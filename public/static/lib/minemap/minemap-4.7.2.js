/**
 * minemap-3d-engine
 * version: v4.7.2
 * submission time: 2024-04-12 17:35:55 +0800
 * build time: 2024-04-12 17:38:41
 * branch: master
 * SHA: dfddb36eebaac68dc8aff87a6f4971191ec55749
 */
(function (global, factory) {
typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
typeof define === 'function' && define.amd ? define(factory) :
(global = typeof globalThis !== 'undefined' ? globalThis : global || self, global.minemap = factory());
})(this, (function () { 'use strict';

/* eslint-disable */
var shared, worker, minemap;
function define(_, chunk) {
	if (!shared) {
		shared = chunk;
	} else if (!worker) {
		worker = chunk;
	} else {
		var workerBundleString =
			"self.onerror = function() { console.error('解析webworker附属包出问题'); }; var sharedChunk = {}; (" +
			shared +
			")(sharedChunk); (" +
			worker +
			")(sharedChunk); self.onerror = null;";
		var sharedChunk = {};
		shared(sharedChunk);
		minemap = chunk(sharedChunk);
		if (typeof window !== "undefined" && window && window.URL && window.URL.createObjectURL) {
			minemap.workerUrl = window.URL.createObjectURL(new Blob([workerBundleString], { type: "text/javascript" }));
		}
	}
}


define(["exports"],(function(e){"use strict";const t=1/Math.PI*180,i=1/180*Math.PI,n=1e-12;function r(e,t,i){if(o(e)){i=i||((n=e).clone?n.clone():new Array(...n));for(let n=0;n<i.length&&n<e.length;++n)i[n]=t(e[n],n,i);return i}var n;return t(e)}function o(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function a(e){return r(e,(e=>e*i))}function s(e){return r(e,(e=>e*t))}function l(e,t,i){return r(e,(e=>Math.max(t,Math.min(i,e))))}function c(e,t){if(e===t)return !0;if(o(e)&&o(t)){if(e.length!==t.length)return !1;for(let i=0;i<e.length;++i)if(!c(e[i],t[i]))return !1;return !0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):!(!Number.isFinite(e)||!Number.isFinite(t))&&Math.abs(e-t)<=n*Math.max(1,Math.abs(e),Math.abs(t))}class u extends Array{get ELEMENTS(){return this.length}get elements(){return this}clone(){return (new this.constructor).copy(this)}from(e){return o(e)?this.copy(e):this.fromObject(e)}fromArray(e,t=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+t];return this.check()}to(e){return e===this?this:o(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toArray(e=[],t=0){for(let i=0;i<this.ELEMENTS;++i)e[t+i]=this[i];return e}toObject(e={}){for(let t=0;t<this.ELEMENTS;++t)e[t]=this[t];return e}toFloat32Array(){return new Float32Array(this.toArray())}toString(){return this._formatString()}_formatString(){let e="";for(let i=0;i<this.ELEMENTS;++i)e+=(i>0?", ":"")+(t=function(e){return Math.round(e/n)*n}(t=this[i]),`${parseFloat(t.toPrecision(4))}`);var t;return `[${e}]`}equals(e){if(!e||this.length!==e.length)return !1;for(let t=0;t<this.ELEMENTS;++t)if(!c(this[t],e[t]))return !1;return !0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}add(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]+=t[e];return this.check()}subtract(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]-=t[e];return this.check()}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyScalar(1/e)}clampScalar(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),t);return this.check()}multiplyByScalar(e){return this.multiplyScalar(e)}divideByScalar(e){return this.divideScalar(e)}check(){return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}}const h={};function d(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${e}`);return e}function p(e,t,i=""){if(!function(e,t){if(e.length!==t)return !1;for(let t=0;t<e.length;++t)if(!Number.isFinite(e[t]))return !1;return !0}(e,t))throw new Error(`math.gl: ${i} some fields set to invalid numbers'`);return e}function f(e,t){h[e]||(h[e]=!0,console.warn(`${e} has been removed in version ${t}, see upgrade guide for more information`));}var m=1e-6,_="undefined"!=typeof Float32Array?Float32Array:Array;function g(e,t,i){var n=t[0],r=t[1],o=t[2],a=t[3],s=i[0],l=i[1],c=i[2],u=i[3];return e[0]=n*s+o*l,e[1]=r*s+a*l,e[2]=n*c+o*u,e[3]=r*c+a*u,e}function y(e,t,i){var n=t[1],r=t[2],o=t[3],a=i[0],s=i[1];return e[0]=t[0]*a,e[1]=n*a,e[2]=r*s,e[3]=o*s,e}function x(e,t,i){var n=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=i[0],p=i[1],f=i[2],m=i[3],_=i[4],g=i[5],y=i[6],x=i[7],v=i[8];return e[0]=d*n+p*a+f*c,e[1]=d*r+p*s+f*u,e[2]=d*o+p*l+f*h,e[3]=m*n+_*a+g*c,e[4]=m*r+_*s+g*u,e[5]=m*o+_*l+g*h,e[6]=y*n+x*a+v*c,e[7]=y*r+x*s+v*u,e[8]=y*o+x*l+v*h,e}function v(e,t,i){var n=i[0],r=i[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function w(e,t,i){var n=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],m=t[12],_=t[13],g=t[14],y=t[15],x=i[0],v=i[1],w=i[2],T=i[3];return e[0]=x*n+v*s+w*h+T*m,e[1]=x*r+v*l+w*d+T*_,e[2]=x*o+v*c+w*p+T*g,e[3]=x*a+v*u+w*f+T*y,e[4]=(x=i[4])*n+(v=i[5])*s+(w=i[6])*h+(T=i[7])*m,e[5]=x*r+v*l+w*d+T*_,e[6]=x*o+v*c+w*p+T*g,e[7]=x*a+v*u+w*f+T*y,e[8]=(x=i[8])*n+(v=i[9])*s+(w=i[10])*h+(T=i[11])*m,e[9]=x*r+v*l+w*d+T*_,e[10]=x*o+v*c+w*p+T*g,e[11]=x*a+v*u+w*f+T*y,e[12]=(x=i[12])*n+(v=i[13])*s+(w=i[14])*h+(T=i[15])*m,e[13]=x*r+v*l+w*d+T*_,e[14]=x*o+v*c+w*p+T*g,e[15]=x*a+v*u+w*f+T*y,e}function T(){var e=new _(3);return _!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function b(e){return Math.hypot(e[0],e[1],e[2])}function P(e,t,i){var n=new _(3);return n[0]=e,n[1]=t,n[2]=i,n}function S(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function A(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function E(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function C(e,t){var i=t[0]-e[0],n=t[1]-e[1],r=t[2]-e[2];return i*i+n*n+r*r}function M(e,t){var i=t[0],n=t[1],r=t[2],o=i*i+n*n+r*r;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function I(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function L(e,t,i){var n=t[0],r=t[1],o=t[2],a=i[0],s=i[1],l=i[2];return e[0]=r*l-o*s,e[1]=o*a-n*l,e[2]=n*s-r*a,e}function N(e,t,i){var n=t[0],r=t[1],o=t[2],a=i[3]*n+i[7]*r+i[11]*o+i[15];return e[0]=(i[0]*n+i[4]*r+i[8]*o+i[12])/(a=a||1),e[1]=(i[1]*n+i[5]*r+i[9]*o+i[13])/a,e[2]=(i[2]*n+i[6]*r+i[10]*o+i[14])/a,e}function R(e,t,i){var n=t[0],r=t[1],o=t[2];return e[0]=n*i[0]+r*i[3]+o*i[6],e[1]=n*i[1]+r*i[4]+o*i[7],e[2]=n*i[2]+r*i[5]+o*i[8],e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var O=function(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e},D=b;function F(e,t,i){var n=t[0],r=t[1],o=t[2],a=t[3];return e[0]=i[0]*n+i[4]*r+i[8]*o+i[12]*a,e[1]=i[1]*n+i[5]*r+i[9]*o+i[13]*a,e[2]=i[2]*n+i[6]*r+i[10]*o+i[14]*a,e[3]=i[3]*n+i[7]*r+i[11]*o+i[15]*a,e}function z(e,t,i){var n=t[0],r=t[1],o=t[2],a=i[0],s=i[1],l=i[2],c=i[3],u=c*n+s*o-l*r,h=c*r+l*n-a*o,d=c*o+a*r-s*n,p=-a*n-s*r-l*o;return e[0]=u*c+p*-a+h*-l-d*-s,e[1]=h*c+p*-s+d*-a-u*-l,e[2]=d*c+p*-l+u*-s-h*-a,e[3]=t[3],e}function B(){var e=new _(4);return _!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function V(e,t,i){i*=.5;var n=Math.sin(i);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(i),e}function U(e,t,i){var n=t[0],r=t[1],o=t[2],a=t[3],s=i[0],l=i[1],c=i[2],u=i[3];return e[0]=n*u+a*s+r*c-o*l,e[1]=r*u+a*l+o*s-n*c,e[2]=o*u+a*c+n*l-r*s,e[3]=a*u-n*s-r*l-o*c,e}T(),function(){var e;e=new _(4),_!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0);}();var k,G,H,Y,q=(k=T(),G=P(1,0,0),H=P(0,1,0),function(e,t,i){var n=I(t,i);return n<-.999999?(L(k,G,t),D(k)<1e-6&&L(k,H,t),M(k,k),V(e,k,Math.PI),e):n>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(L(k,t,i),e[0]=k[0],e[1]=k[1],e[2]=k[2],e[3]=1+n,function(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],a=i*i+n*n+r*r+o*o;return a>0&&(a=1/Math.sqrt(a)),e[0]=i*a,e[1]=n*a,e[2]=r*a,e[3]=o*a,e}(e,e))});function X(e,t,i){var n=t[0],r=t[1];return e[0]=i[0]*n+i[2]*r,e[1]=i[1]*n+i[3]*r,e}function j(e,t,i){var n=t[0],r=t[1];return e[0]=i[0]*n+i[3]*r+i[6],e[1]=i[1]*n+i[4]*r+i[7],e}function W(e,t,i){var n=t[0],r=t[1];return e[0]=i[0]*n+i[4]*r+i[12],e[1]=i[1]*n+i[5]*r+i[13],e}function $(e){return null!=e}function Z(e,t){return null!=e?e:t}B(),B(),Y=new _(9),_!=Float32Array&&(Y[1]=0,Y[2]=0,Y[3]=0,Y[5]=0,Y[6]=0,Y[7]=0),Y[0]=1,Y[4]=1,Y[8]=1,function(){var e=new _(2);_!=Float32Array&&(e[0]=0,e[1]=0);}(),Z.EMPTY_OBJECT=Object.freeze({});var K=Q;function Q(e,t,i,n){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=i,this.p2y=n;}Q.prototype.sampleCurveX=function(e){return ((this.ax*e+this.bx)*e+this.cx)*e},Q.prototype.sampleCurveY=function(e){return ((this.ay*e+this.by)*e+this.cy)*e},Q.prototype.sampleCurveDerivativeX=function(e){return (3*this.ax*e+2*this.bx)*e+this.cx},Q.prototype.solveCurveX=function(e,t){var i,n,r,o,a;for(void 0===t&&(t=1e-6),r=e,a=0;a<8;a++){if(o=this.sampleCurveX(r)-e,Math.abs(o)<t)return r;var s=this.sampleCurveDerivativeX(r);if(Math.abs(s)<1e-6)break;r-=o/s;}if((r=e)<(i=0))return i;if(r>(n=1))return n;for(;i<n;){if(o=this.sampleCurveX(r),Math.abs(o-e)<t)return r;e>o?i=r:n=r,r=.5*(n-i)+i;}return r},Q.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var J="undefined"!=typeof self?self:{};class ee{constructor(e,t,i){this.column=e,this.row=t,this.zoom=i;}clone(){return new ee(this.column,this.row,this.zoom)}zoomTo(e){return this.clone()._zoomTo(e)}sub(e){return this.clone()._sub(e)}_zoomTo(e){const t=Math.pow(2,e-this.zoom);return this.column*=t,this.row*=t,this.zoom=e,this}_sub(e){return e=e.zoomTo(this.zoom),this.column-=e.column,this.row-=e.row,this}}var te=ie;function ie(e,t,i){this.x=e,this.y=t,this.z=i||0;}ie.prototype={clone:function(){return new ie(this.x,this.y,this.z)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),n=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=n,this},_rotateAround:function(e,t){var i=Math.cos(e),n=Math.sin(e),r=t.y+n*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-n*(this.y-t.y),this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ie.convert=function(e){return e instanceof ie?e:Array.isArray(e)?new ie(e[0],e[1],e[2]):e};var ne=6371008.8,re={centimeters:100*ne,centimetres:100*ne,degrees:ne/111325,feet:3.28084*ne,inches:39.37*ne,kilometers:ne/1e3,kilometres:ne/1e3,meters:ne,metres:ne,miles:ne/1609.344,millimeters:1e3*ne,millimetres:1e3*ne,nauticalmiles:ne/1852,radians:1,yards:1.0936*ne};function oe(e,t,i){void 0===i&&(i={});var n={type:"Feature"};return (0===i.id||i.id)&&(n.id=i.id),i.bbox&&(n.bbox=i.bbox),n.properties=t||{},n.geometry=e,n}function ae(e,t,i){if(void 0===i&&(i={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!de(e[0])||!de(e[1]))throw new Error("coordinates must contain numbers");return oe({type:"Point",coordinates:e},t,i)}function se(e,t,i){if(void 0===i&&(i={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return oe({type:"LineString",coordinates:e},t,i)}function le(e,t){void 0===t&&(t={});var i={type:"FeatureCollection"};return t.id&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.features=e,i}function ce(e,t){void 0===t&&(t="kilometers");var i=re[t];if(!i)throw new Error(t+" units is invalid");return e*i}function ue(e){return e%360*Math.PI/180}function he(e,t,i){if(void 0===t&&(t="kilometers"),void 0===i&&(i="kilometers"),!(e>=0))throw new Error("length must be a positive number");return ce(function(e,t){void 0===t&&(t="kilometers");var i=re[t];if(!i)throw new Error(t+" units is invalid");return e/i}(e,t),i)}function de(e){return !isNaN(e)&&null!==e&&!Array.isArray(e)}function pe(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function fe(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function me(e,t,i){if(!e)throw new Error("No feature passed");if(!i)throw new Error(".featureOf() requires a name");if(!e||"Feature"!==e.type||!e.geometry)throw new Error("Invalid input to "+i+", Feature with geometry required");if(!e.geometry||e.geometry.type!==t)throw new Error("Invalid input to "+i+": must be a "+t+", given "+e.geometry.type)}function _e(e){return "Feature"===e.type?e.geometry:e}function ge(e,t,i){void 0===i&&(i={});var n=pe(e),r=pe(t),o=ue(r[1]-n[1]),a=ue(r[0]-n[0]),s=ue(n[1]),l=ue(r[1]),c=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(l);return ce(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),i.units)}function ye(e,t,i){if(null!==e)for(var n,r,o,a,s,l,c,u,h=0,d=0,p=e.type,f="FeatureCollection"===p,m="Feature"===p,_=f?e.features.length:1,g=0;g<_;g++){s=(u=!!(c=f?e.features[g].geometry:m?e.geometry:e)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var y=0;y<s;y++){var x=0,v=0;if(null!==(a=u?c.geometries[y]:c)){l=a.coordinates;var w=a.type;switch(h=!i||"Polygon"!==w&&"MultiPolygon"!==w?0:1,w){case null:break;case"Point":if(!1===t(l,d,g,x,v))return !1;d++,x++;break;case"LineString":case"MultiPoint":for(n=0;n<l.length;n++){if(!1===t(l[n],d,g,x,v))return !1;d++,"MultiPoint"===w&&x++;}"LineString"===w&&x++;break;case"Polygon":case"MultiLineString":for(n=0;n<l.length;n++){for(r=0;r<l[n].length-h;r++){if(!1===t(l[n][r],d,g,x,v))return !1;d++;}"MultiLineString"===w&&x++,"Polygon"===w&&v++;}"Polygon"===w&&x++;break;case"MultiPolygon":for(n=0;n<l.length;n++){for(v=0,r=0;r<l[n].length;r++){for(o=0;o<l[n][r].length-h;o++){if(!1===t(l[n][r][o],d,g,x,v))return !1;d++;}v++;}x++;}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)if(!1===ye(a.geometries[n],t,i))return !1;break;default:throw new Error("Unknown Geometry Type")}}}}}function xe(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var i=0;i<e.features.length&&!1!==t(e.features[i],i);i++);}function ve(e,t){!function(e,t){var i,n,r,o,a,s,l,c,u,h,d=0,p="FeatureCollection"===e.type,f="Feature"===e.type,m=p?e.features.length:1;for(i=0;i<m;i++){for(c=p?e.features[i].properties:f?e.properties:{},u=p?e.features[i].bbox:f?e.bbox:void 0,h=p?e.features[i].id:f?e.id:void 0,a=(l=!!(s=p?e.features[i].geometry:f?e.geometry:e)&&"GeometryCollection"===s.type)?s.geometries.length:1,r=0;r<a;r++)if(null!==(o=l?s.geometries[r]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,d,c,u,h))return !1;break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(!1===t(o.geometries[n],d,c,u,h))return !1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,d,c,u,h))return !1;d++;}}(e,(function(e,i,n,r,o){var a,s=null===e?null:e.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return !1!==t(oe(e,n,{bbox:r,id:o}),i,0)&&void 0}switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";}for(var l=0;l<e.coordinates.length;l++)if(!1===t(oe({type:a,coordinates:e.coordinates[l]},n),i,l))return !1}));}function we(e,t){ve(e,(function(e,i,n){var r=0;if(e.geometry){var o=e.geometry.type;if("Point"!==o&&"MultiPoint"!==o){var a,s=0,l=0,c=0;return !1!==ye(e,(function(o,u,h,d,p){if(void 0===a||i>s||d>l||p>c)return a=o,s=i,l=d,c=p,void(r=0);var f=se([a,o],e.properties);if(!1===t(f,i,n,p,r))return !1;r++,a=o;}))&&void 0}}}));}function Te(e,t,i){if(void 0===i&&(i={}),i.method||(i.method="geodesic"),i.units||(i.units="kilometers"),!e)throw new Error("pt is required");if(Array.isArray(e)?e=ae(e):"Point"===e.type?e=oe(e):me(e,"Point","point"),!t)throw new Error("line is required");Array.isArray(t)?t=se(t):"LineString"===t.type?t=oe(t):me(t,"LineString","line");var n=1/0,r=e.geometry.coordinates;return we(t,(function(e){var t=function(e,t,i,n){var r=[i[0]-t[0],i[1]-t[1]],o=be([e[0]-t[0],e[1]-t[1]],r);if(o<=0)return Pe(e,t,{method:n.method,units:"degrees"});var a=be(r,r);if(a<=o)return Pe(e,i,{method:n.method,units:"degrees"});var s=o/a;return Pe(e,[t[0]+s*r[0],t[1]+s*r[1]],{method:n.method,units:"degrees"})}(r,e.geometry.coordinates[0],e.geometry.coordinates[1],i);t<n&&(n=t);})),he(n,"degrees",i.units)}function be(e,t){return e[0]*t[0]+e[1]*t[1]}function Pe(e,t,i){return "planar"===i.method?function(e,t,i){void 0===i&&(i={});var n=pe(e),r=pe(t);r[0]+=r[0]-n[0]>180?-360:n[0]-r[0]>180?360:0;var o=function(e,t,i){var n=i=void 0===i?ne:Number(i),r=e[1]*Math.PI/180,o=t[1]*Math.PI/180,a=o-r,s=Math.abs(t[0]-e[0])*Math.PI/180;s>Math.PI&&(s-=2*Math.PI);var l=Math.log(Math.tan(o/2+Math.PI/4)/Math.tan(r/2+Math.PI/4)),c=Math.abs(l)>1e-11?a/l:Math.cos(r);return Math.sqrt(a*a+c*c*s*s)*n}(n,r);return he(o,"meters",i.units)}(e,t,i):ge(e,t,i)}function Se(e,t){return e.length>1?function(e,t,i){return void 0===i&&(i={}),oe({type:"MultiLineString",coordinates:e},t,i)}(e,t):se(e[0],t)}var Ae=Array.isArray||function(e){return "[object Array]"===Object.prototype.toString.call(e)},Ee=function(e,t){if(!Ae(e))throw new Error("Coordinates must be an array");if(e.length<2)throw new Error("Coordinates must be at least 2 numbers long");return {type:"Feature",geometry:{type:"Point",coordinates:e},properties:t||{}}},Ce=function(e,t){if(!e)throw new Error("No coordinates passed");return {type:"Feature",geometry:{type:"LineString",coordinates:e},properties:t||{}}},Me=function(e,t){if(null===e)throw new Error("No coordinates passed");for(var i=0;i<e.length;i++)for(var n=e[i],r=0;r<n[n.length-1].length;r++){if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(n[n.length-1][r]!==n[0][r])throw new Error("First and last Position are not equivalent.")}var o={type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:t};return o.properties||(o.properties={}),o};const Ie=Math.pow(2,53)-1;function Le(e){return "function"==typeof e||"object"==typeof e&&null!==e&&!Array.isArray(e)}function Ne(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,i=t*e;return 4*(e<.5?i:3*(e-t)+i-.75)}function Re(e,t,i,n){const r=new K(e,t,i,n);return function(e){return r.solve(e)}}const Oe=Re(.25,.1,.25,1);function De(e,t,i){return Math.min(i,Math.max(t,e))}function Fe(e,t,i){const n=i-t,r=((e-t)%n+n)%n+t;return r===t?i:r}function ze(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}Re(0,.7,1,.3),Re(0,0,1,1),Re(.42,0,1,1),Re(0,0,.58,1),Re(.42,0,.58,1);let Be=1;function Ve(){return Be++}function Ue(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function ke(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Ge(e,t){e.forEach((e=>{t[e]&&(t[e]=t[e].bind(t));}));}function He(e,t){return -1!==e.indexOf(t,e.length-t.length)}function Ye(e,t,i){const n={};for(const r in e)n[r]=t.call(i||this,e[r],r,e);return n}function qe(e,t,i){const n={};for(const r in e)t.call(i||this,e[r],r,e)&&(n[r]=e[r]);return n}function Xe(e){return Array.isArray(e)?e.map(Xe):"object"==typeof e&&e?Ye(e,Xe):e}const je={};function We(e){je[e]||("undefined"!=typeof console&&console.warn(e),je[e]=!0);}function $e(e,t,i){return (i.y-e.y)*(t.x-e.x)>(t.y-e.y)*(i.x-e.x)}function Ze(e){let t=0;for(let i,n,r=0,o=e.length,a=o-1;r<o;a=r++)i=e[r],n=e[a],t+=(n.x-i.x)*(i.y+n.y);return t}function Ke(){return "undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function Qe(e){return "number"==typeof e}function Je(e){return "boolean"==typeof e}function et(e,t){let i;if("Feature"===t.type&&(t=t.geometry),"MultiPolygon"===t.type)i=t.coordinates.map((t=>et(e,Me(t)))).reduce(((e,t)=>t<e?t:e));else if(t.coordinates.length>1){const[n,...r]=t.coordinates.map((t=>et(e,Me([t]).geometry)));if(n<0){const e=r.reduce(((e,t)=>t<e?t:e));i=e<0||e<n?e:n;}else i=n;}else i=Te(e,function(e,t){void 0===t&&(t={});var i=_e(e);switch(t.properties||"Feature"!==e.type||(t.properties=e.properties),i.type){case"Polygon":return function(e,t){return void 0===t&&(t={}),Se(_e(e).coordinates,t.properties?t.properties:"Feature"===e.type?e.properties:{})}(i,t);case"MultiPolygon":return function(e,t){void 0===t&&(t={});var i=_e(e),n=t.properties?t.properties:"Feature"===e.type?e.properties:{},r=[];return i.coordinates.forEach((function(e){r.push(Se(e,n));})),le(r)}(i,t);default:throw new Error("invalid poly")}}(t),{units:"miles"});return i}const tt=6378137,it=3.141592653589793,nt={DEFAULT_SPHERE_TRIANGLES:[],SCROLL_ZOOM_SPHERE_CONTROL:4,TILE_GRIDSAMPLES_SPLIT:{SMALL:4,MIDDLE:6,LARGE:9,LARGE_S:20,SMALL_Z_SAMPLES:16,MIDDLE_Z_SAMPLES:8,LARGE_Z_SAMPLES:2,LARGE_S_Z_SAMPLES:1,THE_MIN_SAMPLES:1},TRANSFORM:{PROJECTION_CHANGE_SMALL_ZOOM:5,PROJECTION_CHANGE_MIDDLE_ZOOM:10,PROJECTION_CHANGE_LARGE_ZOOM:15,MAX_LAT:90,MIN_LAT:-90,SPHERE_MAX_PITCH:90,PLAIN_MAX_PITCH:90,SPHERE_DRAG_PAN_MAX_PITCH:45,DEG_TO_RAD:it/180,RAD_TO_DEG:180/it,R:tt,R1:6356752.314245179,REAL_R:6378137,R2:40680631590769,R_SCALE:1,R_ZOOM:1,CIR:2*it*tt,COVERING_TILE_ZOOM:6,EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,UNIT_Z:[0,0,1],UNIT_Z_REVERSE:[0,0,-1],VIEW_MAX_BOUNDING:{west:-180,south:-85.05113,east:180,north:85.05113},PI:it,TWO_PI:2*it,PI_OVER_TWO:it/2,FP_ZOOM:17,TERRAIN_FIND_ZOOM_MIN:5,TERRAIN_SIMPLIFY_ZOOM_MAX:15,ERR_TERRAIN_ALT:-tt,OFFSCREEN_WIDTH:2048,OFFSCREEN_HEIGHT:2048,SHADOW_VIEWPORT_SIZE:[8192,8192],RAY_PICK_MIN_ZOOM:4,BOUND_KEYS:["topLeft","topMidL","topMiddle","topMidR","topRight","bottomRight","bottomMiddle","bottomLeft"],FOV_IN_RADIANS:.6435011087932844,FOV_IN_DEGREES:36.86989764584402},CesiumMath:{EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,EPSILON21:1e-21,GRAVITATIONALPARAMETER:3986004418e5,SOLAR_RADIUS:6955e5,LUNAR_RADIUS:1737400,SIXTY_FOUR_KILOBYTES:65536,FOUR_GIGABYTES:4294967296,PI:Math.PI,ONE_OVER_PI:1/Math.PI,PI_OVER_TWO:Math.PI/2,PI_OVER_THREE:Math.PI/3,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,THREE_PI_OVER_TWO:3*Math.PI/2,TWO_PI:2*Math.PI,ONE_OVER_TWO_PI:1/(2*Math.PI),RADIANS_PER_DEGREE:Math.PI/180,DEGREES_PER_RADIAN:180/Math.PI,RADIANS_PER_ARCSECOND:Math.PI/180/3600,log2:Z(Math.log2,(e=>Math.log(e)*Math.LOG2E)),clamp:(e,t,i)=>e<t?t:e>i?i:e,equalsEpsilon(e,t,i,n){i=i||0,n=n||i;const r=Math.abs(e-t);return r<=n||r<=i*Math.max(Math.abs(e),Math.abs(t))},toRadians:e=>e*nt.CesiumMath.RADIANS_PER_DEGREE,toDegrees:e=>e*nt.CesiumMath.DEGREES_PER_RADIAN,negativePiToPi:e=>e>=-nt.CesiumMath.PI&&e<=nt.CesiumMath.PI?e:nt.CesiumMath.zeroToTwoPi(e+nt.CesiumMath.PI)-nt.CesiumMath.PI,zeroToTwoPi(e){if(e>=0&&e<=nt.CesiumMath.TWO_PI)return e;const t=nt.CesiumMath.mod(e,nt.CesiumMath.TWO_PI);return Math.abs(t)<nt.CesiumMath.EPSILON14&&Math.abs(e)>nt.CesiumMath.EPSILON14?nt.CesiumMath.TWO_PI:t},mod:(e,t)=>Math.sign(e)===Math.sign(t)&&Math.abs(e)<Math.abs(t)?e:(e%t+t)%t,acosClamped:e=>Math.acos(De(e,-1,1)),asinClamped:e=>Math.asin(De(e,-1,1)),chordLength(e,t){if(void 0===e)throw new Error("angle is required.");if(void 0===t)throw new Error("radius is required.");return 2*t*Math.sin(.5*e)},fastApproximateAtan2(e,t){let i,n=Math.abs(e);i=Math.abs(t);const r=Math.max(n,i);i=Math.min(n,i);const o=i/r;if(isNaN(o))throw new Error("either x or y must be nonzero");return n=nt.CesiumMath.fastApproximateAtan(o),n=Math.abs(t)>Math.abs(e)?nt.CesiumMath.PI_OVER_TWO-n:n,n=e<0?nt.CesiumMath.PI-n:n,n=t<0?-n:n,n},fastApproximateAtan:e=>e*(-.1784*Math.abs(e)-.0663*e*e+1.0301)},TEXTUREWRAP:{REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648},TEXTUREMAGNIFICATIONFILTER:{NEAREST:9728,LINEAR:9729},TEXTUREMINNIFICATIONFILTER:{NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987},SOURCE:{MAX_BOUNDS:[[-180,90],[180,90],[180,-90],[-180,-90]],ERROR_IMG_INDEX:-999,CLOCK_SKEW_RETRY_TIMEOUT:3e4,TRANSPARENT_PNG_URL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",MAX_PARALLEL_IMAGE_REQUESTS:16,GLOBAL_SOURCE_ID:"sphere-image-globe",SKYBOX_SOURCE_ID:"sphere-image-skybox",PANORAMA_SOURCE_ID:"panorama-special-source",ATMOSPHERE_SOURCE_ID:"sphere-atmosphere",COSMOS_SOURCE_ID:"sphere-cosmos",MAX_GLTF_TILE_COUNT:300,MAX_GLTF_TILE_TO_FIND_PARENT:64,MAX_IMAGE_CONCURRENCY:32,TEXTURE_CUBE_KEYS:["px","nx","py","ny","pz","nz"],ION_ACCESS_TOKEN:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIzMGY4ODczYy1mNTk4LTRiMDUtYmIxYy0xZWYwOWZmMGY4NjQiLCJpZCI6NDQsInNjb3BlcyI6WyJhc3IiLCJnYyJdLCJhc3NldHMiOlsxLDIsMyw0LDYxOTMsNjI3Myw3MTYyLDczNTMsNzE0Ml0sImlhdCI6MTU0MTYxODM0NX0.lWnGs9ySXO4QK3HagcMsDpZ8L01DpmUDQm38-2QAQuE"},HIGHLIGHT_TYPE:{PRIMITIVE:"PRIMITIVE",NODE:"NODE",SCENE:"SCENE"},MODEL_TYPE:{OSGB:"osgb",E3DCM:"e3dcm",TDMODEL:"3dmodel"},LAYER:{PANORAMA_LAYER_ID:"panorama-special-layer",RADIATION_REGIONS:5},TILE:{EXTENT:8192,DEPTH_MAX_RANGE:1,OFFSCREEN_SIZE:1024},FRAMEBUFFER:{DEPTH_IMAGE_SCALE:1},EFFECTS:{FOG_START_DISTANCE:4e3,FOG_CALC_LENGTH:2e4,SHADOW_OFFSET:25e-8},CAMERA:{SUNLIGHT_CAMERA_ID:"SUNLIGHT_CAMERA_ID",SKYBOX_CAMERA_ID:"SKYBOX_CAMERA_ID",ATMOSPHERE_BLEND_CAMERA_ID:"ATMOSPHERE_BLEND_CAMERA_ID",DRAW_MODE:{NORMAL:"NORMAL",OFFSCREEN:"OFFSCREEN",OFFSCREEN_VIEWSHED:"OFFSCREEN_VIEWSHED",ONSCREEN_SHADOW:"SHADOW",ONSCREEN_VIEWSHED:"VIEWSHED",ONSCREEN_ALL:"ONSCREEN_ALL"},SUNLIGHT_FIXED_MODE:{FIXED:"FIXED",DYNAMIC:"DYNAMIC"}},GL_CONST:{SHADOW_TEXTURE_UNIT1:{VALUE:33984,INDEX:0},SHADOW_TEXTURE_UNIT2:{VALUE:33985,INDEX:1},SHADOW_BASE_TEXTURE_UNIT:{VALUE:33986,INDEX:2},FXAA_TEXTURE_UNIT1:{VALUE:33987,INDEX:3},BLUR_TEXTURE_UNIT1:{VALUE:33988,INDEX:4},BLUR_TEXTURE_UNIT2:{VALUE:33989,INDEX:5},MODEL_TEXTURE_UNIT1:{VALUE:33990,INDEX:6},MODEL_TEXTURE_UNIT2:{VALUE:33991,INDEX:7},MODEL_TEXTURE_UNIT3:{VALUE:33992,INDEX:8},MODEL_TEXTURE_UNIT4:{VALUE:33993,INDEX:9},MODEL_TEXTURE_UNIT5:{VALUE:33994,INDEX:10},VIDEO_TEXTURE_UNIT1:{VALUE:33995,INDEX:11},PATTERN_TEXTURE_UNIT1:{VALUE:33996,INDEX:12},BRDF_TEXTURE_UNIT:{VALUE:33997,INDEX:13},TEXTURE14:{VALUE:33998,INDEX:14},TEXTURE15:{VALUE:33999,INDEX:15},TEXTURE16:{VALUE:34e3,INDEX:16},TEXTURE17:{VALUE:34001,INDEX:17},TEXTURE18:{VALUE:34002,INDEX:18}},PERFORMANCE:{MODE:{FLIGHT:"FLIGHT",MANUAL:"MANUAL"},SMOOTH_CONSTS:{FRAME_RATE:30,FRAME_DURATION:33.33}},COMPRESSED_TEXTURE_TYPE:{COMPRESSED_RGB_S3TC:{COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779},COMPRESSED_RGB_PVRTC:{COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843},COMPRESSED_RGB_ETC1_WEBGL:36196},COLORTYPEANDLENGTH:{ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,FRAGMENT_SHADER:35632},PixelDatatype:{UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126,HALF_FLOAT_OES:36193,UNSIGNED_INT_24_8:34042,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635}},rt={SYMTRACKING_DISPLAY_MODE:{DEFAULT:"default",SEQUENCE:"time-sequence",TIMESTAMP:"timestamp"}};class ot{constructor(e=0,t=0,i=0){this.heading=e,this.pitch=t,this.roll=i;}static fromQuaternion(e,t=new ot){const i=2*(e.w*e.y-e.z*e.x),n=1-2*(e.x*e.x+e.y*e.y),r=2*(e.w*e.x+e.y*e.z);return t.heading=-Math.atan2(2*(e.w*e.z+e.x*e.y),1-2*(e.y*e.y+e.z*e.z)),t.roll=Math.atan2(r,n),t.pitch=-nt.CesiumMath.asinClamped(i),t}static fromDegrees(e,t,i,n=new ot){return n.heading=e*nt.CesiumMath.RADIANS_PER_DEGREE,n.pitch=t*nt.CesiumMath.RADIANS_PER_DEGREE,n.roll=i*nt.CesiumMath.RADIANS_PER_DEGREE,n}static clone(e,t=new ot){return t.heading=e.heading,t.pitch=e.pitch,t.roll=e.roll,t}static equals(e,t){return e===t||$(e)&&$(t)&&e.heading===t.heading&&e.pitch===t.pitch&&e.roll===t.roll}static equalsEpsilon(e,t,i=0,n=i){return e===t||$(e)&&$(t)&&nt.CesiumMath.equalsEpsilon(e.heading,t.heading,i,n)&&nt.CesiumMath.equalsEpsilon(e.pitch,t.pitch,i,n)&&nt.CesiumMath.equalsEpsilon(e.roll,t.roll,i,n)}clone(e=new ot){return ot.clone(this,e)}equals(e){return ot.equals(this,e)}equalsEpsilon(e,t=0,i=t){return ot.equalsEpsilon(this,e,t,i)}toString(){return `(${this.heading}, ${this.pitch}, ${this.roll})`}}class at extends u{copy(e){for(let t=0;t<this.ELEMENTS;t++)this[t]=e[t];return this}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let i=0;i<this.ELEMENTS;++i){const n=this[i]-e[i];t+=n*n;}return d(t)}dot(e){let t=0;for(let i=0;i<this.ELEMENTS;++i)t+=this[i]*e[i];return d(t)}normalize(){const e=this.magnitude();if(0!==e)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]*=t[e];return this.check()}divide(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t[e];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return d(this[e])}setComponent(e,t){return this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}scale(e){if(o(e))for(let t=0;t<this.ELEMENTS;++t)this[t]*=e[t];else this.multiplyScalar(e);return this}lerp(e,t,i){void 0===i&&"number"==typeof t&&(i=t,t=e,e=this);for(let n=0;n<this.ELEMENTS;++n){const r=e[n];this[n]=r+i*(t[n]-r);}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),t[i]);return this.check()}}function st(e,t,i){const n=t[0],r=t[1],o=i[3]*n+i[7]*r||1;return e[0]=(i[0]*n+i[4]*r)/o,e[1]=(i[1]*n+i[5]*r)/o,e}function lt(e,t,i){const n=t[0],r=t[1],o=t[2],a=i[3]*n+i[7]*r+i[11]*o||1;return e[0]=(i[0]*n+i[4]*r+i[8]*o)/a,e[1]=(i[1]*n+i[5]*r+i[9]*o)/a,e[2]=(i[2]*n+i[6]*r+i[10]*o)/a,e}function ct(e,t,i){const n=t[0],r=t[1],o=t[2];return e[0]=i[0]*n+i[3]*r+i[6]*o,e[1]=i[1]*n+i[4]*r+i[7]*o,e[2]=i[2]*n+i[5]*r+i[8]*o,e[3]=t[3],e}const ut=[0,0,0],ht={},dt=e=>e;function pt(e,t,i){return t=t||new ft,i=i||dt,o(e)?(t[0]=i(e[0]),t[1]=i(e[1]),t[2]=e[2]):"longitude"in e?(t[0]=i(e.longitude),t[1]=i(e.latitude),t[2]=e.height):(t[0]=i(e.x),t[1]=i(e.y),t[2]=e.z),t}class ft extends at{static get ZERO(){return ht.ZERO=ht.ZERO||Object.freeze(new ft(0,0,0))}static get ONE(){return ht.ONE=ht.ONE||Object.freeze(new ft(1,1,1))}static get UNIT_X(){return ht.UNIT_X=ht.UNIT_X||Object.freeze(new ft(1,0,0))}static get UNIT_Y(){return ht.UNIT_Y=ht.UNIT_Y||Object.freeze(new ft(0,1,0))}static get UNIT_Z(){return ht.UNIT_Z=ht.UNIT_Z||Object.freeze(new ft(0,0,1))}constructor(e,t,i){o(e)?super(e[0],e[1],e[2]):super(e||0,t||0,i||0);}get x(){return this[0]}set x(e){this[0]=d(e);}get y(){return this[1]}set y(e){this[1]=d(e);}get z(){return this[2]}set z(e){this[2]=d(e);}get ELEMENTS(){return 3}set(e,t,i){return this[0]=e,this[1]=t,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e={}){return e.x=this[0],e.y=this[1],e.z=this[2],e}angle(e,t=this){return r=(i=t)[0],o=i[1],a=i[2],s=(n=e)[0],l=n[1],c=n[2],h=(u=Math.sqrt(r*r+o*o+a*a)*Math.sqrt(s*s+l*l+c*c))&&I(i,n)/u,Math.acos(Math.min(Math.max(h,-1),1));var i,n,r,o,a,s,l,c,u,h;}cross(e,t=this){return L(t,this,e),t.check()}rotateX({radians:e,origin:t=ut,result:i=this}){return function(e,t,i,n){var r=[],o=[];r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],o[0]=r[0],o[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n),o[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n),e[0]=o[0]+i[0],e[1]=o[1]+i[1],e[2]=o[2]+i[2];}(i,this,t,e),i.check()}rotateY({radians:e,origin:t=ut,result:i=this}){return function(e,t,i,n){var r=[],o=[];r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],o[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n),o[1]=r[1],o[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n),e[0]=o[0]+i[0],e[1]=o[1]+i[1],e[2]=o[2]+i[2];}(i,this,t,e),i.check()}rotateZ({radians:e,origin:t=ut,result:i=this}){return function(e,t,i,n){var r=[],o=[];r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],o[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),o[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),o[2]=r[2],e[0]=o[0]+i[0],e[1]=o[1]+i[1],e[2]=o[2]+i[2];}(i,this,t,e),i.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e,t=this){return N(t,this,e),t.check()}transformAsVector(e,t=this){return lt(t,this,e),t.check()}transformByMatrix3(e,t=this){return R(t,this,e),t.check()}transformByMatrix2(e,t=this){return function(e,t,i){const n=t[0],r=t[1];e[0]=i[0]*n+i[2]*r,e[1]=i[1]*n+i[3]*r,e[2]=t[2];}(t,this,e),t.check()}transformByQuaternion(e,t=this){return function(e,t,i){var n=i[0],r=i[1],o=i[2],a=t[0],s=t[1],l=t[2],c=r*l-o*s,u=o*a-n*l,h=n*s-r*a,d=r*h-o*u,p=o*c-n*h,f=n*u-r*c,m=2*i[3];u*=m,h*=m,p*=2,f*=2,e[0]=a+(c*=m)+(d*=2),e[1]=s+u+p,e[2]=l+h+f;}(t,this,e),t.check()}applyMatrix3(e){const t=this[0],i=this[1],n=this[2],r=e.elements;return this[0]=r[0]*t+r[3]*i+r[6]*n,this[1]=r[1]*t+r[4]*i+r[7]*n,this[2]=r[2]*t+r[5]*i+r[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this[0],i=this[1],n=this[2],r=e.elements,o=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this[0]=(r[0]*t+r[4]*i+r[8]*n+r[12])*o,this[1]=(r[1]*t+r[5]*i+r[9]*n+r[13])*o,this[2]=(r[2]*t+r[6]*i+r[10]*n+r[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*n-a*i,c=s*i+a*t-r*n,u=s*n+r*i-o*t,h=-r*t-o*i-a*n;return this[0]=l*s+h*-r+c*-a-u*-o,this[1]=c*s+h*-o+u*-r-l*-a,this[2]=u*s+h*-a+l*-o-c*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this[0],i=this[1],n=this[2],r=e.elements;return this[0]=r[0]*t+r[4]*i+r[8]*n,this[1]=r[1]*t+r[5]*i+r[9]*n,this[2]=r[2]*t+r[6]*i+r[10]*n,this.normalize()}clampLength(e,t){const i=this.len();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this[0]=Math.floor(this[0]),this[1]=Math.floor(this[1]),this[2]=Math.floor(this[2]),this}ceil(){return this[0]=Math.ceil(this[0]),this[1]=Math.ceil(this[1]),this[2]=Math.ceil(this[2]),this}round(){return this[0]=Math.round(this[0]),this[1]=Math.round(this[1]),this[2]=Math.round(this[2]),this}roundToZero(){return this[0]=this[0]<0?Math.ceil(this[0]):Math.floor(this[0]),this[1]=this[1]<0?Math.ceil(this[1]):Math.floor(this[1]),this[2]=this[2]<0?Math.ceil(this[2]):Math.floor(this[2]),this}manhattanLength(){return Math.abs(this[0])+Math.abs(this[1])+Math.abs(this[2])}setLength(e){return this.normalize().multiplyScalar(e)}lerpVectors(e,t,i){return this[0]=e[0]+(t[0]-e[0])*i,this[1]=e[1]+(t[1]-e[1])*i,this[2]=e[2]+(t[2]-e[2])*i,this}crossVectors(e,t){const i=e[0],n=e[1],r=e[2],o=t[0],a=t[1],s=t[2];return this[0]=n*s-r*a,this[1]=r*o-i*s,this[2]=i*a-n*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){const t=(new ft).copy(this).projectOnVector(e);return this.sub(t)}reflect(e){return this.sub((new ft).copy(e).multiplyScalar(2*this.dot(e)))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this[0]-e[0],i=this[1]-e[1],n=this[2]-e[2];return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this[0]-e[0])+Math.abs(this[1]-e[1])+Math.abs(this[2]-e[2])}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const n=Math.sin(t)*e;return this[0]=n*Math.sin(i),this[1]=Math.cos(t)*e,this[2]=n*Math.cos(i),this}setFromMatrixPosition(e){const t=e.elements;return this[0]=t[12],this[1]=t[13],this[2]=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).len(),i=this.setFromMatrixColumn(e,1).len(),n=this.setFromMatrixColumn(e,2).len();return this[0]=t,this[1]=i,this[2]=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}static toCartographicFromRadians(e){return pt(e)}static toCartographicFromDegrees(e){return pt(e,new ft,a)}random(){return this[0]=Math.random(),this[1]=Math.random(),this[2]=Math.random(),this}static multiplyByScalar(e,t,i=new ft){return i.x=e.x*t,i.y=e.y*t,i.z=e.z*t,i}static fromElements(e,t,i,n=new ft){return n.x=e,n.y=t,n.z=i,n}static fromDegrees(e,t,i=0,n,r=new ft){return e=nt.CesiumMath.toRadians(e),t=nt.CesiumMath.toRadians(t),ft.fromRadians(e,t,i,n,r)}static fromRadians(e,t,i=0,n,r=new ft){let o,a=new ft,s=new ft;i=Z(i,0),o=$(n)?n.radiiSquared:mt;const l=Math.cos(t);a.x=l*Math.cos(e),a.y=l*Math.sin(e),a.z=Math.sin(t),a=ft.normalize(a,a),ft.multiplyComponents(o,a,s);const c=Math.sqrt(ft.dot(a,s));return s=ft.divideByScalar(s,c,s),a=ft.multiplyByScalar(a,i,a),ft.add(s,a,r)}static fromDegreesArray(e,t,i=new Array(e.length/2)){const n=e.length;for(let r=0;r<n;r+=2){const n=r/2;i[n]=ft.fromDegrees(e[r],e[r+1],0,t,i[n]);}return i}static fromRadiansArray(e,t,i=new Array(e.length/2)){const n=e.length;i.length=n/2;for(let r=0;r<n;r+=2){const n=r/2;i[n]=ft.fromRadians(e[r],e[r+1],0,t,i[n]);}return i}static fromDegreesArrayHeights(e,t,i=new Array(e.length/3)){const n=e.length;i.length=n/3;for(let r=0;r<n;r+=3){const n=r/3;i[n]=ft.fromDegrees(e[r],e[r+1],e[r+2],t,i[n]);}return i}static fromRadiansArrayHeights(e,t,i=new Array(e.length/3)){const n=e.length;i.length=n/3;for(let r=0;r<n;r+=3){const n=r/3;i[n]=ft.fromRadians(e[r],e[r+1],e[r+2],t,i[n]);}return i}clone(e){return ft.clone(this,e)}static clone(e,t=new ft(e.x,e.y,e.z)){return t.x=e.x,t.y=e.y,t.z=e.z,t}equals(e){return ft.equals(this,e)}static equals(e,t){return e===t||$(e)&&$(t)&&e.x===t.x&&e.y===t.y&&e.z===t.z}equalsEpsilon(e,t=0,i=t){return ft.equalsEpsilon(this,e,t,i)}static equalsEpsilon(e,t,i=0,n=i){return e===t||$(e)&&$(t)&&nt.CesiumMath.equalsEpsilon(e.x,t.x,i,n)&&nt.CesiumMath.equalsEpsilon(e.y,t.y,i,n)&&nt.CesiumMath.equalsEpsilon(e.z,t.z,i,n)}toString(){return `(${this.x}, ${this.y}, ${this.z})`}static pack(e,t,i=0){return t[i++]=e.x,t[i++]=e.y,t[i]=e.z,t}static unpack(e,t=0,i=new ft){return i.x=e[t++],i.y=e[t++],i.z=e[t],i}static packArray(e,t=new Array(3*e.length)){const i=e.length,n=3*i;if(!Array.isArray(t)&&t.length!==n)throw new Error("If result is a typed array, it must have exactly array.length * 3 elements");t.length!==n&&(t.length=n);for(let n=0;n<i;++n)ft.pack(e[n],t,3*n);return t}static unpackArray(e,t=new Array(e.length/3)){const i=e.length;t.length=i/3;for(let n=0;n<i;n+=3){const i=n/3;t[i]=ft.unpack(e,n,t[i]);}return t}static maximumComponent(e){return Math.max(e.x,e.y,e.z)}static minimumComponent(e){return Math.min(e.x,e.y,e.z)}static minimumByComponent(e,t,i=new ft){return i.x=Math.min(e.x,t.x),i.y=Math.min(e.y,t.y),i.z=Math.min(e.z,t.z),i}static maximumByComponent(e,t,i=new ft){return i.x=Math.max(e.x,t.x),i.y=Math.max(e.y,t.y),i.z=Math.max(e.z,t.z),i}static magnitudeSquared(e){return e.x*e.x+e.y*e.y+e.z*e.z}static magnitude(e){return Math.sqrt(ft.magnitudeSquared(e))}static distance(e,t){const i=new ft;return ft.subtract(e,t,i),ft.magnitude(i)}static distanceSquared(e,t){const i=new ft;return ft.subtract(e,t,i),ft.magnitudeSquared(i)}static normalize(e,t=new ft){const i=ft.magnitude(e);return t.x=e.x/i,t.y=e.y/i,t.z=e.z/i,t}static dot(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}static multiplyComponents(e,t,i=new ft){return i.x=e.x*t.x,i.y=e.y*t.y,i.z=e.z*t.z,i}static divideComponents(e,t,i=new ft){return i.x=e.x/t.x,i.y=e.y/t.y,i.z=e.z/t.z,i}static add(e,t,i=new ft){return i.x=e.x+t.x,i.y=e.y+t.y,i.z=e.z+t.z,i}static subtract(e,t,i=new ft){return i.x=e.x-t.x,i.y=e.y-t.y,i.z=e.z-t.z,i}static divideByScalar(e,t,i=new ft){return i.x=e.x/t,i.y=e.y/t,i.z=e.z/t,i}static negate(e,t=new ft){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t}static abs(e,t=new ft){return t.x=Math.abs(e.x),t.y=Math.abs(e.y),t.z=Math.abs(e.z),t}static lerp(e,t,i,n=new ft){const r=new ft;return ft.multiplyByScalar(t,i,r),n=ft.multiplyByScalar(e,1-i,n),ft.add(r,n,n)}static angleBetween(e,t){const i=new ft,n=new ft;ft.normalize(e,i),ft.normalize(t,n);const r=ft.dot(i,n),o=ft.magnitude(ft.cross(i,n,i));return Math.atan2(o,r)}static mostOrthogonalAxis(e,t=new ft){const i=new ft,n=ft.normalize(e,i);return ft.abs(n,n),ft.clone(n.x<=n.y?n.x<=n.z?ft.UNIT_X:ft.UNIT_Z:n.y<=n.z?ft.UNIT_Y:ft.UNIT_Z,t)}static projectVector(e,t,i=new ft){const n=ft.dot(e,t)/ft.dot(t,t);return ft.multiplyByScalar(t,n,i)}static equalsArray(e,t,i=0){return e.x===t[i]&&e.y===t[i+1]&&e.z===t[i+2]}static cross(e,t,i=new ft){const n=e.x,r=e.y,o=e.z,a=t.x,s=t.y,l=t.z,c=o*a-n*l,u=n*s-r*a;return i.x=r*l-o*s,i.y=c,i.z=u,i}static midpoint(e,t,i=new ft){return i.x=.5*(e.x+t.x),i.y=.5*(e.y+t.y),i.z=.5*(e.z+t.z),i}static fromCartesian4(...e){return this.clone(...e)}static fromArray(...e){return this.unpack(...e)}}ft.packedLength=3;const mt=new ft(40680631590769,40680631590769,40408299984661.445),_t={},gt=new Float32Array(1),yt=new Uint8Array(gt.buffer),xt=new Uint32Array([287454020]),vt=68===new Uint8Array(xt.buffer)[0];class wt extends at{static get ZERO(){return _t.ZERO=_t.ZERO||Object.freeze(new wt(0,0,0,0))}static get ONE(){return _t.ONE=_t.ONE||Object.freeze(new wt(1,1,1,1))}static get UNIT_X(){return _t.UNIT_X=_t.UNIT_X||Object.freeze(new wt(1,0,0,0))}static get UNIT_Y(){return _t.UNIT_Y=_t.UNIT_Y||Object.freeze(new wt(0,1,0,0))}static get UNIT_Z(){return _t.UNIT_Z=_t.UNIT_Z||Object.freeze(new wt(0,0,1,0))}static get UNIT_W(){return _t.UNIT_W=_t.UNIT_W||Object.freeze(new wt(0,0,0,1))}constructor(e,t,i,n){o(e)?super(e[0],e[1],e[2],e[3]):super(e||0,t||0,i||0,n||0);}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=d(e);}get y(){return this[1]}set y(e){this[1]=d(e);}get z(){return this[2]}set z(e){this[2]=d(e);}get w(){return this[3]}set w(e){this[3]=d(e);}set(e,t,i,n){return this[0]=e,this[1]=t,this[2]=i,this[3]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}transform(e,t=this){return F(t,this,e),t.check()}transformByMatrix3(e,t=this){return ct(t,this,e),t.check()}transformByMatrix2(e,t=this){return function(e,t,i){const n=t[0],r=t[1];e[0]=i[0]*n+i[2]*r,e[1]=i[1]*n+i[3]*r,e[2]=t[2],e[3]=t[3];}(t,this,e),t.check()}transformByQuaternion(e,t){return z(t,this,e),t.check()}applyMatrix4(e){return e.transform(this,this),this}static fromElements(e,t,i,n,r=new wt){return r.x=e,r.y=t,r.z=i,r.w=n,r}static clone(e,t=new wt){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}static pack(e,t,i=0){return t[i++]=e.x,t[i++]=e.y,t[i++]=e.z,t[i]=e.w,t}static unpack(e,t=0,i=new wt){return i.x=e[t++],i.y=e[t++],i.z=e[t++],i.w=e[t],i}static packArray(e,t=new Array(4*e.length)){const i=e.length,n=4*i;if(!Array.isArray(t)&&t.length!==n)throw new Error("If result is a typed array, it must have exactly array.length * 4 elements");t.length!==n&&(t.length=n);for(let n=0;n<i;++n)wt.pack(e[n],t,4*n);return t}static unpackArray(e,t=new Array(e.length/4)){const i=e.length;t.length=i/4;for(let n=0;n<i;n+=4){const i=n/4;t[i]=wt.unpack(e,n,t[i]);}return t}static maximumComponent(e){return Math.max(e.x,e.y,e.z,e.w)}static minimumComponent(e){return Math.min(e.x,e.y,e.z,e.w)}static minimumByComponent(e,t,i=new wt){return i.x=Math.min(e.x,t.x),i.y=Math.min(e.y,t.y),i.z=Math.min(e.z,t.z),i.w=Math.min(e.w,t.w),i}static maximumByComponent(e,t,i=new wt){return i.x=Math.max(e.x,t.x),i.y=Math.max(e.y,t.y),i.z=Math.max(e.z,t.z),i.w=Math.max(e.w,t.w),i}static magnitudeSquared(e){return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w}static magnitude(e){return Math.sqrt(wt.magnitudeSquared(e))}static distance(e,t){const i=new wt;return wt.subtract(e,t,i),wt.magnitude(i)}static distanceSquared(e,t){const i=new wt;return wt.subtract(e,t,i),wt.magnitudeSquared(i)}static normalize(e,t=new wt){const i=wt.magnitude(e);return t.x=e.x/i,t.y=e.y/i,t.z=e.z/i,t.w=e.w/i,t}static dot(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w}static multiplyComponents(e,t,i=new wt){return i.x=e.x*t.x,i.y=e.y*t.y,i.z=e.z*t.z,i.w=e.w*t.w,i}static divideComponents(e,t,i=new wt){return i.x=e.x/t.x,i.y=e.y/t.y,i.z=e.z/t.z,i.w=e.w/t.w,i}static add(e,t,i=new wt){return i.x=e.x+t.x,i.y=e.y+t.y,i.z=e.z+t.z,i.w=e.w+t.w,i}static subtract(e,t,i=new wt){return i.x=e.x-t.x,i.y=e.y-t.y,i.z=e.z-t.z,i.w=e.w-t.w,i}static multiplyByScalar(e,t,i){return i.x=e.x*t,i.y=e.y*t,i.z=e.z*t,i.w=e.w*t,i}static divideByScalar(e,t,i){return i.x=e.x/t,i.y=e.y/t,i.z=e.z/t,i.w=e.w/t,i}static negate(e,t=new wt){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t}static abs(e,t=new wt){return t.x=Math.abs(e.x),t.y=Math.abs(e.y),t.z=Math.abs(e.z),t.w=Math.abs(e.w),t}static lerp(e,t,i,n=new wt){const r=new wt;return wt.multiplyByScalar(t,i,r),n=wt.multiplyByScalar(e,1-i,n),wt.add(r,n,n)}static mostOrthogonalAxis(e,t=new wt){const i=new wt,n=wt.normalize(e,i);return wt.abs(n,n),wt.clone(n.x<=n.y?n.x<=n.z?n.x<=n.w?wt.UNIT_X:wt.UNIT_W:n.z<=n.w?wt.UNIT_Z:wt.UNIT_W:n.y<=n.z?n.y<=n.w?wt.UNIT_Y:wt.UNIT_W:n.z<=n.w?wt.UNIT_Z:wt.UNIT_W,t)}static equals(e,t){return e===t||$(e)&&$(t)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}static equalsArray(e,t,i=0){return e.x===t[i]&&e.y===t[i+1]&&e.z===t[i+2]&&e.w===t[i+3]}static equalsEpsilon(e,t,i=0,n=i){return e===t||$(e)&&$(t)&&nt.CesiumMath.equalsEpsilon(e.x,t.x,i,n)&&nt.CesiumMath.equalsEpsilon(e.y,t.y,i,n)&&nt.CesiumMath.equalsEpsilon(e.z,t.z,i,n)&&nt.CesiumMath.equalsEpsilon(e.w,t.w,i,n)}clone(e=new wt){return wt.clone(this,e)}equals(e){return wt.equals(this,e)}equalsEpsilon(e,t=0,i=t){return wt.equalsEpsilon(this,e,t,i)}toString(){return `(${this.x}, ${this.y}, ${this.z}, ${this.w})`}static packFloat(e,t=new wt){return gt[0]=e,vt?(t.x=yt[0],t.y=yt[1],t.z=yt[2],t.w=yt[3]):(t.x=yt[3],t.y=yt[2],t.z=yt[1],t.w=yt[0]),t}static unpackFloat(e){return vt?(yt[0]=e.x,yt[1]=e.y,yt[2]=e.z,yt[3]=e.w):(yt[0]=e.w,yt[1]=e.z,yt[2]=e.y,yt[3]=e.x),gt[0]}static fromColor(e,t,i=new wt){return void 0!==e.r&&void 0!==e.g&&void 0!==e.b&&void 0!==e.a&&(t?(i.x=e.r/255,i.y=e.g/255,i.z=e.b/255,i.w=e.a):(i.x=e.r,i.y=e.g,i.z=e.b,i.w=e.a)),i}static convert(e){return Array.isArray(e)?new wt(e):e}}class Tt extends u{constructor(e,t,i,n){o(e)?super(e[0],e[1],e[2],e[3]):super(e||0,t||0,i||0,n||1);}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=d(e);}get y(){return this[1]}set y(e){this[1]=d(e);}get z(){return this[2]}set z(e){this[2]=d(e);}get w(){return this[3]}set w(e){this[3]=d(e);}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,i,n){return this[0]=e,this[1]=t,this[2]=i,this[3]=n,this.check()}fromMatrix3(e){return function(e,t){var i,n=t[0]+t[4]+t[8];if(n>0)i=Math.sqrt(n+1),e[3]=.5*i,e[0]=(t[5]-t[7])*(i=.5/i),e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else {var r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);var o=(r+1)%3,a=(r+2)%3;i=Math.sqrt(t[3*r+r]-t[3*o+o]-t[3*a+a]+1),e[r]=.5*i,e[3]=(t[3*o+a]-t[3*a+o])*(i=.5/i),e[o]=(t[3*o+r]+t[3*r+o])*i,e[a]=(t[3*a+r]+t[3*r+a])*i;}}(this,e),this.check()}fromRotationMatrix4(e){const t=e.elements,i=t[0],n=t[4],r=t[8],o=t[1],a=t[5],s=t[9],l=t[2],c=t[6],u=t[10],h=i+a+u;let d;return h>0?(d=.5/Math.sqrt(h+1),this[3]=.25/d,this[0]=(c-s)*d,this[1]=(r-l)*d,this[2]=(o-n)*d):i>a&&i>u?(d=2*Math.sqrt(1+i-a-u),this[3]=(c-s)/d,this[0]=.25*d,this[1]=(n+o)/d,this[2]=(r+l)/d):a>u?(d=2*Math.sqrt(1+a-i-u),this[3]=(r-l)/d,this[0]=(n+o)/d,this[1]=.25*d,this[2]=(s+c)/d):(d=2*Math.sqrt(1+u-i-a),this[3]=(o-n)/d,this[0]=(r+l)/d,this[1]=(s+c)/d,this[2]=.25*d),this}fromHeadingPitchRoll(e){if(!(e instanceof ot))throw new Error("There is not a HeadingPitchRoll!");const t=(new Tt).setFromAxisAngle([1,0,0],e.roll),i=(new Tt).setFromAxisAngle([0,1,0],-e.pitch),n=(new Tt).setFromAxisAngle([0,0,1],-e.heading);return this.multiply(n).multiply(i).multiply(t),this}identity(){return function(e){e[0]=0,e[1]=0,e[2]=0,e[3]=1;}(this),this.check()}fromAxisRotation(e,t){return V(this,e,t),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}len(){return e=this,Math.hypot(e[0],e[1],e[2],e[3]);var e;}lengthSquared(){return (t=(e=this)[0])*t+(i=e[1])*i+(n=e[2])*n+(r=e[3])*r;var e,t,i,n,r;}dot(e){return function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}(this,e)}getAxisAngle(e={}){var t,i,n,r;return e.axis=new ft,e.angle=(t=e.axis,i=this,n=2*Math.acos(i[3]),(r=Math.sin(n/2))>m?(t[0]=i[0]/r,t[1]=i[1]/r,t[2]=i[2]/r):(t[0]=1,t[1]=0,t[2]=0),n),e}rotationTo(e,t){return q(this,e,t),this.check()}add(e){return function(e,t,i){e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3];}(this,this,e),this.check()}calculateW(){return function(e,t){var i=t[0],n=t[1],r=t[2];e[0]=i,e[1]=n,e[2]=r,e[3]=Math.sqrt(Math.abs(1-i*i-n*n-r*r));}(this,this),this.check()}conjugate(){return function(e,t){e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3];}(this,this),this.check()}invert(){return function(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],a=i*i+n*n+r*r+o*o,s=a?1/a:0;e[0]=-i*s,e[1]=-n*s,e[2]=-r*s,e[3]=o*s;}(this,this),this.check()}lerp(e,t,i){return function(e,t,i,n){var r=t[0],o=t[1],a=t[2],s=t[3];e[0]=r+n*(i[0]-r),e[1]=o+n*(i[1]-o),e[2]=a+n*(i[2]-a),e[3]=s+n*(i[3]-s);}(this,e,t,i),this.check()}multiplyRight(e){return U(this,this,e),this.check()}multiplyLeft(e){return U(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,0===e&&(this[3]=1),this.check()}rotateX(e){return function(e,t,i){i*=.5;var n=t[0],r=t[1],o=t[2],a=t[3],s=Math.sin(i),l=Math.cos(i);e[0]=n*l+a*s,e[1]=r*l+o*s,e[2]=o*l-r*s,e[3]=a*l-n*s;}(this,this,e),this.check()}rotateY(e){return function(e,t,i){i*=.5;var n=t[0],r=t[1],o=t[2],a=t[3],s=Math.sin(i),l=Math.cos(i);e[0]=n*l-o*s,e[1]=r*l+a*s,e[2]=o*l+n*s,e[3]=a*l-r*s;}(this,this,e),this.check()}rotateZ(e){return function(e,t,i){i*=.5;var n=t[0],r=t[1],o=t[2],a=t[3],s=Math.sin(i),l=Math.cos(i);e[0]=n*l+r*s,e[1]=r*l-n*s,e[2]=o*l+a*s,e[3]=a*l-o*s;}(this,this,e),this.check()}scale(e){return function(e,t,i){e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i;}(this,this,e),this.check()}slerp(e,t,i){return function(e,t,i,n){var r,o,a,s,l,c=t[0],u=t[1],h=t[2],d=t[3],p=i[0],f=i[1],_=i[2],g=i[3];(o=c*p+u*f+h*_+d*g)<0&&(o=-o,p=-p,f=-f,_=-_,g=-g),1-o>m?(r=Math.acos(o),a=Math.sin(r),s=Math.sin((1-n)*r)/a,l=Math.sin(n*r)/a):(s=1-n,l=n),e[0]=s*c+l*p,e[1]=s*u+l*f,e[2]=s*h+l*_,e[3]=s*d+l*g;}(this,e,t,i),this.check()}transformVector4(e,t=new wt){return z(t,e,this),p(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}static fromAxisAngle(e,t,i=new Tt){let n=new ft;const r=t/2,o=Math.sin(r);n=ft.normalize(e,n);const a=n.x*o,s=n.y*o,l=n.z*o,c=Math.cos(r);return i.x=a,i.y=s,i.z=l,i.w=c,i}static multiply(e,t,i=new Tt){const n=e.x,r=e.y,o=e.z,a=e.w,s=t.x,l=t.y,c=t.z,u=t.w,h=a*l-n*c+r*u+o*s,d=a*c+n*l-r*s+o*u,p=a*u-n*s-r*l-o*c;return i.x=a*s+n*u+r*c-o*l,i.y=h,i.z=d,i.w=p,i}}Tt.IDENTITY=Object.freeze(new Tt(0,0,0,1));class bt extends u{get RANK(){return 0}toString(){let e="[";e+="row-major:";for(let t=0;t<this.RANK;++t)for(let i=0;i<this.RANK;++i)e+=` ${this[i*this.RANK+t]}`;return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,i){return this[t*this.RANK+e]=d(i),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let e=0;e<this.RANK;++e)t[e]=this[i+e];return t}setColumn(e,t){const i=e*this.RANK;for(let e=0;e<this.RANK;++e)this[i+e]=t[e];return this}}const Pt=Object.freeze([1,0,0,0,1,0,0,0,1]),St=Object.freeze([0,0,0,0,0,0,0,0,0]),At=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL1ROW0:3,COL1ROW1:4,COL1ROW2:5,COL2ROW0:6,COL2ROW1:7,COL2ROW2:8}),Et={};class Ct extends bt{static get IDENTITY(){return Et.IDENTITY=Et.IDENTITY||Object.freeze(new Ct(Pt)),Et.IDENTITY}static get ZERO(){return Et.ZERO=Et.ZERO||Object.freeze(new Ct(St)),Et.ZERO}constructor(e){o(e)?super(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]):super(...Pt);}get ELEMENTS(){return 9}get RANK(){return 3}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}set(e,t,i,n,r,o,a,s,l){return this[0]=e,this[1]=t,this[2]=i,this[3]=n,this[4]=r,this[5]=o,this[6]=a,this[7]=s,this[8]=l,this.check()}setRowMajor(e,t,i,n,r,o,a,s,l){return this[0]=e,this[1]=n,this[2]=a,this[3]=t,this[4]=r,this[5]=s,this[6]=i,this[7]=o,this[8]=l,this.check()}determinant(){return (e=this)[0]*((a=e[8])*(i=e[4])-(n=e[5])*(o=e[7]))+e[1]*(-a*(t=e[3])+n*(r=e[6]))+e[2]*(o*t-i*r);var e,t,i,n,r,o,a;}identity(){return this.copy(Pt)}fromQuaternion(e,t=this){return function(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],a=i+i,s=n+n,l=r+r,c=i*a,u=n*a,h=n*s,d=r*a,p=r*s,f=r*l,m=o*a,_=o*s,g=o*l;e[0]=1-h-f,e[3]=u-g,e[6]=d+_,e[1]=u+g,e[4]=1-c-f,e[7]=p-m,e[2]=d-_,e[5]=p+m,e[8]=1-c-h;}(t,e),t.check()}transpose(e=this){return function(e,t){if(e===t){var i=t[1],n=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=n,e[7]=r;}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];}(e,this),e.check()}invert(e=this){return function(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],h=u*a-s*c,d=-u*o+s*l,p=c*o-a*l,f=i*h+n*d+r*p;f&&(e[0]=h*(f=1/f),e[1]=(-u*n+r*c)*f,e[2]=(s*n-r*a)*f,e[3]=d*f,e[4]=(u*i-r*l)*f,e[5]=(-s*i+r*o)*f,e[6]=p*f,e[7]=(-c*i+n*l)*f,e[8]=(a*i-n*o)*f);}(e,this),e.check()}multiplyLeft(e,t=this){return x(t,e,this),t.check()}multiplyRight(e,t=this){return t?(x(t,this,e),t.check()):(x(this,this,e),this.check())}rotate(e,t=this){return function(e,t,i){var n=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=Math.sin(i),p=Math.cos(i);e[0]=p*n+d*a,e[1]=p*r+d*s,e[2]=p*o+d*l,e[3]=p*a-d*n,e[4]=p*s-d*r,e[5]=p*l-d*o,e[6]=c,e[7]=u,e[8]=h;}(t,this,e),t.check()}scale(e,t=this){return o(e)?v(t,this,e):v(t,this,[e,e,e]),t.check()}translate(e,t=this){return function(e,t,i){var n=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=i[0],p=i[1];e[0]=n,e[1]=r,e[2]=o,e[3]=a,e[4]=s,e[5]=l,e[6]=d*n+p*a+c,e[7]=d*r+p*s+u,e[8]=d*o+p*l+h;}(t,this,e),t.check()}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transform(e,t){switch(e.length){case 2:t=j(t||[-0,-0],e,this);break;case 3:t=R(t||[-0,-0,-0],e,this);break;case 4:t=ct(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return p(t,e.length),t}setFromMatrix4(e){const t=e.elements;return this.setRowMajor(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}static multiply(e,t,i=new Ct){const n=e[1]*t[0]+e[4]*t[1]+e[7]*t[2],r=e[2]*t[0]+e[5]*t[1]+e[8]*t[2],o=e[0]*t[3]+e[3]*t[4]+e[6]*t[5],a=e[1]*t[3]+e[4]*t[4]+e[7]*t[5],s=e[2]*t[3]+e[5]*t[4]+e[8]*t[5],l=e[0]*t[6]+e[3]*t[7]+e[6]*t[8],c=e[1]*t[6]+e[4]*t[7]+e[7]*t[8],u=e[2]*t[6]+e[5]*t[7]+e[8]*t[8];return i[0]=e[0]*t[0]+e[3]*t[1]+e[6]*t[2],i[1]=n,i[2]=r,i[3]=o,i[4]=a,i[5]=s,i[6]=l,i[7]=c,i[8]=u,i}static multiplyByScale(e,t,i){return i[0]=e[0]*t.x,i[1]=e[1]*t.x,i[2]=e[2]*t.x,i[3]=e[3]*t.y,i[4]=e[4]*t.y,i[5]=e[5]*t.y,i[6]=e[6]*t.z,i[7]=e[7]*t.z,i[8]=e[8]*t.z,i}static multiplyByVector(e,t,i=new ft){const n=t.x,r=t.y,o=t.z,a=e[1]*n+e[4]*r+e[7]*o,s=e[2]*n+e[5]*r+e[8]*o;return i.x=e[0]*n+e[3]*r+e[6]*o,i.y=a,i.z=s,i}static fromScale(e,t=new Ct){return t[0]=e.x,t[1]=0,t[2]=0,t[3]=0,t[4]=e.y,t[5]=0,t[6]=0,t[7]=0,t[8]=e.z,t}static setColumn(e,t,i,n=new Ct){const r=3*t;return (n=Ct.clone(e,n))[r]=i.x,n[r+1]=i.y,n[r+2]=i.z,n}static getColumn(e,t,i=new ft){const n=3*t,r=e[n+1],o=e[n+2];return i.x=e[n],i.y=r,i.z=o,i}static clone(e,t=new Ct){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}static equalsArray(e,t,i=0){return e[0]===t[0+i]&&e[1]===t[1+i]&&e[2]===t[2+i]&&e[3]===t[3+i]&&e[4]===t[4+i]&&e[5]===t[5+i]&&e[6]===t[6+i]&&e[7]===t[7+i]&&e[8]===t[8+i]}static pack(e,t,i=0){return t[i++]=e[0],t[i++]=e[1],t[i++]=e[2],t[i++]=e[3],t[i++]=e[4],t[i++]=e[5],t[i++]=e[6],t[i++]=e[7],t[i++]=e[8],t}static equalsEpsilon(e,t,i=0){return e===t||$(e)&&$(t)&&Math.abs(e[0]-t[0])<=i&&Math.abs(e[1]-t[1])<=i&&Math.abs(e[2]-t[2])<=i&&Math.abs(e[3]-t[3])<=i&&Math.abs(e[4]-t[4])<=i&&Math.abs(e[5]-t[5])<=i&&Math.abs(e[6]-t[6])<=i&&Math.abs(e[7]-t[7])<=i&&Math.abs(e[8]-t[8])<=i}static fromQuaternion(e,t=new Ct){const i=e.x*e.x,n=e.x*e.y,r=e.x*e.z,o=e.x*e.w,a=e.y*e.y,s=e.y*e.z,l=e.y*e.w,c=e.z*e.z,u=e.z*e.w,h=e.w*e.w,d=2*(n-u),p=2*(r+l),f=2*(n+u),m=-i+a-c+h,_=2*(s-o),g=2*(r-l),y=2*(s+o),x=-i-a+c+h;return t[0]=i-a-c+h,t[1]=f,t[2]=g,t[3]=d,t[4]=m,t[5]=y,t[6]=p,t[7]=_,t[8]=x,t}static transpose(e,t=new Ct){const i=e[3],n=e[6],r=e[1],o=e[4],a=e[7],s=e[2],l=e[5],c=e[8];return t[0]=e[0],t[1]=i,t[2]=n,t[3]=r,t[4]=o,t[5]=a,t[6]=s,t[7]=l,t[8]=c,t}static getElementIndex(e,t){return 3*e+t}static computeFrobeniusNorm(e){let t=0;for(let i=0;i<9;++i){const n=e[i];t+=n*n;}return Math.sqrt(t)}static offDiagonalFrobeniusNorm(e){const t=[2,2,1],i=[1,0,0];let n=0;for(let r=0;r<3;++r){const o=e[Ct.getElementIndex(t[r],i[r])];n+=2*o*o;}return Math.sqrt(n)}static shurDecomposition(e,t){const i=[1,0,0],n=[2,2,1];let r=0,o=1;for(let t=0;t<3;++t){const a=Math.abs(e[Ct.getElementIndex(n[t],i[t])]);a>r&&(o=t,r=a);}let a=1,s=0;const l=i[o],c=n[o];if(Math.abs(e[Ct.getElementIndex(c,l)])>1e-15){const t=(e[Ct.getElementIndex(c,c)]-e[Ct.getElementIndex(l,l)])/2/e[Ct.getElementIndex(c,l)];let i;i=t<0?-1/(-t+Math.sqrt(1+t*t)):1/(t+Math.sqrt(1+t*t)),a=1/Math.sqrt(1+i*i),s=i*a;}return (t=Ct.clone(Ct.IDENTITY,t))[Ct.getElementIndex(l,l)]=t[Ct.getElementIndex(c,c)]=a,t[Ct.getElementIndex(c,l)]=s,t[Ct.getElementIndex(l,c)]=-s,t}static computeEigenDecomposition(e,t={}){const i=new Ct,n=new Ct;let r=0,o=0;const a=t.unitary=Ct.clone(Ct.IDENTITY,t.unitary),s=t.diagonal=Ct.clone(e,t.diagonal),l=1e-20*Ct.computeFrobeniusNorm(s);for(;o<10&&Ct.offDiagonalFrobeniusNorm(s)>l;)Ct.shurDecomposition(s,i),Ct.transpose(i,n),Ct.multiply(s,i,s),Ct.multiply(n,s,s),Ct.multiply(a,i,a),++r>2&&(++o,r=0);return t}transformVector(e,t){return f("Matrix3.transformVector"),this.transform(e,t)}transformVector2(e,t){return f("Matrix3.transformVector"),this.transform(e,t)}transformVector3(e,t){return f("Matrix3.transformVector"),this.transform(e,t)}}const Mt={};class It extends at{static get ONE(){return Mt.ONE=Mt.ONE||Object.freeze(new It(1,1))}static get ZERO(){return Mt.ZERO=Mt.ZERO||Object.freeze(new It(0,0))}static get UNIT_X(){return Mt.UNIT_X=Mt.UNIT_X||Object.freeze(new It(1,0))}static get UNIT_Y(){return Mt.UNIT_Y=Mt.UNIT_Y||Object.freeze(new It(0,1))}constructor(e,t){o(e)?super(e[0],e[1]):super(e||0,t||0);}get ELEMENTS(){return 2}get x(){return this[0]}set x(e){this[0]=d(e);}get y(){return this[1]}set y(e){this[1]=d(e);}set(e,t){return this[0]=e,this[1]=t,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this.check()}toObject(e={}){return e.x=this[0],e.y=this[1],e}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}rotate(e,t,i){const n=e[0]-t[0],r=e[1]-t[1],o=Math.sin(i),a=Math.cos(i);return this[0]=n*a-r*o+t[0],this[1]=n*o+r*a+t[1],this.check()}transform(e,t=this){return this.transformAsPoint(e,t)}transformAsPoint(e,t=this){return W(t,this,e),t.check()}transformAsVector(e,t=this){return st(t,this,e),t.check()}transformByMatrix3(e,t=this){return j(t,this,e),t.check()}transformByMatrix2(e,t=this){return X(t,this,e),t.check()}perp(){const e=this.x;return this.x=this.y,this.y=-e,this.check()}mostOrthogonalAxis(e,t=new It){const i=new It,n=It.normalize(e,i);return It.abs(n,n),It.clone(n.x<=n.y?It.UNIT_X:It.UNIT_Y,t)}clone(e=new It){return It.clone(this,e)}equals(e){return It.equals(this,e)}equalsEpsilon(e,t=0,i=t){return It.equalsEpsilon(this,e,t,i)}toString(){return `(${this.x}, ${this.y})`}static fromElements(e,t,i=new It){return i.x=e,i.y=t,i}static clone(e,t=new It){return t.x=e.x,t.y=e.y,t}static pack(e,t,i=0){return t[i++]=e.x,t[i]=e.y,t}static unpack(e,t=0,i=new It){return i.x=e[t++],i.y=e[t],i}static packArray(e,t){const i=e.length,n=2*i;if($(t)){if(!Array.isArray(t)&&t.length!==n)throw new Error("If result is a typed array, it must have exactly array.length * 2 elements");t.length!==n&&(t.length=n);}else t=new Array(n);for(let n=0;n<i;++n)It.pack(e[n],t,2*n);return t}static unpackArray(e,t){const i=e.length;$(t)?t.length=i/2:t=new Array(i/2);for(let n=0;n<i;n+=2){const i=n/2;t[i]=It.unpack(e,n,t[i]);}return t}static maximumComponent(e){return Math.max(e.x,e.y)}static minimumComponent(e){return Math.min(e.x,e.y)}static minimumByComponent(e,t,i=new It){return i.x=Math.min(e.x,t.x),i.y=Math.min(e.y,t.y),i}static maximumByComponent(e,t,i=new It){return i.x=Math.max(e.x,t.x),i.y=Math.max(e.y,t.y),i}static magnitudeSquared(e){return e.x*e.x+e.y*e.y}static magnitude(e){return Math.sqrt(It.magnitudeSquared(e))}static distance(e,t){const i=new It;return It.subtract(e,t,i),It.magnitude(i)}static distanceSquared(e,t){const i=new It;return It.subtract(e,t,i),It.magnitudeSquared(i)}static normalize(e,t=new It){const i=It.magnitude(e);return t.x=e.x/i,t.y=e.y/i,t}static dot(e,t){return e.x*t.x+e.y*t.y}static cross(e,t){return e.x*t.y-e.y*t.x}static multiplyComponents(e,t,i){return i.x=e.x*t.x,i.y=e.y*t.y,i}static divideComponents(e,t,i=new It){return i.x=e.x/t.x,i.y=e.y/t.y,i}static add(e,t,i=new It){return i.x=e.x+t.x,i.y=e.y+t.y,i}static subtract(e,t,i=new It){return i.x=e.x-t.x,i.y=e.y-t.y,i}static multiplyByScalar(e,t,i=new It){return i.x=e.x*t,i.y=e.y*t,i}static divideByScalar(e,t,i=new It){return i.x=e.x/t,i.y=e.y/t,i}static negate(e,t){return t.x=-e.x,t.y=-e.y,t}static abs(e,t){return t.x=Math.abs(e.x),t.y=Math.abs(e.y),t}static lerp(e,t,i,n=new It){const r=new It;return It.multiplyByScalar(t,i,r),n=It.multiplyByScalar(e,1-i,n),It.add(r,n,n)}static angleBetween(e,t){const i=new It,n=new It;return It.normalize(e,i),It.normalize(t,n),nt.CesiumMath.acosClamped(It.dot(i,n))}static equals(e,t){return e===t||e.x===t.x&&e.y===t.y}static equalsArray(e,t,i=0){return e.x===t[i]&&e.y===t[i+1]}static equalsEpsilon(e,t,i=0,n=i){return e===t||nt.CesiumMath.equalsEpsilon(e.x,t.x,i,n)&&nt.CesiumMath.equalsEpsilon(e.y,t.y,i,n)}static convert(e){return Array.isArray(e)?new It(e):e}}const Lt=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Nt=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Rt={};Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15});class Ot extends bt{static get IDENTITY(){return Rt.IDENTITY=Rt.IDENTITY||Object.freeze(new Ot(Lt)),Rt.IDENTITY}static get ZERO(){return Rt.ZERO=Rt.ZERO||Object.freeze(new Ot(Nt)),Rt.ZERO}constructor(e){o(e)?super(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]):super(...Lt);}get ELEMENTS(){return 16}get RANK(){return 4}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,i,n,r,o,a,s,l,c,u,h,d,p,f,m){return this[0]=e,this[1]=t,this[2]=i,this[3]=n,this[4]=r,this[5]=o,this[6]=a,this[7]=s,this[8]=l,this[9]=c,this[10]=u,this[11]=h,this[12]=d,this[13]=p,this[14]=f,this[15]=m,this.check()}setRowMajor(e,t,i,n,r,o,a,s,l,c,u,h,d,p,f,m){return this[0]=e,this[1]=r,this[2]=l,this[3]=d,this[4]=t,this[5]=o,this[6]=c,this[7]=p,this[8]=i,this[9]=a,this[10]=u,this[11]=f,this[12]=n,this[13]=s,this[14]=h,this[15]=m,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}setFromMatrix3(e){return this.set(e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1),this.check()}identity(){return this.copy(Lt)}fromQuaternion(e){return function(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],a=i+i,s=n+n,l=r+r,c=i*a,u=n*a,h=n*s,d=r*a,p=r*s,f=r*l,m=o*a,_=o*s,g=o*l;e[0]=1-h-f,e[1]=u+g,e[2]=d-_,e[3]=0,e[4]=u-g,e[5]=1-c-f,e[6]=p+m,e[7]=0,e[8]=d+_,e[9]=p-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1;}(this,e),this.check()}frustum({left:e,right:t,bottom:i,top:n,near:r,far:o}){return o===1/0?Ot.computeInfinitePerspectiveOffCenter(this,e,t,i,n,r):function(e,t,i,n,r,o,a){var s=1/(i-t),l=1/(r-n),c=1/(o-a);e[0]=2*o*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*l,e[6]=0,e[7]=0,e[8]=(i+t)*s,e[9]=(r+n)*l,e[10]=(a+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o*2*c,e[15]=0;}(this,e,t,i,n,r,o),this.check()}static computeInfinitePerspectiveOffCenter(e,t,i,n,r,o){const a=2*o/(r-n),s=(i+t)/(i-t),l=(r+n)/(r-n),c=-2*o;return e[0]=2*o/(i-t),e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=s,e[9]=l,e[10]=-1,e[11]=-1,e[12]=0,e[13]=0,e[14]=c,e[15]=0,e}lookAt(e,t,i){return 1===arguments.length&&({eye:e,center:t,up:i}=e),function(e,t,i,n){var r,o,a,s,l,c,u,h,d,p,f=t[0],_=t[1],g=t[2],y=n[0],x=n[1],v=n[2],w=i[0],T=i[1],b=i[2];Math.abs(f-w)<m&&Math.abs(_-T)<m&&Math.abs(g-b)<m?function(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1;}(e):(u=f-w,h=_-T,d=g-b,r=x*(d*=p=1/Math.hypot(u,h,d))-v*(h*=p),o=v*(u*=p)-y*d,a=y*h-x*u,(p=Math.hypot(r,o,a))?(r*=p=1/p,o*=p,a*=p):(r=0,o=0,a=0),s=h*a-d*o,l=d*r-u*a,c=u*o-h*r,(p=Math.hypot(s,l,c))?(s*=p=1/p,l*=p,c*=p):(s=0,l=0,c=0),e[0]=r,e[1]=s,e[2]=u,e[3]=0,e[4]=o,e[5]=l,e[6]=h,e[7]=0,e[8]=a,e[9]=c,e[10]=d,e[11]=0,e[12]=-(r*f+o*_+a*g),e[13]=-(s*f+l*_+c*g),e[14]=-(u*f+h*_+d*g),e[15]=1);}(this,e,t=t||[0,0,0],i=i||[0,1,0]),this.check()}ortho({left:e,right:t,bottom:i,top:n,near:r=.1,far:o=500}){return function(e,t,i,n,r,o,a){var s=1/(t-i),l=1/(n-r),c=1/(o-a);e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*s,e[13]=(r+n)*l,e[14]=(a+o)*c,e[15]=1;}(this,e,t,i,n,r,o),this.check()}perspective({fov:e=.25*Math.PI,aspect:t=1,near:i=.1,far:n=500}){if(e>2*Math.PI)throw Error("radians");return function(e,t,i,n,r){var o,a=1/Math.tan(t/2);e[0]=a/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(e[10]=(r+n)*(o=1/(n-r)),e[14]=2*r*n*o):(e[10]=-1,e[14]=-2*n);}(this,e,t,i,n),this.check()}determinant(){return ((t=(e=this)[0])*(a=e[5])-(i=e[1])*(o=e[4]))*((h=e[10])*(_=e[15])-(d=e[11])*(m=e[14]))-(t*(s=e[6])-(n=e[2])*o)*((u=e[9])*_-d*(f=e[13]))+(t*(l=e[7])-(r=e[3])*o)*(u*m-h*f)+(i*s-n*a)*((c=e[8])*_-d*(p=e[12]))-(i*l-r*a)*(c*m-h*p)+(n*l-r*s)*(c*f-u*p);var e,t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,_;}getScale(e=new ft){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}setTranslation(e){return this[12]=e[0],this[13]=e[1],this[14]=e[2],this.check()}getTranslation(e=new ft){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getTranslationMatrix4(e=new Ot){return e.identity(),e[12]=this[12],e[13]=this[13],e[14]=this[14],e}getRotation(e=new Ot){const t=this.getScale(),i=1/t[0],n=1/t[1],r=1/t[2];return e[0]=this[0]*i,e[1]=this[1]*n,e[2]=this[2]*r,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*n,e[6]=this[6]*r,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*n,e[10]=this[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e=new Ct){const t=this.getScale(),i=1/t[0],n=1/t[1],r=1/t[2];return e[0]=this[0]*i,e[1]=this[1]*n,e[2]=this[2]*r,e[3]=this[4]*i,e[4]=this[5]*n,e[5]=this[6]*r,e[6]=this[8]*i,e[7]=this[9]*n,e[8]=this[10]*r,e}transpose(e=this){return function(e,t){if(e===t){var i=t[1],n=t[2],r=t[3],o=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=o,e[11]=t[14],e[12]=r,e[13]=a,e[14]=s;}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];}(e,this),e.check()}invert(e=this){return function(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],_=t[14],g=t[15],y=i*s-n*a,x=i*l-r*a,v=i*c-o*a,w=n*l-r*s,T=n*c-o*s,b=r*c-o*l,P=u*m-h*f,S=u*_-d*f,A=u*g-p*f,E=h*_-d*m,C=h*g-p*m,M=d*g-p*_,I=y*M-x*C+v*E+w*A-T*S+b*P;I&&(e[0]=(s*M-l*C+c*E)*(I=1/I),e[1]=(r*C-n*M-o*E)*I,e[2]=(m*b-_*T+g*w)*I,e[3]=(d*T-h*b-p*w)*I,e[4]=(l*A-a*M-c*S)*I,e[5]=(i*M-r*A+o*S)*I,e[6]=(_*v-f*b-g*x)*I,e[7]=(u*b-d*v+p*x)*I,e[8]=(a*C-s*A+c*P)*I,e[9]=(n*A-i*C-o*P)*I,e[10]=(f*T-m*v+g*y)*I,e[11]=(h*v-u*T-p*y)*I,e[12]=(s*S-a*E-l*P)*I,e[13]=(i*E-n*S+r*P)*I,e[14]=(m*x-f*w-_*y)*I,e[15]=(u*w-h*x+d*y)*I);}(e,this),e.check()}inverseTranspose(e=this){return this.transpose(e).invert(e)}multiplyLeft(e,t=this){return w(t,e,this),t.check()}multiplyRight(e,t=this){return w(t,this,e),t.check()}rotateX(e,t=this){return function(e,t,i){var n=Math.sin(i),r=Math.cos(i),o=t[4],a=t[5],s=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*r+c*n,e[5]=a*r+u*n,e[6]=s*r+h*n,e[7]=l*r+d*n,e[8]=c*r-o*n,e[9]=u*r-a*n,e[10]=h*r-s*n,e[11]=d*r-l*n;}(t,this,e),t.check()}rotateY(e,t=this){return function(e,t,i){var n=Math.sin(i),r=Math.cos(i),o=t[0],a=t[1],s=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r-c*n,e[1]=a*r-u*n,e[2]=s*r-h*n,e[3]=l*r-d*n,e[8]=o*n+c*r,e[9]=a*n+u*r,e[10]=s*n+h*r,e[11]=l*n+d*r;}(t,this,e),t.check()}rotateZ(e,t=this){return function(e,t,i){var n=Math.sin(i),r=Math.cos(i),o=t[0],a=t[1],s=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r+c*n,e[1]=a*r+u*n,e[2]=s*r+h*n,e[3]=l*r+d*n,e[4]=c*r-o*n,e[5]=u*r-a*n,e[6]=h*r-s*n,e[7]=d*r-l*n;}(t,this,e),t.check()}rotateXYZ([e,t,i]){return this.rotateX(e).rotateY(t).rotateZ(i)}rotateAxis(e,t,i=this){return function(e,t,i,n){var r,o,a,s,l,c,u,h,d,p,f,_,g,y,x,v,w,T,b,P,S,A,E,C,M=n[0],I=n[1],L=n[2],N=Math.hypot(M,I,L);N<m||(M*=N=1/N,I*=N,L*=N,r=Math.sin(i),o=Math.cos(i),l=t[1],c=t[2],u=t[3],d=t[5],p=t[6],f=t[7],g=t[9],y=t[10],x=t[11],b=M*I*(a=1-o)-L*r,P=I*I*a+o,S=L*I*a+M*r,A=M*L*a+I*r,E=I*L*a-M*r,C=L*L*a+o,e[0]=(s=t[0])*(v=M*M*a+o)+(h=t[4])*(w=I*M*a+L*r)+(_=t[8])*(T=L*M*a-I*r),e[1]=l*v+d*w+g*T,e[2]=c*v+p*w+y*T,e[3]=u*v+f*w+x*T,e[4]=s*b+h*P+_*S,e[5]=l*b+d*P+g*S,e[6]=c*b+p*P+y*S,e[7]=u*b+f*P+x*S,e[8]=s*A+h*E+_*C,e[9]=l*A+d*E+g*C,e[10]=c*A+p*E+y*C,e[11]=u*A+f*E+x*C,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]));}(i,this,e,t),i.check()}scale(e,t=this){return function(e,t,i){var n=i[0],r=i[1],o=i[2];e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15];}(t,this,"number"!=typeof e?e:[e,e,e]),t.check()}translate(e,t=this){return function(e,t,i){var n,r,o,a,s,l,c,u,h,d,p,f,m=i[0],_=i[1],g=i[2];t===e?(e[12]=t[0]*m+t[4]*_+t[8]*g+t[12],e[13]=t[1]*m+t[5]*_+t[9]*g+t[13],e[14]=t[2]*m+t[6]*_+t[10]*g+t[14],e[15]=t[3]*m+t[7]*_+t[11]*g+t[15]):(r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=n=t[0],e[1]=r,e[2]=o,e[3]=a,e[4]=s,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=n*m+s*_+h*g+t[12],e[13]=r*m+l*_+d*g+t[13],e[14]=o*m+c*_+p*g+t[14],e[15]=a*m+u*_+f*g+t[15]);}(t,this,e),t.check()}transform(e,t){return 4===e.length?(p(t=F(t||new wt,e,this),4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:i}=e.toArray();switch(i){case 2:t=W(t||new It,e,this);break;case 3:t=N(t||new ft,e,this);break;default:throw new Error("Illegal vector")}return p(t,e.length),t}transformAsVector(e,t){switch(e.length){case 2:t=st(t||new It,e,this);break;case 3:t=lt(t||new ft,e,this);break;default:throw new Error("Illegal vector")}return p(t,e.length),t}makeRotationX(e){return this.identity().rotateX(e)}makeRotationY(e){return this.identity().rotateY(e)}makeRotationZ(e){return this.identity().rotateZ(e)}makeTranslation(e,t,i){return this.identity().translate([e,t,i])}makeScale(e,t,i){return this.identity().scale([e,t,i])}compose(e,t,i){const n=this.elements,r=t[0],o=t[1],a=t[2],s=t[3],l=r+r,c=o+o,u=a+a,h=r*l,d=r*c,p=r*u,f=o*c,m=o*u,_=a*u,g=s*l,y=s*c,x=s*u,v=i[0],w=i[1],T=i[2];return n[0]=(1-(f+_))*v,n[1]=(d+x)*v,n[2]=(p-y)*v,n[3]=0,n[4]=(d-x)*w,n[5]=(1-(h+_))*w,n[6]=(m+g)*w,n[7]=0,n[8]=(p+y)*T,n[9]=(m-g)*T,n[10]=(1-(h+f))*T,n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,this}decompose(e,t,i){const n=this.elements;let r=new ft(n[0],n[1],n[2]).len();const o=new ft(n[4],n[5],n[6]).len(),a=new ft(n[8],n[9],n[10]).len();this.determinant()<0&&(r=-r),e[0]=n[12],e[1]=n[13],e[2]=n[14];const s=this.clone(),l=1/r,c=1/o,u=1/a;return s[0]*=l,s[1]*=l,s[2]*=l,s[4]*=c,s[5]*=c,s[6]*=c,s[8]*=u,s[9]*=u,s[10]*=u,t.fromRotationMatrix4(s),i[0]=r,i[1]=o,i[2]=a,this}extractRotation(e=this){const t=this,i=e,n=1/new ft(t[0],t[1],t[2]).len(),r=1/new ft(t[4],t[5],t[6]).len(),o=1/new ft(t[8],t[9],t[10]).len();return i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i[3]=0,i[4]=t[4]*r,i[5]=t[5]*r,i[6]=t[6]*r,i[7]=0,i[8]=t[8]*o,i[9]=t[9]*o,i[10]=t[10]*o,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}static equalsEpsilon(e,t,i){return i=Z(i,0),e===t||$(e)&&$(t)&&Math.abs(e[0]-t[0])<=i&&Math.abs(e[1]-t[1])<=i&&Math.abs(e[2]-t[2])<=i&&Math.abs(e[3]-t[3])<=i&&Math.abs(e[4]-t[4])<=i&&Math.abs(e[5]-t[5])<=i&&Math.abs(e[6]-t[6])<=i&&Math.abs(e[7]-t[7])<=i&&Math.abs(e[8]-t[8])<=i&&Math.abs(e[9]-t[9])<=i&&Math.abs(e[10]-t[10])<=i&&Math.abs(e[11]-t[11])<=i&&Math.abs(e[12]-t[12])<=i&&Math.abs(e[13]-t[13])<=i&&Math.abs(e[14]-t[14])<=i&&Math.abs(e[15]-t[15])<=i}static getTranslation(e,t=new ft){return t.x=e[12],t.y=e[13],t.z=e[14],t}static multiplyByPoint(e,t,i=new ft){const n=t.x,r=t.y,o=t.z,a=e[1]*n+e[5]*r+e[9]*o+e[13],s=e[2]*n+e[6]*r+e[10]*o+e[14];return i.x=e[0]*n+e[4]*r+e[8]*o+e[12],i.y=a,i.z=s,i}static multiply(e,t,i){if(!e||!t||!i)throw new Error("multiply error para");return w(e,t,i),e.check()}static getMaximumScale(e){const t=new ft;return Ot.getScale(e,t),ft.maximumComponent(t)}static multiplyByVector(e,t,i=new wt){const n=t.x,r=t.y,o=t.z,a=t.w,s=e[1]*n+e[5]*r+e[9]*o+e[13]*a,l=e[2]*n+e[6]*r+e[10]*o+e[14]*a,c=e[3]*n+e[7]*r+e[11]*o+e[15]*a;return i.x=e[0]*n+e[4]*r+e[8]*o+e[12]*a,i.y=s,i.z=l,i.w=c,i}static getScale(e,t=new ft){const i=new ft;return t.x=ft.magnitude(ft.fromElements(e[0],e[1],e[2],i)),t.y=ft.magnitude(ft.fromElements(e[4],e[5],e[6],i)),t.z=ft.magnitude(ft.fromElements(e[8],e[9],e[10],i)),t}static getColumn(e,t,i=new wt){const n=4*t,r=e[n+1],o=e[n+2],a=e[n+3];return i.x=e[n],i.y=r,i.z=o,i.w=a,i}static inverseTransformation(e,t=new Ot){const i=e[0],n=e[1],r=e[2],o=e[4],a=e[5],s=e[6],l=e[8],c=e[9],u=e[10],h=e[12],d=e[13],p=e[14],f=-i*h-n*d-r*p,m=-o*h-a*d-s*p,_=-l*h-c*d-u*p;return t[0]=i,t[1]=o,t[2]=l,t[3]=0,t[4]=n,t[5]=a,t[6]=c,t[7]=0,t[8]=r,t[9]=s,t[10]=u,t[11]=0,t[12]=f,t[13]=m,t[14]=_,t[15]=1,t}static inverse(e,t=new Ot){const i=new Ct,n=new Ct,r=new wt,o=new wt(0,0,0,1),a=e[0],s=e[4],l=e[8],c=e[12],u=e[1],h=e[5],d=e[9],p=e[13],f=e[2],m=e[6],_=e[10],g=e[14],y=e[3],x=e[7],v=e[11],w=e[15];let T=_*w,b=g*v,P=m*w,S=g*x,A=m*v,E=_*x,C=f*w,M=g*y,I=f*v,L=_*y,N=f*x,R=m*y;const O=T*h+S*d+A*p-(b*h+P*d+E*p),D=b*u+C*d+L*p-(T*u+M*d+I*p),F=P*u+M*h+N*p-(S*u+C*h+R*p),z=E*u+I*h+R*d-(A*u+L*h+N*d),B=b*s+P*l+E*c-(T*s+S*l+A*c),V=T*a+M*l+I*c-(b*a+C*l+L*c),U=S*a+C*s+R*c-(P*a+M*s+N*c),k=A*a+L*s+N*l-(E*a+I*s+R*l);T=l*p,b=c*d,P=s*p,S=c*h,A=s*d,E=l*h,C=a*p,M=c*u,I=a*d,L=l*u,N=a*h,R=s*u;const G=T*x+S*v+A*w-(b*x+P*v+E*w),H=b*y+C*v+L*w-(T*y+M*v+I*w),Y=P*y+M*x+N*w-(S*y+C*x+R*w),q=E*y+I*x+R*v-(A*y+L*x+N*v),X=P*_+E*g+b*m-(A*g+T*m+S*_),j=I*g+T*f+M*_-(C*_+L*g+b*f),W=C*m+R*g+S*f-(N*g+P*f+M*m),$=N*_+A*f+L*m-(I*m+R*_+E*f);let Z=a*O+s*D+l*F+c*z;if(Math.abs(Z)<nt.CesiumMath.EPSILON21){if(Ct.equalsEpsilon(Ot.getMatrix3(e,i),n,nt.CesiumMath.EPSILON7)&&wt.equals(Ot.getRow(e,3,r),o))return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=0,t[11]=0,t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=1,t;throw new Error("matrix is not invertible because its determinate is zero.")}return Z=1/Z,t[0]=O*Z,t[1]=D*Z,t[2]=F*Z,t[3]=z*Z,t[4]=B*Z,t[5]=V*Z,t[6]=U*Z,t[7]=k*Z,t[8]=G*Z,t[9]=H*Z,t[10]=Y*Z,t[11]=q*Z,t[12]=X*Z,t[13]=j*Z,t[14]=W*Z,t[15]=$*Z,t}static transpose(e,t=new Ot){return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t}static inverseTranspose(e,t=new Ot){const i=new Ot;return Ot.inverse(Ot.transpose(e,i),t)}static getMatrix3(e,t=new Ct){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}static getRow(e,t,i=new wt){const n=e[t+4],r=e[t+8],o=e[t+12];return i.x=e[t],i.y=n,i.z=r,i.w=o,i}static equals(e,t){return e===t||$(e)&&$(t)&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[3]===t[3]&&e[7]===t[7]&&e[11]===t[11]&&e[15]===t[15]}static equalsArray(e,t,i=0){return e[0]===t[0+i]&&e[1]===t[1+i]&&e[2]===t[2+i]&&e[3]===t[3+i]&&e[4]===t[4+i]&&e[5]===t[5+i]&&e[6]===t[6+i]&&e[7]===t[7+i]&&e[8]===t[8+i]&&e[9]===t[9+i]&&e[10]===t[10+i]&&e[11]===t[11+i]&&e[12]===t[12+i]&&e[13]===t[13+i]&&e[14]===t[14+i]&&e[15]===t[15+i]}static pack(e,t,i=0){return t[i++]=e[0],t[i++]=e[1],t[i++]=e[2],t[i++]=e[3],t[i++]=e[4],t[i++]=e[5],t[i++]=e[6],t[i++]=e[7],t[i++]=e[8],t[i++]=e[9],t[i++]=e[10],t[i++]=e[11],t[i++]=e[12],t[i++]=e[13],t[i++]=e[14],t[i]=e[15],t}static computeView(e,t,i,n,r=new Ot){return r[0]=n.x,r[1]=i.x,r[2]=-t.x,r[3]=0,r[4]=n.y,r[5]=i.y,r[6]=-t.y,r[7]=0,r[8]=n.z,r[9]=i.z,r[10]=-t.z,r[11]=0,r[12]=-ft.dot(n,e),r[13]=-ft.dot(i,e),r[14]=ft.dot(t,e),r[15]=1,r}static fromRotationTranslation(e,t=ft.ZERO,i=new Ot){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=0,i[4]=e[3],i[5]=e[4],i[6]=e[5],i[7]=0,i[8]=e[6],i[9]=e[7],i[10]=e[8],i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,i}static fromTranslationQuaternionRotationScale(e=ft.ZERO,t=new Tt,i=ft.ONE,n=new Ot){const r=i.x,o=i.y,a=i.z,s=t.x*t.x,l=t.x*t.y,c=t.x*t.z,u=t.x*t.w,h=t.y*t.y,d=t.y*t.z,p=t.y*t.w,f=t.z*t.z,m=t.z*t.w,_=t.w*t.w,g=2*(l-m),y=2*(c+p),x=2*(l+m),v=-s+h-f+_,w=2*(d-u),T=2*(c-p),b=2*(d+u),P=-s-h+f+_;return n[0]=(s-h-f+_)*r,n[1]=x*r,n[2]=T*r,n[3]=0,n[4]=g*o,n[5]=v*o,n[6]=b*o,n[7]=0,n[8]=y*a,n[9]=w*a,n[10]=P*a,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,n}static fromTranslationHeadingPitchRollRotationScale(e=ft.ZERO,t=new ot,i=ft.ONE,n=new Ot){const r=(new Tt).fromHeadingPitchRoll(t),o=i.x,a=i.y,s=i.z,l=r.x*r.x,c=r.x*r.y,u=r.x*r.z,h=r.x*r.w,d=r.y*r.y,p=r.y*r.z,f=r.y*r.w,m=r.z*r.z,_=r.z*r.w,g=r.w*r.w,y=2*(c-_),x=2*(u+f),v=2*(c+_),w=-l+d-m+g,T=2*(p-h),b=2*(u-f),P=2*(p+h),S=-l-d+m+g;return n[0]=(l-d-m+g)*o,n[1]=v*o,n[2]=b*o,n[3]=0,n[4]=y*a,n[5]=w*a,n[6]=P*a,n[7]=0,n[8]=x*s,n[9]=T*s,n[10]=S*s,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,n}static multiplyTransformation(e,t,i=new Ot){const n=e[0],r=e[1],o=e[2],a=e[4],s=e[5],l=e[6],c=e[8],u=e[9],h=e[10],d=t[0],p=t[1],f=t[2],m=t[4],_=t[5],g=t[6],y=t[8],x=t[9],v=t[10],w=t[12],T=t[13],b=t[14],P=r*d+s*p+u*f,S=o*d+l*p+h*f,A=n*m+a*_+c*g,E=r*m+s*_+u*g,C=o*m+l*_+h*g,M=n*y+a*x+c*v,I=r*y+s*x+u*v,L=o*y+l*x+h*v,N=n*w+a*T+c*b+e[12],R=r*w+s*T+u*b+e[13],O=o*w+l*T+h*b+e[14];return i[0]=n*d+a*p+c*f,i[1]=P,i[2]=S,i[3]=0,i[4]=A,i[5]=E,i[6]=C,i[7]=0,i[8]=M,i[9]=I,i[10]=L,i[11]=0,i[12]=N,i[13]=R,i[14]=O,i[15]=1,i}static multiplyByPointAsVector(e,t,i=new ft){const n=t.x,r=t.y,o=t.z,a=e[1]*n+e[5]*r+e[9]*o,s=e[2]*n+e[6]*r+e[10]*o;return i.x=e[0]*n+e[4]*r+e[8]*o,i.y=a,i.z=s,i}static clone(e,t=new Ot){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}static computeOrthographicOffCenter(e,t,i,n,r,o,a=new Ot){let s=1/(t-e),l=1/(n-i),c=1/(o-r);const u=-(t+e)*s,h=-(n+i)*l,d=-(o+r)*c;return s*=2,l*=2,c*=-2,a[0]=s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=l,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=c,a[11]=0,a[12]=u,a[13]=h,a[14]=d,a[15]=1,a}static fromTranslation(e,t=new Ot){return Ot.fromRotationTranslation(Ct.IDENTITY,e,t)}static multiplyByTranslation(e,t,i=new Ot){const n=t.x,r=t.y,o=t.z,a=n*e[0]+r*e[4]+o*e[8]+e[12],s=n*e[1]+r*e[5]+o*e[9]+e[13],l=n*e[2]+r*e[6]+o*e[10]+e[14];return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=a,i[13]=s,i[14]=l,i[15]=e[15],i}static computeViewportTransformation(e={},t=0,i=1,n=new Ot){const r=Z(e.x,0),o=Z(e.y,0),a=.5*Z(e.width,0),s=.5*Z(e.height,0),l=.5*(i-t),c=s,u=l,h=r+a,d=o+s,p=t+l;return n[0]=a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=c,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=u,n[11]=0,n[12]=h,n[13]=d,n[14]=p,n[15]=1,n}transformPoint(e,t){return f("Matrix4.transformPoint","3.0"),this.transformAsPoint(e,t)}transformVector(e,t){return f("Matrix4.transformVector","3.0"),this.transformAsPoint(e,t)}transformDirection(e,t){return f("Matrix4.transformDirection","3.0"),this.transformAsVector(e,t)}static fromCamera(e,t=new Ot){const i=new ft,n=new ft,r=new ft,o=e.position,a=e.up;ft.normalize(e.direction,i),ft.normalize(ft.cross(i,a,n),n),ft.normalize(ft.cross(n,i,r),r);const s=n.x,l=n.y,c=n.z,u=i.x,h=i.y,d=i.z,p=r.x,f=r.y,m=r.z,_=o.x,g=o.y,y=o.z,x=s*-_+l*-g+c*-y,v=p*-_+f*-g+m*-y,w=u*_+h*g+d*y;return $(t)?(t[0]=s,t[1]=p,t[2]=-u,t[3]=0,t[4]=l,t[5]=f,t[6]=-h,t[7]=0,t[8]=c,t[9]=m,t[10]=-d,t[11]=0,t[12]=x,t[13]=v,t[14]=w,t[15]=1,t):new Ot(s,l,c,x,p,f,m,v,-u,-h,-d,w,0,0,0,1)}}const Dt="Unknown Euler angle order",Ft=.99999;class zt extends u{constructor(e=0,t=0,i=0,n=zt.DefaultOrder){super(-0,-0,-0,-0),o(e)?this.fromVector3(e,n):this.set(e,t,i,n);}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=d(e);}get y(){return this[1]}set y(e){this[1]=d(e);}get z(){return this[2]}set z(e){this[2]=d(e);}get alpha(){return this[0]}set alpha(e){this[0]=d(e);}get beta(){return this[1]}set beta(e){this[1]=d(e);}get gamma(){return this[2]}set gamma(e){this[2]=d(e);}get phi(){return this[0]}set phi(e){this[0]=d(e);}get theta(){return this[1]}set theta(e){this[1]=d(e);}get psi(){return this[2]}set psi(e){this[2]=d(e);}get roll(){return this[0]}set roll(e){this[0]=d(e);}get pitch(){return this[1]}set pitch(e){this[1]=d(e);}get yaw(){return this[2]}set yaw(e){this[2]=d(e);}get order(){return this[3]}set order(e){this[3]=function(e){if(e<0&&e>=6)throw new Error(Dt);return e}(e);}fromQuaternion(e){const[t,i,n,r]=e,o=i*i,a=-2*(o+n*n)+1,s=2*(t*i+r*n);let l=-2*(t*n-r*i);l=l>1?1:l,l=l<-1?-1:l;const c=Math.atan2(2*(i*n+r*t),-2*(t*t+o)+1),u=-Math.asin(l),h=-Math.atan2(s,a);return this.set(c,u,h,zt.RollPitchYaw)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=Number.isFinite(e[3])||this.order,this.check()}set(e,t,i,n=zt.ZYX){return this[0]=e,this[1]=t,this[2]=i,this[3]=Number.isFinite(n)?n:this[3],this.check()}validate(){return (e=this[3])>=0&&e<6&&Number.isFinite(this[0])&&Number.isFinite(this[1])&&Number.isFinite(this[2]);var e;}toArray(e=[],t=0){return e[t]=this[0],e[t+1]=this[1],e[t+2]=this[2],e}toArray4(e=[],t=0){return e[t]=this[0],e[t+1]=this[1],e[t+2]=this[2],e[t+3]=this[3],e}toVector3(e=new ft){return e[0]=this[0],e[1]=this[1],e[2]=this[2],e}fromVector3(e,t){return this.set(e[0],e[1],e[2],Number.isFinite(t)?t:this[3])}fromArray(e,t=0){return this[0]=e[t],this[1]=e[1+t],this[2]=e[2+t],void 0!==e[3]&&(this[3]=e[3]),this.check()}fromRollPitchYaw(e,t,i){return this.set(e,t,i,zt.RollPitchYaw)}fromHeadingPitchRoll(e){return this.set(e.pitch,-e.roll,-e.heading,zt.RollPitchYaw)}fromRotationMatrix(e,t=zt.DefaultOrder){return this._fromRotationMatrix(e,t),this.check()}getRotationMatrix(){return this._getRotationMatrix()}getQuaternion(){const e=new Tt;switch(this[3]){case zt.XYZ:return e.rotateX(this[0]).rotateY(this[1]).rotateZ(this[2]);case zt.YXZ:return e.rotateY(this[0]).rotateX(this[1]).rotateZ(this[2]);case zt.ZXY:return e.rotateZ(this[0]).rotateX(this[1]).rotateY(this[2]);case zt.ZYX:return e.rotateZ(this[0]).rotateY(this[1]).rotateX(this[2]);case zt.YZX:return e.rotateY(this[0]).rotateZ(this[1]).rotateX(this[2]);case zt.XZY:return e.rotateX(this[0]).rotateZ(this[1]).rotateY(this[2]);default:throw new Error(Dt)}}_fromRotationMatrix(e,t=zt.DefaultOrder){const i=e.elements,n=i[0],r=i[4],o=i[8],a=i[1],s=i[5],c=i[9],u=i[2],h=i[6],d=i[10];switch(t=t||this[3]){case zt.XYZ:this[1]=Math.asin(l(o,-1,1)),Math.abs(o)<Ft?(this[0]=Math.atan2(-c,d),this[2]=Math.atan2(-r,n)):(this[0]=Math.atan2(h,s),this[2]=0);break;case zt.YXZ:this[0]=Math.asin(-l(c,-1,1)),Math.abs(c)<Ft?(this[1]=Math.atan2(o,d),this[2]=Math.atan2(a,s)):(this[1]=Math.atan2(-u,n),this[2]=0);break;case zt.ZXY:this[0]=Math.asin(l(h,-1,1)),Math.abs(h)<Ft?(this[1]=Math.atan2(-u,d),this[2]=Math.atan2(-r,s)):(this[1]=0,this[2]=Math.atan2(a,n));break;case zt.ZYX:this[1]=Math.asin(-l(u,-1,1)),Math.abs(u)<Ft?(this[0]=Math.atan2(h,d),this[2]=Math.atan2(a,n)):(this[0]=0,this[2]=Math.atan2(-r,s));break;case zt.YZX:this[2]=Math.asin(l(a,-1,1)),Math.abs(a)<Ft?(this[0]=Math.atan2(-c,s),this[1]=Math.atan2(-u,n)):(this[0]=0,this[1]=Math.atan2(o,d));break;case zt.XZY:this[2]=Math.asin(-l(r,-1,1)),Math.abs(r)<Ft?(this[0]=Math.atan2(h,s),this[1]=Math.atan2(o,n)):(this[0]=Math.atan2(-c,d),this[1]=0);break;default:throw new Error(Dt)}return this[3]=t,this}_getRotationMatrix(e=new Ot){const t=e,i=this.x,n=this.y,r=this.z,o=Math.cos(i),a=Math.cos(n),s=Math.cos(r),l=Math.sin(i),c=Math.sin(n),u=Math.sin(r);switch(this[3]){case zt.XYZ:{const e=o*s,i=o*u,n=l*s,r=l*u;t[0]=a*s,t[4]=-a*u,t[8]=c,t[1]=i+n*c,t[5]=e-r*c,t[9]=-l*a,t[2]=r-e*c,t[6]=n+i*c,t[10]=o*a;break}case zt.YXZ:{const e=a*s,i=a*u,n=c*s,r=c*u;t[0]=e+r*l,t[4]=n*l-i,t[8]=o*c,t[1]=o*u,t[5]=o*s,t[9]=-l,t[2]=i*l-n,t[6]=r+e*l,t[10]=o*a;break}case zt.ZXY:{const e=a*s,i=a*u,n=c*s,r=c*u;t[0]=e-r*l,t[4]=-o*u,t[8]=n+i*l,t[1]=i+n*l,t[5]=o*s,t[9]=r-e*l,t[2]=-o*c,t[6]=l,t[10]=o*a;break}case zt.ZYX:{const e=o*s,i=o*u,n=l*s,r=l*u;t[0]=a*s,t[4]=n*c-i,t[8]=e*c+r,t[1]=a*u,t[5]=r*c+e,t[9]=i*c-n,t[2]=-c,t[6]=l*a,t[10]=o*a;break}case zt.YZX:{const e=o*a,i=o*c,n=l*a,r=l*c;t[0]=a*s,t[4]=r-e*u,t[8]=n*u+i,t[1]=u,t[5]=o*s,t[9]=-l*s,t[2]=-c*s,t[6]=i*u+n,t[10]=e-r*u;break}case zt.XZY:{const e=o*a,i=o*c,n=l*a,r=l*c;t[0]=a*s,t[4]=-u,t[8]=c*s,t[1]=e*u+r,t[5]=o*s,t[9]=i*u-n,t[2]=n*u-i,t[6]=l*s,t[10]=r*u+e;break}default:throw new Error(Dt)}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}toQuaternion(){const e=Math.cos(.5*this.yaw),t=Math.sin(.5*this.yaw),i=Math.cos(.5*this.roll),n=Math.sin(.5*this.roll),r=Math.cos(.5*this.pitch),o=Math.sin(.5*this.pitch);return new Tt(e*n*r-t*i*o,e*i*o+t*n*r,t*i*r-e*n*o,e*i*r+t*n*o)}}zt.ZYX=0,zt.YXZ=1,zt.XZY=2,zt.ZXY=3,zt.YZX=4,zt.XYZ=5,zt.RollPitchYaw=0,zt.DefaultOrder=zt.ZYX;const Bt=6378137,Vt=6378137,Ut=6356752.314245179,kt=e=>e;let Gt,Ht,Yt,qt,Xt;function jt(e,t){return Gt||(Gt=new ft),function(e,t,i=kt){return o(e)?(t[0]=i(e[0]),t[1]=i(e[1]),t[2]=e[2]):"longitude"in e?(t[0]=i(e.longitude),t[1]=i(e.latitude),t[2]=e.height):(t[0]=i(e.x),t[1]=i(e.y),t[2]=e.z),t}(e,t||Gt,a)}function Wt(e,t,i=new ft){const{oneOverRadii:n,oneOverRadiiSquared:r,centerToleranceSquared:o}=t;Ht||(Ht=new ft,Yt=new ft,qt=new ft),Ht.from(e);const a=e.x,s=e.y,l=e.z,c=n.x,u=n.y,h=n.z,d=a*a*c*c,p=s*s*u*u,f=l*l*h*h,m=d+p+f,_=Math.sqrt(1/m);if(!Number.isFinite(_))return;const g=Yt;if(g.copy(e).scale(_),m<o)return g.to(i);const y=r.x,x=r.y,v=r.z,w=qt;w.set(g.x*y*2,g.y*x*2,g.z*v*2);let T,b,P,S,A=(1-_)*e.len()/(.5*w.len()),E=0;do{A-=E,T=1/(1+A*y),b=1/(1+A*x),P=1/(1+A*v);const e=T*T,t=b*b,i=P*P;S=d*e+p*t+f*i-1,E=S/(-2*(d*(e*T)*y+p*(t*b)*x+f*(i*P)*v));}while(Math.abs(S)>nt.TRANSFORM.EPSILON12);return Ht.scale([T,b,P]).to(i)}const $t={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]};let Zt,Kt,Qt,Jt,ei,ti,ii={};function ni(e,t,i,n,r,o){let a,s,l;Xt||(Xt=new ft,ii={east:new ft,north:new ft,up:new ft,west:new ft,south:new ft,down:new ft},Zt=new ft,Kt=new ft,Qt=new ft);const u=Xt.copy(r);if(c(u.x,0)&&c(u.y,0)){const e=Math.sign(u.z);a=Zt.fromArray($t[t]),"east"!==t&&"west"!==t&&a.scale(e),s=Kt.fromArray($t[i]),"east"!==i&&"west"!==i&&s.scale(e),l=Qt.fromArray($t[n]),"east"!==n&&"west"!==n&&l.scale(e);}else {const{up:r,east:o,north:c}=ii;o.set(-u.y,u.x,0).normalize(),e.geodeticSurfaceNormal(u,r),c.copy(r).cross(o);const{down:h,west:d,south:p}=ii;h.copy(r).scale(-1),d.copy(o).scale(-1),p.copy(c).scale(-1),a=ii[t],s=ii[i],l=ii[n];}return o[0]=a.x,o[1]=a.y,o[2]=a.z,o[3]=0,o[4]=s.x,o[5]=s.y,o[6]=s.z,o[7]=0,o[8]=l.x,o[9]=l.y,o[10]=l.z,o[11]=0,o[12]=u.x,o[13]=u.y,o[14]=u.z,o[15]=1,o}function ri(e,t,i,n){e.radii=new ft(t,i,n),e.radiiSquared=new ft(t*t,i*i,n*n),e.radiiToTheFourth=new ft(t*t*t*t,i*i*i*i,n*n*n*n),e.oneOverRadii=new ft(0===t?0:1/t,0===i?0:1/i,0===n?0:1/n),e.oneOverRadiiSquared=new ft(0===t?0:1/(t*t),0===i?0:1/(i*i),0===n?0:1/(n*n)),e.minimumRadius=Math.min(t,i,n),e.maximumRadius=Math.max(t,i,n),e.centerToleranceSquared=nt.TRANSFORM.EPSILON1,0!==e.radiiSquared.z&&(e.squaredXOverSquaredZ=e.radiiSquared.x/e.radiiSquared.z),Object.freeze(this);}class oi{constructor(e=0,t=0,i=0){this._scratchNormal=new ft,this._scratchK=new ft,this._scratchPosition=new ft,this._scratchHeight=new ft,this._scratchCartesian=new ft,this._scratchVector=new ft,ri(this,e,t,i);}equals(e){return this===e||Boolean(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,t=[0,0,0],i){const n=this._scratchNormal,r=this._scratchK,o=e[2];this.geodeticSurfaceNormalCartographic(e,n,i),r.copy(this.radiiSquared).scale(n);const a=Math.sqrt(n.dot(r));return r.multiplyScalar(1/a),n.multiplyScalar(o),r.add(n),r.to(t)}cartographicToCartesianInRadians(e,t=[0,0,0]){const i=this._scratchNormal,n=this._scratchK,[,,r]=e;this.geodeticSurfaceNormalCartographic(e,i,!0),n.copy(this.radiiSquared).scale(i);const o=Math.sqrt(i.dot(n));return n.scale(1/o),i.scale(r),n.add(i),n.to(t)}cartesianToCartographic(e,t=[0,0,0]){this._scratchCartesian.from(e);const i=this.scaleToGeodeticSurface(this._scratchCartesian,this._scratchPosition);if(!i)return;const n=this.geodeticSurfaceNormal(i,this._scratchNormal),r=this._scratchHeight;return r.copy(this._scratchCartesian).subtract(i),function(e,t,i=kt){return o(t)?(t[0]=i(e[0]),t[1]=i(e[1]),t[2]=e[2]):"longitude"in t?(t.longitude=i(e[0]),t.latitude=i(e[1]),t.height=e[2]):(t.x=i(e[0]),t.y=i(e[1]),t.z=e[2]),t}([Math.atan2(n.y,n.x),Math.asin(n.z),Math.sign(I(r,this._scratchCartesian))*b(r)],t,s)}eastNorthUpToFixedFrame(e,t=new Ot){return ni(this,"east","north","up",e,t)}localFrameToFixedFrame(e,t,i,n,r=new Ot){return ni(this,e,t,i,n,r)}geocentricSurfaceNormal(e,t=[0,0,0]){return this._scratchVector.from(e).normalize().to(t)}geodeticSurfaceNormalCartographic(e,t=[0,0,0],i){const n=i?e:jt(e),r=n[0],o=n[1],a=Math.cos(o);return this._scratchVector.set(a*Math.cos(r),a*Math.sin(r),Math.sin(o)).normalize(),this._scratchVector.to(t)}geodeticSurfaceNormal(e,t=[0,0,0]){return this._scratchVector.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}scaleToGeodeticSurface(e,t){return Wt(e,this,t)}scaleToGeocentricSurface(e,t=[0,0,0]){this._scratchPosition.from(e);const i=this._scratchPosition.x,n=this._scratchPosition.y,r=this._scratchPosition.z,o=this.oneOverRadiiSquared,a=1/Math.sqrt(i*i*o.x+n*n*o.y+r*r*o.z);return this._scratchPosition.multiplyScalar(a).to(t)}transformPositionToScaledSpace(e,t=[0,0,0]){return this._scratchPosition.from(e).scale(this.oneOverRadii).to(t)}transformPositionFromScaledSpace(e,t=[0,0,0]){return this._scratchPosition.from(e).scale(this.radii).to(t)}getSurfaceNormalIntersectionWithZAxis(e,t=0,i=[0,0,0]){this._scratchPosition.from(e);const n=this._scratchPosition.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-t))return this._scratchPosition.set(0,0,n).to(i)}static fromCartesian3(e,t){return ri(t,e.x,e.y,e.z),t}static clone(e){return new oi(e.radii.x,e.radii.y,e.radii.z)}static get WGS84(){return Jt=Jt||new oi(Bt,Vt,Ut),Jt}static get RegularEllipsoid(){return ei=ei||new oi(Bt,Vt,6378137),ei}static get UNIT_SPHERE(){return ti=ti||new oi(1,1,1),ti}}class ai{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]));}setNorthEast(e){return this._ne=e instanceof li?new li(e.lng,e.lat):li.convert(e),this}setSouthWest(e){return this._sw=e instanceof li?new li(e.lng,e.lat):li.convert(e),this}extend(e){const t=this._sw,i=this._ne;let n,r;if(e instanceof li)n=e,r=e;else {if(!(e instanceof ai))return Array.isArray(e)?e.every(Array.isArray)?this.extend(ai.convert(e)):this.extend(li.convert(e)):this;if(n=e._sw,r=e._ne,!n||!r)return this}return t||i?(t.lng=Math.min(n.lng,t.lng),t.lat=Math.min(n.lat,t.lat),i.lng=Math.max(r.lng,i.lng),i.lat=Math.max(r.lat,i.lat)):(this._sw=new li(n.lng,n.lat),this._ne=new li(r.lng,r.lat)),this}getCenter(){return new li((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new li(this.getWest(),this.getNorth())}getSouthEast(){return new li(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return [this._sw.toArray(),this._ne.toArray()]}toString(){return `LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return !(this._sw&&this._ne)}contains(e){const{lng:t,lat:i}=li.convert(e);let n=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&n}static convert(e){return !e||e instanceof ai?e:new ai(e)}}const si=nt.TRANSFORM.R;class li{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);this.lng=+e,this.lat=+t,(this.lat>90||this.lat<-90)&&(this.lat=function(e){return e>90?90:e<-90?-90:e}(this.lat));}wrap(){return new li(Fe(this.lng,-180,180),this.lat)}toArray(){return [this.lng,this.lat]}toString(){return `LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,i=this.lat*t,n=e.lat*t,r=Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos((e.lng-this.lng)*t);return si*Math.acos(Math.min(r,1))}toBounds(e=0){const t=360*e/40075017,i=t/Math.cos(Math.PI/180*this.lat);return new ai(new li(this.lng-i,this.lat-t),new li(this.lng+i,this.lat+t))}static convert(e){if(e instanceof li)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new li(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new li(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}static equals(e,t){return e.lng===t.lng&&e.lat===t.lat}}const ci={LATLON:"LATLON",MERCATOR:"MERCATOR"},ui={R:nt.TRANSFORM.R,CIR:nt.TRANSFORM.CIR,projectType:"LATLON",project(e){return new te(this.lngX(e.lng,this.CIR),this.latY(e.lat,this.CIR))},unproject(e){return new li(this.xLng(e.x,this.CIR),this.yLat(e.y,this.CIR))},projectWithWorldSize(e,t){return new te(this.lngX(e.lng,t),this.latY(e.lat,t))},unprojectWithWorldSize(e,t){return new li(this.xLng(e.x,t),this.yLat(e.y,t))},lngX:(e,t)=>(180+e)*t/360,latY:(e,t)=>(90-e)/180*t*.5,xLng:(e,t)=>360*e/t-180,yLat:(e,t)=>90-e/(.5*t)*180,tileNumberToLngLat(e,t,i){return new li(this.xLng(e[0]*t,i),this.yLat(e[1]*t,i))},lngLatToTileNumber(e,t,i){return [this.lngX(e.lng,i)/t,this.latY(e.lat,i)/t]}},hi={R:nt.TRANSFORM.R,CIR:nt.TRANSFORM.CIR,projectType:"MERCATOR",project(e){return new te(this.lngX(e.lng,this.CIR),this.latY(e.lat,this.CIR))},unproject(e){return new li(this.xLng(e.x,this.CIR),this.yLat(e.y,this.CIR))},projectWithWorldSize(e,t){return new te(this.lngX(e.lng,t),this.latY(e.lat,t))},unprojectWithWorldSize(e,t){return new li(this.xLng(e.x,t),this.yLat(e.y,t))},lngX:(e,t)=>(180+e)*t/360,latY:(e,t)=>(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))*t/360,xLng:(e,t)=>360*e/t-180,yLat:(e,t)=>360/Math.PI*Math.atan(Math.exp((180-360*e/t)*Math.PI/180))-90,tileNumberToLngLat(e,t,i){return new li(this.xLng(e[0]*t,i),this.yLat(e[1]*t,i))},lngLatToTileNumber(e,t,i){return [this.lngX(e.lng,i)/t,this.latY(e.lat,i)/t]}};function di(e){return e===ci.LATLON?ui:hi}const pi={lngX:(e,t,i)=>di(i).lngX(e,t),lngXRoundZoom:(e,t,i)=>di(i).lngX(e,Math.pow(2,Math.floor(t))),latY:(e,t,i)=>di(i).latY(e,t),latYRoundZoom:(e,t,i)=>di(i).latY(e,Math.pow(2,Math.floor(t))),xLng:(e,t,i)=>di(i).xLng(e,t),yLat:(e,t,i)=>di(i).yLat(e,t)},fi={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class mi{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8;}}class _i{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0);}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews());}clear(){this.length=0;}resize(e){this.reserve(e),this.length=e;}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t);}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function gi(e,t=1){let i=0,n=0;return {members:e.map((e=>{const r=fi[e.type].BYTES_PER_ELEMENT,o=i=yi(i,Math.max(t,r)),a=e.components||1;return n=Math.max(n,r),i+=r*a,{name:e.name,type:e.type,components:a,offset:o}})),size:yi(i,Math.max(n,t)),alignment:t}}function yi(e,t){return Math.ceil(e/t)*t}var xi=wi,vi=3;function wi(e,t,i){var n=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var r=new Int32Array(this.arrayBuffer);e=r[0],this.d=(t=r[1])+2*(i=r[2]);for(var o=0;o<this.d*this.d;o++){var a=r[vi+o],s=r[vi+o+1];n.push(a===s?null:r.subarray(a,s));}var l=r[vi+n.length+1];this.keys=r.subarray(r[vi+n.length],l),this.bboxes=r.subarray(l),this.insert=this._insertReadonly;}else {this.d=t+2*i;for(var c=0;c<this.d*this.d;c++)n.push([]);this.keys=[],this.bboxes=[];}this.n=t,this.extent=e,this.padding=i,this.scale=t/e,this.uid=0;var u=i/t*e;this.min=-u,this.max=e+u;}wi.prototype.insert=function(e,t,i,n,r){this._forEachCell(t,i,n,r,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r);},wi.prototype._insertReadonly=function(){throw "Cannot insert into a GridIndex created from an ArrayBuffer."},wi.prototype._insertCell=function(e,t,i,n,r,o){this.cells[r].push(o);},wi.prototype.query=function(e,t,i,n,r){var o=this.min,a=this.max;if(e<=o&&t<=o&&a<=i&&a<=n&&!r)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(e,t,i,n,this._queryCell,s,{},r),s},wi.prototype._queryCell=function(e,t,i,n,r,o,a,s){var l=this.cells[r];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var d=l[h];if(void 0===a[d]){var p=4*d;(s?s(u[p+0],u[p+1],u[p+2],u[p+3]):e<=u[p+2]&&t<=u[p+3]&&i>=u[p+0]&&n>=u[p+1])?(a[d]=!0,o.push(c[d])):a[d]=!1;}}},wi.prototype._forEachCell=function(e,t,i,n,r,o,a,s){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(i),h=this._convertToCellCoord(n),d=l;d<=u;d++)for(var p=c;p<=h;p++){var f=this.d*p+d;if((!s||s(this._convertFromCellCoord(d),this._convertFromCellCoord(p),this._convertFromCellCoord(d+1),this._convertFromCellCoord(p+1)))&&r.call(this,e,t,i,n,f,o,a,s))return}},wi.prototype._convertFromCellCoord=function(e){return (e-this.padding)/this.scale},wi.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},wi.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=vi+this.cells.length+1+1,i=0,n=0;n<this.cells.length;n++)i+=this.cells[n].length;var r=new Int32Array(t+i+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var o=t,a=0;a<e.length;a++){var s=e[a];r[vi+a]=o,r.set(s,o),o+=s.length;}return r[vi+e.length]=o,r.set(this.keys,o),r[vi+e.length+1]=o+=this.keys.length,r.set(this.bboxes,o),o+=this.bboxes.length,r.buffer};const Ti={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function bi(e){return (e=Math.round(e))<0?0:e>255?255:e}function Pi(e){return e<0?0:e>1?1:e}function Si(e){return bi("%"===e[e.length-1]?Number(e.slice(0,-1))/100*255:Number(e))}function Ai(e){return "%"!==e[e.length-1]?null:Pi(Number(e.slice(0,-1))/100)}function Ei(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}function Ci(e){return e<48?NaN:e<=57?e-48:e<97?NaN:e<=102?e-87:NaN}const Mi=new Set([" ","\t","\n","\r",",","/"]);function Ii(e){const t=e.trim().toLowerCase();if(t in Ti)return Ti[t].slice();if("#"===t[0]){const e=4===t.length||5===t.length;if(!e&&7!==t.length&&9!==t.length)return null;const i=e?1:2,n=[0,0,0,255],r=5===t.length||9===t.length?4:3;for(let o=0;o<r;o++){const r=Ci(t.charCodeAt(o*i+1));if(n[o]=16*r+(e?r:Ci(t.charCodeAt(o*i+2))),Number.isNaN(n[o]))return null}return n[3]/=255,n}const i=t.indexOf("(");let n=t.indexOf(")");if(-1===n&&(n=t.length),-1!==i&&(n+1===t.length||n===t.length)){const e=t.substr(0,i),r=[];let o="";for(let e=i+1;e<n;e++)Mi.has(t[e])?0!==o.length&&(r.push(o),o=""):o+=t[e];0!==o.length&&r.push(o);const a=4===r.length?function(e){return Ai(e)??Pi(Number(e))}(r.pop()):1;if(3!==r.length)return null;let s,l,c,u,h,d;switch(e){case"rgba":case"rgb":return d=[...r.map(Si),a],d.some(Number.isNaN)?null:d;case"hsla":case"hsl":return s=(function(e){return e.endsWith("deg")?Number(e.slice(0,-3)):e.endsWith("grad")?360*Number(e.slice(0,-4))/400:e.endsWith("rad")?360*Number(e.slice(0,-3))/(2*Math.PI):e.endsWith("turn")?360*Number(e.slice(0,-4)):Number(e)}(r[0])%360+360)%360/360,Number.isNaN(s)?null:(l=Ai(r[1]),Number.isNaN(l)||null===l?null:(c=Ai(r[2]),Number.isNaN(c)||null===c?null:(h=c<=.5?c*(l+1):c+l-c*l,u=2*c-h,[bi(255*Ei(u,h,s+1/3)),bi(255*Ei(u,h,s)),bi(255*Ei(u,h,s-1/3)),a])));default:return null}}return null}class Li{constructor(e,t,i,n=1){this.r=e,this.g=t,this.b=i,this.a=n;}set(e){this.r=e[0],this.g=e[1],this.b=e[2],this.a=e[3];}toBytes(e){const t=Li.floatToByte(this.r),i=Li.floatToByte(this.g),n=Li.floatToByte(this.b),r=Li.floatToByte(this.a);return $(e)?(e[0]=t,e[1]=i,e[2]=n,e[3]=r,e):[t,i,n,r]}static equals(e,t){return e===t||$(e)&&$(t)&&e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}static parse(e){if(!e)return;if(e instanceof Li)return e;if(Array.isArray(e))return new Li(...e);if(e instanceof ft)return new Li(e[0],e[1],e[2]);if(e instanceof wt)return new Li(e[0],e[1],e[2],e[3]);if("string"!=typeof e)return;const t=Ii(e);return t?new Li(t[0]/255,t[1]/255,t[2]/255,t[3]):void 0}toString(){const[e,t,i,n]=this.toArray();return `rgba(${Math.round(e)},${Math.round(t)},${Math.round(i)},${n})`}toArray(){const{r:e,g:t,b:i,a:n}=this;return 0===n?[0,0,0,0]:[255*e/n,255*t/n,255*i/n,n]}toArrayFloat(){const{r:e,g:t,b:i,a:n}=this;return 0===n?[0,0,0,0]:[e/n,t/n,i/n,n]}toVector3(){const{r:e,g:t,b:i}=this;return new ft(e,t,i)}toVector4(){return new wt(this.r,this.g,this.b,this.a)}static floatToByte(e){return 1===e?255:256*e|0}static byteToFloat(e){return e/255}toRgba(){return Oi[0]=Li.floatToByte(this.r),Oi[1]=Li.floatToByte(this.g),Oi[2]=Li.floatToByte(this.b),Oi[3]=Li.floatToByte(this.a),Ri[0]}static toHex(e){return function(e){const t=e.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),i=parseFloat(t[3]||1),n=Math.floor(i*parseInt(t[0])+255*(1-i)),r=Math.floor(i*parseInt(t[1])+255*(1-i)),o=Math.floor(i*parseInt(t[2])+255*(1-i));return `#${`0${n.toString(16)}`.slice(-2)}${`0${r.toString(16)}`.slice(-2)}${`0${o.toString(16)}`.slice(-2)}`.toLocaleUpperCase()}(this.parse(e).toString())}static fromRgba(e,t){return Ri[0]=e,Li.fromBytes(Oi[0],Oi[1],Oi[2],Oi[3],t)}static fromBytes(e,t,i,n,r){return e=Li.byteToFloat(Z(e,255)),t=Li.byteToFloat(Z(t,255)),i=Li.byteToFloat(Z(i,255)),n=Li.byteToFloat(Z(n,255)),$(r)?(r.r=e,r.g=t,r.b=i,r.a=n,r):new Li(e,t,i,n)}static pack(e,t,i){return i=Z(i,0),t[i++]=e.r,t[i++]=e.g,t[i++]=e.b,t[i]=e.a,t}static unpack(e,t,i){return t=Z(t,0),$(i)||(i=new Li),i.r=e[t++],i.g=e[t++],i.b=e[t++],i.a=e[t],i}static clone(e,t){if($(e))return $(t)?(t.r=e.r,t.g=e.g,t.b=e.b,t.a=e.a,t):new Li(e.r,e.g,e.b,e.a)}copy(e){this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a;}}const Ni=new ArrayBuffer(4),Ri=new Uint32Array(Ni),Oi=new Uint8Array(Ni);Li.black=new Li(0,0,0,1),Li.white=new Li(1,1,1,1),Li.transparent=new Li(0,0,0,0),Li.packedLength=4;var Di=Li;function Fi(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}class zi extends Error{constructor(e,t){super(t),this.message=t,this.key=e;}}var Bi=zi;class Vi{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,i]of t)this.bindings[e]=i;}concat(e){return new Vi(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return !!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Ui=Vi;const ki={kind:"null"},Gi={kind:"number"},Hi={kind:"string"},Yi={kind:"boolean"},qi={kind:"color"},Xi={kind:"object"},ji={kind:"value"},Wi={kind:"collator"},$i={kind:"formatted"},Zi={kind:"resolvedImage"};function Ki(e,t){return {kind:"array",itemType:e,N:t}}function Qi(e){if("array"===e.kind){const t=Qi(e.itemType);return "number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const Ji=[ki,Gi,Hi,Yi,qi,$i,Xi,Ki(ji),Zi];function en(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!en(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else {if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of Ji)if(!en(e,t))return null}return `Expected ${Qi(e)} but found ${Qi(t)} instead.`}function tn(e,t){return t.some((t=>t.kind===e.kind))}function nn(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}class rn{constructor(e,t,i){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"});}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class on{constructor(e,t,i){this.type=Wi,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=t;}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const i=e[1];if("object"!=typeof i||Array.isArray(i))return t.error("Collator options argument must be an object.");const n=t.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,Yi);if(!n)return null;const r=t.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,Yi);if(!r)return null;let o=null;return i.locale&&(o=t.parse(i.locale,1,Hi),!o)?null:new on(n,r,o)}evaluate(e){return new rn(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale);}possibleOutputs(){return [void 0]}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var an={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519};function sn(e){for(const t of e)if(cn(t.charCodeAt(0)))return !0;return !1}function ln(e){return !(an.Arabic(e)||an["Arabic Supplement"](e)||an["Arabic Extended-A"](e)||an["Arabic Presentation Forms-A"](e)||an["Arabic Presentation Forms-B"](e))}function cn(e){return !(746!==e&&747!==e&&(e<4352||!(an["Bopomofo Extended"](e)||an.Bopomofo(e)||an["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||an["CJK Compatibility Ideographs"](e)||an["CJK Compatibility"](e)||an["CJK Radicals Supplement"](e)||an["CJK Strokes"](e)||!(!an["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||an["CJK Unified Ideographs Extension A"](e)||an["CJK Unified Ideographs"](e)||an["Enclosed CJK Letters and Months"](e)||an["Hangul Compatibility Jamo"](e)||an["Hangul Jamo Extended-A"](e)||an["Hangul Jamo Extended-B"](e)||an["Hangul Jamo"](e)||an["Hangul Syllables"](e)||an.Hiragana(e)||an["Ideographic Description Characters"](e)||an.Kanbun(e)||an["Kangxi Radicals"](e)||an["Katakana Phonetic Extensions"](e)||an.Katakana(e)&&12540!==e||!(!an["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!an["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||an["Unified Canadian Aboriginal Syllabics"](e)||an["Unified Canadian Aboriginal Syllabics Extended"](e)||an["Vertical Forms"](e)||an["Yijing Hexagram Symbols"](e)||an["Yi Syllables"](e)||an["Yi Radicals"](e))))}function un(e){return !(cn(e)||function(e){return !!(an["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||an["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||an["Letterlike Symbols"](e)||an["Number Forms"](e)||an["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||an["Control Pictures"](e)&&9251!==e||an["Optical Character Recognition"](e)||an["Enclosed Alphanumerics"](e)||an["Geometric Shapes"](e)||an["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||an["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||an["CJK Symbols and Punctuation"](e)||an.Katakana(e)||an["Private Use Area"](e)||an["CJK Compatibility Forms"](e)||an["Small Form Variants"](e)||an["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function hn(e){return e>=1424&&e<=2303||an["Arabic Presentation Forms-A"](e)||an["Arabic Presentation Forms-B"](e)}function dn(e,t){return !(!t&&hn(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||an.Khmer(e))}function pn(e){for(const t of e)if(hn(t.charCodeAt(0)))return !0;return !1}class fn{constructor(e,t,i){this.text="string"==typeof e?e:e.toString(),this.scale=t,this.fontStack=i;}}class mn{constructor(e){this.sections=e;}static fromString(e){return new mn([new fn(e,null,null,null)])}static factory(e){return e instanceof mn?e:mn.fromString(e)}toString(){return this.sections.map((e=>e.text)).join("")}containsRTLText(){for(const e of this.sections)if(pn(e.text))return !0;return !1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.text);const i=t.fontStack?["literal",t.fontStack.split(",")]:null;e.push({"text-font":i,"font-scale":t.scale});}return e}}class _n{constructor(e){this.name=e.name,this.available=e.available;}toString(){return this.name}static fromString(e){return e?new _n({name:e,available:!1}):null}serialize(){return ["image",this.name]}}function gn(e,t,i,n){return "number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[e,t,i,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof n?[e,t,i,n]:[e,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function yn(e){if(null===e)return !0;if("string"==typeof e)return !0;if("boolean"==typeof e)return !0;if("number"==typeof e)return !0;if(e instanceof Di)return !0;if(e instanceof rn)return !0;if(e instanceof mn)return !0;if(e instanceof _n)return !0;if(Array.isArray(e)){for(const t of e)if(!yn(t))return !1;return !0}if("object"==typeof e){for(const t in e)if(!yn(e[t]))return !1;return !0}return !1}function xn(e){if(null===e)return ki;if("string"==typeof e)return Hi;if("boolean"==typeof e)return Yi;if("number"==typeof e)return Gi;if(e instanceof Di)return qi;if(e instanceof rn)return Wi;if(e instanceof mn)return $i;if(e instanceof _n)return Zi;if(Array.isArray(e)){const t=e.length;let i;for(const t of e){const e=xn(t);if(i){if(i===e)continue;i=ji;break}i=e;}return Ki(i||ji,t)}return Xi}function vn(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof Di||e instanceof mn||e instanceof _n?e.toString():JSON.stringify(e)}class wn{constructor(e,t){this.type=e,this.value=t;}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!yn(e[1]))return t.error("invalid value");const i=e[1];let n=xn(i);const r=t.expectedType;return "array"!==n.kind||0!==n.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(n=r),new wn(n,i)}evaluate(){return this.value}eachChild(){}possibleOutputs(){return [this.value]}serialize(){return "array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Di?["rgba"].concat(this.value.toArray()):this.value instanceof mn?this.value.serialize():this.value}}var Tn=wn,bn=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e;}toJSON(){return this.message}};const Pn={string:Hi,number:Gi,boolean:Yi,object:Xi};class Sn{constructor(e,t){this.type=e,this.args=t;}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=Pn[e[0]],n=[];for(let i=1;i<e.length;i++){const r=t.parse(e[i],i,ji);if(!r)return null;n.push(r);}return new Sn(i,n)}evaluate(e){for(let t=0;t<this.args.length;t++){const i=this.args[t].evaluate(e);if(!en(this.type,xn(i)))return i;if(t===this.args.length-1)throw new bn(`Expected value to be of type ${Qi(this.type)}, but found ${Qi(xn(i))} instead.`)}return null}eachChild(e){this.args.forEach(e);}possibleOutputs(){return [].concat(...this.args.map((e=>e.possibleOutputs())))}serialize(){return [this.type.kind].concat(this.args.map((e=>e.serialize())))}}var An=Sn;const En={string:Hi,number:Gi,boolean:Yi};class Cn{constructor(e,t){this.type=e,this.input=t;}static parse(e,t){if(e.length<2||e.length>4)return t.error(`Expected 1, 2, or 3 arguments, but found ${e.length-1} instead.`);let i,n;if(e.length>2){const n=e[1];if("string"!=typeof n||!(n in En))return t.error('The item type argument of "array" must be one of string, number, boolean',1);i=En[n];}else i=ji;if(e.length>3){if("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2]))return t.error('The length argument to "array" must be a positive integer literal',2);n=e[2];}const r=Ki(i,n),o=t.parse(e[e.length-1],e.length-1,ji);return o?new Cn(r,o):null}evaluate(e){const t=this.input.evaluate(e);if(en(this.type,xn(t)))throw new bn(`Expected value to be of type ${Qi(this.type)}, but found ${Qi(xn(t))} instead.`);return t}eachChild(e){e(this.input);}possibleOutputs(){return this.input.possibleOutputs()}serialize(){const e=["array"],t=this.type.itemType;if("string"===t.kind||"number"===t.kind||"boolean"===t.kind){e.push(t.kind);const i=this.type.N;"number"==typeof i&&e.push(i);}return e.push(this.input.serialize()),e}}var Mn=Cn;function In(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}const Ln={"to-boolean":Yi,"to-color":qi,"to-number":Gi,"to-string":Hi};class Nn{constructor(e,t){this.type=e,this.args=t;}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[0],n=[];let r=ki;if("to-array"===i){if(!Array.isArray(e[1]))return null;const i=e[1].length;if(t.expectedType){if("array"!==t.expectedType.kind)return t.error(`Expected ${t.expectedType.kind} but found array.`);r=Ki(t.expectedType.itemType,i);}else {if(!(i>0&&yn(e[1][0])))return null;r=Ki(xn(e[1][0]),i);}for(let o=0;o<i;o++){const i=e[1][o];let a;if("array"===In(i))a=t.parse(i,void 0,r.itemType);else {const e=In(i);if(e!==r.itemType.kind)return t.error(`Expected ${r.itemType.kind} but found ${e}.`);a=t.registry.literal.parse(["literal",void 0===i?null:i],t);}if(!a)return null;n.push(a);}}else {if(("to-boolean"===i||"to-string"===i)&&2!==e.length)return t.error("Expected one argument.");r=Ln[i];for(let i=1;i<e.length;i++){const r=t.parse(e[i],i,ji);if(!r)return null;n.push(r);}}return new Nn(r,n)}evaluate(e){if("color"===this.type.kind){let t,i;for(const n of this.args)if(t=n.evaluate(e),i=null,"string"==typeof t){const i=e.parseColor(t);if(i)return i}else if(Array.isArray(t)&&(i=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:gn(t[0],t[1],t[2],t[3]),!i))return new Di(t[0]/255,t[1]/255,t[2]/255,t[3]);throw new bn(i||`Could not parse color from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}if("formatted"===this.type.kind)return mn.fromString(vn(this.args[0].evaluate(e)));if("resolvedImage"===this.type.kind)return _n.fromString(vn(this.args[0].evaluate(e)));{let t=null;for(const i of this.args){if(t=i.evaluate(e),null===t)continue;const n=Number(t);if(!isNaN(n))return n}throw new bn(`Could not convert ${JSON.stringify(t)} to number.`)}}eachChild(e){this.args.forEach(e);}possibleOutputs(){return [].concat(...this.args.map((e=>e.possibleOutputs())))}serialize(){const e=[`to-${this.type.kind}`];return this.eachChild((t=>{e.push(t.serialize());})),e}}var Rn=Nn;const On=["Unknown","Point","LineString","Polygon"];var Dn=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null;}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?this.feature._feature?"number"==typeof this.feature._feature.type?On[this.feature._feature.type]:this.feature._feature.type:"number"==typeof this.feature.type?On[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&this.feature.hasOwnProperty("geometry")?this.feature.geometry:this.feature&&this.feature._feature&&this.feature._feature.hasOwnProperty("geometry")?this.feature._feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Di.parse(e)),t}};class Fn{constructor(e,t,i,n){this.name=e,this.type=t,this._evaluate=i,this.args=n;}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e);}possibleOutputs(){return [void 0]}serialize(){return [this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const i=e[0],n=Fn.definitions[i];if(!n)return t.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const r=Array.isArray(n)?n[0]:n.type,o=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,a=o.filter((([t])=>!Array.isArray(t)||t.length===e.length-1)),s=[];for(let i=1;i<e.length;i++){const n=e[i];let r;if(1===a.length){const e=a[0][0];r=Array.isArray(e)?e[i-1]:e.type;}const o=t.parse(n,1+s.length,r);if(!o)return null;s.push(o);}let l=null;for(const[e,n]of a)if(l=new lr(t.registry,t.path,null,t.scope),Array.isArray(e)&&e.length!==s.length)l.error(`Expected ${e.length} arguments, but found ${s.length} instead.`);else {for(let t=0;t<s.length;t++){const i=Array.isArray(e)?e[t]:e.type,n=s[t];l.concat(t+1).checkSubtype(i,n.type);}if(0===l.errors.length)return new Fn(i,r,n,s)}if(1===a.length)t.errors.push.apply(t.errors,l.errors);else {const e=(a.length?a:o).map((([e])=>{return t=e,Array.isArray(t)?`(${t.map(Qi).join(", ")})`:`(${Qi(t.type)}...)`;var t;})).join(" | "),i=s.map((e=>Qi(e.type))).join(", ");t.error(`Expected arguments of type ${e}, but found (${i}) instead.`);}return null}static register(e,t){Fn.definitions=t;for(const i in t)e[i]=Fn;}}var zn=Fn;const Bn=8192;function Vn(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1]);}function Un(e,t){return !(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function kn(e,t){const i=(180+e[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,r=Math.pow(2,t.z);return [Math.round(i*r*Bn),Math.round(n*r*Bn)]}function Gn(e,t,i){const n=e[0]-t[0],r=e[1]-t[1],o=e[0]-i[0],a=e[1]-i[1];return n*a-o*r==0&&n*o<=0&&r*a<=0}function Hn(e,t){let i=!1;for(let a=0,s=t.length;a<s;a++){const s=t[a];for(let t=0,a=s.length;t<a-1;t++){if(Gn(e,s[t],s[t+1]))return !1;(r=s[t])[1]>(n=e)[1]!=(o=s[t+1])[1]>n[1]&&n[0]<(o[0]-r[0])*(n[1]-r[1])/(o[1]-r[1])+r[0]&&(i=!i);}}var n,r,o;return i}function Yn(e,t){for(let i=0;i<t.length;i++)if(Hn(e,t[i]))return !0;return !1}function qn(e,t,i,n){const r=n[0]-i[0],o=n[1]-i[1],a=(e[0]-i[0])*o-r*(e[1]-i[1]),s=(t[0]-i[0])*o-r*(t[1]-i[1]);return a>0&&s<0||a<0&&s>0}function Xn(e,t,i){for(const c of i)for(let i=0;i<c.length-1;++i)if(0!=(s=[(a=c[i+1])[0]-(o=c[i])[0],a[1]-o[1]])[0]*(l=[(r=t)[0]-(n=e)[0],r[1]-n[1]])[1]-s[1]*l[0]&&qn(n,r,o,a)&&qn(o,a,n,r))return !0;var n,r,o,a,s,l;return !1}function jn(e,t){for(let i=0;i<e.length;++i)if(!Hn(e[i],t))return !1;for(let i=0;i<e.length-1;++i)if(Xn(e[i],e[i+1],t))return !1;return !0}function Wn(e,t){for(let i=0;i<t.length;i++)if(jn(e,t[i]))return !0;return !1}function $n(e,t,i){const n=[];for(let r=0;r<e.length;r++){const o=[];for(let n=0;n<e[r].length;n++){const a=kn(e[r][n],i);Vn(t,a),o.push(a);}n.push(o);}return n}function Zn(e,t,i){const n=[];for(let r=0;r<e.length;r++){const o=$n(e[r],t,i);n.push(o);}return n}function Kn(e,t,i,n){if(e[0]<i[0]||e[0]>i[2]){const t=.5*n;let r=e[0]-i[0]>t?-n:i[0]-e[0]>t?n:0;0===r&&(r=e[0]-i[2]>t?-n:i[2]-e[0]>t?n:0),e[0]+=r;}Vn(t,e);}function Qn(e,t,i,n){const r=Math.pow(2,n.z)*Bn,o=[n.x*Bn,n.y*Bn],a=[];for(const n of e)if(n.length)for(let e=0;e<n.length;e++){let s;s=n[e].x?[n[e].x+o[0],n[e].y+o[1]]:[n[e]+o[0],n[e]+o[1]],Kn(s,t,i,r),a.push(s);}else for(const e of n){const n=[e.x+o[0],e.y+o[1]];Kn(n,t,i,r),a.push(n);}return a}function Jn(e,t,i,n){const r=Math.pow(2,n.z)*Bn,o=[n.x*Bn,n.y*Bn],a=[];for(const i of e){const e=[];if(i.length)for(let n=0;n<i.length;n++){const r=[i[n][0]+o[0],i[n][1]+o[1]];Vn(t,r),e.push(r);}else for(const n of i){const i=[n.x+o[0],n.y+o[1]];Vn(t,i),e.push(i);}a.push(e);}if(t[2]-t[0]<=r/2){!function(e){e[0]=e[1]=1/0,e[2]=e[3]=-1/0;}(t);for(const e of a)for(const n of e)Kn(n,t,i,r);}return a}class er{constructor(e,t){this.type=Yi,this.geojson=e,this.geometries=t;}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(yn(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const i=t.features[e].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new er(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new er(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new er(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if("Polygon"===t.type){const o=$n(t.coordinates,n,r),a=Qn(e.geometry(),i,n,r);if(!Un(i,n))return !1;for(const e of a)if(!Hn(e,o))return !1}if("MultiPolygon"===t.type){const o=Zn(t.coordinates,n,r),a=Qn(e.geometry(),i,n,r);if(!Un(i,n))return !1;for(const e of a)if(!Yn(e,o))return !1}return !0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if("Polygon"===t.type){const o=$n(t.coordinates,n,r),a=Jn(e.geometry(),i,n,r);if(!Un(i,n))return !1;for(const e of a)if(!jn(e,o))return !1}if("MultiPolygon"===t.type){const o=Zn(t.coordinates,n,r),a=Jn(e.geometry(),i,n,r);if(!Un(i,n))return !1;for(const e of a)if(!Wn(e,o))return !1}return !0}(e,this.geometries)}return !1}eachChild(){}possibleOutputs(){return [void 0]}serialize(){return ["within",this.geojson]}}var tr=er;function ir(e){if(e instanceof zn){if("get"===e.name&&1===e.args.length)return !1;if("feature-state"===e.name)return !1;if("has"===e.name&&1===e.args.length)return !1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return !1;if(/^filter-/.test(e.name))return !1}if(e instanceof tr)return !1;let t=!0;return e.eachChild((e=>{t&&!ir(e)&&(t=!1);})),t}function nr(e){if(e instanceof zn&&"feature-state"===e.name)return !1;let t=!0;return e.eachChild((e=>{t&&!nr(e)&&(t=!1);})),t}function rr(e,t){if(e instanceof zn&&t.indexOf(e.name)>=0)return !1;let i=!0;return e.eachChild((e=>{i&&!rr(e,t)&&(i=!1);})),i}class or{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t;}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const i=e[1];return t.scope.has(i)?new or(i,t.scope.get(i)):t.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}possibleOutputs(){return [void 0]}serialize(){return ["var",this.name]}}var ar=or;class sr{constructor(e,t=[],i,n=new Ui,r=[],o){this.registry=e,this.path=t,this.key=t.map((e=>`[${e}]`)).join(""),this.scope=n,this.errors=r,this.expectedType=i,this.options=o;}parse(e,t,i,n,r={}){return t||i?this.concat(t,i,n)._parse(e,r):this._parse(e,r)}_parse(e,t){function i(e,t,i){return "assert"===i?new An(t,[e]):"coerce"===i?new Rn(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n="string"==typeof e[0]?this.registry[e[0]]:void 0;if(n){let r=n.parse(e,this);if(!r)return null;if(this.expectedType){const e=this.expectedType,n=r.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==n.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==n.kind&&"string"!==n.kind){if(this.checkSubtype(e,n))return null}else r=i(r,e,t.typeAnnotation||"coerce");else r=i(r,e,t.typeAnnotation||"assert");}if(!(r instanceof Tn)&&"resolvedImage"!==r.type.kind&&cr(r)){const e=new Dn(this.options);try{r=new Tn(r.type,r.evaluate(e));}catch(e){return this.error(e.message),null}}return r}return Rn.parse(["to-array",e],this)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,i){const n="number"==typeof e?this.path.concat(e):this.path,r=i?this.scope.concat(i):this.scope;return new sr(this.registry,n,t||null,r,this.errors,this.options)}error(e,...t){const i=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new Bi(i,e));}checkSubtype(e,t){const i=en(e,t);return i&&this.error(i),i}}var lr=sr;function cr(e){if(e instanceof ar)return cr(e.boundExpression);if(e instanceof zn&&"error"===e.name)return !1;if(e instanceof zn&&"config"===e.name)return !1;if(e instanceof on)return !1;if(e instanceof tr)return !1;const t=e instanceof Rn||e instanceof An||e instanceof Mn;let i=!0;return e.eachChild((e=>{i=t?i&&cr(e):i&&e instanceof Tn;})),!!i&&ir(e)&&rr(e,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function ur(e,t){let i,n,r=0,o=e.length-1,a=0;for(;r<=o;){if(a=Math.floor((r+o)/2),i=e[a],n=e[a+1],t===i||t>i&&t<n)return a;if(i<t)r=a+1;else {if(!(i>t))throw new bn("Input is not a number.");o=a-1;}}return Math.max(a-1,0)}class hr{constructor(e,t,i){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of i)this.labels.push(e),this.outputs.push(t);}static parse(e,t){let[,i,...n]=e;if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(i=t.parse(i,1,Gi),!i)return null;const r=[];let o=null;t.expectedType&&"value"!==t.expectedType.kind&&(o=t.expectedType),n.unshift(-1/0);for(let e=0;e<n.length;e+=2){const i=n[e],a=n[e+1],s=e+1,l=e+2;if("number"!=typeof i)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(r.length&&r[r.length-1][0]>=i)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',s);const c=t.parse(a,l,o);if(!c)return null;o=o||c.type,r.push([i,c]);}return new hr(o,i,r)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return i[0].evaluate(e);const r=t.length;return n>=t[r-1]?i[r-1].evaluate(e):i[ur(t,n)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t);}possibleOutputs(){return [].concat(...this.outputs.map((e=>e.possibleOutputs())))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var dr=hr;function pr(e,t,i){return e*(1-i)+t*i}var fr=Object.freeze({__proto__:null,number:pr,color:function(e,t,i){return new Di(pr(e.r,t.r,i),pr(e.g,t.g,i),pr(e.b,t.b,i),pr(e.a,t.a,i))},array:function(e,t,i){return e.map(((e,n)=>pr(e,t[n],i)))}});class mr{constructor(e,t,i,n){this.type=e,this.interpolation=t,this.input=i,this.labels=[],this.outputs=[];for(const[e,t]of n)this.labels.push(e),this.outputs.push(t);}static interpolationFactor(e,t,i,n){let r=0;if("exponential"===e.name)r=_r(t,e.base,i,n);else if("linear"===e.name)r=_r(t,1,i,n);else if("cubic-bezier"===e.name){const o=e.controlPoints;r=new K(o[0],o[1],o[2],o[3]).solve(_r(t,1,i,n));}return r}static parse(e,t){let[,i,n,...r]=e;if(!Array.isArray(i)||0===i.length)return t.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){const e=i[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:e};}else {if("cubic-bezier"!==i[0])return t.error(`Unknown interpolation type ${String(i[0])}`,1,0);{const e=i.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:e};}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(n=t.parse(n,2,Gi),!n)return null;const o=[];let a=null;t.expectedType&&"value"!==t.expectedType.kind&&(a=t.expectedType);for(let e=0;e<r.length;e+=2){const i=r[e],n=r[e+1],s=e+3,l=e+4;if("number"!=typeof i)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(o.length&&o[o.length-1][0]>=i)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',s);const c=t.parse(n,l,a);if(!c)return null;a=a||c.type,o.push([i,c]);}return "number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new mr(a,i,n,o):t.error(`Type ${Qi(a)} is not interpolatable.`)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return i[0].evaluate(e);const r=t.length;if(n>=t[r-1])return i[r-1].evaluate(e);const o=ur(t,n),a=mr.interpolationFactor(this.interpolation,n,t[o],t[o+1]),s=i[o].evaluate(e),l=i[o+1].evaluate(e);return fr[this.type.kind.toLowerCase()](s,l,a)}eachChild(e){e(this.input);for(const t of this.outputs)e(t);}possibleOutputs(){return [].concat(...this.outputs.map((e=>e.possibleOutputs())))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=["interpolate",e,this.input.serialize()];for(let e=0;e<this.labels.length;e++)t.push(this.labels[e],this.outputs[e].serialize());return t}}function _r(e,t,i,n){const r=n-i,o=e-i;return 0===r?0:1===t?o/r:(Math.pow(t,o)-1)/(Math.pow(t,r)-1)}var gr=mr;class yr{constructor(e,t){this.type=e,this.args=t;}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let i=null;const n=t.expectedType;n&&"value"!==n.kind&&(i=n);const r=[];for(const n of e.slice(1)){const e=t.parse(n,1+r.length,i,void 0,{omitTypeAnnotations:!0});if(!e)return null;i=i||e.type,r.push(e);}const o=n&&r.some((e=>en(n,e.type)));return new yr(o?ji:i,r)}evaluate(e){let t,i=null,n=0;for(const r of this.args)if(n++,i=r.evaluate(e),i&&i instanceof _n&&!i.available&&(t||(t=i.name),i=null,n===this.args.length&&(i=t)),null!==i)break;return i}eachChild(e){this.args.forEach(e);}possibleOutputs(){return [].concat(...this.args.map((e=>e.possibleOutputs())))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize());})),e}}var xr=yr;class vr{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t;}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result);}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const i=[];for(let n=1;n<e.length-1;n+=2){const r=e[n];if("string"!=typeof r)return t.error(`Expected string, but found ${typeof r} instead.`,n);if(/[^a-zA-Z0-9_]/.test(r))return t.error("Variable names must contain only alphanumeric characters or '_'.",n);const o=t.parse(e[n+1],n+1);if(!o)return null;i.push([r,o]);}const n=t.parse(e[e.length-1],e.length-1,void 0,i);return n?new vr(i,n):null}possibleOutputs(){return this.result.possibleOutputs()}serialize(){const e=["let"];for(const[t,i]of this.bindings)e.push(t,i.serialize());return e.push(this.result.serialize()),e}}var wr=vr;class Tr{constructor(e,t,i){this.type=e,this.index=t,this.input=i;}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Gi),n=t.parse(e[2],2,Ki(t.expectedType||ji));return i&&n?new Tr(n.type.itemType,i,n):null}evaluate(e){const t=this.index.evaluate(e),i=this.input.evaluate(e);if(t<0)throw new bn(`Array index out of bounds: ${t} < 0.`);if(t>=i.length)throw new bn(`Array index out of bounds: ${t} > ${i.length-1}.`);if(t!==Math.floor(t))throw new bn(`Array index must be an integer, but found ${t} instead.`);return i[t]}eachChild(e){e(this.index),e(this.input);}possibleOutputs(){return [void 0]}serialize(){return ["at",this.index.serialize(),this.input.serialize()]}}var br=Tr;class Pr{constructor(e,t,i,n,r,o){this.inputType=e,this.type=t,this.input=i,this.cases=n,this.outputs=r,this.otherwise=o;}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let i,n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const r={},o=[];for(let a=2;a<e.length-1;a+=2){let s=e[a];const l=e[a+1];Array.isArray(s)||(s=[s]);const c=t.concat(a);if(0===s.length)return c.error("Expected at least one branch label.");for(const e of s){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,xn(e)))return null}else i=xn(e);if(void 0!==r[String(e)])return c.error("Branch labels must be unique.");r[String(e)]=o.length;}const u=t.parse(l,a,n);if(!u)return null;n=n||u.type,o.push(u);}const a=t.parse(e[1],1,ji);if(!a)return null;const s=t.parse(e[e.length-1],e.length-1,n);return s?"value"!==a.type.kind&&t.concat(1).checkSubtype(i,a.type)?null:new Pr(i,n,a,r,o,s):null}evaluate(e){const t=this.input.evaluate(e);return (xn(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise);}possibleOutputs(){const e=[].concat(...this.outputs.map((e=>e.possibleOutputs()))).concat(this.otherwise.possibleOutputs());return e}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),i=[],n={};for(const e of t){const t=n[this.cases[e]];void 0===t?(n[this.cases[e]]=i.length,i.push([this.cases[e],[e]])):i[t][1].push(e);}const r=e=>"number"===this.inputType.kind?Number(e):e;for(const[t,n]of i){if(1===n.length)e.push(r(n[0]));else {const t=n.map(r);e.push(t);}e.push(this.outputs[t].serialize());}return e.push(this.otherwise.serialize()),e}}var Sr=Pr;class Ar{constructor(e,t,i){this.type=e,this.branches=t,this.otherwise=i;}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const n=[];for(let r=1;r<e.length-1;r+=2){const o=t.parse(e[r],r,Yi);if(!o)return null;const a=t.parse(e[r+1],r+1,i);if(!a)return null;n.push([o,a]),i=i||a.type;}const r=t.parse(e[e.length-1],e.length-1,i);return r?new Ar(i,n,r):null}evaluate(e){for(const[t,i]of this.branches)if(t.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,i]of this.branches)e(t),e(i);e(this.otherwise);}possibleOutputs(){const e=[].concat(...this.branches.map((([e,t])=>t.possibleOutputs()))).concat(this.otherwise.possibleOutputs());return e}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize());})),e}}var Er=Ar;class Cr{constructor(e){this.type=Zi,this.input=e;}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,Hi);return i?new Cr(i):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),i=_n.fromString(t);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(t)>-1),i}eachChild(e){e(this.input);}possibleOutputs(){return [void 0]}serialize(){return ["image",this.input.serialize()]}}class Mr{constructor(e,t,i){this.type=Gi,this.needle=e,this.haystack=t,this.fromIndex=i;}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,ji),n=t.parse(e[2],2,ji);if(!i||!n)return null;if(!tn(i.type,[Yi,Hi,Gi,ki,ji]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qi(i.type)} instead`);if(4===e.length){const r=t.parse(e[3],3,Gi);return r?new Mr(i,n,r):null}return new Mr(i,n)}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!nn(t,["boolean","string","number","null"]))throw new bn(`Expected first argument to be of type boolean, string, number or null, but found ${Qi(xn(t))} instead.`);if(!nn(i,["string","array"]))throw new bn(`Expected second argument to be of type array or string, but found ${Qi(xn(i))} instead.`);if(this.fromIndex){const n=this.fromIndex.evaluate(e);return i.indexOf(t,n)}return i.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex);}possibleOutputs(){return [void 0]}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return ["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return ["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Ir=Mr;function Lr(e,t){return "=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function Nr(e,t,i,n){return 0===n.compare(t,i)}function Rr(e,t,i){const n="=="!==e&&"!="!==e;return class r{constructor(e,t,i){this.type=Yi,this.lhs=e,this.rhs=t,this.collator=i,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind;}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const i=e[0];let o=t.parse(e[1],1,ji);if(!o)return null;if(!Lr(i,o.type))return t.concat(1).error(`"${i}" comparisons are not supported for type '${Qi(o.type)}'.`);let a=t.parse(e[2],2,ji);if(!a)return null;if(!Lr(i,a.type))return t.concat(2).error(`"${i}" comparisons are not supported for type '${Qi(a.type)}'.`);if(o.type.kind!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return t.error(`Cannot compare types '${Qi(o.type)}' and '${Qi(a.type)}'.`);n&&("value"===o.type.kind&&"value"!==a.type.kind?o=new An(a.type,[o]):"value"!==o.type.kind&&"value"===a.type.kind&&(a=new An(o.type,[a])));let s=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return t.error("Cannot use collator to compare non-string types.");if(s=t.parse(e[3],3,Wi),!s)return null}return new r(o,a,s)}evaluate(r){const o=this.lhs.evaluate(r),a=this.rhs.evaluate(r);if(n&&this.hasUntypedArgument){const t=xn(o),i=xn(a);if(t.kind!==i.kind||"string"!==t.kind&&"number"!==t.kind)throw new bn(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${i.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const e=xn(o),i=xn(a);if("string"!==e.kind||"string"!==i.kind)return t(r,o,a)}return this.collator?i(r,o,a,this.collator.evaluate(r)):t(r,o,a)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator);}possibleOutputs(){return [void 0]}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize());})),t}}}const Or=Rr("==",(function(e,t,i){return t===i}),Nr),Dr=Rr("!=",(function(e,t,i){return t!==i}),(function(e,t,i,n){return !Nr(0,t,i,n)})),Fr=Rr("<",(function(e,t,i){return t<i}),(function(e,t,i,n){return n.compare(t,i)<0})),zr=Rr(">",(function(e,t,i){return t>i}),(function(e,t,i,n){return n.compare(t,i)>0})),Br=Rr("<=",(function(e,t,i){return t<=i}),(function(e,t,i,n){return n.compare(t,i)<=0})),Vr=Rr(">=",(function(e,t,i){return t>=i}),(function(e,t,i,n){return n.compare(t,i)>=0}));class Ur{constructor(e){this.type=Gi,this.input=e;}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=t.parse(e[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?t.error(`Expected argument of type string or array, but found ${Qi(i.type)} instead.`):new Ur(i):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new bn(`Expected value to be of type string or array, but found ${Qi(xn(t))} instead.`)}eachChild(e){e(this.input);}possibleOutputs(){return [void 0]}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize());})),e}}var kr=Ur;class Gr{constructor(e,t,i,n){this.type=e,this.input=t,this.beginIndex=i,this.endIndex=n;}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,ji),n=t.parse(e[2],2,Gi);if(!i||!n)return null;if(!tn(i.type,[Ki(ji),Hi,ji]))return t.error(`Expected first argument to be of type array or string, but found ${Qi(i.type)} instead`);if(4===e.length){const r=t.parse(e[3],3,Gi);return r?new Gr(i.type,i,n,r):null}return new Gr(i.type,i,n)}evaluate(e){const t=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!nn(t,["string","array"]))throw new bn(`Expected first argument to be of type array or string, but found ${Qi(xn(t))} instead.`);if(this.endIndex){const n=this.endIndex.evaluate(e);return t.slice(i,n)}return t.slice(i)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex);}possibleOutputs(){return [void 0]}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return ["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return ["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Hr=Gr;class Yr{constructor(e,t,i,n,r){this.type=Hi,this.number=e,this.locale=t,this.currency=i,this.minFractionDigits=n,this.maxFractionDigits=r;}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,Gi);if(!i)return null;const n=e[2];if("object"!=typeof n||Array.isArray(n))return t.error("NumberFormat options argument must be an object.");let r=null;if(n.locale&&(r=t.parse(n.locale,1,Hi),!r))return null;let o=null;if(n.currency&&(o=t.parse(n.currency,1,Hi),!o))return null;let a=null;if(n["min-fraction-digits"]&&(a=t.parse(n["min-fraction-digits"],1,Gi),!a))return null;let s=null;return n["max-fraction-digits"]&&(s=t.parse(n["max-fraction-digits"],1,Gi),!s)?null:new Yr(i,r,o,a,s)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits);}possibleOutputs(){return [void 0]}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class qr{constructor(e,t){this.type=Yi,this.needle=e,this.haystack=t;}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,ji),n=t.parse(e[2],2,ji);return i&&n?tn(i.type,[Yi,Hi,Gi,ki,ji])?new qr(i,n):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qi(i.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!i)return !1;if(!nn(t,["boolean","string","number","null"]))throw new bn(`Expected first argument to be of type boolean, string, number or null, but found ${Qi(xn(t))} instead.`);if(!nn(i,["string","array"]))throw new bn(`Expected second argument to be of type array or string, but found ${Qi(xn(i))} instead.`);return i.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack);}possibleOutputs(){return [void 0]}serialize(){return ["in",this.needle.serialize(),this.haystack.serialize()]}}var Xr=qr;class jr{constructor(e){this.type=$i,this.sections=e;}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&"object"==typeof i)return t.error("First argument must be an image or text section.");const n=[];let r=!1;for(let i=1;i<=e.length-1;++i){const o=e[i];if(r&&"object"==typeof o&&!Array.isArray(o)){r=!1;let e=null;if(o["font-scale"]&&(e=t.parse(o["font-scale"],1,Gi),!e))return null;let i=null;if(o["text-font"]&&(i=t.parse(o["text-font"],1,Ki(Hi)),!i))return null;let a=null;if(o["text-color"]&&(a=t.parse(o["text-color"],1,qi),!a))return null;const s=n[n.length-1];s.scale=e,s.font=i,s.textColor=a;}else {const o=t.parse(e[i],1,ji);if(!o)return null;const a=o.type.kind;if("string"!==a&&"value"!==a&&"null"!==a&&"resolvedImage"!==a)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,n.push({content:o,scale:null,font:null,textColor:null});}}return new jr(n)}evaluate(e){return new mn(this.sections.map((t=>{const i=t.content.evaluate(e);return xn(i)===Zi?new fn("",i,null,null,null):new fn(vn(i),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor);}possibleOutputs(){return [void 0]}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const i={};t.scale&&(i["font-scale"]=t.scale.serialize()),t.font&&(i["text-font"]=t.font.serialize()),t.textColor&&(i["text-color"]=t.textColor.serialize()),e.push(i);}return e}}const Wr={"==":Or,"!=":Dr,">":zr,"<":Fr,">=":Vr,"<=":Br,array:Mn,at:br,boolean:An,case:Er,coalesce:xr,collator:on,format:jr,image:Cr,in:Xr,"index-of":Ir,interpolate:gr,"interpolate-hcl":gr,"interpolate-lab":gr,length:kr,let:wr,literal:Tn,match:Sr,number:An,"number-format":Yr,object:An,slice:Hr,step:dr,string:An,"to-boolean":Rn,"to-color":Rn,"to-number":Rn,"to-string":Rn,var:ar,within:tr};function $r(e,[t,i,n,r]){t=t.evaluate(e),i=i.evaluate(e),n=n.evaluate(e);const o=r?r.evaluate(e):1,a=gn(t,i,n,o);if(a)throw new bn(a);return new Di(t/255*o,i/255*o,n/255*o,o)}function Zr(e,t){return e in t}function Kr(e,t){const i=t[e];return void 0===i?null:i}function Qr(e){return {type:e}}zn.register(Wr,{error:[{kind:"error"},[Hi],(e,[t])=>{throw new bn(t.evaluate(e))}],typeof:[Hi,[ji],(e,[t])=>Qi(xn(t.evaluate(e)))],"to-rgba":[Ki(Gi,4),[qi],(e,[t])=>t.evaluate(e).toArray()],rgb:[qi,[Gi,Gi,Gi],$r],rgba:[qi,[Gi,Gi,Gi,Gi],$r],has:{type:Yi,overloads:[[[Hi],(e,[t])=>Zr(t.evaluate(e),e.properties())],[[Hi,Xi],(e,[t,i])=>Zr(t.evaluate(e),i.evaluate(e))]]},get:{type:ji,overloads:[[[Hi],(e,[t])=>Kr(t.evaluate(e),e.properties())],[[Hi,Xi],(e,[t,i])=>Kr(t.evaluate(e),i.evaluate(e))]]},"feature-state":[ji,[Hi],(e,[t])=>Kr(t.evaluate(e),e.featureState||{})],properties:[Xi,[],e=>e.properties()],"geometry-type":[Hi,[],e=>e.geometryType()],id:[ji,[],e=>e.id()],zoom:[Gi,[],e=>e.globals.zoom],"heatmap-density":[Gi,[],e=>e.globals.heatmapDensity||0],"line-progress":[Gi,[],e=>e.globals.lineProgress||0],accumulated:[ji,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[Gi,Qr(Gi),(e,t)=>{let i=0;for(const n of t)i+=n.evaluate(e);return i}],"*":[Gi,Qr(Gi),(e,t)=>{let i=1;for(const n of t)i*=n.evaluate(e);return i}],"-":{type:Gi,overloads:[[[Gi,Gi],(e,[t,i])=>t.evaluate(e)-i.evaluate(e)],[[Gi],(e,[t])=>-t.evaluate(e)]]},"/":[Gi,[Gi,Gi],(e,[t,i])=>t.evaluate(e)/i.evaluate(e)],"%":[Gi,[Gi,Gi],(e,[t,i])=>t.evaluate(e)%i.evaluate(e)],ln2:[Gi,[],()=>Math.LN2],pi:[Gi,[],()=>Math.PI],e:[Gi,[],()=>Math.E],"^":[Gi,[Gi,Gi],(e,[t,i])=>Math.pow(t.evaluate(e),i.evaluate(e))],sqrt:[Gi,[Gi],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[Gi,[Gi],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[Gi,[Gi],(e,[t])=>Math.log(t.evaluate(e))],log2:[Gi,[Gi],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[Gi,[Gi],(e,[t])=>Math.sin(t.evaluate(e))],cos:[Gi,[Gi],(e,[t])=>Math.cos(t.evaluate(e))],tan:[Gi,[Gi],(e,[t])=>Math.tan(t.evaluate(e))],asin:[Gi,[Gi],(e,[t])=>Math.asin(t.evaluate(e))],acos:[Gi,[Gi],(e,[t])=>Math.acos(t.evaluate(e))],atan:[Gi,[Gi],(e,[t])=>Math.atan(t.evaluate(e))],min:[Gi,Qr(Gi),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[Gi,Qr(Gi),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[Gi,[Gi],(e,[t])=>Math.abs(t.evaluate(e))],round:[Gi,[Gi],(e,[t])=>{const i=t.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[Gi,[Gi],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[Gi,[Gi],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[Yi,[Hi,ji],(e,[t,i])=>e.properties()[t.value]===i.value],"filter-id-==":[Yi,[ji],(e,[t])=>e.id()===t.value],"filter-type-==":[Yi,[Hi],(e,[t])=>e.geometryType()===t.value],"filter-<":[Yi,[Hi,ji],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n<r}],"filter-id-<":[Yi,[ji],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i<n}],"filter->":[Yi,[Hi,ji],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n>r}],"filter-id->":[Yi,[ji],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i>n}],"filter-<=":[Yi,[Hi,ji],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n<=r}],"filter-id-<=":[Yi,[ji],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i<=n}],"filter->=":[Yi,[Hi,ji],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n>=r}],"filter-id->=":[Yi,[ji],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i>=n}],"filter-like":[Yi,[Hi,ji],(e,[t,i])=>e.properties()[t.value].indexOf(i.value)>=0],"filter-id-like":[Yi,[ji],(e,[t])=>e.id().indexOf(t.value)>=0],"filter-type-like":[Yi,[Hi],(e,[t])=>e.geometryType().indexOf(t.value)>=0],"filter-start":[Yi,[Hi,ji],(e,[t,i])=>0===e.properties()[t.value].indexOf(i.value)],"filter-id-start":[Yi,[ji],(e,[t])=>0===e.id().indexOf(t.value)],"filter-type-start":[Yi,[Hi],(e,[t])=>0===e.geometryType().indexOf(t.value)],"filter-end":[Yi,[Hi,ji],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return n.slice(-r.length)===r}],"filter-id-end":[Yi,[ji],(e,[t])=>{const i=e.id(),n=t.value;return i.slice(-n.length)===n}],"filter-type-end":[Yi,[Hi],(e,[t])=>{const i=e.geometryType(),n=t.value;return i.slice(-n.length)===n}],"filter-has":[Yi,[ji],(e,[t])=>t.value in e.properties()],"filter-has-id":[Yi,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[Yi,[Ki(Hi)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-type-arrin":[Yi,[Ki(Hi)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-arrin":[Yi,[Hi,Ki(ji)],(e,[t,i])=>function(e,t,i,n){for(;i<=n;){if(!e)return !1;if(e.indexOf(t[i])>-1)return !0;i+=1;}return !1}(e.properties()[t.value],i.value,0,i.value.length-1)],"filter-id-in":[Yi,[Ki(ji)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[Yi,[Hi,Ki(ji)],(e,[t,i])=>i.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[Yi,[Hi,Ki(ji)],(e,[t,i])=>function(e,t,i,n){for(;i<=n;){const r=i+n>>1;if(t[r]===e)return !0;t[r]>e?n=r-1:i=r+1;}return !1}(e.properties()[t.value],i.value,0,i.value.length-1)],all:{type:Yi,overloads:[[[Yi,Yi],(e,[t,i])=>t.evaluate(e)&&i.evaluate(e)],[Qr(Yi),(e,t)=>{for(const i of t)if(!i.evaluate(e))return !1;return !0}]]},any:{type:Yi,overloads:[[[Yi,Yi],(e,[t,i])=>t.evaluate(e)||i.evaluate(e)],[Qr(Yi),(e,t)=>{for(const i of t)if(i.evaluate(e))return !0;return !1}]]},"!":[Yi,[Yi],(e,[t])=>!t.evaluate(e)],"is-supported-script":[Yi,[Hi],(e,[t])=>{const i=e.globals&&e.globals.isSupportedScript;return !i||i(t.evaluate(e))}],upcase:[Hi,[Hi],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[Hi,[Hi],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[Hi,Qr(ji),(e,t)=>t.map((t=>vn(t.evaluate(e)))).join("")],"resolved-locale":[Hi,[Wi],(e,[t])=>t.evaluate(e).resolvedLocale()]});var Jr=Wr;function eo(e){return {result:"success",value:e}}function to(e){return {result:"error",value:e}}function io(e){return "data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function no(e){return !!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function ro(e){return !!e.expression&&e.expression.interpolated}const oo=.95047,ao=1.08883,so=4/29,lo=6/29,co=3*lo*lo,uo=lo*lo*lo,ho=Math.PI/180,po=180/Math.PI;function fo(e){return e>uo?Math.pow(e,1/3):e/co+so}function mo(e){return e>lo?e*e*e:co*(e-so)}function _o(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function go(e){return (e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function yo(e){const t=go(e.r),i=go(e.g),n=go(e.b),r=fo((.4124564*t+.3575761*i+.1804375*n)/oo),o=fo((.2126729*t+.7151522*i+.072175*n)/1);return {l:116*o-16,a:500*(r-o),b:200*(o-fo((.0193339*t+.119192*i+.9503041*n)/ao)),alpha:e.a}}function xo(e){let t=(e.l+16)/116,i=isNaN(e.a)?t:t+e.a/500,n=isNaN(e.b)?t:t-e.b/200;return t=1*mo(t),i=oo*mo(i),n=ao*mo(n),new Di(_o(3.2404542*i-1.5371385*t-.4985314*n),_o(-.969266*i+1.8760108*t+.041556*n),_o(.0556434*i-.2040259*t+1.0572252*n),e.alpha)}function vo(e,t,i){const n=t-e;return e+i*(n>180||n<-180?n-360*Math.round(n/360):n)}var wo=Object.freeze({__proto__:null,lab:{forward:yo,reverse:xo,interpolate:function(e,t,i){return {l:pr(e.l,t.l,i),a:pr(e.a,t.a,i),b:pr(e.b,t.b,i),alpha:pr(e.alpha,t.alpha,i)}}},hcl:{forward:function(e){const{l:t,a:i,b:n}=yo(e),r=Math.atan2(n,i)*po;return {h:r<0?r+360:r,c:Math.sqrt(i*i+n*n),l:t,alpha:e.a}},reverse:function(e){const t=e.h*ho,i=e.c;return xo({l:e.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:e.alpha})},interpolate:function(e,t,i){return {h:vo(e.h,t.h,i),c:pr(e.c,t.c,i),l:pr(e.l,t.l,i),alpha:pr(e.alpha,t.alpha,i)}}}});function To(e){return "object"==typeof e&&null!==e&&!Array.isArray(e)}function bo(e){return e}function Po(e,t){const i="color"===t.type,n=e.stops&&"object"==typeof e.stops[0][0],r=n||!(n||void 0!==e.property),o=e.type||(ro(t)?"exponential":"interval");if(i&&((e=Fi({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],Di.parse(e[1])]))),e.default=Di.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!wo[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let a,s,l;if("exponential"===o)a=Co;else if("interval"===o)a=Eo;else if("categorical"===o){a=Ao,s=Object.create(null);for(const t of e.stops)s[t[0]]=t[1];l=typeof e.stops[0][0];}else {if("identity"!==o)throw new Error(`Unknown function type "${o}"`);a=Mo;}if(n){const i={},n=[];for(let t=0;t<e.stops.length;t++){const r=e.stops[t],o=r[0].zoom;void 0===i[o]&&(i[o]={zoom:o,type:e.type,property:e.property,default:e.default,stops:[]},n.push(o)),i[o].stops.push([r[0].value,r[1]]);}const r=[];for(const e of n)r.push([i[e].zoom,Po(i[e],t)]);return {kind:"composite",interpolationFactor:gr.interpolationFactor.bind(void 0,{name:"linear"}),zoomStops:r.map((e=>e[0])),evaluate:({zoom:i},n)=>Co({stops:r,base:e.base},t,i).evaluate(i,n)}}return r?{kind:"camera",interpolationFactor:"exponential"===o?gr.interpolationFactor.bind(void 0,{name:"exponential",base:void 0!==e.base?e.base:1}):()=>0,zoomStops:e.stops.map((e=>e[0])),evaluate:({zoom:i})=>a(e,t,i,s,l)}:{kind:"source",evaluate(i,n){const r=n&&n.properties?n.properties[e.property]:void 0;return void 0===r?So(e.default,t.default):a(e,t,r,s,l)}}}function So(e,t,i){return void 0!==e?e:void 0!==t?t:void 0!==i?i:void 0}function Ao(e,t,i,n,r){return So(typeof i===r?n[i]:void 0,e.default,t.default)}function Eo(e,t,i){if("number"!==In(i))return So(e.default,t.default);const n=e.stops.length;if(1===n)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[n-1][0])return e.stops[n-1][1];const r=Io(e.stops,i);return e.stops[r][1]}function Co(e,t,i){const n=void 0!==e.base?e.base:1;if("number"!==In(i))return So(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[r-1][0])return e.stops[r-1][1];const o=Io(e.stops,i),a=function(e,t,i,n){const r=n-i,o=e-i;return 0===r?0:1===t?o/r:(Math.pow(t,o)-1)/(Math.pow(t,r)-1)}(i,n,e.stops[o][0],e.stops[o+1][0]),s=e.stops[o][1],l=e.stops[o+1][1];let c=fr[t.type]||bo;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=wo[e.colorSpace];c=(e,i)=>t.reverse(t.interpolate(t.forward(e),t.forward(i),a));}return "function"==typeof s.evaluate?{evaluate(...e){const t=s.evaluate.apply(void 0,e),i=l.evaluate.apply(void 0,e);if(void 0!==t&&void 0!==i)return c(t,i,a)}}:c(s,l,a)}function Mo(e,t,i){return "color"===t.type?"x-color"!==t.units&&(i=Di.parse(i)):"formatted"===t.type?i=mn.fromString(i.toString()):"resolvedImage"===t.type?i=_n.fromString(i.toString()):In(i)===t.type||"enum"===t.type&&t.values[i]||(i=void 0),So(i,e.default,t.default)}function Io(e,t){let i,n,r=0,o=e.length-1,a=0;for(;r<=o;){if(a=Math.floor((r+o)/2),i=e[a][0],n=e[a+1][0],t===i||t>i&&t<n)return a;i<t?r=a+1:i>t&&(o=a-1);}return Math.max(a-1,0)}class Lo{constructor(e,t,i){this.expression=e,this._warningHistory={},this._evaluator=new Dn(i),this._defaultValue=t?function(e){return "color"===e.type&&(To(e.default)||Array.isArray(e.default))?new Di(0,0,0,0):"color"===e.type?Di.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null;}evaluateWithoutErrorHandling(e,t,i){return this._evaluator||(this._evaluator=new Dn),this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=i,this.expression.evaluate(this._evaluator)}evaluate(e,t,i,n,r,o){this._evaluator||(this._evaluator=new Dn),this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=i,this._evaluator.canonical=n,this._evaluator.availableImages=r,this._evaluator.formattedSection=o;try{const e=this.expression.evaluate(this._evaluator);if(null==e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new bn(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function No(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in Jr}function Ro(e,t){const i=new lr(Jr,[],t?function(e){const t={color:qi,string:Hi,number:Gi,enum:Hi,boolean:Yi,formatted:$i,resolvedImage:Zi};return "array"===e.type?Ki(t[e.value]||ji,e.length):t[e.type]||null}(t):void 0),n=i.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return n?eo(new Lo(n,t)):to(i.errors)}class Oo{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!nr(t.expression);}evaluateWithoutErrorHandling(e,t,i,n,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,n,r,o)}evaluate(e,t,i,n,r,o){return this._styleExpression.evaluate(e,t,i,n,r,o)}}class Do{constructor(e,t,i){this.kind=e,this.zoomStops=i.labels,this._styleExpression=t,this.isStateDependent="camera"!==e&&!nr(t.expression),i instanceof gr&&(this._interpolationType=i.interpolation);}evaluateWithoutErrorHandling(e,t,i,n,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,n,r,o)}evaluate(e,t,i,n,r,o){return this._styleExpression.evaluate(e,t,i,n,r,o)}interpolationFactor(e,t,i){return this._interpolationType?gr.interpolationFactor(this._interpolationType,e,t,i):0}}function Fo(e,t){if("error"===(e=Ro(e,t)).result)return e;const i=e.value.expression,n=ir(i);if(!n&&!io(t))return to([new Bi("","data expressions not supported")]);const r=rr(i,["zoom"]);if(!r&&!no(t))return to([new Bi("","zoom expressions not supported")]);const o=Vo(i);return o||r?o instanceof Bi?to([o]):o instanceof gr&&!ro(t)?to([new Bi("",'"interpolate" expressions cannot be used with this property')]):eo(o?new Do(n?"camera":"composite",e.value,o):new Oo(n?"constant":"source",e.value)):to([new Bi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class zo{constructor(e,t){this._parameters=e,this._specification=t,Fi(this,Po(this._parameters,this._specification));}static deserialize(e){return new zo(e._parameters,e._specification)}static serialize(e){return {_parameters:e._parameters,_specification:e._specification}}}function Bo(e,t){if(To(e))return new zo(e,t);if(No(e)){const i=Fo(e,t);if("error"===i.result)throw new Error(i.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return i.value}{let i=e;return "string"==typeof e&&"color"===t.type&&(i=Di.parse(e)),{kind:"constant",evaluate:()=>i}}}function Vo(e){let t=null;if(e instanceof wr)t=Vo(e.result);else if(e instanceof xr){for(const i of e.args)if(t=Vo(i),t)break}else (e instanceof dr||e instanceof gr)&&e.input instanceof zn&&"zoom"===e.input.name&&(t=e);return t instanceof Bi||e.eachChild((e=>{const i=Vo(e);i instanceof Bi?t=i:!t&&i?t=new Bi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&i&&t!==i&&(t=new Bi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'));})),t}const{ImageData:Uo,ImageBitmap:ko}=J,Go={};function Ho(e,t,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Go[e]={klass:t,omit:i.omit||[],shallow:i.shallow||[]};}Ho("Object",Object),xi.serialize=function(e,t){const i=e.toArrayBuffer();return t&&t.push(i),i},xi.deserialize=function(e){return new xi(e)},Ho("Grid",xi),Ho("Color",Di),Ho("Error",Error),Ho("StylePropertyFunction",zo),Ho("StyleExpression",Lo,{omit:["_evaluator"]}),Ho("ZoomDependentExpression",Do),Ho("ZoomConstantExpression",Oo),Ho("CompoundExpression",zn,{omit:["_evaluate"]});for(const e in Jr)Jr[e]._classRegistryKey||Ho(`Expression_${e}`,Jr[e]);function Yo(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function qo(e){return ko&&e instanceof ko}function Xo(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||e instanceof J.Blob)return e;if(Yo(e)||qo(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){const i=e;return t&&t.push(i.buffer),i}if(e instanceof Uo)return t&&t.push(e.data.buffer),e;if(o(e)){const i=[];for(const n of e)i.push(Xo(n,t));return i}if("object"==typeof e){const i=e.constructor,n=i._classRegistryKey;if(!n)throw new Error("can't serialize object of unregistered class");const r={};if(i.serialize)r._serialized=i.serialize(e,t);else {for(const i in e){if(!e.hasOwnProperty(i))continue;if(Go[n].omit.indexOf(i)>=0)continue;const o=e[i];r[i]=Go[n].shallow.indexOf(i)>=0?o:Xo(o,t);}e instanceof Error&&(r.message=e.message);}return {name:n,properties:r}}throw new Error("can't serialize object of type "+typeof e)}function jo(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Yo(e)||qo(e)||ArrayBuffer.isView(e)||e instanceof Uo||e instanceof J.Blob)return e;if(Array.isArray(e))return e.map((e=>jo(e)));if("object"==typeof e){const{name:t,properties:i}=e;if(!t)throw new Error("can't deserialize object of anonymous class");const{klass:n}=Go[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(i._serialized);const r=Object.create(n.prototype);for(const e of Object.keys(i))r[e]=Go[t].shallow.indexOf(e)>=0?i[e]:jo(i[e]);return r}throw new Error("can't deserialize object of type "+typeof e)}class Wo extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(e,t){const i=this.length;this.resize(i+1);const n=2*i;return this.int16[n+0]=e,this.int16[n+1]=t,i}emplace(e,t,i){const n=2*e;return this.int16[n+0]=t,this.int16[n+1]=i,e}}Wo.prototype.bytesPerElement=4,Ho("StructArrayLayout2i4",Wo);class $o extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(e,t,i,n){const r=this.length;this.resize(r+1);const o=4*r;return this.int16[o+0]=e,this.int16[o+1]=t,this.int16[o+2]=i,this.int16[o+3]=n,r}emplace(e,t,i,n,r){const o=4*e;return this.int16[o+0]=t,this.int16[o+1]=i,this.int16[o+2]=n,this.int16[o+3]=r,e}}$o.prototype.bytesPerElement=8,Ho("StructArrayLayout4i8",$o);class Zo extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r){const o=this.length;this.resize(o+1);const a=5*o;return this.float32[a+0]=e,this.float32[a+1]=t,this.float32[a+2]=i,this.float32[a+3]=n,this.float32[a+4]=r,o}emplace(e,t,i,n,r,o){const a=5*e;return this.float32[a+0]=t,this.float32[a+1]=i,this.float32[a+2]=n,this.float32[a+3]=r,this.float32[a+4]=o,e}}Zo.prototype.bytesPerElement=20,Ho("StructArrayLayout5f20",Zo);class Ko extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s){const l=this.length;this.resize(l+1);const c=8*l;return this.float32[c+0]=e,this.float32[c+1]=t,this.float32[c+2]=i,this.float32[c+3]=n,this.float32[c+4]=r,this.float32[c+5]=o,this.float32[c+6]=a,this.float32[c+7]=s,l}emplace(e,t,i,n,r,o,a,s,l){const c=8*e;return this.float32[c+0]=t,this.float32[c+1]=i,this.float32[c+2]=n,this.float32[c+3]=r,this.float32[c+4]=o,this.float32[c+5]=a,this.float32[c+6]=s,this.float32[c+7]=l,e}}Ko.prototype.bytesPerElement=32,Ho("StructArrayLayout8f32",Ko);class Qo extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s){const l=this.length;this.resize(l+1);const c=8*l;return this.float32[c+0]=e,this.float32[c+1]=t,this.float32[c+2]=i,this.float32[c+3]=n,this.float32[c+4]=r,this.float32[c+5]=o,this.float32[c+6]=a,this.float32[c+7]=s,l}emplace(e,t,i,n,r,o,a,s,l){const c=8*e;return this.float32[c+0]=t,this.float32[c+1]=i,this.float32[c+2]=n,this.float32[c+3]=r,this.float32[c+4]=o,this.float32[c+5]=a,this.float32[c+6]=s,this.float32[c+7]=l,e}}Qo.prototype.bytesPerElement=32,Ho("StructArrayLayout3f2f3f32",Qo);class Jo extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,_,g,y,x,v){const w=this.length;this.resize(w+1);const T=21*w;return this.float32[T+0]=e,this.float32[T+1]=t,this.float32[T+2]=i,this.float32[T+3]=n,this.float32[T+4]=r,this.float32[T+5]=o,this.float32[T+6]=a,this.float32[T+7]=s,this.float32[T+8]=l,this.float32[T+9]=c,this.float32[T+10]=u,this.float32[T+11]=h,this.float32[T+12]=d,this.float32[T+13]=p,this.float32[T+14]=f,this.float32[T+15]=m,this.float32[T+16]=_,this.float32[T+17]=g,this.float32[T+18]=y,this.float32[T+19]=x,this.float32[T+20]=v,w}emplace(e,t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,_,g,y,x,v,w){const T=21*e;return this.float32[T+0]=t,this.float32[T+1]=i,this.float32[T+2]=n,this.float32[T+3]=r,this.float32[T+4]=o,this.float32[T+5]=a,this.float32[T+6]=s,this.float32[T+7]=l,this.float32[T+8]=c,this.float32[T+9]=u,this.float32[T+10]=h,this.float32[T+11]=d,this.float32[T+12]=p,this.float32[T+13]=f,this.float32[T+14]=m,this.float32[T+15]=_,this.float32[T+16]=g,this.float32[T+17]=y,this.float32[T+18]=x,this.float32[T+19]=v,this.float32[T+20]=w,e}}Jo.prototype.bytesPerElement=84,Ho("StructArrayLayout21f84",Jo);class ea extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,_,g,y,x,v,w){const T=this.length;this.resize(T+1);const b=22*T;return this.float32[b+0]=e,this.float32[b+1]=t,this.float32[b+2]=i,this.float32[b+3]=n,this.float32[b+4]=r,this.float32[b+5]=o,this.float32[b+6]=a,this.float32[b+7]=s,this.float32[b+8]=l,this.float32[b+9]=c,this.float32[b+10]=u,this.float32[b+11]=h,this.float32[b+12]=d,this.float32[b+13]=p,this.float32[b+14]=f,this.float32[b+15]=m,this.float32[b+16]=_,this.float32[b+17]=g,this.float32[b+18]=y,this.float32[b+19]=x,this.float32[b+20]=v,this.float32[b+21]=w,T}emplace(e,t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,_,g,y,x,v,w,T){const b=22*e;return this.float32[b+0]=t,this.float32[b+1]=i,this.float32[b+2]=n,this.float32[b+3]=r,this.float32[b+4]=o,this.float32[b+5]=a,this.float32[b+6]=s,this.float32[b+7]=l,this.float32[b+8]=c,this.float32[b+9]=u,this.float32[b+10]=h,this.float32[b+11]=d,this.float32[b+12]=p,this.float32[b+13]=f,this.float32[b+14]=m,this.float32[b+15]=_,this.float32[b+16]=g,this.float32[b+17]=y,this.float32[b+18]=x,this.float32[b+19]=v,this.float32[b+20]=w,this.float32[b+21]=T,e}}ea.prototype.bytesPerElement=88,Ho("StructArrayLayout22f88",ea);class ta extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,_,g,y,x,v,w,T,b,P,S,A){const E=this.length;this.resize(E+1);const C=27*E;return this.float32[C+0]=e,this.float32[C+1]=t,this.float32[C+2]=i,this.float32[C+3]=n,this.float32[C+4]=r,this.float32[C+5]=o,this.float32[C+6]=a,this.float32[C+7]=s,this.float32[C+8]=l,this.float32[C+9]=c,this.float32[C+10]=u,this.float32[C+11]=h,this.float32[C+12]=d,this.float32[C+13]=p,this.float32[C+14]=f,this.float32[C+15]=m,this.float32[C+16]=_,this.float32[C+17]=g,this.float32[C+18]=y,this.float32[C+19]=x,this.float32[C+20]=v,this.float32[C+21]=w,this.float32[C+22]=T,this.float32[C+23]=b,this.float32[C+24]=P,this.float32[C+25]=S,this.float32[C+26]=A,E}emplace(e,t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,_,g,y,x,v,w,T,b,P,S,A,E){const C=27*e;return this.float32[C+0]=t,this.float32[C+1]=i,this.float32[C+2]=n,this.float32[C+3]=r,this.float32[C+4]=o,this.float32[C+5]=a,this.float32[C+6]=s,this.float32[C+7]=l,this.float32[C+8]=c,this.float32[C+9]=u,this.float32[C+10]=h,this.float32[C+11]=d,this.float32[C+12]=p,this.float32[C+13]=f,this.float32[C+14]=m,this.float32[C+15]=_,this.float32[C+16]=g,this.float32[C+17]=y,this.float32[C+18]=x,this.float32[C+19]=v,this.float32[C+20]=w,this.float32[C+21]=T,this.float32[C+22]=b,this.float32[C+23]=P,this.float32[C+24]=S,this.float32[C+25]=A,this.float32[C+26]=E,e}}ta.prototype.bytesPerElement=108,Ho("StructArrayLayout27f108",ta);class ia extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,_,g,y,x,v,w,T,b,P){const S=this.length;this.resize(S+1);const A=25*S;return this.float32[A+0]=e,this.float32[A+1]=t,this.float32[A+2]=i,this.float32[A+3]=n,this.float32[A+4]=r,this.float32[A+5]=o,this.float32[A+6]=a,this.float32[A+7]=s,this.float32[A+8]=l,this.float32[A+9]=c,this.float32[A+10]=u,this.float32[A+11]=h,this.float32[A+12]=d,this.float32[A+13]=p,this.float32[A+14]=f,this.float32[A+15]=m,this.float32[A+16]=_,this.float32[A+17]=g,this.float32[A+18]=y,this.float32[A+19]=x,this.float32[A+20]=v,this.float32[A+21]=w,this.float32[A+22]=T,this.float32[A+23]=b,this.float32[A+24]=P,S}emplace(e,t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,_,g,y,x,v,w,T,b,P,S){const A=25*e;return this.float32[A+0]=t,this.float32[A+1]=i,this.float32[A+2]=n,this.float32[A+3]=r,this.float32[A+4]=o,this.float32[A+5]=a,this.float32[A+6]=s,this.float32[A+7]=l,this.float32[A+8]=c,this.float32[A+9]=u,this.float32[A+10]=h,this.float32[A+11]=d,this.float32[A+12]=p,this.float32[A+13]=f,this.float32[A+14]=m,this.float32[A+15]=_,this.float32[A+16]=g,this.float32[A+17]=y,this.float32[A+18]=x,this.float32[A+19]=v,this.float32[A+20]=w,this.float32[A+21]=T,this.float32[A+22]=b,this.float32[A+23]=P,this.float32[A+24]=S,e}}ia.prototype.bytesPerElement=100,Ho("StructArrayLayout25f100",ia);class na extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,c,u){const h=this.length;this.resize(h+1);const d=11*h;return this.float32[d+0]=e,this.float32[d+1]=t,this.float32[d+2]=i,this.float32[d+3]=n,this.float32[d+4]=r,this.float32[d+5]=o,this.float32[d+6]=a,this.float32[d+7]=s,this.float32[d+8]=l,this.float32[d+9]=c,this.float32[d+10]=u,h}emplace(e,t,i,n,r,o,a,s,l,c,u,h){const d=11*e;return this.float32[d+0]=t,this.float32[d+1]=i,this.float32[d+2]=n,this.float32[d+3]=r,this.float32[d+4]=o,this.float32[d+5]=a,this.float32[d+6]=s,this.float32[d+7]=l,this.float32[d+8]=c,this.float32[d+9]=u,this.float32[d+10]=h,e}}na.prototype.bytesPerElement=44,Ho("StructArrayLayout11f44",na);class ra extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o){const a=this.length;this.resize(a+1);const s=6*a;return this.float32[s+0]=e,this.float32[s+1]=t,this.float32[s+2]=i,this.float32[s+3]=n,this.float32[s+4]=r,this.float32[s+5]=o,a}emplace(e,t,i,n,r,o,a){const s=6*e;return this.float32[s+0]=t,this.float32[s+1]=i,this.float32[s+2]=n,this.float32[s+3]=r,this.float32[s+4]=o,this.float32[s+5]=a,e}}ra.prototype.bytesPerElement=24,Ho("StructArrayLayout3f3f24",ra);class oa extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int8=new Int8Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r){const o=this.length;this.resize(o+1);const a=4*o,s=16*o;return this.float32[a+0]=e,this.float32[a+1]=t,this.float32[a+2]=i,this.int8[s+12]=n,this.int8[s+13]=r,o}emplace(e,t,i,n,r,o){const a=4*e,s=16*e;return this.float32[a+0]=t,this.float32[a+1]=i,this.float32[a+2]=n,this.int8[s+12]=r,this.int8[s+13]=o,e}}oa.prototype.bytesPerElement=16,Ho("StructArrayLayout3f2b16",oa);class aa extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l){const c=this.length;this.resize(c+1);const u=9*c;return this.float32[u+0]=e,this.float32[u+1]=t,this.float32[u+2]=i,this.float32[u+3]=n,this.float32[u+4]=r,this.float32[u+5]=o,this.float32[u+6]=a,this.float32[u+7]=s,this.float32[u+8]=l,c}emplace(e,t,i,n,r,o,a,s,l,c){const u=9*e;return this.float32[u+0]=t,this.float32[u+1]=i,this.float32[u+2]=n,this.float32[u+3]=r,this.float32[u+4]=o,this.float32[u+5]=a,this.float32[u+6]=s,this.float32[u+7]=l,this.float32[u+8]=c,e}}aa.prototype.bytesPerElement=36,Ho("StructArrayLayout3f3f3f36",aa);class sa extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s){const l=this.length;this.resize(l+1);const c=8*l;return this.float32[c+0]=e,this.float32[c+1]=t,this.float32[c+2]=i,this.float32[c+3]=n,this.float32[c+4]=r,this.float32[c+5]=o,this.float32[c+6]=a,this.float32[c+7]=s,l}emplace(e,t,i,n,r,o,a,s,l){const c=8*e;return this.float32[c+0]=t,this.float32[c+1]=i,this.float32[c+2]=n,this.float32[c+3]=r,this.float32[c+4]=o,this.float32[c+5]=a,this.float32[c+6]=s,this.float32[c+7]=l,e}}sa.prototype.bytesPerElement=32,Ho("StructArrayLayout1f1f3f3f32",sa);class la extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,c){const u=this.length;this.resize(u+1);const h=4*u,d=16*u;return this.float32[h+0]=e,this.float32[h+1]=t,this.uint8[d+8]=i,this.uint8[d+9]=n,this.uint8[d+10]=r,this.uint8[d+11]=o,this.uint8[d+12]=a,this.uint8[d+13]=s,this.uint8[d+14]=l,this.uint8[d+15]=c,u}emplace(e,t,i,n,r,o,a,s,l,c,u){const h=4*e,d=16*e;return this.float32[h+0]=t,this.float32[h+1]=i,this.uint8[d+8]=n,this.uint8[d+9]=r,this.uint8[d+10]=o,this.uint8[d+11]=a,this.uint8[d+12]=s,this.uint8[d+13]=l,this.uint8[d+14]=c,this.uint8[d+15]=u,e}}la.prototype.bytesPerElement=16,Ho("StructArrayLayout2f8ub16",la);class ca extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int8=new Int8Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,c,u,h){const d=this.length;this.resize(d+1);const p=6*d,f=24*d;return this.float32[p+0]=e,this.float32[p+1]=t,this.float32[p+2]=i,this.int8[f+12]=n,this.int8[f+13]=r,this.uint8[f+16]=o,this.uint8[f+17]=a,this.uint8[f+18]=s,this.uint8[f+19]=l,this.uint8[f+20]=c,this.uint8[f+21]=u,this.uint8[f+22]=h,d}emplace(e,t,i,n,r,o,a,s,l,c,u,h,d){const p=6*e,f=24*e;return this.float32[p+0]=t,this.float32[p+1]=i,this.float32[p+2]=n,this.int8[f+12]=r,this.int8[f+13]=o,this.uint8[f+16]=a,this.uint8[f+17]=s,this.uint8[f+18]=l,this.uint8[f+19]=c,this.uint8[f+20]=u,this.uint8[f+21]=h,this.uint8[f+22]=d,e}}ca.prototype.bytesPerElement=24,Ho("StructArrayLayout3f2b4ub3ub24",ca);class ua extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,c,u,h){const d=this.length;this.resize(d+1);const p=7*d,f=28*d,m=14*d;return this.float32[p+0]=e,this.float32[p+1]=t,this.float32[p+2]=i,this.uint8[f+12]=n,this.uint8[f+16]=r,this.uint8[f+17]=o,this.uint8[f+18]=a,this.uint8[f+19]=s,this.uint8[f+20]=l,this.uint8[f+21]=c,this.int16[m+12]=u,this.int16[m+13]=h,d}emplace(e,t,i,n,r,o,a,s,l,c,u,h,d){const p=7*e,f=28*e,m=14*e;return this.float32[p+0]=t,this.float32[p+1]=i,this.float32[p+2]=n,this.uint8[f+12]=r,this.uint8[f+16]=o,this.uint8[f+17]=a,this.uint8[f+18]=s,this.uint8[f+19]=l,this.uint8[f+20]=c,this.uint8[f+21]=u,this.int16[m+12]=h,this.int16[m+13]=d,e}}ua.prototype.bytesPerElement=28,Ho("StructArrayLayout3f1ub4ub2ub2i28",ua);class ha extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,c){const u=this.length;this.resize(u+1);const h=10*u;return this.uint16[h+0]=e,this.uint16[h+1]=t,this.uint16[h+2]=i,this.uint16[h+3]=n,this.uint16[h+4]=r,this.uint16[h+5]=o,this.uint16[h+6]=a,this.uint16[h+7]=s,this.uint16[h+8]=l,this.uint16[h+9]=c,u}emplace(e,t,i,n,r,o,a,s,l,c,u){const h=10*e;return this.uint16[h+0]=t,this.uint16[h+1]=i,this.uint16[h+2]=n,this.uint16[h+3]=r,this.uint16[h+4]=o,this.uint16[h+5]=a,this.uint16[h+6]=s,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,e}}ha.prototype.bytesPerElement=20,Ho("StructArrayLayout10ui20",ha);class da extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,c,u){const h=this.length;this.resize(h+1);const d=7*h,p=28*h,f=14*h;return this.float32[d+0]=e,this.float32[d+1]=t,this.float32[d+2]=i,this.uint8[p+12]=n,this.uint8[p+16]=r,this.uint8[p+17]=o,this.uint8[p+18]=a,this.uint8[p+19]=s,this.uint16[f+10]=l,this.uint16[f+12]=c,this.uint16[f+13]=u,h}emplace(e,t,i,n,r,o,a,s,l,c,u,h){const d=7*e,p=28*e,f=14*e;return this.float32[d+0]=t,this.float32[d+1]=i,this.float32[d+2]=n,this.uint8[p+12]=r,this.uint8[p+16]=o,this.uint8[p+17]=a,this.uint8[p+18]=s,this.uint8[p+19]=l,this.uint16[f+10]=c,this.uint16[f+12]=u,this.uint16[f+13]=h,e}}da.prototype.bytesPerElement=28,Ho("StructArrayLayout3f1ub4ub1ui2ui28",da);class pa extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r){const o=this.length;this.resize(o+1);const a=5*o;return this.float32[a+0]=e,this.float32[a+1]=t,this.float32[a+2]=i,this.float32[a+3]=n,this.float32[a+4]=r,o}emplace(e,t,i,n,r,o){const a=5*e;return this.float32[a+0]=t,this.float32[a+1]=i,this.float32[a+2]=n,this.float32[a+3]=r,this.float32[a+4]=o,e}}pa.prototype.bytesPerElement=20,Ho("StructArrayLayout3f2f20",pa);class fa extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int8=new Int8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,c){const u=this.length;this.resize(u+1);const h=6*u,d=24*u,p=12*u;return this.float32[h+0]=e,this.float32[h+1]=t,this.float32[h+2]=i,this.int8[d+12]=n,this.int8[d+13]=r,this.uint8[d+16]=o,this.uint8[d+17]=a,this.uint8[d+18]=s,this.uint8[d+19]=l,this.uint16[p+10]=c,u}emplace(e,t,i,n,r,o,a,s,l,c,u){const h=6*e,d=24*e,p=12*e;return this.float32[h+0]=t,this.float32[h+1]=i,this.float32[h+2]=n,this.int8[d+12]=r,this.int8[d+13]=o,this.uint8[d+16]=a,this.uint8[d+17]=s,this.uint8[d+18]=l,this.uint8[d+19]=c,this.uint16[p+10]=u,e}}fa.prototype.bytesPerElement=24,Ho("StructArrayLayout3f2b4ub1ui24",fa);class ma extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i){const n=this.length;this.resize(n+1);const r=3*n;return this.float32[r+0]=e,this.float32[r+1]=t,this.float32[r+2]=i,n}emplace(e,t,i,n){const r=3*e;return this.float32[r+0]=t,this.float32[r+1]=i,this.float32[r+2]=n,e}}ma.prototype.bytesPerElement=12,Ho("StructArrayLayout1f1f1f12",ma);class _a extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r){const o=this.length;this.resize(o+1);const a=4*o,s=8*o;return this.float32[a+0]=e,this.float32[a+1]=t,this.float32[a+2]=i,this.int16[s+6]=n,this.int16[s+7]=r,o}emplace(e,t,i,n,r,o){const a=4*e,s=8*e;return this.float32[a+0]=t,this.float32[a+1]=i,this.float32[a+2]=n,this.int16[s+6]=r,this.int16[s+7]=o,e}}_a.prototype.bytesPerElement=16,Ho("StructArrayLayout3f2i16",_a);class ga extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i){const n=this.length;this.resize(n+1);const r=3*n;return this.float32[r+0]=e,this.float32[r+1]=t,this.float32[r+2]=i,n}emplace(e,t,i,n){const r=3*e;return this.float32[r+0]=t,this.float32[r+1]=i,this.float32[r+2]=n,e}}ga.prototype.bytesPerElement=12,Ho("StructArrayLayout3f12",ga);class ya extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t){const i=this.length;this.resize(i+1);const n=2*i;return this.float32[n+0]=e,this.float32[n+1]=t,i}emplace(e,t,i){const n=2*e;return this.float32[n+0]=t,this.float32[n+1]=i,e}}ya.prototype.bytesPerElement=8,Ho("StructArrayLayout2f8",ya);class xa extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l){const c=this.length;this.resize(c+1);const u=6*c,h=24*c;return this.float32[u+0]=e,this.float32[u+1]=t,this.float32[u+2]=i,this.float32[u+3]=n,this.float32[u+4]=r,this.uint8[h+20]=o,this.uint8[h+21]=a,this.uint8[h+22]=s,this.uint8[h+23]=l,c}emplace(e,t,i,n,r,o,a,s,l,c){const u=6*e,h=24*e;return this.float32[u+0]=t,this.float32[u+1]=i,this.float32[u+2]=n,this.float32[u+3]=r,this.float32[u+4]=o,this.uint8[h+20]=a,this.uint8[h+21]=s,this.uint8[h+22]=l,this.uint8[h+23]=c,e}}xa.prototype.bytesPerElement=24,Ho("StructArrayLayout3f2f4ub24",xa);class va extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer);}emplaceBack(e){const t=this.length;return this.resize(t+1),this.uint32[1*t+0]=e,t}emplace(e,t){return this.uint32[1*e+0]=t,e}}va.prototype.bytesPerElement=4,Ho("StructArrayLayout1ul4",va);class wa extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,c,u){const h=this.length;this.resize(h+1);const d=12*h,p=6*h;return this.int16[d+0]=e,this.int16[d+1]=t,this.int16[d+2]=i,this.int16[d+3]=n,this.int16[d+4]=r,this.int16[d+5]=o,this.uint32[p+3]=a,this.uint16[d+8]=s,this.uint16[d+9]=l,this.int16[d+10]=c,this.int16[d+11]=u,h}emplace(e,t,i,n,r,o,a,s,l,c,u,h){const d=12*e,p=6*e;return this.int16[d+0]=t,this.int16[d+1]=i,this.int16[d+2]=n,this.int16[d+3]=r,this.int16[d+4]=o,this.int16[d+5]=a,this.uint32[p+3]=s,this.uint16[d+8]=l,this.uint16[d+9]=c,this.int16[d+10]=u,this.int16[d+11]=h,e}}wa.prototype.bytesPerElement=24,Ho("StructArrayLayout6i1ul2ui2i24",wa);class Ta extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer);}emplaceBack(e,t){const i=this.length;this.resize(i+1);const n=4*i;return this.uint8[n+0]=e,this.uint8[n+1]=t,i}emplace(e,t,i){const n=4*e;return this.uint8[n+0]=t,this.uint8[n+1]=i,e}}Ta.prototype.bytesPerElement=4,Ho("StructArrayLayout2ub4",Ta);class ba extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,c,u,h,d,p){const f=this.length;this.resize(f+1);const m=20*f,_=10*f,g=40*f;return this.int16[m+0]=e,this.int16[m+1]=t,this.uint16[m+2]=i,this.uint16[m+3]=n,this.uint32[_+2]=r,this.uint32[_+3]=o,this.uint32[_+4]=a,this.uint16[m+10]=s,this.uint16[m+11]=l,this.uint16[m+12]=c,this.float32[_+7]=u,this.float32[_+8]=h,this.uint8[g+36]=d,this.uint8[g+37]=p,f}emplace(e,t,i,n,r,o,a,s,l,c,u,h,d,p,f){const m=20*e,_=10*e,g=40*e;return this.int16[m+0]=t,this.int16[m+1]=i,this.uint16[m+2]=n,this.uint16[m+3]=r,this.uint32[_+2]=o,this.uint32[_+3]=a,this.uint32[_+4]=s,this.uint16[m+10]=l,this.uint16[m+11]=c,this.uint16[m+12]=u,this.float32[_+7]=h,this.float32[_+8]=d,this.uint8[g+36]=p,this.uint8[g+37]=f,e}}ba.prototype.bytesPerElement=40,Ho("StructArrayLayout2i2ui3ul3ui2f2ub40",ba);class Pa extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e){const t=this.length;return this.resize(t+1),this.float32[1*t+0]=e,t}emplace(e,t){return this.float32[1*e+0]=t,e}}Pa.prototype.bytesPerElement=4,Ho("StructArrayLayout1f4",Pa);class Sa extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(e,t,i){const n=this.length;this.resize(n+1);const r=3*n;return this.int16[r+0]=e,this.int16[r+1]=t,this.int16[r+2]=i,n}emplace(e,t,i,n){const r=3*e;return this.int16[r+0]=t,this.int16[r+1]=i,this.int16[r+2]=n,e}}Sa.prototype.bytesPerElement=6,Ho("StructArrayLayout3i6",Sa);class Aa extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l){const c=this.length;this.resize(c+1);const u=6*c,h=12*c;return this.float32[u+0]=e,this.float32[u+1]=t,this.float32[u+2]=i,this.int16[h+6]=n,this.int16[h+7]=r,this.uint16[h+8]=o,this.uint16[h+9]=a,this.uint16[h+10]=s,this.uint16[h+11]=l,c}emplace(e,t,i,n,r,o,a,s,l,c){const u=6*e,h=12*e;return this.float32[u+0]=t,this.float32[u+1]=i,this.float32[u+2]=n,this.int16[h+6]=r,this.int16[h+7]=o,this.uint16[h+8]=a,this.uint16[h+9]=s,this.uint16[h+10]=l,this.uint16[h+11]=c,e}}Aa.prototype.bytesPerElement=24,Ho("StructArrayLayout3f2i4ui24",Aa);class Ea extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a){const s=this.length;this.resize(s+1);const l=5*s,c=10*s;return this.float32[l+0]=e,this.float32[l+1]=t,this.float32[l+2]=i,this.int16[c+6]=n,this.int16[c+7]=r,this.int16[c+8]=o,this.int16[c+9]=a,s}emplace(e,t,i,n,r,o,a,s){const l=5*e,c=10*e;return this.float32[l+0]=t,this.float32[l+1]=i,this.float32[l+2]=n,this.int16[c+6]=r,this.int16[c+7]=o,this.int16[c+8]=a,this.int16[c+9]=s,e}}Ea.prototype.bytesPerElement=20,Ho("StructArrayLayout3f2i2i20",Ea);class Ca extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,c,u,h){const d=this.length;this.resize(d+1);const p=8*d,f=16*d;return this.float32[p+0]=e,this.float32[p+1]=t,this.float32[p+2]=i,this.int16[f+6]=n,this.int16[f+7]=r,this.uint16[f+8]=o,this.uint16[f+9]=a,this.uint16[f+10]=s,this.uint16[f+11]=l,this.uint16[f+12]=c,this.uint16[f+13]=u,this.uint16[f+14]=h,d}emplace(e,t,i,n,r,o,a,s,l,c,u,h,d){const p=8*e,f=16*e;return this.float32[p+0]=t,this.float32[p+1]=i,this.float32[p+2]=n,this.int16[f+6]=r,this.int16[f+7]=o,this.uint16[f+8]=a,this.uint16[f+9]=s,this.uint16[f+10]=l,this.uint16[f+11]=c,this.uint16[f+12]=u,this.uint16[f+13]=h,this.uint16[f+14]=d,e}}Ca.prototype.bytesPerElement=32,Ho("StructArrayLayout3f2i7ui32",Ca);class Ma extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(e,t,i){const n=this.length;this.resize(n+1);const r=4*n;return this.uint32[2*n+0]=e,this.uint16[r+2]=t,this.uint16[r+3]=i,n}emplace(e,t,i,n){const r=4*e;return this.uint32[2*e+0]=t,this.uint16[r+2]=i,this.uint16[r+3]=n,e}}Ma.prototype.bytesPerElement=8,Ho("StructArrayLayout1ul2ui8",Ma);class Ia extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(e,t,i){const n=this.length;this.resize(n+1);const r=3*n;return this.uint16[r+0]=e,this.uint16[r+1]=t,this.uint16[r+2]=i,n}emplace(e,t,i,n){const r=3*e;return this.uint16[r+0]=t,this.uint16[r+1]=i,this.uint16[r+2]=n,e}}Ia.prototype.bytesPerElement=6,Ho("StructArrayLayout3ui6",Ia);class La extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer);}emplaceBack(e,t,i){const n=this.length;this.resize(n+1);const r=3*n;return this.uint32[r+0]=e,this.uint32[r+1]=t,this.uint32[r+2]=i,n}emplace(e,t,i,n){const r=3*e;return this.uint32[r+0]=t,this.uint32[r+1]=i,this.uint32[r+2]=n,e}}La.prototype.bytesPerElement=12,Ho("StructArrayLayout3ul12",La);class Na extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(e,t){const i=this.length;this.resize(i+1);const n=2*i;return this.uint16[n+0]=e,this.uint16[n+1]=t,i}emplace(e,t,i){const n=2*e;return this.uint16[n+0]=t,this.uint16[n+1]=i,e}}Na.prototype.bytesPerElement=4,Ho("StructArrayLayout2ui4",Na);class Ra extends _i{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n){const r=this.length;this.resize(r+1);const o=4*r;return this.float32[o+0]=e,this.float32[o+1]=t,this.float32[o+2]=i,this.float32[o+3]=n,r}emplace(e,t,i,n,r){const o=4*e;return this.float32[o+0]=t,this.float32[o+1]=i,this.float32[o+2]=n,this.float32[o+3]=r,e}}Ra.prototype.bytesPerElement=16,Ho("StructArrayLayout4f16",Ra);class Oa extends mi{get anchorPointX(){return this._structArray.int16[this._pos2+0]}set anchorPointX(e){this._structArray.int16[this._pos2+0]=e;}get anchorPointY(){return this._structArray.int16[this._pos2+1]}set anchorPointY(e){this._structArray.int16[this._pos2+1]=e;}get x1(){return this._structArray.int16[this._pos2+2]}set x1(e){this._structArray.int16[this._pos2+2]=e;}get y1(){return this._structArray.int16[this._pos2+3]}set y1(e){this._structArray.int16[this._pos2+3]=e;}get x2(){return this._structArray.int16[this._pos2+4]}set x2(e){this._structArray.int16[this._pos2+4]=e;}get y2(){return this._structArray.int16[this._pos2+5]}set y2(e){this._structArray.int16[this._pos2+5]=e;}get featureIndex(){return this._structArray.uint32[this._pos4+3]}set featureIndex(e){this._structArray.uint32[this._pos4+3]=e;}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}set sourceLayerIndex(e){this._structArray.uint16[this._pos2+8]=e;}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}set bucketIndex(e){this._structArray.uint16[this._pos2+9]=e;}get radius(){return this._structArray.int16[this._pos2+10]}set radius(e){this._structArray.int16[this._pos2+10]=e;}get signedDistanceFromAnchor(){return this._structArray.int16[this._pos2+11]}set signedDistanceFromAnchor(e){this._structArray.int16[this._pos2+11]=e;}get anchorPoint(){return new te(this.anchorPointX,this.anchorPointY)}}Oa.prototype.size=24;class Da extends wa{get(e){return new Oa(this,e)}}Ho("CollisionBoxArray",Da);class Fa extends mi{get anchorX(){return this._structArray.int16[this._pos2+0]}set anchorX(e){this._structArray.int16[this._pos2+0]=e;}get anchorY(){return this._structArray.int16[this._pos2+1]}set anchorY(e){this._structArray.int16[this._pos2+1]=e;}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}set glyphStartIndex(e){this._structArray.uint16[this._pos2+2]=e;}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}set numGlyphs(e){this._structArray.uint16[this._pos2+3]=e;}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}set vertexStartIndex(e){this._structArray.uint32[this._pos4+2]=e;}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}set lineStartIndex(e){this._structArray.uint32[this._pos4+3]=e;}get lineLength(){return this._structArray.uint32[this._pos4+4]}set lineLength(e){this._structArray.uint32[this._pos4+4]=e;}get segment(){return this._structArray.uint16[this._pos2+10]}set segment(e){this._structArray.uint16[this._pos2+10]=e;}get lowerSize(){return this._structArray.uint16[this._pos2+11]}set lowerSize(e){this._structArray.uint16[this._pos2+11]=e;}get upperSize(){return this._structArray.uint16[this._pos2+12]}set upperSize(e){this._structArray.uint16[this._pos2+12]=e;}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}set lineOffsetX(e){this._structArray.float32[this._pos4+7]=e;}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}set lineOffsetY(e){this._structArray.float32[this._pos4+8]=e;}get writingMode(){return this._structArray.uint8[this._pos1+36]}set writingMode(e){this._structArray.uint8[this._pos1+36]=e;}get hidden(){return this._structArray.uint8[this._pos1+37]}set hidden(e){this._structArray.uint8[this._pos1+37]=e;}}Fa.prototype.size=40;class za extends ba{get(e){return new Fa(this,e)}}Ho("PlacedSymbolArray",za);class Ba extends mi{get offsetX(){return this._structArray.float32[this._pos4+0]}set offsetX(e){this._structArray.float32[this._pos4+0]=e;}}Ba.prototype.size=4;class Va extends Pa{getoffsetX(e){return this.float32[1*e+0]}get(e){return new Ba(this,e)}}Ho("GlyphOffsetArray",Va);class Ua extends mi{get x(){return this._structArray.int16[this._pos2+0]}set x(e){this._structArray.int16[this._pos2+0]=e;}get y(){return this._structArray.int16[this._pos2+1]}set y(e){this._structArray.int16[this._pos2+1]=e;}get tileUnitDistanceFromAnchor(){return this._structArray.int16[this._pos2+2]}set tileUnitDistanceFromAnchor(e){this._structArray.int16[this._pos2+2]=e;}}Ua.prototype.size=6;class ka extends Sa{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}get(e){return new Ua(this,e)}}Ho("SymbolLineVertexArray",ka);class Ga extends mi{get featureIndex(){return this._structArray.uint32[this._pos4+0]}set featureIndex(e){this._structArray.uint32[this._pos4+0]=e;}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}set sourceLayerIndex(e){this._structArray.uint16[this._pos2+2]=e;}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}set bucketIndex(e){this._structArray.uint16[this._pos2+3]=e;}}Ga.prototype.size=8;class Ha extends Ma{get(e){return new Ga(this,e)}}Ho("FeatureIndexArray",Ha);const Ya={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};Object.freeze(Ya);const qa=new ft,Xa=new ft;class ja{constructor(e=[0,0,1],t=0){this.normal=new ft,this.distance=-0,this.fromNormalDistance(e,t);}fromNormalDistance(e,t){return this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=qa.from(e),this.normal.from(t).normalize();const i=-this.normal.dot(e);return this.distance=i,this}fromCoefficients(e,t,i,n){return this.normal.set(e,t,i),this.distance=n,this}clone(){return new ja(this.normal,this.distance)}equals(e){return c(this.distance,e.distance)&&c(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=Xa.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,t)}projectPointOntoPlane(e,t=[0,0,0]){e=qa.from(e);const i=this.getPointDistance(e),n=Xa.copy(this.normal).scale(i);return e.subtract(n).to(t)}static fromPointNormal(e,t,i){const n=-ft.dot(t,e);return $(i)?(ft.clone(t,i.normal),i.distance=n,i):new ja(t,n)}static fromCartesian4(e,t){const i=new ft,n=ft.fromCartesian4(e,i),r=e.w;return $(t)?(ft.clone(n,t.normal),t.distance=r,t):new ja(n,r)}static getPointDistance(e,t){return ft.dot(e.normal,t)+e.distance}static projectPointOntoPlane(e,t,i){const n=new ft;$(i)||(i=new ft);const r=ja.getPointDistance(e,t),o=ft.multiplyByScalar(e.normal,r,n);return ft.subtract(t,o,i)}static transform(e,t,i){const n=new Ot,r=new wt,o=new ft,a=e.normal,s=e.distance,l=Ot.inverseTranspose(t,n);let c=wt.fromElements(a.x,a.y,a.z,s,r);c=Ot.multiplyByVector(l,c,c);const u=ft.fromCartesian4(c,o);return c=wt.divideByScalar(c,ft.magnitude(u),c),ja.fromCartesian4(c,i)}static clone(e,t){return $(t)?(ft.clone(e.normal,t.normal),t.distance=e.distance,t):new ja(e.normal,e.distance)}static equals(e,t){return e.distance===t.distance&&ft.equals(e.normal,t.normal)}}const Wa=[new ft(1,0,0),new ft(0,1,0),new ft(0,0,1)],$a=new ft,Za=new ft;new ja(new ft(1,0,0),0);class Ka{static get MASK_OUTSIDE(){return 4294967295}static get MASK_INSIDE(){return 0}static get MASK_INDETERMINATE(){return 2147483647}constructor(e=[]){this.planes=e;}fromBoundingSphere(e){this.planes.length=2*Wa.length;const t=e.center,i=e.radius;let n=0;for(const e of Wa){let r=this.planes[n],o=this.planes[n+1];r||(r=this.planes[n]=new ja),o||(o=this.planes[n+1]=new ja);const a=$a.copy(e).scale(-i).add(t);e.dot(a),r.fromPointNormal(a,e);const s=$a.copy(e).scale(i).add(t),l=Za.copy(e).negate();l.dot(s),o.fromPointNormal(s,l),n+=2;}return this}computeVisibility(e){let t=Ya.INSIDE;for(let i=0;i<6;i++)switch(e.intersectPlane(this.planes[i])){case Ya.OUTSIDE:return Ya.OUTSIDE;case Ya.INTERSECTING:t=Ya.INTERSECTING;}return t}computeVisibilityWithPlaneMask(e,t){if(t===Ka.MASK_OUTSIDE||t===Ka.MASK_INSIDE)return t;let i=Ka.MASK_INSIDE;const n=this.planes;for(let r=0;r<this.planes.length;++r){const o=r<31?1<<r:0;if(r<31&&0==(t&o))continue;const a=e.intersectPlane(n[r]);if(a===Ya.OUTSIDE)return Ka.MASK_OUTSIDE;a===Ya.INTERSECTING&&(i|=o);}return i}}const Qa=new ft,Ja=new ft,es=new ft,ts=new ft,is=new ft;class ns{constructor(e={}){e={near:1,far:5e8,...e},this.left=e.left,this._left=void 0,this.right=e.right,this._right=void 0,this.top=e.top,this._top=void 0,this.bottom=e.bottom,this._bottom=void 0,this.near=e.near,this._near=this.near,this.far=e.far,this._far=this.far,this._cullingVolume=new Ka([new ja,new ja,new ja,new ja,new ja,new ja]),this._perspectiveMatrix=new Ot,this._infinitePerspective=new Ot;}clone(e){return $(e)||(e=new ns),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e._left=void 0,e._right=void 0,e._top=void 0,e._bottom=void 0,e._near=void 0,e._far=void 0,e}equals(e){return e&&e instanceof ns&&this.right===e.right&&this.left===e.left&&this.top===e.top&&this.bottom===e.bottom&&this.near===e.near&&this.far===e.far}equalsEpsilon(e,t,i){return e===this||$(e)&&e instanceof ns&&nt.CesiumMath.equalsEpsilon(this.right,e.right,t,i)&&nt.CesiumMath.equalsEpsilon(this.left,e.left,t,i)&&nt.CesiumMath.equalsEpsilon(this.top,e.top,t,i)&&nt.CesiumMath.equalsEpsilon(this.bottom,e.bottom,t,i)&&nt.CesiumMath.equalsEpsilon(this.near,e.near,t,i)&&nt.CesiumMath.equalsEpsilon(this.far,e.far,t,i)}get projectionMatrix(){return rs(this),this._perspectiveMatrix}get infiniteProjectionMatrix(){return rs(this),this._infinitePerspective}computeCullingVolume(e,t,i){const n=this._cullingVolume.planes;i=Qa.copy(i).normalize();const r=Ja.copy(t).cross(i).normalize(),o=es.copy(t).multiplyByScalar(this.near).add(e),a=ts.copy(t).multiplyByScalar(this.far).add(e);let s=is;return s.copy(r).multiplyByScalar(this.left).add(o).subtract(e).cross(i),n[0].fromPointNormal(e,s),s.copy(r).multiplyByScalar(this.right).add(o).subtract(e).cross(i).negate(),n[1].fromPointNormal(e,s),s.copy(i).multiplyByScalar(this.bottom).add(o).subtract(e).cross(r).negate(),n[2].fromPointNormal(e,s),s.copy(i).multiplyByScalar(this.top).add(o).subtract(e).cross(r),n[3].fromPointNormal(e,s),s=(new ft).copy(t),n[4].fromPointNormal(o,s),s.negate(),n[5].fromPointNormal(a,s),this._cullingVolume}setFromMatrix(e){const t=this._cullingVolume.planes,i=e[0],n=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],_=e[14],g=e[15];t[0].fromNormalDistance([o-i,c-a,p-u],g-f),t[1].fromNormalDistance([o+i,c+a,p+u],g+f),t[2].fromNormalDistance([o+n,c+s,p+h],g+m),t[3].fromNormalDistance([o-n,c-s,p-h],g-m),t[4].fromNormalDistance([o-r,c-l,p-d],g-_),t[5].fromNormalDistance([o+r,c+l,p+d],g+_);}getPixelDimensions(e,t,i,n){rs(this);const r=1/this.near;let o=this.top*r;const a=2*i*o/t;return o=this.right*r,n.x=2*i*o/e,n.y=a,n}}function rs(e){const{top:t,bottom:i,right:n,left:r,near:o,far:a}=e;t===e._top&&i===e._bottom&&r===e._left&&n===e._right&&o===e._near&&a===e._far||(e._left=r,e._right=n,e._top=t,e._bottom=i,e._near=o,e._far=a,e._perspectiveMatrix=(new Ot).frustum({left:r,right:n,bottom:i,top:t,near:o,far:a}),e._infinitePerspective=(new Ot).frustum({left:r,right:n,bottom:i,top:t,near:o,far:1/0}));}const os=new ft,as=new ft,ss=new ft,ls=new ft;class cs{constructor(e){e=Z(e,Z.EMPTY_OBJECT),this.left=e.left,this._left=void 0,this.right=e.right,this._right=void 0,this.top=e.top,this._top=void 0,this.bottom=e.bottom,this._bottom=void 0,this.near=Z(e.near,1),this._near=this.near,this.far=Z(e.far,5e8),this._far=this.far,this._cullingVolume=new Ka([new ja,new ja,new ja,new ja,new ja,new ja]),this._orthographicMatrix=new Ot;}get projectionMatrix(){return us(this),this._orthographicMatrix}computeCullingVolume(e,t,i){const n=this._cullingVolume.planes,r=this.top,o=this.bottom,a=this.right,s=this.left,l=this.near,c=this.far,u=os.copy(t).cross(i);u.normalize();const h=as;h.copy(t).multiplyByScalar(l),h.add(e);const d=ss;d.copy(u).multiplyByScalar(s),d.add(h);let p=n[0];$(p)||(p=n[0]=new ja);let f=-u.dot(d);return p.fromCoefficients(u[0],u[1],u[2],f),d.copy(u).multiplyByScalar(a),d.add(h),p=n[1],$(p)||(p=n[1]=new ja),f=-ls.copy(u).negate().dot(d),p.fromCoefficients(-u[0],-u[1],-u[2],f),d.copy(i).multiplyByScalar(o),d.add(h),p=n[2],$(p)||(p=n[2]=new ja),f=-i.dot(d),ft.normalize(i,i),p.fromCoefficients(i[0],i[1],i[2],f),d.copy(i).multiplyByScalar(r),d.add(h),p=n[3],$(p)||(p=n[3]=new ja),f=-ls.copy(i).negate().dot(d),p.fromCoefficients(-i[0],-i[1],-i[2],f),p=n[4],$(p)||(p=n[4]=new ja),f=-t.dot(h),ft.normalize(t,t),p.fromCoefficients(t[0],t[1],t[2],f),d.copy(t).multiplyByScalar(c),d.add(e),p=n[5],$(p)||(p=n[5]=new ja),f=-ls.copy(t).negate().dot(d),p.fromCoefficients(-t[0],-t[1],-t[2],f),this._cullingVolume}getPixelDimensions(e,t,i,n,r){us(this);const o=n*(this.top-this.bottom)/t;return r.x=n*(this.right-this.left)/e,r.y=o,r}clone(e){return $(e)||(e=new cs),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e._left=void 0,e._right=void 0,e._top=void 0,e._bottom=void 0,e._near=void 0,e._far=void 0,e}equals(e){return $(e)&&e instanceof cs&&this.right===e.right&&this.left===e.left&&this.top===e.top&&this.bottom===e.bottom&&this.near===e.near&&this.far===e.far}equalsEpsilon(e,t,i){return e===this||$(e)&&e instanceof cs&&nt.CesiumMath.equalsEpsilon(this.right,e.right,t,i)&&nt.CesiumMath.equalsEpsilon(this.left,e.left,t,i)&&nt.CesiumMath.equalsEpsilon(this.top,e.top,t,i)&&nt.CesiumMath.equalsEpsilon(this.bottom,e.bottom,t,i)&&nt.CesiumMath.equalsEpsilon(this.near,e.near,t,i)&&nt.CesiumMath.equalsEpsilon(this.far,e.far,t,i)}}function us(e){e.top===e._top&&e.bottom===e._bottom&&e.left===e._left&&e.right===e._right&&e.near===e._near&&e.far===e._far||(e._left=e.left,e._right=e.right,e._top=e.top,e._bottom=e.bottom,e._near=e.near,e._far=e.far,e._orthographicMatrix=(new Ot).ortho({left:e.left,right:e.right,bottom:e.bottom,top:e.top,near:e.near,far:e.far}));}class hs{constructor(e){e=Z(e,Z.EMPTY_OBJECT),this._offCenterFrustum=new cs,this.width=e.width,this._width=void 0,this.aspectRatio=e.aspectRatio,this._aspectRatio=void 0,this.near=Z(e.near,1),this._near=this.near,this.far=Z(e.far,5e8),this._far=this.far;}static pack(e,t,i){return i=Z(i,0),t[i++]=e.width,t[i++]=e.aspectRatio,t[i++]=e.near,t[i]=e.far,t}static unpack(e,t,i){return t=Z(t,0),$(i)||(i=new hs),i.width=e[t++],i.aspectRatio=e[t++],i.near=e[t++],i.far=e[t],i}get projectionMatrix(){return ds(this),this._offCenterFrustum.projectionMatrix}computeCullingVolume(e,t,i){return ds(this),this._offCenterFrustum.computeCullingVolume(e,t,i)}getPixelDimensions(e,t,i,n,r){return ds(this),this._offCenterFrustum.getPixelDimensions(e,t,i,n,r)}clone(e){return $(e)||(e=new hs),e.aspectRatio=this.aspectRatio,e.width=this.width,e.near=this.near,e.far=this.far,e._aspectRatio=void 0,e._width=void 0,e._near=void 0,e._far=void 0,this._offCenterFrustum.clone(e._offCenterFrustum),e}equals(e){return !!($(e)&&e instanceof hs)&&(ds(this),ds(e),this.width===e.width&&this.aspectRatio===e.aspectRatio&&this._offCenterFrustum.equals(e._offCenterFrustum))}equalsEpsilon(e,t,i){return !!($(e)&&e instanceof hs)&&(ds(this),ds(e),nt.CesiumMath.equalsEpsilon(this.width,e.width,t,i)&&nt.CesiumMath.equalsEpsilon(this.aspectRatio,e.aspectRatio,t,i)&&this._offCenterFrustum.equalsEpsilon(e._offCenterFrustum,t,i))}}function ds(e){const t=e._offCenterFrustum;if(e.width!==e._width||e.aspectRatio!==e._aspectRatio||e.near!==e._near||e.far!==e._far){e._aspectRatio=e.aspectRatio,e._width=e.width,e._near=e.near,e._far=e.far;const i=1/e.aspectRatio;t.right=.5*e.width,t.left=-t.right,t.top=i*t.right,t.bottom=-t.top,t.near=e.near,t.far=e.far;}}hs.packedLength=4;const ps=new ft,fs=new ft,ms=new ft;class _s extends ft{constructor(e=0,t=0,i=0){super(e,t,i);}get longitude(){return this[0]}set longitude(e){this[0]=e;}get latitude(){return this[1]}set latitude(e){this[1]=e;}get height(){return this[2]}set height(e){this[2]=e;}clone(e=new _s){return _s.clone(this,e)}equals(e){return _s.equals(this,e)}equalsEpsilon(e,t=0){return _s.equalsEpsilon(this,e,t)}toString(){return `(${this.longitude}, ${this.latitude}, ${this.height})`}static fromRadians(e,t,i=0,n=new _s){return n.longitude=e,n.latitude=t,n.height=i,n}static fromDegrees(e,t,i=0,n=new _s){return e=nt.CesiumMath.toRadians(e),t=nt.CesiumMath.toRadians(t),_s.fromRadians(e,t,i,n)}static fromVector3(e,t=oi.WGS84,i=new _s){const n=Wt(e,t,fs);if(!$(n))return;let r=ft.multiplyComponents(n,t.oneOverRadiiSquared,ps);r=ft.normalize(r,r);const o=ft.subtract(e,n,ms),a=Math.atan2(r.y,r.x),s=Math.asin(r.z),l=Math.sign(ft.dot(o,e))*ft.magnitude(o);return i.longitude=a,i.latitude=s,i.height=l,i}static toVector3(e,t,i=new ft){return ft.fromRadians(e.longitude,e.latitude,e.height,t,i)}static clone(e,t=new _s){return t.longitude=e.longitude,t.latitude=e.latitude,t.height=e.height,t}static equals(e,t){return e===t||$(e)&&$(t)&&e.longitude===t.longitude&&e.latitude===t.latitude&&e.height===t.height}static equalsEpsilon(e,t,i=0){return e===t||$(e)&&$(t)&&Math.abs(e.longitude-t.longitude)<=i&&Math.abs(e.latitude-t.latitude)<=i&&Math.abs(e.height-t.height)<=i}}class gs{constructor(e,t,i,n){this.west=Z(e,0),this.south=Z(t,0),this.east=Z(i,0),this.north=Z(n,0);}get width(){return gs.computeWidth(this)}get height(){return gs.computeHeight(this)}static pack(e,t,i){return i=Z(i,0),t[i++]=e.west,t[i++]=e.south,t[i++]=e.east,t[i]=e.north,t}static unpack(e,t,i){return t=Z(t,0),$(i)||(i=new gs),i.west=e[t++],i.south=e[t++],i.east=e[t++],i.north=e[t],i}static computeWidth(e){let t=e.east;const i=e.west;return t<i&&(t+=nt.CesiumMath.TWO_PI),t-i}static computeHeight(e){return e.north-e.south}static fromDegrees(e,t,i,n,r){return e=nt.CesiumMath.toRadians(Z(e,0)),t=nt.CesiumMath.toRadians(Z(t,0)),i=nt.CesiumMath.toRadians(Z(i,0)),n=nt.CesiumMath.toRadians(Z(n,0)),$(r)?(r.west=e,r.south=t,r.east=i,r.north=n,r):new gs(e,t,i,n)}static fromRadians(e,t,i,n,r){return $(r)?(r.west=Z(e,0),r.south=Z(t,0),r.east=Z(i,0),r.north=Z(n,0),r):new gs(e,t,i,n)}static fromCartographicArray(e,t){let i=Number.MAX_VALUE,n=-Number.MAX_VALUE,r=Number.MAX_VALUE,o=-Number.MAX_VALUE,a=Number.MAX_VALUE,s=-Number.MAX_VALUE;for(let t=0,l=e.length;t<l;t++){const l=e[t];i=Math.min(i,l.longitude),n=Math.max(n,l.longitude),a=Math.min(a,l.latitude),s=Math.max(s,l.latitude);const c=l.longitude>=0?l.longitude:l.longitude+nt.CesiumMath.TWO_PI;r=Math.min(r,c),o=Math.max(o,c);}return n-i>o-r&&(i=r,n=o,n>nt.CesiumMath.PI&&(n-=nt.CesiumMath.TWO_PI),i>nt.CesiumMath.PI&&(i-=nt.CesiumMath.TWO_PI)),$(t)?(t.west=i,t.south=a,t.east=n,t.north=s,t):new gs(i,a,n,s)}static fromCartesianArray(e,t,i){t=Z(t,oi.WGS84);let n=Number.MAX_VALUE,r=-Number.MAX_VALUE,o=Number.MAX_VALUE,a=-Number.MAX_VALUE,s=Number.MAX_VALUE,l=-Number.MAX_VALUE;const c=new _s;for(let i=0,u=e.length;i<u;i++){const u=_s.fromVector3(e[i],t,c);n=Math.min(n,u.longitude),r=Math.max(r,u.longitude),s=Math.min(s,u.latitude),l=Math.max(l,u.latitude);const h=u.longitude>=0?u.longitude:u.longitude+nt.CesiumMath.TWO_PI;o=Math.min(o,h),a=Math.max(a,h);}return r-n>a-o&&(n=o,r=a,r>nt.CesiumMath.PI&&(r-=nt.CesiumMath.TWO_PI),n>nt.CesiumMath.PI&&(n-=nt.CesiumMath.TWO_PI)),$(i)?(i.west=n,i.south=s,i.east=r,i.north=l,i):new gs(n,s,r,l)}static clone(e,t){if($(e))return $(t)?(t.west=e.west,t.south=e.south,t.east=e.east,t.north=e.north,t):new gs(e.west,e.south,e.east,e.north)}static equalsEpsilon(e,t,i){return i=Z(i,0),e===t||$(e)&&$(t)&&Math.abs(e.west-t.west)<=i&&Math.abs(e.south-t.south)<=i&&Math.abs(e.east-t.east)<=i&&Math.abs(e.north-t.north)<=i}clone(e){return gs.clone(this,e)}equals(e){return gs.equals(this,e)}static equals(e,t){return e===t||$(e)&&$(t)&&e.west===t.west&&e.south===t.south&&e.east===t.east&&e.north===t.north}equalsEpsilon(e,t){return gs.equalsEpsilon(this,e,t)}static validate(e){const t=e.north;if(t<-nt.CesiumMath.PI_OVER_TWO||t>nt.CesiumMath.PI_OVER_TWO)throw new Error("north 范围越界！");const i=e.south;if(i<-nt.CesiumMath.PI_OVER_TWO||i>nt.CesiumMath.PI_OVER_TWO)throw new Error("south 范围越界！");const n=e.west;if(n<-nt.CesiumMath.PI||n>nt.CesiumMath.PI)throw new Error("west 范围越界！");const r=e.east;if(r<-nt.CesiumMath.PI||r>nt.CesiumMath.PI)throw new Error("east 范围越界！")}static southwest(e,t){return $(t)?(t.longitude=e.west,t.latitude=e.south,t.height=0,t):new _s(e.west,e.south)}static northwest(e,t){return $(t)?(t.longitude=e.west,t.latitude=e.north,t.height=0,t):new _s(e.west,e.north)}static northeast(e,t){return $(t)?(t.longitude=e.east,t.latitude=e.north,t.height=0,t):new _s(e.east,e.north)}static southeast(e,t){return $(t)?(t.longitude=e.east,t.latitude=e.south,t.height=0,t):new _s(e.east,e.south)}static center(e,t){let i=e.east;const n=e.west;i<n&&(i+=nt.CesiumMath.TWO_PI);const r=nt.CesiumMath.negativePiToPi(.5*(n+i)),o=.5*(e.south+e.north);return $(t)?(t.longitude=r,t.latitude=o,t.height=0,t):new _s(r,o)}static intersection(e,t,i){let n=e.east,r=e.west,o=t.east,a=t.west;n<r&&o>0?n+=nt.CesiumMath.TWO_PI:o<a&&n>0&&(o+=nt.CesiumMath.TWO_PI),n<r&&a<0?a+=nt.CesiumMath.TWO_PI:o<a&&r<0&&(r+=nt.CesiumMath.TWO_PI);const s=nt.CesiumMath.negativePiToPi(Math.max(r,a)),l=nt.CesiumMath.negativePiToPi(Math.min(n,o));if((e.west<e.east||t.west<t.east)&&l<=s)return;const c=Math.max(e.south,t.south),u=Math.min(e.north,t.north);return c>=u?void 0:$(i)?(i.west=s,i.south=c,i.east=l,i.north=u,i):new gs(s,c,l,u)}static simpleIntersection(e,t,i){const n=Math.max(e.west,t.west),r=Math.max(e.south,t.south),o=Math.min(e.east,t.east),a=Math.min(e.north,t.north);if(!(r>=a||n>=o))return $(i)?(i.west=n,i.south=r,i.east=o,i.north=a,i):new gs(n,r,o,a)}static union(e,t,i){$(i)||(i=new gs);let n=e.east,r=e.west,o=t.east,a=t.west;n<r&&o>0?n+=nt.CesiumMath.TWO_PI:o<a&&n>0&&(o+=nt.CesiumMath.TWO_PI),n<r&&a<0?a+=nt.CesiumMath.TWO_PI:o<a&&r<0&&(r+=nt.CesiumMath.TWO_PI);const s=nt.CesiumMath.negativePiToPi(Math.min(r,a)),l=nt.CesiumMath.negativePiToPi(Math.max(n,o));return i.west=s,i.south=Math.min(e.south,t.south),i.east=l,i.north=Math.max(e.north,t.north),i}static expand(e,t,i){return $(i)||(i=new gs),i.west=Math.min(e.west,t.longitude),i.south=Math.min(e.south,t.latitude),i.east=Math.max(e.east,t.longitude),i.north=Math.max(e.north,t.latitude),i}static contains(e,t){let i=t.longitude;const n=t.latitude,r=e.west;let o=e.east;return o<r&&(o+=nt.CesiumMath.TWO_PI,i<0&&(i+=nt.CesiumMath.TWO_PI)),(i>r||nt.CesiumMath.equalsEpsilon(i,r,nt.CesiumMath.EPSILON14))&&(i<o||nt.CesiumMath.equalsEpsilon(i,o,nt.CesiumMath.EPSILON14))&&n>=e.south&&n<=e.north}static subsample(e,t,i,n){t=Z(t,oi.WGS84),i=Z(i,0);const r=new _s;$(n)||(n=[]);let o=0;const a=e.north,s=e.south,l=e.east,c=e.west,u=r;u.height=i,u.longitude=c,u.latitude=a,n[o]=t.cartographicToCartesian(u,n[o]),o++,u.longitude=l,n[o]=t.cartographicToCartesian(u,n[o]),o++,u.latitude=s,n[o]=t.cartographicToCartesian(u,n[o]),o++,u.longitude=c,n[o]=t.cartographicToCartesian(u,n[o]),o++,u.latitude=a<0?a:s>0?s:0;for(let i=1;i<8;++i)u.longitude=-Math.PI+i*nt.CesiumMath.PI_OVER_TWO,gs.contains(e,u)&&(n[o]=t.cartographicToCartesian(u,n[o]),o++);return 0===u.latitude&&(u.longitude=c,n[o]=t.cartographicToCartesian(u,n[o]),o++,u.longitude=l,n[o]=t.cartographicToCartesian(u,n[o]),o++),n.length=o,n}}gs.packedLength=4,gs.MAX_VALUE=Object.freeze(new gs(-Math.PI,-nt.CesiumMath.PI_OVER_TWO,Math.PI,nt.CesiumMath.PI_OVER_TWO));const ys={};function xs(e,t,i){const n=e+t;return Math.sign(e)!==Math.sign(t)&&Math.abs(n/Math.max(Math.abs(e),Math.abs(t)))<i?0:n}ys.computeDiscriminant=function(e,t,i){return t*t-4*e*i},ys.computeRealRoots=function(e,t,i){let n;if(0===e)return 0===t?[]:[-i/t];if(0===t){if(0===i)return [0,0];const t=Math.abs(i),r=Math.abs(e);if(t<r&&t/r<nt.CesiumMath.EPSILON14)return [0,0];if(t>r&&r/t<nt.CesiumMath.EPSILON14)return [];if(n=-i/e,n<0)return [];const o=Math.sqrt(n);return [-o,o]}if(0===i)return n=-t/e,n<0?[n,0]:[0,n];const r=xs(t*t,-4*e*i,nt.CesiumMath.EPSILON14);if(r<0)return [];const o=-.5*xs(t,Math.sign(t)*Math.sqrt(r),nt.CesiumMath.EPSILON14);return t>0?[o/e,i/o]:[i/o,o/e]};const vs={};function ws(e,t,i,n){const r=e,o=t/3,a=i/3,s=n,l=r*a,c=o*s,u=o*o,h=a*a,d=r*a-u,p=r*s-o*a,f=o*s-h,m=4*d*f-p*p;let _,g;if(m<0){let e,t,i;u*c>=l*h?(e=r,t=d,i=-2*o*d+r*p):(e=s,t=f,i=-s*p+2*a*f);const n=-(i<0?-1:1)*Math.abs(e)*Math.sqrt(-m);g=-i+n;const y=g/2,x=y<0?-Math.pow(-y,1/3):Math.pow(y,1/3),v=g===n?-x:-t/x;return _=t<=0?x+v:-i/(x*x+v*v+t),u*c>=l*h?[(_-o)/r]:[-s/(_+a)]}const y=d,x=-2*o*d+r*p,v=f,w=-s*p+2*a*f,T=Math.sqrt(m),b=Math.sqrt(3)/2;let P=Math.abs(Math.atan2(r*T,-x)/3);_=2*Math.sqrt(-y);let S=Math.cos(P);g=_*S;let A=_*(-S/2-b*Math.sin(P));const E=g+A>2*o?g-o:A-o,C=r,M=E/C;P=Math.abs(Math.atan2(s*T,-w)/3),_=2*Math.sqrt(-v),S=Math.cos(P),g=_*S,A=_*(-S/2-b*Math.sin(P));const I=-s,L=g+A<2*a?g+a:A+a,N=I/L,R=-E*L-C*I,O=(a*R-o*(E*I))/(-o*R+a*(C*L));return M<=O?M<=N?O<=N?[M,O,N]:[M,N,O]:[N,M,O]:M<=N?[O,M,N]:O<=N?[O,N,M]:[N,O,M]}vs.computeDiscriminant=function(e,t,i,n){const r=t*t,o=i*i;return 18*e*t*i*n+r*o-e*e*27*(n*n)-4*(e*o*i+r*t*n)},vs.computeRealRoots=function(e,t,i,n){let r,o;if(0===e)return ys.computeRealRoots(t,i,n);if(0===t){if(0===i){if(0===n)return [0,0,0];o=-n/e;const t=o<0?-Math.pow(-o,1/3):Math.pow(o,1/3);return [t,t,t]}return 0===n?(r=ys.computeRealRoots(e,0,i),0===r.Length?[0]:[r[0],0,r[1]]):ws(e,0,i,n)}return 0===i?0===n?(o=-t/e,o<0?[o,0,0]:[0,0,o]):ws(e,t,0,n):0===n?(r=ys.computeRealRoots(e,t,i),0===r.length?[0]:r[1]<=0?[r[0],r[1],0]:r[0]>=0?[0,r[0],r[1]]:[r[0],0,r[1]]):ws(e,t,i,n)};const Ts={computeDiscriminant:function(e,t,i,n,r){const o=e*e,a=t*t,s=a*t,l=i*i,c=l*i,u=n*n,h=u*n,d=r*r;return a*l*u-4*s*h-4*e*c*u+18*e*t*i*h-27*o*u*u+o*e*256*(d*r)+r*(18*s*i*n-4*a*c+16*e*l*l-80*e*t*l*n-6*e*a*u+144*o*i*u)+d*(144*e*a*i-27*a*a-128*o*l-192*o*t*n)},computeRealRoots:function(e,t,i,n,r){if(Math.abs(e)<nt.CesiumMath.EPSILON15)return vs.computeRealRoots(t,i,n,r);const o=t/e,a=i/e,s=n/e,l=r/e;let c=o<0?1:0;switch(c+=a<0?c+1:c,c+=s<0?c+1:c,c+=l<0?c+1:c,c){case 0:case 3:case 4:case 6:case 7:case 9:case 10:case 12:case 13:case 14:case 15:return function(e,t,i,n){const r=e*e,o=t-3*r/8,a=i-t*e/2+r*e/8,s=n-i*e/4+t*r/16-3*r*r/256,l=vs.computeRealRoots(1,2*o,o*o-4*s,-a*a);if(l.length>0){const t=-e/4,i=l[l.length-1];if(Math.abs(i)<nt.CesiumMath.EPSILON14){const e=ys.computeRealRoots(1,o,s);if(2===e.length){const i=e[0],n=e[1];let r;if(i>=0&&n>=0){const e=Math.sqrt(i),r=Math.sqrt(n);return [t-r,t-e,t+e,t+r]}if(i>=0&&n<0)return r=Math.sqrt(i),[t-r,t+r];if(i<0&&n>=0)return r=Math.sqrt(n),[t-r,t+r]}return []}if(i>0){const e=Math.sqrt(i),n=(o+i+a/e)/2,r=ys.computeRealRoots(1,e,(o+i-a/e)/2),s=ys.computeRealRoots(1,-e,n);return 0!==r.length?(r[0]+=t,r[1]+=t,0!==s.length?(s[0]+=t,s[1]+=t,r[1]<=s[0]?[r[0],r[1],s[0],s[1]]:s[1]<=r[0]?[s[0],s[1],r[0],r[1]]:r[0]>=s[0]&&r[1]<=s[1]?[s[0],r[0],r[1],s[1]]:s[0]>=r[0]&&s[1]<=r[1]?[r[0],s[0],s[1],r[1]]:r[0]>s[0]&&r[0]<s[1]?[s[0],r[0],s[1],r[1]]:[r[0],s[0],r[1],s[1]]):r):0!==s.length?(s[0]+=t,s[1]+=t,s):[]}}return []}(o,a,s,l);case 1:case 2:case 5:case 8:case 11:return function(e,t,i,n){const r=e*e,o=vs.computeRealRoots(1,-2*t,i*e+t*t-4*n,r*n-i*t*e+i*i);if(o.length>0){const a=o[0],s=t-a,l=s*s,c=e/2,u=s/2,h=l-4*n,d=l+4*Math.abs(n),p=r-4*a,f=r+4*Math.abs(a);let m,_,g,y,x,v;if(a<0||h*f<p*d){const t=Math.sqrt(p);m=t/2,_=0===t?0:(e*u-i)/t;}else {const t=Math.sqrt(h);m=0===t?0:(e*u-i)/t,_=t/2;}0===c&&0===m?(g=0,y=0):Math.sign(c)===Math.sign(m)?(g=c+m,y=a/g):(y=c-m,g=a/y),0===u&&0===_?(x=0,v=0):Math.sign(u)===Math.sign(_)?(x=u+_,v=n/x):(v=u-_,x=n/v);const w=ys.computeRealRoots(1,g,x),T=ys.computeRealRoots(1,y,v);if(0!==w.length)return 0!==T.length?w[1]<=T[0]?[w[0],w[1],T[0],T[1]]:T[1]<=w[0]?[T[0],T[1],w[0],w[1]]:w[0]>=T[0]&&w[1]<=T[1]?[T[0],w[0],w[1],T[1]]:T[0]>=w[0]&&T[1]<=w[1]?[w[0],T[0],T[1],w[1]]:w[0]>T[0]&&w[0]<T[1]?[T[0],w[0],T[1],w[1]]:[w[0],T[0],w[1],T[1]]:w;if(0!==T.length)return T}return []}(o,a,s,l);default:return}}},bs=new ft,Ps=new ft,Ss=new ft,As=new ft;class Es{constructor(e,t){this.origin=new ft(void 0!==e?e:[0,0,0]),this.direction=new ft(void 0!==t?t:[0,0,0]);}set(e,t){return S(this.origin,e),S(this.direction,t),this}clone(){return new Es(this.origin,this.direction)}copy(e){S(this.origin,e.origin),S(this.direction,e.direction);}at(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=[0,0,0]),S(t,this.direction),E(t,t,e),A(t,t,this.origin),t}lookAt(e){return S(this.direction,e),O(this.direction,this.direction,this.origin),M(this.direction,this.direction),this}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=[0,0,0]),O(t,e,this.origin);const i=I(t,this.direction);return i<0?S(t,this.origin):(S(t,this.direction),E(t,t,i),A(t,t,this.origin),t)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(){const e=[0,0,0],t=I(O(e,point,this.origin),this.direction);return t<0?C(this.origin,point):(S(e,this.direction),E(e,e,t),A(e,e,this.origin),C(e,point))}distanceSqToSegment(e,t,i,n){const r=[0,0,0],o=[0,0,0],a=[0,0,0];r.copy(e).add(t).multiplyScalar(.5),o.copy(t).sub(e).normalize(),a.copy(this.origin).sub(r);const s=.5*e.distanceTo(t),l=-this.direction.dot(o),c=a.dot(this.direction),u=-a.dot(o),h=a.lengthSq(),d=Math.abs(1-l*l);let p,f,m,_;if(d>0)if(p=l*u-c,f=l*c-u,_=s*d,p>=0)if(f>=-_)if(f<=_){const e=1/d;p*=e,f*=e,m=p*(p+l*f+2*c)+f*(l*p+f+2*u)+h;}else f=s,p=Math.max(0,-(l*f+c)),m=-p*p+f*(f+2*u)+h;else f=-s,p=Math.max(0,-(l*f+c)),m=-p*p+f*(f+2*u)+h;else f<=-_?(p=Math.max(0,-(-l*s+c)),f=p>0?-s:Math.min(Math.max(-s,-u),s),m=-p*p+f*(f+2*u)+h):f<=_?(p=0,f=Math.min(Math.max(-s,-u),s),m=f*(f+2*u)+h):(p=Math.max(0,-(l*s+c)),f=p>0?s:Math.min(Math.max(-s,-u),s),m=-p*p+f*(f+2*u)+h);else f=l>0?-s:s,p=Math.max(0,-(l*f+c)),m=-p*p+f*(f+2*u)+h;return i&&i.copy(this.direction).multiplyScalar(p).add(this.origin),n&&n.copy(o).multiplyScalar(f).add(r),m}intersectSphere(e,t){const i=[0,0,0];O(i,e.center,this.origin);const n=I(i,this.direction),r=I(i,i)-n*n,o=e.radius*e.radius;if(r>o)return null;const a=Math.sqrt(o-r),s=n-a,l=n+a;return s<0&&l<0?null:this.at(s<0?l:s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,n,r,o,a,s;const l=1/this.direction[0],c=1/this.direction[1],u=1/this.direction[2],h=this.origin;return l>=0?(i=(e[0][0]-h[0])*l,n=(e[1][0]-h[0])*l):(i=(e[1][0]-h[0])*l,n=(e[0][0]-h[0])*l),c>=0?(r=(e[0][1]-h[1])*c,o=(e[1][1]-h[1])*c):(r=(e[1][1]-h[1])*c,o=(e[0][1]-h[1])*c),i>o||r>n?null:((r>i||i!=i)&&(i=r),(o<n||n!=n)&&(n=o),u>=0?(a=(e[0][2]-h[2])*u,s=(e[1][2]-h[2])*u):(a=(e[1][2]-h[2])*u,s=(e[0][2]-h[2])*u),i>s||a>n?null:((a>i||i!=i)&&(i=a),(s<n||n!=n)&&(n=s),n<0?null:this.at(i>=0?i:n,t)))}intersectTriangle(e,t,i,n,r){Ps.subVectors(t,e),Ss.subVectors(i,e),As.crossVectors(Ps,Ss);let o,a=this.direction.dot(As);if(a>0){if(n)return null;o=1;}else {if(!(a<0))return null;o=-1,a=-a;}bs.subVectors(this.origin,e);const s=o*this.direction.dot(Ss.crossVectors(bs,Ss));if(s<0)return null;const l=o*this.direction.dot(Ps.cross(bs));if(l<0)return null;if(s+l>a)return null;const c=-o*bs.dot(As);return c<0?null:this.at(c/a,r)}applyMatrix4(e){return F(this.origin,this.origin,e),F(this.direction,this.direction,e),this}equals(e){return e.origin===this.origin&&e.direction===this.direction}static getPoint(e,t,i){return $(i)||(i=new ft),i=ft.multiplyByScalar(e.direction,t,i),ft.add(e.origin,i,i)}}const Cs={rayPlane:function(e,t,i){$(i)||(i=new ft);const n=e.origin,r=e.direction,o=t.normal,a=ft.dot(o,r);if(Math.abs(a)<nt.CesiumMath.EPSILON15)return;const s=(-t.distance-ft.dot(o,n))/a;return s<0?void 0:(i=ft.multiplyByScalar(r,s,i),ft.add(n,i,i))}},Ms=new ft,Is=new ft,Ls=new ft,Ns=new ft,Rs=new ft;Cs.rayTriangleParametric=function(e,t,i,n,r){r=Z(r,!1);const o=e.origin,a=e.direction,s=ft.subtract(i,t,Ms),l=ft.subtract(n,t,Is),c=ft.cross(a,l,Ls),u=ft.dot(s,c);let h,d,p,f,m;if(r){if(u<nt.CesiumMath.EPSILON6)return;if(h=ft.subtract(o,t,Ns),p=ft.dot(h,c),p<0||p>u)return;if(d=ft.cross(h,s,Rs),f=ft.dot(a,d),f<0||p+f>u)return;m=ft.dot(l,d)/u;}else {if(Math.abs(u)<nt.CesiumMath.EPSILON6)return;const e=1/u;if(h=ft.subtract(o,t,Ns),p=ft.dot(h,c)*e,p<0||p>1)return;if(d=ft.cross(h,s,Rs),f=ft.dot(a,d)*e,f<0||p+f>1)return;m=ft.dot(l,d)*e;}return m},Cs.rayTriangle=function(e,t,i,n,r,o){const a=Cs.rayTriangleParametric(e,t,i,n,r);if($(a)&&!(a<0))return $(o)||(o=new ft),ft.multiplyByScalar(e.direction,a,o),ft.add(e.origin,o,o)};const Os=new Es;Cs.lineSegmentTriangle=function(e,t,i,n,r,o,a){const s=Os;ft.clone(e,s.origin),ft.subtract(t,e,s.direction),ft.normalize(s.direction,s.direction);const l=Cs.rayTriangleParametric(s,i,n,r,o);if(!(!$(l)||l<0||l>ft.distance(e,t)))return $(a)||(a=new ft),ft.multiplyByScalar(s.direction,l,a),ft.add(s.origin,a,a)};const Ds={root0:0,root1:0};function Fs(e,t,i){$(i)||(i={start:0,stop:0});const n=e.direction,r=t.radius*t.radius,o=ft.subtract(e.origin,t.center,Ls),a=function(e,t,i,n){const r=t*t-4*e*i;if(r<0)return;if(r>0){const i=1/(2*e),o=Math.sqrt(r),a=(-t+o)*i,s=(-t-o)*i;return a<s?(n.root0=a,n.root1=s):(n.root0=s,n.root1=a),n}const o=-t/(2*e);return 0!==o?(n.root0=n.root1=o,n):void 0}(ft.dot(n,n),2*ft.dot(n,o),ft.magnitudeSquared(o)-r,Ds);if($(a))return i.start=a.root0,i.stop=a.root1,i}Cs.raySphere=function(e,t,i){if($(i=Fs(e,t,i))&&!(i.stop<0))return i.start=Math.max(i.start,0),i};const zs=new Es;Cs.lineSegmentSphere=function(e,t,i,n){const r=zs;ft.clone(e,r.origin);const o=ft.subtract(t,e,r.direction),a=ft.magnitude(o);if(ft.normalize(o,o),!(!$(n=Fs(r,i,n))||n.stop<0||n.start>a))return n.start=Math.max(n.start,0),n.stop=Math.min(n.stop,a),n};const Bs=new ft,Vs=new ft;function Us(e,t,i){const n=e+t;return Math.sign(e)!==Math.sign(t)&&Math.abs(n/Math.max(Math.abs(e),Math.abs(t)))<i?0:n}Cs.rayEllipsoid=function(e,t){const i=t.oneOverRadii,n=ft.multiplyComponents(i,e.origin,Bs),r=ft.multiplyComponents(i,e.direction,Vs),o=ft.magnitudeSquared(n),a=ft.dot(n,r);let s,l,c,u,h;if(o>1){if(a>=0)return;const e=a*a;if(s=o-1,l=ft.magnitudeSquared(r),c=l*s,e<c)return;if(e>c){u=a*a-c,h=-a+Math.sqrt(u);const e=h/l,t=s/h;return e<t?{start:e,stop:t}:{start:t,stop:e}}const t=Math.sqrt(s/l);return {start:t,stop:t}}return o<1?(s=o-1,l=ft.magnitudeSquared(r),c=l*s,u=a*a-c,h=-a+Math.sqrt(u),{start:0,stop:h/l}):a<0?(l=ft.magnitudeSquared(r),{start:0,stop:-a/l}):void 0};const ks=new ft,Gs=new ft,Hs=new ft,Ys=new ft,qs=new ft,Xs=new Ct,js=new Ct,Ws=new Ct,$s=new Ct,Zs=new Ct,Ks=new Ct,Qs=new Ct,Js=new ft,el=new ft;Cs.grazingAltitudeLocation=function(e,t){const i=e.origin,n=e.direction;if(!ft.equals(i,ft.ZERO)){const e=t.geodeticSurfaceNormal(i,ks);if(ft.dot(n,e)>=0)return i}const r=$(this.rayEllipsoid(e,t)),o=t.transformPositionToScaledSpace(n,ks),a=ft.normalize(o,o),s=ft.mostOrthogonalAxis(o,Ys),l=ft.normalize(ft.cross(s,a,Gs),Gs),c=ft.normalize(ft.cross(a,l,Hs),Hs),u=Xs;u[0]=a.x,u[1]=a.y,u[2]=a.z,u[3]=l.x,u[4]=l.y,u[5]=l.z,u[6]=c.x,u[7]=c.y,u[8]=c.z;const h=u.transpose(js),d=Ct.fromScale(t.radii,Ws),p=Ct.fromScale(t.oneOverRadii,$s),f=Zs;f[0]=0,f[1]=-n.z,f[2]=n.y,f[3]=n.z,f[4]=0,f[5]=-n.x,f[6]=-n.y,f[7]=n.x,f[8]=0;const m=Ct.multiply(Ct.multiply(h,p,Ks),f,Ks),_=Ct.multiply(Ct.multiply(m,d,Qs),u,Qs),g=Ct.multiplyByVector(m,i,qs),y=function(e,t,i,n,r){const o=1*(e[At.COL1ROW1]-e[At.COL2ROW2]),a=1*(0*Us(e[At.COL1ROW0],e[At.COL0ROW1],nt.CesiumMath.EPSILON15)+t.y),s=0*e[At.COL0ROW0]+1*e[At.COL2ROW2]+0*t.x+0,l=1*Us(e[At.COL2ROW1],e[At.COL1ROW2],nt.CesiumMath.EPSILON15),c=1*(0*Us(e[At.COL2ROW0],e[At.COL0ROW2])+t.z);let u;const h=[];if(0===c&&0===l){if(u=ys.computeRealRoots(o,a,s),0===u.length)return h;const e=u[0],t=Math.sqrt(Math.max(1-e*e,0));if(h.push(new ft(0,1*e,1*-t)),h.push(new ft(0,1*e,1*t)),2===u.length){const e=u[1],t=Math.sqrt(Math.max(1-e*e,0));h.push(new ft(0,1*e,1*-t)),h.push(new ft(0,1*e,1*t));}return h}const d=c*c,p=l*l,f=c*l,m=o*o+p,_=2*(a*o+f),g=2*s*o+a*a-p+d,y=2*(s*a-f);if(0===m&&0===_&&0===g&&0===y)return h;u=Ts.computeRealRoots(m,_,g,y,s*s-d);const x=u.length;if(0===x)return h;for(let e=0;e<x;++e){const t=u[e],i=t*t,n=Math.max(1-i,0),r=Math.sqrt(n);let d;d=Math.sign(o)===Math.sign(s)?Us(o*i+s,a*t,nt.CesiumMath.EPSILON12):Math.sign(s)===Math.sign(a*t)?Us(o*i,a*t+s,nt.CesiumMath.EPSILON12):Us(o*i+a*t,s,nt.CesiumMath.EPSILON12);const p=d*Us(l*t,c,nt.CesiumMath.EPSILON15);p<0?h.push(new ft(0,1*t,1*r)):p>0?h.push(new ft(0,1*t,1*-r)):0!==r?(h.push(new ft(0,1*t,1*-r)),h.push(new ft(0,1*t,1*r)),++e):h.push(new ft(0,1*t,1*r));}return h}(_,ft.negate(g,ks));let x,v;const w=y.length;if(w>0){let e=ft.clone(ft.ZERO,el),o=Number.NEGATIVE_INFINITY;for(let t=0;t<w;++t){x=Ct.multiplyByVector(d,Ct.multiplyByVector(u,y[t],Js),Js);const r=ft.normalize(ft.subtract(x,i,Ys),Ys),a=ft.dot(r,n);a>o&&(o=a,e=ft.clone(x,e));}const a=new _s,s=t.cartesianToCartographic(e,a);return o=De(o,0,1),v=ft.magnitude(ft.subtract(e,i,Ys))*Math.sqrt(1-o*o),v=r?-v:v,s.height=v,t.cartographicToCartesianInRadians(s,new ft)}};const tl=new ft;Cs.lineSegmentPlane=function(e,t,i,n){$(n)||(n=new ft);const r=ft.subtract(t,e,tl),o=i.normal,a=ft.dot(o,r);if(Math.abs(a)<nt.CesiumMath.EPSILON6)return;const s=ft.dot(o,e),l=-(i.distance+s)/a;return l<0||l>1?void 0:(ft.multiplyByScalar(r,l,n),ft.add(e,n,n),n)},Cs.trianglePlaneIntersection=function(e,t,i,n){const r=n.normal,o=n.distance,a=ft.dot(r,e)+o<0,s=ft.dot(r,t)+o<0,l=ft.dot(r,i)+o<0;let c,u,h=0;if(h+=a?1:0,h+=s?1:0,h+=l?1:0,1!==h&&2!==h||(c=new ft,u=new ft),1===h){if(a)return Cs.lineSegmentPlane(e,t,n,c),Cs.lineSegmentPlane(e,i,n,u),{positions:[e,t,i,c,u],indices:[0,3,4,1,2,4,1,4,3]};if(s)return Cs.lineSegmentPlane(t,i,n,c),Cs.lineSegmentPlane(t,e,n,u),{positions:[e,t,i,c,u],indices:[1,3,4,2,0,4,2,4,3]};if(l)return Cs.lineSegmentPlane(i,e,n,c),Cs.lineSegmentPlane(i,t,n,u),{positions:[e,t,i,c,u],indices:[2,3,4,0,1,4,0,4,3]}}else if(2===h){if(!a)return Cs.lineSegmentPlane(t,e,n,c),Cs.lineSegmentPlane(i,e,n,u),{positions:[e,t,i,c,u],indices:[1,2,4,1,4,3,0,3,4]};if(!s)return Cs.lineSegmentPlane(i,t,n,c),Cs.lineSegmentPlane(e,t,n,u),{positions:[e,t,i,c,u],indices:[2,0,4,2,4,3,1,3,4]};if(!l)return Cs.lineSegmentPlane(e,i,n,c),Cs.lineSegmentPlane(t,i,n,u),{positions:[e,t,i,c,u],indices:[0,1,4,0,4,3,2,3,4]}}};class il{constructor(e,t,i){const n=Z(i,oi.WGS84);this._ellipsoid=n,this._start=new ft,this._end=new ft,this._constants={},this._startHeading=void 0,this._endHeading=void 0,this._distance=void 0,this._uSquared=void 0;}get ellipsoid(){return this._ellipsoid}get surfaceDistance(){return this._distance}get start(){return this._start}get end(){return this._end}get startHeading(){return this._startHeading}get endHeading(){return this._endHeading}setConstants(e){const t=e._uSquared,i=e._ellipsoid.maximumRadius,n=e._ellipsoid.minimumRadius,r=(i-n)/i,o=Math.cos(e._startHeading),a=Math.sin(e._startHeading),s=(1-r)*Math.tan(e._start.y),l=1/Math.sqrt(1+s*s),c=l*s,u=Math.atan2(s,o),h=l*a,d=h*h,p=1-d,f=Math.sqrt(p),m=t/4,_=m*m,g=_*m,y=_*_,x=1+m-3*_/4+5*g/4-175*y/64,v=1-m+15*_/8-35*g/8,w=1-3*m+35*_/4,T=1-5*m,b=x*u-v*Math.sin(2*u)*m/2-w*Math.sin(4*u)*_/16-T*Math.sin(6*u)*g/48-5*Math.sin(8*u)*y/512,P=e._constants;P.a=i,P.b=n,P.f=r,P.cosineHeading=o,P.sineHeading=a,P.tanU=s,P.cosineU=l,P.sineU=c,P.sigma=u,P.sineAlpha=h,P.sineSquaredAlpha=d,P.cosineSquaredAlpha=p,P.cosineAlpha=f,P.u2Over4=m,P.u4Over16=_,P.u6Over64=g,P.u8Over256=y,P.a0=x,P.a1=v,P.a2=w,P.a3=T,P.distanceRatio=b;}computeC(e,t){return e*t*(4+e*(4-3*t))/16}computeDeltaLambda(e,t,i,n,r,o,a){const s=this.computeC(e,i);return (1-s)*e*t*(n+s*r*(a+s*o*(2*a*a-1)))}vincentyInverseFormula(e,t,i,n,r,o,a){const s=(t-i)/t,l=o-n,c=Math.atan((1-s)*Math.tan(r)),u=Math.atan((1-s)*Math.tan(a)),h=Math.cos(c),d=Math.sin(c),p=Math.cos(u),f=Math.sin(u),m=h*p,_=h*f,g=d*f,y=d*p;let x,v,w,T,b,P=l,S=nt.TRANSFORM.TWO_PI,A=Math.cos(P),E=Math.sin(P);do{A=Math.cos(P),E=Math.sin(P);const e=_-y*A;let t;w=Math.sqrt(p*p*E*E+e*e),v=g+m*A,x=Math.atan2(w,v),0===w?(t=0,T=1):(t=m*E/w,T=1-t*t),S=P,b=v-2*g/T,isFinite(b)||(b=0),P=l+this.computeDeltaLambda(s,t,T,x,w,v,b);}while(Math.abs(P-S)>nt.TRANSFORM.EPSILON12);const C=T*(t*t-i*i)/(i*i),M=C*(256+C*(C*(74-47*C)-128))/1024,I=b*b,L=i*(1+C*(4096+C*(C*(320-175*C)-768))/16384)*(x-M*w*(b+M*(v*(2*I-1)-M*b*(4*w*w-3)*(4*I-3)/6)/4)),N=Math.atan2(p*E,_-y*A),R=Math.atan2(h*E,_*A-y);e._distance=L,e._startHeading=N,e._endHeading=R,e._uSquared=C;}computeProperties(e,t,i,n){this.vincentyInverseFormula(e,n.maximumRadius,n.minimumRadius,t.x,t.y,i.x,i.y),e._start=ft.clone(t,e._start),e._end=ft.clone(i,e._end),e._start.z=0,e._end.z=0,this.setConstants(e);}setEndPoints(e,t,i){this.computeProperties(this,e,t,this._ellipsoid,i);}interpolateUsingFraction(e,t){return this.interpolateUsingSurfaceDistance(this._distance*e,t)}interpolateUsingSurfaceDistance(e,t){const i=this._constants,n=i.distanceRatio+e/i.b,r=Math.cos(2*n),o=Math.cos(4*n),a=Math.cos(6*n),s=Math.sin(2*n),l=Math.sin(4*n),c=Math.sin(6*n),u=Math.sin(8*n),h=n*n,d=i.u8Over256,p=i.u2Over4,f=i.u6Over64,m=i.u4Over16;let _=n*h*2*d*r/3+n*(1-p+7*m/4-15*f/4+579*d/64-(m-15*f/4+187*d/16)*r-(5*f/4-115*d/16)*o-29*d*a/16)+(p/2-m+71*f/32-85*d/16)*s+(5*m/16-5*f/4+383*d/96)*l-h*((f-11*d/2)*s+5*d*l/2)+(29*f/96-29*d/16)*c+539*d*u/1536;const g=Math.asin(Math.sin(_)*i.cosineAlpha),y=Math.atan(i.a/i.b*Math.tan(g));_-=i.sigma;const x=Math.cos(2*i.sigma+_),v=Math.sin(_),w=Math.cos(_),T=Math.atan2(v*i.sineHeading,i.cosineU*w-i.sineU*v*i.cosineHeading)-this.computeDeltaLambda(i.f,i.sineAlpha,i.cosineSquaredAlpha,_,v,w,x);return $(t)?(t.x=this._start.x+T,t.y=y,t.z=0,t):new ft(this._start.x+T,y,0)}}class nl{constructor(e){let t;this.name="DeveloperError",this.message=e;try{throw new Error}catch(e){t=e.stack;}this.stack=t;}toString(){let e=`${this.name}: ${this.message}`;return $(this.stack)&&(e+=`\n${this.stack.toString()}`),e}static throwInstantiationError(){throw new nl("This function defines an interface and should not be called directly.")}}function rl(e,t,i){i[e]&&-1!==i[e].indexOf(t)||(i[e]=i[e]||[],i[e].push(t));}function ol(e,t,i){if(i&&i[e]){const n=i[e].indexOf(t);-1!==n&&i[e].splice(n,1);}}class al{constructor(e,t={}){ze(this,t),this.type=e;}}class sl extends al{constructor(e,t={}){super("error",ze({error:e},t));}}class ll{on(e,t){return this._listeners=this._listeners||{},rl(e,t,this._listeners),this}off(e,t){return ol(e,t,this._listeners),ol(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},rl(e,t,this._oneTimeListeners),this):new Promise((t=>this.once(e,t)))}fire(e,t){"string"==typeof e&&(e=new al(e,t||{}));const i=e.type;if(this.listens(i)){e.target=this;const t=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const i of t)i&&i.call(this,e);const n=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const t of n)ol(i,t,this._oneTimeListeners),t&&t.call(this,e);const r=this._eventedParent;r&&(ze(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),r.fire(e));}else e instanceof sl&&console.error(e.error);return this}listens(e){return !!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}const cl=Object.freeze(new ft(1,0,0)),ul=Object.freeze(new ft(0,1,0)),hl=Object.freeze(new ft(0,0,1));class dl extends ll{constructor(){super(),this.isObject3D=!0,this.type="Object3D",this._rotation=new ft(0,0,0),this._quaternion=new Tt,this._scale=new ft(1,1,1),this._position=new ft(0,0,0),this._matrix=new Ot,this._matrixWorld=new Ot,this.matrixAutoUpdate=pl,this.matrixWorldNeedsUpdate=!1,this.unmodified=!1,this.parent=null,this.visible=!0,this.children=[],this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!1;}get target(){return this._target}set target(e){this.unmodified=!1,this._target=e;}set up(e){this.unmodified=!1,this._up=e;}get up(){return this._up||ft.normalize(new ft(this.matrix[4],this.matrix[5],this.matrix[6]),new ft)}get right(){return ft.normalize(new ft(this.matrix[0],this.matrix[1],this.matrix[2]),new ft)}get direction(){return ft.normalize(new ft(this.matrix[8],this.matrix[9],this.matrix[10]),new ft)}get quaternion(){return this._quaternion}set quaternion(e){this.unmodified=!1,this._quaternion=e;}get position(){return this._position}set position(e){if(this.unmodified=!1,3!==e.length)throw new Error("position must be a array of length 3!");this._position=e,this.updateMatrixWorld(!0);}get cartographicPosition(){const e=lc.cartesian3ToCartographic(this._position);return $(e)?e:this._position}set cartographicPosition(e){if(this.unmodified=!1,3!==e.length)throw new Error("position must be a array of length 3!");const t=lc.cartographicToCartesian3([...e]);this._position=t,this.updateMatrixWorld(!0);}get rotation(){return this._rotation}set rotation(e){this.unmodified=!1,this._rotation=e;}get scale(){return this._scale}set scale(e){this.unmodified=!1,this._scale=e,this.updateMatrixWorld(!0);}get matrix(){return this._matrix}set matrix(e){this.unmodified=!1,this._matrix=e;}get matrixWorld(){return this._matrixWorld}set matrixWorld(e){this.unmodified=!1,this._matrixWorld=e;}get modelViewMatrix(){return new Ot}get normalMatrix(){return new Ct}setMatrix(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix=e,this.matrix.decompose(this.position,this.quaternion,this.scale);}applyMatrix(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.multiplyLeft(e),this.matrix.decompose(this.position,this.quaternion,this.scale);}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromEuler(e){this.quaternion=e.getQuaternion();}setRotationFromMatrix(e){this.quaternion.fromRotationMatrix4(e);}setRotationFromQuaternion(e){this.quaternion.copy(e);}rotateOnAxis(e,t){const i=(new Tt).fromAxisRotation(e,t);return this.quaternion.multiplyRight(i),this}rotateOnWorldAxis(e,t){const i=(new Tt).fromAxisRotation(e,t);return this.quaternion.multiplyLeft(i),this}rotateX(e){return this.rotateOnAxis(cl,e)}rotateY(e){return this.rotateOnAxis(ul,e)}rotateZ(e){return this.rotateOnAxis(hl,e)}translateOnAxis(e,t){const i=new ft;return i.copy(e).applyQuaternion(this.quaternion),this.position.add(i.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(cl,e)}translateY(e){return this.translateOnAxis(ul,e)}translateZ(e){return this.translateOnAxis(hl,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.transform(this.matrixWorld.clone().invert())}lookAt(e){const t=new ft(e),i=this.parent;this.updateWorldMatrix(!0,!1);const n=new ft;n.setFromMatrixPosition(this.matrixWorld);let r=new Ot;if(this.isCamera||this.isLight?r.lookAt(n,t,this.up):r.lookAt(t,n,this.up),this.quaternion.fromRotationMatrix4(r),i){r=i.matrixWorld.clone().extractRotation();const e=(new Tt).fromRotationMatrix4(r);this.quaternion.multiplyLeft(e.invert());}}addObject3DsWithoutParent(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.addObject3DsWithoutParent(arguments[e]);return this}return e===this?(console.error("不能将自己添加为自己的child",e),this):(e&&e.isObject3D?e.parent||(e.parent=this,this.children.push(e)):console.error("添加的object必须是Object3D的类型",e),this)}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("不能将自己添加为自己的child",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e)):console.error("添加的object必须是Object3D的类型",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return -1!==t&&(e.parent=null,this.children.splice(t,1)),this}attach(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.clone().invert();return null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),t.multiplyRight(e.parent.matrixWorld)),e.applyMatrix(t),e.updateWorldMatrix(!1,!1),this.add(e),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(e,t);if(void 0!==n)return n}}getWorldPosition(e){return void 0===e&&(e=new ft),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return void 0===e&&(e=new Tt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(new ft,e,new ft),e}getWorldScale(e){return void 0===e&&(e=new ft),this.updateMatrixWorld(!0),this.matrixWorld.decompose(new ft,new ft,e),e}getWorldDirection(e){void 0===e&&(e=new ft),this.updateMatrixWorld(!0);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e);}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e);}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e));}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0;}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld=this.parent.matrixWorld.clone().multiplyRight(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].updateMatrixWorld(e);this.unmodified=!0;}updateWorldMatrix(e,t){const i=this.parent;if(!0===e&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld=this.parent.matrixWorld.clone().multiplyRight(this.matrix),!0===t){const e=this.children;for(let t=0,i=e.length;t<i;t++)e[t].updateWorldMatrix(!1,!0);}this.unmodified=!0;}clone(e){return (new this.constructor).copy(this,e)}copy(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.visible=e.visible,this.frustumCulled=e.frustumCulled,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++)this.add(e.children[t].clone());return this}}const pl=!0,fl=new ft(0,1,0);function ml(e){const t=e.transform.getCameraPos(),i=new Es(t,gl(e.canvasX,e.canvasY,.999999,e.transform)),n=Cs.rayEllipsoid(i,e.ellipsoid?e.ellipsoid:lc.DefaultEllipsoid);if(n){const t=i.origin.clone().add(i.direction.clone().multiplyScalar(n.start)),r=lc.cartesian3ToCartographic(t,e.ellipsoid?e.ellipsoid:lc.DefaultEllipsoid);return {lngLat:new li(r[0],r[1]),cartographic:r,cartesian:t,ray:i}}return {lngLat:null,cartesian:null,cartographic:null,ray:i}}function _l(e){const t=Cs.rayEllipsoid(e,lc.DefaultEllipsoid);if(t){const i=e.origin.clone().add(e.direction.clone().multiplyScalar(t.start));return {cartographic:lc.cartesian3ToCartographic(i),cartesian:i}}return {cartographic:null,cartesian:null}}function gl(e,t,i,n){const r=n.getCameraPos(),o=new wt(n.width?2*e/n.width-1:0,n.height?1-2*t/n.height:0,i,1);return function(e,t){e.transform(t.activeCamera.projectionMatrixInverse),e.scale(1/e[3]),e.transform(t.activeCamera.matrixWorld);}(o,n),new ft(o).sub(r).normalize()}function yl(e,t,i){if(t<2)return 18040095.69614729*(2-t)+18040095.69614729;if(t<=24){const n=1/Math.tan(e/2),r=1;return i*Math.sqrt(Math.pow(n,2)+Math.pow(r,2))*Math.sin(Math.PI/Math.pow(2,t)+e/2)}return 6378140.582985588-t+24}function xl(e,t,i){if(t>18040095.69614729)return 3-t/18040095.69614729;if(t<6378140.582985588)return 6378164.582985588-t;{const n=1/Math.tan(e/2),r=1,o=t/i/Math.sqrt(Math.pow(n,2)+Math.pow(r,2)),a=Math.asin(o);return Math.log2(Math.PI/(a-e/2))}}function vl(e,t,i,n,r,o,a){const s=Math.pow(2,o),l=n+e/8192,c=r+t/8192,u=di(a),h=u.xLng(l,s),d=u.yLat(c,s);return lc.cartographicToCartesian3([h,d,i])}function wl(e,t,i,n){const r=i,o=e,a=t,s=di(n);return [s.xLng(o,r),s.yLat(a,r)]}function Tl(e,t,i,n,r){const o=wl(e,t,Math.pow(2,i),n);return lc.cartographicToCartesian3([o[0],o[1],r||0])}function bl(e){const t=new Ot;return t[12]=e[0],t[13]=e[1],t[14]=e[2],t}function Pl(e,t,i){return (1-i)*e+i*t}function Sl(e,t){const i=yl(t,e[2],nt.TRANSFORM.R)-nt.TRANSFORM.R,n=function(e){const t=new ft(e.cartographic[0],e.cartographic[1],0),i=lc.cartographicToCartesian3(t),n=lc.localFrameToFixedFrame(i),r=(new Ot).rotateZ(-e.bearing*nt.TRANSFORM.DEG_TO_RAD).rotateY(-e.roll*nt.TRANSFORM.DEG_TO_RAD).rotateX(e.pitch*nt.TRANSFORM.DEG_TO_RAD),o=new ft(0,0,e.cartographic[2]).transform(r);return r[12]=o.x,r[13]=o.y,r[14]=o.z,n.multiplyRight(r),n}({cartographic:[e[0],e[1],i],bearing:e[3],pitch:e[4],roll:e.length>5?e[5]:0}),r=lc.fixedFrameToHeadingPitchRoll(n),o=lc.cartesian3ToCartographic(new ft(n[12],n[13],n[14])),a=xl(t,o[2]+nt.TRANSFORM.R,nt.TRANSFORM.R),s=(l=r.roll,c=Math.PI/2,l<0?0:l>c?c:l);var l,c;const u=Fe(r.heading,-Math.PI,Math.PI),h=Fe(r.pitch,-Math.PI,Math.PI);return [o[0],o[1],a,u*nt.TRANSFORM.RAD_TO_DEG,s*nt.TRANSFORM.RAD_TO_DEG,h*nt.TRANSFORM.RAD_TO_DEG,new ft(o)]}function Al(e){let t=Math.floor(0),i=e.height;const n=e.width/2;let r,o,a,s=ml({canvasX:n,canvasY:i,transform:e});for(r=s.ray;i>t;){const l=Math.floor((t+i)/2);if(s=ml({canvasX:n,canvasY:l,transform:e}),r=s.ray,s.lngLat?(o=[s.lngLat.lng,s.lngLat.lat,0],a=s.cartesian,i=l):t=l,i-t<4)break}return o?{cartesian:a,cartographic:o,ray:r}:null}function El(e,t,i){let n,r;const o=yl(t,e[2],nt.TRANSFORM.R)-nt.TRANSFORM.R,a=ft.fromDegrees(e[0],e[1],o),s=lc.headingPitchRollToFixedFrame(a,new ot(e[3]*nt.TRANSFORM.DEG_TO_RAD,e[4]*nt.TRANSFORM.DEG_TO_RAD,e[5]*nt.TRANSFORM.DEG_TO_RAD));if(ml({canvasX:i.width/2,canvasY:0,transform:i}).lngLat){const e=_l(new Es([s[12],s[13],s[14]],new ft(s[8],s[9],s[10]).normalize().multiplyScalar(-1)));n=e.cartographic,r=e.cartesian;}else if(ml({canvasX:i.width/2,canvasY:i.height,transform:i}).lngLat){const e=Al(i);if(!e||!e.cartographic||!e.cartesian)return null;const t=function(e){let t=Math.floor(e.height/2),i=e.height;const n=e.width/2;let r,o,a,s=ml({canvasX:n,canvasY:i,transform:e});if(r=s.ray,s.lngLat)return {cartesian:s.cartesian,cartographic:[s.lngLat.lng,s.lngLat.lat,0],ray:r};for(;i>t;){const l=Math.floor((t+i)/2);if(s=ml({canvasX:n,canvasY:l,transform:e}),r=s.ray,s.lngLat?(o=[s.lngLat.lng,s.lngLat.lat,0],a=s.cartesian,t=l):i=l,i-t<4)break}return o?{cartesian:a,cartographic:o,ray:r}:null}(i),o=e.ray,a=new Es(o.origin,ft.add(o.direction,t.ray.direction).normalize()),s=Cs.rayEllipsoid(a,lc.DefaultEllipsoid);r=a.origin.clone().add(a.direction.clone().multiplyScalar(s.start)),n=lc.cartesian3ToCartographic(r,lc.DefaultEllipsoid),n[2]=0;}else {const e=ml({canvasX:i.width/2,canvasY:i.height/2,transform:i});if(!e.lngLat)return null;n=e.cartographic,r=e.cartesian;}if(!r||!n)return null;const l=lc.localFrameToFixedFrame(r).invert().multiplyRight(s),c=new Ct;c[0]=l[0],c[1]=l[1],c[2]=l[2],c[3]=l[4],c[4]=l[5],c[5]=l[6],c[6]=l[8],c[7]=l[9],c[8]=l[10];const u=new Tt;u.fromMatrix3(c);const h=ot.fromQuaternion(u);let d=h.heading*nt.TRANSFORM.RAD_TO_DEG;Math.abs(e[3]-d)<.01&&(d=e[3]);const p=h.roll*nt.TRANSFORM.RAD_TO_DEG,f=h.pitch*nt.TRANSFORM.RAD_TO_DEG,m=xl(t,new ft(s[12]-r[0],s[13]-r[1],s[14]-r[2]).len()+nt.TRANSFORM.R,nt.TRANSFORM.R);return [n[0],n[1],m,d,p,f]}const Cl={};function Ml(e,t,i){return `Expected ${i} to be typeof ${t}, actual typeof was ${e}`}function Il(e,t,i){Cl.defined("array",e),Cl.defined("itemToFind",t),Cl.defined("comparator",i);let n,r,o=0,a=e.length-1;for(;o<=a;)if(n=~~((o+a)/2),r=i(e[n],t),r<0)o=n+1;else {if(!(r>0))return n;a=n-1;}return ~(a+1)}function Ll(e,t,i,n,r,o,a,s){this.year=e,this.month=t,this.day=i,this.hour=n,this.minute=r,this.second=o,this.millisecond=a,this.isLeapSecond=s;}function Nl(e){if(null===e||isNaN(e))throw new nl("year is required and must be a number.");return e%4==0&&e%100!=0||e%400==0}function Rl(e,t){this.julianDate=e,this.offset=t;}Cl.typeOf={},Cl.defined=function(e,t){if(!$(t))throw new nl(function(e){return `${e} is required, actual value was undefined`}(e))},Cl.typeOf.func=function(e,t){if("function"!=typeof t)throw new nl(Ml(typeof t,"function",e))},Cl.typeOf.string=function(e,t){if("string"!=typeof t)throw new nl(Ml(typeof t,"string",e))},Cl.typeOf.number=function(e,t){if("number"!=typeof t)throw new nl(Ml(typeof t,"number",e))},Cl.typeOf.number.lessThan=function(e,t,i){if(Cl.typeOf.number(e,t),t>=i)throw new nl(`Expected ${e} to be less than ${i}, actual value was ${t}`)},Cl.typeOf.number.lessThanOrEquals=function(e,t,i){if(Cl.typeOf.number(e,t),t>i)throw new nl(`Expected ${e} to be less than or equal to ${i}, actual value was ${t}`)},Cl.typeOf.number.greaterThan=function(e,t,i){if(Cl.typeOf.number(e,t),t<=i)throw new nl(`Expected ${e} to be greater than ${i}, actual value was ${t}`)},Cl.typeOf.number.greaterThanOrEquals=function(e,t,i){if(Cl.typeOf.number(e,t),t<i)throw new nl(`Expected ${e} to be greater than or equal to ${i}, actual value was ${t}`)},Cl.typeOf.object=function(e,t){if("object"!=typeof t)throw new nl(Ml(typeof t,"object",e))},Cl.typeOf.bool=function(e,t){if("boolean"!=typeof t)throw new nl(Ml(typeof t,"boolean",e))},Cl.typeOf.bigint=function(e,t){if("bigint"!=typeof t)throw new nl(Ml(typeof t,"bigint",e))},Cl.typeOf.number.equals=function(e,t,i,n){if(Cl.typeOf.number(e,i),Cl.typeOf.number(t,n),i!==n)throw new nl(`${e} must be equal to ${t}, the actual values are ${i} and ${n}`)};var Ol=Object.freeze({SECONDS_PER_MILLISECOND:.001,SECONDS_PER_MINUTE:60,MINUTES_PER_HOUR:60,HOURS_PER_DAY:24,SECONDS_PER_HOUR:3600,MINUTES_PER_DAY:1440,SECONDS_PER_DAY:86400,DAYS_PER_JULIAN_CENTURY:36525,PICOSECOND:1e-9,MODIFIED_JULIAN_DATE_DIFFERENCE:2400000.5}),Dl=Object.freeze({UTC:0,TAI:1});const Fl=new Ll,zl=[31,28,31,30,31,30,31,31,30,31,30,31];function Bl(e,t){return ec.compare(e.julianDate,t.julianDate)}const Vl=new Rl;function Ul(e){Vl.julianDate=e;const t=ec.leapSeconds;let i=Il(t,Vl,Bl);i<0&&(i=~i),i>=t.length&&(i=t.length-1);let n=t[i].offset;i>0&&ec.secondsDifference(t[i].julianDate,e)>n&&(i--,n=t[i].offset),ec.addSeconds(e,n,e);}function kl(e,t){Vl.julianDate=e;const i=ec.leapSeconds;let n=Il(i,Vl,Bl);if(n<0&&(n=~n),0===n)return ec.addSeconds(e,-i[0].offset,t);if(n>=i.length)return ec.addSeconds(e,-i[n-1].offset,t);const r=ec.secondsDifference(i[n].julianDate,e);return 0===r?ec.addSeconds(e,-i[n].offset,t):r<=1?void 0:ec.addSeconds(e,-i[--n].offset,t)}function Gl(e,t,i){const n=t/Ol.SECONDS_PER_DAY|0;return e+=n,(t-=Ol.SECONDS_PER_DAY*n)<0&&(e--,t+=Ol.SECONDS_PER_DAY),i.dayNumber=e,i.secondsOfDay=t,i}function Hl(e,t,i,n,r,o,a){const s=(t-14)/12|0,l=e+4800+s;let c=(1461*l/4|0)+(367*(t-2-12*s)/12|0)-(3*((l+100)/100|0)/4|0)+i-32075;(n-=12)<0&&(n+=24);const u=o+(n*Ol.SECONDS_PER_HOUR+r*Ol.SECONDS_PER_MINUTE+a*Ol.SECONDS_PER_MILLISECOND);return u>=43200&&(c-=1),[c,u]}const Yl=/^(\d{4})$/,ql=/^(\d{4})-(\d{2})$/,Xl=/^(\d{4})-?(\d{3})$/,jl=/^(\d{4})-?W(\d{2})-?(\d{1})?$/,Wl=/^(\d{4})-?(\d{2})-?(\d{2})$/,$l=/([Z+\-])?(\d{2})?:?(\d{2})?$/,Zl=/^(\d{2})(\.\d+)?/.source+$l.source,Kl=/^(\d{2}):?(\d{2})(\.\d+)?/.source+$l.source,Ql=/^(\d{2}):?(\d{2}):?(\d{2})(\.\d+)?/.source+$l.source,Jl="Invalid ISO 8601 date.";function ec(e,t,i){this.dayNumber=void 0,this.secondsOfDay=void 0,e=Z(e,0),t=Z(t,0),i=Z(i,Dl.UTC);const n=0|e;Gl(n,t+=(e-n)*Ol.SECONDS_PER_DAY,this),i===Dl.UTC&&Ul(this);}ec.fromGregorianDate=function(e,t){if(!(e instanceof Ll))throw new nl("date must be a valid GregorianDate.");const i=Hl(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond);return $(t)?(Gl(i[0],i[1],t),Ul(t),t):new ec(i[0],i[1],Dl.UTC)},ec.fromDate=function(e,t){if(!(e instanceof Date)||isNaN(e.getTime()))throw new nl("date must be a valid JavaScript Date.");const i=Hl(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds());return $(t)?(Gl(i[0],i[1],t),Ul(t),t):new ec(i[0],i[1],Dl.UTC)},ec.fromIso8601=function(e,t){if("string"!=typeof e)throw new nl(Jl);let i,n=(e=e.replace(",",".")).split("T"),r=1,o=1,a=0,s=0,l=0,c=0;const u=n[0],h=n[1];let d,p,f,m;if(!$(u))throw new nl(Jl);if(n=u.match(Wl),null!==n){if(f=u.split("-").length-1,f>0&&2!==f)throw new nl(Jl);i=+n[1],r=+n[2],o=+n[3];}else if(n=u.match(ql),null!==n)i=+n[1],r=+n[2];else if(n=u.match(Yl),null!==n)i=+n[1];else {let e;if(n=u.match(Xl),null!==n){if(i=+n[1],e=+n[2],p=Nl(i),e<1||p&&e>366||!p&&e>365)throw new nl(Jl)}else {if(n=u.match(jl),null===n)throw new nl(Jl);{i=+n[1];const t=+n[2],r=+n[3]||0;if(f=u.split("-").length-1,f>0&&(!$(n[3])&&1!==f||$(n[3])&&2!==f))throw new nl(Jl);e=7*t+r-new Date(Date.UTC(i,0,4)).getUTCDay()-3;}}d=new Date(Date.UTC(i,0,1)),d.setUTCDate(e),r=d.getUTCMonth()+1,o=d.getUTCDate();}if(p=Nl(i),r<1||r>12||o<1||(2!==r||!p)&&o>zl[r-1]||p&&2===r&&o>29)throw new nl(Jl);if($(h)){if(n=h.match(Ql),null!==n){if(f=h.split(":").length-1,f>0&&2!==f&&3!==f)throw new nl(Jl);a=+n[1],s=+n[2],l=+n[3],c=1e3*+(n[4]||0),m=5;}else if(n=h.match(Kl),null!==n){if(f=h.split(":").length-1,f>2)throw new nl(Jl);a=+n[1],s=+n[2],l=60*+(n[3]||0),m=4;}else {if(n=h.match(Zl),null===n)throw new nl(Jl);a=+n[1],s=60*+(n[2]||0),m=3;}if(s>=60||l>=61||a>24||24===a&&(s>0||l>0||c>0))throw new nl(Jl);const e=+n[m+1],t=+(n[m+2]||0);switch(n[m]){case"+":a-=e,s-=t;break;case"-":a+=e,s+=t;break;case"Z":break;default:s+=new Date(Date.UTC(i,r-1,o,a,s)).getTimezoneOffset();}}const _=60===l;for(_&&l--;s>=60;)s-=60,a++;for(;a>=24;)a-=24,o++;for(d=p&&2===r?29:zl[r-1];o>d;)o-=d,r++,r>12&&(r-=12,i++),d=p&&2===r?29:zl[r-1];for(;s<0;)s+=60,a--;for(;a<0;)a+=24,o--;for(;o<1;)r--,r<1&&(r+=12,i--),d=p&&2===r?29:zl[r-1],o+=d;const g=Hl(i,r,o,a,s,l,c);return $(t)?(Gl(g[0],g[1],t),Ul(t)):t=new ec(g[0],g[1],Dl.UTC),_&&ec.addSeconds(t,1,t),t},ec.now=function(e){return ec.fromDate(new Date,e)};const tc=new ec(0,0,Dl.TAI);ec.toGregorianDate=function(e,t){if(!$(e))throw new nl("julianDate is required.");let i=!1,n=kl(e,tc);$(n)||(ec.addSeconds(e,-1,tc),n=kl(tc,tc),i=!0);let r=n.dayNumber;const o=n.secondsOfDay;o>=43200&&(r+=1);let a=r+68569|0;const s=4*a/146097|0;a=a-((146097*s+3)/4|0)|0;const l=4e3*(a+1)/1461001|0;a=a-(1461*l/4|0)+31|0;const c=80*a/2447|0,u=a-(2447*c/80|0)|0;a=c/11|0;const h=c+2-12*a|0,d=100*(s-49)+l+a|0;let p=o/Ol.SECONDS_PER_HOUR|0,f=o-p*Ol.SECONDS_PER_HOUR;const m=f/Ol.SECONDS_PER_MINUTE|0;f-=m*Ol.SECONDS_PER_MINUTE;let _=0|f;const g=(f-_)/Ol.SECONDS_PER_MILLISECOND;return p+=12,p>23&&(p-=24),i&&(_+=1),$(t)?(t.year=d,t.month=h,t.day=u,t.hour=p,t.minute=m,t.second=_,t.millisecond=g,t.isLeapSecond=i,t):new Ll(d,h,u,p,m,_,g,i)},ec.toDate=function(e){if(!$(e))throw new nl("julianDate is required.");const t=ec.toGregorianDate(e,Fl);let i=t.second;return t.isLeapSecond&&(i-=1),new Date(Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,i,t.millisecond))},ec.toIso8601=function(e,t){if(!$(e))throw new nl("julianDate is required.");const i=ec.toGregorianDate(e,Fl);let n=i.year,r=i.month,o=i.day,a=i.hour;const s=i.minute,l=i.second,c=i.millisecond;let u;return 1e4===n&&1===r&&1===o&&0===a&&0===s&&0===l&&0===c&&(n=9999,r=12,o=31,a=24),$(t)||0===c?$(t)&&0!==t?(u=(.01*c).toFixed(t).replace(".","").slice(0,t),`${n.toString().padStart(4,"0")}-${r.toString().padStart(2,"0")}-${o.toString().padStart(2,"0")}T${a.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}.${u}Z`):`${n.toString().padStart(4,"0")}-${r.toString().padStart(2,"0")}-${o.toString().padStart(2,"0")}T${a.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}Z`:(u=(.01*c).toString().replace(".",""),`${n.toString().padStart(4,"0")}-${r.toString().padStart(2,"0")}-${o.toString().padStart(2,"0")}T${a.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}.${u}Z`)},ec.clone=function(e,t){if($(e))return $(t)?(t.dayNumber=e.dayNumber,t.secondsOfDay=e.secondsOfDay,t):new ec(e.dayNumber,e.secondsOfDay,Dl.TAI)},ec.compare=function(e,t){if(!$(e))throw new nl("left is required.");if(!$(t))throw new nl("right is required.");const i=e.dayNumber-t.dayNumber;return 0!==i?i:e.secondsOfDay-t.secondsOfDay},ec.equals=function(e,t){return e===t||$(e)&&$(t)&&e.dayNumber===t.dayNumber&&e.secondsOfDay===t.secondsOfDay},ec.equalsEpsilon=function(e,t,i){return i=Z(i,0),e===t||$(e)&&$(t)&&Math.abs(ec.secondsDifference(e,t))<=i},ec.totalDays=function(e){if(!$(e))throw new nl("julianDate is required.");return e.dayNumber+e.secondsOfDay/Ol.SECONDS_PER_DAY},ec.secondsDifference=function(e,t){if(!$(e))throw new nl("left is required.");if(!$(t))throw new nl("right is required.");return (e.dayNumber-t.dayNumber)*Ol.SECONDS_PER_DAY+(e.secondsOfDay-t.secondsOfDay)},ec.daysDifference=function(e,t){if(!$(e))throw new nl("left is required.");if(!$(t))throw new nl("right is required.");return e.dayNumber-t.dayNumber+(e.secondsOfDay-t.secondsOfDay)/Ol.SECONDS_PER_DAY},ec.computeTaiMinusUtc=function(e){Vl.julianDate=e;const t=ec.leapSeconds;let i=Il(t,Vl,Bl);return i<0&&(i=~i,--i,i<0&&(i=0)),t[i].offset},ec.addSeconds=function(e,t,i){if(!$(e))throw new nl("julianDate is required.");if(!$(t))throw new nl("seconds is required.");if(!$(i))throw new nl("result is required.");return Gl(e.dayNumber,e.secondsOfDay+t,i)},ec.addMinutes=function(e,t,i){if(!$(e))throw new nl("julianDate is required.");if(!$(t))throw new nl("minutes is required.");if(!$(i))throw new nl("result is required.");return Gl(e.dayNumber,e.secondsOfDay+t*Ol.SECONDS_PER_MINUTE,i)},ec.addHours=function(e,t,i){if(!$(e))throw new nl("julianDate is required.");if(!$(t))throw new nl("hours is required.");if(!$(i))throw new nl("result is required.");return Gl(e.dayNumber,e.secondsOfDay+t*Ol.SECONDS_PER_HOUR,i)},ec.addDays=function(e,t,i){if(!$(e))throw new nl("julianDate is required.");if(!$(t))throw new nl("days is required.");if(!$(i))throw new nl("result is required.");return Gl(e.dayNumber+t,e.secondsOfDay,i)},ec.lessThan=function(e,t){return ec.compare(e,t)<0},ec.lessThanOrEquals=function(e,t){return ec.compare(e,t)<=0},ec.greaterThan=function(e,t){return ec.compare(e,t)>0},ec.greaterThanOrEquals=function(e,t){return ec.compare(e,t)>=0},ec.prototype.clone=function(e){return ec.clone(this,e)},ec.prototype.equals=function(e){return ec.equals(this,e)},ec.prototype.equalsEpsilon=function(e,t){return ec.equalsEpsilon(this,e,t)},ec.prototype.toString=function(){return ec.toIso8601(this)},ec.leapSeconds=[new Rl(new ec(2441317,43210,Dl.TAI),10),new Rl(new ec(2441499,43211,Dl.TAI),11),new Rl(new ec(2441683,43212,Dl.TAI),12),new Rl(new ec(2442048,43213,Dl.TAI),13),new Rl(new ec(2442413,43214,Dl.TAI),14),new Rl(new ec(2442778,43215,Dl.TAI),15),new Rl(new ec(2443144,43216,Dl.TAI),16),new Rl(new ec(2443509,43217,Dl.TAI),17),new Rl(new ec(2443874,43218,Dl.TAI),18),new Rl(new ec(2444239,43219,Dl.TAI),19),new Rl(new ec(2444786,43220,Dl.TAI),20),new Rl(new ec(2445151,43221,Dl.TAI),21),new Rl(new ec(2445516,43222,Dl.TAI),22),new Rl(new ec(2446247,43223,Dl.TAI),23),new Rl(new ec(2447161,43224,Dl.TAI),24),new Rl(new ec(2447892,43225,Dl.TAI),25),new Rl(new ec(2448257,43226,Dl.TAI),26),new Rl(new ec(2448804,43227,Dl.TAI),27),new Rl(new ec(2449169,43228,Dl.TAI),28),new Rl(new ec(2449534,43229,Dl.TAI),29),new Rl(new ec(2450083,43230,Dl.TAI),30),new Rl(new ec(2450630,43231,Dl.TAI),31),new Rl(new ec(2451179,43232,Dl.TAI),32),new Rl(new ec(2453736,43233,Dl.TAI),33),new Rl(new ec(2454832,43234,Dl.TAI),34),new Rl(new ec(2456109,43235,Dl.TAI),35),new Rl(new ec(2457204,43236,Dl.TAI),36),new Rl(new ec(2457754,43237,Dl.TAI),37)];const ic=oi.RegularEllipsoid,nc=oi.WGS84,rc=oi.WGS84,oc=2*Math.PI/86400;let ac=new ec;const sc={normalScratch:new ft,rightScratch:new ft,upScratch:new ft,WGS84Ellipsoid:nc,RegularEllipsoid:ic,DefaultEllipsoid:rc,cartesian3ToCartographic:(e,t=rc)=>t.cartesianToCartographic(e),cartographicToCartesian3:(e,t=rc)=>t.cartographicToCartesian(e),cartographicToFixedFrame(e,t=rc){const i=t.cartographicToCartesian(e);return t.eastNorthUpToFixedFrame(i)},cartesianToFixedFrame:(e,t=rc)=>t.eastNorthUpToFixedFrame(e),localFrameToFixedFrame:(e,t=rc)=>t.eastNorthUpToFixedFrame(e),headingPitchRollToFixedFrame(e,t,i=rc){const n=new zt;return n.fromHeadingPitchRoll(t),sc.localFrameToFixedFrame(e,i).multiplyRight(n.getRotationMatrix())},fixedFrameToHeadingPitchRoll(e,t=rc){const i=e.getTranslation(),n=sc.localFrameToFixedFrame(i,t).invert(),r=e.clone().setTranslation([0,0,0]);n.multiplyRight(r);const o=(new Tt).fromRotationMatrix4(n.extractRotation());return o.normalize(),ot.fromQuaternion(o)},computeTemeToPseudoFixedMatrix(e,t){e=ec.fromDate(e),ac=ec.addSeconds(e,-ec.computeTaiMinusUtc(e),ac);const i=ac.dayNumber,n=ac.secondsOfDay;let r;const o=i-2451545;r=n>=43200?(o+.5)/Ol.DAYS_PER_JULIAN_CENTURY:(o-.5)/Ol.DAYS_PER_JULIAN_CENTURY;const a=(24110.54841+r*(8640184.812866+r*(.093104+-62e-7*r)))*oc%(2*Math.PI)+(n+.5*Ol.SECONDS_PER_DAY)%Ol.SECONDS_PER_DAY*(72921158553e-15+11772758384668e-32*(i-2451545.5)),s=Math.cos(a),l=Math.sin(a);return $(t)?(t[0]=s,t[1]=-l,t[2]=0,t[3]=0,t[4]=l,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t):new Ot([s,l,0,0,-l,s,0,0,0,0,1,0,0,0,0,1])},pointToWindowCoordinates(e,t,i){const n=i.clone().transformAsPoint(e);return n.transformAsPoint(t),new It(n)},pointToWindowCoordinatesFrontCheck(e,t,i){const n=new wt(i.x,i.y,i.z,1);n.transform(e),n.transform(t);const r=n.z>0?1:-1;return n.divideScalar(n.w),new ft(n.x,n.y,r)},pointToGLWindowCoordinates(e,t){const i=t.clone().transformAsPoint(e);return new ft(i)},eastNorthUpToFixedFrame:(e,t=rc)=>t.eastNorthUpToFixedFrame(e),rotationMatrixFromPositionVelocity(e,t,i=rc,n){const r=Z(i,rc).geodeticSurfaceNormal(e,sc.normalScratch);let o=ft.cross(t,r,sc.rightScratch);ft.equalsEpsilon(o,ft.ZERO,nt.TRANSFORM.EPSILON6)&&(o=ft.clone(ft.UNIT_X,o));const a=ft.cross(o,t,sc.upScratch);return ft.normalize(a,a),ft.cross(t,a,o),ft.negate(o,o),ft.normalize(o,o),$(n)||(n=new Ct),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=o.x,n[4]=o.y,n[5]=o.z,n[6]=a.x,n[7]=a.y,n[8]=a.z,n},convertV34Pos2V4:e=>Sl(e,nt.TRANSFORM.FOV_IN_RADIANS),convertMapCenterOptions2CameraPositionOptions:e=>sc.convertV34Pos2V4(e),convertV4Pos2V34:e=>El(e,nt.TRANSFORM.FOV_IN_RADIANS),convertV4Pos2V34Traversal:(e,t)=>El(e,nt.TRANSFORM.FOV_IN_RADIANS,t),convertCameraPositionOptions2MapCenterOptions:e=>sc.convertV4Pos2V34(e),convertMapCenterFromCameraPosition:e=>function(e){const t=lc.cartographicToFixedFrame(e);return _l(new Es([t[12],t[13],t[14]],new ft(t[8],t[9],t[10]).normalize().multiplyScalar(-1)))}(e),convertMapCenterFromCameraCartesian3Position:e=>function(e){const t=lc.localFrameToFixedFrame(e);return _l(new Es([t[12],t[13],t[14]],new ft(t[8],t[9],t[10]).normalize().multiplyScalar(-1)))}(e)};var lc=sc;function cc(){return !0}function uc(e,t){function i(){throw new Error(t)}for(const t in e)"function"==typeof e[t]&&(e[t]=i);e.isDestroyed=cc;}var hc=Object.freeze({DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_ASTC_4x4_WEBGL:37808,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_BPTC_UNORM:36492,HALF_FLOAT_OES:36193,DOUBLE:5130,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,CESIUM_3D_TILE_MASK:128,SKIP_LOD_MASK:112,SKIP_LOD_BIT_SHIFT:4,CLASSIFICATION_MASK:15});class dc{constructor(e){this._ellipsoid=Z(e,oi.WGS84),this._semimajorAxis=this._ellipsoid.maximumRadius,this._oneOverSemimajorAxis=1/this._semimajorAxis;}get ellipsoid(){return this._ellipsoid}project(e,t){const i=this._semimajorAxis,n=e.longitude*i,r=e.latitude*i,o=e.height;return $(t)?(t.x=n,t.y=r,t.z=o,t):new ft(n,r,o)}unproject(e,t){const i=this._oneOverSemimajorAxis,n=e.x*i,r=e.y*i,o=e.z;return $(t)?(t.longitude=n,t.latitude=r,t.height=o,t):new _s(n,r,o)}}const pc=new ft,fc=new ft,mc=new ft,_c=new ft,gc=new ft,yc=new ft,xc=new ft,vc=new ft,wc=new ft,Tc=new ft,bc=new ft,Pc=new ft,Sc=new ft,Ac=new ft,Ec=new dc,Cc=new ft,Mc=new ft,Ic=new _s(0,0,0),Lc=new _s(0,0,0),Nc=[],Rc=new ft,Oc=new ft,Dc=new ft,Fc=new ft,zc=new ft,Bc=new ft,Vc=new ft,Uc=new ft,kc=new ft,Gc=new dc,Hc=new ft,Yc=new ft,qc=new ft,Xc=new ft,jc=new ft,Wc=new _s,$c=new Array(8);for(let e=0;e<8;++e)$c[e]=new ft;class Zc{constructor(e=[0,0,0],t=0){this.radius=-0,this.center=new ft,this.fromCenterRadius(e,t);}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=pc.from(t),this.center=(new ft).from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.radius===e.radius}clone(e){return Zc.clone(this,e)}union(e){const t=this.center,i=this.radius,n=e.radius,r=pc.copy(e.center).subtract(t),o=r.magnitude();if(i>=o+n)return this.clone();if(n>=o+i)return e.clone();const a=.5*(i+o+n);return fc.copy(r).scale((-i+a)/o).add(t),this.center.copy(fc),this.radius=a,this}expand(e){const t=(e=pc.from(e)).subtract(this.center).magnitude();return t>this.radius&&(this.radius=t),this}transform(e){this.center.transform(e);const t=function(e,t){var i=t[4],n=t[5],r=t[6],o=t[8],a=t[9],s=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(i,n,r),e[2]=Math.hypot(o,a,s),e}(pc,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}computePlaneDistances(e,t,i){return Zc.computePlaneDistances(this,e,t,i)}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const t=(e=pc.from(e)).subtract(this.center);return Math.max(0,t.len()-this.radius)}intersectPlane(e){const t=this.radius,i=e.normal.dot(this.center)+e.distance;return i<-t?Ya.OUTSIDE:i<t?Ya.INTERSECTING:Ya.INSIDE}setFromPoints(e){if(!e||0==e.length)return this;let t;if(o(e[0])&&e[0]instanceof ft)t=e;else {t=[];for(let i=0;i<e.length;i+=3)t.push(new ft(e[i],e[i+1],e[i+2]));}return Zc.fromPoints(t,this)}static fromPoints(e,t){if($(t)||(t=new Zc),!$(e)||0===e.length)return t.center=ft.clone(ft.ZERO,t.center),t.radius=0,t;const i=ft.clone(e[0],wc),n=ft.clone(i,mc),r=ft.clone(i,_c),o=ft.clone(i,gc),a=ft.clone(i,yc),s=ft.clone(i,xc),l=ft.clone(i,vc),c=e.length;let u;for(u=1;u<c;u++){ft.clone(e[u],i);const t=i.x,c=i.y,h=i.z;t<n.x&&ft.clone(i,n),t>a.x&&ft.clone(i,a),c<r.y&&ft.clone(i,r),c>s.y&&ft.clone(i,s),h<o.z&&ft.clone(i,o),h>l.z&&ft.clone(i,l);}const h=ft.magnitudeSquared(ft.subtract(a,n,Tc)),d=ft.magnitudeSquared(ft.subtract(s,r,Tc)),p=ft.magnitudeSquared(ft.subtract(l,o,Tc));let f=n,m=a,_=h;d>_&&(_=d,f=r,m=s),p>_&&(_=p,f=o,m=l);const g=bc;g.x=.5*(f.x+m.x),g.y=.5*(f.y+m.y),g.z=.5*(f.z+m.z);let y=ft.magnitudeSquared(ft.subtract(m,g,Tc)),x=Math.sqrt(y);const v=Pc;v.x=n.x,v.y=r.y,v.z=o.z;const w=Sc;w.x=a.x,w.y=s.y,w.z=l.z;const T=ft.midpoint(v,w,Ac);let b=0;for(u=0;u<c;u++){ft.clone(e[u],i);const t=ft.magnitude(ft.subtract(i,T,Tc));t>b&&(b=t);const n=ft.magnitudeSquared(ft.subtract(i,g,Tc));if(n>y){const e=Math.sqrt(n);x=.5*(x+e),y=x*x;const t=e-x;g.x=(x*g.x+t*i.x)/e,g.y=(x*g.y+t*i.y)/e,g.z=(x*g.z+t*i.z)/e;}}return x<b?(ft.clone(g,t.center),t.radius=x):(ft.clone(T,t.center),t.radius=b),t}static fromRectangle2D(e,t,i){return Zc.fromRectangleWithHeights2D(e,t,0,0,i)}static fromRectangleWithHeights2D(e,t,i,n,r){if($(r)||(r=new Zc),!$(e))return r.center=ft.clone(ft.ZERO,r.center),r.radius=0,r;t=Z(t,Ec),gs.southwest(e,Ic),Ic.height=i,gs.northeast(e,Lc),Lc.height=n;const o=t.project(Ic,Cc),a=t.project(Lc,Mc),s=a.x-o.x,l=a.y-o.y,c=a.z-o.z;r.radius=.5*Math.sqrt(s*s+l*l+c*c);const u=r.center;return u.x=o.x+.5*s,u.y=o.y+.5*l,u.z=o.z+.5*c,r}static fromRectangle3D(e,t,i,n){if(t=Z(t,oi.WGS84),i=Z(i,0),$(n)||(n=new Zc),!$(e))return n.center=ft.clone(ft.ZERO,n.center),n.radius=0,n;const r=gs.subsample(e,t,i,Nc);return Zc.fromPoints(r,n)}static fromVertices(e,t,i,n){if($(n)||(n=new Zc),!$(e)||0===e.length)return n.center=ft.clone(ft.ZERO,n.center),n.radius=0,n;t=Z(t,ft.ZERO),i=Z(i,3);const r=wc;r.x=e[0]+t.x,r.y=e[1]+t.y,r.z=e[2]+t.z;const o=ft.clone(r,mc),a=ft.clone(r,_c),s=ft.clone(r,gc),l=ft.clone(r,yc),c=ft.clone(r,xc),u=ft.clone(r,vc),h=e.length;let d;for(d=0;d<h;d+=i){const i=e[d]+t.x,n=e[d+1]+t.y,h=e[d+2]+t.z;r.x=i,r.y=n,r.z=h,i<o.x&&ft.clone(r,o),i>l.x&&ft.clone(r,l),n<a.y&&ft.clone(r,a),n>c.y&&ft.clone(r,c),h<s.z&&ft.clone(r,s),h>u.z&&ft.clone(r,u);}const p=ft.magnitudeSquared(ft.subtract(l,o,Tc)),f=ft.magnitudeSquared(ft.subtract(c,a,Tc)),m=ft.magnitudeSquared(ft.subtract(u,s,Tc));let _=o,g=l,y=p;f>y&&(y=f,_=a,g=c),m>y&&(y=m,_=s,g=u);const x=bc;x.x=.5*(_.x+g.x),x.y=.5*(_.y+g.y),x.z=.5*(_.z+g.z);let v=ft.magnitudeSquared(ft.subtract(g,x,Tc)),w=Math.sqrt(v);const T=Pc;T.x=o.x,T.y=a.y,T.z=s.z;const b=Sc;b.x=l.x,b.y=c.y,b.z=u.z;const P=ft.midpoint(T,b,Ac);let S=0;for(d=0;d<h;d+=i){r.x=e[d]+t.x,r.y=e[d+1]+t.y,r.z=e[d+2]+t.z;const i=ft.magnitude(ft.subtract(r,P,Tc));i>S&&(S=i);const n=ft.magnitudeSquared(ft.subtract(r,x,Tc));if(n>v){const e=Math.sqrt(n);w=.5*(w+e),v=w*w;const t=e-w;x.x=(w*x.x+t*r.x)/e,x.y=(w*x.y+t*r.y)/e,x.z=(w*x.z+t*r.z)/e;}}return w<S?(ft.clone(x,n.center),n.radius=w):(ft.clone(P,n.center),n.radius=S),n}static fromEncodedCartesianVertices(e,t,i){if($(i)||(i=new Zc),!$(e)||!$(t)||e.length!==t.length||0===e.length)return i.center=ft.clone(ft.ZERO,i.center),i.radius=0,i;const n=wc;n.x=e[0]+t[0],n.y=e[1]+t[1],n.z=e[2]+t[2];const r=ft.clone(n,mc),o=ft.clone(n,_c),a=ft.clone(n,gc),s=ft.clone(n,yc),l=ft.clone(n,xc),c=ft.clone(n,vc),u=e.length;let h;for(h=0;h<u;h+=3){const i=e[h]+t[h],u=e[h+1]+t[h+1],d=e[h+2]+t[h+2];n.x=i,n.y=u,n.z=d,i<r.x&&ft.clone(n,r),i>s.x&&ft.clone(n,s),u<o.y&&ft.clone(n,o),u>l.y&&ft.clone(n,l),d<a.z&&ft.clone(n,a),d>c.z&&ft.clone(n,c);}const d=ft.magnitudeSquared(ft.subtract(s,r,Tc)),p=ft.magnitudeSquared(ft.subtract(l,o,Tc)),f=ft.magnitudeSquared(ft.subtract(c,a,Tc));let m=r,_=s,g=d;p>g&&(g=p,m=o,_=l),f>g&&(g=f,m=a,_=c);const y=bc;y.x=.5*(m.x+_.x),y.y=.5*(m.y+_.y),y.z=.5*(m.z+_.z);let x=ft.magnitudeSquared(ft.subtract(_,y,Tc)),v=Math.sqrt(x);const w=Pc;w.x=r.x,w.y=o.y,w.z=a.z;const T=Sc;T.x=s.x,T.y=l.y,T.z=c.z;const b=ft.midpoint(w,T,Ac);let P=0;for(h=0;h<u;h+=3){n.x=e[h]+t[h],n.y=e[h+1]+t[h+1],n.z=e[h+2]+t[h+2];const i=ft.magnitude(ft.subtract(n,b,Tc));i>P&&(P=i);const r=ft.magnitudeSquared(ft.subtract(n,y,Tc));if(r>x){const e=Math.sqrt(r);v=.5*(v+e),x=v*v;const t=e-v;y.x=(v*y.x+t*n.x)/e,y.y=(v*y.y+t*n.y)/e,y.z=(v*y.z+t*n.z)/e;}}return v<P?(ft.clone(y,i.center),i.radius=v):(ft.clone(b,i.center),i.radius=P),i}static fromCornerPoints(e,t,i){$(i)||(i=new Zc);const n=ft.midpoint(e,t,i.center);return i.radius=ft.distance(n,t),i}static fromEllipsoid(e,t){return $(t)||(t=new Zc),ft.clone(ft.ZERO,t.center),t.radius=e.maximumRadius,t}static fromBoundingSpheres(e,t){if($(t)||(t=new Zc),!$(e)||0===e.length)return t.center=ft.clone(ft.ZERO,t.center),t.radius=0,t;const i=e.length;if(1===i)return Zc.clone(e[0],t);if(2===i)return Zc.union(e[0],e[1],t);const n=[];let r;for(r=0;r<i;r++)n.push(e[r].center);const o=(t=Zc.fromPoints(n,t)).center;let a=t.radius;for(r=0;r<i;r++){const t=e[r];a=Math.max(a,ft.distance(o,t.center,Rc)+t.radius);}return t.radius=a,t}static fromOrientedBoundingBox(e,t){$(t)||(t=new Zc);const i=e.halfAxes,n=Ct.getColumn(i,0,Oc),r=Ct.getColumn(i,1,Dc),o=Ct.getColumn(i,2,Fc);return ft.add(n,r,n),ft.add(n,o,n),t.center=ft.clone(e.center,t.center),t.radius=ft.magnitude(n),t}static clone(e,t){if($(e))return $(t)?(t.center=ft.clone(e.center,t.center),t.radius=e.radius,t):new Zc(e.center,e.radius)}static pack(e,t,i){i=Z(i,0);const n=e.center;return t[i++]=n.x,t[i++]=n.y,t[i++]=n.z,t[i]=e.radius,t}static unpack(e,t,i){t=Z(t,0),$(i)||(i=new Zc);const n=i.center;return n.x=e[t++],n.y=e[t++],n.z=e[t++],i.radius=e[t],i}static union(e,t,i){$(i)||(i=new Zc);const n=e.center,r=e.radius,o=t.radius,a=ft.subtract(t.center,n,zc),s=ft.magnitude(a);if(r>=s+o)return Zc.clone(e,i),i;if(o>=s+r)return Zc.clone(t,i),i;const l=.5*(r+s+o),c=ft.multiplyByScalar(a,(-r+l)/s,Bc);return ft.add(c,n,c),ft.clone(c,i.center),i.radius=l,i}static expand(e,t,i){i=Zc.clone(e,i);const n=ft.magnitude(ft.subtract(t,i.center,Vc));return n>i.radius&&(i.radius=n),i}static intersectPlane(e,t){const i=e.radius,n=ft.dot(t.normal,e.center)+t.distance;return n<-i?Ya.OUTSIDE:n<i?Ya.INTERSECTING:Ya.INSIDE}static transform(e,t,i){return $(i)||(i=new Zc),i.center=Ot.multiplyByPoint(t,e.center,i.center),i.radius=Ot.getMaximumScale(t)*e.radius,i}static distanceSquaredTo(e,t){const i=ft.subtract(e.center,t,Uc),n=ft.magnitude(i)-e.radius;return n<=0?0:n*n}static transformWithoutScale(e,t,i){return $(i)||(i=new Zc),i.center=Ot.multiplyByPoint(t,e.center,i.center),i.radius=e.radius,i}static computePlaneDistances(e,t,i,n){$(n)||(n=new Kc);const r=ft.subtract(e.center,t,kc),o=ft.dot(i,r);return n.start=o-e.radius,n.stop=o+e.radius,n}static projectTo2D(e,t,i){const n=(t=Z(t,Gc)).ellipsoid;let r=e.center;const o=e.radius;let a;a=ft.equals(r,ft.ZERO)?ft.clone(ft.UNIT_X,Hc):n.geodeticSurfaceNormal(r,Hc);const s=ft.cross(ft.UNIT_Z,a,Yc);ft.normalize(s,s);const l=ft.cross(a,s,qc);ft.normalize(l,l),ft.multiplyByScalar(a,o,a),ft.multiplyByScalar(l,o,l),ft.multiplyByScalar(s,o,s);const c=ft.negate(l,jc),u=ft.negate(s,Xc),h=$c;let d=h[0];ft.add(a,l,d),ft.add(d,s,d),d=h[1],ft.add(a,l,d),ft.add(d,u,d),d=h[2],ft.add(a,c,d),ft.add(d,u,d),d=h[3],ft.add(a,c,d),ft.add(d,s,d),ft.negate(a,a),d=h[4],ft.add(a,l,d),ft.add(d,s,d),d=h[5],ft.add(a,l,d),ft.add(d,u,d),d=h[6],ft.add(a,c,d),ft.add(d,u,d),d=h[7],ft.add(a,c,d),ft.add(d,s,d);const p=h.length;for(let e=0;e<p;++e){const i=h[e];ft.add(r,i,i);const o=n.cartesianToCartographic(i,Wc);t.project(o,i);}r=(i=Zc.fromPoints(h,i)).center;const f=r.x,m=r.y;return r.x=r.z,r.y=f,r.z=m,i}static equals(e,t){return e===t||$(e)&&$(t)&&ft.equals(e.center,t.center)&&e.radius===t.radius}getBoundingMaximum(){return {boundingMaxValue:new ft(this.center.x+this.radius,this.center.y+this.radius,this.center.z+this.radius),boundingMinValue:new ft(this.center.x-this.radius,this.center.y-this.radius,this.center.z-this.radius)}}}function Kc(e,t){this.start=Z(e,0),this.stop=Z(t,0);}Zc.packedLength=4;const Qc=new ft,Jc=new ft;class eu{constructor(e=[0,0,0],t=[0,0,0],i=null){i=i||Qc.copy(e).add(t).scale(.5),this.center=new ft(i),this.halfDiagonal=new ft(t).subtract(this.center),this.minimum=new ft(e),this.maximum=new ft(t);}setFromPoints(e){if(!o(e)||0===e.length)return this;let t;if(o(e[0]))t=e;else {t=[];for(let i=0;i<e.length;i+=3)t.push(new ft(e[i],e[i+1],e[i+2]));}return eu.fromPoints(t,this)}clone(){return new eu(this.minimum,this.maximum,this.center)}equals(e){return this===e||Boolean(e)&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:t}=this,i=Jc.from(e.normal),n=t.x*Math.abs(i.x)+t.y*Math.abs(i.y)+t.z*Math.abs(i.z),r=this.center.dot(i)+e.distance;return r-n>0?Ya.INSIDE:r+n<0?Ya.OUTSIDE:Ya.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=Qc.from(e).subtract(this.center),{halfDiagonal:i}=this;let n,r=0;return n=Math.abs(t.x)-i.x,n>0&&(r+=n*n),n=Math.abs(t.y)-i.y,n>0&&(r+=n*n),n=Math.abs(t.z)-i.z,n>0&&(r+=n*n),r}getBoundingMaximum(e=1){return {boundingMinValue:this.minimum.clone().multiplyByScalar(e),boundingMaxValue:this.maximum.clone().multiplyByScalar(e)}}static fromPoints(e,t){let i;if(o(e[0])&&e[0]instanceof ft)i=e;else {i=[];for(let t=0;t<e.length;t+=3)i.push(new ft(e[t],e[t+1],e[t+2]));}if($(t)||(t=new eu),!$(i)||0===i.length)return t.minimum=ft.clone(ft.ZERO,t.minimum),t.maximum=ft.clone(ft.ZERO,t.maximum),t.center=ft.clone(ft.ZERO,t.center),t.halfDiagonal=ft.clone(ft.ZERO,t.halfDiagonal),t;let n=i[0].x,r=i[0].y,a=i[0].z,s=i[0].x,l=i[0].y,c=i[0].z;const u=i.length;for(let e=1;e<u;e++){const t=i[e],o=t.x,u=t.y,h=t.z;n=Math.min(o,n),s=Math.max(o,s),r=Math.min(u,r),l=Math.max(u,l),a=Math.min(h,a),c=Math.max(h,c);}const h=t.minimum;h.x=n,h.y=r,h.z=a;const d=t.maximum;return d.x=s,d.y=l,d.z=c,t.center=ft.midpoint(h,d,t.center),t.halfDiagonal=new ft(t.maximum).subtract(t.center),t}static clone(e){return new eu(e.minimum,e.maximum,e.center)}}const tu=new wt,iu=new eu,nu=new Es,ru=new ft,ou=new ft;class au{constructor(e,t){e=(t=Z(t,oi.WGS84)).scaleToGeodeticSurface(e);const i=lc.eastNorthUpToFixedFrame(e,t);this._ellipsoid=t,this._origin=e,this._xAxis=ft.fromCartesian4(Ot.getColumn(i,0,tu)),this._yAxis=ft.fromCartesian4(Ot.getColumn(i,1,tu));const n=ft.fromCartesian4(Ot.getColumn(i,2,tu));this._plane=ja.fromPointNormal(e,n);}get ellipsoid(){return this._ellipsoid}get origin(){return this._origin}get plane(){return this._plane}get xAxis(){return this._xAxis}get yAxis(){return this._yAxis}get zAxis(){return this._plane.normal}static fromPoints(e,t){const i=eu.fromPoints(e,iu);return new au(i.center,t)}projectPointOntoPlane(e,t){const i=nu;i.origin=e,ft.normalize(e,i.direction);let n=Cs.rayPlane(i,this._plane,ru);if($(n)||(ft.negate(i.direction,i.direction),n=Cs.rayPlane(i,this._plane,ru)),$(n)){const e=ft.subtract(n,this._origin,n),i=ft.dot(this._xAxis,e),r=ft.dot(this._yAxis,e);return $(t)?(t.x=i,t.y=r,t):new It(i,r)}}projectPointsOntoPlane(e,t){$(t)||(t=[]);let i=0;const n=e.length;for(let r=0;r<n;r++){const n=this.projectPointOntoPlane(e[r],t[i]);$(n)&&(t[i]=n,i++);}return t.length=i,t}projectPointToNearestOnPlane(e,t){$(t)||(t=new It);const i=nu;i.origin=e,ft.clone(this._plane.normal,i.direction);let n=Cs.rayPlane(i,this._plane,ru);$(n)||(ft.negate(i.direction,i.direction),n=Cs.rayPlane(i,this._plane,ru));const r=ft.subtract(n,this._origin,n),o=ft.dot(this._xAxis,r),a=ft.dot(this._yAxis,r);return t.x=o,t.y=a,t}projectPointsToNearestOnPlane(e,t){$(t)||(t=[]);const i=e.length;t.length=i;for(let n=0;n<i;n++)t[n]=this.projectPointToNearestOnPlane(e[n],t[n]);return t}projectPointOntoEllipsoid(e,t){$(t)||(t=new ft);const i=this._ellipsoid,n=this._origin,r=this._yAxis,o=ou;return ft.multiplyByScalar(this._xAxis,e.x,o),t=ft.add(n,o,t),ft.multiplyByScalar(r,e.y,o),ft.add(t,o,t),i.scaleToGeocentricSurface(t,t),t}projectPointsOntoEllipsoid(e,t){const i=e.length;$(t)?t.length=i:t=new Array(i);for(let n=0;n<i;++n)t[n]=this.projectPointOntoEllipsoid(e[n],t[n]);return t}}const su=new ft,lu=new ft,cu=new ft,uu=new ft,hu=new ft,du=new ft,pu=new ft,fu=new ft,mu=new ft,_u=new ft;class gu{constructor(e=[0,0,0],t=[0,0,0,0,0,0,0,0,0]){this.center=(new ft).from(e),this.halfAxes=new Ct(t);}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return [new ft(e).len(),new ft(t).len(),new ft(i).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),n=new ft(e).normalize(),r=new ft(t).normalize(),o=new ft(i).normalize();return (new Tt).fromMatrix3(new Ct([...n,...r,...o]))}fromCenterHalfSizeQuaternion(e,t,i){const n=new Tt(i),r=(new Ct).fromQuaternion(n);return r[0]=r[0]*t[0],r[1]=r[1]*t[0],r[2]=r[2]*t[0],r[3]=r[3]*t[1],r[4]=r[4]*t[1],r[5]=r[5]*t[1],r[6]=r[6]*t[2],r[7]=r[7]*t[2],r[8]=r[8]*t[2],this.center=(new ft).from(e),this.halfAxes=r,this}clone(){return new gu(this.center,this.halfAxes)}equals(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Zc){const t=this.halfAxes,i=t.getColumn(0,cu),n=t.getColumn(1,uu),r=t.getColumn(2,hu),o=su.copy(i).add(n).add(r);return e.center.copy(this.center),e.radius=o.magnitude(),e}getBoundingMaximum(e){e=e||1;const t=new ft(this.halfAxes[0],this.halfAxes[1],this.halfAxes[2]).scale(e),i=new ft(this.halfAxes[3],this.halfAxes[4],this.halfAxes[5]).scale(e),n=new ft(this.halfAxes[6],this.halfAxes[7],this.halfAxes[8]).scale(e),r=ft.add(ft.add(t,i),n);return {boundingMaxValue:ft.add(this.center,r),boundingMinValue:ft.subtract(this.center,r)}}intersectPlane(e){const t=this.center,i=e.normal,n=this.halfAxes,r=i.x,o=i.y,a=i.z,s=Math.abs(r*n[At.COL0ROW0]+o*n[At.COL0ROW1]+a*n[At.COL0ROW2])+Math.abs(r*n[At.COL1ROW0]+o*n[At.COL1ROW1]+a*n[At.COL1ROW2])+Math.abs(r*n[At.COL2ROW0]+o*n[At.COL2ROW1]+a*n[At.COL2ROW2]),l=i.dot(t)+e.distance;return l<=-s?Ya.OUTSIDE:l>=s?Ya.INSIDE:Ya.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=lu.from(e).subtract(this.center),i=this.halfAxes,n=i.getColumn(0,cu),r=i.getColumn(1,uu),o=i.getColumn(2,hu),a=n.magnitude(),s=r.magnitude(),l=o.magnitude();n.normalize(),r.normalize(),o.normalize();let c,u=0;return c=Math.abs(t.dot(n))-a,c>0&&(u+=c*c),c=Math.abs(t.dot(r))-s,c>0&&(u+=c*c),c=Math.abs(t.dot(o))-l,c>0&&(u+=c*c),u}computePlaneDistances(e,t,i){return gu.computePlaneDistances(this,e,t,i)}static computePlaneDistances(e,t,i,n){$(n)||(n=new Kc);let r=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;const a=e.center,s=e.halfAxes,l=Ct.getColumn(s,0,fu),c=Ct.getColumn(s,1,mu),u=Ct.getColumn(s,2,_u),h=ft.add(l,c,du);ft.add(h,u,h),ft.add(h,a,h);const d=ft.subtract(h,t,pu);let p=ft.dot(i,d);return r=Math.min(p,r),o=Math.max(p,o),ft.add(a,l,h),ft.add(h,c,h),ft.subtract(h,u,h),ft.subtract(h,t,d),p=ft.dot(i,d),r=Math.min(p,r),o=Math.max(p,o),ft.add(a,l,h),ft.subtract(h,c,h),ft.add(h,u,h),ft.subtract(h,t,d),p=ft.dot(i,d),r=Math.min(p,r),o=Math.max(p,o),ft.add(a,l,h),ft.subtract(h,c,h),ft.subtract(h,u,h),ft.subtract(h,t,d),p=ft.dot(i,d),r=Math.min(p,r),o=Math.max(p,o),ft.subtract(a,l,h),ft.add(h,c,h),ft.add(h,u,h),ft.subtract(h,t,d),p=ft.dot(i,d),r=Math.min(p,r),o=Math.max(p,o),ft.subtract(a,l,h),ft.add(h,c,h),ft.subtract(h,u,h),ft.subtract(h,t,d),p=ft.dot(i,d),r=Math.min(p,r),o=Math.max(p,o),ft.subtract(a,l,h),ft.subtract(h,c,h),ft.add(h,u,h),ft.subtract(h,t,d),p=ft.dot(i,d),r=Math.min(p,r),o=Math.max(p,o),ft.subtract(a,l,h),ft.subtract(h,c,h),ft.subtract(h,u,h),ft.subtract(h,t,d),p=ft.dot(i,d),r=Math.min(p,r),o=Math.max(p,o),n.start=r,n.stop=o,n}transform(e){this.center.transformAsPoint(e);const t=e.clone();t[12]=0,t[13]=0,t[14]=0,t[15]=1;const i=this.halfAxes.getColumn(0,cu);i.transformAsPoint(t);const n=this.halfAxes.getColumn(1,uu);n.transformAsPoint(t);const r=this.halfAxes.getColumn(2,hu);return r.transformAsPoint(t),this.halfAxes=new Ct([...i,...n,...r]),this}getTransform(){return Ot.fromRotationTranslation(this.halfAxes,this.center)}static fromRectangle(e,t,i,n,r){const o=new _s,a=new ft,s=new _s,l=new _s,c=new _s,u=new _s,h=new _s,d=new ft,p=new ft,f=new ft,m=new ft,_=new ft,g=new It,y=new It,x=new It,v=new It,w=new It,T=new ft,b=new ft,P=new ft,S=new ft,A=new It,E=new ft,C=new ft,M=new ft,I=new ja(ft.UNIT_X,0);let L,N,R,O,D,F,z;if(t=Z(t,0),i=Z(i,0),n=Z(n,oi.WGS84),e.width<=nt.CesiumMath.PI){const T=gs.center(e,o),b=n.cartographicToCartesianInRadians(T,a),P=new au(b,n);z=P.plane;const S=T.longitude,A=e.south<0&&e.north>0?0:T.latitude,E=_s.fromRadians(S,e.north,i,s),C=_s.fromRadians(e.west,e.north,i,l),M=_s.fromRadians(e.west,A,i,c),I=_s.fromRadians(e.west,e.south,i,u),B=_s.fromRadians(S,e.south,i,h),V=n.cartographicToCartesianInRadians(E,d);let U=n.cartographicToCartesianInRadians(C,p);const k=n.cartographicToCartesianInRadians(M,f);let G=n.cartographicToCartesianInRadians(I,m);const H=n.cartographicToCartesianInRadians(B,_),Y=P.projectPointToNearestOnPlane(V,g),q=P.projectPointToNearestOnPlane(U,y),X=P.projectPointToNearestOnPlane(k,x),j=P.projectPointToNearestOnPlane(G,v),W=P.projectPointToNearestOnPlane(H,w);return L=Math.min(q.x,X.x,j.x),N=-L,O=Math.max(q.y,Y.y),R=Math.min(j.y,W.y),C.height=I.height=t,U=n.cartographicToCartesianInRadians(C,p),G=n.cartographicToCartesianInRadians(I,m),D=Math.min(ja.getPointDistance(z,U),ja.getPointDistance(z,G)),F=i,xu(P.origin,P.xAxis,P.yAxis,P.zAxis,L,N,R,O,D,F,r)}const B=e.south>0,V=e.north<0,U=B?e.south:V?e.north:0,k=gs.center(e,o).longitude,G=ft.fromRadians(k,U,i,n,T);G.z=0;const H=Math.abs(G.x)<nt.CesiumMath.EPSILON10&&Math.abs(G.y)<nt.CesiumMath.EPSILON10?ft.UNIT_X:ft.normalize(G,b),Y=ft.UNIT_Z,q=ft.cross(H,Y,P);z=ja.fromPointNormal(G,H,I);const X=ft.fromRadians(k+nt.CesiumMath.PI_OVER_TWO,U,i,n,S);N=ft.dot(ja.projectPointOntoPlane(z,X,A),q),L=-N,O=ft.fromRadians(0,e.north,V?t:i,n,E).z,R=ft.fromRadians(0,e.south,B?t:i,n,C).z;const j=ft.fromRadians(e.east,U,i,n,M);return D=ja.getPointDistance(z,j),F=0,xu(G,q,Y,H,L,N,R,O,D,F,r)}setFromPoints(e){let t;if(o(e[0])&&e[0]instanceof ft)t=e;else {t=[];for(let i=0;i<e.length;i+=3)t.push(new ft(e[i],e[i+1],e[i+2]));}return gu.fromPoints(t,this)}static fromPoints(e,t){const i=new ft,n=new ft,r=new ft,o=new ft,a=new ft,s=new ft,l=new Ct,c={unitary:new Ct,diagonal:new Ct};if($(t)||(t=new gu),!$(e)||0===e.length)return t.halfAxes=Ct.ZERO,t.center=ft.ZERO,t;let u;const h=e.length,d=ft.clone(e[0],i);for(u=1;u<h;u++)ft.add(d,e[u],d);const p=1/h;ft.multiplyByScalar(d,p,d);let f,m=0,_=0,g=0,y=0,x=0,v=0;for(u=0;u<h;u++)f=ft.subtract(e[u],d,n),m+=f.x*f.x,_+=f.x*f.y,g+=f.x*f.z,y+=f.y*f.y,x+=f.y*f.z,v+=f.z*f.z;m*=p,_*=p,g*=p,y*=p,x*=p,v*=p;const w=l;w[0]=m,w[1]=_,w[2]=g,w[3]=_,w[4]=y,w[5]=x,w[6]=g,w[7]=x,w[8]=v;const T=Ct.computeEigenDecomposition(w,c),b=Ct.clone(T.unitary,t.halfAxes);let P=Ct.getColumn(b,0,o),S=Ct.getColumn(b,1,a),A=Ct.getColumn(b,2,s),E=-Number.MAX_VALUE,C=-Number.MAX_VALUE,M=-Number.MAX_VALUE,I=Number.MAX_VALUE,L=Number.MAX_VALUE,N=Number.MAX_VALUE;for(u=0;u<h;u++)f=e[u],E=Math.max(ft.dot(P,f),E),C=Math.max(ft.dot(S,f),C),M=Math.max(ft.dot(A,f),M),I=Math.min(ft.dot(P,f),I),L=Math.min(ft.dot(S,f),L),N=Math.min(ft.dot(A,f),N);P=ft.multiplyByScalar(P,.5*(I+E),P),S=ft.multiplyByScalar(S,.5*(L+C),S),A=ft.multiplyByScalar(A,.5*(N+M),A);const R=ft.add(P,S,t.center);ft.add(R,A,R);const O=r;return O.x=E-I,O.y=C-L,O.z=M-N,ft.multiplyByScalar(O,.5,O),Ct.multiplyByScale(t.halfAxes,O,t.halfAxes),t}static clone(e){return new gu(e.center,e.halfAxes)}static computeCorners(e,t){const i=new ft,n=new ft,r=new ft;$(t)||(t=[new ft,new ft,new ft,new ft,new ft,new ft,new ft,new ft]);const o=e.center,a=e.halfAxes,s=Ct.getColumn(a,0,i),l=Ct.getColumn(a,1,n),c=Ct.getColumn(a,2,r);return ft.clone(o,t[0]),ft.subtract(t[0],s,t[0]),ft.subtract(t[0],l,t[0]),ft.subtract(t[0],c,t[0]),ft.clone(o,t[1]),ft.subtract(t[1],s,t[1]),ft.subtract(t[1],l,t[1]),ft.add(t[1],c,t[1]),ft.clone(o,t[2]),ft.subtract(t[2],s,t[2]),ft.add(t[2],l,t[2]),ft.subtract(t[2],c,t[2]),ft.clone(o,t[3]),ft.subtract(t[3],s,t[3]),ft.add(t[3],l,t[3]),ft.add(t[3],c,t[3]),ft.clone(o,t[4]),ft.add(t[4],s,t[4]),ft.subtract(t[4],l,t[4]),ft.subtract(t[4],c,t[4]),ft.clone(o,t[5]),ft.add(t[5],s,t[5]),ft.subtract(t[5],l,t[5]),ft.add(t[5],c,t[5]),ft.clone(o,t[6]),ft.add(t[6],s,t[6]),ft.add(t[6],l,t[6]),ft.subtract(t[6],c,t[6]),ft.clone(o,t[7]),ft.add(t[7],s,t[7]),ft.add(t[7],l,t[7]),ft.add(t[7],c,t[7]),t}computeCorners(e){return gu.computeCorners(this,e)}union(e,t){if(!(e instanceof gu))throw new Error("包围盒的类型不正确！");$(t)||(t=new gu);let i=[];const n=gu.computeCorners(this),r=gu.computeCorners(e);return i=i.concat(n,r),gu.fromPoints(i,t)}static union(e,t,i){if(!(e instanceof gu&&t instanceof gu))throw new Error("包围盒的类型不正确！");$(i)||(i=new gu);let n=[];const r=gu.computeCorners(e),o=gu.computeCorners(t);return n=n.concat(r,o),gu.fromPoints(n)}}const yu=new ft;function xu(e,t,i,n,r,o,a,s,l,c,u){$(u)||(u=new gu);const h=u.halfAxes;Ct.setColumn(h,0,t,h),Ct.setColumn(h,1,i,h),Ct.setColumn(h,2,n,h);let d=lu;d.x=(r+o)/2,d.y=(a+s)/2,d.z=(l+c)/2;const p=yu;p.x=(o-r)/2,p.y=(s-a)/2,p.z=(c-l)/2;const f=u.center;return d=Ct.multiplyByVector(h,d,d),ft.add(e,d,f),Ct.multiplyByScale(h,p,h),u}const vu={_maximumCombinedTextureImageUnits:0,_maximumCubeMapSize:0,_maximumFragmentUniformVectors:0,_maximumTextureImageUnits:0,_maximumRenderbufferSize:0,_maximumTextureSize:0,_maximumVaryingVectors:0,_maximumVertexAttributes:0,_maximumVertexTextureImageUnits:0,_maximumVertexUniformVectors:0,_minimumAliasedLineWidth:0,_maximumAliasedLineWidth:0,_minimumAliasedPointSize:0,_maximumAliasedPointSize:0,_maximumViewportWidth:0,_maximumViewportHeight:0,_maximumTextureFilterAnisotropy:0,_maximumDrawBuffers:0,_maximumColorAttachments:0,_highpFloatSupported:!1,_highpIntSupported:!1};Object.defineProperties(vu,{maximumCombinedTextureImageUnits:{get:()=>vu._maximumCombinedTextureImageUnits},maximumCubeMapSize:{get:()=>vu._maximumCubeMapSize},maximumFragmentUniformVectors:{get:()=>vu._maximumFragmentUniformVectors},maximumTextureImageUnits:{get:()=>vu._maximumTextureImageUnits},maximumRenderbufferSize:{get:()=>vu._maximumRenderbufferSize},maximumTextureSize:{get:()=>vu._maximumTextureSize},maximumVaryingVectors:{get:()=>vu._maximumVaryingVectors},maximumVertexAttributes:{get:()=>vu._maximumVertexAttributes},maximumVertexTextureImageUnits:{get:()=>vu._maximumVertexTextureImageUnits},maximumVertexUniformVectors:{get:()=>vu._maximumVertexUniformVectors},minimumAliasedLineWidth:{get:()=>vu._minimumAliasedLineWidth},maximumAliasedLineWidth:{get:()=>vu._maximumAliasedLineWidth},minimumAliasedPointSize:{get:()=>vu._minimumAliasedPointSize},maximumAliasedPointSize:{get:()=>vu._maximumAliasedPointSize},maximumViewportWidth:{get:()=>vu._maximumViewportWidth},maximumViewportHeight:{get:()=>vu._maximumViewportHeight},maximumTextureFilterAnisotropy:{get:()=>vu._maximumTextureFilterAnisotropy},maximumDrawBuffers:{get:()=>vu._maximumDrawBuffers},maximumColorAttachments:{get:()=>vu._maximumColorAttachments},highpFloatSupported:{get:()=>vu._highpFloatSupported},highpIntSupported:{get:()=>vu._highpIntSupported}});const wu={NEAREST:hc.NEAREST,LINEAR:hc.LINEAR,validate:function(e){return e===wu.NEAREST||e===wu.LINEAR}};var Tu=Object.freeze(wu);const bu={NEAREST:hc.NEAREST,LINEAR:hc.LINEAR,NEAREST_MIPMAP_NEAREST:hc.NEAREST_MIPMAP_NEAREST,LINEAR_MIPMAP_NEAREST:hc.LINEAR_MIPMAP_NEAREST,NEAREST_MIPMAP_LINEAR:hc.NEAREST_MIPMAP_LINEAR,LINEAR_MIPMAP_LINEAR:hc.LINEAR_MIPMAP_LINEAR,validate:function(e){return e===bu.NEAREST||e===bu.LINEAR||e===bu.NEAREST_MIPMAP_NEAREST||e===bu.LINEAR_MIPMAP_NEAREST||e===bu.NEAREST_MIPMAP_LINEAR||e===bu.LINEAR_MIPMAP_LINEAR}};var Pu=Object.freeze(bu);const Su={CLAMP_TO_EDGE:hc.CLAMP_TO_EDGE,REPEAT:hc.REPEAT,MIRRORED_REPEAT:hc.MIRRORED_REPEAT,validate:e=>e===Su.CLAMP_TO_EDGE||e===Su.REPEAT||e===Su.MIRRORED_REPEAT};var Au=Object.freeze(Su);class Eu{constructor(e){const t=(e=e||{}).wrapS||Au.CLAMP_TO_EDGE,i=e.wrapT||Au.CLAMP_TO_EDGE,n=e.minificationFilter||Pu.LINEAR,r=e.magnificationFilter||Tu.LINEAR,o=$(e.maximumAnisotropy)?e.maximumAnisotropy:1;if(!Au.validate(t))throw new nl("Invalid sampler.wrapS.");if(!Au.validate(i))throw new nl("Invalid sampler.wrapT.");if(!Pu.validate(n))throw new nl("Invalid sampler.minificationFilter.");if(!Tu.validate(r))throw new nl("Invalid sampler.magnificationFilter.");this._wrapS=t,this._wrapT=i,this._minificationFilter=n,this._magnificationFilter=r,this._maximumAnisotropy=o;}get wrapS(){return this._wrapS}get wrapT(){return this._wrapT}get minificationFilter(){return this._minificationFilter}get magnificationFilter(){return this._magnificationFilter}get maximumAnisotropy(){return this._maximumAnisotropy}static equals(e,t){return e===t||$(e)&&$(t)&&e._wrapS===t._wrapS&&e._wrapT===t._wrapT&&e._minificationFilter===t._minificationFilter&&e._magnificationFilter===t._magnificationFilter&&e._maximumAnisotropy===t._maximumAnisotropy}}Eu.NEAREST=Object.freeze(new Eu({wrapS:Au.CLAMP_TO_EDGE,wrapT:Au.CLAMP_TO_EDGE,minificationFilter:Pu.NEAREST,magnificationFilter:Tu.NEAREST}));const Cu={ALPHA:nt.COLORTYPEANDLENGTH.ALPHA,RGB:nt.COLORTYPEANDLENGTH.RGB,RGBA:nt.COLORTYPEANDLENGTH.RGBA,LUMINANCE:nt.COLORTYPEANDLENGTH.LUMINANCE,LUMINANCE_ALPHA:nt.COLORTYPEANDLENGTH.LUMINANCE_ALPHA,RGB_DXT1:nt.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_S3TC.COMPRESSED_RGB_S3TC_DXT1_EXT,RGBA_DXT1:nt.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_S3TC.COMPRESSED_RGBA_S3TC_DXT1_EXT,RGBA_DXT3:nt.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_S3TC.COMPRESSED_RGBA_S3TC_DXT3_EXT,RGBA_DXT5:nt.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_S3TC.COMPRESSED_RGBA_S3TC_DXT5_EXT,RGB_PVRTC_4BPPV1:nt.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_PVRTC.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,RGB_PVRTC_2BPPV1:nt.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_PVRTC.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,RGBA_PVRTC_4BPPV1:nt.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_PVRTC.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,RGBA_PVRTC_2BPPV1:nt.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_PVRTC.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,RGB_ETC1:nt.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_ETC1_WEBGL,isCompressedFormat(e){let t;return t=Array.isArray(e)&&e.length>0?e[0].format:e.format||"",t===Cu.RGB_DXT1||t===Cu.RGBA_DXT1||t===Cu.RGBA_DXT3||t===Cu.RGBA_DXT5||t===Cu.RGB_PVRTC_4BPPV1||t===Cu.RGB_PVRTC_2BPPV1||t===Cu.RGBA_PVRTC_4BPPV1||t===Cu.RGBA_PVRTC_2BPPV1||t===Cu.RGB_ETC1},isDXTFormat:e=>e===Cu.RGB_DXT1||e===Cu.RGBA_DXT1||e===Cu.RGBA_DXT3||e===Cu.RGBA_DXT5,isPVRTCFormat:e=>e===Cu.RGB_PVRTC_4BPPV1||e===Cu.RGB_PVRTC_2BPPV1||e===Cu.RGBA_PVRTC_4BPPV1||e===Cu.RGBA_PVRTC_2BPPV1,isETC1Format:e=>e===Cu.RGB_ETC1,compressedTextureSizeInBytes(e,t,i){switch(e){case Cu.RGB_DXT1:case Cu.RGBA_DXT1:case Cu.RGB_ETC1:return Math.floor((t+3)/4)*Math.floor((i+3)/4)*8;case Cu.RGBA_DXT3:case Cu.RGBA_DXT5:return Math.floor((t+3)/4)*Math.floor((i+3)/4)*16;case Cu.RGB_PVRTC_4BPPV1:case Cu.RGBA_PVRTC_4BPPV1:return Math.floor((Math.max(t,8)*Math.max(i,8)*4+7)/8);case Cu.RGB_PVRTC_2BPPV1:case Cu.RGBA_PVRTC_2BPPV1:return Math.floor((Math.max(t,16)*Math.max(i,8)*2+7)/8);default:return 0}},componentsLength(e){switch(e){case Cu.RGB:return 3;case Cu.RGBA:return 4;case Cu.LUMINANCE_ALPHA:return 2;default:return 1}},textureSizeInBytes(e,t,i,n){let r=Cu.componentsLength(e);return Cu.isPacked(t)&&(r=1),r*Cu.sizeInBytes(t)*i*n},sizeInBytes(e){switch(e){case nt.PixelDatatype.UNSIGNED_BYTE:return 1;case nt.PixelDatatype.UNSIGNED_SHORT:case nt.PixelDatatype.UNSIGNED_SHORT_4_4_4_4:case nt.PixelDatatype.UNSIGNED_SHORT_5_5_5_1:case nt.PixelDatatype.UNSIGNED_SHORT_5_6_5:case nt.PixelDatatype.HALF_FLOAT:return 2;case nt.PixelDatatype.UNSIGNED_INT:case nt.PixelDatatype.FLOAT:case nt.PixelDatatype.UNSIGNED_INT_24_8:return 4}},isPacked:e=>e===nt.PixelDatatype.UNSIGNED_INT_24_8||e===nt.PixelDatatype.UNSIGNED_SHORT_4_4_4_4||e===nt.PixelDatatype.UNSIGNED_SHORT_5_5_5_1||e===nt.PixelDatatype.UNSIGNED_SHORT_5_6_5},Mu={UNSIGNED_BYTE:hc.UNSIGNED_BYTE,UNSIGNED_SHORT:hc.UNSIGNED_SHORT,UNSIGNED_INT:hc.UNSIGNED_INT,FLOAT:hc.FLOAT,HALF_FLOAT:hc.HALF_FLOAT_OES,UNSIGNED_INT_24_8:hc.UNSIGNED_INT_24_8,UNSIGNED_SHORT_4_4_4_4:hc.UNSIGNED_SHORT_4_4_4_4,UNSIGNED_SHORT_5_5_5_1:hc.UNSIGNED_SHORT_5_5_5_1,UNSIGNED_SHORT_5_6_5:hc.UNSIGNED_SHORT_5_6_5,toWebGLConstant(e,t){switch(e){case Mu.UNSIGNED_BYTE:return hc.UNSIGNED_BYTE;case Mu.UNSIGNED_SHORT:return hc.UNSIGNED_SHORT;case Mu.UNSIGNED_INT:return hc.UNSIGNED_INT;case Mu.FLOAT:return hc.FLOAT;case Mu.HALF_FLOAT:return t.webgl2?hc.HALF_FLOAT:hc.HALF_FLOAT_OES;case Mu.UNSIGNED_INT_24_8:return hc.UNSIGNED_INT_24_8;case Mu.UNSIGNED_SHORT_4_4_4_4:return hc.UNSIGNED_SHORT_4_4_4_4;case Mu.UNSIGNED_SHORT_5_5_5_1:return hc.UNSIGNED_SHORT_5_5_5_1;case Mu.UNSIGNED_SHORT_5_6_5:return Mu.UNSIGNED_SHORT_5_6_5}},isPacked:e=>e===Mu.UNSIGNED_INT_24_8||e===Mu.UNSIGNED_SHORT_4_4_4_4||e===Mu.UNSIGNED_SHORT_5_5_5_1||e===Mu.UNSIGNED_SHORT_5_6_5,sizeInBytes(e){switch(e){case Mu.UNSIGNED_BYTE:return 1;case Mu.UNSIGNED_SHORT:case Mu.UNSIGNED_SHORT_4_4_4_4:case Mu.UNSIGNED_SHORT_5_5_5_1:case Mu.UNSIGNED_SHORT_5_6_5:case Mu.HALF_FLOAT:return 2;case Mu.UNSIGNED_INT:case Mu.FLOAT:case Mu.UNSIGNED_INT_24_8:return 4}},validate:e=>e===Mu.UNSIGNED_BYTE||e===Mu.UNSIGNED_SHORT||e===Mu.UNSIGNED_INT||e===Mu.FLOAT||e===Mu.HALF_FLOAT||e===Mu.UNSIGNED_INT_24_8||e===Mu.UNSIGNED_SHORT_4_4_4_4||e===Mu.UNSIGNED_SHORT_5_5_5_1||e===Mu.UNSIGNED_SHORT_5_6_5};var Iu=Object.freeze(Mu);const Lu={DEPTH_COMPONENT:hc.DEPTH_COMPONENT,DEPTH_STENCIL:hc.DEPTH_STENCIL,ALPHA:hc.ALPHA,RGB:hc.RGB,RGBA:hc.RGBA,LUMINANCE:hc.LUMINANCE,LUMINANCE_ALPHA:hc.LUMINANCE_ALPHA,RGB_DXT1:hc.COMPRESSED_RGB_S3TC_DXT1_EXT,RGBA_DXT1:hc.COMPRESSED_RGBA_S3TC_DXT1_EXT,RGBA_DXT3:hc.COMPRESSED_RGBA_S3TC_DXT3_EXT,RGBA_DXT5:hc.COMPRESSED_RGBA_S3TC_DXT5_EXT,RGB_PVRTC_4BPPV1:hc.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,RGB_PVRTC_2BPPV1:hc.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,RGBA_PVRTC_4BPPV1:hc.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,RGBA_PVRTC_2BPPV1:hc.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,RGBA_ASTC:hc.COMPRESSED_RGBA_ASTC_4x4_WEBGL,RGB_ETC1:hc.COMPRESSED_RGB_ETC1_WEBGL,RGB8_ETC2:hc.COMPRESSED_RGB8_ETC2,RGBA8_ETC2_EAC:hc.COMPRESSED_RGBA8_ETC2_EAC,RGBA_BC7:hc.COMPRESSED_RGBA_BPTC_UNORM,componentsLength:function(e){switch(e){case Lu.RGB:return 3;case Lu.RGBA:return 4;case Lu.LUMINANCE_ALPHA:return 2;default:return 1}},validate:function(e){return e===Lu.DEPTH_COMPONENT||e===Lu.DEPTH_STENCIL||e===Lu.ALPHA||e===Lu.RGB||e===Lu.RGBA||e===Lu.LUMINANCE||e===Lu.LUMINANCE_ALPHA||e===Lu.RGB_DXT1||e===Lu.RGBA_DXT1||e===Lu.RGBA_DXT3||e===Lu.RGBA_DXT5||e===Lu.RGB_PVRTC_4BPPV1||e===Lu.RGB_PVRTC_2BPPV1||e===Lu.RGBA_PVRTC_4BPPV1||e===Lu.RGBA_PVRTC_2BPPV1||e===Lu.RGBA_ASTC||e===Lu.RGB_ETC1||e===Lu.RGB8_ETC2||e===Lu.RGBA8_ETC2_EAC||e===Lu.RGBA_BC7},isColorFormat:function(e){return e===Lu.ALPHA||e===Lu.RGB||e===Lu.RGBA||e===Lu.LUMINANCE||e===Lu.LUMINANCE_ALPHA},isDepthFormat:function(e){return e===Lu.DEPTH_COMPONENT||e===Lu.DEPTH_STENCIL},isCompressedFormat:function(e){return e===Lu.RGB_DXT1||e===Lu.RGBA_DXT1||e===Lu.RGBA_DXT3||e===Lu.RGBA_DXT5||e===Lu.RGB_PVRTC_4BPPV1||e===Lu.RGB_PVRTC_2BPPV1||e===Lu.RGBA_PVRTC_4BPPV1||e===Lu.RGBA_PVRTC_2BPPV1||e===Lu.RGBA_ASTC||e===Lu.RGB_ETC1||e===Lu.RGB8_ETC2||e===Lu.RGBA8_ETC2_EAC||e===Lu.RGBA_BC7},isDXTFormat:function(e){return e===Lu.RGB_DXT1||e===Lu.RGBA_DXT1||e===Lu.RGBA_DXT3||e===Lu.RGBA_DXT5},isPVRTCFormat:function(e){return e===Lu.RGB_PVRTC_4BPPV1||e===Lu.RGB_PVRTC_2BPPV1||e===Lu.RGBA_PVRTC_4BPPV1||e===Lu.RGBA_PVRTC_2BPPV1},isASTCFormat:function(e){return e===Lu.RGBA_ASTC},isETC1Format:function(e){return e===Lu.RGB_ETC1},isETC2Format:function(e){return e===Lu.RGB8_ETC2||e===Lu.RGBA8_ETC2_EAC},isBC7Format:function(e){return e===Lu.RGBA_BC7},compressedTextureSizeInBytes:function(e,t,i){switch(e){case Lu.RGB_DXT1:case Lu.RGBA_DXT1:case Lu.RGB_ETC1:case Lu.RGB8_ETC2:return Math.floor((t+3)/4)*Math.floor((i+3)/4)*8;case Lu.RGBA_DXT3:case Lu.RGBA_DXT5:case Lu.RGBA_ASTC:case Lu.RGBA8_ETC2_EAC:return Math.floor((t+3)/4)*Math.floor((i+3)/4)*16;case Lu.RGB_PVRTC_4BPPV1:case Lu.RGBA_PVRTC_4BPPV1:return Math.floor((Math.max(t,8)*Math.max(i,8)*4+7)/8);case Lu.RGB_PVRTC_2BPPV1:case Lu.RGBA_PVRTC_2BPPV1:return Math.floor((Math.max(t,16)*Math.max(i,8)*2+7)/8);case Lu.RGBA_BC7:return Math.ceil(t/4)*Math.ceil(i/4)*16;default:return 0}},textureSizeInBytes:function(e,t,i,n){let r=Lu.componentsLength(e);return Iu.isPacked(t)&&(r=1),r*Iu.sizeInBytes(t)*i*n},alignmentInBytes:function(e,t,i){const n=Lu.textureSizeInBytes(e,t,i,1)%4;return 0===n?4:2===n?2:1},createTypedArray:function(e,t,i,n){let r;const o=Iu.sizeInBytes(t);return r=o===Uint8Array.BYTES_PER_ELEMENT?Uint8Array:o===Uint16Array.BYTES_PER_ELEMENT?Uint16Array:o===Float32Array.BYTES_PER_ELEMENT&&t===Iu.FLOAT?Float32Array:Uint32Array,new r(Lu.componentsLength(e)*i*n)},flipY:function(e,t,i,n,r){if(1===r)return e;const o=Lu.createTypedArray(t,i,n,r),a=Lu.componentsLength(t),s=n*a;for(let t=0;t<r;++t){const i=t*n*a,l=(r-t-1)*n*a;for(let t=0;t<s;++t)o[l+t]=e[i+t];}return o},toInternalFormat:function(e,t,i){if(!i.webgl2)return e;if(e===Lu.DEPTH_STENCIL)return hc.DEPTH24_STENCIL8;if(e===Lu.DEPTH_COMPONENT){if(t===Iu.UNSIGNED_SHORT)return e;if(t===Iu.UNSIGNED_INT)return hc.DEPTH_COMPONENT24}if(t===Iu.FLOAT)switch(e){case Lu.RGBA:return hc.RGBA32F;case Lu.RGB:return hc.RGB32F;case Lu.RG:return hc.RG32F;case Lu.R:return hc.R32F}if(t===Iu.HALF_FLOAT)switch(e){case Lu.RGBA:return hc.RGBA16F;case Lu.RGB:return hc.RGB16F;case Lu.RG:return hc.RG16F;case Lu.R:return hc.R16F}return e}};var Nu=Object.freeze(Lu);const Ru={supported:!1,testSupport:function(e){!Fu&&Du&&(zu?Bu(e):Ou=e);}};let Ou,Du,Fu=!1,zu=!1;function Bu(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Du),e.isContextLost())return;Ru.supported=!0;}catch(e){}e.deleteTexture(t),Fu=!0;}function Vu(e,t){if(t&&-1!==t.indexOf("?")){const i=t.split("?")[1],n=new RegExp(`(^|&)${e}=([^&]*)(&|$)`),r=i.match(n);if(null!=r)return unescape(r[2])}return null}function Uu(e,t,i){if(1===arguments.length)return e;e.set(e.subarray(t+i),t);}function ku(e){const t=e.responseURL||e.__responseURL,i=e.response,n=i?i.byteLength:0,r=Vu("token",t)||"",o=Vu("appKey",t)||"",a=Vu("key",t)||"";return n>8?Gu(i,n,a.length>0?a:o.length>0?o:r,e):i}function Gu(e,t,i,n){let r=new Uint8Array(e);if("MEMM"===String.fromCharCode.apply(null,r.subarray(0,4))){const t=new Uint8Array([r[4],r[5],r[6],r[7]]),i=new Uint32Array(t.buffer);r=new Uint8Array(e,16+i[0]);const o=new Uint8Array(e,16,i),a=String.fromCharCode.apply(null,o),s=JSON.parse(a);n.bbx=s;}const o=String.fromCharCode.apply(null,r.subarray(r.length-8,r.length)),a=String.fromCharCode.apply(null,r.subarray(0,9));if(o&&"minedata"===o.toLowerCase())return i&&function(e,t){const i=e.length-8;if(i<=t)for(let t=0;t<i/2;t++){const n=e[t];e[t]=e[i-t-1],e[i-t-1]=n;}else {const n=parseInt(i/t),r=parseInt(t/2);for(let i=0;i<n;i++){const n=i*t,o=(i+1)*t-1;for(let t=n,i=0;t<n+r;t++,i++){const n=o-i,r=e[t];e[t]=e[n],e[n]=r;}}}}(r,function(e){let t=0;const i=e.length;for(let n=0;n<i;n++)t+=e.charCodeAt(n);return parseInt(t/i)}(i)),r.slice(0,t-8);if(a&&"mineearth"===a.toLowerCase()){const e=r[9],t=r[10];return function(e,t,i){const n=e.length-t*i,r=Math.floor(n/t);let o=0,a=r;for(let n=0;n<t;n++)Uu(e,a,i),o=a,a=o+r;return e.subarray(0,n)}(r.slice(11,r.length),e,t)}return r=null,e}J.document&&(Du=J.document.createElement("img"),Du.onload=function(){Ou&&Bu(Ou),Ou=null,zu=!0;},Du.onerror=function(){Fu=!0,Ou=null;},Du.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Hu=new Set,Yu={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",PanoramaImage:"PanoramaImage",PanoramaJson:"PanoramaJson"};"function"==typeof Object.freeze&&Object.freeze(Yu);class qu extends Error{constructor(e,t,i){401===t&&i.includes("minemap")&&(e+=": you may have provided an invalid MineMap key."),super(e),this.status=t,this.url=i;}toString(){return `${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Xu=Ke()?()=>self.worker&&self.worker.referrer:()=>("blob:"===J.location.protocol?J.parent:J).location.href,ju=function(e,t){if(!(/^file:/.test(i=e.url)||/^file:/.test(Xu())&&!/^\w+:/.test(i))){if(J.fetch&&J.Request&&J.AbortController&&J.Request.prototype.hasOwnProperty("signal"))return function(e,t){const i=new J.AbortController,n=new J.Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:Xu(),signal:i.signal});let r=!1,o=!1;"json"===e.type&&n.headers.set("Accept","application/json");return o||(Hu.has(n.url)?t(new Error("error")):J.fetch(n).then((i=>i.ok?(i=>{("arrayBuffer"===e.type?i.arrayBuffer():"json"===e.type?i.json():i.text()).then((n=>{if(o)return;r=!0;let a=n;const s=i.url.includes("png")||i.url.includes("jpg");let l;"arrayBuffer"!==e.type||s||(l={responseURL:i.url,response:n,bbx:null},a=ku(l),l.bbx&&(l.bbx.minimumHeight=l.bbx.minHeight,l.bbx.maximumHeight=l.bbx.maxHeight,delete l.bbx.minHeight,delete l.bbx.maxHeight)),t(null,a,i.headers.get("Cache-Control"),i.headers.get("Expires"),l?.bbx);})).catch((e=>{o||t(new Error(e.message));}));})(i):(i.text(),r=!0,t(new qu(i.statusText,i.status,e.url))))).catch((e=>{20!==e.code&&(Hu.add(n.url),t(new Error(e.message)));}))),{cancel:()=>{o=!0,r||i.abort();}}}(e,t);if(Ke()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var i;return function(e,t){const i=new J.XMLHttpRequest;i.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(i.responseType="arraybuffer");for(const t in e.headers)i.setRequestHeader(t,e.headers[t]);return "json"===e.type&&(i.responseType="text",i.setRequestHeader("Accept","application/json")),i.withCredentials="include"===e.credentials,i.onerror=()=>{t(new Error(i.statusText));},i.onload=()=>{if((i.status>=200&&i.status<300||0===i.status)&&null!==i.response){let n=i.response;if("json"===e.type)try{n=JSON.parse(i.response);}catch(e){return t(e)}let r=n;const o=e.url.includes("png")||e.url.includes("jpg");"arrayBuffer"!==e.type||o||(r=ku(i)),t(null,r,i.getResponseHeader("Cache-Control"),i.getResponseHeader("Expires"));}else t(new qu(i.statusText,i.status,e.url));},i.send(e.body),{cancel:()=>i.abort()}}(e,t)},Wu=function(e,t){return ju(ze(e,{type:"arrayBuffer"}),t)};function $u(e){const t=J.document.createElement("a");return t.href=e,t.protocol===J.document.location.protocol&&t.host===J.document.location.host}function Zu(e,t){const i=new J.Image,n=J.URL;let r=new J.Blob([e],{type:"image/png"});i.onload=()=>{e=null,r=null,t(null,i),n.revokeObjectURL(i.src),i.onload=null,i.src=null;},i.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),i.src=e?.byteLength?n.createObjectURL(r):nt.SOURCE.TRANSPARENT_PNG_URL;}let Ku,Qu,Ju=!1;Ku=[],Qu=0;const eh=function(e,t){if(Ru.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Qu>=nt.SOURCE.MAX_PARALLEL_IMAGE_REQUESTS){const i={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0;}};return Ku.push(i),i}Qu++;let i=!1;const n=()=>{if(!i)for(i=!0,Qu--;Ku.length&&Qu<nt.SOURCE.MAX_PARALLEL_IMAGE_REQUESTS;){const e=Ku.shift(),{requestParameters:t,callback:i,cancelled:n}=e;n||(e.cancel=eh(t,i).cancel);}},r=Wu(e,((i,r,o,a)=>{n(),i?t(i):r&&(!J.createImageBitmap||e.isImageBitmap||e.isImageBitmap?Zu(r,((e,i)=>t(e,i,o,a))):function(e,t,i){if(Ju)return Zu(e,((e,t)=>i(e,t)));let n=new J.Blob([e],{type:"image/png"});J.createImageBitmap(n,t).then((t=>{n=null,e=null,i(null,t);})).catch((()=>{Ju=!0,Zu(e,((e,t)=>i(e,t)));}));}(r,e.imageBitmapOptions,((e,i)=>t(e,i,o,a))));}));return {cancel:()=>{r.cancel(),n();}}},{HTMLImageElement:th,HTMLCanvasElement:ih,HTMLVideoElement:nh,ImageData:rh,ImageBitmap:oh}=J;class ah{constructor(e){const{map:t,context:i,pixelFormat:n,compressed:r,premultiply:o,flipY:a,texUrl:s,name:l,target:c,pixelDatatype:u,sampler:h}=e;this.map=Z(t,null),null!=i&&null!=i||!this.map||(this.context=this.map.painter.context);let d=e.image;this.mIsGenerateMipmap=!1,this.anisotropy=Math.min(vu._maximumTextureFilterAnisotropy,void 0===e.anisotropy?vu._maximumTextureFilterAnisotropy:e.anisotropy),s&&(this.texUrl=s),e.warpS&&(this.warpS=e.warpS),e.warpT&&(this.warpT=e.warpT),e.minFilter&&(this.minFilter=e.minFilter),e.magFilter&&(this.magFilter=e.magFilter),this.referenceCount=1,this.name=l||"",i&&(this.context=i),this.pixelFormat=Z(n,Nu.RGBA),this.pixelDatatype=Z(u,Iu.UNSIGNED_BYTE),this.internalFormat=Nu.toInternalFormat(this.pixelFormat,this.pixelDatatype,this.context),this.texture=this.context.gl.createTexture(),this._powerOfTwoCalculated=!1,this.powerOfTwoNoneSquareFlag=!1,this.flipY=!!a,this.premultiply=!!o,r?(this.compressed=r,d={data:d[0].data,width:d[0].width,height:d[0].height},Cu.isDXTFormat(n)&&!this.context._s3tc?We("When options.pixelFormat is S3TC compressed, this WebGL implementation must support the WEBGL_texture_compression_s3tc extension. Check context.s3tc."):Cu.isPVRTCFormat(n)&&!this.context._pvrtc?We("When options.pixelFormat is PVRTC compressed, this WebGL implementation must support the WEBGL_texture_compression_pvrtc extension. Check context.pvrtc."):Cu.isETC1Format(n)&&!this.context._etc1&&We("When options.pixelFormat is ETC1 compressed, this WebGL implementation must support the WEBGL_texture_compression_etc1 extension. Check context.etc1.")):this.compressed=!1,this._target=c||hc.TEXTURE_2D,this._hasSetSampler=!1,this.update(d,e),h&&(this.sampler=h);}update(e,t){const i=e?.width||t.width,n=e?.height||t.height,r=!this.size||this.size[0]!==i||this.size[1]!==n,{context:o}=this,{gl:a}=o;if(this.useMipmap=Boolean(t?.useMipmap),this.premultiply=Boolean(t?.premultiply),null==i&&null==n&&this.map)this.useMipmap=Z(t?.useMipmap,!0);else {if(a.bindTexture(this._target,this.texture),o.pixelStoreUnpackFlipY.set(this.flipY),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.premultiply),r)if(this.size=[i,n],this.compressed)a.compressedTexImage2D(this._target,0,this.internalFormat,i,n,0,e.data);else if(t&&t.hasOwnProperty("framebuffer"))a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),null!==t.framebuffer&&t.framebuffer._bind(),a.copyTexImage2D(this._target,0,this.internalFormat,t.xOffset,t.yOffset,i,n,0),null!==t.framebuffer&&t.framebuffer._unBind();else if(e?.arrayBufferView){let t=4;t=Nu.alignmentInBytes(this.pixelFormat,this.pixelDatatype,i),a.pixelStorei(a.UNPACK_ALIGNMENT,t),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),a.texImage2D(this._target,0,this.internalFormat,i,n,0,this.pixelFormat,Iu.toWebGLConstant(this.pixelDatatype,o),e.arrayBufferView);}else if(o.pixelStoreUnpackPremultiplyAlpha.set(this.premultiply),e instanceof th||e instanceof ih||e instanceof nh||e instanceof rh||oh&&e instanceof oh)a.texImage2D(this._target,0,this.internalFormat,this.pixelFormat,Iu.toWebGLConstant(this.pixelDatatype,o),e);else {let t=4;t=Nu.alignmentInBytes(this.pixelFormat,this.pixelDatatype,i),a.pixelStorei(a.UNPACK_ALIGNMENT,t),a.texImage2D(this._target,0,this.internalFormat,i,n,0,this.pixelFormat,Iu.toWebGLConstant(this.pixelDatatype,o),e?.data);}else e instanceof th||e instanceof ih||e instanceof nh||e instanceof rh||oh&&e instanceof oh?a.texSubImage2D(this._target,0,0,0,this.pixelFormat,Iu.toWebGLConstant(this.pixelDatatype,o),e):a.texSubImage2D(this._target,0,0,0,i,n,this.pixelFormat,Iu.toWebGLConstant(this.pixelDatatype,o),e?.data);e=null,r&&(this._powerOfTwoCalculated=!1),this.isSizePowerOfTwoNoneSquare()&&this.useMipmap?(a.generateMipmap(this._target),this.mIsGenerateMipmap=!0):this.mIsGenerateMipmap=!1,this._dimensions=new It(i,n),this._width=i,this._height=n;}}get width(){return this._width}get height(){return this._height}get sampler(){return this._sampler}get dimensions(){return this._dimensions}set sampler(e){if(this._hasSetSampler)return;this._hasSetSampler=!0;let t=e.minificationFilter,i=e.magnificationFilter;const n=this.context;let r=e.wrapS,o=e.wrapT;this.isSizePowerOfTwoNoneSquare()||(t!==hc.LINEAR_MIPMAP_NEAREST&&t!==hc.LINEAR_MIPMAP_LINEAR&&t!==hc.NEAREST_MIPMAP_NEAREST&&t!==hc.NEAREST_MIPMAP_LINEAR||(t=hc.LINEAR),r===hc.REPEAT&&(r=hc.CLAMP_TO_EDGE),o===hc.REPEAT&&(o=hc.CLAMP_TO_EDGE)),t&&i||(this.isSizePowerOfTwoNoneSquare()&&this.useMipmap?(t=hc.LINEAR_MIPMAP_NEAREST,i=hc.LINEAR):(t=hc.LINEAR,i=hc.LINEAR)),this.useMipmap||(t=hc.LINEAR,i=hc.LINEAR);const a=n.gl,s=this._target;a.activeTexture(a.TEXTURE0),a.bindTexture(s,this.texture),a.texParameteri(s,hc.TEXTURE_MIN_FILTER,t),a.texParameteri(s,hc.TEXTURE_MAG_FILTER,i),a.texParameteri(s,hc.TEXTURE_WRAP_S,r),a.texParameteri(s,hc.TEXTURE_WRAP_T,o),this.anisotropy&&$(n.extTextureFilterAnisotropic)&&a.texParameteri(s,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropy),a.bindTexture(s,null),this._sampler=e;}bind(e,t){return this.sampler={minificationFilter:this.useMipmap?hc.LINEAR_MIPMAP_NEAREST:e,magnificationFilter:e||hc.LINEAR,wrapS:t||hc.CLAMP_TO_EDGE,wrapT:t||hc.CLAMP_TO_EDGE,continueBindTextureOnExit:!0},this}addReference(){this.referenceCount+=1;}reduceReference(){this.referenceCount-=1;}upload(e){const{context:t}=this,{gl:i}=t;this.size=[e.width,e.height],i.deleteTexture(this.texture),this.texture=i.createTexture(),i.pixelStorei(hc.UNPACK_FLIP_Y_WEBGL,this.flipY),i.bindTexture(this._target,this.texture),this.compressed?i.compressedTexImage2D(this._target,0,this.internalFormat,e.width,e.height,0,e.data):e instanceof th||e instanceof ih||e instanceof nh||e instanceof rh||oh&&e instanceof oh?i.texImage2D(this._target,0,this.internalFormat,this.pixelFormat,this.pixelDatatype,e):i.texImage2D(this._target,0,this.internalFormat,this.size[0],this.size[1],0,this.pixelFormat,this.pixelDatatype,e.data);}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}isSizePowerOfTwoNoneSquare(){return this._powerOfTwoCalculated?this.powerOfTwoNoneSquareFlag:!!this.size&&(this._powerOfTwoCalculated=!0,this.powerOfTwoNoneSquareFlag=Math.log(this.size[0])/Math.LN2%1==0&&Math.log(this.size[1])/Math.LN2%1==0,this.powerOfTwoNoneSquareFlag)}destroy(){if(this.context){if(this.referenceCount-=1,0===this.referenceCount){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null,this.context=null;}uc(this);}}copyFrom(e){const t=this.context.gl,i=Z(e.xOffset,0),n=Z(e.yOffset,0);if(Nu.isDepthFormat(this.pixelFormat))throw new Error("Cannot call copyFrom when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(Nu.isCompressedFormat(this.pixelFormat))throw new Error("Cannot call copyFrom with a compressed texture pixel format.");const r=e.source,o=this.context,a=this._target;t.bindTexture(a,this.texture);const s=r.width,l=r.height;let c=r.arrayBufferView;const u=this.internalFormat,h=this.pixelFormat,d=this.pixelDatatype,p=this.flipY;let f=4;$(c)&&(f=Nu.alignmentInBytes(h,d,s)),t.pixelStorei(t.UNPACK_ALIGNMENT,f),$(c)?(t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),p&&(c=Nu.flipY(c,h,d,s,l)),t.texSubImage2D(a,0,i,n,s,l,h,Iu.toWebGLConstant(d,o),c)):(t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(hc.UNPACK_FLIP_Y_WEBGL,p),t.texImage2D(a,0,u,h,Iu.toWebGLConstant(d,o),r));}copyFromFramebuffer(e,t,i,n,r,o){if(e=Z(e,0),t=Z(t,0),i=Z(i,0),n=Z(n,0),r=Z(r,this._width),o=Z(o,this._height),Nu.isDepthFormat(this.pixelFormat))throw new Error("Cannot call copyFromFramebuffer when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(this.pixelDatatype===Iu.FLOAT)throw new Error("Cannot call copyFromFramebuffer when the texture pixel data type is FLOAT.");if(this.pixelDatatype===Iu.HALF_FLOAT)throw new Error("Cannot call copyFromFramebuffer when the texture pixel data type is HALF_FLOAT.");if(Nu.isCompressedFormat(this.pixelFormat))throw new Error("Cannot call copyFrom with a compressed texture pixel format.");const a=this.context.gl,s=this._target;a.activeTexture(a.TEXTURE0),a.bindTexture(s,this.texture),a.copyTexSubImage2D(s,0,e,t,i,n,r,o),a.bindTexture(s,null),this._initialized=!0;}async load(e,t){this.texUrl=e;const i=await(()=>new Promise(((t,i)=>{eh({url:this.map._transformRequest(e,Yu.Image).url,imageBitmapOptions:{imageOrientation:this.flipY?"flipY":"none",premultiplyAlpha:this.premultiply?"premultiply":"none"}},((e,n)=>{e&&i(e),t(n);}));})))();if(!i.width||!i.height)throw new Error(`load image error, url is ${e}`);this.uploadTexData(i),t&&t();}uploadTexData(e){const t=e.width,i=e.height,{context:n}=this,{gl:r}=n;r.bindTexture(hc.TEXTURE_2D,this.texture),n.pixelStoreUnpackFlipY.set(this.flipY),n.pixelStoreUnpack.set(1),n.pixelStoreUnpackPremultiplyAlpha.set(!1),this.size=[t,i],r.texImage2D(hc.TEXTURE_2D,0,this.internalFormat,this.pixelFormat,Iu.toWebGLConstant(this.pixelDatatype,n),e),this._powerOfTwoCalculated=!1,this.isSizePowerOfTwoNoneSquare()&&this.useMipmap&&(r.generateMipmap(hc.TEXTURE_2D),this.mIsGenerateMipmap=!0),this._hasSetSampler=!1,this.map&&(this.map.needRepaint=!0);}serialize(){let e;return $(this.texUrl)&&(e={texUrl:this.texUrl}),e}isDestroyed(){return !1}static fromFramebuffer(e){const t=(e=Z(e,Z.EMPTY_OBJECT)).context,i=t.gl,n=Z(e.pixelFormat,Nu.RGBA),r=Z(e.framebufferXOffset,0),o=Z(e.framebufferYOffset,0),a=Z(e.width,i.drawingBufferWidth),s=Z(e.height,i.drawingBufferHeight),l=e.framebuffer;return new ah({context:t,width:a,height:s,pixelFormat:n,framebuffer:$(l)?l:null,xOffset:r,yOffset:o})}static createImageFromTexture(e,t,i,n){const r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0);const o=new Uint8Array(i*n*4);e.readPixels(0,0,i,n,e.RGBA,e.UNSIGNED_BYTE,o),e.deleteFramebuffer(r);const a=J.document.createElement("canvas");a.width=i,a.height=n;const s=a.getContext("2d"),l=s.createImageData(i,n);l.data.set(o),s.putImageData(l,0,0);const c=new J.Image;return c.src=a.toDataURL("image/png"),c}static createDescendantImageFromTexture(e,t,i,n,r,o){const a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0);const s=new Uint8Array(o*o);e.readPixels(i,n,r,r,e.RGBA,e.UNSIGNED_BYTE,s),e.deleteFramebuffer(a);const l=J.document.createElement("canvas");l.width=o/2,l.height=o/2;const c=l.getContext("2d"),u=c.createImageData(o/2,o/2);u.data.set(s),c.putImageData(u,0,0);const h=J.document.createElement("canvas");h.width=o,h.height=o,h.getContext("2d").drawImage(l,0,0,o,o);const d=new J.Image;return d.src=h.toDataURL("image/png"),d.width=o,d.height=o,d}}class sh{constructor(e,t,i){if(!$(e))throw new Error("context is required");if(!$(t))throw new Error("attributes is required");if(!$(i))throw new Error("numberOfInstances is required");if(this._attributes=t,this._numberOfInstances=i,0===t.length)return;const n=function(e){let t=!1;const i=e.length;for(let n=0;n<i;++n)if(e[n].type!==hc.UNSIGNED_BYTE){t=!0;break}return t?hc.FLOAT:hc.UNSIGNED_BYTE}(t),r=n===hc.FLOAT&&!e.floatingPointTexture,o=function(e,t){const i=new Array(e.length);let n=0;const r=e.length;for(let o=0;o<r;++o){const r=e[o].type;i[o]=n,r!==hc.UNSIGNED_BYTE&&t?n+=4:++n;}return i}(t,r),a=function(e,t,i){const n=e.length,r=e[n-1];return t[n-1].type!==hc.UNSIGNED_BYTE&&i?r+4:r+1}(o,t,r),s=Math.floor(vu.maximumTextureSize/a),l=Math.min(i,s),c=a*l,u=Math.ceil(i/l),h=1/c,d=.5*h,p=1/u,f=.5*p;this._textureDimensions=new It(c,u),this._textureStep=new wt(h,d,p,f),this._pixelDatatype=r?hc.UNSIGNED_BYTE:n,this._packFloats=r,this._offsets=o,this._stride=a,this._texture=void 0;const m=4*c*u;this._batchValues=n!==hc.FLOAT||r?new Uint8Array(m):new Float32Array(m),this._batchValuesDirty=!1;}get attributes(){return this._attributes}get numberOfInstances(){return this._numberOfInstances}getBatchedAttribute(e,t,i){if(e<0||e>=this._numberOfInstances)throw new Error("instanceIndex is out of range.");if(t<0||t>=this._attributes.length)throw new Error("attributeIndex is out of range");const n=this._attributes,r=4*this._stride*e+4*this._offsets[t];let o;o=this._packFloats&&n[t].componentDatatype!==hc.UNSIGNED_BYTE?function(e,t,i){let n=wt.unpack(e,t,ch);const r=wt.unpackFloat(n);n=wt.unpack(e,t+4,ch);const o=wt.unpackFloat(n);n=wt.unpack(e,t+8,ch);const a=wt.unpackFloat(n);n=wt.unpack(e,t+12,ch);const s=wt.unpackFloat(n);return wt.fromElements(r,o,a,s,i)}(this._batchValues,r,lh):wt.unpack(this._batchValues,r,lh);const a=uh(n,t);return $(a.fromCartesian4)?a.fromCartesian4(o,i):$(a.clone)?a.clone(o,i):o.x}setBatchedAttribute(e,t,i){const n=[void 0,void 0,new It,new ft,new wt],r=new wt;if(e<0||e>=this._numberOfInstances)throw new Error("instanceIndex is out of range.");if(t<0||t>=this._attributes.length)throw new Error("attributeIndex is out of range");if(!$(i))throw new Error("value is required.");const o=this._attributes,a=this.getBatchedAttribute(e,t,n[o[t].components]),s=uh(this._attributes,t);if($(s.equals)?s.equals(a,i):a===i)return;const l=r;l.x=$(i.x)?i.x:i,l.y=$(i.y)?i.y:0,l.z=$(i.z)?i.z:0,l.w=$(i.w)?i.w:0;const c=4*this._stride*e+4*this._offsets[t];this._packFloats&&o[t].type!==hc.UNSIGNED_BYTE?function(e,t,i){let n=wt.packFloat(e.x,ch);wt.pack(n,t,i),n=wt.packFloat(e.y,n),wt.pack(n,t,i+4),n=wt.packFloat(e.z,n),wt.pack(n,t,i+8),n=wt.packFloat(e.w,n),wt.pack(n,t,i+12);}(l,this._batchValues,c):wt.pack(l,this._batchValues,c),this._batchValuesDirty=!0;}createTexture(e){const t=this._textureDimensions;this._texture=new ah({context:e,pixelFormat:hc.RGBA,pixelDatatype:this._pixelDatatype,width:t.x,height:t.y,sampler:Eu.NEAREST,flipY:!1});}updateTexture(){const e=this._textureDimensions;this._texture.copyFrom({source:{width:e.x,height:e.y,arrayBufferView:this._batchValues}});}update(e){$(this._texture)&&!this._batchValuesDirty||0===this._attributes.length||(this._batchValuesDirty=!1,$(this._texture)||this.createTexture(e),this.updateTexture());}getUniformMapCallback(){const e=new Map,t=this;return 0===t._attributes.length||(e.set("batchTableTexture",(()=>t._texture)),e.set("batchTextureDimensions",(()=>t._textureDimensions)),e.set("batchTextureStep",(()=>t._textureStep)),e.set("numberOfAttributes",(()=>t._attributes.length))),e}destroy(){return this._texture=this._texture&&this._texture.destroy(),uc(this)}}const lh=new wt,ch=new wt;function uh(e,t){const i=e[t].components;return 2===i?It:3===i?ft:4===i?wt:Number}const hh={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class dh{constructor(e){const{attributes:t,dynamicDraw:i,context:n,buffers:r,attributesbuffviewObject:o,array:a}=e;this.length=a?a.length:0,this.attributes=t,this.dynamicDraw=i,this.context=n,this._isVectorBuffer=!e.hasOwnProperty("attributesbuffviewObject"),this.buffers={},r?this.buffers=r:this._isVectorBuffer?(this.itemSize=a.bytesPerElement,this._parseAttributesOfVector(a)):this._parseAttributesbuffviewObject(o);}getBuffers(){return this.buffers}bind(e){e&&this.context.bindVertexBuffer.set(this.buffers[e]);}updateData(e){if(!this._isVectorBuffer)return;const t=this.context.gl;this.bind("default"),t.bufferData(t.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?t.DYNAMIC_DRAW:t.STATIC_DRAW);}updateDataTest(e,t){const i=this.context.gl;this.bind(this._isVectorBuffer?"default":t),i.bufferData(i.ARRAY_BUFFER,e.arrayBuffer?e.arrayBuffer:e.buffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW);}enableAttributes(e,t){for(let i=0;i<this.attributes.length;i++){const n=t.attributes[this.attributes[i].name];void 0!==n&&e.enableVertexAttribArray(n);}}setVertexAttribPointers(e,t,i){this._isVectorBuffer?this._setVertexAttribPointersOfVector(e,t,i):this._setVertexAttribPointersOfModel(e,t);}_setVertexAttribPointersOfVector(e,t,i){for(let n=0;n<this.attributes.length;n++){const r=this.attributes[n],o=t.attributes[r.name];this.bind("default"),void 0!==o&&e.vertexAttribPointer(o,r.components,hc[hh[r.type]],!1,this.itemSize,r.offset+this.itemSize*(i||0));}}_setVertexAttribPointersOfModel(e,t){for(let i=0;i<this.attributes.length;i++){const n=this.attributes[i];let r=!1;-1!==n.name.indexOf("a_COLOR")&&(r=!0),this.bind(n.name);const o=t.attributes[n.name];void 0!==o&&(n.instance?(e.enableVertexAttribArray(n.attribIndex+o),e.vertexAttribPointer(n.attribIndex+o,n.components,hc.FLOAT,r,n.byteStride,n.offset),this.context.drawInstance.vertexAttribDivisorANGLE(n.attribIndex+o,1)):(e.enableVertexAttribArray(o),e.vertexAttribPointer(o,n.components,n.type,r,n.byteStride,n.offset))),this.context.bindVertexBuffer.set(null);}}_parseAttributesOfVector(e){const t=this.context,i=t.gl;this.buffers.default=i.createBuffer(),t.bindVertexBuffer.set(this.buffers.default),i.bufferData(hc.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?hc.DYNAMIC_DRAW:hc.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer;}_parseAttributesbuffviewObject(e){const t=this.context.gl,i=Object.keys(e);i.forEach(((n,r)=>{const o=e[n];let a,s;a=ph(n,"_")?`a${n}`:`a_${n}`;let l,c=r-1,u=!1;for(;c>=0;){if(u=this._findSameBuffer(i[c],n,e),u){l=i[c];break}c--;}if(u)this.buffers[a]=ph(l,"_")?this.buffers[`a${l}`]:this.buffers[`a_${l}`];else {s=t.createBuffer(),this.context.bindVertexBuffer.set(s);const e=null!=o.bufferView?o.bufferView.data:o.value;t.bufferData(hc.ARRAY_BUFFER,e,this.dynamicDraw?hc.DYNAMIC_DRAW:hc.STATIC_DRAW),s.length=e?.length,this.buffers[a]=s;}}));}_findSameBuffer(e,t,i){return null!=i[e].bufferView&&null!=i[t].bufferView?i[e].bufferView.data===i[t].bufferView.data:i[e].value===i[t].value}destroy(){if(!this.context||!this.context.gl)return;const e=this.context.gl;for(const t in this.buffers)e.deleteBuffer(this.buffers[t]),delete this.buffers[t];this.context=null;}}function ph(e,t){return e.charAt(0)==t}class fh{constructor(e){this.rectangle=gs.clone(e.rectangle),this.minimumHeight=Z(e.minimumHeight,0),this.maximumHeight=Z(e.maximumHeight,0),this.isAmbiguousHeight=Z(e.isAmbiguousHeight,!1),this.southwestCornerCartesian=new ft,this.northeastCornerCartesian=new ft,this.westNormal=new ft,this.southNormal=new ft,this.eastNormal=new ft,this.northNormal=new ft;const t=Z(e.ellipsoid,oi.WGS84);!function(e,t,i){i.cartographicToCartesianInRadians(gs.southwest(t),e.southwestCornerCartesian),i.cartographicToCartesianInRadians(gs.northeast(t),e.northeastCornerCartesian),wh.longitude=t.west,wh.latitude=.5*(t.south+t.north),wh.height=0;const n=i.cartographicToCartesianInRadians(wh,xh),r=ft.cross(n,ft.UNIT_Z,mh);ft.normalize(r,e.westNormal),wh.longitude=t.east;const o=i.cartographicToCartesianInRadians(wh,vh),a=ft.cross(ft.UNIT_Z,o,mh);ft.normalize(a,e.eastNormal);const s=ft.subtract(n,o,mh),l=ft.normalize(s,yh),c=t.south;let u;if(c>0){wh.longitude=.5*(t.west+t.east),wh.latitude=c;const n=i.cartographicToCartesianInRadians(wh,bh.origin);ft.clone(l,bh.direction);const r=ja.fromPointNormal(e.southwestCornerCartesian,e.westNormal,Th);Cs.rayPlane(bh,r,e.southwestCornerCartesian),u=i.geodeticSurfaceNormal(n,_h);}else u=i.geodeticSurfaceNormalCartographic(gs.southeast(t),_h,!0);const h=ft.cross(u,s,gh);ft.normalize(h,e.southNormal);const d=t.north;let p;if(d<0){wh.longitude=.5*(t.west+t.east),wh.latitude=d;const n=i.cartographicToCartesianInRadians(wh,bh.origin);ft.negate(l,bh.direction);const r=ja.fromPointNormal(e.northeastCornerCartesian,e.eastNormal,Th);Cs.rayPlane(bh,r,e.northeastCornerCartesian),p=i.geodeticSurfaceNormal(n,_h);}else p=i.geodeticSurfaceNormalCartographic(gs.northwest(t),_h,!0);const f=ft.cross(s,p,gh);ft.normalize(f,e.northNormal);}(this,e.rectangle,t),this._orientedBoundingBox=void 0,this._boundingSphere=void 0,Z(e.computeBoundingVolumes,!0)&&this.computeBoundingVolumes(t);}get boundingVolume(){return this._orientedBoundingBox}get boundingSphere(){return this._boundingSphere}computeBoundingVolumes(e){this._orientedBoundingBox=gu.fromRectangle(this.rectangle,this.minimumHeight,this.maximumHeight,e),this._boundingSphere=Zc.fromOrientedBoundingBox(this._orientedBoundingBox);}computePlaneDistances(e,t,i){return this._orientedBoundingBox.computePlaneDistances(e,t,i)}distanceToCamera(e){const t=function(e,t){const i=t.position,n=_s.fromVector3(t.position);let r=0;if(!gs.contains(e.rectangle,n)){const t=e.northeastCornerCartesian,n=e.westNormal,o=e.southNormal,a=e.eastNormal,s=e.northNormal,l=ft.subtract(i,e.southwestCornerCartesian,Ph),c=ft.dot(l,n),u=ft.dot(l,o),h=ft.subtract(i,t,Ph),d=ft.dot(h,a),p=ft.dot(h,s);c>0?r+=c*c:d>0&&(r+=d*d),u>0?r+=u*u:p>0&&(r+=p*p);}const o=n.height,a=e.minimumHeight,s=e.maximumHeight;if(o>s){const e=o-s;r+=e*e;}else if(o<a){const e=a-o;r+=e*e;}return Math.sqrt(r)}(this,e);if($(this._orientedBoundingBox)){const i=Math.sqrt(this._orientedBoundingBox.distanceSquaredTo(e.position));return Math.max(t,i)}return t}intersectPlane(e){return this._orientedBoundingBox.intersectPlane(e)}}const mh=new ft,_h=new ft,gh=new ft,yh=new ft,xh=new ft,vh=new ft,wh=new _s,Th=new ja(ft.UNIT_X,0),bh=new Es,Ph=new ft;class Sh{constructor(e){if(this.collection=e.collection,!$(e.modelMatrix))throw new Error("modelMatrix must be defined!");if(!(e.modelMatrix instanceof Ot))throw new Error("modelMatrix must be type of Matrix4!");this._modelMatrix=e.modelMatrix,this._instanceId=Z(e.instanceId,void 0),this._instanceName=Z(e.instanceName,void 0),this._show=Z(e.show,!0),this._color=Z(Di.parse(e.color),new Di(0,0,0,0)),this._scale=new ft,this._boundingVolume=void 0,this.scale=Z(e.scale,void 0),this.rotation=Z(e.rotation,void 0),this.position=Z(e.position,void 0),this.pickId=void 0,this._dirty=!0,this._originalMatrix=this._modelMatrix.clone();}get dirty(){return this._dirty}set dirty(e){Je(e)&&(e&&(this.collection.dirty=!0),this._dirty=e);}get instanceId(){return this._instanceId}get instanceName(){return this._instanceName}get modelMatrix(){return this._modelMatrix.clone()}set modelMatrix(e){e instanceof Ot&&(this._modelMatrix=e.clone(),this.dirty=!0);}get show(){return this._show}set show(e){Je(e)&&(this._show=e,this.dirty=!0);}getBounds(){let e,t=this._boundingVolume;if(t instanceof fh)t=t.boundingVolume;else if(t instanceof BoundingSphere){e=t.getBoundingMaximum();const i=lc.cartesian3ToCartographic(e.boundingMaxValue),n=lc.cartesian3ToCartographic(e.boundingMinValue);return new ai([n[0],n[1]],[i[0],i[1]])}const i=gs.fromCartesianArray(t.computeCorners()),n=nt.CesiumMath.toDegrees(i.west),r=nt.CesiumMath.toDegrees(i.south),o=nt.CesiumMath.toDegrees(i.east),a=nt.CesiumMath.toDegrees(i.north);return new ai([n,r],[o,a])}get color(){return this._color}set color(e){const t=Di.parse(e);t&&(this._color=t,this.dirty=!0);}get scale(){return Ot.getScale(this._modelMatrix,this._scale)}set scale(e){e instanceof ft&&(this._modelMatrix.scale(new ft(1/this.scale.x,1/this.scale.y,1/this.scale.z)),this._modelMatrix.scale(e),this.dirty=!0);}get rotation(){const e=this._modelMatrix.clone(),t=lc.localFrameToFixedFrame(e.getTranslation(new ft)),i=Ot.inverse(t,new Ot),n=e.multiplyLeft(i),r=(new Tt).fromRotationMatrix4(n.getRotation());return ot.fromQuaternion(r)}set rotation(e){e instanceof ot&&(lc.localFrameToFixedFrame(this._modelMatrix.getTranslation(new ft)).multiplyRight(Ot.fromTranslationHeadingPitchRollRotationScale(new ft,e,new ft(this.scale.x,this.scale.y,this.scale.z)),this._modelMatrix),this.dirty=!0);}get position(){return this._modelMatrix.getTranslation(new ft)}set position(e){e instanceof ft&&(this._modelMatrix.setTranslation(e),this.dirty=!0);}}class Ah{constructor(e){this._rootId=e.rootId,this._instances=this.createInstance(e.instances),this._primitivesInstance=[],this.type=Z(e.type,"3d-model"),this._batchTable=void 0,this._parentBouningVolumeNeedUpdate=!1,this.boundingVolume=this._updateBoundingVolume(),this._center=this.boundingVolume.center,this._rtcTransform=new Ot,Ot.multiplyByTranslation(new Ot,this._center,this._rtcTransform),this.sprites=e.spriteAtlas,this._insatnceBuffer=void 0,this._attributes=[],this._attributesbuffviewObject={},this.allowPick=Z(e.allowPick,!0),this._createAttributes(),this._parseBufferViewAttributes(),this.dirty=!1,this.reCreateInstancesData=!1;}getInstance(e){return this._instances.get(e)}get instanceBuffer(){return this._insatnceBuffer}get dirty(){return this._dirty}set dirty(e){Je(e)&&(this._dirty=e);}add(e){if("3d-model-instance"!==this.type)return;if(!$(e.position)&&!$(e.positions))throw new Error("instance's position or positions must be defined!");let t;if($(e.positions)){const t=Ah.generateInstanceModelMatrix({positions:e.positions,scales:e.scales,rotations:e.rotations,shows:e.shows,colors:e.colors,instanceNames:e.instanceNames});let i=this._instances.size;for(let e=0;e<t.length;e++)t[e].batchId=i,i++;const n=this.createInstance(t);this._instances=new Map([...this._instances,...n]);}else {const i=e.position,n=e.rotation,r=e.scale,o=e.color,a=e.show,s=e.instanceName;if(!(i instanceof ft))throw new Error("instance's position is unKnown type!");if($(n)&&!(n instanceof ot))throw new Error("instance's rotation is unKnown type!");if($(r)&&!(r instanceof ft))throw new Error("instance's scale is unKnown type!");if($(o)&&!(o instanceof Di))throw new Error("instance's color is unKnown type!");if($(a)&&!Je(a))throw new Error("instance's show is unKnown type!");const l=lc.cartographicToFixedFrame(i);t=new Sh({collection:this,modelMatrix:l,instanceId:this._instances.size,instanceName:s,show:a,color:o,scale:r,rotation:n,position:ft.fromElements(l[12],l[13],l[14])}),this._instances.set(t.instanceId,t);}return this.reCreateInstancesData=!0,this.dirty=!0,this._parseBufferViewAttributes(),t}remove(e){let t=!1;if("3d-model-instance"!==this.type)return t;if(!$(e))return t;if(e instanceof Array)for(let i=0;i<e.length;i++)this._instances.has(e[i].instanceId)&&(this._instances.delete(e[i].instanceId),t=!0);else this._instances.has(e.instanceId)&&(this._instances.delete(e.instanceId),t=!0);const i=[];this._instances.forEach((e=>{i.push(e);}));const n=new Map;for(let e=0;e<i.length;e++)i[e]._instanceId=e,i.dirty=!0,n.set(e,i[e]);return this._instances.clear(),this._instances=n,this.reCreateInstancesData=!0,this.dirty=!0,this._parseBufferViewAttributes(),t}removeByName(e){if("3d-model-instance"!==this.type)return !1;const t=[];if(e instanceof Array)for(let i=0;i<e.length;i++){const n=e[i];this._instances.forEach((e=>{e.instanceName===n&&t.push(e);}));}else this._instances.forEach((i=>{i.instanceName===e&&t.push(i);}));return this.remove(t)}getByName(e){if("3d-model-instance"!==this.type)return;const t=[];return this._instances.forEach((i=>{i.instanceName===e&&t.push(i);})),t[0]}removeAll(){this._instances.clear(),this.reCreateInstancesData=!0,this.dirty=!0,this._parseBufferViewAttributes();}createInstance(e){const t=new Map;return e.forEach(((e,i)=>{const n=e.modelMatrix,r=Z(e.batchId,i),o=new Sh({collection:this,modelMatrix:n,instanceId:r,instanceName:e.instanceName,show:e.show,color:e.color,scale:e.scale,rotation:e.rotation,position:e.position});t.set(r,o);})),t}_createPickId(e){const t=this._instances;for(let i=0;i<t.size;++i)t.get(i).pickId=e.createPickId(this.getInstance(i));}createBuffer(e){this._insatnceBuffer=new dh({context:e,attributesbuffviewObject:this._attributesbuffviewObject,attributes:this._attributes,dynamicDraw:!1,buffers:void 0});}_updateBoundingVolume(){const e=[];for(let t=0;t<this._instances.size;++t){const i=this._instances.get(t);if($(i)){const t=[];if(this._primitivesInstance.length>0)for(let n=0;n<this._primitivesInstance.length;n++){let r=this._primitivesInstance[n].boundingVolume.clone();r=r.transform(i.modelMatrix);const o=r.computeCorners();for(let i=0;i<o.length;i++)e.push(o[i]),t.push(o[i]);}else {const n=Ot.getTranslation(i.modelMatrix,new ft);e.push(n),t.push(n);}i._boundingVolume=gu.fromPoints(t),this._parentBouningVolumeNeedUpdate=!0;}}return gu.fromPoints(e)}_createAttributes(){for(let e=0;e<4;++e)this._attributes.push({name:"a_InstanceMatrix4",type:hc.FLOAT,components:4,instance:!0,byteStride:64,offset:16*e,attribIndex:e,divisor:1});this.allowPick&&(this._attributes.push({name:"a_BATCHID",type:hc.FLOAT,components:1,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1}),this._attributes.push({name:"a_PickColor",type:hc.FLOAT,components:4,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1})),this.sprites&&this._attributes.push({name:"a_UVOffset",type:hc.FLOAT,components:2,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1}),this.modelInstanceAttributes=[{name:"color",type:hc.UNSIGNED_BYTE,components:4,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1,batchTableAttributeIndex:0},{name:"show",type:hc.UNSIGNED_BYTE,components:1,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1,batchTableAttributeIndex:1},{name:"pickColor",type:hc.UNSIGNED_BYTE,components:4,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1,batchTableAttributeIndex:2}];}_parseBufferViewAttributes(){this._parseInstances("InstanceMatrix4"),this.allowPick&&this._parseInstances("batchid"),this.sprites&&this._parseInstances("UVOffset");}_parseInstances(e){if("InstanceMatrix4"===e){const t=this._parseInstancesData(e);this._attributesbuffviewObject.InstanceMatrix4={value:new Float32Array(t)};}else if("batchid"===e){const t=this._parseInstancesData(e);this._attributesbuffviewObject.BATCHID={value:new Float32Array(t)};}else if("UVOffset"===e){const t=this._parseInstanceAtlas(e);this._attributesbuffviewObject.UVOffset={value:new Float32Array(t)};}}_parseInstance(e,t,i){if("InstanceMatrix4"===e){const e=new Ot,n=Ot.clone(t.modelMatrix,e);"3d-model-instance"===this.type&&(n[12]-=this._center.x,n[13]-=this._center.y,n[14]-=this._center.z);for(let e=0;e<t.modelMatrix.length;e++)i.push(n[e]);}else "batchid"===e&&i.push(t.instanceId);return i}_parseInstancesData(e){let t=[];for(let i=0;i<this._instances.size;i++){const n=this._instances.get(i);$(n)&&(t=this._parseInstance(e,n,t));}return t}_parseInstanceAtlas(e){const t=[];if("UVOffset"===e)for(let e=0;e<this._instances.size;e++){const i=e%this.sprites.spriteWidthCount/this.sprites.spriteWidthCount,n=Math.floor(e/this.sprites.spriteWidthCount)/this.sprites.spriteHeightCount;t.push(i),t.push(n);}return t}_createBatchTable(e){$(this._batchTable)&&(this._batchTable.destroy(),this._batchTable=void 0),this._batchTable=new sh(e,this.modelInstanceAttributes,this._instances.size);for(let t=0;t<this._instances.size;t++){const i=this._instances.get(t);$(i)&&(this._setBatchTableAttribute(i,e),i.dirty=!1);}}_setBatchTableAttribute(e,t){let i,n,r;const o=e.instanceId;for(let t=0;t<this.modelInstanceAttributes.length-1;++t)i=this.modelInstanceAttributes[t].name,n=this.modelInstanceAttributes[t].batchTableAttributeIndex,e[i]instanceof Di?(r=Di.clone(e[i]),r.r=Di.floatToByte(r.r),r.g=Di.floatToByte(r.g),r.b=Di.floatToByte(r.b),r.a=Di.floatToByte(r.a),r=wt.fromColor(r)):Je(e[i])&&(r=Number(e[i])),this._batchTable.setBatchedAttribute(o,n,r);$(e.pickId)||(e.pickId=t.createPickId(e));const a=e.pickId.color,s=new wt;s.x=Di.floatToByte(a.r),s.y=Di.floatToByte(a.g),s.z=Di.floatToByte(a.b),s.w=Di.floatToByte(a.a),this._batchTable.setBatchedAttribute(o,this.modelInstanceAttributes.length-1,s);}_updateBatchTable(){let e;for(let t=0;t<this._instances.size;t++)e=this._instances.get(t),$(e)&&e.dirty&&(this._setBatchTableAttribute(e),e.dirty=!1);}update(e){if(e&&e.context&&!this._insatnceBuffer&&this._instances.size>0&&("3d-model-instance"===this.type&&(this._createPickId(e.context),this._createBatchTable(e.context)),this.createBuffer(e.context)),"3d-model-instance"===this.type&&this.reCreateInstancesData&&(this._createPickId(e.context),this._createBatchTable(e.context),this.createBuffer(e.context),this.reCreateInstancesData=!1),this.dirty){const e=this._parseInstancesData("InstanceMatrix4");this._insatnceBuffer.updateDataTest(new Float32Array(e),"a_InstanceMatrix4"),this.boundingVolume=this._updateBoundingVolume(),$(this._batchTable)&&this._updateBatchTable(),this.dirty=!1;}$(e.context)&&$(this._batchTable)&&this._batchTable.update(e.context);}static generateInstanceObject(e){const t=[];return e.forEach(((e,i)=>{t.push({modelMatrix:(new Ot).translate(e),batchId:i});})),t}static generateInstanceModelMatrix(e){const t=[],i=e.positions,n=e.instanceNames,r=e.scales,o=e.rotations,a=e.shows,s=e.colors;if($(n)&&n.length>0&&n.length!==i.length)throw new Error("instanceNames's length  must be equal than positions's length!");if($(r)&&r.length>0&&r.length!==i.length)throw new Error("scales's length  must be equal than positions's length!");if($(o)&&o.length&&o.length!==i.length)throw new Error("rotations's length  must be equal than positions's length!");if($(a)&&a.length>0&&a.length!==i.length)throw new Error("shows's length  must be equal than positions's length!");if($(s)&&s.length>0&&s.length!==i.length)throw new Error("colors's length  must be equal than positions's length!");let l,c,u,h,d,p;for(let f=0;f<i.length;f++){let m;l=i[f],$(n)&&n.length>0&&(c=n[f]),$(o)&&o.length>0&&(u=o[f]),$(r)&&r.length>0&&(h=r[f]),$(a)&&a.length>0&&(d=a[f]),$(s)&&s.length>0&&(p=s[f]),e.cartesian?m=lc.cartesianToFixedFrame(l):(m=lc.cartographicToFixedFrame(l),l=ft.fromDegrees(l.x,l.y,l.z)),t.push({modelMatrix:m,batchId:f,instanceName:Z(c,void 0),position:Z(l,void 0),scale:Z(h,void 0),rotation:Z(u,void 0),show:Z(d,!0),color:Z(p,void 0)});}return t}updateInstanceMatrixByIndex(e,t){this.dirty=!0,this._instances.get(e).modelMatrix=t;}destroy(){this._instances&&this._instances.clear(),this._insatnceBuffer&&this._insatnceBuffer.destroy(),this._batchTable&&this._batchTable.destroy(),this._attributes=[],this._attributesbuffviewObject=null,this.dirty=!1;}}class Eh{constructor(){this._animationPropertyMap=new Map,this._animationPropertyOrders=[];}add(e){if(this.has(e.id))throw new Error(`There is already a animationProperty with this ID: ${e.id}`);this._animationPropertyOrders.push(e.id),this._animationPropertyMap.set(e.id,e);}get(e){return this._animationPropertyMap.get(e)}getAll(){const e=[];for(let t=0;t<this._animationPropertyOrders.length;t++){const i=this.get(this._animationPropertyOrders[t]);e.push(i);}return e}has(e){return this._animationPropertyMap.has(e)}sort(e){this._animationPropertyOrders.sort(e);}remove(e,t){if(this.has(e)){if(t){const t=this.get(e);t.destroy&&t.destroy();}this._animationPropertyMap.delete(e);const i=this._animationPropertyOrders.indexOf(e);this._animationPropertyOrders.splice(i,1);}}removeAll(e){for(;this._animationPropertyOrders.length>0;)this.remove(this._animationPropertyOrders[0],e);}get keys(){return this._animationPropertyOrders}get size(){return this._animationPropertyMap.size}}var Ch=8192;J.performance&&J.performance.now?J.performance.now.bind(J.performance):Date.now.bind(Date);const Mh=J.requestAnimationFrame||J.mozRequestAnimationFrame||J.webkitRequestAnimationFrame||J.msRequestAnimationFrame,Ih=J.cancelAnimationFrame||J.mozCancelAnimationFrame||J.webkitCancelAnimationFrame||J.msCancelAnimationFrame;let Lh;const Nh={now:()=>void 0!==Lh?Lh:J.performance.now(),setNow(e){Lh=e;},restoreNow(){Lh=void 0;},frame(e){const t=Mh(e);return {cancel:()=>Ih(t)}},getImageData(e){const t=J.document.createElement("canvas"),i=t.getContext("2d");if(!i)throw new Error("failed to create canvas 2d context");return t.width=e.width,t.height=e.height,i.drawImage(e,0,0,e.width,e.height),i.getImageData(0,0,e.width,e.height)},resolveURL(e){const t=J.document.createElement("a");return t.href=e,t.href},hardwareConcurrency:J.navigator.hardwareConcurrency||4,get devicePixelRatio(){return J.devicePixelRatio},supportsWebp:!1};if(J.document){const e=J.document.createElement("img");e.onload=function(){Nh.supportsWebp=!0;},e.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=";}function Rh(e,t,i){const n=Oh(256*e,256*(t=Math.pow(2,i)-t-1),i),r=Oh(256*(e+1),256*(t+1),i);return `${n[0]},${n[1]},${r[0]},${r[1]}`}function Oh(e,t,i){const n=2*Math.PI*6378137/256/Math.pow(2,i);return [e*n-2*Math.PI*6378137/2,t*n-2*Math.PI*6378137/2]}const Dh=2*Math.PI*si;function Fh(e){return Dh*Math.cos(e*Math.PI/180)}function zh(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}class Bh{constructor(e,t,i=0){this.x=+e,this.y=+t,this.z=+i;}static fromLngLat(e,t=0){const i=li.convert(e);return new Bh((180+i.lng)/360,(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i.lat*Math.PI/360)))/360,function(e,t){return e/Fh(t)}(t,i.lat))}toLngLat(){return new li(360*this.x-180,zh(this.y))}toAltitude(){return this.z*Fh(zh(this.y))}meterInMercatorCoordinateUnits(){return 1/Dh*(e=zh(this.y),1/Math.cos(e*Math.PI/180));var e;}}class Vh{constructor(e,t,i,n){this.z=e,this.x=t,this.y=i,this.key=Hh(0,e,t,i);}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}containsOrContained(e){const t=this.z-e.z;if(0==t){if(this.z===e.z&&this.x===e.x&&this.y===e.y)return !0}else if(t>0){if(this.x>>t===e.x&&this.y>>t===e.y)return !0}else if(this.x===e.x>>t&&this.y===e.y>>t)return !0;return !1}url(e,t){let i,n;e[0].includes("{bbox}")&&(t===ci.LATLON?i=function(e,t,i){if(0===i)return "-180,-90,180,90";{const n=Math.pow(2,i-1);return `${e/(2*n)*360-180},${90-(t+1)/n*180},${(e+1)/(2*n)*360-180},${90-t/n*180}`}}(this.x,this.y,this.z):t===ci.MERCATOR&&(i=Rh(this.x,this.y,this.z))),e[0].includes("{crs}")&&(t===ci.LATLON?n="EPSG:4326":t===ci.MERCATOR&&(n="EPSG:3857"));const r=Yh(this.z,this.x,this.y),o=this.x,a=this.y;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/\{z\}/g,String(this.z)).replace(/\{x\}/g,String(o)).replace(/\{y\}/g,String(a)).replace(/\{m\}/g,String(Math.floor(this.x/16))).replace(/\{n\}/g,String(Math.floor(a/16))).replace("{quadkey}",r).replace("{bbox}",i).replace("{crs}",n).replace(/\{c\}/g,this._getC()).replace(/\{r\}/g,this._getR())}wmtsUrl(e,t){let i=e[(this.x+this.y)%e.length].replace(/\{TileMatrixSet\}/g,t.matrixSet).replace(/\{TileMatrix\}/g,String(this.z)).replace(/\{TileCol\}/g,String(this.x)).replace(/\{TileRow\}/g,String(this.y));return t.dimensions&&t.dimensions.forEach(((e,t)=>{i=i.replace(new RegExp(`{${t}}`),String(e));})),i}tmsUrl(e){const t=Rh(this.x,this.y,this.z),i=Yh(this.z,this.x,this.y),n=this.x,r=Math.pow(2,this.z)-this.y-1;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/\{z\}/g,String(this.z)).replace(/\{x\}/g,String(n)).replace(/\{y\}/g,String(r)).replace(/\{m\}/g,String(Math.floor(this.x/16))).replace(/\{n\}/g,String(Math.floor(r/16))).replace("{quadkey}",i).replace("{bbox-epsg-3857}",t).replace(/\{c\}/g,this._getC()).replace(/\{r\}/g,this._getR())}baiduUrl(e){const t=this.x-Math.pow(2,this.z)/2,i=Math.pow(2,this.z)/2-this.y-1;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/\{z\}/g,String(this.z)).replace(/\{x\}/g,String(t)).replace(/\{y\}/g,String(i))}_getC(){return this.z>6?`C${Math.floor(Math.floor(this.x/(1<<this.z-5)))}`:"C0"}_getR(){return this.z>6?`R${Math.floor(Math.floor(this.y/(1<<this.z-5)))}`:"R0"}toRealCoord(e){const t="tms"===e?Math.pow(2,this.z)-this.y-1:this.y;return {x:this.x,y:t,z:this.z}}getTilePoint(e){return new te((e.x-this.x)*Ch,(e.y-this.y)*Ch)}}class Uh{constructor(e,t){this.wrap=e,this.canonical=t,this.key=Hh(0,t.z,t.x,t.y);}}const kh=Number.MAX_VALUE;class Gh{constructor(e,t,i,n,r,o){this.projection=o,this.overscaledZ=e,this.wrap=t,this.canonical=new Vh(i,+n,+r,this.projection),this.key=Hh(0,e,n,r),this._distance=kh;}set distance(e){this._distance=e;}get distance(){return this._distance}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}static getParentTileId(e){return new Gh(e.overscaledZ-1,0,e.canonical.z-1,Math.floor(e.canonical.x/2),Math.floor(e.canonical.y/2),e.projection)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new Gh(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y,this.projection):new Gh(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t,this.projection)}isChildOf(e){const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return [new Gh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y,this.projection)];const t=this.canonical.z+1,i=2*this.canonical.x,n=2*this.canonical.y;return [new Gh(t,this.wrap,t,i,n,this.projection),new Gh(t,this.wrap,t,i+1,n,this.projection),new Gh(t,this.wrap,t,i,n+1,this.projection),new Gh(t,this.wrap,t,i+1,n+1,this.projection)]}isLessThan(e){return "string"!=typeof e&&(this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y)))}wrapped(){return new Gh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y,this.projection)}unwrapTo(e){return new Gh(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y,this.projection)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Uh(this.wrap,this.canonical)}toString(){return `${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}toCoordinate(){return new ee(this.canonical.x+Math.pow(2,this.wrap),this.canonical.y,this.canonical.z)}getTilePoint(e){return this.canonical.getTilePoint(new Bh(e.x-this.wrap,e.y))}}function Hh(e,t,i,n){return `${t}_${i}_${n}`}function Yh(e,t,i){let n,r="";for(let o=e;o>0;o--)n=1<<o-1,r+=(t&n?1:0)+(i&n?2:0);return r}Ho("CanonicalTileID",Vh),Ho("OverscaledTileID",Gh,{omit:["posMatrix"]});const qh=Object.freeze([1,0,0,1]),Xh=Object.freeze([0,0,0,0]),jh={};Object.freeze({COL0ROW0:0,COL0ROW1:1,COL1ROW0:2,COL1ROW1:3});class Wh extends bt{static get IDENTITY(){return jh.IDENTITY=jh.IDENTITY||Object.freeze(new Wh(qh)),jh.IDENTITY}static get ZERO(){return jh.ZERO=jh.ZERO||Object.freeze(new Wh(Xh)),jh.ZERO}constructor(e){o(e)?super(e[0],e[1],e[2],e[3]):super(...qh);}get ELEMENTS(){return 4}get RANK(){return 2}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,i,n){return this[0]=e,this[1]=t,this[2]=i,this[3]=n,this.check()}setRowMajor(e,t,i,n){return this[0]=e,this[1]=i,this[2]=t,this[3]=n,this.check()}determinant(){return (e=this)[0]*e[3]-e[2]*e[1];var e;}identity(){return this.copy(Wh.IDENTITY)}transpose(e=this){return function(e,t){if(e===t){var i=t[1];e[1]=t[2],e[2]=i;}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];}(e,this),e.check()}invert(e){return function(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],a=i*o-r*n;a&&(e[0]=o*(a=1/a),e[1]=-n*a,e[2]=-r*a,e[3]=i*a);}(e,this),e.check()}multiplyLeft(e,t=this){return g(t,e,this),t.check()}multiplyRight(e,t=this){return g(t,this,e),t.check()}rotate(e,t=this){return function(e,t,i){var n=t[0],r=t[1],o=t[2],a=t[3],s=Math.sin(i),l=Math.cos(i);e[0]=n*l+o*s,e[1]=r*l+a*s,e[2]=n*-s+o*l,e[3]=r*-s+a*l;}(t,this,e),t.check()}scale(e,t=this){return o(e)?y(t,this,e):y(t,this,[e,e]),t.check()}transform(e,t=new It){return p(t=X(t,e,this),e.length),t}transformVector(e,t){return f("Matrix2.transformVector"),this.transform(e,t)}transformVector2(e,t){return f("Matrix2.transformVector2"),this.transform(e,t)}static equalsArray(e,t,i=0){return e[0]===t[0+i]&&e[1]===t[1+i]&&e[2]===t[2+i]&&e[3]===t[3+i]}static pack(e,t,i=0){return i=i||0,t[i++]=e[0],t[i++]=e[1],t[i++]=e[2],t[i++]=e[3],t}}function $h(e){var t={exports:{}};return e(t,t.exports),t.exports}class Zh{constructor(e,t,i,n,r,o){this.a=e,this.b=t,this.c=i,this.normal=n||new ft,this.vertexNormals=Array.isArray(n)?n:[],this.color=r||new Di,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=$(o)?o:0;}clone(){return new Zh(this.a,this.b,this.c,this.normal,this.color,this.materialIndex)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=new ft(e.vertexNormals[t]);for(let t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=Di.parse(e.vertexColors[t]);return this}}var Kh=Object.freeze({UNPROCESSING:0,PROCESSING:1,PROCESSINGSUCESS:2,PROCESSINGFAIL:3,PROCESSINGFISH:4});class Qh{constructor(){this.high=ft.clone(ft.ZERO),this.low=ft.clone(ft.ZERO);}static encode(e,t){let i;return $(t)||(t={high:0,low:0}),e>=0?(i=65536*Math.floor(e/65536),t.high=i,t.low=e-i):(i=65536*Math.floor(-e/65536),t.high=-i,t.low=e+i),t}static fromVector3(e,t){const i={high:0,low:0};$(t)||(t=new Qh);const n=t.high,r=t.low;return Qh.encode(e.x,i),n.x=i.high,r.x=i.low,Qh.encode(e.y,i),n.y=i.high,r.y=i.low,Qh.encode(e.z,i),n.z=i.high,r.z=i.low,t}}const Jh=new Ot,ed=new dl,td=new ft;class id{constructor(e={}){if(this.dynamicDraw=Z(e.dynamicDraw,!0),this.type=e.type||"",this._attributes=e.attributes||void 0,this._indices=e.indices||void 0,this._vertBuffer=e.vertBuffer||void 0,this._indexBuffer=e.indexBuffer||void 0,this.wireframeIndexBuffer=e.wireframeIndexBuffer||void 0,this.primitiveType=$(e.primitiveType)?e.primitiveType:hc.TRIANGLES,this._segmentVector=e.segmentVector||void 0,this.dynamicLayoutBuffer1=e.dynamicLayoutBuffer1||void 0,this.dynamicLayoutBuffer2=e.dynamicLayoutBuffer2||void 0,this.dynamicLayoutBuffer3=e.dynamicLayoutBuffer3||void 0,this.vertices=e.vertices||[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],e.tileBoundingRegion)this.boundingSphere=e.tileBoundingRegion._boundingSphere,this.boundingBox=e.tileBoundingRegion._orientedBoundingBox,this.isTileGeometryType=!0;else if(this.vertices.length>0){const e=this.vertices.length,t=[];for(let i=0;i<e;i+=3)t.push(new ft(this.vertices[i],this.vertices[i+1],this.vertices[i+2]));this.computeBoundingSphere(t),this.computeBoundingBox(t),this.isTileGeometryType=!1;}else this.boundingSphere=null,this.boundingBox=null,this.isTileGeometryType=!1;this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.state=Kh.PROCESSINGFISH;}parse(){}update(){}emplaceVertexBufferOfLines(){if(this._vertexArray.clear(),this._usedDoublePrecision){let e,t,i;for(let n=0;n<this.vertices.length;n+=3)e=Qh.encode(this.vertices[n]),t=Qh.encode(this.vertices[n+1]),i=Qh.encode(this.vertices[n+2]),this._vertexArray.emplaceBack(e.high,t.high,i.high,e.low,t.low,i.low);}else for(let e=0;e<this.vertices.length;e+=3)this._vertexArray.emplaceBack(this.vertices[e],this.vertices[e+1],this.vertices[e+2]);}emplaceVertexBufferTriangle(){if(this._vertexArray.clear(),this._usedDoublePrecision){let e,t,i;for(let n=0;n<this.vertices.length;n+=3)e=Qh.encode(this.vertices[n]),t=Qh.encode(this.vertices[n+1]),i=Qh.encode(this.vertices[n+2]),this._vertexArray.emplaceBack(e.high,t.high,i.high,e.low,t.low,i.low,this.uvs[n/3*2],this.uvs[n/3*2+1],this.normals[n],this.normals[n+1],this.normals[n+2]);}else for(let e=0;e<this.vertices.length;e+=3)this._vertexArray.emplaceBack(this.vertices[e],this.vertices[e+1],this.vertices[e+2],this.uvs[e/3*2],this.uvs[e/3*2+1],this.normals[e],this.normals[e+1],this.normals[e+2]);}applyMatrix(e){const t=(new Ct).getNormalMatrix(e);for(let t=0,i=this.vertices.length;t<i;t++)this.vertices[t].transform(e);for(let e=0,i=this.faces.length;e<i;e++){const i=this.faces[e];i.normal.transformByMatrix3(t).normalize();for(let e=0,n=i.vertexNormals.length;e<n;e++)i.vertexNormals[e].transformByMatrix3(t).normalize();}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return Jh.makeRotationX(e),this.applyMatrix(Jh),this}rotateY(e){return Jh.makeRotationY(e),this.applyMatrix(Jh),this}rotateZ(e){return Jh.makeRotationZ(e),this.applyMatrix(Jh),this}translate(e,t,i){return Jh.makeTranslation(e,t,i),this.applyMatrix(Jh),this}scale(e,t,i){return Jh.makeScale(e,t,i),this.applyMatrix(Jh),this}lookAt(e){return ed.lookAt(e),ed.updateMatrix(),this.applyMatrix(ed.matrix),this}fromBufferGeometry(e){const t=this,i=null!==e.index?e.index.array:void 0,n=e.attributes,r=n.position.array,o=void 0!==n.normal?n.normal.array:void 0,a=void 0!==n.color?n.color.array:void 0,s=void 0!==n.uv?n.uv.array:void 0,l=void 0!==n.uv2?n.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(let e=0;e<r.length;e+=3)t.vertices.push((new ft).fromArray(r,e)),void 0!==a&&t.colors.push(Di.parse(a[e]));function c(e,i,n,r){const c=void 0===a?[]:[Di.parse(t.colors[e]),Di.parse(t.colors[i]),Di.parse(t.colors[n])],u=void 0===o?[]:[(new ft).fromArray(o,3*e),(new ft).fromArray(o,3*i),(new ft).fromArray(o,3*n)],h=new Zh(e,i,n,u,c,r);t.faces.push(h),void 0!==s&&t.faceVertexUvs[0].push([(new It).fromArray(s,2*e),(new It).fromArray(s,2*i),(new It).fromArray(s,2*n)]),void 0!==l&&t.faceVertexUvs[1].push([(new It).fromArray(l,2*e),(new It).fromArray(l,2*i),(new It).fromArray(l,2*n)]);}const u=e.groups;if(u.length>0)for(let e=0;e<u.length;e++){const t=u[e],n=t.start;for(let e=n,r=n+t.count;e<r;e+=3)void 0!==i?c(i[e],i[e+1],i[e+2],t.materialIndex):c(e,e+1,e+2,t.materialIndex);}else if(void 0!==i)for(let e=0;e<i.length;e+=3)c(i[e],i[e+1],i[e+2]);else for(let e=0;e<r.length/3;e+=3)c(e,e+1,e+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(td).negate(),this.translate(td.x,td.y,td.z),this}normalize(){this.computeBoundingSphere();const e=this.boundingSphere.center,t=this.boundingSphere.radius,i=0===t?1:1/t,n=new Ot;return n.setRowMajor(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix(n),this}computeFaceNormals(){const e=new ft,t=new ft;for(let i=0,n=this.faces.length;i<n;i++){const n=this.faces[i],r=this.vertices[n.a],o=this.vertices[n.b];e.subVectors(this.vertices[n.c],o),t.subVectors(r,o),e.cross(t),e.normalize(),n.normal.copy(e);}}computeVertexNormals(e){let t,i,n,r,o;void 0===e&&(e=!0);const a=new Array(this.vertices.length);for(t=0,i=this.vertices.length;t<i;t++)a[t]=new ft;if(e){let e,t,i;const s=new ft,l=new ft;for(n=0,r=this.faces.length;n<r;n++)o=this.faces[n],e=this.vertices[o.a],t=this.vertices[o.b],i=this.vertices[o.c],s.subVectors(i,t),l.subVectors(e,t),s.cross(l),a[o.a].add(s),a[o.b].add(s),a[o.c].add(s);}else for(this.computeFaceNormals(),n=0,r=this.faces.length;n<r;n++)o=this.faces[n],a[o.a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(t=0,i=this.vertices.length;t<i;t++)a[t].normalize();for(n=0,r=this.faces.length;n<r;n++){o=this.faces[n];const e=o.vertexNormals;3===e.length?(e[0].copy(a[o.a]),e[1].copy(a[o.b]),e[2].copy(a[o.c])):(e[0]=new ft(a[o.a]),e[1]=new ft(a[o.b]),e[2]=new ft(a[o.c]));}this.faces.length>0&&(this.normalsNeedUpdate=!0);}computeFlatVertexNormals(){let e,t,i;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){i=this.faces[e];const t=i.vertexNormals;3===t.length?(t[0].copy(i.normal),t[1].copy(i.normal),t[2].copy(i.normal)):(t[0]=new ft(i.normal),t[1]=new ft(i.normal),t[2]=new ft(i.normal));}this.faces.length>0&&(this.normalsNeedUpdate=!0);}computeMorphNormals(){let e,t,i,n,r;for(i=0,n=this.faces.length;i<n;i++)for(r=this.faces[i],r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=new ft(r.normal),r.__originalVertexNormals||(r.__originalVertexNormals=[]),e=0,t=r.vertexNormals.length;e<t;e++)r.__originalVertexNormals[e]?r.__originalVertexNormals[e].copy(r.vertexNormals[e]):r.__originalVertexNormals[e]=new ft(r.vertexNormals[e]);const o=new id;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];const t=this.morphNormals[e].faceNormals,r=this.morphNormals[e].vertexNormals;let o,a;for(i=0,n=this.faces.length;i<n;i++)o=new ft,a={a:new ft,b:new ft,c:new ft},t.push(o),r.push(a);}const t=this.morphNormals[e];let a,s;for(o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),i=0,n=this.faces.length;i<n;i++)r=this.faces[i],a=t.faceNormals[i],s=t.vertexNormals[i],a.copy(r.normal),s.a.copy(r.vertexNormals[0]),s.b.copy(r.vertexNormals[1]),s.c.copy(r.vertexNormals[2]);}for(i=0,n=this.faces.length;i<n;i++)r=this.faces[i],r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals;}computeBoundingBox(e){let t;if($(e)||(e=this.vertices),o(e[0])&&e[0]instanceof ft)t=e;else {t=[];for(let i=0;i<e.length;i+=3)t.push(new ft(e[i],e[i+1],e[i+2]));}const i=[];for(let e=0;e<t.length;e++)isNaN(t[e][0])||isNaN(t[e][1])||isNaN(t[e][2])||i.push(t[e]);t=i,this.boundingBox=gu.fromPoints(t);}computeBoundingSphere(e){let t;if($(e)||(e=this.vertices),o(e[0])&&e[0]instanceof ft)t=e;else {t=[];for(let i=0;i<e.length;i+=3)t.push(new ft(e[i],e[i+1],e[i+2]));}const i=[];for(let e=0;e<t.length;e++)isNaN(t[e][0])||isNaN(t[e][1])||isNaN(t[e][2])||i.push(t[e]);t=i,this.boundingSphere=Zc.fromPoints(t);}merge(e,t,i){if(!e||!e.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);let n;const r=this.vertices.length,o=this.vertices,a=e.vertices,s=this.faces,l=e.faces,c=this.colors,u=e.colors;void 0===i&&(i=0),void 0!==t&&(n=(new Ct).getNormalMatrix(t));for(let e=0,i=a.length;e<i;e++){const i=new ft(a[e]);void 0!==t&&i.transform(t),o.push(i);}for(let e=0,t=u.length;e<t;e++)c.push(Di.parse(u[e]));for(let e=0,t=l.length;e<t;e++){let t,o;const a=l[e],c=a.vertexNormals,u=a.vertexColors,h=new Zh(a.a+r,a.b+r,a.c+r);h.normal.copy(a.normal),void 0!==n&&h.normal.transformByMatrix3(n).normalize();for(let e=0,i=c.length;e<i;e++)t=c[e].clone(),void 0!==n&&t.transformByMatrix3(n).normalize(),h.vertexNormals.push(t);h.color.copy(a.color);for(let e=0,t=u.length;e<t;e++)o=u[e],h.vertexColors.push(Di.parse(o));h.materialIndex=a.materialIndex+i,s.push(h);}for(let t=0,i=e.faceVertexUvs.length;t<i;t++){const i=e.faceVertexUvs[t];void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]);for(let e=0,n=i.length;e<n;e++){const n=i[e],r=[];for(let e=0,t=n.length;e<t;e++)r.push(new It(n[e]));this.faceVertexUvs[t].push(r);}}}mergeMesh(e){e?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);}mergeVertices(){const e={},t=[],i=[];let n,r;const o=Math.pow(10,4);let a,s,l,c,u,h;for(a=0,s=this.vertices.length;a<s;a++)n=this.vertices[a],r=`${Math.round(n.x*o)}_${Math.round(n.y*o)}_${Math.round(n.z*o)}`,void 0===e[r]?(e[r]=a,t.push(this.vertices[a]),i[a]=t.length-1):i[a]=i[e[r]];const d=[];for(a=0,s=this.faces.length;a<s;a++){l=this.faces[a],l.a=i[l.a],l.b=i[l.b],l.c=i[l.c],c=[l.a,l.b,l.c];for(let e=0;e<3;e++)if(c[e]===c[(e+1)%3]){d.push(a);break}}for(a=d.length-1;a>=0;a--){const e=d[a];for(this.faces.splice(e,1),u=0,h=this.faceVertexUvs.length;u<h;u++)this.faceVertexUvs[u].splice(e,1);}const p=this.vertices.length-t.length;return this.vertices=t,p}setFromPoints(e){this.vertices=[];for(let t=0,i=e.length;t<i;t++){const i=e[t];this.vertices.push(new ft(i.x,i.y,i.z||0));}return this}sortFacesByMaterialIndex(){const e=this.faces,t=e.length;for(let i=0;i<t;i++)e[i]._id=i;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));const i=this.faceVertexUvs[0],n=this.faceVertexUvs[1];let r,o;i&&i.length===t&&(r=[]),n&&n.length===t&&(o=[]);for(let a=0;a<t;a++){const t=e[a]._id;r&&r.push(i[t]),o&&o.push(n[t]);}r&&(this.faceVertexUvs[0]=r),o&&(this.faceVertexUvs[1]=o);}static fromBucket(e,t,i){if(!i)throw new Error("检查当前的瓦片没有 tileBoundingRegion！无法创建geometry对象！");const n=new id({tileBoundingRegion:i});return n._vertBuffer=e.layoutVertexBuffer,n._indexBuffer=e.indexBuffer,n._segmentVector=e.segments,n.primitiveType=$(t)?t:hc.TRIANGLES,e._animationFlag&&(n.animationVertexBuffers=e.animationVertexBuffers),n}static fromPointCloudData(e,t){const i=new id({});return i._vertBuffer=e.layoutVertexBuffer,i._indexBuffer=e.indexBuffer,i._segmentVector=e.segmentVector,i.primitiveType=$(t)?t:hc.POINTS,i}setData(){}destroy(){this.type="",this._attributes=void 0,this._indices=void 0,this._indexBuffer?.destroy(),this._vertBuffer?.destroy(),this._segmentVector?.destroy(),this.wireframeIndexBuffer?.destroy(),this.dynamicLayoutBuffer1?.destroy(),this.dynamicLayoutBuffer2?.destroy(),this.dynamicLayoutBuffer3?.destroy(),this._vertBuffer=void 0,this._indexBuffer=void 0,this.primitiveType=void 0,this.wireframeIndexBuffer=void 0,this._segmentVector=void 0,this.boundingSphere=void 0;}}function nd(e,t,i){if(0===e)return t*i;const n=e*e,r=n*n,o=r*n,a=o*n,s=a*n,l=s*n,c=i;return t*((1-n/4-3*r/64-5*o/256-175*a/16384-441*s/65536-4851*l/1048576)*c-(3*n/8+3*r/32+45*o/1024+105*a/4096+2205*s/131072+6237*l/524288)*Math.sin(2*c)+(15*r/256+45*o/1024+525*a/16384+1575*s/65536+155925*l/8388608)*Math.sin(4*c)-(35*o/3072+175*a/12288+3675*s/262144+13475*l/1048576)*Math.sin(6*c)+(315*a/131072+2205*s/524288+43659*l/8388608)*Math.sin(8*c)-(693*s/1310720+6237*l/5242880)*Math.sin(10*c)+1001*l/8388608*Math.sin(12*c))}function rd(e,t){if(0===e)return Math.log(Math.tan(.5*(nt.CesiumMath.PI_OVER_TWO+t)));const i=e*Math.sin(t);return Math.log(Math.tan(.5*(nt.CesiumMath.PI_OVER_TWO+t)))-e/2*Math.log((1+i)/(1-i))}function od(e,t,i,n){const r=n.maximumRadius,o=n.minimumRadius,a=r*r;e._ellipticitySquared=(a-o*o)/a,e._ellipticity=Math.sqrt(e._ellipticitySquared),e._start=_s.clone(t,e._start),e._start.height=0,e._end=_s.clone(i,e._end),e._end.height=0,e._heading=function(e,t,i,n,r){const o=rd(e._ellipticity,i),a=rd(e._ellipticity,r);return Math.atan2(nt.CesiumMath.negativePiToPi(n-t),a-o)}(e,t.longitude,t.latitude,i.longitude,i.latitude),e._distance=function(e,t,i,n,r,o,a){const s=e._heading,l=o-n;let c=0;if(nt.CesiumMath.equalsEpsilon(Math.abs(s),nt.CesiumMath.PI_OVER_TWO,nt.CesiumMath.EPSILON8))if(t===i)c=t*Math.cos(r)*nt.CesiumMath.negativePiToPi(l);else {const i=Math.sin(r);c=t*Math.cos(r)*nt.CesiumMath.negativePiToPi(l)/Math.sqrt(1-e._ellipticitySquared*i*i);}else {const i=nd(e._ellipticity,t,r);c=(nd(e._ellipticity,t,a)-i)/Math.cos(s);}return Math.abs(c)}(e,n.maximumRadius,n.minimumRadius,t.longitude,t.latitude,i.longitude,i.latitude);}function ad(e,t,i,n,r,o){if(0===i)return _s.clone(e,o);const a=r*r;let s,l,c;if(Math.abs(nt.CesiumMath.PI_OVER_TWO-Math.abs(t))>nt.CesiumMath.EPSILON8){l=function(e,t,i){const n=e/i;if(0===t)return n;const r=n*n,o=r*n,a=o*n,s=t*t,l=s*s,c=l*s,u=c*s,h=u*s,d=h*s,p=Math.sin(2*n),f=Math.cos(2*n),m=Math.sin(4*n),_=Math.cos(4*n),g=Math.sin(6*n),y=Math.cos(6*n),x=Math.sin(8*n),v=Math.cos(8*n),w=Math.sin(10*n);return n+n*s/4+7*n*l/64+15*n*c/256+579*n*u/16384+1515*n*h/65536+16837*n*d/1048576+(3*n*l/16+45*n*c/256-n*(32*r-561)*u/4096-n*(232*r-1677)*h/16384+n*(399985-90560*r+512*a)*d/5242880)*f+(21*n*c/256+483*n*u/4096-n*(224*r-1969)*h/16384-n*(33152*r-112599)*d/1048576)*_+(151*n*u/4096+4681*n*h/65536+1479*n*d/16384-453*o*d/32768)*y+(1097*n*h/65536+42783*n*d/1048576)*v+8011*n*d/1048576*Math.cos(10*n)+(3*s/8+3*l/16+213*c/2048-3*r*c/64+255*u/4096-33*r*u/512+20861*h/524288-33*r*h/512+a*h/1024+28273*d/1048576-471*r*d/8192+9*a*d/4096)*p+(21*l/256+21*c/256+533*u/8192-21*r*u/512+197*h/4096-315*r*h/4096+584039*d/16777216-12517*r*d/131072+7*a*d/2048)*m+(151*c/6144+151*u/4096+5019*h/131072-453*r*h/16384+26965*d/786432-8607*r*d/131072)*g+(1097*u/131072+1097*h/65536+225797*d/10485760-1097*r*d/65536)*x+(8011*h/2621440+8011*d/1048576)*w+293393*d/251658240*Math.sin(12*n)}(nd(r,n,e.latitude)+i*Math.cos(t),r,n);const o=rd(r,e.latitude),a=rd(r,l);c=Math.tan(t)*(a-o),s=nt.CesiumMath.negativePiToPi(e.longitude+c);}else {let o;if(l=e.latitude,0===r)o=n*Math.cos(e.latitude);else {const t=Math.sin(e.latitude);o=n*Math.cos(e.latitude)/Math.sqrt(1-a*t*t);}c=i/o,s=nt.CesiumMath.negativePiToPi(t>0?e.longitude+c:e.longitude-c);}return $(o)?(o.longitude=s,o.latitude=l,o.height=0,o):new _s(s,l,0)}function sd(e,t,i){const n=Z(i,oi.WGS84);this._ellipsoid=n,this._start=new _s,this._end=new _s,this._heading=void 0,this._distance=void 0,this._ellipticity=void 0,this._ellipticitySquared=void 0,$(e)&&$(t)&&od(this,e,t,n);}function ld(e,t,i,n,r,o){let a,s;if(void 0===o&&(o=function(e,t={}){const{start:i=0,end:n=e.length}=t,r=t.size||2;let o=0;for(let t=i,a=n-r;t<n;t+=r)o+=(e[t]-e[a])*(e[t+1]+e[a+1]),a=t;return o/2}(e,{start:t,end:i,size:n})),r===o<0)for(a=t;a<i;a+=n)s=Md(a,e[a],e[a+1],s);else for(a=i-n;a>=t;a-=n)s=Md(a,e[a],e[a+1],s);return s&&bd(s,s.next)&&(Id(s),s=s.next),s}function cd(e,t){if(!e)return e;t||(t=e);let i,n=e;do{if(i=!1,n.steiner||!bd(n,n.next)&&0!==Td(n.prev,n,n.next))n=n.next;else {if(Id(n),n=t=n.prev,n===n.next)break;i=!0;}}while(i||n!==t);return t}function ud(e,t,i,n,r,o,a){if(!e)return;!a&&o&&function(e,t,i,n){let r=e;do{null===r.z&&(r.z=yd(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,i,n,r,o,a,s,l,c=1;do{for(r=e,e=null,l=null,n=0;r;){for(n++,a=r,o=0,i=0;i<c&&(o++,a=a.nextZ,a);i++);for(s=c;o>0||s>0&&a;)0!==o&&(0===s||!a||r.z<=a.z)?(t=r,r=r.nextZ,o--):(t=a,a=a.nextZ,s--),l?l.nextZ=t:e=t,t.prevZ=l,l=t;r=a;}l.nextZ=null,c*=2;}while(n>1)}(r);}(e,n,r,o);let s,l,c=e;for(;e.prev!==e.next;)if(s=e.prev,l=e.next,o?dd(e,n,r,o):hd(e))t.push(s.i/i),t.push(e.i/i),t.push(l.i/i),Id(e),e=l.next,c=l.next;else if((e=l)===c){a?1===a?ud(e=pd(cd(e),t,i),t,i,n,r,o,2):2===a&&fd(e,t,i,n,r,o):ud(cd(e),t,i,n,r,o,1);break}}function hd(e){const t=e.prev,i=e,n=e.next;if(Td(t,i,n)>=0)return !1;let r=e.next.next;for(;r!==e.prev;){if(vd(t.x,t.y,i.x,i.y,n.x,n.y,r.x,r.y)&&Td(r.prev,r,r.next)>=0)return !1;r=r.next;}return !0}function dd(e,t,i,n){const r=e.prev,o=e,a=e.next;if(Td(r,o,a)>=0)return !1;const s=r.x>o.x?r.x>a.x?r.x:a.x:o.x>a.x?o.x:a.x,l=r.y>o.y?r.y>a.y?r.y:a.y:o.y>a.y?o.y:a.y,c=yd(r.x<o.x?r.x<a.x?r.x:a.x:o.x<a.x?o.x:a.x,r.y<o.y?r.y<a.y?r.y:a.y:o.y<a.y?o.y:a.y,t,i,n),u=yd(s,l,t,i,n);let h=e.prevZ,d=e.nextZ;for(;h&&h.z>=c&&d&&d.z<=u;){if(h!==e.prev&&h!==e.next&&vd(r.x,r.y,o.x,o.y,a.x,a.y,h.x,h.y)&&Td(h.prev,h,h.next)>=0)return !1;if(h=h.prevZ,d!==e.prev&&d!==e.next&&vd(r.x,r.y,o.x,o.y,a.x,a.y,d.x,d.y)&&Td(d.prev,d,d.next)>=0)return !1;d=d.nextZ;}for(;h&&h.z>=c;){if(h!==e.prev&&h!==e.next&&vd(r.x,r.y,o.x,o.y,a.x,a.y,h.x,h.y)&&Td(h.prev,h,h.next)>=0)return !1;h=h.prevZ;}for(;d&&d.z<=u;){if(d!==e.prev&&d!==e.next&&vd(r.x,r.y,o.x,o.y,a.x,a.y,d.x,d.y)&&Td(d.prev,d,d.next)>=0)return !1;d=d.nextZ;}return !0}function pd(e,t,i){let n=e;do{const r=n.prev,o=n.next.next;!bd(r,o)&&Pd(r,n,n.next,o)&&Ed(r,o)&&Ed(o,r)&&(t.push(r.i/i),t.push(n.i/i),t.push(o.i/i),Id(n),Id(n.next),n=e=o),n=n.next;}while(n!==e);return cd(n)}function fd(e,t,i,n,r,o){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&wd(a,e)){let s=Cd(a,e);return a=cd(a,a.next),s=cd(s,s.next),ud(a,t,i,n,r,o),void ud(s,t,i,n,r,o)}e=e.next;}a=a.next;}while(a!==e)}function md(e,t){return e.x-t.x}function _d(e,t){if(t=function(e,t){let i=t;const n=e.x,r=e.y;let o,a=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const e=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=n&&e>a){if(a=e,e===n){if(r===i.y)return i;if(r===i.next.y)return i.next}o=i.x<i.next.x?i:i.next;}}i=i.next;}while(i!==t);if(!o)return null;if(n===a)return o;const s=o,l=o.x,c=o.y;let u,h=1/0;i=o;do{n>=i.x&&i.x>=l&&n!==i.x&&vd(r<c?n:a,r,l,c,r<c?a:n,r,i.x,i.y)&&(u=Math.abs(r-i.y)/(n-i.x),Ed(i,e)&&(u<h||u===h&&(i.x>o.x||i.x===o.x&&gd(o,i)))&&(o=i,h=u)),i=i.next;}while(i!==s);return o}(e,t),t){const i=Cd(t,e);cd(t,t.next),cd(i,i.next);}}function gd(e,t){return Td(e.prev,e,t.prev)<0&&Td(t.next,e,e.next)<0}function yd(e,t,i,n,r){return (e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function xd(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;}while(t!==e);return i}function vd(e,t,i,n,r,o,a,s){return (r-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(n-s)-(i-a)*(t-s)>=0&&(i-a)*(o-s)-(r-a)*(n-s)>=0}function wd(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&Pd(i,i.next,e,t))return !0;i=i.next;}while(i!==e);return !1}(e,t)&&(Ed(e,t)&&Ed(t,e)&&function(e,t){let i=e,n=!1;const r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;}while(i!==e);return n}(e,t)&&(Td(e.prev,e,t.prev)||Td(e,t.prev,t))||bd(e,t)&&Td(e.prev,e,e.next)>0&&Td(t.prev,t,t.next)>0)}function Td(e,t,i){return (t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function bd(e,t){return e.x===t.x&&e.y===t.y}function Pd(e,t,i,n){const r=Ad(Td(e,t,i)),o=Ad(Td(e,t,n)),a=Ad(Td(i,n,e)),s=Ad(Td(i,n,t));return r!==o&&a!==s||!(0!==r||!Sd(e,i,t))||!(0!==o||!Sd(e,n,t))||!(0!==a||!Sd(i,e,n))||!(0!==s||!Sd(i,t,n))}function Sd(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function Ad(e){return e>0?1:e<0?-1:0}function Ed(e,t){return Td(e.prev,e,e.next)<0?Td(e,t,e.next)>=0&&Td(e,e.prev,t)>=0:Td(e,t,e.prev)<0||Td(e,e.next,t)<0}function Cd(e,t){const i=new Ld(e.i,e.x,e.y),n=new Ld(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function Md(e,t,i,n){const r=new Ld(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function Id(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ);}function Ld(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1;}Object.defineProperties(sd.prototype,{ellipsoid:{get(){return this._ellipsoid}},surfaceDistance:{get(){return this._distance}},start:{get(){return this._start}},end:{get(){return this._end}},heading:{get(){return this._heading}}}),sd.fromStartHeadingDistance=function(e,t,i,n,r){const o=Z(n,oi.WGS84),a=o.maximumRadius,s=o.minimumRadius,l=a*a,c=Math.sqrt((l-s*s)/l),u=ad(e,t=nt.CesiumMath.negativePiToPi(t),i,o.maximumRadius,c);return !$(r)||$(n)&&!n.equals(r.ellipsoid)?new sd(e,u,o):(r.setEndPoints(e,u),r)},sd.prototype.setEndPoints=function(e,t){od(this,e,t,this._ellipsoid);},sd.prototype.interpolateUsingFraction=function(e,t){return this.interpolateUsingSurfaceDistance(e*this._distance,t)},sd.prototype.interpolateUsingSurfaceDistance=function(e,t){if(!$(this._distance)||0===this._distance)throw new Error("EllipsoidRhumbLine must have distinct start and end set.");return ad(this._start,this._heading,e,this._ellipsoid.maximumRadius,this._ellipticity,t)},sd.prototype.findIntersectionWithLongitude=function(e,t){if(!$(this._distance)||0===this._distance)throw new Error("EllipsoidRhumbLine must have distinct start and end set.");const i=this._ellipticity,n=this._heading,r=Math.abs(n),o=this._start;if(e=nt.CesiumMath.negativePiToPi(e),nt.CesiumMath.equalsEpsilon(Math.abs(e),Math.PI,nt.CesiumMath.EPSILON14)&&(e=nt.CesiumMath.sign(o.longitude)*Math.PI),$(t)||(t=new _s),Math.abs(nt.CesiumMath.PI_OVER_TWO-r)<=nt.CesiumMath.EPSILON8)return t.longitude=e,t.latitude=o.latitude,t.height=0,t;if(nt.CesiumMath.equalsEpsilon(Math.abs(nt.CesiumMath.PI_OVER_TWO-r),nt.CesiumMath.PI_OVER_TWO,nt.CesiumMath.EPSILON8)){if(nt.CesiumMath.equalsEpsilon(e,o.longitude,nt.CesiumMath.EPSILON12))return;return t.longitude=e,t.latitude=nt.CesiumMath.PI_OVER_TWO*nt.CesiumMath.sign(nt.CesiumMath.PI_OVER_TWO-n),t.height=0,t}const a=o.latitude,s=i*Math.sin(a),l=Math.tan(.5*(nt.CesiumMath.PI_OVER_TWO+a))*Math.exp((e-o.longitude)/Math.tan(n)),c=(1+s)/(1-s);let u,h=o.latitude;do{u=h;const e=i*Math.sin(u);h=2*Math.atan(l*Math.pow((1+e)/(1-e)/c,i/2))-nt.CesiumMath.PI_OVER_TWO;}while(!nt.CesiumMath.equalsEpsilon(h,u,nt.CesiumMath.EPSILON12));return t.longitude=e,t.latitude=h,t.height=0,t},sd.prototype.findIntersectionWithLatitude=function(e,t){if(!$(this._distance)||0===this._distance)throw new Error("EllipsoidRhumbLine must have distinct start and end set.");const i=this._ellipticity,n=this._heading,r=this._start;if(nt.CesiumMath.equalsEpsilon(Math.abs(n),nt.CesiumMath.PI_OVER_TWO,nt.CesiumMath.EPSILON8))return;const o=rd(i,r.latitude),a=rd(i,e),s=Math.tan(n)*(a-o),l=nt.CesiumMath.negativePiToPi(r.longitude+s);return $(t)?(t.longitude=l,t.latitude=e,t.height=0,t):new _s(l,e,0)};const Nd=nt.CesiumMath,Rd={computeArea2D:function(e){if(e.length<3)throw new Error("positions.length must greater than 3.");const t=e.length;let i=0;for(let n=t-1,r=0;r<t;n=r++){const t=e[n],o=e[r];i+=t.x*o.y-o.x*t.y;}return .5*i},computeWindingOrder2D:function(e){return Rd.computeArea2D(e)>0?Bd.COUNTER_CLOCKWISE:Bd.CLOCKWISE},triangulate:function(e,t){if(!$($))throw new Error("positions could not be undefined!");return function(e,t,i,n){i=i||2;const r=t&&t.length,o=r?t[0]*i:e.length;let a=ld(e,0,o,i,!0,n);const s=[];if(!a||a.next===a.prev)return s;let l,c,u,h,d,p,f;if(r&&(a=function(e,t,i,n,r){const o=[];let a,s,l,c,u;for(a=0,s=t.length;a<s;a++)l=t[a]*n,c=a<s-1?t[a+1]*n:e.length,u=ld(e,l,c,n,!1,r),u===u.next&&(u.steiner=!0),o.push(xd(u));for(o.sort(md),a=0;a<o.length;a++)_d(o[a],i),i=cd(i,i.next);return i}(e,t,a,i,n)),e.length>80*i){h=c=e[0],d=u=e[1];for(let t=i;t<o;t+=i)p=e[t],f=e[t+1],p<h&&(h=p),f<d&&(d=f),p>c&&(c=p),f>u&&(u=f);l=Math.max(c-h,u-d),l=0!==l?1/l:0;}return ud(a,s,i,h,d,l),s}(It.packArray(e),t,2)},computeSubdivision:function(e,t,i,n){const r=new ft,o=new ft,a=new ft,s=new ft,l=new ft,c=new ft,u=new ft;if(n=Z(n,Nd.RADIANS_PER_DEGREE),"object"!=typeof e)throw new Error("ellipsoid could not be undefined!");if(!$(t))throw new Error("positions could not be undefined!");if(!$(i))throw new Error("indices could not be undefined!");if(i.length<3)throw new Error("indices.length could not less than 3!");if(i.length%3!=0)throw new Error("indices.length % 3 must equal 0!");if(n<=0)throw new Error("granularity must greater than 0!");const h=i.slice(0);let d;const p=t.length,f=new Array(3*p);let m=0;for(d=0;d<p;d++){const e=t[d];f[m++]=e.x,f[m++]=e.y,f[m++]=e.z;}const _=[],g={},y=e.maximumRadius,x=Nd.chordLength(n,y),v=x*x;for(;h.length>0;){const e=h.pop(),t=h.pop(),i=h.pop(),n=ft.fromArray(f,3*i,r),p=ft.fromArray(f,3*t,o),m=ft.fromArray(f,3*e,a),x=ft.multiplyByScalar(ft.normalize(n,s),y,s),w=ft.multiplyByScalar(ft.normalize(p,l),y,l),T=ft.multiplyByScalar(ft.normalize(m,c),y,c),b=ft.magnitudeSquared(ft.subtract(x,w,u)),P=ft.magnitudeSquared(ft.subtract(w,T,u)),S=ft.magnitudeSquared(ft.subtract(T,x,u)),A=Math.max(b,P,S);let E,C;A>v?b===A?(E=`${Math.min(i,t)} ${Math.max(i,t)}`,d=g[E],$(d)||(C=ft.add(n,p,u),ft.multiplyByScalar(C,.5,C),f.push(C.x,C.y,C.z),d=f.length/3-1,g[E]=d),h.push(i,d,e),h.push(d,t,e)):P===A?(E=`${Math.min(t,e)} ${Math.max(t,e)}`,d=g[E],$(d)||(C=ft.add(p,m,u),ft.multiplyByScalar(C,.5,C),f.push(C.x,C.y,C.z),d=f.length/3-1,g[E]=d),h.push(t,d,i),h.push(d,e,i)):S===A&&(E=`${Math.min(e,i)} ${Math.max(e,i)}`,d=g[E],$(d)||(C=ft.add(m,n,u),ft.multiplyByScalar(C,.5,C),f.push(C.x,C.y,C.z),d=f.length/3-1,g[E]=d),h.push(e,d,t),h.push(d,i,t)):(_.push(i),_.push(t),_.push(e));}return {positions:f,indices:_}}},Od=new _s,Dd=new _s,Fd=new _s,zd=new _s;Rd.computeRhumbLineSubdivision=function(e,t,i,n){const r=new ft,o=new ft,a=new ft,s=new ft;if(n=Z(n,Nd.RADIANS_PER_DEGREE),"object"!=typeof e)throw new Error("ellipsoid could not be undefined!");if(!$(t))throw new Error("positions could not be undefined!");if(!$(i))throw new Error("indices could not be undefined!");if(i.length<3)throw new Error("indices.length could not less than 3!");if(i.length%3!=0)throw new Error("indices.length % 3 must equal 0!");if(n<=0)throw new Error("granularity must greater than 0!");const l=i.slice(0);let c;const u=t.length,h=new Array(3*u);let d=0;for(c=0;c<u;c++){const e=t[c];h[d++]=e.x,h[d++]=e.y,h[d++]=e.z;}const p=[],f={},m=Nd.chordLength(n,e.maximumRadius),_=new sd(void 0,void 0,e),g=new sd(void 0,void 0,e),y=new sd(void 0,void 0,e);for(;l.length>0;){const t=l.pop(),i=l.pop(),n=l.pop(),u=ft.fromArray(h,3*n,r),d=ft.fromArray(h,3*i,o),x=ft.fromArray(h,3*t,a),v=e.cartesianToCartographic(u,Od),w=e.cartesianToCartographic(d,Dd),T=e.cartesianToCartographic(x,Fd);_.setEndPoints(v,w);const b=_.surfaceDistance;g.setEndPoints(w,T);const P=g.surfaceDistance;y.setEndPoints(T,v);const S=y.surfaceDistance,A=Math.max(b,P,S);let E,C,M,I;A>m?b===A?(E=`${Math.min(n,i)} ${Math.max(n,i)}`,c=f[E],$(c)||(C=_.interpolateUsingFraction(.5,zd),M=.5*(v.height+w.height),I=ft.fromRadians(C.longitude,C.latitude,M,e,s),h.push(I.x,I.y,I.z),c=h.length/3-1,f[E]=c),l.push(n,c,t),l.push(c,i,t)):P===A?(E=`${Math.min(i,t)} ${Math.max(i,t)}`,c=f[E],$(c)||(C=g.interpolateUsingFraction(.5,zd),M=.5*(w.height+T.height),I=ft.fromRadians(C.longitude,C.latitude,M,e,s),h.push(I.x,I.y,I.z),c=h.length/3-1,f[E]=c),l.push(i,c,n),l.push(c,t,n)):S===A&&(E=`${Math.min(t,n)} ${Math.max(t,n)}`,c=f[E],$(c)||(C=y.interpolateUsingFraction(.5,zd),M=.5*(T.height+v.height),I=ft.fromRadians(C.longitude,C.latitude,M,e,s),h.push(I.x,I.y,I.z),c=h.length/3-1,f[E]=c),l.push(t,c,i),l.push(c,n,i)):(p.push(n),p.push(i),p.push(t));}return {positions:h,indices:p}},Rd.scaleToGeodeticHeight=function(e,t,i,n){i=Z(i,oi.WGS84);let r=new ft,o=new ft;if(t=Z(t,0),n=Z(n,!0),$(e)){const a=e.length;for(let s=0;s<a;s+=3)ft.fromArray(e,s,o),n&&(o=i.scaleToGeodeticSurface(o,o)),0!==t&&(r=i.geodeticSurfaceNormal(o,r),ft.multiplyByScalar(r,t,r),ft.add(o,r,o)),e[s]=o.x,e[s+1]=o.y,e[s+2]=o.z;}return e},Rd.hierarchyPack=function(e,t){if($(e.holes)){t.holes=[];for(let i=0;i<e.holes.length;i++)t.holes[i]=Rd.hierarchyPack(e.holes[i],{});}if($(e.positions)){const i=[];for(let t=0;t<e.positions.length;t++)i.push(ft.pack(e.positions[t],new Array(3)));t.positions=i;}return t},Rd.hierarchyUnpack=function(e,t){if($(e.holes)){t.holes=[];for(const i in e.holes)t.holes[i]=Rd.hierarchyUnpack(e.holes[i],{});}if($(e.positions)){const i=[];for(let t=0;t<e.positions.length;t++)i.push(ft.unpack(e.positions[t]));t.positions=i;}return t};const Bd={CLOCKWISE:hc.CW,COUNTER_CLOCKWISE:hc.CCW};function Vd(){this._array=[],this._offset=0,this._length=0;}Bd.validate=function(e){return e===Bd.CLOCKWISE||e===Bd.COUNTER_CLOCKWISE},Object.defineProperties(Vd.prototype,{length:{get(){return this._length}}}),Vd.prototype.enqueue=function(e){this._array.push(e),this._length++;},Vd.prototype.dequeue=function(){if(0===this._length)return;const e=this._array;let t=this._offset;const i=e[t];return e[t]=void 0,t++,t>10&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,i},Vd.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]},Vd.prototype.contains=function(e){return -1!==this._array.indexOf(e)},Vd.prototype.clear=function(){this._array.length=this._offset=this._length=0;},Vd.prototype.sort=function(e){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e);};class Ud{constructor(e){this.segments=e||[];}pushSegment(e){this.segments.push(e);}prepareSegment(e,t,i){let n=this.segments[this.segments.length-1];return (!n||n.vertexLength+e>Ud.MAX_VERTEX_ARRAY_LENGTH)&&(n={vertexOffset:t.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0},this.segments.push(n)),n}static simpleSegment(e,t,i,n){return new Ud([{vertexOffset:e,primitiveOffset:t,vertexLength:i,primitiveLength:n,vaos:{},sortKey:0}])}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy();}}Ud.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ho("SegmentVector",Ud);const kd=gi([{name:"a_PositionHigh",type:"Float32",components:3},{name:"a_PositionLow",type:"Float32",components:3},{name:"a_TEXCOORD_0",type:"Float32",components:2},{name:"a_NORMAL",type:"Float32",components:3}]),Gd=gi([{name:"a_POSITION",type:"Float32",components:3},{name:"a_TEXCOORD_0",type:"Float32",components:2},{name:"a_NORMAL",type:"Float32",components:3}],4),Hd=nt.TRANSFORM.EPSILON10;function Yd(e,t,i,n){if(!$(e))return;i=Z(i,!1);const r=$(n),o=e.length;if(o<2)return e;let a,s,l,c=e[0],u=0,h=-1;for(a=1;a<o;++a)s=e[a],t(c,s,Hd)?($(l)||(l=e.slice(0,a),u=a-1,h=0),r&&n.push(a)):($(l)&&(l.push(s),u=a,r&&(h=n.length)),c=s);return i&&t(e[0],e[o-1],Hd)&&(r&&($(l)?n.splice(h,0,u):n.push(o-1)),$(l)?l.length-=1:l=e.slice(0,-1)),$(l)?l:e}function qd(e,t,i,n){this.x=Z(e,0),this.y=Z(t,0),this.width=Z(i,0),this.height=Z(n,0);}qd.packedLength=4,qd.pack=function(e,t,i){return i=Z(i,0),t[i++]=e.x,t[i++]=e.y,t[i++]=e.width,t[i]=e.height,t},qd.unpack=function(e,t,i){return t=Z(t,0),$(i)||(i=new qd),i.x=e[t++],i.y=e[t++],i.width=e[t++],i.height=e[t],i},qd.fromPoints=function(e,t){if($(t)||(t=new qd),!$(e)||0===e.length)return t.x=0,t.y=0,t.width=0,t.height=0,t;const i=e.length;let n=e[0].x,r=e[0].y,o=e[0].x,a=e[0].y;for(let t=1;t<i;t++){const i=e[t],s=i.x,l=i.y;n=Math.min(s,n),o=Math.max(s,o),r=Math.min(l,r),a=Math.max(l,a);}return t.x=n,t.y=r,t.width=o-n,t.height=a-r,t},qd.clone=function(e,t){if($(e))return $(t)?(t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,t):new qd(e.x,e.y,e.width,e.height)},qd.union=function(e,t,i){$(i)||(i=new qd);const n=Math.min(e.x,t.x),r=Math.min(e.y,t.y),o=Math.max(e.x+e.width,t.x+t.width),a=Math.max(e.y+e.height,t.y+t.height);return i.x=n,i.y=r,i.width=o-n,i.height=a-r,i},qd.expand=function(e,t,i){i=qd.clone(e,i);const n=t.x-i.x,r=t.y-i.y;return n>i.width?i.width=n:n<0&&(i.width-=n,i.x=t.x),r>i.height?i.height=r:r<0&&(i.height-=r,i.y=t.y),i},qd.equals=function(e,t){return e===t||$(e)&&$(t)&&e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height},qd.prototype.clone=function(e){return qd.clone(this,e)},qd.prototype.equals=function(e){return qd.equals(this,e)};const Xd={NONE:0,GEODESIC:1,RHUMB:2},jd=Xd;class Wd{constructor(){}static adjustPosHeightsForNormal(e,t,i,n){const r=new _s,o=new _s,a=n.cartesianToCartographic(e,r);jt(a,a);const s=a.height,l=n.cartesianToCartographic(t,o);jt(l,l),l.height=s,n.cartographicToCartesian(l,t);const c=n.cartesianToCartographic(i,o);jt(c,c),c.height=s-100,n.cartographicToCartesian(c,i);}static combineGeometries(e){const t=e.length;let i,n,r,o;const a=$(e[0].indices);for(n=1;n<t;++n)if($(e[n].indices)!==a)throw new Error("All geometries must have an indices or not have one.");const s=this.findAttributesInAllGeometries(e);let l,c,u,h;for(i in s)if(s.hasOwnProperty(i))for(l=s[i],o=0,n=0;n<t;++n)for(c=e[n][i],u=c.length,r=0;r<u;++r)l[o++]=c[r];if(a){let i=0;for(n=0;n<t;++n)i+=e[n].indices.length;const r=new Uint16Array(i);let a=0,s=0;for(n=0;n<t;++n){const t=e[n].indices,i=t.length;for(o=0;o<i;++o)r[a++]=s+t[o];s+=e[n].positions.length/3;}h=r;}return {positions:s.positions,normals:s.normals,uvs:s.uvs,indices:h}}static computeAttributes(e){const t=new ft,i=new ft,n=new ft,r=new ft,o=new ft,a=new ft,s=new ft,l=new Ct,c=e.geometry,u=c.positions;let h=u.length;const d=e.wall,p=e.top||d,f=e.bottom||d,m=e.boundingRectangle,_=e.tangentPlane,g=e.ellipsoid,y=e.perPositionHeight,x=o;x.x=m.x,x.y=m.y;const v=new Float32Array(h/3*2);let w;w=y&&p&&!d?c.normals:new Float32Array(h);let T=0,b=0,P=i,S=!0,A=l;A=Ct.clone(Ct.IDENTITY,A);let E=0,C=0;p&&f&&(E=h/2,C=h/3,h/=2);for(let i=0;i<h;i+=3){const o=ft.fromArray(u,i,s);let l=Ct.multiplyByVector(A,o,t);l=g.scaleToGeodeticSurface(l,l);const c=_.projectPointOntoPlane(l,a);It.subtract(c,x,c);const M=De(c.x/m.width,0,1),I=De(c.y/m.height,0,1);f&&(v[T+C]=M,v[T+1+C]=I),p&&(v[T]=M,v[T+1]=I),T+=2;const L=b+1,N=b+2;if(d){if(i+3<h){const e=ft.fromArray(u,i+3,n);if(S){const t=ft.fromArray(u,i+h,r);y&&this.adjustPosHeightsForNormal(o,e,t,g),ft.subtract(e,o,e),ft.subtract(t,o,t),P=ft.normalize(ft.cross(t,e,P),P),S=!1;}ft.equalsEpsilon(e,o,nt.CesiumMath.EPSILON10)&&(S=!0);}}else P=g.geodeticSurfaceNormal(o,P);e.wall?(w[b+E]=P.x,w[L+E]=P.y,w[N+E]=P.z):f&&(w[b+E]=-P.x,w[L+E]=-P.y,w[N+E]=-P.z),(p&&!y||d)&&(w[b]=P.x,w[L]=P.y,w[N]=P.z),b+=3;}return c.uvs=v,c.normals=w,c}static computeBoundingBox(e){const t=[];for(let i=0;i<e.length;i+=3)t.push(new ft(e[i],e[i+1],e[i+2]));return (new gu).setFromPoints(t)}static computeBoundingSphere(e){const t=[];for(let i=0;i<e.length;i+=3)t.push(new ft(e[i],e[i+1],e[i+2]));return Zc.fromPoints(t)}static computeBoundingRectangle(e,t,i,n=0,r){const o=(new Tt).fromAxisRotation(new ft(e.x,e.y,e.z),n),a=(new Ct).fromQuaternion(o);let s=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,c=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY;const h=i.length;for(let e=0;e<h;++e){const n=ft.clone(i[e]);Ct.multiplyByVector(a,n,n);const r=t(n);s=Math.min(s,r.x),l=Math.max(l,r.x),c=Math.min(c,r.y),u=Math.max(u,r.y);}return $(r)||(r=new qd),r.x=s,r.y=c,r.width=l-s,r.height=u-c,r}static computeNormal(e,t){const i=new ft,n=new ft,r=new ft,o=new ft,a=e.length/3,s=t.length,l=new Array(a),c=new Array(s/3),u=new Array(s);let h;for(h=0;h<a;h++)l[h]={indexOffset:0,count:0,currentCount:0};let d=0;for(h=0;h<s;h+=3){const i=t[h],a=t[h+1],s=t[h+2],u=3*i,p=3*a,f=3*s;n.x=e[u],n.y=e[u+1],n.z=e[u+2],r.x=e[p],r.y=e[p+1],r.z=e[p+2],o.x=e[f],o.y=e[f+1],o.z=e[f+2],l[i].count++,l[a].count++,l[s].count++,ft.subtract(r,n,r),ft.subtract(o,n,o),c[d]=ft.cross(r,o,new ft),d++;}let p,f=0;for(h=0;h<a;h++)l[h].indexOffset+=f,f+=l[h].count;for(d=0,h=0;h<s;h+=3){p=l[t[h]];let e=p.indexOffset+p.currentCount;u[e]=d,p.currentCount++,p=l[t[h+1]],e=p.indexOffset+p.currentCount,u[e]=d,p.currentCount++,p=l[t[h+2]],e=p.indexOffset+p.currentCount,u[e]=d,p.currentCount++,d++;}const m=[];for(h=0;h<a;h++){const e=3*h;if(p=l[h],ft.clone(ft.ZERO,i),p.count>0){for(d=0;d<p.count;d++)ft.add(i,c[u[p.indexOffset+d]],i);ft.equalsEpsilon(ft.ZERO,i,nt.CesiumMath.EPSILON10)&&ft.clone(c[u[p.indexOffset]],i);}ft.equalsEpsilon(ft.ZERO,i,nt.CesiumMath.EPSILON10)&&(i.z=1),ft.normalize(i,i),m[e]=i.x,m[e+1]=i.y,m[e+2]=i.z;}return m}static createGeometryFromPositions(e,t,i,n,r){let o=Rd.triangulate(t.positions2D,t.holes);o.length<3&&(o=[0,1,2]);const a=t.positions;if(n){const e=a.length,t=new Array(3*e);let i=0;for(let n=0;n<e;n++){const e=a[n];t[i++]=e.x,t[i++]=e.y,t[i++]=e.z;}return {positions:t,indices:o,normals:this.computeNormal(t,o)}}return r===jd.GEODESIC?Rd.computeSubdivision(e,a,o,i):r===jd.RHUMB?Rd.computeRhumbLineSubdivision(e,a,o,i):void 0}static createOutlineGeometryFromPositions(e,t,i,n,r){const o=[],a=au.fromPoints(t,e).projectPointsOntoPlane(t,[]);let s,l;Rd.computeWindingOrder2D(a)===Bd.CLOCKWISE&&(a.reverse(),t=t.slice().reverse());let c=t.length,u=0;if(n)for(s=new Float64Array(2*c*3),l=0;l<c;l++){const e=t[l],i=t[(l+1)%c];s[u++]=e.x,s[u++]=e.y,s[u++]=e.z,s[u++]=i.x,s[u++]=i.y,s[u++]=i.z;}else {let n=0;if(r===jd.GEODESIC)for(l=0;l<c;l++)n+=Wd.subdivideLineCount(t[l],t[(l+1)%c],i);else if(r===jd.RHUMB)for(l=0;l<c;l++)n+=Wd.subdivideRhumbLineCount(e,t[l],t[(l+1)%c],i);for(s=new Float64Array(3*n),l=0;l<c;l++){let n;r===jd.GEODESIC?n=Wd.subdivideLine(t[l],t[(l+1)%c],i,o):r===jd.RHUMB&&(n=Wd.subdivideRhumbLine(e,t[l],t[(l+1)%c],i,o));const a=n.length;for(let e=0;e<a;++e)s[u++]=n[e];}}c=s.length/3;const h=new Uint16Array(2*c);for(u=0,l=0;l<c-1;l++)h[u++]=l,h[u++]=l+1;return h[u++]=c-1,h[u++]=0,{positions:s,indices:h}}static createGeometryFromPositionsExtruded(e,t,i,n,r,o,a,s){const l=[],c={walls:[]};let u;if(o||a){const n=this.createGeometryFromPositions(e,t,i,r,s),l=n.positions,h=n.indices;let d,p;if(o&&a){const e=l.concat(l);d=e.length/3,p=new Uint16Array(2*h.length),p.set(h);const t=h.length,i=d/2;for(u=0;u<t;u+=3){const e=p[u]+i,n=p[u+1]+i;p[u+t]=p[u+2]+i,p[u+1+t]=n,p[u+2+t]=e;}if(n.positions=e,r){const t=n.normals;n.normals=new Float32Array(e.length),n.normals.set(t);}n.indices=p;}else if(a){for(d=l.length/3,p=new Float32Array(h.length),u=0;u<h.length;u+=3)p[u]=h[u+2],p[u+1]=h[u+1],p[u+2]=h[u];n.indices=p;}c.topAndBottom=n;}let h=n.outerRing,d=au.fromPoints(h,e),p=d.projectPointsOntoPlane(h,l),f=Rd.computeWindingOrder2D(p);f===Bd.CLOCKWISE&&(h=h.slice().reverse());let m=this.computeWallGeometry(h,e,i,r,s);c.walls.push(m);const _=n.holes;for(u=0;u<_.length;u++){let t=_[u];d=au.fromPoints(t,e),p=d.projectPointsOntoPlane(t,l),f=Rd.computeWindingOrder2D(p),f===Bd.COUNTER_CLOCKWISE&&(t=t.slice().reverse()),m=this.computeWallGeometry(t,e,i,r,s),c.walls.push(m);}return c}static createOutlineGeometryFromPositionsExtruded(e,t,i,n,r){const o=[],a=au.fromPoints(t,e).projectPointsOntoPlane(t,[]);let s,l;Rd.computeWindingOrder2D(a)===Bd.CLOCKWISE&&(a.reverse(),t=t.slice().reverse());let c=t.length;const u=new Array(c);let h=0;if(n)for(s=new Float64Array(2*c*3*2),l=0;l<c;++l){u[l]=h/3;const e=t[l],i=t[(l+1)%c];s[h++]=e.x,s[h++]=e.y,s[h++]=e.z,s[h++]=i.x,s[h++]=i.y,s[h++]=i.z;}else {let n=0;if(r===jd.GEODESIC)for(l=0;l<c;l++)n+=Wd.subdivideLineCount(t[l],t[(l+1)%c],i);else if(r===jd.RHUMB)for(l=0;l<c;l++)n+=Wd.subdivideRhumbLineCount(e,t[l],t[(l+1)%c],i);for(s=new Float64Array(3*n*2),l=0;l<c;++l){let n;u[l]=h/3,r===jd.GEODESIC?n=Wd.subdivideLine(t[l],t[(l+1)%c],i,o):r===jd.RHUMB&&(n=Wd.subdivideRhumbLine(e,t[l],t[(l+1)%c],i,o));const a=n.length;for(let e=0;e<a;++e)s[h++]=n[e];}}c=s.length/6;const d=u.length,p=new Uint16Array(2*(2*c+d));for(h=0,l=0;l<c;++l)p[h++]=l,p[h++]=(l+1)%c,p[h++]=l+c,p[h++]=(l+1)%c+c;for(l=0;l<d;l++){const e=u[l];p[h++]=e,p[h++]=e+c;}return {positions:s,indices:p}}static computeWallGeometry(e,t,i,n,r){const o=[],a=new ft,s=new ft;let l,c,u,h,d,p=e.length,f=0;if(n)for(c=3*p*2,l=new Array(2*c),u=0;u<p;u++)h=e[u],d=e[(u+1)%p],l[f]=l[f+c]=h.x,++f,l[f]=l[f+c]=h.y,++f,l[f]=l[f+c]=h.z,++f,l[f]=l[f+c]=d.x,++f,l[f]=l[f+c]=d.y,++f,l[f]=l[f+c]=d.z,++f;else {const n=nt.CesiumMath.chordLength(i,t.maximumRadius);let a=0;if(r===jd.GEODESIC)for(u=0;u<p;u++)a+=this.subdivideLineCount(e[u],e[(u+1)%p],n);else if(r===jd.RHUMB)for(u=0;u<p;u++)a+=this.subdivideRhumbLineCount(t,e[u],e[(u+1)%p],n);for(c=3*(a+p),l=new Array(2*c),u=0;u<p;u++){let i;h=e[u],d=e[(u+1)%p],r===jd.GEODESIC?i=this.subdivideLine(h,d,n,o):r===jd.RHUMB&&(i=this.subdivideRhumbLine(t,h,d,n,o));const a=i.length;for(let e=0;e<a;++e,++f)l[f]=i[e],l[f+c]=i[e];l[f]=d.x,l[f+c]=d.x,++f,l[f]=d.y,l[f+c]=d.y,++f,l[f]=d.z,l[f+c]=d.z,++f;}}p=l.length;const m=new Uint16Array(p-6*e.length);let _=0;for(p/=6,u=0;u<p;u++){const e=u,t=e+1,i=e+p,n=i+1;h=ft.fromArray(l,3*e,a),d=ft.fromArray(l,3*t,s),ft.equalsEpsilon(h,d,nt.CesiumMath.EPSILON10,nt.CesiumMath.EPSILON10)||(m[_++]=e,m[_++]=i,m[_++]=t,m[_++]=t,m[_++]=i,m[_++]=n);}return {positions:l,indices:m}}static findAttributesInAllGeometries(e){const t=e.length,i={};let n;for(n in e[0]){const r=e[0][n];let o=r.length,a=!0;for(let i=1;i<t;++i){const t=e[i][n];if(!$(t)||r.componentDatatype!==t.componentDatatype||r.componentsPerAttribute!==t.componentsPerAttribute||r.normalize!==t.normalize){a=!1;break}o+=t.length;}a&&("positions"===n?i[n]=new Float64Array(o):"normals"!==n&&"uvs"!==n||(i[n]=new Float32Array(o)));}return i}static getPointAtDistance(e,t,i,n){const r=new ft;return ft.subtract(t,e,r),ft.multiplyByScalar(r,i/n,r),ft.add(e,r,r),[r.x,r.y,r.z]}static scaleToGeodeticHeightExtruded(e,t,i,n,r){const o=new ft,a=new ft,s=new ft,l=new ft;n=Z(n,oi.WGS84);const c=o;let u=a;const h=s;let d=l;if($(e)&&$(e.positions)){const o=e.positions,a=o.length/2;for(let e=0;e<a;e+=3)ft.fromArray(o,e,h),n.geodeticSurfaceNormal(h,c),d=n.scaleToGeodeticSurface(h,d),u=ft.multiplyByScalar(c,i,u),u=ft.add(d,u,u),o[e+a]=u.x,o[e+1+a]=u.y,o[e+2+a]=u.z,r&&(d=ft.clone(h,d)),u=ft.multiplyByScalar(c,t,u),u=ft.add(d,u,u),o[e]=u.x,o[e+1]=u.y,o[e+2]=u.z;}return e}static subdivideLine(e,t,i,n){const r=this.subdivideLineCount(e,t,i),o=ft.distance(e,t),a=o/r;$(n)||(n=[]);const s=n;s.length=3*r;let l=0;for(let i=0;i<r;i++){const n=this.getPointAtDistance(e,t,i*a,o);s[l++]=n[0],s[l++]=n[1],s[l++]=n[2];}return s}static subdivideLineCount(e,t,i){const n=ft.distance(e,t),r=Math.max(0,Math.ceil(nt.CesiumMath.log2(n/i)));return Math.pow(2,r)}static subdivideRhumbLine(e,t,i,n,r){const o=new _s,a=new _s,s=new _s,l=new ft,c=new sd(e.cartesianToCartographic(t,o),e.cartesianToCartographic(i,a),e),u=Math.max(0,Math.ceil(nt.CesiumMath.log2(c.surfaceDistance/n))),h=Math.pow(2,u),d=c.surfaceDistance/h;$(r)||(r=[]);const p=r;p.length=3*h;let f=0;for(let t=0;t<h;t++){const i=c.interpolateUsingSurfaceDistance(t*d,s),n=e.cartographicToCartesian(i,l);p[f++]=n.x,p[f++]=n.y,p[f++]=n.z;}return p}static subdivideRhumbLineCount(e,t,i,n){const r=new _s,o=new _s,a=new sd(e.cartesianToCartographic(t,r),e.cartesianToCartographic(i,o),e),s=Math.max(0,Math.ceil(nt.CesiumMath.log2(a.surfaceDistance/n)));return Math.pow(2,s)}static polygonsFromHierarchy(e,t,i,n){const r=[],o=[],a=new Vd;for(a.enqueue(e);0!==a.length;){const e=a.dequeue();let s=e.positions;const l=e.holes;let c,u;if(i)for(u=s.length,c=0;c<u;c++)n.scaleToGeodeticSurface(s[c],s[c]);if(s=Yd(s,ft.equalsEpsilon,!0),s.length<3)continue;let h=t(s);if(!$(h))continue;const d=[];let p=Rd.computeWindingOrder2D(h);p===Bd.CLOCKWISE&&(h.reverse(),s=s.slice().reverse());let f=s.slice();const m=$(l)?l.length:0,_=[];let g;for(c=0;c<m;c++){const e=l[c];let r=e.positions;if(i)for(u=r.length,g=0;g<u;++g)n.scaleToGeodeticSurface(r[g],r[g]);if(r=Yd(r,ft.equalsEpsilon,!0),r.length<3)continue;const o=t(r);if(!$(o))continue;p=Rd.computeWindingOrder2D(o),p===Bd.CLOCKWISE&&(o.reverse(),r=r.slice().reverse()),_.push(r),d.push(f.length),f=f.concat(r),h=h.concat(o);let s=0;for($(e.holes)&&(s=e.holes.length),g=0;g<s;g++)a.enqueue(e.holes[g]);}r.push({outerRing:s,holes:_}),o.push({positions:f,positions2D:h,holes:d});}return {hierarchy:r,polygons:o}}static polygonOutlinesFromHierarchy(e,t,i){const n=[],r=new Vd;let o,a,s;for(r.enqueue(e);0!==r.length;){const e=r.dequeue();let l=e.positions;if(t)for(s=l.length,o=0;o<s;o++)i.scaleToGeodeticSurface(l[o],l[o]);if(l=Yd(l,ft.equalsEpsilon,!0),l.length<3)continue;const c=e.holes?e.holes.length:0;for(o=0;o<c;o++){const l=e.holes[o];let c=l.positions;if(t)for(s=c.length,a=0;a<s;++a)i.scaleToGeodeticSurface(c[a],c[a]);if(c=Yd(c,ft.equalsEpsilon,!0),c.length<3)continue;n.push(c);let u=0;for($(l.holes)&&(u=l.holes.length),a=0;a<u;a++)r.enqueue(l.holes[a]);}n.push(l);}return n}}const $d={TERRAIN:0,MINEMAP_3D_TILE:1,BOTH:2,SINGULARIZATION:3,NONE:4,ALL:5,IGNORECLASSIFICATION:6,VECTOR_WITH_HEIGHT:7,FORCE_VECTOR_OVER_MODEL:8};var Zd=Object.freeze($d);function Kd(e){return !!$(e)&&(e===$d.ALL||e===$d.BOTH||e===$d.TERRAIN||e===$d.MINEMAP_3D_TILE||e===$d.SINGULARIZATION)}const Qd=8848;class Jd{static getMinMaxHeight(e){switch(e.classificationtype){case Zd.TERRAIN:case Zd.MINEMAP_3D_TILE:case Zd.BOTH:case Zd.SINGULARIZATION:case Zd.ALL:e.maximumHeight=Qd,e.minimumHeight=-10;break;default:e.maximumHeight=0,e.minimumHeight=0;}}static get3DTileMinMaxHeight(){}}const ep=nt.CesiumMath;class tp extends id{constructor(e){super(e),$(e.adaptTerrain)&&(this.adaptTerrain=e.adaptTerrain),this.setData(e);}updateProperty(e){this.setData(e);}setData(e){super.setData(e),this._setProperty(e),e.adaptTerrain?this._parseExtrude():this._parse();}_setProperty(e){if($(e.perPositionHeight)&&e.perPositionHeight&&$(e.height))throw new Error("Cannot use both options.perPositionHeight and options.height");if($(e.arcType)&&e.arcType!==jd.GEODESIC&&e.arcType!==jd.RHUMB)throw new Error("Invalid arcType. Valid options are minemap.ARCTYPE.GEODESIC and minemap.ARCTYPE.RHUMB.");if(!$(e.polygonHierarchy)||!$(e.polygonHierarchy.positions))throw new Error("positions must be defined!");let t;if(e.polygonHierarchy.positions instanceof Function&&(t=e.polygonHierarchy.positions),this._positionsCallBack=t,this.minimumHeight=Z(e.minimumHeight,Z(this.minimumHeight,-10)),this.maximumHeight=Z(e.maximumHeight,Z(this.maximumHeight,Qd)),this._polygonHierarchy=e.polygonHierarchy,this._granularity=Z(e.granularity,nt.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=Z(e.ellipsoid,oi.WGS84),this._perPositionHeight=Z(e.perPositionHeight,!1),this._perPositionHeightExtrude=this._perPositionHeight&&$(e.extrudedHeight),this._height=Z(e.height,0),this._extrudedHeight=Z(e.extrudedHeight,this._height),!this._perPositionHeightExtrude){const e=Math.max(this._height,this._extrudedHeight);this._extrudedHeight=Math.min(this._height,this._extrudedHeight),this._height=e;}this._closeTop=Z(e.closeTop,!0),this._closeBottom=Z(e.closeBottom,!0),this._arcType=Z(e.arcType,jd.GEODESIC),this.type="PolygonGeometry",this.vertices=void 0,this.normals=void 0,this.indices=void 0,this.uvs=void 0,this._referenceCenter=Z(e.referenceCenter,new ft),this._usedDoublePrecision=!$(e.referenceCenter),this._vertexArray=this._usedDoublePrecision?new na:new Qo,this._checkSelfIntersection=Z(e.checkSelfIntersection,!1),this._indices=new Ia,this._needUpdate=!0,this._initialized=!1,this.primitiveType=hc.TRIANGLES;}static isSelfIntersection(e,t=!1){const i=[];for(const n of e)i.push(t?lc.cartesian3ToCartographic(n).slice(0,2):n);const n=parseFloat(i[0][0]).toFixed(5),r=parseFloat(i[0][1]).toFixed(5),o=parseFloat(i[i.length-1][0]).toFixed(5),a=parseFloat(i[i.length-1][1]).toFixed(5);return n===o&&r===a||i.push(i[0]),function(e){for(var t,i,n=fe(e),r=0,o=1;o<n.length;)t=i||n[0],r+=((i=n[o])[0]-t[0])*(i[1]+t[1]),o++;return r>0}(Ce(i))&&i.reverse(),function(e){var t,i,n={type:"FeatureCollection",features:[]};if("LineString"===(i="Feature"===e.type?e.geometry:e).type)t=[i.coordinates];else if("MultiLineString"===i.type)t=i.coordinates;else if("MultiPolygon"===i.type)t=[].concat.apply([],i.coordinates);else {if("Polygon"!==i.type)throw new Error("Input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry");t=i.coordinates;}return t.forEach((function(e){t.forEach((function(t){for(var i=0;i<e.length-1;i++)for(var r=i;r<t.length-1;r++){if(e===t){if(1===Math.abs(i-r))continue;if(0===i&&r===e.length-2&&e[i][0]===e[e.length-1][0]&&e[i][1]===e[e.length-1][1])continue}var o=(void 0,m=void 0,_=void 0,g=void 0,y=void 0,y={x:null,y:null,onLine1:!1,onLine2:!1},0==(f=((p=t[r+1][1])-(h=t[r][1]))*((l=e[i+1][0])-(a=e[i][0]))-((d=t[r+1][0])-(u=t[r][0]))*((c=e[i+1][1])-(s=e[i][1])))?null!==y.x&&null!==y.y&&y:(g=(d-u)*(m=s-h)-(p-h)*(_=a-u),_=((l-a)*m-(c-s)*_)/f,y.x=a+(m=g/f)*(l-a),y.y=s+m*(c-s),m>=0&&m<=1&&(y.onLine1=!0),_>=0&&_<=1&&(y.onLine2=!0),!(!y.onLine1||!y.onLine2)&&[y.x,y.y]));o&&n.features.push(ae([o[0],o[1]]));}var a,s,l,c,u,h,d,p,f,m,_,g,y;}));})),n}(Me([i])).features.length>0}_parse(){let e;if(e=this._positionsCallBack?this._positionsCallBack():this._polygonHierarchy.positions,e.length<3)return;if(this._checkSelfIntersection&&tp.isSelfIntersection(e,!0))return void console.error("不支持自相交多边形！");this._needUpdate=!0;const t=au.fromPoints(e,this._ellipsoid),i=Wd.polygonsFromHierarchy($(this._positionsCallBack)?{positions:e}:this._polygonHierarchy,t.projectPointsOntoPlane.bind(t),!this._perPositionHeight,this._ellipsoid),n=i.hierarchy,r=i.polygons;if(0===n.length)return;e=n[0].outerRing;const o=Wd.computeBoundingRectangle(t.plane.normal,t.projectPointOntoPlane.bind(t),e),a=[],s=this._height,l=this._extrudedHeight,c=this._perPositionHeightExtrude||!nt.CesiumMath.equalsEpsilon(s,l,0,nt.CesiumMath.EPSILON2),u={perPositionHeight:this._perPositionHeight,tangentPlane:t,boundingRectangle:o,ellipsoid:this._ellipsoid,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:this._arcType};let h;if(c)for(u.extrude=!0,u.top=this._closeTop,u.bottom=this._closeBottom,h=0;h<r.length;h++){const e=Wd.createGeometryFromPositionsExtruded(this._ellipsoid,r[h],this._granularity,n[h],this._perPositionHeight,this._closeTop,this._closeBottom,this._arcType),t=e.topAndBottom;this._closeTop&&this._closeBottom?u.geometry=Wd.scaleToGeodeticHeightExtruded(t,s,l,this._ellipsoid,this._perPositionHeight):this._closeTop?(t.positions=Rd.scaleToGeodeticHeight(t.positions,s,this._ellipsoid,!this._perPositionHeight),u.geometry=t):this._closeBottom&&(t.position=Rd.scaleToGeodeticHeight(t.positions,l,this._ellipsoid,!0),u.geometry=t),(this._closeTop||this._closeBottom)&&(u.wall=!1,t.geometry=Wd.computeAttributes(u),a.push(t));const i=e.walls;u.wall=!0;for(let e=0;e<i.length;e++)u.geometry=Wd.scaleToGeodeticHeightExtruded(i[e],s,l,this._ellipsoid,this._perPositionHeight),u.geometry=Wd.computeAttributes(u),a.push(u.geometry);}else for(h=0;h<r.length;h++)u.geometry=Wd.createGeometryFromPositions(this._ellipsoid,r[h],this._granularity,this._perPositionHeight,this._arcType),u.geometry=Wd.computeAttributes(u),a.push(u.geometry);const d=Wd.combineGeometries(a);this.normals=d.normals,this.indices=d.indices,this.uvs=d.uvs,this._indices.clear();for(let e=0;e<this.indices.length;e+=3)this._indices.emplaceBack(this.indices[e],this.indices[e+1],this.indices[e+2]);this.vertices=Rd.scaleToGeodeticHeight(d.positions,s,this._ellipsoid,!this._perPositionHeight);const p=new ft;for(let e=0;e<this.vertices.length;e+=3)ft.fromArray(this.vertices,e,p),ft.subtract(p,this._referenceCenter,p),this.vertices[e]=p.x,this.vertices[e+1]=p.y,this.vertices[e+2]=p.z;this.emplaceVertexBufferTriangle(),this._initialized=!0,this.computeBoundingSphere(),this.computeBoundingBox();}_parseExtrude(){let e;if(e=this._positionsCallBack?this._positionsCallBack():this._polygonHierarchy.positions,e.length<3)return;if(this._checkSelfIntersection&&tp.isSelfIntersection(e,!0))return void console.error("不支持自相交多边形！");this._needUpdate=!0;const t=au.fromPoints(e,this._ellipsoid),i=Wd.polygonsFromHierarchy($(this._positionsCallBack)?{positions:e}:this._polygonHierarchy,t.projectPointsOntoPlane.bind(t),!0,this._ellipsoid),n=i.hierarchy,r=i.polygons;if(0===n.length)return;e=n[0].outerRing;const o=Wd.computeBoundingRectangle(t.plane.normal,t.projectPointOntoPlane.bind(t),e),a=[],s=this.minimumHeight,l=this.maximumHeight-this.minimumHeight,c={perPositionHeight:!0,tangentPlane:t,boundingRectangle:o,ellipsoid:this._ellipsoid,bottom:!0,top:!0,wall:!1,extrude:!0,arcType:this._arcType};for(let e=0;e<r.length;e++){const t=Wd.createGeometryFromPositionsExtruded(c.ellipsoid,r[e],this._granularity,n[e],c.perPositionHeight,c.top,c.bottom,c.arcType),i=t.topAndBottom;c.geometry=Wd.scaleToGeodeticHeightExtruded(i,s,l,c.ellipsoid,c.perPositionHeight),c.wall=!1,i.geometry=Wd.computeAttributes(c),a.push(i);const o=t.walls;c.wall=!0;for(let e=0;e<o.length;e++)c.geometry=Wd.scaleToGeodeticHeightExtruded(o[e],s,l,c.ellipsoid,c.perPositionHeight),c.geometry=Wd.computeAttributes(c),a.push(c.geometry);}const u=Wd.combineGeometries(a);this.normals=u.normals,this.indices=u.indices,this.uvs=u.uvs,this._indices.clear();for(let e=0;e<this.indices.length;e+=3)this._indices.emplaceBack(this.indices[e],this.indices[e+1],this.indices[e+2]);this.vertices=Rd.scaleToGeodeticHeight(u.positions,s,c.ellipsoid,!c.perPositionHeight);const h=new ft;for(let e=0;e<this.vertices.length;e+=3)ft.fromArray(this.vertices,e,h),this.vertices[e]=h.x,this.vertices[e+1]=h.y,this.vertices[e+2]=h.z;this.emplaceVertexBufferTriangle(),this._initialized=!0,this.computeBoundingSphere(),this.computeBoundingBox();}update(e){if($(this._positionsCallBack)&&(e.adaptTerrain?this._parseExtrude():this._parse()),this._initialized&&this._needUpdate&&e.painter){const t=e.painter.context;this._segmentVector&&this._segmentVector.destroy(),this._vertBuffer&&this._indexBuffer?(this._vertBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indices)):(this._vertBuffer=t.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?kd.members:Gd.members,this.dynamicDraw),this._indexBuffer=t.createIndexBuffer(this._indices,this.dynamicDraw)),this._segmentVector=Ud.simpleSegment(0,0,this.vertices.length/3,this.indices.length/3),this._needUpdate=!1,this._initialized=!1;}}serialize(){const e={type:this.type,polygonHierarchy:Rd.hierarchyPack(this._polygonHierarchy,{}),perPositionHeight:this._perPositionHeight,arcType:this._arcType};return (this._perPositionHeightExtrude||!nt.CesiumMath.equalsEpsilon(this._height,this._extrudedHeight,0,nt.CesiumMath.EPSILON2))&&(e.extrudedHeight=this._extrudedHeight),this._perPositionHeight||(e.height=this._height),e}setAdaptTerrain(e){this._vertexArray=this._usedDoublePrecision?new na:new Qo,this._indices=new Ia,e?this._parseExtrude():this._parse();}computeRectangle(e,t,i,n,r){if(r=Z(r,new gs),!$(e)||e.length<3)return r.west=0,r.north=0,r.south=0,r.east=0,r;if(i===jd.RHUMB)return gs.fromCartesianArray(e,t,r);let o=new il;o.ellipsoid.equals(t)||(o=new il(void 0,void 0,t));const a={westOverIDL:0,eastOverIDL:0},s=new _s,l=new _s;r.west=Number.POSITIVE_INFINITY,r.east=Number.NEGATIVE_INFINITY,r.south=Number.POSITIVE_INFINITY,r.north=Number.NEGATIVE_INFINITY,a.westOverIDL=Number.POSITIVE_INFINITY,a.eastOverIDL=Number.NEGATIVE_INFINITY;const c=1/ep.chordLength(n,t.maximumRadius),u=e.length;let h=t.cartesianToCartographic(e[0],l);jt(h,h);let d,p=s;for(let i=1;i<u;i++)d=p,p=h,h=t.cartesianToCartographic(e[i],d),jt(h,h),o.setEndPoints(p,h),this.interpolateAndGrowRectangle(o,c,r,a);return d=p,p=h,h=t.cartesianToCartographic(e[0],d),jt(h,h),o.setEndPoints(p,h),this.interpolateAndGrowRectangle(o,c,r,a),r.east-r.west>a.eastOverIDL-a.westOverIDL&&(r.west=a.westOverIDL,r.east=a.eastOverIDL,r.east>ep.PI&&(r.east=r.east-ep.TWO_PI),r.west>ep.PI&&(r.west=r.west-ep.TWO_PI)),r}interpolateAndGrowRectangle(e,t,i,n){const r=new _s,o=e.surfaceDistance,a=Math.ceil(o*t),s=a>0?o/(a-1):Number.POSITIVE_INFINITY;let l=0;for(let t=0;t<a;t++){const t=e.interpolateUsingSurfaceDistance(l,r);l+=s;const o=t.longitude,a=t.latitude;i.west=Math.min(i.west,o),i.east=Math.max(i.east,o),i.south=Math.min(i.south,a),i.north=Math.max(i.north,a);const c=o>=0?o:o+ep.TWO_PI;n.westOverIDL=Math.min(n.westOverIDL,c),n.eastOverIDL=Math.max(n.eastOverIDL,c);}}textureCoordinateRotationPoints(){return [0,0,0,1,1,0]}getSphericalExtentGeometryInstanceAttributes(e,t,i){const n=this.latLongToSpherical(e.south,e.west,i);let r=n.x,o=n.y;const a=this.latLongToSpherical(e.north,e.east,i);let s=a.x,l=a.y,c=0;o>l&&(c=ep.PI-o,o=-ep.PI,l+=c),r-=ep.EPSILON5,o-=ep.EPSILON5,s+=ep.EPSILON5,l+=ep.EPSILON5,this.sphericalExtents=new wt(r,o,1/(s-r),1/(l-o)),this.attributes.push({name:"sphericalExtents",type:hc.FLOAT,components:4,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1,batchTableAttributeIndex:this.attributes.length}),this.attributes.push({name:"longitudeRotation",type:hc.FLOAT,components:1,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1,batchTableAttributeIndex:this.attributes.length}),this.longitudeRotation=0;const u=new dc(i);this.addTextureCoordinateRotationAttributes(t),this.add2DTextureCoordinateAttributes(e,u);}latLongToSpherical(e,t){const i=new _s;i.latitude=e,i.longitude=t,i.height=0;const n=_s.toVector3(i),r=Math.sqrt(n.x*n.x+n.y*n.y),o=ep.fastApproximateAtan2(r,n.z),a=ep.fastApproximateAtan2(n.x,n.y),s=new It;return s.x=o,s.y=a,s}addTextureCoordinateRotationAttributes(e){const t=[new It,new It,new It,new It],i=It.unpack(e,0,t[0]),n=It.unpack(e,2,t[1]),r=It.unpack(e,4,t[2]);this.attributes.push({name:"uMaxVmax",type:hc.FLOAT,components:4,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1,batchTableAttributeIndex:this.attributes.length}),this.uMaxVmax=new wt(n.x,n.y,r.x,r.y);const o=1/this.pointLineDistance(i,n,r),a=1/this.pointLineDistance(i,r,n);this.attributes.push({name:"uvMinAndExtents",type:hc.FLOAT,components:4,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1,batchTableAttributeIndex:this.attributes.length}),this.uvMinAndExtents=new wt(i.x,i.y,o,a);}add2DTextureCoordinateAttributes(e,t){const i=new _s,n={high:0,low:0};i.height=0,i.longitude=e.west,i.latitude=e.south;const r=t.project(i);i.latitude=e.north;const o=t.project(i);i.longitude=e.east,i.latitude=e.south;const a=t.project(i),s=[0,0,0,0],l=[0,0,0,0];let c=Qh.encode(r.x,n);s[0]=c.high,l[0]=c.low,c=Qh.encode(r.y,n),s[1]=c.high,l[1]=c.low,c=Qh.encode(o.y,n),s[2]=c.high,l[2]=c.low,c=Qh.encode(a.x,n),s[3]=c.high,l[3]=c.low,this.attributes.push({name:"planes2DHIGH",type:hc.FLOAT,components:4,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1,batchTableAttributeIndex:this.attributes.length}),this.planes2DHIGH=new wt(s[0],s[1],s[2],s[3]),this.attributes.push({name:"planes2DLOW",type:hc.FLOAT,components:4,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1,batchTableAttributeIndex:this.attributes.length}),this.planes2DLOW=new wt(l[0],l[1],l[2],l[3]);}pointLineDistance(e,t,i){return Math.abs((t.y-e.y)*i.x-(t.x-e.x)*i.y+t.x*e.y-t.y*e.x)/It.distance(t,e)}getDataComputeUV(){this._rectangle=this.computeRectangle(this._polygonHierarchy.positions,this._ellipsoid,this._arcType,this._granularity),this.attributes=[];const e=this.textureCoordinateRotationPoints();this.getSphericalExtentGeometryInstanceAttributes(this._rectangle,e,this._ellipsoid);}destroy(){return super.destroy(),this._polygonHierarchy=void 0,this._granularity=void 0,this._ellipsoid=void 0,this._perPositionHeight=void 0,this._perPositionHeightExtrude=void 0,this._height=void 0,this._extrudedHeight=void 0,this._closeTop=void 0,this._closeBottom=void 0,this._arcType=void 0,this.type=void 0,this._vertexArray=void 0,this._indices=void 0,this._initialized=void 0,this._needUpdate=void 0,this.primitiveType=void 0,this.vertices=void 0,this.normals=void 0,this.indices=void 0,this.uvs=void 0,this.boundingBox=void 0,this.boundingSphere=void 0,this._vertBuffer=void 0,this._indexBuffer=void 0,this._segmentVector=void 0,uc(this)}}const ip=function(e,t){return 256*(e=De(Math.floor(e),0,255))+De(Math.floor(t),0,255)};class np{constructor(){this.first=!0;}update(e,t){const i=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=i,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=i,!0):(this.lastFloorZoom>i?(this.lastIntegerZoom=i+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<i&&(this.lastIntegerZoom=i,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=i,!0))}}const rp="deferred",op="loading",ap="loaded";let sp=null,lp="unavailable",cp=null;const up=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(lp="error"),sp&&sp(e);};function hp(){dp.fire(new al("pluginStateChange",{pluginStatus:lp,pluginURL:cp}));}const dp=new ll,pp=function(){return lp},fp=function(){if(lp!==rp||!cp)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");lp=op,hp(),cp&&Wu({url:cp},(e=>{e?up(e):(lp=ap,hp());}));},mp={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>lp===ap||null!=mp.applyArabicShaping,isLoading:()=>lp===op,setState(e){lp=e.pluginStatus,cp=e.pluginURL;},isParsed:()=>null!=mp.applyArabicShaping&&null!=mp.processBidirectionalText&&null!=mp.processStyledBidirectionalText,getPluginURL:()=>cp};class _p{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new np,this.transition={});}isSupportedScript(e){return function(e,t){for(const i of e)if(!dn(i.charCodeAt(0),t))return !1;return !0}(e,mp.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,t=e-Math.floor(e),i=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*i}:{fromScale:.5,toScale:1,t:1-(1-i)*t}}}class gp{constructor(e,t){this.property=e,this.value=t,this.expression=Bo(void 0===t?e.specification.default:t,e.specification);}isDataDriven(){return "source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,i){return this.property.possiblyEvaluate(this,e,t,i)}}class yp{constructor(e){this.property=e,this.value=new gp(e,void 0);}transitioned(e,t){return new vp(this.property,this.value,t,ze({},e.transition,this.transition),e.now)}untransitioned(){return new vp(this.property,this.value,null,{},0)}}class xp{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues);}getValue(e){return Xe(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new yp(this._values[e].property)),this._values[e].value=new gp(this._values[e].property,null===t?void 0:Xe(t));}getTransition(e){return Xe(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new yp(this._values[e].property)),this._values[e].transition=Xe(t)||void 0;}serialize(){const e={};for(const t of Object.keys(this._values)){const i=this.getValue(t);void 0!==i&&(e[t]=i);const n=this.getTransition(t);void 0!==n&&(e[`${t}-transition`]=n);}return e}transitioned(e,t){const i=new wp(this._properties);for(const n of Object.keys(this._values))i._values[n]=this._values[n].transitioned(e,t._values[n]);return i}untransitioned(){const e=new wp(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class vp{constructor(e,t,i,n,r){this.property=e,this.value=t,this.begin=r+n.delay||0,this.end=this.begin+n.duration||0,e.specification.transition&&(n.delay||n.duration)&&(this.prior=i);}possiblyEvaluate(e,t,i){const n=e.now||0,r=this.value.possiblyEvaluate(e,t,i),o=this.prior;if(o){if(n>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(n<this.begin)return o.possiblyEvaluate(e,t,i);{const a=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(e,t,i),r,Ne(a))}}return r}}class wp{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues);}possiblyEvaluate(e,t,i){const n=new Pp(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].possiblyEvaluate(e,t,i);return n}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return !0;return !1}}class Tp{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues);}getValue(e){return Xe(this._values[e].value)}setValue(e,t){this._values[e]=new gp(this._values[e].property,null===t?void 0:Xe(t));}serialize(){const e={};for(const t of Object.keys(this._values)){const i=this.getValue(t);void 0!==i&&(e[t]=i);}return e}possiblyEvaluate(e,t,i){const n=new Pp(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].possiblyEvaluate(e,t,i);return n}}class bp{constructor(e,t,i){this.property=e,this.value=t,this.parameters=i;}isConstant(){return "constant"===this.value.kind}constantOr(e){return "constant"===this.value.kind?this.value.value:e}evaluate(e,t,i,n){return this.property.evaluate(this.value,this.parameters,e,t,i,n)}}class Pp{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues);}get(e){return this._values[e]}}class Sp{constructor(e){this.specification=e;}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,i){const n=fr[this.specification.type];return n?n(e,t,i):e}}class Ap{constructor(e,t){this.specification=e,this.overrides=t;}possiblyEvaluate(e,t,i,n){return new bp(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},i,n)}:e.expression,t)}interpolate(e,t,i){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new bp(this,{kind:"constant",value:void 0},e.parameters);const n=fr[this.specification.type];return n?new bp(this,{kind:"constant",value:n(e.value.value,t.value.value,i)},e.parameters):e}evaluate(e,t,i,n,r,o){return "constant"===e.kind?e.value:e.evaluate(t,i,n,r,o)}}class Ep extends Ap{possiblyEvaluate(e,t,i,n){if(void 0===e.value)return new bp(this,{kind:"constant",value:void 0},t);if("constant"===e.expression.kind){const r=e.expression.evaluate(t,null,{},i,n),o="resolvedImage"===e.property.specification.type&&"string"!=typeof r?r.name:r,a=this._calculate(o,o,o,t);return new bp(this,{kind:"constant",value:a},t)}if("camera"===e.expression.kind){const i=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new bp(this,{kind:"constant",value:i},t)}return new bp(this,e.expression,t)}evaluate(e,t,i,n,r,o){if("source"===e.kind){const a=e.evaluate(t,i,n,r,o);return this._calculate(a,a,a,t)}return "composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},i,n),e.evaluate({zoom:Math.floor(t.zoom)},i,n),e.evaluate({zoom:Math.floor(t.zoom)+1},i,n),t):e.value}_calculate(e,t,i,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:i,to:t}}interpolate(e){return e}}class Cp{constructor(e){this.specification=e;}possiblyEvaluate(e,t,i,n){if(void 0!==e.value){if("constant"===e.expression.kind){const r=e.expression.evaluate(t,null,{},i,n);return this._calculate(r,r,r,t)}return this._calculate(e.expression.evaluate(new _p(Math.floor(t.zoom-1),t)),e.expression.evaluate(new _p(Math.floor(t.zoom),t)),e.expression.evaluate(new _p(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,i,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:i,to:t}}interpolate(e){return e}}class Mp{constructor(e){this.specification=e;}possiblyEvaluate(e,t,i,n){return !!e.expression.evaluate(t,null,{},i,n)}interpolate(){return !1}}class Ip{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const t in e){const i=e[t];i.specification.overridable&&this.overridableProperties.push(t);const n=this.defaultPropertyValues[t]=new gp(i,void 0),r=this.defaultTransitionablePropertyValues[t]=new yp(i);this.defaultTransitioningPropertyValues[t]=r.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=n.possiblyEvaluate({});}}}Ho("DataDrivenProperty",Ap),Ho("DataConstantProperty",Sp),Ho("CrossFadedDataDrivenProperty",Ep),Ho("CrossFadedProperty",Cp),Ho("ColorRampProperty",Mp);const Lp=gi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Np=gi([{name:"a_top_pattern_from",components:4,type:"Uint16"},{name:"a_top_pattern_to",components:4,type:"Uint16"},{name:"a_top_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_top_pixel_ratio_to",components:1,type:"Uint16"}]);class Rp{constructor(e,t){this.gl=e.gl,this.location=t;}}class Op extends Rp{constructor(e,t){super(e,t),this.current=0;}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e));}}class Dp extends Rp{constructor(e,t){super(e,t),this.current=[0,0];}set(e){e[0]===this.current[0]&&e[1]===this.current[1]||(this.current=e,this.gl.uniform2f(this.location,e[0],e[1]));}}class Fp extends Rp{constructor(e,t){super(e,t),this.current=[0,0,0];}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]||(this.current=e,this.gl.uniform3f(this.location,e[0],e[1],e[2]));}}class zp extends Rp{constructor(e,t){super(e,t),this.current=[0,0,0,0];}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]));}}class Bp extends Rp{constructor(e,t){super(e,t),this.current=Di.transparent;}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a));}}var Vp=$h((function(e){e.exports=function(e,t){var i,n,r,o,a,s,l,c;for(n=e.length-(i=3&e.length),r=t,a=3432918353,s=461845907,c=0;c<n;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,r=27492+(65535&(o=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295;}return r^=e.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0};})),Up=$h((function(e){e.exports=function(e,t){for(var i,n=e.length,r=t^n,o=0;n>=4;)i=1540483477*(65535&(i=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(i>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),n-=4,++o;switch(n){case 3:r^=(255&e.charCodeAt(o+2))<<16;case 2:r^=(255&e.charCodeAt(o+1))<<8;case 1:r=1540483477*(65535&(r^=255&e.charCodeAt(o)))+((1540483477*(r>>>16)&65535)<<16);}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0};})),kp=Vp,Gp=Up;kp.murmur3=Vp,kp.murmur2=Gp;class Hp{constructor(){this.ids=[],this.positions=[],this.indexed=!1;}add(e,t,i,n){this.ids.push(qp(e)),this.positions.push(t,i,n);}getPositions(e){const t=qp(e);let i=0,n=this.ids.length-1;for(;i<n;){const e=i+n>>1;this.ids[e]>=t?n=e:i=e+1;}const r=[];for(;this.ids[i]===t;)r.push({index:this.positions[3*i],start:this.positions[3*i+1],end:this.positions[3*i+2]}),i++;return r}static serialize(e,t){const i=new Float64Array(e.ids),n=new Uint32Array(e.positions);return Xp(i,n,0,i.length-1),t&&t.push(i.buffer,n.buffer),{ids:i,positions:n}}static deserialize(e){const t=new Hp;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}const Yp=Math.pow(2,53)-1;function qp(e){const t=+e;return !isNaN(t)&&t<=Yp?t:kp(String(e))}function Xp(e,t,i,n){for(;i<n;){const r=e[i+n>>1];let o=i-1,a=n+1;for(;;){do{o++;}while(e[o]<r);do{a--;}while(e[a]>r);if(o>=a)break;jp(e,o,a),jp(t,3*o,3*a),jp(t,3*o+1,3*a+1),jp(t,3*o+2,3*a+2);}a-i<n-a?(Xp(e,t,i,a),i=a+1):(Xp(e,t,a+1,n),n=a);}}function jp(e,t,i){const n=e[t];e[t]=e[i],e[i]=n;}function Wp(e){return [ip(255*e.r,255*e.g),ip(255*e.b,255*e.a)]}Ho("FeaturePositionMap",Hp);class $p{constructor(e,t,i){this.value=e,this.uniformNames=t.map((e=>`u_${e}`)),this.type=i;}setUniform(e,t,i,n){let r=i.constantOr(this.value);"u_translate_anchor"===n&&(r="map"===r?0:1),e.set(r);}getBinding(e,t,i){switch(this.type){case"color":return new Bp(e,t);case"array":switch(this.value.length){case 1:return new Op(e,t);case 2:return new Dp(e,t);case 3:return new Fp(e,t);default:return new zp(e,t)}default:return new Op(e,t)}}}class Zp{constructor(e,t){this.uniformNames=t.map((e=>`u_${e}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1,this.topPatternFrom=null,this.topPatternTo=null,this.topPixelRatioFrom=1,this.topPixelRatioTo=1;}setConstantPatternPositions(e,t,i){i?(this.topPixelRatioFrom=t.pixelRatio,this.topPixelRatioTo=e.pixelRatio,this.topPatternFrom=t.tlbr,this.topPatternTo=e.tlbr):(this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr);}setUniform(e,t,i,n){const r="u_pattern_to"===n?this.patternTo:"u_pattern_from"===n?this.patternFrom:"u_pixel_ratio_to"===n?this.pixelRatioTo:"u_pixel_ratio_from"===n?this.pixelRatioFrom:"u_top_pattern_to"===n?this.topPatternTo:"u_top_pattern_from"===n?this.topPatternFrom:"u_top_pixel_ratio_to"===n?this.topPixelRatioTo:"u_top_pixel_ratio_from"===n?this.topPixelRatioFrom:null;r&&e.set(r);}getBinding(e,t,i){return "u_pattern"===i.substr(0,9)||"u_top_pattern"===i.substr(0,13)?new zp(e,t):new Op(e,t)}}class Kp{constructor(e,t,i,n){this.expression=e,this.type=i,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===i?2:1,offset:0}))),this.paintVertexArray=new n;}populatePaintArray(e,t,i,n,r){const o=this.paintVertexArray.length,a=this.expression.evaluate(new _p(0),t,{},n,[],r);this.paintVertexArray.resize(e),this._setPaintValue(o,e,a);}updatePaintArray(e,t,i,n){const r=this.expression.evaluate({zoom:0},i,n);this._setPaintValue(e,t,r);}_setPaintValue(e,t,i){if("color"===this.type){const n=Wp(i);for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n[0],n[1]);}else {for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i);this.maxValue=Math.max(this.maxValue,Math.abs(i));}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffers?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent));}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy();}}class Qp{constructor(e,t,i,n,r,o){this.expression=e,this.uniformNames=t.map((e=>`u_${e}_t`)),this.type=i,this.useIntegerZoom=n,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===i?4:2,offset:0}))),this.paintVertexArray=new o;}populatePaintArray(e,t,i,n,r){const o=this.expression.evaluate(new _p(this.zoom),t,{},n,[],r),a=this.expression.evaluate(new _p(this.zoom+1),t,{},n,[],r),s=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(s,e,o,a);}updatePaintArray(e,t,i,n){const r=this.expression.evaluate({zoom:this.zoom},i,n),o=this.expression.evaluate({zoom:this.zoom+1},i,n);this._setPaintValue(e,t,r,o);}_setPaintValue(e,t,i,n){if("color"===this.type){const r=Wp(i),o=Wp(n);for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,r[0],r[1],o[0],o[1]);}else {for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,i,n);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(n));}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffers?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent));}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy();}setUniform(e,t){const i=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,n=De(this.expression.interpolationFactor(i,this.zoom,this.zoom+1),0,1);e.set(n);}getBinding(e,t,i){return new Op(e,t)}}class Jp{constructor(e,t,i,n,r,o){this.expression=e,this.type=t,this.useIntegerZoom=i,this.zoom=n,this.layerId=o,this.zoomInPaintVertexArray=new r,this.zoomOutPaintVertexArray=new r,this.zoomInPaintVertexArrayTopPattern=new r,this.zoomOutPaintVertexArrayTopPattern=new r;}populatePaintArray(e,t,i){const n=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this.zoomInPaintVertexArrayTopPattern.resize(e),this.zoomOutPaintVertexArrayTopPattern.resize(e),this._setPaintValues(n,e,t.patterns&&t.patterns[this.layerId],i);const r=`${this.layerId}topPattern`;t.patterns&&t.patterns[r]&&this._setTopPatternPaintValues(n,e,t.patterns&&t.patterns[r],i);}updatePaintArray(e,t,i,n,r){this._setPaintValues(e,t,i.patterns&&i.patterns[this.layerId],r);const o=`${this.layerId}topPattern`;i.patterns&&i.patterns[o]&&this._setTopPatternPaintValues(e,t,i.patterns&&i.patterns[o],r);}_setPaintValues(e,t,i,n){if(!n||!i)return;const{min:r,mid:o,max:a}=i,s=n[r],l=n[o],c=n[a];if(s&&l&&c)for(let i=e;i<t;i++)this.zoomInPaintVertexArray.emplace(i,l.tl[0],l.tl[1],l.br[0],l.br[1],s.tl[0],s.tl[1],s.br[0],s.br[1],l.pixelRatio,s.pixelRatio),this.zoomOutPaintVertexArray.emplace(i,l.tl[0],l.tl[1],l.br[0],l.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],l.pixelRatio,c.pixelRatio);}_setTopPatternPaintValues(e,t,i,n){if(!n||!i)return;const{min:r,mid:o,max:a}=i,s=n[r],l=n[o],c=n[a];if(s&&l&&c)for(let i=e;i<t;i++)this.zoomInPaintVertexArrayTopPattern.emplace(i,l.tl[0],l.tl[1],l.br[0],l.br[1],s.tl[0],s.tl[1],s.br[0],s.br[1],l.pixelRatio,s.pixelRatio),this.zoomOutPaintVertexArrayTopPattern.emplace(i,l.tl[0],l.tl[1],l.br[0],l.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],l.pixelRatio,c.pixelRatio);}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Lp.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Lp.members,this.expression.isStateDependent)),this.zoomInPaintVertexArrayTopPattern&&this.zoomInPaintVertexArrayTopPattern.arrayBuffer&&this.zoomOutPaintVertexArrayTopPattern&&this.zoomOutPaintVertexArrayTopPattern.arrayBuffer&&(this.zoomInPaintVertexBufferTopPattern=e.createVertexBuffer(this.zoomInPaintVertexArrayTopPattern,Np.members,this.expression.isStateDependent),this.zoomOutPaintVertexBufferTopPattern=e.createVertexBuffer(this.zoomOutPaintVertexArrayTopPattern,Np.members,this.expression.isStateDependent));}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy(),this.zoomOutPaintVertexBufferTopPattern&&this.zoomOutPaintVertexBufferTopPattern.destroy(),this.zoomInPaintVertexBufferTopPattern&&this.zoomInPaintVertexBufferTopPattern.destroy();}}class ef{constructor(e,t,i){this.binders={},this._buffers=[];const n=[];if(e)for(const r in e.paint._values){if(!i(r))continue;const o=e.paint.get(r);if(!(o instanceof bp&&io(o.property.specification)))continue;const a=nf(r,e.type),s=o.value,l=o.property.specification.type,c=o.property.useIntegerZoom,u=o.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u;if("constant"===s.kind)this.binders[r]=h?new Zp(s.value,a):new $p(s.value,a,l),n.push(`/u_${r}`);else if("source"===s.kind||h){const i=rf(r,l,"source");this.binders[r]=h?new Jp(s,l,c,t,i,e.id):new Kp(s,a,l,i),n.push(`/a_${r}`);}else {const e=rf(r,l,"composite");this.binders[r]=new Qp(s,a,l,c,t,e),n.push(`/z_${r}`);}}this.cacheKey=n.sort().join("");}getMaxValue(e){const t=this.binders[e];return t instanceof Kp||t instanceof Qp?t.maxValue:0}populatePaintArrays(e,t,i,n,r){for(const o in this.binders){const a=this.binders[o];(a instanceof Kp||a instanceof Qp||a instanceof Jp)&&a.populatePaintArray(e,t,i,n,r);}}setConstantPatternPositions(e,t,i){for(const n in this.binders){const r=this.binders[n];r instanceof Zp&&r.setConstantPatternPositions(e,t,i);}}updatePaintArrays(e,t,i,n,r){let o=!1;for(const a in e){const s=t.getPositions(a);for(const t of s){const s=i.feature(t.index);for(const i in this.binders){const l=this.binders[i];if((l instanceof Kp||l instanceof Qp||l instanceof Jp)&&!0===l.expression.isStateDependent){const c=n.paint.get(i);l.expression=c.value,l.updatePaintArray(t.start,t.end,s,e[a],r),o=!0;}}}}return o}defines(){const e=[];for(const t in this.binders){const i=this.binders[t];(i instanceof $p||i instanceof Zp)&&e.push(...i.uniformNames.map((e=>`#define HAS_UNIFORM_${e}`)));}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const i=this.binders[t];if(i instanceof Kp||i instanceof Qp)for(let t=0;t<i.paintVertexAttributes.length;t++)e.push(i.paintVertexAttributes[t].name);else if(i instanceof Jp){for(let t=0;t<Lp.members.length;t++)e.push(Lp.members[t].name);for(let t=0;t<Np.members.length;t++)e.push(Np.members[t].name);}}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const i=this.binders[t];if(i instanceof $p||i instanceof Zp||i instanceof Qp)for(const t of i.uniformNames)e.push(t);}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,t){const i=[];for(const n in this.binders){const r=this.binders[n];if(r instanceof $p||r instanceof Zp||r instanceof Qp)for(const o of r.uniformNames)if(t[o]){const a=r.getBinding(e,t[o],o);i.push({name:o,property:n,binding:a});}}return i}setUniforms(e,t,i,n){for(const{name:e,property:r,binding:o}of t)this.binders[r].setUniform(o,n,i.get(r),e);}updatePaintBuffers(e,t){this._buffers=[];for(const i in this.binders){const n=this.binders[i];if(e&&n instanceof Jp)if(t&&i.indexOf("top-pattern")>-1){const t=2===e.fromScale?n.zoomInPaintVertexBufferTopPattern:n.zoomOutPaintVertexBufferTopPattern;t&&this._buffers.push(t);}else {const t=2===e.fromScale?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;t&&this._buffers.push(t);}else (n instanceof Kp||n instanceof Qp)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer);}}upload(e){for(const t in this.binders){const i=this.binders[t];(i instanceof Kp||i instanceof Qp||i instanceof Jp)&&i.upload(e);}this.updatePaintBuffers();}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Kp||t instanceof Qp||t instanceof Jp)&&t.destroy();}}}class tf{constructor(e,t,i,n=(()=>!0)){this.programConfigurations={};for(const r of t)this.programConfigurations[r.id]=new ef(r,i,n),this.programConfigurations[r.id].layoutAttributes=e;this.needsUpload=!1,this._featureMap=new Hp,this._bufferOffset=0;}populatePaintArrays(e,t,i,n,r,o){for(const i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(e,t,n,r,o);void 0!==t.id&&this._featureMap.add(t.id,i,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0;}updatePaintArrays(e,t,i,n){for(const r of i)this.needsUpload=this.programConfigurations[r.id].updatePaintArrays(e,this._featureMap,t,r,n)||this.needsUpload;}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1;}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy();}}function nf(e,t){return {"line-border-opacity":["borderopacity"],"line-border-width":["borderwidth"],"line-border-color":["bordercolor"],"line-offset":["offset"],"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"text-translate":["translate"],"icon-translate":["translate"],"line-translate":["translate"],"fill-translate":["translate"],"extrusion-translate":["translate"],"sprite-translate":["translate"],"icon-translate-anchor":["translate_anchor"],"text-translate-anchor":["translate_anchor"],"line-translate-anchor":["translate_anchor"],"fill-translate-anchor":["translate_anchor"],"extrusion-translate-anchor":["translate_anchor"],"sprite-translate-anchor":["translate_anchor"],"sprite-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"extrusion-top-pattern":["top_pattern_to","top_pattern_from","top_pixel_ratio_to","top_pixel_ratio_from"]}[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}function rf(e,t,i){const n={color:{source:ya,composite:Ra},number:{source:Pa,composite:ya},boolean:{source:Pa,composite:ya}},r=function(e){return {"line-pattern":{source:ha,composite:ha},"sprite-pattern":{source:ha,composite:ha},"fill-pattern":{source:ha,composite:ha},"extrusion-pattern":{source:ha,composite:ha},"extrusion-top-pattern":{source:ha,composite:ha}}[e]}(e);return r&&r[i]||n[t][i]}Ho("ConstantBinder",$p),Ho("CrossFadedConstantBinder",Zp),Ho("SourceExpressionBinder",Kp),Ho("CrossFadedCompositeBinder",Jp),Ho("CompositeExpressionBinder",Qp),Ho("ProgramConfiguration",ef,{omit:["_buffers"]}),Ho("ProgramConfigurationSet",tf);var of="object"==typeof global&&global&&global.Object===Object&&global,af="object"==typeof self&&self&&self.Object===Object&&self,sf=of||af||Function("return this")(),lf=sf.Symbol,cf=Object.prototype,uf=cf.hasOwnProperty,hf=cf.toString,df=lf?lf.toStringTag:void 0,pf=Object.prototype.toString,ff="[object Null]",mf="[object Undefined]",_f=lf?lf.toStringTag:void 0;function gf(e){return null==e?void 0===e?mf:ff:_f&&_f in Object(e)?function(e){var t=uf.call(e,df),i=e[df];try{e[df]=void 0;var n=!0;}catch(e){}var r=hf.call(e);return n&&(t?e[df]=i:delete e[df]),r}(e):function(e){return pf.call(e)}(e)}function yf(e){return null!=e&&"object"==typeof e}var xf=Array.isArray;function vf(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function wf(e){return e}var Tf="[object AsyncFunction]",bf="[object Function]",Pf="[object GeneratorFunction]",Sf="[object Proxy]";function Af(e){if(!vf(e))return !1;var t=gf(e);return t==bf||t==Pf||t==Tf||t==Sf}var Ef,Cf=sf["__core-js_shared__"],Mf=(Ef=/[^.]+$/.exec(Cf&&Cf.keys&&Cf.keys.IE_PROTO||""))?"Symbol(src)_1."+Ef:"",If=Function.prototype.toString,Lf=/^\[object .+?Constructor\]$/,Nf=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Rf(e,t){var i=function(e,t){return null==e?void 0:e[t]}(e,t);return function(e){return !(!vf(e)||(t=e,Mf&&Mf in t))&&(Af(e)?Nf:Lf).test(function(e){if(null!=e){try{return If.call(e)}catch(e){}try{return e+""}catch(e){}}return ""}(e));var t;}(i)?i:void 0}var Of=Object.create,Df=function(){function e(){}return function(t){if(!vf(t))return {};if(Of)return Of(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}();function Ff(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}var zf,Bf,Vf,Uf=Date.now,kf=function(){try{var e=Rf(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),Gf=kf,Hf=Gf?function(e,t){return Gf(e,"toString",{configurable:!0,enumerable:!1,value:(i=t,function(){return i}),writable:!0});var i;}:wf,Yf=(zf=Hf,Bf=0,Vf=0,function(){var e=Uf(),t=16-(e-Vf);if(Vf=e,t>0){if(++Bf>=800)return arguments[0]}else Bf=0;return zf.apply(void 0,arguments)}),qf=Yf,Xf=9007199254740991,jf=/^(?:0|[1-9]\d*)$/;function Wf(e,t){var i=typeof e;return !!(t=null==t?Xf:t)&&("number"==i||"symbol"!=i&&jf.test(e))&&e>-1&&e%1==0&&e<t}function $f(e,t,i){"__proto__"==t&&Gf?Gf(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i;}function Zf(e,t){return e===t||e!=e&&t!=t}var Kf=Object.prototype.hasOwnProperty;function Qf(e,t,i){var n=e[t];Kf.call(e,t)&&Zf(n,i)&&(void 0!==i||t in e)||$f(e,t,i);}var Jf=Math.max;function em(e,t){return qf(function(e,t,i){return t=Jf(void 0===t?e.length-1:t,0),function(){for(var n=arguments,r=-1,o=Jf(n.length-t,0),a=Array(o);++r<o;)a[r]=n[t+r];r=-1;for(var s=Array(t+1);++r<t;)s[r]=n[r];return s[t]=i(a),Ff(e,this,s)}}(e,t,wf),e+"")}var tm=9007199254740991;function im(e){return "number"==typeof e&&e>-1&&e%1==0&&e<=tm}function nm(e){return null!=e&&im(e.length)&&!Af(e)}var rm=Object.prototype;function om(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||rm)}function am(e){return yf(e)&&"[object Arguments]"==gf(e)}var sm=Object.prototype,lm=sm.hasOwnProperty,cm=sm.propertyIsEnumerable,um=am(function(){return arguments}())?am:function(e){return yf(e)&&lm.call(e,"callee")&&!cm.call(e,"callee")},hm=um,dm="object"==typeof e&&e&&!e.nodeType&&e,pm=dm&&"object"==typeof module&&module&&!module.nodeType&&module,fm=pm&&pm.exports===dm?sf.Buffer:void 0,mm=(fm?fm.isBuffer:void 0)||function(){return !1},_m={};_m["[object Float32Array]"]=_m["[object Float64Array]"]=_m["[object Int8Array]"]=_m["[object Int16Array]"]=_m["[object Int32Array]"]=_m["[object Uint8Array]"]=_m["[object Uint8ClampedArray]"]=_m["[object Uint16Array]"]=_m["[object Uint32Array]"]=!0,_m["[object Arguments]"]=_m["[object Array]"]=_m["[object ArrayBuffer]"]=_m["[object Boolean]"]=_m["[object DataView]"]=_m["[object Date]"]=_m["[object Error]"]=_m["[object Function]"]=_m["[object Map]"]=_m["[object Number]"]=_m["[object Object]"]=_m["[object RegExp]"]=_m["[object Set]"]=_m["[object String]"]=_m["[object WeakMap]"]=!1;var gm="object"==typeof e&&e&&!e.nodeType&&e,ym=gm&&"object"==typeof module&&module&&!module.nodeType&&module,xm=ym&&ym.exports===gm&&of.process,vm=function(){try{return ym&&ym.require&&ym.require("util").types||xm&&xm.binding&&xm.binding("util")}catch(e){}}(),wm=vm&&vm.isTypedArray,Tm=wm?function(e){return function(t){return e(t)}}(wm):function(e){return yf(e)&&im(e.length)&&!!_m[gf(e)]},bm=Tm,Pm=Object.prototype.hasOwnProperty;function Sm(e){return nm(e)?function(e,t){var i=xf(e),n=!i&&hm(e),r=!i&&!n&&mm(e),o=!i&&!n&&!r&&bm(e),a=i||n||r||o,s=a?function(e,t){for(var i=-1,n=Array(e);++i<e;)n[i]=t(i);return n}(e.length,String):[],l=s.length;for(var c in e)a&&("length"==c||r&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Wf(c,l))||s.push(c);return s}(e):function(e){if(!vf(e))return function(e){var t=[];if(null!=e)for(var i in Object(e))t.push(i);return t}(e);var t=om(e),i=[];for(var n in e)("constructor"!=n||!t&&Pm.call(e,n))&&i.push(n);return i}(e)}var Am=Rf(Object,"create"),Em=Object.prototype.hasOwnProperty,Cm=Object.prototype.hasOwnProperty;function Mm(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1]);}}function Im(e,t){for(var i=e.length;i--;)if(Zf(e[i][0],t))return i;return -1}Mm.prototype.clear=function(){this.__data__=Am?Am(null):{},this.size=0;},Mm.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Mm.prototype.get=function(e){var t=this.__data__;if(Am){var i=t[e];return "__lodash_hash_undefined__"===i?void 0:i}return Em.call(t,e)?t[e]:void 0},Mm.prototype.has=function(e){var t=this.__data__;return Am?void 0!==t[e]:Cm.call(t,e)},Mm.prototype.set=function(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=Am&&void 0===t?"__lodash_hash_undefined__":t,this};var Lm=Array.prototype.splice;function Nm(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1]);}}Nm.prototype.clear=function(){this.__data__=[],this.size=0;},Nm.prototype.delete=function(e){var t=this.__data__,i=Im(t,e);return !(i<0||(i==t.length-1?t.pop():Lm.call(t,i,1),--this.size,0))},Nm.prototype.get=function(e){var t=this.__data__,i=Im(t,e);return i<0?void 0:t[i][1]},Nm.prototype.has=function(e){return Im(this.__data__,e)>-1},Nm.prototype.set=function(e,t){var i=this.__data__,n=Im(i,e);return n<0?(++this.size,i.push([e,t])):i[n][1]=t,this};var Rm=Rf(sf,"Map");function Om(e,t){var i,n,r=e.__data__;return ("string"==(n=typeof(i=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==i:null===i)?r["string"==typeof t?"string":"hash"]:r.map}function Dm(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1]);}}Dm.prototype.clear=function(){this.size=0,this.__data__={hash:new Mm,map:new(Rm||Nm),string:new Mm};},Dm.prototype.delete=function(e){var t=Om(this,e).delete(e);return this.size-=t?1:0,t},Dm.prototype.get=function(e){return Om(this,e).get(e)},Dm.prototype.has=function(e){return Om(this,e).has(e)},Dm.prototype.set=function(e,t){var i=Om(this,e),n=i.size;return i.set(e,t),this.size+=i.size==n?0:1,this};var Fm=function(e,t){return function(i){return e(t(i))}}(Object.getPrototypeOf,Object),zm=Fm,Bm="[object Object]",Vm=Function.prototype.toString,Um=Object.prototype.hasOwnProperty,km=Vm.call(Object);function Gm(e){var t=this.__data__=new Nm(e);this.size=t.size;}Gm.prototype.clear=function(){this.__data__=new Nm,this.size=0;},Gm.prototype.delete=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i},Gm.prototype.get=function(e){return this.__data__.get(e)},Gm.prototype.has=function(e){return this.__data__.has(e)},Gm.prototype.set=function(e,t){var i=this.__data__;if(i instanceof Nm){var n=i.__data__;if(!Rm||n.length<199)return n.push([e,t]),this.size=++i.size,this;i=this.__data__=new Dm(n);}return i.set(e,t),this.size=i.size,this};var Hm=("object"==typeof e&&e&&!e.nodeType&&e&&"object"==typeof module&&module&&!module.nodeType&&module,sf.Uint8Array),Ym=function(e,t,i){for(var n=-1,r=Object(e),o=i(e),a=o.length;a--;){var s=o[++n];if(!1===t(r[s],s,r))break}return e};function qm(e,t,i){(void 0!==i&&!Zf(e[t],i)||void 0===i&&!(t in e))&&$f(e,t,i);}function Xm(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}function jm(e,t,i,n,r){e!==t&&Ym(t,(function(o,a){if(r||(r=new Gm),vf(o))!function(e,t,i,n,r,o,a){var s,l,c,u=Xm(e,i),h=Xm(t,i),d=a.get(h);if(d)qm(e,i,d);else {var p,f=o?o(u,h,i+"",e,t,a):void 0,m=void 0===f;if(m){var _=xf(h),g=!_&&mm(h),y=!_&&!g&&bm(h);f=h,_||g||y?xf(u)?f=u:yf(p=u)&&nm(p)?f=function(e,t){var i=-1,n=e.length;for(t||(t=Array(n));++i<n;)t[i]=e[i];return t}(u):g?(m=!1,f=h.slice()):y?(m=!1,c=new(l=(s=h).buffer).constructor(l.byteLength),new Hm(c).set(new Hm(l)),f=new s.constructor(c,s.byteOffset,s.length)):f=[]:function(e){if(!yf(e)||gf(e)!=Bm)return !1;var t=zm(e);if(null===t)return !0;var i=Um.call(t,"constructor")&&t.constructor;return "function"==typeof i&&i instanceof i&&Vm.call(i)==km}(h)||hm(h)?(f=u,hm(u)?f=function(e){return function(e,t,i,n){var r=!i;i||(i={});for(var o=-1,a=t.length;++o<a;){var s=t[o],l=void 0;void 0===l&&(l=e[s]),r?$f(i,s,l):Qf(i,s,l);}return i}(e,Sm(e))}(u):vf(u)&&!Af(u)||(f=function(e){return "function"!=typeof e.constructor||om(e)?{}:Df(zm(e))}(h))):m=!1;}m&&(a.set(h,f),r(f,h,n,o,a),a.delete(h)),qm(e,i,f);}}(e,t,a,i,jm,n,r);else {var s=n?n(Xm(e,a),o,a+"",e,t,r):void 0;void 0===s&&(s=o),qm(e,a,s);}}),Sm);}function Wm(e,t,i,n,r,o){return vf(e)&&vf(t)&&(o.set(t,e),jm(e,t,void 0,Wm,o),o.delete(t)),e}var $m,Zm=($m=function(e,t,i,n){jm(e,t,i,n);},em((function(e,t){var i=-1,n=t.length,r=n>1?t[n-1]:void 0,o=n>2?t[2]:void 0;for(r=$m.length>3&&"function"==typeof r?(n--,r):void 0,o&&function(e,t,i){if(!vf(i))return !1;var n=typeof t;return !!("number"==n?nm(i)&&Wf(t,i.length):"string"==n&&t in i)&&Zf(i[t],e)}(t[0],t[1],o)&&(r=n<3?void 0:r,n=1),e=Object(e);++i<n;){var a=t[i];a&&$m(e,a,i,r);}return e}))),Km=em((function(e){return e.push(void 0,Wm),Ff(Zm,void 0,e)}));function Qm(e,t,i=!1){let n;return n=i?Km(e,t):{...t,...e},n}const Jm={SUB_GLOBE_PASS:1,SUB_VECTOR_OPAQUE_PASS:2,SUB_VECTOR_TRANSLUCENT_PASS:3,SUB_MODEL_OPAQUE_PASS:4,SUB_MODEL_TRANSLUCENT_PASS:5,_USER_DEFINED_PRE_PASS:6,PICK_PASS:7,SHADOW_PASS:8,VIEWSHED_PASS:9,REAL_RENDER_PASS:10,FXAA_PASS:11,BLOOM_PASS:12,TOON_SHADING_PASS:13,HDR_PASS:12,USER_DEFINED_POST_PROCESS_PASS:14,PICK_COLOR_PASS:15,CUBE_MAP_RENDER_FOR_SKYBOX:16,CUBE_MAP_RENDER:16,EARTH_EFFECT_PASS:17,PROXY_PASS:18};class e_{constructor(e){const t=e||Z.EMPTY_OBJECT;this.frontFace=t.frontFace||hc.CCW;const i=t.cull||Z.EMPTY_OBJECT;this.cull={enabled:i.enabled||!1,face:i.face||hc.BACK};const n=t.polygonOffset||Z.EMPTY_OBJECT;this.polygonOffset={enabled:n.enabled||!1,factor:n.factor||0,units:n.units||0};const r=t.scissorTest||Z.EMPTY_OBJECT;this.scissorTest={enabled:r.enabled||!1,rectangle:r.rectangle||Z.EMPTY_OBJECT};const o=t.depthRange||Z.EMPTY_OBJECT;this.depthRange={near:Z(o.near,0),far:Z(o.far,1)};const a=t.depthTest||Z.EMPTY_OBJECT;this.depthTest={enabled:a.enabled||!1,func:a.func||hc.LESS},this.depthMask=Z(t.depthMask,!0);const s=t.colorMask||Z.EMPTY_OBJECT;this.colorMask={red:Z(s.red,!0),green:Z(s.green,!0),blue:Z(s.blue,!0),alpha:Z(s.alpha,!0)};const l=t.blending||Z.EMPTY_OBJECT,c=l.color||Z.EMPTY_OBJECT;this.blending={enabled:l.enabled||!1,color:{red:c.red||0,green:c.green||0,blue:c.blue||0,alpha:c.alpha||0},equationRgb:l.equationRgb||hc.FUNC_ADD,equationAlpha:l.equationAlpha||hc.FUNC_ADD,functionSourceRgb:l.functionSourceRgb||hc.ONE,functionSourceAlpha:l.functionSourceAlpha||hc.ONE,functionDestinationRgb:l.functionDestinationRgb||hc.ZERO,functionDestinationAlpha:l.functionDestinationAlpha||hc.ZERO},this.stencilMask=Z(t.stencilMask,-1);const u=t.stencilTest||Z.EMPTY_OBJECT,h=u.frontOperation||Z.EMPTY_OBJECT,d=u.backOperation||Z.EMPTY_OBJECT;this.stencilTest={enabled:u.enabled||!1,frontFunction:u.frontFunction||hc.ALWAYS,backFunction:u.backFunction||hc.ALWAYS,reference:u.reference||0,mask:Z(u.mask,-1),frontOperation:{fail:h.fail||hc.KEEP,zFail:h.zFail||hc.KEEP,zPass:h.zPass||hc.KEEP},backOperation:{fail:d.fail||hc.KEEP,zFail:d.zFail||hc.KEEP,zPass:d.zPass||hc.KEEP}};const p=t.sampleCoverage||Z.EMPTY_OBJECT;this.sampleCoverage={enabled:p.enabled||!1,value:Z(p.value,1),invert:p.invert||!1},this.viewport=t.viewport,this.id=0;}static fromCache(e={}){return new e_(e)}static applyRenderState(e,t,i){!function(e,t){e._frontFace.set(t.frontFace);}(e,t),function(e,t){e._cullFace.set(t.cull);}(e,t),function(e,t){e._polygonOffset.set(t.polygonOffset);}(e,t),function(e,t){e._depthRange.set(t.depthRange);}(e,t),function(e,t){e._depthTest.set(t.depthTest);}(e,t),function(e,t){e._colorMask.set(t.colorMask);}(e,t),function(e,t){e._depthMask.set(t.depthMask);}(e,t),function(e,t){e._stencilMask.set(t.stencilMask);}(e,t),function(e,t){e._stencilTest.set(t.stencilTest);}(e,t),function(e,t){e._sampleCoverage.set(t.sampleCoverage);}(e,t),function(e,t){e._scissorTest.set(e._scissorTest?e._scissorTest.current:t.scissorTest.rectangle);}(e,t),function(e,t,i={}){e._blending.set(t.blending),(i?.frameState?.passType===Jm.PICK_PASS||i?.frameState?.passType===Jm.PICK_COLOR_PASS)&&e._blending.set(t_.disableBlending);}(e,t,i),function(e,t){let i=Z(t.viewport,e._viewport&&e._viewport.current);i||(i={x:0,y:0,width:e.gl.drawingBufferWidth,height:e.gl.drawingBufferHeight}),e._viewport.set(i);}(e,t);}static generateSimpleRenderState(){}}const t_=Object.freeze({enableBlending:Object.freeze({enabled:!0,color:{red:0,green:0,blue:0,alpha:0},equationRgb:hc.FUNC_ADD,equationAlpha:hc.FUNC_ADD,functionSourceRgb:hc.SRC_ALPHA,functionSourceAlpha:hc.ONE,functionDestinationRgb:hc.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:hc.ONE_MINUS_SRC_ALPHA}),disableBlending:Object.freeze({color:{red:0,green:0,blue:0,alpha:0},enabled:!1,equationRgb:hc.FUNC_ADD,equationAlpha:hc.FUNC_ADD,functionSourceRgb:hc.SRC_ALPHA,functionSourceAlpha:hc.ONE,functionDestinationRgb:hc.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:hc.ONE_MINUS_SRC_ALPHA}),enableDepthTest:Object.freeze({enabled:!0,func:hc.LESS}),enableDepthTestWithLEQUAL:Object.freeze({enabled:!0,func:hc.LEQUAL}),disableDepthTest:Object.freeze({enabled:!1,func:hc.LEQUAL}),enableDepthMask:!0,disableDepthMask:!1,enableStencilMask:255,disableStencilMask:0,enableCull:Object.freeze({enabled:!0,face:hc.BACK}),disableCull:Object.freeze({enabled:!1,face:hc.BACK}),depthRange:Object.freeze({near:0,far:1}),enableClassificationStencilTest:Object.freeze({enabled:!0,frontFunction:hc.ALWAYS,backFunction:hc.ALWAYS,reference:0,mask:255,frontOperation:{fail:hc.KEEP,zFail:hc.DECR_WRAP,zPass:hc.KEEP},backOperation:{fail:hc.KEEP,zFail:hc.INCR_WRAP,zPass:hc.KEEP}}),openClassificationStencilTest:Object.freeze({enabled:!0,frontFunction:hc.NOTEQUAL,backFunction:hc.NOTEQUAL,reference:0,mask:255,frontOperation:{fail:hc.ZERO,zFail:hc.ZERO,zPass:hc.ZERO},backOperation:{fail:hc.ZERO,zFail:hc.ZERO,zPass:hc.ZERO}}),disableStencilTest:Object.freeze({enabled:!1,frontFunction:hc.NOTEQUAL,backFunction:hc.NOTEQUAL,reference:0,mask:255,frontOperation:{fail:hc.ZERO,zFail:hc.ZERO,zPass:hc.ZERO},backOperation:{fail:hc.ZERO,zFail:hc.ZERO,zPass:hc.ZERO}}),disabledColorMask:Object.freeze({red:!1,green:!1,blue:!1,alpha:!1}),enableColorMask:Object.freeze({red:!0,green:!0,blue:!0,alpha:!0})}),i_=function e(t){if("object"!=typeof t||null===t)return t;let i;const n=Object.keys(t);for(let r=0;r<n.length;r++)i=n[r],t.hasOwnProperty(i)&&(t[i]=e(t[i]));return Object.freeze(t)}({depthTest:{enabled:!1},blending:{enabled:!1,equationRgb:hc.FUNC_ADD,equationAlpha:hc.FUNC_ADD,functionSourceRgb:hc.SRC_ALPHA,functionSourceAlpha:hc.ONE,functionDestinationRgb:hc.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:hc.ONE_MINUS_SRC_ALPHA},depthMask:!0,frontFace:hc.CCW,cull:{enabled:!1,face:hc.BACK}});var n_="#define GLSLIFY 1\nvec2 unpack_float(const float packedValue){int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity){int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor){return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0);}float unpack_mix_vec2(const vec2 packedValue,const float t){return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_vec4(const vec4 packedColors,const float t){vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}",r_="#define GLSLIFY 1\n#include <c_define>\n#include <c_symbolF>\n#include <pragma_symbol_define>\n#include <u_BaseColorSampler>\n#ifdef M_PICK_COLOR\nvarying vec4 v_pick_color;\n#endif\nvoid main(){\n#include <pragma_symbol_initialize>\n#ifdef M_SYM_TRACKING\nif(v_seq<0.0){discard;}\n#endif\n#ifdef M_PICK_COLOR\nif(v_fade_opacity==0.0){discard;}gl_FragColor=v_pick_color;\n#else\nlowp float alpha=opacity*v_fade_opacity;vec4 tempColor=texture2D(u_BaseColorSampler,v_tex);gl_FragColor=vec4(tempColor.rgb,tempColor.a*alpha);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#endif\n}",o_="#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelMatrix>\n#include <u_ViewProjectionMatrix>\n#include <c_define>\n#include <c_symbolV>\n#include <pragma_symbol_define>\n#include <fn_getVectorPointVisibilityValue>\n#include <fn_rotateXYZ>\n#ifdef M_PICK_COLOR\nattribute vec4 a_pick_color;varying vec4 v_pick_color;\n#endif\n#ifdef M_SYM_TRACKING\nbool findRangeMatch(){float num=u_seq*a_extra.y;if(u_seq<1.0){return num>=a_extra.x&&num<(a_extra.x+1.0);}else{return a_extra.x>=a_extra.y-1.0;}}bool findTimeRangeMatch(){float currentStamp=a_extra.x;float beforeStamp=a_extra.y;float endStamp=a_extra.z;float totalStartStamp=u_timestamp_se.x;float totalEndStamp=u_timestamp_se.y;float clockStamp=u_seq+totalStartStamp;if(clockStamp<=endStamp){if(clockStamp>beforeStamp&&clockStamp<=currentStamp){return true;}}else{if(currentStamp==endStamp){return true;}}return false;}\n#endif\nvoid main(){\n#include <pragma_symbol_initialize>\n#ifdef M_SYM_TRACKING\nif(u_display_mode==2.0){if(!findTimeRangeMatch()){v_seq=-100.0;}else{v_seq=100.0;}}else if(u_display_mode==1.0){if(!findRangeMatch()){v_seq=-100.0;}else{v_seq=100.0;}}else if(u_display_mode==0.0){float a_seq=a_extra.x;if(a_seq!=u_seq){v_seq=-100.0;}else{v_seq=100.0;}}\n#endif\nvec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if(!u_is_size_zoom_constant&&!u_is_size_feature_constant){size=mix(a_size[0],a_size[1],u_size_t)/10.0;}else if(u_is_size_zoom_constant&&!u_is_size_feature_constant){size=a_size[0]/10.0;}else if(!u_is_size_zoom_constant&&u_is_size_feature_constant){size=u_size;}else{size=u_size;}float fontScale=u_is_text ? size/24.0 : size;if(!u_rotate_with_map&&!u_pitch_with_map){highp float angle_sin=0.;highp float angle_cos=1.;gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION.xyz,1.0);gl_Position/=gl_Position.w;angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);gl_Position.xy+=rotation_matrix*a_offset/32.0*fontScale/u_GlUnitsToPixels;}else if(u_rotate_with_map&&u_pitch_with_map&&u_along_line){highp float angle_sin=0.;highp float angle_cos=1.;gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION.xyz,1.0);gl_Position/=gl_Position.w;angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);mat2 rotation_bearing_matrix=mat2(cos(u_Bearing),-sin(u_Bearing),sin(u_Bearing),cos(u_Bearing));gl_Position.xy+=rotation_bearing_matrix*rotation_matrix*vec2(a_offset.x,a_offset.y)/32.0*fontScale/vec2(u_GlUnitsToPixels.xy);}else if(u_rotate_with_map&&!u_pitch_with_map&&!u_along_line){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION.xyz,1.0);gl_Position/=gl_Position.w;mat3 rotation_matrix=rotateXYZ(0.,0.,u_Bearing);gl_Position.xyz+=rotation_matrix*vec3(a_offset.x,a_offset.y,0.)/32.0*fontScale/vec3(u_GlUnitsToPixels.xyx);}else if(u_rotate_with_map&&u_pitch_with_map&&!u_along_line){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION.xyz,1.0);gl_Position/=gl_Position.w;mat3 rotation_matrix=rotateXYZ(u_pitch,0.,u_Bearing);gl_Position.xyz+=rotation_matrix*vec3(a_offset.x,a_offset.y,0.)/32.0*fontScale/vec3(u_GlUnitsToPixels.xyx);}else if(!u_rotate_with_map&&u_pitch_with_map){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION.xyz,1.0);gl_Position/=gl_Position.w;mat3 rotation_matrix=rotateXYZ(u_pitch,0.,0.);gl_Position.xyz+=rotation_matrix*vec3(a_offset.x,a_offset.y,0.)/32.0*fontScale/vec3(u_GlUnitsToPixels.xyx);}else if(u_rotate_with_map&&!u_pitch_with_map&&u_along_line){gl_Position=u_ModelViewProjectionMatrix*vec4(a_CARTESIAN,1.0);}vec2 translate=u_translate;float translate_anchor=u_translate_anchor;if(translate_anchor==0.0){float sinA=sin(-u_Bearing);float cosA=cos(-u_Bearing);translate=vec2(translate[0]*cosA-translate[1]*sinA,translate[0]*sinA+translate[1]*cosA);}gl_Position.xy+=translate/u_GlUnitsToPixels;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1]>0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));float vVal=getVectorPointVisibilityValue(a_POSITION.xyz,u_ModelMatrix,u_CameraPosition,u_CameraDirection);if(vVal==-1.0){interpolated_fade_opacity=0.0;}v_fade_opacity=interpolated_fade_opacity;\n#ifdef M_PICK_COLOR\nv_pick_color=a_pick_color;\n#endif\n}",a_="#define GLSLIFY 1\n#include <c_define>\n#include <c_symbolF>\n#include <pragma_symbol_define>\n#include <u_BaseColorSampler>\n#ifdef M_PICK_COLOR\nvarying vec4 v_pick_color;\n#endif\nvoid main(){\n#include <pragma_symbol_initialize>\n#ifdef M_SYM_TRACKING\nif(v_seq<0.0){discard;}\n#endif\nvec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];\n#ifdef M_PICK_COLOR\nif(fade_opacity==0.0){discard;}gl_FragColor=v_pick_color;\n#else\nfloat fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/fontScale;lowp float buff=(256.0-64.0)/256.0;if(u_is_halo){color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/fontScale;buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_BaseColorSampler,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=vec4(color.rgb,color.a*alpha*opacity*fade_opacity);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#endif\n}",s_="precision highp float;\n#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <u_ViewProjectionMatrix>\n#include <u_ModelMatrix>\n#include <c_define>\n#include <c_symbolV>\n#include <pragma_symbol_define>\n#include <fn_getVectorPointVisibilityValue>\n#include <fn_rotateXYZ>\n#ifdef M_PICK_COLOR\nattribute vec4 a_pick_color;varying vec4 v_pick_color;\n#endif\n#ifdef M_SYM_TRACKING\nbool findRangeMatch(){float num=u_seq*a_extra.y;if(u_seq<1.0){return num>=a_extra.x&&num<(a_extra.x+1.0);}else{return a_extra.x>=a_extra.y-1.0;}}bool findTimeRangeMatch(){float currentStamp=a_extra.x;float beforeStamp=a_extra.y;float endStamp=a_extra.z;float totalStartStamp=u_timestamp_se.x;float totalEndStamp=u_timestamp_se.y;float clockStamp=u_seq+totalStartStamp;if(clockStamp<=endStamp){if(clockStamp>beforeStamp&&clockStamp<=currentStamp){return true;}}else{if(currentStamp==endStamp){return true;}}return false;}\n#endif\nvoid main(){\n#include <pragma_symbol_initialize>\n#ifdef M_SYM_TRACKING\nif(u_display_mode==2.0){if(!findTimeRangeMatch()){v_seq=-100.0;}else{v_seq=100.0;}}else if(u_display_mode==1.0){if(!findRangeMatch()){v_seq=-100.0;}else{v_seq=100.0;}}else if(u_display_mode==0.0){float a_seq=a_extra.x;if(a_seq!=u_seq){v_seq=-100.0;}else{v_seq=100.0;}}\n#endif\nvec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if(!u_is_size_zoom_constant&&!u_is_size_feature_constant){size=mix(a_size[0],a_size[1],u_size_t)/10.0;}else if(u_is_size_zoom_constant&&!u_is_size_feature_constant){size=a_size[0]/10.0;}else if(!u_is_size_zoom_constant&&u_is_size_feature_constant){size=u_size;}else{size=u_size;}float fontScale=u_is_text ? size/24.0 : size;highp float angle_sin=0.;highp float angle_cos=0.;highp float angle_sin_mv=0.;highp float angle_cos_mv=0.;float lineRotAngle=0.;if(!u_rotate_with_map&&!u_pitch_with_map){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION.xyz,1.0);gl_Position/=gl_Position.w;gl_Position.xy+=a_offset/32.0*fontScale/u_GlUnitsToPixels;}else if(u_rotate_with_map&&u_pitch_with_map&&u_along_line){gl_Position=u_ModelViewProjectionMatrix*vec4(a_CARTESIAN,1.0);}else if(u_rotate_with_map&&!u_pitch_with_map&&!u_along_line){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION.xyz,1.0);gl_Position/=gl_Position.w;mat3 rotation_matrix=rotateXYZ(0.,0.,u_Bearing);gl_Position.xyz+=rotation_matrix*vec3(a_offset.x,a_offset.y,0.)/32.0*fontScale/vec3(u_GlUnitsToPixels.xyx);}else if(u_rotate_with_map&&u_pitch_with_map&&!u_along_line){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION.xyz,1.0);gl_Position/=gl_Position.w;mat3 rotation_matrix=rotateXYZ(u_pitch,0.,u_Bearing);gl_Position.xyz+=rotation_matrix*vec3(a_offset.x,a_offset.y,0.)/32.0*fontScale/vec3(u_GlUnitsToPixels.xyx);}else if(!u_rotate_with_map&&u_pitch_with_map){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION.xyz,1.0);gl_Position/=gl_Position.w;mat3 rotation_matrix=rotateXYZ(u_pitch,0.,0.);gl_Position.xyz+=rotation_matrix*vec3(a_offset.x,a_offset.y,0.)/32.0*fontScale/vec3(u_GlUnitsToPixels.xyx);}else if(u_rotate_with_map&&!u_pitch_with_map&&u_along_line){gl_Position=u_ModelViewProjectionMatrix*vec4(a_CARTESIAN,1.0);}vec2 translate=u_translate;float translate_anchor=u_translate_anchor;if(translate_anchor==0.0){float sinA=sin(-u_Bearing);float cosA=cos(-u_Bearing);translate=vec2(translate[0]*cosA-translate[1]*sinA,translate[0]*sinA+translate[1]*cosA);}gl_Position.xy+=translate/u_GlUnitsToPixels;vec2 tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1]>0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));float vVal=getVectorPointVisibilityValue(a_POSITION.xyz,u_ModelMatrix,u_CameraPosition,u_CameraDirection);if(vVal==-1.0){interpolated_fade_opacity=0.0;}v_data0=vec2(tex.x,tex.y);v_data1=vec3(1.,size,interpolated_fade_opacity);\n#ifdef M_PICK_COLOR\nv_pick_color=a_pick_color;\n#endif\n}",l_="#define GLSLIFY 1\n#include <u_ModelMatrix>\n#include <u_NormalMatrix>\n#include <v_LocalPosition>\n#ifdef M_HAS_BASECOLORMAP\n#include <u_BaseColorSampler>\n#endif\nuniform vec4 u_BaseColorFactor;\n#include <c_define>\n#include <fn_writeLogDepth>\nuniform sampler2D u_MaskSample;\n#include <u_ClipMatrix>\nuniform vec2 u_TextureSize;uniform bool u_ClipVideo;\n#if (defined M_NUM_VIDEOS) && (M_NUM_VIDEOS>0)\nuniform highp mat4 u_VIDEOMATCH_MVPMATRIX[M_NUM_VIDEOS];uniform highp vec3 u_VIDEOMATCH_RTP[M_NUM_VIDEOS];uniform bool u_HAS_VIDEOMATCHMAP[M_NUM_VIDEOS];uniform float u_Alpha[M_NUM_VIDEOS];uniform highp sampler2D u_VideoSampler[M_NUM_VIDEOS];uniform bool u_ActiveClipVideoTexture[M_NUM_VIDEOS];uniform vec3 u_ClipColors[M_NUM_VIDEOS];\n#endif\n#include <fn_getNormal>\nvarying vec3 v_Position;varying vec3 v_ViewPosition;varying vec2 v_TexCoord;varying vec4 v_ModelInstanceColor;varying mat3 v_TBN;\n#include <v_Normal3>\nvarying vec4 v_COLOR_0;\n#include <u_Opacity>\nuniform highp sampler2D u_model_clippingPlanes;uniform vec4 u_model_clippingPlanesEdgeStyle;uniform mat4 u_model_clippingPlanesMatrix;\n#include <u_Viewport>\nuniform mat4 u_ViewportTransformation;uniform mat4 u_InverseProjection;\n#include <u_PixelRatio>\n#include <u_CurrentFrustum>\n#include <u_FrustumPlanes>\n#include <fn_primitiveClippingPlanes>\n#include <fn_getBatchTextureColor>\nuniform samplerCube u_DiffuseEnvSampler;uniform samplerCube u_SpecularEnvSampler;uniform sampler2D u_brdfLUT;\n#ifdef M_HAS_NORMALMAP\nuniform sampler2D u_NormalSampler;\n#endif\nuniform float u_NormalScale;\n#ifdef M_HAS_EMISSIVEMAP\nuniform sampler2D u_EmissiveSampler;\n#endif\nuniform vec3 u_EmissiveFactor;\n#ifdef M_HAS_METALROUGHNESSMAP\nuniform sampler2D u_MetallicRoughnessSampler;\n#endif\nuniform vec2 u_MetallicRoughnessValues;\n#ifdef M_HAS_OCCLUSIONMAP\nuniform sampler2D u_OcclusionSampler;\n#endif\nuniform float u_OcclusionStrength;uniform vec3 u_cameraLocalPosition;uniform vec3 u_SunLightDirectionSpecial;\n#ifdef M_ShadowEnable\nuniform sampler2D u_ShadowDepthSampler;uniform float u_EPSILON;uniform float u_MapSizeScale;\n#include <fn_shadow>\nuniform vec2 u_Resolution;varying vec4 v_PositionFromLight;\n#endif\n#include <u_LIGHT>\n#include <fn_pixelInVideo>\nuniform vec4 u_diffSpec;uniform float u_reflect;float DistributionGGX(vec3 N,vec3 H,float roughness){float a=roughness*roughness;float a2=a*a;float NdotH=max(dot(N,H),0.0);float NdotH2=NdotH*NdotH;float nom=a2;float denom=(NdotH2*(a2-1.0)+1.0);denom=PI*denom*denom;if(denom==0.0){denom=0.0001;}return nom/denom;}float GeometrySchlickGGX(float NdotV,float roughness){float r=(roughness+1.0);float k=(r*r)/8.0;float nom=NdotV;float denom=NdotV*(1.0-k)+k;if(denom==0.0){denom=0.0001;}return nom/denom;}float GeometrySmith(vec3 N,vec3 V,vec3 L,float roughness){float NdotV=max(dot(N,V),0.0);float NdotL=max(dot(N,L),0.0);float ggx2=GeometrySchlickGGX(NdotV,roughness);float ggx1=GeometrySchlickGGX(NdotL,roughness);return ggx1*ggx2;}vec3 fresnelSchlick(float cosTheta,vec3 F0){return F0+(1.0-F0)*pow(clamp(1.0-cosTheta,0.0,1.0),5.0);}vec3 fresnelSchlickRoughness(float cosTheta,vec3 F0,float roughness){return F0+(max(vec3(1.0-roughness),F0)-F0)*pow(clamp(1.0-cosTheta,0.0,1.0),5.0);}mat3 getTangentFrame(vec3 eye_pos,vec3 surf_norm,vec2 uv){vec3 q0=dFdx(eye_pos.xyz);vec3 q1=dFdy(eye_pos.xyz);vec2 st0=dFdx(uv.st);vec2 st1=dFdy(uv.st);vec3 N=surf_norm;vec3 q1perp=cross(q1,N);vec3 q0perp=cross(N,q0);vec3 T=q1perp*st0.x+q0perp*st1.x;vec3 B=q1perp*st0.y+q0perp*st1.y;float det=max(dot(T,T),dot(B,B));float scale2=(det==0.0)? 0.0 : inversesqrt(det);return mat3(T*scale2,B*scale2,N);}vec3 pbr(vec4 baseColor){float metallic=u_MetallicRoughnessValues.x;float roughness=u_MetallicRoughnessValues.y;\n#ifdef M_HAS_METALROUGHNESSMAP\nvec4 mrSample=texture2D(u_MetallicRoughnessSampler,v_TexCoord);roughness=mrSample.g*roughness;metallic=mrSample.b*metallic;\n#endif\nmetallic=clamp(metallic,0.0,1.0);roughness=clamp(roughness,c_MinRoughness,1.0);vec3 N=normalize(v_Normal);vec3 V=normalize(u_CameraPosition-v_Position.xyz);\n#ifdef M_HAS_NORMALMAP\nmat3 TBN;\n#ifdef M_HAS_TANGENTS\nTBN=v_TBN;\n#else\nTBN=getTangentFrame(-v_ViewPosition,N,v_TexCoord);\n#endif\nvec3 normalMap=texture2D(u_NormalSampler,v_TexCoord).rgb;vec3 normalT=normalMap*2.0-1.0;N=normalize(v_TBN*normalT);\n#endif\nvec3 R=reflect(-V,N);vec3 F0=vec3(0.04);F0=mix(F0,baseColor.rgb,metallic);vec3 Lo=vec3(0.0);\n#ifdef M_SunLight\n{vec3 directLightColor=u_SunLightColor;vec3 L=normalize(u_SunLightDirectionGlobal);vec3 H=normalize(V+L);float attenuation=1.0;vec3 radiance=directLightColor*attenuation;float NDF=DistributionGGX(N,H,roughness);float G=GeometrySmith(N,V,L,roughness);vec3 F=fresnelSchlick(max(dot(H,V),0.0),F0);vec3 numerator=NDF*G*F;float denominator=4.0*max(dot(N,V),0.0)*max(dot(N,L),0.0)+0.0001;vec3 specular=numerator/denominator;vec3 kS=F;vec3 kD=vec3(1.0)-kS;kD*=1.0-metallic;float NdotL=max(dot(N,L),0.0);Lo+=(kD*baseColor.rgb/PI+specular)*radiance*NdotL;}\n#endif\n#ifdef M_DirectionalLight\nfor(int i=0;i<int(M_DirectionalLightCount);++i){vec3 directLightColor=vec3(u_DirectionalLightColor[i*3],u_DirectionalLightColor[i*3+1],u_DirectionalLightColor[i*3+2]);vec3 L=normalize(vec3(u_DirectionalLightDir[i*3],u_DirectionalLightDir[i*3+1],u_DirectionalLightDir[i*3+2]));vec3 H=normalize(V+L);float attenuation=1.0*u_DirectionalLightIntensity[i];vec3 radiance=directLightColor*attenuation;float NDF=DistributionGGX(N,H,roughness);float G=GeometrySmith(N,V,L,roughness);vec3 F=fresnelSchlick(max(dot(H,V),0.0),F0);vec3 numerator=NDF*G*F;float denominator=4.0*max(dot(N,V),0.0)*max(dot(N,L),0.0)+0.0001;vec3 specular=numerator/denominator;vec3 kS=F;vec3 kD=vec3(1.0)-kS;kD*=1.0-metallic;float NdotL=max(dot(N,L),0.0);Lo+=(kD*baseColor.rgb/PI+specular)*radiance*NdotL;}\n#endif\n#ifdef M_PointLight\nfor(int i=0;i<int(M_PointLightCount);i++){vec3 pointLightPosition=vec3(u_PointLightPosition[i*3],u_PointLightPosition[i*3+1],u_PointLightPosition[i*3+2]);vec3 pointLightColor=vec3(u_PointLightColor[i*3],u_PointLightColor[i*3+1],u_PointLightColor[i*3+2]);float pointLightIntensity=u_PointLightIntensity[i];vec3 LV=pointLightPosition-v_Position;vec3 L=normalize(LV);vec3 H=normalize(V+L);float distance=length(LV);if(distance==0.0){distance=0.0001;}float attenuation=pointLightIntensity*1000.0/(distance*distance);vec3 radiance=pointLightColor*attenuation;float NDF=DistributionGGX(N,H,roughness);float G=GeometrySmith(N,V,L,roughness);vec3 F=fresnelSchlick(max(dot(H,V),0.0),F0);vec3 numerator=NDF*G*F;float denominator=4.0*max(dot(N,V),0.0)*max(dot(N,L),0.0)+0.0001;vec3 specular=numerator/denominator;vec3 kS=F;vec3 kD=vec3(1.0)-kS;kD*=1.0-metallic;float NdotL=max(dot(N,L),0.0);Lo+=(kD*baseColor.rgb/PI+specular)*radiance*NdotL;}\n#endif\nvec3 F=fresnelSchlickRoughness(max(dot(N,V),0.0),F0,roughness);vec3 kS=F;vec3 kD=1.0-kS;kD*=1.0-metallic;vec3 irradiance=textureCube(u_DiffuseEnvSampler,N).rgb*0.28;\n#ifdef M_AmbientLight\nfor(int i=0;i<int(M_AmbientLightCount);++i){vec3 ambientColor=vec3(u_AmbientLightsColor[i*3],u_AmbientLightsColor[i*3+1],u_AmbientLightsColor[i*3+2]);irradiance+=ambientColor;}\n#endif\nvec3 diffuse=irradiance*baseColor.rgb;vec3 prefilteredColor=textureCube(u_SpecularEnvSampler,R).rgb;vec2 brdf=texture2D(u_brdfLUT,vec2(max(dot(N,V),0.0),1.0-roughness)).rg;vec3 specular=prefilteredColor*(F*brdf.x+brdf.y);vec3 color=(kD*diffuse+specular);\n#ifdef M_HAS_OCCLUSIONMAP\nfloat ao=texture2D(u_OcclusionSampler,v_TexCoord).r;color=mix(color,color*ao,u_OcclusionStrength);\n#endif\n#ifdef M_HAS_EMISSIVEMAP\nvec3 emissive=texture2D(u_EmissiveSampler,v_TexCoord).rgb*u_EmissiveFactor;color+=emissive;\n#endif\ncolor=color+Lo;return color;}void main(){vec4 baseColor=u_BaseColorFactor;\n#if defined M_HAS_BASECOLORMAP\nbaseColor=texture2D(u_BaseColorSampler,v_TexCoord);\n#if defined M_OPAQUE\nif(baseColor.a>0.0){baseColor.rgb*=u_BaseColorFactor.rgb;baseColor.a=1.0;}else{baseColor*=u_BaseColorFactor;}\n#else\nbaseColor*=u_BaseColorFactor;\n#endif\n#endif\n#if defined M_VERTEX_COLOR\nbaseColor*=v_COLOR_0;\n#endif\n#ifdef M_MODEL_INSTANCE_BATCH_TEXTURE\nbaseColor.rgb=mix(baseColor.rgb,v_ModelInstanceColor.rgb,v_ModelInstanceColor.a);\n#endif\nif(baseColor.a==0.0){discard;}\n#ifdef M_HAS_CLIPPING_PLANES\nmodelClippingPlanesStage(baseColor);\n#endif\nvec3 color=vec3(1.0);\n#ifdef M_HAS_NORMALS\ncolor=pbr(baseColor);float m=max(0.0,max(color.r,max(color.g,color.b)));if(m>1.0){color/=m;}\n#else\ncolor=baseColor.rgb;\n#endif\ngl_FragColor=vec4(color,baseColor.a);float visibility=1.0;\n#ifdef M_ShadowEnable\n#ifdef M_ShadowMapping\nvisibility=0.6+0.4*ifShadow2(v_PositionFromLight,u_ShadowDepthSampler,u_EPSILON,1./u_Resolution.x,1./u_Resolution.y,u_MapSizeScale);\n#else\n#ifdef M_PCF\nvisibility=ShadowPCF(v_PositionFromLight,u_Resolution,u_ShadowDepthSampler);\n#endif\n#endif\n#endif\ngl_FragColor=vec4(gl_FragColor.rgb*visibility,gl_FragColor.a*u_Opacity);\n#if (defined M_NUM_VIDEOS) && (M_NUM_VIDEOS>0)\nfor(int i=0;i<M_NUM_VIDEOS;i++){if(u_HAS_VIDEOMATCHMAP[i]){if(u_ClipVideo){if(pixelInVideo(u_VIDEOMATCH_MVPMATRIX[i],u_VIDEOMATCH_RTP[i],u_ModelMatrix,v_LocalPosition,u_VideoSampler[i],u_Alpha[i],u_ClipMatrix,u_MaskSample,u_TextureSize,u_ActiveClipVideoTexture[i],u_ClipColors[i])){continue;}}else{if(pixelInVideo(u_VIDEOMATCH_MVPMATRIX[i],u_VIDEOMATCH_RTP[i],u_ModelMatrix,v_LocalPosition,u_VideoSampler[i],u_Alpha[i],u_ClipMatrix,u_MaskSample,u_TextureSize,false,u_ClipColors[i])){continue;}}}}\n#endif\n#if defined(M_ONE_DIMENSION_BATCH_TEXTURE)||defined(M_TWO_DIMENSION_BATCH_TEXTURE)\ngetBatchTextureColor(batch_featureColor);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}",c_="#define GLSLIFY 1\n#include <c_define>\n#ifdef M_DOUBLEPRECISION\n#include <a_DOUBLE_PRECISION_POSITION>\n#else\n#include <a_POSITION3>\n#endif\n#include <a_NORMAL3>\n#include <a_TANGENT>\n#include <a_TEXCOORD_0>\n#ifdef M_USE_MORPHTARGETS\n#include <a_POSITION3_1>\n#include <a_POSITION3_2>\nuniform vec2 u_morphTargetInfluences;\n#include <a_NORMAL3_1>\n#include <a_NORMAL3_2>\n#include <a_TANGENT_1>\n#include <a_TANGENT_2>\n#endif\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelMatrix>\n#include <u_ViewMatrix>\n#include <u_NormalMatrix>\n#include <v_LocalPosition>\n#include <a_COLOR4_0>\n#include <a_BATCHID>\n#ifdef M_JOINT_MATRIX_CNT\nattribute vec4 a_JOINTS_0;attribute vec4 a_WEIGHTS_0;\n#endif\n#ifdef M_INSTANCE_MATRIX\nattribute mat4 a_InstanceMatrix4;uniform mat4 vpmatrix;uniform mat4 u_ModelInstanceRTCTransformMatrix;\n#endif\nuniform bool u_useKhr;uniform vec4 u_khrValues;varying vec3 v_Position;varying vec3 v_ViewPosition;\n#ifdef M_ShadowEnable\nvarying vec4 v_PositionFromLight;uniform mat4 u_ShadowModelViewProjectionMatrix;\n#endif\nvarying vec2 v_TexCoord;varying mat3 v_TBN;\n#include <v_Normal3>\nvarying vec4 v_COLOR_0;\n#include <s_JointMatrix>\n#include <fn_vertexLogDepth>\n#include <u_HasSkinning>\n#ifdef M_JOINT_MATRIX_CNT\nuniform highp mat4 u_jointMatrix[M_JOINT_MATRIX_CNT];\n#else\nuniform highp mat4 u_jointMatrix[19];\n#endif\n#include <fn_getKHRCoord>\n#include <c_computeSTParsVert>\n#include <u_ModelViewProjectionRelativeToEye>\n#include <u_EncodedCameraPosition>\n#include <fn_translateRelativeToEye>\n#include <fn_getAnimatedGLPosition>\n#include <u_LIGHT>\n#include <v_LIGHT>\nuniform sampler2D u_NormalSampler;mat3 transpose(mat3 matrix){return mat3(vec3(matrix[0][0],matrix[1][0],matrix[2][0]),vec3(matrix[0][1],matrix[1][1],matrix[2][1]),vec3(matrix[0][2],matrix[1][2],matrix[2][2]));}void main(){mat4 modelMatrix=mat4(1.0);\n#ifdef M_INSTANCE_MATRIX\nmodelMatrix=u_ModelInstanceRTCTransformMatrix*a_InstanceMatrix4*u_ModelMatrix;\n#else\nmodelMatrix=u_ModelMatrix;\n#endif\n#ifdef M_DOUBLEPRECISION\nvec4 pos=modelMatrix*vec4(a_PositionHigh+a_PositionLow,1.0);v_Position=vec3(pos.xyz)/pos.w;v_ViewPosition=(u_ViewMatrix*pos).xyz;v_LocalPosition=vec4(a_PositionHigh+a_PositionLow,1.0);\n#ifdef M_ShadowEnable\nv_PositionFromLight=u_ShadowModelViewProjectionMatrix*vec4(a_PositionHigh+a_PositionLow,1.0);\n#endif\n#else\nvec4 pos=modelMatrix*vec4(a_POSITION,1.0);v_Position=vec3(pos.xyz)/pos.w;v_ViewPosition=(u_ViewMatrix*pos).xyz;v_LocalPosition=vec4(a_POSITION,1.0);\n#ifdef M_ShadowEnable\nv_PositionFromLight=u_ShadowModelViewProjectionMatrix*vec4(a_POSITION,1.0);\n#endif\n#endif\n#if defined(M_enableLight) && defined(M_PointLight) && defined(M_ShadowEnable)\nfor(int i=0;i<int(M_PointLightCount);i++){vec4 positionToLight=u_PointLightModelMatrixInverse[i]*vec4(v_Position,1.0);v_PointDirection[i]=positionToLight.xyz;}\n#endif\nif(u_useKhr){v_TexCoord=getKHRCoord(a_TEXCOORD_0,u_khrValues);}else{v_TexCoord=a_TEXCOORD_0;}\n#ifndef M_INSTANCE_MATRIX\n#ifdef M_HAS_NORMALS\nv_Normal=normalize(u_NormalMatrix*a_NORMAL);\n#ifdef M_HAS_NORMALMAP\n#ifdef M_HAS_TANGENTS\nvec3 N=v_Normal;vec3 T=normalize(u_NormalMatrix*a_TANGENT);vec3 B=normalize(cross(N,T));v_TBN=mat3(T,B,N);\n#endif\n#endif\n#endif\n#endif\nv_COLOR_0=a_COLOR_0;getAnimatedGLPosition();\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n#include <c_computeSTMainVert>\n}",u_="#define GLSLIFY 1\n#include <a_POSITION2>\n#include <u_ModelViewProjectionMatrix>\n#include <u_World>\n#include <v_TexCoord2>\nvoid main(){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION*u_World,0,1);v_TexCoord.x=a_POSITION.x;v_TexCoord.y=1.0-a_POSITION.y;}",h_="#define GLSLIFY 1\n#include <a_POSITION2>\nvarying vec2 vUv;void main(){gl_Position=vec4(a_POSITION,0.0,1.0);vUv=a_POSITION;}";const d_={basicVertex:"#define GLSLIFY 1\n#ifdef M_DOUBLEPRECISION\n#include <a_DOUBLE_PRECISION_POSITION>\n#else\n#include <a_POSITION3>\n#endif\n#include <u_ModelMatrix>\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelViewProjectionRelativeToEye>\n#include <u_EncodedCameraPosition>\n#include <fn_translateRelativeToEye>\n",a_BATCHID:"#define GLSLIFY 1\nattribute float a_BATCHID;",a_COLOR3_0:"#define GLSLIFY 1\nattribute vec3 a_COLOR_0;",a_COLOR4_0:"#define GLSLIFY 1\nattribute vec4 a_COLOR_0;",a_POSITION2:"#define GLSLIFY 1\nattribute vec2 a_POSITION;",a_POSITION3:"#define GLSLIFY 1\nattribute vec3 a_POSITION;",a_POSITION3_1:"#define GLSLIFY 1\nattribute vec3 a_POSITION_1;",a_POSITION3_2:"#define GLSLIFY 1\nattribute vec3 a_POSITION_2;",a_POSITION4:"#define GLSLIFY 1\nattribute vec4 a_POSITION;",a_DOUBLE_PRECISION_POSITION:"#define GLSLIFY 1\n#ifdef M_DOUBLEPRECISION\nattribute vec3 a_PositionHigh;attribute vec3 a_PositionLow;\n#endif\n",a_NORMAL3:"#define GLSLIFY 1\nattribute vec3 a_NORMAL;",a_NORMAL3_1:"#define GLSLIFY 1\nattribute vec3 a_NORMAL_1;",a_NORMAL3_2:"#define GLSLIFY 1\nattribute vec3 a_NORMAL_2;",a_NORMAL2:"#define GLSLIFY 1\nattribute vec2 a_NORMAL;",a_TANGENT:"#define GLSLIFY 1\nattribute vec3 a_TANGENT;",a_TANGENT_1:"#define GLSLIFY 1\nattribute vec3 a_TANGENT_1;",a_TANGENT_2:"#define GLSLIFY 1\nattribute vec3 a_TANGENT_2;",a_TEXCOORD_0:"#define GLSLIFY 1\nattribute vec2 a_TEXCOORD_0;",u_ModelMatrix:"#define GLSLIFY 1\n#ifndef __MODEL_MATRIX__\n#define __MODEL_MATRIX__\nuniform mat4 u_ModelMatrix;\n#endif\n",u_ProjectionMatrix:"#define GLSLIFY 1\nuniform mat4 u_ProjectionMatrix;",u_ModelViewMatrix:"#define GLSLIFY 1\n#ifndef __MODEL_VIEW_MATRIX__\n#define __MODEL_VIEW_MATRIX__\nuniform mat4 u_ModelViewMatrix;",u_ViewProjectionMatrix:"#define GLSLIFY 1\nuniform mat4 u_ViewProjectionMatrix;",u_ModelViewProjectionMatrix:"#define GLSLIFY 1\n#ifndef __MODEL_VIEW_PROJECTION_MATRIX__\n#define __MODEL_VIEW_PROJECTION_MATRIX__\nuniform mat4 u_ModelViewProjectionMatrix;\n#endif\n",u_NormalMatrix:"#define GLSLIFY 1\nuniform mat3 u_NormalMatrix;",u_ClipMatrix:"#define GLSLIFY 1\nuniform mat4 u_ClipMatrix;",u_BaseColorSampler:"#define GLSLIFY 1\nuniform sampler2D u_BaseColorSampler;",u_Resolution:"#define GLSLIFY 1\nuniform highp vec2 u_Resolution;",u_PixelMatrix:"#define GLSLIFY 1\nuniform mat2 u_PixelMatrix;",u_PixelRatio:"#define GLSLIFY 1\nuniform float u_PixelRatio;",u_Opacity:"#define GLSLIFY 1\nuniform float u_Opacity;",u_LightMaterial:"#define GLSLIFY 1\nuniform LightMaterial u_LightMaterial;",u_Color4:"#define GLSLIFY 1\nuniform vec4 u_Color;",u_Color3:"#define GLSLIFY 1\nuniform vec3 u_Color;",u_World:"#define GLSLIFY 1\n#ifndef _U_WORLD_\n#define _U_WORLD_\nuniform vec2 u_World;\n#endif\n",u_Zoom:"#define GLSLIFY 1\nuniform float u_Zoom;",u_ViewMatrix:"#define GLSLIFY 1\nuniform mat4 u_ViewMatrix;",u_TileNumber:"#define GLSLIFY 1\nuniform vec4 u_TileNumber;",u_Viewport:"#define GLSLIFY 1\nuniform vec4 u_Viewport;",u_RotateMatrixInverse:"#define GLSLIFY 1\nuniform mat4 u_RotateMatrixInverse;",u_ShadowViewProjectionMatrix:"#define GLSLIFY 1\nuniform mat4 u_ShadowViewProjectionMatrix;",u_ModelViewProjectionRelativeToEye:"#define GLSLIFY 1\n#ifndef __MODEL_VIEW_PROJECTION_MATRIX_RTE__\n#define __MODEL_VIEW_PROJECTION_MATRIX_RTE__\nuniform mat4 u_ModelViewProjectionRelativeToEye;\n#endif\n",u_CurrentFrustum:"#define GLSLIFY 1\nuniform vec2 u_CurrentFrustum;",u_EncodedCameraPosition:"#define GLSLIFY 1\nuniform vec3 u_EncodedCameraPositionMCLow;uniform vec3 u_EncodedCameraPositionMCHigh;",u_FrameTime:"#define GLSLIFY 1\nuniform float u_FrameTime;",u_FrustumPlanes:"#define GLSLIFY 1\nuniform vec4 u_FrustumPlanes;",u_Gamma:"#define GLSLIFY 1\nuniform float u_Gamma;",u_HasSkinning:"#define GLSLIFY 1\nuniform bool u_HasSkinning;",u_LIGHT:"#define GLSLIFY 1\n#ifdef M_enableLight\n#ifdef M_AmbientLight\nuniform float u_AmbientLightsColor[M_AmbientLightCount*3];uniform float u_AmbientLightsIntensity[M_AmbientLightCount];\n#endif\n#ifdef M_DirectionalLight\nuniform float u_DirectionalLightColor[M_DirectionalLightCount*3];uniform float u_DirectionalLightIntensity[M_DirectionalLightCount];uniform float u_DirectionalLightDir[M_DirectionalLightCount*3];\n#endif\n#ifdef M_PointLight\nuniform float u_PointLightColor[M_PointLightCount*3];uniform float u_PointLightIntensity[M_PointLightCount];uniform float u_PointLightPosition[M_PointLightCount*3];\n#ifdef M_ShadowEnable\nuniform mat4 u_PointLightModelMatrixInverse[M_PointLightCount];uniform float u_PointLightFar[M_PointLightCount];uniform samplerCube u_PointLightDepthCubeTexture;uniform float u_PointLightEpsilon[M_PointLightCount];uniform float u_DiskRadius[M_PointLightCount];uniform samplerCube u_PointLightDepthCubeTexture0;uniform samplerCube u_PointLightDepthCubeTexture1;uniform samplerCube u_PointLightDepthCubeTexture2;uniform samplerCube u_PointLightDepthCubeTexture3;uniform samplerCube u_PointLightDepthCubeTexture4;uniform samplerCube u_PointLightDepthCubeTexture5;\n#endif\n#endif\n#endif\n",u_Bearing:"#define GLSLIFY 1\nuniform float u_Bearing;",v_TexCoord2:"#define GLSLIFY 1\nvarying vec2 v_TexCoord;",v_TexCoord3:"#define GLSLIFY 1\nvarying vec3 v_TexCoord;",v_Normal3:"#define GLSLIFY 1\nvarying vec3 v_Normal;",v_Normal2:"#define GLSLIFY 1\nvarying vec2 v_Normal;",v_LocalPosition:"#define GLSLIFY 1\nvarying vec4 v_LocalPosition;",v_LIGHT:"#define GLSLIFY 1\n#ifdef M_enableLight\n#ifdef M_PointLight\n#ifdef M_ShadowEnable\nvarying vec3 v_PointDirection[M_PointLightCount];\n#endif\n#endif\n#endif\n",c_define:"#define GLSLIFY 1\n#define scale 0.015873016\n#define GAUSS_COEF 0.3989422804014327\n#define ANTIALIASING 1.0 / M_DEVICE_PIXEL_RATIO / 2.0\n#define LINE_DISTANCE_SCALE 2.0\n#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105/M_DEVICE_PIXEL_RATIO\n#ifdef M_LOG_DEPTH\nvarying float v_depthFromNearPlusOne;\n#include <u_CurrentFrustum>\n#endif\nconst highp float ZERO=1.0/255.0/16.0;const float c_MinRoughness=0.04;",c_extrusionF:"#define GLSLIFY 1\n#include <v_Normal3>\nvarying highp float v_Top;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;uniform bool u_RenderBodyTex;uniform vec2 u_top_pattern_tl_a;uniform vec2 u_top_pattern_br_a;uniform vec2 u_top_pattern_tl_b;uniform vec2 u_top_pattern_br_b;uniform bool u_RenderTopTex;uniform vec2 u_texsize;uniform vec2 u_top_pattern_size_a;uniform vec2 u_top_pattern_size_b;uniform float u_mix;varying float v_directional;varying float v_opacity;varying vec4 v_color;varying float v_height;uniform lowp float u_depth_render;uniform vec4 u_color_a;uniform vec4 u_color_b;uniform vec4 u_color_c;uniform vec4 u_color_d;uniform vec4 u_color_e;uniform float u_max_height;",c_extrusionV:"#define GLSLIFY 1\nuniform float u_is_max_length;attribute vec4 a_NORMAL_ED;attribute vec3 a_ST;\n#include <v_Normal3>\nvarying highp float v_Top;\n#include <fn_getPatternPos>\nuniform vec2 u_top_pattern_size_a;uniform vec2 u_top_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;uniform vec2 u_translate;uniform float u_translate_anchor;\n#include <u_World>\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;",c_fillF:"#define GLSLIFY 1\nuniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;",c_fillV:"#define GLSLIFY 1\n#include <fn_getVectorPointVisibilityValue>\nuniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_translate;uniform float u_translate_anchor;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#include <u_ModelMatrix>\n",c_lineF:"#define GLSLIFY 1\n#include <fn_writeLogDepth>\nuniform bool u_HasBorder;varying vec2 v_width2;\n#include <v_Normal2>\nvarying float v_gamma_scale;",c_lineV:"#define GLSLIFY 1\n#include <fn_vertexLogDepth>\n#include <fn_getVectorPointVisibilityValue>\nattribute float a_NORMAL;attribute vec4 a_data;attribute vec2 a_pos_normal;\n#include <u_PixelMatrix>\nuniform mediump float u_Ratio;uniform vec2 u_GlUnitsToPixels;uniform bool u_HalfRender;uniform lowp float normaldirection;uniform bool u_HasBorder;uniform vec2 u_translate;uniform float u_translate_anchor;\n#include <u_ModelMatrix>\n#include <v_Normal2>\nvarying vec2 v_width2;varying float v_gamma_scale;",c_symbolF:"#define GLSLIFY 1\nuniform bool u_is_halo;uniform bool u_is_text;varying vec2 v_tex;varying float v_fade_opacity;varying vec2 v_data0;varying vec3 v_data1;varying float v_seq;",c_symbolV:"#define GLSLIFY 1\nattribute vec2 a_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute vec3 a_CARTESIAN;attribute float a_fade_opacity;attribute vec3 a_extra;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform vec2 u_GlUnitsToPixels;uniform highp float u_Bearing;uniform bool u_along_line;uniform bool u_pitch_with_map;uniform bool u_rotate_with_map;uniform bool u_rotate_symbol;uniform bool u_is_text;uniform highp float u_pitch;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform vec2 u_texsize;uniform float u_display_mode;uniform vec2 u_timestamp_se;uniform highp float u_seq;uniform vec2 u_translate;uniform float u_translate_anchor;varying vec2 v_data0;varying vec3 v_data1;varying vec2 v_tex;varying float v_fade_opacity;varying float v_seq;",c_computeSTParsVert:"#define GLSLIFY 1\n#if defined(M_ONE_DIMENSION_BATCH_TEXTURE)\nuniform sampler2D batchTexture;uniform vec4 batch_textureStep;varying vec4 batch_featureColor;varying vec2 batch_featureSt;vec2 computeSt(float batchId){float stepX=batch_textureStep.x;float centerX=batch_textureStep.y;return vec2(centerX+(batchId*stepX),0.5);}\n#endif\n#if defined(M_TWO_DIMENSION_BATCH_TEXTURE)\nuniform sampler2D batchTexture;uniform vec4 batch_textureStep;uniform vec2 batch_textureDimensions;varying vec2 batch_featureSt;varying vec4 batch_featureColor;vec2 computeSt(float batchId){float stepX=batch_textureStep.x;float centerX=batch_textureStep.y;float stepY=batch_textureStep.z;float centerY=batch_textureStep.w;float xId=mod(batchId,batch_textureDimensions.x);float yId=floor(batchId/batch_textureDimensions.x);return vec2(centerX+(xId*stepX),centerY+(yId*stepY));}\n#endif\n#if defined(M_MODEL_INSTANCE_BATCH_TEXTURE)\nuniform sampler2D batchTableTexture;uniform vec4 batchTextureStep;uniform float numberOfAttributes;varying vec4 v_ModelInstanceColor;varying vec4 v_PickColor;attribute vec4 a_PickColor;vec2 computeModelSt(float batchId){float stepX=batchTextureStep.x;float centerX=batchTextureStep.y;return vec2(centerX+(batchId*numberOfAttributes*stepX),0.5);}vec4 batchTable_color(float batchId){vec2 st=computeModelSt(batchId);st.x+=batchTextureStep.x*float(0);vec4 textureValue=texture2D(batchTableTexture,st);return textureValue;}float batchTable_show(float batchId){vec2 st=computeModelSt(batchId);st.x+=batchTextureStep.x*float(1);vec4 textureValue=texture2D(batchTableTexture,st);float value=textureValue.x;value*=255.0;return value;}vec4 batchTable_pickColor(float batchId){vec2 st=computeModelSt(batchId);st.x+=batchTextureStep.x*float(2);vec4 textureValue=texture2D(batchTableTexture,st);vec4 value=textureValue;return value;}\n#endif\n",c_computeSTMainVert:"#define GLSLIFY 1\n#if defined(M_ONE_DIMENSION_BATCH_TEXTURE)||defined(M_TWO_DIMENSION_BATCH_TEXTURE)\nbatch_featureSt=computeSt(a_BATCHID);batch_featureColor=texture2D(batchTexture,batch_featureSt);float show=ceil(batch_featureColor.a);gl_Position*=show;\n#endif\n#ifdef M_MODEL_INSTANCE_BATCH_TEXTURE\ngl_Position*=batchTable_show(a_BATCHID);v_ModelInstanceColor=batchTable_color(a_BATCHID);v_PickColor=batchTable_pickColor(a_BATCHID);\n#endif\n",pragma_base_define:"#define GLSLIFY 1\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n",pragma_base_initialize:"#define GLSLIFY 1\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n",pragma_border_define:"#define GLSLIFY 1\n#pragma minemap: define highp vec4 bordercolor\n#pragma minemap: define mediump float borderwidth\n#pragma minemap: define lowp float borderopacity\n",pragma_border_initialize:"#define GLSLIFY 1\n#pragma minemap: initialize highp vec4 bordercolor\n#pragma minemap: initialize mediump float borderwidth\n#pragma minemap: initialize lowp float borderopacity\n",pragma_circle_define:"#define GLSLIFY 1\n#include <pragma_base_define>\n#pragma minemap: define mediump float radius\n#pragma minemap: define highp vec4 stroke_color\n#pragma minemap: define mediump float stroke_width\n#pragma minemap: define lowp float stroke_opacity\n",pragma_circle_initialize:"#define GLSLIFY 1\n#include <pragma_base_initialize>\n#pragma minemap: initialize mediump float radius\n#pragma minemap: initialize highp vec4 stroke_color\n#pragma minemap: initialize mediump float stroke_width\n#pragma minemap: initialize lowp float stroke_opacity\n",pragma_extrusion_define:"#define GLSLIFY 1\n#include <pragma_base_define>\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n",pragma_extrusion_initialize:"#define GLSLIFY 1\n#include <pragma_base_initialize>\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n",pragma_heatmap_define:"#define GLSLIFY 1\n#pragma minemap: define highp float weight\n#pragma minemap: define mediump float radius\n",pragma_heatmap_initialize:"#define GLSLIFY 1\n#pragma minemap: initialize highp float weight\n#pragma minemap: initialize mediump float radius\n",pragma_line_define:"#define GLSLIFY 1\n#include <pragma_base_define>\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\n#pragma minemap: define lowp float floorwidth\n#pragma minemap: define lowp float normal_direction\n#pragma minemap: define lowp float speed_factor\n",pragma_line_initialize:"#define GLSLIFY 1\n#include <pragma_base_initialize>\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float width\n#pragma minemap: initialize lowp float floorwidth\n#pragma minemap: initialize lowp float normal_direction\n#pragma minemap: initialize lowp float speed_factor\n",pragma_fill_define:"#define GLSLIFY 1\n#pragma minemap: define highp vec4 outline_color\n",pragma_fill_initialize:"#define GLSLIFY 1\n#pragma minemap: initialize highp vec4 outline_color\n",pragma_symbol_define:"#define GLSLIFY 1\n#pragma minemap: define highp vec4 fill_color\n#pragma minemap: define highp vec4 halo_color\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float halo_width\n#pragma minemap: define lowp float halo_blur\n",pragma_symbol_initialize:"#define GLSLIFY 1\n#pragma minemap: initialize highp vec4 fill_color\n#pragma minemap: initialize highp vec4 halo_color\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize lowp float halo_width\n#pragma minemap: initialize lowp float halo_blur\n",pragma_water_define:"#define GLSLIFY 1\n#pragma minemap: define lowp float watercalm\n#pragma minemap: define lowp float waterspeed\n",pragma_water_initialize:"#define GLSLIFY 1\n#pragma minemap: initialize lowp float watercalm\n#pragma minemap: initialize lowp float waterspeed\n",fn_basic:"#define GLSLIFY 1\nvec4 getGLPosition(){\n#ifdef M_DOUBLEPRECISION\nvec4 position=u_ModelViewProjectionRelativeToEye*translateRelativeToEye(a_PositionHigh,a_PositionLow);\n#else\nvec4 position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);\n#endif\nreturn position;}vec4 getWorldPosition(){\n#ifdef M_DOUBLEPRECISION\nvec4 position=u_ModelMatrix*vec4(a_PositionHigh+a_PositionLow,1);\n#else\nvec4 position=u_ModelMatrix*vec4(a_POSITION,1.0);\n#endif\nreturn position;}",fn_translateRelativeToEye:"#define GLSLIFY 1\nvec4 translateRelativeToEye(vec3 high,vec3 low){vec3 highDifference=high-u_EncodedCameraPositionMCHigh;vec3 lowDifference=low-u_EncodedCameraPositionMCLow;return vec4(highDifference+lowDifference,1.0);}",fn_rotateXYZ:"#define GLSLIFY 1\n#ifndef _fn_rotateXYZ_\n#define _fn_rotateXYZ_\nmat3 rotateX(float radian){float c=cos(radian);float s=sin(radian);return mat3(1.0,0.0,0.0,0.0,c,-s,0.0,s,c);}mat3 rotateY(float radian){float c=cos(radian);float s=sin(radian);return mat3(c,0.0,s,0.0,1.0,0.0,-s,0.0,c);}mat3 rotateZ(float radian){float c=cos(radian);float s=sin(radian);return mat3(c,-s,0.0,s,c,0.0,0.0,0.0,1.0);}mat3 rotateXYZ(float x,float y,float z){return rotateX(x)*rotateY(y)*rotateZ(z);}\n#endif\n",fn_rotateTexCoord:"#define GLSLIFY 1\nvec2 rotateTexCoord(vec2 texCoord,float angle){mat2 rotationMatrix=mat2(cos(angle),-sin(angle),sin(angle),cos(angle));return rotationMatrix*(texCoord-0.5)+0.5;}",fn_shadow:"#define GLSLIFY 1\n#include <fn_decodeFloat>\nfloat getDepthUseWPAndVP(vec3 worldPosition,mat4 viewProjectionMatrix,sampler2D depthSampler){vec4 clipPos=viewProjectionMatrix*vec4(worldPosition,1.0);clipPos=clipPos/clipPos.w;vec2 texPos=vec2(clipPos.x,clipPos.y)*0.5+0.5;vec4 depthTexture=texture2D(depthSampler,texPos);return unpackDepth(depthTexture);}bool ifShadow(vec3 worldPosition,mat4 viewProjectionMatrix,sampler2D depthSampler){vec4 clipPos=viewProjectionMatrix*vec4(worldPosition,1.0);clipPos=clipPos/clipPos.w;vec2 texPos=vec2(clipPos.x,clipPos.y)*0.5+0.5;vec4 depthTexture=texture2D(depthSampler,texPos);float depthValue=unpackDepth(depthTexture);if(texPos.x<0.0||texPos.y<0.0||texPos.x>1.0||texPos.y>1.0||depthValue==0.0){return false;}else{return depthValue<((clipPos.z*0.5)+0.5)-0.01;}}bool ifShadow(vec4 clipPos,sampler2D depthSampler){vec3 shadowPos=clipPos.xyz/clipPos.w;vec2 texPos=vec2(shadowPos.x,shadowPos.y)*0.5+0.5;vec4 depthTexture=texture2D(depthSampler,texPos);float depthValue=unpackDepth(depthTexture);if(texPos.x<0.0||texPos.y<0.0||texPos.x>1.0||texPos.y>1.0||depthValue==0.0){return false;}else{return depthValue<((shadowPos.z*0.5)+0.5)-0.0015;}}float ShadowPCF(vec4 clipPos,vec2 resolution,sampler2D depthSampler){vec3 shadowPos=clipPos.xyz/clipPos.w;vec2 texPos=vec2(shadowPos.x,shadowPos.y)*0.5+0.5;const int size=2;const float num=25.0;int cout=0;for(int x=-size;x<=size;x++){for(int y=-size;y<=size;y++){vec2 coordinate=texPos+vec2(x,y)/resolution;if(coordinate.x<0.0||coordinate.y<0.0||coordinate.x>1.0||coordinate.y>1.0){continue;}else{vec4 depthTexture=texture2D(depthSampler,coordinate);float depthValue=unpackDepth(depthTexture);if(depthValue<((clipPos.z*0.5)+0.5)-0.025){cout=cout+1;}}}}return 1.0-0.3*(float(cout)/num);}vec4 getColor(vec3 worldPosition,mat4 viewProjectionMatrix,sampler2D depthSampler){vec4 clipPos=viewProjectionMatrix*vec4(worldPosition,1.0);clipPos=clipPos/clipPos.w;vec2 texPos=vec2(clipPos.x,clipPos.y)*0.5+0.5;if(texPos.x<0.0||texPos.y<0.0||texPos.x>1.0&&texPos.y>1.0){return vec4(0.0,0.0,1.0,1.0);}vec4 depthTexture=texture2D(depthSampler,texPos);if(unpackDepth(depthTexture)==0.0000){return vec4(1.0,0.0,0.0,1.0);}else if(unpackDepth(depthTexture)<((clipPos.z*0.5)+0.5)){return vec4(0.0,1.0,0.0,1.0);}else{return vec4(1.0,1.0,1.0,1.0);}}bool ifShadowMin(vec4 fragCoord,vec2 u_Resolution,mat4 u_InverseViewProjectionMatrix,mat4 viewProjectionMatrix2,sampler2D depthSampler,sampler2D shadowDepthSampler){int cout=0;for(float x=-1.0;x<=1.0;x++){for(float y=-1.0;y<=1.0;y++){float x_coord=fragCoord.x+x;float y_coord=fragCoord.y+y;if(x_coord<0.0||y_coord<0.0||x_coord>u_Resolution.x||y_coord>u_Resolution.y){continue;}else{x_coord=x_coord/u_Resolution.x;y_coord=y_coord/u_Resolution.y;float z_coord=unpackDepth(texture2D(depthSampler,vec2(x_coord,y_coord)));vec4 coordinate=vec4(x_coord*2.0-1.0,y_coord*2.0-1.0,z_coord*2.0-1.0,1.0);coordinate=u_InverseViewProjectionMatrix*coordinate;coordinate=coordinate/coordinate.w;if(ifShadow(coordinate.xyz,viewProjectionMatrix2,shadowDepthSampler)){cout=cout+1;}}}}return cout==9;}float ifShadow2(vec4 clipPos,sampler2D depthSampler,float EPSILON,float deltX,float deltY,float scaleShadow){float Factor=0.0;clipPos=clipPos/clipPos.w;float z=(clipPos.z*0.5)+0.5;vec2 texPos=vec2(clipPos.x,clipPos.y)*0.5+0.5;if(texPos.x<0.0||texPos.y<0.0||texPos.x>1.0||texPos.y>1.0){return 1.0;}else{float indexIJ[10];indexIJ[0]=-1.0;indexIJ[1]=0.0;indexIJ[2]=0.0;indexIJ[3]=0.0;indexIJ[4]=1.0;indexIJ[5]=0.0;indexIJ[6]=0.0;indexIJ[7]=-1.0;indexIJ[8]=0.0;indexIJ[9]=1.0;float xOffset=deltX*scaleShadow;float yOffset=deltY*scaleShadow;for(int i=0;i<5;i++){vec2 Offsets=vec2(indexIJ[2*i]*xOffset,indexIJ[2*i+1]*yOffset);vec2 UVC=vec2(texPos+Offsets);vec4 rgbaDepth=texture2D(depthSampler,UVC);float Depth=unpackDepth(rgbaDepth);if(Depth+EPSILON>z){Factor+=1.0;}}Factor=Factor*0.2;return Factor;}}",fn_isBackOfEarth:"#define GLSLIFY 1\nbool isBackOfEarth(vec3 spacePos,vec3 camPos,float tangentAngle){float val=dot(normalize(spacePos),normalize(camPos));float angle=acos(val);return angle>tangentAngle;}",fn_pixelInVideo:"#define GLSLIFY 1\nfloat EPSILON4=0.0001;bool pixelInVideo(mat4 videoMatrix,vec3 cameraPosition,mat4 modelMatrix,vec4 posOrigin,sampler2D videoSampler,float videoAlpha,mat4 clipMatrix,sampler2D maskSample,vec2 textureSize,bool activeClipVideoTexture,vec3 polygonColor){modelMatrix[3]=modelMatrix[3]-vec4(cameraPosition,0.);vec4 VideoProjectPostion=videoMatrix*modelMatrix*posOrigin;vec4 clipProjectPostion=clipMatrix*modelMatrix*posOrigin;VideoProjectPostion=VideoProjectPostion/VideoProjectPostion.w;clipProjectPostion=clipProjectPostion/clipProjectPostion.w;vec2 UV=VideoProjectPostion.xy*0.5+0.5;vec2 clipUV=clipProjectPostion.xy*0.5+0.5;UV.y=1.0-UV.y;bool isGap=false;if(UV.x>=0.0&&UV.x<=1.0&&UV.y>=0.0&&UV.y<=1.0){if(activeClipVideoTexture){vec2 offsetXY=vec2(1./textureSize.x,1./textureSize.y);vec4 c_Color=texture2D(maskSample,clipUV);vec4 c_Color1=texture2D(maskSample,clipUV+vec2(-offsetXY.x,0.0));vec4 c_Color2=texture2D(maskSample,clipUV+vec2(offsetXY.x,0.0));vec4 c_Color3=texture2D(maskSample,clipUV+vec2(0.0,-offsetXY.y));vec4 c_Color4=texture2D(maskSample,clipUV+vec2(0.0,offsetXY.y));vec4 avgZ=(c_Color+c_Color1+c_Color2+c_Color3+c_Color4)/5.0;bool isInPolygon=false;if(abs(avgZ.x-polygonColor.x)<EPSILON4&&abs(avgZ.y-polygonColor.y)<EPSILON4&&abs(avgZ.z-polygonColor.z)<EPSILON4){isInPolygon=true;}else if(abs(c_Color.x-polygonColor.x)<EPSILON4&&abs(c_Color.y-polygonColor.y)<EPSILON4&&abs(c_Color.z-polygonColor.z)<EPSILON4){isInPolygon=true;}if(isInPolygon){vec4 videoColor=texture2D(videoSampler,UV);gl_FragColor=mix(gl_FragColor.rgba,videoColor,videoAlpha);return true;}else{return false;}}else{vec4 videoColor=texture2D(videoSampler,UV);gl_FragColor=mix(gl_FragColor.rgba,videoColor,videoAlpha);return true;}}return false;}",fn_nvidia_fxaa:"#define GLSLIFY 1\n#if (M_FXAA_QUALITY_PRESET == 10)\n#define FXAA_QUALITY_PS 3\n#define FXAA_QUALITY_P0 1.5\n#define FXAA_QUALITY_P1 3.0\n#define FXAA_QUALITY_P2 12.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 11)\n#define FXAA_QUALITY_PS 4\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 3.0\n#define FXAA_QUALITY_P3 12.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 12)\n#define FXAA_QUALITY_PS 5\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 4.0\n#define FXAA_QUALITY_P4 12.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 13)\n#define FXAA_QUALITY_PS 6\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 4.0\n#define FXAA_QUALITY_P5 12.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 14)\n#define FXAA_QUALITY_PS 7\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 4.0\n#define FXAA_QUALITY_P6 12.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 15)\n#define FXAA_QUALITY_PS 8\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 4.0\n#define FXAA_QUALITY_P7 12.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 20)\n#define FXAA_QUALITY_PS 3\n#define FXAA_QUALITY_P0 1.5\n#define FXAA_QUALITY_P1 2.0\n#define FXAA_QUALITY_P2 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 21)\n#define FXAA_QUALITY_PS 4\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 22)\n#define FXAA_QUALITY_PS 5\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 23)\n#define FXAA_QUALITY_PS 6\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 24)\n#define FXAA_QUALITY_PS 7\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 3.0\n#define FXAA_QUALITY_P6 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 25)\n#define FXAA_QUALITY_PS 8\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 4.0\n#define FXAA_QUALITY_P7 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 26)\n#define FXAA_QUALITY_PS 9\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 4.0\n#define FXAA_QUALITY_P8 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 27)\n#define FXAA_QUALITY_PS 10\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 4.0\n#define FXAA_QUALITY_P9 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 28)\n#define FXAA_QUALITY_PS 11\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 4.0\n#define FXAA_QUALITY_P10 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 29)\n#define FXAA_QUALITY_PS 12\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 2.0\n#define FXAA_QUALITY_P10 4.0\n#define FXAA_QUALITY_P11 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 39)\n#define FXAA_QUALITY_PS 12\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.0\n#define FXAA_QUALITY_P2 1.0\n#define FXAA_QUALITY_P3 1.0\n#define FXAA_QUALITY_P4 1.0\n#define FXAA_QUALITY_P5 1.5\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 2.0\n#define FXAA_QUALITY_P10 4.0\n#define FXAA_QUALITY_P11 8.0\n#endif\n#define FxaaBool bool\n#define FxaaFloat float\n#define FxaaFloat2 vec2\n#define FxaaFloat3 vec3\n#define FxaaFloat4 vec4\n#define FxaaHalf float\n#define FxaaHalf2 vec2\n#define FxaaHalf3 vec3\n#define FxaaHalf4 vec4\n#define FxaaInt2 vec2\n#define FxaaTex sampler2D\n#define FxaaSat(x) clamp(x, 0.0, 1.0)\n#define FxaaTexTop(t, p) texture2D(t, p)\n#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r))\nFxaaFloat FxaaLuma(FxaaFloat4 rgba){return rgba.y;}FxaaFloat4 FxaaPixelShader(FxaaFloat2 pos,FxaaTex tex,FxaaFloat2 fxaaQualityRcpFrame,FxaaFloat fxaaQualitySubpix,FxaaFloat fxaaQualityEdgeThreshold,FxaaFloat fxaaQualityEdgeThresholdMin){FxaaFloat2 posM;posM.x=pos.x;posM.y=pos.y;FxaaFloat4 rgbyM=FxaaTexTop(tex,posM);\n#define lumaM rgbyM.y\nFxaaFloat lumaS=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(0,1),fxaaQualityRcpFrame.xy));FxaaFloat lumaE=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(1,0),fxaaQualityRcpFrame.xy));FxaaFloat lumaN=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(0,-1),fxaaQualityRcpFrame.xy));FxaaFloat lumaW=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(-1,0),fxaaQualityRcpFrame.xy));FxaaFloat maxSM=max(lumaS,lumaM);FxaaFloat minSM=min(lumaS,lumaM);FxaaFloat maxESM=max(lumaE,maxSM);FxaaFloat minESM=min(lumaE,minSM);FxaaFloat maxWN=max(lumaN,lumaW);FxaaFloat minWN=min(lumaN,lumaW);FxaaFloat rangeMax=max(maxWN,maxESM);FxaaFloat rangeMin=min(minWN,minESM);FxaaFloat rangeMaxScaled=rangeMax*fxaaQualityEdgeThreshold;FxaaFloat range=rangeMax-rangeMin;FxaaFloat rangeMaxClamped=max(fxaaQualityEdgeThresholdMin,rangeMaxScaled);FxaaBool earlyExit=range<rangeMaxClamped;if(earlyExit)return rgbyM;FxaaFloat lumaNW=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(-1,-1),fxaaQualityRcpFrame.xy));FxaaFloat lumaSE=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(1,1),fxaaQualityRcpFrame.xy));FxaaFloat lumaNE=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(1,-1),fxaaQualityRcpFrame.xy));FxaaFloat lumaSW=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(-1,1),fxaaQualityRcpFrame.xy));FxaaFloat lumaNS=lumaN+lumaS;FxaaFloat lumaWE=lumaW+lumaE;FxaaFloat subpixRcpRange=1.0/range;FxaaFloat subpixNSWE=lumaNS+lumaWE;FxaaFloat edgeHorz1=(-2.0*lumaM)+lumaNS;FxaaFloat edgeVert1=(-2.0*lumaM)+lumaWE;FxaaFloat lumaNESE=lumaNE+lumaSE;FxaaFloat lumaNWNE=lumaNW+lumaNE;FxaaFloat edgeHorz2=(-2.0*lumaE)+lumaNESE;FxaaFloat edgeVert2=(-2.0*lumaN)+lumaNWNE;FxaaFloat lumaNWSW=lumaNW+lumaSW;FxaaFloat lumaSWSE=lumaSW+lumaSE;FxaaFloat edgeHorz4=(abs(edgeHorz1)*2.0)+abs(edgeHorz2);FxaaFloat edgeVert4=(abs(edgeVert1)*2.0)+abs(edgeVert2);FxaaFloat edgeHorz3=(-2.0*lumaW)+lumaNWSW;FxaaFloat edgeVert3=(-2.0*lumaS)+lumaSWSE;FxaaFloat edgeHorz=abs(edgeHorz3)+edgeHorz4;FxaaFloat edgeVert=abs(edgeVert3)+edgeVert4;FxaaFloat subpixNWSWNESE=lumaNWSW+lumaNESE;FxaaFloat lengthSign=fxaaQualityRcpFrame.x;FxaaBool horzSpan=edgeHorz>=edgeVert;FxaaFloat subpixA=subpixNSWE*2.0+subpixNWSWNESE;if(!horzSpan)lumaN=lumaW;if(!horzSpan)lumaS=lumaE;if(horzSpan)lengthSign=fxaaQualityRcpFrame.y;FxaaFloat subpixB=(subpixA*(1.0/12.0))-lumaM;FxaaFloat gradientN=lumaN-lumaM;FxaaFloat gradientS=lumaS-lumaM;FxaaFloat lumaNN=lumaN+lumaM;FxaaFloat lumaSS=lumaS+lumaM;FxaaBool pairN=abs(gradientN)>=abs(gradientS);FxaaFloat gradient=max(abs(gradientN),abs(gradientS));if(pairN)lengthSign=-lengthSign;FxaaFloat subpixC=FxaaSat(abs(subpixB)*subpixRcpRange);FxaaFloat2 posB;posB.x=posM.x;posB.y=posM.y;FxaaFloat2 offNP;offNP.x=(!horzSpan)? 0.0 : fxaaQualityRcpFrame.x;offNP.y=(horzSpan)? 0.0 : fxaaQualityRcpFrame.y;if(!horzSpan)posB.x+=lengthSign*0.5;if(horzSpan)posB.y+=lengthSign*0.5;FxaaFloat2 posN;posN.x=posB.x-offNP.x*FXAA_QUALITY_P0;posN.y=posB.y-offNP.y*FXAA_QUALITY_P0;FxaaFloat2 posP;posP.x=posB.x+offNP.x*FXAA_QUALITY_P0;posP.y=posB.y+offNP.y*FXAA_QUALITY_P0;FxaaFloat subpixD=((-2.0)*subpixC)+3.0;FxaaFloat lumaEndN=FxaaLuma(FxaaTexTop(tex,posN));FxaaFloat subpixE=subpixC*subpixC;FxaaFloat lumaEndP=FxaaLuma(FxaaTexTop(tex,posP));if(!pairN)lumaNN=lumaSS;FxaaFloat gradientScaled=gradient*1.0/4.0;FxaaFloat lumaMM=lumaM-lumaNN*0.5;FxaaFloat subpixF=subpixD*subpixE;FxaaBool lumaMLTZero=lumaMM<0.0;lumaEndN-=lumaNN*0.5;lumaEndP-=lumaNN*0.5;FxaaBool doneN=abs(lumaEndN)>=gradientScaled;FxaaBool doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P1;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P1;FxaaBool doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P1;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P1;if(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P2;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P2;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P2;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P2;\n#if (FXAA_QUALITY_PS > 3)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P3;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P3;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P3;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P3;\n#if (FXAA_QUALITY_PS > 4)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P4;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P4;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P4;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P4;\n#if (FXAA_QUALITY_PS > 5)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P5;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P5;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P5;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P5;\n#if (FXAA_QUALITY_PS > 6)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P6;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P6;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P6;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P6;\n#if (FXAA_QUALITY_PS > 7)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P7;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P7;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P7;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P7;\n#if (FXAA_QUALITY_PS > 8)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P8;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P8;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P8;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P8;\n#if (FXAA_QUALITY_PS > 9)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P9;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P9;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P9;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P9;\n#if (FXAA_QUALITY_PS > 10)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P10;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P10;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P10;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P10;\n#if (FXAA_QUALITY_PS > 11)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P11;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P11;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P11;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P11;\n#if (FXAA_QUALITY_PS > 12)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P12;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P12;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P12;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P12;}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}FxaaFloat dstN=posM.x-posN.x;FxaaFloat dstP=posP.x-posM.x;if(!horzSpan)dstN=posM.y-posN.y;if(!horzSpan)dstP=posP.y-posM.y;FxaaBool goodSpanN=(lumaEndN<0.0)!=lumaMLTZero;FxaaFloat spanLength=(dstP+dstN);FxaaBool goodSpanP=(lumaEndP<0.0)!=lumaMLTZero;FxaaFloat spanLengthRcp=1.0/spanLength;FxaaBool directionN=dstN<dstP;FxaaFloat dst=min(dstN,dstP);FxaaBool goodSpan=directionN ? goodSpanN : goodSpanP;FxaaFloat subpixG=subpixF*subpixF;FxaaFloat pixelOffset=(dst*(-spanLengthRcp))+0.5;FxaaFloat subpixH=subpixG*fxaaQualitySubpix;FxaaFloat pixelOffsetGood=goodSpan ? pixelOffset : 0.0;FxaaFloat pixelOffsetSubpix=max(pixelOffsetGood,subpixH);if(!horzSpan)posM.x+=pixelOffsetSubpix*lengthSign;if(horzSpan)posM.y+=pixelOffsetSubpix*lengthSign;return FxaaFloat4(FxaaTexTop(tex,posM).xyz,lumaM);}",fn_getBlinnPhongColor:"#define GLSLIFY 1\nvec4 getBlinnPhongColor(vec3 normal,vec3 world_pos,vec3 lightPos,vec3 lightColor,vec3 camPos,vec3 Ka,vec3 Kd,vec3 Ks,vec4 texColor,float shininess){vec3 N=normalize(normal);vec3 L=normalize(lightPos);vec3 V=normalize(camPos-world_pos);vec3 H=normalize(L+V);vec3 ambient=Ka*lightColor;float dv=dot(N,L);float diffuseLight=max(dot(N,L),0.);vec3 diffuse=Kd*lightColor*diffuseLight;if(dv<0.){ambient*=(1.+dv*4.0);diffuse*=4.0;}float specularLight=pow(max(dot(H,N),0.),32.*shininess);if(diffuseLight<=0.)specularLight=0.;vec3 specular=Ks*lightColor*specularLight;vec4 color=vec4(1.0);color.xyz=texColor.xyz*(ambient+diffuse+specular);color.w=texColor.a;return color;}",fn_phong:"#define GLSLIFY 1\n#include <u_LIGHT>\n#include <v_LIGHT>\n#ifdef M_enableLight\n#ifdef M_PointLight\n#ifdef M_ShadowEnable\nfloat getDepthFromDiffPointInfo(int pointNum,vec3 direction){\n#if M_PointLightCount > 5\nif(pointNum==0){return textureCube(u_PointLightDepthCubeTexture0,direction).r;}else if(pointNum==1){return textureCube(u_PointLightDepthCubeTexture1,direction).r;}else if(pointNum==2){return textureCube(u_PointLightDepthCubeTexture2,direction).r;}else if(pointNum==3){return textureCube(u_PointLightDepthCubeTexture3,direction).r;}else if(pointNum==4){return textureCube(u_PointLightDepthCubeTexture4,direction).r;}else if(pointNum==5){return textureCube(u_PointLightDepthCubeTexture5,direction).r;}\n#endif\n#if M_PointLightCount > 4\nif(pointNum==0){return textureCube(u_PointLightDepthCubeTexture0,direction).r;}else if(pointNum==1){return textureCube(u_PointLightDepthCubeTexture1,direction).r;}else if(pointNum==2){return textureCube(u_PointLightDepthCubeTexture2,direction).r;}else if(pointNum==3){return textureCube(u_PointLightDepthCubeTexture3,direction).r;}else if(pointNum==4){return textureCube(u_PointLightDepthCubeTexture4,direction).r;}\n#endif\n#if M_PointLightCount > 3\nif(pointNum==0){return textureCube(u_PointLightDepthCubeTexture0,direction).r;}else if(pointNum==1){return textureCube(u_PointLightDepthCubeTexture1,direction).r;}else if(pointNum==2){return textureCube(u_PointLightDepthCubeTexture2,direction).r;}else if(pointNum==3){return textureCube(u_PointLightDepthCubeTexture3,direction).r;}\n#endif\n#if M_PointLightCount > 2\nif(pointNum==0){return textureCube(u_PointLightDepthCubeTexture0,direction).r;}else if(pointNum==1){return textureCube(u_PointLightDepthCubeTexture1,direction).r;}else if(pointNum==2){return textureCube(u_PointLightDepthCubeTexture2,direction).r;}\n#endif\n#if M_PointLightCount > 1\nif(pointNum==0){return textureCube(u_PointLightDepthCubeTexture0,direction).r;}else if(pointNum==1){return textureCube(u_PointLightDepthCubeTexture1,direction).r;}\n#endif\nreturn textureCube(u_PointLightDepthCubeTexture0,direction).r;}\n#endif\n#endif\n#endif\nvec3 phong(vec3 pos,vec3 tnormal,LightMaterial lightMaterial,vec3 lightDirection,vec3 cameraPosition){vec3 ambient=lightMaterial.Ambient;vec3 norm=normalize(tnormal);vec3 lightDir=normalize(lightDirection);float diff=max(dot(norm,lightDir),0.0);vec3 diffuse=lightMaterial.Diffuse*diff;vec3 viewDir=normalize(cameraPosition-pos);vec3 reflectDir=reflect(-lightDir,norm);float spec=pow(max(dot(viewDir,reflectDir),0.0),lightMaterial.Shininess);vec3 specular=lightMaterial.SpecularColor*spec;vec3 fColor=ambient+diffuse+specular;return fColor;}vec3 phong(float reflectivity,vec3 normal,vec3 sunLightGlobal,vec3 worldPosition,float shininess){vec3 ambient=vec3(0.0,0.0,0.0);vec3 diffuse=vec3(0.0,0.0,0.0);vec3 specular=vec3(0.0,0.0,.0);\n#ifdef M_enableLight\n#ifdef M_AmbientLight\nfor(int i=0;i<int(M_AmbientLightCount);++i){vec3 ambientColor=vec3(u_AmbientLightsColor[i*3],u_AmbientLightsColor[i*3+1],u_AmbientLightsColor[i*3+2]);float ambientIntensity=u_AmbientLightsIntensity[i];ambient=ambient+ambientIntensity*reflectivity*ambientColor;}\n#endif\n#ifdef M_SunLight\nif(u_SunLightDirectionLocal.z>0.0){diffuse=diffuse+reflectivity*max(dot(normal,sunLightGlobal),0.)*u_SunLightColor*u_SunLightIntensity;}\n#endif\n#ifdef M_SunLight\nvec3 H=normalize(sunLightGlobal+normalize(u_CameraPosition-worldPosition));specular=specular+reflectivity*pow(max(dot(H,normal),0.),shininess)*u_SunLightColor*u_SunLightIntensity;\n#endif\n#ifdef M_DirectionalLight\nfor(int i=0;i<int(M_DirectionalLightCount);++i){vec3 directLightColor=vec3(u_DirectionalLightColor[i*3],u_DirectionalLightColor[i*3+1],u_DirectionalLightColor[i*3+2]);float directLightIntensity=u_DirectionalLightIntensity[i];vec3 directLightDir=vec3(u_DirectionalLightDir[i*3],u_DirectionalLightDir[i*3+1],u_DirectionalLightDir[i*3+2]);diffuse=diffuse+reflectivity*max(dot(normal,directLightDir),0.)*directLightColor*directLightIntensity;vec3 H=normalize(directLightDir+normalize(u_CameraPosition-worldPosition));specular=specular+reflectivity*pow(max(dot(H,normal),0.),shininess)*directLightColor*directLightIntensity;}\n#endif\n#ifdef M_PointLight\nfor(int i=0;i<int(M_PointLightCount);i++){float pointShadow=1.0;vec3 pointLightPosition=vec3(u_PointLightPosition[i*3],u_PointLightPosition[i*3+1],u_PointLightPosition[i*3+2]);float dis=distance(pointLightPosition,worldPosition);float pointLightIntensity=u_PointLightIntensity[i];float pointFragIntensity=pointLightIntensity*1000.0/(dis*dis);if(pointFragIntensity<0.1){continue;}\n#ifdef M_ShadowEnable\nif(i>5){pointShadow=1.0;}else{\n#ifdef M_ShadowMapping\nfloat depth=getDepthFromDiffPointInfo(i,normalize(v_PointDirection[i]));vec3 light=vec3(u_PointLightPosition[i*3],u_PointLightPosition[i*3+1],u_PointLightPosition[i*3+2]);if((dis/u_PointLightFar[i])-u_PointLightEpsilon[i]>depth){pointShadow=0.3;}\n#else\n#ifdef M_PCF\nfloat shadow=0.0;float diskRadius=u_DiskRadius[i];vec3 sampleOffsetDirections[20];sampleOffsetDirections[0]=vec3(1,1,1);sampleOffsetDirections[1]=vec3(1,-1,1);sampleOffsetDirections[2]=vec3(-1,-1,1);sampleOffsetDirections[3]=vec3(-1,1,1);sampleOffsetDirections[4]=vec3(1,1,-1);sampleOffsetDirections[5]=vec3(1,-1,-1);sampleOffsetDirections[6]=vec3(-1,-1,-1);sampleOffsetDirections[7]=vec3(-1,1,-1);sampleOffsetDirections[8]=vec3(1,1,0);sampleOffsetDirections[9]=vec3(1,-1,0);sampleOffsetDirections[10]=vec3(-1,-1,0);sampleOffsetDirections[11]=vec3(-1,1,0);sampleOffsetDirections[12]=vec3(1,0,1);sampleOffsetDirections[13]=vec3(-1,0,1);sampleOffsetDirections[14]=vec3(1,0,-1);sampleOffsetDirections[15]=vec3(-1,0,-1);sampleOffsetDirections[16]=vec3(0,1,1);sampleOffsetDirections[17]=vec3(0,-1,1);sampleOffsetDirections[18]=vec3(0,-1,-1);sampleOffsetDirections[19]=vec3(0,1,-1);for(int j=0;j<20;j++){vec3 pointDirection=normalize(v_PointDirection[i])+sampleOffsetDirections[j]*diskRadius;float depth=getDepthFromDiffPointInfo(i,pointDirection);vec3 light=vec3(u_PointLightPosition[i*3],u_PointLightPosition[i*3+1],u_PointLightPosition[i*3+2]);if((dis/u_PointLightFar[i])-u_PointLightEpsilon[i]>depth){shadow=shadow+1.0;}}pointShadow=1.0-0.7*shadow/20.0;\n#endif\n#endif\n}\n#endif\nvec3 pointLightColor=vec3(u_PointLightColor[i*3],u_PointLightColor[i*3+1],u_PointLightColor[i*3+2]);vec3 pointLightDir=normalize(pointLightPosition-worldPosition);diffuse=diffuse+reflectivity*max(dot(normal,pointLightDir),0.)*pointLightColor*pointFragIntensity*pointShadow;vec3 H=normalize(pointLightDir+normalize(u_CameraPosition-worldPosition));specular=specular+reflectivity*pow(max(dot(H,normal),0.),shininess)*pointLightColor*pointFragIntensity*pointShadow;}\n#endif\n#endif\nreturn ambient+diffuse+specular;}vec3 phong(float reflectivity,vec3 normal,vec3 sunLightGlobal,vec3 worldPosition,float shininess,float roughness){vec3 ambient=vec3(0.0,0.0,0.0);vec3 diffuse=vec3(0.0,0.0,0.0);vec3 specular=vec3(0.0,0.0,.0);\n#ifdef M_enableLight\n#ifdef M_AmbientLight\nfor(int i=0;i<int(M_AmbientLightCount);++i){vec3 ambientColor=vec3(u_AmbientLightsColor[i*3],u_AmbientLightsColor[i*3+1],u_AmbientLightsColor[i*3+2]);float ambientIntensity=u_AmbientLightsIntensity[i];ambient=ambient+ambientIntensity*reflectivity*ambientColor;}\n#endif\n#ifdef M_SunLight\nif(u_SunLightDirectionLocal.z>0.0){diffuse=diffuse+reflectivity*max(dot(normal,sunLightGlobal),0.)*u_SunLightColor*u_SunLightIntensity;diffuse=(1.0-roughness)*diffuse;}\n#endif\n#ifdef M_SunLight\nvec3 H=normalize(sunLightGlobal+normalize(u_CameraPosition-worldPosition));specular=specular+reflectivity*pow(max(dot(H,normal),0.),shininess)*u_SunLightColor*u_SunLightIntensity;specular=0.16*reflectivity*reflectivity*roughness+specular*(1.0-roughness);\n#endif\n#ifdef M_DirectionalLight\nfor(int i=0;i<int(M_DirectionalLightCount);++i){vec3 directLightColor=vec3(u_DirectionalLightColor[i*3],u_DirectionalLightColor[i*3+1],u_DirectionalLightColor[i*3+2]);float directLightIntensity=u_DirectionalLightIntensity[i];vec3 directLightDir=vec3(u_DirectionalLightDir[i*3],u_DirectionalLightDir[i*3+1],u_DirectionalLightDir[i*3+2]);diffuse=diffuse+reflectivity*max(dot(normal,directLightDir),0.)*directLightColor*directLightIntensity;diffuse=(1.0-roughness)*diffuse;vec3 H=normalize(directLightDir+normalize(u_CameraPosition-worldPosition));specular=specular+reflectivity*pow(max(dot(H,normal),0.),shininess)*directLightColor*directLightIntensity;specular=0.16*reflectivity*reflectivity*roughness+specular*(1.0-roughness);}\n#endif\n#ifdef M_PointLight\nfor(int i=0;i<int(M_PointLightCount);i++){float pointShadow=1.0;vec3 pointLightPosition=vec3(u_PointLightPosition[i*3],u_PointLightPosition[i*3+1],u_PointLightPosition[i*3+2]);float dis=distance(pointLightPosition,worldPosition);float pointLightIntensity=u_PointLightIntensity[i];float pointFragIntensity=pointLightIntensity*1000.0/(dis*dis);if(pointFragIntensity<0.1){continue;}\n#ifdef M_ShadowEnable\nif(i>5){pointShadow=1.0;}else{\n#ifdef M_ShadowMapping\nfloat depth=getDepthFromDiffPointInfo(i,normalize(v_PointDirection[i]));vec3 light=vec3(u_PointLightPosition[i*3],u_PointLightPosition[i*3+1],u_PointLightPosition[i*3+2]);if((dis/u_PointLightFar[i])-u_PointLightEpsilon[i]>depth){pointShadow=0.3;}\n#else\n#ifdef M_PCF\nfloat shadow=0.0;float diskRadius=u_DiskRadius[i];vec3 sampleOffsetDirections[20];sampleOffsetDirections[0]=vec3(1,1,1);sampleOffsetDirections[1]=vec3(1,-1,1);sampleOffsetDirections[2]=vec3(-1,-1,1);sampleOffsetDirections[3]=vec3(-1,1,1);sampleOffsetDirections[4]=vec3(1,1,-1);sampleOffsetDirections[5]=vec3(1,-1,-1);sampleOffsetDirections[6]=vec3(-1,-1,-1);sampleOffsetDirections[7]=vec3(-1,1,-1);sampleOffsetDirections[8]=vec3(1,1,0);sampleOffsetDirections[9]=vec3(1,-1,0);sampleOffsetDirections[10]=vec3(-1,-1,0);sampleOffsetDirections[11]=vec3(-1,1,0);sampleOffsetDirections[12]=vec3(1,0,1);sampleOffsetDirections[13]=vec3(-1,0,1);sampleOffsetDirections[14]=vec3(1,0,-1);sampleOffsetDirections[15]=vec3(-1,0,-1);sampleOffsetDirections[16]=vec3(0,1,1);sampleOffsetDirections[17]=vec3(0,-1,1);sampleOffsetDirections[18]=vec3(0,-1,-1);sampleOffsetDirections[19]=vec3(0,1,-1);for(int j=0;j<20;j++){vec3 pointDirection=normalize(v_PointDirection[i])+sampleOffsetDirections[j]*diskRadius;float depth=getDepthFromDiffPointInfo(i,pointDirection);vec3 light=vec3(u_PointLightPosition[i*3],u_PointLightPosition[i*3+1],u_PointLightPosition[i*3+2]);if((dis/u_PointLightFar[i])-u_PointLightEpsilon[i]>depth){shadow=shadow+1.0;}}pointShadow=1.0-0.7*shadow/20.0;\n#endif\n#endif\n}\n#endif\nvec3 pointLightColor=vec3(u_PointLightColor[i*3],u_PointLightColor[i*3+1],u_PointLightColor[i*3+2]);vec3 pointLightDir=normalize(pointLightPosition-worldPosition);diffuse=diffuse+reflectivity*max(dot(normal,pointLightDir),0.)*pointLightColor*pointFragIntensity*pointShadow;diffuse=(1.0-roughness)*diffuse;vec3 H=normalize(pointLightDir+normalize(u_CameraPosition-worldPosition));specular=specular+reflectivity*pow(max(dot(H,normal),0.),shininess)*pointLightColor*pointFragIntensity*pointShadow;specular=0.16*reflectivity*reflectivity*roughness+specular*(1.0-roughness);}\n#endif\n#endif\nreturn ambient+diffuse+specular;}vec3 ambient(){vec3 ambient=vec3(0.0,0.0,0.0);\n#ifdef M_enableLight\n#ifdef M_AmbientLight\nfor(int i=0;i<int(M_AmbientLightCount);++i){vec3 ambientColor=vec3(u_AmbientLightsColor[i*3],u_AmbientLightsColor[i*3+1],u_AmbientLightsColor[i*3+2]);float ambientIntensity=u_AmbientLightsIntensity[i];ambient=ambient+ambientIntensity*1.0*ambientColor;}\n#endif\n#endif\nreturn ambient;}",fn_reverseLogDepth:"#define GLSLIFY 1\n#ifndef _REVERSE_LOG_DEPTH_\n#define _REVERSE_LOG_DEPTH_\nfloat reverseLogDepth(float logZ,vec2 currentFrustum){float near=currentFrustum.x;float far=currentFrustum.y;float farDepthFromNearPlusOne=currentFrustum.y-currentFrustum.x+1.0;float log2FarDepthFromNearPlusOne=log2(farDepthFromNearPlusOne);float log2Depth=logZ*log2FarDepthFromNearPlusOne;float depthFromNear=pow(2.0,log2Depth)-1.0;return far*(1.0-near/(depthFromNear+near))/(far-near);}float reverseLogDepth(float logZ){\n#ifdef M_LOG_DEPTH\nfloat near=czm_currentFrustum.x;float far=czm_currentFrustum.y;float log2Depth=logZ*czm_log2FarDepthFromNearPlusOne;float depthFromNear=pow(2.0,log2Depth)-1.0;return far*(1.0-near/(depthFromNear+near))/(far-near);\n#endif\nreturn logZ;}\n#endif\n",fn_RGBToHSB:"#define GLSLIFY 1\nconst vec4 K_RGB2HSB=vec4(0.0,-1.0/3.0,2.0/3.0,-1.0);vec3 RGBToHSB(vec3 rgb){vec4 p=mix(vec4(rgb.bg,K_RGB2HSB.wz),vec4(rgb.gb,K_RGB2HSB.xy),step(rgb.b,rgb.g));vec4 q=mix(vec4(p.xyw,rgb.r),vec4(rgb.r,p.yzx),step(p.x,rgb.r));float d=q.x-min(q.w,q.y);return vec3(abs(q.z+(q.w-q.y)/(6.0*d+czm_epsilon7)),d/(q.x+czm_epsilon7),q.x);}",fn_RGBToHSL:"#define GLSLIFY 1\nvec3 RGBtoHCV(vec3 rgb){vec4 p=(rgb.g<rgb.b)? vec4(rgb.bg,-1.0,2.0/3.0): vec4(rgb.gb,0.0,-1.0/3.0);vec4 q=(rgb.r<p.x)? vec4(p.xyw,rgb.r): vec4(rgb.r,p.yzx);float c=q.x-min(q.w,q.y);float h=abs((q.w-q.y)/(6.0*c+czm_epsilon7)+q.z);return vec3(h,c,q.x);}vec3 RGBToHSL(vec3 rgb){vec3 hcv=RGBtoHCV(rgb);float l=hcv.z-hcv.y*0.5;float s=hcv.y/(1.0-abs(l*2.0-1.0)+czm_epsilon7);return vec3(hcv.x,s,l);}",fn_RGBToXYZ:"#define GLSLIFY 1\nvec3 RGBToXYZ(vec3 rgb){const mat3 RGB2XYZ=mat3(0.4124,0.2126,0.0193,0.3576,0.7152,0.1192,0.1805,0.0722,0.9505);vec3 xyz=RGB2XYZ*rgb;vec3 Yxy;Yxy.r=xyz.g;float temp=dot(vec3(1.0),xyz);Yxy.gb=xyz.rg/temp;return Yxy;}",fn_vertexLogDepth:"#define GLSLIFY 1\nvec4 updatePositionDepth(vec4 coords){coords.z=clamp(coords.z/coords.w,-1.0,1.0)*coords.w;return coords;}float vertexLogDepth(vec2 currentFrustum){gl_Position=updatePositionDepth(gl_Position);float depthFromNearPlusOne=(gl_Position.w-currentFrustum.x)+1.0;return depthFromNearPlusOne;}",fn_webMercatorInTileCoordToLngLat:"#define GLSLIFY 1\n#ifndef _fn_webMercatorInTileCoordToLngLat_\n#define _fn_webMercatorInTileCoordToLngLat_\nvec2 webMercatorInTileCoordToLngLatDegree(vec2 inTileCoord,vec3 tileCoordXYZ){vec2 coord=vec2(inTileCoord.x+tileCoordXYZ.x,inTileCoord.y+tileCoordXYZ.y);float worldSize=pow(2.0,tileCoordXYZ.z);float lng=(coord.x*360.0)/worldSize-180.0;float y2=180.-(coord.y*360.)/worldSize;float lat=(360./PI)*atan(exp((y2*PI)/180.0))-90.0;return vec2(lng,lat);}vec2 webMercatorInTileCoordToLngLatRadian(vec2 inTileCoord,vec3 tileCoordXYZ){vec2 coord=vec2(inTileCoord.x+tileCoordXYZ.x,inTileCoord.y+tileCoordXYZ.y);float worldSize=pow(2.0,tileCoordXYZ.z);float lng=(coord.x*360.0)/worldSize-180.0;float y2=180.-(coord.y*360.)/worldSize;float lat=(360./PI)*atan(exp((y2*PI)/180.0))-90.0;return vec2(lng*PI/180.0,lat*PI/180.0);}\n#endif\n",fn_writeLogDepth:"#define GLSLIFY 1\nvoid writeLogDepth(float depth,vec2 currentFrustum){float farDepthFromNearPlusOne=currentFrustum.y-currentFrustum.x+1.0;float log2FarDepthFromNearPlusOne=log2(farDepthFromNearPlusOne);float oneOverLog2FarDepthFromNearPlusOne=1.0/log2FarDepthFromNearPlusOne;if(depth<=0.9999999||depth>farDepthFromNearPlusOne){discard;}\n#ifdef M_DEPTH_EXT\ngl_FragDepthEXT=log2(depth)*oneOverLog2FarDepthFromNearPlusOne;\n#endif\n}",fn_atan2:"#define GLSLIFY 1\n#ifndef _fn_atan2_\n#define _fn_atan2_\nfloat fn_atan2(float dx,float dy){float ax=abs(dx),ay=abs(dy);float a=min(ax,ay)/(max(ax,ay)+0.00000001);float s=a*a;float r=((-0.0464964749*s+0.15931422)*s-0.327622764)*s*a+a;if(ay>ax)r=1.57079637-r;if(dx<0.)r=3.14159274-r;if(dy<0.)r=-r;return r;}\n#endif\n",fn_decodeFloat:"#define GLSLIFY 1\n#ifndef _DECODE_FLOAT_\n#define _DECODE_FLOAT_\nfloat unpackDepth(const in vec4 rgbaDepth){const vec4 bitShift=vec4(1.0,1./255.0,1./65025.0,1./16581375.0);float depth=dot(rgbaDepth,bitShift);return depth;}\n#endif\n",fn_encodeFloat:"#define GLSLIFY 1\n#ifndef _ENCODE_FLOAT_\n#define _ENCODE_FLOAT_\nvec4 encodeFloat(float depth){vec4 enc=vec4(1.0,255.0,65025.0,16581375.0)*depth;enc=fract(enc);enc-=enc.yzww*vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);return enc;}\n#endif\n",fn_transformCartesianToGeographic:"#define GLSLIFY 1\n#ifndef _fn_transformCartesianToGeographic_\n#define _fn_transformCartesianToGeographic_\nconst float a=6378137.0;const float b=6356752.3142;const float f=(a-b)/a;const float e_sq=2.0*f-f*f;vec3 transformCartesianToGeographicDegree(vec3 cartesianCoords){float x=cartesianCoords.x;float y=cartesianCoords.y;float z=cartesianCoords.z;float lon=atan(y,x);float p=sqrt(x*x+y*y);float lat=atan(z/(p*(1.0-e_sq)));float sinLat=sin(lat);float N=a/sqrt(1.0-e_sq*sinLat*sinLat);float alt=(p/cos(lat))-N;return vec3(degrees(lon),degrees(lat),alt);}vec3 transformCartesianToGeographicRadian(vec3 cartesianCoords){float x=cartesianCoords.x;float y=cartesianCoords.y;float z=cartesianCoords.z;float lon=atan(y,x);float p=sqrt(x*x+y*y);float lat=atan(z/(p*(1.0-e_sq)));float sinLat=sin(lat);float N=a/sqrt(1.0-e_sq*sinLat*sinLat);float alt=(p/cos(lat))-N;return vec3(lon,lat,alt);}\n#endif\n",fn_transformGeographicToCartesian:"#define GLSLIFY 1\n#ifndef _fn_transformGeographicToCartesian_\n#define _fn_transformGeographicToCartesian_\nvec3 transformGeographicInDegreeToCartesian(vec3 cartographic){float longitude=cartographic.x;float latitude=cartographic.y;float height=cartographic.z;const float semiMajorAxis=6378137.0;const float flattening=1.0/298.257223563;float cosLatitude=cos(radians(latitude));float sinLatitude=sin(radians(latitude));float cosLongitude=cos(radians(longitude));float sinLongitude=sin(radians(longitude));float C=1.0/sqrt(cosLatitude*cosLatitude+(1.0-flattening)*(1.0-flattening)*sinLatitude*sinLatitude);float S=C*(1.0-flattening)*(1.0-flattening);float x=(semiMajorAxis*C+height)*cosLatitude*cosLongitude;float y=(semiMajorAxis*C+height)*cosLatitude*sinLongitude;float z=(semiMajorAxis*S+height)*sinLatitude;return vec3(x,y,z);}vec3 transformGeographicInRadianToCartesian(vec3 cartographic){float longitude=cartographic.x;float latitude=cartographic.y;float height=cartographic.z;const float semiMajorAxis=6378137.0;const float flattening=1.0/298.257223563;float cosLatitude=cos(latitude);float sinLatitude=sin(latitude);float cosLongitude=cos(longitude);float sinLongitude=sin(longitude);float C=1.0/sqrt(cosLatitude*cosLatitude+(1.0-flattening)*(1.0-flattening)*sinLatitude*sinLatitude);float S=C*(1.0-flattening)*(1.0-flattening);float x=(semiMajorAxis*C+height)*cosLatitude*cosLongitude;float y=(semiMajorAxis*C+height)*cosLatitude*sinLongitude;float z=(semiMajorAxis*S+height)*sinLatitude;return vec3(x,y,z);}\n#endif\n",fn_lngLatProjectionInTileCoordToLngLat:"#define GLSLIFY 1\n#ifndef _fn_lngLatProjectionInTileCoordToLngLat_\n#define _fn_lngLatProjectionInTileCoordToLngLat_\nvec2 lngLatProjectionInTileCoordToLngLatDegree(vec2 inTileCoord,vec3 tileCoordXYZ){vec2 coord=vec2(inTileCoord.x+tileCoordXYZ.x,inTileCoord.y+tileCoordXYZ.y);float worldSize=pow(2.0,tileCoordXYZ.z);float lng=(coord.x*360.0)/worldSize-180.0;float lat=90.0-(coord.y/(0.5*worldSize))*180.0;return vec2(lng,lat);}vec2 lngLatProjectionInTileCoordToLngLatRadian(vec2 inTileCoord,vec3 tileCoordXYZ){vec2 coord=vec2(inTileCoord.x+tileCoordXYZ.x,inTileCoord.y+tileCoordXYZ.y);float worldSize=pow(2.0,tileCoordXYZ.z);float lng=(coord.x*360.0)/worldSize-180.0;float lat=90.0-(coord.y/(0.5*worldSize))*180.0;return vec2(lng*PI/180.0,lat*PI/180.0);}\n#endif\n",fn_lngLatToWebMercatorInTileCoord:"#define GLSLIFY 1\n#ifndef _fn_lngLatToWebMercatorInTileCoord_\n#define _fn_lngLatToWebMercatorInTileCoord_\nvec2 lngLatDegreeToWebMercatorTileCoord(vec2 lngLat,vec3 tileCoordXYZ){float worldSize=pow(2.0,tileCoordXYZ[2]);float x=(180.0+lngLat.x)*worldSize/360.0;float y=180.0/PI*log(tan(PI/4.0+lngLat.y*PI/360.0));y=(180.-y)*worldSize/360.0;return vec2(x-tileCoordXYZ[0],y-tileCoordXYZ[1]);}vec2 lngLatRadianToWebMercatorTileCoord(vec2 lngLat,vec3 tileCoordXYZ){float worldSize=pow(2.0,tileCoordXYZ[2]);float x=(180.0+lngLat.x/PI*180.0)*worldSize/360.0;float y=180.0/PI*log(tan(PI/4.0+lngLat.y));y=(180.-y)*worldSize/360.0;return vec2(x-tileCoordXYZ[0],y-tileCoordXYZ[1]);}\n#endif\n",fn_lngLatToLngLatProjectionInTileCoord:"#define GLSLIFY 1\n#ifndef _fn_lngLatToLngLatProjectionInTileCoord_\n#define _fn_lngLatToLngLatProjectionInTileCoord_\nvec2 lngLatInDegreeToLngLatProjectionInTileCoord(vec2 lngLat,vec3 tileCoordXYZ){float worldSize=pow(2.0,tileCoordXYZ[2]);float x=(180.0+lngLat.x)*worldSize/360.0;float y=(90.0-lngLat.y)/180.0*worldSize*0.5;return vec2(x-tileCoordXYZ[0],y-tileCoordXYZ[1]);}vec2 lngLatInRadianToLngLatProjectionInTileCoord(vec2 lngLat,vec3 tileCoordXYZ){float worldSize=pow(2.0,tileCoordXYZ[2]);float x=(180.0+lngLat.x*180.0/PI)*worldSize/360.0;float y=(90.0-lngLat.y*180.0/PI)/180.0*worldSize*0.5;return vec2(x-tileCoordXYZ[0],y-tileCoordXYZ[1]);}\n#endif\n",fn_luminance:"#define GLSLIFY 1\nfloat luminance(vec3 rgb){const vec3 W=vec3(0.2125,0.7154,0.0721);return dot(rgb,W);}",fn_createRotateMat4:"#define GLSLIFY 1\nmat4 createRotateMat4(float rad,vec3 axis){float x=axis[0],y=axis[1],z=axis[2];float len=sqrt(x*x+y*y+z*z);float s,c,t;float a00,a01,a02,a03;float a10,a11,a12,a13;float a20,a21,a22,a23;float b00,b01,b02;float b10,b11,b12;float b20,b21,b22;if(len<0.00000001){return mat4(0.);};len=1./len;x*=len;y*=len;z*=len;s=sin(rad);c=cos(rad);t=1.-c;a00=1.;a01=0.;a02=0.;a03=0.;a10=0.;a11=1.;a12=0.;a13=0.;a20=0.;a21=0.;a22=1.;a23=0.;b00=x*x*t+c;b01=y*x*t+z*s;b02=z*x*t-y*s;b10=x*y*t-z*s;b11=y*y*t+c;b12=z*y*t+x*s;b20=x*z*t+y*s;b21=y*z*t-x*s;b22=z*z*t+c;mat4 outd=mat4(0.);outd[0][0]=a00*b00+a10*b01+a20*b02;outd[0][1]=a01*b00+a11*b01+a21*b02;outd[0][2]=a02*b00+a12*b01+a22*b02;outd[0][3]=a03*b00+a13*b01+a23*b02;outd[1][0]=a00*b10+a10*b11+a20*b12;outd[1][1]=a01*b10+a11*b11+a21*b12;outd[1][2]=a02*b10+a12*b11+a22*b12;outd[1][3]=a03*b10+a13*b11+a23*b12;outd[2][0]=a00*b20+a10*b21+a20*b22;outd[2][1]=a01*b20+a11*b21+a21*b22;outd[2][2]=a02*b20+a12*b21+a22*b22;outd[2][3]=a03*b20+a13*b21+a23*b22;outd[3][0]=0.;outd[3][1]=0.;outd[3][2]=0.;outd[3][3]=1.;return outd;}",fn_acesTonemapping:"#define GLSLIFY 1\n#ifndef _AES_TONE_MAPPTING_\n#define _AES_TONE_MAPPTING_\nvec3 acesTonemapping(vec3 color){float g=0.985;float a=0.065;float b=0.0001;float c=0.433;float d=0.238;color=(color*(color+a)-b)/(color*(g*color+c)+d);color=clamp(color,0.0,1.0);return color;}\n#endif\n",fn_getPatternPos:"#define GLSLIFY 1\nvec2 getPatternPos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos){vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return(tile_units_to_pixels*pos+offset)/pattern_size;}",fn_getVectorPointVisibilityValue:"#define GLSLIFY 1\n#ifndef __fn_getVectorPointVisibilityValue__\n#define __fn_getVectorPointVisibilityValue__\n#include <fn_rayEllipsoidIntersectionInterval>\nfloat getVectorPointVisibilityValue(vec3 position,mat4 modelMatrix,vec3 cameraPosition,vec3 cameraDirection){vec4 spacePos=modelMatrix*vec4(position,1.0);vec3 rayDir=spacePos.xyz-cameraPosition;vec3 normalizedRayDir=normalize(rayDir);vec2 interval=rayEllipsoidIntersectionInterval(cameraPosition,normalizedRayDir);if(interval.x!=-infinity){float distanceToSymbol=length(rayDir);if(abs(interval.x-distanceToSymbol)>abs(interval.y-distanceToSymbol)){return-1.0;}}if(dot(normalizedRayDir,cameraDirection)<0.0){return-1.0;}return 1.0;}\n#endif\n",fn_HSBToRGB:"#define GLSLIFY 1\nconst vec4 K_HSB2RGB=vec4(1.0,2.0/3.0,1.0/3.0,3.0);vec3 HSBToRGB(vec3 hsb){vec3 p=abs(fract(hsb.xxx+K_HSB2RGB.xyz)*6.0-K_HSB2RGB.www);return hsb.z*mix(K_HSB2RGB.xxx,clamp(p-K_HSB2RGB.xxx,0.0,1.0),hsb.y);}",fn_HSLToRGB:"#define GLSLIFY 1\nvec3 hueToRGB(float hue){float r=abs(hue*6.0-3.0)-1.0;float g=2.0-abs(hue*6.0-2.0);float b=2.0-abs(hue*6.0-4.0);return clamp(vec3(r,g,b),0.0,1.0);}vec3 HSLToRGB(vec3 hsl){vec3 rgb=hueToRGB(hsl.x);float c=(1.0-abs(2.0*hsl.z-1.0))*hsl.y;return(rgb-0.5)*c+hsl.z;}",fn_inverseGamma:"#define GLSLIFY 1\nvec3 inverseGamma(vec3 color,float gamma){return pow(color,vec3(1./gamma));}",fn_unpackDepth:"#define GLSLIFY 1\n#ifndef _UNPACK_DEPTH_\n#define _UNPACK_DEPTH_\nfloat unpackDepth(vec4 packedDepth){return dot(packedDepth,vec4(1.0,1.0/255.0,1.0/65025.0,1.0/16581375.0));}\n#endif\n",fn_geometricOcculusion:"#define GLSLIFY 1\nfloat geometricOcclusion(PBRInfo pbrInputs){float NdotL=pbrInputs.NdotL;float NdotV=pbrInputs.NdotV;float r=pbrInputs.alphaRoughness;float attenuationL=2.0*NdotL/(NdotL+sqrt(r*r+(1.0-r*r)*(NdotL*NdotL)));float attenuationV=2.0*NdotV/(NdotV+sqrt(r*r+(1.0-r*r)*(NdotV*NdotV)));return attenuationL*attenuationV;}",fn_getEllipsoidNormal:"#define GLSLIFY 1\nconst float xSquaredVal=1.0/6378137.0/6378137.0;const float zSquaredVal=1.0/6356752.3142451793/6356752.3142451793;const vec3 ellipsoid_oneOverRadiiSquared=vec3(xSquaredVal,xSquaredVal,zSquaredVal);\n#include <infinity>\nvec3 getEllipsoidNormal(vec3 position){vec3 result=normalize(position*ellipsoid_oneOverRadiiSquared);return result;}",fn_getIBLContribution:"#define GLSLIFY 1\nvec3 getIBLContribution(PBRInfo pbrInputs,vec3 n,vec3 reflection,vec2 modelUV,sampler2D brdfLUT,samplerCube diffuseEnvSampler,samplerCube specularEnvSampler){float mipCount=9.0;vec3 brdf=texture2D(brdfLUT,vec2(pbrInputs.NdotV,1.0-pbrInputs.perceptualRoughness)).rgb;vec3 specularLight=textureCube(specularEnvSampler,reflection).rgb;vec3 diffuseLight=textureCube(diffuseEnvSampler,n).rgb;vec3 diffuse=diffuseLight*pbrInputs.diffuseColor;vec3 specular=specularLight*(pbrInputs.specularColor*brdf.x+brdf.y);return diffuse+specular;}",fn_getKHRCoord:"#define GLSLIFY 1\nvec2 getKHRCoord(vec2 a_coord,vec4 khrValues){vec2 coord=vec2(0.);mat3 translation=mat3(1,0,0,0,1,0,khrValues.x,khrValues.y,1);mat3 scaleKHR=mat3(khrValues.z,0,0,0,khrValues.w,0,0,0,1);mat3 matrix=translation*scaleKHR;coord=(matrix*vec3(a_coord,1)).xy;return coord;}",fn_getNormal:"#define GLSLIFY 1\nvec3 getNormal(bool hasTangent,bool hasNormal,vec2 UV,vec3 pos,vec3 normal,mat3 TBN){mat3 tbn=mat3(0.0);if(!hasTangent){vec3 pos_dx=dFdx(pos);vec3 pos_dy=dFdy(pos);vec3 tex_dx=dFdx(vec3(UV,0.0));vec3 tex_dy=dFdy(vec3(UV,0.0));vec3 t=(tex_dy.t*pos_dx-tex_dx.t*pos_dy)/(tex_dx.s*tex_dy.t-tex_dy.s*tex_dx.t);vec3 ng=vec3(0.0);if(hasNormal){ng=normalize(normal);}else{ng=cross(pos_dx,pos_dy);}t=normalize(t-ng*dot(ng,t));vec3 b=normalize(cross(ng,t));tbn=mat3(t,b,ng);}else{tbn=TBN;}vec3 n=normalize(tbn[2].xyz);return n;}vec3 getNormalFromMap(bool hasTangent,bool hasNormal,vec2 UV,vec3 pos,vec3 normal,mat3 TBN,sampler2D normalSampler){mat3 tbn=mat3(0.0);if(!hasTangent){vec3 pos_dx=dFdx(pos);vec3 pos_dy=dFdy(pos);vec3 tex_dx=dFdx(vec3(UV,0.0));vec3 tex_dy=dFdy(vec3(UV,0.0));vec3 t=(tex_dy.t*pos_dx-tex_dx.t*pos_dy)/(tex_dx.s*tex_dy.t-tex_dy.s*tex_dx.t);vec3 ng=vec3(0.0);if(hasNormal){ng=normalize(normal);}else{ng=cross(pos_dx,pos_dy);}t=normalize(t-ng*dot(ng,t));vec3 b=normalize(cross(ng,t));tbn=mat3(t,b,ng);}else{tbn=TBN;}vec3 n=vec3(0.0);n=texture2D(normalSampler,UV).rgb;n=normalize(tbn*((2.0*n-1.0)));return n;}",fn_getMetallicAndRoughness:"#define GLSLIFY 1\nconst float c_MinRoughness=0.04;\n#ifdef M_HAS_METALROUGHNESSMAP\nvec3 getMetallicAndRoughness(vec2 UV,vec2 metallicRoughnessValue,sampler2D metallicRoughnessSampler){float perceptualRoughness=metallicRoughnessValue.y;float metallic=metallicRoughnessValue.x;vec4 mrSample=texture2D(metallicRoughnessSampler,v_TexCoord);perceptualRoughness=mrSample.g*perceptualRoughness;metallic=mrSample.b*metallic;perceptualRoughness=clamp(perceptualRoughness,c_MinRoughness,1.0);metallic=clamp(metallic,0.0,1.0);float alphaRoughness=perceptualRoughness*perceptualRoughness;return vec3(metallic,perceptualRoughness,alphaRoughness);}\n#else\nvec3 getMetallicAndRoughness(vec2 UV,vec2 metallicRoughnessValue){float perceptualRoughness=metallicRoughnessValue.y;float metallic=metallicRoughnessValue.x;perceptualRoughness=clamp(perceptualRoughness,c_MinRoughness,1.0);metallic=clamp(metallic,0.0,1.0);float alphaRoughness=perceptualRoughness*perceptualRoughness;return vec3(metallic,perceptualRoughness,alphaRoughness);}\n#endif\n",fn_getAnimatedGLPosition:"#define GLSLIFY 1\nmat4 calcSkinMatrix(){mat4 skinMatrix=mat4(1.0);if(u_HasSkinning){\n#ifdef M_JOINT_MATRIX_CNT\nskinMatrix=a_WEIGHTS_0.x*u_jointMatrix[int(a_JOINTS_0.x)]+a_WEIGHTS_0.y*u_jointMatrix[int(a_JOINTS_0.y)]+a_WEIGHTS_0.z*u_jointMatrix[int(a_JOINTS_0.z)]+a_WEIGHTS_0.w*u_jointMatrix[int(a_JOINTS_0.w)];\n#endif\n}return skinMatrix;}mat3 getNormalMatrix(mat4 modelMatrix){mat3 normalMat=mat3(modelMatrix[0][0],modelMatrix[0][1],modelMatrix[0][2],modelMatrix[1][0],modelMatrix[1][1],modelMatrix[1][2],modelMatrix[2][0],modelMatrix[2][1],modelMatrix[2][2]);return normalMat;}void getAnimatedGLPosition(vec4 position,mat4 viewportOrthographic){gl_Position=viewportOrthographic*position;}\n#ifdef M_DOUBLEPRECISION\nvoid getAnimatedGLPosition(){\n#ifdef M_INSTANCE_MATRIX\ngl_Position=u_ModelViewProjectionMatrix*a_InstanceMatrix4*u_ModelMatrix*vec4(a_PositionHigh+a_PositionLow,1.0);\n#else\ngl_Position=u_ModelViewProjectionRelativeToEye*translateRelativeToEye(a_PositionHigh,a_PositionLow);\n#endif\n}\n#else\nvec3 transformed=vec3(0.0);mat4 instanceMatrix4=mat4(1.0);void getAnimatedGLPosition(){transformed=vec3(0.0);instanceMatrix4=mat4(1.0);\n#ifdef M_USE_MORPHTARGETS\ntransformed=a_POSITION_1.xyz*u_morphTargetInfluences[0];transformed+=a_POSITION_2.xyz*u_morphTargetInfluences[1];\n#ifdef M_USE_MORPHNORMALS\nvec3 transformedNormal=a_NORMAL_1.xyz*u_morphTargetInfluences[0];transformedNormal+=a_NORMAL_2.xyz*u_morphTargetInfluences[1];v_Normal=v_Normal+transformedNormal;\n#endif\n#endif\n#ifdef M_INSTANCE_MATRIX\ninstanceMatrix4=a_InstanceMatrix4*u_ModelMatrix;\n#ifndef _SHADER_IN_VERTEX_DEPTH_\n#ifdef M_HAS_NORMALS\nmat3 normalMatrix=getNormalMatrix(instanceMatrix4);v_Normal=normalize(normalMatrix*a_NORMAL);\n#ifdef M_HAS_NORMALMAP\n#ifdef M_HAS_TANGENTS\nvec3 N=v_Normal;vec3 T=normalize(normalMatrix*a_TANGENT);vec3 B=normalize(cross(N,T));v_TBN=mat3(T,B,N);\n#endif\n#endif\n#endif\n#endif\n#endif\ngl_Position=u_ModelViewProjectionMatrix*instanceMatrix4*calcSkinMatrix()*vec4(a_POSITION.xyz+transformed,1.0);}\n#endif\n",fn_microfacetDistribution:"#define GLSLIFY 1\nfloat microfacetDistribution(PBRInfo pbrInputs){float roughnessSq=pbrInputs.alphaRoughness*pbrInputs.alphaRoughness;float f=(pbrInputs.NdotH*roughnessSq-pbrInputs.NdotH)*pbrInputs.NdotH+1.0;return roughnessSq/(PI*f*f);}",fn_nearFarScalar:"#define GLSLIFY 1\nfloat nearFarScalar(vec4 nearFarScalar,float cameraDistSq){float valueAtMin=nearFarScalar.y;float valueAtMax=nearFarScalar.w;float nearDistanceSq=nearFarScalar.x*nearFarScalar.x;float farDistanceSq=nearFarScalar.z*nearFarScalar.z;float t=(cameraDistSq-nearDistanceSq)/(farDistanceSq-nearDistanceSq);t=pow(clamp(t,0.0,1.0),0.2);return mix(valueAtMin,valueAtMax,t);}",fn_pbrDiffuse:"#define GLSLIFY 1\nvec3 pbrDiffuse(PBRInfo pbrInputs){return pbrInputs.diffuseColor/PI;}",fn_packDepth:"#define GLSLIFY 1\n#ifndef _PACK_DEPTH_\n#define _PACK_DEPTH_\nvec4 packDepth(float depth){vec4 enc=vec4(1.0,255.0,65025.0,16581375.0)*depth;enc=fract(enc);enc-=enc.yzww*vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);return enc;}\n#endif\n",fn_specularReflection:"#define GLSLIFY 1\nvec3 specularReflection(PBRInfo pbrInputs){return pbrInputs.reflectance0+(pbrInputs.reflectance90-pbrInputs.reflectance0)*pow(clamp(1.0-pbrInputs.VdotH,0.0,1.0),5.0);}",fn_sRGB2Linear:"#define GLSLIFY 1\nvec4 sRGB2Linear(vec4 srgbIn){vec3 linOut=pow(srgbIn.xyz,vec3(2.2));return vec4(linOut,srgbIn.w);}",fn_getBatchTextureColor:"#define GLSLIFY 1\n#if defined(M_ONE_DIMENSION_BATCH_TEXTURE)||defined(M_TWO_DIMENSION_BATCH_TEXTURE)\nvarying vec4 batch_featureColor;void getBatchTextureColor(vec4 tile_featureColor){float sumValue=(tile_featureColor.r+tile_featureColor.g+tile_featureColor.b+tile_featureColor.a)/4.0;if(sumValue>0.01&&sumValue<0.98&&tile_featureColor.a>0.0){if(tile_featureColor.a>0.99&&length(batch_featureColor.rgb)>0.01){gl_FragColor.rgb=batch_featureColor.rgb;}else{if(tile_featureColor.a>0.0){gl_FragColor.rgb=mix(tile_featureColor.rgb,gl_FragColor.rgb,tile_featureColor.a);}}}}\n#endif\n",fn_branchFreeTernary:"#define GLSLIFY 1\nfloat branchFreeTernary(bool comparison,float a,float b){float useA=float(comparison);return a*useA+b*(1.0-useA);}vec2 branchFreeTernary(bool comparison,vec2 a,vec2 b){float useA=float(comparison);return a*useA+b*(1.0-useA);}vec3 branchFreeTernary(bool comparison,vec3 a,vec3 b){float useA=float(comparison);return a*useA+b*(1.0-useA);}vec4 branchFreeTernary(bool comparison,vec4 a,vec4 b){float useA=float(comparison);return a*useA+b*(1.0-useA);}",fn_metersPerPixel:"#define GLSLIFY 1\nfloat metersPerPixel(vec4 positionEC,float pixelRatio){float width=u_Viewport.z;float height=u_Viewport.w;float top=u_FrustumPlanes.x;float bottom=u_FrustumPlanes.y;float left=u_FrustumPlanes.z;float right=u_FrustumPlanes.w;float distanceToPixel=-positionEC.z;float inverseNear=1.0/u_CurrentFrustum.x;float tanTheta=top*inverseNear;float pixelHeight=2.0*distanceToPixel*tanTheta/height;tanTheta=right*inverseNear;float pixelWidth=2.0*distanceToPixel*tanTheta/width;return max(pixelWidth,pixelHeight)*pixelRatio;}float metersPerPixel(vec4 positionEC){return metersPerPixel(positionEC,u_PixelRatio);}",fn_octDecode:"#define GLSLIFY 1\nfloat signNotZero(float value){return value>=0.0 ? 1.0 :-1.0;}vec2 signNotZero(vec2 value){return vec2(signNotZero(value.x),signNotZero(value.y));}vec3 octDecode(vec2 encoded,float range){if(encoded.x==0.0&&encoded.y==0.0){return vec3(0.0,0.0,0.0);}encoded=encoded/range*2.0-1.0;vec3 v=vec3(encoded.x,encoded.y,1.0-abs(encoded.x)-abs(encoded.y));if(v.z<0.0){v.xy=(1.0-abs(v.yx))*signNotZero(v.xy);}return normalize(v);}vec3 octDecode(vec2 encoded){return octDecode(encoded,255.0);}vec3 octDecode(float encoded){float temp=encoded/256.0;float x=floor(temp);float y=(temp-x)*256.0;return octDecode(vec2(x,y));}void octDecode(vec2 encoded,out vec3 vector1,out vec3 vector2,out vec3 vector3){float temp=encoded.x/65536.0;float x=floor(temp);float encodedFloat1=(temp-x)*65536.0;temp=encoded.y/65536.0;float y=floor(temp);float encodedFloat2=(temp-y)*65536.0;vector1=octDecode(encodedFloat1);vector2=octDecode(encodedFloat2);vector3=octDecode(vec2(x,y));}",fn_transformPlane:"#define GLSLIFY 1\nvec4 transformPlane(vec4 plane,mat4 transform){vec4 transformedPlane=transform*plane;float normalMagnitude=length(transformedPlane.xyz);return transformedPlane/normalMagnitude;}",fn_unpackFloatVec4:"#define GLSLIFY 1\nfloat unpackFloatVec4(vec4 packedFloat){packedFloat=floor(packedFloat*255.0+0.5);float sign=1.0-step(128.0,packedFloat[3])*2.0;float exponent=2.0*mod(packedFloat[3],128.0)+step(128.0,packedFloat[2])-127.0;if(exponent==-127.0){return 0.0;}float mantissa=mod(packedFloat[2],128.0)*65536.0+packedFloat[1]*256.0+packedFloat[0]+float(0x800000);float result=sign*exp2(exponent-23.0)*mantissa;return result;}",fn_windowToEyeCoordinates:"#define GLSLIFY 1\nvec4 windowToEyeCoordinates(vec4 fragmentCoordinate){float x=2.0*(fragmentCoordinate.x-u_Viewport.x)/u_Viewport.z-1.0;float y=2.0*(fragmentCoordinate.y-u_Viewport.y)/u_Viewport.w-1.0;float z=(fragmentCoordinate.z-u_ViewportTransformation[3][2])/u_ViewportTransformation[2][2];vec4 q=vec4(x,y,z,1.0);q/=fragmentCoordinate.w;if(!(u_InverseProjection==mat4(0.0))){q=u_InverseProjection*q;}else{float top=u_FrustumPlanes.x;float bottom=u_FrustumPlanes.y;float left=u_FrustumPlanes.z;float right=u_FrustumPlanes.w;float near=u_CurrentFrustum.x;float far=u_CurrentFrustum.y;q.x=(q.x*(right-left)+left+right)*0.5;q.y=(q.y*(top-bottom)+bottom+top)*0.5;q.z=(q.z*(near-far)-near-far)*0.5;q.w=1.0;}return q;}vec4 windowToEyeCoordinates(vec2 fragmentCoordinateXY,float depthOrLogDepth){\n#ifdef LOG_DEPTH\nfloat near=u_CurrentFrustum.x;float far=u_CurrentFrustum.y;float log2Depth=depthOrLogDepth*log2FarDepthFromNearPlusOne;float depthFromNear=pow(2.0,log2Depth)-1.0;float depthFromCamera=depthFromNear+near;vec4 windowCoord=vec4(fragmentCoordinateXY,far*(1.0-near/depthFromCamera)/(far-near),1.0);vec4 eyeCoordinate=windowToEyeCoordinates(windowCoord);eyeCoordinate.w=1.0/depthFromCamera;return eyeCoordinate;\n#else\nvec4 windowCoord=vec4(fragmentCoordinateXY,depthOrLogDepth,1.0);vec4 eyeCoordinate=windowToEyeCoordinates(windowCoord);\n#endif\nreturn eyeCoordinate;}",fn_primitiveClippingPlanes:"#define GLSLIFY 1\n#include <fn_branchFreeTernary>\n#include <fn_metersPerPixel>\n#include <fn_octDecode>\n#include <fn_transformPlane>\n#include <fn_unpackFloatVec4>\n#include <fn_windowToEyeCoordinates>\n#ifdef M_USE_CLIPPING_PLANES_FLOAT_TEXTURE\nvec4 getClippingPlane(highp sampler2D packedClippingPlanes,int clippingPlaneNumber,mat4 transform){int pixY=clippingPlaneNumber/M_CLIPPING_PLANES_TEXTURE_WIDTH;int pixX=clippingPlaneNumber-(pixY*M_CLIPPING_PLANES_TEXTURE_WIDTH);float pixelWidth=1.0/float(M_CLIPPING_PLANES_TEXTURE_WIDTH);float pixelHeight=1.0/float(M_CLIPPING_PLANES_TEXTURE_HEIGHT);float u=(float(pixX)+0.5)*pixelWidth;float v=(float(pixY)+0.5)*pixelHeight;vec4 plane=texture2D(packedClippingPlanes,vec2(u,v));return transformPlane(plane,transform);}\n#else\nvec4 getClippingPlane(highp sampler2D packedClippingPlanes,int clippingPlaneNumber,mat4 transform){int clippingPlaneStartIndex=clippingPlaneNumber*2;int pixY=clippingPlaneStartIndex/M_CLIPPING_PLANES_TEXTURE_WIDTH;int pixX=clippingPlaneStartIndex-(pixY*M_CLIPPING_PLANES_TEXTURE_WIDTH);float pixelWidth=1.0/float(M_CLIPPING_PLANES_TEXTURE_WIDTH);float pixelHeight=1.0/float(M_CLIPPING_PLANES_TEXTURE_HEIGHT);float u=(float(pixX)+0.5)*pixelWidth;float v=(float(pixY)+0.5)*pixelHeight;vec4 oct32=texture2D(packedClippingPlanes,vec2(u,v))*255.0;vec2 oct=vec2(oct32.x*256.0+oct32.y,oct32.z*256.0+oct32.w);vec4 plane;plane.xyz=octDecode(oct,65535.0);plane.w=unpackFloatVec4(texture2D(packedClippingPlanes,vec2(u+pixelWidth,v)));return transformPlane(plane,transform);}\n#endif\nfloat clip(vec4 fragCoord,highp sampler2D clippingPlanes,mat4 clippingPlanesMatrix){vec4 position=windowToEyeCoordinates(fragCoord);vec3 clipNormal=vec3(0.0);vec3 clipPosition=vec3(0.0);float pixelWidth=metersPerPixel(position);\n#ifdef M_UNION_CLIPPING_REGIONS\nfloat clipAmount;\n#else\nfloat clipAmount=0.0;bool clipped=true;\n#endif\nfor(int i=0;i<M_CLIPPING_PLANES_LENGTH;++i){vec4 clippingPlane=getClippingPlane(clippingPlanes,i,clippingPlanesMatrix);clipNormal=clippingPlane.xyz;clipPosition=-clippingPlane.w*clipNormal;float amount=dot(clipNormal,(position.xyz-clipPosition))/pixelWidth;\n#ifdef M_UNION_CLIPPING_REGIONS\nclipAmount=branchFreeTernary(i==0,amount,min(amount,clipAmount));if(amount<=0.0){discard;}\n#else\nclipAmount=max(amount,clipAmount);clipped=clipped&&(amount<=0.0);\n#endif\n}\n#ifndef M_UNION_CLIPPING_REGIONS\nif(clipped){discard;}\n#endif\nreturn clipAmount;}void modelClippingPlanesStage(inout vec4 color){float clipDistance=clip(gl_FragCoord,u_model_clippingPlanes,u_model_clippingPlanesMatrix);vec4 clippingPlanesEdgeColor=vec4(1.0);clippingPlanesEdgeColor.rgb=u_model_clippingPlanesEdgeStyle.rgb;float clippingPlanesEdgeWidth=u_model_clippingPlanesEdgeStyle.a;if(clipDistance>0.0&&clipDistance<clippingPlanesEdgeWidth){color=clippingPlanesEdgeColor;}}",fn_rayEllipsoidIntersectionInterval:"#define GLSLIFY 1\n#ifndef _RAY_ELLIPSOID_INTERSECTION_INTERVAL_\n#define _RAY_ELLIPSOID_INTERSECTION_INTERVAL_\nconst float xVal=1.0/6378137.0;const float zVal=1.0/6356752.3142451793;const vec3 ellipsoid_inverseRadii=vec3(xVal,xVal,zVal);\n#include <infinity>\nvec2 rayEllipsoidIntersectionInterval(vec3 rayOrigin,vec3 rayDir){vec3 q=ellipsoid_inverseRadii*rayOrigin;vec3 w=ellipsoid_inverseRadii*rayDir;q=q;float q2=dot(q,q);float qw=dot(q,w);if(q2>1.0){if(qw>=0.0){return vec2(-infinity);}else{float qw2=qw*qw;float difference=q2-1.0;float w2=dot(w,w);float product=w2*difference;if(qw2<product){return vec2(-infinity);}else if(qw2>product){float discriminant=qw*qw-product;float temp=-qw+sqrt(discriminant);float root0=temp/w2;float root1=difference/temp;if(root0<root1){vec2 i=vec2(root0,root1);return i;}else{vec2 i=vec2(root1,root0);return i;}}else{float root=sqrt(difference/w2);vec2 i=vec2(root,root);return i;}}}else if(q2<1.0){float difference=q2-1.0;float w2=dot(w,w);float product=w2*difference;float discriminant=qw*qw-product;float temp=-qw+sqrt(discriminant);vec2 i=vec2(0.0,temp/w2);return i;}else{if(qw<0.0){float w2=dot(w,w);vec2 i=vec2(0.0,-qw/w2);return i;}else{return vec2(-infinity);}}}\n#endif\n",fn_readDepth:"#define GLSLIFY 1\n#include <fn_reverseLogDepth>\n#include <fn_unpackDepth>\n#ifndef _READ_DEPTH_\n#define _READ_DEPTH_\nfloat readDepth(sampler2D depthTexture,vec2 texCoords,bool isColorTexture){if(isColorTexture){\n#ifdef M_UNSUPPORTED_COLOR_BUFFER_FLOAT\nreturn reverseLogDepth(unpackDepth(texture2D(depthTexture,texCoords)));\n#else\nreturn reverseLogDepth(texture2D(depthTexture,texCoords).r);\n#endif\n}else{return reverseLogDepth(texture2D(depthTexture,texCoords).r);}}\n#endif\n",fn_getExponentialInterpColor:"#define GLSLIFY 1\nvec4 getExponentialInterpColor(const float inputValue,const float base,const float lowerValue,const float upperValue,const vec4 lowerColor,const vec4 upperColor){float difference=upperValue-lowerValue;float progress=inputValue-lowerValue;float percent;if(difference==0.0){percent=0.0;}else if(base==1.0){percent=progress/difference;}else{percent=(pow(base,progress)-1.0)/(pow(base,difference)-1.0);}return mix(lowerColor,upperColor,percent);}",fn_writeDepth:"#define GLSLIFY 1\n#include <fn_reverseLogDepth>\n#include <fn_unpackDepth>\n#include <fn_encodeFloat>\n#ifndef _WRITE_DEPTH_\n#define _WRITE_DEPTH_\nvec4 writeDepth(float depth){\n#ifdef M_UNSUPPORTED_COLOR_BUFFER_FLOAT\nreturn encodeFloat(depth);\n#else\nreturn vec4(depth,depth,depth,1.0);\n#endif\n}\n#endif\n",fn_XYZToRGB:"#define GLSLIFY 1\nvec3 XYZToRGB(vec3 Yxy){const mat3 XYZ2RGB=mat3(3.2405,-0.9693,0.0556,-1.5371,1.8760,-0.2040,-0.4985,0.0416,1.0572);vec3 xyz;xyz.r=Yxy.r*Yxy.g/Yxy.b;xyz.g=Yxy.r;xyz.b=Yxy.r*(1.0-Yxy.g-Yxy.b)/Yxy.b;return XYZ2RGB*xyz;}",fn_polylineVertexPosition:"#define GLSLIFY 1\nconst float czm_epsilon6=0.000001;const float czm_epsilon1=0.1;const float czm_piOverFour=0.7853981633974483;bool equalsEpsilon(vec3 left,vec3 right,float epsilon){return all(lessThanEqual(abs(left-right),vec3(epsilon)));}vec4 eyeToWindowCoordinates(vec4 positionEC){vec4 q=u_ProjectionMatrix*positionEC;q.xyz/=q.w;q.xyz=(u_ViewportTransformation*vec4(q.xyz,1.0)).xyz;return q;}void clipLineSegmentToNearPlane(vec3 p0,vec3 p1,out vec4 positionWC,out bool clipped,out bool culledByNearPlane,out vec4 clippedPositionEC){culledByNearPlane=false;clipped=false;vec3 p0ToP1=p1-p0;float magnitude=length(p0ToP1);vec3 direction=normalize(p0ToP1);float endPoint0Distance=u_CurrentFrustum.x+p0.z;float denominator=-direction.z;if(endPoint0Distance>0.0&&abs(denominator)<czm_epsilon7){culledByNearPlane=true;}else if(endPoint0Distance>0.0){float t=endPoint0Distance/denominator;if(t<0.0||t>magnitude){culledByNearPlane=true;}else{p0=p0+t*direction;p0.z=min(p0.z,-u_CurrentFrustum.x);clipped=true;}}clippedPositionEC=vec4(p0,1.0);positionWC=eyeToWindowCoordinates(clippedPositionEC);}vec4 getPolylineWindowCoordinates(vec4 positionEC,vec4 prevEC,vec4 nextEC,float expandDirection,float width,bool usePrevious,out float angle){\n#ifdef M_POLYLINE_DASH\nvec4 positionWindow=eyeToWindowCoordinates(positionEC);vec4 previousWindow=eyeToWindowCoordinates(prevEC);vec4 nextWindow=eyeToWindowCoordinates(nextEC);vec2 lineDir;if(usePrevious){lineDir=normalize(positionWindow.xy-previousWindow.xy);}else{lineDir=normalize(nextWindow.xy-positionWindow.xy);}angle=atan(lineDir.x,lineDir.y)-1.570796327;angle=floor(angle/czm_piOverFour+0.5)*czm_piOverFour;\n#endif\nvec4 clippedPrevWC,clippedPrevEC;bool prevSegmentClipped,prevSegmentCulled;clipLineSegmentToNearPlane(prevEC.xyz,positionEC.xyz,clippedPrevWC,prevSegmentClipped,prevSegmentCulled,clippedPrevEC);vec4 clippedNextWC,clippedNextEC;bool nextSegmentClipped,nextSegmentCulled;clipLineSegmentToNearPlane(nextEC.xyz,positionEC.xyz,clippedNextWC,nextSegmentClipped,nextSegmentCulled,clippedNextEC);bool segmentClipped,segmentCulled;vec4 clippedPositionWC,clippedPositionEC;clipLineSegmentToNearPlane(positionEC.xyz,usePrevious ? prevEC.xyz : nextEC.xyz,clippedPositionWC,segmentClipped,segmentCulled,clippedPositionEC);if(segmentCulled){return vec4(0.0,0.0,0.0,1.0);}vec2 directionToPrevWC=normalize(clippedPrevWC.xy-clippedPositionWC.xy);vec2 directionToNextWC=normalize(clippedNextWC.xy-clippedPositionWC.xy);if(prevSegmentCulled){directionToPrevWC=-directionToNextWC;}else if(nextSegmentCulled){directionToNextWC=-directionToPrevWC;}vec2 thisSegmentForwardWC,otherSegmentForwardWC;if(usePrevious){thisSegmentForwardWC=-directionToPrevWC;otherSegmentForwardWC=directionToNextWC;}else{thisSegmentForwardWC=directionToNextWC;otherSegmentForwardWC=-directionToPrevWC;}vec2 thisSegmentLeftWC=vec2(-thisSegmentForwardWC.y,thisSegmentForwardWC.x);vec2 leftWC=thisSegmentLeftWC;float expandWidth=width*0.5;if(!equalsEpsilon(prevEC.xyz-positionEC.xyz,vec3(0.0),czm_epsilon1)&&!equalsEpsilon(nextEC.xyz-positionEC.xyz,vec3(0.0),czm_epsilon1)){vec2 otherSegmentLeftWC=vec2(-otherSegmentForwardWC.y,otherSegmentForwardWC.x);vec2 leftSumWC=thisSegmentLeftWC+otherSegmentLeftWC;float leftSumLength=length(leftSumWC);leftWC=leftSumLength<czm_epsilon6 ? thisSegmentLeftWC :(leftSumWC/leftSumLength);vec2 u=-thisSegmentForwardWC;vec2 v=leftWC;float sinAngle=abs(u.x*v.y-u.y*v.x);expandWidth=clamp(expandWidth/sinAngle,0.0,width*1.0);}vec2 offset=leftWC*expandDirection*expandWidth*u_PixelRatio;\n#if !defined(M_PIXEL_WIDTH)\noffset/=metersPerPixel(positionEC);\n#endif\nreturn vec4(clippedPositionWC.xy+offset,-clippedPositionWC.z,1.0)*(u_ProjectionMatrix*clippedPositionEC).w;}vec4 computePositionEC(in vec3 high,in vec3 low){vec4 p=u_modelViewRelativeToEye*translateRelativeToEye(high,low);return p;}vec4 polylineVertexPosition(out float angle){float expandDir=a_ExpandAndWidth.x;float width=abs(a_ExpandAndWidth.y)+0.5;bool usePrev=a_ExpandAndWidth.y<0.0;vec4 currentEC=computePositionEC(a_PositionHigh,a_PositionLow);vec4 prevEC=computePositionEC(a_PrevPositionHigh,a_PrevPositionLow);vec4 nextEC=computePositionEC(a_NextPositionHigh,a_NextPositionLow);return getPolylineWindowCoordinates(currentEC,prevEC,nextEC,expandDir,width,usePrev,angle);}vec4 polylineVertexPosition(){float angle;float expandDir=a_ExpandAndWidth.x;float width=abs(a_ExpandAndWidth.y)+0.5;bool usePrev=a_ExpandAndWidth.y<0.0;vec4 currentEC=computePositionEC(a_PositionHigh,a_PositionLow);vec4 prevEC=computePositionEC(a_PrevPositionHigh,a_PrevPositionLow);vec4 nextEC=computePositionEC(a_NextPositionHigh,a_NextPositionLow);return getPolylineWindowCoordinates(currentEC,prevEC,nextEC,expandDir,width,usePrev,angle);}",fn_polylineVolumePosition:"#define GLSLIFY 1\nconst float czm_piOverFour=0.7853981633974483;vec4 eyeToWindowCoordinates(vec4 positionEC){vec4 q=u_ProjectionMatrix*positionEC;q.xyz/=q.w;q.xyz=(u_ViewportTransformation*vec4(q.xyz,1.0)).xyz;return q;}vec4 polylineVolumePosition(out float angle){float width=a_Width;vec3 ecStart=(u_modelViewRelativeToEye*translateRelativeToEye(a_StartHigh,a_StartLow)).xyz;vec3 offset=u_Normal*a_ForwardOffset;vec3 ecEnd=ecStart+offset;vec3 forwardDirectionEC=normalize(offset);\n#ifdef M_POLYLINE_DASH\nvec4 forwardDirectionWC=eyeToWindowCoordinates(vec4(forwardDirectionEC,1.0));vec2 lineDir=forwardDirectionWC.xy;angle=atan(lineDir.x,lineDir.y)-1.570796327;angle=floor(angle/czm_piOverFour+0.5)*czm_piOverFour;\n#endif\nvec4 startPlaneEC;startPlaneEC.xyz=u_Normal*a_StartNormal;startPlaneEC.w=-dot(startPlaneEC.xyz,ecStart);vec4 endPlaneEC;endPlaneEC.xyz=u_Normal*a_EndNormal;endPlaneEC.w=-dot(endPlaneEC.xyz,ecEnd);v_rightPlaneEC.xyz=u_Normal*a_RightNormal.xyz;v_rightPlaneEC.w=-dot(v_rightPlaneEC.xyz,ecStart);v_texcoordNormalizationAndStartEcYZ.x=abs(a_TexCoord.x);v_texcoordNormalizationAndStartEcYZ.y=a_TexCoord.y;v_texcoordNormalizationAndStartEcYZ.zw=ecStart.yz;v_endEcAndStartEcX.xyz=ecEnd;v_endEcAndStartEcX.w=ecStart.x;vec3 positionRelativeToEye=translateRelativeToEye(a_PositionHigh,a_PositionLow).xyz;vec4 positionEC=u_modelViewRelativeToEye*vec4(positionRelativeToEye,1.0);float absStartPlaneDistance=abs(planeDistance(startPlaneEC,positionEC.xyz));float absEndPlaneDistance=abs(planeDistance(endPlaneEC,positionEC.xyz));vec3 planeDirection=branchFreeTernary(absStartPlaneDistance<absEndPlaneDistance,startPlaneEC.xyz,endPlaneEC.xyz);vec3 upOrDown=normalize(cross(v_rightPlaneEC.xyz,planeDirection));vec3 normalEC=normalize(cross(planeDirection,upOrDown));upOrDown=cross(forwardDirectionEC,normalEC);upOrDown=min(u_GlobeMinimumAltitude,u_GeometricToleranceOverMeter*length(positionRelativeToEye.xyz))*upOrDown;positionEC.xyz+=upOrDown;v_texcoordNormalizationAndStartEcYZ.y=branchFreeTernary(v_texcoordNormalizationAndStartEcYZ.y>1.0,0.0,abs(v_texcoordNormalizationAndStartEcYZ.y));v_startPlaneNormalEcAndHalfWidth.xyz=startPlaneEC.xyz;v_startPlaneNormalEcAndHalfWidth.w=width*0.5;v_endPlaneNormalEcAndBatchId.xyz=endPlaneEC.xyz;\n#ifdef M_PIXEL_WIDTH\nwidth=width*max(0.0,metersPerPixel(positionEC));\n#endif\nwidth=width/dot(normalEC,v_rightPlaneEC.xyz);normalEC*=sign(a_TexCoord.x);positionEC.xyz+=width*normalEC;return u_ProjectionMatrix*positionEC;}",fn_planeDistance:"#define GLSLIFY 1\nfloat planeDistance(vec4 plane,vec3 point){return(dot(plane.xyz,point)+plane.w);}float planeDistance(vec3 planeNormal,float planeDistance,vec3 point){return(dot(planeNormal,point)+planeDistance);}",fn_billboardVertexPosition:"#define GLSLIFY 1\nvec4 billboardVertexPosition(){mat4 newModelMatrix;vec4 mvPosition;\n#ifdef M_FIXED_PIXEL_SIZE\nvec2 offset=vec2(0.0);offset=(a_POSITION.xy-u_center)*u_PixelResolution;vec4 center=u_ProjectionMatrix*u_MvMatrix*vec4(0.0,0.0,0.0,1.0);center=center/center.w;vec2 screenLocation=(u_ViewportTransformation*center).xy+offset;vec4 ndc=vec4(0.0);ndc.x=((screenLocation.x-u_Viewport[0])/u_Viewport[2])*2.0-1.0;ndc.y=((screenLocation.y-u_Viewport[1])/u_Viewport[3])*2.0-1.0;ndc.z=center.z;ndc.w=1.0;return ndc;\n#else\n#ifdef M_INSTANCE_MATRIX\nnewModelMatrix=u_InvertViewMatrix*a_InstanceMatrix4*u_ScaleMatrix;mvPosition=a_InstanceMatrix4*u_ScaleMatrix*vec4(0.0,0.0,0.0,1.0);\n#ifdef M_PARTICLSYSTEM\nv_Color=a_Color;\n#endif\n#else\nnewModelMatrix=u_InvertViewMatrix*u_MvMatrix*u_ScaleMatrix;mvPosition=u_MvMatrix*vec4(0.0,0.0,0.0,1.0);\n#endif\nvec2 scale;scale.x=length(vec3(newModelMatrix[0].x,newModelMatrix[0].y,newModelMatrix[0].z));scale.y=length(vec3(newModelMatrix[1].x,newModelMatrix[1].y,newModelMatrix[1].z));\n#if defined(M_SIZEATTENUATION)\n#ifdef M_PARTICLSYSTEM\nscale*=-mvPosition.z*a_Scale;\n#else\nscale*=-mvPosition.z;\n#endif\n#endif\nvec2 alignedPosition=(a_POSITION.xy-(u_center-vec2(0.5)))*scale;vec2 rotatedPosition;rotatedPosition.x=cos(u_rotation)*alignedPosition.x-sin(u_rotation)*alignedPosition.y;rotatedPosition.y=sin(u_rotation)*alignedPosition.x+cos(u_rotation)*alignedPosition.y;mvPosition.xy+=rotatedPosition;return u_ProjectionMatrix*mvPosition;\n#endif\n}",fn_computePolygonAdaptUV:"#define GLSLIFY 1\nfloat lineDistance(vec2 point1,vec2 point2,vec2 point){return abs((point2.y-point1.y)*point.x-(point2.x-point1.x)*point.y+point2.x*point1.y-point2.y*point1.x)/distance(point2,point1);}float fastApproximateAtan(float x){return x*(-0.1784*x-0.0663*x*x+1.0301);}float fastApproximateAtan(float x,float y){float t=abs(x);float opposite=abs(y);float adjacent=max(t,opposite);opposite=min(t,opposite);t=fastApproximateAtan(opposite/adjacent);t=branchFreeTernary(abs(y)>abs(x),1.5707963267948966-t,t);t=branchFreeTernary(x<0.0,3.141592653589793-t,t);t=branchFreeTernary(y<0.0,-t,t);return t;}vec2 approximateSphericalCoordinates(vec3 normal){float latitudeApproximation=fastApproximateAtan(sqrt(normal.x*normal.x+normal.y*normal.y),normal.z);float longitudeApproximation=fastApproximateAtan(normal.x,normal.y);return vec2(latitudeApproximation,longitudeApproximation);}vec2 computePolygonAdaptUV(){float logDepthOrDepth=readDepth(u_DepthTexture,gl_FragCoord.xy/u_Viewport.zw,false);vec4 eyeCoordinate=windowToEyeCoordinates(gl_FragCoord.xy,logDepthOrDepth);eyeCoordinate/=eyeCoordinate.w;vec4 worldCoordinate4=u_InvertViewMatrix*eyeCoordinate;vec3 worldCoordinate=worldCoordinate4.xyz/worldCoordinate4.w;vec2 sphericalLatLong=approximateSphericalCoordinates(worldCoordinate);sphericalLatLong.y+=v_uvMinAndSphericalLongitudeRotation.z;bool flag=sphericalLatLong.y<3.141592653589793;float range=sphericalLatLong.y-3.141592653589793*2.0;sphericalLatLong.y=branchFreeTernary(flag,sphericalLatLong.y,range);vec2 uv=vec2(0.0,0.0);uv.x=(sphericalLatLong.y-v_sphericalExtents.y)*v_sphericalExtents.w;uv.y=(sphericalLatLong.x-v_sphericalExtents.x)*v_sphericalExtents.z;if(uv.x<=0.0||1.0<=uv.x||uv.y<=0.0||1.0<=uv.y||logDepthOrDepth==0.0){discard;}float s=lineDistance(v_uvMinAndSphericalLongitudeRotation.xy,v_uMaxAndInverseDistance.xy,uv)*v_uMaxAndInverseDistance.z;float t=lineDistance(v_uvMinAndSphericalLongitudeRotation.xy,v_vMaxAndInverseDistance.xy,uv)*v_vMaxAndInverseDistance.z;return vec2(s,t);}",s_HighlightColorInfo:"#define GLSLIFY 1\nstruct HighlightColorInfo{vec4 color;};",s_JointMatrix:"#define GLSLIFY 1\nstruct JointMatrix{mat4 m;};",s_LightMaterial:"#define GLSLIFY 1\nstruct LightMaterial{vec3 Ambient;vec3 Diffuse;float Shininess;vec3 SpecularColor;};",s_PBRInfo:"#define GLSLIFY 1\nstruct PBRInfo{float NdotL;float NdotV;float NdotH;float LdotH;float VdotH;float perceptualRoughness;float metalness;vec3 reflectance0;vec3 reflectance90;float alphaRoughness;vec3 diffuseColor;vec3 specularColor;};",infinity:"#define GLSLIFY 1\n#ifndef _MINEMAP_INFINITY_\n#define _MINEMAP_INFINITY_\nconst float infinity=5906376272000.0;\n#endif\n"};var p_="#define GLSLIFY 1\n#ifndef _SHADER_IN_VERTEX_DEPTH_\n#define _SHADER_IN_VERTEX_DEPTH_\n#endif\n#include <fn_vertexLogDepth>\n#include <a_DOUBLE_PRECISION_POSITION>\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelMatrix>\n#include <a_BATCHID>\n#include <c_computeSTParsVert>\n#include <u_ModelViewProjectionRelativeToEye>\n#include <u_EncodedCameraPosition>\n#include <fn_translateRelativeToEye>\n#if defined(M_POLYLINE) || defined(M_LOG_DEPTH)\n#include <u_CurrentFrustum>\n#endif\n#ifdef M_JOINT_MATRIX_CNT\nattribute vec4 a_JOINTS_0;attribute vec4 a_WEIGHTS_0;\n#endif\n#ifdef M_INSTANCE_MATRIX\nattribute mat4 a_InstanceMatrix4;uniform mat4 vpmatrix;\n#endif\n#include <u_HasSkinning>\n#include <s_JointMatrix>\n#ifdef M_JOINT_MATRIX_CNT\nuniform highp mat4 u_jointMatrix[M_JOINT_MATRIX_CNT];\n#endif\n#ifdef M_USE_MORPHTARGETS\n#include <a_POSITION3_1>\n#include <a_POSITION3_2>\nuniform vec2 u_morphTargetInfluences;\n#include <a_NORMAL3_1>\n#include <a_NORMAL3_2>\n#include <a_TANGENT_1>\n#include <a_TANGENT_2>\n#endif\n#include <fn_getAnimatedGLPosition>\n#ifdef M_POLYLINE\n#include <u_FrustumPlanes>\n#include <u_ProjectionMatrix>\n#include <u_PixelRatio>\n#include <u_Viewport>\n#include <fn_metersPerPixel>\nuniform mat4 u_ViewportTransformation;uniform mat4 u_ViewportOrthographic;uniform mat4 u_modelViewRelativeToEye;uniform mat3 u_Normal;uniform float u_GlobeMinimumAltitude;uniform float u_GeometricToleranceOverMeter;\n#ifdef M_SHADOW_VOLUME\nattribute vec3 a_StartHigh;attribute vec3 a_StartLow;attribute vec3 a_StartNormal;attribute vec3 a_EndNormal;attribute vec3 a_RightNormal;attribute vec3 a_ForwardOffset;attribute vec2 a_TexCoord;attribute float a_Width;varying vec4 v_startPlaneNormalEcAndHalfWidth;varying vec4 v_endPlaneNormalEcAndBatchId;varying vec4 v_rightPlaneEC;varying vec4 v_endEcAndStartEcX;varying vec4 v_texcoordNormalizationAndStartEcYZ;\n#include <fn_planeDistance>\n#include <fn_branchFreeTernary>\n#include <fn_polylineVolumePosition>\n#else\nattribute vec3 a_PrevPositionHigh;attribute vec3 a_PrevPositionLow;attribute vec3 a_NextPositionHigh;attribute vec3 a_NextPositionLow;attribute vec2 a_ExpandAndWidth;\n#include <fn_polylineVertexPosition>\n#endif\nvarying float v_polylineAngle;\n#endif\n#ifdef M_BILLBOARD\n#include <u_ProjectionMatrix>\nuniform float u_rotation;uniform vec2 u_center;uniform vec2 u_UVScale;uniform mat4 u_ScaleMatrix;uniform mat4 u_MvMatrix;uniform mat4 u_InvertViewMatrix;\n#ifdef M_FIXED_PIXEL_SIZE\nuniform vec2 u_PixelResolution;uniform mat4 u_ViewportTransformation;uniform vec4 u_Viewport;\n#endif\n#include <fn_billboardVertexPosition>\n#endif\nvarying float v_depthFromNearPlusOne;\n#ifdef M_DEPTH_DISTANCE\nvarying vec4 v_Position;\n#endif\nvoid main(){\n#ifdef M_POLYLINE\n#ifdef M_SHADOW_VOLUME\nfloat angle;gl_Position=polylineVolumePosition(angle);v_polylineAngle=angle;gl_Position.z=min(gl_Position.z,gl_Position.w);\n#else\nfloat angle;vec4 positionWC=polylineVertexPosition(angle);v_polylineAngle=angle;getAnimatedGLPosition(positionWC,u_ViewportOrthographic);\n#endif\n#else\n#ifdef M_BILLBOARD\ngl_Position=billboardVertexPosition();\n#else\ngetAnimatedGLPosition();\n#endif\n#endif\n#include <c_computeSTMainVert>\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n#ifdef M_DEPTH_DISTANCE\n#ifdef M_DOUBLEPRECISION\nv_Position=u_ModelMatrix*vec4(a_PositionHigh+a_PositionLow,1);\n#else\nv_Position=u_ModelMatrix*vec4(a_POSITION,1.0);\n#endif\n#endif\n}";function f_(e){return y_(e)}const m_=/^[ \t]*#include +<([\w\d./]+)>/gm,__={prelude:{fragmentSource:f_("\n#ifdef M_TEXTURE_LOD_SUPPORTED\n#extension GL_EXT_shader_texture_lod:enable\n#endif\n#ifdef M_STANDARD_DERIVATIVES_SUPPORTED\n#extension GL_OES_standard_derivatives:enable\n#endif\n#ifdef M_DEPTH_EXT\n#extension GL_EXT_frag_depth:enable\n#endif\n#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\n#if !defined(M_HIGHLIGHT_COLOR_MAX)\n#define M_HIGHLIGHT_COLOR_MAX 4\n#endif\n#define PI 3.141592653589793\nconst float czm_epsilon7=0.0000001;const float czm_twoPi=6.283185307179586;const float czm_pixelRatio=1.0;uniform vec3 u_SunLightDirectionLocal;uniform vec3 u_SunLightDirectionGlobal;uniform vec3 u_SunLightColor;uniform float u_SunLightIntensity;uniform vec3 u_CameraPosition;uniform vec3 u_CameraDirection;"),vertexSource:f_("#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\n#if !defined(M_HIGHLIGHT_COLOR_MAX)\n#define M_HIGHLIGHT_COLOR_MAX 4\n#endif\n#define PI 3.141592653589793\nconst float czm_epsilon7=0.0000001;const float czm_twoPi=6.283185307179586;const float czm_pixelRatio=1.0;uniform vec3 u_SunLightDirectionLocal;uniform vec3 u_SunLightDirectionGlobal;uniform vec3 u_SunLightColor;uniform float u_SunLightIntensity;uniform vec3 u_CameraPosition;uniform vec3 u_CameraDirection;")},unpackAll:{fragmentSource:f_(n_),vertexSource:f_(n_)},sphereClipping:{fragmentSource:f_("#define GLSLIFY 1\nvoid main(){gl_FragColor=vec4(1.0);}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\nvoid main(){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1);}")},sphereBackground:{fragmentSource:f_("#define GLSLIFY 1\n#include <u_Color4>\n#include <u_Opacity>\n#include <c_define>\nvoid showLogDepth(float depth,vec2 currentFrustum){float farDepthFromNearPlusOne=currentFrustum.y-currentFrustum.x+1.0;float log2FarDepthFromNearPlusOne=log2(farDepthFromNearPlusOne);float oneOverLog2FarDepthFromNearPlusOne=1.0/log2FarDepthFromNearPlusOne;if(depth<=0.9999999||depth>farDepthFromNearPlusOne){discard;}float logDepth=log2(depth)*oneOverLog2FarDepthFromNearPlusOne;gl_FragColor=vec4(logDepth,logDepth,logDepth,1.0);}void main(){gl_FragColor=vec4(u_Color.rgb,u_Color.a*u_Opacity);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <fn_vertexLogDepth>\n#include <c_define>\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\nvoid main(){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.);}")},sphereBackgroundPattern:{fragmentSource:f_("#define GLSLIFY 1\n#include <u_BaseColorSampler>\nuniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;\n#include <u_Opacity>\nvarying vec2 v_pos_a;varying vec2 v_pos_b;void main(){vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_BaseColorSampler,pos);gl_FragColor=vec4(color1.rgb,color1.a*u_Opacity);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <u_Zoom>\nvarying vec2 v_pos_a;varying vec2 v_pos_b;attribute vec2 a_TEXCOORD_0;void main(){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);v_pos_a=a_TEXCOORD_0*70.0*u_Zoom;v_pos_b=a_TEXCOORD_0*70.0*u_Zoom;}")},collisionBox:{fragmentSource:f_("#define GLSLIFY 1\nvarying float v_placed;varying float v_notUsed;void main(){float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,alpha);if(v_placed>0.5){gl_FragColor=vec4(0.0,0.0,1.0,0.5*alpha);}if(v_notUsed>0.5){gl_FragColor.a*=.1;}}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION2>\nattribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;\n#include <u_ModelViewProjectionMatrix>\nuniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main(){vec4 projectedPoint=u_ModelViewProjectionMatrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,0.0,1.0);gl_Position.xy+=a_extrude*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}")},collisionCircle:{fragmentSource:f_("#define GLSLIFY 1\nuniform float u_overscale_factor;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;varying float v_placed;varying float v_notUsed;void main(){float alpha=0.5;vec4 color=vec4(1.0,0.0,0.0,1.0)*alpha;if(v_placed>0.5){color=vec4(0.0,0.0,1.0,0.5)*alpha;}if(v_notUsed>0.5){color*=.2;}float extrude_scale_length=length(v_extrude_scale);float extrude_length=length(v_extrude)*extrude_scale_length;float stroke_width=15.0*extrude_scale_length/u_overscale_factor;float radius=v_radius*extrude_scale_length;float distance_to_edge=abs(extrude_length-radius);float opacity_t=smoothstep(-stroke_width,0.0,-distance_to_edge);gl_FragColor=vec4(color.rgb,color.a*opacity_t);}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION2>\nattribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;\n#include <u_ModelViewProjectionMatrix>\nuniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;void main(){vec4 projectedPoint=u_ModelViewProjectionMatrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,0.0,1.0);highp float padding_factor=1.2;gl_Position.xy+=a_extrude*u_extrude_scale*padding_factor*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;v_radius=abs(a_extrude.y);v_extrude=a_extrude*padding_factor;v_extrude_scale=u_extrude_scale*u_camera_to_center_distance*collision_perspective_ratio;}")},debug:{fragmentSource:f_("#define GLSLIFY 1\n#include <u_Color4>\nvoid main(){gl_FragColor=u_Color;}"),vertexSource:f_("#define GLSLIFY 1\n#include <u_ModelViewProjectionMatrix>\n#include <a_POSITION3>\nvoid main(){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1);}")},sphere:{fragmentSource:f_("#define GLSLIFY 1\n#include <c_define>\n#include <fn_writeLogDepth>\n#include <fn_getBlinnPhongColor>\nuniform sampler2D u_earthMap;uniform sampler2D u_earthCloudMap;uniform sampler2D u_earthNightMap;\n#include <v_TexCoord2>\n#include <v_Normal3>\nvarying vec3 v_world_pos;uniform float u_earthTime;uniform bool u_NightVisible;uniform highp float u_DayTexPercent;uniform vec4 u_GlobalInnerColor;uniform vec4 u_LightPer;uniform vec2 u_NightGlobalPer;void main(){vec4 globalColor=vec4(0.0);\n#ifdef M_HAS_BASE_MAP\nglobalColor+=texture2D(u_earthMap,v_TexCoord);\n#endif\nglobalColor.xyz=u_LightPer.w*pow(globalColor.xyz,vec3(2.2));vec4 cloudColor=vec4(0.0);\n#ifdef M_HAS_CLOUD_MAP\ncloudColor=texture2D(u_earthCloudMap,vec2(v_TexCoord.x+u_earthTime*u_LightPer.y,v_TexCoord.y));cloudColor.rgb=pow(cloudColor.rgb,vec3(2.2));\n#endif\nvec4 nightLightColor=vec4(0.0);\n#ifdef M_HAS_NIGHT_MAP\nnightLightColor=u_LightPer.z*texture2D(u_earthNightMap,v_TexCoord);\n#endif\nvec3 N=normalize(v_Normal);vec3 LightDir=u_SunLightDirectionGlobal;vec3 V=normalize(u_CameraPosition-v_world_pos);vec3 H=normalize(LightDir+V);float specularPer=pow(max(dot(H,N),0.0),32.0);vec3 specularLight=specularPer*0.0*vec3(1.0,1.0,1.0);float rimPower=u_GlobalInnerColor.w;float ndv=dot(N,V);if(ndv<0.0){discard;}vec3 innerRing=(u_GlobalInnerColor.xyz*pow(1.0-ndv,rimPower));float NL=dot(LightDir,N);vec3 FinalColor=globalColor.xyz;\n#ifdef M_HAS_NIGHT_MAP\nconst float threshold=0.2;float y=0.5*NL/threshold+0.5;if(NL>threshold){FinalColor=globalColor.xyz*NL+u_NightGlobalPer.x*globalColor.xyz+specularLight+innerRing+cloudColor.xyz;}else if(NL>-threshold){float z=(1.0-y);FinalColor=y*NL*globalColor.xyz+z*nightLightColor.xyz+u_NightGlobalPer.x*globalColor.xyz+innerRing+max(u_NightGlobalPer.y,y)*cloudColor.xyz;}else{FinalColor=nightLightColor.xyz+u_NightGlobalPer.x*globalColor.xyz+innerRing+max(u_NightGlobalPer.y,y)*cloudColor.xyz;}\n#else\nFinalColor=globalColor.xyz+innerRing+cloudColor.xyz;\n#endif\nif(u_NightVisible==false)FinalColor=globalColor.xyz+innerRing+cloudColor.xyz;FinalColor=mix(FinalColor,globalColor.xyz,u_DayTexPercent);gl_FragColor=vec4(pow(FinalColor,vec3(1.0/2.2)),1.0);\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <c_define>\n#ifdef M_DOUBLEPRECISION\n#include <a_DOUBLE_PRECISION_POSITION>\n#else\n#include <a_POSITION3>\n#endif\n#include <a_TEXCOORD_0>\n#include <u_ModelViewProjectionMatrix>\n#include <v_Normal3>\n#include <v_TexCoord2>\nvarying vec3 v_world_pos;\n#include <fn_vertexLogDepth>\n#include <u_ModelViewProjectionRelativeToEye>\n#include <u_EncodedCameraPosition>\n#include <fn_translateRelativeToEye>\nvoid main(){\n#ifdef M_DOUBLEPRECISION\ngl_Position=u_ModelViewProjectionRelativeToEye*translateRelativeToEye(a_PositionHigh,a_PositionLow);v_world_pos=a_PositionHigh+a_PositionLow;\n#else\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1);v_world_pos=a_POSITION;\n#endif\nv_TexCoord=a_TEXCOORD_0;v_Normal=v_world_pos;\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n}")},sphereAtmosphere:{fragmentSource:f_("#define GLSLIFY 1\n#include <fn_writeLogDepth>\n#include <c_define>\nuniform vec4 u_GlobalOuterColor;uniform vec4 u_GlobalOuterPara;\n#include <v_Normal3>\nvarying vec3 v_world_pos;varying vec3 v_worldAtmos_pos;uniform highp float u_DayTexPercent;void main(){float _OutLightPow=u_GlobalOuterPara.y;float _OutLightStrength=u_GlobalOuterPara.z;vec3 N=normalize(v_Normal);vec3 V=normalize(u_CameraPosition-v_world_pos);float ndv=dot(N,V);float Alpha=pow(clamp(ndv,0.0,1.0),_OutLightPow);Alpha*=_OutLightStrength*ndv;gl_FragColor=vec4(u_GlobalOuterColor.xyz,Alpha*(1.0-u_DayTexPercent));\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <fn_vertexLogDepth>\n#include <c_define>\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\nvarying vec3 v_Normal;varying vec3 v_world_pos;varying vec3 v_worldAtmos_pos;uniform vec4 u_GlobalOuterPara;void main(){v_Normal=a_POSITION;v_world_pos=a_POSITION;v_Normal=normalize(v_Normal);float _Size=u_GlobalOuterPara.x;gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION+v_Normal*_Size,1.0);v_worldAtmos_pos=a_POSITION+v_Normal*_Size;\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n}")},sphereRaster:{fragmentSource:f_("#define GLSLIFY 1\nuniform float u_fade_t;uniform vec4 u_BackgroundColor;\n#include <u_Opacity>\n#if M_TEXTURE_UNITS > 0\nuniform sampler2D u_Texture[M_TEXTURE_UNITS];uniform vec4 u_TextureTexCoordsRectangle[M_TEXTURE_UNITS];uniform vec4 u_TextureTranslationAndScale[M_TEXTURE_UNITS];uniform float u_TextureAlpha[M_TEXTURE_UNITS];uniform float u_TextureBrightnessMin[M_TEXTURE_UNITS];uniform float u_TextureBrightnessMax[M_TEXTURE_UNITS];uniform float u_TextureSaturationFactor[M_TEXTURE_UNITS];uniform float u_TextureContrastFactor[M_TEXTURE_UNITS];uniform vec3 u_TextureSpinWeight[M_TEXTURE_UNITS];uniform bool u_TextureAlphaPremultiplied[M_TEXTURE_UNITS];\n#endif\nuniform vec4 u_BackgroundLayerColor;varying vec2 v_pos0;varying vec2 v_pos1;varying vec3 v_world_pos;varying vec4 v_Color;vec3 Ka=vec3(0.25);vec3 Kd=vec3(0.4);vec3 Ks=vec3(0.774597);vec3 Ke=vec3(0.1,0.1,0.1);float shininess=0.4;\n#include <u_ModelMatrix>\n#include <fn_pixelInVideo>\n#include <fn_writeLogDepth>\n#include <fn_encodeFloat>\n#include <fn_decodeFloat>\n#include <fn_getBlinnPhongColor>\n#include <v_LocalPosition>\n#include <v_Normal3>\n#include <s_LightMaterial>\n#include <fn_phong>\n#include <c_define>\nuniform sampler2D u_MaskSample;\n#include <u_ClipMatrix>\nuniform vec2 u_TextureSize;uniform bool u_ClipVideo;\n#if (defined M_NUM_VIDEOS) && (M_NUM_VIDEOS>0)\nuniform highp mat4 u_VIDEOMATCH_MVPMATRIX[M_NUM_VIDEOS];uniform highp vec3 u_VIDEOMATCH_RTP[M_NUM_VIDEOS];uniform bool u_HAS_VIDEOMATCHMAP[M_NUM_VIDEOS];uniform float u_Alpha[M_NUM_VIDEOS];uniform highp sampler2D u_VideoSampler[M_NUM_VIDEOS];uniform bool u_ActiveClipVideoTexture[M_NUM_VIDEOS];uniform vec3 u_ClipColors[M_NUM_VIDEOS];\n#endif\nvec4 blendColor(in vec4 prevColor,in vec4 currentColor){vec4 colorB=prevColor;vec4 colorT=currentColor;float alphaB=prevColor.a;float alphaT=currentColor.a;float alphaF=alphaT+alphaB*(1.0-alphaT);vec4 colorF=(colorT*alphaT+colorB*alphaB*(1.0-alphaT))/alphaF;vec4 blendT=alphaB*colorF+(1.0-alphaB)*colorT;vec4 outColor=(blendT*alphaT+colorB*alphaB*(1.0-alphaT))/alphaF;return outColor;}vec4 computeProperty(vec4 previousColor,vec3 textureSpinWeight,float textureSaturationFactor,float textureContrastFactor,float textureBrightnessMin,float textureBrightnessMax){vec3 inColor=previousColor.rgb;float inAlpha=previousColor.a;vec3 rgb=vec3(dot(inColor,textureSpinWeight.xyz),dot(inColor,textureSpinWeight.zxy),dot(inColor,textureSpinWeight.yzx));float average=(inColor.r+inColor.g+inColor.b)/3.0;rgb+=(average-rgb)*textureSaturationFactor;rgb=(rgb-0.5)*textureContrastFactor+0.5;vec3 u_high_vec=vec3(textureBrightnessMin,textureBrightnessMin,textureBrightnessMin);vec3 u_low_vec=vec3(textureBrightnessMax,textureBrightnessMax,textureBrightnessMax);return vec4(mix(u_high_vec,u_low_vec,rgb),inAlpha);}vec4 sampleAndComputePropertyColor(vec4 previousColor,sampler2D textureToSample,vec2 tileTextureCoordinates,vec4 textureCoordinateRectangle,vec4 textureCoordinateTranslationAndScale,float textureAlpha,vec3 textureSpinWeight,float saturationFactor,float contrastFactor,float brightnessMin,float brightnessMax,bool textureAlphaPremultiplied){vec2 alphaMultiplier=step(textureCoordinateRectangle.st,tileTextureCoordinates);textureAlpha=textureAlpha*alphaMultiplier.x*alphaMultiplier.y;alphaMultiplier=step(vec2(0.0),textureCoordinateRectangle.pq-tileTextureCoordinates);textureAlpha=textureAlpha*alphaMultiplier.x*alphaMultiplier.y;vec2 translation=textureCoordinateTranslationAndScale.xy;vec2 scaleValue=textureCoordinateTranslationAndScale.zw;vec2 textureCoordinates=tileTextureCoordinates*scaleValue+translation;vec4 value=texture2D(textureToSample,textureCoordinates);if(value.a>0.01){value=computeProperty(value,textureSpinWeight,saturationFactor,contrastFactor,brightnessMin,brightnessMax);}float sourceAlpha=value.a*textureAlpha;float outAlpha=mix(previousColor.a,1.0,sourceAlpha);outAlpha+=sign(outAlpha)-1.0;vec3 outColor;if(textureAlphaPremultiplied){outColor=(previousColor.rgb*previousColor.a*(1.0-sourceAlpha)+value.rgb)/outAlpha;}else{outColor=mix(previousColor.rgb*previousColor.a,value.rgb,sourceAlpha)/outAlpha;}return vec4(outColor,max(outAlpha,0.0));}\n#if M_TEXTURE_UNITS > 0\nvec4 computeDayColor(vec4 initialColor,vec2 textureCoordinates){vec4 color=initialColor;for(int i=0;i<M_TEXTURE_UNITS;i++){color=sampleAndComputePropertyColor(color,u_Texture[i],textureCoordinates,u_TextureTexCoordsRectangle[i],u_TextureTranslationAndScale[i],u_TextureAlpha[i],u_TextureSpinWeight[i],u_TextureSaturationFactor[i],u_TextureContrastFactor[i],u_TextureBrightnessMin[i],u_TextureBrightnessMax[i],u_TextureAlphaPremultiplied[i]);}return color;}\n#endif\nvoid main(){\n#ifdef M_BACKGROUND_LAYER\ngl_FragColor=u_BackgroundLayerColor;\n#else\nvec4 blankColor;\n#ifdef M_DISABLE_DEPTHTEST\nblankColor=vec4(0.0,0.0,0.0,0.0);\n#else\nblankColor=u_BackgroundColor;\n#endif\nvec4 color=vec4(0.0,0.0,0.0,0.0);\n#if M_TEXTURE_UNITS > 0\ncolor=computeDayColor(color,clamp(v_pos0,0.0,1.0));\n#endif\nif(color.a==0.0){color=blankColor;}\n#ifdef M_PHONG_LIGHT\ngl_FragColor=vec4(ambient(),1.0)*color;\n#else\ngl_FragColor=color;\n#endif\n#endif\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#if (defined M_NUM_VIDEOS) && (M_NUM_VIDEOS>0)\nfor(int i=0;i<M_NUM_VIDEOS;i++){if(u_HAS_VIDEOMATCHMAP[i]){if(u_ClipVideo){if(pixelInVideo(u_VIDEOMATCH_MVPMATRIX[i],u_VIDEOMATCH_RTP[i],u_ModelMatrix,v_LocalPosition,u_VideoSampler[i],u_Alpha[i],u_ClipMatrix,u_MaskSample,u_TextureSize,u_ActiveClipVideoTexture[i],u_ClipColors[i])){continue;}}else{if(pixelInVideo(u_VIDEOMATCH_MVPMATRIX[i],u_VIDEOMATCH_RTP[i],u_ModelMatrix,v_LocalPosition,u_VideoSampler[i],u_Alpha[i],u_ClipMatrix,u_MaskSample,u_TextureSize,false,u_ClipColors[i])){continue;}}}}\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION3>\nattribute vec2 a_texture_pos;\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelMatrix>\nuniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;\n#include <c_define>\n#include <v_LocalPosition>\n#include <v_Normal3>\nvarying vec2 v_pos0;varying vec2 v_pos1;varying vec3 v_world_pos;varying vec4 v_Color;\n#include <fn_vertexLogDepth>\n#include <v_LIGHT>\nvoid main(){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1);v_LocalPosition=vec4(a_POSITION,1);vec4 geographic=u_ModelMatrix*vec4(a_POSITION,1.);v_world_pos=geographic.xyz;vec4 color=vec4(1.0,1.0,1.0,1.0);v_Color=color;v_pos0=a_texture_pos/32767.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;vec4 sunlight_position=u_ModelMatrix*vec4(a_POSITION,1.);v_Normal=sunlight_position.xyz;\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n}")},sphereImage:{fragmentSource:f_("#define GLSLIFY 1\n#include <u_Opacity>\nuniform sampler2D u_BaseColorSampler;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;varying vec2 v_pos0;\n#include <u_ModelMatrix>\n#include <fn_pixelInVideo>\n#include <fn_writeLogDepth>\n#include <fn_encodeFloat>\n#include <fn_decodeFloat>\n#include <fn_getBlinnPhongColor>\n#include <v_LocalPosition>\n#include <v_Normal3>\n#include <c_define>\n#include <u_ClipMatrix>\nvoid main(){vec4 color=texture2D(u_BaseColorSampler,v_pos0);if(color.a>0.0){color.rgb=color.rgb/color.a;}else{discard;}color.a*=u_Opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec4 out_color=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);gl_FragColor=vec4(out_color.xyz,out_color.w*u_Opacity);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION3>\nattribute vec2 a_texture_pos;\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelMatrix>\nuniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;\n#include <c_define>\n#include <v_LocalPosition>\n#include <v_Normal3>\nvarying vec2 v_pos0;varying vec2 v_pos1;varying vec3 v_world_pos;varying vec4 v_Color;\n#include <fn_vertexLogDepth>\nvoid main(){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1);v_LocalPosition=vec4(a_POSITION,1);vec4 geographic=u_ModelMatrix*vec4(a_POSITION,1.);v_world_pos=geographic.xyz;vec4 color=vec4(1.0,1.0,1.0,1.0);v_Color=color;v_pos0=a_texture_pos/32767.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;vec4 sunlight_position=u_ModelMatrix*vec4(a_POSITION,1.);v_Normal=sunlight_position.xyz;\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n}")},sphereSymbolIcon:{fragmentSource:f_(r_),vertexSource:f_(o_)},sphereSymbolSDF:{fragmentSource:f_(a_),vertexSource:f_(s_)},sphereFill:{fragmentSource:f_("#define GLSLIFY 1\n#include <pragma_base_define>\n#include <pragma_fill_define>\n#include <c_define>\n#include <c_fillF>\n#include <fn_writeLogDepth>\n#include <fn_encodeFloat>\nvoid main(){\n#include <pragma_base_initialize>\n#include <pragma_fill_initialize>\nfloat finalOpacity=color.a*opacity;if(finalOpacity==0.0){discard;}gl_FragColor=vec4(color.rgb,finalOpacity);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION3>\nattribute vec2 a_ST;\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelMatrix>\n#include <u_Resolution>\n#include <u_Bearing>\nuniform mat4 u_Matrix;\n#include <pragma_base_define>\n#include <pragma_fill_define>\n#include <c_fillV>\n#include <c_define>\n#include <fn_vertexLogDepth>\nvoid main(){\n#include <pragma_base_initialize>\n#include <pragma_fill_initialize>\n#ifdef M_CANVAS_2D\ngl_Position=u_Matrix*vec4(a_ST*1024.0,0,1);\n#else\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1);vec2 translate=u_translate;float translate_anchor=u_translate_anchor;if(translate_anchor==0.0){float sinA=sin(-u_Bearing);float cosA=cos(-u_Bearing);translate=vec2(translate[0]*cosA-translate[1]*sinA,translate[0]*sinA+translate[1]*cosA);}gl_Position.xy+=translate/vec2(u_Resolution.x/2.0,-u_Resolution.y/2.0)*gl_Position.w;\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n#endif\n}")},sphereFillPattern:{fragmentSource:f_("#define GLSLIFY 1\n#include <u_BaseColorSampler>\n#include <pragma_base_define>\n#include <pragma_fill_define>\n#include <c_fillF>\n#include <fn_rotateTexCoord>\nuniform vec2 u_offset;uniform float u_rotation;uniform float u_scale;uniform bool u_HasTexture;\n#pragma minemap: define lowp vec4 pattern_from\n#pragma minemap: define lowp vec4 pattern_to\nvoid main(){\n#pragma minemap: initialize mediump vec4 pattern_from\n#pragma minemap: initialize mediump vec4 pattern_to\n#include <pragma_base_initialize>\n#include <pragma_fill_initialize>\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;if(u_HasTexture){vec2 imageCoord=mod(abs(v_pos_a),1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imageCoord);vec4 color1=texture2D(u_BaseColorSampler,pos);vec2 imageCoord_b=mod(abs(v_pos_b+u_offset)/u_scale,1.0);vec2 finalImageCoord=rotateTexCoord(imageCoord_b,u_rotation);if(finalImageCoord.x<0.0||finalImageCoord.x>1.0||finalImageCoord.y>1.0||finalImageCoord.y<0.0){discard;}vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,finalImageCoord);vec4 color2=texture2D(u_BaseColorSampler,pos2);vec4 mixedColor=mix(color1,color2,u_mix);float finalOpacity=mixedColor.a*opacity;if(finalOpacity==0.0){discard;}gl_FragColor=vec4(mixedColor.rgb,finalOpacity);}else{float finalOpacity=color.a*opacity;if(finalOpacity==0.0){discard;}gl_FragColor=vec4(color.rgb,finalOpacity);}\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION3>\nattribute vec2 a_ST;\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelMatrix>\n#include <u_Resolution>\n#include <u_Bearing>\nuniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;uniform float u_scale_a;uniform float u_scale_b;\n#include <pragma_base_define>\n#include <pragma_fill_define>\n#include <c_fillV>\nuniform float u_TileZoomFactor;\n#pragma minemap: define lowp vec4 pattern_from\n#pragma minemap: define lowp vec4 pattern_to\n#pragma minemap: define lowp float pixel_ratio_from\n#pragma minemap: define lowp float pixel_ratio_to\nvoid main(){\n#pragma minemap: initialize mediump vec4 pattern_from\n#pragma minemap: initialize mediump vec4 pattern_to\n#pragma minemap: initialize lowp float pixel_ratio_from\n#pragma minemap: initialize lowp float pixel_ratio_to\n#include <pragma_base_initialize>\n#include <pragma_fill_initialize>\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1);vec2 translate=u_translate;float translate_anchor=u_translate_anchor;if(translate_anchor==0.0){float sinA=sin(-u_Bearing);float cosA=cos(-u_Bearing);translate=vec2(translate[0]*cosA-translate[1]*sinA,translate[0]*sinA+translate[1]*cosA);}gl_Position.xy+=translate/vec2(u_Resolution.x/2.0,-u_Resolution.y/2.0)*gl_Position.w;v_pos_a=a_ST*u_TileZoomFactor;v_pos_b=a_ST*u_TileZoomFactor;}")},sphereFillOutline:{fragmentSource:f_("#define GLSLIFY 1\nuniform float u_Opacity;\n#include <c_fillF>\nvarying vec4 v_COLOR;varying float v_DiscardPixel;void main(){\n#ifndef M_CANVAS_2D\nif(v_DiscardPixel<0.){discard;}\n#endif\nfloat finalOpacity=v_COLOR.a/255.0*u_Opacity;if(finalOpacity==0.0){discard;}float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=vec4(v_COLOR.rgb/255.0,finalOpacity);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\nattribute vec4 a_OUTLINE_COLOR;\n#include <a_POSITION3>\nattribute vec2 a_ST;\n#include <u_ModelViewProjectionMatrix>\n#include <u_Resolution>\n#include <u_Bearing>\n#include <u_World>\nuniform mat4 u_Matrix;\n#include <c_fillV>\nvarying vec4 v_COLOR;varying float v_DiscardPixel;void main(){\n#ifdef M_CANVAS_2D\ngl_Position=u_Matrix*vec4(a_ST*1024.0,0,1);\n#else\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1);vec2 translate=u_translate;float translate_anchor=u_translate_anchor;if(translate_anchor==0.0){float sinA=sin(-u_Bearing);float cosA=cos(-u_Bearing);translate=vec2(translate[0]*cosA-translate[1]*sinA,translate[0]*sinA+translate[1]*cosA);}gl_Position.xy+=translate/vec2(u_Resolution.x/2.0,-u_Resolution.y/2.0)*gl_Position.w;v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_World;v_DiscardPixel=getVectorPointVisibilityValue(a_POSITION,u_ModelMatrix,u_CameraPosition,u_CameraDirection);\n#endif\nv_COLOR=a_OUTLINE_COLOR;}")},sphereFillOutlinePattern:{fragmentSource:f_("#define GLSLIFY 1\n#include <u_BaseColorSampler>\n#include <pragma_base_define>\n#include <pragma_fill_define>\n#include <c_fillF>\nvoid main(){\n#include <pragma_base_initialize>\n#include <pragma_fill_initialize>\nvec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_BaseColorSampler,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_BaseColorSampler,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 mixedColor=mix(color1,color2,u_mix);gl_FragColor=vec4(mixedColor.rgb,mixedColor.a*opacity);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <u_Resolution>\n#include <u_Bearing>\n#include <u_World>\n#include <pragma_base_define>\n#include <pragma_fill_define>\n#include <c_fillV>\nvoid main(){\n#include <pragma_base_initialize>\n#include <pragma_fill_initialize>\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);vec2 translate=u_translate;float translate_anchor=u_translate_anchor;if(translate_anchor==0.0){float sinA=sin(-u_Bearing);float cosA=cos(-u_Bearing);translate=vec2(translate[0]*cosA-translate[1]*sinA,translate[0]*sinA+translate[1]*cosA);}gl_Position.xy+=translate/vec2(u_Resolution.x/2.0,-u_Resolution.y/2.0)*gl_Position.w;v_pos_a=a_ST;v_pos_b=a_ST;v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_World;}")},sphereLine:{fragmentSource:f_("#define GLSLIFY 1\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <c_define>\n#include <c_lineF>\nvarying float v_DiscardPixel;void main(){\n#if !defined M_CANVAS_2D\nif(v_DiscardPixel<0.){discard;}\n#endif\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nfloat dist=length(v_Normal)*v_width2.s;float blur2=(blur+1.0/M_DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);if(v_Normal.x>0.0&&alpha<0.5){discard;}gl_FragColor=u_HasBorder ? vec4(bordercolor.rgb,bordercolor.a*(alpha*borderopacity)): vec4(color.rgb,color.a*(alpha*opacity));\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <u_Bearing>\nuniform mat4 u_Matrix;uniform mat2 u_PixelsToTileUnits;\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <c_define>\n#include <c_lineV>\nvarying float v_DiscardPixel;attribute vec2 a_extra_extrude;void main(){\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;mediump vec2 normal;\n#ifdef M_CANVAS_2D\nvec2 pos=floor(a_pos_normal*0.5);normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;\n#else\nnormal=vec2(a_NORMAL/2.0>=1.0 ? 1.0 : 0.0,mod(a_NORMAL,2.0)==1.0 ? 1.0 :-1.0);\n#endif\nv_Normal=normal;float constant=width==0.0 ? 0.0 : ANTIALIASING;float inset=0.0;float outset=0.0;float halfwidth=0.0;if(u_HasBorder){gapwidth=width/2.0;halfwidth=borderwidth;inset=gapwidth+constant;outset=gapwidth+halfwidth+constant;}else{halfwidth=width/2.0;gapwidth=gapwidth/2.0;inset=gapwidth+(gapwidth>0.0 ? constant : 0.0);outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+constant;}offset=-1.0*offset;if(u_HalfRender){if(normal_direction==1.){outset=2.0*(gapwidth+(normal.y>0. ? halfwidth : 0.))*(gapwidth>0.0 ? 2.0 : 1.0)+constant;}else{outset=2.0*(gapwidth+(normal.y<0. ? halfwidth : 0.))*(gapwidth>0.0 ? 2.0 : 1.0)+constant;}}mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist;\n#ifdef M_CANVAS_2D\ndist=outset*a_extrude*scale;\n#else\ndist=u_PixelMatrix*outset*a_extrude*scale;\n#endif\nvec2 extra_extrude=a_extra_extrude.xy-128.0;mediump vec2 extra_dist;\n#ifdef M_CANVAS_2D\nextra_dist=outset*extra_extrude*scale;\n#else\nextra_dist=u_PixelMatrix*outset*extra_extrude*scale;\n#endif\nmediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);\n#ifdef M_CANVAS_2D\nvec4 projected_extrude;if(u_HasBorder){projected_extrude=u_Matrix*vec4(dist*u_PixelsToTileUnits,0.0,0.0);}else{projected_extrude=u_Matrix*vec4((dist+extra_dist)*u_PixelsToTileUnits,0.0,0.0);}gl_Position=u_Matrix*vec4(pos+offset2*u_PixelsToTileUnits,0.0,1.0)+projected_extrude;v_gamma_scale=1.0;\n#else\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION.xyz,1.0);if(u_HasBorder){gl_Position.xy+=dist/u_GlUnitsToPixels*gl_Position.w;}else{gl_Position.xy+=(dist+extra_dist)/u_GlUnitsToPixels*gl_Position.w;}v_DiscardPixel=getVectorPointVisibilityValue(a_POSITION,u_ModelMatrix,u_CameraPosition,u_CameraDirection);vec2 translate=u_translate;float translate_anchor=u_translate_anchor;if(translate_anchor==0.0){float sinA=sin(-u_Bearing);float cosA=cos(-u_Bearing);translate=vec2(translate[0]*cosA-translate[1]*sinA,translate[0]*sinA+translate[1]*cosA);}gl_Position.xy+=(offset2+translate)/u_GlUnitsToPixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n}")},sphereLineSDF:{fragmentSource:f_("#define GLSLIFY 1\n#include <u_BaseColorSampler>\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <c_define>\n#include <c_lineF>\nuniform float u_sdfgamma;uniform float u_mix;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_DiscardPixel;void main(){\n#if !defined M_CANVAS_2D\nif(v_DiscardPixel<0.){discard;}\n#endif\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nfloat dist=length(v_Normal)*v_width2.s;float blur2=(blur+1.0/M_DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_BaseColorSampler,v_tex_a).a;float sdfdist_b=texture2D(u_BaseColorSampler,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);\n#ifdef M_SHADOW_VOLUME\ngl_FragColor=vec4(color.rgb,color.a*alpha*opacity);\n#else\ngl_FragColor=u_HasBorder ? vec4(bordercolor.rgb,bordercolor.a*(alpha*borderopacity)): vec4(color.rgb,color.a*(alpha*opacity));\n#endif\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <u_Bearing>\nuniform mat4 u_Matrix;uniform mat2 u_PixelsToTileUnits;\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <c_define>\n#include <c_lineV>\nuniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_DiscardPixel;void main(){\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\n#ifdef M_CANVAS_2D\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_Normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_Matrix*vec4(dist*u_PixelsToTileUnits,0.0,0.0);gl_Position=u_Matrix*vec4(pos+offset2*u_PixelsToTileUnits,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_GlUnitsToPixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);\n#else\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;mediump vec2 normal=vec2(a_NORMAL/2.0>=1.0 ? 1.0 : 0.0,mod(a_NORMAL,2.0)==1.0 ? 1.0 :-1.0);v_Normal=normal;if(u_HasBorder){gapwidth=width/2.0;width=borderwidth/2.0;}else{gapwidth=gapwidth/2.0;}float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_PixelMatrix*outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);gl_Position.xy+=dist/u_GlUnitsToPixels*gl_Position.w;v_DiscardPixel=getVectorPointVisibilityValue(a_POSITION,u_ModelMatrix,u_CameraPosition,u_CameraDirection);vec2 translate=u_translate;float translate_anchor=u_translate_anchor;if(translate_anchor==0.0){float sinA=sin(-u_Bearing);float cosA=cos(-u_Bearing);translate=vec2(translate[0]*cosA-translate[1]*sinA,translate[0]*sinA+translate[1]*cosA);}gl_Position.xy+=(offset2+translate)/u_GlUnitsToPixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n#endif\n}")},sphereLinePattern:{fragmentSource:f_("#define GLSLIFY 1\n#include <u_BaseColorSampler>\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <c_define>\n#include <c_lineF>\nuniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;varying float v_width;varying float v_linesofar;varying float v_DiscardPixel;\n#pragma minemap: define lowp vec4 pattern_from\n#pragma minemap: define lowp vec4 pattern_to\n#pragma minemap: define lowp float pixel_ratio_from\n#pragma minemap: define lowp float pixel_ratio_to\nvoid main(){\n#pragma minemap: initialize mediump vec4 pattern_from\n#pragma minemap: initialize mediump vec4 pattern_to\n#pragma minemap: initialize lowp float pixel_ratio_from\n#pragma minemap: initialize lowp float pixel_ratio_to\nif(v_DiscardPixel<0.){discard;}\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float dist=length(v_Normal)*v_width2.s;float blur2=(blur+1.0/M_DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x,1.0);float x_b=mod(v_linesofar/pattern_size_b.x,1.0);float y=0.5*v_Normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));color=mix(texture2D(u_BaseColorSampler,pos_a),texture2D(u_BaseColorSampler,pos_b),u_fade);\n#ifdef M_SHADOW_VOLUME\ngl_FragColor=vec4(color.rgb,color.a*alpha*opacity);\n#else\ngl_FragColor=u_HasBorder ? vec4(bordercolor.rgb,bordercolor.a*(alpha*borderopacity)): vec4(color.rgb,color.a*(alpha*opacity));\n#endif\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <u_Bearing>\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <c_define>\n#include <c_lineV>\nvarying float v_linesofar;varying float v_DiscardPixel;varying float v_width;\n#pragma minemap: define lowp vec4 pattern_from\n#pragma minemap: define lowp vec4 pattern_to\n#pragma minemap: define lowp float pixel_ratio_from\n#pragma minemap: define lowp float pixel_ratio_to\nvoid main(){\n#pragma minemap: initialize mediump vec4 pattern_from\n#pragma minemap: initialize mediump vec4 pattern_to\n#pragma minemap: initialize lowp float pixel_ratio_from\n#pragma minemap: initialize lowp float pixel_ratio_to\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;mediump vec2 normal=vec2(a_NORMAL/2.0>=1.0 ? 1.0 : 0.0,mod(a_NORMAL,2.0)==1.0 ? 1.0 :-1.0);v_Normal=normal;if(u_HasBorder){gapwidth=width/2.0;width=borderwidth/2.0;}else{gapwidth=gapwidth/2.0;}float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_PixelMatrix*outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);gl_Position.xy+=dist/u_GlUnitsToPixels*gl_Position.w;v_DiscardPixel=getVectorPointVisibilityValue(a_POSITION,u_ModelMatrix,u_CameraPosition,u_CameraDirection);vec2 translate=u_translate;float translate_anchor=u_translate_anchor;if(translate_anchor==0.0){float sinA=sin(-u_Bearing);float cosA=cos(-u_Bearing);translate=vec2(translate[0]*cosA-translate[1]*sinA,translate[0]*sinA+translate[1]*cosA);}gl_Position.xy+=(offset2+translate)/u_GlUnitsToPixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n}")},sphereLineGradient:{fragmentSource:f_("#define GLSLIFY 1\n#include <u_BaseColorSampler>\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <c_define>\n#include <c_lineF>\n#include <v_TexCoord2>\nvarying float v_DiscardPixel;void main(){if(v_DiscardPixel<0.){discard;}\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nfloat dist=length(v_Normal)*v_width2.s;float blur2=(blur+1.0/M_DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);color=texture2D(u_BaseColorSampler,v_TexCoord);\n#ifdef M_SHADOW_VOLUME\ngl_FragColor=vec4(color.rgb,color.a*alpha*opacity);\n#else\ngl_FragColor=u_HasBorder ? vec4(bordercolor.rgb,bordercolor.a*(alpha*borderopacity)): vec4(color.rgb,color.a*(alpha*opacity));\n#endif\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <u_Bearing>\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <c_define>\n#include <c_lineV>\nattribute float a_uv_x;attribute float a_split_index;uniform float u_image_height;\n#include <v_TexCoord2>\nvarying float v_DiscardPixel;void main(){\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_TexCoord=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);mediump vec2 normal=vec2(a_NORMAL/2.0>=1.0 ? 1.0 : 0.0,mod(a_NORMAL,2.0)==1.0 ? 1.0 :-1.0);v_Normal=normal;if(u_HasBorder){gapwidth=width/2.0;width=borderwidth/2.0;}else{gapwidth=gapwidth/2.0;}float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_PixelMatrix*outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);gl_Position.xy+=dist/u_GlUnitsToPixels*gl_Position.w;v_DiscardPixel=getVectorPointVisibilityValue(a_POSITION,u_ModelMatrix,u_CameraPosition,u_CameraDirection);vec2 translate=u_translate;float translate_anchor=u_translate_anchor;if(translate_anchor==0.0){float sinA=sin(-u_Bearing);float cosA=cos(-u_Bearing);translate=vec2(translate[0]*cosA-translate[1]*sinA,translate[0]*sinA+translate[1]*cosA);}gl_Position.xy+=(offset2+translate)/u_GlUnitsToPixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n}")},sphereHeatmap:{fragmentSource:f_("#define GLSLIFY 1\n#include <pragma_heatmap_define>\n#include <c_define>\nuniform highp float u_Intensity;uniform sampler2D u_color_ramp;\n#include <u_Opacity>\nvarying vec2 v_extrude;void main(){\n#include <pragma_heatmap_initialize>\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_Intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,0.0,1.0);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <pragma_heatmap_define>\n#include <c_define>\nattribute vec3 a_pos_vec3;attribute vec2 a_extrude;\n#include <u_ModelViewProjectionMatrix>\nuniform float u_extrude_scale;\n#include <u_Opacity>\nuniform float u_Intensity;\n#include <u_Resolution>\n#include <u_PixelMatrix>\nvarying float v_value;varying vec2 v_extrude;void main(void){\n#include <pragma_heatmap_initialize>\nfloat S=sqrt(-2.0*log(ZERO/weight/u_Intensity/GAUSS_COEF))/3.0;v_extrude=S*a_extrude;vec2 scaled_extrude=u_PixelMatrix*S*a_extrude;vec4 temppos=vec4(a_pos_vec3,1);vec4 trans_pos=u_ModelViewProjectionMatrix*temppos;vec2 screen_pos=vec2(trans_pos.x/trans_pos.w*u_Resolution.y/2.0+scaled_extrude.x*radius*u_Resolution.y/u_Resolution.x,trans_pos.y/trans_pos.w*u_Resolution.y/2.0+scaled_extrude.y*radius);gl_Position=vec4(screen_pos*trans_pos.w*2.0/u_Resolution.y,trans_pos.z,trans_pos.w);}")},heatmapTexture:{fragmentSource:f_("#define GLSLIFY 1\n#include <u_BaseColorSampler>\n#include <v_TexCoord2>\n#include <c_define>\nuniform highp float u_Intensity;uniform sampler2D u_color_ramp;\n#include <u_Opacity>\nvarying vec2 v_extrude;void main(){float t=texture2D(u_BaseColorSampler,v_TexCoord).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=vec4(color.rgb,color.a*u_Opacity);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION2>\n#include <u_ModelViewProjectionMatrix>\n#include <v_TexCoord2>\n#include <c_define>\nuniform float u_extrude_scale;\n#include <u_Opacity>\nuniform float u_Intensity;\n#include <u_World>\nvarying vec2 v_extrude;void main(){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION*u_World,0,1);v_TexCoord.x=a_POSITION.x;v_TexCoord.y=1.0-a_POSITION.y;}")},heatmap3DTexture:{fragmentSource:f_("#define GLSLIFY 1\n#include <u_BaseColorSampler>\n#include <u_Opacity>\nuniform sampler2D u_color_ramp;\n#include <v_TexCoord2>\nvarying float v_Alpha;void main(){if(v_Alpha==-1.0){discard;}vec4 color=texture2D(u_color_ramp,vec2(v_Alpha,0.5));gl_FragColor=vec4(color.rgb,color.a*u_Opacity);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}"),vertexSource:f_("precision highp float;\n#define GLSLIFY 1\n#include <u_ModelViewProjectionMatrix>\n#include <u_BaseColorSampler>\nuniform float u_HeightFactor;uniform vec4 u_Bezier;uniform mat4 u_ViewMatrix;uniform mat4 u_ProjectionMatrix;uniform mat4 u_InverseProjection;uniform mat4 u_InvertViewMatrix;\n#include <a_POSITION3>\n#include <a_TEXCOORD_0>\nattribute vec3 a_NORMAL;\n#include <v_TexCoord2>\nvarying float v_Alpha;varying vec3 v_Normal;\n#include <fn_rayEllipsoidIntersectionInterval>\n#include <fn_getEllipsoidNormal>\nvec2 toBezierInner(float t,vec2 P0,vec2 P1,vec2 P2,vec2 P3){float t2=t*t;float one_minus_t=1.0-t;float one_minus_t2=one_minus_t*one_minus_t;return(P0*one_minus_t2*one_minus_t+P1*3.0*t*one_minus_t2+P2*3.0*t2*one_minus_t+P3*t2*t);}vec2 toBezier(float t,vec4 p){return toBezierInner(t,vec2(0.0,0.0),vec2(p.x,p.y),vec2(p.z,p.w),vec2(1.0,1.0));}float interpolate(float a,float b,float t){return(a*(1.0-t))+(b*t);}void main(){v_TexCoord=a_TEXCOORD_0;v_Alpha=texture2D(u_BaseColorSampler,v_TexCoord).r;vec4 spacePos=u_InverseProjection*vec4(a_POSITION,1.0);spacePos=spacePos/spacePos.w;spacePos.w=0.0;vec3 rayDir=(u_InvertViewMatrix*spacePos).xyz;vec3 normalizedRayDir=normalize(rayDir);vec2 interval=rayEllipsoidIntersectionInterval(u_CameraPosition,normalizedRayDir);if(interval.x==-infinity){v_Alpha=-1.0;gl_Position=vec4(a_POSITION,1);return;}float height1=toBezier(v_Alpha,u_Bezier).y;float height0=toBezier(0.0,u_Bezier).y;float height=(height1-height0);if(height<0.0){height=0.0;}height*=u_HeightFactor;vec3 cartesian=u_CameraPosition+normalizedRayDir*interval.x;vec3 normal=getEllipsoidNormal(cartesian);vec3 position=normal*height+cartesian-u_CameraPosition;vec4 viewPosition=u_ViewMatrix*vec4(position,1.0);gl_Position=u_ProjectionMatrix*viewPosition;}")},sphereCircle:{fragmentSource:f_("#define GLSLIFY 1\n#include <pragma_circle_define>\nvarying vec3 v_data;void main(){\n#include <pragma_circle_initialize>\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width<0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));vec4 tempColor=mix(vec4(color.rgb,color.a*opacity),vec4(stroke_color.rgb,stroke_color.a*stroke_opacity),color_t);tempColor.a*=opacity_t;gl_FragColor=tempColor;\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION3>\nattribute vec2 a_extra;\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelMatrix>\n#include <u_PixelMatrix>\nuniform vec2 u_GlUnitsToPixels;varying vec3 v_data;\n#include <pragma_circle_define>\n#include <c_define>\nvoid main(void){\n#include <pragma_circle_initialize>\nvec2 extrude=a_extra;mediump vec2 dist=u_PixelMatrix*(radius+stroke_width)*extrude;gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION.xyz,1.0);gl_Position.xy+=dist/u_GlUnitsToPixels*gl_Position.w;lowp float antialiasblur=1.0/M_DEVICE_PIXEL_RATIO/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}")},sphereExtrusion:{fragmentSource:f_("#define GLSLIFY 1\n#include <c_extrusionF>\n#include <c_define>\n#include <pragma_extrusion_define>\n#include <s_LightMaterial>\n#include <fn_phong>\nuniform highp sampler2D u_model_clippingPlanes;uniform vec4 u_model_clippingPlanesEdgeStyle;uniform mat4 u_model_clippingPlanesMatrix;\n#include <u_Viewport>\nuniform mat4 u_ViewportTransformation;uniform mat4 u_InverseProjection;\n#include <u_PixelRatio>\n#include <u_CurrentFrustum>\n#include <u_FrustumPlanes>\n#include <fn_primitiveClippingPlanes>\nuniform bool u_SelfBloom;uniform float u_Time;uniform float u_BloomHeight;uniform float u_PureColorHeight;uniform float u_BloomSpeed;uniform float u_GlowWidth;varying vec4 v_ModelPos;varying vec4 v_RelativePos;\n#include <u_LightMaterial>\nuniform float u_Shininess;uniform float u_Reflectivity;uniform vec3 u_sunLightGlobal;uniform float u_Roughness;varying vec3 v_LocalPosition;bool oppositeSigns(float x,float y){return(x<=0.&&y>=0.)||(x>=0.&&y<=0.);}\n#include <fn_writeLogDepth>\nvoid main(){\n#include <pragma_extrusion_initialize>\nif(color.a==0.||opacity==0.){discard;}vec4 finalColor=v_color;\n#ifdef M_OVERDRAW_INSPECTOR\nfinalColor=vec4(1.0);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n#ifdef M_HAS_CLIPPING_PLANES\nmodelClippingPlanesStage(finalColor);\n#endif\n#ifdef M_PHONG_LIGHT\nfinalColor=finalColor*vec4(phong(u_Reflectivity,v_Normal,u_sunLightGlobal,v_LocalPosition,u_Shininess,u_Roughness),1.0);\n#endif\nif(u_SelfBloom){float earthR=sqrt(v_RelativePos.x*v_RelativePos.x+v_RelativePos.y*v_RelativePos.y+v_RelativePos.z*v_RelativePos.z);float v_R_h=sqrt(v_ModelPos.x*v_ModelPos.x+v_ModelPos.y*v_ModelPos.y+v_ModelPos.z*v_ModelPos.z);float real_h=v_R_h-earthR;float dt_a12=clamp((real_h/u_PureColorHeight),0.0,1.0);finalColor*=vec4(dt_a12,dt_a12,dt_a12,1.0);float dt_a13=fract(u_Time/u_BloomSpeed);float dt_h=clamp((real_h/u_BloomHeight),0.0,1.0);dt_a13=abs(dt_a13-0.5)*2.0;float dt_diff=step(u_GlowWidth,abs(dt_h-dt_a13));finalColor.rgb+=finalColor.rgb*(1.0-dt_diff);}gl_FragColor=finalColor;}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <u_ViewProjectionMatrix>\n#include <u_ModelMatrix>\n#include <u_NormalMatrix>\n#include <u_Resolution>\n#include <u_Bearing>\n#include <c_define>\n#include <c_extrusionV>\n#include <pragma_extrusion_define>\n#ifdef M_ANS_ENABLED\nattribute vec3 a_ANS_NORMAL_WITH_LENGTH;attribute vec3 a_ANS_BASE_POSITION;attribute float a_ANS_POS_TIME_0;attribute float a_ANS_POS_TIME_1;uniform float u_ANS_CurrentTime;\n#endif\nvarying vec4 v_ModelPos;varying vec4 v_RelativePos;varying vec3 v_LocalPosition;\n#include <fn_vertexLogDepth>\nuniform vec3 u_lightPos;varying vec4 v_color;void main(){\n#include <pragma_extrusion_initialize>\nvec4 pos=u_ModelMatrix*vec4(a_POSITION,1.0);v_LocalPosition=vec3(pos.xyz)/pos.w;v_Normal=normalize(u_NormalMatrix*a_NORMAL_ED.xyz);\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n#ifdef M_ANS_ENABLED\nfloat weight0=(u_ANS_CurrentTime-a_ANS_POS_TIME_0)/(a_ANS_POS_TIME_1-a_ANS_POS_TIME_0);weight0=weight0>1.0 ? 1.0 : weight0;vec3 animatedPos=a_ANS_BASE_POSITION+a_ANS_NORMAL_WITH_LENGTH*weight0;gl_Position=u_ModelViewProjectionMatrix*vec4(animatedPos,1);\n#else\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1);\n#endif\nvec2 translate=u_translate;float translate_anchor=u_translate_anchor;if(translate_anchor==0.0){float sinA=sin(-u_Bearing);float cosA=cos(-u_Bearing);translate=vec2(translate[0]*cosA-translate[1]*sinA,translate[0]*sinA+translate[1]*cosA);}gl_Position.xy+=translate/vec2(u_Resolution.x/2.0,-u_Resolution.y/2.0)*gl_Position.w;vec3 normal=a_NORMAL_ED.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float u_lightintensity=0.5;float u_vertical_gradient=1.0;vec3 u_lightcolor=vec3(1.0);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);vec4 ambientColor=color+ambientlight;float directional=clamp(dot(normal/16384.0,u_lightPos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if(normal.y!=0.0){directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(ambientColor.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(ambientColor.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(ambientColor.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color.a=opacity;v_ModelPos=u_ModelMatrix*vec4(a_POSITION,1.0);v_RelativePos=u_ModelMatrix*vec4(0.0,0.0,0.0,1.0);v_RelativePos=v_RelativePos/v_RelativePos.w;v_ModelPos=v_ModelPos/v_ModelPos.w;}")},sphereExtrusionPattern:{fragmentSource:f_("#define GLSLIFY 1\n#include <u_BaseColorSampler>\nuniform sampler2D u_TopTexture;uniform vec2 u_offset;uniform float u_rotation;uniform float u_scale;\n#include <v_TexCoord2>\n#include <c_extrusionF>\n#include <pragma_extrusion_define>\n#include <s_LightMaterial>\n#include <fn_phong>\n#include <fn_rotateTexCoord>\n#include <u_LightMaterial>\nvarying vec4 modelPos;bool oppositeSigns(float x,float y){return(x<=0.&&y>=0.)||(x>=0.&&y<=0.);}\n#pragma minemap: define lowp vec4 pattern_from\n#pragma minemap: define lowp vec4 pattern_to\n#pragma minemap: define lowp float pixel_ratio_from\n#pragma minemap: define lowp float pixel_ratio_to\n#pragma minemap: define lowp vec4 top_pattern_from\n#pragma minemap: define lowp vec4 top_pattern_to\n#pragma minemap: define lowp float top_pixel_ratio_from\n#pragma minemap: define lowp float top_pixel_ratio_to\nvoid main(){\n#include <pragma_extrusion_initialize>\n#pragma minemap: initialize mediump vec4 pattern_from\n#pragma minemap: initialize mediump vec4 pattern_to\n#pragma minemap: initialize lowp float pixel_ratio_from\n#pragma minemap: initialize lowp float pixel_ratio_to\n#pragma minemap: initialize mediump vec4 top_pattern_from\n#pragma minemap: initialize mediump vec4 top_pattern_to\n#pragma minemap: initialize lowp float top_pixel_ratio_from\n#pragma minemap: initialize lowp float top_pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 top_pattern_tl_a=top_pattern_from.xy;vec2 top_pattern_br_a=top_pattern_from.zw;vec2 top_pattern_tl_b=top_pattern_to.xy;vec2 top_pattern_br_b=top_pattern_to.zw;vec4 finalFragColor=vec4(1.0);if(v_Top!=0.){if(u_RenderTopTex){vec2 imageCoord=mod(vec2(v_TexCoord.x,1.0-v_TexCoord.y),1.0);vec2 pos=mix(top_pattern_tl_a/u_top_pattern_size_a,top_pattern_br_a/u_top_pattern_size_a,imageCoord);vec4 color1=texture2D(u_TopTexture,pos);vec2 imageCoord_b=mod(vec2(v_TexCoord.x,1.0-v_TexCoord.y),1.0);vec2 pos2=mix(top_pattern_tl_b/u_top_pattern_size_b,top_pattern_br_b/u_top_pattern_size_b,imageCoord_b);vec4 color2=texture2D(u_TopTexture,pos2);vec4 mixedColor=mix(color1,color2,u_mix);finalFragColor=mixedColor;}else{finalFragColor=vec4(color.rgb,color.a*opacity);}}else{if(u_RenderBodyTex){vec2 imageCoord=mod(vec2(v_TexCoord.x,1.0-v_TexCoord.y),1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imageCoord);vec4 color1=texture2D(u_BaseColorSampler,pos);vec2 imageCoord_b=mod((vec2(v_TexCoord.x,1.0-v_TexCoord.y)+u_offset)/u_scale,1.0);vec2 finalImageCoord=rotateTexCoord(imageCoord_b,u_rotation);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,finalImageCoord);vec4 color2=texture2D(u_BaseColorSampler,pos2);vec4 mixedColor=mix(color1,color2,u_mix);finalFragColor=mixedColor;}else{finalFragColor=vec4(color.rgb,color.a*opacity);}}\n#ifdef M_PHONG_LIGHT\nvec3 normal=normalize(v_Normal);vec4 phongColor=vec4(phong(modelPos.xyz,normal,u_LightMaterial,u_SunLightDirectionLocal,u_CameraPosition),1.0);vec4 baseColor=vec4(finalFragColor.rgb,opacity*finalFragColor.a);finalFragColor=baseColor*phongColor;\n#else\nfinalFragColor=vec4(finalFragColor.rgb,opacity*finalFragColor.a);\n#endif\ngl_FragColor=finalFragColor;\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelMatrix>\n#include <u_NormalMatrix>\n#include <u_Resolution>\n#include <u_Bearing>\n#include <pragma_extrusion_define>\n#include <v_TexCoord2>\n#include <c_extrusionV>\n#pragma minemap: define lowp vec4 pattern_from\n#pragma minemap: define lowp vec4 pattern_to\n#pragma minemap: define lowp float pixel_ratio_from\n#pragma minemap: define lowp float pixel_ratio_to\n#pragma minemap: define lowp vec4 top_pattern_from\n#pragma minemap: define lowp vec4 top_pattern_to\n#pragma minemap: define lowp float top_pixel_ratio_from\n#pragma minemap: define lowp float top_pixel_ratio_to\nvoid main(){\n#include <pragma_extrusion_initialize>\n#pragma minemap: initialize mediump vec4 pattern_from\n#pragma minemap: initialize mediump vec4 pattern_to\n#pragma minemap: initialize lowp float pixel_ratio_from\n#pragma minemap: initialize lowp float pixel_ratio_to\n#pragma minemap: initialize mediump vec4 top_pattern_from\n#pragma minemap: initialize mediump vec4 top_pattern_to\n#pragma minemap: initialize lowp float top_pixel_ratio_from\n#pragma minemap: initialize lowp float top_pixel_ratio_to\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1);vec2 translate=u_translate;float translate_anchor=u_translate_anchor;if(translate_anchor==0.0){float sinA=sin(-u_Bearing);float cosA=cos(-u_Bearing);translate=vec2(translate[0]*cosA-translate[1]*sinA,translate[0]*sinA+translate[1]*cosA);}gl_Position.xy+=translate/vec2(u_Resolution.x/2.0,-u_Resolution.y/2.0)*gl_Position.w;v_Normal=u_NormalMatrix*a_NORMAL_ED.xyz;v_TexCoord=a_ST.xy;v_Top=a_ST.z;}")},sphereTracking:{fragmentSource:f_("#define GLSLIFY 1\n#include <pragma_line_define>\n#include <c_define>\n#include <c_lineF>\nuniform float u_start;uniform float u_end;uniform float u_segments;uniform bool u_reverse;uniform bool u_reserve;varying float v_seq;\n#ifdef M_ANS_ENABLED\nuniform float u_ANS_CurrentTime;varying float v_ANS_tripLength;varying float v_ANS_time;varying float v_ANS_trip_total_time;\n#endif\nvoid main(){\n#include <pragma_line_initialize>\nmediump float drive_opacity=1.0;float dist=length(v_Normal)*v_width2.s;float blur2=(blur+1.0/M_DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 tmpColor=vec4(color.xyz,1.0);\n#ifdef M_ANS_ENABLED\nfloat loopDelta=floor(u_ANS_CurrentTime/v_ANS_trip_total_time);float independentCurrentTime=u_ANS_CurrentTime-v_ANS_trip_total_time*loopDelta;if(v_ANS_time>independentCurrentTime||(v_ANS_time<independentCurrentTime-v_ANS_tripLength)){discard;}float ansOpacity=1.0-(independentCurrentTime-v_ANS_time)/v_ANS_tripLength;gl_FragColor=vec4(tmpColor.rgb,tmpColor.a*(alpha*opacity)*ansOpacity);\n#else\nif(u_reserve){if(v_seq>u_end){discard;}}else{if(v_seq<u_start||v_seq>u_end){discard;}drive_opacity=(v_seq-u_start)/u_segments;if(u_reverse){drive_opacity=1.0-drive_opacity;}}gl_FragColor=vec4(tmpColor.rgb,tmpColor.a*(alpha*opacity)*drive_opacity);\n#endif\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <pragma_line_define>\n#include <c_define>\n#include <c_lineV>\nattribute vec2 a_normal_vec2;attribute float a_seq;varying float v_seq;\n#ifdef M_ANS_ENABLED\nattribute float a_ANS_POS_TIME;attribute float a_ANS_TRIP_TOTAL_TIME;attribute float a_ANS_TRIP_LENGTH;varying float v_ANS_tripLength;varying float v_ANS_time;varying float v_ANS_trip_total_time;\n#endif\nvoid main(){\n#include <pragma_line_initialize>\n#ifdef M_ANS_ENABLED\nv_ANS_tripLength=a_ANS_TRIP_LENGTH;v_ANS_time=a_ANS_POS_TIME;v_ANS_trip_total_time=a_ANS_TRIP_TOTAL_TIME;\n#endif\nv_seq=a_seq;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;mediump vec2 normal=a_normal_vec2;v_Normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_PixelMatrix*outset*a_extrude*scale;gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);gl_Position.xy+=dist/u_GlUnitsToPixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}")},sphereSprite:{fragmentSource:f_("#define GLSLIFY 1\n#include <pragma_base_define>\n#include <c_define>\n#include <c_lineF>\nvarying float v_opacity;varying float v_discard;void main(){\n#include <pragma_base_initialize>\nif(v_discard<0.0){discard;}float opacity_m=v_opacity;float dist=length(v_Normal)*v_width2.s;float blur2=(blur+1.0/M_DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=vec4(color.rgb,color.a*(alpha*opacity)*opacity_m);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <pragma_line_define>\n#include <c_define>\n#include <c_lineV>\nattribute vec2 a_normal_vec2;attribute vec3 a_extra_m;uniform float u_count;varying float v_opacity;varying float v_discard;void main(){\n#include <pragma_line_initialize>\nvec3 f_extra_m=vec3(a_extra_m[0]*3.0/255.0,a_extra_m[1],a_extra_m[2]);float status=f_extra_m[2];float link_seq=f_extra_m[1];v_opacity=f_extra_m[0];int speed1;int speed2;int speed3;int speed4;if(speed_factor==1.0){speed1=int(u_count)-(int(u_count)/20)*20;}else if(speed_factor==2.0){speed2=int(u_count)-(int(u_count)/80)*80;}else if(speed_factor==3.0){speed3=int(u_count)-(int(u_count)/150)*150;}else{speed4=int(u_count)-(int(u_count)/240)*240;}speed1=speed1/2;speed2=speed2/8;speed3=speed3/15;speed4=speed4/24;if(status==1.0){if(link_seq!=float(speed1)){v_discard=-100.0;}else{v_discard=100.0;}}else if(status==2.0){if(link_seq!=float(speed2)){v_discard=-100.0;}else{v_discard=100.0;}}else if(status==3.0){if(link_seq!=float(speed3)){v_discard=-100.0;}else{v_discard=100.0;}}else if(status==4.0){if(link_seq!=float(speed4)){v_discard=-100.0;}else{v_discard=100.0;}}vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;mediump vec2 normal=a_normal_vec2;v_Normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_PixelMatrix*outset*a_extrude*scale;gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);gl_Position.xy+=dist/u_GlUnitsToPixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}")},sphereSpritePattern:{fragmentSource:f_("#define GLSLIFY 1\n#include <u_BaseColorSampler>\n#include <u_PixelRatio>\n#pragma minemap: define lowp vec4 pattern_from\n#pragma minemap: define lowp vec4 pattern_to\n#pragma minemap: define lowp float pixel_ratio_from\n#pragma minemap: define lowp float pixel_ratio_to\n#pragma minemap: define lowp float speed\n#pragma minemap: define lowp float move_direction\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <c_define>\n#include <c_lineF>\nuniform vec2 u_texsize;uniform float u_count;uniform mediump vec3 u_scale;varying float v_linesofar;varying float v_width;void main(){\n#pragma minemap: initialize mediump vec4 pattern_from\n#pragma minemap: initialize mediump vec4 pattern_to\n#pragma minemap: initialize lowp float pixel_ratio_from\n#pragma minemap: initialize lowp float pixel_ratio_to\n#pragma minemap: initialize lowp float speed\n#pragma minemap: initialize lowp float move_direction\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_Normal)*v_width2.s;float blur2=(blur+1.0/u_PixelRatio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_Normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));float dir=move_direction-2.0<0.01 ?-1.0 : move_direction-3.0<0.01 ? 1.0 :-1.0;float count=u_count*speed*dir;color=texture2D(u_BaseColorSampler,vec2(mod(pos_a.x+count,1.0),pos_a.y+0.1));\n#ifdef M_SHADOW_VOLUME\ngl_FragColor=color;\n#else\ngl_FragColor=color;\n#endif\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#pragma minemap: define lowp vec4 pattern_from\n#pragma minemap: define lowp vec4 pattern_to\n#pragma minemap: define lowp float pixel_ratio_from\n#pragma minemap: define lowp float pixel_ratio_to\n#pragma minemap: define lowp float speed\n#pragma minemap: define lowp float move_direction\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <c_define>\n#include <c_lineV>\nvarying float v_linesofar;varying float v_width;void main(){\n#pragma minemap: initialize mediump vec4 pattern_from\n#pragma minemap: initialize mediump vec4 pattern_to\n#pragma minemap: initialize lowp float pixel_ratio_from\n#pragma minemap: initialize lowp float pixel_ratio_to\n#pragma minemap: initialize lowp float speed\n#pragma minemap: initialize lowp float move_direction\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;mediump vec2 normal=vec2(a_NORMAL/2.0>=1.0 ? 1.0 : 0.0,mod(a_NORMAL,2.0)==1.0 ? 1.0 :-1.0);v_Normal=normal;if(u_HasBorder){gapwidth=width/2.0;width=borderwidth/2.0;}else{gapwidth=gapwidth/2.0;}float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_PixelMatrix*outset*a_extrude*scale;gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);gl_Position.xy+=dist/u_GlUnitsToPixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n}")},gltfPBR:{fragmentSource:f_(l_),vertexSource:f_(c_)},gltfPBRI3DM:{fragmentSource:f_(l_),vertexSource:f_(c_)},StandardMaterial:{fragmentSource:f_("#define GLSLIFY 1\n#include <c_define>\n#include <fn_getBlinnPhongColor>\n#include <fn_writeLogDepth>\n#include <s_LightMaterial>\n#include <fn_phong>\n#include <u_LightMaterial>\n#include <fn_encodeFloat>\n#include <u_ModelMatrix>\n#include <v_LocalPosition>\n#include <fn_pixelInVideo>\n#include <u_Color4>\n#include <u_Opacity>\n#include <v_TexCoord2>\n#include <v_Normal3>\nvarying vec4 v_ModelPos;\n#ifdef M_HAS_BASECOLORMAP\n#include <u_BaseColorSampler>\n#endif\nuniform sampler2D u_MaskSample;\n#include <u_ClipMatrix>\nuniform vec2 u_TextureSize;uniform bool u_ClipVideo;\n#if (defined M_NUM_VIDEOS) && (M_NUM_VIDEOS>0)\nuniform highp mat4 u_VIDEOMATCH_MVPMATRIX[M_NUM_VIDEOS];uniform highp vec3 u_VIDEOMATCH_RTP[M_NUM_VIDEOS];uniform bool u_HAS_VIDEOMATCHMAP[M_NUM_VIDEOS];uniform float u_Alpha[M_NUM_VIDEOS];uniform highp sampler2D u_VideoSampler[M_NUM_VIDEOS];uniform bool u_ActiveClipVideoTexture[M_NUM_VIDEOS];uniform vec3 u_ClipColors[M_NUM_VIDEOS];\n#endif\n#ifdef M_VERTEX_COLOR\nvarying vec3 v_Color;\n#endif\n#define PI 3.141592653589793\n#include <u_FrustumPlanes>\n#include <u_CurrentFrustum>\n#include <u_Viewport>\nuniform mat4 u_ViewportTransformation;uniform mat4 u_InverseProjection;uniform float u_PixelRatio;\n#include <fn_readDepth>\nvarying vec4 v_sphericalExtents;varying vec3 v_uMaxAndInverseDistance;varying vec3 v_vMaxAndInverseDistance;varying vec3 v_uvMinAndSphericalLongitudeRotation;uniform sampler2D u_DepthTexture;uniform mat4 u_InvertViewMatrix;\n#ifdef M_HAS_CLIPPING_PLANES\nuniform highp sampler2D u_model_clippingPlanes;uniform vec4 u_model_clippingPlanesEdgeStyle;uniform mat4 u_model_clippingPlanesMatrix;\n#include <fn_primitiveClippingPlanes>\n#else\n#include <fn_windowToEyeCoordinates>\n#include <fn_branchFreeTernary>\n#endif\n#include <fn_computePolygonAdaptUV>\nuniform vec4 u_TexOffsetScale;uniform vec3 u_TexRotate;uniform float u_FrameTime;uniform float u_Speed;mat2 rotate(float angle){return mat2(cos(angle),-sin(angle),sin(angle),cos(angle));}float rayLine(vec2 st,float angle,float r,float w){st*=rotate(-angle);return length(st)<r&&st.x>0.0? smoothstep(w,0.0,abs(st.y)): 0.0;}float sector(vec2 st,float r,float endAng,float offset){float d=length(st);float cosVal=st.y/d;float ang=acos(cosVal);if(st.x<0.0)ang=2.0*PI-ang;ang-=offset;ang=mod(ang,2.*PI);if(ang<0.0)ang+=2.*PI;float percent=ang/endAng;return d<r&&ang<endAng ? percent:0.0;}void main(){vec4 color=vec4(0.0);\n#ifdef M_SHADOW_VOLUME\n#ifdef M_SHADOWVOLUME_DISCARD\nfloat flag=texture2D(u_DepthTexture,gl_FragCoord.xy/u_Viewport.zw).g;if(flag>0.1){discard;}\n#endif\n#endif\n#ifdef M_HAS_BASECOLORMAP\nvec2 finalTexCoord=u_TexOffsetScale.zw*v_TexCoord;finalTexCoord=finalTexCoord-u_TexRotate.xy;finalTexCoord=vec2(finalTexCoord.x*cos(u_TexRotate.z)-finalTexCoord.y*sin(u_TexRotate.z),finalTexCoord.x*sin(u_TexRotate.z)+finalTexCoord.y*cos(u_TexRotate.z));finalTexCoord=finalTexCoord+u_TexRotate.xy;finalTexCoord+=u_TexOffsetScale.xy;\n#ifdef M_HAS_SHADOWVOLUME\nvec2 uv=computePolygonAdaptUV();color=texture2D(u_BaseColorSampler,uv);\n#else\ncolor=texture2D(u_BaseColorSampler,finalTexCoord);\n#endif\n#else\nvec2 st;\n#ifdef M_HAS_RADARSCAN\n#ifdef M_HAS_SHADOWVOLUME\nvec2 realUv=computePolygonAdaptUV();st=realUv-vec2(0.5);\n#else\nst=v_TexCoord-vec2(0.5);\n#endif\nfloat angle=u_FrameTime*u_Speed;color=mix(color,u_Color,rayLine(st,-angle,0.5,0.005));float endAng=PI/2.5;float offset=angle+PI/2.0-PI/2.5;color=mix(color,u_Color,sector(st,0.5,endAng,offset));\n#else\n#ifdef M_HAS_DIFFUSINGRING\n#ifdef M_HAS_SHADOWVOLUME\nvec2 realUv=computePolygonAdaptUV();st=realUv-vec2(0.5);\n#else\nst=v_TexCoord-vec2(0.5);\n#endif\nfloat dis=length(st);float distance=u_FrameTime*u_Speed;if(dis>fract(distance)*0.5){discard;}else{float opacity=u_Color.a*dis/fract(distance)*2.0;color=vec4(u_Color.r,u_Color.g,u_Color.b,opacity);}\n#else\ncolor=u_Color;\n#endif\n#endif\n#endif\nvec4 finalFragColor=vec4(color.rgb,u_Opacity*color.a);gl_FragColor=finalFragColor;\n#if (defined M_NUM_VIDEOS) && (M_NUM_VIDEOS>0)\nfor(int i=0;i<M_NUM_VIDEOS;i++){if(u_HAS_VIDEOMATCHMAP[i]){if(u_ClipVideo){if(pixelInVideo(u_VIDEOMATCH_MVPMATRIX[i],u_VIDEOMATCH_RTP[i],u_ModelMatrix,v_LocalPosition,u_VideoSampler[i],u_Alpha[i],u_ClipMatrix,u_MaskSample,u_TextureSize,u_ActiveClipVideoTexture[i],u_ClipColors[i])){continue;}}else{if(pixelInVideo(u_VIDEOMATCH_MVPMATRIX[i],u_VIDEOMATCH_RTP[i],u_ModelMatrix,v_LocalPosition,u_VideoSampler[i],u_Alpha[i],u_ClipMatrix,u_MaskSample,u_TextureSize,false,u_ClipColors[i])){continue;}}}}\n#endif\n#ifdef M_VERTEX_COLOR\ngl_FragColor=vec4(v_Color,1.0);\n#endif\n#ifdef M_HAS_CLIPPING_PLANES\nmodelClippingPlanesStage(gl_FragColor);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}"),vertexSource:f_("precision highp float;\n#define GLSLIFY 1\n#include <c_define>\n#include <fn_vertexLogDepth>\n#include <a_POSITION3>\n#include <a_DOUBLE_PRECISION_POSITION>\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelMatrix>\n#include <u_NormalMatrix>\n#include <v_LocalPosition>\nattribute vec2 a_TEXCOORD_0;\n#include <a_NORMAL3>\n#include <v_TexCoord2>\n#include <v_Normal3>\nvarying vec4 v_ModelPos;\n#include <u_ModelViewProjectionRelativeToEye>\n#include <u_EncodedCameraPosition>\n#include <fn_translateRelativeToEye>\n#include <v_LIGHT>\n#ifdef M_INSTANCE_MATRIX\nattribute mat4 a_InstanceMatrix4;\n#endif\n#ifdef M_VERTEX_COLOR\nattribute vec3 a_Color;varying vec3 v_Color;\n#endif\nuniform sampler2D batchTableTexture;uniform vec4 batchTextureStep;uniform float numberOfAttributes;varying vec4 v_sphericalExtents;varying vec3 v_uMaxAndInverseDistance;varying vec3 v_vMaxAndInverseDistance;varying vec3 v_uvMinAndSphericalLongitudeRotation;vec2 computeSt(float batchId){float stepX=batchTextureStep.x;float centerX=batchTextureStep.y;return vec2(centerX+(batchId*numberOfAttributes*stepX),0.5);}vec4 batchTable_sphericalExtents(float batchId){vec2 st=computeSt(batchId);st.x+=batchTextureStep.x*float(0);vec4 textureValue=texture2D(batchTableTexture,st);vec4 value=textureValue;return value;}float batchTable_longitudeRotation(float batchId){vec2 st=computeSt(batchId);st.x+=batchTextureStep.x*float(1);vec4 textureValue=texture2D(batchTableTexture,st);float value=textureValue.x;return value;}vec4 batchTable_uMaxVmax(float batchId){vec2 st=computeSt(batchId);st.x+=batchTextureStep.x*float(2);vec4 textureValue=texture2D(batchTableTexture,st);vec4 value=textureValue;return value;}vec4 batchTable_uvMinAndExtents(float batchId){vec2 st=computeSt(batchId);st.x+=batchTextureStep.x*float(3);vec4 textureValue=texture2D(batchTableTexture,st);vec4 value=textureValue;return value;}void main(){\n#ifdef M_DOUBLEPRECISION\n#ifdef M_INSTANCE_MATRIX\ngl_Position=u_ModelViewProjectionMatrix*a_InstanceMatrix4*u_ModelMatrix*vec4(a_PositionHigh+a_PositionLow,1.0);\n#else\ngl_Position=u_ModelViewProjectionRelativeToEye*translateRelativeToEye(a_PositionHigh,a_PositionLow);\n#endif\nv_LocalPosition=vec4(a_PositionHigh+a_PositionLow,1);v_ModelPos=u_ModelMatrix*v_LocalPosition;\n#else\nmat4 instanceMatrix4=mat4(1.0);\n#ifdef M_INSTANCE_MATRIX\ninstanceMatrix4=a_InstanceMatrix4*u_ModelMatrix;\n#endif\ngl_Position=u_ModelViewProjectionMatrix*instanceMatrix4*vec4(a_POSITION,1.0);v_LocalPosition=vec4(a_POSITION,1);v_ModelPos=u_ModelMatrix*vec4(a_POSITION,1.0);\n#endif\n#ifdef M_HAS_SHADOWVOLUME\nv_sphericalExtents=batchTable_sphericalExtents(0.0);v_uvMinAndSphericalLongitudeRotation.z=batchTable_longitudeRotation(0.0);vec4 uvMinAndExtents=batchTable_uvMinAndExtents(0.0);vec4 uMaxVmax=batchTable_uMaxVmax(0.0);v_uMaxAndInverseDistance=vec3(uMaxVmax.xy,uvMinAndExtents.z);v_vMaxAndInverseDistance=vec3(uMaxVmax.zw,uvMinAndExtents.w);v_uvMinAndSphericalLongitudeRotation.xy=uvMinAndExtents.xy;\n#endif\nv_TexCoord=a_TEXCOORD_0;\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\nv_ModelPos=v_ModelPos/v_ModelPos.w;v_Normal=normalize(u_NormalMatrix*a_NORMAL);\n#ifdef M_VERTEX_COLOR\nv_Color=a_Color;\n#endif\n}")},WaterMaterial:{fragmentSource:f_("#define GLSLIFY 1\n#ifdef M_EnableSSR\nuniform sampler2D u_ColorSampler;uniform sampler2D u_NormalSampler;uniform sampler2D u_DepthSampler;varying vec2 uv;\n#include <u_ProjectionMatrix>\n#include <u_ModelViewProjectionMatrix>\nuniform float u_Width;uniform float u_Height;\n#endif\n#include <fn_readDepth>\n#include <u_CurrentFrustum>\n#include <u_Opacity>\nuniform float u_Time;uniform float u_DistortionScale;uniform sampler2D u_BaseColorSampler;\n#include <u_Color3>\nuniform vec3 u_SunDirection;uniform vec3 u_SunColor;uniform vec3 u_SkyColor;uniform float u_WaveSize;varying vec4 v_MirrorCoord;varying vec4 v_WorldPosition;varying vec4 v_reallyPosition;varying vec4 v_camera;varying mat3 v_RotateMatrixInverse;vec4 getNoise(vec2 uv){vec2 uv0=(uv/103.0)+vec2(u_Time/17.0,u_Time/29.0);vec2 uv1=uv/107.0-vec2(u_Time/-19.0,u_Time/31.0);vec2 uv2=uv/vec2(8907.0,9803.0)+vec2(u_Time/101.0,u_Time/97.0);vec2 uv3=uv/vec2(1091.0,1027.0)-vec2(u_Time/109.0,u_Time/-113.0);vec4 noise=texture2D(u_BaseColorSampler,uv0)+texture2D(u_BaseColorSampler,uv1)+texture2D(u_BaseColorSampler,uv2)+texture2D(u_BaseColorSampler,uv3);return noise*0.5-1.0;}float getShadowMask(){float shadow=1.0;\n#ifdef USE_SHADOWMAP\n#if NUM_DIR_LIGHT_SHADOWS > 0\nDirectionalLightShadow directionalLight;\n#pragma unroll_loop_start\nfor(int i=0;i<NUM_DIR_LIGHT_SHADOWS;i++){directionalLight=directionalLightShadows[i];shadow*=receiveShadow ? getShadow(directionalShadowMap[i],directionalLight.shadowMapSize,directionalLight.shadowBias,directionalLight.shadowRadius,vDirectionalShadowCoord[i]): 1.0;}\n#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHT_SHADOWS > 0\nSpotLightShadow spotLight;\n#pragma unroll_loop_start\nfor(int i=0;i<NUM_SPOT_LIGHT_SHADOWS;i++){spotLight=spotLightShadows[i];shadow*=receiveShadow ? getShadow(spotShadowMap[i],spotLight.shadowMapSize,spotLight.shadowBias,spotLight.shadowRadius,vSpotShadowCoord[i]): 1.0;}\n#pragma unroll_loop_end\n#endif\n#if NUM_POINT_LIGHT_SHADOWS > 0\nPointLightShadow pointLight;\n#pragma unroll_loop_start\nfor(int i=0;i<NUM_POINT_LIGHT_SHADOWS;i++){pointLight=pointLightShadows[i];shadow*=receiveShadow ? getPointShadow(pointShadowMap[i],pointLight.shadowMapSize,pointLight.shadowBias,pointLight.shadowRadius,vPointShadowCoord[i],pointLight.shadowCameraNear,pointLight.shadowCameraFar): 1.0;}\n#pragma unroll_loop_end\n#endif\n#endif\nreturn shadow;}void sunLight(const vec3 sunDirection,const vec3 surfaceNormal,const vec3 eyeDirection,float shiny,float spec,float diffuse,inout vec3 diffuseColor,inout vec3 specularColor){vec3 reflection=normalize(reflect(-sunDirection,surfaceNormal));float direction=max(0.0,dot(eyeDirection,reflection));specularColor+=pow(direction,shiny)*u_SunColor*spec;diffuseColor+=max(dot(sunDirection,surfaceNormal),0.0)*u_SunColor*diffuse;}float getDepth(float z){float near=u_CurrentFrustum.x;float far=u_CurrentFrustum.y;float a=far/(far-near);float b=near/(near-far);return(a*z+b)/z;}bool checkDepthCollision(vec3 viewPos,mat4 mvp,sampler2D texture,out vec2 texPos){vec4 clipPos=mvp*vec4(viewPos,1.0);clipPos=clipPos/clipPos.w;texPos=vec2(clipPos.x,clipPos.y)*0.5+0.5;float depth=readDepth(texture,texPos,true);return texPos.x>0.0&&texPos.y>0.0&&texPos.x<1.0&&texPos.y<1.0&&depth<(clipPos.z*0.5)+0.5;}bool viewSpaceRayMarching(vec3 rayOrigin,vec3 rayDir,mat4 mvp,sampler2D texture,out vec2 hitScreenPos){const int maxStep=500;for(int i=10;i<maxStep;i++){vec3 currentPos=rayOrigin+rayDir*2.0*float(i);if(checkDepthCollision(currentPos,mvp,texture,hitScreenPos)){return true;}}return false;}void main(){vec3 sunDirection;if(u_SunDirection==vec3(0,0,0)){sunDirection=vec3(-u_SunLightDirectionLocal.x,u_SunLightDirectionLocal.y,-u_SunLightDirectionLocal.z);}else{sunDirection=u_SunDirection;}vec4 noise=getNoise(v_WorldPosition.xz*u_WaveSize);vec3 surfaceNormal=normalize(noise.xzy*vec3(1.5,1.0,1.5));vec3 diffuseLight=vec3(0.0);vec3 specularLight=vec3(0.0);vec3 worldToEye=v_RotateMatrixInverse*(u_CameraPosition-v_reallyPosition.xyz);worldToEye=vec3(-worldToEye.x,worldToEye.z,worldToEye.y);vec3 eyeDirection=normalize(worldToEye);sunLight(sunDirection,surfaceNormal,eyeDirection,100.0,2.0,0.5,diffuseLight,specularLight);float distance=length(worldToEye);vec2 distortion=surfaceNormal.xz*(0.001+1.0/distance)*u_DistortionScale;vec3 reflectionSample=u_SkyColor;float theta=max(dot(eyeDirection,surfaceNormal),0.0);float rf0=0.3;float reflectance=rf0+(1.0-rf0)*pow((1.0-theta),5.0);vec3 scatter=max(0.0,dot(surfaceNormal,eyeDirection))*u_Color;vec3 albedo=mix((u_SunColor*diffuseLight*0.3+scatter)*getShadowMask(),(vec3(0.1)+reflectionSample*0.9+reflectionSample*specularLight),reflectance);vec3 outgoingLight=albedo;\n#ifdef M_EnableSSR\nvec3 localNormalDirection=vec3(texture2D(u_NormalSampler,vec2(gl_FragCoord.x/u_Width,gl_FragCoord.y/u_Height)))*2.0-1.0;vec3 lightDirection=normalize(u_CameraPosition-v_reallyPosition.xyz);vec3 reflection=normalize(reflect(-lightDirection,localNormalDirection));vec2 hitScreenPos=vec2(0.0,0.0);if(viewSpaceRayMarching(v_reallyPosition.xyz,reflection,u_ModelViewProjectionMatrix,u_DepthSampler,hitScreenPos)){vec3 reflectTexture=vec3(texture2D(u_ColorSampler,hitScreenPos));gl_FragColor=vec4(albedo*u_Opacity*0.5+reflectTexture*0.5,u_Opacity);}else{gl_FragColor=vec4(albedo,u_Opacity);}\n#else\ngl_FragColor=vec4(albedo,u_Opacity);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#ifdef M_DOUBLEPRECISION\n#include <a_DOUBLE_PRECISION_POSITION>\n#else\n#include <a_POSITION3>\n#endif\n#include <u_ModelMatrix>\n#include <u_ModelViewProjectionMatrix>\n#include <u_ProjectionMatrix>\n#include <u_RotateMatrixInverse>\nvarying mat3 v_RotateMatrixInverse;varying vec4 v_MirrorCoord;varying vec4 v_WorldPosition;varying vec4 v_reallyPosition;\n#include <u_ModelViewProjectionRelativeToEye>\n#include <u_EncodedCameraPosition>\n#include <fn_translateRelativeToEye>\nvoid main(){\n#ifdef M_DOUBLEPRECISION\ngl_Position=u_ModelViewProjectionRelativeToEye*translateRelativeToEye(a_PositionHigh,a_PositionLow);v_reallyPosition=u_ModelMatrix*vec4(a_PositionHigh+a_PositionLow,1);\n#else\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);v_reallyPosition=u_ModelMatrix*vec4(a_POSITION,1.0);\n#endif\nv_MirrorCoord=u_RotateMatrixInverse*v_reallyPosition;v_RotateMatrixInverse=mat3(u_RotateMatrixInverse);v_MirrorCoord=v_MirrorCoord.xzyw;v_WorldPosition=v_MirrorCoord.xyzw;}")},mirrorMaterial:{fragmentSource:f_("#define GLSLIFY 1\nuniform lowp samplerCube u_EnvMap;varying vec3 v_Normal;uniform mat4 u_ModelMatrixInverse;varying vec3 v_Position;void main(){vec3 cameraPosition=(u_ModelMatrixInverse*vec4(u_CameraPosition,1.0)).xyz;vec3 eyeToSurfaceDir=normalize(v_Position-cameraPosition);vec3 direction=reflect(eyeToSurfaceDir,v_Normal);gl_FragColor=vec4(textureCube(u_EnvMap,direction).rgb,1.0);}"),vertexSource:f_("#define GLSLIFY 1\n#ifdef M_DOUBLEPRECISION\n#include <a_DOUBLE_PRECISION_POSITION>\n#else\n#include <a_POSITION3>\n#endif\n#include <u_ModelMatrix>\n#include <u_ModelViewProjectionMatrix>\n#include <u_ProjectionMatrix>\n#include <u_RotateMatrixInverse>\nvarying vec3 v_Position;\n#include <u_ModelViewProjectionRelativeToEye>\n#include <u_EncodedCameraPosition>\n#include <fn_translateRelativeToEye>\nattribute vec3 a_NORMAL;varying vec3 v_Normal;void main(){\n#ifdef M_DOUBLEPRECISION\ngl_Position=u_ModelViewProjectionRelativeToEye*translateRelativeToEye(a_PositionHigh,a_PositionLow);v_Position=vec3(a_PositionHigh+a_PositionLow);\n#else\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);v_Position=vec3(a_POSITION);\n#endif\nv_Normal=normalize(a_NORMAL);}")},PhongMaterial:{fragmentSource:f_("#define GLSLIFY 1\n#include <u_Viewport>\n#include <u_FrustumPlanes>\n#include <u_PixelRatio>\n#include <u_CurrentFrustum>\nuniform mat4 u_ViewportTransformation;uniform mat4 u_InverseProjection;\n#ifdef M_HAS_BASECOLORMAP\n#include <u_BaseColorSampler>\n#endif\n#ifdef M_HAS_NORMALMAP\nuniform sampler2D u_NormalSampler;\n#endif\n#ifdef M_HAS_CLIPPING_PLANES\nuniform highp sampler2D u_model_clippingPlanes;uniform vec4 u_model_clippingPlanesEdgeStyle;uniform mat4 u_model_clippingPlanesMatrix;\n#include <fn_primitiveClippingPlanes>\n#endif\n#ifdef M_ShadowEnable\nuniform sampler2D u_ShadowDepthSampler;uniform float u_EPSILON;uniform float u_MapSizeScale;uniform vec2 u_Resolution;varying vec4 v_PositionFromLight;\n#include <fn_shadow>\n#endif\nuniform vec4 u_BaseColorFactor;uniform float u_Shininess;uniform float u_Reflectivity;uniform float u_Opacity;varying vec3 v_Normal;varying vec4 v_LocalPosition;varying vec3 v_ViewPosition;varying vec3 v_WorldPosition;varying vec2 v_TexCoord;varying vec4 v_COLOR;varying mat3 v_TBN;varying vec4 v_ModelInstanceColor;\n#include <s_LightMaterial>\n#include <fn_phong>\n#include <fn_getBatchTextureColor>\nmat3 getTangentFrame(vec3 eye_pos,vec3 surf_norm,vec2 uv){vec3 q0=dFdx(eye_pos.xyz);vec3 q1=dFdy(eye_pos.xyz);vec2 st0=dFdx(uv.st);vec2 st1=dFdy(uv.st);vec3 N=surf_norm;vec3 q1perp=cross(q1,N);vec3 q0perp=cross(N,q0);vec3 T=q1perp*st0.x+q0perp*st1.x;vec3 B=q1perp*st0.y+q0perp*st1.y;float det=max(dot(T,T),dot(B,B));float scale2=(det==0.0)? 0.0 : inversesqrt(det);return mat3(T*scale2,B*scale2,N);}vec4 getBaseColor(){vec4 baseColor=u_BaseColorFactor;\n#ifdef M_HAS_BASECOLORMAP\nbaseColor=texture2D(u_BaseColorSampler,v_TexCoord);baseColor*=u_BaseColorFactor;\n#endif\n#ifdef M_OPAQUE\nbaseColor.a=1.0;\n#endif\n#ifdef M_VERTEX_COLOR\nbaseColor*=v_COLOR_0;\n#endif\nreturn baseColor;}vec3 getNormal(){vec3 N=normalize(v_Normal);\n#ifdef M_HAS_NORMALMAP\nmat3 TBN;\n#ifdef M_HAS_TANGENTS\nTBN=v_TBN;\n#else\nTBN=getTangentFrame(-v_ViewPosition,N,v_TexCoord);\n#endif\nvec3 normalMap=texture2D(u_NormalSampler,v_TexCoord).rgb;vec3 normalT=normalMap*2.0-1.0;N=normalize(v_TBN*normalT);\n#endif\nreturn N;}void main(){vec4 baseColor=getBaseColor();if(baseColor.a==0.0){discard;}\n#ifdef M_HAS_CLIPPING_PLANES\nmodelClippingPlanesStage(baseColor);\n#endif\n#if defined(M_HAS_NORMALS) && defined(M_enableLight)\nvec3 normal=getNormal();gl_FragColor=vec4(baseColor.rgb*phong(u_Reflectivity,normal,u_SunLightDirectionGlobal,v_WorldPosition,u_Shininess),baseColor.a*u_Opacity);\n#else\ngl_FragColor=vec4(baseColor.rgb,baseColor.a*u_Opacity);\n#endif\n#ifdef M_HAS_NORMALS\nbaseColor.rgb/=(baseColor.rgb+vec3(1.0));\n#endif\nbaseColor.rgb=pow(baseColor.rgb,vec3(1.0/2.2));float visibility=1.0;\n#ifdef M_ShadowEnable\n#ifdef M_ShadowMapping\nvisibility=0.6+0.4*ifShadow2(v_PositionFromLight,u_ShadowDepthSampler,u_EPSILON,1./u_Resolution.x,1./u_Resolution.y,u_MapSizeScale);\n#else\n#ifdef M_PCF\nvisibility=ShadowPCF(v_PositionFromLight,u_Resolution,u_ShadowDepthSampler);\n#endif\n#endif\n#endif\ngl_FragColor=vec4(gl_FragColor.rgb*visibility,gl_FragColor.a);\n#if defined(M_ONE_DIMENSION_BATCH_TEXTURE)||defined(M_TWO_DIMENSION_BATCH_TEXTURE)\ngetBatchTextureColor(batch_featureColor);\n#endif\n#ifdef M_MODEL_INSTANCE_BATCH_TEXTURE\ngl_FragColor.rgb=mix(gl_FragColor.rgb,v_ModelInstanceColor.rgb,v_ModelInstanceColor.a);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#ifdef M_DOUBLEPRECISION\n#include <a_DOUBLE_PRECISION_POSITION>\n#else\n#include <a_POSITION3>\n#endif\n#ifdef M_USE_MORPHTARGETS\n#include <a_POSITION3_1>\n#include <a_POSITION3_2>\n#include <a_NORMAL3_1>\n#include <a_NORMAL3_2>\n#include <a_TANGENT_1>\n#include <a_TANGENT_2>\nuniform vec2 u_morphTargetInfluences;\n#endif\n#ifdef M_INSTANCE_MATRIX\nattribute mat4 a_InstanceMatrix4;uniform mat4 u_ModelInstanceRTCTransformMatrix;\n#endif\n#ifdef M_ShadowEnable\nvarying vec4 v_PositionFromLight;uniform mat4 u_ShadowModelViewProjectionMatrix;\n#endif\n#ifdef M_JOINT_MATRIX_CNT\nattribute vec4 a_JOINTS_0;attribute vec4 a_WEIGHTS_0;uniform highp mat4 u_jointMatrix[M_JOINT_MATRIX_CNT];\n#endif\n#include <a_NORMAL3>\n#include <a_TANGENT>\n#include <a_TEXCOORD_0>\n#include <a_COLOR4_0>\n#include <a_BATCHID>\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelMatrix>\n#include <u_ViewMatrix>\n#include <u_NormalMatrix>\n#include <u_HasSkinning>\n#include <u_LIGHT>\nvarying vec3 v_Normal;varying vec4 v_LocalPosition;varying vec3 v_ViewPosition;varying vec3 v_WorldPosition;varying vec2 v_TexCoord;varying vec4 v_COLOR;varying mat3 v_TBN;\n#include <v_LIGHT>\n#include <c_computeSTParsVert>\n#include <fn_getAnimatedGLPosition>\nvoid main(){mat4 modelMatrix;\n#ifdef M_INSTANCE_MATRIX\nmodelMatrix=u_ModelInstanceRTCTransformMatrix*a_InstanceMatrix4*u_ModelMatrix;\n#else\nmodelMatrix=u_ModelMatrix;\n#endif\n#ifdef M_DOUBLEPRECISION\nvec4 pos=modelMatrix*vec4(a_PositionHigh+a_PositionLow,1.0);v_WorldPosition=vec3(pos.xyz)/pos.w;v_ViewPosition=(u_ViewMatrix*pos).xyz;v_LocalPosition=vec4(a_PositionHigh+a_PositionLow,1.0);\n#ifdef M_ShadowEnable\nv_PositionFromLight=u_ShadowModelViewProjectionMatrix*vec4(a_PositionHigh+a_PositionLow,1.0);\n#endif\n#else\nvec4 pos=modelMatrix*vec4(a_POSITION,1.0);v_WorldPosition=vec3(pos.xyz)/pos.w;v_ViewPosition=(u_ViewMatrix*pos).xyz;v_LocalPosition=vec4(a_POSITION,1.0);\n#ifdef M_ShadowEnable\nv_PositionFromLight=u_ShadowModelViewProjectionMatrix*vec4(a_POSITION,1.0);\n#endif\n#endif\n#if defined(M_enableLight) && defined(M_PointLight) && defined(M_ShadowEnable)\nfor(int i=0;i<int(M_PointLightCount);i++){vec4 positionToLight=u_PointLightModelMatrixInverse[i]*vec4(v_WorldPosition,1.0);v_PointDirection[i]=positionToLight.xyz;}\n#endif\n#ifdef M_HAS_NORMALS\nv_Normal=normalize(u_NormalMatrix*a_NORMAL);\n#if defined(M_HAS_NORMALMAP) && defined(M_HAS_TANGENTS)\nvec3 N=v_Normal;vec3 T=normalize(u_NormalMatrix*a_TANGENT);vec3 B=normalize(cross(N,T));v_TBN=mat3(T,B,N);\n#endif\n#endif\nv_TexCoord=a_TEXCOORD_0;v_COLOR=a_COLOR_0;getAnimatedGLPosition();\n#include <c_computeSTMainVert>\n}")},LambertMaterial:{fragmentSource:f_("precision highp float;\n#define GLSLIFY 1\n#ifdef M_enableLight\n#ifdef M_AmbientLight\nuniform float u_AmbientLightsColor[M_AmbientLightCount*3];uniform float u_AmbientLightsIntensity[M_AmbientLightCount];\n#endif\n#ifdef M_DirectionalLight\nuniform float u_DirectionalLightColor[M_DirectionalLightCount*3];uniform float u_DirectionalLightIntensity[M_DirectionalLightCount];uniform float u_DirectionalLightDir[M_DirectionalLightCount*3];\n#endif\n#endif\nuniform vec3 u_Color;uniform vec3 u_Emissive;uniform float u_Reflectivity;uniform float u_Opacity;varying vec3 v_Normal;varying vec3 v_worldPosition;void main(){\n#ifdef M_enableLight\nvec3 ambient=vec3(0.0,0.0,0.0);\n#ifdef M_AmbientLight\nfor(int i=0;i<int(M_AmbientLightCount);++i){vec3 ambientColor=vec3(u_AmbientLightsColor[i*3],u_AmbientLightsColor[i*3+1],u_AmbientLightsColor[i*3+2]);float ambientIntensity=u_AmbientLightsIntensity[i];ambient=ambient+ambientIntensity*u_Reflectivity*ambientColor;}\n#endif\nvec3 diffuse=vec3(0.0,0.0,0.0);\n#ifdef M_SunLight\nif(u_SunLightDirectionLocal.z>0.0){diffuse=diffuse+u_Reflectivity*max(dot(v_Normal,u_SunLightDirectionGlobal),0.)*u_SunLightColor*u_SunLightIntensity;}\n#endif\n#ifdef M_DirectionalLight\nfor(int i=0;i<int(M_DirectionalLightCount);++i){vec3 directLightColor=vec3(u_DirectionalLightColor[i*3],u_DirectionalLightColor[i*3+1],u_DirectionalLightColor[i*3+2]);float directLightIntensity=u_DirectionalLightIntensity[i];vec3 directLightDir=vec3(u_DirectionalLightDir[i*3],u_DirectionalLightDir[i*3+1],u_DirectionalLightDir[i*3+2]);diffuse=diffuse+u_Reflectivity*max(dot(v_Normal,directLightDir),0.)*directLightColor*directLightIntensity;}\n#endif\ngl_FragColor=vec4(u_Color*(ambient+diffuse),u_Opacity);\n#else\ngl_FragColor=vec4(u_Color,u_Opacity);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <basicVertex>\n#include <fn_basic>\nattribute vec3 a_NORMAL;varying vec3 v_Normal;varying vec3 v_worldPosition;void main(){gl_Position=getGLPosition();v_worldPosition=getWorldPosition().xyz;vec4 delt=u_ModelMatrix*vec4(a_NORMAL,1.0)-u_ModelMatrix*vec4(0.0,0.0,0.0,1.0);v_Normal=normalize(delt.xyz);}")},SimplePolyline:{fragmentSource:f_("#define GLSLIFY 1\n#include <u_Color4>\nvoid main(){gl_FragColor=u_Color;}"),vertexSource:f_("#define GLSLIFY 1\n#ifdef M_DOUBLEPRECISION\n#include <a_DOUBLE_PRECISION_POSITION>\n#else\n#include <a_POSITION3>\n#endif\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelViewProjectionRelativeToEye>\n#include <u_EncodedCameraPosition>\n#include <fn_translateRelativeToEye>\nvoid main(){\n#ifdef M_DOUBLEPRECISION\ngl_Position=u_ModelViewProjectionRelativeToEye*translateRelativeToEye(a_PositionHigh,a_PositionLow);\n#else\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);\n#endif\n}")},screen:{fragmentSource:f_("precision highp float;\n#define GLSLIFY 1\n#include <u_BaseColorSampler>\nvarying highp vec2 v_TexCoord;uniform vec2 u_Resolution;void main(){if(M_SSAASamples==1){gl_FragColor=texture2D(u_BaseColorSampler,v_TexCoord);}else{float widthResolution=1.0/(u_Resolution.x*float(M_SSAASamples));float heightResolution=1.0/(u_Resolution.y*float(M_SSAASamples));vec4 color;float number;vec2 startCoord=v_TexCoord-vec2(widthResolution*((float(M_SSAASamples))/2.0-1.0)+0.5*widthResolution,heightResolution*((float(M_SSAASamples))/2.0-1.0)-0.5*widthResolution);for(int i=0;i<M_SSAASamples;i++){for(int j=0;j<M_SSAASamples;j++){color=color+texture2D(u_BaseColorSampler,startCoord+vec2(widthResolution*float(i),heightResolution*float(j)));number=number+1.0;}}gl_FragColor=color/number;}}"),vertexSource:f_(u_)},panorama:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D u_std_resolution_img;uniform sampler2D u_low_resolution;\n#include <v_TexCoord2>\nvoid main(){vec4 calColor=texture2D(u_std_resolution_img,v_TexCoord);gl_FragColor=calColor;\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION3>\nattribute vec2 a_texture_pos;\n#include <u_ModelViewProjectionMatrix>\n#include <v_TexCoord2>\nvoid main(){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1);v_TexCoord=a_texture_pos;}")},sphereHistogram:{fragmentSource:f_("#define GLSLIFY 1\n#include <c_define>\n#include <fn_writeLogDepth>\n#include <c_extrusionF>\n#include <pragma_extrusion_define>\n#include <s_LightMaterial>\n#include <fn_phong>\n#include <u_LightMaterial>\nvarying vec4 modelPos;\n#include <u_Opacity>\nvoid main(){\n#include <pragma_extrusion_initialize>\nvec3 normal=normalize(v_Normal);\n#ifdef M_PHONG_LIGHT\nvec3 phongColor=phong(modelPos.xyz,normal,u_LightMaterial,u_SunLightDirectionLocal,u_CameraPosition);gl_FragColor=vec4(phongColor*color.rgb,color.a*u_Opacity);\n#else\ngl_FragColor=vec4(color.rgb,color.a*u_Opacity);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <fn_vertexLogDepth>\n#include <c_define>\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelMatrix>\n#include <u_NormalMatrix>\n#include <pragma_extrusion_define>\n#include <v_TexCoord2>\n#include <c_extrusionV>\nvarying vec4 modelPos;void main(){\n#include <pragma_extrusion_initialize>\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1);v_Normal=normalize(u_NormalMatrix*a_NORMAL_ED.xyz);v_Normal=a_NORMAL_ED.xyz;v_TexCoord=a_ST.xy;float t=mod(a_NORMAL_ED.y,2.0);modelPos=u_ModelMatrix*vec4(a_POSITION,1.0);modelPos=modelPos/modelPos.w;\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n}")},sphereHistogramColor:{fragmentSource:f_("#define GLSLIFY 1\n#include <pragma_extrusion_define>\n#include <c_extrusionF>\n#include <u_Opacity>\nvoid main(){vec3 normal=normalize(v_Normal);vec3 lightDirection=normalize(u_SunLightDirectionLocal);float nDotL=max(dot(lightDirection,normal),0.0);vec3 diffuse_a=u_SunLightColor*u_color_a.rgb*nDotL;vec3 ambient_a=vec3(0.6,0.6,0.6)*u_color_a.rgb;vec3 diffuse_b=u_SunLightColor*u_color_b.rgb*nDotL;vec3 ambient_b=vec3(0.6,0.6,0.6)*u_color_b.rgb;vec3 diffuse_c=u_SunLightColor*u_color_c.rgb*nDotL;vec3 ambient_c=vec3(0.6,0.6,0.6)*u_color_c.rgb;vec3 diffuse_d=u_SunLightColor*u_color_d.rgb*nDotL;vec3 ambient_d=vec3(0.6,0.6,0.6)*u_color_d.rgb;vec3 diffuse_e=u_SunLightColor*u_color_e.rgb*nDotL;vec3 ambient_e=vec3(0.6,0.6,0.6)*u_color_e.rgb;vec3 tmp=vec3(0.0);vec3 real=vec3(0.0);if(v_height<0.25*u_max_height){tmp=(diffuse_b+ambient_b)-(diffuse_a+ambient_a);real=tmp*((v_height)/0.25/u_max_height)+(diffuse_a+ambient_a);}else if(v_height<0.5*u_max_height){tmp=(diffuse_c+ambient_c)-(diffuse_b+ambient_b);real=tmp*((v_height-0.25*u_max_height)/0.25/u_max_height)+(diffuse_b+ambient_b);}else if(v_height<0.75*u_max_height){tmp=(diffuse_d+ambient_d)-(diffuse_c+ambient_c);real=tmp*((v_height-0.5*u_max_height)/0.25/u_max_height)+(diffuse_c+ambient_c);}else if(v_height<0.8*u_max_height){tmp=(diffuse_e+ambient_e)-(diffuse_d+ambient_d);real=tmp*((v_height-0.75*u_max_height)/0.25/u_max_height)+(diffuse_d+ambient_d);}else{real=(diffuse_e+ambient_e);}if(u_depth_render==1.0){gl_FragColor=vec4(real.rgb,real.a*u_Opacity);}else{gl_FragColor=vec4(real.rgb,real.a*v_opacity*u_Opacity);}\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);;\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <u_NormalMatrix>\n#include <c_extrusionV>\nvarying float v_height;varying float v_opacity;\n#pragma minemap: define highp float base\n#pragma minemap: define highp float height\n#pragma minemap: define highp vec4 color\nvoid main(){\n#pragma minemap: initialize highp float base\n#pragma minemap: initialize highp float height\n#pragma minemap: initialize highp vec4 color\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1);v_Normal=normalize(u_NormalMatrix*a_normal_ed.xyz);vec3 normal=a_normal_ed.xyz;float t=mod(normal.x,2.0);if(t>0.0){v_opacity=1.2;v_height=height*3.0;}else{v_opacity=0.1;v_height=0.0;}}")},sphereHistogramDynamic:{fragmentSource:f_("#define GLSLIFY 1\n#include <pragma_extrusion_define>\n#include <c_extrusionF>\nvoid main(){\n#include <pragma_extrusion_initialize>\nif(v_height<0.2*u_max_height){vec4 tmp=u_color_b-u_color_a;vec4 real=tmp*((v_height)/0.2/u_max_height)+u_color_a;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else if(v_height<0.4*u_max_height){vec4 tmp=u_color_c-u_color_b;vec4 real=tmp*((v_height-0.2*u_max_height)/0.2/u_max_height)+u_color_b;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else if(v_height<0.6*u_max_height){vec4 tmp=u_color_d-u_color_c;vec4 real=tmp*((v_height-0.4*u_max_height)/0.2/u_max_height)+u_color_c;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else if(v_height<0.8*u_max_height){vec4 tmp=u_color_e-u_color_d;vec4 real=tmp*((v_height-0.6*u_max_height)/0.2/u_max_height)+u_color_d;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else{gl_FragColor=vec4(u_color_e.rgb*v_directional,1.0);}\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION2>\n#include <u_ModelViewProjectionMatrix>\n#include <pragma_extrusion_define>\n#include <c_extrusionV>\nuniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform lowp float u_dyn_count;uniform float u_fluorescent;varying vec4 v_color;varying float v_opacity;varying float v_height;varying float v_directional;\n#pragma minemap: define lowp vec4 heightArr1\n#pragma minemap: define lowp vec4 heightArr2\n#pragma minemap: define lowp vec4 heightArr3\nvoid main(){\n#include <pragma_extrusion_initialize>\n#pragma minemap: initialize lowp vec4 heightArr1\n#pragma minemap: initialize lowp vec4 heightArr2\n#pragma minemap: initialize lowp vec4 heightArr3\nfloat _height=0.0;float _num=0.0;float _height1=0.0;float _height2=0.0;_num=abs(u_dyn_count)/500.0;if(_num<1.0){_height1=abs(height);_height2=abs(heightArr1[0]/255.0);}else if(_num<2.0){_height1=abs(heightArr1[0]/255.0);_height2=abs(heightArr1[1]/255.0);}else if(_num<3.0){_height1=abs(heightArr1[1]/255.0);_height2=abs(heightArr1[2]/255.0);}else if(_num<4.0){_height1=abs(heightArr1[2]/255.0);_height2=abs(heightArr1[3]/255.0);}else if(_num<5.0){_height1=abs(heightArr1[3]/255.0);_height2=abs(heightArr2[0]/255.0);}else if(_num<6.0){_height1=abs(heightArr2[0]/255.0);_height2=abs(heightArr2[1]/255.0);}else if(_num<7.0){_height1=abs(heightArr2[1]/255.0);_height2=abs(heightArr2[2]/255.0);}else if(_num<8.0){_height1=abs(heightArr2[2]/255.0);_height2=abs(heightArr2[3]/255.0);}else if(_num<9.0){_height1=abs(heightArr2[3]/255.0);_height2=abs(heightArr3[0]/255.0);}else if(_num<10.0){_height1=abs(heightArr3[0]/255.0);_height2=abs(heightArr3[1]/255.0);}else if(_num<11.0){_height1=abs(heightArr3[1]/255.0);_height2=abs(heightArr3[2]/255.0);}else if(_num<12.0){_height1=abs(heightArr3[2]/255.0);_height2=abs(heightArr3[3]/255.0);}_height=20.0+(_height1+(_height2-_height1)/500.0*mod(abs(u_dyn_count),500.0))*1.0;vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION.xy,t>0.0 ? _height : base,1);if(t>0.0){v_opacity=1.2;v_height=_height*3.0;}else{v_opacity=0.1;v_height=0.0;}float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if(normal.y!=0.0){directional*=clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0);}v_color.r+=clamp(color.r*directional*u_SunLightColor.r,mix(0.0,0.3,1.0-u_SunLightColor.r),1.0);v_color.g+=clamp(color.g*directional*u_SunLightColor.g,mix(0.0,0.3,1.0-u_SunLightColor.g),1.0);v_color.b+=clamp(color.b*directional*u_SunLightColor.b,mix(0.0,0.3,1.0-u_SunLightColor.b),1.0);v_directional=directional;}")},sphereSymtrackingIcon:{fragmentSource:f_(r_),vertexSource:f_(o_)},sphereSymtrackingSDF:{fragmentSource:f_(a_),vertexSource:f_(s_)},sphereDynamicLine:{fragmentSource:f_("#define GLSLIFY 1\n#include <pragma_line_define>\n#include <c_define>\n#include <c_lineF>\nuniform float u_count;uniform float u_segments;varying float v_seq;varying vec2 v_info;void main(){\n#include <pragma_line_initialize>\nfloat total_count=v_info[0];float offset_count=v_info[1];float actualSeq=v_seq-2.0;float actualCount=u_count+offset_count;float quotient=floor(actualCount/(total_count+u_segments));float mod1=mod(quotient,2.0);float count=mod(actualCount,total_count+u_segments);if(mod1!=0.0){count=total_count+u_segments-count;}float start=count-u_segments;float end=count;if(actualSeq<start||actualSeq>end){discard;}mediump float drive_opacity=(actualSeq-start)/u_segments;if(mod1!=0.0){drive_opacity=1.0-drive_opacity;}float dist=length(v_Normal)*v_width2.s;float blur2=(blur+1.0/M_DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=vec4(color.rgb,color.a*(alpha*opacity)*drive_opacity);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <c_define>\n#include <c_lineV>\nattribute float a_seq;attribute vec2 a_info;varying float v_seq;varying vec2 v_info;void main(){\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_seq=a_seq;v_info=a_info;mediump vec2 normal=vec2(a_NORMAL/2.0>=1.0 ? 1.0 : 0.0,mod(a_NORMAL,2.0)==1.0 ? 1.0 :-1.0);v_Normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_HasBorder)?(borderwidth*2.0+width)/2.0 : width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;if(u_HalfRender){if(normaldirection==1.){outset=gapwidth+(normal.y>0. ? halfwidth : 0.)*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;}else{outset=gapwidth+(normal.y<0. ? halfwidth : 0.)*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;}}mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_PixelMatrix*outset*a_extrude*scale;gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION.xyz,1.0);gl_Position.xy+=dist/u_GlUnitsToPixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}")},debugViewPort:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D colorTexture;varying vec2 vUv;void main(){vec4 color=texture2D(colorTexture,vUv);gl_FragColor=vec4(color.r,color.g,color.r,1.0);}"),vertexSource:f_(h_)},debugDepthTexture:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D colorTexture;varying vec2 vUv;\n#include <fn_unpackDepth>\nvoid main(){float z_window=unpackDepth(texture2D(colorTexture,vUv));float n_range=u_CurrentFrustum.x;float f_range=u_CurrentFrustum.y;float z_ndc=(2.0*z_window-n_range-f_range)/(f_range-n_range);float scale=pow(z_ndc*0.5+0.5,1.0);gl_FragColor=vec4(mix(vec3(0.0),vec3(1.0),scale),1.0);}"),vertexSource:f_(h_)},skyboxCapture:{fragmentSource:f_("varying highp vec3 v_position;uniform highp float u_luminance;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\n#define BETA_R vec3(5.5e-6, 13.0e-6, 22.4e-6)\n#define BETA_M vec3(21e-6, 21e-6, 21e-6)\n#define MIE_G 0.76\n#define DENSITY_HEIGHT_SCALE_R 8000.0\n#define DENSITY_HEIGHT_SCALE_M 1200.0\n#define PLANET_RADIUS 6360e3\n#define ATMOSPHERE_RADIUS 6420e3\n#define SAMPLE_STEPS 10\n#define DENSITY_STEPS 4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius){float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return(-b+d)/(2.0*a);}vec3 extinction(vec2 density){return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point){float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle){return(3.0/(16.0*radians(180.0)))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle){return(3.0/(8.0*radians(180.0)))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir){float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for(int i=0;i<DENSITY_STEPS;++i){vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity){vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for(int i=0;i<SAMPLE_STEPS;++i){vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return(scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x){return((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main(){vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_SunLightDirectionLocal,u_SunLightIntensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION3>\nuniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end){return((value-start)*(new_end-new_start))/(end-start)+new_start;}void main(){vec4 pos=vec4(u_matrix_3f*a_POSITION,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_POSITION.xy,0.0,1.0);}")},skybox:{fragmentSource:f_("#define GLSLIFY 1\n#include <v_TexCoord3>\nuniform lowp samplerCube u_cubemap;\n#ifdef M_HAS_STARRY_SKY_MAP\nuniform lowp samplerCube u_starrySkyTextureMap;\n#endif\n#ifdef M_HAS_DAY_MAP\nuniform lowp samplerCube u_dayTextureMap;\n#endif\n#include <u_Opacity>\nfloat sun_disk(highp vec3 ray_direction,highp vec3 sun_direction){highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end){return((value-start)*(new_end-new_start))/(end-start)+new_start;}highp vec3 hash(highp vec2 p){highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed){vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}void main(){vec3 uv=v_TexCoord;\n#ifdef M_HAS_DAY_MAP\nvec3 sky_color=textureCube(u_dayTextureMap,uv).rgb;\n#else\nvec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#endif\n#ifdef M_HAS_STARRY_SKY_MAP\nsky_color=sky_color*u_Opacity+textureCube(u_starrySkyTextureMap,uv).rgb*(1.0-u_Opacity);\n#else\nsky_color=sky_color*u_Opacity+vec3(0.)*(1.0-u_Opacity);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+0.44999999);sky_color+=0.1*sun_disk(v_TexCoord,u_SunLightDirectionLocal)*u_Opacity;gl_FragColor=vec4(sky_color,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION3>\nuniform lowp mat4 u_matrixSkyBox;\n#include <v_TexCoord3>\nvoid main(){const mat3 half_neg_pi_around_x=mat3(1.0,0.0,0.0,0.0,0.0,-1.0,0.0,1.0,0.0);v_TexCoord=half_neg_pi_around_x*a_POSITION;vec4 pos=u_matrixSkyBox*vec4(a_POSITION,1.0);gl_Position=pos.xyww;}")},distanceMaterial:{fragmentSource:f_("#define GLSLIFY 1\nvarying vec4 v_Position;\n#include <fn_encodeFloat>\nvoid main(){float distance=max(dot((u_CameraPosition-v_Position.xyz),u_CameraDirection),0.0);if(distance>65535.0){gl_FragColor=vec4(0.);}else{gl_FragColor=encodeFloat(distance/65535.0);}}"),vertexSource:f_("#define GLSLIFY 1\n#include <fn_vertexLogDepth>\n#include <a_DOUBLE_PRECISION_POSITION>\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <a_BATCHID>\n#include <c_computeSTParsVert>\n#include <u_ModelViewProjectionRelativeToEye>\n#include <u_EncodedCameraPosition>\n#include <fn_translateRelativeToEye>\n#ifdef M_JOINT_MATRIX_CNT\nattribute vec4 a_JOINTS_0;attribute vec4 a_WEIGHTS_0;\n#endif\n#ifdef M_INSTANCE_MATRIX\nattribute mat4 a_InstanceMatrix4;uniform mat4 vpmatrix;\n#endif\n#include <u_HasSkinning>\n#ifdef M_JOINT_MATRIX_CNT\nuniform highp mat4 u_jointMatrix[M_JOINT_MATRIX_CNT];\n#endif\n#ifdef M_USE_MORPHTARGETS\n#include <a_POSITION3_1>\n#include <a_POSITION3_2>\nuniform vec2 u_morphTargetInfluences;\n#include <a_NORMAL3_1>\n#include <a_NORMAL3_2>\n#include <a_TANGENT_1>\n#include <a_TANGENT_2>\n#endif\n#include <u_ModelMatrix>\nvarying vec4 v_Position;\n#include <fn_getAnimatedGLPosition>\nvoid main(){\n#ifdef M_DOUBLEPRECISION\nv_Position=u_ModelMatrix*vec4(a_PositionHigh+a_PositionLow,1);\n#else\nv_Position=u_ModelMatrix*vec4(a_POSITION,1.0);\n#endif\ngetAnimatedGLPosition();\n#include <c_computeSTMainVert>\n}")},depthMaterial:{fragmentSource:f_("#define GLSLIFY 1\n#ifdef M_LOG_DEPTH\n#include <fn_writeLogDepth>\nvarying float v_depthFromNearPlusOne;\n#include <u_CurrentFrustum>\n#endif\n#ifdef M_DEPTH_DISTANCE\nvarying vec4 v_Position;\n#include <u_CurrentFrustum>\n#endif\n#include <fn_encodeFloat>\nvoid main(){gl_FragColor=vec4(encodeFloat(gl_FragCoord.z));\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n#ifdef M_DEPTH_DISTANCE\nfloat distance=length(u_CameraPosition-v_Position.xyz);float depth=distance/u_CurrentFrustum.y;gl_FragColor=vec4(depth,depth,depth,1.0);\n#endif\n}"),vertexSource:f_(p_)},normalMaterial:{fragmentSource:f_("#define GLSLIFY 1\nvarying vec3 v_Normal;void main(){gl_FragColor=vec4((v_Normal+1.0)/2.0,1.0);}"),vertexSource:f_("#define GLSLIFY 1\nattribute vec3 a_NORMAL;varying vec3 v_Normal;varying vec4 v_reallyPosition;\n#include <a_POSITION3>\n#include <u_ModelMatrix>\n#include <u_ModelViewProjectionMatrix>\n#include <a_DOUBLE_PRECISION_POSITION>\n#include <u_ModelViewProjectionRelativeToEye>\n#include <u_EncodedCameraPosition>\n#include <fn_translateRelativeToEye>\nvec3 cross2(vec3 a,vec3 b){float ax=a[0];float ay=a[1];float az=a[2];float bx=b[0];float by=b[1];float bz=b[2];vec3 result;result[0]=ay*bz-az*by;result[1]=az*bx-ax*bz;result[2]=ax*by-ay*bx;return-result;}mat4 localFrameToFixedFrame(vec3 cartesianOrigin){vec3 origin=cartesianOrigin;vec3 oneOverRadiiSquared=vec3(2.458172257647332e-14,2.458172257647332e-14,2.4747391015697002e-14);vec3 east=normalize(vec3(-origin.y,origin.x,0.0));vec3 up=normalize(vec3(origin.x*oneOverRadiiSquared.x,origin.y*oneOverRadiiSquared.y,origin.z*oneOverRadiiSquared.z));vec3 north=cross2(up,east);vec3 firstAxisVector=east;vec3 secondAxisVector=north;vec3 thirdAxisVector=up;mat4 result=mat4(firstAxisVector.x,firstAxisVector.y,firstAxisVector.z,0.0,secondAxisVector.x,secondAxisVector.y,secondAxisVector.z,0.0,thirdAxisVector.x,thirdAxisVector.y,thirdAxisVector.z,0.0,origin.x,origin.y,origin.z,1.0);return result;}void main(){\n#ifdef M_DOUBLEPRECISION\ngl_Position=u_ModelViewProjectionRelativeToEye*translateRelativeToEye(a_PositionHigh,a_PositionLow);v_reallyPosition=u_ModelMatrix*vec4(a_PositionHigh+a_PositionLow,1);\n#else\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);v_reallyPosition=u_ModelMatrix*vec4(a_POSITION,1.0);\n#endif\nvec4 delt=u_ModelMatrix*vec4(a_NORMAL,1.0)-u_ModelMatrix*vec4(0.0,0.0,0.0,1.0);v_Normal=normalize(delt.xyz);}")},pickColorMaterial:{fragmentSource:f_("#define GLSLIFY 1\n#if defined(M_USE_PICKINGTEXTURES)\nuniform sampler2D pickColorTexture;varying vec2 batch_featureSt;\n#else\nuniform vec4 u_pickIdColor;\n#endif\n#ifdef M_MODEL_INSTANCE_BATCH_TEXTURE\nvarying vec4 v_PickColor;\n#endif\n#if defined(M_POLYLINE) && defined(M_SHADOW_VOLUME)\n#include <u_PixelRatio>\n#include <u_Viewport>\n#include <u_CurrentFrustum>\n#include <u_FrustumPlanes>\nuniform mat4 u_ViewportTransformation;uniform mat4 u_InverseProjection;uniform sampler2D u_DepthTexture;\n#include <fn_readDepth>\n#include <fn_windowToEyeCoordinates>\n#include <fn_metersPerPixel>\n#include <fn_planeDistance>\nvarying vec4 v_startPlaneNormalEcAndHalfWidth;varying vec4 v_endPlaneNormalEcAndBatchId;varying vec4 v_rightPlaneEC;varying vec4 v_endEcAndStartEcX;varying vec4 v_texcoordNormalizationAndStartEcYZ;\n#endif\n#ifdef M_USE_PICKINGTEXTURES\nvoid main(){gl_FragColor=texture2D(pickColorTexture,batch_featureSt);}\n#else\nvoid main(){\n#if defined(M_POLYLINE) && defined(M_SHADOW_VOLUME)\nfloat logDepthOrDepth=readDepth(u_DepthTexture,gl_FragCoord.xy/u_Viewport.zw,false);if(logDepthOrDepth==0.0){discard;}vec3 ecStart=vec3(v_endEcAndStartEcX.w,v_texcoordNormalizationAndStartEcYZ.zw);vec4 eyeCoordinate=windowToEyeCoordinates(gl_FragCoord.xy,logDepthOrDepth);eyeCoordinate/=eyeCoordinate.w;float halfMaxWidth=v_startPlaneNormalEcAndHalfWidth.w;\n#ifdef M_PIXEL_WIDTH\nhalfMaxWidth*=metersPerPixel(eyeCoordinate);\n#endif\nfloat widthwiseDistance=planeDistance(v_rightPlaneEC,eyeCoordinate.xyz);float distanceFromStart=planeDistance(v_startPlaneNormalEcAndHalfWidth.xyz,-dot(ecStart,v_startPlaneNormalEcAndHalfWidth.xyz),eyeCoordinate.xyz);float distanceFromEnd=planeDistance(v_endPlaneNormalEcAndBatchId.xyz,-dot(v_endEcAndStartEcX.xyz,v_endPlaneNormalEcAndBatchId.xyz),eyeCoordinate.xyz);if(abs(widthwiseDistance)>halfMaxWidth||distanceFromStart<0.0||distanceFromEnd<0.0){discard;}\n#endif\ngl_FragColor=u_pickIdColor;\n#ifdef M_MODEL_INSTANCE_BATCH_TEXTURE\ngl_FragColor=v_PickColor;\n#endif\n}\n#endif\n"),vertexSource:f_(p_)},BillboardMaterial:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D u_BaseColorSampler;\n#include <u_Color4>\n#include <u_Opacity>\nvarying vec2 v_TexCoord;\n#ifdef M_PARTICLSYSTEM\nvarying vec4 v_Color;\n#endif\nvoid main(){\n#if defined(M_USE_BILLBOARDTEXTURE)\n#if defined(M_INSTANCE_MATRIX) && defined(M_PARTICLSYSTEM)\nvec4 texture=texture2D(u_BaseColorSampler,vec2(v_TexCoord.x,v_TexCoord.y));gl_FragColor=vec4(texture.rgb,texture.a*v_Color.a)*u_Opacity;\n#else\ngl_FragColor=texture2D(u_BaseColorSampler,vec2(v_TexCoord.x,v_TexCoord.y))*u_Opacity;\n#endif\n#else\ngl_FragColor=u_Color*u_Opacity;\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\nattribute vec3 a_POSITION;attribute vec2 a_TEXCOORD_0;attribute vec2 a_UVOffset;uniform float u_rotation;uniform vec2 u_center;uniform vec2 u_UVScale;uniform mat4 u_ScaleMatrix;uniform mat4 u_MvMatrix;uniform mat4 u_InvertViewMatrix;uniform mat4 u_ProjectionMatrix;varying vec2 v_TexCoord;\n#ifdef M_INSTANCE_MATRIX\nattribute mat4 a_InstanceMatrix4;\n#endif\n#ifdef M_PARTICLSYSTEM\nattribute vec4 a_Color;attribute float a_Scale;varying vec4 v_Color;\n#endif\n#ifdef M_FIXED_PIXEL_SIZE\nuniform vec2 u_PixelResolution;uniform mat4 u_ViewportTransformation;uniform vec4 u_Viewport;\n#endif\n#include <fn_billboardVertexPosition>\nvoid main(){v_TexCoord.x=a_TEXCOORD_0.x;v_TexCoord.y=1.0-a_TEXCOORD_0.y;gl_Position=billboardVertexPosition();}")},viewDomeAnalysis:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D u_DepthMap0;uniform sampler2D u_DepthMap1;uniform sampler2D u_DepthMap2;uniform sampler2D u_DepthMap3;uniform sampler2D u_DepthMap4;uniform int u_DomeType;uniform vec4 u_VisibleAreaColor;uniform vec4 u_HiddenAreaColor;varying vec4 v_renderTextureCoord0;varying vec4 v_renderTextureCoord1;varying vec4 v_renderTextureCoord2;varying vec4 v_renderTextureCoord3;varying vec4 v_renderTextureCoord4;\n#include <fn_unpackDepth>\nbool IsValidUV(vec4 texCoord){if((texCoord.x<=1.0)&&(texCoord.x>=-1.0)&&(texCoord.y<=1.0)&&(texCoord.y>=-1.0)&&(texCoord.z<=1.0)&&(texCoord.z>=-1.0)){return true;}else{return false;}}bool IsVisible(sampler2D shadowMap,vec4 uv){bool isVisible=true;float depth=unpackDepth(texture2D(shadowMap,uv.xy));if(depth<0.00001){return isVisible;}if(uv.z>(depth+0.00001)){isVisible=false;}return isVisible;}bool GetVisibleFlag(){bool isVisible=true;if(IsValidUV(v_renderTextureCoord0)){isVisible=IsVisible(u_DepthMap0,v_renderTextureCoord0);}else if(IsValidUV(v_renderTextureCoord1)){isVisible=IsVisible(u_DepthMap1,v_renderTextureCoord1);}else if(IsValidUV(v_renderTextureCoord2)){isVisible=IsVisible(u_DepthMap2,v_renderTextureCoord2);}else if(IsValidUV(v_renderTextureCoord3)){isVisible=IsVisible(u_DepthMap3,v_renderTextureCoord3);}else if(IsValidUV(v_renderTextureCoord4)){isVisible=IsVisible(u_DepthMap4,v_renderTextureCoord4);}return isVisible;}void main(){bool isVisible=GetVisibleFlag();if(u_DomeType==0){if(!isVisible){discard;}else{gl_FragColor=u_VisibleAreaColor;}}else if(u_DomeType==1){if(!isVisible){gl_FragColor=u_HiddenAreaColor;}else{discard;}}else{if(!isVisible){gl_FragColor=u_HiddenAreaColor;}else{gl_FragColor=u_VisibleAreaColor;}}}"),vertexSource:f_("#define GLSLIFY 1\nuniform mat4 u_TexWorldViewProjMatrix0;uniform mat4 u_TexWorldViewProjMatrix1;uniform mat4 u_TexWorldViewProjMatrix2;uniform mat4 u_TexWorldViewProjMatrix3;uniform mat4 u_TexWorldViewProjMatrix4;varying vec4 v_renderTextureCoord0;varying vec4 v_renderTextureCoord1;varying vec4 v_renderTextureCoord2;varying vec4 v_renderTextureCoord3;varying vec4 v_renderTextureCoord4;vec4 vexPos;uniform float u_Radius;\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\nvec4 GetUV(const mat4 renderTextureMatrix){vec4 texCoord=renderTextureMatrix*vec4(vexPos.xyz,1.0);texCoord=texCoord/texCoord.w;texCoord.xyz=texCoord.xyz*0.5+0.5;return texCoord;}void main(){vexPos=vec4(a_POSITION*u_Radius,1.0);v_renderTextureCoord0=GetUV(u_TexWorldViewProjMatrix0);v_renderTextureCoord1=GetUV(u_TexWorldViewProjMatrix1);v_renderTextureCoord2=GetUV(u_TexWorldViewProjMatrix2);v_renderTextureCoord3=GetUV(u_TexWorldViewProjMatrix3);v_renderTextureCoord4=GetUV(u_TexWorldViewProjMatrix4);gl_Position=u_ModelViewProjectionMatrix*vexPos;}")},viewDomeCalculateAnalysis:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D u_DepthMap;varying vec4 v_renderTextureCoord;\n#include <fn_unpackDepth>\nbool IsValidUV(vec4 texCoord){if((texCoord.x<=1.0)&&(texCoord.x>=-1.0)&&(texCoord.y<=1.0)&&(texCoord.y>=-1.0)&&(texCoord.z<=1.0)&&(texCoord.z>=-1.0)){return true;}else{return false;}}void main(){bool isVisible=false;if(IsValidUV(v_renderTextureCoord)){float depth=unpackDepth(texture2D(u_DepthMap,v_renderTextureCoord.xy));if(depth>1.0-0.00001){isVisible=true;}}if(!isVisible){gl_FragColor=vec4(1.0,0.0,0.0,1.0);}else{gl_FragColor=vec4(0.0,1.0,0.0,1.0);}}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\nvarying vec4 v_renderTextureCoord;vec4 GetUV(vec4 vexPos){vec4 texCoord=vec4(vexPos.xyz,1.0);texCoord.xyz=texCoord.xyz*0.5+0.5;return texCoord;}void main(){vec4 vexPos=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);v_renderTextureCoord=GetUV(vexPos);gl_Position=vexPos;}")},viewshedAnalysis:{fragmentSource:f_("precision highp float;\n#define GLSLIFY 1\nuniform sampler2D u_DepthTexture;uniform sampler2D u_ViewshedDepthTexture;uniform mat4 u_textureViewMatrix;uniform mat4 u_textureProjMatrix;uniform float u_farDist;varying vec2 v_TexCoord;\n#include <fn_readDepth>\nvoid main(){vec4 result=vec4(0.,0.,0.,1.);if(result.x!=1.0){float sceneDepth=readDepth(u_DepthTexture,v_TexCoord,true);vec4 projPos=vec4(v_TexCoord*2.0-1.0,sceneDepth*2.0-1.0,1.0);vec4 texViewPos=u_textureViewMatrix*projPos;vec4 texProjPos=u_textureProjMatrix*texViewPos;texProjPos/=texProjPos.w;texProjPos.xyz=texProjPos.xyz*0.5+0.5;texViewPos/=texViewPos.w;texViewPos.xyz*=u_farDist/length(texViewPos.xyz);vec4 farPos=u_textureProjMatrix*texViewPos;float farDepth=farPos.z/farPos.w;farDepth=farDepth*0.5+0.5;farDepth=min(farDepth,1.0);if(texProjPos.x>0.0&&texProjPos.x<1.0&&texProjPos.y>0.0&&texProjPos.y<1.0&&texProjPos.z>0.5&&texProjPos.z<farDepth){float texelSize=1.0/2048.0;float depth0=readDepth(u_ViewshedDepthTexture,texProjPos.xy,false);float depth1=readDepth(u_ViewshedDepthTexture,texProjPos.xy+vec2(-texelSize,0.0),false);float depth2=readDepth(u_ViewshedDepthTexture,texProjPos.xy+vec2(texelSize,0.0),false);float depth3=readDepth(u_ViewshedDepthTexture,texProjPos.xy+vec2(0.0,-texelSize),false);float depth4=readDepth(u_ViewshedDepthTexture,texProjPos.xy+vec2(0.0,texelSize),false);float depth=max(max(max(max(depth0,depth1),depth2),depth3),depth4);if(depth<1.0&&depth-texProjPos.z<-1.0e-5){result.x=0.5;}else{result.x=1.0;}}}gl_FragColor=result;}"),vertexSource:f_(u_)},viewshedMix:{fragmentSource:f_("precision highp float;\n#define GLSLIFY 1\nuniform sampler2D u_resultTexture;uniform vec4 u_visibleAreaColor;uniform vec4 u_hiddenAreaColor;varying vec2 v_TexCoord;void main(){vec4 color=vec4(0.0);vec4 result=texture2D(u_resultTexture,v_TexCoord);if(result.x>0.9){color=u_visibleAreaColor;}else if(result.x>0.4){color=u_hiddenAreaColor;}gl_FragColor=color;}"),vertexSource:f_(u_)},sightlineAnalysis:{fragmentSource:f_("#define GLSLIFY 1\nuniform vec4 u_VisibleColor;uniform vec4 u_HiddenColor;uniform sampler2D u_DepthTexture;uniform sampler2D u_ViewshedDepthTexture;uniform bool u_MainCameraDetection;\n#include <fn_readDepth>\nvarying vec4 v_ViewshedTexCoord;varying vec4 v_TexCoord;void main(){vec4 resultColor=u_VisibleColor;vec4 texCoord=v_ViewshedTexCoord/v_ViewshedTexCoord.w;float depth=texCoord.z*0.5+0.5;texCoord.xy=texCoord.xy*0.5+0.5;float viewshedDepth=readDepth(u_ViewshedDepthTexture,texCoord.xy,false);if(viewshedDepth<depth&&viewshedDepth>0.0&&viewshedDepth<1.0){resultColor=u_HiddenColor;}if(u_MainCameraDetection){vec4 sceneTexCoord=v_TexCoord/v_TexCoord.w;float linePixelDepth=sceneTexCoord.z*0.5+0.5;sceneTexCoord.xy=sceneTexCoord.xy*0.5+0.5;float sceneDepth=readDepth(u_DepthTexture,sceneTexCoord.xy,true);if(sceneDepth<linePixelDepth){resultColor=vec4(0.4,0.4,0.4,1.0);}}gl_FragColor=resultColor;}"),vertexSource:f_("precision highp float;\n#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\nuniform mat4 u_ModelViewProjectionMatrixOnViewshed;varying vec4 v_ViewshedTexCoord;varying vec4 v_TexCoord;void main(){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);v_ViewshedTexCoord=u_ModelViewProjectionMatrixOnViewshed*vec4(a_POSITION,1.0);v_TexCoord=gl_Position;}")},sightlineMix:{fragmentSource:f_("precision highp float;\n#define GLSLIFY 1\nuniform sampler2D u_resultTexture;uniform vec4 u_VisibleColor;uniform vec4 u_HiddenColor;varying vec2 v_TexCoord;uniform vec2 u_World;float visibleCount=0.0;float hiddenCount=0.0;float otherCount=0.0;vec4 grayColor=vec4(0.4,0.4,0.4,1.0);float epsilon=0.002;void checkPixel(vec4 pixel){if(length(pixel-u_HiddenColor)<epsilon){hiddenCount++;}else if(length(pixel-u_VisibleColor)<epsilon){visibleCount++;}else if(length(pixel-grayColor)<epsilon){otherCount++;}}void main(){vec4 result=texture2D(u_resultTexture,v_TexCoord);checkPixel(result);for(float i=1.0;i<float(M_LINE_WIDTH);i++){checkPixel(texture2D(u_resultTexture,v_TexCoord+vec2(0.0,i/u_World.y)));checkPixel(texture2D(u_resultTexture,v_TexCoord-vec2(0.0,i/u_World.y)));checkPixel(texture2D(u_resultTexture,v_TexCoord+vec2(i/u_World.x,0.0)));checkPixel(texture2D(u_resultTexture,v_TexCoord-vec2(i/u_World.x,0.0)));}if(hiddenCount>0.0||visibleCount>0.0||otherCount>0.0){if(visibleCount>hiddenCount){if(visibleCount>otherCount){gl_FragColor=u_VisibleColor;}else{gl_FragColor=grayColor;}}else{if(hiddenCount>otherCount){gl_FragColor=u_HiddenColor;}else{gl_FragColor=grayColor;}}}else{gl_FragColor=result;}}"),vertexSource:f_(u_)},PolylineMaterial:{fragmentSource:f_("#include <u_Opacity>\n#ifndef M_POLYLINE_DASH\n#include <u_PixelRatio>\n#endif\n#extension GL_EXT_frag_depth : enable\n#define GLSLIFY 1\nuniform float u_OneOverLog2FarDepthFromNearPlusOne;uniform float u_FarDepthFromNearPlusOne;\n#ifdef M_SHADOW_VOLUME\n#include <u_Viewport>\n#include <u_CurrentFrustum>\n#include <u_FrustumPlanes>\nuniform mat4 u_ViewportTransformation;uniform mat4 u_InverseProjection;uniform sampler2D u_DepthTexture;\n#include <fn_readDepth>\n#include <fn_windowToEyeCoordinates>\n#include <fn_metersPerPixel>\n#include <fn_planeDistance>\nvarying vec4 v_startPlaneNormalEcAndHalfWidth;varying vec4 v_endPlaneNormalEcAndBatchId;varying vec4 v_rightPlaneEC;varying vec4 v_endEcAndStartEcX;varying vec4 v_texcoordNormalizationAndStartEcYZ;\n#else\n#include <v_TexCoord2>\n#endif\n#ifdef M_LOG_DEPTH\nvarying float v_depthFromNearPlusOne;\n#endif\n#ifdef M_VERTEX_COLOR\nvarying vec3 v_Color;\n#endif\nvoid czm_writeLogDepth(float depth){\n#if defined(GL_EXT_frag_depth) && defined(M_LOG_DEPTH)\nif(depth<=0.9999999||depth>u_FarDepthFromNearPlusOne){discard;}gl_FragDepthEXT=log2(depth)*u_OneOverLog2FarDepthFromNearPlusOne;\n#endif\n}void czm_writeLogDepth(){\n#ifdef M_LOG_DEPTH\nczm_writeLogDepth(v_depthFromNearPlusOne);\n#endif\n}void main(){vec2 texCoord=vec2(0.0);\n#ifdef M_SHADOW_VOLUME\n#ifdef M_SHADOWVOLUME_DISCARD\nfloat flag=texture2D(u_DepthTexture,gl_FragCoord.xy/u_Viewport.zw).g;if(flag>0.1){discard;}\n#endif\nfloat logDepthOrDepth=readDepth(u_DepthTexture,gl_FragCoord.xy/u_Viewport.zw,false);if(logDepthOrDepth==0.0){discard;}vec3 ecStart=vec3(v_endEcAndStartEcX.w,v_texcoordNormalizationAndStartEcYZ.zw);vec4 eyeCoordinate=windowToEyeCoordinates(gl_FragCoord.xy,logDepthOrDepth);eyeCoordinate/=eyeCoordinate.w;float halfMaxWidth=v_startPlaneNormalEcAndHalfWidth.w;\n#ifdef M_PIXEL_WIDTH\nhalfMaxWidth*=metersPerPixel(eyeCoordinate);\n#endif\nfloat widthwiseDistance=planeDistance(v_rightPlaneEC,eyeCoordinate.xyz);float distanceFromStart=planeDistance(v_startPlaneNormalEcAndHalfWidth.xyz,-dot(ecStart,v_startPlaneNormalEcAndHalfWidth.xyz),eyeCoordinate.xyz);float distanceFromEnd=planeDistance(v_endPlaneNormalEcAndBatchId.xyz,-dot(v_endEcAndStartEcX.xyz,v_endPlaneNormalEcAndBatchId.xyz),eyeCoordinate.xyz);if(abs(widthwiseDistance)>halfMaxWidth||distanceFromStart<0.0||distanceFromEnd<0.0){discard;}vec3 alignedPlaneNormal;alignedPlaneNormal=cross(v_rightPlaneEC.xyz,v_startPlaneNormalEcAndHalfWidth.xyz);alignedPlaneNormal=normalize(cross(alignedPlaneNormal,v_rightPlaneEC.xyz));distanceFromStart=planeDistance(alignedPlaneNormal,-dot(alignedPlaneNormal,ecStart),eyeCoordinate.xyz);alignedPlaneNormal=cross(v_rightPlaneEC.xyz,v_endPlaneNormalEcAndBatchId.xyz);alignedPlaneNormal=normalize(cross(alignedPlaneNormal,v_rightPlaneEC.xyz));distanceFromEnd=planeDistance(alignedPlaneNormal,-dot(alignedPlaneNormal,v_endEcAndStartEcX.xyz),eyeCoordinate.xyz);float s=clamp(distanceFromStart/(distanceFromStart+distanceFromEnd),0.0,1.0);s=(s*v_texcoordNormalizationAndStartEcYZ.x)+v_texcoordNormalizationAndStartEcYZ.y;float t=(widthwiseDistance+halfMaxWidth)/(2.0*halfMaxWidth);texCoord=vec2(s,t);\n#else\ntexCoord=v_TexCoord;\n#endif\nvec4 color;\n#ifdef M_VERTEX_COLOR\ncolor=vec4(v_Color,1.0);\n#else\ncolor=getMaterial(texCoord);\n#endif\ngl_FragColor=vec4(color.rgb,color.a*u_Opacity);czm_writeLogDepth();}"),vertexSource:f_("#define GLSLIFY 1\n#include <u_CurrentFrustum>\n#include <u_FrustumPlanes>\n#include <u_EncodedCameraPosition>\n#include <u_ProjectionMatrix>\n#include <u_PixelRatio>\n#include <u_Viewport>\n#include <fn_metersPerPixel>\nuniform mat4 u_ViewportTransformation;uniform mat4 u_ViewportOrthographic;uniform mat4 u_modelViewRelativeToEye;uniform mat3 u_Normal;uniform float u_GlobeMinimumAltitude;uniform float u_GeometricToleranceOverMeter;\n#include <fn_translateRelativeToEye>\n#ifdef M_SHADOW_VOLUME\nattribute vec3 a_PositionHigh;attribute vec3 a_PositionLow;attribute vec3 a_StartHigh;attribute vec3 a_StartLow;attribute vec3 a_StartNormal;attribute vec3 a_EndNormal;attribute vec3 a_RightNormal;attribute vec3 a_ForwardOffset;attribute vec2 a_TexCoord;attribute float a_Width;varying vec4 v_startPlaneNormalEcAndHalfWidth;varying vec4 v_endPlaneNormalEcAndBatchId;varying vec4 v_rightPlaneEC;varying vec4 v_endEcAndStartEcX;varying vec4 v_texcoordNormalizationAndStartEcYZ;\n#include <fn_planeDistance>\n#include <fn_branchFreeTernary>\n#include <fn_polylineVolumePosition>\n#else\nattribute vec3 a_PositionHigh;attribute vec3 a_PositionLow;attribute vec3 a_PrevPositionHigh;attribute vec3 a_PrevPositionLow;attribute vec3 a_NextPositionHigh;attribute vec3 a_NextPositionLow;attribute vec2 a_ExpandAndWidth;attribute vec2 a_TEXCOORD_0;\n#include <fn_polylineVertexPosition>\n#include <v_TexCoord2>\n#endif\nvarying float v_polylineAngle;\n#ifdef M_LOG_DEPTH\nvarying float v_depthFromNearPlusOne;\n#include <fn_vertexLogDepth>\n#endif\n#ifdef M_VERTEX_COLOR\nattribute vec3 a_Color;varying vec3 v_Color;\n#endif\nvoid main(){\n#ifdef M_SHADOW_VOLUME\nfloat angle;gl_Position=polylineVolumePosition(angle);v_polylineAngle=angle;gl_Position.z=min(gl_Position.z,gl_Position.w);\n#else\nfloat angle;vec4 positionWC=polylineVertexPosition(angle);v_polylineAngle=angle;gl_Position=u_ViewportOrthographic*positionWC;v_TexCoord=a_TEXCOORD_0;\n#endif\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n#ifdef M_VERTEX_COLOR\nv_Color=a_Color;\n#endif\n}")},point:{fragmentSource:f_("#define GLSLIFY 1\nvarying vec4 v_color;varying vec4 v_outlineColor;varying float v_innerPercent;varying float v_pixelDistance;\n#ifdef M_PICK_COLOR\nvarying vec4 v_PickColor;\n#endif\n#include <u_CurrentFrustum>\n#include <fn_writeLogDepth>\n#ifdef M_LOG_DEPTH\nvarying float v_depthFromNearPlusOne;\n#endif\nvoid main(){float distanceToCenter=length(gl_PointCoord-vec2(0.5));float maxDistance=max(0.0,0.5-v_pixelDistance);float wholeAlpha=1.0-smoothstep(maxDistance,0.5,distanceToCenter);float innerAlpha=1.0-smoothstep(maxDistance*v_innerPercent,0.5*v_innerPercent,distanceToCenter);vec4 color=mix(v_outlineColor,v_color,innerAlpha);color.a*=wholeAlpha;\n#if !defined(M_OPAQUE) && !defined(M_TRANSLUCENT)\nif(color.a<0.005){discard;}\n#else\n#ifdef M_OPAQUE\nif(color.a<0.995){discard;}\n#else\nif(color.a>=0.995){discard;}\n#endif\n#endif\n#ifdef M_PICK_COLOR\ngl_FragColor=v_PickColor;\n#else\ngl_FragColor=color;\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}"),vertexSource:f_("#define GLSLIFY 1\nuniform float u_maxTotalPointSize;\n#include <u_PixelRatio>\nuniform mat4 u_modelViewRelativeToEye;\n#include <u_ProjectionMatrix>\nuniform vec2 u_CurrentFrustum;attribute vec4 a_PositionHighAndSize;attribute vec4 a_PositionLowAndOutline;attribute vec3 a_CompressedAttribute0;attribute vec4 a_CompressedAttribute1;attribute vec4 a_ScaleByDistance;attribute vec2 a_DistanceDisplayCondition;varying vec4 v_color;varying vec4 v_outlineColor;varying float v_innerPercent;varying float v_pixelDistance;const float SHIFT_LEFT8=256.0;const float SHIFT_RIGHT8=1.0/256.0;\n#include <u_EncodedCameraPosition>\n#include <fn_translateRelativeToEye>\n#include <fn_nearFarScalar>\n#include <fn_vertexLogDepth>\n#ifdef M_PICK_COLOR\nattribute vec4 a_PickColor;varying vec4 v_PickColor;\n#endif\nvoid main(){vec3 positionHigh=a_PositionHighAndSize.xyz;vec3 positionLow=a_PositionLowAndOutline.xyz;float outlineWidthBothSides=2.0*a_PositionLowAndOutline.w;float totalSize=a_PositionHighAndSize.w+outlineWidthBothSides;float outlinePercent=outlineWidthBothSides/totalSize;totalSize*=u_PixelRatio;totalSize+=3.0;float temp=a_CompressedAttribute1.x*SHIFT_RIGHT8;float show=floor(temp);\n#ifdef M_EYE_DISTANCE_TRANSLUCENCY\nvec4 translucencyByDistance;translucencyByDistance.x=a_CompressedAttribute1.z;translucencyByDistance.z=a_CompressedAttribute1.w;translucencyByDistance.y=((temp-floor(temp))*SHIFT_LEFT8)/255.0;temp=a_CompressedAttribute1.y*SHIFT_RIGHT8;translucencyByDistance.w=((temp-floor(temp))*SHIFT_LEFT8)/255.0;\n#endif\nvec4 color;vec4 outlineColor;temp=a_CompressedAttribute0.x*SHIFT_RIGHT8;color.b=(temp-floor(temp))*SHIFT_LEFT8;temp=floor(temp)*SHIFT_RIGHT8;color.g=(temp-floor(temp))*SHIFT_LEFT8;color.r=floor(temp);temp=a_CompressedAttribute0.y*SHIFT_RIGHT8;outlineColor.b=(temp-floor(temp))*SHIFT_LEFT8;temp=floor(temp)*SHIFT_RIGHT8;outlineColor.g=(temp-floor(temp))*SHIFT_LEFT8;outlineColor.r=floor(temp);temp=a_CompressedAttribute0.z*SHIFT_RIGHT8;temp=floor(temp)*SHIFT_RIGHT8;outlineColor.a=(temp-floor(temp))*SHIFT_LEFT8;outlineColor/=255.0;color.a=floor(temp);color/=255.0;vec4 p=translateRelativeToEye(positionHigh,positionLow);vec4 positionEC=u_modelViewRelativeToEye*p;float lengthSq;\n#if defined(M_EYE_DISTANCE_SCALING) || defined(M_EYE_DISTANCE_TRANSLUCENCY) || defined(M_DISTANCE_DISPLAY_CONDITION)\nlengthSq=dot(positionEC.xyz,positionEC.xyz);\n#endif\n#ifdef M_EYE_DISTANCE_SCALING\ntotalSize*=nearFarScalar(a_ScaleByDistance,lengthSq);\n#endif\ntotalSize=min(totalSize,u_maxTotalPointSize);if(totalSize<1.0){positionEC.xyz=vec3(0.0);totalSize=1.0;}float translucency=1.0;\n#ifdef M_EYE_DISTANCE_TRANSLUCENCY\ntranslucency=nearFarScalar(translucencyByDistance,lengthSq);if(translucency<0.004){positionEC.xyz=vec3(0.0);}\n#endif\n#ifdef M_DISTANCE_DISPLAY_CONDITION\nfloat nearSq=a_DistanceDisplayCondition.x;float farSq=a_DistanceDisplayCondition.y;if(lengthSq<nearSq||lengthSq>farSq){positionEC.xyz=vec3(0.0,0.0,1.0);}\n#endif\ngl_Position=u_ProjectionMatrix*positionEC;\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\nv_color=color;v_color.a*=translucency*show;v_outlineColor=outlineColor;v_outlineColor.a*=translucency*show;v_innerPercent=1.0-outlinePercent;v_pixelDistance=2.0/totalSize;gl_PointSize=totalSize*show;gl_Position*=show;\n#ifdef M_PICK_COLOR\nv_PickColor=a_PickColor;\n#endif\n}")},AcesTonemappingStage:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D colorTexture;\n#include <u_Gamma>\n#include <fn_acesTonemapping>\n#include <fn_inverseGamma>\nvarying vec2 v_TexCoord;\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\nvoid main(){vec4 fragmentColor=texture2D(colorTexture,v_TexCoord);vec3 color=fragmentColor.rgb;\n#ifdef AUTO_EXPOSURE\ncolor/=texture2D(autoExposure,vec2(0.5)).r;\n#endif\ncolor=acesTonemapping(color);color=inverseGamma(color,u_Gamma);gl_FragColor=vec4(color,fragmentColor.a);}")},AdditiveBlend:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D colorTexture;uniform sampler2D colorTexture2;uniform vec2 center;uniform float radius;varying vec2 v_TexCoord;void main(){vec4 color0=texture2D(colorTexture,v_TexCoord);vec4 color1=texture2D(colorTexture2,v_TexCoord);float x=length(gl_FragCoord.xy-center)/radius;float t=smoothstep(0.5,0.8,x);gl_FragColor=mix(color0+color1,color1,t);}")},AmbientOcclusionGenerate:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D randomTexture;uniform sampler2D u_depthTexture;uniform float intensity;uniform float bias;uniform float lengthCap;uniform float stepSize;uniform float frustumLength;\n#include <u_Viewport>\n#include <u_PixelRatio>\n#include <fn_readDepth>\nvarying vec2 v_TexCoord;vec4 clipToEye(vec2 uv,float depth){vec2 xy=vec2((uv.x*2.0-1.0),((1.0-uv.y)*2.0-1.0));vec4 posEC=czm_inverseProjection*vec4(xy,depth,1.0);posEC=posEC/posEC.w;return posEC;}vec3 getNormalXEdge(vec3 posInCamera,float depthU,float depthD,float depthL,float depthR,vec2 pixelSize){vec4 posInCameraUp=clipToEye(v_TexCoord-vec2(0.0,pixelSize.y),depthU);vec4 posInCameraDown=clipToEye(v_TexCoord+vec2(0.0,pixelSize.y),depthD);vec4 posInCameraLeft=clipToEye(v_TexCoord-vec2(pixelSize.x,0.0),depthL);vec4 posInCameraRight=clipToEye(v_TexCoord+vec2(pixelSize.x,0.0),depthR);vec3 up=posInCamera.xyz-posInCameraUp.xyz;vec3 down=posInCameraDown.xyz-posInCamera.xyz;vec3 left=posInCamera.xyz-posInCameraLeft.xyz;vec3 right=posInCameraRight.xyz-posInCamera.xyz;vec3 DX=length(left)<length(right)? left : right;vec3 DY=length(up)<length(down)? up : down;return normalize(cross(DY,DX));}void main(void){float depth=readDepth(u_depthTexture,v_TexCoord,true);vec4 posInCamera=clipToEye(v_TexCoord,depth);if(posInCamera.z>frustumLength){gl_FragColor=vec4(1.0);return;}vec2 pixelSize=u_PixelRatio/u_Viewport.zw;float depthU=readDepth(u_depthTexture,v_TexCoord-vec2(0.0,pixelSize.y),true);float depthD=readDepth(u_depthTexture,v_TexCoord+vec2(0.0,pixelSize.y),true);float depthL=readDepth(u_depthTexture,v_TexCoord-vec2(pixelSize.x,0.0),true);float depthR=readDepth(u_depthTexture,v_TexCoord+vec2(pixelSize.x,0.0),true);vec3 normalInCamera=getNormalXEdge(posInCamera.xyz,depthU,depthD,depthL,depthR,pixelSize);float ao=0.0;vec2 sampleDirection=vec2(1.0,0.0);float gapAngle=90.0*czm_radiansPerDegree;float randomVal=texture2D(randomTexture,v_TexCoord).x;for(int i=0;i<4;i++){float newGapAngle=gapAngle*(float(i)+randomVal);float cosVal=cos(newGapAngle);float sinVal=sin(newGapAngle);vec2 rotatedSampleDirection=vec2(cosVal*sampleDirection.x-sinVal*sampleDirection.y,sinVal*sampleDirection.x+cosVal*sampleDirection.y);float localAO=0.0;float localStepSize=stepSize;for(int j=0;j<6;j++){vec2 newCoords=v_TexCoord+rotatedSampleDirection*localStepSize*pixelSize;if(newCoords.x>1.0||newCoords.y>1.0||newCoords.x<0.0||newCoords.y<0.0){break;}float stepDepthInfo=readDepth(u_depthTexture,newCoords,true);vec4 stepPosInCamera=clipToEye(newCoords,stepDepthInfo);vec3 diffVec=stepPosInCamera.xyz-posInCamera.xyz;float len=length(diffVec);if(len>lengthCap){break;}float dotVal=clamp(dot(normalInCamera,normalize(diffVec)),0.0,1.0);float weight=len/lengthCap;weight=1.0-weight*weight;if(dotVal<bias){dotVal=0.0;}localAO=max(localAO,dotVal*weight);localStepSize+=stepSize;}ao+=localAO;}ao/=4.0;ao=1.0-clamp(ao,0.0,1.0);ao=pow(ao,intensity);gl_FragColor=vec4(vec3(ao),1.0);}")},AmbientOcclusionModulate:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D colorTexture;uniform sampler2D ambientOcclusionTexture;uniform bool ambientOcclusionOnly;varying vec2 v_TexCoord;void main(void){vec3 color=texture2D(colorTexture,v_TexCoord).rgb;vec3 ao=texture2D(ambientOcclusionTexture,v_TexCoord).rgb;gl_FragColor.rgb=ambientOcclusionOnly ? ao : ao*color;}")},BlackAndWhite:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D colorTexture;uniform float gradations;\n#include <fn_luminance>\nvarying vec2 v_TexCoord;void main(void){vec3 rgb=texture2D(colorTexture,v_TexCoord).rgb;\n#ifdef CZM_SELECTED_FEATURE\nif(czm_selected()){gl_FragColor=vec4(rgb,1.0);return;}\n#endif\nfloat luminance=luminance(rgb);float darkness=luminance*gradations;darkness=(darkness-fract(darkness))/gradations;gl_FragColor=vec4(vec3(darkness),1.0);}")},BloomComposite:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D colorTexture;uniform sampler2D bloomTexture;uniform bool glowOnly;varying vec2 v_TexCoord;void main(void){vec4 color=texture2D(colorTexture,v_TexCoord);\n#ifdef CZM_SELECTED_FEATURE\nif(czm_selected()){gl_FragColor=color;return;}\n#endif\nvec4 bloom=texture2D(bloomTexture,v_TexCoord);gl_FragColor=glowOnly ? bloom : bloom+color;}")},Brightness:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D colorTexture;uniform float brightness;varying vec2 v_TexCoord;void main(void){vec3 rgb=texture2D(colorTexture,v_TexCoord).rgb;vec3 target=vec3(0.0);gl_FragColor=vec4(mix(target,rgb,brightness),1.0);}")},BrightPass:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D colorTexture;uniform float avgLuminance;uniform float threshold;uniform float offset;\n#include <fn_RGBToXYZ>\n#include <fn_XYZToRGB>\nvarying vec2 v_TexCoord;float key(float avg){float guess=1.5-(1.5/(avg*0.1+1.0));return max(0.0,guess)+0.1;}void main(){vec4 color=texture2D(colorTexture,v_TexCoord);vec3 xyz=RGBToXYZ(color.rgb);float luminance=xyz.r;float scaledLum=key(avgLuminance)*luminance/avgLuminance;float brightLum=max(scaledLum-threshold,0.0);float brightness=brightLum/(offset+brightLum);xyz.r=brightness;gl_FragColor=vec4(XYZToRGB(xyz),1.0);}")},CompositeTranslucentClassification:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D colorTexture;\n#ifdef DEBUG_SHOW_DEPTH\nuniform sampler2D u_packedTranslucentDepth;\n#endif\n#include <fn_unpackDepth>\nvarying vec2 v_TexCoord;void main(){\n#ifdef DEBUG_SHOW_DEPTH\nif(v_TexCoord.x<0.5){gl_FragColor.rgb=vec3(unpackDepth(texture2D(u_packedTranslucentDepth,v_TexCoord)));gl_FragColor.a=1.0;}\n#else\nvec4 color=texture2D(colorTexture,v_TexCoord);\n#ifdef PICK\nif(color==vec4(0.0)){discard;}\n#else\ncolor.rgb/=color.a;\n#endif\ngl_FragColor=color;\n#endif\n}")},ContrastBias:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D colorTexture;uniform float contrast;uniform float brightness;\n#include <fn_HSBToRGB>\n#include <fn_RGBToHSB>\nvarying vec2 v_TexCoord;void main(void){vec3 sceneColor=texture2D(colorTexture,v_TexCoord).xyz;sceneColor=RGBToHSB(sceneColor);sceneColor.z+=brightness;sceneColor=HSBToRGB(sceneColor);float factor=(259.0*(contrast+255.0))/(255.0*(259.0-contrast));sceneColor=factor*(sceneColor-vec3(0.5))+vec3(0.5);gl_FragColor=vec4(sceneColor,1.0);}")},DepthOfField:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D colorTexture;uniform sampler2D blurTexture;uniform sampler2D u_depthTexture;uniform float focalDistance;\n#include <fn_readDepth>\nvarying vec2 v_TexCoord;vec4 toEye(vec2 uv,float depth){vec2 xy=vec2((uv.x*2.0-1.0),((1.0-uv.y)*2.0-1.0));vec4 posInCamera=czm_inverseProjection*vec4(xy,depth,1.0);posInCamera=posInCamera/posInCamera.w;return posInCamera;}float computeDepthBlur(float depth){float f;if(depth<focalDistance){f=(focalDistance-depth)/(focalDistance-czm_currentFrustum.x);}else{f=(depth-focalDistance)/(czm_currentFrustum.y-focalDistance);f=pow(f,0.1);}f*=f;f=clamp(f,0.0,1.0);return pow(f,0.5);}void main(void){float depth=readDepth(u_depthTexture,v_TexCoord,true);vec4 posInCamera=toEye(v_TexCoord,depth);float d=computeDepthBlur(-posInCamera.z);gl_FragColor=mix(texture2D(colorTexture,v_TexCoord),texture2D(blurTexture,v_TexCoord),d);}")},DepthView:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D u_depthTexture;\n#include <fn_readDepth>\nvarying vec2 v_TexCoord;void main(void){float depth=readDepth(u_depthTexture,v_TexCoord,true);gl_FragColor=vec4(vec3(depth),1.0);}")},DepthViewPacked:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D u_depthTexture;\n#include <fn_unpackDepth>\n#include <fn_reverseLogDepth>\nvarying vec2 v_TexCoord;void main(){float z_window=unpackDepth(texture2D(u_depthTexture,v_TexCoord));z_window=reverseLogDepth(z_window);float n_range=czm_depthRange.near;float f_range=czm_depthRange.far;float z_ndc=(2.0*z_window-n_range-f_range)/(f_range-n_range);float scale=pow(z_ndc*0.5+0.5,8.0);gl_FragColor=vec4(mix(vec3(0.0),vec3(1.0),scale),1.0);}")},EdgeDetection:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D depthTexture;uniform float length;uniform vec4 color;\n#include <u_PixelRatio>\n#include <u_Viewport>\n#include <fn_readDepth>\nvarying vec2 v_TexCoord;void main(void){float directions[3];directions[0]=-1.0;directions[1]=0.0;directions[2]=1.0;float scalars[3];scalars[0]=3.0;scalars[1]=10.0;scalars[2]=3.0;float padx=u_PixelRatio/u_Viewport.z;float pady=u_PixelRatio/u_Viewport.w;\n#ifdef CZM_SELECTED_FEATURE\nbool selected=false;for(int i=0;i<3;++i){float dir=directions[i];selected=selected||czm_selected(vec2(-padx,dir*pady));selected=selected||czm_selected(vec2(padx,dir*pady));selected=selected||czm_selected(vec2(dir*padx,-pady));selected=selected||czm_selected(vec2(dir*padx,pady));if(selected){break;}}if(!selected){gl_FragColor=vec4(color.rgb,0.0);return;}\n#endif\nfloat horizEdge=0.0;float vertEdge=0.0;for(int i=0;i<3;++i){float dir=directions[i];float scale=scalars[i];horizEdge-=readDepth(depthTexture,v_TexCoord+vec2(-padx,dir*pady),true)*scale;horizEdge+=readDepth(depthTexture,v_TexCoord+vec2(padx,dir*pady),true)*scale;vertEdge-=readDepth(depthTexture,v_TexCoord+vec2(dir*padx,-pady),true)*scale;vertEdge+=readDepth(depthTexture,v_TexCoord+vec2(dir*padx,pady),true)*scale;}float len=sqrt(horizEdge*horizEdge+vertEdge*vertEdge);gl_FragColor=vec4(color.rgb,len>length ? color.a : 0.0);}")},FilmicTonemapping:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D colorTexture;\n#include <u_Gamma>\n#include <fn_inverseGamma>\nvarying vec2 v_TexCoord;\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\nvoid main(){vec4 fragmentColor=texture2D(colorTexture,v_TexCoord);vec3 color=fragmentColor.rgb;\n#ifdef AUTO_EXPOSURE\nfloat exposure=texture2D(autoExposure,vec2(0.5)).r;color/=exposure;\n#endif\nconst float A=0.22;const float B=0.30;const float C=0.10;const float D=0.20;const float E=0.01;const float F=0.30;const float white=11.2;vec3 c=((color*(A*color+C*B)+D*E)/(color*(A*color+B)+D*F))-E/F;float w=((white*(A*white+C*B)+D*E)/(white*(A*white+B)+D*F))-E/F;c=inverseGamma(c/w,u_Gamma);gl_FragColor=vec4(c,fragmentColor.a);}")},FXAA:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D colorTexture;\n#include <u_Resolution>\nconst float fxaaQualitySubpix=0.5;const float fxaaQualityEdgeThreshold=0.125;const float fxaaQualityEdgeThresholdMin=0.0833;varying vec2 v_TexCoord;\n#include <fn_nvidia_fxaa>\nvoid main(){vec2 fxaaQualityRcpFrame=vec2(1.0)/u_Resolution;vec4 color=FxaaPixelShader(v_TexCoord,colorTexture,fxaaQualityRcpFrame,fxaaQualitySubpix,fxaaQualityEdgeThreshold,fxaaQualityEdgeThresholdMin);float alpha=texture2D(colorTexture,v_TexCoord).a;gl_FragColor=vec4(color.rgb,alpha);}")},GaussianBlur1D:{fragmentSource:f_("#define GLSLIFY 1\n#define SAMPLES 8\nuniform float delta;uniform float sigma;uniform float direction;\n#include <u_Viewport>\n#include <u_PixelRatio>\nuniform sampler2D colorTexture;\n#ifdef USE_STEP_SIZE\nuniform float stepSize;\n#else\nuniform vec2 step;\n#endif\nvarying vec2 v_TexCoord;void main(){vec2 st=v_TexCoord;vec2 dir=vec2(1.0-direction,direction);\n#ifdef USE_STEP_SIZE\nvec2 step=vec2(stepSize*(u_PixelRatio/u_Viewport.zw));\n#else\nvec2 step=step;\n#endif\nvec3 g;g.x=1.0/(sqrt(czm_twoPi)*sigma);g.y=exp((-0.5*delta*delta)/(sigma*sigma));g.z=g.y*g.y;vec4 result=texture2D(colorTexture,st)*g.x;for(int i=1;i<SAMPLES;++i){g.xy*=g.yz;vec2 offset=float(i)*dir*step;result+=texture2D(colorTexture,st-offset)*g.x;result+=texture2D(colorTexture,st+offset)*g.x;}gl_FragColor=result;}")},LensFlare:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D colorTexture;uniform sampler2D dirtTexture;uniform sampler2D starTexture;uniform vec2 dirtTextureDimensions;uniform float distortion;uniform float ghostDispersal;uniform float haloWidth;uniform float dirtAmount;uniform float earthRadius;uniform float intensity;\n#include <u_Viewport>\n#include <u_PixelRatio>\nvarying vec2 v_TexCoord;\n#define DISTANCE_TO_SPACE 6500000.0\nvec4 getNDCFromWC(vec3 WC,float earthRadius){vec4 positionEC=czm_view*vec4(WC,1.0);positionEC=vec4(positionEC.x+earthRadius,positionEC.y,positionEC.z,1.0);vec4 positionWC=czm_eyeToWindowCoordinates(positionEC);return czm_viewportOrthographic*vec4(positionWC.xy,-positionWC.z,1.0);}float isInEarth(vec2 texcoord,vec2 sceneSize){vec2 NDC=texcoord*2.0-1.0;vec4 earthPosSC=getNDCFromWC(vec3(0.0),0.0);vec4 earthPosSCEdge=getNDCFromWC(vec3(0.0),earthRadius*1.5);NDC.xy-=earthPosSC.xy;float X=abs(NDC.x)*sceneSize.x;float Y=abs(NDC.y)*sceneSize.y;return clamp(0.0,1.0,max(sqrt(X*X+Y*Y)/max(abs(earthPosSCEdge.x*sceneSize.x),1.0)-0.8,0.0));}vec4 textureDistorted(sampler2D tex,vec2 texcoord,vec2 direction,vec3 distortion,bool isSpace){vec2 sceneSize=u_Viewport.zw;vec3 color;if(isSpace){color.r=isInEarth(texcoord+direction*distortion.r,sceneSize)*texture2D(tex,texcoord+direction*distortion.r).r;color.g=isInEarth(texcoord+direction*distortion.g,sceneSize)*texture2D(tex,texcoord+direction*distortion.g).g;color.b=isInEarth(texcoord+direction*distortion.b,sceneSize)*texture2D(tex,texcoord+direction*distortion.b).b;}else{color.r=texture2D(tex,texcoord+direction*distortion.r).r;color.g=texture2D(tex,texcoord+direction*distortion.g).g;color.b=texture2D(tex,texcoord+direction*distortion.b).b;}return vec4(clamp(color,0.0,1.0),0.0);}void main(void){vec4 originalColor=texture2D(colorTexture,v_TexCoord);vec3 rgb=originalColor.rgb;bool isSpace=length(czm_viewerPositionWC.xyz)>DISTANCE_TO_SPACE;vec4 sunPos=czm_morphTime==1.0 ? vec4(czm_sunPositionWC,1.0): vec4(czm_sunPositionColumbusView.zxy,1.0);vec4 sunPositionEC=czm_view*sunPos;vec4 sunPositionWC=czm_eyeToWindowCoordinates(sunPositionEC);sunPos=czm_viewportOrthographic*vec4(sunPositionWC.xy,-sunPositionWC.z,1.0);if(!isSpace||!((sunPos.x>=-1.1&&sunPos.x<=1.1)&&(sunPos.y>=-1.1&&sunPos.y<=1.1))){gl_FragColor=originalColor;return;}vec2 texcoord=vec2(1.0)-v_TexCoord;vec2 pixelSize=u_PixelRatio/u_Viewport.zw;vec2 invPixelSize=1.0/pixelSize;vec3 distortionVec=pixelSize.x*vec3(-distortion,0.0,distortion);vec2 ghostVec=(vec2(0.5)-texcoord)*ghostDispersal;vec3 direction=normalize(vec3(ghostVec,0.0));vec4 result=vec4(0.0);vec4 ghost=vec4(0.0);for(int i=0;i<4;++i){vec2 offset=fract(texcoord+ghostVec*float(i));ghost+=textureDistorted(colorTexture,offset,direction.xy,distortionVec,isSpace);}result+=ghost;vec2 haloVec=normalize(ghostVec)*haloWidth;float weightForHalo=length(vec2(0.5)-fract(texcoord+haloVec))/length(vec2(0.5));weightForHalo=pow(1.0-weightForHalo,5.0);result+=textureDistorted(colorTexture,texcoord+haloVec,direction.xy,distortionVec,isSpace)*weightForHalo*1.5;vec2 dirtTexCoords=(v_TexCoord*invPixelSize)/dirtTextureDimensions;if(dirtTexCoords.x>1.0){dirtTexCoords.x=mod(floor(dirtTexCoords.x),2.0)==1.0 ? 1.0-fract(dirtTexCoords.x): fract(dirtTexCoords.x);}if(dirtTexCoords.y>1.0){dirtTexCoords.y=mod(floor(dirtTexCoords.y),2.0)==1.0 ? 1.0-fract(dirtTexCoords.y): fract(dirtTexCoords.y);}result+=dirtAmount*texture2D(dirtTexture,dirtTexCoords);float camrot=czm_view[0].z+czm_view[1].y;float cosValue=cos(camrot);float sinValue=sin(camrot);mat3 rotation=mat3(cosValue,-sinValue,0.0,sinValue,cosValue,0.0,0.0,0.0,1.0);vec3 st1=vec3(v_TexCoord*2.0-vec2(1.0),1.0);vec3 st2=vec3((rotation*st1).xy,1.0);vec3 st3=st2*0.5+vec3(0.5);vec2 lensStarTexcoord=st3.xy;float weightForLensFlare=length(vec3(sunPos.xy,0.0));float oneMinusWeightForLensFlare=max(1.0-weightForLensFlare,0.0);if(!isSpace){result*=oneMinusWeightForLensFlare*intensity*0.2;}else{result*=oneMinusWeightForLensFlare*intensity;result*=texture2D(starTexture,lensStarTexcoord)*pow(weightForLensFlare,1.0)*max((1.0-length(vec3(st1.xy,0.0))),0.0)*2.0;}result+=texture2D(colorTexture,v_TexCoord);gl_FragColor=result;}")},ModifiedReinhardTonemapping:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D colorTexture;uniform vec3 white;\n#include <u_Gamma>\n#include <fn_inverseGamma>\nvarying vec2 v_TexCoord;\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\nvoid main(){vec4 fragmentColor=texture2D(colorTexture,v_TexCoord);vec3 color=fragmentColor.rgb;\n#ifdef AUTO_EXPOSURE\nfloat exposure=texture2D(autoExposure,vec2(0.5)).r;color/=exposure;\n#endif\ncolor=(color*(1.0+color/white))/(1.0+color);color=inverseGamma(color,u_Gamma);gl_FragColor=vec4(color,fragmentColor.a);}")},NightVision:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D colorTexture;\n#include <u_FrameTime>\nvarying vec2 v_TexCoord;float rand(vec2 co){return fract(sin(dot(co.xy,vec2(12.9898,78.233)))*43758.5453);}void main(void){float noiseValue=rand(v_TexCoord+sin(u_FrameTime))*0.1;vec3 rgb=texture2D(colorTexture,v_TexCoord).rgb;vec3 green=vec3(0.0,1.0,0.0);gl_FragColor=vec4((noiseValue+rgb)*green,1.0);}")},PassThrough:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D colorTexture;varying vec2 v_TexCoord;void main(){gl_FragColor=texture2D(colorTexture,v_TexCoord);}")},PassThroughDepth:{fragmentSource:f_("#define GLSLIFY 1\nuniform highp sampler2D u_depthTexture;\n#include <fn_writeDepth>\n#include <fn_readDepth>\nvarying vec2 v_TexCoord;void main(){gl_FragColor=writeDepth(readDepth(u_depthTexture,v_TexCoord,true));}")},PointCloudEyeDomeLighting:{fragmentSource:f_("#extension GL_EXT_frag_depth : enable\n#define GLSLIFY 1\nuniform sampler2D u_pointCloud_colorGBuffer;uniform sampler2D u_pointCloud_depthGBuffer;uniform vec2 u_distanceAndEdlStrength;\n#include <u_Viewport>\n#include <fn_windowToEyeCoordinates>\n#include <fn_unpackDepth>\nvarying vec2 v_TexCoord;vec2 neighborContribution(float log2Depth,vec2 offset){float dist=u_distanceAndEdlStrength.x;vec2 texCoordOrig=v_TexCoord+offset*dist;vec2 texCoord0=v_TexCoord+offset*floor(dist);vec2 texCoord1=v_TexCoord+offset*ceil(dist);float depthOrLogDepth0=unpackDepth(texture2D(u_pointCloud_depthGBuffer,texCoord0));float depthOrLogDepth1=unpackDepth(texture2D(u_pointCloud_depthGBuffer,texCoord1));if(depthOrLogDepth0==0.0||depthOrLogDepth1==0.0){return vec2(0.0);}float depthMix=mix(depthOrLogDepth0,depthOrLogDepth1,fract(dist));vec4 eyeCoordinate=fn_windowToEyeCoordinates(texCoordOrig,depthMix);return vec2(max(0.0,log2Depth-log2(-eyeCoordinate.z/eyeCoordinate.w)),1.0);}void main(){float depthOrLogDepth=unpackDepth(texture2D(u_pointCloud_depthGBuffer,v_TexCoord));vec4 eyeCoordinate=fn_windowToEyeCoordinates(gl_FragCoord.xy,depthOrLogDepth);eyeCoordinate/=eyeCoordinate.w;float log2Depth=log2(-eyeCoordinate.z);if(depthOrLogDepth==0.0){discard;}vec4 color=texture2D(u_pointCloud_colorGBuffer,v_TexCoord);vec2 texelSize=1.0/u_Viewport.zw;vec2 responseAndCount=vec2(0.0);responseAndCount+=neighborContribution(log2Depth,vec2(-texelSize.x,0.0));responseAndCount+=neighborContribution(log2Depth,vec2(+texelSize.x,0.0));responseAndCount+=neighborContribution(log2Depth,vec2(0.0,-texelSize.y));responseAndCount+=neighborContribution(log2Depth,vec2(0.0,+texelSize.y));float response=responseAndCount.x/responseAndCount.y;float strength=u_distanceAndEdlStrength.y;float shade=exp(-response*300.0*strength);color.rgb*=shade;gl_FragColor=vec4(color);gl_FragDepthEXT=depthOrLogDepth;}")},ReinhardTonemapping:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D colorTexture;\n#include <u_Gamma>\n#include <fn_inverseGamma>\nvarying vec2 v_TexCoord;\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\nvoid main(){vec4 fragmentColor=texture2D(colorTexture,v_TexCoord);vec3 color=fragmentColor.rgb;\n#ifdef AUTO_EXPOSURE\nfloat exposure=texture2D(autoExposure,vec2(0.5)).r;color/=exposure;\n#endif\ncolor=color/(1.0+color);color=inverseGamma(color,u_Gamma);gl_FragColor=vec4(color,fragmentColor.a);}")},Silhouette:{fragmentSource:f_("#define GLSLIFY 1\nuniform sampler2D colorTexture;uniform sampler2D silhouetteTexture;varying vec2 v_TexCoord;void main(void){vec4 silhouetteColor=texture2D(silhouetteTexture,v_TexCoord);vec4 color=texture2D(colorTexture,v_TexCoord);gl_FragColor=mix(color,silhouetteColor,silhouetteColor.a);}")},showDepth:{fragmentSource:f_("precision highp float;\n#define GLSLIFY 1\n#include <u_BaseColorSampler>\nuniform sampler2D u_BackgroundSampler;\n#include <fn_readDepth>\n#include <fn_writeDepth>\nvarying vec2 v_TexCoord;void main(){float r=readDepth(u_BaseColorSampler,v_TexCoord,false);float r1=readDepth(u_BackgroundSampler,v_TexCoord,false);float flag=0.0;if(r<r1){r1=r;flag=1.0;}gl_FragColor=vec4(r1,flag,0.0,1.0);}"),vertexSource:f_("#define GLSLIFY 1\n#include <a_POSITION2>\n#include <u_ModelViewProjectionMatrix>\n#include <u_World>\n#include <v_TexCoord2>\nvoid main(){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION*u_World,0,1);v_TexCoord.x=a_POSITION.x;v_TexCoord.y=1.0-a_POSITION.y;}")}},g_=/#pragma minemap: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g;for(const e in __){const t=__[e],i={};t.fragmentSource=t.fragmentSource?.replace(g_,((e,t,n,r,o)=>(i[o]=!0,"define"===t?`\n#ifndef HAS_UNIFORM_u_${o}\nvarying ${n} ${r} ${o};\n#else\nuniform ${n} ${r} u_${o};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${o}\n    ${n} ${r} ${o} = u_${o};\n#endif\n`))),t.vertexSource=t.vertexSource?.replace(g_,((e,t,n,r,o)=>{const a="float"===r?"vec2":"vec4",s=-1!=o.indexOf("pattern_from")||-1!=o.indexOf("pattern_to")||-1!=o.indexOf("top_pattern_from")||-1!=o.indexOf("top_pattern_to");return i[o]?"define"===t?`\n#ifndef HAS_UNIFORM_u_${o}\nuniform lowp float a_${o}_t;\nattribute ${n} ${a} a_${o};\nvarying ${n} ${r} ${o};\n#else\nuniform ${n} ${r} u_${o};\n#endif\n`:s?`\n#ifndef HAS_UNIFORM_u_${o}\n    ${o} = a_${o};\n#else\n    ${n} ${r} ${o} = u_${o};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${o}\n    ${o} = unpack_mix_${a}(a_${o}, a_${o}_t);\n#else\n    ${n} ${r} ${o} = u_${o};\n#endif\n`:"define"===t?`\n#ifndef HAS_UNIFORM_u_${o}\nuniform lowp float a_${o}_t;\nattribute ${n} ${a} a_${o};\n#else\nuniform ${n} ${r} u_${o};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${o}\n    ${n} ${r} ${o} = unpack_mix_${a}(a_${o}, a_${o}_t);\n#else\n    ${n} ${r} ${o} = u_${o};\n#endif\n`}));}function y_(e){return e.replace(m_,x_)}function x_(e,t){const i=d_[t];if(void 0===i)throw new Error(`Can not resolve #include <${t}>`);return y_(i)}class v_{constructor(e){this._type=e.type,this._defines=$(e.defines)?e.defines:{},e.noCache?(this.fragmentSource=e.fragmentSource,this.vertexSource=e.vertexSource):(e.type&&!__[e.type]&&e.fragmentSource&&e.vertexSource&&(__[e.type]={fragmentSource:e.fragmentSource,vertexSource:e.vertexSource}),this.fragmentSource=e.type?__[e.type].fragmentSource:e.fragmentSource,this.vertexSource=e.type?__[e.type].vertexSource:e.vertexSource);}set defines(e){this._defines=Qm(e,this._defines);}get defines(){return this._defines}get type(){return this._type}set type(e){e&&(__[e]&&(this.fragmentSource=__[e].fragmentSource,this.vertexSource=__[e].vertexSource),this._type=e);}destroy(){this._type="",this._defines={},this.fragmentSource=void 0,this.vertexSource=void 0;}static replaceMain(e,t){return e.replace(/void\s+main\s*\(\s*(?:void)?\s*\)/g,t=`void ${t}()`)}}class w_{constructor(e){const{json:t,joints:i}=e;this.options=e;const n=[];for(let e=0;e<i.length;e++)n.push(t.nodes[i[e]]);this._jointNode=n,this._jointMatrix=[];}get jointMatrix(){return this._jointMatrix}findRootMatrix(e){let t=e;for(;t.parent;)t=t.parent;return t.matrix.clone()}findGltfRootMatrix(e){let t=e;for(;t.parent&&"gltfNode"===t.parent.type;)t=t.parent;return t.matrix.clone()}update(){this._jointMatrix.length=0;for(let e=0;e<this._jointNode.length;e++){const t=this._jointNode[e],i=this.findRootMatrix(t).invert(),n=this.findGltfRootMatrix(t).invert().multiplyRight(t.matrixWorld.clone().multiplyLeft(i)).multiplyRight(this.options.inverseBindMatrices[e]);this._jointMatrix.push(n);}}}class T_ extends dl{constructor(e,t=!0){if(super(),this._id=e.id,this.isGLTFTreeNode=!0,this.originMatrix=void 0,this._skinsIndex=void 0,this._skeleton=void 0,this.type="gltfNode",e.matrix&&t)this.applyMatrix(new Ot(e.matrix));else {let t,i,n;e.translation&&(t=new wt(e.translation)),e.scale&&(n=new ft(e.scale)),e.rotation&&(3===e.rotation.length?i=(new Tt).fromHeadingPitchRoll(new ot(e.rotation[0],e.rotation[1],e.rotation[2])):4===e.rotation.length&&(i=new Tt(e.rotation))),this.applyMatrix(Ot.fromTranslationQuaternionRotationScale(t,i,n));}this.mesh=e.mesh,this.properties={name:e.name,id:e.mesh},this.meshes=e.meshes,$(e.skin)&&(this.skin=e.skin,this._skinsIndex=Xe(e.skin)),e.children&&(this.childIdxes=e.children),this._play=!0;}get id(){return this._id}set id(e){this._id=e;}get skeleton(){return this._skeleton}get play(){return this._play}set play(e){Je(e)&&(this._play=e);}createSkeleton(e){$(this.skin)&&(this._skeleton=new w_({json:e,id:this.skin.id,inverseBindMatrices:this.skin.inverseBindMatrices,joints:this.skin.joints,name:this.skin.name,skeleton:this.skin.skeleton,parent:this}));}update(){$(this._skeleton)&&this._skeleton.update();}}function b_(e){let t=[];return $(e.scene)?e.scene.nodes.forEach((e=>{t=t.concat(P_(e));})):$(e.scenes)&&e.scenes.forEach((e=>{e.nodes.forEach((e=>{t=t.concat(P_(e));}));})),t}function P_(e){let t=[];return $(e.children)&&e.children.forEach((e=>{t=t.concat(P_(e));})),$(e.mesh)&&(t=t.concat(e.mesh.primitives)),t}class S_{constructor(e){const{tileID:t,modelFolder:i,modelType:n,noHighlighting:r,boundingVolume:o,minemap3DType:a,instances:s,normalRight:l,normalUp:c,relativeCenter:u}=e;this.tileID=t,this.uid=Ve(),this.expirationTime=null,this.queryPadding=0,this.boundingVolume=o,this.state="loading",this.primitives=[],this.modelFolder=i,this.modelType=n||nt.MODEL_TYPE.OSGB,this.noHighlighting=r||!1,this.cartographicOrigin=[],this.childTiles=[],this.minemap3DType=a,this.instances=s,this.normalRight=l,this.normalUp=c,this.relativeCenter=u;}unloadVectorData(){this.uploaded=!1,this.primitives.forEach((e=>{e.destroy();})),this.primitives=[],this.content=void 0,this.extra=void 0,this.state="unloaded",this.boundingVolume=null;}upload(e,t,i){let n;this.source=i,this.rootNode=new T_({id:this.id}),n="3d-model"===i.type?function(e,t,i){let n=t.translation||[0,0,0];n=[n[0],n[1],n[2]];let r=[];if(t.location)r=t.location;else if(t._eventedParent){const e=t._eventedParent.tileset3d.root.transform.slice(12,15);r=lc.DefaultEllipsoid.cartesianToCartographic(e),t.location=r;}else r=t.location;if(!r)return i;const o=lc.cartographicToFixedFrame(new ft(r[0],r[1],r[2]||0));return o.multiplyRight((new Ot).rotateX(Math.PI/2)),function(e,t,i,n){let r=!1;if(!e||0===e[0]&&0===e[1]&&0===e[2]||(n.translate(e),r=!0),t)if(4===t.length)n.multiplyRight((new Ot).fromQuaternion(t)),r=!0;else if(t[0]||t[1]||t[1]){const e=new zt(t[0]*nt.TRANSFORM.DEG_TO_RAD,t[1]*nt.TRANSFORM.DEG_TO_RAD,t[2]*nt.TRANSFORM.DEG_TO_RAD,zt.XYZ).getQuaternion();n.multiplyRight((new Ot).fromQuaternion(e)),r=!0;}!i||1===i[0]&&1===i[1]&&1===i[2]||(n.scale(i),r=!0);}(n,t.rotation,t.scale,i),i.multiplyLeft(o)}(0,i,new Ot):e.childModelMatrix?e.childModelMatrix:e.cartesianModelMatrix,this.rootNode.applyMatrix(n),this.rootNode.addObject3DsWithoutParent(...e.gltf.nodes),this.rootNode.updateMatrixWorld(!0),this.animations=e.gltf.animations,this.primitives=[],this.extra=e.extra,b_(e.gltf).forEach((e=>{e.owner=this,this.primitives.push(e);})),this.state="loaded";}fire(e){this.source.fire(e);}destroy(){this.unloadVectorData();}}function A_(e=new Map,t=new Map){if(!e||!t)return e||t;try{return new Map([...t,...e])}catch(e){console.error("请检查object1 或 object2 是否未object对象而不是 Map对象");}}var E_=Object.freeze({ShadowMapping:0,SHADOW_MAPPING:0,PCF:1,NONE:-1});const C_=new It,M_=new wt,I_=new Ot,L_=new Ot;class N_{constructor(e){this.isTranslucent="OPAQUE"!=e.alphaMode,this._lights=e.lights,this._type=e.type,this._renderState=Z(e.renderState,N_.getDefaultRenderState()),this._depthTest=void 0,$(e.depthTest)&&(this._renderState.depthTest=Xe(e.depthTest?t_.enableDepthTest:t_.disableDepthTest)),this._translucent=void 0,this._uniforms=new Map,this.minimumUniformMap=new Map,this._programConfiguration=void 0,this._shaderSource=e.shaderSource||new v_({type:e.type,defines:e.defines,fragmentSource:e.fragmentSource,vertexSource:e.vertexSource,noCache:e.noCache}),this.layer=e.layer,this._picking=!1,this._pickColor=void 0,this._usePickColorTexture=void 0,this._isOneDimensionBatchTexture=void 0,this._isModelInstanceTexture=!1,this._pickTextureUniformsCallBack=void 0,this.state=Kh.PROCESSINGFISH,this._defines=e.defines||{},this._baseColorTexture=Z(e.baseColorTexture,void 0),this._color=Z(e.color,void 0),this._doubleSided=Z(e.doubleSided,!1),this._opacity=Z(e.opacity,void 0),this._lightingModel=Z(e.lightingModel,void 0);}get type(){return this._type}set type(e){this._shaderSource.type=e,this._type=e;}set defines(e){this._shaderSource.defines=e;}get defines(){return this._shaderSource.defines}set uniforms(e){this._uniforms=A_(e,this._uniforms);}get picking(){return this._picking}set picking(e){e!=this._picking&&(this._shaderSource.defines.USE_PICKING=!!e,this._picking=e);}get pickColor(){return this._pickColor}set pickColor(e){this._pickColor=new wt(e.r,e.g,e.b,e.a);}get depthTest(){return this._depthTest}set depthTest(e){this._depthTest=e,null!=e&&(!1===Object.getOwnPropertyDescriptor(this._renderState.depthTest,"enabled").writable&&(this._renderState=Xe(this._renderState)),this._renderState.depthTest.enabled=this._depthTest);}get renderState(){return this.overrideRenderState||this._renderState}set renderState(e){this._renderState=Qm(e,this._renderState),$(this._depthTest)&&(!1===Object.getOwnPropertyDescriptor(this._renderState.depthTest,"enabled").writable&&(this._renderState=Xe(this._renderState)),this._renderState.depthTest.enabled=this._depthTest);}get translucent(){return this._translucent}set translucent(e){this._translucent=e,this.renderState={blending:{enabled:this.translucent,color:{red:0,green:0,blue:0,alpha:0},equationRgb:hc.FUNC_ADD,equationAlpha:hc.FUNC_ADD,functionSourceRgb:hc.SRC_ALPHA,functionSourceAlpha:hc.ONE,functionDestinationRgb:hc.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:hc.ONE_MINUS_SRC_ALPHA}};}update(e,t,i={}){this._updateLightsUniforms(e,t,e.transform.activeCamera.cartographicPosition[0],e.transform.activeCamera.cartographicPosition[1]);const n=this.getCamera(t);this._updateCameraUniforms(n),this._updateCommonUniform(e,t,i),this._updateShadowUniforms(e,t,i),this._updateOnceUniform(e,t,i),$(i.primitive)&&i.primitive.allowPick&&this._updatePickStatus(i.primitive);}updateProperty(){}beforeCompile(){}_updateCameraUniforms(e){this._cameraPosition=e.positionWC,this._cameraDir=e.directionWC,this._uniforms.has("u_CameraPosition")||this._uniforms.set("u_CameraPosition",(()=>this._cameraPosition)),this.pushMinimumUniform("u_CameraPosition"),this._uniforms.has("u_CameraDirection")||this._uniforms.set("u_CameraDirection",(()=>this._cameraDir)),this.pushMinimumUniform("u_CameraDirection");}_updateLightsUniforms(e,t,i,n){if(t._enableLight){if(this.defines.enableLight=!0,t.sunLight){this.defines.SunLight=!0;try{this._uniforms.set("u_SunLightDirectionLocal",(()=>{if(t.sunLight)return t.sunLight.getSunDirectionWithCache(n,i)}));}catch(e){throw new Error(e)}this._uniforms.set("u_SunLightColor",(()=>{if(t.sunLight)return t.sunLight.color})),this._uniforms.set("u_SunLightIntensity",(()=>{if(t.sunLight)return t.sunLight.intensity})),this._uniforms.set("u_SunLightDirectionGlobal",(()=>{if(t.sunLight)return t.sunLight.getSunDirectionGlobalWithCache().normalize()}));}else this.defines.SunLight=!1;if(this.defines.AmbientLight=!1,this.defines.DirectionalLight=!1,this.defines.PointLight=!1,t._lights.length>0){const i=[],n=[],r=[],o=[],a=[],s=[],l=[],c=[],u=[],h=[],d=[],p=[],f=[];let m=null,_=null,g=null,y=null,x=null,v=null,w=0;t._lights.forEach((T=>{if("AmbientLight"==T.type&&(this.defines.AmbientLight=!0,i.push(T.color[0],T.color[1],T.color[1]),n.push(T.intensity)),"DirectionalLight"==T.type&&(this.defines.DirectionalLight=!0,r.push(T.color[0],T.color[1],T.color[2]),o.push(T.intensity),a.push(T.lightDirection[0],T.lightDirection[1],T.lightDirection[2])),"PointLight"==T.type&&(this.defines.PointLight=!0,s.push(T.color[0],T.color[1],T.color[2]),l.push(T.position[0],T.position[1],T.position[2]),c.push(T.intensity),t._shadows)){const t=Ot.inverse(lc.localFrameToFixedFrame(new ft(T.position[0],T.position[1],T.position[2])),new Ot);u.push(t),null!=e.cubeMapCollection[T.id]&&h.push(e.cubeMapCollection[T.id].cubeMap),0==w?null!=e.cubeMapCollection[T.id]&&(m=e.cubeMapCollection[T.id].cubeMap):1==w?null!=e.cubeMapCollection[T.id]&&(_=e.cubeMapCollection[T.id].cubeMap):2==w?null!=e.cubeMapCollection[T.id]&&(g=e.cubeMapCollection[T.id].cubeMap):3==w?null!=e.cubeMapCollection[T.id]&&(y=e.cubeMapCollection[T.id].cubeMap):4==w?null!=e.cubeMapCollection[T.id]&&(x=e.cubeMapCollection[T.id].cubeMap):5==w&&null!=e.cubeMapCollection[T.id]&&(v=e.cubeMapCollection[T.id].cubeMap),w+=1,d.push(T.shadowFar),p.push(T.epsilon),f.push(T.mapSizeScale/T.textureSize);}})),n.length>0&&(this.defines.AmbientLightCount=n.length),this._uniforms.set("u_AmbientLightsColor",(()=>i)),this._uniforms.set("u_AmbientLightsIntensity",(()=>n)),o.length>0&&(this.defines.DirectionalLightCount=o.length),this._uniforms.set("u_DirectionalLightColor",(()=>r)),this._uniforms.set("u_DirectionalLightIntensity",(()=>o)),this._uniforms.set("u_DirectionalLightDir",(()=>a)),c.length>0&&(this.defines.PointLightCount=c.length),this._uniforms.set("u_PointLightColor",(()=>s)),this._uniforms.set("u_PointLightIntensity",(()=>c)),this._uniforms.set("u_PointLightPosition",(()=>l)),this._uniforms.set("u_PointLightModelMatrixInverse",(()=>u)),this._uniforms.set("u_PointLightDepthCubeTexture",(()=>{if(c.length>0&&t._shadows&&h.length==c.length)return h[0]})),this._uniforms.set("u_PointLightDepthCubeTexture0",(()=>{if(c.length>0&&t._shadows)return m})),this._uniforms.set("u_PointLightDepthCubeTexture1",(()=>{if(c.length>1&&t._shadows)return _})),this._uniforms.set("u_PointLightDepthCubeTexture2",(()=>{if(c.length>2&&t._shadows)return g})),this._uniforms.set("u_PointLightDepthCubeTexture3",(()=>{if(c.length>3&&t._shadows)return y})),this._uniforms.set("u_PointLightDepthCubeTexture4",(()=>{if(c.length>4&&t._shadows)return x})),this._uniforms.set("u_PointLightDepthCubeTexture5",(()=>{if(c.length>5&&t._shadows)return v})),this._uniforms.set("u_PointLightFar",(()=>{if(c.length>0&&t._shadows)return d})),this._uniforms.set("u_PointLightEpsilon",(()=>{if(c.length>0&&t._shadows)return p})),this._uniforms.set("u_DiskRadius",(()=>{if(c.length>0&&t._shadows)return f}));}}else this.defines.enableLight=!1;}_updateCommonUniform(e,t,i={}){const{primitive:n}=i,r=this.getCamera(t);this._uniforms.set("u_ModelMatrix",(()=>$(n)?$(n.modelInstanceType)&&"3d-model-instance"!==n.modelInstanceType||n.animationModelInstanceCollection?Ot.IDENTITY:n.matrixWorld:Ot.IDENTITY)),this.pushMinimumUniform("u_ModelMatrix"),this._uniforms.set("u_ModelMatrixInverse",(()=>{const e=$(n)&&$(n.modelInstanceType)&&"3d-model-instance"!==n.modelInstanceType,t=new Ot($(n)?e?Ot.IDENTITY:n.matrixWorld:Ot.IDENTITY);return Ot.inverse(t,L_)})),this.pushMinimumUniform("u_ModelMatrixInverse"),this.updateMVPMatrix(e,t,n),this._uniforms.set("u_RotateMatrixInverse",(()=>Ot.inverse(lc.localFrameToFixedFrame(lc.cartographicToCartesian3([116.39178335666656,39.93314961417835,20])),I_))),this._uniforms.set("u_ViewMatrix",(()=>r.viewMatrix)),this._uniforms.set("u_ModelViewMatrix",(()=>r.viewMatrix.clone().multiplyRight(n.matrixWorld))),this.pushMinimumUniform("u_ModelViewMatrix"),this._uniforms.set("u_ProjectionMatrix",(()=>r.projectionMatrix)),this.pushMinimumUniform("u_ProjectionMatrix"),this._uniforms.set("u_ViewProjectionMatrix",(()=>r.getVPMatrix())),this.pushMinimumUniform("u_ViewProjectionMatrix"),this._uniforms.set("u_InverseViewProjectionMatrix",(()=>r.getVPMatrix().invert())),this.pushMinimumUniform("u_InverseViewProjectionMatrix"),this._uniforms.set("u_Resolution",(()=>(C_.set(e.width,e.height),C_))),this.pushMinimumUniform("u_Resolution"),this._uniforms.set("u_NormalMatrix",(()=>{return e=$(n)?n.matrixWorld:Ot.IDENTITY,(new Ct).getNormalMatrix(e);var e;})),this.pushMinimumUniform("u_NormalMatrix"),this._uniforms.set("u_InverseProjection",(()=>r.projectionMatrixInverse)),this.pushMinimumUniform("u_InverseProjection"),this._uniforms.set("u_EncodedCameraPositionMCLow",(()=>Qh.fromVector3(r.positionWC).low)),this._uniforms.set("u_EncodedCameraPositionMCHigh",(()=>Qh.fromVector3(r.positionWC).high)),this._uniforms.set("u_modelViewRelativeToEye",(()=>{const e=r.viewMatrix;return e[12]=0,e[13]=0,e[14]=0,e})),this._uniforms.set("u_ModelViewProjectionRelativeToEye",(()=>{const e=r.viewMatrix;e[12]=0,e[13]=0,e[14]=0;const t=new Ot;return Ot.multiply(t,r.projectionMatrix,e),t})),this._uniforms.set("u_FrustumPlanes",(()=>(M_.set(r.frustumCrate.frustum._offCenterFrustum.top,r.frustumCrate.frustum._offCenterFrustum.bottom,r.frustumCrate.frustum._offCenterFrustum.left,r.frustumCrate.frustum._offCenterFrustum.right),M_))),this._uniforms.set("u_Bearing",(()=>e.style.symbolMatrixHelper.getMapViewParams().bearing*nt.TRANSFORM.DEG_TO_RAD)),this.pushMinimumUniform("u_Bearing");}getCamera(e){return this._extraCamera?this._extraCamera:e.camera}updateMVPMatrix(e,t,i){const n=this.getCamera(t);this._uniforms.set("u_ModelViewProjectionMatrix",(()=>{let e;return e=$(i.modelInstanceCollection)?n.getVPMatrix().multiplyRight(i.modelInstanceCollection._rtcTransform):n.getVPMatrix().multiplyRight($(i)?i.matrixWorld:Ot.IDENTITY),e})),this.pushMinimumUniform("u_ModelViewProjectionMatrix"),this._uniforms.set("u_ModelInstanceRTCTransformMatrix",(()=>$(i.modelInstanceCollection)?i.modelInstanceCollection._rtcTransform:new Ot)),this.pushMinimumUniform("u_ModelInstanceRTCTransformMatrix");}pushMinimumUniform(e){this.isVectorMaterial&&this.minimumUniformMap.set(e,this._uniforms.get(e));}getMinimumUniforms(e){return this.isVectorMaterial?e.sameLayerFrame?this.minimumUniformMap:(e.sameLayerFrame=!0,this._uniforms):this._uniforms}_updateShadowUniforms(e,t,i={}){const{primitive:n}=i;t._shadowModel==E_.NONE?this.defines={ShadowEnable:!1}:t._shadowModel==E_.ShadowMapping?this.defines={ShadowEnable:!0,ShadowMapping:!0,PCF:!1}:t._shadowModel==E_.PCF&&(this.defines={ShadowEnable:!0,ShadowMapping:!1,PCF:!0}),e._shadows&&(this._uniforms.set("u_ShadowModelViewProjectionMatrix",(()=>{const t=e.transform.shadowCamera.vpMatrix.clone();return $(n)?t.multiplyRight(n.matrixWorld):t})),this._uniforms.set("u_ShadowDepthSampler",(()=>{const t=e.shadowPass.framebuffer.depthStencilTexture;return t.sampler={minificationFilter:hc.LINEAR_MIPMAP_LINEAR,magnificationFilter:hc.LINEAR,wrapS:hc.REPEAT,wrapT:hc.REPEAT},t})),this._uniforms.set("u_EPSILON",(()=>{if(e.frameState._sunLight)return e.frameState._sunLight.epsilon})),this._uniforms.set("u_MapSizeScale",(()=>{if(e.frameState._sunLight)return e.frameState._sunLight.mapSizeScale})));}_updateOnceUniform(e){if(this._updatedUniformFlag)return;this._uniforms.set("u_PixelRatio",(()=>J.devicePixelRatio));const t=new It;this._uniforms.set("u_CurrentFrustum",(()=>(t.x=e.frameState._camera.near,t.y=e.frameState._camera.far,t))),this._uniforms.set("u_Viewport",(()=>new wt(e.context.viewport.current.x,e.context.viewport.current.y,e.context.viewport.current.width,e.context.viewport.current.height))),this._uniforms.set("u_ViewportTransformation",(()=>{let t={x:e.context.viewport.current.x,y:e.context.viewport.current.y,width:e.context.viewport.current.width,height:e.context.viewport.current.height},i=new Ot;return Ot.computeViewportTransformation(t,0,1,i),t.x==e.context.viewport.current.x&&t.y==e.context.viewport.current.y&&t.width==e.context.viewport.current.width&&t.height==e.context.viewport.current.height||(t={x:e.context.viewport.current.x,y:e.context.viewport.current.y,width:e.context.viewport.current.width,height:e.context.viewport.current.height},i=new Ot,Ot.computeViewportTransformation(t,0,1,i)),i})),this._updatedUniformFlag=!0;}_updatePickStatus(e){const t=e.owner;if(e.allowPick&&$(t)&&e.pickId)if(this.pickColor=e.pickId.color,this._isModelInstanceTexture=!1,t instanceof S_&&void 0===this._usePickColorTexture){const e=t?.extra?.batchTable;e&&e.featureCount>0&&(this._usePickColorTexture=!0,this._isOneDimensionBatchTexture=!(e._batchTexture._textureDimensions.y>1),this._pickTextureUniformsCallBack=e._batchTexture.getUniformMapCallback(),this._uniforms=this._pickTextureUniformsCallBack(this._uniforms));}else $(e.modelInstanceCollection)&&$(e.modelInstanceCollection._batchTable)&&(this._isModelInstanceTexture=!0,this.uniforms=e.modelInstanceCollection._batchTable.getUniformMapCallback());}openPickColor(e){this.defines={PICK_COLOR:!0},this.renderState={depthTest:{enabled:!e,func:hc.LESS},blending:{color:{red:0,green:0,blue:0,alpha:0},enabled:!1,equationRgb:hc.FUNC_ADD,equationAlpha:hc.FUNC_ADD,functionSourceRgb:hc.SRC_ALPHA,functionSourceAlpha:hc.ONE,functionDestinationRgb:hc.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:hc.ONE_MINUS_SRC_ALPHA},stencilTest:{enabled:!1,frontFunction:hc.ALWAYS,backFunction:hc.ALWAYS,reference:0,mask:0,frontOperation:{fail:hc.KEEP,zFail:hc.KEEP,zPass:hc.REPLACE},backOperation:{fail:hc.KEEP,zFail:hc.KEEP,zPass:hc.REPLACE}}};}closePickColor(){this.defines={PICK_COLOR:!1},this.renderState=N_.getDefaultRenderState();}static getDefaultRenderState(){const e={};return e.blending=t_.enableBlending,e.depthRange=t_.depthRange,e.depthTest=t_.enableDepthTest,e.depthMask=t_.enableDepthMask,e.cull=Xe(t_.enableCull),e.frontFace=hc.CCW,e.stencilTest=t_.disableStencilTest,e.stencilMask=t_.disableStencilMask,e}setValues(e){if(null!=e)for(const t in e){const i=e[t];null!=i?void 0!==this[t]?this[t]="string"==typeof i&&i.startsWith("#")?Di.parse(i).toVector3():i:console.warn(`MineMap.Material: '${t}' is not a property of MineMap.${this.type}.`):console.warn(`MineMap.Material: parameter '${t}' has value of undefined.`);}}destroy(){this._renderState=void 0,this._uniforms=void 0,this._programConfiguration=void 0,this._shaderSource?.destroy(),this._shaderSource=void 0,this.layer=void 0,this._pickColor=void 0,this._usePickColorTexture=void 0,this._isOneDimensionBatchTexture=void 0,this._pickTextureUniformsCallBack=void 0,this.isTranslucent=void 0,this.state=void 0,this._cameraPosition=void 0,this._type=void 0;}}const R_={PolylineColor:"#define GLSLIFY 1\nuniform vec4 u_Color;vec4 getMaterial(vec2 st){vec4 resultColor=u_Color;return resultColor;}",PolylineTexture:"#define GLSLIFY 1\nuniform vec2 u_TexOffset;uniform vec2 u_TexRepeat;uniform vec3 u_TexRotate;uniform sampler2D u_BaseColorSampler;vec4 getMaterial(vec2 st){vec2 finalTexCoord=u_TexRepeat*st;finalTexCoord=finalTexCoord-u_TexRotate.xy;finalTexCoord=vec2(finalTexCoord.x*cos(u_TexRotate.z)-finalTexCoord.y*sin(u_TexRotate.z),finalTexCoord.x*sin(u_TexRotate.z)+finalTexCoord.y*cos(u_TexRotate.z));finalTexCoord=finalTexCoord+u_TexRotate.xy;finalTexCoord+=u_TexOffset;vec4 resultColor=texture2D(u_BaseColorSampler,finalTexCoord);return resultColor;}",PolylineDash:"#define GLSLIFY 1\nuniform float u_DashLength;uniform float u_DashPattern;uniform vec4 u_GapColor;uniform float u_PixelRatio;varying float v_polylineAngle;uniform vec4 u_Color;mat2 rotate(float rad){float c=cos(rad);float s=sin(rad);return mat2(c,s,-s,c);}vec4 getMaterial(vec2 st){vec2 pos=rotate(v_polylineAngle)*gl_FragCoord.xy;float dashPosition=fract(pos.x/(u_DashLength*u_PixelRatio));float maskIndex=floor(dashPosition*16.0);float maskTest=floor(u_DashPattern/pow(2.0,maskIndex));vec4 resultColor=(mod(maskTest,2.0)<1.0)? u_GapColor : u_Color;if(resultColor.a<0.005){discard;}return resultColor;}",PolylineTrail:"#define GLSLIFY 1\nuniform float u_FrameTime;uniform float u_Speed;uniform vec4 u_Color;vec4 getMaterial(vec2 st){float time=fract(u_FrameTime*u_Speed);float resultOpactiy=u_Speed>0.0 ? fract(st.s-time): 1.0-fract(st.s-time);vec4 resultColor=vec4(u_Color.rgb,resultOpactiy);return resultColor;}",PolylineOD:"#define GLSLIFY 1\nuniform float u_FrameTime;uniform float u_Speed;uniform vec4 u_TopColor;uniform vec4 u_Color;vec4 getMaterial(vec2 st){float time=fract(u_FrameTime*u_Speed);float opactiy=1.0-fract(st.s-time);vec4 resultColor;if(opactiy>0.95){resultColor=vec4(u_TopColor.rgb,u_Color.a);}else{resultColor=vec4(u_Color.rgb,u_Color.a);}return resultColor;}",PolylineFlicker:"#define GLSLIFY 1\nuniform float u_FrameTime;uniform float u_Speed;uniform vec4 u_Color;vec4 getMaterial(vec2 st){float time=fract(u_FrameTime*u_Speed);float scalar=smoothstep(0.0,1.0,time);vec4 resultColor=u_Color*scalar;return resultColor;}",PolylineGlow:"#define GLSLIFY 1\nuniform float u_FrameTime;uniform float u_Speed;uniform float u_GlowPower;uniform float u_TaperPower;uniform vec4 u_Color;vec4 getMaterial(vec2 st){float glow=u_GlowPower/abs(st.t-0.5)-(u_GlowPower/0.5);if(u_TaperPower<=0.99999){glow*=min(1.0,u_TaperPower/(0.5-st.s*0.5)-(u_TaperPower/0.5));}vec4 resultColor;resultColor.rgb=max(vec3(glow-1.0+u_Color.rgb),u_Color.rgb);resultColor.a=clamp(0.0,1.0,glow)*u_Color.a;return resultColor;}",PolylineTextureFlow:"#define GLSLIFY 1\nuniform float u_FrameTime;uniform float u_Speed;uniform sampler2D u_BaseColorSampler;uniform vec2 u_TexRepeat;vec4 getMaterial(vec2 st){float time=fract(u_FrameTime*u_Speed);vec2 finalTexCoord=u_TexRepeat*st;vec4 resultColor=texture2D(u_BaseColorSampler,vec2(finalTexCoord.s-time,finalTexCoord.t));return resultColor;}"};class O_ extends N_{constructor(e){super(e),this._renderState={cull:{enabled:!1},blending:{enabled:!0,color:{red:0,green:0,blue:0,alpha:0},equationRgb:hc.FUNC_ADD,equationAlpha:hc.FUNC_ADD,functionSourceRgb:hc.SRC_ALPHA,functionSourceAlpha:hc.ONE,functionDestinationRgb:hc.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:hc.ONE_MINUS_SRC_ALPHA},polygonOffset:{enabled:!0,factor:1,units:1},depthTest:{enabled:!0,func:hc.LESS}},$(e.depthTest)&&(this._renderState.depthTest=e.depthTest?t_.enableDepthTest:t_.disableDepthTest),this.uniformMap={},this.type="PolylineMaterial",e.shaderId||(e.dashed?(e.shaderId="PolylineDash",e.uniforms={color:Z(e.color,"red"),gapColor:Z(e.gapColor,new Di(0,0,0,0)),opacity:Z(e.opacity,1),dashLength:Z(e.dashLength,16),dashPattern:Z(e.dashPattern,255)}):e.baseColorTexture?(e.shaderId="PolylineTexture",e.uniforms={baseColorTexture:e.baseColorTexture,opacity:Z(e.opacity,1),rotation:Z(e.rotation,0),rotationCenter:Z(e.rotationCenter,[.5,.5]),repeat:Z(e.repeat,[1,1]),offset:Z(e.offset,[0,0])}):(e.shaderId="PolylineColor",e.uniforms={color:Z(e.color,"red"),opacity:Z(e.opacity,1)}));const t=[];t.push(R_[e.shaderId]),t.push(this._shaderSource.fragmentSource),this._shaderSource.fragmentSource=t.join("\n"),this.type=e.shaderId,this.uniformMap=e.uniforms,this._viewportOrthographicMatrix=new Ot,this._currentFrustum=new It,this._cameraViewMatrix=void 0,this._pixelWidth=!0,this.defines={POLYLINE:!0,POLYLINE_DASH:"PolylineDash"===this.type,PIXEL_WIDTH:this._pixelWidth},this._flowOptions=void 0,this._depthTexture=void 0,this._pickColorDepthTest=Z(e.pickColorDepthTest,void 0);}get pixelWidth(){return this._pixelWidth}set pixelWidth(e){this._pixelWidth=e;}get pickColorDepthTest(){return this._pickColorDepthTest}set pickColorDepthTest(e){this._pickColorDepthTest=e;}update(e,t,i={}){super.update(e,t,i),this.updateUniforms(e,t,i);}updateTexture(e){console.warn("该方法将被下个大版本废弃，请使用新的材质更新方式！！！"),$(e.color)&&(this.uniformMap.color=e.color),$(e.opacity)&&(this.uniformMap.opacity=e.opacity),$(e.dashLength)&&(this.uniformMap.dashLength=e.dashLength),$(e.baseColorTexture)&&(this.uniformMap.baseColorTexture=e.baseColorTexture),$(e.pixelWidth)&&(this._pixelWidth=e.pixelWidth);}static bindTextureSampler(e){return e.sampler={minificationFilter:e.minFilter||hc.LINEAR_MIPMAP_NEAREST,magnificationFilter:e.magFilter||hc.LINEAR,wrapS:e.wrapS||hc.REPEAT,wrapT:e.wrapT||hc.REPEAT},e}updateUniforms(e,t,i={}){const{primitive:n}=i;this.defines={POLYLINE_DASH:"PolylineDash"===this.type,PIXEL_WIDTH:this._pixelWidth},this._uniforms.set("u_BaseColorSampler",(()=>O_.bindTextureSampler(this.uniformMap.baseColorTexture))),this._uniforms.set("u_Color",(()=>wt.fromColor(Di.parse(this.uniformMap.color),!1))),this._uniforms.set("u_FarDepthFromNearPlusOne",(()=>(this._farDepthFromNearPlusOne=t.camera.far-t.camera.near+1,this._farDepthFromNearPlusOne))),this._uniforms.set("u_OneOverLog2FarDepthFromNearPlusOne",(()=>(this._oneOverLog2FarDepthFromNearPlusOne=1/nt.CesiumMath.log2(this._farDepthFromNearPlusOne),this._oneOverLog2FarDepthFromNearPlusOne))),this._uniforms.set("u_ViewportOrthographic",(()=>{const t=e.context.viewport.current;return Ot.computeOrthographicOffCenter(t.x,t.x+t.width,t.y,t.y+t.height,0,1,this._viewportOrthographicMatrix),this._viewportOrthographicMatrix})),this._uniforms.set("u_Opacity",(()=>this.uniformMap.opacity)),this._uniforms.set("u_GeometricToleranceOverMeter",(()=>{let i;const n=t.camera.frustumCrate.fov,r=e.context.viewport.current;return i=$(n)?r.height>r.width?2*Math.tan(.5*n)/r.height:2*Math.tan(.5*n)/r.width:1/Math.max(r.width,r.height),this._geometricToleranceOverMeter=2*i,this._geometricToleranceOverMeter})),this._uniforms.set("u_Normal",(()=>{const e=n?n.matrixWorld:new Ot,i=t.camera.getViewMatrix();i.multiplyRight(e),i.invert();const r=new Ct;return i.getRotationMatrix3(r),Ct.transpose(r,r),this._normal=r,this._normal})),this._uniforms.set("u_GlobeMinimumAltitude",(()=>(this._globeMinimumAltitude=oi.WGS84.minimumRadius.toFixed(1),this._globeMinimumAltitude))),this._uniforms.set("u_DashLength",(()=>this.uniformMap.dashLength)),this._uniforms.set("u_DashPattern",(()=>this.uniformMap.dashPattern)),this._uniforms.set("u_GapColor",(()=>wt.fromColor(Di.parse(this.uniformMap.gapColor),!1))),this._uniforms.set("u_FrameTime",(()=>e._map.timer.totalTime)),this._uniforms.set("u_Speed",(()=>this.uniformMap.speed)),this._uniforms.set("u_TopColor",(()=>wt.fromColor(Di.parse(this.uniformMap.topColor),!1))),this._uniforms.set("u_GlowPower",(()=>this.uniformMap.glowPower)),this._uniforms.set("u_TaperPower",(()=>this.uniformMap.taperPower)),this._uniforms.set("u_TexOffset",(()=>It.unpack(this.uniformMap.offset))),this._uniforms.set("u_TexRepeat",(()=>It.unpack(this.uniformMap.repeat))),this._uniforms.set("u_TexRotate",(()=>{const e=new ft;return e.x=this.uniformMap.rotationCenter[0],e.y=this.uniformMap.rotationCenter[1],e.z=this.uniformMap.rotation*nt.TRANSFORM.DEG_TO_RAD,e})),this.defines.SHADOW_VOLUME&&(this.defines=t.preMainDepthStencilTexture?{SHADOWVOLUME_DISCARD:!0}:{SHADOWVOLUME_DISCARD:!1},e.commonDepthPass.render({painter:e}),this._depthTexture=e.commonDepthPass.framebuffer.getColorTexture(0).bind(hc.LINEAR,hc.CLAMP_TO_EDGE),this._uniforms.set("u_DepthTexture",(()=>this._depthTexture)));}static fromType(e,t){let i;switch(e){case"Color":i=new O_({uniforms:{color:Z(t.color,"red"),opacity:Z(t.opacity,1)},shaderId:`Polyline${e}`});break;case"Texture":i=new O_({uniforms:{baseColorTexture:t.baseColorTexture,opacity:Z(t.opacity,1),rotation:Z(t.rotation,0),rotationCenter:Z(t.rotationCenter,[.5,.5]),repeat:Z(t.repeat,[1,1]),offset:Z(t.offset,[0,0])},shaderId:`Polyline${e}`});break;case"Dash":i=new O_({uniforms:{color:Z(t.color,"red"),gapColor:Z(t.gapColor,new Di(0,0,0,0)),opacity:Z(t.opacity,1),dashLength:Z(t.dashLength,16),dashPattern:Z(t.dashPattern,255)},shaderId:`Polyline${e}`});break;case"TextureFlow":i=new O_({uniforms:{baseColorTexture:t.baseColorTexture,opacity:Z(t.opacity,1),repeat:Z(t.repeat,[1,1]),speed:Z(t.speed,1)},shaderId:`Polyline${e}`});break;case"Trail":case"Flicker":i=new O_({uniforms:{color:Z(t.color,"red"),speed:Z(t.speed,1),opacity:Z(t.opacity,1)},shaderId:`Polyline${e}`});break;case"OD":i=new O_({uniforms:{color:Z(t.color,"red"),speed:Z(t.speed,1),topColor:Z(t.topColor,"green"),opacity:Z(t.opacity,1)},shaderId:`Polyline${e}`});break;case"Glow":i=new O_({uniforms:{color:Z(t.color,"red"),glowPower:Z(t.glowPower,.25),taperPower:Z(t.taperPower,1),opacity:Z(t.opacity,1)},shaderId:`Polyline${e}`});break;default:throw new Error(`material with type '${e}' does not exist.`)}return i}serialize(){return {type:this.type,uniforms:this.uniformMap}}destroy(){return this._renderState=void 0,this._color=void 0,this._uColor=void 0,this.type=void 0,this._viewportOrthographicMatrix=void 0,this._currentFrustum=void 0,this._cameraPositionEncode=void 0,this._cameraViewMatrix=void 0,this._pixelWidth=void 0,this._depthTexture&&(this._depthTexture.destroy(),this._depthTexture=void 0),uc(this)}}class D_ extends N_{constructor(e){super(e),this.type="pickColorMaterial",this.renderState=this._createRenderState(),this.dirty=!1,this.bUniformCreated=!1,this._usePickColorTexture=void 0,this._isOneDimensionBatchTexture=void 0,this._pickTextureUniformsCallBack=void 0;}update(e,t,i={}){this._resetStatus(),super.update(e,t,i),this._updateUniform(i,t),this._updateDefines(i.primitive);}_updateUniform(e={},t){const{primitive:i}=e;if(i.allowPick){if(i.allowPick&&(this._renderState.cull=t_.disableCull),$(i.material.pickColorDepthTest)&&(this._renderState.depthTest=i.material.pickColorDepthTest?t_.enableDepthTestWithLEQUAL:t_.disableDepthTest),null!=this._usePickColorTexture){const e=i?.owner?.extra?.batchTable?._batchTexture.getUniformMapCallback();e&&(this._uniforms=e(this._uniforms));}else this._uniforms.set("u_pickIdColor",(()=>i._material.pickColor));i._material instanceof O_&&(this._uniforms.set("u_ViewportOrthographic",(()=>i._material._viewportOrthographicMatrix)),this._uniforms.set("u_GeometricToleranceOverMeter",(()=>i._material._geometricToleranceOverMeter)),this._uniforms.set("u_Normal",(()=>i._material._normal)),this._uniforms.set("u_GlobeMinimumAltitude",(()=>i._material._globeMinimumAltitude)),i._material.defines.SHADOW_VOLUME&&this._uniforms.set("u_DepthTexture",(()=>i._material._depthTexture))),"BillboardMaterial"===i._material.type&&(i._material._pixelResolution&&(this.defines={FIXED_PIXEL_SIZE:!0},this._uniforms.set("u_PixelResolution",(()=>new It(i._material._pixelResolution)))),this._uniforms.set("u_MvMatrix",(()=>i._material._modelMatrix?t.camera.getViewMatrix().multiplyRight(i._material._modelMatrix):void 0)),this._uniforms.set("u_center",(()=>i._material._center)),this._uniforms.set("u_rotation",(()=>i._material.u_rotation)),this._uniforms.set("u_ProjectionMatrix",(()=>t.camera.getProjectionMatrix())),this._uniforms.set("u_InvertViewMatrix",(()=>t.camera.getViewMatrix().invert())),this._uniforms.set("u_ScaleMatrix",(()=>i._material._scaleMatrix)));}}_updateDefines(e){this.defines={JOINT_MATRIX_CNT:Z(e?._material?.defines?.JOINT_MATRIX_CNT,!1),INSTANCE_MATRIX:Z(e?._material?.isInstance,!1),USE_MORPHTARGETS:Z(e?._material?.defines?.USE_MORPHTARGETS,!1),LOG_DEPTH:!1,USE_PICKINGTEXTURES:Z(this._usePickColorTexture,!1),ONE_DIMENSION_BATCH_TEXTURE:Z(this._isOneDimensionBatchTexture,!1),TWO_DIMENSION_BATCH_TEXTURE:!1,MODEL_INSTANCE_BATCH_TEXTURE:this._isModelInstanceTexture,POLYLINE:Z(e?._material?.defines?.POLYLINE,!1),PIXEL_WIDTH:Z(e?._material?.defines?.PIXEL_WIDTH,!1),BILLBOARD:Z(e?._material?.defines?.BILLBOARD,!1),SHADOW_VOLUME:Z(e.adaptTerrain,!1)};}_resetStatus(){this._usePickColorTexture=void 0,this._isOneDimensionBatchTexture=void 0;}_createRenderState(){return {depthTest:{enabled:!0,func:hc.LEQUAL},blending:{color:{red:0,green:0,blue:0,alpha:0},enabled:!1,equationRgb:hc.FUNC_ADD,equationAlpha:hc.FUNC_ADD,functionSourceRgb:hc.SRC_ALPHA,functionSourceAlpha:hc.ONE,functionDestinationRgb:hc.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:hc.ONE_MINUS_SRC_ALPHA},stencilTest:{enabled:!1,frontFunction:hc.ALWAYS,backFunction:hc.ALWAYS,reference:0,mask:0,frontOperation:{fail:hc.KEEP,zFail:hc.KEEP,zPass:hc.REPLACE},backOperation:{fail:hc.KEEP,zFail:hc.KEEP,zPass:hc.REPLACE}}}}}class F_ extends N_{constructor(e){super(e),this.type="depthMaterial",this.renderState=this._createRenderState(),this.dirty=!1,this.bUniformCreated=!1;}update(e,t,i={}){super.update(e,t,i),this._updateDefines(i.primitive,e),this.bUniformCreated||this._createUniform();}_updateDefines(e,t){this.defines={JOINT_MATRIX_CNT:Z(e?._material?.defines?.JOINT_MATRIX_CNT,!1),INSTANCE_MATRIX:Z(e?._material?.defines?.INSTANCE_MATRIX,!1),USE_MORPHTARGETS:Z(e?._material?.defines?.USE_MORPHTARGETS,!1),LOG_DEPTH:Z(t._logDepth,!1)};}_createRenderState(){return {cull:{enabled:!1},depthTest:{enabled:!0,func:hc.LESS},blending:{color:{red:0,green:0,blue:0,alpha:0},enabled:!1,equationRgb:hc.FUNC_ADD,equationAlpha:hc.FUNC_ADD,functionSourceRgb:hc.SRC_ALPHA,functionSourceAlpha:hc.ONE,functionDestinationRgb:hc.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:hc.ONE_MINUS_SRC_ALPHA},stencilTest:{enabled:!1,frontFunction:hc.ALWAYS,backFunction:hc.ALWAYS,reference:0,mask:0,frontOperation:{fail:hc.KEEP,zFail:hc.KEEP,zPass:hc.REPLACE},backOperation:{fail:hc.KEEP,zFail:hc.KEEP,zPass:hc.REPLACE}}}}_createUniform(){this.bUniformCreated=!0;}destroy(){return this.type=void 0,this._renderState=void 0,this.dirty=void 0,this.bUniformCreated=void 0,this._uniforms=void 0,this._programConfiguration=void 0,this._shaderSource.destroy(),this._shaderSource=void 0,this.layer=void 0,this._pickColor=void 0,this._usePickColorTexture=void 0,this._isOneDimensionBatchTexture=void 0,this._pickTextureUniformsCallBack=void 0,uc(this)}}class z_ extends N_{constructor(e){super(e),this.type="normalMaterial",this.renderState=this._createRenderState(),this.dirty=!1,this.bUniformCreated=!1;}update(e,t,i={}){super.update(e,t,i),this.bUniformCreated||(this.bUniformCreated=!0);}_createRenderState(){return {depthTest:{enabled:!0,func:hc.LESS},blending:{color:{red:0,green:0,blue:0,alpha:0},enabled:!1,equationRgb:hc.FUNC_ADD,equationAlpha:hc.FUNC_ADD,functionSourceRgb:hc.SRC_ALPHA,functionSourceAlpha:hc.ONE,functionDestinationRgb:hc.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:hc.ONE_MINUS_SRC_ALPHA},stencilTest:{enabled:!1,frontFunction:hc.ALWAYS,backFunction:hc.ALWAYS,reference:0,mask:0,frontOperation:{fail:hc.KEEP,zFail:hc.KEEP,zPass:hc.REPLACE},backOperation:{fail:hc.KEEP,zFail:hc.KEEP,zPass:hc.REPLACE}}}}destroy(){return this.type=void 0,this._renderState=void 0,this.dirty=void 0,this.bUniformCreated=void 0,this._uniforms=void 0,this._programConfiguration=void 0,this._shaderSource.destroy(),this._shaderSource=void 0,this.layer=void 0,this._pickColor=void 0,this._usePickColorTexture=void 0,this._isOneDimensionBatchTexture=void 0,this._pickTextureUniformsCallBack=void 0,uc(this)}}class B_{constructor(){this._insatnceBuffer=void 0,this._attributes=[],this._attributesbuffviewObject={},this._createAttributes(),this._parseBufferViewAttributes(),this._particleNum=0,this.dirty=!1,this.colorArr=null,this.modelPositonArr=null,this.scaleArr=null;}get instanceBuffer(){return this._insatnceBuffer}createBuffer(e){this._insatnceBuffer=new dh({context:e,attributesbuffviewObject:this._attributesbuffviewObject,attributes:this._attributes,dynamicDraw:!1,buffers:void 0});}_createAttributes(){for(let e=0;e<4;++e)this._attributes.push({name:"a_InstanceMatrix4",type:5126,components:4,instance:!0,byteStride:64,offset:16*e,attribIndex:e,divisor:1});this._attributes.push({name:"a_Color",type:5126,components:4,instance:!0,byteStride:0,offset:0,attribIndex:0,divisor:1}),this._attributes.push({name:"a_Scale",type:5126,components:1,instance:!0,byteStride:0,offset:0,attribIndex:0,divisor:1});}_parseBufferViewAttributes(){this._parseInstances();}_parseInstances(){this._attributesbuffviewObject.InstanceMatrix4={value:new Float32Array(128e4)},this._attributesbuffviewObject.Color={value:new Float32Array(32e4)},this._attributesbuffviewObject.Scale={value:new Float32Array(8e4)};}update(e){e&&e.context&&!this._insatnceBuffer&&this.createBuffer(e.context),this.dirty&&(this._insatnceBuffer.updateDataTest(new Float32Array(this.modelPositonArr),"a_InstanceMatrix4"),this._insatnceBuffer.updateDataTest(new Float32Array(this.colorArr),"a_Color"),this._insatnceBuffer.updateDataTest(new Float32Array(this.scaleArr),"a_Scale"));}updateData(e){if(e.positions.length){const t=e.positions,i=e.frameState.camera.getViewMatrix().clone(),n=[];for(let e=0;e<t.length;e++){const r=lc.eastNorthUpToFixedFrame(t[e]),o=i.multiplyRight(r,new Ot);n.push(o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7],o[8],o[9],o[10],o[11],o[12],o[13],o[14],o[15]);}this._particleNum=t.length,this.colorArr=e.colorArr,this.scaleArr=e.scaleArr,this.modelPositonArr=n,this.dirty=!0;}}static generateInstanceModelMatrix(e){const t=[];return e.forEach(((e,i)=>{const n=lc.cartographicToFixedFrame(e);t.push({modelMatrix:n,batchId:i});})),t}destroy(){this._insatnceBuffer&&this._insatnceBuffer.destroy(),this._attributes=[],this._attributesbuffviewObject=null,this._particleNum=0,this.dirty=!1,this.colorArr=null,this.modelPositonArr=null,this.scaleArr=null;}}const V_={};function U_(e,t,i){const n=[];let r;if(n.length=e,t===i){for(r=0;r<e;r++)n[r]=t;return n}const o=(i-t)/e;for(r=0;r<e;r++)n[r]=t+r*o;return n}function k_(e,t,i,n,r,o,a,s){const l=new _s,c=new _s,u=new ft,h=new ft,d=new ft,p=n.scaleToGeodeticSurface(e,h),f=n.scaleToGeodeticSurface(t,d),m=new il,_=V_.numberOfPoints(e,t,i),g=n.cartesianToCartographic(p,l);jt(g,g);const y=n.cartesianToCartographic(f,c);jt(y,y);const x=U_(_,r,o);m.setEndPoints(g,y,!0);const v=m.surfaceDistance/_;let w=s;g.height=r;let T=n.cartographicToCartesian(g,u,!0);ft.pack(T,a,w),w+=3;for(let e=1;e<_;e++){const t=m.interpolateUsingSurfaceDistance(e*v,c);t.height=x[e],T=n.cartographicToCartesian(t,u,!0),ft.pack(T,a,w),w+=3;}return w}function G_(e,t,i,n,r,o,a,s){const l=new _s,c=new _s,u=new ft,h=n.cartesianToCartographic(e,l);jt(h,h);const d=n.cartesianToCartographic(t,c);jt(d,d);let p=new sd;const f=V_.numberOfPointsRhumbLine(h,d,i);h.height=0,d.height=0;const m=U_(f,r,o);p.ellipsoid.equals(n)||(p=new sd(void 0,void 0,n)),p.setEndPoints(h,d);const _=p.surfaceDistance/f;let g=s;h.height=r;let y=n.cartographicToCartesian(h,u,!0);ft.pack(y,a,g),g+=3;for(let e=1;e<f;e++){const t=p.interpolateUsingSurfaceDistance(e*_,c);t.height=m[e],y=n.cartographicToCartesian(t,u,!0),ft.pack(y,a,g),g+=3;}return g}V_.numberOfPoints=function(e,t,i){const n=ft.distance(e,t);return Math.ceil(n/i)},V_.numberOfPointsRhumbLine=function(e,t,i){const n=Math.pow(e.longitude-t.longitude,2)+Math.pow(e.latitude-t.latitude,2);return Math.max(1,Math.ceil(Math.sqrt(n/(i*i))))},V_.extractHeights=function(e,t){const i=new _s,n=e.length,r=new Array(n);for(let o=0;o<n;o++)r[o]=t.cartesianToCartographic(e[o],i).height;return r},V_.wrapLongitude=function(e,t){const i=[],n=[],r=new Ot,o=new ft,a=new ft,s=new ja(ft.UNIT_X,0),l=new ft,c=new ja(ft.UNIT_X,0),u=new ft,h=new ft;if($(e)&&e.length>0){t=Z(t,Ot.IDENTITY);const d=Ot.inverseTransformation(t,r),p=Ot.multiplyByPoint(d,ft.ZERO,o),f=ft.normalize(Ot.multiplyByPointAsVector(d,ft.UNIT_Y,a),a),m=ja.fromPointNormal(p,f,s),_=ft.normalize(Ot.multiplyByPointAsVector(d,ft.UNIT_X,l),l),g=ja.fromPointNormal(p,_,c);let y=1;i.push(ft.clone(e[0]));let x=i[0];const v=e.length;for(let t=1;t<v;++t){const r=e[t];if(ja.getPointDistance(g,x)<0||ja.getPointDistance(g,r)<0){const e=Cs.lineSegmentPlane(x,r,m,u);if($(e)){const t=ft.multiplyByScalar(f,5e-9,h);ja.getPointDistance(m,x)<0&&ft.negate(t,t),i.push(ft.add(e,t,new ft)),n.push(y+1),ft.negate(t,t),i.push(ft.add(e,t,new ft)),y=1;}}i.push(ft.clone(e[t])),y++,x=r;}n.push(y);}return {positions:i,lengths:n}},V_.generateArc=function(e){$(e)||(e={});const t=e.positions;if(!$(t))throw new Error("options.positions is required.");const i=new ft,n=new ft,r=t.length,o=Z(e.ellipsoid,oi.WGS84);let a=Z(e.height,0);const s=Array.isArray(a);if(r<1)return [];if(1===r){const e=o.scaleToGeodeticSurface(t[0],n);if(a=s?a[0]:a,0!==a){const t=o.geodeticSurfaceNormal(e,i);ft.multiplyByScalar(t,a,t),ft.add(e,t,e);}return [e.x,e.y,e.z]}let l=e.minDistance;if(!$(l)){const t=Z(e.granularity,nt.CesiumMath.RADIANS_PER_DEGREE);l=nt.CesiumMath.chordLength(t,o.maximumRadius);}let c,u=0;for(c=0;c<r-1;c++)u+=V_.numberOfPoints(t[c],t[c+1],l);const h=3*(u+1),d=new Array(h);let p=0;for(c=0;c<r-1;c++)p=k_(t[c],t[c+1],l,o,s?a[c]:a,s?a[c+1]:a,d,p);const f=t[r-1],m=new _s,_=o.cartesianToCartographic(f,m);jt(_,_),_.height=s?a[r-1]:a;const g=o.cartographicToCartesian(_,i,!0);return ft.pack(g,d,h-3),d};const H_=new _s,Y_=new _s;V_.generateRhumbArc=function(e){$(e)||(e={});const t=e.positions;if(!$(t))throw new Error("options.positions is required.");const i=new ft,n=new ft,r=t.length,o=Z(e.ellipsoid,oi.WGS84);let a=Z(e.height,0);const s=Array.isArray(a);if(r<1)return [];if(1===r){const e=o.scaleToGeodeticSurface(t[0],n);if(a=s?a[0]:a,0!==a){const t=o.geodeticSurfaceNormal(e,i);ft.multiplyByScalar(t,a,t),ft.add(e,t,e);}return [e.x,e.y,e.z]}const l=Z(e.granularity,nt.CesiumMath.RADIANS_PER_DEGREE);let c,u,h=0,d=o.cartesianToCartographic(t[0],H_);for(jt(d,d),c=0;c<r-1;c++)u=o.cartesianToCartographic(t[c+1],Y_),jt(u,u),h+=V_.numberOfPointsRhumbLine(d,u,l),d=_s.clone(u,H_);const p=3*(h+1),f=new Array(p);let m=0;for(c=0;c<r-1;c++)m=G_(t[c],t[c+1],l,o,s?a[c]:a,s?a[c+1]:a,f,m);const _=t[r-1],g=new _s,y=o.cartesianToCartographic(_,g);jt(y,y),y.height=s?a[r-1]:a;const x=o.cartographicToCartesian(y,i,!0);return ft.pack(x,f,p-3),f},V_.generateCartesianArc=function(e){const t=V_.generateArc(e),i=t.length/3,n=new Array(i);for(let e=0;e<i;e++)n[e]=ft.unpack(t,3*e);return n},V_.generateCartesianRhumbArc=function(e){const t=V_.generateRhumbArc(e),i=t.length/3,n=new Array(i);for(let e=0;e<i;e++)n[e]=ft.unpack(t,3*e);return n};const q_=gi([{name:"a_PositionHigh",type:"Float32",components:3},{name:"a_PositionLow",type:"Float32",components:3},{name:"a_PrevPositionHigh",type:"Float32",components:3},{name:"a_PrevPositionLow",type:"Float32",components:3},{name:"a_NextPositionHigh",type:"Float32",components:3},{name:"a_NextPositionLow",type:"Float32",components:3},{name:"a_ExpandAndWidth",type:"Float32",components:2},{name:"a_TEXCOORD_0",type:"Float32",components:2}]),X_=gi([{name:"a_PositionHigh",type:"Float32",components:3},{name:"a_PositionLow",type:"Float32",components:3},{name:"a_StartHigh",type:"Float32",components:3},{name:"a_StartLow",type:"Float32",components:3},{name:"a_StartNormal",type:"Float32",components:3},{name:"a_EndNormal",type:"Float32",components:3},{name:"a_RightNormal",type:"Float32",components:3},{name:"a_ForwardOffset",type:"Float32",components:3},{name:"a_TexCoord",type:"Float32",components:2},{name:"a_Width",type:"Float32",components:1}]),j_=[0,2,1,0,3,2,0,7,3,0,4,7,0,5,4,0,1,5,5,7,4,5,6,7,5,2,6,5,1,2,3,6,2,3,7,6],W_=j_.length;class $_{constructor(){}static createVolumeGeometry(e,t,i,n){if(e.length<2)return;let r=e.map((e=>{const i=ft.fromArray(t.cartesianToCartographic(e));return i.z=0,i}));r=Yd(r,ft.equalsEpsilon,!1);const o=r.length,a=i,s=n-i;let l,c;const u=[],h=[],d=[];let p=new ft,f=new ft,m=new ft,_=new ft,g=new ft;const y=r[0],x=r[1];for(p=this.getPosition(t,r[o-1],a,p),_=this.getPosition(t,x,a,_),f=this.getPosition(t,y,a,f),m=this.getPosition(t,y,s,m),g=this.computeRightNormal(y,x,s,t,g),ft.pack(g,u,0),ft.pack(f,h,0),ft.pack(m,d,0),c=1;c<o-1;++c)p=ft.clone(f,p),f=ft.clone(_,f),this.getPosition(t,r[c],s,m),this.getPosition(t,r[c+1],a,_),this.computeVertexMiterNormal(p,f,m,_,g),l=u.length,ft.pack(g,u,l),ft.pack(f,h,l),ft.pack(m,d,l);const v=r[o-1],w=r[o-2];return f=this.getPosition(t,v,a,f),m=this.getPosition(t,v,s,m),g=this.computeRightNormal(w,v,s,t,g),l=u.length,ft.pack(g,u,l),ft.pack(f,h,l),ft.pack(m,d,l),this.createGeometryArray(h,d,u)}static createGeometryArray(e,t,i){let n,r;const o=e.length/3-1,a=8*o,s=4*a,l=36*o,c=a>65535?new Uint32Array(l):new Uint16Array(l),u=new Float64Array(3*a),h=new Float32Array(s),d=new Float32Array(s),p=new Float32Array(s),f=new Float32Array(s),m=new Float32Array(s);let _=new ft,g=new ft;const y=t.length/3;g=ft.unpack(t,0,g);let x,v=0;for(r=3,n=1;n<y;n++)_=ft.clone(g,_),g=ft.unpack(t,r,g),v+=ft.distance(_,g),r+=3;r=3;let w=0,T=0,b=!1,P=ft.unpack(e,0),S=ft.unpack(t,0),A=ft.unpack(i,0),E=0;for(n=0;n<o;n++){const n=ft.clone(P),o=ft.clone(S);let a=ft.clone(A);b&&(a=ft.negate(a,a)),P=ft.unpack(e,r),S=ft.unpack(t,r),A=ft.unpack(i,r),b=this.breakMiter(A,n,P,S);const s=ft.distance(o,S),l=Qh.fromVector3(n),c=ft.subtract(P,n),_=ft.normalize(c,new ft);let g=ft.subtract(o,n);g=ft.normalize(g,g);let y=ft.cross(_,g);y=ft.normalize(y,y);let C=ft.cross(g,a);C=ft.normalize(C,C);let M=ft.subtract(S,P);M=ft.normalize(M,M);let I=ft.cross(A,M);I=ft.normalize(I,I);const L=s/v,N=E/v;for(x=0;x<8;x++){const e=T+4*x,t=e+3,i=x<4?1:-1,n=2===x||3===x||6===x||7===x?1:-1;ft.pack(l.high,h,e),h[t]=c.x,ft.pack(l.low,d,e),d[t]=c.y,ft.pack(C,p,e),p[t]=c.z,ft.pack(I,f,e),f[t]=L*i,ft.pack(y,m,e);let r=N*n;0===r&&n<0&&(r=9),m[t]=r;}const R=ft.clone(n),O=ft.clone(P),D=ft.clone(o),F=ft.clone(S);let z=ft.multiplyByScalar(y,nt.CesiumMath.EPSILON5);ft.add(R,z,R),ft.add(O,z,O),ft.add(D,z,D),ft.add(F,z,F),this.nudgeXZ(R,O),this.nudgeXZ(D,F),ft.pack(R,u,w),ft.pack(O,u,w+3),ft.pack(F,u,w+6),ft.pack(D,u,w+9),z=ft.multiplyByScalar(y,-2*nt.CesiumMath.EPSILON5,z),ft.add(R,z,R),ft.add(O,z,O),ft.add(D,z,D),ft.add(F,z,F),this.nudgeXZ(R,O),this.nudgeXZ(D,F),ft.pack(R,u,w+12),ft.pack(O,u,w+15),ft.pack(F,u,w+18),ft.pack(D,u,w+21),r+=3,w+=24,T+=32,E+=s;}r=0;let C=0;for(n=0;n<o;n++){for(x=0;x<W_;x++)c[r+x]=j_[x]+C;C+=8,r+=W_;}return {attributes:{position:u,startHiAndForwardOffsetX:h,startLoAndForwardOffsetY:d,startNormalAndForwardOffsetZ:p,endNormalAndTextureCoordinateNormalizationX:f,rightNormalAndTextureCoordinateNormalizationY:m},indices:c}}static getPosition(e,t,i,n){const r=new ft;return ft.clone(t,r),r.z=i,e.cartographicToCartesian(r,n)}static computeRightNormal(e,t,i,n,r){const o=new ft,a=new ft,s=new ft,l=this.getPosition(n,e,0,o),c=this.getPosition(n,e,i,a),u=this.getPosition(n,t,0,s),h=this.direction(c,l,a),d=this.direction(u,l,s);return ft.cross(d,h,r),ft.normalize(r,r)}static computeVertexMiterNormal(e,t,i,n,r){const o=new ft,a=new ft,s=new ft,l=new ft,c=this.direction(i,t,o),u=this.tangentDirection(e,t,c,a),h=this.tangentDirection(n,t,c,s);if(nt.CesiumMath.equalsEpsilon(ft.dot(u,h),-1,nt.CesiumMath.EPSILON5))return r=ft.cross(c,u,r),ft.normalize(r,r);r=ft.add(h,u,r),r=ft.normalize(r,r);const d=ft.cross(c,r,l);return ft.dot(h,d)<0&&(r=ft.negate(r,r)),r}static direction(e,t,i){return ft.subtract(e,t,i),ft.normalize(i,i),i}static tangentDirection(e,t,i,n){return n=this.direction(e,t,n),n=ft.cross(n,i,n),n=ft.normalize(n,n),ft.cross(i,n,n)}static breakMiter(e,t,i,n){const r=Math.cos(nt.CesiumMath.toRadians(30)),o=Math.cos(nt.CesiumMath.toRadians(150)),a=new ft,s=new ft,l=new Ct,c=new Tt,u=this.direction(i,t,s),h=ft.dot(u,e);if(h>r||h<o){const t=this.direction(n,i,a),r=Tt.fromAxisAngle(t,h<o?nt.CesiumMath.PI_OVER_TWO:-nt.CesiumMath.PI_OVER_TWO,c),s=Ct.fromQuaternion(r,l);return Ct.multiplyByVector(s,e,e),!0}return !1}static nudgeXZ(e,t){const i=ja.fromPointNormal(ft.ZERO,ft.UNIT_Y),n=ja.getPointDistance(i,e),r=ja.getPointDistance(i,t);let o=new ft;nt.CesiumMath.equalsEpsilon(n,0,nt.CesiumMath.EPSILON2)?(o=this.direction(t,e,o),ft.multiplyByScalar(o,nt.CesiumMath.EPSILON2,o),ft.add(e,o,e)):nt.CesiumMath.equalsEpsilon(r,0,nt.CesiumMath.EPSILON2)&&(o=this.direction(e,t,o),ft.multiplyByScalar(o,nt.CesiumMath.EPSILON2,o),ft.add(t,o,t));}}const Z_=gi([{name:"a_PositionHigh",type:"Float32",components:3},{name:"a_PositionLow",type:"Float32",components:3},{name:"a_PrevPositionHigh",type:"Float32",components:3},{name:"a_PrevPositionLow",type:"Float32",components:3},{name:"a_NextPositionHigh",type:"Float32",components:3},{name:"a_NextPositionLow",type:"Float32",components:3},{name:"a_ExpandAndWidth",type:"Float32",components:2},{name:"a_TEXCOORD_0",type:"Float32",components:2},{name:"a_Color",type:"Float32",components:3}]),K_=new ft,Q_=new ft,J_=new ft,eg=new ft;class tg extends id{constructor(e){super(e),this.setData(e);}_parse(e,t=[],i=[]){let n,r,o,a;this._positionsCallBack?(n=this._positionsCallBack(),this._vertexArray.clear(),this._indices.clear()):0!=t.length?(n=t,r=i[0][0],o=i[0][1],a=i[0][2]):n=this._positions,e&&this.incrementalData&&(n=this._positions.slice(this.incrementalData.originPositionCount),n=this.incrementalData.lastTwoPosition.concat(n));const s=this._width,l=this._arcType,c=this._granularity,u=this._ellipsoid;let h,d,p;n=Yd(n,ft.equalsEpsilon,!1,[]);let f=n.length;if(f<2||s<=0)return;if(l===jd.GEODESIC||l===jd.RHUMB){let e;e=l===jd.GEODESIC?nt.CesiumMath.chordLength(c,u.maximumRadius):c;const t=V_.extractHeights(n,u);n=l===jd.GEODESIC?V_.generateCartesianArc({positions:n,minDistance:e,ellipsoid:u,height:t}):V_.generateCartesianRhumbArc({positions:n,granularity:e,ellipsoid:u,height:t});}f=n.length;const m=4*f-4,_=new Float64Array(3*m),g=new Float64Array(3*m),y=new Float64Array(3*m),x=new Float32Array(2*m),v=new Float32Array(2*m);let w,T,b,P,S,A,E,C,M,I,L=0,N=0,R=0;for(d=0;d<f;++d){0===d?(w=K_,ft.subtract(n[0],n[1],w),ft.add(n[0],w,w)):w=n[d-1],ft.clone(w,J_),ft.clone(n[d],Q_),d===f-1?(w=K_,ft.subtract(n[f-1],n[f-2],w),ft.add(n[f-1],w,w)):w=n[d+1],ft.clone(w,eg);const e=d===f-1?2:4;for(p=0===d?2:0;p<e;++p){ft.pack(Q_,_,L),ft.pack(J_,g,L),ft.pack(eg,y,L),L+=3;const e=p-2<0?-1:1;x[N++]=p%2*2-1,x[N++]=e*s,v[R++]=d/(f-1),v[R++]=Math.max(x[N-2],0);}}this.finalPositions=_;for(let e=0;e<this._evennessUV.length;e++)v[e]=this._evennessUV[e];for(h=0;h<_.length;h+=3)T=Qh.encode(_[h]),b=Qh.encode(_[h+1]),P=Qh.encode(_[h+2]),S=Qh.encode(g[h]),A=Qh.encode(g[h+1]),E=Qh.encode(g[h+2]),C=Qh.encode(y[h]),M=Qh.encode(y[h+1]),I=Qh.encode(y[h+2]),i.length>1?this._vertexArray.emplaceBack(T.high,b.high,P.high,T.low,b.low,P.low,S.high,A.high,E.high,S.low,A.low,E.low,C.high,M.high,I.high,C.low,M.low,I.low,x[h/3*2],x[h/3*2+1],v[h/3*2],v[h/3*2+1],r,o,a):this._vertexArray.emplaceBack(T.high,b.high,P.high,T.low,b.low,P.low,S.high,A.high,E.high,S.low,A.low,E.low,C.high,M.high,I.high,C.low,M.low,I.low,x[h/3*2],x[h/3*2+1],v[h/3*2],v[h/3*2+1]);const O=f-1;if(t.length>0)for(d=0;d<O;++d)this._indices.emplaceBack(this.index,this.index+2,this.index+1),this._indices.emplaceBack(this.index+1,this.index+2,this.index+3),this.index+=4;else {let t=e?this.incrementalData.lastIndex:0;for(d=0;d<O;++d)this._indices.emplaceBack(t,t+2,t+1),this._indices.emplaceBack(t+1,t+2,t+3),t+=4;this.incrementalData={originPositionCount:this._positionsCallBack?this._positionsCallBack().length:this._positions.length,lastIndex:t,lastTwoPosition:n.slice(n.length-2)};}this.dynamicAirLine||(this.computeBoundingSphere(this.finalPositions),this.computeBoundingBox(this.finalPositions)),this._ready=!0,this._needUpdate=!0;}_parseExtrude(){let e;if(this._positionsCallBack?(e=this._positionsCallBack(),this._vertexArray.clear(),this._indices.clear()):e=this._positions,e=Yd(e,ft.equalsEpsilon,!1),e.length<2)return;const t=this._ellipsoid,{attributes:i,indices:n}=$_.createVolumeGeometry(e,t,this.minimumHeight,this.maximumHeight),{position:r,startHiAndForwardOffsetX:o,startLoAndForwardOffsetY:a,startNormalAndForwardOffsetZ:s,endNormalAndTextureCoordinateNormalizationX:l,rightNormalAndTextureCoordinateNormalizationY:c}=i;this.finalPositions=r;for(let e=0,t=n.length;e<t;e+=3)this._indices.emplaceBack(n[e],n[e+1],n[e+2]);let u,h,d,p=0;for(let e=0,t=o.length;e<t;e+=4)u=Qh.encode(r[p]),h=Qh.encode(r[p+1]),d=Qh.encode(r[p+2]),this._vertexArray.emplaceBack(u.high,h.high,d.high,u.low,h.low,d.low,o[e],o[e+1],o[e+2],a[e],a[e+1],a[e+2],s[e],s[e+1],s[e+2],l[e],l[e+1],l[e+2],c[e],c[e+1],c[e+2],o[e+3],a[e+3],s[e+3],l[e+3],c[e+3],this._width),p+=3;this.computeBoundingSphere(this.finalPositions),this.computeBoundingBox(this.finalPositions),this._ready=!0,this._needUpdate=!0;}updateProperty(e){this.setData(e);}setData(e){if(this._width=Z(Z(e.width,this._width),1),this.colorArray=Z(e.colorArray,void 0),this.lineSegmentation=Z(e.lineSegmentation,void 0),this.speed=Z(e.speed,60),this.segGroup=Z(e.segGroup,5),this.dynamicAirLine=Z(e.dynamicAirLine,!1),this._evennessUV=[],this.minimumHeight=Z(e.minimumHeight,Z(this.minimumHeight,-10)),this.maximumHeight=Z(e.maximumHeight,Z(this.maximumHeight,Qd)),e.positions&&"function"==typeof e.positions)this._positionsCallBack=e.positions;else {if(!e.positions||e.positions.length<2)return void console.error("至少添加两个点位！");this._positions=e.positions;}if(e.useEvennessUV){this._evennessUV.push(0,0,0,1);const e=[0];for(let t=1;t<this._positions.length;t++){const i=e[t-1]+ft.distance(this._positions[t-1],this._positions[t]);e.push(i);}for(let t=1;t<e.length-1;t++){const i=e[t]/e[e.length-1];this._evennessUV.push(i,0,i,1,i,0,i,1);}this._evennessUV.push(1,0,1,1);}if(this._vertexArray||this._indices?e.incrementalUpdate||(this._vertexArray.clear(),this._indices.clear()):(this._arcType=Z(e.arcType,jd.GEODESIC),this._granularity=Z(e.granularity,nt.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=oi.clone(Z(e.ellipsoid,oi.WGS84)),this.type="PolylineGeometry",this._vertexArray=null==this.colorArray?new ea:new ia,this._indices=new Ia,this.primitiveType=hc.TRIANGLES,this._usedDoublePrecision=!0,this._ready=!1),this.adaptTerrain)this._vertexArray=new ta,this._parseExtrude();else if(this.index=0,void 0!==this.lineSegmentation){for(let t=0;t<this.lineSegmentation.length;t++)this._parse(e.incrementalUpdate,this._positions.slice(this.lineSegmentation[t][2],this.lineSegmentation[t][3]),this.colorArray.slice(this.lineSegmentation[t][2],this.lineSegmentation[t][3]));this.computeBoundingSphere(this._positions),this.computeBoundingBox(this._positions);}else this._parse(e.incrementalUpdate);}setAdaptTerrain(e){this.adaptTerrain=e,this._indices=new Ia,this.adaptTerrain?(this._vertexArray=new ta,this._parseExtrude()):(this._vertexArray=new ea,this._parse());}update(e){if(this._positionsCallBack&&(this.adaptTerrain?this._parseExtrude():this._parse()),this.dynamicAirLine&&(null!=this.lineSegmentation&&this.updateLineSegmentation(e),this.setData({positions:this._positions,width:this.width,arcType:jd.GEODESIC,lineSegmentation:this.lineSegmentation,colorArray:this.colorArray,speed:this.speed,segGroup:this.segGroup,dynamicAirLine:this.dynamicAirLine}),this._needUpdate=!0),this._needUpdate&&e.painter){const t=e.painter.context;this._vertBuffer&&this._vertBuffer.destroy(),this._indexBuffer&&this._indexBuffer.destroy(),this._segmentVector&&this._segmentVector.destroy(),this._vertBuffer=t.createVertexBuffer(this._vertexArray,this._vertexArray instanceof ea?q_.members:this._vertexArray instanceof ia?Z_.members:X_.members,this.dynamicDraw),this._indexBuffer=t.createIndexBuffer(this._indices,this.dynamicDraw),this._segmentVector=Ud.simpleSegment(0,0,this._vertexArray.length,this._indices.length),this._ready=!0,this._needUpdate=!1;}}updateLineSegmentation(e){for(let t=0;t<this.lineSegmentation.length;t++){const i=this.lineSegmentation[t][0],n=this.lineSegmentation[t][1],r=n-i;let o=e.painter._map.timer.counter*this.speed,a=o-this.segGroup;o%r>a%r?(o=Math.floor(o%r)+i,a=o-this.segGroup):(o=n,a=Math.floor(a%r)+i),this.lineSegmentation[t][2]=a,this.lineSegmentation[t][3]=o;}}serialize(){const e=[];for(let t=0;t<this._positions.length;t++)e.push(ft.pack(this._positions[t],new Array(3)));return {type:this.type,positions:e,width:this._width,arcType:this._arcType}}destroy(){return super.destroy(),this._positions=void 0,this._width=void 0,this._arcType=void 0,this._granularity=void 0,this._ellipsoid=void 0,this.type=void 0,this._vertexArray=void 0,this._indices=void 0,this.primitiveType=void 0,this._ready=void 0,this._segmentVector=void 0,this._polylineUpdated=void 0,uc(this)}}function ig(e,t,i){return t*(Ch/(e.tileSize*Math.pow(2,i-e.tileID.overscaledZ)))}function ng(e,t){const{expression:i}=t;if("constant"===i.kind)return {functionType:"constant",layoutSize:i.evaluate(new _p(e+1))};if("source"===i.kind)return {functionType:"source"};{const n=i.zoomStops;let r=0;for(;r<n.length&&n[r]<=e;)r++;r=Math.max(0,r-1);let o=r;for(;o<n.length&&n[o]<e+1;)o++;o=Math.min(n.length-1,o);const a={min:n[r],max:n[o]};return "composite"===i.kind?{functionType:"composite",zoomRange:a,propertyValue:t.value}:{functionType:"camera",layoutSize:i.evaluate(new _p(e+1)),zoomRange:a,sizeRange:{min:i.evaluate(new _p(a.min)),max:i.evaluate(new _p(a.max))},propertyValue:t.value}}}function rg(e,t,i){const n=t;return "source"===e.functionType?i.lowerSize/10:"composite"===e.functionType?pr(i.lowerSize/10,i.upperSize/10,n.uSizeT):n.uSize}function og(e,t,i){if("constant"===e.functionType)return {uSizeT:0,uSize:e.layoutSize};if("source"===e.functionType)return {uSizeT:0,uSize:0};if("camera"===e.functionType){const{propertyValue:n,zoomRange:r,sizeRange:o}=e,a=De(Bo(n,i.specification).interpolationFactor(t,r.min,r.max),0,1);return {uSizeT:0,uSize:o.min+a*(o.max-o.min)}}{const{propertyValue:n,zoomRange:r}=e;return {uSizeT:De(Bo(n,i.specification).interpolationFactor(t,r.min,r.max),0,1),uSize:0}}}const ag=gi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_offset",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint16"}]),sg=gi([{name:"a_CARTESIAN",components:3,type:"Float32"},{name:"a_projected_pos",components:3,type:"Float32"}],4);gi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const lg=gi([{name:"a_pick_color",components:4,type:"Float32"}]),cg=gi([{name:"a_placed",components:2,type:"Uint8"}],4);gi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]);const ug=gi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),hg=gi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);function dg(e,t,i){const n=t.layout.get("text-transform").evaluate(i,{});return "uppercase"===n?e=e.toLocaleUpperCase():"lowercase"===n&&(e=e.toLocaleLowerCase()),mp.applyArabicShaping&&(e=mp.applyArabicShaping(e)),e}function pg(e,t,i){return e instanceof mn?(e.sections.forEach((e=>{e.text=dg(e.text,t,i);})),e):dg(e,t,i)}function fg(e){const t={},i={},n=[];let r=0;function o(t){n.push(e[t]),r++;}function a(e,t,r){const o=i[e];return delete i[e],i[t]=o,n[o].geometry[0].pop(),n[o].geometry[0]=n[o].geometry[0].concat(r[0]),o}function s(e,i,r){const o=t[i];return delete t[i],t[e]=o,n[o].geometry[0].shift(),n[o].geometry[0]=r[0].concat(n[o].geometry[0]),o}function l(e,t,i){const n=i?t[0][t[0].length-1]:t[0][0];return `${e}:${n.x}:${n.y}`}for(let c=0;c<e.length;c++){const u=e[c],h=u.geometry,d=u.text instanceof mn?u.text.toString():u.text;if(!d){o(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in i&&f in t&&i[p]!==t[f]){const e=s(p,f,h),r=a(p,f,n[e].geometry);delete t[p],delete i[f],i[l(d,n[r].geometry,!0)]=r,n[e].geometry=null;}else p in i?a(p,f,h):f in t?s(p,f,h):(o(c),t[p]=r-1,i[f]=r-1);}return n.filter((e=>e.geometry))}gi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"hidden"}]),gi([{type:"Float32",name:"offsetX"}]),gi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const mg={min:-1*Math.pow(2,15),max:Math.pow(2,15)-1};function _g(e){const t=Ch/e.extent,i=e.loadGeometry();for(let e=0;e<i.length;e++){const n=i[e];for(let e=0;e<n.length;e++){const i=n[e];i.x=Math.round(i.x*t),i.y=Math.round(i.y*t),(i.x<mg.min||i.x>mg.max||i.y<mg.min||i.y>mg.max)&&We("Geometry exceeds allowed extent, reduce your vector tile buffer size");}}return i}function gg(e,t,i,n,r){this.properties={},this.extent=i,this.type=0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=r,this._version=arguments[5],this._projection=e.projection||"MERCATOR",this.projObj=di(this._projection),e.readFields(yg,this,t);}function yg(e,t,i){1==e?t.id=i.readVarint():2==e?function(e,t){const i=e.readVarint()+e.pos;for(;e.pos<i;){const i=t._keys[e.readVarint()],n=t._values[e.readVarint()];t.properties[i]=n;}}(i,t):3==e?t.type=i.readVarint():4==e&&(t._geometry=i.pos);}function xg(e){let t=0;for(var i,n,r=0,o=e.length,a=o-1;r<o;a=r++)t+=((n=e[a]).x-(i=e[r]).x)*(i.y+n.y);return t}function vg(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(wg,this,t),this.length=this._features.length;}function wg(e,t,i){15===e?t.version=i.readVarint():1===e?t.name=i.readString():5===e?t.extent=i.readVarint():2===e?t._features.push(i.pos):3===e?t._keys.push(i.readString()):4===e&&t._values.push(function(e){let t=null,i=e.readVarint()+e.pos;for(;e.pos<i;){const i=e.readVarint()>>3;t=1===i?e.readString():2===i?e.readFloat():3===i?e.readDouble():4===i?e.readVarint64():5===i?e.readVarint():6===i?e.readSVarint():7===i?e.readBoolean():null;}return t}(i));}function Tg(e,t,i){if(3===e){const e=new vg(i,i.readVarint()+i.pos);e.length&&(t[e.name]=e);}}gg.types=["Unknown","Point","LineString","Polygon"],gg.prototype.loadGeometry=function(){const e=this._pbf;e.pos=this._geometry;let t,i=e.readVarint()+e.pos,n=1,r=0,o=0,a=0,s=0,l=[];for(;e.pos<i;){if(r<=0){const t=e.readVarint();n=7&t,r=t>>3;}if(r--,1===n||2===n)o+=e.readSVarint(),a+=e.readSVarint(),this._version>100&&(s+=e.readSVarint()),1===n&&(t&&l.push(t),t=[]),t.push(new te(o,a,s));else {if(7!==n)throw new Error(`unknown command ${n}`);t&&t.push(t[0].clone());}}return t&&l.push(t),l},gg.prototype.bbox=function(){const e=this._pbf;e.pos=this._geometry;let t=e.readVarint()+e.pos,i=1,n=0,r=0,o=0,a=1/0,s=-1/0,l=1/0,c=-1/0;for(;e.pos<t;){if(n<=0){const t=e.readVarint();i=7&t,n=t>>3;}if(n--,1===i||2===i)r+=e.readSVarint(),o+=e.readSVarint(),r<a&&(a=r),r>s&&(s=r),o<l&&(l=o),o>c&&(c=o);else if(7!==i)throw new Error(`unknown command ${i}`)}return [a,l,s,c]},gg.prototype.toGeoJSON=function(e,t,i){let n,r,o=this.extent*Math.pow(2,i),a=this.extent*e,s=this.extent*t,l=this.loadGeometry(),c=gg.types[this.type];const u=this;function h(e){for(let t=0;t<e.length;t++){const i=e[t];e[t]=[u.projObj.xLng(i.x+a,o),u.projObj.yLat(i.y+s,o)];}}switch(this.type){case 1:var d=[];for(n=0;n<l.length;n++)d[n]=l[n][0];l=d,h(l);break;case 2:for(n=0;n<l.length;n++)h(l[n]);break;case 3:for(l=function(e){const t=e.length;if(t<=1)return [e];let i,n,r=[];for(let o=0;o<t;o++){const t=xg(e[o]);0!==t&&(void 0===n&&(n=t<0),n===t<0?(i&&r.push(i),i=[e[o]]):i.push(e[o]));}return i&&r.push(i),r}(l),n=0;n<l.length;n++)for(r=0;r<l[n].length;r++)h(l[n][r]);}1===l.length?l=l[0]:c=`Multi${c}`;const p={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return "id"in this&&(p.id=this.id),p},vg.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const t=this._pbf.readVarint()+this._pbf.pos;return new gg(this._pbf,t,this.extent,this._keys,this._values,this.version)};var bg={VectorTile:function(e,t,i){e.projection=i,this.layers=e.readFields(Tg,{},t);},VectorTileFeature:gg,VectorTileLayer:vg};const Pg={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};class Sg extends te{constructor(e,t,i,n){super(e,t),this.angle=i,void 0!==n&&(this.segment=n);}clone(){return new Sg(this.x,this.y,this.angle,this.segment)}}Ho("Anchor",Sg);const Ag={AIRLINE:"airline",CIRCLE:"circle",DYNAMIC_LINE:"dynamic-line",EXTRUSION:"extrusion",FILL:"fill",HEATMAP:"heatmap",HISTOGRAM:"histogram",LINE:"line",SPRITE:"sprite",SYMBOL:"symbol",SYMTRACKING:"symtracking",TRACKING:"tracking",RASTER:"raster",IMAGE:"image",BACKGROUND:"background",MODEL:"3d-model",TILES:"3d-tiles",DEBUG_TILE:"debug-tile",PROXY:"proxy"},Eg=bg.VectorTileFeature.types,Cg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Mg(e,t,i,n,r,o,a){e.emplaceBack(t.x,t.y,t.z,Math.round(32*i),Math.round(32*n),r,o,a?a[0]:0,a?a[1]:0);}function Ig(e,t,i,n,r,o,a,s,l,c,u,h){const d=new Wh,p=o[2]-l,f=Math.pow(2,p);let m=1;l-c-p<-.5&&(m=Math.pow(2,(l-c-p+.5)/3));const _=new It(t.x-n.x,t.y-n.y);_.multiplyScalar(16*r*m),d.rotate(i);for(let l=0;l<4;l++){const c=new It(a[l][0]*m,a[l][1]*m);c.multiplyScalar(r/4).transformByMatrix2(d);const p=_.clone().add(c).add([16*n.x,16*n.y]).multiplyScalar(f/8192),g=Tl(o[0]+p[0],o[1]+p[1],o[2],s,h);e.emplaceBack(g[0]-u[0],g[1]-u[1],g[2]-u[2],t.x-n.x,t.y-n.y,i);}}class Lg{constructor(e){this.layoutVertexArray=new Aa,this.indexArray=new Ia,this.programConfigurations=e,this.segments=new Ud,this.dynamicLayoutVertexArray=new ra,this.opacityVertexArray=new va,this.placedSymbolArray=new za;}upload(e,t,i,n){i&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ag.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,sg.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Cg,!0),this.opacityVertexBuffer.itemSize=1),(i||n)&&this.programConfigurations.upload(e);}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy());}}Ho("SphereSymbolBuffers",Lg);class Ng{constructor(e,t,i){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new i,this.segments=new Ud,this.collisionVertexArray=new Ta;}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,cg.members,!0);}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy());}}Ho("SphereCollisionBuffers",Ng);class Rg{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasRTLText=!1,this.glyphQuadsArray=[],this.symbolHeightsArray=[],this.type=Ag.SYMBOL;const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ng(this.zoom,t["text-size"]),this.iconSizeData=ng(this.zoom,t["icon-size"]);const i=this.layers[0].layout,n=i.get("symbol-sort-key"),r=i.get("symbol-z-order");this.sortFeaturesByKey="viewport-y"!==r&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===r||"auto"===r&&!this.sortFeaturesByKey)&&(i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement")),this.sourceID=e.sourceID,this.projection=e.projection||ci.MERCATOR,this.pickColor=!0;}createArrays(){this.text=new Lg(new tf(ag.members,this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new Lg(new tf(ag.members,this.layers,this.zoom,(e=>/^icon/.test(e)))),this.collisionBox=new Ng(Ea,ug.members,Na),this.collisionCircle=new Ng(Ea,hg.members,Ia),this.glyphOffsetArray=new Va,this.lineVertexArray=new ka;}calculateGlyphDependencies(e,t,i,n){for(let r=0;r<e.length;r++)if(t[e.charCodeAt(r)]=!0,i&&n){const i=Pg[e.charAt(r)];i&&(t[i.charCodeAt(0)]=!0);}}populate(e,t,i){this.baseP||(this.x=t.x,this.y=t.y,this.z=t.z,this.zPow=Math.pow(2,this.z),this.baseP=Tl(this.x,this.y,this.z,this.projection),this.matrix=bl(this.baseP));const n=this.layers[0],r=n.layout,o=r.get("text-font"),a=r.get("text-field"),s=r.get("icon-image"),l=("constant"!==a.value.kind||a.value.value.toString().length>0)&&("constant"!==o.value.kind||o.value.value.length>0),c="constant"!==s.value.kind||s.value.value&&s.value.value.length>0,u=r.get("symbol-sort-key");if(this.features=[],!l&&!c)return;const h=t.iconDependencies,d=t.glyphDependencies,p=t.availableImages,f=new _p(this.zoom);for(const{feature:t,index:a,sourceLayerIndex:s}of e){if(!n._featureFilter(f,t,i))continue;let e,m;if(l){const r=n.getValueAndResolveTokens("text-field",t,i,p),o=mn.factory(r);o.containsRTLText()&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===pp()||this.hasRTLText&&mp.isParsed())&&(e=pg(o,n,t));}if(c){this.iconHaloWidth=n.paint.get("icon-halo-width").evaluate(t,{});const e=n.getValueAndResolveTokens("icon-image",t,i,p);m=e instanceof _n?e:_n.fromString(e);}if(!e&&!m)continue;const _=this.sortFeaturesByKey?u.evaluate(t,{},i):void 0,g={text:e,icon:m,index:a,sourceLayerIndex:s,geometry:_g(t),properties:t.properties,type:Eg[t.type],sortKey:_};if(void 0!==t.id&&(g.id=t.id),this.features.push(g),m&&m instanceof _n&&(h[m.name]=!0),e){const i=o.evaluate(t,{}).join(",");this.textHaloWidth=n.paint.get("text-halo-width").evaluate(t,{});const a=d[i]=d[i]||{},s="map"===r.get("text-rotation-alignment")&&"point"!==r.get("symbol-placement");if(e instanceof mn)for(const t of e.sections){const n=sn(e.toString()),r=t.fontStack||i,o=d[r]=d[r]||{};this.calculateGlyphDependencies(t.text,o,s,n);}else {const t=sn(e);this.calculateGlyphDependencies(e,a,s,t);}}}"line"===r.get("symbol-placement")&&(this.features=fg(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey));}update(e,t){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers));}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return !this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){this.uploaded||(this.collisionBox.upload(e),this.collisionCircle.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0;}destroy(){this.text.destroy(),this.icon.destroy(),this.collisionBox.destroy(),this.collisionCircle.destroy();}addToLineVertexArray(e,t){const i=this.lineVertexArray.length;if(void 0!==e.segment){let i=e.dist(t[e.segment+1]),n=e.dist(t[e.segment]);const r={};for(let n=e.segment+1;n<t.length;n++)r[n]={x:t[n].x,y:t[n].y,tileUnitDistanceFromAnchor:i},n<t.length-1&&(i+=t[n+1].dist(t[n]));for(let i=e.segment||0;i>=0;i--)r[i]={x:t[i].x,y:t[i].y,tileUnitDistanceFromAnchor:n},i>0&&(n+=t[i-1].dist(t[i]));for(let e=0;e<t.length;e++){const t=r[e];this.lineVertexArray.emplaceBack(t.x,t.y,t.tileUnitDistanceFromAnchor);}}return {lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(e,t,i,n,r,o,a,s,l,c,u){const h=e.indexArray,d=e.layoutVertexArray,p=e.dynamicLayoutVertexArray,f=e.segments.prepareSegment(4*t.length,e.layoutVertexArray,e.indexArray),m=this.glyphOffsetArray.length,_=f.vertexLength;for(const e of t){const t=e.tl,n=e.tr,r=e.bl,a=e.br,l=e.tex,c=f.vertexLength,u=e.glyphOffset[1];let m=0;const _=this.layers[0].layout.get("symbol-height-offset")?.value?.value||0,g=this.layers[0].layout.get("symbol-height-key")||"symbolHeight";o.properties&&o.properties[g]?m=parseFloat(o.properties[g]):o.properties&&o.properties.height&&o.properties[g]&&(m=parseFloat(o.properties.height)),m+=parseFloat(_);const y=this.calcTDSpacePoint(s.x,s.y,m);Mg(d,y,t.x,u+t.y,l.x,l.y,i),Mg(d,y,n.x,u+n.y,l.x+l.w,l.y,i),Mg(d,y,r.x,u+r.y,l.x,l.y+l.h,i),Mg(d,y,a.x,u+a.y,l.x+l.w,l.y+l.h,i);const x=[[32*t.x,32*(u+t.y)],[32*n.x,32*(u+n.y)],[32*r.x,32*(u+r.y)],[32*a.x,32*(u+a.y)]];Ig(p,s,0,s,1,[this.x,this.y,this.z],x,this.projection,this.z,this.z,this.baseP,m),h.emplaceBack(c,c+1,c+2),h.emplaceBack(c+1,c+2,c+3),f.vertexLength+=4,f.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(e.glyphOffset[0]),this.glyphQuadsArray.push(x),this.symbolHeightsArray.push(m);}e.placedSymbolArray.emplaceBack(s.x,s.y,m,this.glyphOffsetArray.length-m,_,l,c,s.segment,i?i[0]:0,i?i[1]:0,n[0],n[1],a,!1),e.programConfigurations.populatePaintArrays(e.layoutVertexArray.length,o,o.index,{},u);}_addCollisionDebugVertex(e,t,i,n,r){return t.emplaceBack(0,0),e.emplaceBack(i.x,i.y,i.z,n.x,n.y,Math.round(r.x),Math.round(r.y))}addCollisionDebugVertices(e,t,i,n,r,o,a,s){const l=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),c=l.vertexLength,u=r.layoutVertexArray,h=r.collisionVertexArray,d=this.calcTDSpacePoint(o.x,o.y);if(this._addCollisionDebugVertex(u,h,d,a.anchor,new te(e,t)),this._addCollisionDebugVertex(u,h,d,a.anchor,new te(i,t)),this._addCollisionDebugVertex(u,h,d,a.anchor,new te(i,n)),this._addCollisionDebugVertex(u,h,d,a.anchor,new te(e,n)),l.vertexLength+=4,s){const e=r.indexArray;e.emplaceBack(c,c+1,c+2),e.emplaceBack(c,c+2,c+3),l.primitiveLength+=2;}else {const e=r.indexArray;e.emplaceBack(c,c+1),e.emplaceBack(c+1,c+2),e.emplaceBack(c+2,c+3),e.emplaceBack(c+3,c),l.primitiveLength+=4;}}generateCollisionDebugBuffers(){for(const e of this.symbolInstances){e.textCollisionFeature={boxStartIndex:e.textBoxStartIndex,boxEndIndex:e.textBoxEndIndex},e.iconCollisionFeature={boxStartIndex:e.iconBoxStartIndex,boxEndIndex:e.iconBoxEndIndex};for(let t=0;t<2;t++){const i=e[0===t?"textCollisionFeature":"iconCollisionFeature"];if(i)for(let t=i.boxStartIndex;t<i.boxEndIndex;t++){const i=this.collisionBoxArray.get(t),n=i.radius>0;this.addCollisionDebugVertices(i.x1,i.y1,i.x2,i.y2,n?this.collisionCircle:this.collisionBox,i.anchorPoint,e,n);}}}}deserializeCollisionBoxes(e,t,i,n,r){const o={};for(let n=t;n<i;n++){const t=e.get(n);if(0===t.radius){o.textBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,anchorPointX:t.anchorPointX,anchorPointY:t.anchorPointY},o.textFeatureIndex=t.featureIndex;break}o.textCircles||(o.textCircles=[],o.textFeatureIndex=t.featureIndex),o.textCircles.push(t.anchorPointX,t.anchorPointY,t.radius,t.signedDistanceFromAnchor,1);}for(let t=n;t<r;t++){const i=e.get(t);if(0===i.radius){o.iconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},o.iconFeatureIndex=i.featureIndex;break}}return o}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasCollisionBoxData(){return this.collisionBox.segments.get().length>0}hasCollisionCircleData(){return this.collisionCircle.segments.get().length>0}sortFeatures(e){if(!this.sortFeaturesByY)return;if(this.sortedAngle===e)return;if(this.sortedAngle=e,this.text.segments.get().length>1||this.icon.segments.get().length>1)return;const t=[];for(let e=0;e<this.symbolInstances.length;e++)t.push(e);const i=Math.sin(e),n=Math.cos(e);t.sort(((e,t)=>{const r=this.symbolInstances[e],o=this.symbolInstances[t];return (0|Math.round(i*r.anchor.x+n*r.anchor.y))-(0|Math.round(i*o.anchor.x+n*o.anchor.y))||o.featureIndex-r.featureIndex})),this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of t){const t=this.symbolInstances[e];this.featureSortOrder.push(t.featureIndex);for(const e of t.placedTextSymbolIndices){const t=this.text.placedSymbolArray.get(e),i=t.vertexStartIndex+4*t.numGlyphs;for(let e=t.vertexStartIndex;e<i;e+=4)this.text.indexArray.emplaceBack(e,e+1,e+2),this.text.indexArray.emplaceBack(e+1,e+2,e+3);}const i=this.icon.placedSymbolArray.get(e);if(i.numGlyphs){const e=i.vertexStartIndex;this.icon.indexArray.emplaceBack(e,e+1,e+2),this.icon.indexArray.emplaceBack(e+1,e+2,e+3);}}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray);}calcTDSpacePoint(e,t,i){const n=wl(this.x+e/8192,this.y+t/8192,this.zPow,this.projection),r=lc.cartographicToCartesian3([n[0],n[1],i]);return new te(r[0]-this.baseP[0],r[1]-this.baseP[1],r[2]-this.baseP[2])}}Ho("SymbolBucket",Rg,{omit:["layers","collisionBoxArray","compareText"],shallow:["symbolInstances","features","matrix"]}),Rg.addDynamicAttributes=Ig;var Og={$version:8,$root:{version:{required:!0,type:"enum",values:[8],"doc-en":"Style specification version number. Must be 8."},name:{type:"string","doc-en":"A human-readable name for the style."},metadata:{type:"object","doc-en":"Metadata configuration related to map rendering. It only contains two options, 'enableNormal' and 'resolvePass', now. If you want to check out model's normal info, set 'enableNormal' to true and 'resolvePass' to 'normal'."},camera:{type:"object","doc-en":"Camera position and pose, including longitude, latitude, height, pitch, bearing and roll."},lights:{type:"any","doc-en":"The global light source, containing 'AmbientLight', 'DirectionalLight', 'PointLight' and 'SunLight'. Please refer to API documentation."},sources:{required:!0,type:"sources","doc-en":"Data source specifications."},sprite:{type:"any","doc-en":"A base URL for retrieving the sprite image and metadata. The extensions `.png`, `.json` and scale factor `@2x.png` will be automatically appended. This property is required if any layer uses the `background-pattern`, `fill-pattern`, `line-pattern`, `extrusion-pattern`, or `icon-image` properties. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax)."},IBL:{type:"string","doc-en":"The base request path of the picture used to request the PBR effect"},glyphs:{type:"string","doc-en":"A URL template for loading signed-distance-field glyph sets in PBF format. The URL must include `{fontstack}` and `{range}` tokens. This property is required if any layer uses the `text-field` layout property. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax)."},transition:{type:"transition","doc-en":"A global transition definition to use as a default across properties, to be used for timing transitions between one value and the next when no property-specific transition is set. Collision-based symbol fading is controlled independently of the style's `transition` property."},layers:{required:!0,type:"array",value:"layer","doc-en":"Layers will be drawn in the order of this array."},projection:{type:"string",default:"MERCATOR","doc-en":"Map projection, 'MERCATOR' is the default and 'LATLON' can be chosen."},sceneComponent:{type:"object","doc-en":"Scene component specifications. Please refer to API documentation."},analysis:{type:"object","doc-en":"Spatial analysis specifications. Please refer to API documentation."},postProcess:{type:"object","doc-en":"Post Process specifications. Please refer to API documentation."},videoProjection:{type:"any","doc-en":"Video projection specifications. Please refer to API documentation."},terrain:{type:"object","doc-en":"Terrain specifications. Please refer to API documentation."}},sources:{"*":{type:"source","doc-en":"Specification of a data source. For vector and raster sources, either TileJSON or a URL to a TileJSON must be provided. For image and video sources, a URL must be provided. For GeoJSON sources, a URL or inline GeoJSON must be provided."}},source:["source_vector","source_raster","source_geojson","source_image","source_3d_model","source_3d_tiles"],source_vector:{type:{required:!0,type:"enum",values:{vector:{"doc-en":"A vector tile source."}},"doc-en":"The type of the source."},url:{type:"string","doc-en":"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `minemap://<Tileset ID>`."},tiles:{type:"array",value:"string","doc-en":"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-90,180,90],"doc-en":"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by minemap GL."},scheme:{type:"enum",values:{xyz:{"doc-en":"Slippy map tilenames scheme."},tms:{"doc-en":"OSGeo spec scheme."}},default:"xyz","doc-en":"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},projection:{type:"string",default:"MERCATOR","doc-en":"Map projection, 'MERCATOR' is the default and 'LATLON' can be chosen."},minzoom:{type:"number",default:0,"doc-en":"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,"doc-en":"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},attribution:{type:"string","doc-en":"Contains an attribution to be displayed when the map is shown to a user."},promoteId:{type:"promoteId","doc-en":"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`. If specified as a string for a vector tile source, the same property is used across all its source layers."},adaptTerrain:{type:"boolean",default:!1,"doc-en":"Vector adapted to terrain."},"*":{type:"*","doc-en":"Other keys to configure the data source."}},source_raster:{type:{required:!0,type:"enum",values:{raster:{"doc-en":"A raster tile source."}},"doc-en":"The type of the source."},url:{type:"string","doc-en":"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `minemap://<Tileset ID>`."},tiles:{type:"array",value:"string","doc-en":"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-90,180,90],"doc-en":"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by minemap GL."},minzoom:{type:"number",default:0,"doc-en":"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:15,"doc-en":"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels","doc-en":"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},scheme:{type:"enum",values:{xyz:{"doc-en":"Slippy map tilenames scheme."},tms:{"doc-en":"OSGeo spec scheme."},baidu:{"doc-en":"Baidu map scheme."},wmts:{"doc-en":"WMTS spec scheme."}},default:"xyz","doc-en":"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},projection:{type:"string",default:"MERCATOR","doc-en":"Map projection, 'MERCATOR' is the default and 'LATLON' can be chosen."},capabilities:{type:"object","doc-en":"WMTS service description info, can be used only if 'scheme' option set to 'wmts'."},attribution:{type:"string","doc-en":"Contains an attribution to be displayed when the map is shown to a user."},"*":{type:"*","doc-en":"Other keys to configure the data source.",expose:!1}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{"doc-en":"A GeoJSON data source."}},"doc-en":"The data type of the GeoJSON source."},data:{type:"*","doc-en":"A URL to a GeoJSON file, or inline GeoJSON."},minzoom:{type:"number",default:0,"doc-en":"Creates the minimum zoom level for the vector tile (a lower scale level represents a smaller scale level)."},maxzoom:{type:"number",default:24,"doc-en":"Maximum zoom level at which to create vector tiles (higher means greater detail at high zoom levels)."},attribution:{type:"string","doc-en":"Contains an attribution to be displayed when the map is shown to a user."},buffer:{type:"number",default:128,maximum:512,minimum:0,"doc-en":"Size of the tile buffer on each side. A value of 0 produces no buffer. A value of 512 produces a buffer as wide as the tile itself. Larger values produce fewer rendering artifacts near tile edges and slower performance."},tolerance:{type:"number",default:.375,"doc-en":"Douglas-Peucker simplification tolerance (higher means simpler geometries and faster performance)."},cluster:{type:"boolean",default:!1,"doc-en":"If the data is a collection of point features, setting this to true clusters the points by radius into groups. Cluster groups become new `Point` features in the source with additional properties:\n * `cluster` Is `true` if the point is a cluster \n * `cluster_id` A unqiue id for the cluster to be used in conjunction with the [cluster inspection methods](https://www.minemap.com/minemap-gl-js/api/#geojsonsource#getclusterexpansionzoom)\n * `point_count` Number of original points grouped into this cluster\n * `point_count_abbreviated` An abbreviated point count"},clusterRadius:{type:"number",default:50,minimum:0,"doc-en":"Radius of each cluster if clustering is enabled. A value of 512 indicates a radius equal to the width of a tile."},clusterMaxZoom:{type:"number","doc-en":"Max zoom on which to cluster points if clustering is enabled. Defaults to one zoom less than maxzoom (so that last zoom features are not clustered)."},clusterMinPoints:{type:"number",default:2,"doc-en":"Minimum number of points necessary to form a cluster if clustering is enabled. Defaults to `2`."},clusterProperties:{type:"*","doc-en":'An object defining custom properties on the generated clusters if clustering is enabled, aggregating values from clustered points. Has the form `{"property_name": [operator, map_expression]}`. `operator` is any expression function that accepts at least 2 operands (e.g. `"+"` or `"max"`) — it accumulates the property value from clusters/points the cluster contains; `map_expression` produces the value of a single point.'},lineMetrics:{type:"boolean",default:!1,"doc-en":"Whether to calculate line distance metrics. This is required for line layers that specify `line-gradient` values."},promoteId:{type:"promoteId","doc-en":"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`. If specified as a string for a vector tile source, the same property is used across all its source layers."}},source_3d_model:{type:{required:!0,type:"enum",values:{"3d-model":{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},bounds:{type:"array",length:4,value:{type:"array",length:2,value:"number"}},location:{required:!0,type:"array",value:{type:"number"}},scale:{required:!0,type:"array",value:{type:"number"}},pickable:{type:"boolean"},filter:{type:"array",value:"*"},aabbFilter:{type:"array",value:"*"},rotation:{required:!0,type:"array",value:{type:"number"}},"up-axis":{type:"enum",values:{"Y-UP":{},"Z-UP":{}}},translation:{required:!0,type:"array",value:{type:"number"}},modelFolder:{required:!0,type:"string"},debug:{type:"boolean"},configuration:{type:"object"},log:{type:"boolean",default:!1},useMipmap:{type:"boolean",default:!0}},source_image:{type:{required:!0,type:"enum",values:{image:{"doc-en":"An image data source."}},"doc-en":"The data type of the image source."},url:{required:!0,type:"string","doc-en":"URL that points to an image."},coordinates:{required:!0,"doc-en":"Corners of image specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number","doc-en":"单个经度，纬度组。."}},grid:{type:"number",default:1},wms:{type:"boolean",default:!1,"doc-en":"Whether use WMS service."}},source_3d_tiles:{type:{required:!0,type:"enum",values:{"3d-tiles":{}}},url:{type:"string",value:{type:"any"}},urls:{type:"array",value:{type:"object"}},maxzoom:{type:"number",default:22},minzoom:{type:"number",default:14},maximumMemoryUsage:{type:"number"},maximumScreenSpaceError:{type:"number"},throttleRequests:{type:"boolean"},attribution:{type:"string"},bounds:{type:"array",length:4,value:{type:"array",length:2,value:"number"}},collectResourceTiming:{required:!0,type:"boolean"},"up-axis":{type:"enum",values:{"Y-UP":{},"Z-UP":{}}},pickable:{type:"boolean"},debug:{type:"boolean"},forceLocation:{type:"array",value:{type:"number"}},translation:{type:"array",value:{type:"number"}},log:{type:"boolean",default:!1},useMipmap:{type:"boolean",default:!1},viewFrustum:{type:"object","doc-en":"Used to set the distance between the far and near clipping planes of the visual cone of 3dtiles",default:null}},layer:{id:{type:"string","doc-en":"Unique layer name.",required:!0},type:{type:"enum",values:{raster:{},fill:{},line:{},symbol:{},circle:{},heatmap:{},extrusion:{},histogram:{},dynamicLine:{},tracking:{},sprite:{},"3d-model":{},"3d-tiles":{},symtracking:{},background:{}},"doc-en":"Rendering type of this layer.",required:!0},metadata:{type:"*","doc-en":"Arbitrary properties useful to track with the layer, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'minemap:'."},source:{type:"string","doc-en":"Name of a source description to be used for this layer. Required for all layer types except `background`."},"source-layer":{type:"string","doc-en":"Layer to use from a vector tile source. Required for vector tile sources; prohibited for all other source types, including GeoJSON sources."},minzoom:{type:"number",minimum:0,maximum:24,"doc-en":"The minimum zoom level for the layer. At zoom levels less than the minzoom, the layer will be hidden."},maxzoom:{type:"number",minimum:0,maximum:24,"doc-en":"The maximum zoom level for the layer. At zoom levels equal to or greater than the maxzoom, the layer will be hidden."},filter:{type:"filter","doc-en":"A expression specifying conditions on source features. Only features that match the filter are displayed. Zoom expressions in filters are only evaluated at integer zoom levels. The `feature-state` expression is not supported in filter expressions."},layout:{type:"layout","doc-en":"Layout properties for the layer."},paint:{type:"paint","doc-en":"Default paint properties for this layer."},"depth-test":{type:"boolean",from:["raster"]},location:{type:"array",value:{type:"number"},from:["3d-model"]},rotation:{type:"array",value:{type:"number"},from:["3d-model"]},translation:{type:"array",value:{type:"number"},from:["3d-model"]},scale:{type:"array",value:{type:"number"},from:["3d-model"]},isSpecialLight:{type:"boolean",from:["3d-model"]},highLightColorsIndex:{type:"number",from:["3d-model"]},highLightColors:{type:"array",value:{type:"string"},from:["3d-model"]},"shadow-center":{type:"array",value:{type:"number"},from:["3d-model"]},specialLights:{type:"array",value:{type:"*"},from:["3d-model"]},classificationType:{type:"number",from:["line","fill","3d-model","raster","3d-tiles"]},lightingModel:{type:"number",from:["NONE","PHONG","PBR"]},phongLightConfig:{type:"phongLightConfig",from:["3d-model","3d-tiles","extrusion"]},lightExposure:{type:"number",from:["3d-model"]}},phongLightConfig:{Ambient:{type:"number",default:.6,minimum:0,maximum:1},Diffuse:{type:"number",minimum:0,maximum:1,default:.5},SpecularColor:{type:"number",minimum:0,maximum:1,default:.3},Shininess:{type:"number",default:2,minimum:0,maximum:1e3}},layout:["layout_background","layout_fill","layout_line","layout_symbol","layout_circle","layout_heatmap","layout_raster","layout_extrusion","layout_histogram","layout_dynamicLine","layout_tracking","layout_sprite","layout_3d-model","layout_3d-tiles","layout_symtracking"],layout_background:{visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"}},layout_sprite:{"sprite-cap":{type:"enum",values:{butt:{"doc-en":"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{"doc-en":"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},square:{"doc-en":"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},default:"butt","doc-en":"The display of line endings.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sprite-join":{type:"enum",values:{bevel:{"doc-en":"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},round:{"doc-en":"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},miter:{"doc-en":"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter","doc-en":"The display of lines when joining.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"sprite-miter-limit":{type:"number",default:2,"doc-en":"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"sprite-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sprite-round-limit":{type:"number",default:1.05,"doc-en":"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"sprite-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sprite-sort-key":{type:"number","doc-en":"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number","doc-en":"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"},dynamic:{type:"enum",values:{water:{},none:{}},default:"none",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{"doc-en":"A cap with a squared-off end which is drawn to the exact endpoint of the line."},"round-butt":{"doc-en":"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{"doc-en":"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},square:{"doc-en":"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},default:"butt","doc-en":"The display of line endings.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{"doc-en":"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},round:{"doc-en":"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},miter:{"doc-en":"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter","doc-en":"The display of lines when joining.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,"doc-en":"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,"doc-en":"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number","doc-en":"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-height-offset":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"},"border-visibility":{type:"enum",default:"none",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},"doc-en":"Whether draw border.","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{"doc-en":"The label is placed at the point where the geometry is located."},line:{"doc-en":"The label is placed along the line of the geometry. Can only be used on `LineString` and `Polygon` geometries."},"line-center":{"doc-en":"The label is placed at the center of the line of the geometry. Can only be used on `LineString` and `Polygon` geometries. Note that a single feature in a vector tile may contain multiple line geometries."}},default:"point","doc-en":"Label placement relative to its geometry.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels","doc-en":"Distance between two symbol anchors.",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,"doc-en":"If true, the symbols will not cross tile edges to avoid mutual collisions. Recommended in layers that don't have enough padding in the vector tile to prevent collisions, or if it is a point symbol layer placed after a line symbol layer.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number","doc-en":"Sorts features in ascending order based on this value. Features with lower sort keys are drawn and placed first.  When `icon-allow-overlap` or `text-allow-overlap` is `false`, features with a lower sort key will have priority during placement. When `icon-allow-overlap` or `text-allow-overlap` is set to `true`, features with a higher sort key will overlap over features with a lower sort key.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{"doc-en":"Sorts symbols by `symbol-sort-key` if set. Otherwise, sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},"viewport-y":{"doc-en":"Sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},source:{"doc-en":"Sorts symbols by `symbol-sort-key` if set. Otherwise, no sorting is applied; symbols are rendered in the same order as the source data."}},default:"auto","doc-en":"Determines whether overlapping symbols in the same layer are rendered in the order that they appear in the data source or by their y-position relative to the viewport. To control the order and prioritization of symbols otherwise, use `symbol-sort-key`.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-height-key":{type:"string",default:"symbolHeight","property-type":"constant"},"symbol-height-offset":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-pick-color":{type:"boolean",default:!1,"doc-en":"If you want to query a symbol with height properties, set it true, otherwise the result won't be accurate. Set it to false when all symbols are rendered by zero height.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,"doc-en":"If true, the icon will be visible even if it collides with other previously drawn symbols.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,"doc-en":"If true, other symbols can be visible even if they collide with the icon.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,"doc-en":"If true, text will display without their corresponding icons when the icon collides with other symbols and the text does not.",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{"doc-en":"When `symbol-placement` is set to `point`, aligns icons east-west. When `symbol-placement` is set to `line` or `line-center`, aligns icon x-axes with the line."},viewport:{"doc-en":"Produces icons whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{"doc-en":"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto","doc-en":"In combination with `symbol-placement`, determines the rotation behavior of icons.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size","doc-en":"Scales the original size of the icon by the provided factor. The new pixel size of the image will be the original pixel size multiplied by `icon-size`. 1 is the original size; 3 triples the size of the image.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{"doc-en":"The icon is displayed at its intrinsic aspect ratio."},width:{"doc-en":"The icon is scaled in the x-dimension to fit the width of the text."},height:{"doc-en":"The icon is scaled in the y-dimension to fit the height of the text."},both:{"doc-en":"The icon is scaled in both x- and y-dimensions."}},default:"none","doc-en":"Scales the icon to fit around the associated text.",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels","doc-en":"Size of the additional area added to dimensions determined by `icon-text-fit`, in clockwise order: top, right, bottom, left.",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage","doc-en":"Name of image in sprite to use for drawing an image background.",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees","doc-en":"Rotates the icon clockwise.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels","doc-en":"Size of the additional area around the icon bounding box used for detecting symbol collisions.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,"doc-en":"If true, the icon may be flipped to prevent it from being rendered upside-down.",requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],"doc-en":"Offset distance of icon from its anchor. Positive values indicate right and down, while negative values indicate left and up. Each component is multiplied by the value of `icon-size` to obtain the final offset in pixels. When combined with `icon-rotate` the offset will be as if the rotated direction was up.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{"doc-en":"The center of the icon is placed closest to the anchor."},left:{"doc-en":"The left side of the icon is placed closest to the anchor."},right:{"doc-en":"The right side of the icon is placed closest to the anchor."},top:{"doc-en":"The top of the icon is placed closest to the anchor."},bottom:{"doc-en":"The bottom of the icon is placed closest to the anchor."},"top-left":{"doc-en":"The top left corner of the icon is placed closest to the anchor."},"top-right":{"doc-en":"The top right corner of the icon is placed closest to the anchor."},"bottom-left":{"doc-en":"The bottom left corner of the icon is placed closest to the anchor."},"bottom-right":{"doc-en":"The bottom right corner of the icon is placed closest to the anchor."}},default:"center","doc-en":"Part of the icon placed closest to the anchor.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{"doc-en":"The icon is aligned to the plane of the map."},viewport:{"doc-en":"The icon is aligned to the plane of the viewport."},auto:{"doc-en":"Automatically matches the value of `icon-rotation-alignment`."}},default:"auto","doc-en":"Orientation of icon when map is pitched.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{"doc-en":"The text is aligned to the plane of the map."},viewport:{"doc-en":"The text is aligned to the plane of the viewport."},auto:{"doc-en":"Automatically matches the value of `text-rotation-alignment`."}},default:"auto","doc-en":"Orientation of text when map is pitched.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{"doc-en":"When `symbol-placement` is set to `point`, aligns text east-west. When `symbol-placement` is set to `line` or `line-center`, aligns text x-axes with the line."},viewport:{"doc-en":"Produces glyphs whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{"doc-en":"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto","doc-en":"In combination with `symbol-placement`, determines the rotation behavior of the individual glyphs forming the text.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,"doc-en":"Value to use for a text label. If a plain `string` is provided, it will be treated as a `formatted` with default/inherited formatting options.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],"doc-en":"Font stack to use for displaying text.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems","doc-en":"The maximum line width for text wrapping.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems","doc-en":"Text leading value for multi-line text.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!0},"text-letter-spacing":{type:"number",default:0,units:"ems","doc-en":"Text tracking amount.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{left:{"doc-en":"The text is aligned to the left."},center:{"doc-en":"The text is centered."},right:{"doc-en":"The text is aligned to the right."}},default:"center","doc-en":"Text justification options.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-anchor":{type:"enum",values:{center:{"doc-en":"The center of the text is placed closest to the anchor."},left:{"doc-en":"The left side of the text is placed closest to the anchor."},right:{"doc-en":"The right side of the text is placed closest to the anchor."},top:{"doc-en":"The top of the text is placed closest to the anchor."},bottom:{"doc-en":"The bottom of the text is placed closest to the anchor."},"top-left":{"doc-en":"The top left corner of the text is placed closest to the anchor."},"top-right":{"doc-en":"The top right corner of the text is placed closest to the anchor."},"bottom-left":{"doc-en":"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{"doc-en":"The bottom right corner of the text is placed closest to the anchor."}},default:"center","doc-en":"Part of the text placed closest to the anchor.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees","doc-en":"Maximum angle change between adjacent characters.",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees","doc-en":"Rotates the text clockwise.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels","doc-en":"Size of the additional area around the text bounding box used for detecting symbol collisions.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,"doc-en":"If true, the text may be flipped vertically to prevent it from being rendered upside-down.",requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{"doc-en":"The text is not altered."},uppercase:{"doc-en":"Forces all letters to be displayed in uppercase."},lowercase:{"doc-en":"Forces all letters to be displayed in lowercase."}},default:"none","doc-en":"Specifies how to capitalize text, similar to the CSS `text-transform` property.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array","doc-en":"Offset distance of text from its anchor. Positive values indicate right and down, while negative values indicate left and up. If used with text-variable-anchor, input values will be taken as absolute values. Offsets along the x- and y-axis will be applied automatically based on the anchor position.",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,"doc-en":"If true, the text will be visible even if it collides with other previously drawn symbols.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,"doc-en":"If true, other symbols can be visible even if they collide with the text.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,"doc-en":"If true, icons will display without their corresponding text when the text collides with other symbols and the icon does not.",requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number","doc-en":"基于此值按升序对要素排序。具有较高排序键的功能将显示在具有较低排序键的功能上方。",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"},"display-mode":{type:"enum",values:{"2d":{"doc-en":"The layer is 2d."},"3d":{"doc-en":"The layer is 3d."}},default:"2d","doc-en":"Whether this layer is 2d or 3d.","property-type":"constant"}},layout_extrusion:{visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"}},layout_histogram:{visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"},"histogram-max-height-render":{type:"boolean",default:!1,"doc-en":"If true, histogram's height * 100",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"histogram-color-render":{type:"boolean",default:!1,"doc-en":"If true, histogram's color becomes a single histogram longitudinal difference value rendering, use the 'histogram-colors' attribute in paint to render",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},layout_dynamicLine:{"dynamicLine-cap":{type:"enum",values:{butt:{"doc-en":"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{"doc-en":"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},square:{"doc-en":"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},default:"butt","doc-en":"The display of dynamicLine endings.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"dynamicLine-join":{type:"enum",values:{bevel:{"doc-en":"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},round:{"doc-en":"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},miter:{"doc-en":"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter","doc-en":"The display of dynamicLine when joining.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"dynamicLine-miter-limit":{type:"number",default:2,"doc-en":"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"dynamicLine-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"dynamicLine-round-limit":{type:"number",default:1.05,"doc-en":"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"dynamicLine-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"dynamicLine-sort-key":{type:"number","doc-en":"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"}},layout_tracking:{"tracking-cap":{type:"enum",values:{butt:{"doc-en":"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{"doc-en":"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},square:{"doc-en":"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},default:"butt","doc-en":"The display of line endings.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"tracking-join":{type:"enum",values:{bevel:{"doc-en":"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},round:{"doc-en":"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},miter:{"doc-en":"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter","doc-en":"The display of lines when joining.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"tracking-miter-limit":{type:"number",default:2,"doc-en":"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"tracking-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"tracking-round-limit":{type:"number",default:1.05,"doc-en":"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"tracking-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"tracking-sort-key":{type:"number","doc-en":"暂不生效。基于此值按升序对要素排序。具有较高排序键的功能将显示在具有较低排序键的功能上方。",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"},"tracking-display-mode":{type:"enum",function:"piecewise-constant",values:{loop:{},reverse:{},"loop-reserve":{},"reverse-reserve":{}},default:"loop","property-type":"data-constant"}},"layout_3d-model":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_3d-tiles":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symtracking:{"symtracking-display-mode":{type:"enum",function:"piecewise-constant",values:{default:{},"time-sequence":{},timestamp:{}},default:"default","property-type":"data-constant"},"symtracking-time-segment":{type:"number",default:20,minimum:1,units:"second","property-type":"constant"},"symtracking-fps":{type:"number",default:1,minimum:1,"property-type":"constant"},"symtracking-sort-key":{type:"number","doc-en":"Sorts features in ascending order based on this value. Features with lower sort keys are drawn and placed first.  When `icon-allow-overlap` or `text-allow-overlap` is `false`, features with a lower sort key will have priority during placement. When `icon-allow-overlap` or `text-allow-overlap` is set to `true`, features with a higher sort key will overlap over features with a lower sort key.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symtracking-z-order":{type:"enum",values:{auto:{"doc-en":"Sorts symbols by `symbol-sort-key` if set. Otherwise, sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},"viewport-y":{"doc-en":"Sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},source:{"doc-en":"Sorts symbols by `symbol-sort-key` if set. Otherwise, no sorting is applied; symbols are rendered in the same order as the source data."}},default:"auto","doc-en":"Determines whether overlapping symbols in the same layer are rendered in the order that they appear in the data source or by their y-position relative to the viewport. To control the order and prioritization of symbols otherwise, use `symbol-sort-key`.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"compatible-mode":{type:"boolean",default:!0,"property-type":"constant"},"symbol-placement":{type:"enum",values:{point:{"doc-en":"The label is placed at the point where the geometry is located."},line:{"doc-en":"The label is placed along the line of the geometry. Can only be used on `LineString` and `Polygon` geometries."},"line-center":{"doc-en":"The label is placed at the center of the line of the geometry. Can only be used on `LineString` and `Polygon` geometries. Note that a single feature in a vector tile may contain multiple line geometries."}},default:"point","doc-en":"Label placement relative to its geometry.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels","doc-en":"Distance between two symbol anchors.",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,"doc-en":"If true, the symbols will not cross tile edges to avoid mutual collisions. Recommended in layers that don't have enough padding in the vector tile to prevent collisions, or if it is a point symbol layer placed after a line symbol layer. When using a client that supports global collision detection, like minemap GL JS version 0.42.0 or greater, enabling this property is not needed to prevent clipped labels at tile boundaries.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-allow-overlap":{type:"boolean",default:!1,"doc-en":"If true, the icon will be visible even if it collides with other previously drawn symbols.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-ignore-placement":{type:"boolean",default:!1,"doc-en":"If true, other symbols can be visible even if they collide with the icon.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-optional":{type:"boolean",default:!1,"doc-en":"If true, text will display without their corresponding icons when the icon collides with other symbols and the text does not.",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-rotation-alignment":{type:"enum",values:{map:{"doc-en":"When `symbol-placement` is set to `point`, aligns icons east-west. When `symbol-placement` is set to `line` or `line-center`, aligns icon x-axes with the line."},viewport:{"doc-en":"Produces icons whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{"doc-en":"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"map","doc-en":"In combination with `symbol-placement`, determines the rotation behavior of icons.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-size":{type:"number",default:1,minimum:0,units:"图标原始大小的倍数因子","units-en":"factor of the original icon size","doc-en":"Scales the original size of the icon by the provided factor. The new pixel size of the image will be the original pixel size multiplied by `icon-size`. 1 is the original size; 3 triples the size of the image.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{"doc-en":"The icon is displayed at its intrinsic aspect ratio."},width:{"doc-en":"The icon is scaled in the x-dimension to fit the width of the text."},height:{"doc-en":"The icon is scaled in the y-dimension to fit the height of the text."},both:{"doc-en":"The icon is scaled in both x- and y-dimensions."}},default:"none","doc-en":"Scales the icon to fit around the associated text.",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels","doc-en":"Size of the additional area added to dimensions determined by `icon-text-fit`, in clockwise order: top, right, bottom, left.",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-image":{type:"resolvedImage","doc-en":"Name of image in sprite to use for drawing an image background.",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees","doc-en":"Rotates the icon clockwise.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels","doc-en":"Size of the additional area around the icon bounding box used for detecting symbol collisions.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-keep-upright":{type:"boolean",default:!1,"doc-en":"If true, the icon may be flipped to prevent it from being rendered upside-down.",requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],"doc-en":"Offset distance of icon from its anchor. Positive values indicate right and down, while negative values indicate left and up. Each component is multiplied by the value of `icon-size` to obtain the final offset in pixels. When combined with `icon-rotate` the offset will be as if the rotated direction was up.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{"doc-en":"The center of the icon is placed closest to the anchor."},left:{"doc-en":"The left side of the icon is placed closest to the anchor."},right:{"doc-en":"The right side of the icon is placed closest to the anchor."},top:{"doc-en":"The top of the icon is placed closest to the anchor."},bottom:{"doc-en":"The bottom of the icon is placed closest to the anchor."},"top-left":{"doc-en":"The top left corner of the icon is placed closest to the anchor."},"top-right":{"doc-en":"The top right corner of the icon is placed closest to the anchor."},"bottom-left":{"doc-en":"The bottom left corner of the icon is placed closest to the anchor."},"bottom-right":{"doc-en":"The bottom right corner of the icon is placed closest to the anchor."}},default:"center","doc-en":"Part of the icon placed closest to the anchor.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"icon-pitch-alignment":{type:"enum",values:{map:{"doc-en":"The icon is aligned to the plane of the map."},viewport:{"doc-en":"The icon is aligned to the plane of the viewport."},auto:{"doc-en":"Automatically matches the value of `icon-rotation-alignment`."}},default:"auto","doc-en":"Orientation of icon when map is pitched.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-pitch-alignment":{type:"enum",values:{map:{"doc-en":"The text is aligned to the plane of the map."},viewport:{"doc-en":"The text is aligned to the plane of the viewport."},auto:{"doc-en":"Automatically matches the value of `text-rotation-alignment`."}},default:"auto","doc-en":"Orientation of text when map is pitched.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-rotation-alignment":{type:"enum",values:{map:{"doc-en":"When `symbol-placement` is set to `point`, aligns text east-west. When `symbol-placement` is set to `line` or `line-center`, aligns text x-axes with the line."},viewport:{"doc-en":"Produces glyphs whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{"doc-en":"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto","doc-en":"In combination with `symbol-placement`, determines the rotation behavior of the individual glyphs forming the text.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-field":{type:"string",default:"",tokens:!0,"doc-en":"Value to use for a text label.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],"doc-en":"Font stack to use for displaying text.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-size":{type:"number",default:16,minimum:0,units:"pixels","doc-en":"Font size.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-max-width":{type:"number",default:10,minimum:0,units:"ems","doc-en":"The maximum line width for text wrapping.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-line-height":{type:"number",default:1.2,units:"ems","doc-en":"Text leading value for multi-line text.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-letter-spacing":{type:"number",default:0,units:"ems","doc-en":"Text tracking amount.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-justify":{type:"enum",values:{left:{},center:{},right:{}},default:"center","doc-en":"Text justification options.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center","doc-en":"Part of the text placed closest to the anchor.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-max-angle":{type:"number",default:45,units:"degrees","doc-en":"Maximum angle change between adjacent characters.",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-rotate":{type:"number",default:0,period:360,units:"degrees","doc-en":"Rotates the text clockwise.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-padding":{type:"number",default:2,minimum:0,units:"pixels","doc-en":"Size of the additional area around the text bounding box used for detecting symbol collisions.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-keep-upright":{type:"boolean",default:!0,"doc-en":"If true, the text may be flipped vertically to prevent it from being rendered upside-down.",requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none","doc-en":"Specifies how to capitalize text, similar to the CSS `text-transform` property.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-offset":{type:"array","doc-en":"Offset distance of text from its anchor. Positive values indicate right and down, while negative values indicate left and up.",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-allow-overlap":{type:"boolean",default:!1,"doc-en":"If true, the text will be visible even if it collides with other previously drawn symbols.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-ignore-placement":{type:"boolean",default:!1,"doc-en":"If true, other symbols can be visible even if they collide with the text.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-optional":{type:"boolean",default:!1,"doc-en":"If true, icons will display without their corresponding text when the text collides with other symbols and the icon does not.",requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"}},filter:{type:"array",value:"*","doc-en":"A filter selects specific features from a layer."},filter_operator:{type:"enum",values:{"==":{},like:{},"!like":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},arrin:{},"!arrin":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{"doc-en":"Filter to point geometries."},LineString:{"doc-en":"Filter to line geometries."},Polygon:{"doc-en":"Filter to polygon geometries."}},"doc-en":"The geometry type for the filter to select."},function:{expression:{type:"expression","doc-en":"An expression."},stops:{type:"array","doc-en":"An array of stops.",value:"function_stop"},base:{type:"number",default:1,minimum:0,"doc-en":"The exponential base of the interpolation curve. It controls the rate at which the result increases. Higher values make the result increase more towards the high end of the range. With `1` the stops are interpolated linearly."},property:{type:"string","doc-en":"The name of a feature property to use as the function input.",default:"$zoom"},type:{type:"enum",values:{identity:{"doc-en":"Return the input value as the output value."},exponential:{"doc-en":"Generate an output by interpolating between stops just less than and just greater than the function input."},interval:{"doc-en":"Return the output value of the stop just less than the function input."},categorical:{"doc-en":"Return the output value of the stop equal to the function input."}},"doc-en":"The interpolation strategy to use in function evaluation.",default:"exponential"},colorSpace:{type:"enum",values:{rgb:{"doc-en":"Use the RGB color space to interpolate color values"},lab:{"doc-en":"Use the LAB color space to interpolate color values."},hcl:{"doc-en":"Use the HCL color space to interpolate color values, interpolating the Hue, Chroma, and Luminance channels individually."}},"doc-en":"The color space in which colors interpolated. Interpolating colors in perceptual color spaces like LAB and HCL tend to produce color ramps that look more consistent and produce colors that can be differentiated more easily than those interpolated in RGB space.",default:"rgb"},default:{type:"*",required:!1,"doc-en":"A value to serve as a fallback function result when a value isn't otherwise available. It is used in the following circumstances:\n* In categorical functions, when the feature value does not match any of the stop domain values.\n* In property and zoom-and-property functions, when a feature does not contain a value for the specified property.\n* In identity functions, when the feature value is not valid for the style property (for example, if the function is being used for a `circle-color` property but the feature property value is not a string or not a valid color).\n* In interval or exponential property and zoom-and-property functions, when the feature value is not numeric.\nIf no default is provided, the style property's default is used in these circumstances."}},function_stop:{type:"array",minimum:0,maximum:22,value:["number","color"],length:2,"doc-en":"Zoom level and value pair."},expression:{type:"array",value:"*",minimum:1,"doc-en":"An expression defines a function that can be used for data-driven style properties or feature filters."},paint:["paint_background","paint_fill","paint_line","paint_symbol","paint_circle","paint_heatmap","paint_raster","paint_extrusion","paint_histogram","paint_dynamicLine","paint_tracking","paint_sprite","paint_3d-model","paint_3d-tiles","paint_symtracking"],paint_background:{"background-color":{type:"color",default:"#000000","doc-en":"The color with which the background will be drawn.",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"string",transition:!0,"doc-en":"Name of image in sprite to use for drawing an image background. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-pattern-fixed":{type:"boolean",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,"doc-en":"The opacity at which the background will be drawn.",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-terrain-analysis":{type:"color","doc-en":"The color with which the slope or aspect of terrain will be drawn.",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_raster:{"raster-opacity":{type:"number","doc-en":"The opacity at which the image will be drawn.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees","doc-en":"Rotates hues around the color wheel.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number","doc-en":"Increase or reduce the brightness of the image. The value is the minimum brightness.",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number","doc-en":"Increase or reduce the brightness of the image. The value is the maximum brightness.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number","doc-en":"Increase or reduce the saturation of the image.",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number","doc-en":"Increase or reduce the contrast of the image.",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum","doc-en":"The resampling/interpolation method to use for overscaling, also known as texture magnification filter",values:{linear:{"doc-en":"(Bi)linear filtering interpolates pixel values using the weighted average of the four closest original source pixels creating a smooth but blurry look when overscaled"},nearest:{"doc-en":"Nearest neighbor filtering interpolates pixel values using the nearest original source pixel creating a sharp but pixelated look when overscaled"}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds","doc-en":"Fade duration when a new tile is added.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_fill:{"fill-antialias":{type:"boolean",default:!0,"doc-en":"Whether or not the fill should be antialiased.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,"doc-en":"The opacity of the entire fill layer. In contrast to the `fill-color`, this value will also affect the 1px stroke around the fill, if the stroke is used.",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-water-texture":{type:"string",default:"","doc-en":"Texture object url link","property-type":"data-constant",requires:[{"fill-water":"water"}]},"fill-water-speed":{type:"number",default:1,"doc-en":"The speed of water","property-type":"data-constant",requires:[{"fill-water":"water"}]},"fill-water-wave-size":{type:"number",default:1,"doc-en":"Describe the speed of water ripples","property-type":"data-constant",requires:[{"fill-water":"water"}]},"sunlight-color":{type:"color",default:"#76ca17","property-type":"data-constant",requires:[{"fill-water":"water"}]},"sunlight-direction":{type:"array",value:"number",length:3,default:[1,1.0349,-.0994],"property-type":"data-constant",requires:[{"fill-water":"water"}]},"sky-color":{type:"color",default:"#ffffff","property-type":"data-constant",requires:[{"fill-water":"water"}]},"fill-color":{type:"color",default:"#000000","doc-en":"The color of the filled part of this layer. This color can be specified as `rgba` with an alpha component and the color's opacity will not affect the opacity of the 1px stroke, if it is used.",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven",expose:!1},"fill-outline-color":{type:"color","doc-en":"The outline color of the fill. Matches the value of `fill-color` if unspecified.",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-driven",expose:!1},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},"doc-en":"Controls the frame of reference for `fill-translate`.",default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-driven"},"fill-pattern":{type:"resolvedImage",transition:!0,"doc-en":"Name of image in sprite to use for drawing image fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-water":{type:"string",default:"none","doc-en":"Whether it is water ripple","property-type":"data-constant"},"fill-dynamic-speed":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven",requires:[{"fill-water":"water"}]},"fill-dynamic-image-url":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded",requires:[{"fill-water":"water"}]},"fill-offset":{type:"array",value:"number",length:2,default:[0,0],units:"pixels","doc-en":"The offset of the fill pattern. Values are [x, y]","property-type":"data-driven",requires:["fill-pattern"]},"fill-rotation":{type:"number",default:0,units:"degrees","doc-en":"The rotation of the fill pattern in degrees counter-clockwise","property-type":"data-driven",requires:["fill-pattern"]},"fill-scale":{type:"number",default:1,"doc-en":"The scale of the fill pattern","property-type":"data-driven",requires:["fill-pattern"]}},paint_line:{"line-opacity":{type:"number","doc-en":"The opacity at which the line will be drawn.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color","doc-en":"The color with which the line will be drawn.",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-driven"},"line-translate-anchor":{type:"enum",values:{map:{"doc-en":"The line is translated relative to the map."},viewport:{"doc-en":"The line is translated relative to the viewport."}},"doc-en":"Controls the frame of reference for `line-translate`.",default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-driven"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels","doc-en":"Stroke thickness.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-width":{type:"number",default:0,minimum:0,function:"interpolated",transition:!0,units:"pixels","doc-en":"Border stroke thickness.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},requires:[{"!":"line-pattern"}],"property-type":"data-driven"},"line-border-opacity":{type:"number","doc-en":"The opacity at which the line border will be drawn.",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},default:1,minimum:0,maximum:1,transition:!0,requires:[{"!":"line-pattern"}],"property-type":"data-driven"},"line-border-color":{type:"color","doc-en":"The color with which the line border will be drawn.",default:"#000000",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},transition:!0,requires:[{"!":"line-pattern"}],"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,"doc-en":"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,"doc-en":"The line's offset. For linear features, a positive value offsets the line to the right, relative to the direction of the line, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.",transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Blur applied to the line, in pixels.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number","doc-en":"Specifies the lengths of the alternating dashes and gaps that form the dash pattern. The lengths are later scaled by the line width. To convert a dash length to pixels, multiply the length by the current line width. Note that GeoJSON sources with `lineMetrics: true` specified won't render dashed lines to the expected scale. Also note that zoom-dependent expressions will be evaluated only at integer zoom levels.",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,"doc-en":"Name of image in sprite to use for drawing image lines. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color","doc-en":'Defines a gradient with which to color a line feature. Can only be used with GeoJSON sources that specify `"lineMetrics": true`.',transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"},"half-render":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-normal-direction":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"}},paint_symbol:{"icon-opacity":{"doc-en":"The opacity at which the icon will be drawn.",type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,"doc-en":"The color of the icon. This can only be used with sdf icons.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,"doc-en":"The color of the icon's halo. Icon halos can only be used with SDF icons.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Distance of halo to the icon outline.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Fade out the halo towards the outside.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"Distance that the icon's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-driven"},"icon-translate-anchor":{type:"enum",values:{map:{"doc-en":"Icons are translated relative to the map."},viewport:{"doc-en":"Icons are translated relative to the viewport."}},"doc-en":"Controls the frame of reference for `icon-translate`.",default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number","doc-en":"The opacity at which the text will be drawn.",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color","doc-en":"The color with which the text will be drawn.",default:"#000000",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,"doc-en":"The color of the text's halo, which helps it stand out from backgrounds.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"The halo's fadeout distance towards the outside.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"Distance that the text's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-driven"},"text-translate-anchor":{type:"enum",values:{map:{"doc-en":"The text is translated relative to the map."},viewport:{"doc-en":"The text is translated relative to the viewport."}},"doc-en":"Controls the frame of reference for `text-translate`.",default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels","doc-en":"Circle radius.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000","doc-en":"The fill color of the circle.",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,"doc-en":"Amount to blur the circle. 1 blurs the circle such that only the centerpoint is full opacity.",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number","doc-en":"The opacity at which the circle will be drawn.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{"doc-en":"The circle is translated relative to the map."},viewport:{"doc-en":"The circle is translated relative to the viewport."}},"doc-en":"Controls the frame of reference for `circle-translate`.",default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{"doc-en":"Circles are scaled according to their apparent distance to the camera."},viewport:{"doc-en":"Circles are not scaled."}},default:"map","doc-en":"Controls the scaling behavior of the circle when the map is pitched.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{"doc-en":"The circle is aligned to the plane of the map."},viewport:{"doc-en":"The circle is aligned to the plane of the viewport."}},default:"viewport","doc-en":"Orientation of circle when map is pitched.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"The width of the circle's stroke. Strokes are placed outside of the `circle-radius`.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000","doc-en":"The stroke color of the circle.",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number","doc-en":"The opacity of the circle's stroke.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-height":{type:"number",default:0,minimum:0,expression:{interpolated:!1,parameters:["zoom","feature","feature-state"]},"property-type":"constant"},"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels","doc-en":"Radius of influence of one heatmap point in pixels. Increasing the value makes the heatmap smoother, but less detailed.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,"doc-en":"A measure of how much an individual point contributes to the heatmap. A value of 10 would be equivalent to having 10 points of weight 1 in the same spot. Especially useful when combined with clustering.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,"doc-en":"Similar to `heatmap-weight` but controls the intensity of the heatmap globally. Primarily used for adjusting the heatmap based on zoom level.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],"doc-en":'Defines the color of each pixel based on its density value in a heatmap.  Should be an expression that uses `["heatmap-density"]` as input.',transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number","doc-en":"The global opacity at which the heatmap layer will be drawn.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-height-factor":{type:"number",default:100,minimum:0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-driven"}},paint_extrusion:{"extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,"doc-en":"The opacity of the entire fill extrusion layer. This is rendered on a per-layer, not per-feature, basis, and data-driven styling is not available.",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-driven"},"extrusion-color":{type:"color",default:"#000000","doc-en":"The base color of the extruded fill. The extrusion's surfaces will be shaded differently based on this color in combination with the root `light` settings.",transition:!0,requires:[{"!":"extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-driven"},"extrusion-translate-anchor":{type:"enum",values:{map:{"doc-en":"The fill-extrusion is translated relative to the map."},viewport:{"doc-en":"The fill-extrusion is translated relative to the viewport."}},"doc-en":"Controls the frame of reference for `extrusion-translate`.",default:"map",requires:["extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-driven"},"extrusion-pattern":{type:"resolvedImage",transition:!0,"doc-en":"Name of image in sprite to use for drawing images on extruded fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"extrusion-top-pattern":{type:"resolvedImage",transition:!1,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"extrusion-height":{type:"number",default:0,minimum:0,units:"meters","doc-en":"The height with which to extrude this layer.",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"extrusion-base":{type:"number",default:0,minimum:0,units:"meters","doc-en":"The height with which to extrude the base of this layer. Must be less than or equal to `extrusion-height`.",transition:!0,requires:["extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"extrusion-pattern-factor":{type:"array",value:"number",length:2,"property-type":"constant"},"extrusion-self-bloom":{type:"boolean",default:!1,"doc-en":"The  extrude  layer generate bloom by oneself.","property-type":"data-constant"},"extrusion-bloom-height":{type:"number",default:!1,"doc-en":"Maximum height of self illumination of building white mode","property-type":"data-constant"},"extrusion-glow-pure-color-height":{type:"number",default:.4,"doc-en":"building white mold height to control the building white mold gradient range.","property-type":"data-constant"},"extrusion-glow-width":{type:"number",default:.005,"doc-en":"width of building white mold refresh strip.","property-type":"data-constant"},"extrusion-glow-speed":{type:"number",default:12,"doc-en":"speed of building white strip refresh.","property-type":"data-constant"},"extrusion-roughness":{type:"number",default:0,minimum:0,maximum:1,"doc-en":"The roughness of the building white mold","property-type":"data-constant"},"extrusion-offset":{type:"array",value:"number",length:2,default:[0,0],units:"pixels","doc-en":"The offset of the extrusion pattern. Values are [x, y]","property-type":"data-driven"},"extrusion-rotation":{type:"number",default:0,units:"degrees","doc-en":"The rotation of the extrusion pattern","property-type":"data-driven"},"extrusion-scale":{type:"number",default:1,"doc-en":"The scale of the extrusion pattern","property-type":"data-driven"}},paint_histogram:{"histogram-opacity":{type:"number",default:1,minimum:0,maximum:1,"doc-en":"The opacity of the entire fill histogram layer. This is rendered on a per-layer, not per-feature, basis, and data-driven styling is not available.",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"histogram-color":{type:"color",default:"#000000","doc-en":"The base color of the extruded fill. The histogram's surfaces will be shaded differently based on this color in combination with the root `light` settings. If this color is specified as `rgba` with an alpha component, the alpha component will be ignored; use `extrusion-opacity` to set layer opacity.",transition:!0,requires:[{"!":"extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"histogram-colors":{type:"array",value:"string",length:5,default:["#ffc1e0","#bbffff","#00e3e3","#005757","#ea0000"],requires:[{"!":"histogram-color-render"}],"doc-en":"Histogram segmented color, this parameter has effect only when histogram-color-render is enabled.","property-type":"data-constant"},"histogram-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"The geometry's offset. Values are [x, y] where negatives indicate left and up (on the flat plane), respectively.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"histogram-translate-anchor":{type:"enum",values:{map:{},viewport:{}},"doc-en":"Controls the frame of reference for `extrusion-translate`.",default:"map",requires:["extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"histogram-height":{type:"number",default:0,minimum:0,units:"meters","doc-en":"The height with which to extrude this layer.",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"histogram-base":{type:"number",default:0,minimum:0,units:"meters","doc-en":"The height with which to extrude the base of this layer. Must be less than or equal to `extrusion-height`.",transition:!0,requires:["extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"histogram-vertical-gradient":{type:"boolean",default:!0,"doc-en":"Whether to apply a vertical gradient to the sides of a histogram layer. If true, sides will be shaded slightly darker farther down.",transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"histogram-dynamic":{type:"boolean",default:!1,"doc-en":"Whether to perform dynamic up and down rendering",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},expose:!1,"property-type":"data-constant"},"histogram-heightArr1":{type:"color",default:[0,0,0,0],"doc-en":"The first trajectory of dynamic histogram",transition:!0,units:"x-color",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},expose:!1,"property-type":"data-driven"},"histogram-heightArr2":{type:"color",default:[0,0,0,0],"doc-en":"The second trajectory of dynamic histogram",transition:!0,units:"x-color",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},expose:!1,"property-type":"data-driven"},"histogram-heightArr3":{type:"color",default:[0,0,0,0],"doc-en":"The third trajectory of dynamic histogram",transition:!0,units:"x-color",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},expose:!1,"property-type":"data-driven"},"histogram-speed":{type:"number","doc-en":"The speed of dynamic up and down rendering",default:1,minimum:1,maximum:1e3,transition:!0,"property-type":"data-constant"},"histogram-count":{type:"number",default:12,"doc-en":"The count of dynamic up and down rendering",minimum:1,maximum:12,units:"millisecond",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"histogram-max-height":{type:"number",default:200,minimum:0,units:"meters","doc-en":"The maximum height of the histogram, 'only effective when' histogram-color-render 'is turned on, When this value is identical with 'histostore-height', the column will be equally divided into 4 sections of colors from bottom to top according to the colors specified by 'histostore-colors'","property-type":"data-constant"},"depth-change":{type:"boolean",default:!1,transition:!0,"doc-en":"Turn on or off the transparency gradient from top to bottom",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-constant"}},paint_dynamicLine:{"dynamicLine-opacity":{type:"number","doc-en":"The opacity at which the dynamicLine will be drawn.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"dynamicLine-color":{type:"color","doc-en":"The color with which the dynamicLine will be drawn.",default:"#000000",transition:!0,requires:[{"!":"dynamicLine-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"dynamicLine-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels","doc-en":"Stroke thickness.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"dynamicLine-gap-width":{type:"number",default:0,minimum:0,"doc-en":"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven",expose:!1},"dynamicLine-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Blur applied to the line, in pixels.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"dynamicLine-seg-group":{type:"number","doc-en":"The number of displayed segments of the dynamicLine. When the value is 1, the dynamicLine displays only one segment. The larger the value, the more segments the dynamicLine displays",default:20,minimum:1,maximum:600,"property-type":"constant"},"dynamicLine-speed":{type:"number","doc-en":"The moving speed of dynamicLines, the higher the value, the faster the speed",default:1,minimum:1,maximum:500,"property-type":"constant"}},paint_tracking:{"tracking-opacity":{type:"number","doc-en":"The opacity at which the line will be drawn.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-color":{type:"color","doc-en":"The color with which the line will be drawn.",default:"#000000",transition:!0,requires:[{"!":"tracking-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"tracking-translate-anchor":{type:"enum",values:{map:{"doc-en":"The line is translated relative to the map."},viewport:{"doc-en":"The line is translated relative to the viewport."}},"doc-en":"Controls the frame of reference for `tracking-translate`.",default:"map",requires:["tracking-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"tracking-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels","doc-en":"Stroke thickness.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-gap-width":{type:"number",default:0,minimum:0,"doc-en":"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-offset":{type:"number",default:0,"doc-en":"The line's offset. For linear features, a positive value offsets the line to the right, relative to the direction of the line, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.",transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Blur applied to the line, in pixels.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-type":{type:"enum",function:"piecewise-constant",values:["real-time","history","trips"],default:"real-time","property-type":"constant"},"tracking-run-time":{type:"number",default:0,minimum:0,"property-type":"constant"},"tracking-seg-count":{type:"number",function:"interpolated",default:700,minimum:0,maximum:1e4,transition:!0,"property-type":"constant"},"tracking-seg-group":{type:"number",function:"interpolated",default:20,minimum:1,maximum:600,transition:!0,"property-type":"constant"},"tracking-speed":{type:"number",function:"interpolated",default:1,minimum:1,maximum:500,transition:!0,"property-type":"constant"},"tracking-delay":{type:"number",default:20,minimum:0,maximum:120,transition:!0,"property-type":"constant"},"tracking-speed-factor":{type:"number",default:1,minimum:0,function:"interpolated",transition:!0,units:"pixels","property-type":"constant"}},paint_sprite:{"sprite-opacity":{type:"number","doc-en":"The opacity at which the line will be drawn.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-color":{type:"color","doc-en":"The color with which the line will be drawn.",default:"#000000",transition:!0,requires:[{"!":"sprite-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-driven"},"sprite-translate-anchor":{type:"enum",values:{map:{"doc-en":"The line is translated relative to the map."},viewport:{"doc-en":"The line is translated relative to the viewport."}},"doc-en":"Controls the frame of reference for `sprite-translate`.",default:"map",requires:["sprite-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-driven"},"sprite-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels","doc-en":"Stroke thickness.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-gap-width":{type:"number",default:0,minimum:0,"doc-en":"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-offset":{type:"number",default:0,"doc-en":"The line's offset. For linear features, a positive value offsets the line to the right, relative to the direction of the line, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.",transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Blur applied to the line, in pixels.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-speed-factor":{type:"number",default:1,minimum:1,maximum:4,transition:!0,"doc-en":"Play speed factor of sprite.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-speed":{type:"number","doc-en":"Play speed of sprite.",default:60,minimum:1e-6,maximum:2e3,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-pattern":{type:"resolvedImage",transition:!0,"doc-en":"Name of image in sprite to use for drawing image lines. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"sprite-move-direction":{type:"number","doc-en":"The direction of Sprite when playing, the number 2 represents the starting point to the end point of road data, and the number 3 represents the starting point to the end point of road data",default:2,minimum:0,maximum:10,transition:!0,requires:["sprite-pattern"],expression:{interpolated:!1,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-interpolate":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"},"sprite-status":{type:"number",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},default:1,minimum:1,maximum:5,transition:!0,"property-type":"data-driven"},"sprite-instatus":{type:"number",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},default:1,minimum:1,maximum:5,transition:!0,"property-type":"data-driven"}},"paint_3d-model":{"3d-model-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},"paint_3d-tiles":{"point-cloud-color":{type:"color","doc-en":"The color with which the point cloud will be drawn.",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_symtracking:{"icon-opacity":{"doc-en":"The opacity at which the icon will be drawn.",type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,"doc-en":"The color of the icon. This can only be used with sdf icons.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,"doc-en":"The color of the icon's halo. Icon halos can only be used with SDF icons.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Distance of halo to the icon outline.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Fade out the halo towards the outside.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"Distance that the icon's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-translate-anchor":{type:"enum",values:{map:{"doc-en":"Icons are translated relative to the map."},viewport:{"doc-en":"Icons are translated relative to the viewport."}},"doc-en":"Controls the frame of reference for `icon-translate`.",default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-opacity":{type:"number","doc-en":"The opacity at which the text will be drawn.",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven",expose:!1},"text-color":{type:"color","doc-en":"The color with which the text will be drawn.",default:"#000000",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven",expose:!1},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,"doc-en":"The color of the text's halo, which helps it stand out from backgrounds.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven",expose:!1},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven",expose:!1},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"The halo's fadeout distance towards the outside.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven",expose:!1},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"Distance that the text's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-translate-anchor":{type:"enum",values:{map:{"doc-en":"The text is translated relative to the map."},viewport:{"doc-en":"The text is translated relative to the viewport."}},"doc-en":"Controls the frame of reference for `text-translate`.",default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"symtracking-delay":{type:"number",default:10,minimum:0,maximum:120,"doc-en":"Motion icon update delay, which is the cycle interval time. If the value is 0, there is no interval for the animation cycle. If it is 5, the interval between animation cycles will be 5 seconds.","property-type":"constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds","doc-en":"Time allotted for transitions to complete."},delay:{type:"number",default:0,minimum:0,units:"milliseconds","doc-en":"Length of time before a transition begins."}},"property-type":{"data-driven":{type:"property-type","doc-en":"Property is interpolable and can be represented using a property expression."},"cross-faded":{type:"property-type","doc-en":"Property is non-interpolable; rather, its values will be cross-faded to smoothly transition between integer zooms."},"cross-faded-data-driven":{type:"property-type","doc-en":"Property is non-interpolable; rather, its values will be cross-faded to smoothly transition between integer zooms. It can be represented using a property expression."},"color-ramp":{type:"property-type","doc-en":"Property should be specified using a color ramp from which the output color can be sampled based on a property calculation."},"data-constant":{type:"property-type","doc-en":"Property is interpolable but cannot be represented using a property expression."},constant:{type:"property-type","doc-en":"Property is constant across all zoom levels and property values."}},promoteId:{"*":{type:"string"}}};const Dg=new Ip({"symbol-placement":new Sp(Og.layout_symbol["symbol-placement"]),"symbol-spacing":new Sp(Og.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Sp(Og.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ap(Og.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Sp(Og.layout_symbol["symbol-z-order"]),"symbol-height-key":new Sp(Og.layout_symbol["symbol-height-key"]),"symbol-height-offset":new Ap(Og.layout_symbol["symbol-height-offset"]),"symbol-pick-color":new Sp(Og.layout_symbol["symbol-pick-color"]),"icon-allow-overlap":new Sp(Og.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Sp(Og.layout_symbol["icon-ignore-placement"]),"icon-optional":new Sp(Og.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Sp(Og.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ap(Og.layout_symbol["icon-size"]),"icon-text-fit":new Sp(Og.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Sp(Og.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ap(Og.layout_symbol["icon-image"]),"icon-rotate":new Ap(Og.layout_symbol["icon-rotate"]),"icon-padding":new Sp(Og.layout_symbol["icon-padding"]),"icon-keep-upright":new Sp(Og.layout_symbol["icon-keep-upright"]),"icon-offset":new Ap(Og.layout_symbol["icon-offset"]),"icon-anchor":new Ap(Og.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Sp(Og.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Sp(Og.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Sp(Og.layout_symbol["text-rotation-alignment"]),"text-field":new Ap(Og.layout_symbol["text-field"]),"text-font":new Ap(Og.layout_symbol["text-font"]),"text-size":new Ap(Og.layout_symbol["text-size"]),"text-max-width":new Ap(Og.layout_symbol["text-max-width"]),"text-line-height":new Sp(Og.layout_symbol["text-line-height"]),"text-letter-spacing":new Ap(Og.layout_symbol["text-letter-spacing"]),"text-justify":new Ap(Og.layout_symbol["text-justify"]),"text-anchor":new Ap(Og.layout_symbol["text-anchor"]),"text-max-angle":new Sp(Og.layout_symbol["text-max-angle"]),"text-rotate":new Ap(Og.layout_symbol["text-rotate"]),"text-padding":new Sp(Og.layout_symbol["text-padding"]),"text-keep-upright":new Sp(Og.layout_symbol["text-keep-upright"]),"text-transform":new Ap(Og.layout_symbol["text-transform"]),"text-offset":new Ap(Og.layout_symbol["text-offset"]),"text-allow-overlap":new Sp(Og.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Sp(Og.layout_symbol["text-ignore-placement"]),"text-optional":new Sp(Og.layout_symbol["text-optional"])});var Fg={paint:new Ip({"icon-opacity":new Ap(Og.paint_symbol["icon-opacity"]),"icon-color":new Ap(Og.paint_symbol["icon-color"]),"icon-halo-color":new Ap(Og.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ap(Og.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ap(Og.paint_symbol["icon-halo-blur"]),"icon-translate":new Ap(Og.paint_symbol["icon-translate"]),"icon-translate-anchor":new Sp(Og.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ap(Og.paint_symbol["text-opacity"]),"text-color":new Ap(Og.paint_symbol["text-color"]),"text-halo-color":new Ap(Og.paint_symbol["text-halo-color"]),"text-halo-width":new Ap(Og.paint_symbol["text-halo-width"]),"text-halo-blur":new Ap(Og.paint_symbol["text-halo-blur"]),"text-translate":new Ap(Og.paint_symbol["text-translate"]),"text-translate-anchor":new Sp(Og.paint_symbol["text-translate-anchor"])}),layout:Dg};const zg=gi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_offset",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_extra",components:3,type:"Uint16"}]),Bg=gi([{name:"a_CARTESIAN",components:3,type:"Float32"},{name:"a_projected_pos",components:3,type:"Float32"}],4);gi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Vg=gi([{name:"a_placed",components:2,type:"Uint8"}],4);gi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]);const Ug=gi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),kg=gi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);gi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"hidden"}]),gi([{type:"Float32",name:"offsetX"}]),gi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Gg=bg.VectorTileFeature.types,Hg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Yg(e,t,i,n,r,o,a,s,l,c){e.emplaceBack(t.x,t.y,t.z,Math.round(32*i),Math.round(32*n),r,o,a?a[0]:0,a?a[1]:0,s,l,c||0);}class qg{constructor(e){this.layoutVertexArray=new Ca,this.indexArray=new Ia,this.programConfigurations=e,this.segments=new Ud,this.dynamicLayoutVertexArray=new ra,this.opacityVertexArray=new va,this.placedSymbolArray=new za;}upload(e,t,i,n){i&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Bg.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Hg,!0),this.opacityVertexBuffer.itemSize=1),(i||n)&&this.programConfigurations.upload(e);}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy());}}Ho("SphereSymtrackingBuffers",qg);class Xg{constructor(e,t,i){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new i,this.segments=new Ud,this.collisionVertexArray=new Ta;}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Vg.members,!0);}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy());}}Ho("SphereSymtrackingCollisionBuffers",Xg);class jg{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasRTLText=!1,this.glyphQuadsArray=[],this.symbolHeightsArray=[],this.type=Ag.SYMTRACKING;const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ng(this.zoom,t["text-size"]),this.iconSizeData=ng(this.zoom,t["icon-size"]);const i=this.layers[0].layout;this.sortFeaturesByY=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sourceID=e.sourceID,this.projection=e.projection||ci.MERCATOR;}createArrays(){this.text=new qg(new tf(zg.members,this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new qg(new tf(zg.members,this.layers,this.zoom,(e=>/^icon/.test(e)))),this.collisionBox=new Xg(Ea,Ug.members,Na),this.collisionCircle=new Xg(Ea,kg.members,Ia),this.glyphOffsetArray=new Va,this.lineVertexArray=new ka;}calculateGlyphDependencies(e,t,i,n){for(let r=0;r<e.length;r++)if(t[e.charCodeAt(r)]=!0,i&&n){const i=Pg[e.charAt(r)];i&&(t[i.charCodeAt(0)]=!0);}}populate(e,t,i){this.baseP||(this.x=t.x,this.y=t.y,this.z=t.z,this.zPow=Math.pow(2,this.z),this.baseP=Tl(this.x,this.y,this.z,this.projection),this.matrix=bl(this.baseP));const n=this.layers[0],r=n.layout,o=r.get("text-font"),a=r.get("text-field"),s=r.get("icon-image"),l=("constant"!==a.value.kind||a.value.value.toString().length>0)&&("constant"!==o.value.kind||o.value.value.length>0),c="constant"!==s.value.kind||s.value.value&&s.value.value.length>0;if(this.features=[],!l&&!c)return;const u=t.iconDependencies,h=t.glyphDependencies,d=t.availableImages,p=new _p(this.zoom);for(const{feature:t,index:a,sourceLayerIndex:s}of e){if(!n._featureFilter(p,t))continue;let e,f;if(l){const r=n.getValueAndResolveTokens("text-field",t,i,d),o=mn.factory(r);o.containsRTLText()&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===pp()||this.hasRTLText&&mp.isParsed())&&(e=pg(o,n,t));}if(c){const e=n.getValueAndResolveTokens("icon-image",t,i,d);f=e instanceof _n?e:_n.fromString(e);}if(!e&&!f)continue;const m={text:e,icon:f,index:a,sourceLayerIndex:s,geometry:_g(t),properties:t.properties,type:Gg[t.type]};if(void 0!==t.id&&(m.id=t.id),this.features.push(m),f&&f instanceof _n&&(u[f.name]=!0),e){const i=o.evaluate(t,{}).join(","),n=h[i]=h[i]||{},a="map"===r.get("text-rotation-alignment")&&"point"!==r.get("symbol-placement");if(e instanceof mn)for(const t of e.sections){const n=sn(e.toString()),r=t.fontStack||i,o=h[r]=h[r]||{};this.calculateGlyphDependencies(t.text,o,a,n);}else {const t=sn(e);this.calculateGlyphDependencies(e,n,a,t);}}}"line"===r.get("symbol-placement")&&(this.features=fg(this.features));}update(e,t){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers));}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return !this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){this.uploaded||(this.collisionBox.upload(e),this.collisionCircle.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0;}destroy(){this.text.destroy(),this.icon.destroy(),this.collisionBox.destroy(),this.collisionCircle.destroy();}addToLineVertexArray(e,t){const i=this.lineVertexArray.length;if(void 0!==e.segment){let i=e.dist(t[e.segment+1]),n=e.dist(t[e.segment]);const r={};for(let n=e.segment+1;n<t.length;n++)r[n]={x:t[n].x,y:t[n].y,tileUnitDistanceFromAnchor:i},n<t.length-1&&(i+=t[n+1].dist(t[n]));for(let i=e.segment||0;i>=0;i--)r[i]={x:t[i].x,y:t[i].y,tileUnitDistanceFromAnchor:n},i>0&&(n+=t[i-1].dist(t[i]));for(let e=0;e<t.length;e++){const t=r[e];this.lineVertexArray.emplaceBack(t.x,t.y,t.tileUnitDistanceFromAnchor);}}return {lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(e,t,i,n,r,o,a,s,l,c,u){const h=e.indexArray,d=e.layoutVertexArray,p=e.dynamicLayoutVertexArray,f=e.segments.prepareSegment(4*t.length,e.layoutVertexArray,e.indexArray),m=this.glyphOffsetArray.length,_=f.vertexLength;for(const e of t){const t=e.tl,n=e.tr,r=e.bl,a=e.br,l=e.tex,c=f.vertexLength,u=e.glyphOffset[1],m=this.calcTDSpacePoint(s.x,s.y),_=o.properties;let g,y,x;_.hasOwnProperty("link_seq")?(g=_.link_seq,y=_.link_total||0,x=0):_.hasOwnProperty("link_time")&&(g=_.link_time%1e4,y=_.link_time_before%1e4,x=_.link_time_end%1e4,this.timestampExtraData||(this.timestampExtraData={total_time_end:_.total_time_end%1e4,total_time_start:_.total_time_start%1e4})),Yg(d,m,t.x,u+t.y,l.x,l.y,i,g,y,x),Yg(d,m,n.x,u+n.y,l.x+l.w,l.y,i,g,y,x),Yg(d,m,r.x,u+r.y,l.x,l.y+l.h,i,g,y,x),Yg(d,m,a.x,u+a.y,l.x+l.w,l.y+l.h,i,g,y,x);const v=[[32*t.x,32*(u+t.y)],[32*n.x,32*(u+n.y)],[32*r.x,32*(u+r.y)],[32*a.x,32*(u+a.y)]];Ig(p,s,0,s,1,[this.x,this.y,this.z],v,this.projection,this.z,this.baseP,0),h.emplaceBack(c,c+1,c+2),h.emplaceBack(c+1,c+2,c+3),f.vertexLength+=4,f.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(e.glyphOffset[0]),this.glyphQuadsArray.push(v),this.symbolHeightsArray.push(0);}e.placedSymbolArray.emplaceBack(s.x,s.y,m,this.glyphOffsetArray.length-m,_,l,c,s.segment,i?i[0]:0,i?i[1]:0,n[0],n[1],a,!1),e.programConfigurations.populatePaintArrays(e.layoutVertexArray.length,o,o.index,{},u);}_addCollisionDebugVertex(e,t,i,n,r){return t.emplaceBack(0,0),e.emplaceBack(i.x,i.y,i.z,n.x,n.y,Math.round(r.x),Math.round(r.y))}addCollisionDebugVertices(e,t,i,n,r,o,a,s){const l=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),c=l.vertexLength,u=r.layoutVertexArray,h=r.collisionVertexArray,d=this.calcTDSpacePoint(o.x,o.y);if(this._addCollisionDebugVertex(u,h,d,a.anchor,new te(e,t)),this._addCollisionDebugVertex(u,h,d,a.anchor,new te(i,t)),this._addCollisionDebugVertex(u,h,d,a.anchor,new te(i,n)),this._addCollisionDebugVertex(u,h,d,a.anchor,new te(e,n)),l.vertexLength+=4,s){const e=r.indexArray;e.emplaceBack(c,c+1,c+2),e.emplaceBack(c,c+2,c+3),l.primitiveLength+=2;}else {const e=r.indexArray;e.emplaceBack(c,c+1),e.emplaceBack(c+1,c+2),e.emplaceBack(c+2,c+3),e.emplaceBack(c+3,c),l.primitiveLength+=4;}}generateCollisionDebugBuffers(){for(const e of this.symbolInstances){e.textCollisionFeature={boxStartIndex:e.textBoxStartIndex,boxEndIndex:e.textBoxEndIndex},e.iconCollisionFeature={boxStartIndex:e.iconBoxStartIndex,boxEndIndex:e.iconBoxEndIndex};for(let t=0;t<2;t++){const i=e[0===t?"textCollisionFeature":"iconCollisionFeature"];if(i)for(let t=i.boxStartIndex;t<i.boxEndIndex;t++){const i=this.collisionBoxArray.get(t),n=i.radius>0;this.addCollisionDebugVertices(i.x1,i.y1,i.x2,i.y2,n?this.collisionCircle:this.collisionBox,i.anchorPoint,e,n);}}}}deserializeCollisionBoxes(e,t,i,n,r){const o={};for(let n=t;n<i;n++){const t=e.get(n);if(0===t.radius){o.textBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,anchorPointX:t.anchorPointX,anchorPointY:t.anchorPointY},o.textFeatureIndex=t.featureIndex;break}o.textCircles||(o.textCircles=[],o.textFeatureIndex=t.featureIndex),o.textCircles.push(t.anchorPointX,t.anchorPointY,t.radius,t.signedDistanceFromAnchor,1);}for(let t=n;t<r;t++){const i=e.get(t);if(0===i.radius){o.iconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},o.iconFeatureIndex=i.featureIndex;break}}return o}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasCollisionBoxData(){return this.collisionBox.segments.get().length>0}hasCollisionCircleData(){return this.collisionCircle.segments.get().length>0}sortFeatures(e){if(!this.sortFeaturesByY)return;if(this.sortedAngle===e)return;if(this.sortedAngle=e,this.text.segments.get().length>1||this.icon.segments.get().length>1)return;const t=[];for(let e=0;e<this.symbolInstances.length;e++)t.push(e);const i=Math.sin(e),n=Math.cos(e);t.sort(((e,t)=>{const r=this.symbolInstances[e],o=this.symbolInstances[t];return (0|Math.round(i*r.anchor.x+n*r.anchor.y))-(0|Math.round(i*o.anchor.x+n*o.anchor.y))||o.featureIndex-r.featureIndex})),this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of t){const t=this.symbolInstances[e];this.featureSortOrder.push(t.featureIndex);for(const e of t.placedTextSymbolIndices){const t=this.text.placedSymbolArray.get(e),i=t.vertexStartIndex+4*t.numGlyphs;for(let e=t.vertexStartIndex;e<i;e+=4)this.text.indexArray.emplaceBack(e,e+1,e+2),this.text.indexArray.emplaceBack(e+1,e+2,e+3);}const i=this.icon.placedSymbolArray.get(e);if(i.numGlyphs){const e=i.vertexStartIndex;this.icon.indexArray.emplaceBack(e,e+1,e+2),this.icon.indexArray.emplaceBack(e+1,e+2,e+3);}}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray);}calcTDSpacePoint(e,t){const i=wl(this.x+e/8192,this.y+t/8192,this.zPow,this.projection),n=lc.cartographicToCartesian3([i[0],i[1],0]);return new te(n[0]-this.baseP[0],n[1]-this.baseP[1],n[2]-this.baseP[2])}}Ho("SymtrackingBucket",jg,{omit:["layers","collisionBoxArray","features","compareText"],shallow:["symbolInstances","matrix"]}),jg.addDynamicAttributes=Ig;const Wg={horizontal:1,vertical:2,horizontalOnly:3};class $g{constructor(){this.text="",this.sectionIndex=[],this.sections=[];}static fromFeature(e,t){const i=new $g;if(e instanceof mn)for(let n=0;n<e.sections.length;n++){const r=e.sections[n];i.sections.push({scale:r.scale||1,fontStack:r.fontStack||t}),i.text+=r.text;for(let e=0;e<r.text.length;e++)i.sectionIndex.push(n);}else {i.text=e,i.sections.push({scale:1,fontStack:t});for(let t=0;t<e.length;t++)i.sectionIndex.push(0);}return i}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let t="";for(let i=0;i<e.length;i++){const n=e.charCodeAt(i+1)||null,r=e.charCodeAt(i-1)||null;t+=n&&un(n)&&!Pg[e[i+1]]||r&&un(r)&&!Pg[e[i-1]]||!Pg[e[i]]?e[i]:Pg[e[i]];}return t}(this.text);}trim(){let e=0;for(let t=0;t<this.text.length&&Kg[this.text.charCodeAt(t)];t++)e++;let t=this.text.length;for(let i=this.text.length-1;i>=0&&i>=e&&Kg[this.text.charCodeAt(i)];i--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t);}substring(e,t){const i=new $g;return i.text=this.text.substring(e,t),i.sectionIndex=this.sectionIndex.slice(e,t),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}}function Zg(e,t){const i=[],n=e.text;let r=0;for(const n of t)i.push(e.substring(r,n)),r=n;return r<n.length&&i.push(e.substring(r,n.length)),i}const Kg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Qg={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Jg(e,t,i,n){const r=Math.pow(e-t,2);return n?e<t?r/2:2*r:r+Math.abs(i)*i}function ey(e,t){let i=0;return 10===e&&(i-=1e4),40!==e&&65288!==e||(i+=50),41!==t&&65289!==t||(i+=50),i}function ty(e,t,i,n,r,o){let a=null,s=Jg(t,i,r,o);for(const e of n){const n=Jg(t-e.x,i,r,o)+e.badness;n<=s&&(a=e,s=n);}return {index:e,x:t,priorBreak:a,badness:s}}function iy(e){return e?iy(e.priorBreak).concat(e.index):[]}function ny(e,t,i,n){if(!i)return [];if(!e)return [];const r=[],o=function(e,t,i,n){let r=0;for(let i=0;i<e.length();i++){const o=e.getSection(i),a=n[o.fontStack],s=a&&a[e.getCharCode(i)];s&&(r+=s.metrics.advance*o.scale+t);}return r/Math.max(1,Math.ceil(r/i))}(e,t,i,n);let a=0;for(let i=0;i<e.length();i++){const l=e.getSection(i),c=e.getCharCode(i),u=n[l.fontStack],h=u&&u[c];h&&!Kg[c]&&(a+=h.metrics.advance*l.scale+t),i<e.length()-1&&(Qg[c]||!((s=c)<11904)&&(an["Bopomofo Extended"](s)||an.Bopomofo(s)||an["CJK Compatibility Forms"](s)||an["CJK Compatibility Ideographs"](s)||an["CJK Compatibility"](s)||an["CJK Radicals Supplement"](s)||an["CJK Strokes"](s)||an["CJK Symbols and Punctuation"](s)||an["CJK Unified Ideographs Extension A"](s)||an["CJK Unified Ideographs"](s)||an["Enclosed CJK Letters and Months"](s)||an["Halfwidth and Fullwidth Forms"](s)||an.Hiragana(s)||an["Ideographic Description Characters"](s)||an["Kangxi Radicals"](s)||an["Katakana Phonetic Extensions"](s)||an.Katakana(s)||an["Vertical Forms"](s)||an["Yi Radicals"](s)||an["Yi Syllables"](s)))&&r.push(ty(i+1,a,o,r,ey(c,e.getCharCode(i+1)),!1));}var s;return iy(ty(e.length(),a,o,r,0,!0))}function ry(e){let t=.5,i=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0;}switch(e){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0;}return {horizontalAlign:t,verticalAlign:i}}function oy(e,t,i,n,r){if(!r)return;const o=e[n],a=t[o.fontStack],s=a&&a[o.glyph];if(s){const t=(e[n].x+s.metrics.advance*o.scale)*r;for(let r=i;r<=n;r++)e[r].x-=t;}}const ay=Fg.layout;function sy(e,t,i,n,r){const o=new Ot;return t?(o.scale([1/r,1/r,1]),i||o.rotateZ(-n.getMapViewParams().bearing*nt.TRANSFORM.DEG_TO_RAD)):(o.scale([n.width/2,-n.height/2,1]),o.translate([1,-1,0]),o.multiplyRight(e)),o}function ly(e,t){const i=[e.x,e.y,0,1];gy(i,i,t);const n=i[3];return {point:new te(i[0]/n,i[1]/n),signedDistanceFromCamera:n}}function cy(e,t){const i=e[0]/e[3],n=e[1]/e[3];return i>=-t[0]&&i<=t[0]&&n>=-t[1]&&n<=t[1]}function uy(e,t,i,n,r,o,a,s,l,c,u,h){const d=s.glyphStartIndex+s.numGlyphs,p=s.lineStartIndex,f=s.lineStartIndex+s.lineLength,m=t.getoffsetX(s.glyphStartIndex),_=t.getoffsetX(d-1),g=fy(e*m,i,n,r,o,a,s.segment,p,f,l,c,u,h);if(!g)return null;const y=fy(e*_,i,n,r,o,a,s.segment,p,f,l,c,u,h);return y?{first:g,last:y}:null}function hy(e,t,i,n){return e===Wg.horizontal&&Math.abs(i.y-t.y)>Math.abs(i.x-t.x)*n?{useVertical:!0}:(e===Wg.vertical?t.y<i.y:t.x>i.x)?{needsFlipping:!0}:null}function dy(e,t,i,n,r,o,a,s,l,c,u,h,d,p,f,m,_,g,y){const x=t/24,v=e.lineOffsetX*t,w=e.lineOffsetY*t,T=[],b=[];let P;if(e.numGlyphs>1){const t=e.glyphStartIndex+e.numGlyphs,r=e.lineStartIndex,c=e.lineStartIndex+e.lineLength,f=uy(x,s,v,w,i,u,h,e,l,o,d,!1);if(!f)return {notEnoughRoom:!0};const m=ly(f.first.point,a).point,g=ly(f.last.point,a).point;if(n&&!i){const t=hy(e.writingMode,m,g,p);if(t)return t}P=[f.first],T.push(_[e.glyphStartIndex]),b.push(y[e.glyphStartIndex]);for(let n=e.glyphStartIndex+1;n<t-1;n++)P.push(fy(x*s.getoffsetX(n),v,w,i,u,h,e.segment,r,c,l,o,d,!1)),T.push(_[n]),b.push(y[n]);P.push(f.last),T.push(_[t-1]),b.push(y[t-1]);}else {if(n&&!i){const t=ly(h,r).point,i=e.lineStartIndex+e.segment+1,n=new te(l.getx(i),l.gety(i)),o=ly(n,r),a=o.signedDistanceFromCamera>0?o.point:py(h,n,t,1,r),s=hy(e.writingMode,t,a,p);if(s)return s}const t=fy(x*s.getoffsetX(e.glyphStartIndex),v,w,i,u,h,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,l,o,d,!1);if(!t)return {notEnoughRoom:!0};P=[t],T.push(_[e.glyphStartIndex]),b.push(y[e.glyphStartIndex]);}for(let e=0;e<P.length;e++){const i=P[e];Ig(c,i.point,i.angle,i.anchorPoint,t/15/f.height*822,m,T[e],f.projection,f.zoom,f.cameraHeightConvertedZoom,g,b[e]);}return {}}function py(e,t,i,n,r){const o=ly(e.add(e.sub(t)._unit()),r).point,a=i.sub(o);return i.add(a._mult(n/a.mag()))}function fy(e,t,i,n,r,o,a,s,l,c,u,h,d){const p=n?e-t:e+t;let f=p>0?1:-1,m=0;n&&(f*=-1,m=Math.PI),f<0&&(m+=Math.PI);let _=f>0?s+a:s+a+1;const g=_;let y=r,x=r,v=0,w=0;const T=Math.abs(p);for(;v+w<=T;){if(_+=f,_<s||_>=l)return null;if(x=y,y=h[_],void 0===y){const e=new te(c.getx(_),c.gety(_)),t=ly(e,u);if(t.signedDistanceFromCamera>0)y=h[_]=t.point;else {const t=_-f;y=py(0===v?o:new te(c.getx(t),c.gety(t)),e,x,T-v+1,u);}}v+=w,w=x.dist(y);}const b=(T-v)/w,P=y.sub(x),S=P.mult(b)._add(x);return S._add(P._unit()._perp()._mult(i*f)),{point:S,angle:m+Math.atan2(y.y-x.y,y.x-x.x),anchorPoint:r,tileDistance:d?{prevTileDistance:_-f===g?0:c.gettileUnitDistanceFromAnchor(_-f),lastSegmentViewportDistance:T-v}:null}}const my=new Float64Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function _y(e,t){for(let i=0;i<e;i++){const e=t.length;t.resize(e+4),t.float32.set(my,6*e);}}function gy(e,t,i){const n=t[0],r=t[1];return e[0]=i[0]*n+i[4]*r+i[12],e[1]=i[1]*n+i[5]*r+i[13],e[3]=i[3]*n+i[7]*r+i[15],e}const yy=Fg.layout,xy=new It,vy=new It,wy=new It;class Ty extends N_{tile=void 0;constructor(e){super(e),this.layer=e.layer,this.tile=e.tile,this.coord=e.tile.tileID,this._programConfiguration=e.programConfiguration,this._renderState=e.renderState,this.type=e.type,this.isText=e.isText,this.isSDF=e.isSDF,this.modeNum=e.modeNum,this.sizeData=e.sizeData,this.bucket=e.bucket,this.ishalo=!1,this.hasHalo=e.hasHalo,this.size=void 0,this.defines={SYM_TRACKING:"symtracking"===this.layer.type},this._createUniforms(e.painter);}updateDepthTest(){this.renderState.depthTest={enabled:this.layer.depthTest,func:hc.LESS};}update(e,t,i={}){super.update(e,t,i),this._updateDynamicUniform(e),this.updateDepthTest();}_createUniforms(e){this._uniforms.set("u_GlUnitsToPixels",(()=>(xy.set(e.style.symbolMatrixHelper.width/2,-e.style.symbolMatrixHelper.height/2),xy))),this.pushMinimumUniform("u_GlUnitsToPixels"),this._uniforms.set("u_pitch_with_map",(()=>this.isText?"map"==this.layer.layout.get("text-pitch-alignment"):"map"==this.layer.layout.get("icon-pitch-alignment"))),this.pushMinimumUniform("u_pitch_with_map"),this._uniforms.set("u_is_text",(()=>this.isText)),this.pushMinimumUniform("u_is_text"),this._uniforms.set("u_pitch",(()=>e.style.symbolMatrixHelper.getMapViewParams().pitch*nt.TRANSFORM.DEG_TO_RAD)),this.pushMinimumUniform("u_pitch"),this._uniforms.set("u_is_size_zoom_constant",(()=>"constant"===this.sizeData.functionType||"source"===this.sizeData.functionType)),this.pushMinimumUniform("u_is_size_zoom_constant"),this._uniforms.set("u_is_size_feature_constant",(()=>"constant"===this.sizeData.functionType||"camera"===this.sizeData.functionType)),this.pushMinimumUniform("u_is_size_feature_constant"),this._uniforms.set("u_camera_to_center_distance",(()=>e.style.symbolMatrixHelper.cameraToCenterDistance)),this._uniforms.set("u_aspect_ratio",(()=>e.style.symbolMatrixHelper.width/e.style.symbolMatrixHelper.height)),this._uniforms.set("u_rotate_symbol",(()=>{const e="map"===this.layer.layout.get("icon-rotation-alignment"),t="map"===this.layer.layout.get("icon-pitch-alignment"),i=e&&"point"!==this.layer.layout.get("symbol-placement");return e&&!t&&!i})),this.pushMinimumUniform("u_rotate_symbol"),this._uniforms.set("u_rotate_with_map",(()=>this.isText?"map"==this.layer.layout.get("text-rotation-alignment"):"map"==this.layer.layout.get("icon-rotation-alignment"))),this.pushMinimumUniform("u_rotate_with_map"),this.isText?(this._uniforms.set("u_BaseColorSampler",(()=>(this.tile.glyphAtlasTexture?.bind(hc.LINEAR,hc.CLAMP_TO_EDGE),this.tile.glyphAtlasTexture))),this._uniforms.set("u_texsize",(()=>{const e=this.tile.glyphAtlasTexture.size;return vy.set(e[0],e[1]),vy}))):(this._uniforms.set("u_BaseColorSampler",(()=>{const t=e.style.symbolMatrixHelper.getMapViewParams().pitch*nt.TRANSFORM.DEG_TO_RAD,i=1!==this.layer.layout.get("icon-size").constantOr(0)||this.bucket.iconsNeedLinear,n="map"===this.layer.layout.get("icon-pitch-alignment")||0!==t;return this.tile.imageAtlasTexture.bind(this.isSDF||e.options.rotating||e.options.zooming||i||n?hc.LINEAR:hc.NEAREST,hc.CLAMP_TO_EDGE),this.tile.imageAtlasTexture})),this._uniforms.set("u_texsize",(()=>{const e=this.tile.imageAtlasTexture.size;return vy.set(e[0],e[1]),vy}))),this.pushMinimumUniform("u_BaseColorSampler"),this.pushMinimumUniform("u_texsize"),this._uniforms.set("u_fade_change",(()=>e.options.fadeDuration?e.symbolFadeChange:1)),this.pushMinimumUniform("u_fade_change"),this._uniforms.set("u_is_halo",(()=>this.ishalo)),this.pushMinimumUniform("u_is_halo"),"symtracking"===this.layer.type&&(2==this.modeNum&&(this._uniforms.set("u_timestamp_se",(()=>{const e=this.bucket.timestampExtraData;return wy.set(e.total_time_start,e.total_time_end),wy})),this.pushMinimumUniform("u_timestamp_se")),this._uniforms.set("u_seq",(()=>this.layer._count?this.layer._count:0)),this.pushMinimumUniform("u_seq"),this._uniforms.set("u_display_mode",(()=>this.modeNum)),this.pushMinimumUniform("u_display_mode"));}_updateLineLabels(e){const t=this.isText?"map"==this.layer.layout.get("text-rotation-alignment"):"map"==this.layer.layout.get("icon-rotation-alignment"),i=ig(this.tile,1,e.style.symbolMatrixHelper.zoom),n=e.style.symbolMatrixHelper.calculatePosMatrix(this.tile.tileID.toUnwrapped()),r=sy(n,!0,t,e.style.symbolMatrixHelper,i),o=function(e,t,i,n,r){const o=new Ot;return o.multiplyRight(e),o.scale([r,r,1]),i||o.rotateZ(n.getMapViewParams().bearing*nt.TRANSFORM.DEG_TO_RAD),o}(n,0,t,e.style.symbolMatrixHelper,i);!function(e,t,i,n,r,o,a,s){const l=n?e.textSizeData:e.iconSizeData,c=og(l,i.style.getNearestTileZoom(),ay&&ay.properties&&ay.properties[n?"text-size":"icon-size"]),u=[256/i.width*2+1,256/i.height*2+1],h=n?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;h.clear();const d=e.lineVertexArray,p=n?e.text.placedSymbolArray:e.icon.placedSymbolArray,f=e.glyphQuadsArray,m=e.symbolHeightsArray,_=i.style.symbolMatrixHelper.width/i.style.symbolMatrixHelper.height;let g=!1;for(let n=0;n<p.length;n++){const a=p.get(n);if(a.hidden||a.writingMode===Wg.vertical&&!g){_y(a.numGlyphs,h);continue}g=!1;const y=new wt([a.anchorX,a.anchorY,0,1]);if(y.transform(t),!cy(y,u)){_y(a.numGlyphs,h);continue}const x=rg(l,c,a),v=new te(a.anchorX,a.anchorY),w=ly(v,r).point,T={},b=dy(a,x,!1,s,t,r,o,e.glyphOffsetArray,d,h,w,v,T,_,i.style.symbolMatrixHelper,[e.x,e.y,e.z],f,e.baseP,m);g=b.useVertical,(b.notEnoughRoom||g||b.needsFlipping&&dy(a,x,!0,s,t,r,o,e.glyphOffsetArray,d,h,w,v,T,_,i.style.symbolMatrixHelper,[e.x,e.y,e.z],f,e.baseP,m).notEnoughRoom)&&_y(a.numGlyphs,h);}n?e.text.dynamicLayoutVertexBuffer.updateData(h):e.icon.dynamicLayoutVertexBuffer.updateData(h);}(this.bucket,n,e,this.isText,r,o,0,this.layer.layout.get(this.isText?"text-keep-upright":"icon-keep-upright"));}_updateDynamicUniform(e){const t="map"===this.layer.layout.get("text-rotation-alignment")&&"point"!==this.layer.layout.get("symbol-placement"),i="map"===this.layer.layout.get("icon-rotation-alignment")&&"point"!==this.layer.layout.get("symbol-placement");this.isText?t&&this._updateLineLabels(e):i&&this._updateLineLabels(e),this._uniforms.set("u_along_line",(()=>this.isText?t:i)),this.pushMinimumUniform("u_along_line"),this.size=og(this.sizeData,e.style.symbolMatrixHelper.zoom,yy.properties[this.isText?"text-size":"icon-size"]),void 0!==this.size.uSizeT&&(this._uniforms.set("u_size_t",(()=>this.size.uSizeT)),this.pushMinimumUniform("u_size_t")),void 0!==this.size.uSize&&(this._uniforms.set("u_size",(()=>this.size.uSize)),this.pushMinimumUniform("u_size"));}destroy(){super.destroy(),this.tile=void 0,this.coord=void 0,this._programConfiguration=void 0,this.isText=void 0,this.isSDF=void 0,this.modeNum=void 0,this.sizeData=void 0,this.bucket=void 0;}static updateSymtrackingLayerProperty(e,t,i){const n=e.layout.get("symtracking-display-mode");if(n===rt.SYMTRACKING_DISPLAY_MODE.DEFAULT){e._count=e._count?e._count:0,void 0===e.first&&(e.first=!0),e.startOffset=e.startOffset?e.startOffset:0,e.preFps=e.preFps?e.preFps:0,e.fpsDifference=e.fpsDifference?e.fpsDifference:0,e.fpsOffset=e.fpsOffset?e.fpsOffset:0,e.totalFpsOffset=e.totalFpsOffset?e.totalFpsOffset:0;const i=e.layout.get("symtracking-fps"),n=e.layout.get("symtracking-time-segment");e.offset=e.paint.get("symtracking-delay");const r=i*(n+e.offset);e.first&&(e.startOffset=t._map.timer.totalTime*i,e.first=!1,e.fpsFirst=i);const o=t._map.timer.totalTime;e.preFps&&e.preFps!==e.layout.get("symtracking-fps")&&(e.fpsDifference=e.layout.get("symtracking-fps")-e.preFps,e.fpsOffset=o*e.fpsDifference,e.totalFpsOffset+=e.fpsOffset),e.preFps=i,e._count=Math.round(o*i-e.startOffset-e.totalFpsOffset),e._count%=r;}let r=0;return n===rt.SYMTRACKING_DISPLAY_MODE.DEFAULT?r=0:n===rt.SYMTRACKING_DISPLAY_MODE.SEQUENCE?(r=1,e._count=Ty.calcSymTrackingInterval(i.getSource()._timestamp)):(r=2,e._count=Ty.calcSymTrackingTimeStamp(i.getSource()._timestamp)),r}static calcSymTrackingInterval(e){let t=(Date.now()-e)/1e3;return t>1?t=1:t<0&&(t=0),t}static calcSymTrackingTimeStamp(e){return Date.now()-e}}class by extends dl{constructor(e){super(),e.modelMatrix=Z(e.modelMatrix,new Ot),$(e.id)&&(this.customId=e.id),this.id=Z(e.id,Ue()),this.name=Z(e.name,void 0),this.skinsIndex=Z(e.skinsIndex,void 0),this.keepGeometryWhenFree=e.keepGeometryWhenFree,this._geometry=Z(e.geometry,void 0),this._material=Z(e.material,void 0),this.framebuffer=Z(e.framebuffer,void 0),this.properties=Z(e.properties,void 0),this.castShadow=Z(e.castShadow,void 0),this.receiveShadow=Z(e.receiveShadow,void 0),this.clearStates=Z(e.clearStates,void 0),this.nextShadowVolumePrimitiveIDs=[],this.usedVideoProjection=Z(e.usedVideoProjection,!1),this._adaptTerrain=Z(e.adaptTerrain,!1),this._classificationType=Z(e.classificationType,Zd.NONE),this.classificationType=this._adaptTerrain||this._geometry.adaptTerrain?Zd.ALL:e.classificationType||Zd.NONE,this._rootId=null,this.pickId=void 0,this._owner=Z(e.owner,void 0),this.allowPick=Z(e.allowPick,void 0),this._show=Z(e.show,!0),this._visible=Z(e.visible,!0),this.state=Kh.UNPROCESSING,this._filterPassIds=[],this._oldMatrixWorld=this.matrixWorld.clone(),this.ready=!1,this.animationPropertyCollection=new Eh,this._isPrimitive=!0,e.allowPick&&(this._owner=this._geometry),this._modelInstanceCollection=void 0,e.positions?(this.positions=e.positions,this.modelInstanceCollection=new Ah({instances:Ah.generateInstanceModelMatrix({positions:e.positions})})):(this.applyMatrix(e.modelMatrix),this.updateMatrixWorld(!0),this._modelMatrix=e.modelMatrix),this.particleSystemInstanceCollection=void 0,Z(e.particleSystem,void 0)&&(this.particleSystemInstanceCollection=new B_),e.adaptTerrain&&(this._geometry instanceof tp||this._geometry instanceof tg)&&(this._geometry.setAdaptTerrain(e.adaptTerrain),this._material.defines={SHADOW_VOLUME:e.adaptTerrain});const t=this.matrix.clone(),i=this.position.clone(),n=lc.eastNorthUpToFixedFrame(i.clone()).invert();this.originalRotationScaleMatrix=t.multiplyLeft(n);}updateMatrixWorld(e){super.updateMatrixWorld(e),this.computeBounding();}setMatrix(e){e instanceof Ot&&(this.matrixAutoUpdate&&this.updateMatrix(),this.matrix=e,this.matrix.decompose(this.position,this.quaternion,this.scale),this.updateMatrixWorld(!0),this._modelMatrix=e);}computeBounding(){this._geometry&&this._geometry.boundingSphere&&(this._geometry.isTileGeometryType?(this.boundingSphere=Zc.clone(this._geometry.boundingSphere),this.boundingBox=gu.clone(this._geometry.boundingBox)):(this.boundingSphere=this._geometry.boundingSphere.clone().transform(this.matrixWorld),this.boundingBox=this._geometry.boundingBox.clone().transform(this.matrixWorld)),this.boundingVolume=gu.clone(this.boundingBox));}get filterPassIds(){return this._filterPassIds}set filterPassIds(e){for(let t=0;t<e.length;t++){for(let i=0;i<this._filterPassIds.length&&e[t]!==this._filterPassIds[i];i++);this._filterPassIds.push(e);}}get modelInstanceCollection(){return this._modelInstanceCollection}set modelInstanceCollection(e){this._modelInstanceCollection=e;}get adaptTerrain(){return this._adaptTerrain}set adaptTerrain(e){e!==this._adaptTerrain&&(this._adaptTerrain=e,(this._geometry instanceof tp||this._geometry instanceof tg)&&(this._geometry.setAdaptTerrain(e),this._material.defines={SHADOW_VOLUME:e})),this._adaptTerrain?this.classificationType=Zd.ALL:this.classificationType===Zd.ALL&&(this.classificationType=Zd.NONE);}set classificationType(e){this._classificationType!==e&&(this._classificationType=e,(this._geometry instanceof tp||this._geometry instanceof tg)&&(this.adaptTerrain=e===Zd.ALL));}get classificationType(){return this._classificationType}get color(){return this._material?.baseColor}set color(e){if(e&&"string"!=typeof e)this._material.baseColor.set(e[0],e[1],e[2],e[3]);else {const t=Di.parse(e);this._material.baseColor.set(t.r,t.g,t.b,t.a);}}get show(){return this._show}set show(e){this._show=e,this._visible=e;}get visible(){return this._visible}set visible(e){this._visible=e,this._show=e;}set rootId(e){this._rootId=e;}get rootId(){return this._rootId}get owner(){return this._owner}set owner(e){this._owner=e;}get geometry(){return this._geometry}get material(){return this._material}set material(e){this._material=e;}update(e,t,i={}){if(!this.show)return;this.pickId||!this.allowPick||this._material instanceof Ty||(this.pickId=e.context.createPickId(this)),i.primitive=this;const n={};this.owner?.extra?.batchTable?.update(e,t);const r=t.overrideMaterial||this._material;if(void 0!==t.overrideMaterial)r.update(e,t,i);else {if(this._geometry._usedDoublePrecision&&(n.DOUBLEPRECISION=!0),this._adaptTerrain&&"PolygonGeometry"===this._geometry.type&&(this._geometry._needUpdate||!r._batchTable)){this._geometry.getDataComputeUV();const t=this._geometry.attributes,i=new sh(e.context,t,1);let n,o;for(let e=0;e<t.length-1;++e)n=t[e].name,o=t[e].batchTableAttributeIndex,i.setBatchedAttribute(0,o,this._geometry[n]);i.update(e.context),r._batchTable=i;}r.update(e,t,i);}const o=$(this._geometry)&&!!this._geometry._needUpdate;if(this._geometry.update({painter:e,adaptTerrain:this._adaptTerrain}),o&&this.computeBounding(),this.animationModelInstanceCollection)this.animationModelInstanceCollection.update({context:e.context}),this.setInstanceProperties();else if(this.particleSystemInstanceCollection&&this.particleSystemInstanceCollection._particleNum){n.INSTANCE_MATRIX=!0,n.PARTICLSYSTEM=!0,this.particleSystemInstanceCollection.update({context:e.context}),this._geometry._segmentVector.destroy();const t=new Ud;t.pushSegment({isInstance:!0,indicesCount:this._geometry.indices.length,instanceCount:this.particleSystemInstanceCollection._particleNum}),this._geometry._segmentVector=t,this._geometry.instanceVerterBuffers=this.particleSystemInstanceCollection._insatnceBuffer;}if(this._geometry.state===Kh.PROCESSINGFISH&&r.state===Kh.PROCESSINGFISH&&(this.ready=!0),"PolylineGeometry"===this._geometry.type&&this._geometry._ready){const e=t.camera.directionWC.clone();this._geometry.boundingSphere.computePlaneDistances(t.camera.position,e,r._interval);}r.defines=n;}render(e,t,i){if(!this.show||!this.ready)return;if(!this.allowPick&&i.overrideMaterial instanceof D_)return;let n=!!i.overrideMaterial;if(i.overrideMaterial instanceof D_&&this._material instanceof Ty){n=!1;const e=t.classificationType===Zd.FORCE_VECTOR_OVER_MODEL,i=!!$(t["depth-test"])&&t["depth-test"];this._material.openPickColor(!!e||!i);}else i.overrideMaterial instanceof D_&&"pointCollection"===this._geometry.type?(n=!1,this._material.openPickColor(!0)):this._geometry._usedDoublePrecision&&(i.overrideMaterial instanceof F_||i.overrideMaterial instanceof z_||i.overrideMaterial instanceof D_)?i.overrideMaterial.defines={DOUBLEPRECISION:!0}:!this._geometry._usedDoublePrecision&&(i.overrideMaterial instanceof F_||i.overrideMaterial instanceof z_||i.overrideMaterial instanceof D_)&&(i.overrideMaterial.defines={DOUBLEPRECISION:!1});e.SSRState&&this._material._enableSSR&&this.setEnableSSRParameter(e),e.context.draw({painter:e,layer:t,frameState:i,framebuffer:this.framebuffer?this.framebuffer:i.framebuffer?.framebuffer,clearStates:this.clearStates,clearColorDepth:this.clearColorDepth,geometry:this._geometry,material:n?i.overrideMaterial:this._material}),i.overrideMaterial instanceof D_&&(this._material instanceof Ty||"pointCollection"===this._geometry.type)&&this._material.closePickColor(),e.SSRState&&this._material._enableSSR&&this.setDisableSSRParameter();}setEnableSSRParameter(e){this._material._colorTexture=e.colorTexture,this._material._normalTexture=e.normalTexture,this._material._depthTexture=e.depthTexture,this._material.SSRState=!0,this._material.defines={EnableSSR:!0};}setDisableSSRParameter(){this._material.SSRState=!1,this._material.defines={EnableSSR:!1};}afterRender(e){Le(e)&&e();}updateAnimation(e){if(this.animationPropertyCollection&&this.animationPropertyCollection.size>0){const t=this.animationPropertyCollection.getAll();1===t.length?t[0].updateAnimation(this,e):console.warn(`id为"${this.id}"的primitive轨迹动画只能有1个`);}}setInstanceProperties(){let e;this._material.defines={INSTANCE_MATRIX:!0},e=this.animationModelInstanceCollection._particleNum?this.animationModelInstanceCollection._particleNum:this.animationModelInstanceCollection._instances.size,this._geometry._segmentVector&&this._geometry._segmentVector.destroy();const t=new Ud;t.pushSegment({isInstance:!0,indicesCount:this._geometry.indices.length,instanceCount:e}),this._geometry._segmentVector=t,this._geometry.dynamicLayoutBuffer1=this.animationModelInstanceCollection?.instanceBuffer;}serialize(){if($(this.name)&&(-1!==this.name.indexOf("debugVideo_")||-1!==this.name.indexOf("excavationBody")||-1!==this.name.indexOf("excavationBottom")))return;const e={geometry:this._geometry.serialize(),material:this._material.serialize()};return Ot.equals(this._modelMatrix,Ot.IDENTITY)||(e.modelMatrix=this._modelMatrix),$(this.customId)&&(e.id=this.customId),$(e.geometry)?e:void 0}destroy(){return this.keepGeometryWhenFree||this?._geometry?.destroy(),this?._material?.destroy(),this._material=null,this._geometry=null,this.framebuffer=void 0,this.nextShadowVolumePrimitiveIDs=[],this.clearStates=void 0,this.receiveShadow=!1,this.castShadow=!1,this._owner=null,this.pickId&&this.pickId.destroy(),this.modelInstanceCollection&&this.modelInstanceCollection.destroy(),this.animationModelInstanceCollection&&this.animationModelInstanceCollection.destroy(),this.particleSystemInstanceCollection&&this.particleSystemInstanceCollection.destroy(),this.animationPropertyCollection=void 0,this._isPrimitive=void 0,this.pickId=null,uc(this)}}class Py{constructor(e){if(!$(e.position))throw new Error("options.position is required.");if(!$(e.normal))throw new Error("options.normal is required.");this._origin=e.position,this._originModelMatrix=lc.eastNorthUpToFixedFrame(this._origin),this._relativeDistance=Z(e.distance,0),this._relativeNormal=ft.normalize(new ft(e.normal),new ft),this.setReferenceCenter(this._originModelMatrix),this.onChangeCallback=void 0,this.index=-1;}get position(){return this._origin}set position(e){e instanceof ft&&($(this.onChangeCallback)&&!ft.equals(this._origin,e)&&this.onChangeCallback(this.index),this._origin=e,this._originModelMatrix=lc.eastNorthUpToFixedFrame(this._origin),this._update());}get distance(){return this._distance}set distance(e){Qe(e)&&($(this.onChangeCallback)&&e!==this._distance&&this.onChangeCallback(this.index),this._relativeDistance=e,this._distance=this._absoluteDistance+this._relativeDistance);}get normal(){return this._normal}set normal(e){if(e instanceof ft){const t=ft.normalize(new ft(e),new ft);$(this.onChangeCallback)&&!ft.equals(this._normal,t)&&this.onChangeCallback(this.index),this._relativeNormal=t,this._update();}}static fromPlane(e,t){if(!(e instanceof ja))throw new Error("plane type must be Plane!");return $(t)?(t.normal=e.normal,t.distance=e.distance):t=new Py(e.normal,e.distance),t}static clone(e,t){return $(t)?(t.normal=e.normal,t.distance=e.distance,t.position=e.position,t):new Py({normal:e.normal,distance:e.distance,position:e.position})}setReferenceCenter(e){this._modelMatrix=e.clone(),this._update();}_update(){let e=new wt(this._relativeNormal[0],this._relativeNormal[1],this._relativeNormal[2],1);const t=new Ot;Ot.inverse(this._modelMatrix,t);const i=new Ot;t.multiplyRight(this._originModelMatrix,i),Ot.multiplyByVector(i,e,e),e=new ft(e[0],e[1],e[2]),ft.subtract(e,new ft(i.getTranslation()),e),this._normal=ft.normalize(e,new ft);const n=new wt(0,0,0,1);Ot.multiplyByVector(i,n,n),this._absoluteDistance=ft.dot(new ft(-n[0],-n[1],-n[2]),this._normal),this._distance=this._absoluteDistance+this._relativeDistance;}serialize(){return {position:ft.pack(this.position,new Array(3)),normal:ft.pack(this._relativeNormal,new Array(3)),distance:this._relativeDistance}}}function Sy(e,t){if(!e)throw new Error(`math.gl assertion failed. ${t}`)}const Ay=1/256;new It;const Ey=new ft;new It;const Cy=new It,My=new Uint8Array(1);function Iy(e){return My[0]=e,My[0]}function Ly(e,t=255){return l(e,0,t)/t*2-1}function Ny(e,t=255){return Math.round((.5*l(e,-1,1)+.5)*t)}function Ry(e){return e<0?-1:1}function Oy(e,t,i){const n=e._uint8View,r=e._planes;let o=0;for(let e=t;e<i;++e){const t=r[e],i=(a=t.normal,s=new wt,function(e,t,i){Sy(e),Sy(i);const n=Ey.from(e);if(Sy(Math.abs(n.magnitudeSquared()-1)<=nt.TRANSFORM.EPSILON6),i.x=e.x/(Math.abs(e.x)+Math.abs(e.y)+Math.abs(e.z)),i.y=e.y/(Math.abs(e.x)+Math.abs(e.y)+Math.abs(e.z)),e.z<0){const e=i.x,t=i.y;i.x=(1-Math.abs(t))*Ry(e),i.y=(1-Math.abs(e))*Ry(t);}i.x=Ny(i.x,65535),i.y=Ny(i.y,65535);}(a,0,Cy),s.x=Iy(Cy.x*Ay),s.y=Iy(Cy.x),s.z=Iy(Cy.y*Ay),s.w=Iy(Cy.y),s);n[o]=i.x,n[o+1]=i.y,n[o+2]=i.z,n[o+3]=i.w;const l=wt.packFloat(t.distance,new wt);n[o+4]=l.x,n[o+5]=l.y,n[o+6]=l.z,n[o+7]=l.w,o+=8;}var a,s;}function Dy(e,t,i){const n=e._float32View,r=e._planes;let o=0;for(let e=t;e<i;++e){const t=r[e],i=t.normal;n[o]=i.x,n[o+1]=i.y,n[o+2]=i.z,n[o+3]=t.distance,o+=4;}}function Fy(e,t){return t.x=Math.min(e,vu.maximumTextureSize),t.y=Math.ceil(e/t.x),t}function zy(e,t){e._multipleDirtyPlanes=e._multipleDirtyPlanes||-1!==e._dirtyIndex&&e._dirtyIndex!==t,e._dirtyIndex=t;}function By(e,t){const i=e.length;for(let n=0;n<i;++n)if(ja.equals(e[n],t))return n;return -1}function Vy(e){return e===Ya.OUTSIDE}function Uy(e){return e===Ya.INSIDE}class ky{constructor(e){e=Z(e,Z.EMPTY_OBJECT),this._planes=[],this._dirtyIndex=-1,this._multipleDirtyPlanes=!1,this._enabled=Z(e.enabled,!0),this.modelMatrix=Ot.clone(Z(e.modelMatrix,Ot.IDENTITY),new Ot),this.edgeColor=Di.clone(Z(e.edgeColor,Di.white)),this.edgeWidth=Z(e.edgeWidth,0),this.planeAdded=new ll,this.planeRemoved=new ll,this._owner=void 0;const t=Z(e.unionClippingRegions,!0);this._unionClippingRegions=t,this._testIntersection=t?Vy:Uy,this._uint8View=void 0,this._float32View=void 0,this._clippingPlanesTexture=void 0,this._useFloatTexture=void 0;const i=e.planes;if($(i)){const e=i.length;for(let t=0;t<e;++t)this.add(i[t]);}}get length(){return this._planes.length}get unionClippingRegions(){return this._unionClippingRegions}set unionClippingRegions(e){this._unionClippingRegions!==e&&(this._unionClippingRegions=e,this._testIntersection=e?Vy:Uy);}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(this._enabled=e);}get texture(){return this._clippingPlanesTexture}get owner(){return this._owner}get clippingPlanesState(){return this._unionClippingRegions?this._planes.length:-this._planes.length}add(e){const t=this._planes.length;e.onChangeCallback=e=>{zy(this,e);},e.index=t,zy(this,t),e.setReferenceCenter(this.modelMatrix),this._planes.push(e),this.planeAdded.fire(e,t);}get(e){if(Qe(e))return this._planes[e]}contains(e){return -1!==By(this._planes,e)}remove(e){const t=this._planes,i=By(t,e);if(-1===i)return !1;e instanceof Py&&(e.onChangeCallback=void 0,e.index=-1);const n=t.length-1;for(let e=i;e<n;++e){const i=t[e+1];t[e]=i,i instanceof Py&&(i.index=e);}return this._multipleDirtyPlanes=!0,t.length=n,this.planeRemoved.fire(e,i),!0}removeAll(){const e=this._planes,t=e.length;for(let i=0;i<t;++i){const t=e[i];t instanceof Py&&(t.onChangeCallback=void 0,t.index=-1),this.planeRemoved.fire(t,i);}this._multipleDirtyPlanes=!0,this._planes=[];}update(e){let t=this._clippingPlanesTexture;const i=e.context;this.useFloatTexture(i);const n=this._useFloatTexture?this.length:2*this.length;if($(t)){const e=t.width*t.height;(e<n||n<.25*e)&&(t.destroy(),t=void 0,this._clippingPlanesTexture=void 0);}if(0===this.length)return;if(!$(t)){const e=Fy(n,new It);e.y*=2,this._useFloatTexture?(t=new ah({context:i,width:e.x,height:e.y,pixelFormat:Nu.RGBA,pixelDatatype:Iu.FLOAT,sampler:Eu.NEAREST,flipY:!1}),this._float32View=new Float32Array(e.x*e.y*4)):(t=new ah({context:i,width:e.x,height:e.y,pixelFormat:Nu.RGBA,pixelDatatype:Iu.UNSIGNED_BYTE,sampler:Eu.NEAREST,flipY:!1}),this._uint8View=new Uint8Array(e.x*e.y*4)),this._clippingPlanesTexture=t,this._multipleDirtyPlanes=!0;}const r=this._dirtyIndex;if(this._multipleDirtyPlanes||-1!==r){if(this._multipleDirtyPlanes)this._useFloatTexture?(Dy(this,0,this._planes.length),t.copyFrom({source:{width:t.width,height:t.height,arrayBufferView:this._float32View}})):(Oy(this,0,this._planes.length),t.copyFrom({source:{width:t.width,height:t.height,arrayBufferView:this._uint8View}}));else {let e=0,i=0;this._useFloatTexture?(i=Math.floor(r/t.width),e=Math.floor(r-i*t.width),Dy(this,r,r+1),t.copyFrom({source:{width:1,height:1,arrayBufferView:this._float32View},xOffset:e,yOffset:i})):(i=Math.floor(2*r/t.width),e=Math.floor(2*r-i*t.width),Oy(this,r,r+1),t.copyFrom({source:{width:2,height:1,arrayBufferView:this._uint8View},xOffset:e,yOffset:i}));}this._multipleDirtyPlanes=!1,this._dirtyIndex=-1;}}computeIntersectionWithBoundingVolume(e,t){const i=this._planes,n=i.length;let r=this.modelMatrix;$(t)&&(r=Ot.multiply(t,r,new Ot));let o=Ya.INSIDE;!this.unionClippingRegions&&n>0&&(o=Ya.OUTSIDE);const a=new ja(ft.UNIT_X,0);for(let t=0;t<n;++t){ja.transform(i[t],r,a);const n=e.intersectPlane(a);if(n===Ya.INTERSECTING)o=n;else if(this._testIntersection(n))return n}return o}static setOwner(e,t,i){if(e!==t[i]&&(t[i]=t[i]&&t[i].destroy(),$(e))){if($(e._owner))throw new Error("ClippingPlaneCollection should only be assigned to one object");e._owner=t,t[i]=e;}}useFloatTexture(e){this._useFloatTexture=e.floatingPointTexture;}static getTextureResolution(e){const t=new It,i=e.texture;if($(i))return t.x=i.width,t.y=i.height,t;const n=Fy(2*e.length,t);return n.y*=2,n}serialize(){const e=[];for(let t=0;t<this.length;t++)e.push(this.get(t).serialize());return {modelMatrix:Ot.pack(this.modelMatrix,new Array(16)),edgeColor:Di.pack(this.edgeColor,new Array(4)),edgeWidth:this.edgeWidth,enabled:this.enabled,unionClippingRegions:this.unionClippingRegions,planes:e}}destroy(){return this._clippingPlanesTexture=this._clippingPlanesTexture&&this._clippingPlanesTexture.destroy(),uc(this)}}var Gy=Object.freeze({NONE:0,PHONG:1,PBR:2});class Hy{constructor(e,t,i,n){this.message=(e?`${e}: `:"")+i,n&&(this.identifier=n),null!=t&&t.__line__&&(this.line=t.__line__);}}function Yy(e){const t=e.value;return t?[new Hy(e.key,t,"constants have been deprecated as of v8")]:[]}function qy(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Xy(e){if(Array.isArray(e))return e.map(Xy);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const i in e)t[i]=Xy(e[i]);return t}return qy(e)}function jy(e){const t=e.key,i=e.value,n=e.valueSpec||{},r=e.objectElementValidators||{},o=e.style,a=e.styleSpec;let s=[];const l=In(i);if("object"!==l)return [new Hy(t,i,`object expected, ${l} found`)];for(const e in i){const l=e.split(".")[0],c=n[l]||n["*"];let u;if(r[l])u=r[l];else if(n[l])u=wx;else if(r["*"])u=r["*"];else {if(!n["*"]){s.push(new Hy(t,i[e],`unknown property "${e}"`));continue}u=wx;}s=s.concat(u({key:(t?`${t}.`:t)+e,value:i[e],valueSpec:c,style:o,styleSpec:a,object:i,objectKey:e},i));}for(const e in n)r[e]||n[e].required&&void 0===n[e].default&&void 0===i[e]&&s.push(new Hy(t,i,`missing required property "${e}"`));return s}function Wy(e){const t=e.value,i=e.valueSpec,n=e.style,r=e.styleSpec,o=e.key,a=e.arrayElementValidator||wx;if("array"!==In(t))return [new Hy(o,t,`array expected, ${In(t)} found`)];if(i.length&&t.length!==i.length)return [new Hy(o,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return [new Hy(o,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let s={type:i.value};r.$version<7&&(s.function=i.function),"object"===In(i.value)&&(s=i.value);let l=[];for(let e=0;e<t.length;e++)l=l.concat(a({array:t,arrayIndex:e,value:t[e],valueSpec:s,style:n,styleSpec:r,key:`${o}[${e}]`}));return l}function $y(e){const t=e.key,i=e.value,n=e.valueSpec,r=In(i);return "number"!==r?[new Hy(t,i,`number expected, ${r} found`)]:"minimum"in n&&i<n.minimum?[new Hy(t,i,`${i} is less than the minimum value ${n.minimum}`)]:"maximum"in n&&i>n.maximum?[new Hy(t,i,`${i} is greater than the maximum value ${n.maximum}`)]:[]}function Zy(e){const t=e.valueSpec,i=qy(e.value.type);let n,r,o,a={};const s="categorical"!==i&&void 0===e.value.property,l=!s,c="array"===In(e.value.stops)&&"array"===In(e.value.stops[0])&&"object"===In(e.value.stops[0][0]),u=jy({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===i)return [new Hy(e.key,e.value,'identity function may not have a "stops" property')];let t=[];const n=e.value;return t=t.concat(Wy({key:e.key,value:n,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===In(n)&&0===n.length&&t.push(new Hy(e.key,n,"array must have at least one stop")),t},default:function(e){return wx({key:e.key,value:e.value,valueSpec:t,style:e.style,styleSpec:e.styleSpec})}}});return "identity"===i&&s&&u.push(new Hy(e.key,e.value,'missing required property "property"')),"identity"===i||e.value.stops||u.push(new Hy(e.key,e.value,'missing required property "stops"')),"exponential"===i&&e.valueSpec.expression&&!ro(e.valueSpec)&&u.push(new Hy(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!io(e.valueSpec)?u.push(new Hy(e.key,e.value,"property functions not supported")):s&&!no(e.valueSpec)&&u.push(new Hy(e.key,e.value,"zoom functions not supported"))),"categorical"!==i&&!c||void 0!==e.value.property||u.push(new Hy(e.key,e.value,'"property" property is required')),u;function h(e){let i=[];const n=e.value,s=e.key;if("array"!==In(n))return [new Hy(s,n,`array expected, ${In(n)} found`)];if(2!==n.length)return [new Hy(s,n,`array length 2 expected, length ${n.length} found`)];if(c){if("object"!==In(n[0]))return [new Hy(s,n,`object expected, ${In(n[0])} found`)];if(void 0===n[0].zoom)return [new Hy(s,n,"object stop key must have zoom")];if(void 0===n[0].value)return [new Hy(s,n,"object stop key must have value")];if(o&&o>qy(n[0].zoom))return [new Hy(s,n[0].zoom,"stop zoom values must appear in ascending order")];qy(n[0].zoom)!==o&&(o=qy(n[0].zoom),r=void 0,a={}),i=i.concat(jy({key:`${s}[0]`,value:n[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:$y,value:d}}));}else i=i.concat(d({key:`${s}[0]`,value:n[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},n));return i.concat(wx({key:`${s}[1]`,value:n[1],valueSpec:t,style:e.style,styleSpec:e.styleSpec}))}function d(e,o){const s=In(e.value),l=qy(e.value),c=null!==e.value?e.value:o;if(n){if(s!==n)return [new Hy(e.key,c,`${s} stop domain type must match previous stop domain type ${n}`)]}else n=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return [new Hy(e.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==i){let n=`number expected, ${s} found`;return io(t)&&void 0===i&&(n+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Hy(e.key,c,n)]}return "categorical"!==i||"number"!==s||isFinite(l)&&Math.floor(l)===l?"categorical"!==i&&"number"===s&&void 0!==r&&l<r?[new Hy(e.key,c,"stop domain values must appear in ascending order")]:(r=l,"categorical"===i&&l in a?[new Hy(e.key,c,"stop domain values must be unique")]:(a[l]=!0,[])):[new Hy(e.key,c,`integer expected, found ${l}`)]}}function Ky(e){const t=("property"===e.expressionContext?Fo:Ro)(Xy(e.value),e.valueSpec);if("error"===t.result)return t.value.map((t=>new Hy(`${e.key}${t.key}`,e.value,t.message)));const i=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&-1!==t.value._styleExpression.expression.possibleOutputs().indexOf(void 0))return [new Hy(e.key,e.value,'Invalid data expression for "text-font". Output values must be contained as literals within the expression.')];if("property"===e.expressionContext&&"layout"===e.propertyType&&!nr(t.value._styleExpression.expression))return [new Hy(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext&&!nr(i))return [new Hy(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!rr(i,["zoom","feature-state"]))return [new Hy(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!ir(i))return [new Hy(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return []}function Qy(e){const t=e.key,i=e.value,n=e.valueSpec,r=[];return Array.isArray(n.values)?-1===n.values.indexOf(qy(i))&&r.push(new Hy(t,i,`expected one of [${n.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(n.values).indexOf(qy(i))&&r.push(new Hy(t,i,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(i)} found`)),r}function Jy(e){if(!0===e||!1===e)return !0;if(!Array.isArray(e)||0===e.length)return !1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":case"!arrin":case"arrin":case"like":case"!like":return !1;case"==":case"!=":case">":case">=":case"<":case"<=":case"start":case"end":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Jy(t)&&"boolean"!=typeof t)return !1;return !0;default:return !0}}const ex={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function tx(e){if(!e)return ()=>!0;Jy(e)||(e=nx(e));const t=Ro(e,ex);if("error"===t.result)throw new Error(t.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return (e,i,n)=>t.value.evaluate(e,i,{},n)}function ix(e,t){return e<t?-1:e>t?1:0}function nx(e){if(!e)return !0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?rx(e[1],e[2],"=="):"!="===t?cx(rx(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?rx(e[1],e[2],t):"any"===t?(i=e.slice(1),["any"].concat(i.map(nx))):"all"===t?["all"].concat(e.slice(1).map(nx)):"none"===t?["all"].concat(e.slice(1).map(nx).map(cx)):"in"===t?ox(e[1],e.slice(2)):"!in"===t?cx(ox(e[1],e.slice(2))):"has"===t?lx(e[1]):"!has"===t?cx(lx(e[1])):"arrin"===t?ax(e[1],e.slice(2)):"!arrin"===t?cx(ax(e[1],e.slice(2))):"like"===t?sx(e[1],e.slice(2)):"!like"===t?cx(sx(e[1],e.slice(2))):"within"!==t||e;var i;}function rx(e,t,i){switch(e){case"$type":return [`filter-type-${i}`,t];case"$id":return [`filter-id-${i}`,t];default:return [`filter-${i}`,e,t]}}function ox(e,t){if(0===t.length)return !1;switch(e){case"$type":return ["filter-type-in",["literal",t]];case"$id":return ["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(ix)]]:["filter-in-small",e,["literal",t]]}}function ax(e,t){return 0!==t.length&&("$type"===e?["filter-type-arrin",["literal",t]]:["filter-arrin",e,["literal",t]])}function sx(e,t){return 0!==t.length&&("$type"===e?["filter-type-like",["literal",t]]:["filter-like",e,["literal",t]])}function lx(e){switch(e){case"$type":return !0;case"$id":return ["filter-has-id"];default:return ["filter-has",e]}}function cx(e){return ["!",e]}function ux(e){return Jy(Xy(e.value))?Ky(Fi({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):hx(e)}function hx(e){const t=e.value,i=e.key;if("array"!==In(t))return [new Hy(i,t,`array expected, ${In(t)} found`)];const n=e.styleSpec;let r,o=[];if(t.length<1)return [new Hy(i,t,"filter array must have at least 1 element")];switch(o=o.concat(Qy({key:`${i}[0]`,value:t[0],valueSpec:n.filter_operator,style:e.style,styleSpec:e.styleSpec})),qy(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===qy(t[1])&&o.push(new Hy(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&o.push(new Hy(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(r=In(t[1]),"string"!==r&&o.push(new Hy(`${i}[1]`,t[1],`string expected, ${r} found`)));for(let a=2;a<t.length;a++)r=In(t[a]),"$type"===qy(t[1])?o=o.concat(Qy({key:`${i}[${a}]`,value:t[a],valueSpec:n.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&o.push(new Hy(`${i}[${a}]`,t[a],`string, number, or boolean expected, ${r} found`));break;case"like":case"!like":t.length>=2&&(r=In(t[1]),"string"!==r&&o.push(new Hy(`${i}[1]`,t[1],`string expected, ${r} found`)));for(let a=2;a<t.length;a++)r=In(t[a]),"$type"===qy(t[1])?o=o.concat(Qy({key:`${i}[${a}]`,value:t[a],valueSpec:n.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&o.push(new Hy(`${i}[${a}]`,t[a],`string, number, or boolean expected, ${r} found`));break;case"any":case"all":case"none":for(let n=1;n<t.length;n++)o=o.concat(hx({key:`${i}[${n}]`,value:t[n],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":r=In(t[1]),2!==t.length?o.push(new Hy(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==r&&o.push(new Hy(`${i}[1]`,t[1],`string expected, ${r} found`));break;case"within":r=In(t[1]),2!==t.length?o.push(new Hy(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):"object"!==r&&o.push(new Hy(`${i}[1]`,t[1],`object expected, ${r} found`));}return o}function dx(e,t){const i=e.key,n=e.style,r=e.styleSpec,o=e.value,a=e.objectKey,s=r[`${t}_${e.layerType}`];if(!s)return [];const l=a.match(/^(.*)-transition$/);if("paint"===t&&l&&s[l[1]]&&s[l[1]].transition)return wx({key:i,value:o,valueSpec:r.transition,style:n,styleSpec:r});const c=e.valueSpec||s[a];if(!c)return [new Hy(i,o,`unknown property "${a}"`)];let u;if("string"===In(o)&&io(c)&&!c.tokens&&(u=/^{([^}]+)}$/.exec(o)))return [new Hy(i,o,`"${a}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(u[1])} }\`.`)];const h=[];return "symbol"===e.layerType&&("text-field"===a&&n&&!n.glyphs&&h.push(new Hy(i,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&To(Xy(o))&&"identity"===qy(o.type)&&h.push(new Hy(i,o,'"text-font" does not support identity functions'))),h.concat(wx({key:e.key,value:o,valueSpec:c,style:n,styleSpec:r,expressionContext:"property",propertyType:t,propertyKey:a}))}function px(e){return dx(e,"paint")}function fx(e){return dx(e,"layout")}function mx(e){let t=[];const i=e.value,n=e.key,r=e.style,o=e.styleSpec;i.type||i.ref||t.push(new Hy(n,i,'either "type" or "ref" is required'));let a=qy(i.type);const s=qy(i.ref);if(i.id){const o=qy(i.id);for(let a=0;a<e.arrayIndex;a++){const e=r.layers[a];qy(e.id)===o&&t.push(new Hy(n,i.id,`duplicate layer id "${i.id}", previously used at line ${e.id.__line__}`));}}if("ref"in i){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in i&&t.push(new Hy(n,i[e],`"${e}" is prohibited for ref layers`));})),r.layers.forEach((t=>{qy(t.id)===s&&(e=t);})),e?e.ref?t.push(new Hy(n,i.ref,"ref cannot reference another ref layer")):a=qy(e.type):t.push(new Hy(n,i.ref,`ref layer "${s}" not found`));}else if("background"!==a&&"raster"!==a)if(i.source){const e=r.sources&&r.sources[i.source],o=e&&qy(e.type);e?"vector"===o&&"raster"===a?t.push(new Hy(n,i.source,`layer "${i.id}" requires a raster source`)):"raster"===o&&"raster"!==a?t.push(new Hy(n,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==o||i["source-layer"]?"line"!==a||!i.paint||!i.paint["line-gradient"]||"geojson"===o&&e.lineMetrics||t.push(new Hy(n,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Hy(n,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new Hy(n,i.source,`source "${i.source}" not found`));}else t.push(new Hy(n,i,'missing required property "source"'));return t=t.concat(jy({key:n,value:i,valueSpec:o.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>wx({key:`${n}.type`,value:i.type,valueSpec:o.layer.type,style:e.style,styleSpec:e.styleSpec,object:i,objectKey:"type"}),filter:ux,layout:e=>jy({layer:i,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>fx(Fi({layerType:a},e))}}),paint:e=>jy({layer:i,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>px(Fi({layerType:a},e))}})}})),t}function _x(e){const t=e.value,i=e.key,n=In(t);return "string"!==n?[new Hy(i,t,`string expected, ${n} found`)]:[]}const gx={promoteId:function({key:e,value:t}){if("string"===In(t))return _x({key:e,value:t});{const i=[];for(const n in t)i.push(..._x({key:`${e}.${n}`,value:t[n]}));return i}}};function yx(e){const t=e.value,i=e.key,n=e.styleSpec,r=e.style;if(!t.type)return [new Hy(i,t,'"type" is required')];const o=qy(t.type);let a=[];switch(o){case"vector":case"raster":case"raster-dem":if(a=a.concat(jy({key:i,value:t,valueSpec:n[`source_${o.replace("-","_")}`],style:e.style,styleSpec:n,objectElementValidators:gx})),"url"in t)for(const e in t)["type","url","tileSize"].indexOf(e)<0&&a.push(new Hy(`${i}.${e}`,t[e],`a source with a "url" property may not include a "${e}" property`));return a;case"geojson":return jy({key:i,value:t,valueSpec:n.source_geojson,style:r,styleSpec:n,objectElementValidators:gx});case"video":return jy({key:i,value:t,valueSpec:n.source_video,style:r,styleSpec:n});case"image":return jy({key:i,value:t,valueSpec:n.source_image,style:r,styleSpec:n});case"canvas":return a.push(new Hy(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")),a;case"sphere-image":case"3d-model":case"3d-tiles":return [];default:return Qy({key:`${i}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:r,styleSpec:n})}}function xx(e){const t=e.value,i=e.styleSpec,n=i.light,r=e.style;let o=[];const a=In(t);if(void 0===t)return o;if("object"!==a)return o=o.concat([new Hy("light",t,`object expected, ${a} found`)]),o;for(const e in t){const a=e.match(/^(.*)-transition$/);o=o.concat(a&&n[a[1]]&&n[a[1]].transition?wx({key:e,value:t[e],valueSpec:i.transition,style:r,styleSpec:i}):n[e]?wx({key:e,value:t[e],valueSpec:n[e],style:r,styleSpec:i}):[new Hy(e,t[e],`unknown property "${e}"`)]);}return o}const vx={"*":()=>[],any:()=>[],array:Wy,boolean:function(e){const t=e.value,i=e.key,n=In(t);return "boolean"!==n?[new Hy(i,t,`boolean expected, ${n} found`)]:[]},number:$y,color:function(e){const t=e.key,i=e.value,n=In(i);return "string"!==n?[new Hy(t,i,`color expected, ${n} found`)]:null===Ii(i)?[new Hy(t,i,`color expected, "${i}" found`)]:[]},constants:Yy,enum:Qy,filter:ux,function:Zy,layer:mx,object:jy,source:yx,light:xx,string:_x,formatted:function(e){return 0===_x(e).length?[]:Ky(e)},resolvedImage:function(e){return 0===_x(e).length?[]:Ky(e)}};function wx(e){const t=e.value,i=e.valueSpec,n=e.styleSpec;if(i.expression&&To(qy(t)))return Zy(e);if(i.expression&&No(Xy(t)))return Ky(e);if(i.type&&vx[i.type])return vx[i.type](e);{const t=jy(Fi({},e,{valueSpec:i.type?n[i.type]:i}));return t||We("not valid"),t}}function Tx(e){const t=e.value,i=e.key,n=_x(e);return n.length||(-1===t.indexOf("{fontstack}")&&n.push(new Hy(i,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&n.push(new Hy(i,t,'"glyphs" url must include a "{range}" token'))),n}function bx(e,t){let i=[];return i=i.concat(wx({key:"",value:e,valueSpec:(t=t||Og).$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Tx,"*":()=>[]}})),e.constants&&(i=i.concat(Yy({key:"constants",value:e.constants,style:e,styleSpec:t}))),Px(i)}function Px(e){return [].concat(e).sort(((e,t)=>e.line-t.line))}function Sx(e){return function(){return Px(e.apply(this,arguments))}}bx.source=Sx(yx),bx.light=Sx(xx),bx.layer=Sx(mx),bx.filter=Sx(ux),bx.paintProperty=Sx(px),bx.layoutProperty=Sx(fx);const Ax=bx,Ex=bx.paintProperty,Cx=bx.layoutProperty;function Mx(e,t){let i=!1;if(t&&t.length)for(const n of t)e.fire(new sl(new Error(n.message))),i=!0;return i}const Ix="-transition";class Lx extends ll{constructor(e,t){if(super(),this.id=e.id,this._featureFilter=()=>!0,"custom"!==e.type){if(this.metadata=e.metadata,this.type=e.type,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this.visibility="visible",this.depthTest=e["depth-test"]||!1,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t&&t.layout&&(this._unevaluatedLayout=new Tp(t.layout)),t&&t.paint){this._transitionablePaint=new xp(t.paint);for(const t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(const t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned();}"3d-model"!==e.type&&"3d-tiles"!==e.type&&"extrusion"!==e.type||(this.lightingModel=Z(e.lightingModel,Gy.NONE),this.phongLightConfig=e.phongLightConfig,this.clippingPlanes=e.clippingPlanes),("circle"===e.type||"line"===e.type||"fill"===e.type||"extrusion"===e.type||"heatmap"===e.type||"sprite"===e.type||"symbol"===e.type&&e.classificationType===Zd.FORCE_VECTOR_OVER_MODEL)&&(this.classificationType=e.classificationType);}}getLayoutProperty(e){return "visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,i){null!=t&&this._validate(Cx,`layers.${this.id}.layout.${e}`,e,t,i)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility="none"===t?t:"visible");}getPaintProperty(e){return He(e,Ix)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,i){if(null!=t&&this._validate(Ex,`layers.${this.id}.paint.${e}`,e,t,i))return !1;if(He(e,Ix))return this._transitionablePaint.setTransition(e.slice(0,-11),t||void 0),!1;{const i=this._transitionablePaint._values[e],n=i.value.isDataDriven(),r=i.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const o=this._transitionablePaint._values[e].value,a=o.isDataDriven(),s=He(e,"pattern")||"line-dasharray"===e;return a||n||s||this._handleOverridablePaintPropertyUpdate(e,r,o)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,t,i){return t.value!==i.value}isHidden(e,t){return this.minzoom>t||this.maxzoom<=e||"none"===this.visibility}isHiddenByMapZoom(e){return Nx(this,e)}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint);}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t);}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,_original_style:this._original_style,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize(),enableQuery:this.enableQuery,vectorRenderInSpace:this.vectorRenderInSpace,classificationType:this.classificationType};return "none"===this.visibility&&(e.layout=e.layout||{},e.layout.visibility="none"),qe(e,((e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)))}_validate(e,t,i,n,r){return (!r||!1!==r.validate)&&Mx(this,e.call(Ax,{key:t,layerType:this.type,objectKey:i,value:n,styleSpec:Og,style:{glyphs:!0,sprite:!0}}))}hasOffscreenPass(){return !1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof bp&&io(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return !0}return !1}}function Nx(e,t,i){i=i||nt.TRANSFORM.EPSILON11;let n=!1;return $(e.minzoom)&&e.minzoom-t>i&&(n=!0),$(e.maxzoom)&&t-e.maxzoom>i&&(n=!0),n||"none"===e.visibility}var Rx={paint:new Ip({"background-color":new Sp(Og.paint_background["background-color"]),"background-pattern":new Cp(Og.paint_background["background-pattern"]),"background-pattern-fixed":new Sp(Og.paint_background["background-pattern-fixed"]),"background-opacity":new Sp(Og.paint_background["background-opacity"]),"background-terrain-analysis":new Ap(Og.paint_background["background-terrain-analysis"])})},Ox={paint:new Ip({"raster-opacity":new Sp(Og.paint_raster["raster-opacity"]),"raster-hue-rotate":new Sp(Og.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Sp(Og.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Sp(Og.paint_raster["raster-brightness-max"]),"raster-saturation":new Sp(Og.paint_raster["raster-saturation"]),"raster-contrast":new Sp(Og.paint_raster["raster-contrast"]),"raster-resampling":new Sp(Og.paint_raster["raster-resampling"]),"raster-fade-duration":new Sp(Og.paint_raster["raster-fade-duration"])})};class Dx{constructor(){}static setPhongLightUniform(e){const{material:t,phongLightConfig:i}=e,n=Object.assign({Ambient:Og.phongLightConfig.Ambient.default,Diffuse:Og.phongLightConfig.Diffuse.default,SpecularColor:Og.phongLightConfig.SpecularColor.default,Shininess:Og.phongLightConfig.Shininess.default},i),{Ambient:r,Diffuse:o,SpecularColor:a,Shininess:s}=n;t._uniforms.set("u_LightMaterial",{Ambient:()=>new ft(r,r,r),Diffuse:()=>new ft(o,o,o),SpecularColor:()=>new ft(a,a,a),Shininess:()=>s});}}const Fx={COLOR:"Color",TEXTURE:"Texture",DIFFUSING_RING:"DiffusingRing",RADAR_SCAN:"RadarScan"};Object.freeze(Fx);const zx=new Ot,Bx=new wt;class Vx extends N_{constructor(e){super(e),this.frame=void 0,this._texType=Z(e.texType,void 0),this._flowOptions=void 0,this._count=0,this._pickColorDepthTest=Z(e.pickColorDepthTest,void 0),this.totalTime=0,this._clippingPlanes=Z(e.clippingPlanes,void 0);}get pickColorDepthTest(){return this._pickColorDepthTest}set pickColorDepthTest(e){this._pickColorDepthTest=e;}update(e,t,i={}){if(this.totalTime=e._map.timer.totalTime,this._flowOptions&&this.animateTexture(),super.update(e,t,i),this._batchTable&&(this.uniforms=this._batchTable.getUniformMapCallback(),e.commonDepthPass.render({painter:e}),this._depthTexture=e.commonDepthPass.framebuffer.getColorTexture(0).bind(hc.LINEAR,hc.CLAMP_TO_EDGE),this._uniforms.set("u_DepthTexture",(()=>this._depthTexture)),this._uniforms.set("u_InvertViewMatrix",(()=>t.camera.getViewMatrix().invert())),this.defines=i.primitive._adaptTerrain?t.preMainDepthStencilTexture?{HAS_SHADOWVOLUME:!0,SHADOWVOLUME_DISCARD:!0}:{HAS_SHADOWVOLUME:!0,SHADOWVOLUME_DISCARD:!1}:{HAS_SHADOWVOLUME:!1,SHADOWVOLUME_DISCARD:!1}),this._clippingPlanes&&this._clippingPlanes.enabled&&0!==this._clippingPlanes.length){this._clippingPlanes.update(e,t),this._uniforms.set("u_model_clippingPlanesEdgeStyle",(()=>(Bx.set(this._clippingPlanes.edgeColor.r,this._clippingPlanes.edgeColor.g,this._clippingPlanes.edgeColor.b,this._clippingPlanes.edgeWidth),Bx))),this._uniforms.set("u_model_clippingPlanes",(()=>this._clippingPlanes.texture)),this._uniforms.set("u_model_clippingPlanesMatrix",(()=>{const e=Ot.multiply(zx,t.camera.matrixWorldInverse,this._clippingPlanes.modelMatrix);return Ot.inverseTranspose(e,e),e})),this.defines.HAS_CLIPPING_PLANES=!0,this.defines.USE_CLIPPING_PLANES_FLOAT_TEXTURE=!!this._clippingPlanes._useFloatTexture;const i=ky.getTextureResolution(this._clippingPlanes);this.defines.CLIPPING_PLANES_LENGTH=this._clippingPlanes.length,this.defines.CLIPPING_PLANES_TEXTURE_WIDTH=i.x,this.defines.CLIPPING_PLANES_TEXTURE_HEIGHT=i.y,this.defines.UNION_CLIPPING_REGIONS=!!this._clippingPlanes._unionClippingRegions;}else this.defines.HAS_CLIPPING_PLANES=!1,this.defines.USE_CLIPPING_PLANES_FLOAT_TEXTURE=!1,this.defines.CLIPPING_PLANES_LENGTH=0,this.defines.CLIPPING_PLANES_TEXTURE_WIDTH=1,this.defines.CLIPPING_PLANES_TEXTURE_HEIGHT=1;this._uniforms.set("u_FrameTime",(()=>e._map.timer.totalTime));}_updateTexOffsetScale(e){this._uniforms.set("u_TexOffsetScale",(()=>{const t=new wt(0,0,1,1);return e&&e.texCoordOffset&&e.texCoordOffset[0]&&(t.x=e.texCoordOffset[0]),e&&e.texCoordOffset&&e.texCoordOffset[1]&&(t.y=e.texCoordOffset[1]),e&&e.texCoordRepeat&&e.texCoordRepeat[0]&&(t.z=e.texCoordRepeat[0]),e&&e.texCoordRepeat&&e.texCoordRepeat[1]&&(t.w=e.texCoordRepeat[1]),t})),this._uniforms.set("u_TexRotate",(()=>{const t=new ft(.5,.5,0);return e&&e.texCoordCenter&&e.texCoordCenter[0]&&(t.x=e.texCoordCenter[0]),e&&e.texCoordCenter&&e.texCoordCenter[1]&&(t.y=e.texCoordCenter[1]),e&&e.texCoordRotation&&(t.z=e.texCoordRotation*nt.TRANSFORM.DEG_TO_RAD),t}));}flowTexture(e){e.speed||(e.speed=1),e.rotation||(e.rotation=0),e.direction||(e.direction="right"),e.texRepeat||(e.repeat=[0,0]),e.speed>10&&(e.speed=10),e.speed<1&&(e.speed=1),this._flowOptions=e;}animateTexture(){const e=this.totalTime*this._flowOptions.speed/5,t=new wt(0,0,1,1);switch(t.x>1&&(t.x=t.x-1),t.y>1&&(t.y=t.y-1),this._flowOptions.direction){case"right":t.x=t.x-e+1;break;case"left":default:t.x+=e;break;case"up":t.y=t.y-e+1;break;case"down":t.y+=e;}this._updateTexOffsetScale({texCoordCenter:[.5,.5],texCoordRotation:this._flowOptions.rotation,texCoordOffset:[t.x,t.y],texCoordRepeat:this._flowOptions.texRepeat});}updateTexture(e,t){let i;return this._flowOptions||J.cancelAnimationFrame(this.frame),e==Fx.COLOR?i=Vx.fromType(Fx.COLOR,{color:t.baseColor,opacity:t.opacity,lightingModel:t.lightingModel,doubleSided:t.doubleSided}):e==Fx.TEXTURE?i=Vx.fromType(Fx.TEXTURE,{baseColorTexture:t.baseColorTexture,opacity:t.opacity,lightingModel:t.lightingModel,doubleSided:t.doubleSided}):e==Fx.RADAR_SCAN?i=Vx.fromType(Fx.RADAR_SCAN,{color:t.baseColor,opacity:t.opacity,lightingModel:t.lightingModel,doubleSided:t.doubleSided}):e==Fx.DIFFUSING_RING&&(i=Vx.fromType(Fx.DIFFUSING_RING,{color:t.baseColor,opacity:t.opacity,lightingModel:t.lightingModel,doubleSided:t.doubleSided})),i}updateProperty(e){if(e.color){const t=Di.parse(e.color);this._uniforms.set("u_Color",(()=>wt.fromColor(t,!1)));}e.baseColorTexture&&(this._uniforms.set("u_BaseColorSampler",(()=>Vx.bindTextureSampler(e.baseColorTexture))),Vx.buildDefines(this,e)),$(e.opacity)&&this._uniforms.set("u_Opacity",(()=>e.opacity)),this._flowOptions||J.cancelAnimationFrame(this.frame),this._updateTexOffsetScale(e);}static buildDefines(e,t={}){const i={};if(i.PHONG_LIGHT=t.phongLight,i.HAS_BASECOLORMAP=t.hasBaseColorMap,i.HAS_RADARSCAN=t.radarScan,i.HAS_DIFFUSINGRING=t.diffusingRing,i.HAS_CLIPPING_PLANES=t.clippingPlanes,i.HAS_CLIPPING_PLANES){i.HAS_CLIPPING_PLANES=!0,i.USE_CLIPPING_PLANES_FLOAT_TEXTURE=!!e._clippingPlanes._useFloatTexture;const t=ky.getTextureResolution(e._clippingPlanes);i.CLIPPING_PLANES_LENGTH=e._clippingPlanes.length,i.CLIPPING_PLANES_TEXTURE_WIDTH=t.x,i.CLIPPING_PLANES_TEXTURE_HEIGHT=t.y,i.UNION_CLIPPING_REGIONS=!!e._clippingPlanes._unionClippingRegions;}else i.HAS_CLIPPING_PLANES=!1,i.USE_CLIPPING_PLANES_FLOAT_TEXTURE=!1,i.CLIPPING_PLANES_LENGTH=0,i.CLIPPING_PLANES_TEXTURE_WIDTH=1,i.CLIPPING_PLANES_TEXTURE_HEIGHT=1;e.defines=i;}get texType(){return this._texType}set texType(e){this._texType=e;}get clippingPlanes(){return this._clippingPlanes}set clippingPlanes(e){this._clippingPlanes=e instanceof ky?e:void 0;}static fromType(e,t){const i=Vx.getPresetMaterial(e,t),n=new Vx({renderState:t.renderState?t.renderState:i.renderState,defines:t.defines,type:"StandardMaterial",texType:e,baseColorTexture:i.baseColorTexture,color:i.color,doubleSided:i.doubleSided,opacity:i.opacity,lightingModel:i.lightingModel,depthTest:t.depthTest,clippingPlanes:t.clippingPlanes});Vx.buildDefines(n,i.microDefineOptions),Dx.setPhongLightUniform({material:n});for(const e in i.uniforms)n._uniforms.set(`u_${e}`,i.uniforms[e]);return n._updateTexOffsetScale({texCoordRepeat:Z(t.texRepeat,[0,0])}),n}static bindTextureSampler(e){return e.sampler={minificationFilter:e.minFilter||hc.LINEAR_MIPMAP_NEAREST,magnificationFilter:e.magFilter||hc.LINEAR,wrapS:e.wrapS||hc.REPEAT,wrapT:e.wrapT||hc.REPEAT},e}static getPresetMaterial(e,t){const i=Z(t?.lightingModel,Gy.PHONG),n={renderState:N_.getDefaultRenderState(),videoOptions:{},uniforms:{},baseColorTexture:void 0,doubleSided:void 0,lightingModel:void 0,defines:void 0,microDefineOptions:{phongLight:i===Gy.PHONG,hasBaseColorMap:Z(!!t.baseColorTexture,!1),radarScan:Z(e===Fx.RADAR_SCAN,!1),diffusingRing:Z(e===Fx.DIFFUSING_RING,!1),clippingPlanes:Z(!!t.clippingPlanes,!1)},color:void 0,opacity:void 0};n.renderState.polygonOffset={enabled:!0,factor:1,units:1},n.renderState.cull.enabled=Z(!t.doubleSided,!0);const r=Z(t?.opacity,1),o=Di.parse(Z(t?.color,new Di(1,0,0,1)));n.color=o,n.doubleSided=Z(t.doubleSided,!1),n.opacity=r,n.lightingModel=i,n.baseColorTexture=t.baseColorTexture;const a=Z(t?.speed,1);if(e==Fx.COLOR)n.uniforms={Color:()=>wt.fromColor(o,!1),Opacity:()=>r};else if(e==Fx.TEXTURE)n.uniforms={BaseColorSampler:()=>Vx.bindTextureSampler(t.baseColorTexture),Color:()=>new wt(o.r,o.g,o.b,o.a),Opacity:()=>r};else if(e==Fx.RADAR_SCAN)n.uniforms={Color:()=>wt.fromColor(o,!1),Opacity:()=>r,Speed:()=>a};else {if(e!=Fx.DIFFUSING_RING)throw new Error(`material with type '${e}' does not exist.`);n.uniforms={Color:()=>wt.fromColor(o,!1),Opacity:()=>r,Speed:()=>a};}return n}serialize(){const e={type:"StandardMaterial",texTYpe:this._texType,opacity:this._opacity,doubleSided:this._doubleSided,lightingModel:this._lightingModel};return this._texType===Fx.COLOR?e.color=Di.pack(this._color,new Array(4)):this._texType===Fx.TEXTURE&&(e.texUrl=this._baseColorTexture.texUrl),$(this._flowOptions)&&(e.flowOptions=this._flowOptions),$(this.clippingPlanes)&&(e.clippingPlanes=this.clippingPlanes.serialize()),e}destroy(){return super.destroy(),J.cancelAnimationFrame(this.frame),uc(this)}}const Ux=gi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_ST",components:2,type:"Float32"}],4),{members:kx}=Ux,Gx=gi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_ST",components:2,type:"Float32"},{name:"a_OUTLINE_COLOR",components:4,type:"Uint8"}],4),{members:Hx}=Gx;function Yx(e,t,i){const n=i.patternDependencies;let r=!1;for(const i of t){const t=i.paint.get(`${e}-pattern`),o=i.paint.get(`${e}-top-pattern`);if(!t)continue;t.isConstant()||(r=!0);const a=t.constantOr(null);if(a&&(r=!0,n[a.to]=!0,n[a.from]=!0),!o)continue;o.isConstant()||(r=!0);const s=o.constantOr(null);s&&(r=!0,n[s.to]=!0,n[s.from]=!0);}return r}function qx(e,t,i,n,r){const o=r.patternDependencies;for(const a of t){const t=a.paint.get(`${e}-pattern`),s=a.paint.get(`${e}-top-pattern`);if(!t)continue;const l=t.value;if("constant"!==l.kind){let e=l.evaluate({zoom:n-1},i,{},r.availableImages),t=l.evaluate({zoom:n},i,{},r.availableImages),s=l.evaluate({zoom:n+1},i,{},r.availableImages);e=e&&e.name?e.name:e,t=t&&t.name?t.name:t,s=s&&s.name?s.name:s,o[e]=!0,o[t]=!0,o[s]=!0,i.patterns[a.id]={min:e,mid:t,max:s};}if(!s)continue;const c=s.value;if("constant"!==c.kind){let e=c.evaluate({zoom:n-1},i,{},r.availableImages),t=c.evaluate({zoom:n},i,{},r.availableImages),s=c.evaluate({zoom:n+1},i,{},r.availableImages);e=e&&e.name?e.name:e,t=t&&t.name?t.name:t,s=s&&s.name?s.name:s,o[e]=!0,o[t]=!0,o[s]=!0,i.patterns[`${a.id}topPattern`]={min:e,mid:t,max:s};}}return i}var Xx=Wx,jx=Wx;function Wx(e,t,i){i=i||2;var n,r,o,a,s,l,c,u=t&&t.length,h=u?t[0]*i:e.length,d=$x(e,0,h,i,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(e,t,i,n){var r,o,a,s=[];for(r=0,o=t.length;r<o;r++)(a=$x(e,t[r]*n,r<o-1?t[r+1]*n:e.length,n,!1))===a.next&&(a.steiner=!0),s.push(av(a));for(s.sort(iv),r=0;r<s.length;r++)i=nv(s[r],i);return i}(e,t,d,i)),e.length>80*i){n=o=e[0],r=a=e[1];for(var f=i;f<h;f+=i)(s=e[f])<n&&(n=s),(l=e[f+1])<r&&(r=l),s>o&&(o=s),l>a&&(a=l);c=0!==(c=Math.max(o-n,a-r))?32767/c:0;}return Kx(d,p,i,n,r,c,0),p}function $x(e,t,i,n,r){var o,a;if(r===xv(e,t,i,n)>0)for(o=t;o<i;o+=n)a=_v(o,e[o],e[o+1],a);else for(o=i-n;o>=t;o-=n)a=_v(o,e[o],e[o+1],a);return a&&uv(a,a.next)&&(gv(a),a=a.next),a}function Zx(e,t){if(!e)return e;t||(t=e);var i,n=e;do{if(i=!1,n.steiner||!uv(n,n.next)&&0!==cv(n.prev,n,n.next))n=n.next;else {if(gv(n),(n=t=n.prev)===n.next)break;i=!0;}}while(i||n!==t);return t}function Kx(e,t,i,n,r,o,a){if(e){!a&&o&&function(e,t,i,n){var r=e;do{0===r.z&&(r.z=ov(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,i,n,r,o,a,s,l,c=1;do{for(i=e,e=null,o=null,a=0;i;){for(a++,n=i,s=0,t=0;t<c&&(s++,n=n.nextZ);t++);for(l=c;s>0||l>0&&n;)0!==s&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,s--):(r=n,n=n.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;i=n;}o.nextZ=null,c*=2;}while(a>1)}(r);}(e,n,r,o);for(var s,l,c=e;e.prev!==e.next;)if(s=e.prev,l=e.next,o?Jx(e,n,r,o):Qx(e))t.push(s.i/i|0),t.push(e.i/i|0),t.push(l.i/i|0),gv(e),e=l.next,c=l.next;else if((e=l)===c){a?1===a?Kx(e=ev(Zx(e),t,i),t,i,n,r,o,2):2===a&&tv(e,t,i,n,r,o):Kx(Zx(e),t,i,n,r,o,1);break}}}function Qx(e){var t=e.prev,i=e,n=e.next;if(cv(t,i,n)>=0)return !1;for(var r=t.x,o=i.x,a=n.x,s=t.y,l=i.y,c=n.y,u=r<o?r<a?r:a:o<a?o:a,h=s<l?s<c?s:c:l<c?l:c,d=r>o?r>a?r:a:o>a?o:a,p=s>l?s>c?s:c:l>c?l:c,f=n.next;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&sv(r,s,o,l,a,c,f.x,f.y)&&cv(f.prev,f,f.next)>=0)return !1;f=f.next;}return !0}function Jx(e,t,i,n){var r=e.prev,o=e,a=e.next;if(cv(r,o,a)>=0)return !1;for(var s=r.x,l=o.x,c=a.x,u=r.y,h=o.y,d=a.y,p=s<l?s<c?s:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,m=s>l?s>c?s:c:l>c?l:c,_=u>h?u>d?u:d:h>d?h:d,g=ov(p,f,t,i,n),y=ov(m,_,t,i,n),x=e.prevZ,v=e.nextZ;x&&x.z>=g&&v&&v.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=_&&x!==r&&x!==a&&sv(s,u,l,h,c,d,x.x,x.y)&&cv(x.prev,x,x.next)>=0)return !1;if(x=x.prevZ,v.x>=p&&v.x<=m&&v.y>=f&&v.y<=_&&v!==r&&v!==a&&sv(s,u,l,h,c,d,v.x,v.y)&&cv(v.prev,v,v.next)>=0)return !1;v=v.nextZ;}for(;x&&x.z>=g;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=_&&x!==r&&x!==a&&sv(s,u,l,h,c,d,x.x,x.y)&&cv(x.prev,x,x.next)>=0)return !1;x=x.prevZ;}for(;v&&v.z<=y;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=_&&v!==r&&v!==a&&sv(s,u,l,h,c,d,v.x,v.y)&&cv(v.prev,v,v.next)>=0)return !1;v=v.nextZ;}return !0}function ev(e,t,i){var n=e;do{var r=n.prev,o=n.next.next;!uv(r,o)&&hv(r,n,n.next,o)&&fv(r,o)&&fv(o,r)&&(t.push(r.i/i|0),t.push(n.i/i|0),t.push(o.i/i|0),gv(n),gv(n.next),n=e=o),n=n.next;}while(n!==e);return Zx(n)}function tv(e,t,i,n,r,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&lv(a,s)){var l=mv(a,s);return a=Zx(a,a.next),l=Zx(l,l.next),Kx(a,t,i,n,r,o,0),void Kx(l,t,i,n,r,o,0)}s=s.next;}a=a.next;}while(a!==e)}function iv(e,t){return e.x-t.x}function nv(e,t){var i=function(e,t){var i,n=t,r=e.x,o=e.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=r&&s>a&&(a=s,i=n.x<n.next.x?n:n.next,s===r))return i}n=n.next;}while(n!==t);if(!i)return null;var l,c=i,u=i.x,h=i.y,d=1/0;n=i;do{r>=n.x&&n.x>=u&&r!==n.x&&sv(o<h?r:a,o,u,h,o<h?a:r,o,n.x,n.y)&&(l=Math.abs(o-n.y)/(r-n.x),fv(n,e)&&(l<d||l===d&&(n.x>i.x||n.x===i.x&&rv(i,n)))&&(i=n,d=l)),n=n.next;}while(n!==c);return i}(e,t);if(!i)return t;var n=mv(i,e);return Zx(n,n.next),Zx(i,i.next)}function rv(e,t){return cv(e.prev,e,t.prev)<0&&cv(t.next,e,e.next)<0}function ov(e,t,i,n,r){return (e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function av(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;}while(t!==e);return i}function sv(e,t,i,n,r,o,a,s){return (r-a)*(t-s)>=(e-a)*(o-s)&&(e-a)*(n-s)>=(i-a)*(t-s)&&(i-a)*(o-s)>=(r-a)*(n-s)}function lv(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&hv(i,i.next,e,t))return !0;i=i.next;}while(i!==e);return !1}(e,t)&&(fv(e,t)&&fv(t,e)&&function(e,t){var i=e,n=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;}while(i!==e);return n}(e,t)&&(cv(e.prev,e,t.prev)||cv(e,t.prev,t))||uv(e,t)&&cv(e.prev,e,e.next)>0&&cv(t.prev,t,t.next)>0)}function cv(e,t,i){return (t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function uv(e,t){return e.x===t.x&&e.y===t.y}function hv(e,t,i,n){var r=pv(cv(e,t,i)),o=pv(cv(e,t,n)),a=pv(cv(i,n,e)),s=pv(cv(i,n,t));return r!==o&&a!==s||!(0!==r||!dv(e,i,t))||!(0!==o||!dv(e,n,t))||!(0!==a||!dv(i,e,n))||!(0!==s||!dv(i,t,n))}function dv(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function pv(e){return e>0?1:e<0?-1:0}function fv(e,t){return cv(e.prev,e,e.next)<0?cv(e,t,e.next)>=0&&cv(e,e.prev,t)>=0:cv(e,t,e.prev)<0||cv(e,e.next,t)<0}function mv(e,t){var i=new yv(e.i,e.x,e.y),n=new yv(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function _v(e,t,i,n){var r=new yv(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function gv(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ);}function yv(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1;}function xv(e,t,i,n){for(var r=0,o=t,a=i-n;o<i;o+=n)r+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return r}function vv(e,t,i,n,r){wv(e,t,i||0,n||e.length-1,r||bv);}function wv(e,t,i,n,r){for(;n>i;){if(n-i>600){var o=n-i+1,a=t-i+1,s=Math.log(o),l=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*l*(o-l)/o)*(a-o/2<0?-1:1);wv(e,t,Math.max(i,Math.floor(t-a*l/o+c)),Math.min(n,Math.floor(t+(o-a)*l/o+c)),r);}var u=e[t],h=i,d=n;for(Tv(e,i,t),r(e[n],u)>0&&Tv(e,i,n);h<d;){for(Tv(e,h,d),h++,d--;r(e[h],u)<0;)h++;for(;r(e[d],u)>0;)d--;}0===r(e[i],u)?Tv(e,i,d):Tv(e,++d,n),d<=t&&(i=d+1),t<=d&&(n=d-1);}}function Tv(e,t,i){var n=e[t];e[t]=e[i],e[i]=n;}function bv(e,t){return e<t?-1:e>t?1:0}function Pv(e,t){const i=e.length;if(i<=1)return [e];const n=[];let r,o;for(let t=0;t<i;t++){const i=Ze(e[t]);0!==i&&(e[t].area=Math.abs(i),void 0===o&&(o=i<0),o===i<0?(r&&n.push(r),r=[e[t]]):r.push(e[t]));}if(r&&n.push(r),t>1)for(let e=0;e<n.length;e++)n[e].length<=t||(vv(n[e],t,1,n[e].length-1,Sv),n[e]=n[e].slice(0,t));return n}function Sv(e,t){return t.area-e.area}function Av(e,t,i,n,r,o){if(r>=t&&o<=i)return e;if(r>i||o<t)return null;const a=[];for(let r=0;r<e.length;r++){const o=e[r],s=o.geometry,l=o.type,c=o.min[n],u=o.max[n];if(c>=t&&u<=i){a.push(o);continue}if(c>i||u<t)continue;const h="Point"===l?Ev(s,t,i,n):Cv(s,t,i,n,0===n?Nv:Rv,"Polygon"===l);h.length&&a.push(Iv(o.tags,l,h,o.id));}return a.length?a:null}function Ev(e,t,i,n){const r=[];for(let o=0;o<e.length;o++){const a=e[o],s=a[n];s>=t&&s<=i&&r.push(a);}return r}function Cv(e,t,i,n,r,o){const a=[];for(let s=0;s<e.length;s++){let l,c,u=0,h=0,d=null,p=[];const f=e[s],m=f.area,_=f.dist,g=f.outer,y=f.length;for(c=0;c<y-1;c++)l=d||f[c],d=f[c+1],u=h||l[n],h=d[n],u<t?h>i?(p.push(r(l,d,t),r(l,d,i)),o||(p=Mv(a,p,m,_,g))):h>=t&&p.push(r(l,d,t)):u>i?h<t?(p.push(r(l,d,i),r(l,d,t)),o||(p=Mv(a,p,m,_,g))):h<=i&&p.push(r(l,d,i)):(p.push(l),h<t?(p.push(r(l,d,t)),o||(p=Mv(a,p,m,_,g))):h>i&&(p.push(r(l,d,i)),o||(p=Mv(a,p,m,_,g))));l=f[y-1],u=l[n],u>=t&&u<=i&&p.push(l);const x=p[p.length-1];o&&x&&(p[0][0]!==x[0]||p[0][1]!==x[1])&&p.push(p[0]),Mv(a,p,m,_,g);}return a}function Mv(e,t,i,n,r){return t.length&&(t.area=i,t.dist=n,void 0!==r&&(t.outer=r),e.push(t)),[]}function Iv(e,t,i,n){const r={id:n||null,type:t,geometry:i,tags:e||null,min:[1/0,1/0],max:[-1/0,-1/0]};return function(e){const t=e.geometry,i=e.min,n=e.max;if(1===e.type)Lv(i,n,t);else for(let e=0;e<t.length;e++)Lv(i,n,t[e]);}(r),r}function Lv(e,t,i){for(let n,r=0;r<i.length;r++)n=i[r],e[0]=Math.min(n[0],e[0]),t[0]=Math.max(n[0],t[0]),e[1]=Math.min(n[1],e[1]),t[1]=Math.max(n[1],t[1]);}function Nv(e,t,i){return [i,(i-e[0])*(t[1]-e[1])/(t[0]-e[0])+e[1]]}function Rv(e,t,i){return [(i-e[1])*(t[0]-e[0])/(t[1]-e[1])+e[0],i]}function Ov(e,t,i,n,r,o,a){if(!(e>1))return a.push(...o);{const s=Av(o,t,t+(i-t)/2,0,0,8192),l=Av(o,t+(i-t)/2,i,0,0,8192);if(s){const o=Av(s,n,n+(r-n)/2,1,0,8192),l=Av(s,n+(r-n)/2,r,1,0,8192);o&&Ov(e-1,t,t+(i-t)/2,n,n+(r-n)/2,o,a),l&&Ov(e-1,t,t+(i-t)/2,n+(r-n)/2,r,l,a);}if(l){const o=Av(l,n,n+(r-n)/2,1,0,8192),s=Av(l,n+(r-n)/2,r,1,0,8192);o&&Ov(e-1,t+(i-t)/2,i,n,n+(r-n)/2,o,a),s&&Ov(e-1,t+(i-t)/2,i,n+(r-n)/2,r,s,a);}}}function Dv(e,t,i){if(e&&e.length<=0)return [];const n=[];n.push(new Vv(new te(0,0),new te(8192,0))),n.push(new Vv(new te(8192,0),new te(8192,8192))),n.push(new Vv(new te(8192,8192),new te(0,8192))),n.push(new Vv(new te(0,8192),new te(0,0))),t=t||n;let r,o=[],a=[],s=e[e.length-1];for(let t=0;t<e.length;t++)o.push(e[t]);for(const e in t){s=o[o.length-1],r=!Fv(s,t[e]);for(let i=0;i<o.length;i++)Fv(o[i],t[e])?(r&&(r=!1,a.push(Bv(s,o[i],t[e].start,t[e].end))),a.push(o[i])):r||(r=!0,a.push(Bv(s,o[i],t[e].start,t[e].end))),s=o[i];o=[];for(let e=0;e<a.length;e++)o.push(a[e]);a=[];}return o.push(i?o[0]:o[o.length-1]),o}function Fv(e,t){return !!e&&zv(e,t.start,t.end)>=0}function zv(e,t,i){return (i.x-t.x)*(e.y-t.y)-(i.y-t.y)*(e.x-t.x)}function Bv(e,t,i,n){const r=(zv(e,n,i)*t.x-zv(t,n,i)*e.x)/(zv(e,n,i)-zv(t,n,i)),o=(zv(e,n,i)*t.y-zv(t,n,i)*e.y)/(zv(e,n,i)-zv(t,n,i));return new te(r,o)}function Vv(e,t){this.start=e,this.end=t;}Wx.deviation=function(e,t,i,n){var r=t&&t.length,o=Math.abs(xv(e,0,r?t[0]*i:e.length,i));if(r)for(var a=0,s=t.length;a<s;a++)o-=Math.abs(xv(e,t[a]*i,a<s-1?t[a+1]*i:e.length,i));var l=0;for(a=0;a<n.length;a+=3){var c=n[a]*i,u=n[a+1]*i,h=n[a+2]*i;l+=Math.abs((e[c]-e[h])*(e[u+1]-e[c+1])-(e[c]-e[u])*(e[h+1]-e[c+1]));}return 0===o&&0===l?0:Math.abs((l-o)/o)},Wx.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},n=0,r=0;r<e.length;r++){for(var o=0;o<e[r].length;o++)for(var a=0;a<t;a++)i.vertices.push(e[r][o][a]);r>0&&i.holes.push(n+=e[r-1].length);}return i},Xx.default=jx;const Uv={};function kv(e){let t=8-e;return t<0&&(t=0),t}Uv.clipTriangleAtAxisAlignedThreshold=function(e,t,i,n,r,o){let a,s,l;o.length=0,t?(a=i<e,s=n<e,l=r<e):(a=i>e,s=n>e,l=r>e);const c=a+s+l;let u,h,d,p,f,m;return 1===c?a?(u=(e-i)/(n-i),h=(e-i)/(r-i),o.push(1),o.push(2),1!==h&&(o.push(-1),o.push(0),o.push(2),o.push(h)),1!==u&&(o.push(-1),o.push(0),o.push(1),o.push(u))):s?(d=(e-n)/(r-n),p=(e-n)/(i-n),o.push(2),o.push(0),1!==p&&(o.push(-1),o.push(1),o.push(0),o.push(p)),1!==d&&(o.push(-1),o.push(1),o.push(2),o.push(d))):l&&(f=(e-r)/(i-r),m=(e-r)/(n-r),o.push(0),o.push(1),1!==m&&(o.push(-1),o.push(2),o.push(1),o.push(m)),1!==f&&(o.push(-1),o.push(2),o.push(0),o.push(f))):2===c?a||i===e?s||n===e?l||r===e||(h=(e-i)/(r-i),d=(e-n)/(r-n),o.push(2),o.push(-1),o.push(0),o.push(2),o.push(h),o.push(-1),o.push(1),o.push(2),o.push(d)):(m=(e-r)/(n-r),u=(e-i)/(n-i),o.push(1),o.push(-1),o.push(2),o.push(1),o.push(m),o.push(-1),o.push(0),o.push(1),o.push(u)):(p=(e-n)/(i-n),f=(e-r)/(i-r),o.push(0),o.push(-1),o.push(1),o.push(0),o.push(p),o.push(-1),o.push(2),o.push(0),o.push(f)):3!==c&&(o.push(0),o.push(1),o.push(2)),o},Uv.computeBarycentricCoordinates=function(e,t,i,n,r,o,a,s,l){const c=i-a,u=a-r,h=o-s,d=n-s,p=1/(h*c+u*d),f=t-s,m=e-a,_=(h*m+u*f)*p,g=(-d*m+c*f)*p,y=1-_-g;return l?(l.x=_,l.y=g,l.z=y,l):{x:_,y:g,z:y}},Uv.computeLineSegmentLineSegmentIntersection=function(e,t,i,n,r,o,a,s,l){const c=(s-o)*(i-e)-(a-r)*(n-t);if(0===c)return;const u=((a-r)*(t-o)-(s-o)*(e-r))/c,h=((i-e)*(t-o)-(n-t)*(e-r))/c;return u>=0&&u<=1&&h>=0&&h<=1?(l.x=e+u*(i-e),l.y=t+u*(n-t),l):void 0},Uv.featureInsect=function(e,t){let i=!1;const n=t.filter((t=>t.index!=e.index));return !!(e.feature&&e.feature._feature&&e.feature._feature.geometry)&&(e.feature._feature.geometry.forEach((e=>{for(let t=0;t<e.length-1;t++)if(Uv.geometryInsect(e[t],e[t+1],n))return void(i=!0)})),i)},Uv.geometryInsect=function(e,t,i){let n=!1;return i.forEach((i=>{i.feature._feature.geometry.forEach((i=>{for(let r=0;r<i.length-1;r++){const o=i[r],a=i[r+1];if(Uv.computeLineSegmentLineSegmentIntersection(e[0],e[1],t[0],t[1],o[0],o[1],a[0],a[1],new It))return void(n=!0)}}));})),n};const Gv=Math.pow(2,7);function Hv(e,t,i,n,r,o,a){const s=vl(t,i,0,r,o,n,a);e[0]=s[0],e[1]=s[1],e[2]=s[2];}function Yv(e){if(!e)throw new Error("geojson is required");var t=[];return ve(e,(function(e){!function(e,t){var i=[],n=e.geometry;if(null!==n){switch(n.type){case"Polygon":i=fe(n);break;case"LineString":i=[fe(n)];}i.forEach((function(i){var n=function(e,t){var i=[];return e.reduce((function(e,n){var r,o,a,s,l,c,u=se([e,n],t);return u.bbox=[(a=(r=e)[0])<(l=(o=n)[0])?a:l,(s=r[1])<(c=o[1])?s:c,a>l?a:l,s>c?s:c],i.push(u),n})),i}(i,e.properties);n.forEach((function(e){e.id=t.length,t.push(e);}));}));}}(e,t);})),le(t)}var qv=$h((function(e,t){e.exports=function(){function e(e,n,r,o,a){!function e(i,n,r,o,a){for(;o>r;){if(o-r>600){var s=o-r+1,l=n-r+1,c=Math.log(s),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(s-u)/s)*(l-s/2<0?-1:1);e(i,n,Math.max(r,Math.floor(n-l*u/s+h)),Math.min(o,Math.floor(n+(s-l)*u/s+h)),a);}var d=i[n],p=r,f=o;for(t(i,r,n),a(i[o],d)>0&&t(i,r,o);p<f;){for(t(i,p,f),p++,f--;a(i[p],d)<0;)p++;for(;a(i[f],d)>0;)f--;}0===a(i[r],d)?t(i,r,f):t(i,++f,o),f<=n&&(r=f+1),n<=f&&(o=f-1);}}(e,n,r||0,o||e.length-1,a||i);}function t(e,t,i){var n=e[t];e[t]=e[i],e[i]=n;}function i(e,t){return e<t?-1:e>t?1:0}var n=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear();};function r(e,t,i){if(!i)return t.indexOf(e);for(var n=0;n<t.length;n++)if(i(e,t[n]))return n;return -1}function o(e,t){a(e,0,e.children.length,t,e);}function a(e,t,i,n,r){r||(r=f(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var o=t;o<i;o++){var a=e.children[o];s(r,e.leaf?n(a):a);}return r}function s(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function u(e){return (e.maxX-e.minX)*(e.maxY-e.minY)}function h(e){return e.maxX-e.minX+(e.maxY-e.minY)}function d(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function p(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function f(e){return {children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(t,i,n,r,o){for(var a=[i,n];a.length;)if(!((n=a.pop())-(i=a.pop())<=r)){var s=i+Math.ceil((n-i)/r/2)*r;e(t,s,i,n,o),a.push(i,s,s,n);}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(e){var t=this.data,i=[];if(!p(e,t))return i;for(var n=this.toBBox,r=[];t;){for(var o=0;o<t.children.length;o++){var a=t.children[o],s=t.leaf?n(a):a;p(e,s)&&(t.leaf?i.push(a):d(e,s)?this._all(a,i):r.push(a));}t=r.pop();}return i},n.prototype.collides=function(e){var t=this.data;if(!p(e,t))return !1;for(var i=[];t;){for(var n=0;n<t.children.length;n++){var r=t.children[n],o=t.leaf?this.toBBox(r):r;if(p(e,o)){if(t.leaf||d(e,o))return !0;i.push(r);}}t=i.pop();}return !1},n.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var i=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else {if(this.data.height<i.height){var n=this.data;this.data=i,i=n;}this._insert(i,this.data.height-i.height-1,!0);}else this.data=i;return this},n.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},n.prototype.clear=function(){return this.data=f([]),this},n.prototype.remove=function(e,t){if(!e)return this;for(var i,n,o,a=this.data,s=this.toBBox(e),l=[],c=[];a||l.length;){if(a||(a=l.pop(),n=l[l.length-1],i=c.pop(),o=!0),a.leaf){var u=r(e,a.children,t);if(-1!==u)return a.children.splice(u,1),l.push(a),this._condense(l),this}o||a.leaf||!d(a,s)?n?(i++,a=n.children[i],o=!1):a=null:(l.push(a),c.push(i),i=0,n=a,a=a.children[0]);}return this},n.prototype.toBBox=function(e){return e},n.prototype.compareMinX=function(e,t){return e.minX-t.minX},n.prototype.compareMinY=function(e,t){return e.minY-t.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(e){return this.data=e,this},n.prototype._all=function(e,t){for(var i=[];e;)e.leaf?t.push.apply(t,e.children):i.push.apply(i,e.children),e=i.pop();return t},n.prototype._build=function(e,t,i,n){var r,a=i-t+1,s=this._maxEntries;if(a<=s)return o(r=f(e.slice(t,i+1)),this.toBBox),r;n||(n=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,n-1))),(r=f([])).leaf=!1,r.height=n;var l=Math.ceil(a/s),c=l*Math.ceil(Math.sqrt(s));m(e,t,i,c,this.compareMinX);for(var u=t;u<=i;u+=c){var h=Math.min(u+c-1,i);m(e,u,h,l,this.compareMinY);for(var d=u;d<=h;d+=l){var p=Math.min(d+l-1,h);r.children.push(this._build(e,d,p,n-1));}}return o(r,this.toBBox),r},n.prototype._chooseSubtree=function(e,t,i,n){for(;n.push(t),!t.leaf&&n.length-1!==i;){for(var r=1/0,o=1/0,a=void 0,s=0;s<t.children.length;s++){var l=t.children[s],c=u(l),h=(d=e,p=l,(Math.max(p.maxX,d.maxX)-Math.min(p.minX,d.minX))*(Math.max(p.maxY,d.maxY)-Math.min(p.minY,d.minY))-c);h<o?(o=h,r=c<r?c:r,a=l):h===o&&c<r&&(r=c,a=l);}t=a||t.children[0];}var d,p;return t},n.prototype._insert=function(e,t,i){var n=i?e:this.toBBox(e),r=[],o=this._chooseSubtree(n,this.data,t,r);for(o.children.push(e),s(o,n);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(n,r,t);},n.prototype._split=function(e,t){var i=e[t],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);var a=this._chooseSplitIndex(i,r,n),s=f(i.children.splice(a,i.children.length-a));s.height=i.height,s.leaf=i.leaf,o(i,this.toBBox),o(s,this.toBBox),t?e[t-1].children.push(s):this._splitRoot(i,s);},n.prototype._splitRoot=function(e,t){this.data=f([e,t]),this.data.height=e.height+1,this.data.leaf=!1,o(this.data,this.toBBox);},n.prototype._chooseSplitIndex=function(e,t,i){for(var n,r,o,s,l,c,h,d=1/0,p=1/0,f=t;f<=i-t;f++){var m=a(e,0,f,this.toBBox),_=a(e,f,i,this.toBBox),g=(r=m,o=_,s=Math.max(r.minX,o.minX),l=Math.max(r.minY,o.minY),c=Math.min(r.maxX,o.maxX),h=Math.min(r.maxY,o.maxY),Math.max(0,c-s)*Math.max(0,h-l)),y=u(m)+u(_);g<d?(d=g,n=f,p=y<p?y:p):g===d&&y<p&&(p=y,n=f);}return n||i-t},n.prototype._chooseSplitAxis=function(e,t,i){var n=e.leaf?this.compareMinX:l,r=e.leaf?this.compareMinY:c;this._allDistMargin(e,t,i,n)<this._allDistMargin(e,t,i,r)&&e.children.sort(n);},n.prototype._allDistMargin=function(e,t,i,n){e.children.sort(n);for(var r=this.toBBox,o=a(e,0,t,r),l=a(e,i-t,i,r),c=h(o)+h(l),u=t;u<i-t;u++){var d=e.children[u];s(o,e.leaf?r(d):d),c+=h(o);}for(var p=i-t-1;p>=t;p--){var f=e.children[p];s(l,e.leaf?r(f):f),c+=h(l);}return c},n.prototype._adjustParentBBoxes=function(e,t,i){for(var n=i;n>=0;n--)s(t[n],e);},n.prototype._condense=function(e){for(var t=e.length-1,i=void 0;t>=0;t--)0===e[t].children.length?t>0?(i=e[t-1].children).splice(i.indexOf(e[t]),1):this.clear():o(e[t],this.toBBox);},n}();})),Xv=$h((function(e,t){function i(e,t,i){void 0===i&&(i={});var n={type:"Feature"};return (0===i.id||i.id)&&(n.id=i.id),i.bbox&&(n.bbox=i.bbox),n.properties=t||{},n.geometry=e,n}function n(e,t,n){if(void 0===n&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!p(e[0])||!p(e[1]))throw new Error("coordinates must contain numbers");return i({type:"Point",coordinates:e},t,n)}function r(e,t,n){void 0===n&&(n={});for(var r=0,o=e;r<o.length;r++){var a=o[r];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<a[a.length-1].length;s++)if(a[a.length-1][s]!==a[0][s])throw new Error("First and last Position are not equivalent.")}return i({type:"Polygon",coordinates:e},t,n)}function o(e,t,n){if(void 0===n&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return i({type:"LineString",coordinates:e},t,n)}function a(e,t){void 0===t&&(t={});var i={type:"FeatureCollection"};return t.id&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.features=e,i}function s(e,t,n){return void 0===n&&(n={}),i({type:"MultiLineString",coordinates:e},t,n)}function l(e,t,n){return void 0===n&&(n={}),i({type:"MultiPoint",coordinates:e},t,n)}function c(e,t,n){return void 0===n&&(n={}),i({type:"MultiPolygon",coordinates:e},t,n)}function u(e,i){void 0===i&&(i="kilometers");var n=t.factors[i];if(!n)throw new Error(i+" units is invalid");return e*n}function h(e,i){void 0===i&&(i="kilometers");var n=t.factors[i];if(!n)throw new Error(i+" units is invalid");return e/n}function d(e){return e%(2*Math.PI)*180/Math.PI}function p(e){return !isNaN(e)&&null!==e&&!Array.isArray(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.earthRadius=6371008.8,t.factors={centimeters:100*t.earthRadius,centimetres:100*t.earthRadius,degrees:t.earthRadius/111325,feet:3.28084*t.earthRadius,inches:39.37*t.earthRadius,kilometers:t.earthRadius/1e3,kilometres:t.earthRadius/1e3,meters:t.earthRadius,metres:t.earthRadius,miles:t.earthRadius/1609.344,millimeters:1e3*t.earthRadius,millimetres:1e3*t.earthRadius,nauticalmiles:t.earthRadius/1852,radians:1,yards:1.0936*t.earthRadius},t.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/t.earthRadius,yards:1.0936133},t.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},t.feature=i,t.geometry=function(e,t,i){switch(e){case"Point":return n(t).geometry;case"LineString":return o(t).geometry;case"Polygon":return r(t).geometry;case"MultiPoint":return l(t).geometry;case"MultiLineString":return s(t).geometry;case"MultiPolygon":return c(t).geometry;default:throw new Error(e+" is invalid")}},t.point=n,t.points=function(e,t,i){return void 0===i&&(i={}),a(e.map((function(e){return n(e,t)})),i)},t.polygon=r,t.polygons=function(e,t,i){return void 0===i&&(i={}),a(e.map((function(e){return r(e,t)})),i)},t.lineString=o,t.lineStrings=function(e,t,i){return void 0===i&&(i={}),a(e.map((function(e){return o(e,t)})),i)},t.featureCollection=a,t.multiLineString=s,t.multiPoint=l,t.multiPolygon=c,t.geometryCollection=function(e,t,n){return void 0===n&&(n={}),i({type:"GeometryCollection",geometries:e},t,n)},t.round=function(e,t){if(void 0===t&&(t=0),t&&!(t>=0))throw new Error("precision must be a positive number");var i=Math.pow(10,t||0);return Math.round(e*i)/i},t.radiansToLength=u,t.lengthToRadians=h,t.lengthToDegrees=function(e,t){return d(h(e,t))},t.bearingToAzimuth=function(e){var t=e%360;return t<0&&(t+=360),t},t.radiansToDegrees=d,t.degreesToRadians=function(e){return e%360*Math.PI/180},t.convertLength=function(e,t,i){if(void 0===t&&(t="kilometers"),void 0===i&&(i="kilometers"),!(e>=0))throw new Error("length must be a positive number");return u(h(e,t),i)},t.convertArea=function(e,i,n){if(void 0===i&&(i="meters"),void 0===n&&(n="kilometers"),!(e>=0))throw new Error("area must be a positive number");var r=t.areaFactors[i];if(!r)throw new Error("invalid original units");var o=t.areaFactors[n];if(!o)throw new Error("invalid final units");return e/r*o},t.isNumber=p,t.isObject=function(e){return !!e&&e.constructor===Object},t.validateBBox=function(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(4!==e.length&&6!==e.length)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach((function(e){if(!p(e))throw new Error("bbox must only contain numbers")}));},t.validateId=function(e){if(!e)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof e))throw new Error("id must be a number or a string")};})),jv=Xv;function Wv(e,t,i){if(null!==e)for(var n,r,o,a,s,l,c,u,h=0,d=0,p=e.type,f="FeatureCollection"===p,m="Feature"===p,_=f?e.features.length:1,g=0;g<_;g++){s=(u=!!(c=f?e.features[g].geometry:m?e.geometry:e)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var y=0;y<s;y++){var x=0,v=0;if(null!==(a=u?c.geometries[y]:c)){l=a.coordinates;var w=a.type;switch(h=!i||"Polygon"!==w&&"MultiPolygon"!==w?0:1,w){case null:break;case"Point":if(!1===t(l,d,g,x,v))return !1;d++,x++;break;case"LineString":case"MultiPoint":for(n=0;n<l.length;n++){if(!1===t(l[n],d,g,x,v))return !1;d++,"MultiPoint"===w&&x++;}"LineString"===w&&x++;break;case"Polygon":case"MultiLineString":for(n=0;n<l.length;n++){for(r=0;r<l[n].length-h;r++){if(!1===t(l[n][r],d,g,x,v))return !1;d++;}"MultiLineString"===w&&x++,"Polygon"===w&&v++;}"Polygon"===w&&x++;break;case"MultiPolygon":for(n=0;n<l.length;n++){for(v=0,r=0;r<l[n].length;r++){for(o=0;o<l[n][r].length-h;o++){if(!1===t(l[n][r][o],d,g,x,v))return !1;d++;}v++;}x++;}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)if(!1===Wv(a.geometries[n],t,i))return !1;break;default:throw new Error("Unknown Geometry Type")}}}}}function $v(e,t){var i;switch(e.type){case"FeatureCollection":for(i=0;i<e.features.length&&!1!==t(e.features[i].properties,i);i++);break;case"Feature":t(e.properties,0);}}function Zv(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var i=0;i<e.features.length&&!1!==t(e.features[i],i);i++);}function Kv(e,t){var i,n,r,o,a,s,l,c,u,h,d=0,p="FeatureCollection"===e.type,f="Feature"===e.type,m=p?e.features.length:1;for(i=0;i<m;i++){for(c=p?e.features[i].properties:f?e.properties:{},u=p?e.features[i].bbox:f?e.bbox:void 0,h=p?e.features[i].id:f?e.id:void 0,a=(l=!!(s=p?e.features[i].geometry:f?e.geometry:e)&&"GeometryCollection"===s.type)?s.geometries.length:1,r=0;r<a;r++)if(null!==(o=l?s.geometries[r]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,d,c,u,h))return !1;break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(!1===t(o.geometries[n],d,c,u,h))return !1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,d,c,u,h))return !1;d++;}}function Qv(e,t){Kv(e,(function(e,i,n,r,o){var a,s=null===e?null:e.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return !1!==t(jv.feature(e,n,{bbox:r,id:o}),i,0)&&void 0}switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";}for(var l=0;l<e.coordinates.length;l++)if(!1===t(jv.feature({type:a,coordinates:e.coordinates[l]},n),i,l))return !1}));}function Jv(e,t){Qv(e,(function(e,i,n){var r=0;if(e.geometry){var o=e.geometry.type;if("Point"!==o&&"MultiPoint"!==o){var a,s=0,l=0,c=0;return !1!==Wv(e,(function(o,u,h,d,p){if(void 0===a||i>s||d>l||p>c)return a=o,s=i,l=d,c=p,void(r=0);var f=jv.lineString([a,o],e.properties);if(!1===t(f,i,n,p,r))return !1;r++,a=o;}))&&void 0}}}));}function ew(e,t){if(!e)throw new Error("geojson is required");Qv(e,(function(e,i,n){if(null!==e.geometry){var r=e.geometry.coordinates;switch(e.geometry.type){case"LineString":if(!1===t(e,i,n,0,0))return !1;break;case"Polygon":for(var o=0;o<r.length;o++)if(!1===t(jv.lineString(r[o],e.properties),i,n,o))return !1}}}));}var tw=Object.defineProperty({coordAll:function(e){var t=[];return Wv(e,(function(e){t.push(e);})),t},coordEach:Wv,coordReduce:function(e,t,i,n){var r=i;return Wv(e,(function(e,n,o,a,s){r=0===n&&void 0===i?e:t(r,e,n,o,a,s);}),n),r},featureEach:Zv,featureReduce:function(e,t,i){var n=i;return Zv(e,(function(e,r){n=0===r&&void 0===i?e:t(n,e,r);})),n},findPoint:function(e,t){if(!jv.isObject(t=t||{}))throw new Error("options is invalid");var i,n=t.featureIndex||0,r=t.multiFeatureIndex||0,o=t.geometryIndex||0,a=t.coordIndex||0,s=t.properties;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),s=s||e.features[n].properties,i=e.features[n].geometry;break;case"Feature":s=s||e.properties,i=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":i=e;break;default:throw new Error("geojson is invalid")}if(null===i)return null;var l=i.coordinates;switch(i.type){case"Point":return jv.point(l,s,t);case"MultiPoint":return r<0&&(r=l.length+r),jv.point(l[r],s,t);case"LineString":return a<0&&(a=l.length+a),jv.point(l[a],s,t);case"Polygon":return o<0&&(o=l.length+o),a<0&&(a=l[o].length+a),jv.point(l[o][a],s,t);case"MultiLineString":return r<0&&(r=l.length+r),a<0&&(a=l[r].length+a),jv.point(l[r][a],s,t);case"MultiPolygon":return r<0&&(r=l.length+r),o<0&&(o=l[r].length+o),a<0&&(a=l[r][o].length-a),jv.point(l[r][o][a],s,t)}throw new Error("geojson is invalid")},findSegment:function(e,t){if(!jv.isObject(t=t||{}))throw new Error("options is invalid");var i,n=t.featureIndex||0,r=t.multiFeatureIndex||0,o=t.geometryIndex||0,a=t.segmentIndex||0,s=t.properties;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),s=s||e.features[n].properties,i=e.features[n].geometry;break;case"Feature":s=s||e.properties,i=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":i=e;break;default:throw new Error("geojson is invalid")}if(null===i)return null;var l=i.coordinates;switch(i.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=l.length+a-1),jv.lineString([l[a],l[a+1]],s,t);case"Polygon":return o<0&&(o=l.length+o),a<0&&(a=l[o].length+a-1),jv.lineString([l[o][a],l[o][a+1]],s,t);case"MultiLineString":return r<0&&(r=l.length+r),a<0&&(a=l[r].length+a-1),jv.lineString([l[r][a],l[r][a+1]],s,t);case"MultiPolygon":return r<0&&(r=l.length+r),o<0&&(o=l[r].length+o),a<0&&(a=l[r][o].length-a-1),jv.lineString([l[r][o][a],l[r][o][a+1]],s,t)}throw new Error("geojson is invalid")},flattenEach:Qv,flattenReduce:function(e,t,i){var n=i;return Qv(e,(function(e,r,o){n=0===r&&0===o&&void 0===i?e:t(n,e,r,o);})),n},geomEach:Kv,geomReduce:function(e,t,i){var n=i;return Kv(e,(function(e,r,o,a,s){n=0===r&&void 0===i?e:t(n,e,r,o,a,s);})),n},lineEach:ew,lineReduce:function(e,t,i){var n=i;return ew(e,(function(e,r,o,a){n=0===r&&void 0===i?e:t(n,e,r,o,a);})),n},propEach:$v,propReduce:function(e,t,i){var n=i;return $v(e,(function(e,r){n=0===r&&void 0===i?e:t(n,e,r);})),n},segmentEach:Jv,segmentReduce:function(e,t,i){var n=i,r=!1;return Jv(e,(function(e,o,a,s,l){n=!1===r&&void 0===i?e:t(n,e,o,a,s,l),r=!0;})),n}},"__esModule",{value:!0});function iw(e){var t=[1/0,1/0,-1/0,-1/0];return tw.coordEach(e,(function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1]);})),t}iw.default=iw;var nw=Object.defineProperty({default:iw},"__esModule",{value:!0}).default,rw=tw.featureEach,ow=jv.featureCollection;function aw(e){var t=new qv(e);return t.insert=function(e){if("Feature"!==e.type)throw new Error("invalid feature");return e.bbox=e.bbox?e.bbox:nw(e),qv.prototype.insert.call(this,e)},t.load=function(e){var t=[];return Array.isArray(e)?e.forEach((function(e){if("Feature"!==e.type)throw new Error("invalid features");e.bbox=e.bbox?e.bbox:nw(e),t.push(e);})):rw(e,(function(e){if("Feature"!==e.type)throw new Error("invalid features");e.bbox=e.bbox?e.bbox:nw(e),t.push(e);})),qv.prototype.load.call(this,t)},t.remove=function(e,t){if("Feature"!==e.type)throw new Error("invalid feature");return e.bbox=e.bbox?e.bbox:nw(e),qv.prototype.remove.call(this,e,t)},t.clear=function(){return qv.prototype.clear.call(this)},t.search=function(e){var t=qv.prototype.search.call(this,this.toBBox(e));return ow(t)},t.collides=function(e){return qv.prototype.collides.call(this,this.toBBox(e))},t.all=function(){var e=qv.prototype.all.call(this);return ow(e)},t.toJSON=function(){return qv.prototype.toJSON.call(this)},t.fromJSON=function(e){return qv.prototype.fromJSON.call(this,e)},t.toBBox=function(e){var t;if(e.bbox)t=e.bbox;else if(Array.isArray(e)&&4===e.length)t=e;else if(Array.isArray(e)&&6===e.length)t=[e[0],e[1],e[3],e[4]];else if("Feature"===e.type)t=nw(e);else {if("FeatureCollection"!==e.type)throw new Error("invalid geojson");t=nw(e);}return {minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}},t}var sw=aw;function lw(e,t){var i={},n=[];if("LineString"===e.type&&(e=oe(e)),"LineString"===t.type&&(t=oe(t)),"Feature"===e.type&&"Feature"===t.type&&null!==e.geometry&&null!==t.geometry&&"LineString"===e.geometry.type&&"LineString"===t.geometry.type&&2===e.geometry.coordinates.length&&2===t.geometry.coordinates.length){var r=cw(e,t);return r&&n.push(r),le(n)}var o=sw();return o.load(Yv(t)),xe(Yv(e),(function(e){xe(o.search(e),(function(t){var r=cw(e,t);if(r){var o=fe(r).join(",");i[o]||(i[o]=!0,n.push(r));}}));})),le(n)}function cw(e,t){var i=fe(e),n=fe(t);if(2!==i.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==n.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var r=i[0][0],o=i[0][1],a=i[1][0],s=i[1][1],l=n[0][0],c=n[0][1],u=n[1][0],h=n[1][1],d=(h-c)*(a-r)-(u-l)*(s-o);if(0===d)return null;var p=((u-l)*(o-c)-(h-c)*(r-l))/d,f=((a-r)*(o-c)-(s-o)*(r-l))/d;return p>=0&&p<=1&&f>=0&&f<=1?ae([r+p*(a-r),o+p*(s-o)]):null}function uw(e){let t=0,i=0;for(const n of e)t+=n.w*n.h,i=Math.max(i,n.w);e.sort(((e,t)=>t.h-e.h));const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let r=0,o=0;for(const t of e)for(let e=n.length-1;e>=0;e--){const i=n[e];if(!(t.w>i.w||t.h>i.h)){if(t.x=i.x,t.y=i.y,o=Math.max(o,t.y+t.h),r=Math.max(r,t.x+t.w),t.w===i.w&&t.h===i.h){const t=n.pop();e<n.length&&(n[e]=t);}else t.h===i.h?(i.x+=t.w,i.w-=t.w):t.w===i.w?(i.y+=t.h,i.h-=t.h):(n.push({x:i.x+t.w,y:i.y,w:i.w-t.w,h:t.h}),i.y+=t.h,i.h-=t.h);break}}return {w:r,h:o,fill:t/(r*o)||0}}function hw(e,{width:t,height:i},n,r){if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==t*i*n)throw new RangeError("mismatched image size")}else r=new Uint8Array(t*i*n);return e.width=t,e.height=i,e.data=r,e}function dw(e,{width:t,height:i},n){if(t===e.width&&i===e.height)return;const r=hw({},{width:t,height:i},n);pw(e,r,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,t),height:Math.min(e.height,i)},n),e.width=t,e.height=i,e.data=r.data;}function pw(e,t,i,n,r,o){if(0===r.width||0===r.height)return t;if(r.width>e.width||r.height>e.height||i.x>e.width-r.width||i.y>e.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>t.width||r.height>t.height||n.x>t.width-r.width||n.y>t.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const a=e.data,s=t.data;for(let l=0;l<r.height;l++){const c=((i.y+l)*e.width+i.x)*o,u=((n.y+l)*t.width+n.x)*o;for(let e=0;e<r.width*o;e++)s[u+e]=a[c+e];}return t}sw.default=aw;class fw{constructor(e,t){hw(this,e,1,t);}resize(e){dw(this,e,1);}clone(){return new fw({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,n,r){pw(e,t,i,n,r,1);}}class mw{constructor(e,t){hw(this,e,4,t);}resize(e){dw(this,e,4);}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e;}clone(){return new mw({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,n,r){pw(e,t,i,n,r,4);}}Ho("AlphaImage",fw),Ho("RGBAImage",mw);class _w{constructor(e,{pixelRatio:t,version:i,stretchX:n,stretchY:r,content:o}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=n,this.stretchY=r,this.content=o,this.version=i;}get tl(){return [this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return [this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return [(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class gw{constructor(e,t){const i={},n={};this.haveRenderCallbacks=[];const r=[];this.addImages(e,i,r),this.addImages(t,n,r);const{w:o,h:a}=uw(r),s=new mw({width:o||1,height:a||1});for(const t in e){const n=e[t],r=i[t].paddedRect;mw.copy(n.data,s,{x:0,y:0},{x:r.x+1,y:r.y+1},n.data);}for(const e in t){const i=t[e],r=n[e].paddedRect,o=r.x+1,a=r.y+1,l=i.data.width,c=i.data.height;mw.copy(i.data,s,{x:0,y:0},{x:o,y:a},i.data),mw.copy(i.data,s,{x:0,y:c-1},{x:o,y:a-1},{width:l,height:1}),mw.copy(i.data,s,{x:0,y:0},{x:o,y:a+c},{width:l,height:1}),mw.copy(i.data,s,{x:l-1,y:0},{x:o-1,y:a},{width:1,height:c}),mw.copy(i.data,s,{x:0,y:0},{x:o+l,y:a},{width:1,height:c});}this.image=s,this.iconPositions=i,this.patternPositions=n;}addImages(e,t,i){for(const n in e){const r=e[n],o={x:0,y:0,w:r.data.width+2,h:r.data.height+2};i.push(o),t[n]=new _w(o,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(n);}}patchUpdatedImages(e,t){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const i in e.updatedImages)this.patchUpdatedImage(this.iconPositions[i],e.getImage(i),t),this.patchUpdatedImage(this.patternPositions[i],e.getImage(i),t);}patchUpdatedImage(e,t,i){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[n,r]=e.tl;i.update(t.data,void 0,{x:n,y:r});}}Ho("ImagePosition",_w),Ho("ImageAtlas",gw);const yw=1024;class xw{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.type=Ag.FILL,this.layoutVertexArray=new pa,this.layoutVertexArray2=new xa,this.indexArray=new Ia,this.indexArray2=new Na,this.programConfigurations=new tf(kx,e.layers,e.zoom),this.segments=new Ud,this.segments2=new Ud,this.projection=e.projection||ci.MERCATOR,this.vectorRenderInSpace=!1,this.classificationtype=Zd.NONE,this.layers.forEach((e=>{Kd(e.classificationType)&&(this.vectorRenderInSpace=!0,this.classificationtype=e.classificationType);})),this.maximumHeight=0,this.minimumHeight=0,this.forceUpdateSegment=!1;}_convertGeometryPointToPolygon(e){const t=[];for(let i=0;i<e.length;i++){const n=[];let r=1/0,o=1/0,a=-1/0,s=-1/0;for(let t=0;t<e[i].length;t++){const l=e[i][t].x,c=e[i][t].y;n.push([l,c]),r>l&&(r=l),a<l&&(a=l),o>c&&(o=c),s<c&&(s=c);}t.push({type:"Polygon",geometry:[n],min:[r,o],max:[a,s]});}return t}_convertPolygonToGeometry(e){const t=[];for(let i=0;i<e.length;i++){const n=e[i].geometry.map((e=>e.map((e=>new te(e[0],e[1])))));t.push(...n);}return t}populate(e,t,i){const n=this.vectorRenderInSpace;this.baseP||(this.x=t.x,this.y=t.y,this.z=t.z,this.zPow=Math.pow(2,this.z),this.baseP=Tl(this.x,this.y,this.z,this.projection),this.matrix=new Ot,this.matrix[12]=this.baseP[0],this.matrix[13]=this.baseP[1],this.matrix[14]=this.baseP[2],Jd.getMinMaxHeight(this)),this.hasPattern=Yx("fill",this.layers,t);const r=this.layers[0].layout.get("fill-sort-key"),o=[];for(const{feature:n,id:a,index:s,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c={type:n.type,id:a,properties:n.properties,geometry:e?_g(n):[]};if(!this.layers[0]._featureFilter(new _p(this.zoom),c,i))continue;e||(c.geometry=_g(n));const u=r?r.evaluate(c,{},i,t.availableImages):void 0;o.push({feature:n,sourceLayerIndex:l,index:s,geometry:c.geometry,sortKey:u});}r&&o.sort(((e,t)=>e.sortKey-t.sortKey));for(const e of o){const{feature:r,index:a,sourceLayerIndex:s,geometry:l}=e,c=[];this.vectorRenderInSpace&&Uv.featureInsect(e,o)&&(this.forceUpdateSegment=!0);const u=[];Ov(kv(this.z),0,8192,0,8192,this._convertGeometryPointToPolygon(l),u);const h=this._convertPolygonToGeometry(u);if(n)this.addExtrusionFeature(r,l,a,c,i,n);else if(this.hasPattern&&e.feature._feature){const i=[];for(let t=0;t<e.feature._feature.geometry.length;t++){const n=[];for(let i=0;i<e.feature._feature.geometry[t].length;i++){const r=e.feature._feature.geometry[t][i],o=new te(r[0],r[1]);n.push(o);}i.push(n);}if(this.hasPattern){const n=qx("fill",this.layers,{id:e.feature.id,index:e.index,geometry:i,patterns:{},properties:e.feature.properties,sortKey:e.sortKey,sourceLayerIndex:e.sourceLayerIndex,type:e.feature.type,geo:h},this.zoom,t);this.patternFeatures.push(n);}}else this.addGridedFeature(r,l,h,a,i,this.z,{});t.featureIndex.insert(r,l,a,s,this.index),this.forceUpdateSegment=!1;}if(n){if(!this.baseP)return;this.matrix=bl(this.baseP);}0==this.layoutVertexArray2.length&&delete this.layoutVertexArray2;}update(e,t,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i);}addFeatures(e,t,i){if(this.patternFeatures.length>0)for(const e of this.patternFeatures)this.addGridedFeature(e,e.geometry,e.geo,e.index,t,this.z,i);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,kx),this.layoutVertexArray2&&this.layoutVertexArray2.length>0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Hx)),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy());}calcTDSpacePoint(e){if(Object.is(e.x,NaN)||Object.is(e.y,NaN)||Object.is(e.z,NaN))return;const t=wl(this.x+e.x/8192,this.y+e.y/8192,this.zPow,this.projection),i=lc.cartographicToCartesian3([t[0],t[1],0]);return [i[0]-this.baseP[0],i[1]-this.baseP[1],i[2]-this.baseP[2]]}addGridedFeature(e,t,i,n,r,o,a){const s=this.layers[0].paint.get("fill-outline-color").evaluate(e,{},r);let l,c,u=[65025*s.r,65025*s.g,65025*s.b,255*s.a];(65025*s.r>255||65025*s.g>255||65025*s.b>255)&&(u=[255*s.r,255*s.g,255*s.b,255*s.a]);for(const e of Pv(i,500)){let t=0;for(const i of e)t+=i.length;l=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray);const i=l.vertexLength,n=[],r=[];for(const t of e){if(0===t.length)continue;t!==e[0]&&r.push(n.length/2);const i=this.calcTDSpacePoint(t[0]);if(null!=i){this.layoutVertexArray.emplaceBack(...i,t[0].x/yw,t[0].y/yw),n.push(t[0].x),n.push(t[0].y);for(let e=1;e<t.length;e++){const i=this.calcTDSpacePoint(t[e]);null!=i&&(this.layoutVertexArray.emplaceBack(...i,t[e].x/yw,t[e].y/yw),n.push(t[e].x),n.push(t[e].y));}}}const o=Xx(n,r);for(let e=0;e<o.length;e+=3)this.indexArray.emplaceBack(i+o[e],i+o[e+1],i+o[e+2]);l.vertexLength+=t,l.primitiveLength+=o.length/3;}for(const e of Pv(t,500))for(const t of e){if(0===t.length)continue;this.layoutVertexArray2||(this.layoutVertexArray2=new xa),c=this.segments2.prepareSegment(t.length,this.layoutVertexArray2,this.indexArray2);const e=c.vertexLength;let i,n=0;for(let r=0;r<t.length;r++){if(r>=t.length-1)continue;const o=r<t.length-1?r+1:0;let a=Sw(t[r],t[o]);if(a||(a=[]),ww(t[r])||a.unshift(t[r]),ww(t[o])||a.push(t[o]),a.length>=2)for(let t=0;t<a.length;t++){const r=a[t],o=this.calcTDSpacePoint(r);i?(this.layoutVertexArray2.emplaceBack(...i.spacePos,i.st[0],i.st[1],...u),i={spacePos:[...o],st:[r.x/yw,r.y/yw]},this.layoutVertexArray2.emplaceBack(...i.spacePos,i.st[0],i.st[1],...u),this.indexArray2.emplaceBack(e+n-1,e+n),n+=2):i={spacePos:[...o],st:[r.x/yw,r.y/yw]};}i=null;}c.vertexLength+=n,c.primitiveLength+=n;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,a,r);}addExtrusionFeature(e,t,i,n,r,o){for(const i of Pv(t,500)){let t=0,n=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,this.forceUpdateSegment);for(let e of i)if(0!==e.length&&!bw(e)&&(!Pw(e)||(e=Dv(e,void 0,o),e[0]))){t+=e.length;for(let t=0;t<e.length;t++){const i=e[t];if(t>=1){const r=e[t-1];if(!Tw(i,r)){n.vertexLength+4>Ud.MAX_VERTEX_ARRAY_LENGTH&&(n=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const e=vl(i.x,i.y,this.minimumHeight,this.x,this.y,this.z,this.projection);this.baseP||(this.baseP=e);const t=vl(i.x,i.y,this.maximumHeight,this.x,this.y,this.z,this.projection),o=vl(r.x,r.y,this.minimumHeight,this.x,this.y,this.z,this.projection),a=vl(r.x,r.y,this.maximumHeight,this.x,this.y,this.z,this.projection),s=this.baseP;this.layoutVertexArray.emplaceBack(e[0]-s[0],e[1]-s[1],e[2]-s[2]),this.layoutVertexArray.emplaceBack(t[0]-s[0],t[1]-s[1],t[2]-s[2]),this.layoutVertexArray.emplaceBack(o[0]-s[0],o[1]-s[1],o[2]-s[2]),this.layoutVertexArray.emplaceBack(a[0]-s[0],a[1]-s[1],a[2]-s[2]);const l=n.vertexLength;this.indexArray.emplaceBack(l,l+2,l+1),this.indexArray.emplaceBack(l+1,l+2,l+3),n.vertexLength+=4,n.primitiveLength+=2;}}}}if(n.vertexLength+t>Ud.MAX_VERTEX_ARRAY_LENGTH&&(n=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray)),"Polygon"!==bg.VectorTileFeature.types[e.type])continue;const r=this.segments.prepareSegment(4*t,this.layoutVertexArray,this.indexArray);vw(r,this.maximumHeight,o,!0,i,this,t),vw(r,this.minimumHeight,o,!1,i,this,t);}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i);}}function vw(e,t,i,n,r,o,a){const s=[],l=[],c=e.vertexLength;for(let e=0;e<r.length;e++){let a=r[e];if(0!==a.length&&!bw(a)&&(!Pw(a)||(a=Dv(a,void 0,i),a[0]))){e>0&&a!==r[0]&&l.push(s.length/2);for(let e=0;e<a.length;e++){const i=a[e],r=vl(i.x,i.y,n?t:o.minimumHeight,o.x,o.y,o.z,o.projection);o.baseP||(o.baseP=r),o.layoutVertexArray.emplaceBack(r[0]-o.baseP[0],r[1]-o.baseP[1],r[2]-o.baseP[2]),s.push(i.x),s.push(i.y);}}}const u=Xx(s,l);for(let e=0;e<u.length;e+=3)n?o.indexArray.emplaceBack(c+u[e],c+u[e+2],c+u[e+1]):o.indexArray.emplaceBack(c+u[e],c+u[e+1],c+u[e+2]);e.primitiveLength+=u.length/3,e.vertexLength+=a;}function ww(e){return e.x<0||e.x>Ch||e.y<0||e.y>Ch}function Tw(e,t){return e.x===t.x&&(e.x<0||e.x>Ch)||e.y===t.y&&(e.y<0||e.y>Ch)}function bw(e){return e.every((e=>e.x<0))||e.every((e=>e.x>Ch))||e.every((e=>e.y<0))||e.every((e=>e.y>Ch))}function Pw(e){return !(e.every((e=>e.x>=0))&&e.every((e=>e.x<=Ch))&&e.every((e=>e.y>=0))&&e.every((e=>e.y<=Ch)))}function Sw(e,t){const i=lw(Ce([[0,0],[Ch,0],[Ch,Ch],[0,Ch],[0,0]]),Ce([[e.x,e.y],[t.x,t.y]]));if(i&&i.features&&i.features.length>0){const e=[];for(let t=0;t<i.features.length;t++){const n=i.features[t].geometry.coordinates;e.push(new te(n[0],n[1]));}return e}return null}function Aw(e,t,i){return !!Ow(e,t)||!!Lw(t,e,i)}function Ew(e,t,i){for(let n=0;n<t.length;n++){const r=t[n];if(e.length>=3)for(let t=0;t<r.length;t++)if(Ow(e,r[t]))return !0;if(Cw(e,r,i))return !0}return !1}function Cw(e,t,i){if(e.length>1){if(Mw(e,t))return !0;for(let n=0;n<t.length;n++)if(Lw(t[n],e,i))return !0}for(let n=0;n<e.length;n++)if(Lw(e[n],t,i))return !0;return !1}function Mw(e,t){if(0===e.length||0===t.length)return !1;for(let i=0;i<e.length-1;i++){const n=e[i],r=e[i+1];for(let e=0;e<t.length-1;e++)if(Iw(n,r,t[e],t[e+1]))return !0}return !1}function Iw(e,t,i,n){return $e(e,i,n)!==$e(t,i,n)&&$e(e,t,i)!==$e(e,t,n)}function Lw(e,t,i){const n=i*i;if(1===t.length)return e.distSqr(t[0])<n;for(let i=1;i<t.length;i++)if(Nw(e,t[i-1],t[i])<n)return !0;return !1}function Nw(e,t,i){const n=t.distSqr(i);if(0===n)return e.distSqr(t);const r=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/n;return e.distSqr(r<0?t:r>1?i:i.sub(t)._mult(r)._add(t))}function Rw(e,t){let i,n,r,o=!1;for(let a=0;a<e.length;a++){i=e[a];for(let e=0,a=i.length-1;e<i.length;a=e++)n=i[e],r=i[a],n.y>t.y!=r.y>t.y&&t.x<(r.x-n.x)*(t.y-n.y)/(r.y-n.y)+n.x&&(o=!o);}return o}function Ow(e,t){let i=!1;for(let n=0,r=e.length-1;n<e.length;r=n++){const o=e[n],a=e[r];o.y>t.y!=a.y>t.y&&t.x<(a.x-o.x)*(t.y-o.y)/(a.y-o.y)+o.x&&(i=!i);}return i}function Dw(e,t,i){const n=i[0],r=i[2];if(e.x<n.x&&t.x<n.x||e.x>r.x&&t.x>r.x||e.y<n.y&&t.y<n.y||e.y>r.y&&t.y>r.y)return !1;const o=$e(e,t,i[0]);return o!==$e(e,t,i[1])||o!==$e(e,t,i[2])||o!==$e(e,t,i[3])}function Fw(e,t,i){const n=t.paint.get(e).value;return "constant"===n.kind?n.value:i.programConfigurations.get(t.id).getMaxValue(e)}function zw(e,t,i,n,r){if(!t[0]&&!t[1])return e;const o=te.convert(t);"viewport"===i&&o._rotate(-n);const a=[];for(let t=0;t<e.length;t++)a.push(e[t].sub(o.clone()._mult(r)));return a}Ho("FillBucket",xw,{omit:["layers","patternFeatures"],shallow:["matrix"]});const Bw=new Ip({"fill-sort-key":new Ap(Og.layout_fill["fill-sort-key"]),dynamic:new Sp(Og.layout_fill.dynamic)});var Vw={paint:new Ip({"fill-antialias":new Sp(Og.paint_fill["fill-antialias"]),"fill-opacity":new Ap(Og.paint_fill["fill-opacity"]),"fill-water-texture":new Sp(Og.paint_fill["fill-water-texture"]),"fill-water-speed":new Sp(Og.paint_fill["fill-water-speed"]),"fill-water-wave-size":new Sp(Og.paint_fill["fill-water-wave-size"]),"sunlight-color":new Sp(Og.paint_fill["sunlight-color"]),"sunlight-direction":new Sp(Og.paint_fill["sunlight-direction"]),"sky-color":new Sp(Og.paint_fill["sky-color"]),"fill-color":new Ap(Og.paint_fill["fill-color"]),"fill-outline-color":new Ap(Og.paint_fill["fill-outline-color"]),"fill-translate":new Ap(Og.paint_fill["fill-translate"]),"fill-translate-anchor":new Ap(Og.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ep(Og.paint_fill["fill-pattern"]),"fill-water":new Sp(Og.paint_fill["fill-water"]),"fill-dynamic-speed":new Ap(Og.paint_fill["fill-dynamic-speed"]),"fill-dynamic-image-url":new Cp(Og.paint_fill["fill-dynamic-image-url"]),"fill-offset":new Ap(Og.paint_fill["fill-offset"]),"fill-rotation":new Ap(Og.paint_fill["fill-rotation"]),"fill-scale":new Ap(Og.paint_fill["fill-scale"])}),layout:Bw};const Uw=gi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_NORMAL",components:1,type:"Uint8"},{name:"a_data",components:4,type:"Uint8"},{name:"a_extra_extrude",components:2,type:"Uint8"},{name:"a_pos_normal",components:2,type:"Int16"}],4),{members:kw}=Uw,Gw=gi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Hw}=Gw,Yw=bg.VectorTileFeature.types,qw=63,Xw=Math.cos(Math.PI/180*37.5),jw=.5,Ww=Math.pow(2,14)/jw;class $w{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.vectorRenderInSpace=!1,this.layers.forEach((e=>{this.gradients[e.id]={},this.classificationtype=e.classificationType,Kd(e.classificationType)&&(this.vectorRenderInSpace=!0);})),this.type=Ag.LINE,this.layoutVertexArray=new ua,this.layoutVertexArray2=new ya,this.indexArray=new Ia,this.programConfigurations=new tf(kw,e.layers,e.zoom),this.segments=new Ud,this.maxLineLength=0,this.projection=e.projection||ci.MERCATOR,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.tempVertex=[],this.bottomTempVertex=[],this.bottomTempIndice=[],this.maximumHeight=0,this.minimumHeight=0,this.forceUpdateSegment=!1;}_convertGeometryPointToLine(e){const t=[];for(let i=0;i<e.length;i++){const n=[];let r=1/0,o=1/0,a=-1/0,s=-1/0;for(let t=0;t<e[i].length;t++){const l=e[i][t].x,c=e[i][t].y;n.push([l,c]),r>l&&(r=l),a<l&&(a=l),o>c&&(o=c),s<c&&(s=c);}t.push({type:"LineString",geometry:[n],min:[r,o],max:[a,s]});}return t}_convertLineToGeometry(e){const t=[];for(let i=0;i<e.length;i++){const n=e[i].geometry.map((e=>e.map((e=>new te(e[0],e[1])))));t.push(...n);}return t}populate(e,t,i){this.baseP||(this.x=t.x,this.y=t.y,this.z=t.z,this.zPow=Math.pow(2,this.z),this.baseP=Tl(this.x,this.y,this.z,this.projection),this.matrix=bl(this.baseP),Jd.getMinMaxHeight(this)),this.hasPattern=Yx("line",this.layers,t);const n=this.layers[0].layout.get("line-sort-key"),r=[];for(const{feature:t,id:o,index:a,sourceLayerIndex:s}of e){const e=this.layers[0]._featureFilter.needGeometry,l={type:t.type,id:o,properties:t.properties,geometry:e?_g(t):[]};if(!this.layers[0]._featureFilter(new _p(this.zoom),l,i))continue;e||(l.geometry=_g(t));const c=n?n.evaluate(l,{},i):void 0;r.push({feature:t,sourceLayerIndex:s,index:a,sortKey:c});}n&&r.sort(((e,t)=>e.sortKey-t.sortKey));for(const e of r){const{feature:i,index:n,sourceLayerIndex:o}=e;this.vectorRenderInSpace&&Uv.featureInsect(e,r)&&(this.forceUpdateSegment=!0);const a=_g(i);let s=kv(this.z);this.layers[0].paint._values["line-gradient"]&&(s=1);const l=this._convertGeometryPointToLine(a),c=[];3===i.type&&(s=2,i.polygon2Line=!0),Ov(s,0,8192,0,8192,l,c);const u=this._convertLineToGeometry(c);if(this.classificationtype===Zd.VECTOR_WITH_HEIGHT){const e=i?.properties?.height?.split(",");for(let t=0;t<u[0].length&&e&&0!==e.length;t++)u[0][t].z=+e[t];}if(this.hasPattern&&e.feature._feature){const i=[];for(let t=0;t<e.feature._feature.geometry.length;t++){const n=[];for(let i=0;i<e.feature._feature.geometry[t].length;i++){const r=e.feature._feature.geometry[t][i],o=new te(r[0],r[1]);n.push(o);}i.push(n);}const n=qx("line",this.layers,{id:e.feature.id,index:e.index,geometry:i,patterns:{},properties:e.feature.properties,sortKey:e.sortKey,sourceLayerIndex:e.sourceLayerIndex,type:e.feature.type},this.zoom,t);this.patternFeatures.push(n);}else this.addFeature(i,u,n,new Vh(this.z,this.x,this.y),{});this.forceUpdateSegment=!1,t.featureIndex.insert(i,a,n,o,this.index);}delete this.tempVertex,delete this.bottomTempVertex,delete this.bottomTempIndice,delete this.maximumHeight,delete this.minimumHeight,delete this.forceUpdateSegment,delete this.e1,delete this.e2,0==this.layoutVertexArray2.length&&delete this.layoutVertexArray2;}update(e,t){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers);}addFeatures(e,t,i){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,i);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2&&0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Hw)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,kw),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.layoutVertexBuffer2&&this.layoutVertexBuffer2.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("minemap_clip_start")&&e.properties.hasOwnProperty("minemap_clip_end"))return {start:+e.properties.minemap_clip_start,end:+e.properties.minemap_clip_end}}addFeature(e,t,i,n,r){const o=this.layers[0].layout,a=o.get("line-join").evaluate(e,{}),s=o.get("line-cap"),l=o.get("line-miter-limit"),c=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const i of t)if(this.vectorRenderInSpace){this.tempVertex=[],this.bottomTempVertex=[],this.bottomTempIndice=[],this.addLine(i,e,a,s,l,c);const t=this.segments.prepareSegment(4*(this.tempVertex.length+this.bottomTempVertex.length),this.layoutVertexArray,this.indexArray);this.tempVertex.push(this.tempVertex[0]),this.addSide(t),this.addBottom(t),this.tempVertex=[],this.bottomTempIndice=[],this.bottomTempVertex=[];}else this.addLine(i,e,a,s,l,c);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,r,n);}addLine(e,t,i,n,r,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance);}let a="Polygon"===Yw[t.type];t.polygon2Line&&(a=!1);let s=e.length;for(;s>=2&&e[s-1].equals(e[s-2]);)s--;let l=0;for(;l<s-1&&e[l].equals(e[l+1]);)l++;if(s<(a?3:2))return;"bevel"===i&&(r=1.05);const c=this.overscaling<=16?15*Ch/(512*this.overscaling):0,u=this.segments.prepareSegment(10*s,this.layoutVertexArray,this.indexArray);let h,d,p,f,m;this.e1=this.e2=-1,a&&(h=e[s-2],m=e[l].sub(h)._unit()._perp());for(let t=l;t<s;t++){if(p=t===s-1?a?e[l+1]:void 0:e[t+1],p&&e[t].equals(p))continue;m&&(f=m),h&&(d=h),h=e[t],m=p?p.sub(h)._unit()._perp():f,f=f||m;let _=f.add(m);0===_.x&&0===_.y||_._unit();const g=f.x*m.x+f.y*m.y,y=_.x*m.x+_.y*m.y,x=0!==y?1/y:1/0,v=2*Math.sqrt(2-2*y),w=y<Xw&&d&&p,T=f.x*m.y-f.y*m.x>0;if(w&&t>l){const e=h.dist(d);if(e>2*c){const t=h.sub(h.sub(d)._mult(c/e)._round());this.updateDistance(d,t),this.addCurrentVertex(t,f,0,0,u),d=t;}}const b=d&&p;let P=b?i:a?"butt":n;if(b&&"round"===P&&(x<o?P="miter":x<=2&&(P="fakeround")),"miter"===P&&x>r&&(P="bevel"),"bevel"===P&&(x>2&&(P="flipbevel"),x<r&&(P="miter")),d&&this.updateDistance(d,h),"miter"===P)_._mult(x),this.addCurrentVertex(h,_,0,0,u);else if("flipbevel"===P){if(x>100)_=m.mult(-1);else {const e=x*f.add(m).mag()/f.sub(m).mag();_._perp()._mult(e*(T?-1:1));}this.addCurrentVertex(h,_,0,0,u),this.addCurrentVertex(h,_.mult(-1),0,0,u);}else if("bevel"===P||"fakeround"===P){const e=-Math.sqrt(x*x-1),t=T?e:0,i=T?0:e;if(d&&this.addCurrentVertex(h,f,t,i,u),"fakeround"===P){const e=Math.round(180*v/Math.PI/20);for(let t=1;t<e;t++){let i=t/e;if(.5!==i){const e=i-.5;i+=i*e*(i-1)*((1.0904+g*(g*(3.55645-1.43519*g)-3.2452))*e*e+(.848013+g*(.215638*g-1.06021)));}const n=m.sub(f)._mult(i)._add(f)._unit()._mult(T?-1:1);this.addHalfVertex(h,n.x,n.y,!1,T,0,u,{x:0,y:0});}}p&&this.addCurrentVertex(h,m,-t,-i,u);}else if("butt"===P)this.addCurrentVertex(h,_,0,0,u);else if("square"===P){const e=d?1:-1;this.addCurrentVertex(h,_,e,e,u);}else "round"===P?(d&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),p&&(this.addCurrentVertex(h,m,-1,-1,u,!0),this.addCurrentVertex(h,m,0,0,u))):"round-butt"===P&&(d&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,.5,.5,u,!0,.42,.42)),p&&(this.addCurrentVertex(h,m,-.5,-.5,u,!0,-.42,-.42),this.addCurrentVertex(h,m,0,0,u)));if(w&&t<s-1){const e=h.dist(p);if(e>2*c){const t=h.add(p.sub(h)._mult(c/e)._round());this.updateDistance(h,t),this.addCurrentVertex(t,m,0,0,u),h=t;}}}return u}addBottom(e){const t=e.vertexLength,i=this.bottomTempIndice;let n=-1;for(let e=0;e<i.length;e++){const t=i[e];n=n>-1?Math.min(Math.min(Math.min(t.x,t.y),t.z),n):Math.min(Math.min(t.x,t.y),t.z);}for(let r=0;r<i.length;r++){const o=i[r];this.indexArray.emplaceBack(t+o.x-n,t+o.y-n,t+o.z-n),e.primitiveLength++;}const r=this.bottomTempVertex;for(let t=0;t<r.length;t++){const i=r[t],n=(this.lineClips?this.scaledDistance*(Ww-1):this.scaledDistance)*jw;this.layoutVertexArray.emplaceBack(i.currentVertex.x,i.currentVertex.y,i.currentVertex.z,(i.round?2:0)+(i.up?1:0),Math.round(qw*i.extrudeX)+128,Math.round(qw*i.extrudeY)+128,1+(0===i.dir?0:i.dir<0?-1:1)|(63&n)<<2,n>>6,128,128),e.vertexLength++;}}addSide(e){if(this.tempVertex.length<2)return;let t=!0;for(let i=0;i<this.tempVertex.length;i++)if(0===i){const e=this.tempVertex[i];t=!t,this.addSideVertex(e.currentVertex.x,e.currentVertex.y,e.currentVertex.z,e.extrudeX,e.extrudeY,e.round,t,e.dir),this.addSideVertex(e.currentSpaceVertex.x,e.currentSpaceVertex.y,e.currentSpaceVertex.z,e.extrudeX,e.extrudeY,e.round,t,e.dir);}else {t=!t;const n=this.tempVertex[i];this.addSideVertex(n.currentVertex.x,n.currentVertex.y,n.currentVertex.z,n.extrudeX,n.extrudeY,n.round,t,n.dir),this.addSideVertex(n.currentSpaceVertex.x,n.currentSpaceVertex.y,n.currentSpaceVertex.z,n.extrudeX,n.extrudeY,n.round,t,n.dir);const r=e.vertexLength;this.indexArray.emplaceBack(r,r+2,r+1),this.indexArray.emplaceBack(r+1,r+2,r+3),e.vertexLength+=2,e.primitiveLength+=2;}e.vertexLength+=2;}addSideVertex(e,t,i,n,r,o,a,s){const l=(this.lineClips?this.scaledDistance*(Ww-1):this.scaledDistance)*jw;this.layoutVertexArray.emplaceBack(e,t,i,(o?2:0)+(a?1:0),Math.round(qw*n)+128,Math.round(qw*r)+128,1+(0===s?0:s<0?-1:1)|(63&l)<<2,l>>6,128,128);}calcTDSpacePoint(e,t){if(Object.is(e.x,NaN)||Object.is(e.y,NaN)||Object.is(e.z,NaN))return;const i=wl(this.x+e.x/8192,this.y+e.y/8192,this.zPow,this.projection),n=lc.cartographicToCartesian3([i[0],i[1],t]);return new te(n[0]-this.baseP[0],n[1]-this.baseP[1],n[2]-this.baseP[2])}addCurrentVertex(e,t,i,n,r,o=!1,a=0,s=0){const l=t.x+t.y*i,c=t.y-t.x*i,u=t.y*n-t.x,h=-t.y-t.x*n;let d=t.mult(0);d=t.perp().mult(-a);let p=t.mult(0);p=t.perp().mult(-s);const f=this.calcTDSpacePoint(e,this.minimumHeight);if(null!=f){if(this.vectorRenderInSpace){const t=this.calcTDSpacePoint(e,this.maximumHeight);if(null==t)return;this.addHalfVertex(e,l,c,o,!1,i,r,d),this.addHalfVertex(e,u,h,o,!0,-n,r,p),this.tempVertex.push({currentVertex:f,currentSpaceVertex:t,extrudeX:l,extrudeY:c,round:o,up:!1,dir:i}),this.tempVertex.unshift({currentVertex:f,currentSpaceVertex:t,extrudeX:u,extrudeY:h,round:o,up:!0,dir:-n});}else this.addHalfVertex(e,l,c,o,!1,i,r,d),this.addHalfVertex(e,u,h,o,!0,-n,r,p);this.distance>Ww/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(e,t,i,n,r,o));}}addHalfVertex(e,t,i,n,r,o,a,s){const l=this.layers[0].layout.get("line-height-offset")?.value?.value||0,c=this.lineClips?this.scaledDistance*(Ww-1):this.scaledDistance,u=this.calcTDSpacePoint(e,this.vectorRenderInSpace?this.maximumHeight:e.z+l);if(null==u)return;if(this.vectorRenderInSpace){const a=this.calcTDSpacePoint(e,this.minimumHeight);if(void 0===a)return;this.bottomTempVertex.push({currentVertex:a,extrudeX:t,extrudeY:i,round:n,up:r,dir:o});}const h=c*jw;this.layoutVertexArray.emplaceBack(u.x,u.y,u.z,(n?2:0)+(r?1:0),Math.round(qw*t)+128,Math.round(qw*i)+128,1+(0===o?0:o<0?-1:1)|(63&h)<<2,h>>6,Math.round(qw*s.x)+128,Math.round(qw*s.y)+128,(e.x<<1)+(n?1:0),(e.y<<1)+(r?1:0)),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const d=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,d,this.e2),a.primitiveLength++,this.vectorRenderInSpace&&this.bottomTempIndice.push({x:this.e1,y:this.e2,z:d})),r?this.e2=d:this.e1=d;}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance;}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance();}}Ho("LineBucket",$w,{omit:["layers","patternFeatures"],shallow:["matrix"]});const Zw=new Ip({"line-cap":new Sp(Og.layout_line["line-cap"]),"line-join":new Ap(Og.layout_line["line-join"]),"line-miter-limit":new Sp(Og.layout_line["line-miter-limit"]),"line-round-limit":new Sp(Og.layout_line["line-round-limit"]),"line-sort-key":new Ap(Og.layout_line["line-sort-key"]),"line-height-offset":new Ap(Og.layout_line["line-height-offset"]),"border-visibility":new Sp(Og.layout_line["border-visibility"])});var Kw={paint:new Ip({"line-opacity":new Ap(Og.paint_line["line-opacity"]),"line-color":new Ap(Og.paint_line["line-color"]),"line-translate":new Ap(Og.paint_line["line-translate"]),"line-translate-anchor":new Ap(Og.paint_line["line-translate-anchor"]),"line-width":new Ap(Og.paint_line["line-width"]),"line-border-width":new Ap(Og.paint_line["line-border-width"]),"line-border-opacity":new Ap(Og.paint_line["line-border-opacity"]),"line-border-color":new Ap(Og.paint_line["line-border-color"]),"line-gap-width":new Ap(Og.paint_line["line-gap-width"]),"line-offset":new Ap(Og.paint_line["line-offset"]),"line-blur":new Ap(Og.paint_line["line-blur"]),"line-dasharray":new Cp(Og.paint_line["line-dasharray"]),"line-pattern":new Ep(Og.paint_line["line-pattern"]),"line-gradient":new Mp(Og.paint_line["line-gradient"]),"half-render":new Sp(Og.paint_line["half-render"]),"line-normal-direction":new Ap(Og.paint_line["line-normal-direction"])}),layout:Zw};const Qw=new class extends Ap{possiblyEvaluate(e,t){return t=new _p(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,n){return t=ze({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,n)}}(Kw.paint.properties["line-width"].specification);Qw.useIntegerZoom=!0;class Jw extends Lx{constructor(e){e&&e.layout&&"visible"===e.layout["border-visibility"]&&e.paint&&e.paint["line-gap-width"]&&(We("'line-gap-width' cannot be set when 'border-visibility' is 'visible'"),e.paint["line-gap-width"]=0),super(e,Kw),this.stencilTest=e["stencil-test"],this.gradientVersion=0;}_handleSpecialPaintPropertyUpdate(e){"line-gradient"===e&&(this.stepInterpolate=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof dr,this.gradientVersion=(this.gradientVersion+1)%Ie);}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}getCrossfadeParameters(){return this._crossfadeParameters}recalculate(e,t){super.recalculate(e,t),e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this.paint._values["line-floorwidth"]=Qw.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e);}createBucket(e){return new $w(e)}queryRadius(e){const t=e,i=eT(Fw("line-width",this,t),Fw("line-gap-width",this,t)),n=Fw("line-offset",this,t);return i/2+Math.abs(n)+0}queryIntersectsFeature(e,t,i,n,r,o,a,s){const l=zw(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.getMapViewParams().bearing*nt.TRANSFORM.DEG_TO_RAD,a);let c=a/2*eT(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i));null!=s&&null!=s.line&&(c=Math.max(c,s.line));const u=this.paint.get("line-offset").evaluate(t,i);return u&&(n=function(e,t){const i=[],n=new te(0,0);for(let r=0;r<e.length;r++){const o=e[r],a=[];for(let e=0;e<o.length;e++){const i=o[e],r=o[e+1],s=0===e?n:i.sub(o[e-1])._unit()._perp(),l=e===o.length-1?n:r.sub(i)._unit()._perp(),c=s._add(l)._unit();c._mult(1/(c.x*l.x+c.y*l.y)),a.push(c._mult(t)._add(i));}i.push(a);}return i}(n,u*a)),Ew(l,n,c)}hasOffscreenPass(){return 0!==this.paint.get("line-opacity")&&"none"!==this.visibility}}function eT(e,t){return t>0?t+2*e:e}const tT=gi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_extra",components:2,type:"Int16"}],4),{members:iT}=tT;function nT(e,t,i,n,r,o){e.emplaceBack(t,i,n,r,o);}class rT{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.type=Ag.CIRCLE,this.layoutVertexArray=new _a,this.indexArray=new Ia,this.segments=new Ud,this.programConfigurations=new tf(iT,e.layers,e.zoom),this.projection=e.projection||ci.MERCATOR;}populate(e,t,i){const n=this.layers[0],r=[];let o=null;"circle"===n.type&&(o=n.layout.get("circle-sort-key")),this.baseP||(this.x=t.x,this.y=t.y,this.z=t.z,this.zPow=Math.pow(2,this.z),this.baseP=Tl(this.x,this.y,this.z,this.projection),this.matrix=bl(this.baseP));for(const{feature:t,index:n,sourceLayerIndex:a}of e){const e=t.id,s=this.layers[0]._featureFilter.needGeometry,l={type:t.type,id:e,properties:t.properties,geometry:s?_g(t):[]};if(!this.layers[0]._featureFilter(new _p(this.zoom),t,i))continue;s||(l.geometry=_g(t));const c=o?o.evaluate(l,{},i):void 0;r.push({id:e,properties:t.properties,type:t.type,sourceLayerIndex:a,index:n,geometry:l.geometry,patterns:{},sortKey:c});}o&&r.sort(((e,t)=>e.sortKey-t.sortKey));for(const n of r){const{geometry:r,index:o,sourceLayerIndex:a}=n,s=e[o].feature;this.addFeature(n,r,o,i),t.featureIndex.insert(s,r,o,a,this.index);}this.x=t.x,this.y=t.y,this.z=t.z;}update(e,t){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,iT),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());}calcTDSpacePoint(e,t){const i=wl(this.x+e/8192,this.y+t/8192,this.zPow,this.projection),n=lc.cartographicToCartesian3([i[0],i[1],0]);return [n[0]-this.baseP[0],n[1]-this.baseP[1],n[2]-this.baseP[2]]}addFeature(e,t,i,n){for(const e of t)for(const t of e){const e=t.x,i=t.y;if(e<0||e>=Ch||i<0||i>=Ch)continue;const n=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),r=n.vertexLength,o=this.calcTDSpacePoint(e,i);nT(this.layoutVertexArray,...o,-1,-1),nT(this.layoutVertexArray,...o,1,-1),nT(this.layoutVertexArray,...o,1,1),nT(this.layoutVertexArray,...o,-1,1),this.indexArray.emplaceBack(r,r+1,r+2),this.indexArray.emplaceBack(r,r+3,r+2),n.vertexLength+=4,n.primitiveLength+=2;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},n);}}Ho("CircleBucket",rT,{omit:["layers"],shallow:["matrix"]});const oT=new Ip({"circle-sort-key":new Ap(Og.layout_circle["circle-sort-key"])});var aT={paint:new Ip({"circle-radius":new Ap(Og.paint_circle["circle-radius"]),"circle-color":new Ap(Og.paint_circle["circle-color"]),"circle-blur":new Ap(Og.paint_circle["circle-blur"]),"circle-opacity":new Ap(Og.paint_circle["circle-opacity"]),"circle-translate":new Sp(Og.paint_circle["circle-translate"]),"circle-translate-anchor":new Sp(Og.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Sp(Og.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Sp(Og.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ap(Og.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ap(Og.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ap(Og.paint_circle["circle-stroke-opacity"])}),layout:oT};function sT(e,t){const i=new wt([e.x,e.y,0,1]).transform(t);return new te(i[0]/i[3],i[1]/i[3])}const lT=gi([{name:"a_pos_vec3",components:3,type:"Float32"},{name:"a_extrude",components:2,type:"Int8"}],4),{members:cT}=lT;function uT(e,t,i,n,r,o){e.emplaceBack(t,i,n,r,o);}class hT{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.type=Ag.HEATMAP,this.layoutVertexArray=new oa,this.indexArray=new Ia,this.segments=new Ud,this.programConfigurations=new tf(cT,e.layers,e.zoom),this.projection=e.projection||ci.MERCATOR;}populate(e,t,i){const n=[];this.baseP||(this.x=t.x,this.y=t.y,this.z=t.z,this.zPow=Math.pow(2,this.z),this.baseP=Tl(this.x,this.y,this.z,this.projection),this.matrix=bl(this.baseP));for(const{feature:t,id:r,index:o,sourceLayerIndex:a}of e){const e=this.layers[0]._featureFilter.needGeometry,s={type:t.type,id:r,properties:t.properties,geometry:e?_g(t):[]};this.layers[0]._featureFilter(new _p(this.zoom),t,i)&&(e||(s.geometry=_g(t)),n.push({id:r,properties:t.properties,type:t.type,sourceLayerIndex:a,index:o,geometry:s.geometry,patterns:{}}));}for(const r of n){const{geometry:n,index:o,sourceLayerIndex:a}=r,s=e[o].feature;this.addFeature(r,n,o,i),t.featureIndex.insert(s,n,o,a,this.index);}this.x=t.x,this.y=t.y,this.z=t.z;}update(e,t){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cT),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());}calcTDSpacePoint(e,t){const i=wl(this.x+e/8192,this.y+t/8192,this.zPow,this.projection),n=lc.cartographicToCartesian3([i[0],i[1],0]);return [n[0]-this.baseP[0],n[1]-this.baseP[1],n[2]-this.baseP[2]]}addFeature(e,t,i,n){for(const e of t)for(const t of e){const e=t.x,i=t.y;if(e<0||e>=Ch||i<0||i>=Ch)continue;const n=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),r=n.vertexLength,o=this.calcTDSpacePoint(e,i);uT(this.layoutVertexArray,o[0],o[1],o[2],-1,-1),uT(this.layoutVertexArray,o[0],o[1],o[2],1,-1),uT(this.layoutVertexArray,o[0],o[1],o[2],1,1),uT(this.layoutVertexArray,o[0],o[1],o[2],-1,1),this.indexArray.emplaceBack(r,r+1,r+2),this.indexArray.emplaceBack(r,r+3,r+2),n.vertexLength+=4,n.primitiveLength+=2;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},n);}}Ho("HeatmapBucket",hT,{omit:["layers"],shallow:["matrix"]});const dT=new Ip({"display-mode":new Sp(Og.layout_heatmap["display-mode"])});var pT={paint:new Ip({"heatmap-height":new Sp(Og.paint_heatmap["heatmap-height"]),"heatmap-radius":new Ap(Og.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ap(Og.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Sp(Og.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Mp(Og.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Sp(Og.paint_heatmap["heatmap-opacity"]),"heatmap-height-factor":new Ap(Og.paint_heatmap["heatmap-height-factor"])}),layout:dT};function fT(e){const t={},i=e.resolution||256,n=e.clips?e.clips.length:1,r=e.image||new mw({width:i,height:n}),o=(i,n,o)=>{t[e.evaluationKey]=o;const a=e.expression.evaluate(t);r.data[i+n+0]=Math.floor(255*a.r),r.data[i+n+1]=Math.floor(255*a.g),r.data[i+n+2]=Math.floor(255*a.b),r.data[i+n+3]=Math.floor(255*a.a);};if(e.clips)for(let t=0,r=0;t<n;++t,r+=4*i)for(let n=0,a=0;n<i;n++,a+=4){const s=n/(i-1),{start:l,end:c}=e.clips[t];o(r,a,l*(1-s)+c*s);}else for(let e=0,t=0;e<i;e++,t+=4)o(0,t,e/(i-1));return r}function mT(e,t){return t.replace(/{([^{}]+)}/g,((t,i)=>i in e?String(e[i]):""))}const _T=gi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_NORMAL_ED",components:3,type:"Float32"},{name:"a_ST",components:3,type:"Float32"}],4),gT=gi([{name:"a_ANS_POS_TIME_0",components:1,type:"Float32"},{name:"a_ANS_POS_TIME_1",components:1,type:"Float32"},{name:"a_ANS_NORMAL_WITH_LENGTH",components:3,type:"Float32"},{name:"a_ANS_BASE_POSITION",components:3,type:"Float32"}],4),yT=gi([{name:"a_ANS_COLOR_TIME_0",components:1,type:"Float32"},{name:"a_ANS_COLOR_TIME_1",components:1,type:"Float32"},{name:"a_ANS_VERTEXCOLOR_0",components:4,type:"Uint8"},{name:"a_ANS_VERTEXCOLOR_1",components:4,type:"Uint8"}],1),{members:xT}=_T,vT=Math.pow(2,13),wT=[1,0,16384];function TT(e,t,i,n,r,o,a,s,l,c){e.emplaceBack(t,i,n,r,o,a,s,l,c);}function bT(e,t,i,n){e.emplaceBack(t.t0,t.t1,i.x,i.y,i.z,n.x,n.y,n.z);}class PT{constructor(e,t){this.featureTriangles=[],this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.type=Ag.EXTRUSION,this.layoutVertexArray=new aa,this.positionAnimationVertexArray=new sa,this.colorAnimationVertexArray=new la,this.indexArray=new Ia,this.programConfigurations=new tf(xT,e.layers,e.zoom),this.segments=new Ud,this.projection=e.projection||ci.MERCATOR,this.enableQuery=t,this._animationFlag=!1;}populate(e,t,i){this.x=t.x,this.y=t.y,this.z=t.z,this.patternFeatures=[],this.hasPattern=Yx("extrusion",this.layers,t);for(const{feature:n,id:r,index:o,sourceLayerIndex:a}of e)if(this.layers[0]._featureFilter(new _p(this.zoom),n,i)){const e=_g(n);if(CT(e))continue;const s={id:r,sourceLayerIndex:a,index:o,geometry:e,properties:n.properties,type:n.type,patterns:{}};void 0!==n.id&&(s.id=n.id);const l=[];this.hasPattern?(this.patternFeatures.push(qx("extrusion",this.layers,s,this.zoom,t)),this.addFeature(n,e,o,i,{},l)):this.addFeature(n,e,o,i,{},l),this.enableQuery&&this.featureTriangles.push({feature:n.toGeoJSON(this.x,this.y,this.z),triangles:l});}this.baseP&&(this.matrix=bl(this.baseP));}addFeatures(e,t,i){for(const e of this.patternFeatures){const n=[],{geometry:r}=e;this.addFeature(e,r,e.index,t,i,n);}}update(e,t,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xT),this.indexBuffer=e.createIndexBuffer(this.indexArray),this._animationFlag&&this.uploadAnimationBuffers(e)),this.programConfigurations.upload(e),this.uploaded=!0;}uploadAnimationBuffers(e){this.animationVertexBuffers={},this.positionAnimationVertexArray.length>0&&(this.animationVertexBuffers.positionAnimationVertexBuffer=e.createVertexBuffer(this.positionAnimationVertexArray,gT.members)),this.colorAnimationVertexArray.length>0&&(this.animationVertexBuffers.colorAnimationVertexBuffer=e.createVertexBuffer(this.colorAnimationVertexArray,yT.members));}destroyAnimationBuffers(){if(Object.keys(this?.animationVertexBuffers).length>0)for(const e in this.animationVertexBuffers)Object.hasOwnProperty.call(this.animationVertexBuffers,e)&&this.animationVertexBuffers[e].destroy();}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this._animationFlag&&this.destroyAnimationBuffers());}addAnimationEdgeFeature(e,t,i){e:{const n=e?.targetValues,r=e?.times;if(!n||n.length<2||!r||r.length<2)break e;this._animationFlag=!0;const o=n[0],a=n[1],s=r[0],l=r[1],c=vl(t.x,t.y,o,this.x,this.y,this.z,this.projection),u=vl(i.x,i.y,o,this.x,this.y,this.z,this.projection),h=lc.DefaultEllipsoid.geodeticSurfaceNormal(c),d=lc.DefaultEllipsoid.geodeticSurfaceNormal(u),p=o-o,f=a-o;bT(this.positionAnimationVertexArray,{t0:0,t1:0},{x:h[0]*p,y:h[1]*p,z:h[2]*p},{x:c[0]-this.baseP[0],y:c[1]-this.baseP[1],z:c[2]-this.baseP[2]}),bT(this.positionAnimationVertexArray,{t0:s,t1:l},{x:h[0]*f,y:h[1]*f,z:h[2]*f},{x:c[0]-this.baseP[0],y:c[1]-this.baseP[1],z:c[2]-this.baseP[2]}),bT(this.positionAnimationVertexArray,{t0:0,t1:0},{x:d[0]*p,y:d[1]*p,z:d[2]*p},{x:u[0]-this.baseP[0],y:u[1]-this.baseP[1],z:u[2]-this.baseP[2]}),bT(this.positionAnimationVertexArray,{t0:s,t1:l},{x:d[0]*f,y:d[1]*f,z:d[2]*f},{x:u[0]-this.baseP[0],y:u[1]-this.baseP[1],z:u[2]-this.baseP[2]});}}addAnimationTopFeature(e,t){const i=e?.targetValues,n=e?.times,r=i[0],o=n[0],a=n[1],s=i[1]-r,l=vl(t.x,t.y,r,this.x,this.y,this.z,this.projection),c=lc.DefaultEllipsoid.geodeticSurfaceNormal(l);bT(this.positionAnimationVertexArray,{t0:o,t1:a},{x:c[0]*s,y:c[1]*s,z:c[2]*s},{x:l[0]-this.baseP[0],y:l[1]-this.baseP[1],z:l[2]-this.baseP[2]});}addFeature(e,t,i,n,r,o){let a=0;const s=this.layers[0].paint.get("extrusion-height"),l=this.layers[0].paint.get("extrusion-base"),c=this.layers[0].paint.get("extrusion-pattern-factor"),u=l.evaluate(e,{},n)||0;a=s.evaluate(e,{},n)||0;const h=e?.properties?.animations?.positionKeyframeTrack;if(h){const e=h?.targetValues,t=h?.times;(!e||e.length<2||!t||t.length<2)&&console.warn(`${this.layers[0].id}图层的形变动画缺少形变的关键帧数据，至少要有2个形变数据`);}for(const i of Pv(t,500)){let t=0,n=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const e of i)if(0!==e.length){t+=e.length;for(let t=0;t<e.length;t++)if(t>=1){const i=e[t],r=e[t-1];if(AT(i,r))continue;if(!ST(i,r)){n.vertexLength+4>Ud.MAX_VERTEX_ARRAY_LENGTH&&(n=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const e=vl(i.x,i.y,u,this.x,this.y,this.z,this.projection);this.baseP||(this.baseP=e);const t=vl(i.x,i.y,a,this.x,this.y,this.z,this.projection),s=vl(r.x,r.y,u,this.x,this.y,this.z,this.projection),l=vl(r.x,r.y,a,this.x,this.y,this.z,this.projection),p=this.baseP,f=i.sub(r)._perp()._unit();if(c)TT(this.layoutVertexArray,e[0]-p[0],e[1]-p[1],e[2]-p[2],f[0],f[1],f[2],0,0,0),TT(this.layoutVertexArray,t[0]-p[0],t[1]-p[1],t[2]-p[2],f[0],f[1],f[2],0,1*c[1],0),TT(this.layoutVertexArray,s[0]-p[0],s[1]-p[1],s[2]-p[2],f[0],f[1],f[2],1*c[0],0,0),TT(this.layoutVertexArray,l[0]-p[0],l[1]-p[1],l[2]-p[2],f[0],f[1],f[2],1*c[0],1*c[1],0);else {const i=(d=f.y,new ft(2*Math.floor(f.x*vT)+0,d*vT*2,0*vT*2));TT(this.layoutVertexArray,e[0]-p[0],e[1]-p[1],e[2]-p[2],i.x,i.y,i.z,0,0,0),TT(this.layoutVertexArray,t[0]-p[0],t[1]-p[1],t[2]-p[2],i.x,i.y,i.z,0,1,0),TT(this.layoutVertexArray,s[0]-p[0],s[1]-p[1],s[2]-p[2],i.x,i.y,i.z,1,0,0),TT(this.layoutVertexArray,l[0]-p[0],l[1]-p[1],l[2]-p[2],i.x,i.y,i.z,1,1,0);}const m=n.vertexLength;this.indexArray.emplaceBack(m,m+2,m+1),this.indexArray.emplaceBack(m+1,m+2,m+3),o.push([e,t,s],[t,s,l]),n.vertexLength+=4,n.primitiveLength+=2,h&&this.addAnimationEdgeFeature(h,i,r);}}}if(n.vertexLength+t>Ud.MAX_VERTEX_ARRAY_LENGTH&&(n=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray)),"Polygon"!==bg.VectorTileFeature.types[e.type])continue;const r=[],s=[],l=n.vertexLength,p=[];for(const e of i){if(0===e.length)continue;e!==i[0]&&s.push(r.length/2);const t=ET(i);for(let i=0;i<e.length;i++){const n=e[i],o=[(n.x-t.minX)/t.maxLength,(n.y-t.minY)/t.maxLength],s=vl(n.x,n.y,a,this.x,this.y,this.z,this.projection);p.push(s),this.baseP||(this.baseP=s),TT(this.layoutVertexArray,s[0]-this.baseP[0],s[1]-this.baseP[1],s[2]-this.baseP[2],wT[0],wT[1],wT[2],o[0],o[1],1),r.push(n.x),r.push(n.y),h&&this.addAnimationTopFeature(h,n);}}const f=Xx(r,s);for(let e=0;e<f.length;e+=3)this.indexArray.emplaceBack(l+f[e],l+f[e+2],l+f[e+1]),o.push([p[f[e]],p[f[e+1]],p[f[e+2]]]);n.primitiveLength+=f.length/3,n.vertexLength+=t;}var d;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,r,n);}}function ST(e,t){return e.x===t.x&&(e.x<0||e.x>Ch)||e.y===t.y&&(e.y<0||e.y>Ch)}function AT(e,t){return e.x===t.x&&(0===e.x||8192===e.x)||e.y===t.y&&(0===e.y||8192===e.y)}function ET(e){let t=1/0,i=-1/0,n=1/0,r=-1/0;for(const o of e)for(const e of o)t>e.x&&(t=e.x),i<e.x&&(i=e.x),n>e.y&&(n=e.y),r<e.y&&(r=e.y);let o=i-t<512?512:i-t;return o<r-n&&(o=r-n),{minX:t,maxX:i,minY:n,maxY:r,maxLength:o}}function CT(e){for(let t=0;t<e.length;t++){const i=e[t];return i.every((e=>e.x<0))||i.every((e=>e.x>Ch))||i.every((e=>e.y<0))||i.every((e=>e.y>Ch))}}Ho("SphereExtrusionBucket",PT,{omit:["layers"],shallow:["matrix"]});var MT={paint:new Ip({"extrusion-opacity":new Ap(Og.paint_extrusion["extrusion-opacity"]),"extrusion-color":new Ap(Og.paint_extrusion["extrusion-color"]),"extrusion-translate":new Ap(Og.paint_extrusion["extrusion-translate"]),"extrusion-translate-anchor":new Ap(Og.paint_extrusion["extrusion-translate-anchor"]),"extrusion-pattern":new Ep(Og.paint_extrusion["extrusion-pattern"]),"extrusion-top-pattern":new Ep(Og.paint_extrusion["extrusion-top-pattern"]),"extrusion-height":new Ap(Og.paint_extrusion["extrusion-height"]),"extrusion-base":new Ap(Og.paint_extrusion["extrusion-base"]),"extrusion-pattern-factor":new Sp(Og.paint_extrusion["extrusion-pattern-factor"]),"extrusion-self-bloom":new Sp(Og.paint_extrusion["extrusion-self-bloom"]),"extrusion-bloom-height":new Sp(Og.paint_extrusion["extrusion-bloom-height"]),"extrusion-glow-pure-color-height":new Sp(Og.paint_extrusion["extrusion-glow-pure-color-height"]),"extrusion-glow-width":new Sp(Og.paint_extrusion["extrusion-glow-width"]),"extrusion-glow-speed":new Sp(Og.paint_extrusion["extrusion-glow-speed"]),"extrusion-roughness":new Sp(Og.paint_extrusion["extrusion-roughness"]),"extrusion-offset":new Ap(Og.paint_extrusion["extrusion-offset"]),"extrusion-rotation":new Ap(Og.paint_extrusion["extrusion-rotation"]),"extrusion-scale":new Ap(Og.paint_extrusion["extrusion-scale"])})};const IT=gi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_normal_vec2",components:2,type:"Int8"},{name:"a_data",components:4,type:"Uint8"},{name:"a_seq",components:1,type:"Uint16"}],4),LT=gi([{name:"a_ANS_POS_TIME",components:1,type:"Float32"},{name:"a_ANS_TRIP_TOTAL_TIME",components:1,type:"Float32"},{name:"a_ANS_TRIP_LENGTH",components:1,type:"Float32"}],4),{members:NT}=IT,RT=bg.VectorTileFeature.types,OT=Math.cos(Math.PI/180*37.5),DT=Math.pow(2,14)/.5;function FT(e,t,i,n,r,o,a,s){e.emplaceBack(t.x,t.y,t.z,n?1:0,r?1:-1,Math.round(63*i.x)+128,Math.round(63*i.y)+128,1+(0===o?0:o<0?-1:1)|(.5*a&63)<<2,.5*a>>6,s);}function zT(e,t,i,n){e.emplaceBack(t,i,n);}class BT{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.type=Ag.TRACKING,this.layoutVertexArray=new fa,this.tripsAnimationVertexArray=new ma,this.indexArray=new Ia,this.programConfigurations=new tf(NT,e.layers,e.zoom),this.segments=new Ud,this.projection=e.projection||ci.MERCATOR,this._animationFlag=!1;}populate(e,t,i){this.baseP||(this.x=t.x,this.y=t.y,this.z=t.z,this.zPow=Math.pow(2,this.z),this.baseP=Tl(this.x,this.y,this.z,this.projection),this.matrix=bl(this.baseP));for(const{feature:n,index:r,sourceLayerIndex:o}of e)if(this.layers[0]._featureFilter(new _p(this.zoom),n,i)){const e=_g(n);this.addFeature(n,e,r,i),t.featureIndex.insert(n,e,r,o,this.index);}}update(e,t){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,NT),this.indexBuffer=e.createIndexBuffer(this.indexArray),this._animationFlag&&this.uploadAnimationBuffers(e)),this.programConfigurations.upload(e),this.uploaded=!0;}uploadAnimationBuffers(e){this.animationVertexBuffers={},this.tripsAnimationVertexArray.length>0&&(this.animationVertexBuffers.tripsAnimationVertexBuffer=e.createVertexBuffer(this.tripsAnimationVertexArray,LT.members));}destroyAnimationBuffers(){if(Object.keys(this?.animationVertexBuffers).length>0)for(const e in this.animationVertexBuffers)Object.hasOwnProperty.call(this.animationVertexBuffers,e)&&this.animationVertexBuffers[e].destroy();}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this._animationFlag&&this.destroyAnimationBuffers());}addFeature(e,t,i,n){const r=this.layers[0].layout,o=r.get("tracking-join").evaluate(e,{}),a=r.get("tracking-cap"),s=r.get("tracking-miter-limit"),l=r.get("tracking-round-limit"),c=Number(e.properties.link_seq);for(const r of t)this.addLine(r,e,o,a,s,l,i,c,n);}addLine(e,t,i,n,r,o,a,s,l){const c=t?.properties?.animations?.tripsKeyframeTrack;if(c){const t=c?.times;t&&t.length===e.length?(c.available=!0,this._animationFlag=!0):c.available=!0;}const u="Polygon"===RT[t.type];let h=e.length;for(;h>=2&&e[h-1].equals(e[h-2]);)h--;let d=0;for(;d<h-1&&e[d].equals(e[d+1]);)d++;if(h<(u?3:2))return;"bevel"===i&&(r=1.05);const p=Ch/(512*this.overscaling)*15,f=e[d],m=this.segments.prepareSegment(10*h,this.layoutVertexArray,this.indexArray);this.distance=0;const _=n,g=u?"butt":n;let y,x,v,w,T,b,P,S=!0;this.e1=this.e2=this.e3=-1,u&&(y=e[h-2],T=f.sub(y)._unit()._perp());for(let t=d;t<h;t++){if(s+=1,v=u&&t===h-1?e[d+1]:e[t+1],v&&e[t].equals(v))continue;T&&(w=T),y&&(x=y),y=e[t],T=v?v.sub(y)._unit()._perp():w,w=w||T;let n=w.add(T);0===n.x&&0===n.y||n._unit();const a=n.x*T.x+n.y*T.y,l=0!==a?1/a:1/0,f=a<OT&&x&&v;if(f&&t>d){const e=y.dist(x);if(e>2*p){const i=y.sub(y.sub(x)._mult(p/e)._round());this.distance+=i.dist(x),this.addCurrentVertex(i,this.distance,w.mult(1),0,0,!1,m,s,{tripsKeyframeTrack:c,timeIndex:t}),x=i;}}const A=x&&v;let E=A?i:v?_:g;if(A&&"round"===E&&(l<o?E="miter":l<=2&&(E="fakeround")),"miter"===E&&l>r&&(E="bevel"),"bevel"===E&&(l>2&&(E="flipbevel"),l<r&&(E="miter")),x&&(this.distance+=y.dist(x)),"miter"===E)n._mult(l),this.addCurrentVertex(y,this.distance,n,0,0,!1,m,s,{tripsKeyframeTrack:c,timeIndex:t});else if("flipbevel"===E){if(l>100)n=T.clone().mult(-1);else {const e=w.x*T.y-w.y*T.x>0?-1:1,t=l*w.add(T).mag()/w.sub(T).mag();n._perp()._mult(t*e);}this.addCurrentVertex(y,this.distance,n,0,0,!1,m,s,{tripsKeyframeTrack:c,timeIndex:t}),this.addCurrentVertex(y,this.distance,n.mult(-1),0,0,!1,m,s,{tripsKeyframeTrack:c,timeIndex:t});}else if("bevel"===E||"fakeround"===E){const e=w.x*T.y-w.y*T.x>0,i=-Math.sqrt(l*l-1);if(e?(P=0,b=i):(b=0,P=i),S||this.addCurrentVertex(y,this.distance,w,b,P,!1,m,s,{tripsKeyframeTrack:c,timeIndex:t}),"fakeround"===E){const i=Math.floor(8*(.5-(a-.5)));let r;for(let n=0;n<i;n++)r=T.mult((n+1)/(i+1))._add(w)._unit(),this.addPieSliceVertex(y,this.distance,r,e,m,s,{tripsKeyframeTrack:c,timeIndex:t});this.addPieSliceVertex(y,this.distance,n,e,m,s,{tripsKeyframeTrack:c,timeIndex:t});for(let n=i-1;n>=0;n--)r=w.mult((n+1)/(i+1))._add(T)._unit(),this.addPieSliceVertex(y,this.distance,r,e,m,s,{tripsKeyframeTrack:c,timeIndex:t});}v&&this.addCurrentVertex(y,this.distance,T,-b,-P,!1,m,s,{tripsKeyframeTrack:c,timeIndex:t});}else "butt"===E?(S||this.addCurrentVertex(y,this.distance,w,0,0,!1,m,s,{tripsKeyframeTrack:c,timeIndex:t}),v&&this.addCurrentVertex(y,this.distance,T,0,0,!1,m,s,{tripsKeyframeTrack:c,timeIndex:t})):"square"===E?(S||(this.addCurrentVertex(y,this.distance,w,1,1,!1,m,s,{tripsKeyframeTrack:c,timeIndex:t}),this.e1=this.e2=-1),v&&this.addCurrentVertex(y,this.distance,T,-1,-1,!1,m,s,{tripsKeyframeTrack:c,timeIndex:t})):"round"===E&&(S||(this.addCurrentVertex(y,this.distance,w,0,0,!1,m,s,{tripsKeyframeTrack:c,timeIndex:t}),this.addCurrentVertex(y,this.distance,w,1,1,!0,m,s,{tripsKeyframeTrack:c,timeIndex:t}),this.e1=this.e2=-1),v&&(this.addCurrentVertex(y,this.distance,T,-1,-1,!0,m,s,{tripsKeyframeTrack:c,timeIndex:t}),this.addCurrentVertex(y,this.distance,T,0,0,!1,m,s,{tripsKeyframeTrack:c,timeIndex:t})));if(f&&t<h-1){const e=y.dist(v);if(e>2*p){const i=y.add(v.sub(y)._mult(p/e)._round());this.distance+=i.dist(y),this.addCurrentVertex(i,this.distance,T.mult(1),0,0,!1,m,s,{tripsKeyframeTrack:c,timeIndex:t}),y=i;}}S=!1;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},l);}calcTDSpacePoint(e){const t=wl(this.x+e.x/8192,this.y+e.y/8192,this.zPow,this.projection),i=lc.cartographicToCartesian3([t[0],t[1],0]);return new te(i[0]-this.baseP[0],i[1]-this.baseP[1],i[2]-this.baseP[2])}addCurrentVertex(e,t,i,n,r,o,a,s,l){const{tripsKeyframeTrack:c,timeIndex:u}=l;let h;const d=this.layoutVertexArray,p=this.indexArray;h=i.clone(),n&&h._sub(i.perp()._mult(n));const f=this.calcTDSpacePoint(e);if(FT(d,f,h,o,!1,n,t,s),c&&c.available){const{times:e,totalTime:t,tripLength:i}=c;zT(this.tripsAnimationVertexArray,e[u],t,i);}if(this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),this.e1=this.e2,this.e2=this.e3,h=i.mult(-1),r&&h._sub(i.perp()._mult(r)),FT(d,f,h,o,!0,-r,t,s),c&&c.available){const{times:e,totalTime:t,tripLength:i}=c;zT(this.tripsAnimationVertexArray,e[u],t,i);}this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),this.e1=this.e2,this.e2=this.e3,t>DT/2&&(this.distance=0,this.addCurrentVertex(e,this.distance,i,n,r,o,a,s,{tripsKeyframeTrack:c,timeIndex:u}));}addPieSliceVertex(e,t,i,n,r,o,a){const{tripsKeyframeTrack:s,timeIndex:l}=a;i=i.mult(n?-1:1);const c=this.indexArray;if(FT(this.layoutVertexArray,this.calcTDSpacePoint(e),i,!1,n,0,t,o),s&&s.available){const{times:e,totalTime:t,tripLength:i}=s;zT(this.tripsAnimationVertexArray,e[l],t,i);}this.e3=r.vertexLength++,this.e1>=0&&this.e2>=0&&(c.emplaceBack(this.e1,this.e2,this.e3),r.primitiveLength++),n?this.e2=this.e3:this.e1=this.e3;}}Ho("TrackingBucket",BT,{omit:["layers"],shallow:["matrix"]});const VT=new Ip({"tracking-cap":new Sp(Og.layout_tracking["tracking-cap"]),"tracking-join":new Ap(Og.layout_tracking["tracking-join"]),"tracking-miter-limit":new Sp(Og.layout_tracking["tracking-miter-limit"]),"tracking-round-limit":new Sp(Og.layout_tracking["tracking-round-limit"]),"tracking-sort-key":new Ap(Og.layout_tracking["tracking-sort-key"]),"tracking-display-mode":new Sp(Og.layout_tracking["tracking-display-mode"])});var UT={paint:new Ip({"tracking-opacity":new Ap(Og.paint_tracking["tracking-opacity"]),"tracking-color":new Ap(Og.paint_tracking["tracking-color"]),"tracking-translate":new Sp(Og.paint_tracking["tracking-translate"]),"tracking-translate-anchor":new Sp(Og.paint_tracking["tracking-translate-anchor"]),"tracking-width":new Ap(Og.paint_tracking["tracking-width"]),"tracking-gap-width":new Ap(Og.paint_tracking["tracking-gap-width"]),"tracking-offset":new Ap(Og.paint_tracking["tracking-offset"]),"tracking-blur":new Ap(Og.paint_tracking["tracking-blur"]),"tracking-type":new Sp(Og.paint_tracking["tracking-type"]),"tracking-run-time":new Sp(Og.paint_tracking["tracking-run-time"]),"tracking-seg-count":new Sp(Og.paint_tracking["tracking-seg-count"]),"tracking-seg-group":new Sp(Og.paint_tracking["tracking-seg-group"]),"tracking-speed":new Sp(Og.paint_tracking["tracking-speed"]),"tracking-delay":new Sp(Og.paint_tracking["tracking-delay"]),"tracking-speed-factor":new Sp(Og.paint_tracking["tracking-speed-factor"])}),layout:VT};const kT=new class extends Ap{possiblyEvaluate(e,t){return t=new _p(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,n){return t=ze({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,n)}}(UT.paint.properties["tracking-width"].specification);function GT(e,t){return t>0?t+2*e:e}kT.useIntegerZoom=!0;var HT={paint:new Ip({"3d-model-opacity":new Sp(Og["paint_3d-model"]["3d-model-opacity"])})},YT={paint:new Ip({"point-cloud-color":new Ap(Og["paint_3d-tiles"]["point-cloud-color"])})};const qT=gi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_normal_vec2",components:2,type:"Int8"},{name:"a_data",components:4,type:"Uint8"},{name:"a_extra_m",components:3,type:"Uint8"}],4),{members:XT}=qT,jT=bg.VectorTileFeature.types,WT=Math.cos(Math.PI/180*37.5),$T=Math.pow(2,14)/.5;let ZT=0,KT=0,QT=1;function JT(e,t,i,n,r,o,a){e.emplaceBack(t.x,t.y,t.z,n?1:0,r?1:-1,Math.round(63*i.x)+128,Math.round(63*i.y)+128,1+(0===o?0:o<0?-1:1)|(.5*a&63)<<2,.5*a>>6,255&ZT,parseInt(KT),parseInt(QT));}class eb{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.patternFeatures=[],this.type=Ag.SPRITE,this.layoutVertexArray=new ca,this.indexArray=new Ia,this.programConfigurations=new tf(XT,e.layers,e.zoom),this.segments=new Ud,this.projection=e.projection||ci.MERCATOR,this.curOpacity=0,this.curNum=0,this.curStatus=1,this._percent=0;}populate(e,t,i){this.baseP||(this.x=t.x,this.y=t.y,this.z=t.z,this.zPow=Math.pow(2,this.z),this.baseP=Tl(this.x,this.y,this.z,this.projection),this.matrix=bl(this.baseP)),this.hasPattern=Yx("sprite",this.layers,t);const n=[];for(const{feature:t,id:r,index:o,sourceLayerIndex:a}of e){const e=this.layers[0]._featureFilter.needGeometry,s={type:t.type,id:r,properties:t.properties,geometry:e?_g(t):[]};this.layers[0]._featureFilter(new _p(this.zoom),s,i)&&(e||(s.geometry=_g(t)),n.push({id:r,properties:t.properties,type:t.type,sourceLayerIndex:a,index:o,geometry:s.geometry,patterns:{}}));}for(const r of n){const{geometry:n,index:o,sourceLayerIndex:a}=r;if(this.hasPattern){this.imageNeedResize=!0;const e=qx("sprite",this.layers,r,this.zoom,t);this.patternFeatures.push(e);}else this.addFeature(r,n,o,i,{});t.featureIndex.insert(e[o].feature,n,o,a,this.index);}}update(e,t){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers);}addFeatures(e,t,i){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,i);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,XT),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());}addFeature(e,t,i,n,r){const o=this.layers[0].layout,a=o.get("sprite-join").evaluate(e,{}),s=o.get("sprite-cap"),l=o.get("sprite-miter-limit"),c=o.get("sprite-round-limit");KT=e.properties.link_seq?Number(e.properties.link_seq):KT,KT%=10,QT=Number(e.properties.status)||1;for(const r of t)this.addLine(r,e,a,s,l,c,i,n);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,r,n);}addLine(e,t,i,n,r,o){const a="Polygon"===jT[t.type];let s=e.length;for(;s>=2&&e[s-1].equals(e[s-2]);)s--;let l=0;for(;l<s-1&&e[l].equals(e[l+1]);)l++;if(s<(a?3:2))return;"bevel"===i&&(r=1.05);const c=Ch/(512*this.overscaling)*15,u=e[l],h=this.segments.prepareSegment(10*s,this.layoutVertexArray,this.indexArray);this.distance=0;const d=n,p=a?"butt":n;let f,m,_,g,y,x,v,w=!0;this.e1=this.e2=this.e3=-1,a&&(f=e[s-2],y=u.sub(f)._unit()._perp());for(let t=l;t<s;t++){if(ZT=Math.round(255/s*t),_=a&&t===s-1?e[l+1]:e[t+1],_&&e[t].equals(_))continue;y&&(g=y),f&&(m=f),f=e[t],y=_?_.sub(f)._unit()._perp():g,g=g||y;let n=g.add(y);0===n.x&&0===n.y||n._unit();const u=n.x*y.x+n.y*y.y,T=0!==u?1/u:1/0,b=u<WT&&m&&_;if(b&&t>l){const e=f.dist(m);if(e>2*c){const t=f.sub(f.sub(m)._mult(c/e)._round());this.distance+=t.dist(m),this.addCurrentVertex(t,this.distance,g.mult(1),0,0,!1,h),m=t;}}const P=m&&_;let S=P?i:_?d:p;if(P&&"round"===S&&(T<o?S="miter":T<=2&&(S="fakeround")),"miter"===S&&T>r&&(S="bevel"),"bevel"===S&&(T>2&&(S="flipbevel"),T<r&&(S="miter")),m&&(this.distance+=f.dist(m)),"miter"===S)n._mult(T),this.addCurrentVertex(f,this.distance,n,0,0,!1,h);else if("flipbevel"===S){if(T>100)n=y.clone().mult(-1);else {const e=g.x*y.y-g.y*y.x>0?-1:1,t=T*g.add(y).mag()/g.sub(y).mag();n._perp()._mult(t*e);}this.addCurrentVertex(f,this.distance,n,0,0,!1,h),this.addCurrentVertex(f,this.distance,n.mult(-1),0,0,!1,h);}else if("bevel"===S||"fakeround"===S){const e=g.x*y.y-g.y*y.x>0,t=-Math.sqrt(T*T-1);if(e?(v=0,x=t):(x=0,v=t),w||this.addCurrentVertex(f,this.distance,g,x,v,!1,h),"fakeround"===S){const t=Math.floor(8*(.5-(u-.5)));let i;for(let n=0;n<t;n++)i=y.mult((n+1)/(t+1))._add(g)._unit(),this.addPieSliceVertex(f,this.distance,i,e,h);this.addPieSliceVertex(f,this.distance,n,e,h);for(let n=t-1;n>=0;n--)i=g.mult((n+1)/(t+1))._add(y)._unit(),this.addPieSliceVertex(f,this.distance,i,e,h);}_&&this.addCurrentVertex(f,this.distance,y,-x,-v,!1,h);}else "butt"===S?(w||this.addCurrentVertex(f,this.distance,g,0,0,!1,h),_&&this.addCurrentVertex(f,this.distance,y,0,0,!1,h)):"square"===S?(w||(this.addCurrentVertex(f,this.distance,g,1,1,!1,h),this.e1=this.e2=-1),_&&this.addCurrentVertex(f,this.distance,y,-1,-1,!1,h)):"round"===S&&(w||(this.addCurrentVertex(f,this.distance,g,0,0,!1,h),this.addCurrentVertex(f,this.distance,g,1,1,!0,h),this.e1=this.e2=-1),_&&(this.addCurrentVertex(f,this.distance,y,-1,-1,!0,h),this.addCurrentVertex(f,this.distance,y,0,0,!1,h)));if(b&&t<s-1){const e=f.dist(_);if(e>2*c){const t=f.add(_.sub(f)._mult(c/e)._round());this.distance+=t.dist(f),this.addCurrentVertex(t,this.distance,y.mult(1),0,0,!1,h),f=t;}}w=!1;}}calcTDSpacePoint(e){const t=wl(this.x+e.x/8192,this.y+e.y/8192,this.zPow,this.projection),i=lc.cartographicToCartesian3([t[0],t[1],0]);return new te(i[0]-this.baseP[0],i[1]-this.baseP[1],i[2]-this.baseP[2])}addCurrentVertex(e,t,i,n,r,o,a){let s;const l=this.layoutVertexArray,c=this.indexArray;s=i.clone(),n&&s._sub(i.perp()._mult(n));const u=this.calcTDSpacePoint(e);JT(l,u,s,o,!1,n,t),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(c.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),this.e1=this.e2,this.e2=this.e3,s=i.mult(-1),r&&s._sub(i.perp()._mult(r)),JT(l,u,s,o,!0,-r,t),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(c.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),this.e1=this.e2,this.e2=this.e3,t>$T/2&&(this.distance=0,this.addCurrentVertex(e,this.distance,i,n,r,o,a));}addPieSliceVertex(e,t,i,n,r){i=i.mult(n?-1:1);const o=this.indexArray;JT(this.layoutVertexArray,this.calcTDSpacePoint(e),i,!1,n,0,t),this.e3=r.vertexLength++,this.e1>=0&&this.e2>=0&&(o.emplaceBack(this.e1,this.e2,this.e3),r.primitiveLength++),n?this.e2=this.e3:this.e1=this.e3;}}Ho("SpriteBucket",eb,{omit:["layers"],shallow:["matrix"]});const tb=new Ip({"sprite-cap":new Sp(Og.layout_sprite["sprite-cap"]),"sprite-join":new Ap(Og.layout_sprite["sprite-join"]),"sprite-miter-limit":new Sp(Og.layout_sprite["sprite-miter-limit"]),"sprite-round-limit":new Sp(Og.layout_sprite["sprite-round-limit"]),"sprite-sort-key":new Ap(Og.layout_sprite["sprite-sort-key"])});var ib={paint:new Ip({"sprite-opacity":new Ap(Og.paint_sprite["sprite-opacity"]),"sprite-color":new Ap(Og.paint_sprite["sprite-color"]),"sprite-translate":new Ap(Og.paint_sprite["sprite-translate"]),"sprite-translate-anchor":new Ap(Og.paint_sprite["sprite-translate-anchor"]),"sprite-width":new Ap(Og.paint_sprite["sprite-width"]),"sprite-gap-width":new Ap(Og.paint_sprite["sprite-gap-width"]),"sprite-offset":new Ap(Og.paint_sprite["sprite-offset"]),"sprite-blur":new Ap(Og.paint_sprite["sprite-blur"]),"sprite-speed-factor":new Ap(Og.paint_sprite["sprite-speed-factor"]),"sprite-speed":new Ap(Og.paint_sprite["sprite-speed"]),"sprite-pattern":new Ep(Og.paint_sprite["sprite-pattern"]),"sprite-move-direction":new Ap(Og.paint_sprite["sprite-move-direction"]),"sprite-interpolate":new Sp(Og.paint_sprite["sprite-interpolate"]),"sprite-status":new Ap(Og.paint_sprite["sprite-status"]),"sprite-instatus":new Ap(Og.paint_sprite["sprite-instatus"])}),layout:tb};const nb=new class extends Ap{possiblyEvaluate(e,t){return t=new _p(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,n){return t=ze({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,n)}}(ib.paint.properties["sprite-width"].specification);function rb(e,t){return t>0?t+2*e:e}nb.useIntegerZoom=!0;class ob extends Lx{constructor(e){super(e,{}),this.id=e.id,this.type=e.type,this.implementation=e;}serialize(){}resize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl);}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e);}}const ab=gi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_NORMAL_ED",components:3,type:"Float32"},{name:"a_ST",components:3,type:"Float32"}],4),{members:sb}=ab;function lb(e,t,i,n,r,o,a,s,l,c){e.emplaceBack(t,i,n,r,o,a,s,l,c);}class cb{constructor(e){this.featureTrangles=[],this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.type=Ag.HISTOGRAM,this.layoutVertexArray=new aa,this.indexArray=new Ia,this.programConfigurations=new tf(sb,e.layers,e.zoom),this.segments=new Ud,this.projection=e.projection||ci.MERCATOR;}populate(e,t,i){this.x=t.x,this.y=t.y,this.z=t.z;for(const{feature:t,index:n}of e)if(this.layers[0]._featureFilter(new _p(this.zoom),t,i)){const e=_g(t);this.addFeature(t,e,n,[],i);}this.baseP&&(this.matrix=bl(this.baseP));}update(e,t){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sb),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());}addFeature(e,t,i,n,r){let o=0,a=0;const s=this.layers[0].paint.get("histogram-height"),l=this.layers[0].paint.get("histogram-base");o=s.evaluate(e,{},r)||0,a=l.evaluate(e,{},r)||0,this.layers[0].layout.get("histogram-max-height-render")&&(o*=100,a*=100);for(const e of Pv(t,500)){let t=0;for(const i of e)t+=i.length;let i=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let t of e)if(0!==t.length&&!hb(t)){db(t)&&(t=Dv(t));for(let e=0;e<t.length;e++){const r=t[e];if(e>=1){const s=t[e-1];if(pb(r,s))continue;if(!ub(r,s)){i.vertexLength+4>Ud.MAX_VERTEX_ARRAY_LENGTH&&(i=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const e=vl(r.x,r.y,a,this.x,this.y,this.z,this.projection);this.baseP||(this.baseP=e);const t=vl(r.x,r.y,o,this.x,this.y,this.z,this.projection),l=vl(s.x,s.y,a,this.x,this.y,this.z,this.projection),c=vl(s.x,s.y,o,this.x,this.y,this.z,this.projection),u=this.baseP,h=new ft;h.subVectors(e,t);const d=new ft;d.subVectors(e,l);const p=h.cross(d);lb(this.layoutVertexArray,e[0]-u[0],e[1]-u[1],e[2]-u[2],p[0],p[1],p[2],0,a/5,0),lb(this.layoutVertexArray,t[0]-u[0],t[1]-u[1],t[2]-u[2],p[0],p[1],p[2],0,o/5,1);const f=20*new ft(l).distance(e);lb(this.layoutVertexArray,l[0]-u[0],l[1]-u[1],l[2]-u[2],p[0],p[1],p[2],f,a/5,0),lb(this.layoutVertexArray,c[0]-u[0],c[1]-u[1],c[2]-u[2],p[0],p[1],p[2],f,o/5,1);const m=i.vertexLength;this.indexArray.emplaceBack(m,m+1,m+2),this.indexArray.emplaceBack(m+1,m+2,m+3),n.push([e,t,l],[t,l,c]),i.vertexLength+=4,i.primitiveLength+=2;}}}}i.vertexLength+t>Ud.MAX_VERTEX_ARRAY_LENGTH&&(i=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray));const r=[],s=[],l=i.vertexLength,c=[];for(const t of e){if(0===t.length)continue;t!==e[0]&&s.push(r.length/2);const i=fb(e);for(let e=0;e<t.length;e++){const n=t[e],a=[(n.x-i.minX)/i.maxLength,(n.y-i.minY)/i.maxLength],s=vl(n.x,n.y,o+(this.x%2+this.y%2)/256,this.x,this.y,this.z,this.projection);c.push(s),this.baseP||(this.baseP=s),lb(this.layoutVertexArray,s[0]-this.baseP[0],s[1]-this.baseP[1],s[2]-this.baseP[2],0,8,0,a[0],a[1],1),r.push(n.x),r.push(n.y);}}const u=Xx(r,s);for(let e=0;e<u.length;e+=3)this.indexArray.emplaceBack(l+u[e],l+u[e+1],l+u[e+2]),n.push([c[u[e]],c[u[e+1]],c[u[e+2]]]);i.primitiveLength+=u.length/3,i.vertexLength+=t;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},r);}}function ub(e,t){return e.x===t.x&&(e.x<0||e.x>Ch)||e.y===t.y&&(e.y<0||e.y>Ch)}function hb(e){return e.every((e=>e.x<0))||e.every((e=>e.x>Ch))||e.every((e=>e.y<0))||e.every((e=>e.y>Ch))}function db(e){return !(e.every((e=>e.x>=0))&&e.every((e=>e.x<=Ch))&&e.every((e=>e.y>=0))&&e.every((e=>e.y<=Ch)))}function pb(e,t){return e.x===t.x&&(0===e.x||8192===e.x)||e.y===t.y&&(0===e.y||8192===e.y)}function fb(e){let t=1/0,i=-1/0,n=1/0,r=-1/0;for(const o of e)for(const e of o)t>e.x&&(t=e.x),i<e.x&&(i=e.x),n>e.y&&(n=e.y),r<e.y&&(r=e.y);let o=i-t<512?512:i-t;return o<r-n&&(o=r-n),{minX:t,maxX:i,minY:n,maxY:r,maxLength:o}}Ho("SphereHistogramBucket",cb,{omit:["layers"],shallow:["matrix"]});const mb=new Ip({"histogram-max-height-render":new Sp(Og.layout_histogram["histogram-max-height-render"]),"histogram-color-render":new Sp(Og.layout_histogram["histogram-color-render"])});var _b={paint:new Ip({"histogram-opacity":new Sp(Og.paint_histogram["histogram-opacity"]),"histogram-color":new Ap(Og.paint_histogram["histogram-color"]),"histogram-colors":new Sp(Og.paint_histogram["histogram-colors"]),"histogram-translate":new Sp(Og.paint_histogram["histogram-translate"]),"histogram-translate-anchor":new Sp(Og.paint_histogram["histogram-translate-anchor"]),"histogram-height":new Ap(Og.paint_histogram["histogram-height"]),"histogram-base":new Ap(Og.paint_histogram["histogram-base"]),"histogram-vertical-gradient":new Sp(Og.paint_histogram["histogram-vertical-gradient"]),"histogram-dynamic":new Sp(Og.paint_histogram["histogram-dynamic"]),"histogram-heightArr1":new Ap(Og.paint_histogram["histogram-heightArr1"]),"histogram-heightArr2":new Ap(Og.paint_histogram["histogram-heightArr2"]),"histogram-heightArr3":new Ap(Og.paint_histogram["histogram-heightArr3"]),"histogram-speed":new Sp(Og.paint_histogram["histogram-speed"]),"histogram-count":new Sp(Og.paint_histogram["histogram-count"]),"histogram-max-height":new Sp(Og.paint_histogram["histogram-max-height"]),"depth-change":new Sp(Og.paint_histogram["depth-change"])}),layout:mb};const gb=new Ip({"symtracking-display-mode":new Sp(Og.layout_symtracking["symtracking-display-mode"]),"symtracking-time-segment":new Sp(Og.layout_symtracking["symtracking-time-segment"]),"symtracking-fps":new Sp(Og.layout_symtracking["symtracking-fps"]),"symtracking-sort-key":new Ap(Og.layout_symtracking["symtracking-sort-key"]),"symtracking-z-order":new Sp(Og.layout_symtracking["symtracking-z-order"]),"compatible-mode":new Sp(Og.layout_symtracking["compatible-mode"]),"symbol-placement":new Sp(Og.layout_symtracking["symbol-placement"]),"symbol-spacing":new Sp(Og.layout_symtracking["symbol-spacing"]),"symbol-avoid-edges":new Sp(Og.layout_symtracking["symbol-avoid-edges"]),"icon-allow-overlap":new Sp(Og.layout_symtracking["icon-allow-overlap"]),"icon-ignore-placement":new Sp(Og.layout_symtracking["icon-ignore-placement"]),"icon-optional":new Sp(Og.layout_symtracking["icon-optional"]),"icon-rotation-alignment":new Sp(Og.layout_symtracking["icon-rotation-alignment"]),"icon-size":new Ap(Og.layout_symtracking["icon-size"]),"icon-text-fit":new Sp(Og.layout_symtracking["icon-text-fit"]),"icon-text-fit-padding":new Sp(Og.layout_symtracking["icon-text-fit-padding"]),"icon-image":new Ap(Og.layout_symtracking["icon-image"]),"icon-rotate":new Ap(Og.layout_symtracking["icon-rotate"]),"icon-padding":new Sp(Og.layout_symtracking["icon-padding"]),"icon-keep-upright":new Sp(Og.layout_symtracking["icon-keep-upright"]),"icon-offset":new Ap(Og.layout_symtracking["icon-offset"]),"icon-anchor":new Ap(Og.layout_symtracking["icon-anchor"]),"icon-pitch-alignment":new Sp(Og.layout_symtracking["icon-pitch-alignment"]),"text-pitch-alignment":new Sp(Og.layout_symtracking["text-pitch-alignment"]),"text-rotation-alignment":new Sp(Og.layout_symtracking["text-rotation-alignment"]),"text-field":new Ap(Og.layout_symtracking["text-field"]),"text-font":new Ap(Og.layout_symtracking["text-font"]),"text-size":new Ap(Og.layout_symtracking["text-size"]),"text-max-width":new Ap(Og.layout_symtracking["text-max-width"]),"text-line-height":new Sp(Og.layout_symtracking["text-line-height"]),"text-letter-spacing":new Ap(Og.layout_symtracking["text-letter-spacing"]),"text-justify":new Ap(Og.layout_symtracking["text-justify"]),"text-anchor":new Ap(Og.layout_symtracking["text-anchor"]),"text-max-angle":new Sp(Og.layout_symtracking["text-max-angle"]),"text-rotate":new Ap(Og.layout_symtracking["text-rotate"]),"text-padding":new Sp(Og.layout_symtracking["text-padding"]),"text-keep-upright":new Sp(Og.layout_symtracking["text-keep-upright"]),"text-transform":new Ap(Og.layout_symtracking["text-transform"]),"text-offset":new Ap(Og.layout_symtracking["text-offset"]),"text-allow-overlap":new Sp(Og.layout_symtracking["text-allow-overlap"]),"text-ignore-placement":new Sp(Og.layout_symtracking["text-ignore-placement"]),"text-optional":new Sp(Og.layout_symtracking["text-optional"])});var yb={paint:new Ip({"icon-opacity":new Ap(Og.paint_symtracking["icon-opacity"]),"icon-color":new Ap(Og.paint_symtracking["icon-color"]),"icon-halo-color":new Ap(Og.paint_symtracking["icon-halo-color"]),"icon-halo-width":new Ap(Og.paint_symtracking["icon-halo-width"]),"icon-halo-blur":new Ap(Og.paint_symtracking["icon-halo-blur"]),"icon-translate":new Sp(Og.paint_symtracking["icon-translate"]),"icon-translate-anchor":new Sp(Og.paint_symtracking["icon-translate-anchor"]),"text-opacity":new Ap(Og.paint_symtracking["text-opacity"]),"text-color":new Ap(Og.paint_symtracking["text-color"]),"text-halo-color":new Ap(Og.paint_symtracking["text-halo-color"]),"text-halo-width":new Ap(Og.paint_symtracking["text-halo-width"]),"text-halo-blur":new Ap(Og.paint_symtracking["text-halo-blur"]),"text-translate":new Sp(Og.paint_symtracking["text-translate"]),"text-translate-anchor":new Sp(Og.paint_symtracking["text-translate-anchor"]),"symtracking-delay":new Sp(Og.paint_symtracking["symtracking-delay"])}),layout:gb};const xb=gi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_NORMAL",components:1,type:"Uint8"},{name:"a_data",components:4,type:"Uint8"},{name:"a_seq",components:1,type:"Uint16"},{name:"a_info",components:2,type:"Uint16"}],4),{members:vb}=xb,wb=bg.VectorTileFeature.types,Tb=Math.cos(Math.PI/180*37.5),bb=Math.pow(2,14)/.5;class Pb{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={};})),this.type=Ag.DYNAMIC_LINE,this.layoutVertexArray=new da,this.indexArray=new Ia,this.programConfigurations=new tf(vb,e.layers,e.zoom),this.segments=new Ud,this.maxLineLength=0,this.projection=e.projection||ci.MERCATOR,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.seq=0,this.total=0,this.offset=0;}_convertGeometryPointToLine(e){const t=[];for(let i=0;i<e.length;i++){const n=[];let r=1/0,o=1/0,a=-1/0,s=-1/0;for(let t=0;t<e[i].length;t++){const l=e[i][t].x,c=e[i][t].y;n.push([l,c]),r>l&&(r=l),a<l&&(a=l),o>c&&(o=c),s<c&&(s=c);}t.push({type:"LineString",geometry:[n],min:[r,o],max:[a,s]});}return t}_convertLineToGeometry(e){const t=[];for(let i=0;i<e.length;i++){const n=e[i].geometry.map((e=>e.map((e=>new te(e[0],e[1])))));t.push(...n);}return t}populate(e,t,i){this.baseP||(this.x=t.x,this.y=t.y,this.z=t.z,this.zPow=Math.pow(2,this.z),this.baseP=Tl(this.x,this.y,this.z,this.projection),this.matrix=bl(this.baseP));for(const{feature:n,index:r,sourceLayerIndex:o}of e)if(this.layers[0]._featureFilter(new _p(this.zoom),n,i)){const e=_g(n),a=[];Ov(kv(this.z),0,8192,0,8192,this._convertGeometryPointToLine(e),a);const s=this._convertLineToGeometry(a);this.addFeature(n,s,r,i,{}),t.featureIndex.insert(n,e,r,o,this.index);}}update(e,t,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i);}addFeatures(e,t,i){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,i);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vb),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());}addFeature(e,t,i,n,r){const o=this.layers[0].layout,a=o.get("dynamicLine-join").evaluate(e,{}),s=o.get("dynamicLine-cap"),l=o.get("dynamicLine-miter-limit"),c=o.get("dynamicLine-round-limit");this.seq=e.properties.link_seq,this.total=e.properties.total_link_count,this.offset=e.properties.offset_link_count;for(const i of t)this.addLine(i,e,a,s,l,c);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,r,n);}addLine(e,t,i,n,r,o){this.distance=0,this.scaledDistance=0,this.totalDistance=0;const a="Polygon"===wb[t.type];let s=e.length;for(;s>=2&&e[s-1].equals(e[s-2]);)s--;let l=0;for(;l<s-1&&e[l].equals(e[l+1]);)l++;if(s<(a?3:2))return;"bevel"===i&&(r=1.05);const c=this.overscaling<=16?15*Ch/(512*this.overscaling):0,u=this.segments.prepareSegment(10*s,this.layoutVertexArray,this.indexArray);let h,d,p,f,m;this.e1=this.e2=-1,a&&(h=e[s-2],m=e[l].sub(h)._unit()._perp());for(let t=l;t<s;t++){if(this.seq++,p=t===s-1?a?e[l+1]:void 0:e[t+1],p&&e[t].equals(p))continue;m&&(f=m),h&&(d=h),h=e[t],m=p?p.sub(h)._unit()._perp():f,f=f||m;let _=f.add(m);0===_.x&&0===_.y||_._unit();const g=f.x*m.x+f.y*m.y,y=_.x*m.x+_.y*m.y,x=0!==y?1/y:1/0,v=2*Math.sqrt(2-2*y),w=y<Tb&&d&&p,T=f.x*m.y-f.y*m.x>0;if(w&&t>l){const e=h.dist(d);if(e>2*c){const t=h.sub(h.sub(d)._mult(c/e)._round());this.updateDistance(d,t),this.addCurrentVertex(t,f,0,0,u),d=t;}}const b=d&&p;let P=b?i:a?"butt":n;if(b&&"round"===P&&(x<o?P="miter":x<=2&&(P="fakeround")),"miter"===P&&x>r&&(P="bevel"),"bevel"===P&&(x>2&&(P="flipbevel"),x<r&&(P="miter")),d&&this.updateDistance(d,h),"miter"===P)_._mult(x),this.addCurrentVertex(h,_,0,0,u);else if("flipbevel"===P){if(x>100)_=m.mult(-1);else {const e=x*f.add(m).mag()/f.sub(m).mag();_._perp()._mult(e*(T?-1:1));}this.addCurrentVertex(h,_,0,0,u),this.addCurrentVertex(h,_.mult(-1),0,0,u);}else if("bevel"===P||"fakeround"===P){const e=-Math.sqrt(x*x-1),t=T?e:0,i=T?0:e;if(d&&this.addCurrentVertex(h,f,t,i,u),"fakeround"===P){const e=Math.round(180*v/Math.PI/20);for(let t=1;t<e;t++){let i=t/e;if(.5!==i){const e=i-.5;i+=i*e*(i-1)*((1.0904+g*(g*(3.55645-1.43519*g)-3.2452))*e*e+(.848013+g*(.215638*g-1.06021)));}const n=m.sub(f)._mult(i)._add(f)._unit()._mult(T?-1:1);this.addHalfVertex(h,n.x,n.y,!1,T,0,u);}}p&&this.addCurrentVertex(h,m,-t,-i,u);}else if("butt"===P)this.addCurrentVertex(h,_,0,0,u);else if("square"===P){const e=d?1:-1;this.addCurrentVertex(h,_,e,e,u);}else "round"===P&&(d&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),p&&(this.addCurrentVertex(h,m,-1,-1,u,!0),this.addCurrentVertex(h,m,0,0,u)));if(w&&t<s-1){const e=h.dist(p);if(e>2*c){const t=h.add(p.sub(h)._mult(c/e)._round());this.updateDistance(h,t),this.addCurrentVertex(t,m,0,0,u),h=t;}}}}calcTDSpacePoint(e){const t=wl(this.x+e.x/8192,this.y+e.y/8192,this.zPow,this.projection),i=lc.cartographicToCartesian3([t[0],t[1],0]);return new te(i[0]-this.baseP[0],i[1]-this.baseP[1],i[2]-this.baseP[2])}addCurrentVertex(e,t,i,n,r,o=!1){const a=t.y*n-t.x,s=-t.y-t.x*n;this.addHalfVertex(e,t.x+t.y*i,t.y-t.x*i,o,!1,i,r),this.addHalfVertex(e,a,s,o,!0,-n,r),this.distance>bb/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(e,t,i,n,r,o));}addHalfVertex(e,t,i,n,r,o,a){const s=this.scaledDistance,l=this.calcTDSpacePoint(e),c=.5*s;this.layoutVertexArray.emplaceBack(l.x,l.y,l.z,(n?2:0)+(r?1:0),Math.round(63*t)+128,Math.round(63*i)+128,1+(0===o?0:o<0?-1:1)|(63&c)<<2,c>>6,this.seq,this.total,this.offset);const u=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,u),a.primitiveLength++),r?this.e2=u:this.e1=u;}updateScaledDistance(){this.scaledDistance=this.distance;}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance();}}Ho("DynamicLineBucket",Pb,{omit:["layers","patternFeatures"],shallow:["matrix"]});const Sb=new Ip({"dynamicLine-cap":new Sp(Og.layout_dynamicLine["dynamicLine-cap"]),"dynamicLine-join":new Ap(Og.layout_dynamicLine["dynamicLine-join"]),"dynamicLine-miter-limit":new Sp(Og.layout_dynamicLine["dynamicLine-miter-limit"]),"dynamicLine-round-limit":new Sp(Og.layout_dynamicLine["dynamicLine-round-limit"]),"dynamicLine-sort-key":new Ap(Og.layout_dynamicLine["dynamicLine-sort-key"])});var Ab={paint:new Ip({"dynamicLine-opacity":new Ap(Og.paint_dynamicLine["dynamicLine-opacity"]),"dynamicLine-color":new Ap(Og.paint_dynamicLine["dynamicLine-color"]),"dynamicLine-width":new Ap(Og.paint_dynamicLine["dynamicLine-width"]),"dynamicLine-gap-width":new Ap(Og.paint_dynamicLine["dynamicLine-gap-width"]),"dynamicLine-blur":new Ap(Og.paint_dynamicLine["dynamicLine-blur"]),"dynamicLine-seg-group":new Sp(Og.paint_dynamicLine["dynamicLine-seg-group"]),"dynamicLine-speed":new Sp(Og.paint_dynamicLine["dynamicLine-speed"])}),layout:Sb};const Eb=new class extends Ap{possiblyEvaluate(e,t){return t=new _p(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,n){return t=ze({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,n)}}(Ab.paint.properties["dynamicLine-width"].specification);function Cb(e,t){return t>0?t+2*e:e}Eb.useIntegerZoom=!0;const Mb={raster:class extends Lx{constructor(e){super(e,Ox),this.maskingEnabled=e.maskingEnabled,this.maskingPolygonHierarchy=e.maskingPolygonHierarchy,this.depthTest=!!$(e["depth-test"])&&e["depth-test"],e["draw-mode"]&&(this.drawMode=e["draw-mode"]);}set maskingEnabled(e){this._maskingEnabled=e;}get maskingEnabled(){return this._maskingEnabled}set maskingPolygonHierarchy(e){this._maskingPolygonHierarchy=e,this._maskingPolygonPrimitive&&(this._maskingPolygonPrimitive.destroy(),this._maskingPolygonPrimitive=null);}get maskingPolygonHierarchy(){return this._maskingPolygonHierarchy}get maskingPolygonPrimitive(){return this._maskingPolygonPrimitive||this.maskingEnabled&&this.maskingPolygonHierarchy&&(this.maskingId=222,this._maskingPolygonPrimitive=function(e){const t=new tp({polygonHierarchy:e.polygonHierarchy,extrudedHeight:e.extrudedHeight,perPositionHeight:e.perPositionHeight,height:e.height,arcType:e.arcType}),i=Vx.fromType("Color",{color:"rgba(255,0,0,1.0)",opacity:1,doubleSided:!0,renderState:{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},depthTest:{enabled:!1,func:hc.LESS},stencilTest:{enabled:!0,frontFunction:hc.ALWAYS,frontOperation:{fail:hc.KEEP,zFail:hc.KEEP,zPass:hc.REPLACE},backFunction:hc.ALWAYS,backOperation:{fail:hc.KEEP,zFail:hc.KEEP,zPass:hc.REPLACE},reference:e.maskingId,mask:255},stencilMask:255}});return new by({geometry:t,material:i})}({polygonHierarchy:this.maskingPolygonHierarchy,extrudedHeight:0,perPositionHeight:!0,color:"red",maskingId:this.maskingId})),this._maskingPolygonPrimitive}},fill:class extends Lx{constructor(e){super(e,Vw);}getCrossfadeParameters(){return this._crossfadeParameters}recalculate(e,t){super.recalculate(e,t),this.paint=this._transitioningPaint.possiblyEvaluate(e),e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters());const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"],this.outlineFromFillColor=!0);}createBucket(e){return new xw(e)}queryRadius(){return 0}queryIntersectsFeature(e,t,i,n,r,o,a){return function(e,t){if(1===e.length)return Rw(t,e[0]);for(let i=0;i<t.length;i++){const n=t[i];for(let t=0;t<n.length;t++)if(Ow(e,n[t]))return !0}for(let i=0;i<e.length;i++)if(Rw(t,e[i]))return !0;for(let i=0;i<t.length;i++)if(Mw(e,t[i]))return !0;return !1}(zw(e,this.paint.get("fill-translate").value?.value,this.paint.get("fill-translate-anchor").value?.value,o.getMapViewParams().bearing*nt.TRANSFORM.DEG_TO_RAD,a),n)}hasOffscreenPass(){return 0!==this.paint.get("fill-opacity")&&"none"!==this.visibility}},line:Jw,circle:class extends Lx{constructor(e){super(e,aT);}createBucket(e){return new rT(e)}queryRadius(e){const t=e;return Fw("circle-radius",this,t)+Fw("circle-stroke-width",this,t)+0}queryIntersectsFeature(e,t,i,n,r,o,a,s){const l=zw(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.getMapViewParams().bearing*nt.TRANSFORM.DEG_TO_RAD,a),c=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i),u="map"===this.paint.get("circle-pitch-alignment"),h=u?l:function(e,t){return e.map((e=>sT(e,t)))}(l,s),d=u?c*a:c;for(const e of n)for(const t of e){const e=u?t:sT(t,s);let i=d;const n=new wt([t.x,t.y,0,1]).transform(s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?i*=n[3]/o.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(i*=o.cameraToCenterDistance/n[3]),Aw(h,e,i))return !0}return !1}},heatmap:class extends Lx{createBucket(e){return new hT(e)}constructor(e){super(e,pT),this._updateColorRamp();}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp();}_updateColorRamp(){this.colorRamp=fT({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampChanged=!0,this.colorRampTexture=null;}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null);}queryRadius(e){return Fw("heatmap-radius",this,e)}queryIntersectsFeature(){return !1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return ["heatmap","heatmapTexture"]}},symbol:class extends Lx{constructor(e){super(e,Fg);}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));}getValueAndResolveTokens(e,t,i,n){const r=this.layout.get(e).evaluate(t,{},i,n),o=this._unevaluatedLayout._values[e];return o.isDataDriven()||No(o.value)?r:mT(t.properties,r)}createBucket(e){return new Rg(e)}queryRadius(){return 0}queryIntersectsFeature(){return !1}hasOffscreenPass(){return 0!==this.paint.get("icon-opacity")&&0!==this.paint.get("text-opacity")&&"none"!==this.visibility}},extrusion:class extends Lx{constructor(e){super(e,MT),this.enableQuery=e.enableQuery||!1,e.hasOwnProperty("patternZoomOffset")&&(this.patternZoomOffset=e.patternZoomOffset);}createBucket(e){return new PT(e,this.enableQuery)}queryRadius(){return 0}queryIntersectsFeature(){return !1}hasOffscreenPass(){return 0!==this.paint.get("extrusion-opacity")&&"none"!==this.visibility}resize(){this.viewportFrame&&(this.viewportFrame.destroy(),this.viewportFrame=null);}},histogram:class extends Lx{constructor(e){super(e,_b);}createBucket(e){return new cb(e)}queryRadius(){return 0}queryIntersectsFeature(e,t,i,n,r,o,a){return zw(e,this.paint.get("histogram-translate"),this.paint.get("histogram-translate-anchor"),o.getMapViewParams().bearing*nt.TRANSFORM.DEG_TO_RAD,a),!1}hasOffscreenPass(){return 0!==this.paint.get("histogram-opacity")&&"none"!==this.visibility}resize(){this.viewportFrame&&(this.viewportFrame.destroy(),this.viewportFrame=null);}},sprite:class extends Lx{constructor(e){e&&e.layout&&"visible"===e.layout["border-visibility"]&&e.paint&&e.paint["sprite-gap-width"]&&(We("'sprite-gap-width' cannot be set when 'border-visibility' is 'visible'"),e.paint["sprite-gap-width"]=0),super(e,ib),this.gradientVersion=0;}_handleSpecialPaintPropertyUpdate(e){"sprite-gradient"===e&&(this.stepInterpolate=this._transitionablePaint._values["sprite-gradient"].value.expression._styleExpression.expression instanceof dr,this.gradientVersion=(this.gradientVersion+1)%Ie);}gradientExpression(){return this._transitionablePaint._values["sprite-gradient"].value.expression}getCrossfadeParameters(){return this._crossfadeParameters}recalculate(e,t){super.recalculate(e,t),e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this.paint._values["sprite-floorwidth"]=nb.possiblyEvaluate(this._transitioningPaint._values["sprite-width"].value,e);}createBucket(e){return new eb(e)}queryRadius(e){const t=e,i=rb(Fw("sprite-width",this,t),Fw("sprite-gap-width",this,t)),n=Fw("sprite-offset",this,t);return i/2+Math.abs(n)+0}queryIntersectsFeature(e,t,i,n,r,o,a){const s=zw(e,this.paint.get("sprite-translate"),this.paint.get("sprite-translate-anchor"),o.getMapViewParams().bearing*nt.TRANSFORM.DEG_TO_RAD,a),l=a/2*rb(this.paint.get("sprite-width").evaluate(t,i),this.paint.get("sprite-gap-width").evaluate(t,i)),c=Math.max(l,500),u=this.paint.get("sprite-offset").evaluate(t,i);return u&&(n=function(e,t){const i=[],n=new te(0,0);for(let r=0;r<e.length;r++){const o=e[r],a=[];for(let e=0;e<o.length;e++){const i=o[e],r=o[e+1],s=0===e?n:i.sub(o[e-1])._unit()._perp(),l=e===o.length-1?n:r.sub(i)._unit()._perp(),c=s._add(l)._unit();c._mult(1/(c.x*l.x+c.y*l.y)),a.push(c._mult(t)._add(i));}i.push(a);}return i}(n,u*a)),Ew(s,n,c)}hasOffscreenPass(){return 0!==this.paint.get("sprite-opacity")&&"none"!==this.visibility}},background:class extends Lx{constructor(e){super(e,Rx);}},tracking:class extends Lx{constructor(e){super(e,UT);}recalculate(e,t){super.recalculate(e,t),e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this.paint._values["tracking-floorwidth"]=kT.possiblyEvaluate(this._transitioningPaint._values["tracking-width"].value,e);}getCrossfadeParameters(){return this._crossfadeParameters}createBucket(e){return new BT(e)}queryRadius(e){const t=e,i=GT(Fw("tracking-width",this,t),Fw("tracking-gap-width",this,t)),n=Fw("tracking-offset",this,t);return i/2+Math.abs(n)+0}queryIntersectsFeature(e,t,i,n,r,o,a){const s=zw(e,this.paint.get("tracking-translate"),this.paint.get("tracking-translate-anchor"),o.getMapViewParams().bearing*nt.TRANSFORM.DEG_TO_RAD,a),l=a/2*GT(this.paint.get("tracking-width").evaluate(t,i),this.paint.get("tracking-gap-width").evaluate(t,i)),c=this.paint.get("tracking-offset").evaluate(t,i);return c&&(n=function(e,t){const i=[],n=new te(0,0);for(let r=0;r<e.length;r++){const o=e[r],a=[];for(let e=0;e<o.length;e++){const i=o[e],r=o[e+1],s=0===e?n:i.sub(o[e-1])._unit()._perp(),l=e===o.length-1?n:r.sub(i)._unit()._perp(),c=s._add(l)._unit();c._mult(1/(c.x*l.x+c.y*l.y)),a.push(c._mult(t)._add(i));}i.push(a);}return i}(n,c*a)),Ew(s,n,l)}},"3d-model":class extends Lx{constructor(e){super(e,HT),this.baseMatrixCalculated=!1,this.respectiveTransformation=!1,this.identityMatrix=!0,this.matrix=[],this.nodes=[],this.meshes=[],this.primitives=[];}},"3d-tiles":class extends Lx{constructor(e){super(e,YT);}},symtracking:class extends Lx{constructor(e){super(e,yb);}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));}getValueAndResolveTokens(e,t){const i=this.layout.get(e).evaluate(t,{}),n=this._unevaluatedLayout._values[e];return n.isDataDriven()||No(n.value)?i:mT(t.properties,i)}createBucket(e){return new jg(e)}queryRadius(){return 0}queryIntersectsFeature(){return !1}hasOffscreenPass(){return 0!==this.paint.get("icon-opacity")&&0!==this.paint.get("text-opacity")&&"none"!==this.visibility}},dynamicLine:class extends Lx{constructor(e){super(e,Ab);}recalculate(e,t){super.recalculate(e,t),this.paint._values["dynamicLine-floorwidth"]=Eb.possiblyEvaluate(this._transitioningPaint._values["dynamicLine-width"].value,e);}createBucket(e){return new Pb(e)}queryRadius(e){const t=e;return Cb(Fw("dynamicLine-width",this,t),Fw("dynamicLine-gap-width",this,t))/2}queryIntersectsFeature(e,t,i,n,r,o,a){return Ew([],n,a/2*Cb(this.paint.get("dynamicLine-width").evaluate(t,i),this.paint.get("dynamicLine-gap-width").evaluate(t,i)))}isTileClipped(){return !0}}};
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
var Ib=function(e,t,i,n,r){var o,a,s=8*r-n-1,l=(1<<s)-1,c=l>>1,u=-7,h=i?r-1:0,d=i?-1:1,p=e[t+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=s;u>0;o=256*o+e[t+h],h+=d,u-=8);for(a=o&(1<<-u)-1,o>>=-u,u+=n;u>0;a=256*a+e[t+h],h+=d,u-=8);if(0===o)o=1-c;else {if(o===l)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,n),o-=c;}return (p?-1:1)*a*Math.pow(2,o-n)},Lb=function(e,t,i,n,r,o){var a,s,l,c=8*o-r-1,u=(1<<c)-1,h=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,f=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),(t+=a+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(a++,l/=2),a+h>=u?(s=0,a=u):a+h>=1?(s=(t*l-1)*Math.pow(2,r),a+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,r),a=0));r>=8;e[i+p]=255&s,p+=f,s/=256,r-=8);for(a=a<<r|s,c+=r;c>0;e[i+p]=255&a,p+=f,a/=256,c-=8);e[i+p-f]|=128*m;},Nb=Rb;function Rb(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length;}Rb.Varint=0,Rb.Fixed64=1,Rb.Bytes=2,Rb.Fixed32=5;var Ob=4294967296,Db=1/Ob,Fb="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function zb(e){return e.type===Rb.Bytes?e.readVarint()+e.pos:e.pos+1}function Bb(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Vb(e,t,i){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(n);for(var r=i.pos-1;r>=e;r--)i.buf[r+n]=i.buf[r];}function Ub(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i]);}function kb(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i]);}function Gb(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i]);}function Hb(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i]);}function Yb(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i]);}function qb(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i]);}function Xb(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i]);}function jb(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i]);}function Wb(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i]);}function $b(e,t){return (e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Zb(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24;}function Kb(e,t){return (e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}Rb.prototype={destroy:function(){this.buf=null;},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,o=this.pos;this.type=7&n,e(r,t,this),this.pos===o&&this.skip(n);}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=$b(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Kb(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=$b(this.buf,this.pos)+$b(this.buf,this.pos+4)*Ob;return this.pos+=8,e},readSFixed64:function(){var e=$b(this.buf,this.pos)+Kb(this.buf,this.pos+4)*Ob;return this.pos+=8,e},readFloat:function(){var e=Ib(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Ib(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,n=this.buf;return t=127&(i=n[this.pos++]),i<128?t:(t|=(127&(i=n[this.pos++]))<<7,i<128?t:(t|=(127&(i=n[this.pos++]))<<14,i<128?t:(t|=(127&(i=n[this.pos++]))<<21,i<128?t:function(e,t,i){var n,r,o=i.buf;if(n=(112&(r=o[i.pos++]))>>4,r<128)return Bb(e,n,t);if(n|=(127&(r=o[i.pos++]))<<3,r<128)return Bb(e,n,t);if(n|=(127&(r=o[i.pos++]))<<10,r<128)return Bb(e,n,t);if(n|=(127&(r=o[i.pos++]))<<17,r<128)return Bb(e,n,t);if(n|=(127&(r=o[i.pos++]))<<24,r<128)return Bb(e,n,t);if(n|=(1&(r=o[i.pos++]))<<31,r<128)return Bb(e,n,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=n[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Fb?function(e,t,i){return Fb.decode(e.subarray(t,i))}(this.buf,t,e):function(e,t,i){for(var n="",r=t;r<i;){var o,a,s,l=e[r],c=null,u=l>239?4:l>223?3:l>191?2:1;if(r+u>i)break;1===u?l<128&&(c=l):2===u?128==(192&(o=e[r+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(a=e[r+2],128==(192&(o=e[r+1]))&&128==(192&a)&&((c=(15&l)<<12|(63&o)<<6|63&a)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(a=e[r+2],s=e[r+3],128==(192&(o=e[r+1]))&&128==(192&a)&&128==(192&s)&&((c=(15&l)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,n+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),n+=String.fromCharCode(c),r+=u;}return n}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Rb.Bytes)return e.push(this.readVarint(t));var i=zb(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Rb.Bytes)return e.push(this.readSVarint());var t=zb(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Rb.Bytes)return e.push(this.readBoolean());var t=zb(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Rb.Bytes)return e.push(this.readFloat());var t=zb(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Rb.Bytes)return e.push(this.readDouble());var t=zb(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Rb.Bytes)return e.push(this.readFixed32());var t=zb(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Rb.Bytes)return e.push(this.readSFixed32());var t=zb(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Rb.Bytes)return e.push(this.readFixed64());var t=zb(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Rb.Bytes)return e.push(this.readSFixed64());var t=zb(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Rb.Varint)for(;this.buf[this.pos++]>127;);else if(t===Rb.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Rb.Fixed32)this.pos+=4;else {if(t!==Rb.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8;}},writeTag:function(e,t){this.writeVarint(e<<3|t);},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t;}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Zb(this.buf,e,this.pos),this.pos+=4;},writeSFixed32:function(e){this.realloc(4),Zb(this.buf,e,this.pos),this.pos+=4;},writeFixed64:function(e){this.realloc(8),Zb(this.buf,-1&e,this.pos),Zb(this.buf,Math.floor(e*Db),this.pos+4),this.pos+=8;},writeSFixed64:function(e){this.realloc(8),Zb(this.buf,-1&e,this.pos),Zb(this.buf,Math.floor(e*Db),this.pos+4),this.pos+=8;},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var i,n;if(e>=0?(i=e%4294967296|0,n=e/4294967296|0):(n=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,n=n+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,i){i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,i.buf[i.pos]=127&(e>>>=7);}(i,0,t),function(e,t){var i=(7&e)<<4;t.buf[t.pos++]|=i|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))));}(n,t);}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))));},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e);},writeBoolean:function(e){this.writeVarint(Boolean(e));},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,i){for(var n,r,o=0;o<t.length;o++){if((n=t.charCodeAt(o))>55295&&n<57344){if(!r){n>56319||o+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):r=n;continue}if(n<56320){e[i++]=239,e[i++]=191,e[i++]=189,r=n;continue}n=r-55296<<10|n-56320|65536,r=null;}else r&&(e[i++]=239,e[i++]=191,e[i++]=189,r=null);n<128?e[i++]=n:(n<2048?e[i++]=n>>6|192:(n<65536?e[i++]=n>>12|224:(e[i++]=n>>18|240,e[i++]=n>>12&63|128),e[i++]=n>>6&63|128),e[i++]=63&n|128);}return i}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&Vb(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i;},writeFloat:function(e){this.realloc(4),Lb(this.buf,e,this.pos,!0,23,4),this.pos+=4;},writeDouble:function(e){this.realloc(8),Lb(this.buf,e,this.pos,!0,52,8),this.pos+=8;},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i];},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var n=this.pos-i;n>=128&&Vb(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n;},writeMessage:function(e,t,i){this.writeTag(e,Rb.Bytes),this.writeRawMessage(t,i);},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Ub,t);},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,kb,t);},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Yb,t);},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Gb,t);},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Hb,t);},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,qb,t);},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Xb,t);},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,jb,t);},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Wb,t);},writeBytesField:function(e,t){this.writeTag(e,Rb.Bytes),this.writeBytes(t);},writeFixed32Field:function(e,t){this.writeTag(e,Rb.Fixed32),this.writeFixed32(t);},writeSFixed32Field:function(e,t){this.writeTag(e,Rb.Fixed32),this.writeSFixed32(t);},writeFixed64Field:function(e,t){this.writeTag(e,Rb.Fixed64),this.writeFixed64(t);},writeSFixed64Field:function(e,t){this.writeTag(e,Rb.Fixed64),this.writeSFixed64(t);},writeVarintField:function(e,t){this.writeTag(e,Rb.Varint),this.writeVarint(t);},writeSVarintField:function(e,t){this.writeTag(e,Rb.Varint),this.writeSVarint(t);},writeStringField:function(e,t){this.writeTag(e,Rb.Bytes),this.writeString(t);},writeFloatField:function(e,t){this.writeTag(e,Rb.Fixed32),this.writeFloat(t);},writeDoubleField:function(e,t){this.writeTag(e,Rb.Fixed64),this.writeDouble(t);},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t));}};const Qb=3;function Jb(e,t,i){1===e&&i.readMessage(eP,t);}function eP(e,t,i){if(3===e){const{id:e,bitmap:n,width:r,height:o,left:a,top:s,advance:l}=i.readMessage(tP,{});t.push({id:e,bitmap:new fw({width:r+2*Qb,height:o+2*Qb},n),metrics:{width:r,height:o,left:a,top:s,advance:l}});}}function tP(e,t,i){1===e?t.id=i.readVarint():2===e?t.bitmap=i.readBytes():3===e?t.width=i.readVarint():4===e?t.height=i.readVarint():5===e?t.left=i.readSVarint():6===e?t.top=i.readSVarint():7===e&&(t.advance=i.readVarint());}const iP=Qb;class nP{constructor(){}clone(e){return e.uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e}initializeIndexed(e,t,i,n,r){this.uBuffer=e,this.vBuffer=t,this.heightBuffer=i,this.normalBuffer=n,this.index=r,this.first=void 0,this.second=void 0,this.ratio=void 0;}initializeFromClipResult(e,t,i){let n=t+1;return -1!==e[t]?i[e[t]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=i[e[n]],++n,this.second=i[e[n]],++n,this.ratio=e[n],++n),n}getKey(){return this.isIndexed()?`${this.index||0}`:JSON.stringify({first:this.first?this.first.getKey():"",second:this.second?this.second.getKey():"",ratio:this.ratio||0})}isIndexed(){return null!=this.index}getH(){return null!=this.index?this.heightBuffer[this.index]:this.first&&this.second?Pl(this.first.getH(),this.second.getH(),this.ratio||0):0}getU(){return null!=this.index?this.uBuffer[this.index]:this.first&&this.second?Pl(this.first.getU(),this.second.getU(),this.ratio||0):0}getV(){return null!=this.index?this.vBuffer[this.index]:this.first&&this.second?Pl(this.first.getV(),this.second.getV(),this.ratio||0):0}}function rP(e,t){let i;i=t?`a_${e.property}`:`v_${e.property}`;let n="    vec4 color;\n";if("interval"===e.type){let t=new Di(0,0,0,1);if(e.default&&(t=Di.parse(e.default)),e.stops){const r=e.stops.length;for(let o=0;o<r;o+=1){const r=e.stops[o];0===o?(n+=`    if (${i} <= float(${r[0]})) \n`,n+=`        { color = vec4(${t.r}, ${t.g}, ${t.b}, ${t.a}); }\n`,t=Di.parse(r[1])):(r[0]<=e.stops[o-1][0]&&console.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.'),n+=`    else if (${i} <= float(${r[0]})) \n`,n+=`        { color = vec4(${t.r}, ${t.g}, ${t.b}, ${t.a}); }\n`,t=Di.parse(r[1]));}n+=`    else { color = vec4(${t.r}, ${t.g}, ${t.b}, ${t.a}); }\n`;}else n+=`    color = vec4(${t.r}, ${t.g}, ${t.b}, ${t.a});\n`;}else if("categorical"===e.type){let t=new Di(0,0,0,1);if(e.default&&(t=Di.parse(e.default)),e.stops){let r;const o=e.stops.length;for(let t=0;t<o;t+=1){const o=e.stops[t];0===t?(r=Di.parse(o[1]),n+=`    if (${i} == float(${o[0]})) \n`,n+=`        { color = vec4(${r.r}, ${r.g}, ${r.b}, ${r.a}); }\n`):(o[0]<=e.stops[t-1][0]&&console.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.'),r=Di.parse(o[1]),n+=`    else if (${i} == float(${o[0]})) \n`,n+=`        { color = vec4(${r.r}, ${r.g}, ${r.b}, ${r.a}); }\n`);}n+=`    else { color = vec4(${t.r}, ${t.g}, ${t.b}, ${t.a}); }\n`;}else n+=`    color = vec4(${t.r}, ${t.g}, ${t.b}, ${t.a});\n`;}else if("exponential"===e.type){let t=new Di(0,0,0,1),r=1;if(e.default&&(t=Di.parse(e.default)),e.base&&(r=e.base),e.stops){const o=e.stops.length;for(let a=0;a<o;a+=1){const o=e.stops[a];if(0===a)n+=`    if (${i} <= float(${o[0]})) \n`,n+=`        { color = vec4(${t.r}, ${t.g}, ${t.b}, ${t.a}); }\n`;else {const s=e.stops[a-1];o[0]<=s[0]&&console.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.');const l=Di.parse(s[1]),c=Di.parse(o[1]);n+=`    else if (${i} <= float(${o[0]})) \n`,n+="        { color = getExponentialInterpColor( \n",n+=`            ${i}, \n`,n+=`            float(${r}), \n`,n+=`            float(${s[0]}), \n`,n+=`            float(${o[0]}), \n`,n+=`            vec4(${l.r}, ${l.g}, ${l.b}, ${l.a}), \n`,n+=`            vec4(${c.r}, ${c.g}, ${c.b}, ${c.a})); \n`,n+="        }\n",t=c;}}n+=`    else { color = vec4(${t.r}, ${t.g}, ${t.b}, ${t.a}); }\n`;}else n+=`    color = vec4(${t.r}, ${t.g}, ${t.b}, ${t.a});\n`;}else console.error(`Unknown interpolation type ${e.type}`);return n}class oP{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const i=e[t];this._stringToNumber[i]=t,this._numberToString[t]=i;}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class aP{constructor(e,t,i,n){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=i,e._y=n,this.properties=e.properties,null!=e.id&&(this.id=e.id);}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e;}toJSON(){const e={geometry:this.geometry};for(const t in this)"_geometry"!==t&&"_vectorTileFeature"!==t&&(e[t]=this[t]);return e}}class sP{constructor(e,t,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new xi(Ch,16,0),this.grid3D=new xi(Ch,16,0),this.featureIndexArray=new Ha,this.promoteId=t,this.projection=i;}insert(e,t,i,n,r,o){const a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,n,r);const s=o?this.grid3D:this.grid;for(let e=0;e<t.length;e++){const i=t[e],n=[1/0,1/0,-1/0,-1/0];for(let e=0;e<i.length;e++){const t=i[e];n[0]=Math.min(n[0],t.x),n[1]=Math.min(n[1],t.y),n[2]=Math.max(n[2],t.x),n[3]=Math.max(n[3],t.y);}n[0]<Ch&&n[1]<Ch&&n[2]>=0&&n[3]>=0&&s.insert(a,n[0],n[1],n[2],n[3]);}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new bg.VectorTile(new Nb(this.rawTileData),null,this.projection).layers,this.sourceLayerCoder=new oP(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,t,i,n){this.loadVTLayers();const r=e.params||{},o=Ch/e.tileSize/e.scale,a=tx(r.filter),s=e.queryGeometry,l=e.queryPadding*o,c=cP(s),u=this.grid.query(c.minX-l,c.minY-l,c.maxX+l,c.maxY+l),h=cP(e.cameraQueryGeometry),d=this.grid3D.query(h.minX-l,h.minY-l,h.maxX+l,h.maxY+l,((t,i,n,r)=>function(e,t,i,n,r){for(const o of e)if(t<=o.x&&i<=o.y&&n>=o.x&&r>=o.y)return !0;const o=[new te(t,i),new te(t,r),new te(n,r),new te(n,i)];if(e.length>2)for(const t of o)if(Ow(e,t))return !0;for(let t=0;t<e.length-1;t++)if(Dw(e[t],e[t+1],o))return !0;return !1}(e.cameraQueryGeometry,t-l,i-l,n+l,r+l)));for(const e of d)u.push(e);u.sort(lP);const p={};let f;for(let l=0;l<u.length;l++){const c=u[l];if(c===f)continue;f=c;const h=this.featureIndexArray.get(c);let d=null;this.loadMatchingFeature(p,h.bucketIndex,h.sourceLayerIndex,h.featureIndex,a,r.layers,t,i,((t,i,r)=>(d||(d=_g(t)),i.queryIntersectsFeature(s,t,r,d,this.z,e.symbolMatrixHelper,o,i instanceof Jw?n:e.posMatrix))));}return p}loadMatchingFeature(e,t,i,n,r,o,a,s,l){const c=this.bucketLayerIDs[t];if(o&&!function(e,t){for(let i=0;i<e.length;i++)if(t.indexOf(e[i])>=0)return !0;return !1}(o,c))return;const u=this.sourceLayerCoder.decode(i),h=this.vtLayers[u].feature(n);if(!r(new _p(this.tileID.overscaledZ),h))return;const d=this.getId(h,u);for(let t=0;t<c.length;t++){const i=c[t];if(o&&o.indexOf(i)<0)continue;const r=a[i];if(!r)continue;let u={};void 0!==d&&s&&(u=s.getState(r.sourceLayer||"_geojsonTileLayer",d));const p=!l||l(h,r,u);if(!p)continue;const f=new aP(h,this.z,this.x,this.y);f.layer=r.serialize(),f.id=d;let m=e[i];void 0===m&&(m=e[i]=[]),m.push({featureIndex:n,feature:f,intersectionZ:p});}}lookupSymbolFeatures(e,t,i,n,r,o){const a={};this.loadVTLayers();const s=tx(n);for(const n of e)this.loadMatchingFeature(a,t,i,n,s,r,o);return a}hasLayer(e){for(const t of this.bucketLayerIDs)for(const i of t)if(e===i)return !0;return !1}getId(e,t){let i=e.id;return this.promoteId&&(i=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[t]],"boolean"==typeof i&&(i=Number(i))),i}}function lP(e,t){return t-e}function cP(e){let t=1/0,i=1/0,n=-1/0,r=-1/0;for(const o of e)t=Math.min(t,o.x),i=Math.min(i,o.y),n=Math.max(n,o.x),r=Math.max(r,o.y);return {minX:t,minY:i,maxX:n,maxY:r}}Ho("FeatureIndex",sP,{omit:["rawTileData","sourceLayerCoder"]});const uP=function(e,t){if(!e)return !1;const i=t.imageManager.getPattern(e.from),n=t.imageManager.getPattern(e.to);return !i||!n},hP=new Wh,dP=new It,pP=new Ot,fP=new wt,mP=new Ct,_P=new ft(.2875,-.4979646071760521,.9959292143521045),gP=new ft,yP=new Wh,xP=new ft(.0625,.5,1),vP=new Wh,wP=new It,TP=new It;class bP extends N_{constructor(e){super(e),this.isVectorMaterial=!0,this.type=e.type,this.layer=e.layer,this.tile=e.tile,this._renderState=e.renderState,this._defines=e.defines,this._programConfiguration=e.programConfiguration,this.hasPattern=e.hasPattern,this._createUniforms(e.painter);}update(e,t,i={}){const n=this.layer.paint.get("sprite-pattern");let r=!1;n.isConstant()||(r=!0),n.constantOr(null)&&(r=!0),bP.updateLayerProperty(this.layer,r),super.update(e,t,i);}_createUniforms(e){this._uniforms.set("u_PixelMatrix",(()=>(vP.identity(),vP.scale([1,Math.cos(e.transform.hpr.pitch)]),vP.rotate(-e.transform.hpr.heading),vP))),this._uniforms.set("u_Ratio",(()=>1/ig(this.tile,1,e.style.getNearestTileZoom()))),this.pushMinimumUniform("u_Ratio"),this._uniforms.set("u_GlUnitsToPixels",(()=>(wP.set(e.style.symbolMatrixHelper.width/2,-e.style.symbolMatrixHelper.height/2),wP))),this._uniforms.set("u_count",(()=>this.layer.count)),this.pushMinimumUniform("u_count"),this._uniforms.set("u_BaseColorSampler",(()=>(this.tile.imageAtlasTexture.bind(hc.LINEAR,hc.CLAMP_TO_EDGE),this.tile.imageAtlasTexture))),this.pushMinimumUniform("u_BaseColorSampler"),this._uniforms.set("u_texsize",(()=>(TP.set(this.tile.imageAtlasTexture.size[0],this.tile.imageAtlasTexture.size[1]),TP))),this._uniforms.set("u_scale",(()=>xP));}destroy(){super.destroy(),this.layer=void 0,this.tile=void 0,this._programConfiguration=void 0;}static updateLayerProperty(e,t){e.hasOwnProperty("count")||(e.count=0),e.timestamp||(e.timestamp=Date.now());const i=Date.now(),n=i-e.timestamp;let r=0;r=t?n/1e3:n/1e3*60,e.timestamp=i,e.count+=r;}}const PP=new It,SP=new Wh,AP=new It,EP=new It;class CP{constructor(e){this.uid=(1e3*Math.random()).toFixed(0),this.options=e||{},this.maxParallelRequests=e.maxParallelRequests||6,this.status="preparing",this.requestingCount=0,this.ids=[],this.requests={};}setMaxParallelRequests(e){this.maxParallelRequests=e;}run(){this.status="running";let e=this.maxParallelRequests-this.requestingCount;e<=0&&(e=1);for(let t=0;t<e;t++)this.releaseRequest();}pauseRequest(){this.status="pausing";}restart(){this.run();}checkStatus(){0===this.ids.length&&(this.status="stopped");}_nextRequest(e){this.removeRequestById(e),this.requestingCount--,"pausing"!==this.status&&(this.checkStatus(),this.releaseRequest());}pushRequest(e){return !this.hasRequest(e.id)&&(this.ids.push(e.id),this.requests[e.id]={req:null,send:!1,param:e.param,cb:(t,i,n,r,o)=>{this.requests[e.id]&&(e.cb(t,i,n,r,o),this._nextRequest(e.id));}},!0)}pushRequests(e){for(let t=0;t<e.length;t++)this.pushRequest(e[t]);}releaseRequest(){for(let e=0;e<this.ids.length;e++)if(!this.requests[this.ids[e]].send&&!this.requests[this.ids[e]].req){this.releaseRequestById(this.ids[e]),this.requestingCount++;break}}releaseRequestById(e){const t=this.requests[e];this.requests[e].send||this.requests[e].req||(t.req=Wu(t.param,t.cb),t.send=!0);}releaseRequestByIds(e){for(let t=0;t<e.length;t++)this.releaseRequestById(e[t]);}hasRequest(e){return -1!==this.ids.indexOf(e)}removeRequestById(e){if(this.hasRequest(e)){const t=this.ids.indexOf(e);this.ids.splice(t,1),this.cancelRequestById(e),delete this.requests[e];}}removeRequests(e){for(let t=0;t<e.length;t++)this.removeRequestById(e[t]);}removeAllRequest(){for(;this.ids.length>0;)this.removeRequestById(this.ids[0]);}cancelRequestById(e){const t=this.requests[e];t.send&&t.req&&t.req.cancel(),t.req=null,t.send=!1;}cancelRequests(e){for(let t=0;t<e.length;t++)this.cancelRequestById(e[t]);}cancelAllRequest(){for(let e=0;e<this.ids.length;e++)this.cancelRequestById(this.ids[e]);}destroy(){this.removeAllRequest(),this.ids=[],this.requests={};}}class MP extends CP{constructor(e){super(e);}pushRequest(e){return !this.hasRequest(e.id)&&(this.ids.push(e.id),this.requests[e.id]={req:null,send:!1,param:e.param,out:{},cb:(t,i,n,r)=>{this.done("image",{err:t,data:i,cacheControl:n,expires:r},e);}},!0)}done(e,{err:t,data:i},n){const r=this.requests[n.id];r&&(t&&(r.out.err=t),r.out.img=i&&!this._checkBase64(i)?new J.Blob([new Uint8Array(i)],{type:"image/png"}):null,n.cb(r.out.err,r.out),this._nextRequest(n.id));}releaseRequestById(e){const t=this.requests[e];this.requests[e].send||this.requests[e].req||(t.req=Wu(t.param,t.cb),t.requestTerrainFlag&&(t.terrainRequest=Wu(t.terrainParam,t.cb1)),t.send=!0);}cancelRequestById(e){const t=this.requests[e];t.send&&t.req&&t.req.cancel&&(t.req.cancel(),t.requestTerrainFlag&&t.terrainRequest&&t.terrainRequest.cancel()),t.req=null,t.terrainRequest=null,t.send=!1;}_checkBase64(e){if(e.byteLength>200)return !1;const t=new Uint8Array(e);let i="";for(let e=0;e<t.length;e++)i+=String.fromCharCode(t[e]);return -1!==i.indexOf("data:image")||-1!==i.indexOf("base64")}}class IP extends CP{constructor(e){super(e);}pushRequest(e){return !this.hasRequest(e.id)&&(this.ids.push(e.id),this.requests[e.id]={req:null,send:!1,param:e.param,data:null,cb:(t,i,n,r)=>{this.done("terrain",{err:t,data:i,cacheControl:n,expires:r},e);}},!0)}done(e,{err:t,data:i,cacheControl:n,expires:r},o){const a=this.requests[o.id];a&&(t&&(a.err=t),a.data={data:i,cacheControl:n,expires:r},o.cb(a.err,a.data),this._nextRequest(o.id));}releaseRequestById(e){const t=this.requests[e];this.requests[e].send||this.requests[e].req||(t.req=Wu(t.param,t.cb),t.send=!0);}cancelRequestById(e){const t=this.requests[e];t.send&&t.req&&t.req.cancel&&t.req.cancel(),t.req=null,t.send=!1;}}e.ARCTYPE=jd,e.Actor=class{constructor(e,t,i){this.target=e,this.parent=t,this.mapId=i,this.callbacks={},this.callbackID=0,Ge(["receive"],this),this.target.addEventListener("message",this.receive,!1);}send(e,t,i,n){const r=i?`${this.mapId}:${this.callbackID++}`:null;i&&(this.callbacks[r]=i);const o=[];if(this.target.postMessage({targetMapId:n,sourceMapId:this.mapId,type:e,id:String(r),data:Xo(t,o)},o),i)return {cancel:()=>this.target.postMessage({targetMapId:n,sourceMapId:this.mapId,type:"<cancel>",id:String(r)})}}receive(e){const t=e.data,i=t.id;let n;if(t.targetMapId&&this.mapId!==t.targetMapId)return;const r=(e,t)=>{delete this.callbacks[i];const n=[];this.target.postMessage(t&&t.img&&t.img.data&&0===t.img.data.byteLength?{sourceMapId:this.mapId,type:"<response>",id:String(i),error:Xo({message:"图片为空"}),data:null}:{sourceMapId:this.mapId,type:"<response>",id:String(i),error:e?Xo(e):null,data:Xo(t,n)},n);};if("<response>"===t.type||"<cancel>"===t.type)n=this.callbacks[t.id],delete this.callbacks[t.id],n&&t.error?n(jo(t.error)):n&&n(null,jo(t.data));else if(void 0!==t.id&&this.parent[t.type]){this.callbacks[t.id]=null;const e=jo(t.data);e.uid&&(e.uid=`${t.sourceMapId}:${e.uid}`),"reloadTile"===t.type&&(e.projection=this.parent.projection);const i=this.parent[t.type](t.sourceMapId,e,r);i&&null===this.callbacks[t.id]&&(this.callbacks[t.id]=i);}else if(void 0!==t.id&&this.parent.getWorkerSource){const e=t.type.split("."),i=jo(t.data);i.uid&&(i.uid=`${t.sourceMapId}:${i.uid}`),this.parent.getWorkerSource(t.sourceMapId,e[0],i.source)[e[1]](i,r);}else this.parent[t.type](jo(t.data));}remove(){this.target.removeEventListener("message",this.receive,!1);}},e.AlphaImage=fw,e.Anchor=Sg,e.AnimationPropertyCollection=Eh,e.ArcType=Xd,e.AxisAlignedBoundingBox=eu,e.BoundingRectangle=qd,e.BoundingSphere=Zc,e.CONSTS=nt,e.Cartographic=_s,e.ClassificationType=Zd,e.ClippingPlane=Py,e.ClippingPlaneCollection=ky,e.CollisionBoxArray=Da,e.Color=Di,e.CompressedTextureUtil=Cu,e.ContextLimits=vu,e.Coordinate=ee,e.CullingVolume=Ka,e.DefaultUp=fl,e.DepthMaterial=F_,e.DeveloperError=nl,e.DictionaryCoder=oP,e.EXTENT=Ch,e.Ellipsoid=oi,e.EllipsoidGeodesic=il,e.EncodedVector3=Qh,e.ErrorEvent=sl,e.Euler=zt,e.EvaluationParameters=_p,e.Event=al,e.Evented=ll,e.Feature=aP,e.FeatureIndex=sP,e.Formatted=mn,e.GLYPH_PBF_BORDER=iP,e.GeographicProjection=dc,e.Geometry=id,e.GltfTile=S_,e.HeadingPitchRoll=ot,e.INTERSECTION=Ya,e.ImageAtlas=gw,e.ImagePosition=_w,e.Interpolate=gr,e.IntersectionTests=Cs,e.Intersections2D=Uv,e.JulianDate=ec,e.LAYER_LAYOUT_CONSTS=rt,e.LightingModelType=Gy,e.LngLat=li,e.LngLatBounds=ai,e.Material=N_,e.MathArray=u,e.Matrix=bt,e.Matrix2=Wh,e.Matrix3=Ct,e.Matrix4=Ot,e.ModelInstance=Sh,e.ModelInstanceCollection=Ah,e.Node=T_,e.NormalMaterial=z_,e.Object3D=dl,e.OrientedBoundingBox=gu,e.OrthographicFrustum=hs,e.OrthographicOffCenterFrustum=cs,e.OverscaledTileID=Gh,e.PerspectiveOffCenterFrustum=ns,e.PhongLightSetter=Dx,e.PickColorMaterial=D_,e.PixelDatatype=Iu,e.PixelFormat=Nu,e.Plane=ja,e.PolygonGeometry=tp,e.PolygonGeometryLibrary=Wd,e.PolygonPipeline=Rd,e.PolylineGeometry=tg,e.PolylineMaterial=O_,e.PolylinePipeline=V_,e.Primitive=by,e.ProgramConfiguration=ef,e.ProjectionProxy=pi,e.ProjectionType=ci,e.Quaternion=Tt,e.RGBAImage=mw,e.Ray=Es,e.Rectangle=gs,e.RenderPassConsts=Jm,e.RenderState=e_,e.RequestPerformanceManger=class{constructor(e){this.options=e||{},this.imageCacheRequests={},this.vectorCacheRequests={},this.terrainCacheRequests={};}getTerrainRequesterById(e){return this.terrainCacheRequests[e]||(this.terrainCacheRequests[e]=new IP({id:e,maxParallelRequests:1})),this.terrainCacheRequests[e]}getImageRequesterById(e){return this.imageCacheRequests[e]||(this.imageCacheRequests[e]=new MP({id:e,maxParallelRequests:1})),this.imageCacheRequests[e]}getVectorRequesterById(e){return this.vectorCacheRequests[e]||(this.vectorCacheRequests[e]=new CP({id:e,maxParallelRequests:1})),this.vectorCacheRequests[e]}pauseVectorRequest(){for(const e in this.vectorCacheRequests)this.vectorCacheRequests[e].pauseRequest();}restartVectorRequest(){for(const e in this.vectorCacheRequests)this.vectorCacheRequests[e].restart();}removeTerrainRequesterById(e){this.terrainCacheRequests[e]&&(this.terrainCacheRequests[e].destroy(),delete this.terrainCacheRequests[e]);}removeImageRequesterById(e){this.imageCacheRequests[e]&&(this.imageCacheRequests[e].destroy(),delete this.imageCacheRequests[e]);}removeVectorRequesterById(e){this.vectorCacheRequests[e]&&(this.vectorCacheRequests[e].destroy(),delete this.vectorCacheRequests[e]);}removeAll(){for(const e in this.terrainCacheRequests)this.removeTerrainRequesterById(e);for(const e in this.imageCacheRequests)this.removeImageRequesterById(e);for(const e in this.vectorCacheRequests)this.removeVectorRequesterById(e);}destroy(){this.removeAll(),this.imageCacheRequests=null,this.vectorCacheRequests=null,this.terrainCacheRequests=null;}},e.ResourceType=Yu,e.SHADER_CIRCLE="sphereCircle",e.SHADER_FILL_COLOR="sphereFill",e.SHADER_FILL_OUTLINE_COLOR="sphereFillOutline",e.SHADER_HEATMAP_COLOR="sphereHeatmap",e.SHADER_HISTOGRAM_COLOR="sphereHistogram",e.SHADER_LINE_COLOR="sphereLine",e.SHADER_LINE_GRADIENT="sphereLineGradient",e.SHADER_LINE_PATTERN="sphereLinePattern",e.SHADER_LINE_SDF="sphereLineSDF",e.SHADER_LINE_SPRITE_COLOR="sphereSprite",e.SHADER_LINE_SPRITE_PATTERN="sphereSpritePattern",e.SHADER_LINE_TRACKING_COLOR="sphereTracking",e.SHADER_RASTER="sphereRaster",e.SHADER_SYMBOL_ICON="sphereSymbolIcon",e.SHADER_SYMBOL_SDF="sphereSymbolSDF",e.SHADER_SYMTRACKING_ICON="sphereSymtrackingIcon",e.SHADER_SYMTRACKING_SDF="sphereSymtrackingSDF",e.Sampler=Eu,e.SegmentVector=Ud,e.ShaderSource=v_,e.ShadowsType=E_,e.SpriteMaterial=bP,e.StandardMaterial=Vx,e.StandardMaterialType=Fx,e.State=Kh,e.StructArrayLayout11f44=na,e.StructArrayLayout21f84=Jo,e.StructArrayLayout2i4=Wo,e.StructArrayLayout2ui4=Na,e.StructArrayLayout3f12=ga,e.StructArrayLayout3f2f3f32=Qo,e.StructArrayLayout3f3f24=ra,e.StructArrayLayout3ui6=Ia,e.StructArrayLayout3ul12=La,e.StructArrayLayout4f16=Ra,e.StructArrayLayout5f20=Zo,e.SymbolMaterial=Ty,e.TerrainTileParser=class{constructor(){this.maxShort=32767,this.halfMaxShort=this.maxShort/2|0;}getCenterLngLat(e,t,i,n){const r=di(n),o=Math.pow(2,i+1);return r.tileNumberToLngLat([2*e+1,2*t+1],1,o)}createTerrain(e,t,i,n,r,o){if(!e||0===e.byteLength)return;e.buffer&&(e=e.buffer);const a=di(r),s=Math.pow(2,n),l=a.tileNumberToLngLat([t,i],1,s),c=a.tileNumberToLngLat([t+1,i+1],1,s),u=Math.abs(c.lng-l.lng),h=this.getCenterLngLat(t,i,n,r);let d=new Zo;const p=new Ia,f=new Na;let m=0;const _=3*Float64Array.BYTES_PER_ELEMENT,g=4*Float64Array.BYTES_PER_ELEMENT,y=3*Uint16Array.BYTES_PER_ELEMENT;let x=Uint16Array.BYTES_PER_ELEMENT,v=3*x;const w=new DataView(e);m+=_;const T=w.getFloat32(m,!0);m+=Float32Array.BYTES_PER_ELEMENT;const b=w.getFloat32(m,!0);m+=Float32Array.BYTES_PER_ELEMENT;const P=lc.cartographicToCartesian3([h.lng,h.lat,T]),S={vertex:[lc.cartographicToCartesian3([l.lng,l.lat,T]),lc.cartographicToCartesian3([c.lng,l.lat,T]),lc.cartographicToCartesian3([c.lng,c.lat,T]),lc.cartographicToCartesian3([l.lng,c.lat,T]),lc.cartographicToCartesian3([l.lng,l.lat,b]),lc.cartographicToCartesian3([c.lng,l.lat,b]),lc.cartographicToCartesian3([c.lng,c.lat,b]),lc.cartographicToCartesian3([l.lng,c.lat,b])],indices:[0,3,2,0,2,1,4,7,6,4,6,5,0,4,7,0,7,3,1,5,6,1,6,2,0,5,4,0,1,5,3,6,2,3,7,6]},A=[];for(let e=0;e<S.indices.length;)A.push([S.vertex[S.indices[e]],S.vertex[S.indices[e+1]],S.vertex[S.indices[e+2]]]),e+=3;let E;m+=g,m+=_;try{E=w.getUint32(m,!0);}catch(e){return}m+=Uint32Array.BYTES_PER_ELEMENT;const C=new Uint16Array(e,m,3*E);m+=E*y,E>65536&&(x=Uint32Array.BYTES_PER_ELEMENT,v=3*x);const M=C.subarray(0,E),I=C.subarray(E,2*E),L=C.subarray(2*E,3*E),N=[],R=[],O=[];this.zigZagDeltaDecode({uBuffer:M,vBuffer:I,heightBuffer:L,maximumHeight:b,minimumHeight:T,position:N,uv:R,hei:O,sphereMaskedBoundsArray:d,centerLngLat:h,deltaLng:u,projectionType:r,rP:P,worldSize:s,x:t,y:i,z:n}),m%x!=0&&(m+=x-m%x);const D=w.getUint32(m,!0);m+=Uint32Array.BYTES_PER_ELEMENT;const F=new Uint16Array(e,m,3*D);m+=D*v;let z=0;const B=F.length;for(let e=0;e<B;++e){const t=F[e];F[e]=z-t,0===t&&++z;}const V=w.getUint32(m,!0);m+=Uint32Array.BYTES_PER_ELEMENT;let U=new Uint16Array(e,m,V);m+=V*x;const k=w.getUint32(m,!0);m+=Uint32Array.BYTES_PER_ELEMENT;let G=new Uint16Array(e,m,k);m+=k*x;const H=w.getUint32(m,!0);m+=Uint32Array.BYTES_PER_ELEMENT;let Y=new Uint16Array(e,m,H);m+=H*x;const q=w.getUint32(m,!0);m+=Uint32Array.BYTES_PER_ELEMENT;let X=new Uint16Array(e,m,q);m+=q*x;const j=[];d=this.computeNormal(d,F,P,E,B,j);const W=[],$=this.genTerrainAnalysisArray(d,P,E,W,O),Z=Math.max(0,2*(U.length+G.length+Y.length+X.length-4)),K=new Uint16Array(B+3*Z);function Q(e,t){return I[e]-I[t]}function J(e,t){return M[e]-M[t]}K.set(F,0),U=this.sortIndicesIfNecessary(U,Q),G=this.sortIndicesIfNecessary(G,J),Y=this.sortIndicesIfNecessary(Y,Q),X=this.sortIndicesIfNecessary(X,J);let ee=B,te=C.length;ee=this.addSkirt(te,K,ee,U,!0,3,N,R,O,j,W,d,$,n,P,o),te+=3*U.length,ee=this.addSkirt(te,K,ee,G,!1,3,N,R,O,j,W,d,$,n,P,o),te+=3*G.length,ee=this.addSkirt(te,K,ee,Y,!1,3,N,R,O,j,W,d,$,n,P,o),te+=3*Y.length,this.addSkirt(te,K,ee,X,!0,3,N,R,O,j,W,d,$,n,P,o);for(let e=0;e<K.length;e+=3)p.emplaceBack(K[e],K[e+1],K[e+2]),f.emplaceBack(K[e],K[e+1]),f.emplaceBack(K[e+1],K[e+2]),f.emplaceBack(K[e+2],K[e]);return {sphereMaskedBoundsArray:d,sphereIndexArray:p,wireframeIndexArray:f,rP:P,count:N.length,minimumHeight:T,maximumHeight:b,tileBounds:A,tileBoundsVertex:S.vertex,indices:F,skirtIndex:F.length,vertexCountWithoutSkirts:E,x:t,y:i,z:n,uBuffer:M.slice(0),vBuffer:I.slice(0),hBuffer:L.slice(0),westIndices:U.slice(0),southIndices:G.slice(0),eastIndices:Y.slice(0),northIndices:X.slice(0),terrainAnalysisArray:$}}createChildTerrain(e){const t=this.upsampleQuantizedTerrainMesh(e);return t.skirtHeight=e.skirtHeight,this.createUpSampleTerrain(t)}createUpSampleTerrain(e){const t=di(e.projectionType),i=e.x,n=e.y,r=e.z,o=Math.pow(2,r),a=t.tileNumberToLngLat([i,n],1,o),s=t.tileNumberToLngLat([i+1,n+1],1,o),l=Math.abs(s.lng-a.lng),c=this.getCenterLngLat(i,n,r,e.projectionType);let u=new Zo;const h=new Ia,d=new Na,p=new Uint16Array(e.uBuffer),f=new Uint16Array(e.vBuffer),m=new Uint16Array(e.heightBuffer),_=[],g=[],y=[],x=e.maximumHeight,v=e.minimumHeight,w=lc.cartographicToCartesian3([c.lng,c.lat,v]);this.zigZagUpsampleDeltaDecode({uBuffer:p,vBuffer:f,heightBuffer:m,maximumHeight:x,minimumHeight:v,position:_,uv:g,hei:y,sphereMaskedBoundsArray:u,centerLngLat:c,deltaLng:l,projectionType:e.projectionType,rP:w,x:i,y:n,z:r,worldSize:o});const T=e.indices,b=T.length;let P=e.westIndices,S=e.eastIndices,A=e.northIndices,E=e.southIndices;const C=e.vertexCount,M=[];u=this.computeNormal(u,T,w,C,b,M);const I=[],L=this.genTerrainAnalysisArray(u,w,C,I,y),N=Math.max(0,2*(P.length+E.length+S.length+A.length-4)),R=new Uint16Array(b+3*N);function O(e,t){return f[e]-f[t]}function D(e,t){return p[e]-p[t]}R.set(T,0),P=this.sortIndicesIfNecessary(P,O),E=this.sortIndicesIfNecessary(E,D),S=this.sortIndicesIfNecessary(S,O),A=this.sortIndicesIfNecessary(A,D);let F=b,z=3*C;F=this.addSkirt(z,R,F,P,!0,3,_,g,y,M,I,u,L,r,w,e.skirtHeight),z+=3*P.length,F=this.addSkirt(z,R,F,E,!1,3,_,g,y,M,I,u,L,r,w,e.skirtHeight),z+=3*E.length,F=this.addSkirt(z,R,F,S,!1,3,_,g,y,M,I,u,L,r,w,e.skirtHeight),z+=3*S.length,this.addSkirt(z,R,F,A,!0,3,_,g,y,M,I,u,L,r,w,e.skirtHeight);for(let e=0;e<R.length;e+=3)h.emplaceBack(R[e],R[e+1],R[e+2]),d.emplaceBack(R[e],R[e+1]),d.emplaceBack(R[e+1],R[e+2]),d.emplaceBack(R[e+2],R[e]);return {sphereMaskedBoundsArray:u,sphereIndexArray:h,wireframeIndexArray:d,count:_.length,minimumHeight:v,maximumHeight:x,x:e.x,y:e.y,z:e.z,uBuffer:p.slice(0),vBuffer:f.slice(0),hBuffer:m,indices:T,westIndices:P.slice(0),southIndices:E.slice(0),northIndices:A.slice(0),eastIndices:S.slice(0),rP:w,skirtIndex:T.length,vertexCountWithoutSkirts:C,terrainAnalysisArray:L}}zigZagDecode(e){return e>>1^-(1&e)}zigZagDeltaDecode(e){const t=di(e.projectionType),i=e.uBuffer.length;let n=0,r=0,o=0;const a=(e.maximumHeight-e.minimumHeight)/this.maxShort,s=e.deltaLng/this.maxShort;for(let l=0;l<i;++l){n+=this.zigZagDecode(e.uBuffer[l]),r+=this.zigZagDecode(e.vBuffer[l]),o+=this.zigZagDecode(e.heightBuffer[l]),e.heightBuffer[l]=o,e.uBuffer[l]=n,e.vBuffer[l]=r,e.position[l]=[e.centerLngLat.lng+(n-this.halfMaxShort)*s,t.yLat(e.y-r/this.maxShort+1,e.worldSize)],e.uv[l]=[n,this.maxShort-r],e.hei[l]=e.minimumHeight+o*a;const i=lc.cartographicToCartesian3([e.position[l][0],e.position[l][1],e.hei[l]]);e.sphereMaskedBoundsArray.emplaceBack(i[0]-e.rP[0],i[1]-e.rP[1],i[2]-e.rP[2],e.uv[l][0],e.uv[l][1]);}}addSkirt(e,t,i,n,r,o,a,s,l,c,u,h,d,p,f,m){let _,g,y;r?(_=n.length-1,g=-1,y=-1):(_=0,g=n.length,y=1);let x=-1,v=e/o;for(let e=_;e!==g;e+=y){const r=n[e];a[v]=a[r],s[v]=s[r],l[v]=l[r]-m,c[v]=c[r],u[v]=u[r];const o=lc.cartographicToCartesian3([a[v][0],a[v][1],l[v]]);h.emplaceBack(o[0]-f[0],o[1]-f[1],o[2]-f[2],s[v][0],s[v][1],c[v][0],c[v][1],c[v][2]),d.emplaceBack(u[v][0],u[v][1],u[v][2],l[v]),-1!==x&&(t[i++]=x,t[i++]=v-1,t[i++]=r,t[i++]=v-1,t[i++]=v,t[i++]=r),x=r,++v;}return i}sortIndicesIfNecessary(e,t){const i=[];i.length=e.length;let n=!1;for(let r=0,o=e.length;r<o;++r)i[r]=e[r],n=n||r>0&&t(e[r-1],e[r])>0;return n?(i.sort(t),new Uint16Array(i)):e}upsampleQuantizedTerrainMesh(e){const t=e.isEastChild,i=e.isNorthChild,n=t?this.halfMaxShort:0,r=t?this.maxShort:this.halfMaxShort,o=i?this.halfMaxShort:0,a=i?this.maxShort:this.halfMaxShort,s=[],l=[],c=[],u=[],h={},d=e.indices;let p=0;const f=e.vertexCountWithoutSkirts,m=e.minimumHeight,_=e.maximumHeight,g=new Array(f),y=new Array(f),x=new Array(f),v=e.uBuffer,w=e.vBuffer,T=e.hBuffer;let b,P,S,A,E;const C=[],M=[];for(b=0,P=0;b<f;++b,P+=2)S=v[b],A=w[b],S<20&&(S=0),A<20&&(A=0),this.maxShort-S<20&&(S=this.maxShort),this.maxShort-A<20&&(A=this.maxShort),g[b]=S,y[b]=A,x[b]=T[b],(t&&S>=this.halfMaxShort||!t&&S<=this.halfMaxShort)&&(i&&A>=this.halfMaxShort||!i&&A<=this.halfMaxShort)&&(h[b]=p,s.push(S),l.push(A),c.push(x[b]),++p);const I=[];I.push(new nP),I.push(new nP),I.push(new nP);const L=[];L.push(new nP),L.push(new nP),L.push(new nP);const N=[];let R,O;for(N.push(new nP),N.push(new nP),N.push(new nP),N.push(new nP),b=0;b<d.length;b+=3){const e=d[b],n=d[b+1],r=d[b+2],o=g[e],a=g[n],p=g[r];I[0].initializeIndexed(g,y,x,null,e),I[1].initializeIndexed(g,y,x,null,n),I[2].initializeIndexed(g,y,x,null,r);const f=Uv.clipTriangleAtAxisAlignedThreshold(this.halfMaxShort,t,o,a,p,M);R=0,R>=f.length||(R=L[0].initializeFromClipResult(f,R,I),R>=f.length||(R=L[1].initializeFromClipResult(f,R,I),R>=f.length||(R=L[2].initializeFromClipResult(f,R,I),O=Uv.clipTriangleAtAxisAlignedThreshold(this.halfMaxShort,i,L[0].getV(),L[1].getV(),L[2].getV(),C),this.addClippedPolygon(s,l,c,u,h,O,L,N),R<f.length&&(L[2].clone(L[1]),L[2].initializeFromClipResult(f,R,I),O=Uv.clipTriangleAtAxisAlignedThreshold(this.halfMaxShort,i,L[0].getV(),L[1].getV(),L[2].getV(),C),this.addClippedPolygon(s,l,c,u,h,O,L,N)))));}const D=t?-this.maxShort:0,F=i?-this.maxShort:0,z=[],B=[],V=[],U=[];let k=Number.MAX_VALUE,G=-k;for(b=0;b<s.length;++b)S=Math.round(s[b]),S<=n?(z.push(b),S=0):S>=r?(V.push(b),S=this.maxShort):S=2*S+D,s[b]=S,A=Math.round(l[b]),A<=o?(B.push(b),A=0):A>=a?(U.push(b),A=this.maxShort):A=2*A+F,l[b]=A,E=Pl(m,_,c[b]/this.maxShort),E<k&&(k=E),E>G&&(G=E),c[b]=E;const H=G-k;for(b=0;b<c.length;++b)c[b]=this.maxShort*(c[b]-k)/H;return {minimumHeight:k,maximumHeight:G,westIndices:z,southIndices:B,eastIndices:V,northIndices:U,indices:u,uBuffer:s,vBuffer:l,heightBuffer:c,vertexCount:s.length,x:e.x,y:e.y,z:e.z,rP:e.rP,projectionType:e.projectionType}}zigZagUpsampleDeltaDecode(e){const t=di(e.projectionType),i=e.uBuffer.length;let n=0,r=0,o=0;const a=(e.maximumHeight-e.minimumHeight)/this.maxShort,s=e.deltaLng/this.maxShort;for(let l=0;l<i;++l){n=e.uBuffer[l],r=e.vBuffer[l],o=e.heightBuffer[l],e.position[l]=[e.centerLngLat.lng+(n-this.halfMaxShort)*s,t.yLat(e.y-r/this.maxShort+1,e.worldSize)],e.uv[l]=[n,this.maxShort-r],e.hei[l]=e.minimumHeight+o*a;const i=lc.cartographicToCartesian3([e.position[l][0],e.position[l][1],e.hei[l]]);e.sphereMaskedBoundsArray.emplaceBack(i[0]-e.rP[0],i[1]-e.rP[1],i[2]-e.rP[2],e.uv[l][0],e.uv[l][1]);}}addClippedPolygon(e,t,i,n,r,o,a,s){if(0===o.length)return;let l=0,c=0;for(;c<o.length;)c=s[l++].initializeFromClipResult(o,c,a);for(let n=0;n<l;++n){const o=s[n];if(o.isIndexed())o.newIndex=r[o.index],o.uBuffer=e,o.vBuffer=t,o.heightBuffer=i;else {const n=o.getKey();if(null!=r[n])o.newIndex=r[n];else {const a=e.length;e.push(o.getU()),t.push(o.getV()),i.push(o.getH()),o.newIndex=a,r[n]=a;}}}3===l?(n.push(s[0].newIndex),n.push(s[1].newIndex),n.push(s[2].newIndex)):4===l&&(n.push(s[0].newIndex),n.push(s[1].newIndex),n.push(s[2].newIndex),n.push(s[0].newIndex),n.push(s[2].newIndex),n.push(s[3].newIndex));}computeNormal(e,t,i,n,r,o){const a=e.float32,s=new ft,l=new ft,c=new ft,u=new ft,h=new Array(n),d=new Array(r/3),p=new Array(r);let f;for(f=0;f<n;f++)h[f]={indexOffset:0,count:0,currentCount:0};let m=0;for(f=0;f<r;f+=3){const e=t[f],i=t[f+1],n=t[f+2],r=5*e,o=5*i,s=5*n;l.x=a[r],l.y=a[r+1],l.z=a[r+2],c.x=a[o],c.y=a[o+1],c.z=a[o+2],u.x=a[s],u.y=a[s+1],u.z=a[s+2],h[e].count++,h[i].count++,h[n].count++,ft.subtract(c,l,c),ft.subtract(u,l,u);const p=ft.cross(c,u,new ft),_=p.len()/2;d[m]=p.multiplyScalar(_),m++;}let _,g=0;for(f=0;f<n;f++)h[f].indexOffset+=g,g+=h[f].count;for(m=0,f=0;f<r;f+=3){_=h[t[f]];let e=_.indexOffset+_.currentCount;p[e]=m,_.currentCount++,_=h[t[f+1]],e=_.indexOffset+_.currentCount,p[e]=m,_.currentCount++,_=h[t[f+2]],e=_.indexOffset+_.currentCount,p[e]=m,_.currentCount++,m++;}const y=new Qo;for(f=0;f<n;f++){const e=5*f;if(_=h[f],ft.clone(ft.ZERO,s),_.count>0){for(m=0;m<_.count;m++)ft.add(s,d[p[_.indexOffset+m]],s);ft.equalsEpsilon(ft.ZERO,s,nt.CesiumMath.EPSILON10)&&ft.clone(d[p[_.indexOffset]],s);}ft.equalsEpsilon(ft.ZERO,s,nt.CesiumMath.EPSILON10)&&(s.z=1),ft.normalize(s,s),y.emplaceBack(a[e],a[e+1],a[e+2],a[e+3],a[e+4],s.x,s.y,s.z),o[f]=[s.x,s.y,s.z];}return y}genTerrainAnalysisArray(e,t,i,n,r){const o=e.float32,a=new Ra;let s;for(s=0;s<i;s++){const e=8*s,i=new ft(o[e]+t[0],o[e+1]+t[1],o[e+2]+t[2]),l=lc.DefaultEllipsoid.geodeticSurfaceNormal(i,new ft);a.emplaceBack(l.x,l.y,l.z,r[s]),n[s]=[l.x,l.y,l.z];}return a}static genShaderScript(e){let t,i;return "slope"===e.property?(t="\nattribute vec3 a_NORMAL;\nattribute vec3 a_GEODETIC_NORMAL;\nvarying float v_slope;\n\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n\nvoid main(void) {\n\n\t// 计算gl_Position\n\tgl_Position = u_ModelViewProjectionMatrix * vec4(a_POSITION, 1.0);\n\t// 获取坡度\n\tv_slope = degrees(acos(dot(a_NORMAL, a_GEODETIC_NORMAL)));\n}\n\t\t\t",i="\nvarying float v_slope;\n\n#include <fn_getExponentialInterpColor>\n\nvoid main(void) {\n\t\t\t",i+=rP(e,!1),i+="\n\tgl_FragColor = color;\n}\n\t\t\t"):"aspect"===e.property?(t="\nattribute vec3 a_NORMAL;\nattribute vec3 a_GEODETIC_NORMAL;\nvarying float v_dot_product;\nvarying float v_determ;\n\n#include <c_define>\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n\nvoid main(void) {\n\n\t// 计算gl_Position\n\tgl_Position = u_ModelViewProjectionMatrix * vec4(a_POSITION, 1.0);\n\t// 计算法线在椭球切面的投影\n\tvec3 projection = normalize(a_NORMAL - dot(a_NORMAL, a_GEODETIC_NORMAL) * a_GEODETIC_NORMAL);\n\t// 计算enu坐标系的东方向\n\tvec3 east = normalize(cross(vec3(0.0, 0.0, 1.0), a_GEODETIC_NORMAL));\n\tv_dot_product = dot(projection, east);\n\t// 判断东方向和法线在椭球切面的投影构成的切面是向球心还是远离球心的\n    v_determ = dot(cross(projection, east), a_GEODETIC_NORMAL);\n}\n\t\t\t",i="\nvarying float v_dot_product;\nvarying float v_determ;\n\n#include <fn_getExponentialInterpColor>\n#include <fn_branchFreeTernary>\n\nvoid main(void) {\n\t// 计算夹角\n    float v_aspect = degrees(acos(v_dot_product));\n    v_aspect = branchFreeTernary(v_determ < 0.0, 360.0 - v_aspect, v_aspect);\n    // 将以东方向基准改为以北方向为基准\n    v_aspect += 90.0;\n    v_aspect = branchFreeTernary(v_aspect < 360.0, v_aspect, v_aspect - 360.0);\n\t\t\t",i+=rP(e,!1),i+="\n\tgl_FragColor = color;\n}\n\t\t\t"):"elevation_band"===e.property?(t="\nattribute float a_ELEVATION;\nvarying float v_elevation_band;\n\n#include <c_define>\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <fn_branchFreeTernary>\n\nvoid main(void) {\n\n\t// 计算gl_Position\n\tgl_Position = u_ModelViewProjectionMatrix * vec4(a_POSITION, 1.0);\n\n    v_elevation_band = a_ELEVATION;\n}\n\t\t\t",i="\nvarying float v_elevation_band;\n\n#include <fn_getExponentialInterpColor>\n\nvoid main(void) {\n\t\t\t",i+=rP(e,!1),i+="\n\tgl_FragColor = color;\n}\n\t\t\t"):console.error(`Unknown terrain analysis type ${e.property}`),{vs:t,fs:i}}},e.Texture=ah,e.TextureMagnificationFilter=Tu,e.TextureMinificationFilter=Pu,e.TextureWrap=Au,e.TileBoundingRegion=fh,e.TileDebugJSONRenderState=i_,e.Transforms=lc,e.V34Pos2V4PosUtil=Sl,e.ValidationError=Hy,e.Vector=at,e.Vector2=It,e.Vector3=ft,e.Vector4=wt,e.VectorCircleMaterial=class extends N_{constructor(e){super(e),this.isVectorMaterial=!0,this.layer=e.layer,this.tile=e.tile,this.plotter=e.plotter,this._programConfiguration=e.programConfiguration,this._renderState=e.renderState,this._createUniforms(e.painter);}update(e,t,i={}){super.update(e,t,i);}_createUniforms(e){this._uniforms.set("u_GlUnitsToPixels",(()=>(dP.set(e.style.symbolMatrixHelper.width/2,e.style.symbolMatrixHelper.height/2),dP))),this._uniforms.set("u_PixelMatrix",(()=>(hP.identity(),hP.scale([1,Math.cos(e.transform.hpr.pitch)]),hP.rotate(-e.transform.hpr.heading),hP)));}destroy(){this.layer=void 0,this.tile=void 0,this.pattern=void 0,this.plotter=void 0,this.type=void 0,this._uniforms=void 0,this._textures=void 0,this._program=void 0,this._programConfiguration=void 0,this._renderState=void 0,this._pixelMatrix=void 0;}},e.VectorExtrusionMaterial=class extends N_{constructor(e){super(e),this.isVectorMaterial=!1,this.layer=e.layer,this.tile=e.tile,this._programConfiguration=e.programConfiguration,this._renderState=e.renderState,this._pattern=this.layer.paint.get("extrusion-pattern"),this._topPattern=this.layer.paint.get("extrusion-top-pattern"),this.type=this.getProgramType(e.painter.style),this._error=null,this.animationsInfo=e.animationsInfo||{},this.bloomingParams=this.layer.paint.get("extrusion-self-bloom")?{selfBloom:this.layer.paint.get("extrusion-self-bloom"),bloomHeight:this.layer.paint.get("extrusion-bloom-height"),bloomSpeed:this.layer.paint.get("extrusion-glow-speed"),glowPureColorHeight:this.layer.paint.get("extrusion-glow-pure-color-height"),glowWidth:this.layer.paint.get("extrusion-glow-width")}:null,this._offset=$(this.layer.paint.get("extrusion-offset"))?this.layer.paint.get("extrusion-offset").value.value:[0,0],this._rotation=$(this.layer.paint.get("extrusion-rotation"))?this.layer.paint.get("extrusion-rotation").value.value:0,this._scale=$(this.layer.paint.get("extrusion-scale"))?this.layer.paint.get("extrusion-scale").value.value:1,this._buildVectorExtrusionDefines(),this._createUniforms(e.painter);}update(e,t,i){super.update(e,t,i),this.updateRenderState(i),this.updatePattern(e),this.updateBlooming(e),this._updateAnimationUniforms(e,t,i);}getProgramType(e){return this._hasPattern(e)||this.hasTopPattern(e)?"sphereExtrusionPattern":"sphereExtrusion"}updatePattern(e){const t=this.layer.paint.get("extrusion-pattern"),i=this.layer.paint.get("extrusion-top-pattern");let n=!1,r=!1;const o=this._pattern.constantOr(null),a=t.constantOr(null),s=this._topPattern.constantOr(null),l=i.constantOr(null);n=t?!o||a.from!==o.from||a.to!==o.to:!!this._pattern,r=i?!s||l.from!==s.from||l.to!==s.to:!!this._topPattern,(n||r)&&(this._pattern=t,this._topPattern=i,this.createPatternUniforms(e),this.type=this.getProgramType(e.style));}updateBlooming(e){let t=!1,i=null;this.layer.paint.get("extrusion-self-bloom")&&(i={selfBloom:this.layer.paint.get("extrusion-self-bloom"),bloomHeight:this.layer.paint.get("extrusion-bloom-height"),bloomSpeed:this.layer.paint.get("extrusion-glow-speed"),glowPureColorHeight:this.layer.paint.get("extrusion-glow-pure-color-height"),glowWidth:this.layer.paint.get("extrusion-glow-width")},this.bloomingParams.bloomHeight===i.bloomHeight&&this.bloomingParams.bloomSpeed===i.bloomSpeed&&this.bloomingParams.glowPureColorHeight===i.glowPureColorHeight&&this.bloomingParams.glowWidth===i.glowWidth||(t=!0)),t&&(this.bloomingParams=i,this.createBloomingUniforms(e));}static logDifferenceUniform(){}static tryDiffkeys(e,t){const i=t;for(let t=0;t<i.length;t++)e.pushMinimumUniform(i[t]);}_createUniforms(e){this.createCommonUniforms(e),this.createPatternUniforms(e),this.createBloomingUniforms(e);}createPatternUniforms(e){this._topPattern&&uP(this._topPattern,e);const t=new _p(e.style.getNearestTileZoom()).getCrossfadeParameters(),i=Math.pow(2,this.tile.tileID.overscaledZ),n=this.tile.tileSize*Math.pow(2,e.transform.tileZoom)/i,r=n*(this.tile.tileID.canonical.x+this.tile.tileID.wrap*i),o=n*this.tile.tileID.canonical.y;if(this._hasPattern(e.style)){const i=this._pattern.constantOr(1),n=this._pattern.constantOr(null);if(n&&this.tile.imageAtlas){const e=this.tile.imageAtlas,t=e.patternPositions[n.to.toString()],i=e.patternPositions[n.from.toString()];t&&i&&this._programConfiguration.setConstantPatternPositions(t,i);}if(i){const i=e.context.gl;e.context.activeTexture.set(i.TEXTURE0),this.tile.imageAtlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this._programConfiguration.updatePaintBuffers(t);}this._uniforms.set("u_offset",(()=>new It(this._offset[0],this._offset[1]))),this._uniforms.set("u_rotation",(()=>this._rotation*Math.PI/180)),this._uniforms.set("u_scale",(()=>this._scale)),this._uniforms.set("u_BaseColorSampler",(()=>this.tile.imageAtlasTexture)),this._uniforms.set("u_RenderBodyTex",(()=>{const t=this._pattern.constantOr(null);return !(t&&uP(t,e)||!this._pattern)}));}if(this.hasTopPattern(e.style)){this._uniforms.set("u_top_pattern_size_a",(()=>new It(this.tile.imageAtlasTexture.size[0],this.tile.imageAtlasTexture.size[1]))),this._uniforms.set("u_top_pattern_size_b",(()=>new It(this.tile.imageAtlasTexture.size[0],this.tile.imageAtlasTexture.size[1])));const i=this._topPattern.constantOr(1),n=this._topPattern.constantOr(null);if(n&&this.tile.imageAtlas){const e=this.tile.imageAtlas,t=e.patternPositions[n.to.toString()],i=e.patternPositions[n.from.toString()];t&&i&&this._programConfiguration.setConstantPatternPositions(t,i,!0);}if(i){const i=e.context.gl;e.context.activeTexture.set(i.TEXTURE1),this.tile.imageAtlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this._programConfiguration.updatePaintBuffers(t,!0);}this._uniforms.set("u_TopTexture",(()=>this.tile.imageAtlasTexture)),this._uniforms.set("u_RenderTopTex",(()=>{const t=this._topPattern.constantOr(null);return !(t&&uP(t,e)||!this._topPattern)}));}else this._uniforms.set("u_RenderTopTex",(()=>!1));this._uniforms.set("u_Opacity",(()=>1)),this._uniforms.set("u_texsize",(()=>new It(this.tile.imageAtlasTexture.size[0],this.tile.imageAtlasTexture.size[1]))),this._uniforms.set("u_mix",(()=>t.t)),this._uniforms.set("u_scale_a",(()=>t.fromScale)),this._uniforms.set("u_scale_b",(()=>t.toScale)),this._uniforms.set("u_Zoom",(()=>e.style.getNearestTileZoom())),this._uniforms.set("u_tile_units_to_pixels",(()=>1/ig(this.tile,1,e.style.getNearestTileZoom()))),this._uniforms.set("u_pixel_coord_upper",(()=>new It(r>>16,o>>16))),this._uniforms.set("u_pixel_coord_lower",(()=>new It(65535&r,65535&o)));}createCommonUniforms(e){Dx.setPhongLightUniform({material:this,phongLightConfig:this.layer.phongLightConfig}),this._uniforms.set("u_lightPos",(()=>(ft.clone(_P,gP),mP.identity(),mP.rotate(e.transform.hpr.heading,mP),gP.transformByMatrix3(mP)))),this._uniforms.set("u_Reflectivity",(()=>1)),this._uniforms.set("u_Shininess",(()=>30)),this._uniforms.set("u_Roughness",(()=>this.layer.paint.get("extrusion-roughness")));}createBloomingUniforms(e){if(this.bloomingParams&&this.bloomingParams.selfBloom){if(this.bloomingParams.height<=0)throw new Error("extrusion-bloom-height cannot be less than zero");if(this.bloomingParams.speed<=0)throw new Error("extrusion-glow-fps cannot be less than zero");this._uniforms.set("u_Time",(()=>e._map.timer.counter)),this._uniforms.set("u_BloomHeight",(()=>this.bloomingParams.bloomHeight)),this._uniforms.set("u_BloomSpeed",(()=>1/this.bloomingParams.bloomSpeed*this.bloomingParams.bloomHeight)),this._uniforms.set("u_SelfBloom",(()=>this.bloomingParams.selfBloom)),this._uniforms.set("u_PureColorHeight",(()=>this.bloomingParams.glowPureColorHeight)),this._uniforms.set("u_GlowWidth",(()=>this.bloomingParams.glowWidth));}}_updateAnimationUniforms(e,t,i){const{animationsInfo:n={}}=i;this._uniforms.set("u_ANS_CurrentTime",(()=>n.currentClipTime)),this.pushMinimumUniform("u_ANS_CurrentTime"),this.layer.clippingPlanes&&this.layer.clippingPlanes.enabled&&0!==this.layer.clippingPlanes.length&&(this.layer.clippingPlanes.update(e,t),this._uniforms.set("u_model_clippingPlanesEdgeStyle",(()=>(fP.set(this.layer.clippingPlanes.edgeColor.r,this.layer.clippingPlanes.edgeColor.g,this.layer.clippingPlanes.edgeColor.b,this.layer.clippingPlanes.edgeWidth),fP))),this.pushMinimumUniform("u_model_clippingPlanesEdgeStyle"),this._uniforms.set("u_model_clippingPlanes",(()=>this.layer.clippingPlanes.texture)),this.pushMinimumUniform("u_model_clippingPlanes"),this._uniforms.set("u_model_clippingPlanesMatrix",(()=>{const e=Ot.multiply(pP,t.camera.matrixWorldInverse,this.layer.clippingPlanes.modelMatrix);return Ot.inverseTranspose(e,e),e})),this.pushMinimumUniform("u_model_clippingPlanesMatrix"));}updateRenderState(e){const{renderStateTag:t,stencilTest:i,enableColorMask:n}=e;"first"===t?this.renderState={depthMask:t_.enableDepthMask,depthTest:t_.enableDepthTestWithLEQUAL,stencilMask:t_.disableStencilMask,stencilTest:t_.disableStencilTest,colorMask:n?t_.enableColorMask:t_.disabledColorMask}:"second"===t&&(this.renderState={depthMask:t_.enableDepthMask,depthTest:t_.enableDepthTestWithLEQUAL,stencilMask:t_.enableStencilMask,stencilTest:i,colorMask:t_.enableColorMask,blending:t_.enableBlending});}_buildVectorExtrusionDefines(){const e={};if(this.layer.clippingPlanes&&this.layer.clippingPlanes.enabled&&0!==this.layer.clippingPlanes.length){e.HAS_CLIPPING_PLANES=!0,e.USE_CLIPPING_PLANES_FLOAT_TEXTURE=!!this.layer.clippingPlanes._useFloatTexture;const t=ky.getTextureResolution(this.layer.clippingPlanes);e.CLIPPING_PLANES_LENGTH=this.layer.clippingPlanes.length,e.CLIPPING_PLANES_TEXTURE_WIDTH=t.x,e.CLIPPING_PLANES_TEXTURE_HEIGHT=t.y,e.UNION_CLIPPING_REGIONS=!!this.layer.clippingPlanes._unionClippingRegions;}else e.HAS_CLIPPING_PLANES=!1,e.CLIPPING_PLANES_LENGTH=0,e.CLIPPING_PLANES_TEXTURE_WIDTH=1,e.CLIPPING_PLANES_TEXTURE_HEIGHT=1;this.defines=e;}_hasPattern(e){if(this.layer.paint.get("extrusion-pattern")){const t=this.layer.paint.get("extrusion-pattern").constantOr(null);if(t)return !!e.getImage(t.from);if(!this.layer.paint.get("extrusion-pattern").isConstant())return !0}return !1}hasTopPattern(e){if(this.layer.paint.get("extrusion-top-pattern")){const t=this.layer.paint.get("extrusion-top-pattern").constantOr(null);if(t)return !!e.getImage(t.from);if(!this.layer.paint.get("extrusion-top-pattern").isConstant())return !0}return !1}destroy(){this.layer=void 0,this.tile=void 0,this.plotter=void 0,this.type=void 0,this._uniforms=void 0,this._textures=void 0,this._program=void 0,this.defines=void 0,this._programConfiguration=void 0,this._renderState=void 0,this._pattern=void 0,this._topPattern=void 0,this.bloomingParams=void 0;}},e.VectorFillMaterial=class extends N_{constructor(e){super(e),this.layer=e.layer,this.tile=e.tile,this.coord=e.tile.tileID,this.pattern=this.layer.paint.get("fill-pattern"),this.programId=e.programId,this._programConfiguration=e.programConfiguration,this._renderState=e.renderState,this._isShadowVolumeMaterial=e.shadowVolumeMaterial||!1;const t=e.painter,i=this.layer.paint.get("fill-water");this._isWater="water"===i;const n=this.layer.paint.get("fill-water-texture");this._texture=0!==n.length?this.getTextureUseUrl(t.textureResourceManager,{map:t._map,texUrl:n}):null,this._isWater=this._isWater&&this._texture;const r=this.layer.paint.get("sunlight-color");this._sunlightColor=new ft(r.r,r.g,r.b),this._sunlightDirection=new ft(this.layer.paint.get("sunlight-direction")),this._waveSize=1/this.layer.paint.get("fill-water-wave-size"),this._waveSpeed=this.layer.paint.get("fill-water-speed");const o=this.layer.paint.get("fill-color").value.value,a=this.layer.paint.get("sky-color");this._skyColor=new ft(a.r,a.g,a.b),this._waterColor=$(o)&&$(o.r)?new ft(o.r,o.g,o.b):new ft(0,0,.5),this._alpha=this.layer.paint.get("fill-opacity").value.value,this._offset=$(this.layer.paint.get("fill-translate"))?this.layer.paint.get("fill-translate").value.value:[0,0],this._rotation=$(this.layer.paint.get("fill-rotation"))?this.layer.paint.get("fill-rotation").value.value:0,this._scale=$(this.layer.paint.get("fill-scale"))?this.layer.paint.get("fill-scale").value.value:1,this.type=this.getProgramTypeAndCreateUniforms(t),this._isWater&&this.createUniforms(t);}getTextureUseUrl(e,t){const i=e.getTextureByName(t.texUrl);if(i)return i;const n=new ah(t);return t.texUrl&&n.load(t.texUrl),e.addTexture(t.texUrl,n),n}createUniforms(e){this._uniforms.set("u_Color",(()=>this._waterColor)),this._uniforms.set("u_SkyColor",(()=>this._skyColor)),this._uniforms.set("u_Opacity",(()=>this._alpha)),this._uniforms.set("u_Time",(()=>(this._time=e._map.time*this._waveSpeed,this._time))),this._uniforms.set("u_BaseColorSampler",(()=>(this._texture.sampler={minificationFilter:hc.LINEAR_MIPMAP_LINEAR,magnificationFilter:hc.LINEAR,wrapS:hc.REPEAT,wrapT:hc.REPEAT},this._texture))),this.pushMinimumUniform("u_BaseColorSampler"),this._uniforms.set("u_DistortionScale",(()=>3.7)),this._uniforms.set("u_SunColor",(()=>this._sunlightColor)),this._uniforms.set("u_SunDirection",(()=>this._sunlightDirection)),this._uniforms.set("u_IsWater",(()=>this._isWater)),this._uniforms.set("u_WaveSize",(()=>this._waveSize));}update(e,t,i={}){super.update(e,t,i);const n=this.layer.paint.get("fill-pattern");let r=!1;const o=this.pattern.constantOr(null),a=n.constantOr(null);r=n?!o||a.from!==o.from||a.to!==o.to:!!this.pattern,r&&(this.pattern=n,this.type=this.getProgramTypeAndCreateUniforms(e)),!this._isShadowVolumeMaterial&&e.tileClippingMask.status&&(this._renderState.stencilTest={enabled:!0,frontFunction:hc.NOTEQUAL,backFunction:hc.NOTEQUAL,reference:e.tileClippingMask.vectorLayerStencilID,mask:255,frontOperation:{fail:hc.KEEP,zFail:hc.KEEP,zPass:hc.REPLACE},backOperation:{fail:hc.KEEP,zFail:hc.KEEP,zPass:hc.REPLACE}},this._renderState.stencilMask=255);}destroy(){this.layer=void 0,this.tile=void 0,this.coord=void 0,this.pattern=void 0,this.programId=void 0,this.type=void 0,this._uniforms=void 0,this._textures=void 0,this._program=void 0,this._programConfiguration=void 0,this._renderState=void 0;}hasPattern(){const e=this.pattern;let t=!1;return e.isConstant()||(t=!0),e.constantOr(null)&&(t=!0),t}getProgramTypeAndCreateUniforms(e){if(this._isWater)return "WaterMaterial";let t="sphereFill";if(this.hasPattern()){t="sphereFillPattern";const i=new _p(e.style.getNearestTileZoom()).getCrossfadeParameters(),n=this.pattern.constantOr(1),r=this.pattern.constantOr(null);if(r&&this.tile.imageAtlas){const e=this.tile.imageAtlas,t=e.patternPositions[r.to.toString()],i=e.patternPositions[r.from.toString()];t&&i&&this._programConfiguration.setConstantPatternPositions(t,i);}if(n){const t=e.context.gl;e.context.activeTexture.set(t.TEXTURE0),this.tile.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this._programConfiguration.updatePaintBuffers(i);}const o=Math.pow(2,this.tile.tileID.overscaledZ),a=this.tile.tileSize*Math.pow(2,e.style.symbolMatrixHelper.cameraHeightConvertedZoom)/o,s=a*(this.tile.tileID.canonical.x+this.tile.tileID.wrap*o),l=a*this.tile.tileID.canonical.y;this._uniforms.set("u_BaseColorSampler",(()=>this.tile.imageAtlasTexture)),this._uniforms.set("u_Opacity",(()=>this._alpha)),this._uniforms.set("u_texsize",(()=>new It(this.tile.imageAtlasTexture.size[0],this.tile.imageAtlasTexture.size[1]))),this._uniforms.set("u_mix",(()=>i.t)),this._uniforms.set("u_scale_a",(()=>i.fromScale)),this._uniforms.set("u_scale_b",(()=>i.toScale)),this._uniforms.set("u_Zoom",(()=>e.style.getNearestTileZoom())),this._uniforms.set("u_TileZoomFactor",(()=>Math.pow(2,Math.round(e.style.getNearestTileZoom()-this.coord.canonical.z)))),this._uniforms.set("u_tile_units_to_pixels",(()=>1/ig(this.tile,1,e.style.getNearestTileZoom()))),this._uniforms.set("u_pixel_coord_upper",(()=>new It(s>>16,l>>16))),this._uniforms.set("u_pixel_coord_lower",(()=>new It(65535&s,65535&l))),this._uniforms.set("u_offset",(()=>new It(this._offset[0],this._offset[1]))),this._uniforms.set("u_rotation",(()=>this._rotation*Math.PI/180)),this._uniforms.set("u_scale",(()=>this._scale)),this._uniforms.set("u_HasTexture",(()=>{const t=this.pattern.constantOr(null);return !(t&&uP(t,e)||!this.pattern)}));}return this._uniforms.set("u_PixelMatrix",(()=>(yP.identity(),yP.scale([1,Math.cos(e.transform.hpr.pitch)]),yP.rotate(-e.transform.hpr.heading),yP))),t}},e.VectorLayerType=Ag,e.VectorLineMaterial=class extends N_{constructor(e){super(e),this.layer=e.layer,this.tile=e.tile,this.coord=e.tile.tileID,this.isBorder=e.isBorder,this.sourceMaxZoom=e.sourceMaxZoom,this.bucket=e.bucket,this.lineGradient=e.lineGradient||void 0,this._programConfiguration=e.programConfiguration,this._renderState=e.renderState,this._isShadowVolumeMaterial=e.shadowVolumeMaterial||!1,this.dasharray=this.layer.paint.get("line-dasharray"),this.tileRatio=void 0,this.posA=void 0,this.posB=void 0,this.widthA=void 0,this.widthB=void 0,this.crossfade=void 0,this.imagePosA=void 0,this.imagePosB=void 0,this.image=void 0,this.gradientTexture=void 0,this._createUniforms(e.painter);}update(e,t,i={}){super.update(e,t,i);const n=this.layer.paint.get("line-dasharray")?"sphereLineSDF":this._hasPattern(e.style)?"sphereLinePattern":this.layer.paint.get("line-gradient")?"sphereLineGradient":"sphereLine";this.type=n,this.updateDynamicProperty(e),this._updateOrCreateDynamicUniforms(e),this._createDashOrImageUniforms(e),!this._isShadowVolumeMaterial&&e.tileClippingMask.status&&(this._renderState.stencilTest={enabled:!0,frontFunction:hc.NOTEQUAL,backFunction:hc.NOTEQUAL,reference:this.isBorder?e.tileClippingMask.requestedVectorLayerIDs[0]:e.tileClippingMask.requestedVectorLayerIDs[1],mask:255,frontOperation:{fail:hc.KEEP,zFail:hc.KEEP,zPass:hc.REPLACE},backOperation:{fail:hc.KEEP,zFail:hc.KEEP,zPass:hc.REPLACE}},this._renderState.stencilMask=255);}_hasPattern(e){if(this.layer.paint.get("line-pattern")){const t=this.layer.paint.get("line-pattern").constantOr(null);if(t)return !!e.getImage(t.from);if(!this.layer.paint.get("line-pattern").isConstant())return !0}return !1}destroy(){this.layer=void 0,this.tile=void 0,this.coord=void 0,this.drawLine=void 0,this.type=void 0,this._uniforms=void 0,this._textures=void 0,this._program=void 0,this.isBorder=void 0,this.sourceMaxZoom=void 0,this.bucket=void 0,this.lineGradient=void 0,this._programConfiguration=void 0,this.dasharray=void 0,this.tileRatio=void 0,this.posA=void 0,this.posB=void 0,this.widthA=void 0,this.widthB=void 0,this.crossfade=void 0,this.imagePosA=void 0,this.imagePosB=void 0,this.image=void 0,this.gradientTexture=void 0;}_createUniforms(e){this.updateDynamicProperty(e),this._uniforms.set("u_GlUnitsToPixels",(()=>(PP.set(e.style.symbolMatrixHelper.width/2,-e.style.symbolMatrixHelper.height/2),PP))),this._uniforms.set("u_Ratio",(()=>1/ig(this.tile,1,e.style.getNearestTileZoom()))),this.pushMinimumUniform("u_Ratio"),this._uniforms.set("u_HalfRender",(()=>this.layer.paint.get("half-render"))),this._uniforms.set("u_HasBorder",(()=>this.isBorder)),this.pushMinimumUniform("u_HasBorder"),this._uniforms.set("u_PixelMatrix",(()=>(SP.identity(),SP.scale([1,Math.cos(e.transform.hpr.pitch)]),SP.rotate(-e.transform.hpr.heading),SP))),this._updateOrCreateDynamicUniforms(e),this._createDashOrImageUniforms(e);}_updateOrCreateDynamicUniforms(e){this.lineGradient&&(this.gradientTexture=this._parseLineGradient(e),this._uniforms.set("u_BaseColorSampler",(()=>(this.gradientTexture.bind(this.layer.stepInterpolate?hc.NEAREST:hc.LINEAR,hc.CLAMP_TO_EDGE),this.gradientTexture))),this.pushMinimumUniform("u_BaseColorSampler"),this._uniforms.set("u_image_height",(()=>this.bucket.lineClipsArray.length)),this.pushMinimumUniform("u_image_height"));}_parseLineGradient(e){const t=this.bucket.gradients[this.layer.id];let i=t.texture;if(this.layer.gradientVersion!==t.version){let n=256;if(this.layer.stepInterpolate){const t=this.coord.canonical.z===this.sourceMaxZoom?Math.ceil(1<<e.transform.maxZoom-this.coord.canonical.z):1;n=De(ke(this.bucket.maxLineLength/Ch*1024*t),256,e.context.maxTextureSize);}t.gradient=fT({expression:this.layer.gradientExpression(),evaluationKey:"lineProgress",resolution:n,image:t.gradient||void 0,clips:this.bucket.lineClipsArray}),t.texture?t.texture.update(t.gradient):t.texture=new ah({context:e.context,image:t.gradient,pixelFormat:Nu.RGBA}),t.version=this.layer.gradientVersion,i=t.texture;}return i}_createDashOrImageUniforms(e){this.dasharray?(this._uniforms.set("u_patternscale_a",(()=>(AP.set(this.tileRatio/this.widthA,-this.posA.height/2),AP))),this.pushMinimumUniform("u_patternscale_a"),this._uniforms.set("u_patternscale_b",(()=>(EP.set(this.tileRatio/this.widthB,-this.posB.height/2),EP))),this.pushMinimumUniform("u_patternscale_b"),this._uniforms.set("u_sdfgamma",(()=>e.lineAtlas.width/(256*Math.min(this.widthA,this.widthB)*Nh.devicePixelRatio)/2)),this.pushMinimumUniform("u_sdfgamma"),this._uniforms.set("u_BaseColorSampler",(()=>(e.lineAtlas.bind(e.context),e.lineAtlas))),this.pushMinimumUniform("u_BaseColorSampler"),this._uniforms.set("u_tex_y_a",(()=>this.posA.y)),this.pushMinimumUniform("u_tex_y_a"),this._uniforms.set("u_tex_y_b",(()=>this.posB.y)),this.pushMinimumUniform("u_tex_y_b"),this._uniforms.set("u_mix",(()=>this.crossfade.t)),this.pushMinimumUniform("u_mix")):this._hasPattern(e.style)&&(this._uniforms.set("u_texsize",(()=>new It(this.tile.imageAtlasTexture.size[0],this.tile.imageAtlasTexture.size[1]))),this.pushMinimumUniform("u_texsize"),this._uniforms.set("u_BaseColorSampler",(()=>this.tile.imageAtlasTexture)),this.pushMinimumUniform("u_BaseColorSampler"),this._uniforms.set("u_fade",(()=>this.crossfade.t)),this.pushMinimumUniform("u_fade"),this._uniforms.set("u_scale",(()=>new ft(this.tileRatio,this.crossfade.fromScale,this.crossfade.toScale))),this.pushMinimumUniform("u_scale"));}updateDynamicProperty(e){const t=this.layer.paint.get("line-pattern"),i=t.constantOr(null);if(this.image=t,i&&this.tile.imageAtlas){const e=this.tile.imageAtlas,t=e.patternPositions[i.to.toString()],n=e.patternPositions[i.from.toString()];t&&n&&this._programConfiguration.setConstantPatternPositions(t,n);}if(this.crossfade=this.layer.getCrossfadeParameters(),this.dasharray)this.posA=e.lineAtlas.getDash(this.dasharray.from,"round"===this.layer.layout.get("line-cap")),this.posB=e.lineAtlas.getDash(this.dasharray.to,"round"===this.layer.layout.get("line-cap")),this.widthA=this.posA.width*this.crossfade.fromScale,this.widthB=this.posB.width*this.crossfade.toScale;else if(this.image){const t=e.context,i=t.gl;t.activeTexture.set(i.TEXTURE0),this.tile.imageAtlasTexture?.bind(i.LINEAR,i.CLAMP_TO_EDGE),this._programConfiguration.updatePaintBuffers(this.crossfade);}this.tileRatio=1/ig(this.tile,1,e.style.symbolMatrixHelper.cameraHeightConvertedZoom);}},e.VertexBuffer=dh,e.WGS84_RADIUS_X=Bt,e.WGS84_RADIUS_Y=Vt,e.WGS84_RADIUS_Z=Ut,e.WebGLComponentCounts={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},e.WebGLComponentToShaderVariableType={SCALAR:"float",VEC2:"vec2",VEC3:"vec3",VEC4:"vec4",MAT2:"mat2",MAT3:"mat3",MAT4:"mat4"},e.WebGLConstants=hc,e.WebGLSizes={5120:1,5121:1,5122:2,5123:2,5125:4,5124:4,5126:4},e.WritingMode=Wg,e.ZoomHistory=np,e.addColorDefines=function(e){const t={};if(t.PROPERTY=e.property,t.INTERPOLATION_TYPE=e.type,e.default&&(t.DEFAULT_COLOR=Di.parse(e.default)),e.stops)for(let i=0;i<e.stops.length;i+=1){const n=e.stops[i];t[`STOP_${i}`]=n[0],t[`STOP_COLOR_${i}`]=Di.parse(n[1]);}return e.base&&(t.BASE=e.base),t},e.allowsLetterSpacing=function(e){for(const t of e)if(!ln(t.charCodeAt(0)))return !1;return !0},e.allowsVerticalWritingMode=sn,e.arrayRemoveDuplicates=Yd,e.asyncAll=function(e,t,i){if(!e.length)return i(null,[]);let n=e.length;const r=new Array(e.length);let o=null;for(let a=0;a<e.length;a++)t(e[a],((e,t)=>{e&&(o=e),r[a]=t,0==--n&&i(o,r);}));},e.baseGetTag=gf,e.binaryFindRayIntersectionTop=Al,e.binarySearch=Il,e.bindAll=Ge,e.checkIsDepthSupportDataType=function(e){if(void 0===e||e===$d.NONE)return !0},e.checkIsIgnoreClassificationDataType=function(e){if(e===$d.IGNORECLASSIFICATION)return !0},e.checkIsVectorShadowVolumeDataType=Kd,e.clamp=De,e.classifyRings=Pv,e.clone=Xe,e.combine=Qm,e.combineInternalMap=A_,e.createCommonjsModule=$h,e.createExpression=Ro,e.createFilter=tx,e.createLayout=gi,e.createLayoutGltf=function(e,t=1){const i=[],n=e.map((e=>{const t=e.components||1;return i.push(e.name),{name:e.name,type:e.type,components:t,offset:e.offset||0,byteStride:e.byteStride||4}}));return i.sort(),{members:n,size:yi(0,Math.max(0,t)),alignment:t,key:i.join(";")}},e.createLayoutPnts=function(e,t=1){return {members:e.map((e=>({name:e.name,type:e.type,components:e.components||1,offset:e.offset||0,byteStride:e.byteStride||4,bufferName:e.bufferName}))),size:yi(0,Math.max(0,t)),alignment:t}},e.createStyleLayer=function(e){return "custom"===e.type?new ob(e):new Mb[e.type](e)},e.decodeModel=function(e){const t=Gu(e,e?e.byteLength:0);return t.buffer?t.buffer:t},e.deepCopyObj=function e(t){if(!t)return;const i=Array.isArray(t)?[]:{};if("object"!=typeof t)return t;for(const n in t)i[n]="object"==typeof t[n]?e(t[n]):t[n];return i},e.defaultValue=Z,e.defined=$,e.destroyObject=uc,e.distToSegmentSquared=Nw,e.ease=Oe,e.easeCubicInOut=Ne,e.emitValidationErrors=Mx,e.evaluateSizeForFeature=rg,e.evaluateSizeForZoom=og,e.evented=dp,e.exported=Nh,e.extend=ze,e.filterObject=qe,e.findStopLessThanOrEqualTo=ur,e.fromCartographicToRadians=jt,e.genColorBarScript=rP,e.getArrayBuffer=Wu,e.getDefaultExportFromCjs=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e},e.getDistanceFromZoom=yl,e.getImage=eh,e.getJSON=function(e,t){return ju(ze(e="string"==typeof e?{url:e}:e,{type:"json"}),t)},e.getLabelPlaneMatrix=sy,e.getPickPositionOfSurface=ml,e.getPickPositionOfSurfaceByOriginAndDir=function(e,t){const i=new Es(e,t),n=Cs.rayEllipsoid(i,lc.DefaultEllipsoid);return n?i.origin.clone().add(i.direction.clone().multiplyScalar(n.start)):null},e.getPrimitives=b_,e.getProjection=di,e.getRTLTextPluginStatus=pp,e.getRay=function(e){const t=e.transform.getCameraPos();return new Es(t,gl(e.canvasX,e.canvasY,.999999,e.transform))},e.getReferrer=Xu,e.getSpherePos=vl,e.getString=function(e,t){return ju(ze(e="string"==typeof e?{url:e}:e,{type:"string"}),t)},e.getVideo=function(e,t){const i=J.document.createElement("video");i.muted=!0,i.onloadstart=function(){t(null,i);};for(let t=0;t<e.length;t++){const n=J.document.createElement("source");$u(e[t])||(i.crossOrigin="Anonymous"),n.src=e[t],i.appendChild(n);}return {cancel:()=>{}}},e.getZoomFromDistance=xl,e.intersectionMapKeys=function(e,t){let i,n;const r=[];if(!e||!t)return r;for(e.size<t.size?(i=e.keys(),n=t):(i=t.keys(),n=e);;){const e=i.next();if(e.done)break;const t=e.value;n.has(t)&&r.push(t);}return r},e.isBoolean=Je,e.isChar=an,e.isFunction=Le,e.isHiddenByMapZoom=Nx,e.isNumber=Qe,e.isObject=vf,e.isObjectLike=yf,e.isPowerOfTwo=function(e){return Math.log(e)/Math.LN2%1==0},e.isUrl=function(e){const t=e.substring(0,2),i=e.substring(0,1);return !!/^http[s]?:\/\/([\w\-\.]+)+[\w-]*([\w\-\.\/\?%&=]+)?$/gi.test(e)||"./"==t||"/"==i},e.isWorker=Ke,e.keysDifference=function(e,t){const i=[];for(const n in e)n in t||i.push(n);return i},e.keysDifferenceWithMap=function(e,t){const i=[];for(const n in e)t.has(n)||i.push(n);return i},e.layout=kd,e.layout$1=Gd,e.lazyLoadRTLTextPlugin=function(){mp.isLoading()||mp.isLoaded()||"deferred"!==pp()||fp();},e.lerp=Pl,e.makeRequest=ju,e.mapObject=Ye,e.mvt=bg,e.nextPowerOfTwo=ke,e.number=pr,e.octDecode=function(e,t,i){return function(e,t,i,n){if(Sy(n),e<0||e>i||t<0||t>i)throw new Error("x and y must be unsigned normalized integers between 0 and 255");if(n.x=Ly(e,i),n.y=Ly(t,i),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){const e=n.x;n.x=(1-Math.abs(n.y))*Ry(e),n.y=(1-Math.abs(e))*Ry(n.y);}return n.normalize()}(e,t,255,i)},e.parseCacheControl=function(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,i,n,r)=>{const o=n||r;return t[i]=!o||o.toLowerCase(),""})),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e;}return t},e.parseGlyphPBF=function(e){return new Nb(e).readFields(Jb,[])},e.pbf=Nb,e.pick=function(e,t){const i={};for(let n=0;n<t.length;n++){const r=t[n];r in e&&(i[r]=e[r]);}return i},e.pickColorAttributes=lg,e.pixelsToTileUnits=ig,e.placeFirstAndLastGlyph=uy,e.plugin=mp,e.pointGeometry3d=te,e.polygonIntersectsPolygon=function(e,t){for(let i=0;i<e.length;i++)if(Ow(t,e[i]))return !0;for(let i=0;i<t.length;i++)if(Ow(e,t[i]))return !0;return !!Mw(e,t)},e.potpack=uw,e.project=ly,e.properties=Fg,e.randomBetween=function(e,t){const i=new Uint32Array(1);return J.crypto.getRandomValues(i),i[0]/4294967295*(t-e)+e},e.reduceComma=f_,e.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.register=Ho,e.registerForPluginStateChange=function(e){return e({pluginStatus:lp,pluginURL:cp}),dp.on("pluginStateChange",e),e},e.renderStateEnum=t_,e.rgba2Hex=function(e){const t=e.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),i=parseFloat(t[3]||1),n=Math.floor(i*parseInt(t[0])+255*(1-i)),r=Math.floor(i*parseInt(t[1])+255*(1-i)),o=Math.floor(i*parseInt(t[2])+255*(1-i));return `#${`0${n.toString(16)}`.slice(-2)}${`0${r.toString(16)}`.slice(-2)}${`0${o.toString(16)}`.slice(-2)}`},e.root=sf,e.setRTLTextPlugin=function(e,t,i=!1){if(lp===rp||lp===op||lp===ap)throw new Error("setRTLTextPlugin cannot be called multiple times.");cp=Nh.resolveURL(e),lp=rp,sp=t,hp(),i||fp();},e.shaders=__,e.shapeIcon=function(e,t,i){const{horizontalAlign:n,verticalAlign:r}=ry(i),o=t[0]-e.displaySize[0]*n,a=t[1]-e.displaySize[1]*r;return {image:e,top:a,bottom:a+e.displaySize[1],left:o,right:o+e.displaySize[0]}},e.shapeText=function(e,t,i,n,r,o,a,s,l,c,u,h){const d=$g.fromFeature(e,i);u===Wg.vertical&&d.verticalizePunctuation();const p=[],f={positionedGlyphs:p,text:d,top:l[1],bottom:l[1],left:l[0],right:l[0],writingMode:u};let m;if(h&&h.properties&&h.properties.hasOwnProperty("_wrap")){const e=h.properties._wrap.split(",");e.length>0&&""!==e[0]?(e.forEach(((e,t,i)=>{i[t]=parseInt(e);})),m=Zg(d,e)):m=Zg(d,[]);}else {const{processBidirectionalText:e,processStyledBidirectionalText:i}=mp;if(e&&1===d.sections.length){m=[];const i=e(d.toString(),ny(d,s,n,t));for(const e of i){const t=new $g;t.text=e,t.sections=d.sections;for(let i=0;i<e.length;i++)t.sectionIndex.push(0);m.push(t);}}else if(i){m=[];const e=i(d.text,d.sectionIndex,ny(d,s,n,t));for(const t of e){const e=new $g;e.text=t[0],e.sectionIndex=t[1],e.sections=d.sections,m.push(e);}}else m=Zg(d,ny(d,s,n,t));}return function(e,t,i,n,r,o,a,s,l){let c=0,u=-17,h=0;const d=e.positionedGlyphs,p="right"===o?1:"left"===o?0:.5;for(const e of i){e.trim();const i=e.getMaxScale();if(!e.length()){u+=n;continue}const r=d.length;for(let n=0;n<e.length();n++){const r=e.getSection(n),o=e.getCharCode(n),h=24*(i-r.scale),p=t[r.fontStack],f=p&&p[o];f&&(cn(o)&&a!==Wg.horizontal?(d.push({glyph:o,x:c,y:h,vertical:!0,scale:r.scale,fontStack:r.fontStack}),c+=l*r.scale+s):(d.push({glyph:o,x:c,y:u+h,vertical:!1,scale:r.scale,fontStack:r.fontStack}),c+=f.metrics.advance*r.scale+s));}d.length!==r&&(h=Math.max(c-s,h),oy(d,t,r,d.length-1,p)),c=0,u+=n*i;}const{horizontalAlign:f,verticalAlign:m}=ry(r);!function(e,t,i,n,r,o,a){const s=(t-i)*r,l=(-n*a+.5)*o;for(let t=0;t<e.length;t++)e[t].x+=s,e[t].y+=l;}(d,p,f,m,h,n,i.length);const _=u- -17;e.top+=-m*_,e.bottom=e.top+_,e.left+=-f*h,e.right=e.left+h;}(f,t,m,r,o,a,u,s,c),!!p.length&&(f.text=f.text.toString(),f)},e.smoothstep=function(e,t,i){return (i=De((i-e)/(t-e),0,1))*i*(3-2*i)},e.sortFeaturesDependsAnchor=function(e,t){if(null==t)return [];const i=Ee([t.lng,t.lat]);return e.forEach((e=>{null==e.geometry&&null!=e.feature.geometry&&(e=e.feature),e.distanceToClick=1/0;const t=e.geometry.type;if("Point"==t){const t=Ee(e.geometry.coordinates);e.distanceToClick=ge(i,t,{units:"miles"});}else if("MultiLineString"==t)e.geometry.coordinates.forEach((t=>{const n=Ce(t),r=Te(i,n,{units:"miles"});r<e.distanceToClick&&(e.distanceToClick=r);}));else if("LineString"==t){const t=Ce(e.geometry.coordinates),n=Te(i,t,{units:"miles"});n<e.distanceToClick&&(e.distanceToClick=n);}else if("Polygon"==t||"MultiPolygon"==t){let t;t=1==e.geometry.coordinates.length?Me(e.geometry.coordinates):function(e,t){if(!e)throw new Error("No coordinates passed");return {type:"Feature",geometry:{type:"MultiPolygon",coordinates:e},properties:{}}}(e.geometry.coordinates);const n=et(i,t);n<e.distanceToClick&&(e.distanceToClick=n);}})),e.sort(((e,t)=>e.distanceToClick-t.distanceToClick))},e.spec=Og,e.stencilModeforExtrusion=function(e){e.tileClippingMask.nextStencilID+1>256&&(e.tileClippingMask.nextStencilID=1,e.clearStencil());const t=e.tileClippingMask.nextStencilID++;return {enabled:!0,frontFunction:hc.NOTEQUAL,backFunction:hc.NOTEQUAL,reference:t,mask:255,frontOperation:{fail:hc.KEEP,zFail:hc.KEEP,zPass:hc.REPLACE},backOperation:{fail:hc.KEEP,zFail:hc.KEEP,zPass:hc.REPLACE}}},e.tileSamplesGrid=function(e,t){const i=new Ud,n=new Zo,r=new Ia,o=new Na;i.prepareSegment(0,n,r);const a=nt.TILE.EXTENT,s=e.canonical.x,l=e.canonical.y;let c=2*Gv;c/=Math.pow(2,e.overscaledZ),c<nt.TILE_GRIDSAMPLES_SPLIT.THE_MIN_SAMPLES&&(c=nt.TILE_GRIDSAMPLES_SPLIT.THE_MIN_SAMPLES);const u=[],h=a/c,d=e.overscaledZ;let p=[];const f=i.prepareSegment(4*(c+1),n,r);for(let e=0;e<c;e++){Hv(u,0,e*h,d,s,l,t),0===p.length&&(p=u.slice(0)),n.emplaceBack(u[0]-p[0],u[1]-p[1],u[2]-p[2],0,e*h*4),Hv(u,0,(e+1)*h,d,s,l,t),n.emplaceBack(u[0]-p[0],u[1]-p[1],u[2]-p[2],0,(e+1)*h*4),f.vertexLength+=2;for(let i=1;i<=c;i++){Hv(u,i*h,e*h,d,s,l,t),n.emplaceBack(u[0]-p[0],u[1]-p[1],u[2]-p[2],i*h*4,e*h*4),Hv(u,i*h,(e+1)*h,d,s,l,t),n.emplaceBack(u[0]-p[0],u[1]-p[1],u[2]-p[2],i*h*4,(e+1)*h*4);const a=f.vertexLength;r.emplaceBack(a-2,a-1,a),r.emplaceBack(a,a-1,a+1),o.emplaceBack(a-2,a-1),o.emplaceBack(a-1,a),o.emplaceBack(a,a-2),o.emplaceBack(a,a-1),o.emplaceBack(a-1,a+1),o.emplaceBack(a+1,a),f.vertexLength+=2,f.primitiveLength+=2;}}return {sphereSegments:i,sphereIndexArray:r,sphereMaskedBoundsArray:n,wireframeIndexArray:o,rtc:p}},e.toDegrees=s,e.toRadians=a,e.triggerPluginCompletionEvent=up,e.turfPolygon=Me,e.uniqueId=Ve,e.uuid=Ue,e.validateStyle=Ax,e.values=function(e){const t=[];for(const i in e)t.push(e[i]);return t},e.warnOnce=We,e.window=J,e.wrap=Fe,e.xyTransformMat4=gy;}));

define(["./shared"],(function(t){"use strict";function e(t){const o=typeof t;if("number"===o||"boolean"===o||"string"===o||null==t)return JSON.stringify(t);if(Array.isArray(t)){let o="[";for(const i of t)o+=`${e(i)},`;return `${o}]`}const i=Object.keys(t).sort();let n="{";for(let o=0;o<i.length;o++)n+=`${JSON.stringify(i[o])}:${e(t[i[o]])},`;return `${n}}`}function o(o){let i="";for(const n of t.refProperties)i+=`/${e(o[n])}`;return i}class i{constructor(t){t&&this.replace(t);}replace(t){this._layerConfigs={},this._layers={},this.update(t,[]);}update(e,i){for(const o of e){this._layerConfigs[o.id]=o;const e=this._layers[o.id]=t.createStyleLayer(o);e._featureFilter=t.createFilter(e.filter);}for(const t of i)delete this._layerConfigs[t],delete this._layers[t];this.familiesBySource={};const n=function(t){const e={};for(let i=0;i<t.length;i++){const n=o(t[i]);let r=e[n];r||(r=e[n]=[]),r.push(t[i]);}const i=[];for(const t in e)i.push(e[t]);return i}(t.values(this._layerConfigs));for(const t of n){const e=t.map((t=>this._layers[t.id])),o=e[0];if("none"===o.visibility)continue;const i=o.source||"";let n=this.familiesBySource[i];n||(n=this.familiesBySource[i]={});const r=o.sourceLayer||"_geojsonTileLayer";let s=n[r];s||(s=n[r]=[]),s.push(e);}}}function n(t,e,o,i,n){if(void 0===e.segment)return !0;let r=e,s=e.segment+1,a=0;for(;a>-o/2;){if(s--,s<0)return !1;a-=t[s].dist(r),r=t[s];}a+=t[s].dist(t[s+1]),s++;const l=[];let c=0;for(;a<o/2;){const e=t[s],o=t[s+1];if(!o)return !1;let r=t[s-1].angleTo(e)-e.angleTo(o);for(r=Math.abs((r+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:r}),c+=r;a-l[0].distance>i;)c-=l.shift().angleDelta;if(c>n)return !1;s++,a+=e.dist(o);}return !0}function r(t){let e=0;for(let o=0;o<t.length-1;o++)e+=t[o].dist(t[o+1]);return e}function s(t,e,o){return t?.6*e*o:0}function a(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function l(e,o,i,l,c,h){const u=s(i,c,h),p=a(i,l);let f=0;const d=r(e)/2;for(let i=0;i<e.length-1;i++){const r=e[i],s=e[i+1],a=r.dist(s);if(f+a>d){const l=(d-f)/a,c=t.number(r.x,s.x,l),h=t.number(r.y,s.y,l),g=new t.Anchor(c,h,s.angleTo(r),i);if(g._round(),u&&!n(e,g,p,u,o))return;return g}f+=a;}}function c(t,e,o,i,n,r,l,c,u){const p=s(i,r,l),f=a(i,n),d=0===t[0].x||t[0].x===u||0===t[0].y||t[0].y===u;return e-f*l<e/4&&(e=f*l+e/4),h(t,d?e/2*c%e:(f/2+2*r)*l*c%e,e,p,o,f*l,d,!1,u)}function h(e,o,i,s,a,l,c,u,p){const f=l/2,d=r(e);let g=0,y=o-i,m=[];for(let o=0;o<e.length-1;o++){const r=e[o],c=e[o+1],h=r.dist(c),u=c.angleTo(r);for(;y+i<g+h;){y+=i;const x=(y-g)/h,w=t.number(r.x,c.x,x),v=t.number(r.y,c.y,x);if(w>=0&&w<p&&v>=0&&v<p&&y-f>=0&&y+f<=d){const i=new t.Anchor(w,v,u,o);i._round(),s&&!n(e,i,l,s,a)||m.push(i);}}g+=h;}return u||m.length||c||(m=h(e,g/2,i,s,a,l,c,!0,p)),m}class u{constructor(){this.opacity=0,this.targetOpacity=0,this.time=0;}clone(){const t=new u;return t.opacity=this.opacity,t.targetOpacity=this.targetOpacity,t.time=this.time,t}}t.register("OpacityState",u);class p{constructor(e,o,i,n,r,s,a,l,c,h,u,p){let f=a.top*l-c,d=a.bottom*l+c,g=a.left*l-c,y=a.right*l+c;if(this.boxStartIndex=e.length,h){let t=d-f;const a=y-g;t>0&&(t=Math.max(10*l,t),this._addLineCollisionCircles(e,o,i,i.segment,a,t,n,r,s,u));}else {if(p){const e=new t.pointGeometry3d(g,f),o=new t.pointGeometry3d(y,f),i=new t.pointGeometry3d(g,d),n=new t.pointGeometry3d(y,d),r=p*Math.PI/180;e._rotate(r),o._rotate(r),i._rotate(r),n._rotate(r),g=Math.min(e.x,o.x,i.x,n.x),y=Math.max(e.x,o.x,i.x,n.x),f=Math.min(e.y,o.y,i.y,n.y),d=Math.max(e.y,o.y,i.y,n.y);}e.emplaceBack(i.x,i.y,g,f,y,d,n,r,s,0,0);}this.boxEndIndex=e.length;}_addLineCollisionCircles(t,e,o,i,n,r,s,a,l,c){const h=r/2,u=Math.floor(n/h)||1,p=1+.4*Math.log(c)/Math.LN2,f=Math.floor(u*p/2),d=-r/2;let g=o,y=i+1,m=d;const x=-n/2,w=x-n/4;do{if(y--,y<0){if(m>x)return;y=0;break}m-=e[y].dist(g),g=e[y];}while(m>w);let v=e[y].dist(e[y+1]);for(let o=-f;o<u+f;o++){const i=o*h;let c=x+i;if(i<0&&(c+=i),i>n&&(c+=i-n),c<m)continue;for(;m+v<c;){if(m+=v,y++,y+1>=e.length)return;v=e[y].dist(e[y+1]);}const u=c-m,p=e[y],f=e[y+1].sub(p)._unit()._mult(u)._add(p)._round(),g=Math.abs(c-d)<h?0:.8*(c-d);t.emplaceBack(f.x,f.y,-r/2,-r/2,r/2,r/2,s,a,l,r/2,g);}}}class f{constructor(t=[],e=d){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t);}push(t){this.data.push(t),this.length++,this._up(this.length-1);}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:o}=this,i=e[t];for(;t>0;){const n=t-1>>1,r=e[n];if(o(i,r)>=0)break;e[t]=r,t=n;}e[t]=i;}_down(t){const{data:e,compare:o}=this,i=this.length>>1,n=e[t];for(;t<i;){let i=1+(t<<1),r=e[i];const s=i+1;if(s<this.length&&o(e[s],r)<0&&(i=s,r=e[s]),o(r,n)>=0)break;e[t]=r,t=i;}e[t]=n;}}function d(t,e){return t<e?-1:t>e?1:0}function g(e,o=1,i=!1){let n=1/0,r=1/0,s=-1/0,a=-1/0;const l=e[0];for(let t=0;t<l.length;t++){const e=l[t];(!t||e.x<n)&&(n=e.x),(!t||e.y<r)&&(r=e.y),(!t||e.x>s)&&(s=e.x),(!t||e.y>a)&&(a=e.y);}const c=Math.min(s-n,a-r);let h=c/2;const u=new f([],y);if(0===c)return new t.pointGeometry3d(n,r);for(let t=n;t<s;t+=c)for(let o=r;o<a;o+=c)u.push(new m(t+h,o+h,h,e));let p=function(t){let e=0,o=0,i=0;const n=t[0];for(let t=0,r=n.length,s=r-1;t<r;s=t++){const r=n[t],a=n[s],l=r.x*a.y-a.x*r.y;o+=(r.x+a.x)*l,i+=(r.y+a.y)*l,e+=3*l;}return new m(o/e,i/e,0,t)}(e),d=u.length;for(;u.length;){const t=u.pop();(t.d>p.d||!p.d)&&(p=t,i&&console.warn("found best %d after %d probes",Math.round(1e4*t.d)/1e4,d)),t.max-p.d<=o||(h=t.h/2,u.push(new m(t.p.x-h,t.p.y-h,h,e)),u.push(new m(t.p.x+h,t.p.y-h,h,e)),u.push(new m(t.p.x-h,t.p.y+h,h,e)),u.push(new m(t.p.x+h,t.p.y+h,h,e)),d+=4);}return i&&(console.warn(`num probes: ${d}`),console.warn(`best distance: ${p.d}`)),p.p}function y(t,e){return e.max-t.max}function m(e,o,i,n){this.p=new t.pointGeometry3d(e,o),this.h=i,this.d=function(e,o){let i=!1,n=1/0;for(let r=0;r<o.length;r++){const s=o[r];for(let o=0,r=s.length,a=r-1;o<r;a=o++){const r=s[o],l=s[a];r.y>e.y!=l.y>e.y&&e.x<(l.x-r.x)*(e.y-r.y)/(l.y-r.y)+r.x&&(i=!i),n=Math.min(n,t.distToSegmentSquared(e,r,l));}}return (i?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2;}function x(e,o,i,n,r,s,a){e.createArrays(),e.symbolInstances=[],e.tilePixelRatio=t.EXTENT/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const l=e.layers[0].layout,c=e.layers[0]._unevaluatedLayout._values,h={};if("composite"===e.textSizeData.functionType){const{min:o,max:i}=e.textSizeData.zoomRange;h.compositeTextSizes=[c["text-size"].possiblyEvaluate(new t.EvaluationParameters(o),a),c["text-size"].possiblyEvaluate(new t.EvaluationParameters(i),a)];}if("composite"===e.iconSizeData.functionType){const{min:o,max:i}=e.iconSizeData.zoomRange;h.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new t.EvaluationParameters(o),a),c["icon-size"].possiblyEvaluate(new t.EvaluationParameters(i),a)];}h.layoutTextSize=c["text-size"].possiblyEvaluate(new t.EvaluationParameters(e.zoom+1),a),h.layoutIconSize=c["icon-size"].possiblyEvaluate(new t.EvaluationParameters(e.zoom+1),a),h.textMaxSize=c["text-size"].possiblyEvaluate(new t.EvaluationParameters(18));const u=24,p=l.get("text-line-height")*u,f="map"===l.get("text-rotation-alignment")&&"point"!==l.get("symbol-placement"),d=l.get("text-keep-upright");for(const s of e.features){const c=l.get("text-font").evaluate(s,{},a).join(","),g=i,y={},m=s.text;let x,v=[0,0];if(m){const e=m instanceof t.Formatted?m.toString():m;v=l.get("text-offset").evaluate(s,{},a).map((t=>t*u));const i=l.get("text-letter-spacing").evaluate(s,{},a)*u,n=t.allowsLetterSpacing(e)?i:0,r=l.get("text-anchor").evaluate(s,{},a),h=l.get("text-justify").evaluate(s,{},a),g="point"===l.get("symbol-placement")?l.get("text-max-width").evaluate(s,{},a)*u:0;y.horizontal=t.shapeText(m,o,c,g,p,r,h,n,v,u,t.WritingMode.horizontal,s),t.allowsVerticalWritingMode(e)&&f&&d&&(y.vertical=t.shapeText(m,o,c,g,p,r,h,n,v,u,t.WritingMode.vertical,s));}let b=!1;if(s.icon){const o=n[s.icon];o&&(x=t.shapeIcon(r[s.icon],l.get("icon-offset").evaluate(s,{},a),l.get("icon-anchor").evaluate(s,{},a)),b=o.sdf,void 0===e.sdfIcons?e.sdfIcons=o.sdf:e.sdfIcons!==o.sdf&&t.warnOnce("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(o.pixelRatio!==e.pixelRatio||0!==l.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0));}(y.horizontal||x)&&w(e,s,y,x,g,h,0,a);}s&&e.generateCollisionDebugBuffers();}function w(e,o,i,n,r,s,a,h){const f=s.layoutTextSize.evaluate(o,{},h),d=s.layoutIconSize.evaluate(o,{},h);let y=s.textMaxSize.evaluate(o,{},h);void 0===y&&(y=f);const m=e.layers[0].layout,x=m.get("text-offset").evaluate(o,{},h),w=m.get("icon-offset").evaluate(o,{},h),S=e.tilePixelRatio*(f/24),M=e.tilePixelRatio*y/24,_=e.tilePixelRatio*d,I=e.tilePixelRatio*m.get("symbol-spacing"),T=m.get("text-padding")*e.tilePixelRatio,P=m.get("icon-padding")*e.tilePixelRatio,L=m.get("text-max-angle")/180*Math.PI,k="map"===m.get("text-rotation-alignment")&&"point"!==m.get("symbol-placement"),z="map"===m.get("icon-rotation-alignment")&&"point"!==m.get("symbol-placement"),O=m.get("symbol-placement"),E=I/2,C=(a,l)=>{l.x<0||l.x>=t.EXTENT||l.y<0||l.y>=t.EXTENT||e.symbolInstances.push(function(e,o,i,n,r,s,a,l,c,h,f,d,g,y,m,x,w,b,S,M,_,I,T){const P=e.addToLineVertexArray(o,i);let L,k,z=0,O=0,E=0;const C=n.horizontal?n.horizontal.text:"",D=[];if(n.horizontal){const r=s.layout.get("text-rotate").evaluate(S,{},T);L=new p(a,i,o,l,c,h,n.horizontal,f,d,g,e.overscaling,r),O+=v(e,o,n.horizontal,s,g,S,y,P,n.vertical?t.WritingMode.horizontal:t.WritingMode.horizontalOnly,D,M,_,T),n.vertical&&(E+=v(e,o,n.vertical,s,g,S,y,P,t.WritingMode.vertical,D,M,_,T));}const R=L?L.boxStartIndex:e.collisionBoxArray.length,j=L?L.boxEndIndex:e.collisionBoxArray.length;if(r){const u=function(e,o,i,n,r,s){const a=o.image,l=i.layout,c=o.top-1/a.pixelRatio,h=o.left-1/a.pixelRatio,u=o.bottom+1/a.pixelRatio,p=o.right+1/a.pixelRatio;let f,d,g,y,m;if("none"!==l.get("icon-text-fit")&&r){const e=p-h,o=u-c,i=l.get("text-size").evaluate(s,{})/24,n=r.left*i,a=r.top*i,m=r.right*i-n,x=r.bottom*i-a,w=l.get("icon-text-fit-padding")[0],v=l.get("icon-text-fit-padding")[1],b=l.get("icon-text-fit-padding")[2],S=l.get("icon-text-fit-padding")[3],M="width"===l.get("icon-text-fit")?.5*(x-o):0,_="height"===l.get("icon-text-fit")?.5*(m-e):0,I="width"===l.get("icon-text-fit")||"both"===l.get("icon-text-fit")?m:e,T="height"===l.get("icon-text-fit")||"both"===l.get("icon-text-fit")?x:o;f=new t.pointGeometry3d(n+_-S,a+M-w),d=new t.pointGeometry3d(n+_+v+I,a+M-w),g=new t.pointGeometry3d(n+_+v+I,a+M+b+T),y=new t.pointGeometry3d(n+_-S,a+M+b+T);}else f=new t.pointGeometry3d(h,c),d=new t.pointGeometry3d(p,c),g=new t.pointGeometry3d(p,u),y=new t.pointGeometry3d(h,u);if(m="symtracking"!==i.type||i.layout.get("symtracking-display-mode")!==t.LAYER_LAYOUT_CONSTS.SYMTRACKING_DISPLAY_MODE.SEQUENCE&&i.layout.get("symtracking-display-mode")!==t.LAYER_LAYOUT_CONSTS.SYMTRACKING_DISPLAY_MODE.TIMESTAMP?"symtracking"!==i.type||i.layout.get("compatible-mode")?"symtracking"===i.type?function(t,e){const o=t.geometry[0];return o.length>2&&(!t.properties.hasOwnProperty("name")||-1===t.properties.name.indexOf("箭头"))||1===o.length?0:o[1].angleTo(o[0])+0}(s):i.layout.get("icon-rotate").evaluate(s,{})*Math.PI/180:s.properties.car_rotate*Math.PI/180:i.layout.get("icon-rotate").evaluate(s,{})*Math.PI/180,m){const t=Math.sin(m),e=Math.cos(m),o=[e,-t,t,e];f._matMult(o),d._matMult(o),y._matMult(o),g._matMult(o);}return [{tl:f,tr:d,bl:y,br:g,tex:a.paddedRect,writingMode:void 0,glyphOffset:[0,0]}]}(0,r,s,0,n.horizontal,S),f=s.layout.get("icon-rotate").evaluate(S,{},T);k=new p(a,i,o,l,c,h,r,m,x,!1,e.overscaling,f),z=4*u.length;const d=e.iconSizeData;let g=null;"source"===d.functionType?g=[10*s.layout.get("icon-size").evaluate(S,{},T)]:"composite"===d.functionType&&(g=[10*_.compositeIconSizes[0].evaluate(S,{},T),10*_.compositeIconSizes[1].evaluate(S,{},T)]),e.type!=t.VectorLayerType.SYMBOL&&e.type!=t.VectorLayerType.SYMTRACKING||e.addSymbols(e.icon,u,g,b,w,S,!1,o,P.lineStartIndex,P.lineLength,T);}return {key:C,textBoxStartIndex:R,textBoxEndIndex:j,iconBoxStartIndex:k?k.boxStartIndex:e.collisionBoxArray.length,iconBoxEndIndex:k?k.boxEndIndex:e.collisionBoxArray.length,textOffset:y,iconOffset:b,anchor:o,line:i,featureIndex:l,feature:S,numGlyphVertices:O,numVerticalGlyphVertices:E,numIconVertices:z,textOpacityState:new u,iconOpacityState:new u,isDuplicate:!1,placedTextSymbolIndices:D,crossTileID:0}}(e,l,a,i,n,e.layers[0],e.collisionBoxArray,o.index,o.sourceLayerIndex,e.index,S,T,k,x,_,P,z,w,o,r,s,0,h));};if("line"===O)for(const r of function(e,o,i,n,r){const s=[];for(let o=0;o<e.length;o++){const i=e[o];let a;for(let e=0;e<i.length-1;e++){let o=i[e],l=i[e+1];o.x<0&&l.x<0||(o.x<0?o=new t.pointGeometry3d(0,o.y+(0-o.x)/(l.x-o.x)*(l.y-o.y))._round():l.x<0&&(l=new t.pointGeometry3d(0,o.y+(0-o.x)/(l.x-o.x)*(l.y-o.y))._round()),o.y<0&&l.y<0||(o.y<0?o=new t.pointGeometry3d(o.x+(0-o.y)/(l.y-o.y)*(l.x-o.x),0)._round():l.y<0&&(l=new t.pointGeometry3d(o.x+(0-o.y)/(l.y-o.y)*(l.x-o.x),0)._round()),o.x>=n&&l.x>=n||(o.x>=n?o=new t.pointGeometry3d(n,o.y+(n-o.x)/(l.x-o.x)*(l.y-o.y))._round():l.x>=n&&(l=new t.pointGeometry3d(n,o.y+(n-o.x)/(l.x-o.x)*(l.y-o.y))._round()),o.y>=r&&l.y>=r||(o.y>=r?o=new t.pointGeometry3d(o.x+(r-o.y)/(l.y-o.y)*(l.x-o.x),r)._round():l.y>=r&&(l=new t.pointGeometry3d(o.x+(r-o.y)/(l.y-o.y)*(l.x-o.x),r)._round()),a&&o.equals(a[a.length-1])||(a=[o],s.push(a)),a.push(l)))));}}return s}(o.geometry,0,0,t.EXTENT,t.EXTENT)){const o=c(r,I,L,i.vertical||i.horizontal,n,24,M,e.overscaling,t.EXTENT);for(const t of o){const o=i.horizontal;o&&b(e,o.text,E,t)||C(r,t);}}else if("line-center"===O){for(const t of o.geometry)if(t.length>1){const e=l(t,L,i.vertical||i.horizontal,n,24,M);e&&C(t,e);}}else if("Polygon"===o.type)for(const e of t.classifyRings(o.geometry,0)){const o=g(e,16);C(e[0],new t.Anchor(o.x,o.y,0));}else if("LineString"===o.type)for(const e of o.geometry)C(e,new t.Anchor(e[0].x,e[0].y,0));else if("Point"===o.type)for(const e of o.geometry)for(const o of e)C([o],new t.Anchor(o.x,o.y,0));}function v(e,o,i,n,r,s,a,l,c,h,u,p,f){const d=function(e,o,i,n,r,s){const a=i.layout.get("text-rotate").evaluate(r,{})*Math.PI/180,l=i.layout.get("text-offset").evaluate(r,{}).map((t=>24*t)),c=o.positionedGlyphs,h=[];for(let e=0;e<c.length;e++){const i=c[e],r=s[i.fontStack],u=r&&r[i.glyph];if(!u)continue;const p=u.rect;if(!p)continue;const f=t.GLYPH_PBF_BORDER+1,d=u.metrics.advance*i.scale/2,g=n?[i.x+d,i.y]:[0,0],y=n?[0,0]:[i.x+d+l[0],i.y+l[1]],m=(u.metrics.left-f)*i.scale-d+y[0],x=(-u.metrics.top-f)*i.scale+y[1],w=m+p.w*i.scale,v=x+p.h*i.scale,b=new t.pointGeometry3d(m,x),S=new t.pointGeometry3d(w,x),M=new t.pointGeometry3d(m,v),_=new t.pointGeometry3d(w,v);if(n&&i.vertical){const e=new t.pointGeometry3d(-d,d),o=-Math.PI/2,i=new t.pointGeometry3d(5,0);b._rotateAround(o,e)._add(i),S._rotateAround(o,e)._add(i),M._rotateAround(o,e)._add(i),_._rotateAround(o,e)._add(i);}if(a){const t=Math.sin(a),e=Math.cos(a),o=[e,-t,t,e];b._matMult(o),S._matMult(o),M._matMult(o),_._matMult(o);}h.push({tl:b,tr:S,bl:M,br:_,tex:p,writingMode:o.writingMode,glyphOffset:g});}return h}(0,i,n,r,s,u),g=e.textSizeData;let y=null;return "source"===g.functionType?y=[10*n.layout.get("text-size").evaluate(s,{},f)]:"composite"===g.functionType&&(y=[10*p.compositeTextSizes[0].evaluate(s,{},f),10*p.compositeTextSizes[1].evaluate(s,{},f)]),e.type!=t.VectorLayerType.SYMBOL&&e.type!=t.VectorLayerType.SYMTRACKING||e.addSymbols(e.text,d,y,a,r,s,c,o,l.lineStartIndex,l.lineLength,f),h.push(e.text.placedSymbolArray.length-1),4*d.length}function b(t,e,o,i){const n=t.compareText;if(e in n){const t=n[e];for(let e=t.length-1;e>=0;e--)if(i.dist(t[e])<o)return !0}else n[e]=[];return n[e].push(i),!1}function S(t,e,o){o=o||{},this.w=t||64,this.h=e||64,this.autoResize=!!o.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0;}function M(t,e,o){this.x=0,this.y=t,this.w=this.free=e,this.h=o;}function _(t,e,o,i,n,r,s){this.id=t,this.x=e,this.y=o,this.w=i,this.h=n,this.maxw=r||i,this.maxh=s||n,this.refcount=0;}S.prototype.pack=function(t,e){t=[].concat(t),e=e||{};for(var o,i,n,r=[],s=0;s<t.length;s++)if(i=t[s].h||t[s].height,(o=t[s].w||t[s].width)&&i){if(!(n=this.packOne(o,i,t[s].id)))continue;e.inPlace&&(t[s].x=n.x,t[s].y=n.y,t[s].id=n.id),r.push(n);}return this.shrink(),r},S.prototype.packOne=function(t,e,o){var i,n,r,s,a,l,c,h,u={freebin:-1,shelf:-1,waste:1/0},p=0;if("string"==typeof o||"number"==typeof o){if(i=this.getBin(o))return this.ref(i),i;"number"==typeof o&&(this.maxId=Math.max(o,this.maxId));}else o=++this.maxId;for(s=0;s<this.freebins.length;s++){if(e===(i=this.freebins[s]).maxh&&t===i.maxw)return this.allocFreebin(s,t,e,o);e>i.maxh||t>i.maxw||e<=i.maxh&&t<=i.maxw&&(r=i.maxw*i.maxh-t*e)<u.waste&&(u.waste=r,u.freebin=s);}for(s=0;s<this.shelves.length;s++)if(p+=(n=this.shelves[s]).h,!(t>n.free)){if(e===n.h)return this.allocShelf(s,t,e,o);e>n.h||e<n.h&&(r=(n.h-e)*t)<u.waste&&(u.freebin=-1,u.waste=r,u.shelf=s);}return -1!==u.freebin?this.allocFreebin(u.freebin,t,e,o):-1!==u.shelf?this.allocShelf(u.shelf,t,e,o):e<=this.h-p&&t<=this.w?(n=new M(p,this.w,e),this.allocShelf(this.shelves.push(n)-1,t,e,o)):this.autoResize?(a=l=this.h,((c=h=this.w)<=a||t>c)&&(h=2*Math.max(t,c)),(a<c||e>a)&&(l=2*Math.max(e,a)),this.resize(h,l),this.packOne(t,e,o)):null},S.prototype.allocFreebin=function(t,e,o,i){var n=this.freebins.splice(t,1)[0];return n.id=i,n.w=e,n.h=o,n.refcount=0,this.bins[i]=n,this.ref(n),n},S.prototype.allocShelf=function(t,e,o,i){var n=this.shelves[t].alloc(e,o,i);return this.bins[i]=n,this.ref(n),n},S.prototype.shrink=function(){if(this.shelves.length>0){for(var t=0,e=0,o=0;o<this.shelves.length;o++){var i=this.shelves[o];e+=i.h,t=Math.max(i.w-i.free,t);}this.resize(t,e);}},S.prototype.getBin=function(t){return this.bins[t]},S.prototype.ref=function(t){if(1==++t.refcount){var e=t.h;this.stats[e]=1+(0|this.stats[e]);}return t.refcount},S.prototype.unref=function(t){return 0===t.refcount?0:(0==--t.refcount&&(this.stats[t.h]--,delete this.bins[t.id],this.freebins.push(t)),t.refcount)},S.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0;},S.prototype.resize=function(t,e){this.w=t,this.h=e;for(var o=0;o<this.shelves.length;o++)this.shelves[o].resize(t);return !0},M.prototype.alloc=function(t,e,o){if(t>this.free||e>this.h)return null;var i=this.x;return this.x+=t,this.free-=t,new _(o,i,this.y,t,e,t,this.h)},M.prototype.resize=function(t){return this.free+=t-this.w,this.w=t,!0};class I{constructor(e){const o=new t.AlphaImage({width:0,height:0}),i={},n=new S(0,0,{autoResize:!0});for(const r in e){const s=e[r],a=i[r]={};for(const e in s){const i=s[+e];if(i&&0!==i.bitmap.width&&0!==i.bitmap.height){const r=n.packOne(i.bitmap.width+2,i.bitmap.height+2);o.resize({width:n.w,height:n.h}),t.AlphaImage.copy(i.bitmap,o,{x:0,y:0},{x:r.x+1,y:r.y+1},i.bitmap),a[e]={rect:r,metrics:i.metrics};}}}n.shrink(),o.resize({width:n.w,height:n.h}),this.image=o,this.positions=i;}}t.register("GlyphAtlas",I);class T{constructor(e){this.tileID=new t.OverscaledTileID(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y,this.projection),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.projection=e.projection||t.ProjectionType.MERCATOR,this.promoteId=e.promoteId,this.maxZoom=e.maxZoom;}parse(e,o,i,n,r){this.status="parsing",this.data=e,this.collisionBoxArray=new t.CollisionBoxArray;const s=new t.DictionaryCoder(Object.keys(e.layers).sort()),a=new t.FeatureIndex(this.tileID,this.promoteId,this.projection);a.bucketLayerIDs=[];const l={},c={featureIndex:a,iconDependencies:{},glyphDependencies:{},patternDependencies:{},x:this.tileID.canonical.x,y:this.tileID.canonical.y,z:this.tileID.canonical.z,availableImages:i},h=o.familiesBySource[this.source];for(const o in h){const n=e.layers[o];if(!n)continue;1===n.version&&t.warnOnce(`Vector tile source "${this.source}" layer "${o}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const r=s.encode(o),u=[];for(let t=0;t<n.length;t++){const e=n.feature(t),i=a.getId(e,o);e.id=i,u.push({feature:e,index:t,sourceLayerIndex:r});}for(const t of h[o]){const e=t[0];this.zoom<this.maxZoom&&e.minzoom&&this.zoom<Math.floor(e.minzoom)||e.maxzoom&&this.zoom>=e.maxzoom||"none"!==e.visibility&&(P(t,this.zoom,i),(l[e.id]=e.createBucket({index:a.bucketLayerIDs.length,layers:t,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:r,sourceID:this.source,projection:this.projection})).populate(u,c,this.tileID.canonical),a.bucketLayerIDs.push(t.map((t=>t.id))));}}let u,p,f,d;const g=t.mapObject(c.glyphDependencies,(t=>Object.keys(t).map(Number)));Object.keys(g).length?n.send("getGlyphs",{uid:this.uid,stacks:g},((t,e)=>{u||(u=t,p=e,w.call(this));})):p={};const y=Object.keys(c.iconDependencies);y.length?n.send("getImages",{icons:y,source:this.source,tileID:this.tileID,type:"icons"},((t,e)=>{u||(u=t,f=e,w.call(this));})):f={};const m=Object.keys(c.patternDependencies);function w(){if(u)return r(u);if(p&&f&&d){const e=new I(p),o=new t.ImageAtlas(f,d);for(const n in l){const r=l[n];r.type==t.VectorLayerType.SYMBOL||r.type==t.VectorLayerType.SYMTRACKING?(P(r.layers,this.zoom,i),x(r,p,e.positions,f,o.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):!r.hasPattern||r.type!=t.VectorLayerType.LINE&&r.type!=t.VectorLayerType.SPRITE&&r.type!=t.VectorLayerType.FILL&&r.type!=t.VectorLayerType.EXTRUSION||(P(r.layers,this.zoom,i),r.addFeatures(c,this.tileID.canonical,o.patternPositions));}this.status="done",r(null,{buckets:t.values(l).filter((t=>!t.isEmpty())),featureIndex:a,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,imageAtlas:o});}}m.length?n.send("getImages",{icons:m,source:this.source,tileID:this.tileID,type:"patterns"},((t,e)=>{u||(u=t,d=e,w.call(this));})):d={},w.call(this);}}function P(e,o,i){const n=new t.EvaluationParameters(o);for(const t of e)t.recalculate(n,i);}const L=t.window.performance;function k(t){const e=t?t.url.toString():void 0;return L.getEntriesByName(e)}class z{constructor(t,e,o,i){this.actor=t,this.layerIndex=e,this.loadVectorData=this.loadVectorTile,this.loading={},this.loaded={},this.availableImages=o,this.projection=i;}registRequestController(t){this.vrc=t;}loadVectorTile(e,o){return this.vrc.pushRequest({id:e.uid,param:e.request,cb:(i,n,r,s)=>{if(i)o(i);else if(n){const i=new t.mvt.VectorTile(new t.pbf(n),null,e&&e.projection);o(null,{vectorTile:i,rawData:n,cacheControl:r,expires:s});}}})}setDataLoaderFunction(t){t&&(this.loadVectorData=t);}loadTile(e,o){const i=e.uid,n=e&&e.request,r=n&&n.collectResourceTiming;this.loading||(this.loading={});const s=this.loading[i]=new T(e);s.hasRequest=this.loadVectorData(e,((e,a)=>{if(delete this.loading[i],e||!a)return o(e);const l=a.rawData,c={};a.expires&&(c.expires=a.expires),a.cacheControl&&(c.cacheControl=a.cacheControl);const h={};if(r){const t=k(n);t.length>0&&(h.resourceTiming=JSON.parse(JSON.stringify(t)));}s.vectorTile=a.vectorTile,s.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,((e,i)=>{if(e||!i)return o(e);o(null,t.extend({rawTileData:l.slice(0),bbx:a.bbx},i,c,h));})),this.loaded=this.loaded||{},this.loaded[i]=s;}),this.projection),this.vrc&&this.vrc.run();}reloadTile(t,e){const o=this.loaded,i=t.uid,n=this;if(o&&o[i]){const r=o[i];r.showCollisionBoxes=t.showCollisionBoxes;const s=(t,o)=>{const i=r.reloadCallback;i&&(delete r.reloadCallback,r.parse(r.vectorTile,n.layerIndex,this.availableImages,n.actor,i)),e(t,o);};"parsing"===r.status?r.reloadCallback=s:"done"===r.status&&r.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor,s);}}abortTile(t,e){const o=this.loading,i=t.uid;o&&o[i]&&o[i].hasRequest&&(this.vrc.removeRequestById(i),delete o[i]),e();}removeTile(t,e){const o=this.loaded,i=t.uid;o&&o[i]&&delete o[i],e();}}var O=function t(e,o){var i,n=e&&e.type;if("FeatureCollection"===n)for(i=0;i<e.features.length;i++)t(e.features[i],o);else if("GeometryCollection"===n)for(i=0;i<e.geometries.length;i++)t(e.geometries[i],o);else if("Feature"===n)t(e.geometry,o);else if("Polygon"===n)E(e.coordinates,o);else if("MultiPolygon"===n)for(i=0;i<e.coordinates.length;i++)E(e.coordinates[i],o);return e};function E(t,e){if(0!==t.length){C(t[0],e);for(var o=1;o<t.length;o++)C(t[o],!e);}}function C(t,e){for(var o=0,i=0,n=0,r=t.length,s=r-1;n<r;s=n++){var a=(t[n][0]-t[s][0])*(t[s][1]+t[n][1]),l=o+a;i+=Math.abs(o)>=Math.abs(a)?o-l+a:a-l+o,o=l;}o+i>=0!=!!e&&t.reverse();}const D=t.mvt.VectorTileFeature.prototype.toGeoJSON;class R{constructor(e,o){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,this.projObj=t.getProjection(o),"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10));}loadGeometry(){if(1===this._feature.type){const e=[];for(const o of this._feature.geometry)e.push([new t.pointGeometry3d(...o)]);return e}{const e=[];for(const o of this._feature.geometry){const i=[];for(const e of o)i.push(new t.pointGeometry3d(...e));e.push(i);}return e}}toGeoJSON(t,e,o){return D.call(this,t,e,o)}}class j{constructor(e,o){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e,this.projection=o;}feature(t){return new R(this._features[t],this.projection)}}var V=A;function A(t,e){this.x=t,this.y=e;}A.prototype={clone:function(){return new A(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,o=t.y-this.y;return e*e+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),o=Math.sin(t),i=o*this.x+e*this.y;return this.x=e*this.x-o*this.y,this.y=i,this},_rotateAround:function(t,e){var o=Math.cos(t),i=Math.sin(t),n=e.y+i*(this.x-e.x)+o*(this.y-e.y);return this.x=e.x+o*(this.x-e.x)-i*(this.y-e.y),this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},A.convert=function(t){return t instanceof A?t:Array.isArray(t)?new A(t[0],t[1]):t};var G=N;function N(t,e,o,i,n){this.properties={},this.extent=o,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=n,t.readFields(B,this,e);}function B(t,e,o){1==t?e.id=o.readVarint():2==t?function(t,e){for(var o=t.readVarint()+t.pos;t.pos<o;){var i=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[i]=n;}}(o,e):3==t?e.type=o.readVarint():4==t&&(e._geometry=o.pos);}function F(t){for(var e,o,i=0,n=0,r=t.length,s=r-1;n<r;s=n++)i+=((o=t[s]).x-(e=t[n]).x)*(e.y+o.y);return i}N.types=["Unknown","Point","LineString","Polygon"],N.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,o=t.readVarint()+t.pos,i=1,n=0,r=0,s=0,a=[];t.pos<o;){if(n<=0){var l=t.readVarint();i=7&l,n=l>>3;}if(n--,1===i||2===i)r+=t.readSVarint(),s+=t.readSVarint(),1===i&&(e&&a.push(e),e=[]),e.push(new V(r,s));else {if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone());}}return e&&a.push(e),a},N.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,o=1,i=0,n=0,r=0,s=1/0,a=-1/0,l=1/0,c=-1/0;t.pos<e;){if(i<=0){var h=t.readVarint();o=7&h,i=h>>3;}if(i--,1===o||2===o)(n+=t.readSVarint())<s&&(s=n),n>a&&(a=n),(r+=t.readSVarint())<l&&(l=r),r>c&&(c=r);else if(7!==o)throw new Error("unknown command "+o)}return [s,l,a,c]},N.prototype.toGeoJSON=function(t,e,o){var i,n,r=this.extent*Math.pow(2,o),s=this.extent*t,a=this.extent*e,l=this.loadGeometry(),c=N.types[this.type];function h(t){for(var e=0;e<t.length;e++){var o=t[e];t[e]=[360*(o.x+s)/r-180,360/Math.PI*Math.atan(Math.exp((180-360*(o.y+a)/r)*Math.PI/180))-90];}}switch(this.type){case 1:var u=[];for(i=0;i<l.length;i++)u[i]=l[i][0];h(l=u);break;case 2:for(i=0;i<l.length;i++)h(l[i]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return [t];for(var o,i,n=[],r=0;r<e;r++){var s=F(t[r]);0!==s&&(void 0===i&&(i=s<0),i===s<0?(o&&n.push(o),o=[t[r]]):o.push(t[r]));}return o&&n.push(o),n}(l),i=0;i<l.length;i++)for(n=0;n<l[i].length;n++)h(l[i][n]);}1===l.length?l=l[0]:c="Multi"+c;var p={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return "id"in this&&(p.id=this.id),p};var q=Y;function Y(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Z,this,e),this.length=this._features.length;}function Z(t,e,o){15===t?e.version=o.readVarint():1===t?e.name=o.readString():5===t?e.extent=o.readVarint():2===t?e._features.push(o.pos):3===t?e._keys.push(o.readString()):4===t&&e._values.push(function(t){for(var e=null,o=t.readVarint()+t.pos;t.pos<o;){var i=t.readVarint()>>3;e=1===i?t.readString():2===i?t.readFloat():3===i?t.readDouble():4===i?t.readVarint64():5===i?t.readVarint():6===i?t.readSVarint():7===i?t.readBoolean():null;}return e}(o));}function J(t,e,o){if(3===t){var i=new q(o,o.readVarint()+o.pos);i.length&&(e[i.name]=i);}}Y.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new G(this._pbf,e,this.extent,this._keys,this._values)};var X={VectorTile:function(t,e){this.layers=t.readFields(J,{},e);},VectorTileFeature:G,VectorTileLayer:q}.VectorTileFeature,W=$;function $(t,e){this.options=e||{},this.features=t,this.length=t.length;}function U(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096;}$.prototype.feature=function(t){return new U(this.features[t],this.options.extent)},U.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var o=t[e],i=[],n=0;n<o.length;n++)i.push(new V(o[n][0],o[n][1]));this.geometry.push(i);}return this.geometry},U.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,o=-1/0,i=1/0,n=-1/0,r=0;r<t.length;r++)for(var s=t[r],a=0;a<s.length;a++){var l=s[a];e=Math.min(e,l.x),o=Math.max(o,l.x),i=Math.min(i,l.y),n=Math.max(n,l.y);}return [e,i,o,n]},U.prototype.toGeoJSON=X.prototype.toGeoJSON;var K=Q,H=W;function Q(e){var o=new t.pbf;return function(t,e){for(var o in t.layers)e.writeMessage(3,tt,t.layers[o]);}(e,o),o.finish()}function tt(t,e){var o;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var i={keys:[],values:[],keycache:{},valuecache:{}};for(o=0;o<t.length;o++)i.feature=t.feature(o),e.writeMessage(2,et,i);var n=i.keys;for(o=0;o<n.length;o++)e.writeStringField(3,n[o]);var r=i.values;for(o=0;o<r.length;o++)e.writeMessage(4,st,r[o]);}function et(t,e){var o=t.feature;void 0!==o.id&&e.writeVarintField(1,o.id),e.writeMessage(2,ot,t),e.writeVarintField(3,o.type),e.writeMessage(4,rt,o);}function ot(t,e){var o=t.feature,i=t.keys,n=t.values,r=t.keycache,s=t.valuecache;for(var a in o.properties){var l=o.properties[a],c=r[a];if(null!==l){void 0===c&&(i.push(a),r[a]=c=i.length-1),e.writeVarint(c);var h=typeof l;"string"!==h&&"boolean"!==h&&"number"!==h&&(l=JSON.stringify(l));var u=h+":"+l,p=s[u];void 0===p&&(n.push(l),s[u]=p=n.length-1),e.writeVarint(p);}}}function it(t,e){return (e<<3)+(7&t)}function nt(t){return t<<1^t>>31}function rt(t,e){for(var o=t.loadGeometry(),i=t.type,n=0,r=0,s=o.length,a=0;a<s;a++){var l=o[a],c=1;1===i&&(c=l.length),e.writeVarint(it(1,c));for(var h=3===i?l.length-1:l.length,u=0;u<h;u++){1===u&&1!==i&&e.writeVarint(it(2,h-1));var p=l[u].x-n,f=l[u].y-r;e.writeVarint(nt(p)),e.writeVarint(nt(f)),n+=p,r+=f;}3===i&&e.writeVarint(it(7,1));}}function st(t,e){var o=typeof t;"string"===o?e.writeStringField(1,t):"boolean"===o?e.writeBooleanField(7,t):"number"===o&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t));}function at(t,e,o,i,n,r){if(n-i<=o)return;const s=i+n>>1;lt(t,e,s,i,n,r%2),at(t,e,o,i,s-1,r+1),at(t,e,o,s+1,n,r+1);}function lt(t,e,o,i,n,r){for(;n>i;){if(n-i>600){const s=n-i+1,a=o-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);lt(t,e,o,Math.max(i,Math.floor(o-a*c/s+h)),Math.min(n,Math.floor(o+(s-a)*c/s+h)),r);}const s=e[2*o+r];let a=i,l=n;for(ct(t,e,i,o),e[2*n+r]>s&&ct(t,e,i,n);a<l;){for(ct(t,e,a,l),a++,l--;e[2*a+r]<s;)a++;for(;e[2*l+r]>s;)l--;}e[2*i+r]===s?ct(t,e,i,l):(l++,ct(t,e,l,n)),l<=o&&(i=l+1),o<=l&&(n=l-1);}}function ct(t,e,o,i){ht(t,o,i),ht(e,2*o,2*i),ht(e,2*o+1,2*i+1);}function ht(t,e,o){const i=t[e];t[e]=t[o],t[o]=i;}function ut(t,e,o,i){const n=t-o,r=e-i;return n*n+r*r}K.fromVectorTileJs=Q,K.fromGeojsonVt=function(t,e){e=e||{};var o={};for(var i in t)o[i]=new W(t[i].features,e),o[i].name=i,o[i].version=e.version,o[i].extent=e.extent;return Q({layers:o})},K.GeoJSONWrapper=H;const pt=t=>t[0],ft=t=>t[1];class dt{constructor(t,e=pt,o=ft,i=64,n=Float64Array){this.nodeSize=i,this.points=t;const r=t.length<65536?Uint16Array:Uint32Array,s=this.ids=new r(t.length),a=this.coords=new n(2*t.length);for(let i=0;i<t.length;i++)s[i]=i,a[2*i]=e(t[i]),a[2*i+1]=o(t[i]);at(s,a,i,0,s.length-1,0);}range(t,e,o,i){return function(t,e,o,i,n,r,s){const a=[0,t.length-1,0],l=[];let c,h;for(;a.length;){const u=a.pop(),p=a.pop(),f=a.pop();if(p-f<=s){for(let s=f;s<=p;s++)c=e[2*s],h=e[2*s+1],c>=o&&c<=n&&h>=i&&h<=r&&l.push(t[s]);continue}const d=Math.floor((f+p)/2);c=e[2*d],h=e[2*d+1],c>=o&&c<=n&&h>=i&&h<=r&&l.push(t[d]);const g=(u+1)%2;(0===u?o<=c:i<=h)&&(a.push(f),a.push(d-1),a.push(g)),(0===u?n>=c:r>=h)&&(a.push(d+1),a.push(p),a.push(g));}return l}(this.ids,this.coords,t,e,o,i,this.nodeSize)}within(t,e,o){return function(t,e,o,i,n,r){const s=[0,t.length-1,0],a=[],l=n*n;for(;s.length;){const c=s.pop(),h=s.pop(),u=s.pop();if(h-u<=r){for(let n=u;n<=h;n++)ut(e[2*n],e[2*n+1],o,i)<=l&&a.push(t[n]);continue}const p=Math.floor((u+h)/2),f=e[2*p],d=e[2*p+1];ut(f,d,o,i)<=l&&a.push(t[p]);const g=(c+1)%2;(0===c?o-n<=f:i-n<=d)&&(s.push(u),s.push(p-1),s.push(g)),(0===c?o+n>=f:i+n>=d)&&(s.push(p+1),s.push(h),s.push(g));}return a}(this.ids,this.coords,t,e,o,this.nodeSize)}}const gt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},yt=Math.fround||(mt=new Float32Array(1),t=>(mt[0]=+t,mt[0]));var mt;class xt{constructor(e){this.options=Pt(Object.create(gt),e),this.trees=new Array(this.options.maxZoom+1),this.projection=e&&e.projection?e.projection:"MERCATOR",this.projObj=t.getProjection(this.projection);}createPointCluster(t,e,o){const[i,n]=t.geometry.coordinates;return {x:yt(St(i)),y:yt((o?_t:Mt)(n)),zoom:1/0,index:e,parentId:-1}}load(t){const{log:e,minZoom:o,maxZoom:i,nodeSize:n}=this.options;e&&console.time("total time");const r=`prepare ${t.length} points`;e&&console.time(r),this.points=t;let s=[];for(let e=0;e<t.length;e++)t[e].geometry&&s.push(this.createPointCluster(t[e],e,this.options.isLatLon));this.trees[i+1]=new dt(s,Lt,kt,n,Float32Array),e&&console.timeEnd(r);for(let t=i;t>=o;t--){const o=+Date.now();s=this._cluster(s,t),this.trees[t]=new dt(s,Lt,kt,n,Float32Array),e&&console.warn("z%d: %d clusters in %dms",t,s.length,+Date.now()-o);}return e&&console.timeEnd("total time"),this}getClusters(t,e){let o=((t[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,t[1]));let n=180===t[2]?180:((t[2]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)o=-180,n=180;else if(o>n){const t=this.getClusters([o,i,180,r],e),s=this.getClusters([-180,i,n,r],e);return t.concat(s)}const s=this.trees[this._limitZoom(e)],a=s.range(St(o),(this.options.isLatLon?_t:Mt)(r),St(n),(this.options.isLatLon?_t:Mt)(i)),l=[];for(const t of a){const e=s.points[t];l.push(e.numPoints?vt(e,this.options.isLatLon):this.points[e.index]);}return l}getChildren(t){const e=this._getOriginId(t),o=this._getOriginZoom(t),i="No cluster with the specified id.",n=this.trees[o];if(!n)throw new Error(i);const r=n.points[e];if(!r)throw new Error(i);const s=this.options.radius/(this.options.extent*Math.pow(2,o-1)),a=n.within(r.x,r.y,s),l=[];for(const e of a){const o=n.points[e];o.parentId===t&&l.push(o.numPoints?vt(o,this.options.isLatLon):this.points[o.index]);}if(0===l.length)throw new Error(i);return l}getLeaves(t,e,o){const i=[];return this._appendLeaves(i,t,e=e||10,o=o||0,0),i}getTile(t,e,o){const i=this.trees[this._limitZoom(t)],n=Math.pow(2,t),{extent:r,radius:s}=this.options,a=s/r,l=(o-a)/n,c=(o+1+a)/n,h={features:[]};return this._addTileFeatures(i.range((e-a)/n,l,(e+1+a)/n,c),i.points,e,o,n,h),0===e&&this._addTileFeatures(i.range(1-a/n,l,1,c),i.points,n,o,n,h),e===n-1&&this._addTileFeatures(i.range(0,l,a/n,c),i.points,-1,o,n,h),h.features.length?h:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const o=this.getChildren(t);if(e++,1!==o.length)break;t=o[0].properties.cluster_id;}return e}_appendLeaves(t,e,o,i,n){const r=this.getChildren(e);for(const e of r){const r=e.properties;if(r&&r.cluster?n+r.point_count<=i?n+=r.point_count:n=this._appendLeaves(t,r.cluster_id,o,i,n):n<i?n++:t.push(e),t.length===o)break}return n}_addTileFeatures(t,e,o,i,n,r){for(const s of t){const t=e[s],a=t.numPoints;let l,c,h;if(a)l=bt(t),c=t.x,h=t.y;else {const e=this.points[t.index];l=e.properties,c=St(e.geometry.coordinates[0]),h=(this.options.isLatLon?_t:Mt)(e.geometry.coordinates[1]);}const u={type:1,geometry:[[Math.round(this.options.extent*(c*n-o)),Math.round(this.options.extent*(h*n-i))]],tags:l};let p;a?p=t.id:this.options.generateId?p=t.index:this.points[t.index].id&&(p=this.points[t.index].id),void 0!==p&&(u.id=p),r.features.push(u);}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))}_cluster(t,e){const o=[],{radius:i,extent:n,reduce:r,minPoints:s}=this.options,a=i/(n*Math.pow(2,e));for(let i=0;i<t.length;i++){const n=t[i];if(n.zoom<=e)continue;n.zoom=e;const l=this.trees[e+1],c=l.within(n.x,n.y,a),h=n.numPoints||1;let u=h;for(const t of c){const o=l.points[t];o.zoom>e&&(u+=o.numPoints||1);}if(u>=s){let t=n.x*h,s=n.y*h,a=r&&h>1?this._map(n,!0):null;const p=(i<<5)+(e+1)+this.points.length;for(const o of c){const i=l.points[o];if(i.zoom<=e)continue;i.zoom=e;const c=i.numPoints||1;t+=i.x*c,s+=i.y*c,i.parentId=p,r&&(a||(a=this._map(n,!0)),r(a,this._map(i)));}n.parentId=p,o.push(wt(t/u,s/u,p,u,a));}else if(o.push(n),u>1)for(const t of c){const i=l.points[t];i.zoom<=e||(i.zoom=e,o.push(i));}}return o}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return (t-this.points.length)%32}_map(t,e){if(t.numPoints)return e?Pt({},t.properties):t.properties;const o=this.points[t.index].properties,i=this.options.map(o);return e&&i===o?Pt({},i):i}}function wt(t,e,o,i,n){return {x:yt(t),y:yt(e),zoom:1/0,id:o,parentId:-1,numPoints:i,properties:n}}function vt(t,e){return {type:"Feature",id:t.id,properties:bt(t),geometry:{type:"Point",coordinates:[(o=t.x,360*(o-.5)),(e?Tt:It)(t.y)]}};var o;}function bt(t){const e=t.numPoints,o=e>=1e4?`${Math.round(e/1e3)}k`:e>=1e3?Math.round(e/100)/10+"k":e;return Pt(Pt({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:o})}function St(t){return t/360+.5}function Mt(t){const e=Math.sin(t*Math.PI/180),o=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return o<0?0:o>1?1:o}function _t(t){const e=(90-t)/360;return e<0?0:e>1?1:e}function It(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function Tt(t){return 90-360*t}function Pt(t,e){for(const o in e)t[o]=e[o];return t}function Lt(t){return t.x}function kt(t){return t.y}function zt(t,e,o,i){let n=i;const r=o-e>>1;let s,a=o-e;const l=t[e],c=t[e+1],h=t[o],u=t[o+1];for(let i=e+3;i<o;i+=3){const e=Ot(t[i],t[i+1],l,c,h,u);if(e>n)s=i,n=e;else if(e===n){const t=Math.abs(i-r);t<a&&(s=i,a=t);}}n>i&&(s-e>3&&zt(t,e,s,i),t[s+2]=n,o-s>3&&zt(t,s,o,i));}function Ot(t,e,o,i,n,r){let s=n-o,a=r-i;if(0!==s||0!==a){const l=((t-o)*s+(e-i)*a)/(s*s+a*a);l>1?(o=n,i=r):l>0&&(o+=s*l,i+=a*l);}return s=t-o,a=e-i,s*s+a*a}function Et(t,e,o,i){const n={id:null==t?null:t,type:e,geometry:o,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===e||"MultiPoint"===e||"LineString"===e)Ct(n,o);else if("Polygon"===e)Ct(n,o[0]);else if("MultiLineString"===e)for(const t of o)Ct(n,t);else if("MultiPolygon"===e)for(const t of o)Ct(n,t[0]);return n}function Ct(t,e){for(let o=0;o<e.length;o+=3)t.minX=Math.min(t.minX,e[o]),t.minY=Math.min(t.minY,e[o+1]),t.maxX=Math.max(t.maxX,e[o]),t.maxY=Math.max(t.maxY,e[o+1]);}function Dt(t,e,o,i){if(!e.geometry)return;const n=e.geometry.coordinates,r=e.geometry.type,s=Math.pow(o.tolerance/((1<<o.maxZoom)*o.extent),2);let a=[],l=e.id;if(o.promoteId?l=e.properties[o.promoteId]:o.generateId&&(l=i||0),"Point"===r)Rt(n,a,o.projection);else if("MultiPoint"===r)for(const t of n)Rt(t,a,o.projection);else if("LineString"===r)jt(n,a,s,!1,o.projection);else if("MultiLineString"===r){if(o.lineMetrics){for(const i of n)a=[],jt(i,a,s,!1,o.projection),t.push(Et(l,"LineString",a,e.properties));return}Vt(n,a,s,!1,o.projection);}else if("Polygon"===r)Vt(n,a,s,!0,o.projection);else {if("MultiPolygon"!==r){if("GeometryCollection"===r){for(const n of e.geometry.geometries)Dt(t,{id:l,geometry:n,properties:e.properties},o,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const t of n){const e=[];Vt(t,e,s,!0,o.projection),a.push(e);}}t.push(Et(l,r,a,e.properties));}function Rt(t,e,o){e.push(...At(t,o),0);}function jt(t,e,o,i,n){let r,s,a=0;for(let o=0;o<t.length;o++){const l=At(t[o],n),c=l[0],h=l[1];e.push(c,h,0),o>0&&(a+=i?(r*h-c*s)/2:Math.sqrt(Math.pow(c-r,2)+Math.pow(h-s,2))),r=c,s=h;}const l=e.length-3;e[2]=1,zt(e,0,l,o),e[l+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size;}function Vt(t,e,o,i,n){for(let r=0;r<t.length;r++){const s=[];jt(t[r],s,o,i,n),e.push(s);}}function At(e,o){const i=t.getProjection(o),n=i.lngX(e[0],1);let r=i.latY(e[1],1);return r=r<0?0:r>1?1:r,[n,r]}function Gt(t,e,o,i,n,r,s,a){if(i/=e,r>=(o/=e)&&s<i)return t;if(s<o||r>=i)return null;const l=[];for(const e of t){const t=e.geometry;let r=e.type;const s=0===n?e.minX:e.minY,c=0===n?e.maxX:e.maxY;if(s>=o&&c<i){l.push(e);continue}if(c<o||s>=i)continue;let h=[];if("Point"===r||"MultiPoint"===r)Nt(t,h,o,i,n);else if("LineString"===r)Bt(t,h,o,i,n,!1,a.lineMetrics);else if("MultiLineString"===r)qt(t,h,o,i,n,!1);else if("Polygon"===r)qt(t,h,o,i,n,!0);else if("MultiPolygon"===r)for(const e of t){const t=[];qt(e,t,o,i,n,!0),t.length&&h.push(t);}if(h.length){if(a.lineMetrics&&"LineString"===r){for(const t of h)l.push(Et(e.id,r,t,e.tags));continue}"LineString"!==r&&"MultiLineString"!==r||(1===h.length?(r="LineString",h=h[0]):r="MultiLineString"),"Point"!==r&&"MultiPoint"!==r||(r=3===h.length?"Point":"MultiPoint"),l.push(Et(e.id,r,h,e.tags));}}return l.length?l:null}function Nt(t,e,o,i,n){for(let r=0;r<t.length;r+=3){const s=t[r+n];s>=o&&s<=i&&Yt(e,t[r],t[r+1],t[r+2]);}}function Bt(t,e,o,i,n,r,s){let a=Ft(t);const l=0===n?Zt:Jt;let c,h,u=t.start;for(let p=0;p<t.length-3;p+=3){const f=t[p],d=t[p+1],g=t[p+2],y=t[p+3],m=t[p+4],x=0===n?f:d,w=0===n?y:m;let v=!1;s&&(c=Math.sqrt(Math.pow(f-y,2)+Math.pow(d-m,2))),x<o?w>=o&&(h=l(a,f,d,y,m,o),s&&(a.start=u+c*h)):x>i?w<=i&&(h=l(a,f,d,y,m,i),s&&(a.start=u+c*h)):Yt(a,f,d,g),w<o&&x>=o&&(h=l(a,f,d,y,m,o),v=!0),w>i&&x<=i&&(h=l(a,f,d,y,m,i),v=!0),!r&&v&&(s&&(a.end=u+c*h),e.push(a),a=Ft(t)),s&&(u+=c);}let p=t.length-3;const f=t[p],d=t[p+1],g=0===n?f:d;g>=o&&g<=i&&Yt(a,f,d,t[p+2]),p=a.length-3,r&&p>=3&&(a[p]!==a[0]||a[p+1]!==a[1])&&Yt(a,a[0],a[1],a[2]),a.length&&e.push(a);}function Ft(t){const e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function qt(t,e,o,i,n,r){for(const s of t)Bt(s,e,o,i,n,r,!1);}function Yt(t,e,o,i){t.push(e,o,i);}function Zt(t,e,o,i,n,r){const s=(r-e)/(i-e);return Yt(t,r,o+(n-o)*s,1),s}function Jt(t,e,o,i,n,r){const s=(r-o)/(n-o);return Yt(t,e+(i-e)*s,r,1),s}function Xt(t,e){const o=[];for(let i=0;i<t.length;i++){const n=t[i],r=n.type;let s;if("Point"===r||"MultiPoint"===r||"LineString"===r)s=Wt(n.geometry,e);else if("MultiLineString"===r||"Polygon"===r){s=[];for(const t of n.geometry)s.push(Wt(t,e));}else if("MultiPolygon"===r){s=[];for(const t of n.geometry){const o=[];for(const i of t)o.push(Wt(i,e));s.push(o);}}o.push(Et(n.id,r,s,n.tags));}return o}function Wt(t,e){const o=[];o.size=t.size,void 0!==t.start&&(o.start=t.start,o.end=t.end);for(let i=0;i<t.length;i+=3)o.push(t[i]+e,t[i+1],t[i+2]);return o}function $t(t,e){if(t.transformed)return t;const o=1<<t.z,i=t.x,n=t.y;for(const r of t.features){const t=r.geometry,s=r.type;if(r.geometry=[],1===s)for(let s=0;s<t.length;s+=2)r.geometry.push(Ut(t[s],t[s+1],e,o,i,n));else for(let s=0;s<t.length;s++){const a=[];for(let r=0;r<t[s].length;r+=2)a.push(Ut(t[s][r],t[s][r+1],e,o,i,n));r.geometry.push(a);}}return t.transformed=!0,t}function Ut(t,e,o,i,n,r){return [Math.round(o*(t*i-n)),Math.round(o*(e*i-r))]}function Kt(t,e,o,i,n){const r=e===n.maxZoom?0:n.tolerance/((1<<e)*n.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:t.length,source:null,x:o,y:i,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const e of t)Ht(s,e,r,n);return s}function Ht(t,e,o,i){const n=e.geometry,r=e.type,s=[];if(t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),"Point"===r||"MultiPoint"===r)for(let e=0;e<n.length;e+=3)s.push(n[e],n[e+1]),t.numPoints++,t.numSimplified++;else if("LineString"===r)Qt(s,n,t,o,!1,!1);else if("MultiLineString"===r||"Polygon"===r)for(let e=0;e<n.length;e++)Qt(s,n[e],t,o,"Polygon"===r,0===e);else if("MultiPolygon"===r)for(let e=0;e<n.length;e++){const i=n[e];for(let e=0;e<i.length;e++)Qt(s,i[e],t,o,!0,0===e);}if(s.length){let o=e.tags||null;if("LineString"===r&&i.lineMetrics){o={};for(const t in e.tags)o[t]=e.tags[t];o.minemap_clip_start=n.start/n.size,o.minemap_clip_end=n.end/n.size;}const a={geometry:s,type:"Polygon"===r||"MultiPolygon"===r?3:"LineString"===r||"MultiLineString"===r?2:1,tags:o};null!==e.id&&(a.id=e.id),t.features.push(a);}}function Qt(t,e,o,i,n,r){const s=i*i;if(i>0&&e.size<(n?s:i))return void(o.numPoints+=e.length/3);const a=[];for(let t=0;t<e.length;t+=3)(0===i||e[t+2]>s)&&(o.numSimplified++,a.push(e[t],e[t+1])),o.numPoints++;n&&function(t,e){let o=0;for(let e=0,i=t.length,n=i-2;e<i;n=e,e+=2)o+=(t[e]-t[n])*(t[e+1]+t[n+1]);if(o>0===e)for(let e=0,o=t.length;e<o/2;e+=2){const i=t[e],n=t[e+1];t[e]=t[o-2-e],t[e+1]=t[o-1-e],t[o-2-e]=i,t[o-1-e]=n;}}(a,r),t.push(a);}const te={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0,projection:t.ProjectionType.MERCATOR};class ee{constructor(t,e){const o=(e=this.options=function(t,e){for(const o in e)t[o]=e[o];return t}(Object.create(te),e)).debug;if(o&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");let i=function(t,e){const o=[];if("FeatureCollection"===t.type)for(let i=0;i<t.features.length;i++)Dt(o,t.features[i],e,i);else Dt(o,"Feature"===t.type?t:{geometry:t},e);return o}(t,e);this.tiles={},this.tileCoords=[],o&&(console.timeEnd("preprocess data"),console.info("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),i=function(t,e){const o=e.buffer/e.extent;let i=t;const n=Gt(t,1,-1-o,o,0,-1,2,e),r=Gt(t,1,1-o,2+o,0,-1,2,e);return (n||r)&&(i=Gt(t,1,-o,1+o,0,-1,2,e)||[],n&&(i=Xt(n,1).concat(i)),r&&(i=i.concat(Xt(r,-1)))),i}(i,e),i.length&&this.splitTile(i,0,0,0),o&&(i.length&&console.info("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.info("tiles generated:",this.total,JSON.stringify(this.stats)));}splitTile(t,e,o,i,n,r,s){const a=[t,e,o,i],l=this.options,c=l.debug;for(;a.length;){i=a.pop(),o=a.pop(),e=a.pop(),t=a.pop();const h=1<<e,u=oe(e,o,i);let p=this.tiles[u];if(!p&&(c>1&&console.time("creation"),p=this.tiles[u]=Kt(t,e,o,i,l),this.tileCoords.push({z:e,x:o,y:i}),c)){c>1&&(console.info("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,o,i,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));const t=`z${e}`;this.stats[t]=(this.stats[t]||0)+1,this.total++;}if(p.source=t,null==n){if(e===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue}else {if(e===l.maxZoom||e===n)continue;if(null!=n){const t=n-e;if(o!==r>>t||i!==s>>t)continue}}if(p.source=null,0===t.length)continue;c>1&&console.time("clipping");const f=.5*l.buffer/l.extent,d=.5-f,g=.5+f,y=1+f;let m=null,x=null,w=null,v=null,b=Gt(t,h,o-f,o+g,0,p.minX,p.maxX,l),S=Gt(t,h,o+d,o+y,0,p.minX,p.maxX,l);t=null,b&&(m=Gt(b,h,i-f,i+g,1,p.minY,p.maxY,l),x=Gt(b,h,i+d,i+y,1,p.minY,p.maxY,l),b=null),S&&(w=Gt(S,h,i-f,i+g,1,p.minY,p.maxY,l),v=Gt(S,h,i+d,i+y,1,p.minY,p.maxY,l),S=null),c>1&&console.timeEnd("clipping"),a.push(m||[],e+1,2*o,2*i),a.push(x||[],e+1,2*o,2*i+1),a.push(w||[],e+1,2*o+1,2*i),a.push(v||[],e+1,2*o+1,2*i+1);}}getTile(t,e,o){t=+t,e=+e,o=+o;const i=this.options,{extent:n,debug:r}=i;if(t<0||t>24)return null;const s=1<<t,a=oe(t,e=e+s&s-1,o);if(this.tiles[a])return $t(this.tiles[a],n);r>1&&console.info("drilling down to z%d-%d-%d",t,e,o);let l,c=t,h=e,u=o;for(;!l&&c>0;)c--,h>>=1,u>>=1,l=this.tiles[oe(c,h,u)];return l&&l.source?(r>1&&(console.info("found parent tile z%d-%d-%d",c,h,u),console.time("drilling down")),this.splitTile(l.source,c,h,u,t,e,o),r>1&&console.timeEnd("drilling down"),this.tiles[a]?$t(this.tiles[a],n):null):null}}function oe(t,e,o){return 32*((1<<t)*o+e)+t}function ie(t,e,o){const i=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);const n=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!n)return e(null,null);const r=new j(n.features,o);let s=K(r);0===s.byteOffset&&s.byteLength===s.buffer.byteLength||(s=new Uint8Array(s)),e(null,{vectorTile:r,rawData:s.buffer});}class ne extends z{constructor(e,o,i,n){super(e,o,i,n),this.setDataLoaderFunction(ie),this.projection=n||t.ProjectionType.MERCATOR;}loadData(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData());}_loadData(){if(!this._pendingCallback||!this._pendingLoadDataParams)return;const e=this._pendingCallback,o=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;const i=o&&o.request,n=i&&i.collectResourceTiming;this.loadGeoJSON(o,((r,s)=>{if(r||!s)return e(r);if("object"!=typeof s)return e(new Error(`Input data given to '${o.source}' is not a valid GeoJSON object.`));{O(s,!0);try{if(o.filter){const e=t.createExpression(o.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===e.result)throw new Error(e.value.map((t=>`${t.key}: ${t.message}`)).join(", "));const i=s.features.filter((t=>e.value.evaluate({zoom:0},t)));s={type:"FeatureCollection",features:i};}o.geojsonVtOptions.projection=this.projection,this._geoJSONIndex=o.cluster?new xt(function({superclusterOptions:e,clusterProperties:o},i){if(e.isLatLon="LATLON"===i,!o||!e)return e.projection=i,e;const n={},r={},s={accumulated:null,zoom:0},a={properties:null},l=Object.keys(o);for(const e of l){const[i,s]=o[e],a=t.createExpression(s),l=t.createExpression("string"==typeof i?[i,["accumulated"],["get",e]]:i);n[e]=a.value,r[e]=l.value;}return e.map=t=>{a.properties=t;const e={};for(const t of l)e[t]=n[t].evaluate(s,a);return e},e.reduce=(t,e)=>{a.properties=e;for(const e of l)s.accumulated=t[e],t[e]=r[e].evaluate(s,a);},e.projection=i,e}(o,this.projection)).load(s.features):function(t,e){return new ee(t,e)}(s,o.geojsonVtOptions);}catch(r){return e(r)}this.loaded={};const a={};if(n){const t=k(i);t&&(a.resourceTiming={},a.resourceTiming[o.source]=JSON.parse(JSON.stringify(t)));}e(null,a);}}));}coalesce(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData());}reloadTile(t,e){const o=this.loaded;return o&&o[t.uid]?super.reloadTile(t,e):this.loadTile(t,e)}loadGeoJSON(e,o){if(e.request)t.getJSON(e.request,o);else {if("string"!=typeof e.data)return o(new Error("Input data is not a valid GeoJSON object."));try{return o(null,JSON.parse(e.data))}catch(t){return o(new Error("Input data is not a valid GeoJSON object."))}}}removeSource(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e();}getClusterExpansionZoom(t,e){e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId));}getClusterChildren(t,e){e(null,this._geoJSONIndex.getChildren(t.clusterId));}getClusterLeaves(t,e){e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset));}}class re{constructor(t,e,o,i){this.actor=t,this.loading={},this.loaded={},this.availableImages=o,this.projection=i;}registRequestController(t){this.irc=t;}loadTile(t,e){this._loadData(t,e);}_loadData(t,e){this.loading[t.uid]={imgRequest:null,binRequest:null};const o=t.uid;this.loading[o]=this.irc.pushRequest({id:o,param:t.request,cb:(t,i)=>{t&&e(t,null),delete this.loading[o],e(null,i);}}),this.irc.run();}reloadTile(t,e){this._loadData(t,e);const o=this.loaded,i=t.uid,n=this;if(o&&o[i]){const t=o[i],r=(o,i)=>{const r=t.reloadCallback;r&&(delete t.reloadCallback,t.parse(t.vectorTile,n.layerIndex,n.actor,r)),e(o,i);};"parsing"===t.status?t.reloadCallback=r:"done"===t.status&&t.parse(t.vectorTile,this.layerIndex,this.actor,r);}}abortTile(t,e){const o=this.loading,i=t.uid;o&&o[i]&&this.irc.removeRequestById(i),delete o[i],e();}removeTile(t,e){const o=this.loaded,i=t.uid;o&&o[i]&&delete o[i],e();}}class se{constructor(e,o,i,n){this.actor=e,this.loading={},this.loaded={},this.terrainTileParser=new t.TerrainTileParser,this.projection=n;}registRequestController(t){this.irc=t;}loadTile(t,e){this._loadData(t,e);}_loadData(t,e){const o=t.uid;this.loading[o]=this.irc.pushRequest({id:o,param:t.request,cb:(i,n)=>{i&&e(i,null);const r=this.terrainTileParser.createTerrain(n.data,t.tileID.canonical.x,t.tileID.canonical.y,t.tileID.canonical.z,this.projection,t.skirtHeight);delete this.loading[o],e(null,r);}}),this.irc.run();}reloadTile(t,e){this._loadData(t,e);const o=this.loaded,i=t.uid,n=this;if(o&&o[i]){const t=o[i],r=(o,i)=>{const r=t.reloadCallback;r&&(delete t.reloadCallback,t.parse(t.vectorTile,n.layerIndex,n.actor,r)),e(o,i);};"parsing"===t.status?t.reloadCallback=r:"done"===t.status&&t.parse(t.vectorTile,this.layerIndex,this.actor,r);}}abortTile(t,e){const o=this.loading,i=t.uid;o&&o[i]&&(this.irc.removeRequestById(i),delete o[i]),e();}removeTile(t,e){const o=this.loaded,i=t.uid;o&&o[i]&&delete o[i],e();}}class ae{constructor(e){this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.requestPerformanceManager=new t.RequestPerformanceManger,this.workerSourceTypes={vector:z,geojson:ne,raster:re,terrain:se},this.workerSources={},this.self.registerWorkerSource=(t,e)=>{if(this.workerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.workerSourceTypes[t]=e;},this.self.registerRTLTextPlugin=e=>{if(t.plugin.isParsed())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText;};}clearCaches(t,e,o){delete this.layerIndexes[t],delete this.availableImages[t],delete this.workerSources[t],o();}spriteLoaded(e,o){this.isSpriteLoaded[e]=o;for(const i in this.workerSources[e]){const n=this.workerSources[e][i];for(const e in n)n[e]instanceof z&&(n[e].isSpriteLoaded=o,n[e].fire&&n[e].fire(new t.Event("isSpriteLoaded")));}}setImages(t,e,o){this.availableImages[t]=e;for(const o in this.workerSources[t]){const i=this.workerSources[t][o];for(const t in i)i[t].availableImages=e;}o();}setProjection(t,e,o){this.projection=e.projection,o();}setReferrer(t,e){this.referrer=e;}setLayers(t,e,o){this.getLayerIndex(t).replace(e),o();}updateLayers(t,e,o){this.getLayerIndex(t).update(e.layers,e.removedIds),o();}loadTile(t,e,o){e.projection=this.projection,this.getWorkerSource(t,e.type,e.source).loadTile(e,o);}reloadTile(t,e,o){this.getWorkerSource(t,e.type,e.source).reloadTile(e,o);}abortTile(t,e,o){this.getWorkerSource(t,e.type,e.source).abortTile(e,o);}removeTile(t,e,o){this.getWorkerSource(t,e.type,e.source).removeTile(e,o);}removeSource(t,e,o){if(!this.workerSources[t]||!this.workerSources[t][e.type]||!this.workerSources[t][e.type][e.source])return;const i=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==i.removeSource?i.removeSource(e,o):o();}trianglesIntersact(t,e,o){"raster"===e.type&&this.getWorkerSource(t,e.type,e.source).trianglesIntersact(e,o);}loadWorkerSource(t,e,o){try{this.self.importScripts(e.url),o();}catch(t){o(t.toString());}}syncRTLPluginState(e,o,i){try{t.plugin.setState(o);const e=t.plugin.getPluginURL();if(t.plugin.isLoaded()&&!t.plugin.isParsed()&&null!=e){this.self.importScripts(e);const o=t.plugin.isParsed();i(o?void 0:new Error(`RTL Text Plugin failed to import scripts from ${e}`),o);}}catch(t){i(t.toString());}}getLayerIndex(t){let e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new i),e}getAvailableImages(t){let e=this.availableImages[t];return e||(e=[]),e}fetchLoadersTilesData(e,o,i){o.json?t.getJSON(o.requestOptions,((t,e)=>{i(t,e);})):t.getArrayBuffer(o.requestOptions,((e,o)=>{o&&(o=t.decodeModel(o)),i(e,o);}));}loadRegularTile(e,o,i){i(null,t.tileSamplesGrid(o.tileID,this.projection));}caculateViewdomeRatio(e,o,i){let n=0,r=0,s=0;for(let e=0;e<o.data.length;e++){const i=o.data[e];for(let e=0;e<i.length;e+=4){const o=t.Vector4.unpack(i,e,new t.Vector4);255===o.w&&(255===o.x?n++:255===o.y&&r++);}}s=0==r&&0===r?0:r/(n+r),i(null,s);}toggleRequestStatus(t,e){e?this.requestPerformanceManager.pauseVectorRequest():this.requestPerformanceManager.restartVectorRequest();}getWorkerSource(e,o,i){if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][o]||(this.workerSources[e][o]={}),!this.workerSources[e][o][i]){const n={send:(t,o,i)=>{this.actor.send(t,o,i,e);}},r=this.projection||t.ProjectionType.MERCATOR;this.workerSources[e][o][i]=new this.workerSourceTypes[o](n,this.getLayerIndex(e),this.getAvailableImages(e),r,this.isSpriteLoaded[e]),"raster"===o?this.workerSources[e][o][i].registRequestController(this.requestPerformanceManager.getImageRequesterById(i)):"vector"===o||"geojson"===o?this.workerSources[e][o][i].registRequestController(this.requestPerformanceManager.getVectorRequesterById(i)):"terrain"===o&&this.workerSources[e][o][i].registRequestController(this.requestPerformanceManager.getTerrainRequesterById(i));}return this.workerSources[e][o][i]}}return "undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new ae(self)),ae}));

define(["./shared"],(function(e){"use strict";function t(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return !1;for(let s=0;s<e.length;s++)if(!t(e[s],i[s]))return !1;return !0}if("object"==typeof e&&null!==e&&null!==i){if("object"!=typeof i)return !1;if(Object.keys(e).length!==Object.keys(i).length)return !1;for(const s in e)if(!t(e[s],i[s]))return !1;return !0}return e===i}"function"!=typeof Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");e=Object(e);for(let t=1;t<arguments.length;t++){const i=arguments[t];if(null!=i)for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t]);}return e});const i=e=>null!=e;class s{constructor(t={}){t={near:1,far:5e8,xOffset:0,yOffset:0,...t},this._offCenterFrustum=new e.PerspectiveOffCenterFrustum,this.fov=t.fov,this._fov=t.fov,this._fovy=t.fovy||2*Math.atan(Math.tan(.5*this.fov)/t.aspectRatio),this._sseDenominator=void 0,this.aspectRatio=t.aspectRatio,this._aspectRatio=void 0,this.near=t.near,this._near=this.near,this.far=t.far,this._far=this.far,this.xOffset=t.xOffset,this._xOffset=this.xOffset,this.yOffset=t.yOffset,this._yOffset=this.yOffset;}clone(e){return i(e)||(e=new s),e.aspectRatio=this.aspectRatio,e.fov=this.fov,e.near=this.near,e.far=this.far,e._aspectRatio=void 0,e._fov=void 0,e._near=void 0,e._far=void 0,this._offCenterFrustum.clone(e._offCenterFrustum),e}equals(e){return !!(i(e)&&e instanceof s)&&(r(this),r(e),this.fov===e.fov&&this.aspectRatio===e.aspectRatio&&this.near===e.near&&this.far===e.far&&this._offCenterFrustum.equals(e._offCenterFrustum))}equalsEpsilon(t,n,o){return !!(i(t)&&t instanceof s)&&(r(this),r(t),e.CONSTS.CesiumMath.equalsEpsilon(this.fov,t.fov,n,o)&&e.CONSTS.CesiumMath.equalsEpsilon(this.aspectRatio,t.aspectRatio,n,o)&&this._offCenterFrustum.equalsEpsilon(t._offCenterFrustum,n,o))}get projectionMatrix(){return r(this),this._offCenterFrustum.projectionMatrix}get infiniteProjectionMatrix(){return r(this),this._offCenterFrustum.infiniteProjectionMatrix}get fovy(){return r(this),this._fovy}get sseDenominator(){return r(this),this._sseDenominator}computeCullingVolume(e,t,i){return r(this),this._offCenterFrustum.computeCullingVolume(e,t,i)}setFromMatrix(e){return r(this),this._offCenterFrustum.setFromMatrix(e)}getPixelDimensions(e,t,i,s){return r(this),this._offCenterFrustum.getPixelDimensions(e,t,i,s)}}function r(e){const t=e._offCenterFrustum;e.fov===e._fov&&e.aspectRatio===e._aspectRatio&&e.near===e._near&&e.far===e._far&&e.xOffset===e._xOffset&&e.yOffset===e._yOffset||(e._aspectRatio=e.aspectRatio,e._fov=e.fov,e._fovy=e.aspectRatio<=1?e.fov:2*Math.atan(Math.tan(.5*e.fov)/e.aspectRatio),e._near=e.near,e._far=e.far,e._sseDenominator=2*Math.tan(.5*e._fovy),e._xOffset=e.xOffset,e._yOffset=e.yOffset,t.top=e.near*Math.tan(.5*e._fovy),t.bottom=-t.top,t.right=e.aspectRatio*t.top,t.left=-t.right,t.near=e.near,t.far=e.far,t.right+=e.xOffset,t.left+=e.xOffset,t.top+=e.yOffset,t.bottom+=e.yOffset);}class n{constructor(e){this.camerapos=void 0,this.cullingVolume=void 0,this.dir=void 0,this.up=void 0,this.type=e.type,this.updateFrustum(e);}updateFrustum(t){const{width:i,near:r,far:n,fov:o,fovy:a,aspectRatio:l}=t;switch(this.type){case"perspective":this.fov=a,this.frustum=new s({fov:o,fovy:a,near:r,far:n,aspectRatio:l});break;case"orthographic":this.frustum=new e.OrthographicFrustum({width:i,far:n,near:r,aspectRatio:l});}}updateCullingVolume(e,t,i){this.camerapos=e,this.dir=t,this.up=i,this.cullingVolume=this.frustum.computeCullingVolume(e,this.dir,this.up);}}class o extends e.Object3D{constructor(){super(),this.type="Camera",this.isCamera=!0,this.matrixWorldInverse=new e.Matrix4,this.matrixWorld=new e.Matrix4,this.projectionMatrix=new e.Matrix4,this.projectionMatrixInverse=new e.Matrix4,this.positionNew=new e.Vector3,this._positionNew=new e.Vector3,this._positionWC=new e.Vector3,this._positionCartographic=new e.Cartographic,this.directionNew=new e.Vector3,this._directionNew=new e.Vector3,this._directionWC=new e.Vector3,this.upNew=new e.Vector3,this._upNew=new e.Vector3,this._upWC=new e.Vector3,this.rightNew=new e.Vector3,this._rightNew=new e.Vector3,this._rightWC=new e.Vector3,this._transform=new e.Matrix4,this._invTransform=new e.Matrix4,this._actualTransform=new e.Matrix4,this._actualInvTransform=e.Matrix4.clone(e.Matrix4.IDENTITY),this._transformChanged=!1,this.percentageChanged=.5,this._viewMatrix=new e.Matrix4,this._invViewMatrix=new e.Matrix4,this.defaultRotateAmount=Math.PI/3600,this.constrainedAxis=e.Vector3.UNIT_Z,this.defaultMoveAmount=1e5,this._updateViewMatrix(this),this.frustumCrate=null;}get positionWC(){return this._updateMembers(),this._positionWC}get cartographicPosition(){return this._positionCartographic}get directionWC(){return this._updateMembers(),this._directionWC}get upWC(){return this._updateMembers(),this._upWC}get rightWC(){return this._updateMembers(),this._rightWC}get heading(){return this._heading}get pitch(){return this._pitch}get roll(){return this._roll}get transform(){return this._transform}set transform(t){t instanceof e.Matrix4&&(this._transform=t);}get direction(){return e.Vector3.negate(e.Vector3.normalize(new e.Vector3(this.matrix[8],this.matrix[9],this.matrix[10]),new e.Vector3))}set direction(t){if(this.unmodified=!1,!(t instanceof e.Vector3))throw new Error("direction must be type of Vector3!");this.matrix=e.Matrix4.fromCamera({position:this.position,direction:t,up:this.up}),this.updateMatrixWorld(!0);}get up(){return e.Vector3.normalize(new e.Vector3(this.matrix[4],this.matrix[5],this.matrix[6]),new e.Vector3)}set up(t){if(this.unmodified=!1,!(t instanceof e.Vector3))throw new Error("up must be type of Vector3!");this.matrix=e.Matrix4.fromCamera({position:this.position,direction:this.direction,up:t}),this.updateMatrixWorld(!0);}get viewMatrix(){return this._updateMembers(),this._viewMatrix}getWorldDirection(t){void 0===t&&(console.warn("MineMap需要有目标target"),t=new e.Vector3),this.updateMatrixWorld(!0);const i=this.matrixWorld.elements;return t.set(-i[8],-i[9],-i[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse=this.matrixWorld.clone().invert();}getVPMatrix(){return this.unmodified&&this._vpMatrix||this.updateMatrixWorld(!0),this._tmpProjectionMatrix&&this._tmpMatrixWorldInverse&&e.Matrix4.equalsArray(this.projectionMatrix,this._tmpProjectionMatrix)&&e.Matrix4.equalsArray(this.matrixWorldInverse,this._tmpMatrixWorldInverse)||(this._vpMatrix=this.projectionMatrix.clone().multiplyRight(this.matrixWorldInverse),this._tmpProjectionMatrix=this.projectionMatrix.clone(),this._tmpMatrixWorldInverse=this.matrixWorldInverse.clone()),this._vpMatrix.clone()}getViewMatrix(){return this.updateMatrixWorld(!0),this.matrixWorldInverse.clone()}getProjectionMatrix(){return this.projectionMatrix.clone()}_updateMembers(){let t=this._positionNew;const i=!e.Vector3.equals(t,this.positionNew);i&&(t=e.Vector3.clone(this.positionNew,this._positionNew));let s=this._directionNew;const r=!e.Vector3.equals(s,this.directionNew);r&&(e.Vector3.normalize(this.directionNew,this.directionNew),s=e.Vector3.clone(this.directionNew,this._directionNew));let n=this._upNew;const o=!e.Vector3.equals(n,this.upNew);o&&(e.Vector3.normalize(this.upNew,this.upNew),n=e.Vector3.clone(this.upNew,this._upNew));let a=this._rightNew;const l=!e.Vector3.equals(a,this.rightNew);l&&(e.Vector3.normalize(this.rightNew,this.rightNew),a=e.Vector3.clone(this.rightNew,this._rightNew));const h=this._transformChanged;this._transformChanged=!1,h&&(e.Matrix4.inverseTransformation(this._transform,this._invTransform),e.Matrix4.clone(this._transform,this._actualTransform),e.Matrix4.inverseTransformation(this._actualTransform,this._actualInvTransform));const _=this._actualTransform;if((i||h)&&(this._positionWC=e.Matrix4.multiplyByPoint(_,t,this._positionWC),this._positionCartographic=e.Ellipsoid.WGS84.cartesianToCartographic(this._positionWC,this._positionCartographic)),r||o||l){const t=e.Vector3.dot(s,e.Vector3.cross(n,a,new e.Vector3));if(Math.abs(1-t)>e.CONSTS.CesiumMath.EPSILON2){const t=1/e.Vector3.magnitudeSquared(n),i=e.Vector3.dot(n,s)*t,r=e.Vector3.multiplyByScalar(s,i,new e.Vector3);n=e.Vector3.normalize(e.Vector3.subtract(n,r,this._upNew),this._upNew),e.Vector3.clone(n,this.upNew),a=e.Vector3.cross(s,n,this._rightNew),e.Vector3.clone(a,this.rightNew);}}(r||h)&&(this._directionWC=e.Matrix4.multiplyByPointAsVector(_,s,this._directionWC),e.Vector3.normalize(this._directionWC,this._directionWC)),(o||h)&&(this._upWC=e.Matrix4.multiplyByPointAsVector(_,n,this._upWC),e.Vector3.normalize(this._upWC,this._upWC)),(l||h)&&(this._rightWC=e.Matrix4.multiplyByPointAsVector(_,a,this._rightWC),e.Vector3.normalize(this._rightWC,this._rightWC)),(i||r||o||l||h)&&this._updateViewMatrix();}_updateViewMatrix(){e.Matrix4.computeView(this._positionNew,this._directionNew,this._upNew,this._rightNew,this._viewMatrix),e.Matrix4.multiply(this._viewMatrix,this._actualInvTransform,this._viewMatrix),e.Matrix4.inverseTransformation(this._viewMatrix,this._invViewMatrix);}setMatrix(e){super.setMatrix(e),this.updateMatrixWorld(!0),this.updateCullingVolume(),this.unmodified=!1;}updateCullingVolume(){if(!this.frustumCrate)throw new Error({info:"当前没有正确初始化视锥体盒子对象！"});this.frustumCrate.updateCullingVolume(this.position,this.direction.clone(),this.up.clone());}getPickRay(t,i,s){if(!e.defined(t))throw new e.DeveloperError("windowPosition is required.");e.defined(s)||(s=new e.Ray);const r=this.frustumCrate.frustum;return e.defined(r.aspectRatio)&&e.defined(r.fov)&&e.defined(r.near)?this._getPickRayPerspective(this,i,t,s):this._getPickRayOrthographic(this,i,t,s)}_getPickRayPerspective(t,i,s,r){const n=i.clientWidth,o=i.clientHeight,a=Math.tan(.5*t.frustumCrate.frustum.fovy),l=t.frustumCrate.frustum.aspectRatio*a,h=t.frustumCrate.frustum.near,_=2/n*s.x-1,c=2/o*(o-s.y)-1,u=t.position.clone();r.origin=u;const d=e.Vector3.multiplyByScalar(t.direction,h,new e.Vector3);e.Vector3.add(u,d,d);const m=e.Vector3.multiplyByScalar(t.right,_*h*l,new e.Vector3),p=e.Vector3.multiplyByScalar(t.up,c*h*a,new e.Vector3),f=e.Vector3.add(d,m,r.direction);return e.Vector3.add(f,p,f),e.Vector3.subtract(f,u,f),e.Vector3.normalize(f,f),r}_getPickRayOrthographic(t,i,s){let r=t.frustum;return e.defined(r._offCenterFrustum)&&(r=r._offCenterFrustum),s}_pickEllipsoid3D(t,i,s,r){s=e.defaultValue(s,e.Ellipsoid.WGS84);const n=this.getPickRay(t,i,new e.Ray),o=e.IntersectionTests.rayEllipsoid(n,s);if(o)return e.Ray.getPoint(n,o.start>0?o.start:o.stop,r)}pickEllipsoid(t,i,s,r){if(!e.defined(t))throw new Error("windowPosition is required.");if(0!==i.clientWidth&&0!==i.clientHeight)return e.defined(r)||(r=new e.Vector3),s=e.defaultValue(s,e.Ellipsoid.WGS84),this._pickEllipsoid3D(t,i,s,r)}worldToCameraCoordinates(t,i){if(!e.defined(t))throw new Error("vector3 is required.");return e.defined(i)||(i=new e.Vector4),this._updateMembers(),e.Matrix4.multiplyByVector(this._actualInvTransform,t,i)}worldToCameraCoordinatesPoint(t,i){if(!e.defined(t))throw new Error("cartesian is required.");return e.defined(i)||(i=new e.Vector3),this._updateMembers(),e.Matrix4.multiplyByPoint(this._actualInvTransform,t,i)}rotate(t,i){if(!e.defined(t))throw new Error("axis is required.");const s=e.defaultValue(i,this.defaultRotateAmount),r=e.Quaternion.fromAxisAngle(t,-s,new e.Quaternion),n=e.Matrix3.fromQuaternion(r,new e.Matrix3);this.position=e.Matrix3.multiplyByVector(n,this.positionNew,this.positionNew),e.Matrix3.multiplyByVector(n,this.directionNew,this.directionNew),e.Matrix3.multiplyByVector(n,this.upNew,this.upNew),e.Vector3.cross(this.directionNew,this.upNew,this.rightNew),e.Vector3.cross(this.rightNew,this.directionNew,this.upNew);}zoomIn(e){this._zoom3D(e);}_zoom3D(e){this.move(this.directionNew,e);}move(t,i){if(!e.defined(t))throw new Error("direction is required.");const s=new e.Vector3;e.Vector3.multiplyByScalar(t,i,s),this.position=e.Vector3.add(this.positionNew,s,this.positionNew);}_setTransform(t){const i=e.Vector3.clone(this.positionWC,new e.Vector3),s=e.Vector3.clone(this.upWC,new e.Vector3),r=e.Vector3.clone(this.directionWC,new e.Vector3);e.Matrix4.clone(t,this._transform),this._transformChanged=!0,this._updateMembers();const n=this._actualInvTransform;e.Matrix4.multiplyByPoint(n,i,this.positionNew),e.Matrix4.multiplyByPointAsVector(n,r,this.directionNew),e.Matrix4.multiplyByPointAsVector(n,s,this.upNew),e.Vector3.cross(this.directionNew,this.upNew,this.rightNew),this._updateMembers();}rotateUp(t){t=e.defaultValue(t,this.defaultRotateAmount),this._rotateVertical(-t);}_rotateVertical(t){const i=this.positionNew;if(e.defined(this.constrainedAxis)&&!e.Vector3.equalsEpsilon(this.positionNew,e.Vector3.ZERO,e.CONSTS.CesiumMath.EPSILON2)){const s=e.Vector3.normalize(i,new e.Vector3),r=e.Vector3.equalsEpsilon(s,this.constrainedAxis,e.CONSTS.CesiumMath.EPSILON2),n=e.Vector3.equalsEpsilon(s,e.Vector3.negate(this.constrainedAxis,new e.Vector3),e.CONSTS.CesiumMath.EPSILON2);if(r||n)(r&&t<0||n&&t>0)&&this.rotate(this.rightNew,t);else {const i=e.Vector3.normalize(this.constrainedAxis,new e.Vector3);let r=e.Vector3.dot(s,i),n=e.CONSTS.CesiumMath.acosClamped(r);t>0&&t>n&&(t=n-e.CONSTS.CesiumMath.EPSILON4),r=e.Vector3.dot(s,e.Vector3.negate(i,new e.Vector3)),n=e.CONSTS.CesiumMath.acosClamped(r),t<0&&-t>n&&(t=-n+e.CONSTS.CesiumMath.EPSILON4);const o=e.Vector3.cross(i,s,new e.Vector3);this.rotate(o,t);}}else this.rotate(this.rightNew,t);}rotateRight(t){t=e.defaultValue(t,this.defaultRotateAmount),this._rotateHorizontal(-t);}_rotateHorizontal(t){e.defined(this.constrainedAxis)?this.rotate(this.constrainedAxis,t):this.rotate(this.upNew,t);}moveForward(t){t=e.defaultValue(t,this.defaultMoveAmount),this.move(this.directionNew.clone(),t);}moveBackward(t){t=e.defaultValue(t,this.defaultMoveAmount),this.move(this.directionNew.clone(),-t);}moveLeft(t){t=e.defaultValue(t,this.defaultMoveAmount),this.move(this.rightNew.clone(),-t);}moveRight(t){t=e.defaultValue(t,this.defaultMoveAmount),this.move(this.rightNew,t);}look(t,i){if(!e.defined(t))throw new Error("axis is required.");const s=e.defaultValue(i,Math.PI/60),r=e.Quaternion.fromAxisAngle(t,-s,new e.Quaternion),n=e.Matrix3.fromQuaternion(r,new e.Matrix3),o=this.directionNew,a=this.upNew,l=this.rightNew;e.Matrix3.multiplyByVector(n,o,o),e.Matrix3.multiplyByVector(n,a,a),e.Matrix3.multiplyByVector(n,l,l);}getRectangleCameraCoordinates(t,i){if(!e.defined(t))throw new e.DeveloperError("rectangle is required");return e.defined(i)||(i=new e.Vector3),this.rectangleCameraPosition3D(t,i)}rectangleCameraPosition3D(t,i,s){const r=e.Ellipsoid.WGS84,n=s?this:{direction:new e.Vector3,right:new e.Vector3,up:new e.Vector3},o=t.north,a=t.south;let l=t.east;const h=t.west;h>l&&(l+=e.CONSTS.CesiumMath.TWO_PI);const _=.5*(h+l);let c;if(a<-e.CONSTS.CesiumMath.PI_OVER_TWO+e.CONSTS.CesiumMath.RADIANS_PER_DEGREE&&o>e.CONSTS.CesiumMath.PI_OVER_TWO-e.CONSTS.CesiumMath.RADIANS_PER_DEGREE)c=0;else {const t=new e.Cartographic(_,o,0),i=new e.Cartographic(_,a,0),s=new e.EllipsoidGeodesic(void 0,void 0,r);s.setEndPoints(t,i),c=s.interpolateUsingFraction(.5,new e.Cartographic).latitude;}const u=new e.Cartographic(_,c,0),d=r.cartographicToCartesian(u,new e.Vector3),m=new e.Cartographic;m.longitude=l,m.latitude=o;const p=r.cartographicToCartesian(m,new e.Vector3);m.longitude=h;const f=r.cartographicToCartesian(m,new e.Vector3);m.longitude=_;const g=r.cartographicToCartesian(m,new e.Vector3);m.latitude=a;const y=r.cartographicToCartesian(m,new e.Vector3);m.longitude=l;const C=r.cartographicToCartesian(m,new e.Vector3);m.longitude=h;const T=r.cartographicToCartesian(m,new e.Vector3);e.Vector3.subtract(f,d,f),e.Vector3.subtract(C,d,C),e.Vector3.subtract(p,d,p),e.Vector3.subtract(T,d,T),e.Vector3.subtract(g,d,g),e.Vector3.subtract(y,d,y);const x=r.geodeticSurfaceNormal(d,n.directionNew);e.Vector3.negate(x,x);const b=e.Vector3.cross(x,e.Vector3.UNIT_Z,n.rightNew);e.Vector3.normalize(b,b);const v=e.Vector3.cross(b,x,n.upNew);let w;const S=Math.tan(.5*this.frustumCrate.frustum.fovy),A=this.frustumCrate.frustum.aspectRatio*S;if(w=Math.max(this._computeD(x,v,f,S),this._computeD(x,v,C,S),this._computeD(x,v,p,S),this._computeD(x,v,T,S),this._computeD(x,v,g,S),this._computeD(x,v,y,S),this._computeD(x,b,f,A),this._computeD(x,b,C,A),this._computeD(x,b,p,A),this._computeD(x,b,T,A),this._computeD(x,b,g,A),this._computeD(x,b,y,A)),a<0&&o>0){const t=new e.Cartographic(h,0,0);let i=r.cartographicToCartesian(t,new e.Vector3);e.Vector3.subtract(i,d,i),w=Math.max(w,this._computeD(x,v,i,S),this._computeD(x,b,i,A)),t.longitude=l,i=r.cartographicToCartesian(t,new e.Vector3),e.Vector3.subtract(i,d,i),w=Math.max(w,this._computeD(x,v,i,S),this._computeD(x,b,i,A));}return e.Vector3.add(d,e.Vector3.multiplyByScalar(x,-w,new e.Vector3),i)}_computeD(t,i,s,r){return Math.abs(e.Vector3.dot(i,s))/r-e.Vector3.dot(t,s)}_directionUpToHeadingPitchRoll(t,i,s,r){const n=e.Vector3.clone(s.direction,new e.Vector3),o=e.Vector3.clone(s.up,new e.Vector3),a=e.Transforms.eastNorthUpToFixedFrame(i),l=e.Matrix4.inverseTransformation(a,new e.Matrix4);e.Matrix4.multiplyByPointAsVector(l,n,n),e.Matrix4.multiplyByPointAsVector(l,o,o);const h=e.Vector3.cross(n,o,new e.Vector3);return r.heading=this._getHeading(n,o),r.pitch=this._getPitch(n),r.roll=this._getRoll(n,o,h),r}setView(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT);let i=e.defaultValue(t.orientation,e.defaultValue.EMPTY_OBJECT);e.defined(t.endTransform)&&this._setTransform(t.endTransform);let s=e.defaultValue(t.destination,e.Vector3.clone(this.positionNew,new e.Vector3));e.defined(s)&&e.defined(s.west)&&(s=this.getRectangleCameraCoordinates(s,new e.Vector3)),e.defined(i.direction)&&(i=this._directionUpToHeadingPitchRoll(this,s,i,{direction:void 0,up:void 0,heading:void 0,pitch:void 0,roll:void 0}));const r=new e.HeadingPitchRoll;r.heading=e.defaultValue(i.heading,0),r.pitch=e.defaultValue(i.pitch,-e.CONSTS.CesiumMath.PI_OVER_TWO),r.roll=e.defaultValue(i.roll,0),this._setView3D(s,r),this._updateCameraChanged(),this.setMatrix(this._invViewMatrix.clone());}_setView3D(t,i){const s=e.Matrix4.clone(this.transform,new e.Matrix4),r=e.Transforms.eastNorthUpToFixedFrame(t);this._setTransform(r),e.Vector3.clone(e.Vector3.ZERO,this.positionNew),i.heading=i.heading-e.CONSTS.CesiumMath.PI_OVER_TWO;const n=(new e.Quaternion).fromHeadingPitchRoll(i),o=e.Matrix3.fromQuaternion(n,new e.Matrix3);e.Matrix3.getColumn(o,0,this.directionNew),e.Matrix3.getColumn(o,2,this.upNew),e.Vector3.cross(this.directionNew,this.upNew,this.rightNew),this._setTransform(s);}_initializedHeadingPitchRoll(){this._heading=this._calculateHeading(),this._pitch=this._calculatePitch(),this._roll=this._calculateRoll();}_getHeading(t,i){let s;return s=e.CONSTS.CesiumMath.equalsEpsilon(Math.abs(t.z),1,e.CONSTS.CesiumMath.EPSILON3)?Math.atan2(i.y,i.x)-e.CONSTS.CesiumMath.PI_OVER_TWO:Math.atan2(t.y,t.x)-e.CONSTS.CesiumMath.PI_OVER_TWO,e.CONSTS.CesiumMath.TWO_PI-e.CONSTS.CesiumMath.zeroToTwoPi(s)}_getPitch(t){return e.CONSTS.CesiumMath.PI_OVER_TWO-e.CONSTS.CesiumMath.acosClamped(t.z)}_getRoll(t,i,s){let r=0;return e.CONSTS.CesiumMath.equalsEpsilon(Math.abs(t.z),1,e.CONSTS.CesiumMath.EPSILON3)||(r=Math.atan2(-s.z,i.z),r=e.CONSTS.CesiumMath.zeroToTwoPi(r+e.CONSTS.CesiumMath.TWO_PI)),r}_calculateHeading(){const t=e.Matrix4.clone(this._transform,new e.Matrix4),i=e.Transforms.eastNorthUpToFixedFrame(this.positionWC,e.Ellipsoid.WGS84);this._setTransform(i);const s=this._getHeading(this.directionNew,this.upNew);return this._setTransform(t),s}_calculatePitch(){const t=e.Matrix4.clone(this._transform,new e.Matrix4),i=e.Transforms.eastNorthUpToFixedFrame(this.positionWC,e.Ellipsoid.WGS84);this._setTransform(i);const s=this._getPitch(this.directionNew);return this._setTransform(t),s}_calculateRoll(){const t=e.Matrix4.clone(this._transform,new e.Matrix4),i=e.Transforms.eastNorthUpToFixedFrame(this.positionWC,e.Ellipsoid.WGS84);this._setTransform(i);const s=this._getRoll(this.directionNew,this.upNew,this.rightNew);return this._setTransform(t),s}_updateCameraChanged(){const t=this,i=t.percentageChanged,s=this._calculateHeading();this._heading=s,this._pitch=this._calculatePitch(),this._roll=this._calculateRoll(),e.defined(t._changedHeading)||(t._changedHeading=s);let r=Math.abs(t._changedHeading-s)%e.CONSTS.CesiumMath.TWO_PI;if(r=r>e.CONSTS.CesiumMath.PI?e.CONSTS.CesiumMath.TWO_PI-r:r,r/Math.PI>i&&(t._changedHeading=s),!e.defined(t._changedDirection))return t._changedPosition=e.Vector3.clone(t.positionWC,t._changedPosition),void(t._changedDirection=e.Vector3.clone(t.directionWC,t._changedDirection));const n=e.CONSTS.CesiumMath.acosClamped(e.Vector3.dot(t.directionWC,t._changedDirection));let o;o=e.defined(t.frustumCrate.frustum.fovy)?n/(.5*t.frustumCrate.frustum.fovy):n;const a=e.Vector3.distance(t.positionWC,t._changedPosition);(o>i||a/t.cartographicPosition[2]>i)&&(t._changedPosition=e.Vector3.clone(t.positionWC,t._changedPosition),t._changedDirection=e.Vector3.clone(t.directionWC,t._changedDirection)),this.updateCullingVolume();}}class a extends o{constructor(t,i,s,r){super(),this.type="PerspectiveCamera",this.isPerspectiveCamera=!0,this.fov=void 0!==t?t:60,this.zoom=1,this.mapZoom=0,this.near=void 0!==s?s:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==i?i:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix();const n=e.Cartographic.fromVector3(this.rectangleCameraPosition3D(e.Rectangle.fromDegrees(100,-20,120,90),this.positionWC,!0));this.position=e.Vector3.fromRadians(n.longitude,n.latitude,19134411),this._initializedHeadingPitchRoll();}updatePerspectiveOptions(e){e.hasOwnProperty("fov")&&(this.fov=e.fov),e.hasOwnProperty("aspect")&&(this.aspect=e.aspect),e.hasOwnProperty("near")&&(this.near=e.near),e.hasOwnProperty("far")&&(this.far=e.far),this.updateProjectionMatrix();}setFocalLength(t){const i=.5*this.getFilmHeight()/t;this.fov=2*e.CONSTS.TRANSFORM.RAD_TO_DEG*Math.atan(i),this.updateProjectionMatrix();}getFocalLength(){const t=Math.tan(.5*e.CONSTS.TRANSFORM.DEG_TO_RAD*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*e.CONSTS.TRANSFORM.RAD_TO_DEG*Math.atan(Math.tan(.5*e.CONSTS.TRANSFORM.DEG_TO_RAD*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,s,r,n){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=n,this.updateProjectionMatrix();}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix();}updateProjectionMatrix(){const t=this.near,i=e.CONSTS.TRANSFORM.DEG_TO_RAD*this.fov;this.frustumCrate?this.frustumCrate.updateFrustum({near:t,far:this.far,fovy:i,fov:2*Math.atan(this.aspect*Math.tan(i/2)),aspectRatio:this.aspect}):this.frustumCrate=new n({near:t,far:this.far,fovy:i,fov:2*Math.atan(this.aspect*Math.tan(i/2)),aspectRatio:this.aspect,type:"perspective"}),this.projectionMatrix=this.frustumCrate.frustum.projectionMatrix,this.projectionMatrixInverse=this.projectionMatrix.clone().invert();}static clone(t,i){return e.defined(i)||(i=new a(t.fov,t.aspect,t.near,t.far)),e.Vector3.clone(t.positionNew,i.positionNew),e.Vector3.clone(t.directionNew,i.directionNew),e.Vector3.clone(t.rightNew,i.rightNew),e.Vector3.clone(t.upNew,i.upNew),i._updateCameraChanged(),i.setMatrix(i._invViewMatrix.clone()),i.frustumCrate.frustum=t.frustumCrate.frustum.clone(),i._transformChanged=!0,i}serialize(){return {type:"PerspectiveCamera",fov:this.fov,aspect:this.aspect,near:this.near,far:this.far,matrix:this.matrixWorld}}}class l extends o{constructor(t,i,s,r){super(),this.type="OrthographicCamera",this.isOrthographicCamera=!0,this.zoom=1,this.view=null,this.aspectRatio=e.defined(i)?i:1,this.width=e.defined(t)?t:1,this.near=e.defined(s)?s:.1,this.far=e.defined(r)?r:2e3,this.projectMatrix=new e.Matrix4,this.vMatrix=new e.Matrix4,this.vpMatrix=new e.Matrix4,this._painter=null,this.updateProjectionMatrix();}updateOrthographicOptions(e){e.hasOwnProperty("width")&&(this.width=e.width),e.hasOwnProperty("aspectRatio")&&(this.aspectRatio=e.aspectRatio),e.hasOwnProperty("near")&&(this.near=e.near),e.hasOwnProperty("far")&&(this.far=e.far),this.updateProjectionMatrix();}setViewOffset(e,t,i,s,r,n){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=n,this.updateProjectionMatrix();}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix();}updateProjectionMatrix(){this.frustumCrate?this.frustumCrate.updateFrustum({width:this.width,near:this.near,far:this.far,aspectRatio:this.aspectRatio}):this.frustumCrate=new n({width:this.width,near:this.near,far:this.far,aspectRatio:this.aspectRatio,type:"orthographic"}),this.projectionMatrix=this.frustumCrate.frustum.projectionMatrix,this.projectionMatrixInverse=this.projectionMatrix.clone().invert();}update(){if(!this._painter.frameState.camera)return;const e=this._painter.frameState.sunLight;e&&(this.timestamp=e.timestamp,this.initViewMatrix(e),this.updateVPMatrix());}initViewMatrix(t){const i=this._painter.frameState.camera.frustumCrate.camerapos;return this.lightRight=new e.Vector3,this.lightUp=new e.Vector3(-.06079590320587158,.17691355105489492,.982346910983324),this.lightDir=e.Vector3.normalize(t.getSunDirectionGlobalWithCache(),new e.Vector3),this.lightDir=e.Vector3.multiplyByScalar(this.lightDir,-1,this.lightDir),this.lightPosition=i,e.Vector3.cross(this.lightDir,this.lightUp,this.lightRight),this.lightUp=e.Vector3.cross(this.lightRight,this.lightDir,new e.Vector3),e.Vector3.normalize(this.lightUp,this.lightUp),e.Vector3.normalize(this.lightRight,this.lightRight),e.Matrix4.computeView(this.lightPosition,this.lightDir,this.lightUp,this.lightRight,this.vMatrix)}updateVPMatrix(){const t=this.getBoundingBox(this._painter),i=t.max,s=t.min;this.lightPosition=e.Matrix4.multiplyByVector(e.Matrix4.inverse(this.vMatrix,new e.Matrix4),e.Vector4.fromElements((s.x+i.x)/2,(s.y+i.y)/2,-s.z,1),new e.Vector4),e.Matrix4.computeView(this.lightPosition,this.lightDir,this.lightUp,this.lightRight,this.vMatrix),this.updateProjectMatrix(s,i),this.vpMatrix=new e.Matrix4,e.Matrix4.multiply(this.vpMatrix,this.projectMatrix,this.vMatrix);}updateProjectMatrix(t,i){const s=.5*(i.x-t.x),r=.5*(i.y-t.y),n=-s,o=s,a=-r,l=r,h=-.1,_=-(i.z-t.z),c=new e.Matrix4;c[0]=2/(o-n),c[5]=2/(l-a),c[10]=2/(_-h),c[12]=-(o+n)/(o-n),c[13]=-(l+a)/(l-a),c[14]=-(_+h)/(_-h),c[15]=1,this.projectMatrix=c;}getBoundingBox(t){const i=this.getNearFar(t,this.lightPosition,this.lightDir),s=this.getNearFar(t,this.lightPosition,this.lightRight),r=this.getNearFar(t,this.lightPosition,this.lightUp);return {min:e.Vector3.fromElements(s[0],r[0],i[0]),max:e.Vector3.fromElements(s[1],r[1],i[1])}}getNearFar(e,t,i){let s=this.getMaxMin(e.renderGroup.modelTranslucentPrimitiveList,t,i,{near:+Number.MAX_VALUE,far:-Number.MAX_VALUE});return s=this.getMaxMin(e.renderGroup.modelOpaquePrimitiveList,t,i,s),[s.near,s.far]}getMaxMin(e,t,i,s={}){let r=s.near,n=s.far;for(let s=0;s<e.length;s++){const o=e[s];if(o.boundingVolume){const e=o.boundingVolume.computePlaneDistances(t,i),s=e.stop;r=Math.min(r,e.start),n=Math.max(n,s);}}return {near:r,far:n}}serialize(){return {type:"OrthographicCamera",width:this.width,aspect:this.aspectRatio,near:this.near,far:this.far,matrix:this.matrixWorld}}}var h=Object.freeze({LOOP_REPEAT:0,LOOP_ONCE:1,LOOP_NONE:2});const _={NONE:0,PRECISE:1,MEDIUM:2,STABLE:3};let c;c="undefined"!=typeof navigator?e.window.navigator:{};const u=e=>{const t=e.split(".");for(let e=0,i=t.length;e<i;++e)t[e]=parseInt(t[e],10);return t};let d,m;const p=()=>{if(!e.defined(d)&&(d=!1,!E())){const e=/ Chrome\/([\.0-9]+)/.exec(c.userAgent);null!==e&&(d=!0,m=u(e[1]));}return d};let f,g;const y=()=>{if(!e.defined(f)&&(f=!1,!p()&&!E()&&/ Safari\/[\.0-9]+/.test(c.userAgent))){const e=/ Version\/([\.0-9]+)/.exec(c.userAgent);null!==e&&(f=!0,g=u(e[1]));}return f};let C,T;const x=()=>{if(!e.defined(C)){C=!1;const e=/ AppleWebKit\/([\.0-9]+)(\+?)/.exec(c.userAgent);null!==e&&(C=!0,T=u(e[1]),T.isNightly=!!e[2]);}return C};let b,v;const w=()=>{if(!e.defined(b)){let e;b=!1,"Microsoft Internet Explorer"===c.appName?(e=/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(c.userAgent),null!==e&&(b=!0,v=u(e[1]))):"Netscape"===c.appName&&(e=/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(c.userAgent),null!==e&&(b=!0,v=u(e[1])));}return b};let S,A;const E=()=>{if(!e.defined(S)){S=!1;const e=/ Edg\/([\.0-9]+)/.exec(c.userAgent);null!==e&&(S=!0,A=u(e[1]));}return S};let M,P;const R=()=>{if(!e.defined(M)){M=!1;const e=/Firefox\/([\.0-9]+)/.exec(c.userAgent);null!==e&&(M=!0,P=u(e[1]));}return M};let B,I,D,O,L;const V=()=>{if(!e.defined(L)){const t=e.window.document.createElement("canvas");t.setAttribute("style","image-rendering: -moz-crisp-edges;image-rendering: pixelated;");const i=t.style.imageRendering;L=e.defined(i)&&""!==i,L&&(O=i);}return L},N=()=>{if(!N.initialized)throw new Error("You must call FeatureDetection.supportsWebP.initialize and wait for the promise to resolve before calling FeatureDetection.supportsWebP");return N._result};N._promise=void 0,N._result=void 0,N.initialize=()=>(e.defined(N._promise)||(N._promise=new Promise((t=>{const i=new e.window.Image;i.onload=()=>{N._result=i.width>0&&i.height>0,t(N._result);},i.onerror=()=>{N._result=!1,t(N._result);},i.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA";}))),N._promise),Object.defineProperties(N,{initialized:{get:()=>e.defined(N._result)}});const F=[];"undefined"!=typeof ArrayBuffer&&(F.push(Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array),"undefined"!=typeof Uint8ClampedArray&&F.push(Uint8ClampedArray),"undefined"!=typeof Uint8ClampedArray&&F.push(Uint8ClampedArray),"undefined"!=typeof BigInt64Array&&F.push(BigInt64Array),"undefined"!=typeof BigUint64Array&&F.push(BigUint64Array));const G={isChrome:p,chromeVersion:()=>p()&&m,isSafari:y,safariVersion:()=>y()&&g,isWebkit:x,webkitVersion:()=>x()&&T,isInternetExplorer:w,internetExplorerVersion:()=>w()&&v,isEdge:E,edgeVersion:()=>E()&&A,isFirefox:R,firefoxVersion:()=>R()&&P,isWindows:()=>(e.defined(B)||(B=/Windows/i.test(c.appVersion)),B),isIPadOrIOS:()=>(e.defined(I)||(I="iPhone"===e.window.navigator.platform||"iPod"===e.window.navigator.platform||"iPad"===e.window.navigator.platform),I),hardwareConcurrency:e.defaultValue(c.hardwareConcurrency,3),supportsPointerEvents:()=>(e.defined(D)||(D=!R()&&"undefined"!=typeof PointerEvent&&(!e.defined(c.pointerEnabled)||c.pointerEnabled)),D),supportsImageRenderingPixelated:V,supportsWebP:N,imageRenderingValue:()=>V()?O:void 0,typedArrayTypes:F,supportsBasis:e=>G.supportsWebAssembly()&&e.context.supportsBasis,supportsTypedArrays:()=>"undefined"!=typeof ArrayBuffer,supportsBigInt64Array:()=>"undefined"!=typeof BigInt64Array,supportsBigUint64Array:()=>"undefined"!=typeof BigUint64Array,supportsBigInt:()=>"undefined"!=typeof BigInt,supportsWebWorkers:()=>"undefined"!=typeof Worker,supportsWebAssembly:()=>"undefined"!=typeof WebAssembly,supportsWebgl2:e=>e.context.webgl2,supportsEsmWebWorkers:()=>!R()||parseInt(P)>=114};class k{get length(){return this._values.length}get values(){return this._values}constructor(){this._values=[],this._hash={};}contains(t){if("string"!=typeof t&&"number"!=typeof t)throw new Error("key is required to be a string or number.");return e.defined(this._hash[t])}set(e,t){if("string"!=typeof e&&"number"!=typeof e)throw new Error("key is required to be a string or number.");return t!==this._hash[e]&&(this.remove(e),this._hash[e]=t,this._values.push(t)),t}get(e){if("string"!=typeof e&&"number"!=typeof e)throw new Error("key is required to be a string or number.");return this._hash[e]}remove(t){if(e.defined(t)&&"string"!=typeof t&&"number"!=typeof t)throw new Error("key is required to be a string or number.");const i=this._hash[t];if(e.defined(i)){const e=this._values;e.splice(e.indexOf(i),1),delete this._hash[t];}return i}removeAll(){const e=this._values;e.length>0&&(this._hash={},e.length=0);}getAll(){return this._hash}}let U;U="undefined"!=typeof performance&&"function"==typeof performance.now&&isFinite(performance.now())?function(){return performance.now()}:function(){return Date.now()};var H=U;const z={create:function(t,i,s){const r=e.window.document.createElement(t);return void 0!==i&&(r.className=i),s&&s.appendChild(r),r},createNS:function(t,i){return e.window.document.createElementNS(t,i)}},W=e.window.document&&e.window.document.documentElement.style,j=W&&void 0!==W.userSelect?"userSelect":"WebkitUserSelect";let X;z.disableDrag=function(){W&&j&&(X=W[j],W[j]="none");},z.enableDrag=function(){W&&j&&(W[j]=X);},z.setTransform=function(e,t){e.style.transform=t;};const q=function(e){if(!W)return null;for(let t=0;t<e.length;t++)if(e[t]in W)return e[t];return e[0]}(["transformOrigin","WebkitTransformOrigin"]);z.setTransformOrigin=function(e,t){e.style[q]=t;},z.getAllStyle=function(t){return e.window.getComputedStyle(t)};let K=!1;try{const t=Object.defineProperty({},"passive",{get(){K=!0;}});e.window.addEventListener("test",t,t),e.window.removeEventListener("test",t,t);}catch(e){K=!1;}z.addEventListener=function(e,t,i,s={}){e.addEventListener(t,i,"passive"in s&&K?s:s.capture);},z.removeEventListener=function(e,t,i,s={}){e.removeEventListener(t,i,"passive"in s&&K?s:s.capture);};const J=function(t){t.preventDefault(),t.stopPropagation(),e.window.removeEventListener("click",J,!0);};function Z(t,i,s){const r=t.offsetWidth===i.width?1:t.offsetWidth/i.width;return new e.pointGeometry3d((s.clientX-i.left)*r,(s.clientY-i.top)*r)}z.suppressClick=function(){e.window.addEventListener("click",J,!0),e.window.setTimeout((()=>{e.window.removeEventListener("click",J,!0);}),0);},z.mousePos=function(e,t){const i=e.getBoundingClientRect();return Z(e,i,t=t.touches?t.touches[0]:t)},z.touchPos=function(e,t){const i=e.getBoundingClientRect(),s=[];for(let r=0;r<t.length;r++)s.push(Z(e,i,t[r]));return s},z.mouseButton=function(t){return void 0!==e.window.InstallTrigger&&2===t.button&&t.ctrlKey&&e.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button},z.remove=function(e){e.parentNode&&e.parentNode.removeChild(e);};class Y extends e.Event{preventDefault(){this._defaultPrevented=!0;}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,s,r={}){const n=z.mousePos(i.getCanvasContainer(),s),o=i.unproject(n);super(t,e.extend({point:n,lngLat:o,originalEvent:s},r)),this._defaultPrevented=!1,this.target=i;}}class Q extends e.Event{preventDefault(){this._defaultPrevented=!0;}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,s){const r="touchend"===t?s.changedTouches:s.touches,n=z.touchPos(i.getCanvasContainer(),r),o=n.map((e=>i.unproject(e))),a=n.reduce(((e,t,i,s)=>e.add(t.div(s.length))),new e.pointGeometry3d(0,0));super(t,{points:n,point:a,lngLats:o,lngLat:i.unproject(a),originalEvent:s}),this._defaultPrevented=!1;}}var $=Object.freeze({SHIFT:0,CTRL:1,ALT:2}),ee=Object.freeze({LEFT_DOWN:0,LEFT_UP:1,LEFT_CLICK:2,LEFT_DOUBLE_CLICK:3,RIGHT_DOWN:5,RIGHT_UP:6,RIGHT_CLICK:7,MIDDLE_DOWN:10,MIDDLE_UP:11,MIDDLE_CLICK:12,MOUSE_MOVE:15,WHEEL_START:16,WHEEL:17,WHEEL_ZOOM:31,WHEEL_END:18,PINCH_START:19,PINCH_END:20,PINCH_MOVE:21,ROTATE_START:22,ROTATE:23,ROTATE_END:24,PITCH_START:25,PITCH:26,PITCH_END:27,MOVE_START:28,MOVE:29,MOVE_END:30});const te=e.window.document,ie=e=>{let t;switch(e){case 0:case 5:case 10:t="mousedown";break;case 1:case 6:case 11:t="mouseup";break;case 2:case 12:t="click";break;case 7:t="contextmenu";break;case 3:t="dblclick";break;case 15:t="mousemove";break;case 17:t="wheel";break;case 19:t="touchstart";break;case 20:t="touchend";break;case 21:t="touchmove";}return t},se=e=>{const t=[];switch(e){case"mousedown":t.push(ee.LEFT_DOWN),t.push(ee.RIGHT_DOWN),t.push(ee.MIDDLE_DOWN);break;case"mouseup":t.push(ee.LEFT_UP),t.push(ee.MIDDLE_UP),t.push(ee.RIGHT_UP);break;case"mousemove":t.push(ee.MOUSE_MOVE);break;case"movestart":t.push(ee.MOVE_START);break;case"move":t.push(ee.MOVE);break;case"moveend":t.push(ee.MOVE_END);break;case"click":t.push(ee.LEFT_CLICK),t.push(ee.MIDDLE_CLICK);break;case"dblclick":t.push(ee.LEFT_DOUBLE_CLICK);break;case"contextmenu":t.push(ee.RIGHT_CLICK);break;case"wheel":t.push(ee.WHEEL);break;case"zoomstart":t.push(ee.WHEEL_START);break;case"zoom":t.push(ee.WHEEL_ZOOM);break;case"zoomend":t.push(ee.WHEEL_END);break;case"rotatestart":t.push(ee.ROTATE_START);break;case"rotate":t.push(ee.ROTATE);break;case"rotateend":t.push(ee.ROTATE_END);break;case"pitchstart":t.push(ee.PITCH_START);break;case"pitch":t.push(ee.PITCH);break;case"pitchend":t.push(ee.PITCH_END);break;case"touchstart":t.push(ee.PINCH_START);break;case"touchmove":t.push(ee.PINCH_MOVE);break;case"touchend":t.push(ee.PINCH_END);}return t},re=(e,t,i)=>{const s=e._element;if(s===te)return i.x=t.clientX,i.y=t.clientY,i;const r=s.getBoundingClientRect();return i.x=t.clientX-r.left,i.y=t.clientY-r.top,i},ne=(t,i)=>{let s=t;return e.defined(i)&&(s+=`+${i}`),s};function oe(e){return e.shiftKey?$.SHIFT:e.ctrlKey?$.CTRL:e.altKey?$.ALT:void 0}const ae=(e,t,i,s)=>{function r(t){e._elementEvent=t,s(e,t);}G.isInternetExplorer()?i.addEventListener(t,r,!1):i.addEventListener(t,r,{passive:!1}),e._removalFunctions.push((()=>{i.removeEventListener(t,r,!1);}));},le={position:new e.Vector2},he=e=>{e._lastSeenTouchEvent=H();},_e=e=>H()-e._lastSeenTouchEvent>Fe.mouseEmulationIgnoreMilliseconds;function ce(e,t,i){const s=e.x-t.x,r=e.y-t.y;return Math.sqrt(s*s+r*r)<i}const ue=(t,i)=>{if(!_e(t))return;const s=i.button;let r;if(t._buttonDown[s]=!0,0===s)r=ee.LEFT_DOWN;else if(1===s)r=ee.MIDDLE_DOWN;else {if(2!==s)return;r=ee.RIGHT_DOWN;}const n=re(t,i,t._primaryPosition);e.Vector2.clone(n,t._primaryStartPosition),e.Vector2.clone(n,t._primaryPreviousPosition);const o=oe(i);t._outputMouseEvents||t._map.boxZoom.mousedown(i,new e.pointGeometry3d(n.x,n.y));const a=t.getInputAction(r,o),l=t.getOnceInputAction(r,o);if(e.defined(a)){if(e.Vector2.clone(n,le.position),t._outputMouseEvents){const e=new Y(ie(r),t._map,i);for(let t=0;t<a.length;t++)a[t](e);}else for(let e=0;e<a.length;e++)a[e](le);i.preventDefault();}e.defined(l)&&(pe(t,l,i,n.clone(),r),t.removeOnceInputAction(r));},de={position:new e.Vector2},me={position:new e.Vector2},pe=(e,t,i,s,r)=>{if(e._outputMouseEvents){const s=new Y(ie(r),e._map,i);for(let e=0;e<t.length;e++)t[e](s);}},fe=(t,i,s,r)=>{const n=oe(r),o=t.getInputAction(i,n);if(e.defined(o)){const s=re(t,r,t._primaryPosition);if(e.defined(o))if(e.Vector2.clone(s,de.position),t._outputMouseEvents){const e=new Y(ie(i),t._map,r);for(let t=0;t<o.length;t++)o[t](e);}else for(let e=0;e<o.length;e++)o[e](me);}const a=t.getInputAction(s,n);if(e.defined(a)){const i=re(t,r,t._primaryPosition);if(e.defined(a)&&ce(t._primaryStartPosition,i,t._clickPixelTolerance))if(e.Vector2.clone(i,me.position),t._outputMouseEvents){const e=ie(s);if("click"!==e){const i=new Y(e,t._map,r);for(let e=0;e<a.length;e++)a[e](i);}}else for(let e=0;e<a.length;e++)a[e](me);}const l=t.getOnceInputAction(i,n);if(e.defined(l)){const e=re(t,r,t._primaryPosition);pe(t,l,r,e.clone(),i),t.removeOnceInputAction(i);}const h=t.getOnceInputAction(s,n);if(e.defined(h)){const e=re(t,r,t._primaryPosition);pe(t,h,r,e.clone(),s),t.removeOnceInputAction(s);}},ge=(e,t)=>{if(!_e(e))return;const i=t.button;0!==i&&1!==i&&2!==i||(e._outputMouseEvents||e._map.boxZoom.mouseupWindow(t),e._buttonDown[0]&&(fe(e,ee.LEFT_UP,ee.LEFT_CLICK,t),e._buttonDown[0]=!1),e._buttonDown[1]&&(fe(e,ee.MIDDLE_UP,ee.MIDDLE_CLICK,t),e._buttonDown[1]=!1),e._buttonDown[2]&&(fe(e,ee.RIGHT_UP,ee.RIGHT_CLICK,t),e._buttonDown[2]=!1));},ye={startPosition:new e.Vector2,endPosition:new e.Vector2},Ce=(t,i)=>{if(!_e(t))return;const s=oe(i),r=re(t,i,t._primaryPosition),n=t._primaryPreviousPosition;t._outputMouseEvents||t._map.boxZoom.mousemoveWindow(i,new e.pointGeometry3d(r.x,r.y));const o=t.getInputAction(ee.MOUSE_MOVE,s),a=t.getOnceInputAction(ee.MOUSE_MOVE,s);if(e.defined(o)||e.defined(a)){if(e.Vector2.clone(n,ye.startPosition),e.Vector2.clone(r,ye.endPosition),t._outputMouseEvents){const e=new Y(ie(ee.MOUSE_MOVE),t._map,i);for(let t=0;t<o.length;t++)o[t](e);}else for(let e=0;e<o.length;e++)o[e](ye);e.defined(a)&&(pe(t,a,i,r.clone(),ee.MOUSE_MOVE),t.removeOnceInputAction(ee.MOUSE_MOVE));}e.Vector2.clone(r,n),(t._buttonDown[0]||t._buttonDown[1]||t._buttonDown[2])&&i.preventDefault();},Te=(t,i)=>{let s;if(0!==i.button)return;s=ee.LEFT_CLICK;const r=oe(i),n=t.getInputAction(s,r),o=t.getOnceInputAction(s,r);if(e.defined(n)||o){if(re(t,i,me.position),t._outputMouseEvents){const e=new Y(ie(s),t._map,i);for(let t=0;t<n.length;t++)n[t](e);}e.defined(o)&&(pe(t,o,i,me.position.clone(),s),t.removeOnceInputAction(s));}},xe={position:new e.Vector2},be=(t,i)=>{let s;if(0!==i.button)return;s=ee.LEFT_DOUBLE_CLICK;const r=oe(i),n=t.getInputAction(s,r),o=t.getOnceInputAction(s,r);if(e.defined(n)||o){if(re(t,i,xe.position),t._outputMouseEvents){const e=new Y(ie(s),t._map,i);for(let t=0;t<n.length;t++)n[t](e);}else for(let e=0;e<n.length;e++)n[e](xe);e.defined(o)&&(pe(t,o,i,xe.position.clone(),s),t.removeOnceInputAction(s));}},ve=(t,i)=>{let s;if(e.defined(i.deltaY)){const e=i.deltaMode;s=e===i.DOM_DELTA_PIXEL?-i.deltaY:e===i.DOM_DELTA_LINE?40*-i.deltaY:120*-i.deltaY;}else s=i.detail>0?-120*i.detail:i.wheelDelta;if(!e.defined(s))return;re(t,i,t._primaryPosition),t._isRollerWheel=!0;const r=t.getInputAction(ee.WHEEL,void 0);if(e.defined(r)){if(t._outputMouseEvents){const e=new Y(ie(ee.WHEEL),t._map,i);for(let t=0;t<r.length;t++)r[t](e);}else for(let e=0;e<r.length;e++)r[e](s);i.preventDefault();}},we=(e,t)=>{e._map.keyboard.keydown(t);},Se=(t,i)=>{he(t);const s=i.changedTouches;let r;const n=s.length;let o,a;const l=t._positions;for(r=0;r<n;++r)o=s[r],a=o.identifier,l.set(a,re(t,o,new e.Vector2));De(t,i);const h=t._previousPositions;for(r=0;r<n;++r)o=s[r],a=o.identifier,h.set(a,e.Vector2.clone(l.get(a)));},Ae=(e,t)=>{he(e);const i=t.changedTouches;let s;const r=i.length;let n,o;const a=e._positions;for(s=0;s<r;++s)n=i[s],o=n.identifier,a.remove(o);De(e,t);const l=e._previousPositions;for(s=0;s<r;++s)n=i[s],o=n.identifier,l.remove(o);},Ee={position:new e.Vector2},Me={position1:new e.Vector2,position2:new e.Vector2},Pe={position:new e.Vector2},Re={position:new e.Vector2},Be={position:new e.Vector2};let Ie=0;const De=(t,i)=>{const s=oe(i),r=t._positions,n=r.length;let o,a,l,h;const _=t._isPinching;if(t._outputMouseEvents){const r=se(i.type);for(let n=0;n<r.length;n++){const o=t.getInputAction(r[n],s),a=t.getOnceInputAction(r[n],s);if(e.defined(o))for(let e=0;e<o.length;e++)o[e](new Q(i.type,t._map,i));if(e.defined(a))for(let e=0;e<a.length;e++)a[e](new Q(i.type,t._map,i));}}if(1!==n&&t._buttonDown[0]){if(t._buttonDown[0]=!1,e.defined(t._touchHoldTimer)&&(clearTimeout(t._touchHoldTimer),t._touchHoldTimer=void 0),o=t.getInputAction(ee.LEFT_UP,s),a=t.getOnceInputAction(ee.LEFT_UP,s),e.defined(o)&&(e.Vector2.clone(t._primaryPosition,Pe.position),!t._outputMouseEvents))for(let e=0;e<o.length;e++)o[e](Pe);if(e.defined(a)&&(t._outputMouseEvents||(pe(t,a,i,Pe.position.clone(),ee.LEFT_UP),t.removeOnceInputAction(ee.LEFT_UP))),0===n&&!t._isTouchHolding){if(l=t.getInputAction(ee.LEFT_CLICK,s),h=t.getOnceInputAction(ee.LEFT_CLICK,s),e.defined(l)&&ce(t._primaryStartPosition,t._previousPositions.values[0],t._clickPixelTolerance))if(e.Vector2.clone(t._primaryPosition,Re.position),t._outputMouseEvents){const e=new Q(i.type,t._map,i);for(let t=0;t<l.length;t++)l[t](e);}else for(let e=0;e<l.length;e++)l[e](Re);if(e.defined(h))if(t._outputMouseEvents){const e=new Q(i.type,t._map,i);for(let t=0;t<h.length;t++)h[t](e);t.removeOnceInputAction(ee.LEFT_CLICK);}else pe(t,h,i,Pe.position.clone(),ee.LEFT_CLICK),t.removeOnceInputAction(ee.LEFT_CLICK);}t._isTouchHolding=!1;}if(0===n&&_){if(t._isPinching=!1,o=t.getInputAction(ee.PINCH_END,s),a=t.getOnceInputAction(ee.PINCH_END,s),e.defined(o)&&!t._outputMouseEvents)for(let e=0;e<o.length;e++)o[e]();e.defined(a)&&!t._outputMouseEvents&&(pe(t,a,i,Pe.position.clone(),ee.PINCH_END),t.removeOnceInputAction(ee.PINCH_END));}if(1===n&&!_){const n=r.values[0];let _;if(e.Vector2.clone(n,t._primaryPosition),e.Vector2.clone(n,t._primaryStartPosition),e.Vector2.clone(n,t._primaryPreviousPosition),t._buttonDown[0]=!0,_=i.timeStamp-Ie<300?ee.LEFT_DOUBLE_CLICK:ee.LEFT_DOWN,o=t.getInputAction(_,s),e.defined(o)&&(e.Vector2.clone(n,Ee.position),!t._outputMouseEvents))for(let e=0;e<o.length;e++)o[e](Ee);a=t.getOnceInputAction(_,s),e.defined(a)&&e.defined(a)&&!t._outputMouseEvents&&(pe(t,a,i,Pe.position.clone(),_),t.removeOnceInputAction(_)),Ie=i.timeStamp,t._touchHoldTimer=setTimeout((()=>{if(!t.isDestroyed()){if(t._touchHoldTimer=void 0,t._isTouchHolding=!0,l=t.getInputAction(ee.RIGHT_CLICK,s),h=t.getOnceInputAction(ee.RIGHT_CLICK,s),e.defined(l)&&!t._outputMouseEvents&&ce(t._primaryStartPosition,t._previousPositions.values[0],t._holdPixelTolerance)){e.Vector2.clone(t._primaryPosition,Be.position);for(let e=0;e<l.length;e++)l[e](Be);}e.defined(h)&&!t._outputMouseEvents&&e.defined(h)&&(pe(t,h,i,Pe.position.clone(),ee.RIGHT_CLICK),t.removeOnceInputAction(ee.RIGHT_CLICK));}}),Fe.touchHoldDelayMilliseconds),i.preventDefault();}if(2===n&&!_){if(t._isPinching=!0,o=t.getInputAction(ee.PINCH_START,s),a=t.getOnceInputAction(ee.PINCH_START,s),e.defined(o)&&!t._outputMouseEvents){e.Vector2.clone(r.values[0],Me.position1),e.Vector2.clone(r.values[1],Me.position2);for(let e=0;e<o.length;e++)o[e](Me);i.preventDefault();}e.defined(a)&&!t._outputMouseEvents&&e.defined(a)&&(pe(t,a,i,Pe.position.clone(),ee.PINCH_START),t.removeOnceInputAction(ee.PINCH_START),i.preventDefault());}},Oe=(t,i)=>{he(t);const s=i.changedTouches;let r;const n=s.length;let o,a;const l=t._positions;for(r=0;r<n;++r){o=s[r],a=o.identifier;const i=l.get(a);e.defined(i)&&re(t,o,i);}Ne(t,i);const h=t._previousPositions;for(r=0;r<n;++r)o=s[r],a=o.identifier,e.defined(l.get(a))&&e.Vector2.clone(l.get(a),h.get(a));},Le={startPosition:new e.Vector2,endPosition:new e.Vector2},Ve={distance:{startPosition:new e.Vector2,endPosition:new e.Vector2},angleAndHeight:{startPosition:new e.Vector2,endPosition:new e.Vector2}},Ne=(t,i)=>{const s=oe(i),r=t._positions,n=t._previousPositions,o=r.length;let a,l;if(t._outputMouseEvents){const r=se(i.type);for(let n=0;n<r.length;n++){const o=t.getInputAction(r[n],s),a=t.getOnceInputAction(r[n],s);if(e.defined(o))for(let e=0;e<o.length;e++)o[e](new Q(i.type,t._map,i));if(e.defined(a))for(let e=0;e<a.length;e++)a[e](new Q(i.type,t._map,i));}}if(1===o&&t._buttonDown[0]){const n=r.values[0];e.Vector2.clone(n,t._primaryPosition);const o=t._primaryPreviousPosition;if(a=t.getInputAction(ee.MOUSE_MOVE,s),l=t.getOnceInputAction(ee.MOUSE_MOVE,s),e.defined(a)&&!t._outputMouseEvents){e.Vector2.clone(o,Le.startPosition),e.Vector2.clone(n,Le.endPosition);for(let e=0;e<a.length;e++)a[e](Le);}e.defined(l)&&!t._outputMouseEvents&&e.defined(l)&&(pe(t,l,i,Pe.startPosition.clone(),ee.MOUSE_MOVE),t.removeOnceInputAction(ee.MOUSE_MOVE)),e.Vector2.clone(n,o),i.preventDefault();}else if(2===o&&t._isPinching){if(a=t.getInputAction(ee.PINCH_MOVE,s),l=t.getOnceInputAction(ee.PINCH_MOVE,s),e.defined(a)&&!t._outputMouseEvents){const t=r.values[0],i=r.values[1],s=n.values[0],o=n.values[1],l=i.x-t.x,h=i.y-t.y,_=.25*Math.sqrt(l*l+h*h),c=o.x-s.x,u=o.y-s.y,d=.25*Math.sqrt(c*c+u*u),m=.125*(i.y+t.y),p=.125*(o.y+s.y),f=Math.atan2(h,l),g=Math.atan2(u,c);e.Vector2.fromElements(0,d,Ve.distance.startPosition),e.Vector2.fromElements(0,_,Ve.distance.endPosition),e.Vector2.fromElements(g,p,Ve.angleAndHeight.startPosition),e.Vector2.fromElements(f,m,Ve.angleAndHeight.endPosition);for(let e=0;e<a.length;e++)a[e](Ve);}e.defined(l)&&!t._outputMouseEvents&&e.defined(l)&&(pe(t,l,i,Pe.startPosition.clone(),ee.PINCH_MOVE),t.removeOnceInputAction(ee.PINCH_MOVE));}};class Fe{constructor(t,i,s){this._inputEvents={},this._inputOnceEvents={},this._buttonDown={LEFT:!1,MIDDLE:!1,RIGHT:!1},this._isPinching=!1,this._isTouchHolding=!1,this._isRollerWheel=!1,this._lastSeenTouchEvent=-Fe.mouseEmulationIgnoreMilliseconds,this._primaryStartPosition=new e.Vector2,this._primaryPosition=new e.Vector2,this._primaryPreviousPosition=new e.Vector2,this._positions=new k,this._previousPositions=new k,this._removalFunctions=[],this._touchHoldTimer=void 0,this._clickPixelTolerance=5,this._holdPixelTolerance=25,this._element=e.defaultValue(t,te),this._elementEvent=void 0,this._map=i,this._outputMouseEvents=e.defaultValue(s,!1),(t=>{const i=t._element,s=e.defined(i.disableRootEvents)?i:te;let r;ae(t,"mousedown",i,ue),ae(t,"mouseup",s,ge),ae(t,"mousemove",s,Ce),ae(t,"touchstart",i,Se),ae(t,"touchend",s,Ae),ae(t,"touchmove",s,Oe),ae(t,"touchcancel",s,Ae),ae(t,"dblclick",i,be),ae(t,"click",i,Te),r="onwheel"in i?"wheel":void 0!==te.onmousewheel?"mousewheel":"DOMMouseScroll",ae(t,r,i,ve),ae(t,"keydown",te,we);})(this);}setInputAction(t,i,s){if(!e.defined(t))throw new Error("action is required.");if(!e.defined(i))throw new Error("type is required.");const r=ne(i,s);e.defined(this._inputEvents[r])||(this._inputEvents[r]=[]),this._inputEvents[r].push(t);}getInputAction(t,i){if(!e.defined(t))throw new Error("type is required.");const s=ne(t,i);return this._inputEvents[s]}removeInputAction(t,i,s){if(!e.defined(t))throw new Error("type is required.");const r=ne(t,i);if(!e.defined(this._inputEvents[r]))return;const n=this._inputEvents[r].indexOf(s);-1!==n&&this._inputEvents[r].splice(n,1),0===this._inputEvents[r].length&&delete this._inputEvents[r];}setOnceInputAction(t,i){if(!e.defined(i))throw new Error("action is required.");if(!e.defined(t))throw new Error("type is required.");const s=ne(t,void 0);e.defined(this._inputOnceEvents[s])||(this._inputOnceEvents[s]=[]),this._inputOnceEvents[s].push(i);}getOnceInputAction(t,i){if(!e.defined(t))throw new Error("type is required.");const s=ne(t,i);return this._inputOnceEvents[s]}removeOnceInputAction(t){if(!e.defined(t))throw new Error("type is required.");delete this._inputOnceEvents[t];}static addEventListeners(e,t,i,s){const r=se(e),n=[];if(t instanceof Function&&r.length>0)for(let e=0;e<r.length;e++)n.push(s?i._screenSpaceEventHandler.setOnceInputAction(r[e],t):i._screenSpaceEventHandler.setInputAction(t,r[e]));return n}static removeEventListeners(e,t,i){const s=se(e);let r=!1;if(t instanceof Function&&s.length>0)for(let e=0;e<s.length;e++)i._screenSpaceEventHandler.removeInputAction(s[e],void 0,t),i._screenSpaceEventHandler.removeOnceInputAction(s[e],void 0,t),r=!0;return r}static executeEvent(t,i){const s=t._screenSpaceEventHandler,r=se(i);let n=[],o=[];for(let t=0;t<r.length;t++){const i=s.getInputAction(r[t]),a=s.getOnceInputAction(r[t]);e.defined(i)&&(n=n.concat(i)),e.defined(a)&&(o=o.concat(a));}if(e.defined(n))for(let e=0;e<n.length;e++)n[e]({originalEvent:s._elementEvent,target:t,type:i});if(e.defined(o)){for(let e=0;e<o.length;e++)o[e]({originalEvent:s._elementEvent,target:t,type:i});for(let e=0;e<r.length;e++)s.removeOnceInputAction(r[e]);}}isDestroyed(){return !1}destroy(){return (e=>{const t=this._removalFunctions;for(let e=0;e<t.length;++e)t[e]();})(),this._inputOnceEvents={},e.destroyObject(this)}static mouseEmulationIgnoreMilliseconds=800;static touchHoldDelayMilliseconds=1500}class Ge{constructor(t,i){this._blender=t,this._clip=i,this.id=e.uniqueId(),this.loop=e.defaultValue(this._clip._loop,h.LOOP_REPEAT),this._loopCount=0,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.paused=!1,this.enabled=!1,this.timeCounter=0,this.deltaTime=0,this.sumTime=0;}play(){return this.enabled=!0,this._blender._activateAction(this),this}stop(){return this.enabled=!1,this._blender._deactivateAction(this),this.reset()}reset(){this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null;}update(t,i){if(("3d-model"===this._blender._root.type||"3d-model-instance"===this._blender._root.type||"Object3D"===this._blender._root.type)&&this._blender.trackingOptions)switch(this._blender.trackingOptions.trackingEffect){case _.STABLE:this.stableUpdate(t,i);break;case _.MEDIUM:this.mediumUpdate(t,i);break;default:this.preciseUpdate(t,i);}this._updateTime(i,this._blender.speed),e.defined(this._blender)&&(this._blender._root.animationPropertyCollection.get(`${this._clip.id}-${this.id}`).currentClipTime=this.time);}stableUpdate(e,t){return this.timeCounter<5?(this.deltaTime=t,this.timeCounter+=1,this.sumTime+=t):(this.deltaTime=this.sumTime/5,t=this.deltaTime),t}mediumUpdate(e,t){return ke(function(e,t,i){const s=[e-.0334,e-t,e,e+t,e+.0334],r=.5*ke(s),n=[];for(const e in s){const t=s[e],i=Number(ke([r,n[e-1]||s[s.length-1],t,t||s[0]]).toFixed(2));n.push(i);}return n}(t,.0167))}preciseUpdate(e,t){return t}_updateTime(t,i=1){const s=this._clip.duration;if(this.time=this.time+t*i,this.time>=s)switch(this.loop){case h.LOOP_REPEAT:{const e=Math.floor(this.time/s);this.time%=s,this._loopCount+=Math.abs(e);}break;case h.LOOP_ONCE:this._blender?.trackingOptions&&this._blender?._root?._map&&Fe.executeEvent(this._blender._root._map,"moveend"),this._blender.stop(this._blender.autoStop);break;case h.LOOP_NONE:this._blender.stop(this._blender.autoStop);break;default:throw new e.DeveloperError(`Invalid animation loop mode: ${this.loop}`)}return this.time}setLoop(e){return this.loop=e,this}destroy(){for(const e in this)Object.hasOwnProperty.call(this,e)&&(this[e]=null);}}function ke(e){return e.reduce(((e,t)=>e+t),0)/e.length}class Ue{id=e.uniqueId();constructor(t=0,i,s,r,n){this.id=e.uniqueId(),this._duration=t,this._startTime=r,this._endTime=n,this._duration<0&&(this._duration=0),this.tracks=i,"geojson"===i?.type&&(this.tracks=i._data),this._loop=e.defaultValue(s,h.LOOP_REPEAT),this._dirty=!1;}get duration(){return this._duration}set duration(e){this._duration=e&&"number"==typeof e&&e>0?e:0;}get startTime(){return this._startTime}set startTime(e){this._startTime=e&&"number"==typeof e&&e>0?e:0;}get endTime(){return this._endTime}set endTime(e){this._endTime=e&&"number"==typeof e&&e>0?e:0;}get loop(){return this._loop}set loop(e){e&&(this._loop=e);}get dirty(){return this._dirty}set dirty(e){"boolean"==typeof e&&(this._dirty=e);}destroy(){e.defined(this.tracks)&&this.tracks.length>0&&this.tracks.forEach((e=>{e.destroy();}));}updateTracks(e){Array.isArray(e)&&e.length>0&&(this.tracks=e,this.dirty=!0);}}const He={getLinearInterpolationPosition:(e,t,i)=>[(i[0]-t[0])*e+t[0],(i[1]-t[1])*e+t[1],(i[2]-t[2])*e+t[2]],leftBinarySearch(e,t,i,s){const r=Math.floor((i+s)/2),n=e[r];return i>s?r:n>t?He.leftBinarySearch(e,t,i,r-1):n<t?He.leftBinarySearch(e,t,r+1,s):r},getWeightAndPoints(e,t,i){const s=He.leftBinarySearch(e,i,0,e.length-2),r=e[s];return {weight:Math.min((i-r)/(e[s+1]-r),1),pointCurrent:t[s],pointNext:t[s+1],currentIndex:s}},getRSModelMatrix(t,i,s){const r=new e.Vector3;e.Vector3.subtract(i,t,r),r.normalize();const n=e.Transforms.rotationMatrixFromPositionVelocity(t,r),o=(new e.Matrix4).setFromMatrix3(n),a=s.originalRotationScaleMatrix.clone();return o.multiplyRight(a),o},getRotation(t,i){const s=new e.Vector3;e.Vector3.subtract(i,t,s),s.normalize();const r=e.Transforms.rotationMatrixFromPositionVelocity(t,s),n=(new e.Matrix4).setFromMatrix3(r),o=e.Transforms.eastNorthUpToFixedFrame(t),a=e.Matrix4.inverse(o,new e.Matrix4),l=n.multiplyLeft(a),h=(new e.Quaternion).fromRotationMatrix4(l.getRotation());return e.HeadingPitchRoll.fromQuaternion(h)},getRotationMatrixFromEuler(t,i){const s=new e.Matrix4,r=i.split("-"),n={x:(e,t)=>{e.rotateX(t);},y:(e,t)=>{e.rotateY(t);},z:(e,t)=>{e.rotateZ(t);}};for(let e=0;e<r.length;e++)n[r[e]](s,t[e]);return s},getRotationFromEuler(t,i){const s=i.split("-");let r=0,n=0,o=0;const a={x:e=>{o=e;},y:e=>{n=-e;},z:e=>{r=-e;}};for(let e=0;e<s.length;e++)a[s[e]](t[e]);return new e.HeadingPitchRoll(r,n,o)},arraySubtract(e,t){if(!Array.isArray(e)||!Array.isArray(t))throw new Error("arr1 or arr2 type must be Array");if(e.length!==t.length)throw new Error(" the 'arr1' length must be the same as the 'arr2' length ");return e.map(((e,i)=>e-t[i]))}};function ze(e,t,i,s,{units:r="m",distancePrecision:n=0,formula:o="great-circle",bearingPrecision:a=0,directionPrecision:l=2}={}){if(isNaN(e)||isNaN(i)||isNaN(t)||isNaN(s)||isNaN(a)||isNaN(l))throw new Error("Latitude/Longitude parameter is not a number!");if(Math.abs(e)>90||Math.abs(i)>90||Math.abs(t)>180||Math.abs(s)>180)throw new Error("Latitude/Longitude parameter exceeding maximal value!");if(isNaN(n)||isNaN(a)||n>15||a>15)throw new Error("Precision parameter is not a number or exceeds it's maximum value of 15!");if(!["m","km","ft","yd","mi","nm"].includes(r))throw new Error("Units parameter type not supported!");if(!["great-circle","rhumb-line"].includes(o))throw new Error("Calculation formula type parameter not supported!");const h=6371009;function _(e){return e*(Math.PI/180)}Number.prototype.round=function(e=0){const t=Number(this.valueOf());return +`${Math.round(`${t}e+${e}`)}e-${e}`};const c={},u=function(e,t="m"){if("m"===t)return e;switch(t){case"km":return .001*e;case"ft":return 3.28084*e;case"yd":return 1.0936*e;case"mi":return 621371e-9*e;case"nm":return 539957e-9*e;default:return e}}("rhumb-line"===o?function(e,t,i,s){if(e===i&&t===s)return 0;const r=_(e),n=_(i),o=_(e-i);let a=_(t-s);const l=Math.log(Math.tan(Math.PI/4+n/2)/Math.tan(Math.PI/4+r/2)),c=Math.abs(l)>1e-11?o/l:Math.cos(r);return Math.abs(a)>Math.PI&&(a=a>0?-(2*Math.PI-a):2*Math.PI+a),Math.sqrt(o*o+c*c*a*a)*h}(e,t,i,s):function(e,t,i,s){if(e===i&&t===s)return 0;const r=_(e),n=_(i),o=_(e-i),a=_(t-s),l=Math.sin(o/2)*Math.sin(o/2)+Math.cos(r)*Math.cos(n)*Math.sin(a/2)*Math.sin(a/2),c=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l));return h*c}(e,t,i,s),r).round(n);c.distance=u,c.units=r;const d=function(e,t,i,s){const r=_(e),n=_(i),o=_(s-t),a=Math.sin(o)*Math.cos(n),l=Math.cos(r)*Math.sin(n)-Math.sin(r)*Math.cos(n)*Math.cos(o);return (Math.atan2(a,l)*(180/Math.PI)+360)%360}(e,t,i,s);return c.bearing=d,c.formula=o,0!==l&&(c.direction=0==u?"":function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Parameter is not a number!");if(e<0||e>360)throw new Error("Parameter outside of range!");if(t<1||t>3)throw new Error("Parameter outside of range!");const i=["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"];let s=4;2===t&&(s=8),3===t&&(s=16);const r=i.length/s;let n=Math.round(e/(360/s))*r;return (()=>i.length)&&(n=0),i[n]}(d,l)),c}const We={NONE:0,FREE:1,FOLLOW:2,LOCK:3};function je(e,t){return e.children&&e.children.length>0?e.children.forEach((e=>{if(e.children&&e.children.length>0)return je(e,t);t.push(e);})):t.push(e),t}class Xe{get enabled(){return this._enabled}set enabled(e){this._enabled=e;}get currentClipTime(){return this._currentClipTime}set currentClipTime(e){this._currentClipTime=e;}constructor(e){this.id=`${e._clip.id}-${e.id}`,this.animationClip=e._clip,this.animationAction=e,this._enabled=e.enabled,this._currentClipTime=0,this._lastInstancePosition=void 0;}destroy(){this._enabled=null,this._currentClipTime=null,this.animationClip.destroy(),e.defined(this.animationAction._blender._root.animationsInfo)&&(this.animationAction._blender._root.animationsInfo.enabled=!1);}updateAnimation(e,t){this.animationAction.enabled&&("3d-model"!==e.type&&"3d-model-instance"!==e.type||this.updateModelAnimation(e),"geojson"===e.type&&this.updateGeojsonAnimation(e),e._isPrimitive&&this.updatePrimitiveAnimation(e,t));}updateModelAnimation(t){if(!this.enabled)return;const i=this.animationClip.tracks,s=this.animationClip.dirty,r=this.currentClipTime,n=this.animationAction._blender,o=n.trackingOptions,a=n.onPlaying||n.callback;for(const n of i){if("positionKeyframeTrack"===n.type){const i=n.values,s=n.times,{weight:l,pointCurrent:h,pointNext:_}=He.getWeightAndPoints(s,i,r),c=[t.matrixWorld[12],t.matrixWorld[13],t.matrixWorld[14]],u=He.getLinearInterpolationPosition(l,h,_);t.position=u,t.updateMatrixWorld(!0),o&&this.trackingAnimation(t,u,c),a&&a({time:r,modelId:t.id,currentPosition:e.Transforms.cartesian3ToCartographic(u),totalMileage:this.animationAction._blender.trackCalculation.trackLength});}if("multiPositionKeyframeTrack"===n.type){const i=n.values,l=n.times,h=n.eulers||[],_=n.translations||[],c=n.colors||[],u=n.primitiveNames||[],d=n.trackIds||void 0;if("ready"===t._setInstancePropertiesState&&(!t.modelInstanceCollection||s)){this.animationClip.dirty=!1;const s=i.map((e=>e[0])),r=h.map((e=>He.getRotationFromEuler(e[0],n.rotateOrder)));t.type="3d-model-instance",t.modelInstanceCollection=new e.ModelInstanceCollection({instances:e.ModelInstanceCollection.generateInstanceModelMatrix({positions:s,rotations:r,instanceNames:d,cartesian:!0}),type:t.type,rootId:t.id}),t.setInstanceProperties(),t.matrixAutoUpdate=!1,t.setMatrix(t.originalRotationScaleMatrix),t.updateMatrixWorld(!0);}if(!t.modelInstanceCollection)return;for(let s=0;s<l.length;s++){const d=l[s],m=i[s],p=h[s]||[],f=_[s]||[],g=c[s]||[],y=u[s]||[],C=t.modelInstanceCollection._instances.get(s);if(d[0]>r){C.show=!1;continue}if(d.length<2||m.length<2){C.show=!1;continue}C.show=!0;const{weight:T,pointCurrent:x,pointNext:b,currentIndex:v}=He.getWeightAndPoints(d,m,r),w=[C._modelMatrix[12],C._modelMatrix[13],C._modelMatrix[14]];let S=He.getLinearInterpolationPosition(T,x,b);const A=e.Transforms.eastNorthUpToFixedFrame(S);if(f.length>0){const t=He.getLinearInterpolationPosition(T,f[v],f[v+1]);A.translate(e.Vector3.unpack(t)),S=[A[12],A[13],A[14]];}if(C.position=e.Vector3.unpack(S),p.length>0){const e=n.rotateOrder,t=He.getLinearInterpolationPosition(T,p[v],p[v+1]),i=He.getRotationFromEuler(t,e);C.rotation=i;}if(g.length>0&&y.length>0){const e=je(t,[]);for(let t=0;t<e.length;t++)e[t].parent&&e[t].parent.mesh&&e[t].parent.mesh.name===y[v]&&(e[t].color=g[v]);}o&&(C._map=t._map,this.trackingAnimation(C,S,w)),a&&a({time:r,modelId:C.instanceName,currentPosition:e.Transforms.cartesian3ToCartographic(S),totalMileage:this.animationAction._blender.trackCalculation.trackLength});}}if("trackingKeyframeTrack"===n.type){const i=n.values,s=n.times,{weight:l,pointCurrent:h,pointNext:_}=He.getWeightAndPoints(s,i,r);if(!e.Vector3.equals(h,_)){const e=He.getRSModelMatrix(h,_,t);t.setMatrix(e);}const c=[t.matrixWorld[12],t.matrixWorld[13],t.matrixWorld[14]],u=He.getLinearInterpolationPosition(l,h,_);t.position=e.Vector3.unpack(u),t.updateMatrixWorld(!0),o&&this.trackingAnimation(t,u,c),a&&a({time:r,modelId:t.id,currentPosition:e.Transforms.cartesian3ToCartographic(u),totalMileage:this.animationAction._blender.trackCalculation.trackLength});}if("multiTrackingKeyframeTrack"===n.type){const i=n.values,l=n.times,h=n.trackIds||void 0;if("ready"===t._setInstancePropertiesState&&(!t.modelInstanceCollection||s)){this.animationClip.dirty=!1;const s=i.map((e=>e[0]));t.type="3d-model-instance",t.modelInstanceCollection=new e.ModelInstanceCollection({instances:e.ModelInstanceCollection.generateInstanceModelMatrix({positions:s,instanceNames:h,cartesian:!0}),type:t.type,rootId:t.id}),t.setInstanceProperties(),t.matrixAutoUpdate=!1,t.setMatrix(t.originalRotationScaleMatrix),t.updateMatrixWorld(!0);}if(!t.modelInstanceCollection)return;for(let s=0;s<l.length;s++){const n=l[s],h=i[s],_=t.modelInstanceCollection._instances.get(s);if(n[0]>r){_.show=!1;continue}if(n.length<2||h.length<2){_.show=!1;continue}_.show=!0;const{weight:c,pointCurrent:u,pointNext:d}=He.getWeightAndPoints(n,h,r),m=[_._modelMatrix[12],_._modelMatrix[13],_._modelMatrix[14]],p=He.getLinearInterpolationPosition(c,u,d);e.Vector3.equals(u,d)||(_.rotation=He.getRotation(u,d,t)),_.position=e.Vector3.unpack(p),o&&(_._map=t._map,this.trackingAnimation(_,p,m)),a&&a({time:r,modelId:_.instanceName,currentPosition:e.Transforms.cartesian3ToCartographic(p),totalMileage:this.animationAction._blender.trackCalculation.trackLength});}}}}updateGeojsonAnimation(e){e.animationsInfo=e.animationsInfo||{},e.animationsInfo.currentClipTime=this.currentClipTime,e.animationsInfo.enabled=this.enabled||!1;}updatePrimitiveAnimation(t,i){if(!this.enabled)return;const s=this.animationClip.tracks,r=this.animationClip.dirty,n=this.currentClipTime;for(const o of s){if("positionKeyframeTrack"===o.type){const i=o.values,s=o.times,r=o.translations||[],{weight:a,pointCurrent:l,pointNext:h,currentIndex:_}=He.getWeightAndPoints(s,i,n);if(s.length<2||i.length<2)continue;const c=e.Vector3.unpack(He.getLinearInterpolationPosition(a,l,h)),u=e.Transforms.eastNorthUpToFixedFrame(c);if(r.length>0){const t=e.Vector3.unpack(He.getLinearInterpolationPosition(a,r[_],r[_+1]));u.translate(t),e.Matrix4.multiplyByPoint(u,t,c);}if(t.position=c,"BillboardMaterial"===t._material.type){const i=o.textures[_];i?(t._material.defines={USE_BILLBOARDTEXTURE:!0},t._material._texture=i,t.show=!0):(t._material.defines={USE_BILLBOARDTEXTURE:!1},t.show=!1),t._material.position=e.Transforms.cartesian3ToCartographic(c);}t.updateMatrixWorld(!0);}if("trackingKeyframeTrack"===o.type){const i=o.values,s=o.times,{weight:r,pointCurrent:a,pointNext:l}=He.getWeightAndPoints(s,i,n);if("BillboardMaterial"!==t._material.type&&!e.Vector3.equals(a,l)){const e=He.getRSModelMatrix(a,l,t);t.setMatrix(e);}const h=He.getLinearInterpolationPosition(r,a,l);t.position=h,"BillboardMaterial"===t._material.type&&(t._material.position=e.Transforms.cartesian3ToCartographic(h)),t.updateMatrixWorld(!0);}if("multiPositionKeyframeTrack"===o.type){const s=o.values,a=o.times,l=o.eulers||[],h=o.translations||[],_=o.colors||[],c=i.camera.getVPMatrix(),u=c.clone().invert();if(!t.animationModelInstanceCollection||r){this.animationClip.dirty=!1;const i=s[0],r=s.map((t=>{const s=new e.Vector3;return e.Vector3.subtract(t[0],i[0],s),s}));t.animationModelInstanceCollection=new e.ModelInstanceCollection({instances:e.ModelInstanceCollection.generateInstanceObject(r)}),t.setInstanceProperties(),t.matrixAutoUpdate=!1,t.setMatrix(new e.Matrix4),t.updateMatrixWorld(!0);}if(!t.animationModelInstanceCollection)return;t.setMatrix(u),t.updateMatrixWorld(!0);for(let r=0;r<a.length;r++){const u=a[r],d=s[r],m=l[r]||[],p=h[r]||[],f=_[r]||[],g=t.animationModelInstanceCollection._instances.get(r);if(u[0]>n){g.show=!1;continue}if(u.length<2||d.length<2){g.show=!1;continue}g.show=!0;const{weight:y,pointCurrent:C,pointNext:T,currentIndex:x}=He.getWeightAndPoints(u,d,n),b=He.getLinearInterpolationPosition(y,C,T),v=e.Transforms.eastNorthUpToFixedFrame(b);if("BillboardMaterial"===t._material.type){if(p.length>0){const t=He.getLinearInterpolationPosition(y,p[x],p[x+1]);v.translate(e.Vector3.unpack(t));}const s=i.camera.getViewMatrix().clone().multiplyRight(v);t.animationModelInstanceCollection.updateInstanceMatrixByIndex(r,s);}else {if(p.length>0){const t=He.getLinearInterpolationPosition(y,p[x],p[x+1]);v.translate(e.Vector3.unpack(t));}if(m.length>0){const e=o.rotateOrder,t=He.getLinearInterpolationPosition(y,m[x],m[x+1]),i=He.getRotationMatrixFromEuler(t,e);v.multiplyRight(i);}v.multiplyRight(t.originalRotationScaleMatrix.clone());const i=c.clone().multiplyRight(v);t.animationModelInstanceCollection.updateInstanceMatrixByIndex(r,i);}f.length>0&&(t.color=f[x]);}}if("multiTrackingKeyframeTrack"===o.type){const s=o.values,a=o.times,l=i.camera.getVPMatrix(),h=l.clone().invert();if(!t.animationModelInstanceCollection||r){this.animationClip.dirty=!1;const i=s[0],r=s.map((t=>{const s=new e.Vector3;return e.Vector3.subtract(t[0],i[0],s),s}));t.animationModelInstanceCollection=new e.ModelInstanceCollection({instances:e.ModelInstanceCollection.generateInstanceObject(r)}),t.setInstanceProperties(),t.matrixAutoUpdate=!1,t.setMatrix(new e.Matrix4),t.updateMatrixWorld(!0);}if(!t.animationModelInstanceCollection)return;t.setMatrix(h),t.updateMatrixWorld(!0);for(let r=0;r<a.length;r++){const o=a[r],h=s[r],_=t.animationModelInstanceCollection._instances.get(r);if(o[0]>n){_.show=!1;continue}if(o.length<2||h.length<2){_.show=!1;continue}_.show=!0;let c=new e.Matrix4;const{weight:u,pointCurrent:d,pointNext:m}=He.getWeightAndPoints(o,h,n),p=He.getLinearInterpolationPosition(u,d,m);if("BillboardMaterial"===t._material.type){c=e.Transforms.eastNorthUpToFixedFrame(p);const s=i.camera.getViewMatrix().clone().multiplyRight(c);t.animationModelInstanceCollection.updateInstanceMatrixByIndex(r,s);}else {e.Vector3.equals(d,m)?(c=e.Transforms.eastNorthUpToFixedFrame(p),c.multiplyRight(t.originalRotationScaleMatrix.clone())):c=He.getRSModelMatrix(d,m,t),c[12]=p[0],c[13]=p[1],c[14]=p[2];const i=l.clone().multiplyRight(c);t.animationModelInstanceCollection.updateInstanceMatrixByIndex(r,i);}}}}}trackingAnimation(t,i,s){const r=this.animationAction._blender.trackingOptions;if(r)if(r.trackingModel===t.id||r.trackingModel===t._instanceName)switch(r.trackingMode){case We.FOLLOW:if(t._map.scrollZoom.enable(),t._map.dragRotate.enable(),t._map.dragPan.enable(),r.onset){const s=r.onset.distance,n=r.onset.heading??r.onset.bearing??0,o=r.onset.pitch??0,a=s*Math.sin(o*Math.PI/180)*180/(6378137*Math.PI),l=s*Math.cos(o*Math.PI/180),h=e.Vector3.fromArray(i),_=e.Transforms.cartesian3ToCartographic(h),c=e.Vector3.fromDegrees(_[0],_[1]-a,_[2]+l);let u;const d=t._map.transform.activeCamera;this.needUpdateCamera?(u={heading:n*Math.PI/180,pitch:o*Math.PI/180-.5*Math.PI,roll:d.roll},this.needUpdateCamera=!1):u={heading:d.heading,pitch:d.pitch,roll:d.roll},d.setView({destination:c,orientation:u}),Fe.executeEvent(t._map,"move");}break;case We.LOCK:{const n=e.Transforms.cartesian3ToCartographic(s),o=e.Transforms.cartesian3ToCartographic(i),a=ze(n[1],n[0],o[1],o[0]).bearing;if(r.onset){const l=r.onset.distance,h=r.onset.pitch??0,_=l*Math.sin(qe(h))*180/(6378137*Math.PI)*Math.cos(qe(a)),c=l*Math.sin(qe(h))*180/(6378137*Math.PI)*Math.sin(qe(a)),u=l*Math.cos(h*Math.PI/180),d=e.Vector3.fromArray(i),m=e.Transforms.cartesian3ToCartographic(d),p=e.Vector3.fromDegrees(m[0]-c,m[1]-_*Math.sin(qe(h)),m[2]+u),f=Math.asin((o[2]-n[2])/e.Vector3.distance(e.Vector3.fromArray(s),e.Vector3.fromArray(i))),g=a*Math.PI/180,y=(h+180*f/Math.PI)*Math.PI/180-.5*Math.PI;t._map.transform.activeCamera.setView({destination:p,orientation:{heading:g,pitch:y}}),Fe.executeEvent(t._map,"move"),t._map.scrollZoom.disable(),t._map.dragRotate.disable(),t._map.dragPan.disable();}}break;default:t._map.scrollZoom.enable(),t._map.dragRotate.enable(),t._map.dragPan.enable();}else t._map.scrollZoom.enable(),t._map.dragRotate.enable(),t._map.dragPan.enable();}}function qe(e){return e*Math.PI/180}class Ke{constructor(t,i){if(!e.defined(t))throw new e.DeveloperError("must have root");this._root=t,this.id=t.id,this.time=0,this._actions=[],this._uuid=e.uuid(),this._play=!1,this._setClipAction(e.defaultValue(i,[]));}get actions(){return this._actions}set actions(e){e instanceof Ge&&this._actions.push(e);}addClipAction(e){return this._setClipAction([e])}_setClipAction(e){const t=[];for(let i=0;i<e.length;i++){const s=e[i];if(s instanceof Ue){const e=new Ge(this,s);this._initRootAnimationProperty(e),this.actions=e,t.push(e);}}return t}_activateAction(e){const t=this._root.animationPropertyCollection.get(`${e._clip.id}-${e.id}`);t.enabled=e.enabled,this.trackingOptions?.onset&&(t.needUpdateCamera=!0);}_deactivateAction(e){this._root.animationPropertyCollection.get(`${e._clip.id}-${e.id}`).enabled=e.enabled;}play(){this._play=!0,this._actions[0].enabled=!0,this._activateAction(this._actions[0]),this?._root?._map&&this.trackingOptions&&Fe.executeEvent(this._root._map,"movestart"),this.onPlay&&this.onPlay({time:this._actions[0].time});}pause(){this._play=!1,this._actions[0].enabled=!1,this._deactivateAction(this._actions[0]),this.onPause&&this.onPause({time:this._actions[0].time});}stop(t=!0){if(this._play&&this.trackingOptions&&this?._root?._map&&Fe.executeEvent(this._root._map,"moveend"),this._actions[0].reset(),this.time=0,this._play=!1,this._actions[0].enabled=!1,this._deactivateAction(this._actions[0]),t)switch(this._root.type){case"3d-model-instance":this._root.modelInstanceCollection?._instances.forEach((e=>{e.modelMatrix=e._originalMatrix;}));break;case"geojson":this._root.animationsInfo.currentClipTime=0,this._root.animationsInfo.enabled=!1;break;default:this._root.position=new e.Vector3(e.Transforms.cartographicToCartesian3(this._root._options.position)),this._root.animationLock=!0,this._root.rotation=this._root._rotation,this._root.animationLock=!1,this._root.updateMatrixWorld(!0);}this.onStop&&this.onStop({time:this._actions[0].time});}reset(){this._actions[0].reset(),this.time=0,this.onReset&&this.onReset({time:this._actions[0].time}),this.play();}update(e){if(!this._play)return;const t=this.time+=e;this.actions[0].update(t,e);}_initRootAnimationProperty(t){this._root.animationPropertyCollection=this._root.animationPropertyCollection||new e.AnimationPropertyCollection;let i=this._root.animationPropertyCollection.get(`${t._clip.id}-${t.id}`);i||(i=new Xe(t),this._root.animationPropertyCollection.add(i));}speed=1;autoStop=!1}class Je{constructor(e,t){if(void 0===e)throw new Error("minemap.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error(`minemap.KeyframeTrack: no keyframes in track named ${e}`);this.name=e;}destroy(){this.times=null,this.values=null;}}class Ze extends Je{constructor(e,t,i,s,r,n,o,a){super(e,t),this.type="positionKeyframeTrack",this.times=t,this.values=Ze.parsePoints(i,"pos"),s&&(this.eulers=Ze.parsePoints(s,"deg")),r&&(this.translations=Ze.parsePoints(r,"trans")),this.rotateOrder=n||"x-y-z",o&&a?(this.colors=o,this.primitiveNames=a):(this.colors=[],this.primitiveNames=[]);}static parsePoints(t,i){return "pos"===i?e.Vector3.fromDegreesArrayHeights(t):"deg"===i?Ze.parsePointsDegree(t):"trans"===i?Ze.parseTranslations(t):void 0}static parsePointsDegree(t){if(t.length%3==0){const i=[];for(let s=0;s<t.length;s+=3){const r=[];r[0]=t[s]*e.CONSTS.TRANSFORM.DEG_TO_RAD,r[1]=t[s+1]*e.CONSTS.TRANSFORM.DEG_TO_RAD,r[2]=t[s+2]*e.CONSTS.TRANSFORM.DEG_TO_RAD,i.push(r);}return i}}static parseTranslations(e){if(e.length%3==0){const t=[];for(let i=0;i<e.length;i+=3)t.push([e[i],e[i+1],e[i+2]]);return t}}parseImageInfo(t,i,s){this.textures=[];let r,n={};for(let o=0;o<this.times.length;o++){let a=!0;const l={};for(const[t,s]of Object.entries(i)){if(0===o&&this.times.length!==s.length)throw new e.DeveloperError(" the 'imageInfo' length must be the same as the 'values' length ");l[t]=s[o],n[t]!==l[t]&&(a=!1);}n=l,a||(r=t(l)?new e.Texture({context:s,image:t(l),pixelFormat:e.WebGLConstants.RGBA}):void 0),this.textures.push(r);}}}class Ye extends Je{constructor(e,t,i){super(e,t),this.type="trackingKeyframeTrack",this.times=t,this.values=Ye.parsePoints(i);}static parsePoints(t){if(Array.isArray(t))return e.Vector3.fromDegreesArrayHeights(t)}}class Qe extends Je{constructor(t,i,s){if(super(t,i),this.type="multiTrackingKeyframeTrack",this.times=Qe.validateTimesParameter(i),this.values=Qe.parsePoints(s),this.times.length!==this.values.length)throw new e.DeveloperError(" the 'times' length must be the same as the 'values' length ");if(this.trackIds=arguments[8],this.trackIds&&this.trackIds.length!==i.length)throw new e.DeveloperError(" the 'trackIds' length must be the same as the 'times' length ")}static parsePoints(t){const i=[];if(!Array.isArray(t))throw new e.DeveloperError(" 'values' parameter type must be Array< Array<number> >");for(const s of t){if(!Array.isArray(s))throw new e.DeveloperError(" 'values' parameter type must be Array< Array<number> >");i.push(e.Vector3.fromDegreesArrayHeights(s));}return i}static validateTimesParameter(t){if(!Array.isArray(t))throw new e.DeveloperError(" 'times' parameter type must be Array< Array<number> >");for(const i of t)if(!Array.isArray(i))throw new e.DeveloperError(" 'times' parameter type must be Array< Array<number> >");return t}}class $e extends Je{constructor(t,i,s,r,n,o,a,l,h){if(super(t,i),this.type="multiPositionKeyframeTrack",this.times=$e.validateTimesParameter(i),this.values=$e.parsePoints(s,"pos"),r&&(this._angles=r,this.eulers=$e.parsePoints(r,"deg")),n&&(this.translations=$e.parsePoints(n,"trans")),this.rotateOrder=o||"x-y-z",a&&l?(this._colors=a,this.primitiveNames=l):(this._colors=[],this.primitiveNames=[]),h&&(this.trackIds=h),this.times.length!==this.values.length)throw new e.DeveloperError(" the 'times' length must be the same as the 'values' length ");if(r&&this.times.length!==this.eulers.length)throw new e.DeveloperError(" the 'times' length must be the same as the 'angles' length ");if(this.colors.length!==this.primitiveNames.length&&this.colors.length!==this.values.length)throw new e.DeveloperError(" the 'times' length must be the same as the 'colors' length and primitiveNames length");if(h&&this.trackIds.length!==i.length)throw new e.DeveloperError(" the 'trackIds' length must be the same as the 'times' length ")}get colors(){return this._colors}set colors(e){this._colors=e;}static parsePoints(t,i){const s=[];if(!Array.isArray(t))throw new e.DeveloperError(" 'values' parameter type must be Array< Array<number> >");for(const r of t){if(!Array.isArray(r))throw new e.DeveloperError(" 'values' parameter type must be Array< Array<number> >");"pos"===i?s.push(e.Vector3.fromDegreesArrayHeights(r)):"deg"===i?s.push(Ze.parsePointsDegree(r)):"trans"===i&&s.push(Ze.parseTranslations(r));}return s}static validateTimesParameter(t){if(!Array.isArray(t))throw new e.DeveloperError(" 'times' parameter type must be Array< Array<number> >");for(const i of t)if(!Array.isArray(i))throw new e.DeveloperError(" 'times' parameter type must be Array< Array<number> >");return t}}var et="4.7.2";const tt=`v${et.substring(0,1)}.0.0`,it="minemapapi",st={DOMAIN:"//minedata.cn",DATA_DOMAIN:"//datahive.minedata.cn",SERVER_DOMAIN:"//datahive.minedata.cn",API_BASE:"/data/",API_URL:"//datahive.minedata.cn/data/",DYN_BASE:"/dynamicdata/",DYN_URL:"//datahive.minedata.cn/dynamicdata/",MERGE_BASE:"/mergeddata/",MERGE_URL:"//datahive.minedata.cn/mergeddata/",OTHER_BASE:"/otherdata/",OTHER_URL:"//datahive.minedata.cn/otherdata/",SERVER_URL:"//datahive.minedata.cn/service/",SRC_BASE:`/${it}/${tt}`,SRC_URL:`//minedata.cn/${it}/${tt}`,SERVICE_BASE:"/service",SERVICE_URL:"//minedata.cn/service",REQUIRE_ACCESS_TOKEN:!0,APP_KEY:null,KEY:null,ACCESS_TOKEN:null,spriteUrl:null,MAX_PARALLEL_IMAGE_REQUESTS:16};function rt(e,t){return Array.isArray(e)?t&&t.x&&t.y?e[(t.x+t.y)%e.length]:e[0]:e}function nt(t,i,s,r,n,o){switch(t.protocol){case"minemap":{const e=mt(st.SRC_URL);t.protocol=e.protocol,t.authority=e.authority;break}case"minemapdata":{const e=mt(rt(st.API_URL,o));t.path=e.path+t.authority+t.path,t.protocol=e.protocol,t.authority=e.authority;break}case"minemapdatad":{const e=mt(rt(st.DYN_URL||"",o));t.path=e.path+t.authority+t.path,t.protocol=e.protocol,t.authority=e.authority;break}case"minemapdatam":{const e=mt(rt(st.MERGE_URL||"",o));t.path=e.path+t.authority+t.path,t.protocol=e.protocol,t.authority=e.authority;break}case"minemapdatao":{const e=mt(rt(st.OTHER_URL||"",o));t.path=e.path+t.authority+t.path,t.protocol=e.protocol,t.authority=e.authority;break}case"mineserver":{const e=mt(rt(st.SERVER_URL||"",o));t.path=e.path+t.authority+t.path,t.protocol=e.protocol,t.authority=e.authority;break}case"cloudservice":{const e=mt(rt(st.SERVER_URL||"",o));t.path=`/${t.authority}${t.path}`,t.protocol=e.protocol,t.authority=e.authority;break}case"mineservice":{const e=mt(rt(st.SERVICE_URL||"",o));t.path=e.path+t.path,t.protocol=e.protocol,t.authority=e.authority;break}}return st.REQUIRE_ACCESS_TOKEN?(s=s||st.APP_KEY,r=r||st.SOLU,n=n||st.DATA_VERSION,(i=i||st.KEY)?t.params.push(`key=${i}`):s?t.params.push(`appKey=${s}`):st.ACCESS_TOKEN&&t.params.push(`token=${st.ACCESS_TOKEN}`),e.defined(r)&&t.params.push(`solu=${r}`),n&&t.params.push(`version=${n}`),pt(t)):pt(t)}function ot(e){return 0===e.indexOf("minemap:")||0===e.indexOf("minemapdata:")||0===e.indexOf("minemapdatad:")||0===e.indexOf("minemapdatam:")||0===e.indexOf("minemapdatao:")||0===e.indexOf("mineserver:")||0===e.indexOf("cloudservice:")||0===e.indexOf("mineservice:")}const at=function(e,t,i){if(!ot(e))return e;const s=mt(e);return s.path=`/styles/v1${s.path}`,nt(s,t,i)},lt=function(t,i){return e.defined(t)&&ot(t)?nt(mt(t),i):t},ht=e=>{if(!ot(e))return e;const t=mt(e);return `${st.SRC_URL}/${t.authority}${t.path}`},_t=function(e,t,i){if(!ot(e))return e;const s=mt(e);return s.path=`/v4/${s.authority}.json`,s.params.push("secure"),nt(s,t,i)},ct=function(e){const t=mt(e.url);return t.path=e.url.startsWith("http")?`${e.url}${e.format}${e.extension}`:`${st.SRC_URL}/sprite/sprite${e.format}${e.extension}`,Array.isArray(st.spriteUrl)&&st.spriteUrl[e.index]&&`${st.spriteUrl[e.index]}${e.format}${e.extension}`||t.path},ut=function(t,i,s,r){if(!t||t.indexOf("auth=true")<0&&!ot(t))return 0===t.indexOf("//")?`${e.window.document.location.protocol}${t}`:t;const n=mt(t);return function(e){for(let t=0;t<e.length;t++)0===e[t].indexOf("access_token=tk.")&&(e[t]=`access_token=${st.ACCESS_TOKEN||""}`);}(n.params),nt(n,void 0,void 0,void 0,void 0,r)},dt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function mt(e){const t=e.match(dt);if(!t){const t=e.match(/^\/\/([^/?]+)(\/[^?]+)?\??(.+)?/);if(!t)throw new Error("Unable to parse URL object");return {protocol:"",authority:t[1],path:t[2]||"/",params:t[3]?t[3].split("&"):[]}}return {protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function pt(t){const i=t.params.length?`?${t.params.join("&")}`:"";return t.protocol&&t.protocol.length>0?`${t.protocol}://${t.authority}${t.path}${i}`:`${e.window.document.location.protocol}//${t.authority}${t.path}${i}`}function ft(t,i,s){const r=function(t,i){if(t)return s(t);if(i){const t=e.pick(i,["tiles","minzoom","maxzoom","attribution","minemap_logo","bounds"]);i.vector_layers&&(t.vectorLayers=i.vector_layers,t.vectorLayerIds=t.vectorLayers.map((e=>e.id))),s(null,t);}};return t.url?e.getJSON(i(_t(t.url),e.ResourceType.Source),r):e.exported.frame((()=>r(null,t)))}class gt{constructor(t){this._ellipsoid=e.defaultValue(t,e.Ellipsoid.WGS84),this._semimajorAxis=this._ellipsoid.maximumRadius,this._oneOverSemimajorAxis=1/this._semimajorAxis;}get ellipsoid(){return this._ellipsoid}static mercatorAngleToGeodeticLatitude(t){return e.CONSTS.CesiumMath.PI_OVER_TWO-2*Math.atan(Math.exp(-t))}static geodeticLatitudeToMercatorAngle(e){e>gt.MaximumLatitude?e=gt.MaximumLatitude:e<-gt.MaximumLatitude&&(e=-gt.MaximumLatitude);const t=Math.sin(e);return .5*Math.log((1+t)/(1-t))}project(t,i){const s=this._semimajorAxis,r=t.longitude*s,n=gt.geodeticLatitudeToMercatorAngle(t.latitude)*s,o=t.height;return e.defined(i)?(i.x=r,i.y=n,i.z=o,i):new e.Vector3(r,n,o)}unproject(t,i){const s=this._oneOverSemimajorAxis,r=t.x*s,n=gt.mercatorAngleToGeodeticLatitude(t.y*s),o=t.z;return e.defined(i)?(i.longitude=r,i.latitude=n,i.height=o,i):new e.Cartographic(r,n,o)}}gt.MaximumLatitude=gt.mercatorAngleToGeodeticLatitude(Math.PI);class yt{crs="EPSG:3857";type=e.ProjectionType.MERCATOR;constructor(t){if(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this._ellipsoid=e.defaultValue(t.ellipsoid,e.Ellipsoid.WGS84),this._numberOfLevelZeroTilesX=e.defaultValue(t.numberOfLevelZeroTilesX,1),this._numberOfLevelZeroTilesY=e.defaultValue(t.numberOfLevelZeroTilesY,1),this._projection=new gt(this._ellipsoid),e.defined(t.rectangleSouthwestInMeters)&&e.defined(t.rectangleNortheastInMeters))this._rectangleSouthwestInMeters=t.rectangleSouthwestInMeters,this._rectangleNortheastInMeters=t.rectangleNortheastInMeters;else {const t=this._ellipsoid.maximumRadius*Math.PI;this._rectangleSouthwestInMeters=new e.Vector2(-t,-t),this._rectangleNortheastInMeters=new e.Vector2(t,t);}const i=this._projection.unproject(this._rectangleSouthwestInMeters),s=this._projection.unproject(this._rectangleNortheastInMeters);this._rectangle=new e.Rectangle(i.longitude,i.latitude,s.longitude,s.latitude);}get ellipsoid(){return this._ellipsoid}get rectangle(){return this._rectangle}get projection(){return this._projection}getNumberOfXTilesAtLevel(e){return this._numberOfLevelZeroTilesX<<e}getNumberOfYTilesAtLevel(e){return this._numberOfLevelZeroTilesY<<e}rectangleToNativeRectangle(t,i){const s=this._projection,r=s.project(e.Rectangle.southwest(t)),n=s.project(e.Rectangle.northeast(t));return e.defined(i)?(i.west=r.x,i.south=r.y,i.east=n.x,i.north=n.y,i):new e.Rectangle(r.x,r.y,n.x,n.y)}tileXYToNativeRectangle(t,i,s,r){const n=this.getNumberOfXTilesAtLevel(s),o=this.getNumberOfYTilesAtLevel(s),a=(this._rectangleNortheastInMeters.x-this._rectangleSouthwestInMeters.x)/n,l=this._rectangleSouthwestInMeters.x+t*a,h=this._rectangleSouthwestInMeters.x+(t+1)*a,_=(this._rectangleNortheastInMeters.y-this._rectangleSouthwestInMeters.y)/o,c=this._rectangleNortheastInMeters.y-i*_,u=this._rectangleNortheastInMeters.y-(i+1)*_;return e.defined(r)?(r.west=l,r.south=u,r.east=h,r.north=c,r):new e.Rectangle(l,u,h,c)}tileXYToRectangle(t,i,s,r){const n=this.tileXYToNativeRectangle(t,i,s,r),o=this._projection,a=o.unproject(new e.Vector2(n.west,n.south)),l=o.unproject(new e.Vector2(n.east,n.north));return n.west=a.longitude,n.south=a.latitude,n.east=l.longitude,n.north=l.latitude,n}positionToTileXY(t,i,s){if(!e.Rectangle.contains(this._rectangle,t))return;const r=this.getNumberOfXTilesAtLevel(i),n=this.getNumberOfYTilesAtLevel(i),o=(this._rectangleNortheastInMeters.x-this._rectangleSouthwestInMeters.x)/r,a=(this._rectangleNortheastInMeters.y-this._rectangleSouthwestInMeters.y)/n,l=this._projection.project(t);let h=(l.x-this._rectangleSouthwestInMeters.x)/o|0;h>=r&&(h=r-1);let _=(this._rectangleNortheastInMeters.y-l.y)/a|0;return _>=n&&(_=n-1),e.defined(s)?(s.x=h,s.y=_,s):new e.Vector2(h,_)}}class Ct{crs="EPSG:4326";type=e.ProjectionType.LATLON;constructor(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this._ellipsoid=e.defaultValue(t.ellipsoid,e.Ellipsoid.WGS84),this._rectangle=e.defaultValue(t.rectangle,e.Rectangle.MAX_VALUE),this._projection=new e.GeographicProjection(this._ellipsoid),this._numberOfLevelZeroTilesX=e.defaultValue(t.numberOfLevelZeroTilesX,2),this._numberOfLevelZeroTilesY=e.defaultValue(t.numberOfLevelZeroTilesY,1);}get ellipsoid(){return this._ellipsoid}get rectangle(){return this._rectangle}get projection(){return this._projection}getNumberOfXTilesAtLevel(e){return this._numberOfLevelZeroTilesX<<e}getNumberOfYTilesAtLevel(e){return this._numberOfLevelZeroTilesY<<e}rectangleToNativeRectangle(t,i){const s=e.CONSTS.CesiumMath.toDegrees(t.west),r=e.CONSTS.CesiumMath.toDegrees(t.south),n=e.CONSTS.CesiumMath.toDegrees(t.east),o=e.CONSTS.CesiumMath.toDegrees(t.north);return e.defined(i)?(i.west=s,i.south=r,i.east=n,i.north=o,i):new e.Rectangle(s,r,n,o)}tileXYToNativeRectangle(t,i,s,r){const n=this.tileXYToRectangle(t,i,s,r);return n.west=e.CONSTS.CesiumMath.toDegrees(n.west),n.south=e.CONSTS.CesiumMath.toDegrees(n.south),n.east=e.CONSTS.CesiumMath.toDegrees(n.east),n.north=e.CONSTS.CesiumMath.toDegrees(n.north),n}tileXYToRectangle(t,i,s,r){const n=this._rectangle,o=this.getNumberOfXTilesAtLevel(s),a=this.getNumberOfYTilesAtLevel(s),l=n.width/o,h=t*l+n.west,_=(t+1)*l+n.west,c=n.height/a,u=n.north-i*c,d=n.north-(i+1)*c;return e.defined(r)||(r=new e.Rectangle(h,d,_,u)),r.west=h,r.south=d,r.east=_,r.north=u,r}positionToTileXY(t,i,s){const r=this._rectangle;if(!e.Rectangle.contains(r,t))return;const n=this.getNumberOfXTilesAtLevel(i),o=this.getNumberOfYTilesAtLevel(i);let a=t.longitude;r.east<r.west&&(a+=e.CONSTS.CesiumMath.TWO_PI);let l=(a-r.west)/(r.width/n)|0;l>=n&&(l=n-1);let h=(r.north-t.latitude)/(r.height/o)|0;return h>=o&&(h=o-1),e.defined(s)?(s.x=l,s.y=h,s):new e.Vector2(l,h)}}class Tt{constructor(e,t,i){this.imagery=e,this.textureCoordinateRectangle=t,this.textureTranslationAndScale=i;}freeResources(t){return e.defined(this.imagery)?this.imagery.releaseReference(t):0}loadImage(e){this.imagery.loadImage(e);}}var xt=Object.freeze({__proto__:null,MathArray:e.MathArray,Vector:e.Vector,Vector2:e.Vector2,Vector3:e.Vector3,Vector4:e.Vector4,Cartographic:e.Cartographic,Matrix:e.Matrix,Matrix2:e.Matrix2,Matrix3:e.Matrix3,Matrix4:e.Matrix4,Quaternion:e.Quaternion,HeadingPitchRoll:e.HeadingPitchRoll,Euler:e.Euler,toRadians:e.toRadians,toDegrees:e.toDegrees});class bt{constructor(t,i,s,r){this.rasterTileSource=r,this.x=t,this.y=i,this.level=s,this.tileID=new e.OverscaledTileID(s,0,s,t,i),this.state="unloaded",this.texture=void 0,this.referenceCount=0,this.references=[];}addReference(){++this.referenceCount;}releaseReference(){return --this.referenceCount,0===this.referenceCount?(this.rasterTileSource.removeImageryFromCache(this),e.defined(this.texture)&&this.texture.destroy(),e.destroyObject(this),0):this.referenceCount}loadImage(t){const{painter:i,callback:s,url:r}=t;let n=t.data;const o=i.context;if(n.img)if(e.window.hasOwnProperty("createImageBitmap")){let i=e.window.createImageBitmap(n.img,{premultiplyAlpha:"none"});i.then((r=>{if("loaded"===this.state)return;const a=o.gl;this.texture=new e.Texture({context:o,image:r,pixelFormat:e.WebGLConstants.RGBA,useMipmap:!1}),this.texture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),o.extTextureFilterAnisotropic&&(a.bindTexture(this.texture._target,this.texture.texture),a.texParameterf(e.WebGLConstants.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.ContextLimits._maximumTextureFilterAnisotropy),a.bindTexture(this.texture._target,null)),n.img=null,n=null,r=null,this.state="loaded",t.url=null,t.painter=null,t=null,i=null,s&&s();})).catch((()=>{"loaded"!==this.state&&(this.texture=new e.Texture({context:o,image:{width:1,height:1,data:null},pixelFormat:e.WebGLConstants.RGBA,useMipmap:!1}),this.texture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),this.state="loaded",s&&s());}));}else this.texture=new e.Texture({context:o,image:n.img,pixelFormat:e.WebGLConstants.RGBA,useMipmap:!1}),this.texture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),n.img=null,n=null,t.url=null,t.painter=null,t=null,this.state="loaded",s&&s();else e.getImage({url:r},((t,i)=>{if(t)throw new Error(t);this.texture=new e.Texture({context:o,image:i,pixelFormat:e.WebGLConstants.RGBA,useMipmap:!1}),this.texture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),i=null,this.state="loaded",s&&s();}));}}class vt extends e.Evented{constructor(t,i,s,r){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=24,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this.dispatcher=s,this.setEventedParent(r),this._data=i.data,this._options=e.extend({},i),this._collectResourceTiming=i.collectResourceTiming,this._resourceTiming=[],void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.noBox=i.noBox;const n=e.EXTENT/this.tileSize;this.promoteId=i.promoteId,this.workerOptions=e.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*n,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*n,extent:e.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:e.EXTENT,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*n,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions),this._timestamp=Date.now(),this._imageryCache=new Map;}load(){this.fire(new e.Event("dataloading",{dataType:"source"})),this._updateWorkerData((t=>{if(t)return void this.fire(new e.ErrorEvent(t));const i={dataType:"source",sourceDataType:"metadata"};this._collectResourceTiming&&this._resourceTiming&&this._resourceTiming.length>0&&(i.resourceTiming=this._resourceTiming,this._resourceTiming=[]),this.fire(new e.Event("data",i));}));}onAdd(e){this.map=e,this.load();}setData(t){return this._data=t,this._timestamp=Date.now(),this.fire(new e.Event("dataloading",{dataType:"source"})),this._updateWorkerData((t=>{if(t)return void this.fire(new e.ErrorEvent(t));const i={dataType:"source",sourceDataType:"content"};this._collectResourceTiming&&this._resourceTiming&&this._resourceTiming.length>0&&(i.resourceTiming=this._resourceTiming,this._resourceTiming=[]),this.fire(new e.Event("data",i)),this._eventedParent&&this._eventedParent.reload&&this._eventedParent.reload(!0);})),this}getClusterExpansionZoom(e,t){return this.dispatcher.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},t,this.workerID),this}getClusterChildren(e,t){return this.dispatcher.send("geojson.getClusterChildren",{clusterId:e,source:this.id},t,this.workerID),this}getClusterLeaves(e,t,i,s){return this.dispatcher.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:t,offset:i},s,this.workerID),this}_updateWorkerData(t){const i=e.extend({},this.workerOptions),s=this._data;"string"==typeof s?(i.request=this.map._transformRequest(e.exported.resolveURL(s),e.ResourceType.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(s),this.workerID=this.dispatcher.send(`${this.type}.loadData`,i,((e,s)=>{this._removed||s&&s.abandoned||(this._loaded=!0,s&&s.resourceTiming&&s.resourceTiming[this.id]&&(this._resourceTiming=s.resourceTiming[this.id].slice(0)),this.dispatcher.send(`${this.type}.coalesce`,{source:i.source},null,this.workerID),t(e));}),this.workerID);}loadTile(t,i){const s=void 0===t.workerID?"loadTile":"reloadTile";t.workerID=this.dispatcher.send(s,{type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:e.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},((e,r)=>(t.unloadVectorData(),t.aborted?i(null):e?i(e):(t.loadVectorData(r,this.map.painter,"reloadTile"===s),i(null)))),this.workerID);}abortTile(e){e.aborted=!0;}unloadTile(e){e.unloadVectorData(),this.dispatcher.send("removeTile",{uid:e.uid,type:this.type,source:this.id},null,e.workerID);}onRemove(){this._removed=!0,this.dispatcher.send("removeSource",{type:this.type,source:this.id},null,this.workerID);}serialize(){return e.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return !1}isEarthSource(){return !0}createTileImagerySkeletons(t,i){const s=t.sourceCache.map._tilingScheme.tileXYToRectangle(t.tileID.canonical.x,t.tileID.canonical.y,t.tileID.canonical.z);this.projection||(this.projection=t.sourceCache.map.projection,this._tilingScheme=t.sourceCache.map._tilingScheme);const r=this._tilingScheme,n=e.Rectangle.intersection(r.rectangle,e.Rectangle.MAX_VALUE);if(!n)return [];const o=e.Rectangle.intersection(s,n);if(!o)return [];const a=i?.canonical.z,l=r.positionToTileXY(e.Rectangle.northwest(o),a),h=r.positionToTileXY(e.Rectangle.southeast(o),a);let _=s.width/512,c=s.height/512;const u=r.tileXYToRectangle(l.x,l.y,a);Math.abs(u.south-s.north)<c&&l.y<h.y&&++l.y,Math.abs(u.east-s.west)<_&&l.x<h.x&&++l.x;const d=r.tileXYToRectangle(h.x,h.y,a);Math.abs(d.north-s.south)<c&&h.y>l.y&&--h.y,Math.abs(d.west-s.east)<_&&h.x>l.x&&--h.x;const m=e.Rectangle.clone(s);let p,f,g=r.tileXYToRectangle(l.x,l.y,a),y=e.Rectangle.intersection(g,n);this.projection===e.ProjectionType.MERCATOR?(r.rectangleToNativeRectangle(m,m),r.rectangleToNativeRectangle(g,g),r.rectangleToNativeRectangle(y,y),r.rectangleToNativeRectangle(n,n),p=r.tileXYToNativeRectangle.bind(r),_=m.width/512,c=m.height/512):p=r.tileXYToRectangle.bind(r);let C,T=0,x=1;Math.abs(y.west-m.west)>=_&&(T=Math.min(1,(y.west-m.west)/m.width)),Math.abs(y.north-m.north)>=c&&(x=Math.max(0,(y.north-m.south)/m.height));const b=x,v=[];for(let t=i.canonical.x;t<=i.canonical.x;t++){f=T,g=p(t,l.y,a),y=e.Rectangle.simpleIntersection(g,n),T=Math.min(1,(y.east-m.west)/m.width),t===h.x&&Math.abs(y.east-m.east)<_&&(T=1),x=b;for(let s=i.canonical.y;s<=i.canonical.y;s++){C=x,g=p(t,s,a),y=e.Rectangle.simpleIntersection(g,n),x=Math.max(0,(y.south-m.south)/m.height),s===h.y&&Math.abs(y.south-m.south)<c&&(x=0);const i=new e.Vector4(f,1-C,T,1-x),r=m.width,o=m.height,l=r/g.width,_=o/g.height,u=new e.Vector4(l*(m.west-g.west)/r,_*(g.north-m.north)/o,l,_),d=this.getImageryFromCache(t,s,a);v.push(new Tt(d,i,u));}}return v}getImageryFromCache(e,t,i,s){const r=`${i}_${e}_${t}`;let n=this._imageryCache.get(r);return n||(n=new bt(e,t,i,this),this._imageryCache.set(r,n)),n.addReference(s),n}}class wt extends e.Object3D{constructor(){super(),this._minzoom=0,this._maxzoom=24,this._visible=!0,this._loaded=!1,this._fileSize=1/0,this._classificationType="";}set minzoom(e){this._minzoom=e;}get minzoom(){return this._minzoom}set maxzoom(e){this._maxzoom=e;}get maxzoom(){return this._maxzoom}set visible(e){this._visible=e;}get visible(){return this._visible}get loaded(){return this._loaded}get culled(){return this._culled}get fileSize(){return this._fileSize}get classificationType(){return this._classificationType}set classificationType(e){this._classificationType=e;}get lightingModel(){return this._lightingModel}set lightingModel(e){this._lightingModel=e;}}function St(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const At={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},Et=At.global||At.self||At.window,Mt="object"!=typeof process||"[object process]"!==String(process)||process.browser,Pt="undefined"!=typeof process&&process.version&&process.version.match(/v([0-9]*)/),Rt=Pt&&parseFloat(Pt[1])||0;function Bt(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const It={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},Dt=It.global||It.self||It.window,Ot="object"!=typeof process||"[object process]"!==String(process)||process.browser,Lt="function"==typeof importScripts,Vt="undefined"!=typeof window&&void 0!==window.orientation,Nt="undefined"!=typeof process&&process.version&&process.version.match(/v([0-9]*)/);Nt&&parseFloat(Nt[1]);const Ft=new Map;function Gt(e){Bt("string"==typeof e,"worker source");const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function kt(e,t=!0,i){const s=i||new Set;if(e)if(Ut(e))s.add(e);else if(Ut(e.buffer))s.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"==typeof e)for(const i in e)kt(e[i],t,s);return void 0===i?Array.from(s):[]}function Ut(e){return !!e&&(e instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&e instanceof MessagePort||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)}const Ht=e=>{};class zt{static isSupported(){return "undefined"!=typeof Worker}constructor(e){const{name:t,source:i,url:s}=e;Bt(i||s),this.name=t,this.source=i,this.url=s,this.onMessage=Ht,this.onError=e=>{console.log(e);},this.terminated=!1,this.worker=this._createBrowserWorker();}destroy(){this.onMessage=Ht,this.onError=Ht,this.worker.terminate(),this.terminated=!0;}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||kt(e),this.worker.postMessage(e,t);}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=function({source:e,url:t}){Bt(e&&!t||!e&&t);let i=Ft.get(e||t);return i||(t&&(i=function(e){return e.startsWith("http")?Gt(`try {\n  importScripts('${e}');\n} catch (error) {\n  console.error(error);\n  throw error;\n}`):e}(t),Ft.set(t,i)),e&&(i=Gt(e),Ft.set(e,i))),Bt(i),i}({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError("No data received");},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0;},e.onmessageerror=e=>{console.error(e);},e}}class Wt{constructor(e,t){this.name=e,this.workerThread=t,this.isRunning=!0,this.result=new Promise(((e,t)=>{this._resolve=e,this._reject=t;}));}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t});}done(e){Bt(this.isRunning),this.isRunning=!1,this._resolve(e);}error(e){Bt(this.isRunning),this.isRunning=!1,this._reject(e);}}class jt{constructor({source:e,url:t,name:i="unnamed",maxConcurrency:s=1,onMessage:r,onDebug:n=(()=>{}),reuseWorkers:o=!0}){Bt(e||t),this.source=e,this.url=t,this.name=i,this.maxConcurrency=s,this.onMessage=r,this.onDebug=n,this.reuseWorkers=o,this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1;}destroy(){this.idleQueue.forEach((e=>e.destroy())),this.isDestroyed=!0;}async startJob(e,t=((e,t,i)=>e.done(i)),i=((e,t)=>e.error(t))){const s=new Promise((s=>{this.jobQueue.push({name:e,onMessage:t,onError:i,onStart:s});}));return this._startQueuedJob(),s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",jobName:t.name,workerThread:e,backlog:this.jobQueue.length});const i=new Wt(t.name,e);e.onMessage=e=>t.onMessage(i,e.type,e.payload),e.onError=e=>t.onError(i,e),t.onStart(i);try{await i.result;}finally{this.returnWorkerToQueue(e);}}}returnWorkerToQueue(e){this.isDestroyed?e.destroy():(this.reuseWorkers?this.idleQueue.push(e):(e.destroy(),this.count--),this._startQueuedJob());}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.maxConcurrency){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new zt({name:e,source:this.source,url:this.url})}return null}}const Xt={maxConcurrency:3,maxMobileConcurrency:1,onDebug:()=>{},reuseWorkers:!0};let qt=null;class Kt{static isSupported(){return zt.isSupported()}static getWorkerFarm(e={}){return qt=qt||new Kt({}),qt.setProps(e),qt}constructor(e){this.props={...Xt},this.setProps(e),this.workerPools=new Map;}destroy(){this.workerPools.forEach((e=>e.destroy()));}setProps(e){this.props={...this.props,...e};}getWorkerPool({name:e,source:t,url:i}){let s=this.workerPools.get(e);return s||(s=new jt({name:e,source:t,url:i,maxConcurrency:Vt?this.props.maxMobileConcurrency:this.props.maxConcurrency,onDebug:this.props.onDebug,reuseWorkers:this.props.reuseWorkers}),this.workerPools.set(e,s)),s}}const Jt="undefined"!=typeof __VERSION__?__VERSION__:"beta";function Zt(e){const t=e.split(".").map(Number);return {major:t[0],minor:t[1]}}const Yt=new Map;class Qt{static set onmessage(e){self.onmessage=t=>{if(!$t(t))return;const{type:i,payload:s}=t.data;e(i,s);};}static addEventListener(e){let t=Yt.get(e);t||(t=t=>{if(!$t(t))return;const{type:i,payload:s}=t.data;e(i,s);}),self.addEventListener("message",t);}static removeEventListener(e){const t=Yt.get(e);Yt.delete(e),self.removeEventListener("message",t);}static postMessage(e,t){if(self){const i={source:"loaders.gl",type:e,payload:t},s=kt(t);self.postMessage(i,s);}}}function $t(e){const{type:t,data:i}=e;return "message"===t&&i&&"string"==typeof i.source&&i.source.startsWith("loaders.gl")}"undefined"==typeof __VERSION__||__VERSION__;const ei={};async function ti(e,t=null,i={}){return t&&(e=function(e,t,i){if(e.startsWith("http"))return e;const s=i.modules||{};return s[e]?s[e]:Ot?i.CDN?`${i.CDN}/${t}/dist/libs/${e}`:Lt?`../src/libs/${e}`:`modules/${t}/src/libs/${e}`:`modules/${t}/dist/libs/${e}`}(e,t,i)),ei[e]=ei[e]||async function(e){if(e.endsWith("wasm")){const t=await fetch(e);return await t.arrayBuffer()}if(Lt)return importScripts(e);const t=await fetch(e);return function(e,t){if(Lt)return eval.call(Dt,e),null;const i=document.createElement("script");i.id=t;try{i.appendChild(document.createTextNode(e));}catch(t){i.text=e;}return document.body.appendChild(i),null}(await t.text(),e)}(e),await ei[e]}"undefined"==typeof __VERSION__||__VERSION__;let ii=0;function si(e,t={}){return new Promise(((i,s)=>{const r=ii++,n=(e,t)=>{if(t.id===r)switch(e){case"done":Qt.removeEventListener(n),i(t.result);break;case"error":Qt.removeEventListener(n),s(t.error);}};Qt.addEventListener(n),Qt.postMessage("process",{id:r,input:e,options:t});}))}async function ri(e,t,i,s,r){const n=e.id,o=function(e,t){const i=t||{},s=`${e.id}-worker.js`;let r=(i[e.id]||{}).workerUrl;return "test"===i._workerType&&(r=`modules/${e.module}/dist/${s}`),r||(r=`${window.minemapCDN}/@mm-loaders.gl/${e.module}/dist/${s}`,r=r.replace(/\/\//g,"/"),0===window.minemapCDN?.indexOf("//")&&(r=`${window.document.location.protocol}/${r}`)),Bt(r),r}(e,i),a=Kt.getWorkerFarm(i).getWorkerPool({name:n,url:o});i.fetch&&(i.fetch.dispatcher=null),i.dispatcher=null,i=JSON.parse(JSON.stringify(i));const l=await a.startJob("process-on-worker",ni.bind(null,r));l.postMessage("process",{input:t,options:i});const h=await l.result;return await h.result}async function ni(e,t,i,s){switch(i){case"done":t.done(s);break;case"error":t.error(s.error);break;case"process":const{id:r,input:n,options:o}=s;try{const i=await e(n,o);t.postMessage("done",{id:r,result:i});}catch(e){const i=e instanceof Error?e.message:"unknown error";t.postMessage("error",{id:r,error:i});}break;default:console.warn(`parse-with-worker unknown message ${i}`);}}function oi(e,t,i){if(e.byteLength<=t+i)return "";const s=new DataView(e);let r="";for(let e=0;e<i;e++)r+=String.fromCharCode(s.getUint8(t+e));return r}var ai={toArrayBuffer:e=>Buffer.isBuffer(e)?new Uint8Array(e).buffer:e,toBuffer(e){if(ArrayBuffer.isView(e)&&(e=e.buffer),"undefined"!=typeof Buffer&&e instanceof ArrayBuffer){const t=new Buffer(e.byteLength),i=new Uint8Array(e);for(let e=0;e<t.length;++e)t[e]=i[e];return t}return St(!1)}};function li(e){if(ai.toArrayBuffer&&(e=ai.toArrayBuffer(e)),e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.buffer;if("string"==typeof e){const t=e;return (new TextEncoder).encode(t).buffer}return e&&"object"==typeof e&&e._toArrayBuffer?e._toArrayBuffer():St(!1)}function hi(e,t){return St(e>=0),St(t>0),e+(t-1)&~(t-1)}function _i(e,t,i){let s;if(e instanceof ArrayBuffer)s=new Uint8Array(e);else {const t=e.byteOffset;s=new Uint8Array((e.buffer||e.arrayBuffer).slice(t,t+e.byteLength));}return t.set(s,i),i+hi(s.byteLength,4)}function ci(e){return ci="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ci(e)}function ui(e,t,i){return (t=function(e){var t=function(e,t){if("object"!==ci(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var s=i.call(e,"string");if("object"!==ci(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return "symbol"===ci(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function di(){let e;if("undefined"!=typeof window&&window.performance)e=window.performance.now();else if("undefined"!=typeof process&&process.hrtime){const t=process.hrtime();e=1e3*t[0]+t[1]/1e6;}else e=Date.now();return e}class mi{constructor(e,t){ui(this,"name",void 0),ui(this,"type",void 0),ui(this,"sampleSize",1),ui(this,"time",void 0),ui(this,"count",void 0),ui(this,"samples",void 0),ui(this,"lastTiming",void 0),ui(this,"lastSampleTime",void 0),ui(this,"lastSampleCount",void 0),ui(this,"_count",0),ui(this,"_time",0),ui(this,"_samples",0),ui(this,"_startTime",0),ui(this,"_timerPending",!1),this.name=e,this.type=t,this.reset();}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=di(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(di()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0);}}class pi{constructor(e){ui(this,"id",void 0),ui(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this);}get(e){return this._getOrCreate({name:e,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count"})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const t in this.stats)e(this.stats[t]);}getTable(){const e={};return this.forEach((t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0};})),e}_initializeStats(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((e=>this._getOrCreate(e)));}_getOrCreate(e){if(!e||!e.name)return null;const{name:t,type:i}=e;return this.stats[t]||(this.stats[t]=e instanceof mi?e:new mi(t,i)),this.stats[t]}}const fi={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class gi{constructor(e={}){this.props={...fi,...e},this.requestQueue=[],this.activeRequestCount=0,this.requestMap=new Map,this.stats=new pi({id:e.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever"),this._deferredUpdate=null;}scheduleRequest(e,t=(()=>0)){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const i={handle:e,getPriority:t},s=new Promise((e=>(i.resolve=e,i)));return this.requestQueue.push(i),this.requestMap.set(e,s),this._issueNewRequests(),s}_issueRequest(e){const{handle:t,resolve:i}=e;let s=!1;const r=()=>{s||(s=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests());};return this.activeRequestCount++,i?i({done:r}):Promise.resolve({done:r})}_issueNewRequests(){this._deferredUpdate||(this._deferredUpdate=setTimeout((()=>this._issueNewRequestsAsync()),0));}_issueNewRequestsAsync(){this._deferredUpdate=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==e){this._updateAllRequests();for(let t=0;t<e;++t)if(this.requestQueue.length>0){const e=this.requestQueue.shift();e&&this._issueRequest(e);}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const i=e[t];this._updateRequest(i)||(e.splice(t,1),this.requestMap.delete(i.handle),t--);}e.sort(((e,t)=>e.priority-t.priority));}_updateRequest(e){return e.priority=e.getPriority(e.handle),!(e.priority<0&&(e.resolve(null),1))}}let yi="";const Ci={};function Ti(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}function xi(e){if(!e||!e.POSITION)return null;let t=1/0,i=1/0,s=1/0,r=-1/0,n=-1/0,o=-1/0;const a=e.POSITION.value,l=a&&a.length;if(!l)return null;for(let e=0;e<l;e+=3){const l=a[e],h=a[e+1],_=a[e+2];t=l<t?l:t,i=h<i?h:i,s=_<s?_:s,r=l>r?l:r,n=h>n?h:n,o=_>o?_:o;}return [[t,i,s],[r,n,o]]}"undefined"==typeof __VERSION__||__VERSION__,"undefined"==typeof __VERSION__||__VERSION__;const bi="undefined"!=typeof __VERSION__?__VERSION__:"";Et.loaders=Object.assign(Et.loaders||{},{VERSION:bi});const vi=e=>"function"==typeof e,wi=e=>null!==e&&"object"==typeof e,Si=e=>wi(e)&&e.constructor==={}.constructor,Ai=e=>e&&"function"==typeof e[Symbol.iterator],Ei=e=>e&&"function"==typeof e[Symbol.asyncIterator],Mi=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,Pi=e=>"undefined"!=typeof Blob&&e instanceof Blob,Ri=e=>e&&"object"==typeof e&&e.isBuffer,Bi=e=>(e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||wi(e)&&vi(e.tee)&&vi(e.cancel)&&vi(e.getReader))(e)||(e=>wi(e)&&vi(e.read)&&vi(e.pipe)&&(e=>"boolean"==typeof e)(e.readable))(e),Ii=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Di=/^([-\w.]+\/[-\w.+]+)/;function Oi(e){if("string"!=typeof e)return "";const t=e.match(Ii);return t?t[1]:""}const Li=/\?.*/;function Vi(e){if(Mi(e)){const t=function(e){if("string"!=typeof e)return "";const t=e.match(Di);return t?t[1]:e}(e.headers.get("content-type")),i=Oi(e.url);return {url:Ni(e.url||""),type:t||i||null}}return Pi(e)?{url:Ni(e.name||""),type:e.type||""}:"string"==typeof e?{url:Ni(e),type:Oi(e)}:{url:"",type:""}}function Ni(e){return e.replace(Li,"")}async function Fi(e){if(Mi(e))return e;const t={},i=function(e){return Mi(e)?e.headers["content-length"]||-1:Pi(e)?e.size:"string"==typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}(e);i>=0&&(t["content-length"]=String(i));const{url:s,type:r}=Vi(e);r&&(t["content-type"]=r);const n=await async function(e){if("string"==typeof e)return `data:,${e.slice(0,5)}`;if(e instanceof Blob){const t=e.slice(0,5);return await new Promise((e=>{const i=new FileReader;i.onload=t=>e(t.target&&t.target.result),i.readAsDataURL(t);}))}return e instanceof ArrayBuffer?`data:base64,${function(e){let t="";const i=new Uint8Array(e);for(let e=0;e<i.byteLength;e++)t+=String.fromCharCode(i[e]);return btoa(t)}(e.slice(0,5))}`:null}(e);n&&(t["x-first-bytes"]=n),"string"==typeof e&&(e=(new TextEncoder).encode(e));const o=new Response(e,{headers:t});return Object.defineProperty(o,"url",{value:s}),o}async function Gi(e){let t=`Failed to fetch resource ${e.url} (${e.status}): `;try{e.headers.get("Content-Type").includes("application/json")?t+=await e.text():t+=e.statusText;}catch(e){return t}return t}const ki=";base64,";async function Ui(t,i={}){if("string"!=typeof t)return await Fi(t);const s=i.dispatcher;t=function(e){for(const t in Ci)e.startsWith(t)&&(e=e.replace(t,Ci[t]));return e.startsWith("http://")||e.startsWith("https://")||(e=`${yi}${e}`),e}(t);let r={url:t=e.exported.resolveURL(t),binary:i.binary,mode:"no-cors"};const n=new e.window.AbortController;if(i.isDestroyed&&n.abort(),i.transformRequest){const o=-1==t.indexOf(ki)?i.transformRequest(t,e.ResourceType.Source):{url:t},a=new e.window.Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:e.getReferrer(),signal:n.signal});if(i.json&&a.headers.set("Accept","application/json"),!i._abortListMap||i.isDestroyed||i.json||i._abortListMap.set(o.url.split("?")[0],n),e.isWorker()||!s){const e=await fetch(a);if(!e.ok&&i.throws)throw new Error(await Gi(e));return e}r={method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,url:o.url,mode:"no-cors"};}else if(e.isWorker()||!s){const e=await fetch(t,i);if(!e.ok&&i.throws)throw new Error(await Gi(e));return e}const o=new Promise(((e,t)=>{s.send("fetchLoadersTilesData",{requestOptions:r},((i,s)=>{i&&t(i),e(s);}));}));return await o}class Hi{log(){return e=>{}}info(){return e=>{}}warn(){return e=>{}}error(){return e=>{}}}const zi={fetch:null,CDN:"",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,log:new class{constructor(){this.console=console;}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}},metadata:!1,transforms:[],attributeName:null,attributeType:null,reuseWorkers:!0,_workerType:void 0},Wi={dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"},ji=()=>{Et.loaders=Et.loaders||{};const{loaders:e}=Et;return e._state=e._state||{},e._state},Xi=()=>{const e=ji();return zi.CDN=`${Et.minemapCDN}/@mm-loaders.gl`,zi.CDN=zi.CDN.replace(/\/\//g,"/"),0===Et.minemapCDN?.indexOf("//")&&(zi.CDN=`${Et.document.location.protocol}/${zi.CDN}`),e.globalOptions=e.globalOptions||{...zi},e.globalOptions};function qi(e,t){const i=Xi(),s=e.fetch||i.fetch,r=e.dispatcher;return "function"==typeof s?s:wi(s)?(e.transformRequest&&(s.transformRequest=e.transformRequest),s.json=e.json,s.dispatcher=r,e=>Ui(e,s)):t&&t.fetch?t.fetch:t=>Ui(t,e)}function Ki(e,t,i,s,r,n){for(const i in e){const o=!t&&wi(e[i]);i in s||"baseUri"===i&&!t||i in r||o||Ji(i,n);}}function Ji(e,t){const i=e.toLowerCase();let s="";for(const r of t)for(const t in r.options){if(e===t)return `Did you mean '${r.id}.${t}'?`;const n=t.toLowerCase();(i.startsWith(n)||n.startsWith(i))&&(s=s||`Did you mean '${r.id}.${t}'?`);}return s}function Zi(e,t){for(const i in t)i in t&&(e[i]=Si(t[i])&&Si(e[i])?{...e[i],...t[i]}:t[i]);}function Yi(e){return Array.isArray(e)&&(e=e[0]),!!e&&Array.isArray(e.extensions)}function Qi(e){let t;return St(e,"null loader"),St(Yi(e),"invalid loader"),Array.isArray(e)&&(t=e[1],e=e[0],e={...e,options:{...e.options,...t}}),(e.parseTextSync||e.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const $i=()=>{const e=ji();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry},es=1048576;async function ts(e,t,i){return await new Promise(((s,r)=>{const n=e.slice(t,i),o=new FileReader;o.onload=e=>s(e.target&&e.target.result),o.onerror=e=>r(e),o.readAsArrayBuffer(n);}))}function is(e){if(Mt||Rt>=10){if("function"==typeof e[Symbol.asyncIterator])return async function*(e){for await(const t of e)yield li(t);}(e);if("function"==typeof e.getIterator)return e.getIterator()}return Mt?async function*(e){const t=e.getReader();try{for(;;){const{done:e,value:i}=await t.read();if(e)return;yield li(i);}}catch(e){t.releaseLock();}}(e):async function*(e){for(e=await e;;){const t=e.read();if(null===t){if(e._readableState.ended)return;await ss(e);}else yield li(t);}}(e)}async function ss(e){return new Promise((t=>{e.once("readable",t);}))}const rs=/\.([^.]+)$/;function ns(e,t=[],i={},s={}){if(t&&!Array.isArray(t))return Qi(t);!function(e){for(const t of e)Qi(t);}(t=[...t||[],...$i()]);const{url:r,type:n}=Vi(e);let o=function(e,t){const i=t&&t.match(rs),s=i&&i[1];return s&&function(e,t){t=t.toLowerCase();for(const i of e)for(const e of i.extensions)if(e.toLowerCase()===t)return i;return null}(e,s)}(t,r||s.url);if(o=o||function(e,t){for(const i of e){if(i.mimeTypes&&i.mimeTypes.includes(t))return i;if(t===`application/x.${i.id}`)return i;if(i.mimeTypes&&i.mimeTypes.includes("image/crn"))return i;if(i.mimeTypes&&i.mimeTypes.includes("image/ktx"))return i;if(i.mimeTypes&&i.mimeTypes.includes("image/ktx2"))return i;if(i.mimeTypes&&i.mimeTypes.includes("image/basis"))return i}return null}(t,n),o=o||function(e,t){if(!t)return null;for(const i of e)if("string"==typeof t){if(as(t,i))return i}else if(ArrayBuffer.isView(t)){if(ls(t.buffer,t.byteOffset,i))return i}else if(t instanceof ArrayBuffer&&ls(t,0,i))return i;return null}(t,e),!o&&!i.nothrow)throw new Error(os(e));return o}function os(e){const{url:t,type:i}=Vi(e);let s="No valid loader found";return e&&(s+=` data: "${function(e,t=5){return "string"==typeof e?e.slice(0,t):ArrayBuffer.isView(e)?hs(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?hs(e,0,t):""}(e)}", contentType: "${i}"`),t&&(s+=` url: ${t}`),s}function as(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some((t=>e.startsWith(t)))}function ls(e,t,i){return (Array.isArray(i.tests)?i.tests:[i.tests]).some((s=>function(e,t,i,s){if(s instanceof ArrayBuffer)return function(e,t,i){if(e.byteLength<(i=i||e.byteLength)||t.byteLength<i)return !1;const s=new Uint8Array(e),r=new Uint8Array(t);for(let e=0;e<s.length;++e)if(s[e]!==r[e])return !1;return !0}(s,e,s.byteLength);switch(typeof s){case"function":return s(e,i);case"string":return s===hs(e,t,s.length);default:return !1}}(e,t,i,s)))}function hs(e,t,i){if(e.byteLength<t+i)return "";const s=new DataView(e);let r="";for(let e=0;e<i;e++)r+=String.fromCharCode(s.getUint8(t+e));return r}async function _s(e,t,i,s){Bt(!s||"string"!=typeof s,"parse no longer accepts final url"),!t||Array.isArray(t)||Yi(t)||(s=void 0,i=t,t=void 0),e=await e,i=i||{};let{url:r}=Vi(e);r||(r=i.url);const n=function(e,t){if(e&&!Array.isArray(e))return e;let i;if(e&&(i=Array.isArray(e)?e:[e]),t&&t.loaders){const e=Array.isArray(t.loaders)?t.loaders:[t.loaders];i=i?[...i,...e]:e;}return i&&i.length?i:void 0}(t,s),o=await async function(e,t=[],i={},s={}){let r=ns(e,t,{...i,nothrow:!0},s);if(r)return r;if(Pi(e)&&(r=ns(e=await ts(e,0,10),t,i,s)),!r&&!i.nothrow)throw new Error(os(e));return r}(e,n,i);if(!o)return null;s=function(e,t,i=null){return i||(e={fetch:qi(t||{},e),...e},Array.isArray(e.loaders)||(e.loaders=null),e)}({url:r,_parse:_s,loaders:n},i=function(e,t,i,s){return i=i||[],function(e,t,i=console){zi.CDN=Et.minemapCDN,Ki(e,null,0,zi,Wi,t);for(const i of t)Ki(e&&e[i.id]||{},i.id,0,i.options&&i.options[i.id]||{},i.defaultOptions&&i.defaultOptions[i.id]||{},t);}(e,i=Array.isArray(i)?i:[i]),function(e,t,i){const s={...e.options||{}};return function(e,t){t&&!("baseUri"in e)&&(e.baseUri=t);}(s,i),null===s.log&&(s.log=new Hi),Zi(s,Xi()),Zi(s,t),s}(t,e,s)}(i,o,n,r),s||null);const a=await async function(e,t,i,s){if(function(e,t=Jt){Bt(e,"no worker provided");let i=e.version;t&&i&&(t=Zt(t),i=Zt(i));}(e),Mi(t)){const e=t,{ok:i,redirected:r,status:n,statusText:o,type:a,url:l}=e,h=Object.fromEntries(e.headers.entries());s.response={headers:h,ok:i,redirected:r,status:n,statusText:o,type:a,url:l};}if(t=await async function(e,t){const i=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||i)return function(e,t){if(t.text&&"string"==typeof e)return e;if(e instanceof ArrayBuffer){const i=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(e)||Ri(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let i=e.buffer;const s=e.byteLength||e.length;return 0===e.byteOffset&&s===i.byteLength||(i=i.slice(e.byteOffset,e.byteOffset+s)),i}return e}(e,t);if(Pi(e)&&(e=await Fi(e)),Mi(e)){const i=e;return await async function(e){if(!e.ok){const t=await async function(e){let t=`Failed to fetch resource ${e.url} (${e.status}): `;try{const i=e.headers.get("Content-Type");let s=e.statusText;i.includes("application/json")&&(s+=` ${await e.text()}`),t+=s,t=t.length>60?`${t.slice(60)}...`:t;}catch(e){}return t}(e);throw new Error(t)}}(i),t.binary?await i.arrayBuffer():await i.text()}return Bi(e)&&(e=function(e,t={}){return "string"==typeof e?function*(e,t={}){const{chunkSize:i=262144}=t;let s=0;const r=new TextEncoder;for(;s<e.length;){const t=Math.min(e.length-s,i),n=e.slice(s,s+t);s+=t,yield r.encode(n);}}(e,t):e instanceof ArrayBuffer?function*(e,t={}){const{chunkSize:i=262144}=t;let s=0;for(;s<e.byteLength;){const t=Math.min(e.byteLength-s,i),r=new ArrayBuffer(t),n=new Uint8Array(e.slice(s,s+t));new Uint8Array(r).set(n),s+=t,yield r;}}(e,t):Pi(e)?async function*(e,t={}){const i=t.chunkSize||es;let s=0;for(;s<e.size;){const t=s+i,r=await ts(e,s,t);s=t,yield r;}}(e,t):Bi(e)?is(e):Mi(e)?is(e.body):St(!1)}(e)),Ai(e)||Ei(e)?async function(e){const t=[],i=[];for await(const s of e)"string"==typeof s?i.push(s):t.push(s);return i.length>0?(St(0===t.length),i.join("")):function(...e){const t=e.map((e=>e instanceof ArrayBuffer?new Uint8Array(e):e)),i=t.reduce(((e,t)=>e+t.byteLength),0),s=new Uint8Array(i);let r=0;for(const e of t)s.set(e,r),r+=e.byteLength;return s.buffer}(...t)}(e):e}(t,e),e.parseTextSync&&"string"==typeof t)return e.parseTextSync(t,i,s);if(function(e,t,i,s){return !!Kt.isSupported()&&!(!e.worker||!i.worker)&&(!e.useWorker||e.useWorker(i))}(e,0,i))return await ri(e,t,i,0,_s);if(e.parseText&&"string"==typeof t)return await e.parseText(t,i,s);if(e.parse)return await e.parse(t,i,s);throw Bt(!e.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}(o,e,i,s);return a}async function cs(e,t,i,s,r){let n,o;Array.isArray(t)||Yi(t)?(n=t,o=i):(n=[],o=t);const a=qi(o||{});let l=e;return "string"==typeof e?l=await a(e,i):Pi(e)?(l=await a(e),e=null):e=null,i&&(i.modelFolder=r),i.url=e,Array.isArray(n),await _s(l,n,o)}const us="undefined"!=typeof __VERSION__?__VERSION__:"latest";function ds(e,t){if(!e)throw new Error(t)}const ms={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},ps=ms.global||ms.self||ms.window,fs="object"!=typeof process||"[object process]"!==String(process)||process.browser,gs="undefined"!=typeof process&&process.version&&process.version.match(/v([0-9]*)/);gs&&parseFloat(gs[1]);const{_parseImageNode:ys}=ps,Cs="undefined"!=typeof Image,Ts="undefined"!=typeof ImageBitmap,xs=Boolean(ys),bs=!!fs||xs;function vs(e){switch(function(e){const t=function(e){return "undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&e instanceof Image?"image":e&&"object"==typeof e&&e.data&&e.width&&e.height?"data":null}(e);if(!t)throw new Error("Not an image");return t}(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),i=t.getContext("2d");if(i)return t.width=e.width,t.height=e.height,i.drawImage(e,0,0),i.getImageData(0,0,e.width,e.height);default:return ds(!1)}}const ws=/^data:image\/svg\+xml/,Ss=/\.svg((\?|#).*)?$/;function As(e){return e&&(ws.test(e)||Ss.test(e))}function Es(e,t){if(As(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([e])}async function Ms(e,t,i){const s=function(e,t){if(As(t)){const t=(new TextDecoder).decode(e);return `data:image/svg+xml;base64,${btoa(t)}`}return Es(e,t)}(e,i),r=self.URL||self.webkitURL,n="string"!=typeof s&&r.createObjectURL(s);try{return await async function(e,t){const i=new Image;return i.src=e,t.image&&t.image.decode&&i.decode?(await i.decode(),i):await new Promise(((t,s)=>{try{i.onload=()=>t(i),i.onerror=t=>s(new Error(`Could not load image ${e}: ${t}`));}catch(e){s(e);}}))}(n||s,t)}finally{n&&r.revokeObjectURL(n);}}const Ps={};let Rs=!0;const Bs=!1,Is=!0;function Ds(e){const t=Os(e),i=function(e){const t=Os(e);return t.byteLength>=24&&2303741511===t.getUint32(0,Bs)?{mimeType:"image/png",width:t.getUint32(16,Bs),height:t.getUint32(20,Bs)}:null}(t)||function(e){const t=Os(e);if(!(t.byteLength>=3&&65496===t.getUint16(0,Bs)&&255===t.getUint8(2)))return null;const{tableMarkers:i,sofMarkers:s}=function(){const e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);return {tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}();let r=2;for(;r+9<t.byteLength;){const e=t.getUint16(r,Bs);if(s.has(e))return {mimeType:"image/jpeg",height:t.getUint16(r+5,Bs),width:t.getUint16(r+7,Bs)};if(!i.has(e))return null;r+=2,r+=t.getUint16(r,Bs);}return null}(t)||function(e){const t=Os(e);return t.byteLength>=10&&1195984440===t.getUint32(0,Bs)?{mimeType:"image/gif",width:t.getUint16(6,Is),height:t.getUint16(8,Is)}:null}(t)||function(e){const t=Os(e);return t.byteLength>=14&&16973===t.getUint16(0,Bs)&&t.getUint32(2,Is)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,Is),height:t.getUint32(22,Is)}:null}(t);return i||{mimeType:"image/webp",width:256,height:256}}function Os(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}const Ls={name:"Images",id:"image",module:"images",version:us,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml","image/ktx2"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","ktx2"],parse:async function(e,t,i){const s=((t=t||{}).image||{}).type||"auto",{url:r}=i||{};let n;switch(function(e){switch(e){case"auto":case"data":return function(){if(Ts)return "imagebitmap";if(Cs)return "image";if(bs)return "data";throw new Error("Install '@mm-loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return Ts||Cs||bs;case"imagebitmap":return Ts;case"image":case"html":return Cs;case"data":case"ndarray":return bs;default:throw new Error(`@mm-loaders.gl/images: image ${e} not supported in this environment`)}}(e),e}}(s)){case"imagebitmap":n=await async function(e,t,i){let s;s=As(i)?await Ms(e,t,i):Es(e,i);const r=t&&t.imagebitmap;return await async function(e,t=null){if(!function(e){for(const t in e||Ps)return !1;return !0}(t)&&Rs||(t=null),t)try{return await createImageBitmap(e,t)}catch(e){Rs=!1;}return await createImageBitmap(e)}(s,r)}(e,t,r);break;case"image":n=await Ms(e,t,r);break;case"data":n=await function(e,t){const{mimeType:i}=Ds(e)||{},{_parseImageNode:s}=ps;return ds(s),s(e,i,t)}(e,t);break;default:ds(!1);}return "data"===s&&(n=vs(n)),n},tests:[e=>Boolean(Ds(new DataView(e)))],options:{image:{type:"auto",decode:!0}}},Vs={};function Ns(e,t){if(!e)throw new Error(t||"assert failed: gltf")}const Fs="KHR_binary_glTF",Gs="KHR_draco_mesh_compression",ks="KHR_lights_punctual",Us="KHR_materials_unlit",Hs="KHR_techniques_webgl",zs={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ws={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},js=["SCALAR","VEC2","VEC3","VEC4"],Xs=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],qs=new Map(Xs),Ks={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Js={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Zs={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Ys(e){return js[e-1]||js[0]}function Qs(e){const t=qs.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function $s(e,t){const i=Ks[e.type];return {ArrayType:Zs[e.componentType],length:e.count*i,byteLength:e.count*i*Js[e.componentType],componentByteSize:Ws[e.componentType],numberOfComponentsInElement:zs[e.type]}}function er(e,t,i){const s=e.bufferViews[i];Ns(s);const r=t[s.buffer];Ns(r);const n=(s.byteOffset||0)+r.byteOffset;return r.arrayBuffer.slice(n,n+s.byteLength)}class tr{constructor(e){if(e instanceof tr)return e;e||(e={json:{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]},buffers:e?.buffers||[],images:e?.images||[]}),this.sourceBuffers=[],this.byteLength=0,e.buffers&&e.buffers[0]&&(this.byteLength=e.buffers[0].byteLength,this.sourceBuffers=[e.buffers[0]]),this.gltf=e,Ns(this.gltf.json);}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return (this.json.extras||{})[e]}hasExtension(e){const t=this.getUsedExtensions().find((t=>t===e)),i=this.getRequiredExtensions().find((t=>t===e));return "string"==typeof t||"string"==typeof i}getExtension(e){const t=this.getUsedExtensions().find((t=>t===e));return t?(this.json.extensions||{})[e]||!0:null}getRequiredExtension(e){const t=this.getRequiredExtensions().find((t=>t===e));return t?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return (e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getCamera(e){return null}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if("object"==typeof t)return t;const i=this.json[e]&&this.json[e][t];if(!i)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return i}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=this.gltf.buffers[e.buffer];Ns(t);const i=(e.byteOffset||0)+t.byteOffset;return new Uint8Array(t.arrayBuffer.slice(i,i+e.byteLength))}getTypedArrayDataForBufferViewInSimple(e){e=this.getBufferView(e);const t=this.gltf.buffers[e.buffer];Ns(t);const i=(e.byteOffset||0)+t.byteOffset;return t.arrayBuffer.slice(i,i+e.byteLength)}getTypedArrayForAccessor(e){const t=this.getAccessor(e);return function(e,t,i){const s="number"==typeof i?e.accessors?.[i]:i;if(!s)throw new Error(`No gltf accessor ${JSON.stringify(i)}`);const r=e.bufferViews&&e.bufferViews[s.bufferView||0];if(!r)throw new Error(`No gltf buffer view for accessor ${r}`);const{arrayBuffer:n,byteOffset:o}=t[r.buffer],a=(o||0)+(s.byteOffset||0)+(r.byteOffset||0),{ArrayType:l,length:h,componentByteSize:_,numberOfComponentsInElement:c}=$s(s),u=_*c,d=r.byteStride||u;if(void 0===r.byteStride||r.byteStride===u)return new l(n,a,h);const m=new l(h);for(let e=0;e<s.count;e++){const t=new l(n,a+e*d,c);m.set(t,e*c);}return m}(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer),s=t.byteOffset||0;return new Uint8Array(i.data.slice(s,s+t.byteLength))}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,i){return Ns(i),e.extensions=e.extensions||{},e.extensions[t]=i,this.registerUsedExtension(t),this}setObjectExtension(e,t,i){(e.extensions||{})[t]=i;}removeObjectExtension(e,t){const i=e?.extensions||{};if(i[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const e=this.json.extensionsRemoved;e.includes(t)||e.push(t);}delete i[t];}addExtension(e,t={}){return Ns(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return Ns(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find((t=>t===e))||this.json.extensionsUsed.push(e);}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find((t=>t===e))||this.json.extensionsRequired.push(e);}removeExtension(e){if(this.json.extensions?.[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const t=this.json.extensionsRemoved;t.includes(e)||t.push(e);}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e);}setDefaultScene(e){this.json.scene=e;}addScene({nodeIndices:e}){return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:e}),this.json.scenes.length-1}addNode({meshIndex:e,matrix:t=null}){this.json.nodes=this.json.nodes||[];const i={mesh:e};return t&&(i.matrix=t),this.json.nodes.push(i),this.json.nodes.length-1}addMesh({attributes:e,indices:t,material:i,mode:s=4}){const r={primitives:[{attributes:this._addAttributes(e),mode:s}]};if(t){const e=this._addIndices(t);r.primitives[0].indices=e;}return Number.isFinite(i)&&(r.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(r),this.json.meshes.length-1}addPointCloud(e){const t={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(t),this.json.meshes.length-1}addImage(e,t){t=t||function(e){const t=Ds(e);return t?t.mimeType:null}(e);const i={bufferView:this.addBufferView(e),mimeType:t};return this.json.images=this.json.images||[],this.json.images.push(i),this.json.images.length-1}addBufferView(e){const t=e.byteLength;Ns(Number.isFinite(t)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const i={buffer:0,byteOffset:this.byteLength,byteLength:t};return this.byteLength+=hi(t,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}addAccessor(e,t){const i={bufferView:e,type:Ys(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){const i=this.addBufferView(e);let s={min:t.min,max:t.max};s.min&&s.max||(s=this._getAccessorMinMax(e,t.size));const r={size:t.size,componentType:Qs(e),count:Math.round(e.length/t.size),min:s.min,max:s.max};return this.addAccessor(i,Object.assign(r,t))}addTexture({imageIndex:e}){const t={source:e};return this.json.textures=this.json.textures||[],this.json.textures.push(t),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){this.gltf.buffers=[];const e=this.byteLength,t=new ArrayBuffer(e),i=new Uint8Array(t),s=this.sourceBuffers||[];let r=0;for(let e=0;e<s.length;e++)r=_i(s[e],i,r);this.json.buffers[0]=this.json.buffers[0]||{},this.json.buffers[0].byteLength=e,this.gltf.binary=t,this.sourceBuffers=[t];}_removeStringFromArray(e,t){let i=!0;for(;i;){const s=e.indexOf(t);s>-1?e.splice(s,1):i=!1;}}_addAttributes(e={}){const t={};for(const i in e){const s=e[i],r=this._getGltfAttributeName(i),n=this.addBinaryBuffer(s.value,s);t[r]=n;}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return "POSITION";case"normal":case"normals":return "NORMAL";case"color":case"colors":return "COLOR_0";case"texcoord":case"texcoords":return "TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const i={min:null,max:null};if(e.length<t)return i;i.min=[],i.max=[];const s=e.subarray(0,t);for(const e of s)i.min.push(e),i.max.push(e);for(let s=t;s<e.length;s+=t)for(let r=0;r<t;r++)i.min[0+r]=Math.min(i.min[0+r],e[s+r]),i.max[0+r]=Math.max(i.max[0+r],e[s+r]);return i}}function ir(e){return (e%1+1)%1}const sr={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},rr={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},nr={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function or(e,t){return nr[t]*sr[e]}function ar(e,t,i,s){if("UINT8"!==i&&"UINT16"!==i&&"UINT32"!==i&&"UINT64"!==i)return null;const r=lr(e.getTypedArrayForBufferView(t),"SCALAR",i,s+1);return r instanceof BigInt64Array||r instanceof BigUint64Array?null:r}function lr(e,t,i,s=1){const r=rr[i],n=nr[i],o=s*sr[t];let a=e.buffer,l=e.byteOffset;return l%n!=0&&(a=new Uint8Array(a.arrayBuffer,l,l+o*n),l=0),new r(a,l,o)}function hr(e,t,i){const s=e.getTypedArrayForAccessor(i.attributes[`TEXCOORD_${t.texCoord||0}`]),r=e.gltf.json,n=t.index,o=r.textures?.[n]?.source;if(void 0!==o){const i=r.images?.[o]?.mimeType,n=e.gltf.images?.[o];if(n&&void 0!==n.width){const e=[];for(let r=0;r<s.length;r+=2){const o=cr(n,i,s,r,t.channels);e.push(o);}return e}}return []}function _r(e,t,i,s,r){if(!i?.length)return;const n=[];for(const e of i){let t=s.findIndex((t=>t===e));-1===t&&(t=s.push(e)-1),n.push(t);}const o=new Uint32Array(n),a=e.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,l=e.addBufferView(o,a,0),h=e.addAccessor(l,{size:1,componentType:Qs(o),count:o.length});r.attributes[t]=h;}function cr(e,t,i,s,r=[0]){const n={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=i[s],a=i[s+1];let l=1;!t||-1===t.indexOf("image/jpeg")&&-1===t.indexOf("image/png")||(l=4);const h=function(e,t,i,s=1){const r=i.width,n=ir(e)*(r-1),o=Math.round(n),a=i.height,l=ir(t)*(a-1);return (Math.round(l)*r+o)*(i.components?i.components:s)}(o,a,e,l);let _=0;for(const t of r){const i="number"==typeof t?Object.values(n)[t]:n[t],s=h+i.offset,r=vs(e);if(r.data.length<=s)throw new Error(`${r.data.length} <= ${s}`);_|=r.data[s]<<i.shift;}return _}const ur="EXT_mesh_features";function dr(e,t,i){if(!i?.gltf?.loadBuffers)return;const s=t.extensions?.[ur],r=s?.featureIds;if(r)for(const s of r){let r;r=void 0!==s.attribute?e.getTypedArrayForAccessor(t.attributes[`_FEATURE_ID_${s.attribute}`]||t.attributes[s.attribute]):void 0!==s.texture&&i?.gltf?.loadImages?hr(e,s.texture,t):[],s.data=r;}}var mr=Object.freeze({__proto__:null,name:ur,decode:async function(e,t){!function(e,t){const i=e.gltf.json;if(i.meshes)for(const s of i.meshes)for(const i of s.primitives)dr(e,i,t);}(new tr(e),t);}});const pr="EXT_structural_metadata";function fr(e,t){for(const i of e)if(i.class===t)return i;return null}function gr(e,t,i,s){if(!t)return;const r=i.extensions?.[pr],n=r?.propertyTextures;if(n)for(const r of n)yr(e,t[r],i,s);}function yr(e,t,i,s){if(!t.properties)return;s.dataAttributeNames||(s.dataAttributeNames=[]);const r=t.class;for(const n in t.properties){const o=`${r}_${n}`,a=t.properties?.[n];if(!a)continue;a.data||(a.data=[]);const l=a.data,h=hr(e,a,i);null!==h&&(_r(e,o,h,l,i),a.data=l,s.dataAttributeNames.push(o));}}function Cr(e,t,i){const s=t.classes?.[i.class];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${i.class}`);const r=i.count;for(const n in s.properties){const o=s.properties[n],a=i.properties?.[n];if(a){const i=Tr(e,t,o,r,a);a.data=i;}}}function Tr(e,t,i,s,r){let n=[];const o=e.getTypedArrayForBufferView(r.values),a=function(e,t,i,s){return t.array&&void 0===t.count&&void 0!==i.arrayOffsets?ar(e,i.arrayOffsets,i.arrayOffsetType||"UINT32",s):null}(e,i,r,s),l=function(e,t,i){return void 0!==t.stringOffsets?ar(e,t.stringOffsets,t.stringOffsetType||"UINT32",i):null}(e,r,s);switch(i.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":n=function(e,t,i,s){const r=e.array,n=e.count,o=or(e.type,e.componentType);let a;return a=e.componentType?lr(i,e.type,e.componentType,i.byteLength/o):i,r?s?function(e,t,i,s,r){const n=[];for(let o=0;o<t;o++){const t=i[o],a=i[o+1]-i[o];if(a+t>s)break;const l=t/r;n.push(e.slice(l,l+a/r));}return n}(a,t,s,i.length,o):n?function(e,t,i){const s=[];for(let r=0;r<t;r++){const t=r*i;s.push(e.slice(t,t+i));}return s}(a,t,n):[]:a}(i,s,o,a);break;case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${i.type}`);case"STRING":n=function(e,t,i,s){if(i)throw new Error("Not implemented - arrayOffsets for strings is specified");if(s){const i=[],r=new TextDecoder("utf8");let n=0;for(let o=0;o<e;o++){const e=s[o+1]-s[o];if(e+n<=t.length){const s=t.subarray(n,e+n),o=r.decode(s);i.push(o),n+=e;}}return i}return []}(s,o,a,l);break;case"ENUM":n=function(e,t,i,s,r){const n=t.enumType;if(!n)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const o=e.enums?.[n];if(!o)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${n}`);const a=o.valueType||"UINT16",l=or(t.type,a);let h=lr(s,t.type,a,s.byteLength/l);if(h||(h=s),t.array){if(r)return function(e){const{valuesData:t,numberOfElements:i,arrayOffsets:s,valuesDataBytesLength:r,elementSize:n,enumEntry:o}=e,a=[];for(let e=0;e<i;e++){const i=s[e],l=s[e+1]-s[e];if(l+i>r)break;const h=xr(t,i/n,l/n,o);a.push(h);}return a}({valuesData:h,numberOfElements:i,arrayOffsets:r,valuesDataBytesLength:s.length,elementSize:l,enumEntry:o});const e=t.count;return e?function(e,t,i,s){const r=[];for(let n=0;n<t;n++){const t=xr(e,i*n,i,s);r.push(t);}return r}(h,i,e,o):[]}return xr(h,0,i,o)}(t,i,s,o,a);break;default:throw new Error(`Unknown classProperty type ${i.type}`)}return n}function xr(e,t,i,s){const r=[];for(let n=0;n<i;n++)if(e instanceof BigInt64Array||e instanceof BigUint64Array)r.push("");else {const i=br(s,e[t+n]);r.push(i?i.name:"");}return r}function br(e,t){for(const i of e.values)if(i.value===t)return i;return null}var vr=Object.freeze({__proto__:null,name:pr,decode:async function(e,t){!function(e,t){if(!t.gltf?.loadBuffers)return;const i=e.getExtension(pr);i&&(t.gltf?.loadImages&&function(e,t){const i=t.propertyTextures,s=e.gltf.json;if(i&&s.meshes)for(const r of s.meshes)for(const s of r.primitives)gr(e,i,s,t);}(e,i),function(e,t){const i=t.schema;if(!i)return;const s=i.classes,r=t.propertyTables;if(s&&r)for(const t in s){const s=fr(r,t);s&&Cr(e,i,s);}}(e,i));}(new tr(e),t);}});const wr="undefined"!=typeof __VERSION__?__VERSION__:"latest",Sr="undefined"!=typeof __VERSION__?__VERSION__:"beta",Ar="undefined"!=typeof __VERSION__?__VERSION__:"beta";let Er,Mr,Pr="/basis_encoder.wasm",Rr="/basis_encoder.js";async function Br(e){const t=e.modules||{};return t.basis?t.basis:(Er=Er||async function(e){let t=null,i=null;return [t,i]=await Promise.all([await ti("basis_transcoder.js","textures",e),await ti("basis_transcoder.wasm","textures",e)]),t=t||globalThis.BASIS,await function(e,t){const i={};return t&&(i.wasmBinary=t),new Promise((t=>{e(i).then((e=>{const{BasisFile:i,initializeBasis:s}=e;s(),t({BasisFile:i});}));}))}(t,i)}(e),await Er)}async function Ir(e){const t=e.modules||{};return t.basisEncoder?t.basisEncoder:(Mr=Mr||async function(e){let t=null,i=null;if(e.CDN)Rr=`${e.CDN}/textures/dist${Rr}`,Pr=`${e.CDN}/textures/dist${Pr}`;else {const e=`https://unpkg.com/@loaders.gl/textures@${Ar}/dist/libs`;Rr=`${e}${Rr}`,Pr=`${e}${Pr}`;}return [t,i]=await Promise.all([await ti(Rr,"textures",e),await ti(Pr,"textures",e)]),t=t||globalThis.BASIS,await function(e,t){const i={};return t&&(i.wasmBinary=t),new Promise((t=>{e(i).then((e=>{const{BasisFile:i,KTX2File:s,initializeBasis:r,BasisEncoder:n}=e;r(),t({BasisFile:i,KTX2File:s,BasisEncoder:n});}));}))}(t,i)}(e),await Mr)}const Dr={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},Or=["","WEBKIT_","MOZ_"],Lr={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let Vr=null;var Nr=e.createCommonjsModule((function(e,t){var i,s,r,n,o,a,l,h;t.__esModule=!0,t.KTX2DataFormatChannelUASTC=t.KTX2DataFormatChannelETC1S=t.KTX2DataFormatFlags=t.KTX2DataFormatTransfer=t.KTX2DataFormatPrimaries=t.KTX2DataFormatModel=t.VK_FORMAT_UNDEFINED=t.KHR_DF_BLOCKSIZE=t.KHR_DF_VERSION=t.KHR_DF_VENDORID_KHRONOS=t.KTX2DataFormatType=t.KTX2SupercompressionScheme=t.HEADER_BYTE_LENGTH=t.KTX2_ID=t.NUL=t.KTX_WRITER=void 0,t.KTX_WRITER="KTX-Parse v0.0.4",t.NUL=new Uint8Array([0]),t.KTX2_ID=[171,75,84,88,32,50,48,187,13,10,26,10],t.HEADER_BYTE_LENGTH=68,(i=t.KTX2SupercompressionScheme||(t.KTX2SupercompressionScheme={}))[i.NONE=0]="NONE",i[i.BASISLZ=1]="BASISLZ",i[i.ZSTD=2]="ZSTD",i[i.ZLIB=3]="ZLIB",(s=t.KTX2DataFormatType||(t.KTX2DataFormatType={}))[s.BASICFORMAT=0]="BASICFORMAT",t.KHR_DF_VENDORID_KHRONOS=0,t.KHR_DF_VERSION=2,t.KHR_DF_BLOCKSIZE=40,t.VK_FORMAT_UNDEFINED=0,(r=t.KTX2DataFormatModel||(t.KTX2DataFormatModel={}))[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.ETC1S=163]="ETC1S",r[r.UASTC=166]="UASTC",(n=t.KTX2DataFormatPrimaries||(t.KTX2DataFormatPrimaries={}))[n.UNSPECIFIED=0]="UNSPECIFIED",n[n.SRGB=1]="SRGB",(o=t.KTX2DataFormatTransfer||(t.KTX2DataFormatTransfer={}))[o.UNSPECIFIED=0]="UNSPECIFIED",o[o.LINEAR=1]="LINEAR",o[o.SRGB=2]="SRGB",o[o.ITU=3]="ITU",o[o.NTSC=4]="NTSC",o[o.SLOG=5]="SLOG",o[o.SLOG2=6]="SLOG2",(a=t.KTX2DataFormatFlags||(t.KTX2DataFormatFlags={}))[a.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",a[a.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED",(l=t.KTX2DataFormatChannelETC1S||(t.KTX2DataFormatChannelETC1S={}))[l.RGB=0]="RGB",l[l.RRR=3]="RRR",l[l.GGG=4]="GGG",l[l.AAA=15]="AAA",(h=t.KTX2DataFormatChannelUASTC||(t.KTX2DataFormatChannelUASTC={}))[h.RGB=0]="RGB",h[h.RGBA=3]="RGBA",h[h.RRR=4]="RRR",h[h.RRRG=5]="RRRG";})),Fr=e.createCommonjsModule((function(e,t){t.__esModule=!0,t.KTX2Container=void 0,t.KTX2Container=function(){this.vkFormat=Nr.VK_FORMAT_UNDEFINED,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=Nr.KTX2SupercompressionScheme.NONE,this.levels=[],this.dataFormatDescriptor=[{vendorId:Nr.KHR_DF_VENDORID_KHRONOS,descriptorType:Nr.KTX2DataFormatType.BASICFORMAT,versionNumber:Nr.KHR_DF_VERSION,descriptorBlockSize:Nr.KHR_DF_BLOCKSIZE,colorModel:Nr.KTX2DataFormatModel.UNSPECIFIED,colorPrimaries:Nr.KTX2DataFormatPrimaries.SRGB,transferFunction:Nr.KTX2DataFormatPrimaries.SRGB,flags:Nr.KTX2DataFormatFlags.ALPHA_STRAIGHT,texelBlockDimension:{x:4,y:4,z:1,w:1},bytesPlane:[],samples:[]}],this.keyValue={},this.globalData=null;};})),Gr=e.createCommonjsModule((function(e,t){t.__esModule=!0,t.BufferReader=void 0;var i=function(){function e(e,t,i,s){this._dataView=new DataView(e.buffer,e.byteOffset+t,i),this._littleEndian=s,this._offset=0;}return e.prototype._nextUint8=function(){var e=this._dataView.getUint8(this._offset);return this._offset+=1,e},e.prototype._nextUint16=function(){var e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e},e.prototype._nextUint32=function(){var e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e},e.prototype._nextUint64=function(){var e=this._dataView.getUint32(this._offset,this._littleEndian),t=this._dataView.getUint32(this._offset+4,this._littleEndian),i=e+Math.pow(2,32)*t;return this._offset+=8,i},e.prototype._skip=function(e){return this._offset+=e,this},e.prototype._scan=function(e,t){void 0===t&&(t=0);for(var i=this._offset,s=0;this._dataView.getUint8(this._offset)!==t&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,s)},e}();t.BufferReader=i;})),kr=e.createCommonjsModule((function(e,t){t.__esModule=!0,t.concat=t.decodeText=t.encodeText=void 0,t.encodeText=function(e){return "undefined"!=typeof TextEncoder?(new TextEncoder).encode(e):Buffer.from(e)},t.decodeText=function(e){return "undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):Buffer.from(e).toString("utf8")},t.concat=function(e){for(var t=0,i=0,s=e;i<s.length;i++)t+=(l=s[i]).byteLength;for(var r=new Uint8Array(t),n=0,o=0,a=e;o<a.length;o++){var l=a[o];r.set(new Uint8Array(l),n),n+=l.byteLength;}return r};})),Ur=e.createCommonjsModule((function(e,t){t.__esModule=!0,t.read=void 0,t.read=function(e){var t=new Uint8Array(e.buffer.slice(e.byteOffset,e.byteOffset+Nr.KTX2_ID.length));if(t[0]!==Nr.KTX2_ID[0]||t[1]!==Nr.KTX2_ID[1]||t[2]!==Nr.KTX2_ID[2]||t[3]!==Nr.KTX2_ID[3]||t[4]!==Nr.KTX2_ID[4]||t[5]!==Nr.KTX2_ID[5]||t[6]!==Nr.KTX2_ID[6]||t[7]!==Nr.KTX2_ID[7]||t[8]!==Nr.KTX2_ID[8]||t[9]!==Nr.KTX2_ID[9]||t[10]!==Nr.KTX2_ID[10]||t[11]!==Nr.KTX2_ID[11])throw new Error("Missing KTX 2.0 identifier.");var i=new Fr.KTX2Container,s=17*Uint32Array.BYTES_PER_ELEMENT,r=new Gr.BufferReader(e,Nr.KTX2_ID.length,s,!0);i.vkFormat=r._nextUint32(),i.typeSize=r._nextUint32(),i.pixelWidth=r._nextUint32(),i.pixelHeight=r._nextUint32(),i.pixelDepth=r._nextUint32(),i.layerCount=r._nextUint32(),i.faceCount=r._nextUint32();var n=r._nextUint32();i.supercompressionScheme=r._nextUint32();for(var o=r._nextUint32(),a=r._nextUint32(),l=r._nextUint32(),h=r._nextUint32(),_=r._nextUint64(),c=r._nextUint64(),u=new Gr.BufferReader(e,Nr.KTX2_ID.length+s,3*n*8,!0),d=0;d<n;d++)i.levels.push({levelData:new Uint8Array(e.buffer.slice(e.byteOffset+u._nextUint64(),e.byteOffset+u._nextUint64()+u._nextUint64())),uncompressedByteLength:u._nextUint64()});var m=new Gr.BufferReader(e,o,a,!0),p={vendorId:m._skip(4)._nextUint16(),descriptorType:m._nextUint16(),versionNumber:m._nextUint16(),descriptorBlockSize:m._nextUint16(),colorModel:m._nextUint8(),colorPrimaries:m._nextUint8(),transferFunction:m._nextUint8(),flags:m._nextUint8(),texelBlockDimension:{x:m._nextUint8()+1,y:m._nextUint8()+1,z:m._nextUint8()+1,w:m._nextUint8()+1},bytesPlane:[m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8()],samples:[]},f=(p.descriptorBlockSize/4-6)/4;for(d=0;d<f;d++)p.samples[d]={bitOffset:m._nextUint16(),bitLength:m._nextUint8(),channelID:m._nextUint8(),samplePosition:[m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8()],sampleLower:m._nextUint32(),sampleUpper:m._nextUint32()};i.dataFormatDescriptor.length=0,i.dataFormatDescriptor.push(p);for(var g=new Gr.BufferReader(e,l,h,!0);g._offset<h;){var y=g._nextUint32(),C=g._scan(y),T=kr.decodeText(C),x=g._scan(y-C.byteLength);i.keyValue[T]=T.match(/^ktx/i)?kr.decodeText(x):x,y%4&&g._skip(4-y%4);}if(c<=0)return i;var b=new Gr.BufferReader(e,_,c,!0),v=b._nextUint16(),w=b._nextUint16(),S=b._nextUint32(),A=b._nextUint32(),E=b._nextUint32(),M=b._nextUint32(),P=[];for(d=0;d<n;d++)P.push({imageFlags:b._nextUint32(),rgbSliceByteOffset:b._nextUint32(),rgbSliceByteLength:b._nextUint32(),alphaSliceByteOffset:b._nextUint32(),alphaSliceByteLength:b._nextUint32()});var R=_+b._offset,B=R+S,I=B+A,D=I+E,O=new Uint8Array(e.buffer.slice(e.byteOffset+R,e.byteOffset+R+S)),L=new Uint8Array(e.buffer.slice(e.byteOffset+B,e.byteOffset+B+A)),V=new Uint8Array(e.buffer.slice(e.byteOffset+I,e.byteOffset+I+E)),N=new Uint8Array(e.buffer.slice(e.byteOffset+D,e.byteOffset+D+M));return i.globalData={endpointCount:v,selectorCount:w,imageDescs:P,endpointsData:O,selectorsData:L,tablesData:V,extendedData:N},i};})),Hr=e.createCommonjsModule((function(e,t){var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},i.apply(this,arguments)},s=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var s=Array(e),r=0;for(t=0;t<i;t++)for(var n=arguments[t],o=0,a=n.length;o<a;o++,r++)s[r]=n[o];return s};t.__esModule=!0,t.write=void 0;var r={keepWriter:!1};t.write=function(e,t){void 0===t&&(t={}),t=i(i({},r),t);var n=new ArrayBuffer(0);if(e.globalData){var o=new ArrayBuffer(20+5*e.globalData.imageDescs.length*4),a=new DataView(o);a.setUint16(0,e.globalData.endpointCount,!0),a.setUint16(2,e.globalData.selectorCount,!0),a.setUint32(4,e.globalData.endpointsData.byteLength,!0),a.setUint32(8,e.globalData.selectorsData.byteLength,!0),a.setUint32(12,e.globalData.tablesData.byteLength,!0),a.setUint32(16,e.globalData.extendedData.byteLength,!0);for(var l=0;l<e.globalData.imageDescs.length;l++){var h=e.globalData.imageDescs[l];a.setUint32(20+5*l*4+0,h.imageFlags,!0),a.setUint32(20+5*l*4+4,h.rgbSliceByteOffset,!0),a.setUint32(20+5*l*4+8,h.rgbSliceByteLength,!0),a.setUint32(20+5*l*4+12,h.alphaSliceByteOffset,!0),a.setUint32(20+5*l*4+16,h.alphaSliceByteLength,!0);}n=kr.concat([o,e.globalData.endpointsData,e.globalData.selectorsData,e.globalData.tablesData,e.globalData.extendedData]);}var _=[],c=e.keyValue;for(var u in t.keepWriter||(c=i(i({},e.keyValue),{KTXwriter:Nr.KTX_WRITER})),c){var d=c[u],m=kr.encodeText(u),p="string"==typeof d?kr.encodeText(d):d,f=m.byteLength+1+p.byteLength+1,g=f%4?4-f%4:0;_.push(kr.concat([new Uint32Array([f]),m,Nr.NUL,p,Nr.NUL,new Uint8Array(g).fill(0)]));}var y=kr.concat(_),C=new ArrayBuffer(44),T=new DataView(C);if(1!==e.dataFormatDescriptor.length||e.dataFormatDescriptor[0].descriptorType!==Nr.KTX2DataFormatType.BASICFORMAT)throw new Error("Only BASICFORMAT Data Format Descriptor output supported.");var x=e.dataFormatDescriptor[0];for(T.setUint32(0,44,!0),T.setUint16(4,x.vendorId,!0),T.setUint16(6,x.descriptorType,!0),T.setUint16(8,x.versionNumber,!0),T.setUint16(10,x.descriptorBlockSize,!0),T.setUint8(12,x.colorModel),T.setUint8(13,x.colorPrimaries),T.setUint8(14,x.transferFunction),T.setUint8(15,x.flags),T.setUint8(16,x.texelBlockDimension.x-1),T.setUint8(17,x.texelBlockDimension.y-1),T.setUint8(18,x.texelBlockDimension.z-1),T.setUint8(19,x.texelBlockDimension.w-1),l=0;l<8;l++)T.setUint8(20+l,x.bytesPlane[l]);for(l=0;l<x.samples.length;l++){var b=x.samples[l],v=28+16*l;T.setUint16(v+0,b.bitOffset,!0),T.setUint8(v+2,b.bitLength),T.setUint8(v+3,b.channelID),T.setUint8(v+4,b.samplePosition[0]),T.setUint8(v+5,b.samplePosition[1]),T.setUint8(v+6,b.samplePosition[2]),T.setUint8(v+7,b.samplePosition[3]),T.setUint32(v+8,b.sampleLower,!0),T.setUint32(v+12,b.sampleUpper,!0);}var w=Nr.KTX2_ID.length+Nr.HEADER_BYTE_LENGTH+3*e.levels.length*8,S=w+C.byteLength,A=S+y.byteLength;A%8&&(A+=8-A%8);var E=[],M=new DataView(new ArrayBuffer(3*e.levels.length*8)),P=A+n.byteLength;for(l=0;l<e.levels.length;l++){var R=e.levels[l];E.push(R.levelData),M.setBigUint64(24*l+0,BigInt(P),!0),M.setBigUint64(24*l+8,BigInt(R.levelData.byteLength),!0),M.setBigUint64(24*l+16,BigInt(R.uncompressedByteLength),!0),P+=R.levelData.byteLength;}var B=new ArrayBuffer(Nr.HEADER_BYTE_LENGTH),I=new DataView(B);return I.setUint32(0,e.vkFormat,!0),I.setUint32(4,e.typeSize,!0),I.setUint32(8,e.pixelWidth,!0),I.setUint32(12,e.pixelHeight,!0),I.setUint32(16,e.pixelDepth,!0),I.setUint32(20,e.layerCount,!0),I.setUint32(24,e.faceCount,!0),I.setUint32(28,e.levels.length,!0),I.setUint32(32,e.supercompressionScheme,!0),I.setUint32(36,w,!0),I.setUint32(40,C.byteLength,!0),I.setUint32(44,S,!0),I.setUint32(48,y.byteLength,!0),I.setBigUint64(52,BigInt(A),!0),I.setBigUint64(60,BigInt(n.byteLength),!0),new Uint8Array(kr.concat(s([new Uint8Array(Nr.KTX2_ID).buffer,B,M.buffer,C,y,new ArrayBuffer(A-(S+y.byteLength)),n],E)))};})),zr=e.createCommonjsModule((function(e,t){var i=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[i]}});}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i];}),s=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||t.hasOwnProperty(s)||i(t,e,s);};t.__esModule=!0,s(Fr,t),s(Ur,t),s(Hr,t);})),Wr=e.getDefaultExportFromCjs(zr);function jr(e,t){const i=new Array(t.mipMapLevels);let s=t.width,r=t.height,n=0;for(let o=0;o<t.mipMapLevels;++o){const a=qr(t,s,r,e,o),l=Xr(e,o,n,a);i[o]={compressed:!0,format:t.internalFormat,data:l,width:s,height:r,levelSize:a},s=Math.max(1,s>>1),r=Math.max(1,r>>1),n+=a;}return i}function Xr(e,t,i,s){return Array.isArray(e)?e[t].levelData:new Uint8Array(e.buffer.slice(e.byteOffset+i,e.byteOffset+i+s))}function qr(e,t,i,s,r){return Array.isArray(s)?e.sizeFunction(s[r]):e.sizeFunction(t,i)}const Kr={131:Dr.COMPRESSED_RGB_S3TC_DXT1_EXT,132:Dr.COMPRESSED_SRGB_S3TC_DXT1_EXT,133:Dr.COMPRESSED_RGBA_S3TC_DXT1_EXT,134:Dr.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,135:Dr.COMPRESSED_RGBA_S3TC_DXT3_EXT,136:Dr.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,137:Dr.COMPRESSED_RGBA_S3TC_DXT5_EXT,138:Dr.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,139:Dr.COMPRESSED_RED_RGTC1_EXT,140:Dr.COMPRESSED_SIGNED_RED_RGTC1_EXT,141:Dr.COMPRESSED_RED_GREEN_RGTC2_EXT,142:Dr.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT,147:Dr.COMPRESSED_RGB8_ETC2,148:Dr.COMPRESSED_SRGB8_ETC2,149:Dr.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,150:Dr.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,151:Dr.COMPRESSED_RGBA8_ETC2_EAC,152:Dr.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC,153:Dr.COMPRESSED_R11_EAC,154:Dr.COMPRESSED_SIGNED_R11_EAC,155:Dr.COMPRESSED_RG11_EAC,156:Dr.COMPRESSED_SIGNED_RG11_EAC,157:Dr.COMPRESSED_RGBA_ASTC_4x4_KHR,158:Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR,159:Dr.COMPRESSED_RGBA_ASTC_5x4_KHR,160:Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR,161:Dr.COMPRESSED_RGBA_ASTC_5x5_KHR,162:Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR,163:Dr.COMPRESSED_RGBA_ASTC_6x5_KHR,164:Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR,165:Dr.COMPRESSED_RGBA_ASTC_6x6_KHR,166:Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR,167:Dr.COMPRESSED_RGBA_ASTC_8x5_KHR,168:Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR,169:Dr.COMPRESSED_RGBA_ASTC_8x6_KHR,170:Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR,171:Dr.COMPRESSED_RGBA_ASTC_8x8_KHR,172:Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR,173:Dr.COMPRESSED_RGBA_ASTC_10x5_KHR,174:Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR,175:Dr.COMPRESSED_RGBA_ASTC_10x6_KHR,176:Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR,177:Dr.COMPRESSED_RGBA_ASTC_10x8_KHR,178:Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR,179:Dr.COMPRESSED_RGBA_ASTC_10x10_KHR,180:Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR,181:Dr.COMPRESSED_RGBA_ASTC_12x10_KHR,182:Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR,183:Dr.COMPRESSED_RGBA_ASTC_12x12_KHR,184:Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR,1000054e3:Dr.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,1000054001:Dr.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,1000066e3:Dr.COMPRESSED_RGBA_ASTC_4x4_KHR,1000066001:Dr.COMPRESSED_RGBA_ASTC_5x4_KHR,1000066002:Dr.COMPRESSED_RGBA_ASTC_5x5_KHR,1000066003:Dr.COMPRESSED_RGBA_ASTC_6x5_KHR,1000066004:Dr.COMPRESSED_RGBA_ASTC_6x6_KHR,1000066005:Dr.COMPRESSED_RGBA_ASTC_8x5_KHR,1000066006:Dr.COMPRESSED_RGBA_ASTC_8x6_KHR,1000066007:Dr.COMPRESSED_RGBA_ASTC_8x8_KHR,1000066008:Dr.COMPRESSED_RGBA_ASTC_10x5_KHR,1000066009:Dr.COMPRESSED_RGBA_ASTC_10x6_KHR,1000066010:Dr.COMPRESSED_RGBA_ASTC_10x8_KHR,1000066011:Dr.COMPRESSED_RGBA_ASTC_10x10_KHR,1000066012:Dr.COMPRESSED_RGBA_ASTC_12x10_KHR,1000066013:Dr.COMPRESSED_RGBA_ASTC_12x12_KHR},{read:Jr}=Wr,Zr=[171,75,84,88,32,50,48,187,13,10,26,10];function Yr(e){const t=new Uint8Array(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength));return !(t.byteLength<Zr.length||t[0]!==Zr[0]||t[1]!==Zr[1]||t[2]!==Zr[2]||t[3]!==Zr[3]||t[4]!==Zr[4]||t[5]!==Zr[5]||t[6]!==Zr[6]||t[7]!==Zr[7]||t[8]!==Zr[8]||t[9]!==Zr[9]||t[10]!==Zr[10]||t[11]!==Zr[11])}const Qr={etc1:{basisFormat:0,compressed:!0,format:Dr.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Dr.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Dr.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Dr.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Dr.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Dr.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};function $r(e,t,i){const s=new e(new Uint8Array(t));try{if(!s.startTranscoding())throw new Error("Failed to start basis transcoding");const e=s.getNumImages(),t=[];for(let r=0;r<e;r++){const e=s.getNumLevels(r),n=[];for(let t=0;t<e;t++)n.push(en(s,r,t,i));t.push(n);}return t}finally{s.close(),s.delete();}}function en(e,t,i,s){const r=e.getImageWidth(t,i),n=e.getImageHeight(t,i),o=e.getHasAlpha(),{compressed:a,format:l,basisFormat:h}=rn(s,o),_=e.getImageTranscodedSizeInBytes(t,i,h),c=new Uint8Array(_);if(!e.transcodeImage(c,t,i,h,0,0))throw new Error("failed to start Basis transcoding");return {width:r,height:n,data:c,compressed:a,format:l,hasAlpha:o}}function tn(e,t,i){const s=new e(new Uint8Array(t));try{if(!s.startTranscoding())throw new Error("failed to start KTX2 transcoding");const e=s.getLevels(),t=[];for(let r=0;r<e;r++){t.push(sn(s,r,i));break}return [t]}finally{s.close(),s.delete();}}function sn(e,t,i){const{alphaFlag:s,height:r,width:n}=e.getImageLevelInfo(t,0,0),{compressed:o,format:a,basisFormat:l}=rn(i,s),h=e.getImageTranscodedSizeInBytes(t,0,0,l),_=new Uint8Array(h);if(!e.transcodeImage(_,t,0,0,l,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return {width:n,height:r,data:_,compressed:o,hasAlpha:s,format:a}}function rn(e,t){let i=e&&e.basis&&e.basis.format;return "auto"===i&&(i=on()),"object"==typeof i&&(i=t?i.alpha:i.noAlpha),i=i.toLowerCase(),Qr[i]}function nn(e,t){let i=e&&e.basis&&e.basis.format;return "auto"===i&&(i=on()),"object"==typeof i&&(i=t?i.alpha:i.noAlpha),i=i.toLowerCase(),i}function on(){const e=function(e){if(!Vr){e=e||function(){try{return document.createElement("canvas").getContext("webgl")}catch(e){return null}}(),Vr=new Set;for(const t of Or)for(const i in Lr)e&&e.getExtension(`${t}${i}`)&&Vr.add(Lr[i]);}return Vr}();return e.has("astc")?"astc-4x4":e.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:e.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:e.has("etc1")?"etc1":e.has("etc2")?"etc2":"rgb565"}const an={name:"Basis",id:"basis",module:"textures",version:Sr,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}},parse:async function(e,t){if("auto"===t.basis.containerFormat){if(Yr(e))return tn((await Ir(t)).KTX2File,e,t);const{BasisFile:i}=await Br(t);return $r(i,e,t)}if("encoder"===t.basis.module){const i=await Ir(t);return "ktx2"===t.basis.containerFormat?tn(i.KTX2File,e,t):$r(i.BasisFile,e,t)}{const{BasisFile:i}=await Br(t);return $r(i,e,t)}}},ln={MAGIC_NUMBER:542327876,HEADER_LENGTH:31,MAGIC_NUMBER_INDEX:0,HEADER_SIZE_INDEX:1,HEADER_FLAGS_INDEX:2,HEADER_HEIGHT_INDEX:3,HEADER_WIDTH_INDEX:4,MIPMAPCOUNT_INDEX:7,HEADER_PF_FLAGS_INDEX:20,HEADER_PF_FOURCC_INDEX:21,DDSD_MIPMAPCOUNT:131072,DDPF_FOURCC:4,PIXEL_FORMATS:{DXT1:Dr.COMPRESSED_RGB_S3TC_DXT1_EXT,DXT3:Dr.COMPRESSED_RGBA_S3TC_DXT3_EXT,DXT5:Dr.COMPRESSED_RGBA_S3TC_DXT5_EXT,"ATC ":Dr.COMPRESSED_RGB_ATC_WEBGL,ATCA:Dr.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL,ATCI:Dr.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL},SIZE_FUNCTIONS:{DXT1:hn,DXT3:_n,DXT5:_n,"ATC ":hn,ATCA:_n,ATCI:_n}};function hn(e,t){return (e+3>>2)*(t+3>>2)*8}function _n(e,t){return (e+3>>2)*(t+3>>2)*16}const cn={0:[Dr.COMPRESSED_RGB_PVRTC_2BPPV1_IMG],1:[Dr.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG],2:[Dr.COMPRESSED_RGB_PVRTC_4BPPV1_IMG],3:[Dr.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG],6:[Dr.COMPRESSED_RGB_ETC1_WEBGL],7:[Dr.COMPRESSED_RGB_S3TC_DXT1_EXT],9:[Dr.COMPRESSED_RGBA_S3TC_DXT3_EXT],11:[Dr.COMPRESSED_RGBA_S3TC_DXT5_EXT],22:[Dr.COMPRESSED_RGB8_ETC2],23:[Dr.COMPRESSED_RGBA8_ETC2_EAC],24:[Dr.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2],25:[Dr.COMPRESSED_R11_EAC],26:[Dr.COMPRESSED_RG11_EAC],27:[Dr.COMPRESSED_RGBA_ASTC_4X4_KHR,Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR],28:[Dr.COMPRESSED_RGBA_ASTC_5X4_KHR,Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR],29:[Dr.COMPRESSED_RGBA_ASTC_5X5_KHR,Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR],30:[Dr.COMPRESSED_RGBA_ASTC_6X5_KHR,Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR],31:[Dr.COMPRESSED_RGBA_ASTC_6X6_KHR,Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR],32:[Dr.COMPRESSED_RGBA_ASTC_8X5_KHR,Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR],33:[Dr.COMPRESSED_RGBA_ASTC_8X6_KHR,Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR],34:[Dr.COMPRESSED_RGBA_ASTC_8X8_KHR,Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR],35:[Dr.COMPRESSED_RGBA_ASTC_10X5_KHR,Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR],36:[Dr.COMPRESSED_RGBA_ASTC_10X6_KHR,Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR],37:[Dr.COMPRESSED_RGBA_ASTC_10X8_KHR,Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR],38:[Dr.COMPRESSED_RGBA_ASTC_10X10_KHR,Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR],39:[Dr.COMPRESSED_RGBA_ASTC_12X10_KHR,Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR],40:[Dr.COMPRESSED_RGBA_ASTC_12X12_KHR,Dr.COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR]},un={0:dn,1:dn,2:mn,3:mn,6:pn,7:pn,9:fn,11:fn,22:pn,23:fn,24:pn,25:pn,26:fn,27:fn,28:function(e,t){return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16},29:function(e,t){return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16},30:function(e,t){return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16},31:function(e,t){return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16},32:function(e,t){return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16},33:function(e,t){return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16},34:function(e,t){return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16},35:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16},36:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16},37:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16},38:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16},39:function(e,t){return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16},40:function(e,t){return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16}};function dn(e,t){return (e=Math.max(e,16))*(t=Math.max(t,8))/4}function mn(e,t){return (e=Math.max(e,8))*(t=Math.max(t,8))/2}function pn(e,t){return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8}function fn(e,t){return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16}const gn={name:"Texture Containers",id:"compressed-texture",module:"textures",version:Sr,worker:!0,extensions:["ktx","ktx2","dds","pvr"],mimeTypes:["application/octet-stream","image/vnd-ms.dds","image/ktx","image/ktx2"],binary:!0,options:{"compressed-texture":{libraryPath:"libs/"}},parse:async(e,t)=>function(e){if(Yr(e))return function(e){const t=new Uint8Array(e),i=Jr(t),s=Math.max(1,i.levels.length);return jr(i.levels,{mipMapLevels:s,width:i.pixelWidth,height:i.pixelHeight,sizeFunction:e=>e.uncompressedByteLength,internalFormat:Kr[i.vkFormat]})}(e);if(function(e){return new Uint32Array(e,0,ln.HEADER_LENGTH)[ln.MAGIC_NUMBER_INDEX]===ln.MAGIC_NUMBER}(e))return function(e){const t=new Int32Array(e,0,ln.HEADER_LENGTH),i=t[ln.HEADER_PF_FOURCC_INDEX];St(Boolean(t[ln.HEADER_PF_FLAGS_INDEX]&ln.DDPF_FOURCC),"DDS: Unsupported format, must contain a FourCC code");const s=(r=i,String.fromCharCode(255&r,r>>8&255,r>>16&255,r>>24&255));var r;const n=ln.PIXEL_FORMATS[s],o=ln.SIZE_FUNCTIONS[s];St(n&&o,`DDS: Unknown pixel format ${i}`);let a=1;t[ln.HEADER_FLAGS_INDEX]&ln.DDSD_MIPMAPCOUNT&&(a=Math.max(1,t[ln.MIPMAPCOUNT_INDEX]));const l=t[ln.HEADER_WIDTH_INDEX],h=t[ln.HEADER_HEIGHT_INDEX];return jr(new Uint8Array(e.slice(t[ln.HEADER_SIZE_INDEX]+4)),{mipMapLevels:a,width:l,height:h,sizeFunction:o,internalFormat:n})}(e);if(function(e){const t=new Uint32Array(e,0,13)[0];return 55727696===t||1347834371===t}(e))return function(e){const t=new Uint32Array(e,0,13),i=t[2],s=cn[i]||[],r=s.length>1&&t[4]?s[1]:s[0],n=un[i],o=t[11],a=t[7],l=t[6];return jr(new Uint8Array(e.slice(52+t[12])),{mipMapLevels:o,width:a,height:l,sizeFunction:n,internalFormat:r})}(e);throw new Error("Texture container format not recognized")}(e)};!function(){const e=new Uint32Array([305419896]);new Uint8Array(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength));}(),new Uint8Array([147,78,85,77,80,89]);const yn={id:"crunch",name:"Crunch",module:"textures",version:Sr,worker:!0,extensions:["crn"],mimeTypes:["image/crn","image/x-crn","application/octet-stream"],binary:!0,options:{crunch:{libraryPath:"libs/"}}};let Cn;const Tn={};Tn[0]={pixelFormat:Dr.COMPRESSED_RGB_S3TC_DXT1_EXT,sizeFunction:hn},Tn[1]={pixelFormat:Dr.COMPRESSED_RGBA_S3TC_DXT3_EXT,sizeFunction:_n},Tn[2]={pixelFormat:Dr.COMPRESSED_RGBA_S3TC_DXT5_EXT,sizeFunction:_n};let xn=0,bn=null;const vn={...yn,parse:async function(e,t={}){const i=await async function(e){const t=e.modules||{};return t.crunch?t.crunch:async function(e){if(Cn)return Cn;let t=null;return [t]=await Promise.all([await ti("crunch.js","textures",e)]),t=t||globalThis.LoadCrunchDecoder,Cn=t(),Cn}(e)}(t),s=e.byteLength,r=new Uint8Array(e),n=i._malloc(s);!function(e,t,i,s){let r;const n=i/4,o=s%4,a=new Uint32Array(e.buffer.slice(0,(s-o)/4)),l=new Uint32Array(t.buffer);for(r=0;r<a.length;r++)l[n+r]=a[r];for(r=s-o;r<s;r++)t[i+r]=e[r];}(r,i.HEAPU8,n,s);const o=i._crn_get_dxt_format(n,s);St(Boolean(Tn[o]),"Unsupported format");const a=i._crn_get_levels(n,s),l=i._crn_get_width(n,s),h=i._crn_get_height(n,s),_=Tn[o].sizeFunction;let c=0;for(let e=0;e<a;++e)c+=_(l>>e,h>>e);return xn<c&&(bn&&i._free(bn),bn=i._malloc(c),xn=c),i._crn_decompress(n,s,bn,c,0,a),i._free(n),jr(new Uint8Array(i.HEAPU8.buffer.slice(bn,bn+c)),{mipMapLevels:a,width:l,height:h,sizeFunction:_,internalFormat:Tn[o].pixelFormat})}};var wn;function Sn(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;const i=t&&t.modelFolder?t.modelFolder:t.baseUri||t.uri;if(!i)throw new Error(`'baseUri' must be provided to resolve relative url ${e}`);return t&&t.modelFolder?"/"===t.modelFolder.slice(-1)?t.modelFolder+e:`${t.modelFolder}/${e}`:i.substr(0,i.lastIndexOf("/")+1)+e}wn=vn,"undefined"!=typeof self&&(Qt.onmessage=async(e,t)=>{if("process"===e)try{const{input:e,options:i={}}=t,s=await async function({loader:e,arrayBuffer:t,options:i,context:s}){let r,n;if(e.parseSync||e.parse)r=t,n=e.parseSync||e.parse;else {if(!e.parseTextSync)throw new Error(`Could not load data with ${e.name} loader`);r=(new TextDecoder).decode(t),n=e.parseTextSync;}return i={...i,modules:e&&e.options&&e.options.modules||{},worker:!1},await n(r,{...i},s,e)}({loader:wn,arrayBuffer:e,byteOffset:0,byteLength:0,options:i,context:{parse:si}});Qt.postMessage("done",{result:s});}catch(e){Qt.postMessage("error",{error:e.message});}});const An=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),En=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Mn={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Pn={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};let Rn;const Bn="EXT_meshopt_compression";async function In(e,t){const i=e.getObjectExtension(t,Bn);if(i){const{byteOffset:s=0,byteLength:r=0,byteStride:n,count:o,mode:a,filter:l="NONE",buffer:h}=i,_=e.gltf.buffers[h],c=new Uint8Array(_.arrayBuffer,_.byteOffset+s,r),u=new Uint8Array(e.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);await async function(e,t,i,s,r,n="NONE"){const o=await async function(){return Rn||(Rn=async function(){let e="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB";WebAssembly.validate(An)&&(e="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(function(e){const t=new Uint8Array(e.length);for(let i=0;i<e.length;++i){const s=e.charCodeAt(i);t[i]=s>96?s-71:s>64?s-65:s>47?s+4:s>46?63:62;}let i=0;for(let s=0;s<e.length;++s)t[i++]=t[s]<60?En[t[s]]:64*(t[s]-60)+t[++s];return t.buffer.slice(0,i)}(e),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}()),Rn}();!function(e,t,i,s,r,n,o){const a=e.exports.sbrk,l=s+3&-4,h=a(l*r),_=a(n.length),c=new Uint8Array(e.exports.memory.buffer);c.set(n,_);const u=t(h,s,r,_,n.length);if(0===u&&o&&o(h,l,r),i.set(c.subarray(h,h+s*r)),a(h-a(0)),0!==u)throw new Error(`Malformed buffer data: ${u}`)}(o,o.exports[Pn[r]],e,t,i,s,o.exports[Mn[n||"NONE"]]);}(u,o,n,c,a,l),e.removeObjectExtension(t,Bn);}}var Dn=Object.freeze({__proto__:null,name:Bn,decode:async function(e,t){const i=new tr(e);if(!t?.gltf?.decompressMeshes||!t.gltf?.loadBuffers)return;const s=[];for(const t of e.json.bufferViews||[])s.push(In(i,t));await Promise.all(s),i.removeExtension(Bn);}});const On="EXT_texture_webp";var Ln=Object.freeze({__proto__:null,name:On,preprocess:function(e,t){const i=new tr(e);if(!function(e){if(void 0===Vs[e]){const t=fs?function(e){switch(e){case"image/avif":case"image/webp":return function(e){try{return 0===document.createElement("canvas").toDataURL(e).indexOf(`data:${e}`)}catch{return !1}}(e);default:return !0}}(e):function(e){const t=globalThis.loaders?.imageFormatsNode||["image/png","image/jpeg","image/gif"],i=globalThis.loaders?.parseImageNode;return Boolean(i)&&t.includes(e)}(e);Vs[e]=t;}return Vs[e]}("image/webp")){if(i.getRequiredExtensions().includes(On))throw new Error(`gltf: Required extension ${On} not supported by browser`);return}const{json:s}=i;for(const e of s.textures||[]){const t=i.getObjectExtension(e,On);t&&(e.source=t.source),i.removeObjectExtension(e,On);}i.removeExtension(On);}});const Vn="KHR_texture_basisu";var Nn=Object.freeze({__proto__:null,name:Vn,preprocess:function(e,t){const i=new tr(e),{json:s}=i;for(const e of s.textures||[]){const t=i.getObjectExtension(e,Vn);t&&(e.source=t.source),i.removeObjectExtension(e,Vn);}i.removeExtension(Vn);}});const Fn="undefined"!=typeof __VERSION__?__VERSION__:"latest",Gn="1.4.1",kn=`/draco/versioned/decoders/${Gn}/draco_decoder.js`,Un=`/draco/versioned/decoders/${Gn}/draco_wasm_wrapper.js`,Hn=`/draco/versioned/decoders/${Gn}/draco_decoder.wasm`;let zn;const Wn={POSITION:"POSITION",JOINTS_0:"JOINTS_0",WEIGHTS_0:"WEIGHTS_0",NORMAL:"NORMAL",COLOR:"COLOR",TEX_COORD:"TEXCOORD"},jn={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array};class Xn{constructor(e){this.draco=e,this.drawMode="TRIANGLE",this.metadataQuerier={};}destroy(){}parseSync(e,t={}){this.metadataQuerier=new this.draco.MetadataQuerier;const i=new this.draco.DecoderBuffer;i.Init(new Int8Array(e),e.byteLength);const s=new this.draco.Decoder,r={};let n,o,a;try{const e=s.GetEncodedGeometryType(i);switch(e){case this.draco.TRIANGULAR_MESH:o=new this.draco.Mesh,n=s.DecodeBufferToMesh(i,o),a={type:0,faceCount:o.num_faces(),attributeCount:o.num_attributes(),vertexCount:o.num_points()};break;case this.draco.POINT_CLOUD:o=new this.draco.PointCloud,n=s.DecodeBufferToPointCloud(i,o),a={type:1,attributeCount:o.num_attributes(),vertexCount:o.num_points()};break;default:throw new Error("Unknown DRACO geometry type.")}if(!n.ok()||!o.ptr){const e=`DRACO decompression failed: ${n.error_msg()}`;throw o&&this.draco.destroy(o),new Error(e)}r.loaderData={header:a},this._extractDRACOGeometry(s,o,e,r,t);const l=this._getGeometryMetadata(s,o);r.header={vertexCount:a.vertexCount,boundingBox:xi(r.attributes),metadata:l};}finally{this.draco.destroy(s),this.draco.destroy(i),this.draco.destroy(o),this.draco.destroy(this.metadataQuerier);}return r}_extractDRACOGeometry(e,t,i,s,r){const n=this._getAttributes(e,t,r);if(!n.POSITION)throw new Error("DRACO decompressor: No position attribute found.");return i===this.draco.TRIANGULAR_MESH?(n.indices="TRIANGLE_STRIP"===this.drawMode?this._getMeshStripIndices(e,t):this._getMeshFaceIndices(e,t),s.mode="TRIANGLE_STRIP"===this.drawMode?5:4):s.mode=0,n.indices&&(s.indices={value:n.indices,size:1},delete n.indices),s.attributes=n,s}getPositionAttributeMetadata(e){this.metadata=this.metadata||{},this.metadata.attributes=this.metadata.attributes||{};const t=new this.draco.AttributeQuantizationTransform;if(t.InitFromAttribute(e)){this.metadata.attributes.position.isQuantized=!0,this.metadata.attributes.position.maxRange=t.range(),this.metadata.attributes.position.numQuantizationBits=t.quantization_bits(),this.metadata.attributes.position.minValues=new Float32Array(3);for(let e=0;e<3;++e)this.metadata.attributes.position.minValues[e]=t.min_value(e);}this.draco.destroy(t);}_getAttributes(e,t,i){const s={},r=t.num_points();let n=0,o=0;for(let a=0;a<t.num_attributes();a++){const l=e.GetAttribute(t,a),h=this._getAttributeMetadata(e,t,a),_={uniqueId:l.unique_id(),attributeType:l.attribute_type(),dataType:jn[l.data_type()],size:l.size(),numComponents:l.num_components(),byteOffset:l.byte_offset(),byteStride:l.byte_stride(),normalized:l.normalized(),metadata:h};let c=this._deduceAttributeName(_,i);const{typedArray:u}=this._getAttributeTypedArray(e,t,l,c);"COLOR"===c?(c=`${c}_${n}`,n++):"TEXCOORD"===c&&(c=`${c}_${o}`,o++),s[c]={value:u,size:u.length/r,metadata:h};}return s}_getMeshFaceIndices(e,t){const i=3*t.num_faces(),s=4*i,r=this.draco._malloc(s);e.GetTrianglesUInt32Array(t,s,r);const n=new Uint32Array(this.draco.HEAPF32.buffer.slice(r,r+i));return this.draco._free(r),n}_getMeshStripIndices(e,t){const i=new this.draco.DracoInt32Array;e.GetTriangleStripsFromMesh(t,i);const s=new Uint32Array(i.size());for(let e=0;e<i.size();++e)s[e]=i.GetValue(e);return this.draco.destroy(i),s}_getAttributeTypedArray(e,t,i,s){if(0===i.ptr)throw new Error(`DRACO decode bad attribute ${s}`);const r=jn[i.data_type()],n=i.num_components(),o=t.num_points()*n,a=o*r.BYTES_PER_ELEMENT,l=this._getDracoDataType(r),h=this.draco._malloc(a);e.GetAttributeDataArrayForAllPoints(t,i,l,a,h);const _=new r(this.draco.HEAPF32.buffer,h,o).slice();return this.draco._free(h),{typedArray:_,components:n}}_getDracoDataType(e){switch(e){case Float32Array:return this.draco.DT_FLOAT32;case Int8Array:return this.draco.DT_INT8;case Int16Array:return this.draco.DT_INT16;case Int32Array:return this.draco.DT_INT32;case Uint8Array:return this.draco.DT_UINT8;case Uint16Array:return this.draco.DT_UINT16;case Uint32Array:return this.draco.DT_UINT32;default:return this.draco.DT_INVALID}}_deduceAttributeName(e,t){const{extraAttributes:i={}}=t;if(i&&"object"==typeof i)for(const[t,s]of Object.entries(i))if(s===e.uniqueId)return t;for(const t in Wn)if(e.attributeType===this.draco[t])return Wn[t];if(e.metadata){const i=t.attributeNameEntry||"name";if(e.metadata[i])return e.metadata[i].string}return `CUSTOM_ATTRIBUTE_${e.uniqueId}`}_getGeometryMetadata(e,t){const i=e.GetMetadata(t);return this._queryDracoMetadata(i)}_getAttributeMetadata(e,t,i){const s=e.GetAttributeMetadata(t,i);return this._queryDracoMetadata(s)}_queryDracoMetadata(e){if(!e||!e.ptr)return {};const t={},i=this.metadataQuerier.NumEntries(e),s=new this.draco.DracoInt32Array;for(let r=0;r<i;r++){const i=this.metadataQuerier.GetEntryName(e,r);this.metadataQuerier.GetIntEntryArray(e,i,s);const n=s.size(),o=new Int32Array(n);for(let e=0;e<n;e++)o[e]=s.GetValue(e);t[i]={int:this.metadataQuerier.GetIntEntry(e,i),string:this.metadataQuerier.GetStringEntry(e,i),double:this.metadataQuerier.GetDoubleEntry(e,i),intArray:o};}return this.draco.destroy(s),t}decode(e,t){return this.parseSync(e,t)}}const qn={name:"Draco",id:"draco",module:"draco",version:Fn,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:"object"==typeof WebAssembly?"wasm":"js",libraryPath:"libs/",extraAttributes:{}}},parse:async function(e,t,i,s){const{draco:r}=await async function(e){const t=e.modules||{};return zn=t.draco3d?zn||t.draco3d.createDecoderModule({}).then((e=>({draco:e}))):zn||async function(e){let t,i;"js"===(e.draco&&e.draco.decoderType)?t=await ti(`${kn}`,"draco",e):[t,i]=await Promise.all([await ti(`${Un}`,"draco",e),await ti(`${Hn}`,"draco",e)]),t=t||globalThis.DracoDecoderModule;const s=await function(e,t){const i={};return t&&(i.wasmBinary=t),new Promise((t=>{e({...i,onModuleLoaded:e=>t({draco:e})});}))}(t,i);return s}(e),await zn}(t),n=new Xn(r);try{return n.parseSync(e,{extraAttributes:t.draco&&t.draco.extraAttributes||null,...t.parseOptions||{}})}finally{n.destroy();}}};function Kn(e,t){const{buffer:i,size:s,count:r}=function(e,t){let i=e,s=1,r=0;return e&&e.value&&(i=e.value,s=e.size||1),i&&(ArrayBuffer.isView(i)||(i=function(e,t,i=!1){return e?Array.isArray(e)?new t(e):!i||e instanceof t?e:new t(e):null}(i,Float32Array)),r=i.length/s),{buffer:i,size:s,count:r}}(e);return {value:i,size:s,bufferView:null,byteOffset:0,count:r,type:Ys(s),componentType:Qs(i)}}async function Jn(e,t,i,s){const r=t.getObjectExtension(e,Gs);let n=t.getTypedArrayDataForBufferViewInSimple(r.bufferView);const{_parse:o}=s,a={...i};delete a["3d-tiles"];const l=await o(n,qn,a,s);n=null,e.attributes=function(e){const t={};for(const i in e)if("indices"!==i){const s=Kn(e[i]);t[i]=s;}return t}(l.attributes),e.boundingBox={min:l.header.boundingBox[0],max:l.header.boundingBox[1]},l.indices&&(e.indices=Kn(l.indices)),function(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("Empty glTF primitive detected: Draco decompression failure?")}(e);}function Zn(e,t,i=4,s,r){if(!s.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const n=s.DracoWriter.encodeSync({attributes:e}),{parseSync:o}=r,a=o({attributes:e}),l=s._addFauxAttributes(a.attributes),h=s.addBufferView(n);return {primitives:[{attributes:l,mode:i,extensions:{[Gs]:{bufferView:h,attributes:l}}}]}}var Yn=Object.freeze({__proto__:null,decode:async function(e,t,i){if(!t.gltf.decompressMeshes)return;const s=new tr(e),r=[];for(const e of function*(e){for(const t of e.json.meshes||[])for(const e of t.primitives)yield e;}(s))s.getObjectExtension(e,Gs)&&r.push(Jn(e,s,t,i));await Promise.all(r),s.removeExtension(Gs);},encode:function(e,t={}){const i=new tr(e);for(const e of i.json.meshes||[])Zn(e),i.addRequiredExtension(Gs);}});const Qn="KHR_texture_transform",$n=Qn,eo=new e.Vector3,to=new e.Matrix3,io=new e.Matrix3;function so(e,t){const i=[],s=t.json.materials?.[e],r=s?.baseColorTexture;r&&ro(t,e,r,i);const n=s?.emissiveTexture;n&&ro(t,e,n,i);const o=s?.normalTexture;o&&ro(t,e,o,i);const a=s?.occlusionTexture;a&&ro(t,e,a,i);const l=s?.pbrMetallicRoughness?.metallicRoughnessTexture;l&&ro(t,e,l,i);}function ro(t,i,s,r){const n=function(t,i){const s=t.extensions?.[Qn];if(!s)return null;const{texCoord:r=0}=t,{texCoord:n=r}=s;if(-1===i.findIndex((([e,t])=>e===r&&t===n))){const o=function(t){const{offset:i=[0,0],rotation:s=0,scale:r=[1,1]}=t,n=(new e.Matrix3).set(1,0,0,0,1,0,i[0],i[1],1),o=to.set(Math.cos(s),Math.sin(s),0,-Math.sin(s),Math.cos(s),0,0,0,1),a=io.set(r[0],0,0,0,r[1],0,0,0,1);return n.multiplyRight(o).multiplyRight(a)}(s);return r!==n&&(t.texCoord=n),i.push([r,n]),{originalTexCoord:r,texCoord:n,matrix:o}}return null}(s,r);if(!n)return;const o=t.json.meshes||[];for(const e of o)for(const s of e.primitives){const e=s.material;Number.isFinite(e)&&i===e&&no(t,s,n);}}function no(e,t,i){const{originalTexCoord:s,texCoord:r,matrix:n}=i,o=t.attributes[`TEXCOORD_${s}`];if(Number.isFinite(o)){const i=e.json.accessors?.[o];if(i&&i.bufferView){const o=e.json.bufferViews?.[i.bufferView];if(o){const{arrayBuffer:a,byteOffset:l}=e.buffers[o.buffer],h=(l||0)+(i.byteOffset||0)+(o.byteOffset||0),{ArrayType:_,length:c}=$s(i),u=zs[i.type],d=o.byteStride||Ws[i.componentType]*u,m=new Float32Array(c);for(let e=0;e<i.count;e++){const t=new _(a,h+e*d,2);eo.set(t[0],t[1],1),eo.transformByMatrix3(n),m.set([eo[0],eo[1]],e*u);}s===r?function(e,t,i,s){e.componentType=5126,i.push({arrayBuffer:s.buffer,byteOffset:0}),t.buffer=i.length-1,t.byteOffset=0,delete t.byteStride;}(i,o,e.buffers,m):function(e,t,i,s,r){s.buffers.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength});const n=s.json.bufferViews;if(!n)return;n.push({buffer:s.buffers.length-1,byteLength:r.buffer.byteLength,byteOffset:0});const o=s.json.accessors;o&&(o.push({bufferView:n?.length-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),i.attributes[`TEXCOORD_${e}`]=o.length-1);}(r,i,t,e,m);}}}}var oo=Object.freeze({__proto__:null,name:$n,decode:async function(e,t){if(!new tr(e).hasExtension(Qn)||!t.gltf?.loadBuffers)return;const i=e.json.materials||[];for(let t=0;t<i.length;t++)so(t,e);}}),ao=Object.freeze({__proto__:null,decode:function(e,t){const i=new tr(e),{json:s}=i,r=i.getExtension(ks);r&&(i.json.lights=r.lights,i.removeExtension(ks));for(const e of s.nodes||[]){const t=i.getObjectExtension(e,ks);t&&(e.light=t.light),i.removeObjectExtension(e,ks);}},encode:function(e,t){const i=new tr(e),{json:s}=i;if(s.lights){const e=i.addExtension(ks);Ns(!e.lights),e.lights=s.lights,delete s.lights;}if(i.json.lights){for(const e of i.json.lights)i.addObjectExtension(e.node,ks,e);delete i.json.lights;}}});function lo(e,t){const i=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach((t=>{e.uniforms[t].value&&!(t in i)&&(i[t]=e.uniforms[t].value);})),Object.keys(i).forEach((e=>{"object"==typeof i[e]&&void 0!==i[e].index&&(i[e].texture=t.getTexture(i[e].index));})),i}const ho=[vr,mr,Dn,Ln,Nn,Yn,ao,Object.freeze({__proto__:null,decode:function(e,t){const i=new tr(e),{json:s}=i;i.removeExtension(Us);for(const e of s.materials||[])e.extensions&&e.extensions.KHR_materials_unlit&&(e.unlit=!0),i.removeObjectExtension(e,Us);},encode:function(e,t){const i=new tr(e),{json:s}=i;if(i.materials)for(const e of s.materials)e.unlit&&(delete e.unlit,i.addObjectExtension(e,Us,{}),i.addExtension(Us));}}),Object.freeze({__proto__:null,decode:function(e,t){const i=new tr(e),{json:s}=i,r=i.getExtension(Hs);if(r){const e=function({programs:e=[],shaders:t=[],techniques:i=[]},s){const r=new TextDecoder;return t.forEach((e=>{if(!Number.isFinite(e.bufferView))throw new Error("KHR_techniques_webgl: no shader code");e.code=r.decode(s.getTypedArrayForBufferView(e.bufferView));})),e.forEach((e=>{e.fragmentShader=t[e.fragmentShader],e.vertexShader=t[e.vertexShader];})),i.forEach((t=>{t.program=e[t.program];})),i}(r,i);for(const t of s.materials||[]){const s=i.getObjectExtension(t,Hs);s&&(t.technique=Object.assign({},s,e[s.technique]),t.technique.values=lo(t.technique,i)),i.removeObjectExtension(t,Hs);}i.removeExtension(Hs);}},encode:function(e,t){}}),oo];function _o(e,t){const i=t?.gltf?.excludeExtensions||{};return !(e in i&&!i[e])}const co={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},uo={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class mo{constructor(e){this.idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};}normalize(e,t){this.json=e.json;const i=e.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case 1:case"1.0":break;default:return}if(!t.normalize)throw new Error("glTF v1 is not supported.");this._addAsset(i),this._convertTopLevelObjectsToArrays(i),function(e){const t=new tr(e),{json:i}=t;for(const e of i.images||[]){const i=t.getObjectExtension(e,Fs);i&&Object.assign(e,i);}i.buffers&&i.buffers[0]&&delete i.buffers[0].uri,t.removeExtension(Fs);}(e),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i),e.buffers=i.buffers,e.images=i.images;}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl";}_convertTopLevelObjectsToArrays(e){for(const t in co)this._convertTopLevelObjectToArray(e,t);}_convertTopLevelObjectToArray(e,t){const i=e[t];if(i&&!Array.isArray(i)){e[t]=[];for(const s in i){const r=i[s];r.id=r.id||s;const n=e[t].length;e[t].push(r),this.idToIndexMap[t][s]=n;}}}_convertObjectIdsToArrayIndices(e){for(const t in co)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t);}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"));}_convertMeshIds(e){for(const t of e.primitives){const{attributes:e,indices:i,material:s}=t;for(const t in e)e[t]=this._convertIdToIndex(e[t],"accessor");i&&(t.indices=this._convertIdToIndex(i,"accessor")),s&&(t.material=this._convertIdToIndex(s,"material"));}}_convertNodeIds(e){e.children&&(e.children=e.children.map((e=>this._convertIdToIndex(e,"node")))),e.meshes&&(e.meshes=e.meshes.map((e=>this._convertIdToIndex(e,"mesh"))));}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map((e=>this._convertIdToIndex(e,"node"))));}_convertIdsToIndices(e,t){e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(const i of e[t])for(const e in i){const t=this._convertIdToIndex(i[e],e);i[e]=t;}}_convertIdToIndex(e,t){const i=uo[t];if(i in this.idToIndexMap){const s=this.idToIndexMap[i][e];if(!Number.isFinite(s))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return s}return e}_updateObjects(e){for(const e of this.json.buffers)delete e.type;}_updateMaterial(e){for(const t of e.materials){t.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const i=t.values?.tex||t.values?.texture2d_0||t.values?.diffuseTex,s=e.textures.findIndex((e=>e.id===i));-1!==s&&(t.pbrMetallicRoughness.baseColorTexture={index:s});}}}var po=/\s/,fo=/^\s+/,go=/^[-+]0x[0-9a-f]+$/i,yo=/^0b[01]+$/i,Co=/^0o[0-7]+$/i,To=parseInt;function xo(t){if("number"==typeof t)return t;if(function(t){return "symbol"==typeof t||e.isObjectLike(t)&&"[object Symbol]"==e.baseGetTag(t)}(t))return NaN;if(e.isObject(t)){var i="function"==typeof t.valueOf?t.valueOf():t;t=e.isObject(i)?i+"":i;}if("string"!=typeof t)return 0===t?t:+t;var s;t=(s=t)?s.slice(0,function(e){for(var t=e.length;t--&&po.test(e.charAt(t)););return t}(s)+1).replace(fo,""):s;var r=yo.test(t);return r||Co.test(t)?To(t.slice(2),r?2:8):go.test(t)?NaN:+t}var bo=function(){return e.root.Date.now()},vo=Math.max,wo=Math.min;class So extends e.Object3D{constructor(t,i){super(),this.shadowNear=10,this.shadowFar=1e3,this.textureSize=512,this.epsilon=.01,this.mapSizeScale=1,this.shadowRepaint=!0,this.id=e.uuid(),this.type="Light",this.color=e.Color.parse(t).toVector3(),this.intensity=i;}setOptions(t,i){"color"==t?this.color=e.Color.parse(i).toVector3():"intensity"==t?this.intensity=i:console.log(`光源不支持该属性的修改 ${t}`);}setShadowOptions(e){for(const t in e)switch(t){case"shadowFar":this.shadowFar=e[t];break;case"shadowNear":this.shadowNear=e[t];break;case"epsilon":this.epsilon=e[t];break;case"mapSizeScale":this.mapSizeScale=e[t];break;case"size":this.textureSize=e[t];}}}class Ao{constructor(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new e.Vector2(512,512),this.map=null,this.matrix=new e.Matrix4,this._projScreenMatrix=new e.Matrix4,this._frustum=new s,this._frameExtents=new e.Vector2(1,1),this._viewportCount=1,this._viewports=[new e.Vector4(0,0,1,1)],this._enabled=!0;}get enabled(){return this._enabled}set enabled(e){this._enabled=e;}getFrustum(){return this._frustum}getViewportCount(){return this._viewportCount}updateMatrices(e){let t=this._projScreenMatrix;const i=this.camera,s=this.matrix,r=this._lookTarget,n=this._lightPositionWorld;n.setFromMatrixPosition(e.matrixWorld),i.position.copy(n),r.setFromMatrixPosition(e.target.matrixWorld),i.lookAt(r),i.updateMatrixWorld(),t=i.projectionMatrix.clone().multiplyRight(i.matrixWorldInverse),this._frustum.setFromMatrix(t),s.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),s.multiplyRight(i.projectionMatrix),s.multiplyRight(i.matrixWorldInverse);}getViewport(e){return this._viewports[e]}}class Eo extends Ao{constructor(){super(new l(10,1,.5,500)),this.isDirectionalLightShadow=!0;}updateMatrices(e){super.updateMatrices(e);}}class Mo extends So{constructor(t,i){super(t,i),this.type="DirectionalLight",this.isDirectionalLight=!0,this.position.copy(e.DefaultUp),this.updateMatrix(),this.target=new e.Object3D,this.shadow=new Eo,this._lightPosition=new e.Vector3(0,0,0),this._targetPosition=new e.Vector3(0,0,0),this.lightDirection=new e.Vector3(0,0,0);}setPosition(t,i=new e.Vector3(0,0,0)){this._lightPosition=t,this._targetPosition=i,t=e.Vector3.unpack(t),i=e.Vector3.unpack(i),this.lightDirection=e.Vector3.normalize(e.Vector3.subtract(t,i,new e.Vector3),new e.Vector3);}getLightDirection(){return this.lightDirection}serialize(){return {color:e.Vector3.pack(this.color,new Array(3)),intensity:this.intensity,lightPosition:this._lightPosition,targetPosition:this._targetPosition,type:this.type}}}const Po=Math.PI/180,Ro=23.4397*Po;function Bo(e,t,i){const s=Po*-i,r=Po*t,n=function(e){return function(e){return e/864e5-.5+2440588}(e)-2451545}(e),o=function(e){const t=function(e){const t=e;return t+Po*(1.9148*Math.sin(t)+.02*Math.sin(2*t)+3e-4*Math.sin(3*t))+102.9372*Po+Math.PI}(Po*(357.5291+.98560028*e));return {declination:Do(t,0),rightAscension:Io(t,0)}}(n),a=function(e,t){return Po*(280.147+360.9856235*e)-t}(n,s)-o.rightAscension;return {azimuth:Oo(a,r,o.declination),altitude:Lo(a,r,o.declination)}}function Io(e,t){const i=e;return Math.atan2(Math.sin(i)*Math.cos(Ro)-Math.tan(t)*Math.sin(Ro),Math.cos(i))}function Do(e,t){const i=e;return Math.asin(Math.sin(t)*Math.cos(Ro)+Math.cos(t)*Math.sin(Ro)*Math.sin(i))}function Oo(e,t,i){const s=e,r=t,n=i;return Math.atan2(Math.sin(s),Math.cos(s)*Math.sin(r)-Math.tan(n)*Math.cos(r))}function Lo(e,t,i){const s=e,r=t,n=i;return Math.asin(Math.sin(r)*Math.sin(n)+Math.cos(r)*Math.cos(n)*Math.cos(s))}function Vo(e){if(1===e)return 0;if(2===e)return 31;if(3===e)return 59;if(4===e)return 90;if(5===e)return 120;if(6===e)return 151;if(7===e)return 181;if(8===e)return 212;if(9===e)return 243;if(10===e)return 273;if(11===e)return 304;if(12===e)return 334;throw new Error("Error transMonth2Day Not Int!")}function No(t){const i=new Date(t),s=Vo(i.getMonth()+1),r=[180-15*(i.getHours()+i.getMinutes()/60-8),23.45*Math.sin(360*(s+i.getDate()-80)/370*Math.PI/180)],n=e.Transforms.cartographicToCartesian3([r[0],r[1],0]);return new e.Vector3(n)}class Fo extends Mo{constructor(e,t,i){super(e,t),this._cached={},this._timestamp=null==i?Date.now():i,this.type="SunLight";}set timestamp(e){this._timestamp=e;}get timestamp(){return this._timestamp}getSunPosition(e,t){return Bo(this._timestamp,e,t)}getSunPositionWithCache(e,t){if(this._cached.position){if(this._timestamp!==this._cached.position.timestamp||e!==this._cached.position.latitude||t!==this._cached.position.longitude){const i=this.getSunPosition(e,t);this._cached.position={timestamp:this._timestamp,latitude:e,longitude:t,azimuth:i.azimuth,altitude:i.altitude};}}else {const i=this.getSunPosition(e,t);this._cached.position={timestamp:this._timestamp,latitude:e,longitude:t,azimuth:i.azimuth,altitude:i.altitude};}return {azimuth:this._cached.position.azimuth,altitude:this._cached.position.altitude}}getSunDirection(t,i){return e.Vector3.normalize(new e.Vector3(function(e,t,i){const{azimuth:s,altitude:r}=Bo(e,t,i),n=s+Math.PI;return [-Math.sin(n),Math.cos(n),-Math.sin(r)]}(this.timestamp,t,i)),new e.Vector3).multiplyScalar(-1)}getSunDirectionWithCache(e,t){return this._cached.direction&&this._timestamp===this._cached.direction.timestamp&&e===this._cached.direction.latitude&&t===this._cached.direction.longitude||(this._cached.direction={timestamp:this._timestamp,latitude:e,longitude:t,direction:this.getSunDirection(e,t)}),this._cached.direction.direction}getSunDirectionGlobalWithCache(){return this._cached["g-direction"]?this._timestamp!==this._cached["g-direction"].timestamp&&(this._cached["g-direction"]={timestamp:this._timestamp,direction:No(this._timestamp)}):this._cached["g-direction"]={timestamp:this._timestamp,direction:No(this._timestamp)},this._cached["g-direction"].direction}serialize(){return {color:e.Vector3.pack(this.color,new Array(3)),intensity:this.intensity,timeStamp:this.timestamp,type:this.type}}}class Go{constructor(e,t,i,s,r){this.context=e;const n=e.gl;this.dynamicDraw=Boolean(i),this.type=s,this.unbindVAO(),r?this.buffer=r:(this.buffer=n.createBuffer(),e.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,t.arrayBuffer?t.arrayBuffer:t,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW));}getBuffer(){return this.buffer}unbindVAO(){this.context.extVertexArrayObject&&this.context.bindVertexArrayOES.set(null);}bind(){this.context.bindElementBuffer.set(this.buffer);}updateData(e){const t=this.context.gl,i=e.arrayBuffer?e.arrayBuffer:e;this.unbindVAO(),this.bind(),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,this.dynamicDraw?t.DYNAMIC_DRAW:t.STATIC_DRAW);}destroy(){this.context&&this.context.gl&&this.buffer&&(this.context.gl.deleteBuffer(this.buffer),this.buffer=null,this.context=null,delete this.buffer);}}class ko{constructor(){}load(t){const{map:i,texUrl:s}=t,r=i.painter.textureResourceManager,n=r.getTextureByName(s);if(n)return n;const o=new e.Texture(t);return o.load(s,t.loaded),r.addTexture(s,o),o}}class Uo extends e.Material{constructor(t={}){super(t);const{type:i,pbrMetallicRoughness:s,emissiveTexture:r,emissiveFactor:n,occlusionTexture:o,normalTexture:a,brdfTexture:l,specularGlossinessTexture:h,color:_,metalness:c,roughness:u,hasNormal:d,hasTangent:m,hasVertexColor:p,extensions:f,hasMorph:g,hasMorphNormal:y,hasMorphTangent:C,isInstance:T,useStencilTest:x,doubleSided:b,clippingPlanes:v,skins:w,useIBL:S,alphaMode:A}=t;if(this.doubleSided=b,this.type=i||"gltfPBR",this.useStencilTest=x||!1,this.isInstance=T,this._emissiveTexture=r,this._occlusionTexture=o,this._hasNormal=e.defaultValue(d,!0),this._hasTangent=m,this._hasVertexColor=p,this._opacity=1,this._normalTexture=a,a&&a instanceof e.Texture&&(this._normalTexture=this._getGltfTextureWrapObjectFromTexture(a)),this._baseColorTexture=s?.baseColorTexture,t.baseColorTexture&&t.baseColorTexture instanceof e.Texture&&(this._baseColorTexture=this._getGltfTextureWrapObjectFromTexture(t.baseColorTexture)),this._brdfTexture=l,this._specularGlossinessTexture=h,this._metallicRoughnessTexture=s?.metallicRoughnessTexture,t.metallicRoughnessTexture&&t.metallicRoughnessTexture instanceof e.Texture&&(this._metallicRoughnessTexture=this._getGltfTextureWrapObjectFromTexture(t.metallicRoughnessTexture)),this._baseColorFactor=s?.baseColorFactor?e.Color.parse(s?.baseColorFactor).toVector4():new e.Vector4([1,1,1,1]),this._metallicFactor=e.defaultValue(s?.metallicFactor,.1),this._roughnessFactor=e.defaultValue(s?.roughnessFactor,.5),_){this.isForGeometry=!0;const t=e.Color.parse(_);this._baseColorFactor.set(t.r,t.g,t.b,t.a);}this._isValid(c)&&(this._metallicFactor=c),this._isValid(u)&&(this._roughnessFactor=u),this._emissiveFactor=new e.Vector3(n||[1,1,1]),this._specialLight=new e.Vector4([1.01,1.9,1.01,0]),this._lightExposure=1,this.hasMorph=g,this._hasMorphNormal=y,this._hasMorphTangent=C,this._useSkins=e.defaultValue(w,!1),this._useIBL=e.defaultValue(S,!1),this._usePBR=!0,this._specialcolor=[new e.Vector4([1,0,0,1]),new e.Vector4([1,1,0,1]),new e.Vector4([1,0,1,1]),new e.Vector4([0,1,1,1])],this._khrValues=new e.Vector4([0,0,0,0]),this.selectionDepth=-1,this.clippingPlanes=v,this.backCulling=void 0,this.alphaMode=e.defaultValue(A,"BLEND"),this._buildPBRDefines(),this._processExtension(f);}_isValid(e){return null!=e&&null!=e&&(this.isForGeometry=!0,!0)}_getGltfTextureWrapObjectFromTexture(e){this.isForGeometry=!0;const t={texture:{_texture:e,sampler:{parameters:{}}}};return e.wrapS&&(t.texture.sampler.wrapS=e.wrapS),e.wrapT&&(t.texture.sampler.wrapT=e.wrapT),e.minFilter&&(t.texture.sampler.minFilter=e.minFilter),e.magFilter&&(t.texture.sampler.magFilter=e.magFilter),t}updateProperty(t){t.baseColorTexture&&t.baseColorTexture instanceof e.Texture&&(this._baseColorTexture=this._getGltfTextureWrapObjectFromTexture(t.baseColorTexture));}updateTexture(t){const i=t.texType,s=e.defined(t.opacity)?t.opacity:1;let r,n;switch(i){case"Color":r=e.Color.parse(t.colorTexture),this._baseColorFactor.set(r.r,r.g,r.b,r.a*s);break;case"Image":n=(new ko).load({map:t.map,texUrl:t.texUrl}),this._opacity=s,this._baseColorTexture=this._getGltfTextureWrapObjectFromTexture(n);}}_processUniforms(t){if(this._uniformCreated)return;this._uniformCreated=!0;for(let e=0;e<this._specialcolor.length;e++)this._uniforms.set(`u_specialcolor[${e}].color`,(()=>this._specialcolor[e]));this._uniforms.set("u_BaseColorFactor",(()=>this._baseColorFactor)),this._uniforms.set("u_HAS_BASECOLORMAP",(()=>!!this._baseColorTexture)),this._uniforms.set("u_Opacity",(()=>this._opacity)),this._uniforms.set("u_useKhr",(()=>!1)),this._uniforms.set("u_khrValues",(()=>this._khrValues));const i=e.spec.phongLightConfig.Ambient.default,s=e.spec.phongLightConfig.Diffuse.default,r=e.spec.phongLightConfig.SpecularColor.default,n=e.spec.phongLightConfig.Shininess.default;this._uniforms.set("u_LightMaterial",{Ambient:()=>new e.Vector3(i,i,i),Diffuse:()=>new e.Vector3(s,s,s),SpecularColor:()=>new e.Vector3(r,r,r),Shininess:()=>n}),this._baseColorTexture?this._uniforms.set("u_BaseColorSampler",(()=>this._getUniformBindTexture(this._baseColorTexture))):this._uniforms.set("u_reflect",(()=>0)),this._uniforms.set("u_MetallicRoughnessValues",(()=>new e.Vector2(this._metallicFactor,this._roughnessFactor))),this._uniforms.set("u_HAS_METALROUGHNESSMAP",(()=>!!this._metallicRoughnessTexture)),this._metallicRoughnessTexture&&this._uniforms.set("u_MetallicRoughnessSampler",(()=>this._getUniformBindTexture(this._metallicRoughnessTexture))),this._uniforms.set("u_NormalScale",(()=>1)),this._normalTexture&&this._uniforms.set("u_NormalSampler",(()=>this._getUniformBindTexture(this._normalTexture))),this._uniforms.set("u_HAS_OCCLUSIONMAP",(()=>!!this._occlusionTexture)),this._occlusionTexture&&(this._uniforms.set("u_OcclusionSampler",(()=>this._getUniformBindTexture(this._occlusionTexture))),this._uniforms.set("u_OcclusionStrength",(()=>.1))),this._uniforms.set("u_HAS_EMISSIVEMAP",(()=>!!this._emissiveTexture)),this._emissiveTexture&&this._uniforms.set("u_EmissiveSampler",(()=>this._getUniformBindTexture(this._emissiveTexture))),this._uniforms.set("u_EmissiveFactor",(()=>this._emissiveFactor)),this._uniforms.set("u_brdfLUT",(()=>{const i=t.iBLTextures.mBrdfTex;return i?(i.sampler={minificationFilter:e.WebGLConstants.LINEAR,magnificationFilter:e.WebGLConstants.LINEAR,wrapS:e.WebGLConstants.CLAMP_TO_EDGE,wrapT:e.WebGLConstants.CLAMP_TO_EDGE,continueBindTextureOnExit:!0},i):t.context.defaultTexture})),this._uniforms.set("u_DiffuseEnvSampler",(()=>{const e=t.iBLTextures.mDiffuseEnvTex;return e?(e.bind(),e):null})),this._uniforms.set("u_SpecularEnvSampler",(()=>{const e=t.iBLTextures.mSpecularEnvTex;return e?(e.bind(),e):null})),this._uniforms.set("u_HasSkinning",(()=>this._useSkins)),this._uniforms.set("u_Reflectivity",(()=>1)),this._uniforms.set("u_Shininess",(()=>30));}_processExtension(){}_getUniformBindTexture(t){const i=t.texture._texture,s=t.texture.sampler;return t.texture.source=void 0,i.sampler={minificationFilter:s.parameters&&s?.parameters[e.WebGLConstants.TEXTURE_MIN_FILTER]||s?.minFilter||e.WebGLConstants.LINEAR_MIPMAP_NEAREST,magnificationFilter:s.parameters&&s?.parameters[e.WebGLConstants.TEXTURE_MAG_FILTER]||s?.magFilter||e.WebGLConstants.LINEAR,wrapS:s.parameters&&s?.parameters[e.WebGLConstants.TEXTURE_WRAP_S]||s?.wrapS||e.WebGLConstants.REPEAT,wrapT:s.parameters&&s?.parameters[e.WebGLConstants.TEXTURE_WRAP_T]||s?.wrapT||e.WebGLConstants.REPEAT},i}enableIBL(){this._useIBL=!0;}disableIBL(){this._useIBL=!1;}set programId(e){this.type=e;}get programId(){return this.type}get specialLight(){return this._specialLight}set specialLight(e){this._specialLight=e;}get lightExposure(){return this._lightExposure}set lightExposure(e){this._lightExposure=e;}get baseColor(){return this._baseColorFactor}set baseColor(e){this._baseColorFactor=e;}get metallic(){return this._metallicFactor}set metallic(e){this._metallicFactor=e;}get roughness(){return this._roughnessFactor}set roughness(e){this._roughnessFactor=e;}get emissive(){return this._emissiveFactor}set emissive(e){this._emissiveFactor=e;}get brdfTexture(){return this._brdfTexture}set brdfTexture(e){this._brdfTexture=e;}get diffuseTexture(){return this._diffuseTexture}set diffuseTexture(e){this._diffuseTexture=e;}get specularTexture(){return this._specularTexture}set specularTexture(e){this._specularTexture=e;}update(t,i,s={}){if(this._processUniforms(t),!t)throw new Error("pbr material 更新失败，painter为空");super.update(t,i,s),this.defines=this._updateDefines(),this._updateRenderState(),this._createDynamicUniform(t,i);const{primitive:r}=s,n=new e.Matrix4(r.matrixWorld).invert(new e.Matrix4);this._uniforms.set("u_cameraLocalPosition",(()=>{const t=new e.Vector4(i.camera.position.x,i.camera.position.y,i.camera.position.z,1);return t.transform(n),new e.Vector3(t.x,t.y,t.z)}));}_buildPBRDefines(){const e={};this.isForGeometry&&this._useIBL&&(e.USE_IBL=!0),this._usePBR&&(e.USE_PBR=!0),this._hasVertexColor&&(e.VERTEX_COLOR=!0),this._baseColorTexture&&(e.HAS_BASECOLORMAP=!0),this._normalTexture&&(e.HAS_NORMALMAP=!0),this._emissiveTexture&&(e.HAS_EMISSIVEMAP=!0),this._metallicRoughnessTexture&&(e.HAS_METALROUGHNESSMAP=!0),this._occlusionTexture&&(e.HAS_OCCLUSIONMAP=!0),e.HAS_NORMALS=this._hasNormal,e.HAS_TANGENTS=this._hasTangent,this.hasMorph&&(e.USE_MORPHTARGETS=!0,this._hasMorphNormal&&(e.USE_MORPHNORMALS=!0),this._hasMorphTangent&&(e.USE_MORPHTANGENTS=!0)),this.isInstance&&(e.INSTANCE_MATRIX=!0),"OPAQUE"===this.alphaMode&&(e.OPAQUE=!0),this.defines=e;}_updateDefines(){const t={};if(e.defined(this._usePickColorTexture)&&(t.USE_PICKINGTEXTURES=this._usePickColorTexture),e.defined(this._isOneDimensionBatchTexture)&&(t.ONE_DIMENSION_BATCH_TEXTURE=this._isOneDimensionBatchTexture,t.TWO_DIMENSION_BATCH_TEXTURE=!this._isOneDimensionBatchTexture),t.MODEL_INSTANCE_BATCH_TEXTURE=this._isModelInstanceTexture,this.isForGeometry&&this._useIBL&&(t.USE_IBL=!0),this.clippingPlanes&&this.clippingPlanes.enabled&&0!==this.clippingPlanes.length){t.HAS_CLIPPING_PLANES=!0,t.USE_CLIPPING_PLANES_FLOAT_TEXTURE=!!this.clippingPlanes._useFloatTexture;const i=e.ClippingPlaneCollection.getTextureResolution(this.clippingPlanes);t.CLIPPING_PLANES_LENGTH=this.clippingPlanes.length,t.CLIPPING_PLANES_TEXTURE_WIDTH=i.x,t.CLIPPING_PLANES_TEXTURE_HEIGHT=i.y,t.UNION_CLIPPING_REGIONS=!!this.clippingPlanes._unionClippingRegions;}else t.HAS_CLIPPING_PLANES=!1,t.CLIPPING_PLANES_LENGTH=0,t.CLIPPING_PLANES_TEXTURE_WIDTH=1,t.CLIPPING_PLANES_TEXTURE_HEIGHT=1;return t}_updateRenderState(){this.renderState={cull:this.doubleSided?e.renderStateEnum.disableCull:e.renderStateEnum.enableCull,depthTest:{enabled:!0,func:e.WebGLConstants.LEQUAL},polygonOffset:{enabled:!1,factor:25,units:1},stencilTest:{enabled:!1,mask:e.WebGLConstants.SKIP_LOD_MASK,reference:e.WebGLConstants.CESIUM_3D_TILE_MASK,frontFunction:e.WebGLConstants.ALWAYS,backFunction:e.WebGLConstants.ALWAYS,frontOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.REPLACE},backOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.REPLACE}}},e.defined(this.backCulling)&&(this.renderState.cull=this.backCulling?e.renderStateEnum.enableCull:e.renderStateEnum.disableCull);}_createDynamicUniform(t,i){if(this.clippingPlanes&&this.clippingPlanes.enabled){this.clippingPlanes.update(t,i),this._uniforms.set("u_model_clippingPlanesEdgeStyle",(()=>new e.Vector4(this.clippingPlanes.edgeColor.r,this.clippingPlanes.edgeColor.g,this.clippingPlanes.edgeColor.b,this.clippingPlanes.edgeWidth))),this._uniforms.set("u_model_clippingPlanes",(()=>this.clippingPlanes.texture));let s=e.Matrix4.multiply(new e.Matrix4,i.camera.matrixWorldInverse,this.clippingPlanes.modelMatrix);s=e.Matrix4.inverseTranspose(s,new e.Matrix4),this._uniforms.set("u_model_clippingPlanesMatrix",(()=>s));const r={x:t.context.viewport.current.x,y:t.context.viewport.current.y,width:t.context.viewport.current.width,height:t.context.viewport.current.height},n=new e.Matrix4;e.Matrix4.computeViewportTransformation(r,0,1,n),this._uniforms.set("u_ViewportTransformation",(()=>n)),this._uniforms.set("u_InverseProjection",(()=>i.camera.projectionMatrixInverse));}}serialize(){const t={metalness:this._metallicFactor,roughness:this._roughnessFactor,hasNormal:this._hasNormal,type:this.type};return e.defined(this._baseColorTexture)&&(this._baseColorTexture instanceof e.Texture?t.baseColorTextureUrl=this._baseColorTexture.serialize():e.defined(this._baseColorTexture.texture)&&this._baseColorTexture.texture instanceof e.Texture&&(t.baseColorTextureUrl=this._baseColorTexture.texture.serialize())),e.defined(this._normalTexture)&&(this._normalTexture instanceof e.Texture?t.normalTextureUrl=this._normalTexture.serialize():e.defined(this._normalTexture.texture)&&this._normalTexture.texture instanceof e.Texture&&(t.normalTextureUrl=this._normalTexture.texture.serialize())),e.defined(this._metallicRoughnessTexture)&&(this._metallicRoughnessTexture instanceof e.Texture?t.metallicRoughnessTextureUrl=this._metallicRoughnessTexture.serialize():e.defined(this._metallicRoughnessTexture.texture)&&this._metallicRoughnessTexture.texture instanceof e.Texture&&(t.metallicRoughnessTextureUrl=this._metallicRoughnessTexture.texture.serialize())),e.defined(this._baseColorFactor)&&(t.color=e.Vector4.pack(this._baseColorFactor,new Array(4))),t}destroy(){const e=this._baseColorTexture?.texture?._texture?.context?.painter;this._uniforms=void 0,this.type=void 0,this.isInstance=void 0,this._emissiveTexture&&e?.textureResourceManager.removeTexture(this._emissiveTexture.texture._texture.name),this._emissiveTexture=void 0,this._occlusionTexture&&e?.textureResourceManager.removeTexture(this._occlusionTexture.texture._texture.name),this._occlusionTexture=void 0,this._hasNormal=void 0,this._hasTangent=void 0,this._hasVertexColor=void 0,this._normalTexture&&e?.textureResourceManager.removeTexture(this._normalTexture.texture._texture.name),this._normalTexture=void 0,this._baseColorTexture&&e?.textureResourceManager.removeTexture(this._baseColorTexture.texture._texture.name),this._baseColorTexture=void 0,this._brdfTexture=void 0,this._diffuseTexture=void 0,this._specularGlossinessTexture=void 0,this._metallicRoughnessTexture=void 0,this._baseColorFactor=void 0,this._metallicFactor=void 0,this._roughnessFactor=void 0,this._emissiveFactor=void 0,this._specialLight=void 0,this._lightExposure=void 0,this.hasMorph=void 0,this._hasMorphNormal=void 0,this._hasMorphTangent=void 0,this._specialcolor=void 0,this._khrValues=void 0;}}const Ho={nextPowerOfTwo(e){if("number"!=typeof e||e<0||e>2147483648)throw new Error("A number between 0 and 2^31 is required.");return --e,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},generateImage(t){const i=e.window.document.createElement("canvas");return i.width=Ho.nextPowerOfTwo(t.width),i.height=Ho.nextPowerOfTwo(t.height),i.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,i.width,i.height),i},resize(t,i,s){const r=e.window.document.createElement("canvas");return r.width=i,r.height=s,r.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,i,s),r},isPowerOfTwo(e){if("number"!=typeof e||e<0||e>4294967295)throw new Error("A number between 0 and (2^32)-1 is required.");return 0!==e&&0==(e&e-1)}};class zo extends e.Material{color=new e.Color(1,1,1);opacity=1;shininess=30;reflectivity=.85;baseColorMap=null;normalMap=null;hasMorph=!1;hasMorphNormal=!1;hasMorphTangent=!1;isInstance=!1;hasNormal=!0;hasTangent=!1;hasVertexColor=!1;hasSkins=!1;clippingPlanes=null;needUpdate=!1;constructor(e){super(e),this.type="PhongMaterial",this.setOptions(e);}setOptions(t){if(t.color&&(this.color=e.Color.parse(t.color)),t.reflectivity&&(this.reflectivity=t.reflectivity),t.shininess&&(this.shininess=t.shininess),t.baseColorMap&&(this.baseColorMap=t.baseColorMap),t.normalMap&&(this.normalMap=t.normalMap),t.hasMorph&&(this.hasMorph=t.hasMorph),t.hasMorphNormal&&(this.hasMorphNormal=t.hasMorphNormal),t.hasMorphTangent&&(this.hasMorphTangent=t.hasMorphTangent),t.isInstance&&(this.isInstance=t.isInstance),t.hasNormal&&(this.hasNormal=t.hasNormal),t.hasTangent&&(this.hasTangent=t.hasTangent),t.hasVertexColor&&(this.hasVertexColor=t.hasVertexColor),t.hasSkins&&(this.hasSkins=t.hasSkins),t.clippingPlanes&&(this.clippingPlanes=t.clippingPlanes),t.pbrMetallicRoughness&&(t.pbrMetallicRoughness.baseColorFactor&&(this.color=e.Color.parse(t.pbrMetallicRoughness.baseColorFactor)),t.pbrMetallicRoughness.baseColorTexture)){const i=t.pbrMetallicRoughness.baseColorTexture.texture;this.baseColorMap=i._texture,this.baseColorMap.minFilter=i.sampler.parameters[e.WebGLConstants.TEXTURE_MIN_FILTER],this.baseColorMap.magFilter=i.sampler.parameters[e.WebGLConstants.TEXTURE_MAG_FILTER],this.baseColorMap.wrapS=i.sampler.parameters[e.WebGLConstants.TEXTURE_WRAP_S],this.baseColorMap.wrapT=i.sampler.parameters[e.WebGLConstants.TEXTURE_WRAP_T];}if(t.normalTexture){const i=t.normalTexture.texture;this.normalMap=i._texture,this.normalMap.minFilter=i.sampler.parameters[e.WebGLConstants.TEXTURE_MIN_FILTER],this.normalMap.magFilter=i.sampler.parameters[e.WebGLConstants.TEXTURE_MAG_FILTER],this.normalMap.wrapS=i.sampler.parameters[e.WebGLConstants.TEXTURE_WRAP_S],this.normalMap.wrapT=i.sampler.parameters[e.WebGLConstants.TEXTURE_WRAP_T];}this.needUpdate=!0;}update(e,t,i={}){super.update(e,t,i),this._updateDefinesNonStandard(),this.needUpdate&&(this._updateDefines(),this._updateUniforms(),this._updateRenderState(),this.needUpdate=!1);}serialize(){return {type:this.type,color:e.Vector3.pack(this.color,new Array(4)),shininess:this.shininess,reflectivity:this.reflectivity,opacity:this.opacity}}destroy(){super.destroy(),this.normalMap&&this.normalMap.destroy();}_updateUniforms(){this.baseColorMap&&this._uniforms.set("u_BaseColorSampler",(()=>{const t=this.baseColorMap;return t.sampler={minificationFilter:t.minFilter||e.WebGLConstants.LINEAR_MIPMAP_NEAREST,magnificationFilter:t.magFilter||e.WebGLConstants.LINEAR,wrapS:t.wrapS||e.WebGLConstants.REPEAT,wrapT:t.wrapT||e.WebGLConstants.REPEAT},t})),this.normalMap&&this._uniforms.set("u_NormalSampler",(()=>{const t=this.normalMap;return t.sampler={minificationFilter:t.minFilter||e.WebGLConstants.LINEAR_MIPMAP_NEAREST,magnificationFilter:t.magFilter||e.WebGLConstants.LINEAR,wrapS:t.wrapS||e.WebGLConstants.REPEAT,wrapT:t.wrapT||e.WebGLConstants.REPEAT},t})),this._uniforms.set("u_BaseColorFactor",(()=>this.color.toVector4())),this._uniforms.set("u_Shininess",(()=>this.shininess)),this._uniforms.set("u_Opacity",(()=>this.opacity)),this._uniforms.set("u_Reflectivity",(()=>this.reflectivity)),this._uniforms.set("u_HasSkinning",(()=>this.hasSkins));}_updateDefinesNonStandard(){const t={};e.defined(this._usePickColorTexture)&&(t.USE_PICKINGTEXTURES=this._usePickColorTexture),e.defined(this._isOneDimensionBatchTexture)&&(t.ONE_DIMENSION_BATCH_TEXTURE=this._isOneDimensionBatchTexture,t.TWO_DIMENSION_BATCH_TEXTURE=!this._isOneDimensionBatchTexture),t.MODEL_INSTANCE_BATCH_TEXTURE=this._isModelInstanceTexture,this.defines=t;}_updateDefines(){const t={VERTEX_COLOR:this.hasVertexColor,HAS_NORMALS:this.hasNormal,HAS_TANGENTS:this.hasTangent,HAS_NORMALMAP:!!this.normalMap,HAS_BASECOLORMAP:!!this.baseColorMap,USE_MORPHTARGETS:this.hasMorph,USE_MORPHNORMALS:this.hasMorphNormal,USE_MORPHTANGENTS:this.hasMorphTangent,INSTANCE_MATRIX:this.isInstance,OPAQUE:"OPAQUE"===this.alphaMode,HAS_CLIPPING_PLANES:this.clippingPlanes?.enabled&&0!==this.clippingPlanes.length};if(t.HAS_CLIPPING_PLANES){t.HAS_CLIPPING_PLANES=!0,t.USE_CLIPPING_PLANES_FLOAT_TEXTURE=!!this.clippingPlanes._useFloatTexture;const i=e.ClippingPlaneCollection.getTextureResolution(this.clippingPlanes);t.CLIPPING_PLANES_LENGTH=this.clippingPlanes.length,t.CLIPPING_PLANES_TEXTURE_WIDTH=i.x,t.CLIPPING_PLANES_TEXTURE_HEIGHT=i.y,t.UNION_CLIPPING_REGIONS=!!this.clippingPlanes._unionClippingRegions;}else t.HAS_CLIPPING_PLANES=!1,t.USE_CLIPPING_PLANES_FLOAT_TEXTURE=!1,t.CLIPPING_PLANES_LENGTH=0,t.CLIPPING_PLANES_TEXTURE_WIDTH=1,t.CLIPPING_PLANES_TEXTURE_HEIGHT=1;this.defines=t;}_updateRenderState(){this.renderState={cull:this.doubleSided?e.renderStateEnum.disableCull:e.renderStateEnum.enableCull,depthTest:{enabled:!0,func:e.WebGLConstants.LEQUAL},polygonOffset:{enabled:!1,factor:25,units:1},stencilTest:{enabled:!1,mask:e.WebGLConstants.SKIP_LOD_MASK,reference:e.WebGLConstants.CESIUM_3D_TILE_MASK,frontFunction:e.WebGLConstants.ALWAYS,backFunction:e.WebGLConstants.ALWAYS,frontOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.REPLACE},backOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.REPLACE}}},e.defined(this.backCulling)&&(this.renderState.cull=this.backCulling?e.renderStateEnum.enableCull:e.renderStateEnum.disableCull);}}function Wo(e){const t={hasMorph:!1,hasMorphNormal:!1,hasMorphTangent:!1};if(e.targets){t.hasMorph=!0;const i=e.targets[0];i.NORMAL&&(t.hasMorphNormal=!0),i.TANGENT&&(t.hasMorphTangent=!0);}return t}class jo{constructor(e){this.options=Object.assign({},{closed:!1,state:1},e),this._value=null;}set state(e){this.options.state=e;}get state(){return this.options.state}get times(){return this.options.times}get controlPoint(){return this.options.controlPoint}get points(){return this.options.points}get weights(){return this.options.weights}get interpolation(){return this.options.interpolation}get node(){return this.options.node}get nodeId(){return this.options.node.id}get path(){return this.options.path}get closed(){return this.options.closed}start(){this._stime=Date.now();}close(){this.options.closed=!0;}open(){this.options.closed=!1;}get value(){return this._value}update(e){this._curtime=e;}getCurrentTick(t){t=t||Date.now(),this._stime||(this._stime=Date.now());const i=this.options.times;let s=0;const r=(t-this._stime)/1e3%i[i.length-1];for(let t=0;t<i.length-1;t++)if(r>=i[t]&&r<=i[t+1])return s=(r-i[t])/(i[t+1]-i[t]),"LINEAR"===this.interpolation?{ratio:s,index:t}:"STEP"===this.interpolation?{ratio:1,index:t}:"CUBICSPLINE"===this.interpolation?{ratio:e.easeCubicInOut(s),index:t}:{ratio:s,index:t};return {ratio:1,index:i.length-2}}evaluate(){return this.options.closed?(this._value=null,null):(this._value=[],[])}}class Xo extends jo{constructor(e){super(e);}evaluate(){return this.options.closed?null:this.controlPoint}}class qo extends jo{constructor(e){super(e),this.transformationIndex="translation"===e.path?0:2;}evaluate(t){if(this.options.closed)return null;const i=this.getCurrentTick(t),s=this.points,r=new e.Matrix4;if("scale"===this.path)if(-1===i.index)r.scale(new e.Vector3(s));else {const t=new e.Vector3(s.slice(3*i.index,3*i.index+3));t.lerp(s.slice(3*(i.index+1),3*(i.index+1)+3),i.ratio),r.scale(t);}else if("translation"===this.path)if(-1===i.index)r.translate(new e.Vector3(s));else {const t=new e.Vector3(s.slice(3*i.index,3*i.index+3));t.lerp(s.slice(3*(i.index+1),3*(i.index+1)+3),i.ratio),r.translate(t);}this.options.originNodeMatrix&&r.multiplyLeft(this.options.originNodeMatrix.getTranslationMatrix4()),this._value=r;}}class Ko extends jo{constructor(e){super(e),this.transformationIndex=1;}evaluate(t){if(this.options.closed)return null;const i=this.getCurrentTick(t),s=this.points,r=new e.Matrix4,n=new e.Quaternion(s.slice(4*i.index,4*i.index+4));if(n.slerp(n,s.slice(4*i.index+4,4*i.index+8),i.ratio),r.fromQuaternion(n),this.options.originNodeMatrix){const e=this.options.originNodeMatrix.getRotation();r.multiplyLeft(e);}this._value=r;}}class Jo extends jo{constructor(e){super(e);}evaluate(e){if(this.options.closed)return null;const t=this.getCurrentTick(e),i=this.weights,s=i.length/this.times.length,r=[];for(let e=0;e<s;e++)r.push(i[t.index*s+e]*(1-t.ratio)+i[t.index*s+e]*t.ratio);return this._value=r,0}}var Zo=function(e){for(const t of Object.getOwnPropertyNames(e.constructor.prototype)){const i=e[t];"constructor"!==t&&"function"==typeof i&&(e[t]=i.bind(e));}return e};class Yo extends e.Evented{constructor(t){super(),this.options=Object.assign({animations:[],loop:0,delay:0,multiplier:1,reverse:!1},t),delete this.options.animations,this.isRunning=e.defaultValue(t.isRunning,!0),this.id=t.id,this.name=t.name,this.gltf=t.gltf,this.groupsOfNode={},this._defaultAnimations={},this.parseAnimation(t.animations),Zo(this);}parseAnimation(e){if(!this.parsed){for(let t=0;t<e.length;t++)this.addAnimation(e[t],t);this.nodeTransformationSort();}}nodeTransformationSort(){for(const e in this.groupsOfNode)this.groupsOfNode[e].sort(((e,t)=>e.transformationIndex-t.transformationIndex));}evaluateActiveAnimations(){const t=Date.now();this.update(t),this.applyAllAnimationsOfNodes(),e.window.requestAnimationFrame(this.evaluateActiveAnimations);}update(t){if(this.isRunning)for(const i in this.groupsOfNode){const s=this.gltf.nodes[parseFloat(i.slice(5))];if(!s.play)continue;s.translateMat||(s.translateMat=(new e.Matrix4).setTranslation(s._position),s.scaleMat=(new e.Matrix4).scale(s._scale),s.rotateMat=(new e.Matrix4).fromQuaternion(s._quaternion));const r={translation:s.translateMat,rotation:s.rotateMat,scale:s.scaleMat};for(let e=0;e<this.groupsOfNode[i].length;e++)this.groupsOfNode[i][e].evaluate(t),"translation"==this.groupsOfNode[i][e].path&&(r.translation=this.groupsOfNode[i][e]._value),"rotation"==this.groupsOfNode[i][e].path&&(r.rotation=this.groupsOfNode[i][e]._value),"scale"==this.groupsOfNode[i][e].path&&(r.scale=this.groupsOfNode[i][e]._value);s.setMatrix(r.translation.clone().multiplyRight(r.rotation.clone()).multiplyRight(r.scale.clone())),s.updateWorldMatrix(!0,!0);}}play(){this.isRunning=!0;}stop(){this.isRunning=!1;}addAnimation(e,t){const i=e.input,s=e.output,r=e.target.path,n=e.interpolation;let o;const a=e.target.node,l=`${a.id}`,h=`animation-${t}-${l}`,_="HAD"===e.type?e.target.node.matrix:null;return 1===i.length&&1===s.length?o=new Xo({id:h,controlPoint:s[0],node:a}):"LINEAR"!==n&&"STEP"!==n||("translation"===r||"scale"===r?o=new qo({id:h,times:i,points:Array.from(s),node:a,interpolation:n,path:r,originNodeMatrix:_}):"rotation"===r?o=new Ko({id:h,times:i,points:Array.from(s),node:a,interpolation:n,path:r,originNodeMatrix:_}):"weights"===r&&(o=new Jo({id:h,times:i,weights:Array.from(s),node:a,interpolation:n,path:r}))),this.groupsOfNode[l]||(this.groupsOfNode[l]=[]),this.groupsOfNode[l].push(o),h}removeAll(){for(const e in this.groupsOfNode){const t=this.groupsOfNode[e];for(let e=0;e<t.length;e++)t[e].stop();delete this.groupsOfNode[e];}}getMorphAnimation(){for(const e in this.groupsOfNode){const t=this.groupsOfNode[e];for(let e=0;e<t.length;e++)if("weights"===t[e].path)return t[e]}return null}applyAllAnimationsOfNodes(){for(const e in this.groupsOfNode)this.applyAnimationByNodeId(e);}applyAnimationByNode(e){return this.applyAnimationByNodeId(e.id)}applyAnimationByNodeId(t){const i=[],s=[];for(const e of this.groupsOfNode[t])e.closed||("weights"!==e.path?i.push(e):s.push(e));if(0===i.length&&0===s.length)return;const r={};if(i.length>0)if(1===i.length)r.anim=i[0].value;else {const t=new e.Matrix4;for(let e=0;e<i.length;e++)t.multiplyRight(i[e].value);r.anim=t;}return s.length>0&&(r.weights=s[0].value),i[0].node.weights=r.weights,r}}function Qo(t,i){if(null===t||"object"!=typeof t)return t;i=e.defaultValue(i,!1);const s=new t.constructor;for(const e in t)if(t.hasOwnProperty(e)){let r=t[e];i&&(r=Qo(r,i)),s[e]=r;}return s}const $o={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ea={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},ta={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},ia={magFilter:ta.TEXTURE_MAG_FILTER,minFilter:ta.TEXTURE_MIN_FILTER,wrapS:ta.TEXTURE_WRAP_S,wrapT:ta.TEXTURE_WRAP_T},sa={[ta.TEXTURE_MAG_FILTER]:ta.LINEAR,[ta.TEXTURE_MIN_FILTER]:ta.NEAREST_MIPMAP_LINEAR,[ta.TEXTURE_WRAP_S]:ta.REPEAT,[ta.TEXTURE_WRAP_]:ta.REPEAT};class ra{postProcess(t,i={}){const{json:s,buffers:r=[],images:n=[],baseUri:o=""}=t;if(!s)return t;Ns(s),this.vBuffer={},this.iBuffer={},this.useMipmap=i.useMipmap,this.clippingPlanes=i.clippingPlanes,this.allowPick=i.allowPick,this.context=i.context,this.lightingModel=i.lightingModel||e.LightingModelType.PBR,this.modelInstanceCollection=i.modelInstanceCollection,this.baseUri=o,this.json=s,this.buffers=r,this.images=n,this.json.textureByteSize=t.textureByteSize,function(e){const t=e.meshes;for(let e=0;e<t.length;e++){const i=t[e].primitives;for(let e=0;e<i.length;e++){const t=i[e];if(t.extensions&&t.extensions.KHR_draco_mesh_compression){const e=t.extensions.KHR_draco_mesh_compression.attributes;Object.keys(t.attributes).forEach(((i,s)=>{if(-1!==i.indexOf("CUSTOM_ATTRIBUTE")){const s=parseInt(i.split("_")[2]);for(const r in t.extensions.KHR_draco_mesh_compression.attributes)e[r]==s&&(t.attributes[r]=t.attributes[i],delete t.attributes[i]);}}));}}}}(this.json),this._resolveTree(this.json,i),this.context=null,this.vBuffer=null,this.iBuffer=null;const a=this.json;return this.json=null,this.buffers=null,this.images=null,a}_resolveTree(t,i={}){t.bufferViews&&(t.bufferViews=t.bufferViews.map(((e,t)=>this._resolveBufferView(e,t)))),t.images&&(t.images=t.images.map(((e,t)=>this._resolveImage(e,t)))),t.samplers&&(t.samplers=t.samplers.map(((e,t)=>this._resolveSampler(e,t)))),t.textures&&(t.textures=t.textures.map(((e,t)=>this._resolveTexture(e,t)))),t.accessors&&(t.accessors=t.accessors.map(((e,t)=>this._resolveAccessor(e,t)))),t.materials&&(t.materials=t.materials.map(((e,t)=>this._resolveMaterial(e,t)))),t.skins&&(t.skins=t.skins.map(((e,t)=>this._resolveSkin(e,t)))),t.nodes&&(t.nodes=t.nodes.map(i.instances?t=>new e.Node(t,!1):t=>new e.Node(t,!0)),t.nodes=t.nodes.map(((e,t)=>this._resolveNode(e,t)))),t.animations&&(t.animations=t.animations.map(((e,t)=>this._resolveAnimation(e,t)))),t.scenes&&(t.scenes=t.scenes.map(((e,t)=>this._resolveScene(e,t)))),t.scene=e.defined(t.scene)?t.scenes[this.json.scene]:t.scenes[0];}getScene(e){return this._get("scenes",e)}getNode(t){let i=this._get("nodes",t);return i instanceof e.Node||(i=new e.Node(i)),i}getSkin(e){return this._get("skins",e)}getMesh(e){return this._get("meshes",e)}getMaterial(e){return this._get("materials",e)}getAccessor(e){return this._get("accessors",e)}getCamera(e){return null}getTexture(e){return this._get("textures",e)}getSampler(e){return this._get("samplers",e)}getImage(e){return this._get("images",e)}getBufferView(e){return this._get("bufferViews",e)}getBuffer(e){return this._get("buffers",e)}_get(e,t){return "object"==typeof t?t:this.json[e]&&this.json[e][t]}_resolveAnimation(e,t){return e.id=e.id||t,e.name=e.name||"default-animation",e.isRunning=!1,0===t&&(e.isRunning=!0),function(e,t){const i=[],s=e;for(let e=0;e<s.channels.length;e++){const r=s.channels[e],n=s.samplers[r.sampler],o=t.accessors[n.input];let a=null;r.extras&&r.extras.type&&(a=r.extras.type);const l={count:o.count,input:o.value,output:t.accessors[n.output].value,target:r.target,interpolation:n.interpolation,type:a};l.target.node=t.nodes[l.target.node],i.push(l);}return new Yo({id:e.id,name:e.name,animations:i,gltf:t,isRunning:e.isRunning})}(e,this.json)}createNodeMesh(t){const i=this.json;if(void 0===t.mesh)return null;let s=i.meshes[t.mesh],r=!0;return s.primitives.forEach((i=>{(i instanceof e.Primitive||e.defined(i.attributes.POSITION)&&e.defined(i.attributes.POSITION.value))&&(r=!1),i.skinsIndex=t._skinsIndex;})),r&&(s=Qo(i.meshes[t.mesh],!0)),this._resolveMesh(s,t)}_resolveScene(e,t){return e.id=e.id||`scene-${t}`,e.nodes=(e.nodes||[]).map((e=>this.getNode(e))),e}_resolveNode(e,t){if(e.id=e.id||`node-${t}`,e.childIdxes){const t=e.childIdxes.map((e=>this.getNode(e)));e.add(...t);}return void 0!==e.mesh?(e.mesh=this.createNodeMesh(e),e.add(...e.mesh.primitives)):void 0!==e.meshes&&e.meshes.length&&(e.mesh=e.meshes.reduce(((e,t)=>{const i=this.createNodeMesh(t);return e.id=i.id,e.primitives=e.primitives.concat(i.primitives),e}),{primitives:[]}),e.add(...e.mesh.primitives)),void 0!==e.camera&&(e.camera=this.getCamera(e.camera)),void 0!==e.skin&&(e.skin=this.getSkin(e.skin)),e.createSkeleton(this.json),e}_resolveSkin(t,i){t.id=t.id||`skin-${i}`;const s=this.getAccessor(t.inverseBindMatrices),r=[];for(let i=0;i<t.joints.length;i++)r.push(new e.Matrix4(s.value.slice(16*i,16*(i+1))));return t.inverseBindMatrices=r,t}_resolveMesh(t,i){const s=i.mesh;return t.id?i.properties.id=t.id:t.id=`mesh-${s}`,t.primitives&&(t.primitives=t.primitives.map(((t,i)=>{if(t instanceof e.Primitive)return t;const r=(t={...t}).attributes;t.attributes={};for(const e in r)t.attributes[e]=this.getAccessor(r[e]);return void 0!==t.indices&&(t.indicesId=t.indices,t.indices=this.getAccessor(t.indices)),void 0!==t.material&&(t.materialId=t.material,t.material=this.getMaterial(t.material),t.material.alphaMode||(t.material.alphaMode="OPAQUE")),function({primitive:t,context:i,vbuffer:s,ibuffer:r,gltf:n,ppi:o,meshInd:a,modelInstanceCollection:l,clippingPlanes:h,allowPick:_,lightingModel:c}){const u={},d=!!(t.targets&&t.targets.length>0),m=null!=l;!t.attributes.hasOwnProperty("NORMAL")&&i._enableNormal&&(t.attributes.NORMAL={value:new Float32Array(e.PolygonGeometryLibrary.computeNormal(t.attributes.POSITION.value,t.indices.value)),size:3,bufferView:t.attributes.POSITION.bufferView,byteOffset:t.attributes.POSITION.byteOffset,count:t.attributes.POSITION.count,type:"VEC3",components:3,componentType:t.attributes.POSITION.componentType});const p=function(e){const t={HAS_TANGENTS:!1,HAS_NORMALS:!1,HAS_VERTEX_COLOR:!1};for(const i in e.attributes){const e=i.toUpperCase();-1!==e.indexOf("NORMAL")&&(t.HAS_NORMALS=!0),-1!==e.indexOf("TANGENT")&&(t.HAS_TANGENTS=!0),-1!==e.indexOf("COLOR_0")&&(t.HAS_VERTEX_COLOR=!0);}return t}(t),f=function({primitive:t,bufferDataConfig:i,isMorphModel:s,gltf:r}){const n=t.attributes,o=t.extensions,a=o?o.KHR_draco_mesh_compression:void 0,l=[];for(const t in n){const s=n[t],o=s.bufferView||s.value,h=s.byteOffset?s.byteOffset:0,_=s.componentType,c=o.byteStride?o.byteStride:e.WebGLSizes[_]*(e.WebGLComponentCounts[s.type]||s.components);a&&(n[t].bufferViewId=r.bufferViews[a.bufferView].id),"POSITION"===t&&(i.VB={offset:h,byteStride:c,type:_}),"_"==t.charAt(0)?l.push({name:`a${t}`,type:_,components:e.WebGLComponentCounts[s.type],offset:h,byteStride:c}):l.push({name:`a_${t}`,type:_,components:e.WebGLComponentCounts[s.type],offset:h,byteStride:c});}if(s)for(let i=0;i<t.targets.length;i++){const s=t.targets[i];for(const t in s){const s=n[t],r=s.bufferView,o=s.componentType,a=s.components;l.push({name:`a_${t}_${i+1}`,type:o,components:e.WebGLComponentCounts[s.type],offset:s.byteOffset?s.byteOffset:0,byteStride:r.byteStride?r.byteStride:5121===o?a:5123===o?2*a:4*a});}}return e.createLayoutGltf(l)}({primitive:t,bufferDataConfig:u,isMorphModel:d,gltf:n});let g;const y=!!t.hasOwnProperty("indices");y&&(g=t.indices);const C=t.attributes,T=t.mode,x=t.attributes.POSITION||t.attributes.CENTEROFFSETS;x.min||(t.boundingBox?(x.min=t.boundingBox.min,x.max=t.boundingBox.max):(x.min=[0,0,0],x.max=[1e4,1e4,1e4]));const b=null!=x.bufferView?x.bufferView.id:x.bufferViewId;u.VB&&(u.VB.byteOffset=x&&x.byteOffset||0);const v=!s[b+f.key],w=t.targets;v&&w&&w.length>0&&w.forEach(((e,t)=>{const i=e;for(const e in i)C[`${e}_${t+1}`]=n.accessors[i[e]];}));const S=new e.VertexBuffer({context:i,attributesbuffviewObject:v?C:null,attributes:f.members,dynamicDraw:!1,buffers:s[b+f.key]});let A,E,M;if(l&&l.update({context:i}),v&&(s[b+f.key]=S.getBuffers()),y){const e=null!=g.bufferView?g.bufferView:{};e&&!e.hasOwnProperty("byteOffset")&&(e.byteOffset=0),e&&void 0===e.id&&(e.id=`bufferView-${a}_${o}`);const t=null!=g.bufferView?g.bufferView.data:g.value;E=g.byteOffset?g.byteOffset:0;const s=g.componentType;M=g.count,u.IB={byteStride:2,count:M,type:s,value:g.value},r[e.id]?A=new Go(i,null,!1,s,r[e.id]):(A=new Go(i,t,!1,s),r[e.id]=A.getBuffer());}else M=t.attributes.POSITION.count;const P=new e.SegmentVector;P.pushSegment({isModel:!0,isInstance:m,modelVertexOffset:E||0,modelVertexCount:M,instancesCount:l?._instances?.size||0});const R=new e.Geometry({indexBuffer:A,vertBuffer:S,dynamicLayoutBuffer1:l?.instanceBuffer,primitiveType:void 0===T?e.WebGLConstants.TRIANGLES:T,segmentVector:P,vertices:(B=x.min,I=x.max,[B[0],B[1],B[2],I[0],B[1],B[2],B[0],I[1],B[2],B[0],B[1],I[2],I[0],I[1],B[2],I[0],B[1],I[2],B[0],I[1],I[2],I[0],I[1],I[2]])});var B,I;let D;const O=t.material||{};D=c===e.LightingModelType.PHONG?new zo({...O,...Wo(t),isInstance:m,hasNormal:p.HAS_NORMALS,hasTangent:p.HAS_TANGENTS,hasVertexColor:p.HAS_VERTEX_COLOR,hasSkins:e.defined(n.skins)&&n.skins.length>0,clippingPlanes:h}):new Uo({type:m?"gltfPBRI3DM":void 0,isInstance:m,...O,hasNormal:p.HAS_NORMALS,hasTangent:p.HAS_TANGENTS,hasVertexColor:p.HAS_VERTEX_COLOR,doubleSided:!!O.doubleSided,...Wo(t),clippingPlanes:h,skins:e.defined(n.skins)&&n.skins.length>0,alphaMode:O.alphaMode});const L=new e.Primitive({geometry:R,material:D,properties:{primitiveName:t.name,indicesId:t.indicesId,materialId:t.materialId},normalMatrix:new e.Matrix4,allowPick:_,skinsIndex:t.skinsIndex});return m&&(L.modelInstanceType="3d-tile"),L}({primitive:t,context:this.context,vbuffer:this.vBuffer,ibuffer:this.iBuffer,gltf:this.json,meshInd:s,ppi:i,modelInstanceCollection:this.modelInstanceCollection,clippingPlanes:this.clippingPlanes,allowPick:this.allowPick,lightingModel:this.lightingModel})}))),t}_resolveMaterial(e,t){if(e.id=e.id||`material-${t}`,e.normalTexture&&(e.normalTexture={...e.normalTexture},e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlusionTexture={...e.occlusionTexture},e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emissiveTexture={...e.emissiveTexture},e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emissiveTexture?[1,1,1]:[0,0,0]),e.extensions&&e.extensions&&e.extensions&&e.extensions.KHR_materials_pbrSpecularGlossiness){e.pbrMetallicRoughness={...e.extensions.KHR_materials_pbrSpecularGlossiness};const t=e.pbrMetallicRoughness;t.diffuseTexture&&(t.baseColorTexture={...t.diffuseTexture},t.baseColorTexture.texture=this.getTexture(t.diffuseTexture.index));}else {e.pbrMetallicRoughness={...e.pbrMetallicRoughness};const t=e.pbrMetallicRoughness;t.baseColorTexture&&(t.baseColorTexture={...t.baseColorTexture},t.baseColorTexture.texture=this.getTexture(t.baseColorTexture.index)),t.metallicRoughnessTexture&&(t.metallicRoughnessTexture={...t.metallicRoughnessTexture},t.metallicRoughnessTexture.texture=this.getTexture(t.metallicRoughnessTexture.index));}return e}_resolveAccessor(e,t){if(e.id=e.id||`accessor-${t}`,void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=ea[e.componentType],e.components=$o[e.type],e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){const t=e.bufferView.buffer,{ArrayType:i,byteLength:s}=$s(e),r=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+t.byteOffset,n=t.arrayBuffer.slice(r,r+s);e.bytesPerElement*e.count<=e.bufferView.data.length&&(e.value=new i(n));}return e}_resolveTexture(t,i){return t.id=t.id||`texture-${i}`,t.sampler="sampler"in t?this.getSampler(t.sampler):{id:"default-sampler",parameters:sa},t.source=this.getImage(t.source),function(t,i,s){const r=t.source,n=function(t){return {wrapS:t.wrapS||e.WebGLConstants.REPEAT,wrapT:t.wrapT||e.WebGLConstants.REPEAT,magFilter:t.magFilter||e.WebGLConstants.LINEAR,minFilter:t.minFilter||e.WebGLConstants.LINEAR}}(t.sampler);let o=r.image,a="";const l=i.painter.textureResourceManager;if(r.uri&&e.isUrl(r.uri)&&(a=r.uri.substring(r.uri.lastIndexOf("/")+1)),e.CompressedTextureUtil.isCompressedFormat(o)){const{format:e}=o[0],s=l.getTexture({texUrl:r.uri,name:a,context:i,image:o,pixelFormat:e,compressed:!0,useMipmap:!1});s.bind(n.magFilter,n.wrapS),t._texture=s;}else {const h=!1;if(o&&o.width&&(s||n.wrapS===e.WebGLConstants.REPEAT)){const e=!Ho.isPowerOfTwo(o.width)||!Ho.isPowerOfTwo(o.height);o=e?Ho.generateImage(o):o,e&&h&&console.warn(`The model texture 【${r.name?r.name:r.id}】 does not exist to the nth power of 2!`);}const _=l.getTexture({texUrl:r.uri,name:a,context:i,image:o,pixelFormat:r.mimeType&&-1!==r.mimeType.indexOf("jpeg")?e.WebGLConstants.RGB:e.WebGLConstants.RGBA,useMipmap:s});_.bind(n.magFilter,n.wrapS),t._texture=_;}}(t,this.context,this.useMipmap),t}_resolveSampler(e,t){e.id=e.id||`sampler-${t}`,e.parameters={};for(const t in e){const i=this._enumSamplerParameter(t);void 0!==i&&(e.parameters[i]=e[t]);}return e}_enumSamplerParameter(e){return ia[e]}_resolveImage(e,t){e.id=e.id||`image-${t}`,void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView));const i=this.images[t];return i&&(e.image=i),e}_resolveBufferView(e,t){e.id=e.id||`bufferView-${t}`;const i=e.buffer;e.buffer=this.buffers[i];let s=this.buffers[i].byteOffset||0;return "byteOffset"in e&&(s+=e.byteOffset),e.data=new Uint8Array(this.buffers[i].arrayBuffer.slice(s,s+e.byteLength)),e}_resolveCamera(e,t){return e.id=e.id||`camera-${t}`,e}}function na(e,t){return (new ra).postProcess(e,t)}const oa=1735152710,aa=!0;function la(e,t,i,s){const r=new Uint8Array(t.buffer.slice(i,i+s)),n=new TextDecoder("utf8").decode(r);return e.json=JSON.parse(n),hi(s,4)}function ha(e,t,i,s){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:i,byteLength:s,arrayBuffer:t.buffer}),hi(s,4)}const _a={UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126,HALF_FLOAT_OES:36193,UNSIGNED_INT_24_8:34042,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635},ca={ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,RGB_DXT1:33776,RGBA_DXT1:33777,RGBA_DXT3:33778,RGBA_DXT5:33779,RGB_PVRTC_4BPPV1:35840,RGB_PVRTC_2BPPV1:35841,RGBA_PVRTC_4BPPV1:35842,RGBA_PVRTC_2BPPV1:35843,RGB_ETC1:36196,isCompressedFormat(e){let t;return t=Array.isArray(e)&&e.length>0?e[0].format:e.format||"",t===ca.RGB_DXT1||t===ca.RGBA_DXT1||t===ca.RGBA_DXT3||t===ca.RGBA_DXT5||t===ca.RGB_PVRTC_4BPPV1||t===ca.RGB_PVRTC_2BPPV1||t===ca.RGBA_PVRTC_4BPPV1||t===ca.RGBA_PVRTC_2BPPV1||t===ca.RGB_ETC1},isDXTFormat:e=>e===ca.RGB_DXT1||e===ca.RGBA_DXT1||e===ca.RGBA_DXT3||e===ca.RGBA_DXT5,isPVRTCFormat:e=>e===ca.RGB_PVRTC_4BPPV1||e===ca.RGB_PVRTC_2BPPV1||e===ca.RGBA_PVRTC_4BPPV1||e===ca.RGBA_PVRTC_2BPPV1,isETC1Format:e=>e===ca.RGB_ETC1,compressedTextureSizeInBytes(e,t,i){switch(e){case ca.RGB_DXT1:case ca.RGBA_DXT1:case ca.RGB_ETC1:return Math.floor((t+3)/4)*Math.floor((i+3)/4)*8;case ca.RGBA_DXT3:case ca.RGBA_DXT5:return Math.floor((t+3)/4)*Math.floor((i+3)/4)*16;case ca.RGB_PVRTC_4BPPV1:case ca.RGBA_PVRTC_4BPPV1:return Math.floor((Math.max(t,8)*Math.max(i,8)*4+7)/8);case ca.RGB_PVRTC_2BPPV1:case ca.RGBA_PVRTC_2BPPV1:return Math.floor((Math.max(t,16)*Math.max(i,8)*2+7)/8);default:return 0}},componentsLength(e){switch(e){case ca.RGB:return 3;case ca.RGBA:return 4;case ca.LUMINANCE_ALPHA:return 2;default:return 1}},textureSizeInBytes(e,t,i,s){let r=ca.componentsLength(e);return ca.isPacked(t)&&(r=1),r*ca.sizeInBytes(t)*i*s},sizeInBytes(e){switch(e){case _a.UNSIGNED_BYTE:return 1;case _a.UNSIGNED_SHORT:case _a.UNSIGNED_SHORT_4_4_4_4:case _a.UNSIGNED_SHORT_5_5_5_1:case _a.UNSIGNED_SHORT_5_6_5:case _a.HALF_FLOAT:return 2;case _a.UNSIGNED_INT:case _a.FLOAT:case _a.UNSIGNED_INT_24_8:return 4}},isPacked:e=>e===_a.UNSIGNED_INT_24_8||e===_a.UNSIGNED_SHORT_4_4_4_4||e===_a.UNSIGNED_SHORT_5_5_5_1||e===_a.UNSIGNED_SHORT_5_6_5};const ua=new Map;async function da(e,t,i,s,r){const{fetch:n,_parse:o}=r;let a,l;if(t.uri&&function(e){const t=e.substring(0,2),i=e.substring(0,1);return !!/^http[s]?:\/\/([\w\-\.]+)+[\w-]*([\w\-\.\/\?%&=]+)?$/gi.test(e)||"./"===t||"/"===i}(t.uri)){const h=Sn(t.uri,s),_=h.lastIndexOf("/")+1;l=h.substring(_);const c=await n(h,s);a=c instanceof ArrayBuffer?c:await c.arrayBuffer(),Number.isFinite(t.bufferView)&&(a=er(e.json,e.buffers,t.bufferView)),Ns(a,"glTF image has no data");const u=t.uri.split("."),d=u[u.length-1];if("ktx2"==d||"ktx"==d||"crn"==d||"basis"==d){let t;switch("image/"+d){case"image/ktx":t=await o(a,gn,{},r);const{ktxformat:i,ktxwidth:s,ktxheight:n}=t[0];e.textureByteSize+=ca.compressedTextureSizeInBytes(i,s,n);break;case"image/crn":t=await o(a,vn,{worker:!0},r),e.textureByteSize+=t[0].data.byteLength;break;case"image/basis":case"image/ktx2":an.options.basis.format=nn(an.options,!0),t=await o(a,an,r),e.textureByteSize+=t[0].data.byteLength;break;default:t=await o(a,Ls,{},r);const{width:l,height:h}=t;e.textureByteSize+=ca.textureSizeInBytes(6408,5121,l,h);}e.images[i]=t;}else {const t=await o(a,Ls,{},r);if(ua.has(l)){const s=ua.get(l),r={name:"",imageParsed:null,gltf:null,index:-1};s[0].imageParsed?(r.name=l,r.gltf=e,r.index=i,r.imageParsed=s[0].imageParsed,r.gltf.images[r.index]=s[0].imageParsed,s.push(r)):(r.name=l,r.gltf=e,r.index=i,r.imageParsed=t,r.gltf.images[r.index]=t,s.push(r));}else {const s={name:"",imageParsed:null,gltf:null,index:-1};s.name=l,s.gltf=e,s.index=i;const r=[];r.push(s),ua.set(l,r),ua.get(l).forEach((e=>{e.imageParsed=t,e.gltf.images[e.index]=t;}));}}}else {if(t.uri){const e=Sn(t.uri,s),i=await n(e,s);a=i instanceof ArrayBuffer?i:await i.arrayBuffer();}let l;switch(Number.isFinite(t.bufferView)&&(a=er(e.json,e.buffers,t.bufferView)),Ns(a,"glTF image has no data"),t.mimeType){case"image/ktx":l=await o(a,gn,{},r);const{ktxformat:t,ktxwidth:i,ktxheight:s}=l[0];e.textureByteSize+=ca.compressedTextureSizeInBytes(t,i,s);break;case"image/crn":l=await o(a,vn,{worker:!0},r),e.textureByteSize+=l[0].data.byteLength;break;case"image/basis":case"image/ktx2":an.options.basis.format=nn(an.options,!0),l=await o(a,an,r),e.textureByteSize+=l[0].data.byteLength;break;default:l=await o(a,Ls,{},r);const{width:n,height:h}=l;e.textureByteSize+=ca.textureSizeInBytes(6408,5121,n,h);}e.images[i]=l;}}const ma={name:"glTF",id:"gltf",module:"gltf",version:wr,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:async function(t,i={},s){(i={...ma.options,...i}).gltf={...ma.options.gltf,...i.gltf},function(e){"fetchImages"in e&&(e.gltf.loadImages=e.fetchImages),"createImages"in e&&(e.gltf.loadImages=e.createImages),"fetchLinkedResources"in e&&(e.gltf.fetchBuffers=e.fetchLinkedResources),"decompress"in e&&(e.gltf.decompressMeshes=e.decompress),"decompress"in e.gltf&&(e.gltf.decompressMeshes=e.gltf.decompress),"postProcess"in e&&(e.gltf.postProcess=e.postProcess);}(i);const{byteOffset:r=0}=i;let n=e.decodeModel(t),o={textureByteSize:0};const a=await async function(t,i,s=0,r,n){if(function(e,t,i,s){if(s.uri&&(e.baseUri=s.uri),t instanceof ArrayBuffer&&!function(e,t=0,i={}){const s=new DataView(e),{magic:r=oa}=i,n=s.getUint32(t,!1);return n===r||n===oa}(t,i,s)&&(t=(new TextDecoder).decode(t)),"string"==typeof t)e.json=function(e){try{return JSON.parse(e)}catch(t){throw new Error(`Failed to parse JSON from data starting with "${function(e,t=5){return "string"==typeof e?e.slice(0,t):ArrayBuffer.isView(e)?oi(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?oi(e,0,t):""}(e)}"`)}}(t);else if(t instanceof ArrayBuffer){const r={};i=function(e,t,i=0,s={}){const r=new DataView(t);e.type=function(e,t=0){return `${String.fromCharCode(e.getUint8(t+0))}${String.fromCharCode(e.getUint8(t+1))}${String.fromCharCode(e.getUint8(t+2))}${String.fromCharCode(e.getUint8(t+3))}`}(r,i+0),e.version=r.getUint32(i+4,aa);const n=r.getUint32(i+8,aa);switch(e.header={byteOffset:i,byteLength:n,hasBinChunk:!1},e.json={},e.binChunks=[],i+=12,e.version){case 1:return function(e,t,i){St(e.header.byteLength>20);const s=t.getUint32(i+0,aa),r=t.getUint32(i+4,aa);return i+=8,St(0===r),la(e,t,i,s),(i+=s)+ha(e,t,i,e.header.byteLength)}(e,r,i);case 2:return function(e,t,i,s){return St(e.header.byteLength>20),function(e,t,i,s){for(;i+8<=e.header.byteLength;){const r=t.getUint32(i+0,aa),n=t.getUint32(i+4,aa);switch(i+=8,n){case 1313821514:la(e,t,i,r);break;case 5130562:ha(e,t,i,r);break;case 0:s.glb.strict||la(e,t,i,r);break;case 1:s.glb.strict||ha(e,t,i,r);}i+=hi(r,4);}}(e,t,i,{}),i+e.header.byteLength}(e,r,i);default:throw new Error(`Invalid GLB version ${e.version}. Only supports v1 and v2.`)}}(r,t,i,s),Ns("glTF"===r.type,`Invalid GLB magic string ${r.type}`),e._glb=r,e.json=r.json;}else Ns(!1,"GLTF: must be ArrayBuffer or string");if(e.buffers=new Array((e.json.buffers||[]).length).fill(null),e._glb&&e._glb.header.hasBinChunk){const{binChunks:t}=e._glb;e.buffers[0]={arrayBuffer:t[0].arrayBuffer,byteOffset:t[0].byteOffset,byteLength:t[0].byteLength};}e.images=new Array((e.json.images||[]).length).fill({});}(t,i,s,r),"1.0"===t.json?.asset?.version){const e=n.url;throw new Error(`The【${e.slice(e.lastIndexOf("/")+1)}】 version is ${t.json.asset.version}, minemap is not supported!`)}!function(e,t={}){(new mo).normalize(e,t);}(t,{normalize:r.gltf.normalize}),function(e,t={},i){const s=ho.filter((e=>_o(e.name,t)));for(const r of s)r.preprocess?.(e,t,i);}(t,r,n);const o=[];if(r.gltf.loadBuffers&&t.json.buffers&&await async function(e,t,i){for(let s=0;s<e.json.buffers.length;++s){const r=e.json.buffers[s];if(r.uri){const{fetch:n}=i;Ns(n);const o=Sn(r.uri,t),a=await n(o,t);let l;l=a instanceof ArrayBuffer?a:await a.arrayBuffer(),e.buffers[s]={arrayBuffer:l,byteOffset:0,byteLength:l.byteLength},delete r.uri;}}}(t,r,n),r.gltf.loadImages){const e=async function(e,t,i){const s=e.json.images||[],r=[];for(let n=0;n<s.length;++n)r.push(da(e,s[n],n,t,i));const n=await Promise.all(r);for(let t=0;t<e.images.length;t++)if(!Array.isArray(e.images[t])&&void 0===e.images[t].width){const i=[...ua][t];i&&(e.images[t]=i[1][0].imageParsed);}return n}(t,r,n);o.push(e);}const a={...r};delete a.source,delete a.context;const l=async function(e,t={},i){const s=ho.filter((e=>_o(e.name,t)));for(const r of s)await(r.decode?.(e,t,i));}(t,a,n);if(o.push(l),await Promise.all(o),r.instances){let i;if(t.json.nodes[0].matrix)i=new e.Matrix4(t.json.nodes[0].matrix);else {const s=new e.Quaternion,r=new e.Vector3(1,1,1),n=new e.Vector3;t.json.nodes[0].rotation&&(s.set(t.json.nodes[0].rotation[0],t.json.nodes[0].rotation[1],t.json.nodes[0].rotation[2],t.json.nodes[0].rotation[3]),delete t.json.nodes[0].rotation),t.json.nodes[0].scale&&(r.copy(t.json.nodes[0].scale),delete t.json.nodes[0].scale),t.json.nodes[0].translation&&(n.copy(t.json.nodes[0].translation),delete t.json.nodes[0].translation),i=function(t,i,s,r){r||(r=new e.Matrix4);const n=s.x,o=s.y,a=s.z,l=i.x*i.x,h=i.x*i.y,_=i.x*i.z,c=i.x*i.w,u=i.y*i.y,d=i.y*i.z,m=i.y*i.w,p=i.z*i.z,f=i.z*i.w,g=i.w*i.w,y=2*(h-f),C=2*(_+m),T=2*(h+f),x=-l+u-p+g,b=2*(d-c),v=2*(_-m),w=2*(d+c),S=-l-u+p+g;return r[0]=(l-u-p+g)*n,r[1]=T*n,r[2]=v*n,r[3]=0,r[4]=y*o,r[5]=x*o,r[6]=w*o,r[7]=0,r[8]=C*a,r[9]=b*a,r[10]=S*a,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,r}(n,s,r,new e.Matrix4),t.json.nodes[0].matrix=i;}for(const t of r.instances){const s=t.modelMatrix.clone(),r=(new e.Matrix4).rotateX(Math.PI/2),n=s.multiplyRight(r);t.modelMatrix=n.multiplyRight(i);}r.modelInstanceCollection=new e.ModelInstanceCollection({instances:r.instances,type:"3d-tile"});}return r.gltf.postProcess?na(t,r):t}(o,n,r,i,s);n=null;for(let e=0;a.bufferViews&&e<a.bufferViews.length;e++)a.bufferViews[e].data=null,a.bufferViews[e].buffer=null;let l=0;for(let e=0;a.images&&e<a.images.length;e++)a.images[e].image&&(l+=(a.images[e].image.width||0)*(a.images[e].image.height||0)),a.images[e].bufferView=null,a.images[e].image=null;if(o._glb&&o._glb.binChunks&&o._glb.binChunks.length>0){for(let e=0;e<o._glb.binChunks.length;e++)o._glb.binChunks[e].arrayBuffer=null;o._glb.binChunks=null;}if(o.buffers&&o.buffers.length>0){for(let e=0;e<o.buffers.length;e++)o.buffers[e].arrayBuffer=null;o.buffers=null;}return a.imagesSize=l,o._glb=null,o=null,a},options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};class pa{constructor(){}static updateAnimation(t){const{nodes:i,animations:s,skins:r}=t.gltfJson,n={u_has_skinning:!1};if(e.defined(s))for(let t=0;t<s.length;t++){const i=s[t];if(i.isRunning){i.update(Date.now());const t=i.getMorphAnimation();t&&(n.u_morphTargetInfluences=e.Vector2.unpack(1===t.value.length?[t.value[0],0]:t.value.slice(0,2)));}}if(e.defined(r)&&r.length>0){const t=[];i.forEach((i=>{i.update(),e.defined(i.skeleton)&&t.push(i.skeleton.jointMatrix);})),n.u_has_skinning=!0,n.u_jointMatrixs=t;}return n}}class fa extends wt{constructor(t){super(),this.isSceneModel=!0;let{position:i,scale:s,rotation:r,quaternion:n,matrix:o}=t;if(this._options=t,this.opaqueList=[],this.translucentList=[],this.animationPropertyCollection=new e.AnimationPropertyCollection,this.id=e.defaultValue(t.id,void 0),this.modelFolder=e.defaultValue(t.modelFolder,void 0),this._data=e.defaultValue(t.data,void 0),this.lightingModel=e.defaultValue(t.lightingModel,e.LightingModelType.NONE),this.classificationType=e.defaultValue(t.classificationType,e.ClassificationType.NONE),this.type="3d-model",e.defined(t.positions)&&t.positions.length>0&&(this.type="3d-model-instance",this.modelInstanceCollection=new e.ModelInstanceCollection({instances:e.ModelInstanceCollection.generateInstanceModelMatrix({positions:t.positions,scales:t.scales,rotations:t.rotations,shows:t.shows,colors:t.colors,instanceNames:t.instanceNames}),type:this.type,rootId:this.id}),o=new e.Matrix4),this.properties=e.defaultValue(t.properties,void 0),this._map=e.defaultValue(t.map,void 0),this._visibility=e.defaultValue(t.visibility,"visible"),this.loadedCallback=e.defaultValue(t.loaded,void 0),this.useMipmap=e.defaultValue(t.useMipmap,!1),this.clippingPlanes=e.defaultValue(t.clippingPlanes,void 0),this._allowPick=e.defaultValue(t.allowPick,!0),this.backCulling=e.defaultValue(t.backCulling,void 0),this.minzoom=e.defaultValue(t.minzoom,0),this.maxzoom=t.maxzoom,this._activeAnimation=e.defaultValue(t.activeAnimation,!0),this._currentAnimations=[],this._gltfJson=void 0,this._boundingVolume=void 0,o)this.applyMatrix(o);else {if(!i)throw new e.DeveloperError("position must be provided or matrix be provided");{if(!(Array.isArray(i)||i instanceof e.Vector3))throw new e.DeveloperError("position must be an array or Vector3!");let t;i instanceof e.Vector3?t=e.Vector3.unpack(i):(t=new e.Vector3(...i),console.warn("请规范position的类型! 使用minemap.Math.Vector3替换!"));const o=e.Transforms.cartographicToFixedFrame(t);if(r){if(!Array.isArray(r))throw new e.DeveloperError("rotation must be an array");this._rotation=r;const t=new e.Matrix4;t.rotateX(r[0]*e.CONSTS.TRANSFORM.DEG_TO_RAD),t.rotateY(r[1]*e.CONSTS.TRANSFORM.DEG_TO_RAD),t.rotateZ(r[2]*e.CONSTS.TRANSFORM.DEG_TO_RAD),o.multiplyRight(t);}else if(n){if(!(n instanceof e.Quaternion))throw new e.DeveloperError("quaternion must be an Quaternion instance");const t=new e.Matrix4;t.fromQuaternion(n),o.multiplyRight(t);}if(s){if(!(Array.isArray(s)||s instanceof e.Vector3))throw new e.DeveloperError("scale must be an array or Vector3!");const t=new e.Matrix4;t.scale(s),o.multiplyRight(t);}this.applyMatrix(o);}}this._updateOriginalRotationScaleMatrix();}_updateOriginalRotationScaleMatrix(){if(this.animationLock)return;const t=this.matrix.clone(),i=new e.Vector3(this.position),s=e.Transforms.eastNorthUpToFixedFrame(i).invert();this.originalRotationScaleMatrix=t.multiplyLeft(s);}set rotation(t){const i=e.Transforms.cartesian3ToCartographic(new e.Vector3(...this.position)),s=e.Transforms.cartographicToFixedFrame(new e.Vector3(...i)),r=new e.Matrix4;r.rotateX(t[0]*e.CONSTS.TRANSFORM.DEG_TO_RAD),r.rotateY(t[1]*e.CONSTS.TRANSFORM.DEG_TO_RAD),r.rotateZ(t[2]*e.CONSTS.TRANSFORM.DEG_TO_RAD),s.multiplyRight(r),this.quaternion=(new e.Quaternion).fromRotationMatrix4(s),this._rotation=t,this.updateMatrixWorld(!0),this._updateOriginalRotationScaleMatrix();}get rotation(){return this._rotation}get visibility(){return this._visibility}set visibility(e){for(let t=0;t<this.opaqueList.length;t++)this.opaqueList[t].show="visible"===e;for(let t=0;t<this.translucentList.length;t++)this.translucentList[t].show="visible"===e;this._visibility=e;}get scale(){return this._scale}set scale(t){if(t instanceof Array&&3===t.length)t=new e.Vector3(...t);else {if(t instanceof Array&&3!==t.length)return void console.error("The current value's length is not 3! Please check it!");if(!(t instanceof Array||t instanceof e.Vector3))return void console.error("The current value is unKnown type! Please use minemap.Math.Vector3 instaded!")}this.unmodified=!1,this._scale=t,this.updateMatrixWorld(!0),this._boundingVolume=this._getBoundingVolume(),this._updateOriginalRotationScaleMatrix();}get activeAnimation(){return this._activeAnimation}set activeAnimation(t){e.isBoolean(t)&&(this._activeAnimation=t);}get animationsName(){let t;if(e.defined(this._gltfJson)&&this._gltfJson.animations){t=[];for(let e=0;e<this._gltfJson.animations.length;e++)t.push(this._gltfJson.animations[e].name);}return t}get currentAnimations(){return this._currentAnimations}set currentAnimations(t){if(!(t instanceof Array))return;const i=this;i._currentAnimations.length=0;const s=this._gltfJson.animations;e.defined(s)&&s.length>0&&s.forEach((e=>{for(let s=0;s<t.length;s++){if(e.name===t[s]){e.play(),i._currentAnimations.push(t[s]);break}e.stop();}}));}get allowPick(){return this._allowPick}set allowPick(e){this._allowPick=e;let t=[];t=t.concat(this.translucentList,this.opaqueList);for(let i=0;i<t.length;i++)t[i].allowPick=e,e&&!t[i]._owner&&(t[i]._owner=t[i]._geometry,t[i].update(this._map.painter,this._map.painter.frameState));}_getBoundingVolume(){let t;if(e.defined(this.modelInstanceCollection))t=this.modelInstanceCollection.boundingVolume;else {let i=[];const s=[];i=i.concat(this.opaqueList,this.translucentList);for(let e=0;e<i.length;e++){const t=i[e].boundingVolume.computeCorners();for(let e=0;e<t.length;e++)s.push(t[e]);}t=e.OrientedBoundingBox.fromPoints(s);}return t}getBounds(){let t,i=this._boundingVolume;if(e.defined(i)||(i=this._boundingVolume=this._getBoundingVolume()),i instanceof e.TileBoundingRegion)i=i.boundingVolume;else if(i instanceof e.BoundingSphere){t=i.getBoundingMaximum();const s=e.Transforms.cartesian3ToCartographic(t.boundingMaxValue),r=e.Transforms.cartesian3ToCartographic(t.boundingMinValue);return new e.LngLatBounds([r[0],r[1]],[s[0],s[1]])}const s=e.Rectangle.fromCartesianArray(i.computeCorners()),r=e.CONSTS.CesiumMath.toDegrees(s.west),n=e.CONSTS.CesiumMath.toDegrees(s.south),o=e.CONSTS.CesiumMath.toDegrees(s.east),a=e.CONSTS.CesiumMath.toDegrees(s.north);return new e.LngLatBounds([r,n],[o,a])}addGlTF(t){this.add(...t.scene.nodes),this.updateMatrixWorld(!0),this._gltfJson=t,e.defined(this._gltfJson.animations)&&this._gltfJson.animations.length>0&&(this._currentAnimations.length=0,this._currentAnimations[0]=this._gltfJson.animations[0].name);const i=e.getPrimitives(this._gltfJson);e.defined(this.modelInstanceCollection)&&(this.modelInstanceCollection._primitivesInstance=i,this.modelInstanceCollection.dirty=!0),this.separatePrimitives(i);}async load(){const e=await this._loadModel();this.addGlTF(e),this._finishLoad();}_finishLoad(){this._setInstancePropertiesState="ready",this.state="loaded",this._map.needRepaint=!0,this.loadedCallback&&this.loadedCallback(this);}async _loadModel(){let e;return e="string"==typeof this._data?await this._processStringGltf():await this._processBinaryGltf(),e}async _processStringGltf(){const{_transformRequest:t}=this._map,i=lt(this._data),s={request:t(e.exported.resolveURL(i),e.ResourceType.Source)},r=await cs(s.request.url,ma,{gltf:{postProcess:!0,loadImages:!0},context:this._map.painter.context,modelInstanceCollection:this.modelInstanceCollection,useMipmap:this.useMipmap,clippingPlanes:this.clippingPlanes,allowPick:this.allowPick,dispatcher:this._map.style.dispatcher,transformRequest:t,lightingModel:this.lightingModel},0,lt(this.modelFolder));if(r){if(this._removed||r&&r.abandoned)return;this._loaded=!0,this.state="parsing",this.result=r;for(let e=0;r.bufferViews&&e<r.bufferViews.length;e++)r.bufferViews[e].data=null,r.bufferViews[e].buffer=null;for(let e=0;r.images&&e<r.images.length;e++)r.images[e].bufferView=null,r.images[e].image=null;return r}return null}async _processBinaryGltf(){if(this._data.byteLength)return await _s(this._data,ma,{gltf:{postProcess:!0,loadImages:!0},modelInstanceCollection:this.modelInstanceCollection,clippingPlanes:this.clippingPlanes,allowPick:this.allowPick},null);let e;if(e=this._data.buffers[0].data?function(e){return e.map((e=>({byteLength:e.byteLength,arrayBuffer:e.data[0].buffer,name:e.name,byteOffset:0})))}(this._data.buffers):function(e){return e.map((e=>{const t=new Uint8Array((i=e.uri,window.atob(i.substring(i.indexOf(",")+1)).split("").map((e=>e.charCodeAt(0)))));var i;return {byteLength:t.byteLength,arrayBuffer:t.buffer,name:e.name||"name-undefined",byteOffset:0}}))}(this._data.buffers),this._data.buffers=e,!(this._data.images&&this._data.images.length>0))return na({json:this._data,buffers:this._data.buffers,baseUri:this.modelFolder},{lightingModel:this.lightingModel});!function(e,t,i){const s=[];for(let i=0;i<e.length;i++){const r=Sn(e[i].uri,t);s.push(cs(r,Ls,{},0,null));}Promise.all(s).then((e=>{i(e);}));}(this._data.images,{modelFolder:this.modelFolder},(e=>na({json:this._data,buffers:this._data.buffers,images:e,baseUri:this.modelFolder},{lightingModel:this.lightingModel})));}separatePrimitives(t){const i=function(t){const i={};return e.checkIsVectorShadowVolumeDataType(t.classificationType)&&(i.SHADOW_VOLUME=!0),t.lightingModel===e.LightingModelType.PBR?(i.USE_PBR=!0,i.USE_IBL=!0):(i.USE_PBR=!1,i.USE_IBL=!1),i.PHONG_LIGHT=t?.lightingModel===e.LightingModelType.PHONG,i}(this);for(let s=0;s<t.length;s++){if(t[s].rootId=this.id,t[s]._material.backCulling=this.backCulling,e.defined(t[s]._material)&&t[s]._material.hasMorph){const e=this;t[s]._material._uniforms.set("u_morphTargetInfluences",(()=>e.animationResult.u_morphTargetInfluences));}delete i.JOINT_MATRIX_CNT;const r=t[s].skinsIndex;if(e.defined(r)&&(e.defined(this._gltfJson)&&e.defined(this._gltfJson.skins)&&this._gltfJson.skins.length>0&&(i.JOINT_MATRIX_CNT=this._gltfJson.skins[r].joints.length),t[s]._material.defines=i,e.defined(this._gltfJson)&&e.defined(this._gltfJson.skins)&&this._gltfJson.skins.length>0)){const e=this;t[s]._material._uniforms.set("u_jointMatrix",(()=>{const t=e.animationResult,i=[];for(let e=0;t?.u_jointMatrixs&&e<t.u_jointMatrixs[r].length;e++)i.push(t.u_jointMatrixs[r][e]);return i}));}t[s].modelInstanceCollection=this.modelInstanceCollection,(this.modelInstanceCollection||this.animationPropertyCollection?.size>0)&&(t[s].modelInstanceType=this.type),t[s].show="visible"===this._visibility,t[s]._material.isTranslucent?this.translucentList.push(t[s]):this.opaqueList.push(t[s]);}}updateAnimation(){const e=this.animationPropertyCollection.getAll();1===e.length?e[0].updateAnimation(this):console.warn(`id为"${this.id}"的gltf轨迹动画只能有1个`);}update(t){if("loaded"===this.state){e.defined(this._boundingVolume)||(this._boundingVolume=this._getBoundingVolume()),e.defined(this.modelInstanceCollection)&&this.modelInstanceCollection._parentBouningVolumeNeedUpdate&&(this._boundingVolume=this._getBoundingVolume(),this.modelInstanceCollection._parentBouningVolumeNeedUpdate=!1),this.zoomControl(),this.activeAnimation&&(this.animationResult=pa.updateAnimation({gltfJson:this._gltfJson})),this.animationPropertyCollection&&this.animationPropertyCollection.size>0&&this.updateAnimation();for(let e=0;e<this.opaqueList.length;e++)this.activeAnimation&&(this._gltfJson?.animations?.length||this._gltfJson?.skins?.length)&&this.opaqueList[e].computeBounding(),this.opaqueList[e]._material.clippingPlanes=this.clippingPlanes;for(let e=0;e<this.translucentList.length;e++)this.activeAnimation&&(this._gltfJson?.animations?.length||this._gltfJson?.skins?.length)&&this.translucentList[e].computeBounding(),this.translucentList[e]._material.clippingPlanes=this.clippingPlanes;if(e.defined(this.modelInstanceCollection)){this.modelInstanceCollection.update({context:t.framebuffer.context});for(let e=0;e<this.opaqueList.length;e++){const t=this.opaqueList[e]._geometry;t._segmentVector.segments[0].instancesCount!==this.modelInstanceCollection._instances.size&&(t._segmentVector.segments[0].instancesCount=this.modelInstanceCollection._instances.size,t.dynamicLayoutBuffer1=this.modelInstanceCollection?.instanceBuffer);}for(let e=0;e<this.translucentList.length;e++){const t=this.translucentList[e]._geometry;t._segmentVector.segments[0].instancesCount!==this.modelInstanceCollection._instances.size&&(t._segmentVector.segments[0].instancesCount=this.modelInstanceCollection._instances.size,t.dynamicLayoutBuffer1=this.modelInstanceCollection?.instanceBuffer);}}}}setInstanceProperties(){this.modelInstanceCollection.update({context:this._map.painter.context}),fa.updatePrimitiveProperties(this.translucentList,this),fa.updatePrimitiveProperties(this.opaqueList,this);}zoomControl(){let t=[];t=t.concat(this.translucentList,this.opaqueList);const i=t.filter((e=>!0===e.show));if(0!==i.length&&i.length!==t.length)return;const s=e.isHiddenByMapZoom(this,this._map.getZoom());this.controlDisplay(t,!s);}controlDisplay(e,t){for(let i=0;i<e.length;i++)e[i].show=t;}loaded(){return "loaded"===this.state&&e.defined(this._boundingVolume)}destroy(){if("loaded"!==this.state)return this._destroyCount=0,this._destroyTimeout&&clearTimeout(this._destroyTimeout),void(this._destroyTimeout=setTimeout((()=>{this._destroyCount++,this._destroyCount<10?this.destroy():(console.error("当前的scene model对象删除失败，已经重试了10次！原因是state一直未loaded，请检查数据。"),clearTimeout(this._destroyTimeout));}),1e4));if(this.animationPropertyCollection&&this.animationPropertyCollection.size>0)throw new Error(`sceneComponent "${this.id}" cannot be removed while animation is using it`);for(let e=0;e<this.opaqueList.length;e++)this.opaqueList[e].destroy();for(let e=0;e<this.translucentList.length;e++)this.translucentList[e].destroy();for(const e in this)Object.hasOwnProperty.call(this,e)&&(this[e]=null);}static updatePrimitiveProperties(e,t){if(0!==e.length)for(const i of e){const e=i._geometry,s=i._material,r=e._segmentVector.segments[0];r.isInstance=!0,r.instancesCount=t.modelInstanceCollection?._instances?.size||0,e.dynamicLayoutBuffer1=t.modelInstanceCollection?.instanceBuffer,s.isInstance=!0,s.defines.INSTANCE_MATRIX=!0,i.modelInstanceCollection=t.modelInstanceCollection,i.modelInstanceType=t.type;}}}class ga extends e.Material{constructor(t){if(super(t),this.type="BillboardMaterial",this._image=t.image,this._flipY=e.defaultValue(t.flipY,!1),this._imageDirty=!!this._image,this._imageUrl=t.imageUrl,this._sizeattenuation=t.sizeattenuation,this._imageUrl&&this._getImage(this._imageUrl),this._texture=e.defaultValue(t.texture,null),this._position=t.position,this._scale=t.scale,this._center=e.defaultValue(t.center,new e.Vector2(0,0)),this._rotation=e.defaultValue(t.rotation,0),this._pixelResolution=e.defaultValue(t.pixelResolution,null),this._opacity=e.defaultValue(t.opacity,1),this._modelMatrix=void 0,this._scaleMatrix=void 0,this._pickColorDepthTest=e.defaultValue(t.pickColorDepthTest,void 0),t.color)if(t.color instanceof e.Vector4)this._color=e.defaultValue(t.color,new e.Vector4(1,.6,.3,1));else {const i=e.Color.parse(t.color);this._color=e.defaultValue(new e.Vector4(i.r,i.g,i.b,i.a),new e.Vector4(1,.6,.3,1));}this._uvScale=void 0,this._modelMatrixDirty=!0,this.defines={USE_BILLBOARDTEXTURE:null!=this._imageUrl||null!=this._image||null!=this._texture,SIZEATTENUATION:1==this._sizeattenuation,FIXED_PIXEL_SIZE:!!this._pixelResolution,BILLBOARD:!0},this.isTranslucent&&(this.renderState.depthMask=e.renderStateEnum.disableDepthMask);}set position(e){this._modelMatrixDirty=!0,this._position=e;}set scale(e){this._modelMatrixDirty=!0,this._scale=e;}set center(e){this._center=e;}set rotation(e){this._rotation=e;}set opacity(e){this._opacity=e;}get opacity(){return this._opacity}set image(e){this._imageDirty=!0,this._image=e;}set sizeattenuation(e){this._sizeattenuation=e,this.defines={SIZEATTENUATION:e};}set pixelResolution(e){if(e&&(!e.length||2!==e.length))throw new Error("公告板像素大小必须是长度为2的数组");this._pixelResolution=e,this.defines={FIXED_PIXEL_SIZE:!!this._pixelResolution},this._modelMatrixDirty=!0;}get pickColorDepthTest(){return this._pickColorDepthTest}set pickColorDepthTest(e){this._pickColorDepthTest=e;}update(e,t,i={}){super.update(e,t,i),this._modelMatrixDirty&&this._parse(),this._updateUniforms(t,e),this._imageDirty&&this._updateImageData(e.context);}_parse(){if(e.defined(this._position)){const t=e.Transforms.cartographicToFixedFrame(this._position);if(this._pixelResolution)this._modelMatrix=t;else {const i=(new e.Matrix4).makeScale(this._scale[0],this._scale[1],1);this._modelMatrix=t.multiplyRight(i),this._scaleMatrix=e.Matrix4.IDENTITY;}}else this._modelMatrix=void 0,this._scaleMatrix=(new e.Matrix4).makeScale(this._scale[0],this._scale[1],1);this._modelMatrixDirty=!1;}_updateUniforms(t,i){this.uniforms=new Map([["u_MvMatrix",()=>this._modelMatrix?t.camera.getViewMatrix().multiplyRight(this._modelMatrix):void 0],["u_center",()=>this._center],["u_rotation",()=>this._rotation],["u_BaseColorSampler",()=>{const t=e.defaultValue(this._texture,i.context.defaultTexture);return t.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),t}],["u_ProjectionMatrix",()=>t.camera.getProjectionMatrix()],["u_Color",()=>this._color],["u_InvertViewMatrix",()=>t.camera.getViewMatrix().invert()],["u_ScaleMatrix",()=>this._scaleMatrix],["u_UVScale",()=>this._uvScale],["u_Opacity",()=>this._opacity],["u_pixelResolution"]]),this._pixelResolution&&this._uniforms.set("u_PixelResolution",(()=>new e.Vector2(this._pixelResolution)));}async _getImage(t){const i=this;this._image=await new Promise(((s,r)=>{e.getImage({url:t,imageBitmapOptions:{premultiplyAlpha:"none"}},((e,t)=>{if(e)throw r(e),new Error(e);i._imageDirty=!0,s(t);}));}));}_updateImageData(t){this._imageDirty=!1,this._texture?(this._texture.upload(this._image),this._texture._hasSetSampler=!1):this._texture=new e.Texture({context:t,image:this._image,pixelFormat:e.WebGLConstants.RGBA,flipY:this._flipY});}serialize(){}destroy(){this.type=null,this.texture=null,this._scale=null,this._center=null,this._rotate=null,this._pixelResolution=null,this._modelMatrixDirty=!1,this._texture&&this._texture.destroy();}}const ya=e.createLayout([{name:"a_POSITION",type:"Float32",components:3},{name:"a_TEXCOORD_0",type:"Float32",components:2}]);class Ca extends e.Geometry{constructor(){super({}),this._vertBuffer=void 0,this._indexBuffer=void 0,this._segmentVector=void 0,this.primitiveType=e.WebGLConstants.TRIANGLES,this._vertexArray=new e.StructArrayLayout5f20,this._indicesArray=new e.StructArrayLayout3ui6,this.vertices=[-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1],this.indices=[0,1,2,0,2,3],this._parse(),this.boundingSphere=null,this.boundingBox=null;}_parse(){for(let e=0;e<this.indices.length;e+=3)this._indicesArray.emplaceBack(this.indices[e],this.indices[e+1],this.indices[e+2]);for(let e=0;e<this.vertices.length;e+=5)this._vertexArray.emplaceBack(this.vertices[e],this.vertices[e+1],this.vertices[e+2],this.vertices[e+3],this.vertices[e+4]);}update(t){const i=t.painter.context;this._vertBuffer&&this._indexBuffer&&this._segmentVector||(this._vertBuffer=i.createVertexBuffer(this._vertexArray,ya.members,!1),this._indexBuffer=i.createIndexBuffer(this._indicesArray,!1),this._segmentVector=e.SegmentVector.simpleSegment(0,0,4,2));}serialize(){}destroy(){super.destroy(),this._vertBuffer=void 0,this._indexBuffer=void 0,this._segmentVector=void 0,this._vertexArray=void 0,this.indices=void 0;}}class Ta{constructor(e){this._map=e,this._animationCollection=new Map,this._billboardId=new Map;}get animations(){return this._animationCollection}getById(e){let t;return this.animations.has(e)&&(t=this.animations.get(e)),t}getByIndex(t){let i;const s=[...this.animations][t];return e.defined(s)&&(i=s[1]),i}load(t){let i;return i="string"==typeof t?new Promise((i=>{e.getJSON(_t(t),((e,t)=>{i(t);}));})):t,i}add(t){const i=this.load(t),s=this;return Promise.resolve(i).then((t=>{if(e.defined(t))return s.process(t)})).catch((e=>{throw new Error(e)}))}contains(t){let i=!1;return e.defined(t)&&this.animations.has(t.id)&&(i=!0),i}remove(t){let i=!1;return e.defined(t)&&e.defined(t.id)&&this.animations.has(t.id)&&(i=this.removeById(t.id)),i}removeAll(){const e=this;this.animations.forEach(((t,i)=>{e.removeById(i);}));}removeById(t){let i=this.getById(t),s=!1;if(e.defined(i))this.animations.delete(t),i._root.animationPropertyCollection.removeAll(!0),"BillboardMaterial"===i._root._material?.type&&this._map.removePrimitive(i._root),e.defined(i._root.modelInstanceCollection)&&(i._root.modelInstanceCollection=void 0),e.defined(i._root.animationModelInstanceCollection)&&(i._root.animationModelInstanceCollection=void 0),i.actions.forEach((e=>{e.destroy();})),i._root.animationPropertyCollection=null,i._map=null,i._root=null,s=!0;else if(this._billboardId.has(t)){for(const s of this._billboardId.get(t))i=this.getById(s),e.defined(i)&&(this._map.removePrimitiveById(s),this.animations.delete(s),i._root.animationPropertyCollection.removeAll(!0),e.defined(i._root.animationModelInstanceCollection)&&(i._root.animationModelInstanceCollection=void 0),i.actions.forEach((e=>{e.destroy();})),i._root.animationPropertyCollection=null,i._map=null,i._root=null);s=!0;}return s}process(t){let i=[];if(e.defined(t.contents)&&t.contents.length>0)for(let e=0;e<t.contents.length;e++)i=i.concat(xa(this,t.contents[e]));else e.defined(t.id)&&e.defined(t.type)&&(i=i.concat(xa(this,t)));return this._map.trackingOptions&&i.forEach((e=>{e.trackingOptions=this._map.trackingOptions;})),i}serialize(){const t={document:"Animation",contents:[]},i=[];return this.animations.forEach(((t,s)=>{const r={};let n,o;r.id=s;const a=t.actions[0]._clip.tracks,l=e.defined(a)?t.actions[0]._clip.tracks[0].type:void 0;if(t._root instanceof e.Primitive)switch(l){case"trackingKeyframeTrack":case"positionKeyframeTrack":n="primitive";break;case"multiTrackingKeyframeTrack":case"multiPositionKeyframeTrack":n="primitiveInstance";}else if(t._root instanceof fa)switch(l){case"trackingKeyframeTrack":case"positionKeyframeTrack":n="model";break;case"multiTrackingKeyframeTrack":case"multiPositionKeyframeTrack":n="modelInstance";}else t._root instanceof vt&&(n="extrusion");r.type=n;const _=[].concat(e.defined(l)?a[0].values:[]),c=[];if("modelInstance"===n||"primitiveInstance"===n)for(let t=0;t<_.length;t++){const i=[].concat(_[t]),s=[];for(let t=0;t<i.length;t++){let r=i[t].clone();r=e.Cartographic.fromVector3(r),r.x=e.toDegrees(r.x),r.y=e.toDegrees(r.y),s.push(r.x),s.push(r.y),s.push(r.z);}c.push(s);}else for(let t=0;t<_.length;t++){let i=_[t].clone();i=e.Cartographic.fromVector3(i),i.x=e.toDegrees(i.x),i.y=e.toDegrees(i.y),c.push(i.x),c.push(i.y),c.push(i.z);}c.length>0&&(r.positions=c);const u={},d=t.actions[0]._clip.startTime,m=t.actions[0]._clip.endTime,p=e.defined(a)?a[0].times:void 0;switch(u.start=d,u.end=m,e.defined(p)&&(u.steps=p),r.times=u,l){case"trackingKeyframeTrack":case"multiTrackingKeyframeTrack":o="ellipsoid";break;case"positionKeyframeTrack":case"multiPositionKeyframeTrack":o="none";break;default:o=void 0;}e.defined(o)&&(r.reference=o);let f=t.actions[0].loop;switch(f){case h.LOOP_REPEAT:f="repeat";break;case h.LOOP_ONCE:f="once";break;case h.LOOP_NONE:f="none";}if(r.loop=f,"multiPositionKeyframeTrack"===l){const e={};e.names=t.actions[0]._clip.tracks[0].primitiveNames;const i=[];for(let e=0;e<t.actions[0]._clip.tracks[0].colors.length;e++){const s=[];for(let i=0;i<t.actions[0]._clip.tracks[0].colors[e].length;i++){const r=t.actions[0]._clip.tracks[0].colors[e][i].toString().split(","),n=[];n.push(parseFloat(r[0])),n.push(parseFloat(r[1])),n.push(parseFloat(r[2])),n.push(parseFloat(r[3])),s.push(n);}i.push(s);}e.colors=i,r.material=e,r.rotations=t.actions[0]._clip.tracks[0]._angles;}i.push(r);})),t.contents=i,i.length>0?t:void 0}update(e){this.animations.forEach((t=>{t.update(e);}));}}function xa(t,i){let s=[];for(let r=0;r<Ta.updaters.length;r++){const n=Ta.updaters[r](t,i);e.defined(n)&&(n.onPlay=i.onPlay,n.onPlaying=i.onPlaying,n.onPause=i.onPause,n.onStop=i.onStop,n.onReset=i.onReset,n.speed=i.speed||1,n.autoStop=i.autoStop||!1,n.callback=i.callback,s=s.concat(n));}return s}function ba(e){let t;return t="modelInstance"===e.type||"primitiveInstance"===e.type?"ellipsoid"===e.reference?Qe:$e:"ellipsoid"===e.reference?Ye:Ze,t}function va(t,i){if(!e.defined(i.id))throw new Error("id is not defined!");let s;switch(i.type){case"primitive":case"primitiveInstance":case"billboard":s=t._map.getPrimitiveById(i.id);break;case"model":case"modelInstance":s=t._map.getSceneComponent(i.id);break;case"extrusion":s=t._map.getSource(i.id);}if(!e.defined(s))throw new Error(`${i.id} is not found!`);return s}function wa(e){let t;switch(e.loop){case"repeat":default:t=h.LOOP_REPEAT;break;case"once":t=h.LOOP_ONCE;break;case"none":t=h.LOOP_NONE;}return t}function Sa(t){if(!e.defined(t.times))throw new Error(`${t.id}'s times is not defined!`);const i=t.times,s=e.JulianDate.fromIso8601(i.start),r=e.JulianDate.fromIso8601(i.end),n=e.JulianDate.secondsDifference(r,s);let o=i.steps;const a=t.positions;let l=0,h=[];if(!e.defined(a)&&"extrusion"!==t.type)throw new Error("positions is not defined!");if(!e.defined(o)){let i;if(o=[],"modelInstance"===t.type||"primitiveInstance"===t.type)a.forEach((t=>{if(!(t instanceof Array))throw new Error("Incorrect positions of instance!");if(t.length%3!=0)throw new Error("Incorrect number of instance's positions!");i=t.length/3;const s=[];let r=0;for(let s=0;s<i-1;s++){const i=e.Vector3.fromArray(e.Transforms.cartographicToCartesian3(t.slice(3*s,3*s+3))),r=e.Vector3.fromArray(e.Transforms.cartographicToCartesian3(t.slice(3*(s+1),3*(s+1)+3))),n=e.Vector3.distance(i,r);h.push(n),l+=n;}for(let e=0;e<i;e++)0===e?s.push(0):(r+=h[e-1],s.push(n*(r/l)));h=[],l=0,o.push(s);}));else if("extrusion"!==t.type){if(a.length%3!=0)throw new Error("Incorrect number of positions!");i=a.length/3;let t=0;for(let t=0;t<i-1;t++){const i=e.Vector3.fromArray(e.Transforms.cartographicToCartesian3(a.slice(3*t,3*t+3))),s=e.Vector3.fromArray(e.Transforms.cartographicToCartesian3(a.slice(3*(t+1),3*(t+1)+3))),r=e.Vector3.distance(i,s);h.push(r),l+=r;}for(let e=0;e<i;e++)0===e?o.push(0):(t+=h[e-1],o.push(n*(t/l)));}}return {start:i.start,end:i.end,duration:n,steps:o,trackCalculation:{trackLength:l,trackSegments:h}}}function Aa(t){const i=t.positions,s=t.rotations;if(!e.defined(s))return;if(i.length!==s.length)throw new Error("positions's length must be equal than rotations's length!");let r,n,o=[];const a=[],l=Array(3);for(let e=0;e<i.length;e++){if(r=i[e],n=s[e],n.length%3!=0||n.length<3)throw new Error("Incorrect number of instance's rotations!");if(r.length>n.length){const e=r.length-n.length;l[0]=n[n.length-3],l[1]=n[n.length-2],l[2]=n[n.length-1],o=o.concat(n);for(let t=0;t<e;t++)o=o.concat(l);a.push(o);}else if(r.length<n.length){const e=r.length-n.length;a.push(n.splice(n.length-1-e,e));}else a.push(n);}return a}function Ea(e,t,i,s,r,n,o){const a=new Ke(t,[new Ue(i,s,r,n,o)]);return e.animations.set(a.id,a),a}Ta.updaters=[function(e,t){if("primitive"!==t.type&&"extrusion"!==t.type&&"model"!==t.type)return;const i=ba(t),s=t.positions,{start:r,end:n,duration:o,steps:a,trackCalculation:l}=Sa(t),h=va(e,t);let _;"extrusion"!==t.type&&(_=[new i("position",a,s)]);const c=Ea(e,h,o,_,wa(t),r,n);return t.autoPlay&&c.play(),c.trackCalculation=l,c},function(t,i){if("modelInstance"!==i.type&&"primitiveInstance"!==i.type)return;const s=i.positions,{start:r,end:n,duration:o,steps:a,trackCalculation:l}=Sa(i),h=Aa(i),_=i.translations,c=function(t){if(e.defined(t.material)&&e.defined(t.material.colors))return t.material.colors}(i),u=e.defined(i.material)?i.material.names:void 0,d=i.trackIds,m=wa(i),p=[new(ba(i))("position",a,s,h,_,null,c,u,d)],f=Ea(t,va(t,i),o,p,m,r,n);return i.autoPlay&&f.play(),f.trackCalculation=l,f},function(t,i){if("billboard"!==i.type||!e.defined(i.extra))return;if(!e.defined(i.positions))throw new Error("positions is not defined!");if(!e.defined(i.id))throw new Error("id is not defined!");const s=[],r=Aa(i),{start:n,end:o,duration:a,steps:l}=Sa(i),h=i.positions.length,_=t._billboardId.get(i.id)||[],c=[];for(let u=0;u<h;u++){const h=i.positions[u],d=i.translations?i.translations[u]:null,m=r?r[u]:null,p=l[u],f=`${i.id}_${u}`;let g;if(g=i.extra.scale?Array.isArray(i.extra.scale[u])?i.extra.scale[u]:i.extra.scale:[1,1,1],c.push(f),_){const e=_.indexOf(f);e>-1&&_.splice(e,1);}let y=t._map.getPrimitiveById(f);if(y){if("BillboardMaterial"!==y._material.type)throw new e.DeveloperError(` duplicated in ${f} with different primitive type `);y.animationPropertyCollection=new e.AnimationPropertyCollection,y._material.scale=g;}else {const i=new Ca({}),s=new ga({scale:g,center:new e.Vector2(.5,.25),rotation:0,color:[0,0,0,0]});y=new e.Primitive({geometry:i,material:s,id:f,show:!1}),t._map.addPrimitive(y);}const C=i.extra.image,T={};for(const[e,t]of Object.entries(i.extra.imageInfo))T[e]=t[u];const x=[new Ze(f,p,h,m,d,null,null,null,C,T)];C&&T&&x[0].parseImageInfo(C,T,t._map.painter.context);const b=Ea(t,y,a,x,wa(i),n,o);e.defined(b)&&s.push(b),i.autoPlay&&b.play();}for(const e of _)t._map.removePrimitiveById(e);return t._billboardId.set(i.id,c),s}];class Ma{constructor(t){this.tileSize=512,this.scale=this._zoomToScale(0),this._posMatrixCache={},this.screenSize=new e.Vector2(0,0),this.position=new e.Vector3(0,0,0),this.headingPitchRoll=new e.HeadingPitchRoll(0,0,0),this._transform=t;}update(t){let i=!1;e.defined(t.fov)&&this._fov!==t.fov&&(this._fov=t.fov,i=!0),e.defined(t.position)&&!e.Vector3.equals(this.position,t.position)&&(this.position=t.position,this.cameraHeightConvertedZoom=e.getZoomFromDistance(this._fov,this.position[2]+e.CONSTS.TRANSFORM.R,e.CONSTS.TRANSFORM.R),this.scale=this._zoomToScale(this.cameraHeightConvertedZoom),i=!0),e.defined(t.headingPitchRoll)&&!e.HeadingPitchRoll.equals(this.headingPitchRoll,t.headingPitchRoll)&&(this.headingPitchRoll=t.headingPitchRoll,i=!0),e.defined(t.screenSize)&&!e.Vector2.equals(this.screenSize,t.screenSize)&&(this.screenSize=t.screenSize,i=!0),e.defined(t.projection)&&this.projection!==t.projection&&(this.projection=t.projection,i=!0),i&&(this.convertedMapOptions=null,this.calcMatrices());}_zoomToScale(e){return Math.pow(2,e)}calculatePosMatrix(t){const i=t.key,s=this._posMatrixCache;if(s[i])return s[i];const r=t.canonical,n=this.worldSize/this._zoomToScale(r.z),o=new e.Matrix4;return o.translate([r.x*n,r.y*n,0]),o.scale([n/e.EXTENT,n/e.EXTENT,1]),o.multiplyLeft(this.projMatrix),s[i]=o.toArray(),s[i]}calcMatrices(){this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const t=this.getMapViewParams().pitch*e.CONSTS.TRANSFORM.DEG_TO_RAD,i=this.getMapViewParams().bearing*e.CONSTS.TRANSFORM.DEG_TO_RAD,s=Math.PI/2+t,r=.5*this.height/Math.sin(Math.PI-s-this._fov/2),n=this.cameraX,o=this.cameraY,a=1.01*(Math.cos(Math.PI/2-t)*r+this.cameraToCenterDistance),l=new e.Matrix4;l.perspective({fov:this._fov,aspect:this.width/this.height,near:1,far:a}),l.scale([1,-1,1]),l.rotateX(t),l.rotateZ(-i),l.translate([-n,-o,-this.cameraToCenterDistance]);const h=this.worldSize/(2*Math.PI*e.CONSTS.TRANSFORM.REAL_R*Math.abs(Math.cos(this.getMapViewParams().lat*e.CONSTS.TRANSFORM.DEG_TO_RAD)));l.scale([1,1,h,1]),this.projMatrix=l,this._posMatrixCache={};}get zoom(){return this.getMapViewParams().zoom}getMapViewParams(){if(this.convertedMapOptions)return this.convertedMapOptions;const t=[this.position[0],this.position[1],this.cameraHeightConvertedZoom,this.headingPitchRoll.heading*e.CONSTS.TRANSFORM.RAD_TO_DEG,this.headingPitchRoll.pitch*e.CONSTS.TRANSFORM.RAD_TO_DEG,this.headingPitchRoll.roll*e.CONSTS.TRANSFORM.RAD_TO_DEG],i=e.Transforms.convertV4Pos2V34Traversal(t,this._transform);return this.convertedMapOptions={lng:e.defined(i)?i[0]:t[0],lat:e.defined(i)?i[1]:t[1],zoom:e.defined(i)?i[2]:t[2],bearing:e.defined(i)?i[3]:t[3],pitch:e.defined(i)?i[4]:t[4],roll:e.defined(i)?i[5]:t[5]},this.convertedMapOptions}get height(){return this.screenSize[1]}get width(){return this.screenSize[0]}get worldSize(){return this.tileSize*this.scale}get cameraX(){return e.ProjectionProxy.lngX(this.position[0],this.worldSize,this.projection)}get cameraY(){return e.ProjectionProxy.latY(this.position[1],this.worldSize,this.projection)}get fov(){return this._fov}get centerPoint(){return this.screenSize.clone().multiplyScalar(.5)}getCameraPoint(){const t=Math.tan(this.headingPitchRoll.pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.Vector2(0,t))}getCameraQueryGeometry(t){const i=this.getCameraPoint();if(1===t.length)return [t[0],new e.pointGeometry3d(i.x,i.y)];{let s=i.x,r=i.y,n=i.x,o=i.y;for(const e of t)s=Math.min(s,e.x),r=Math.min(r,e.y),n=Math.max(n,e.x),o=Math.max(o,e.y);return [new e.pointGeometry3d(s,r),new e.pointGeometry3d(n,r),new e.pointGeometry3d(n,o),new e.pointGeometry3d(s,o),new e.pointGeometry3d(s,r)]}}maxPitchScaleFactor(){return 1}destroy(){this.transform=null;}}function Pa(t,i,s){if(t.length<i)return;let r=!0;for(let e=0;e<t.length;e++){if(t[e].error)return s(t[e].error);t[e].image&&t[e].json||(r=!1);}if(!r)return;const n={};for(let i=0;i<t.length;i++){const s=t[i],r=e.exported.getImageData(s.image),o=s.json;for(const t in o){const{width:i,height:s,x:a,y:l,sdf:h,pixelRatio:_,stretchX:c,stretchY:u,content:d}=o[t],m=new e.RGBAImage({width:i,height:s});e.RGBAImage.copy(r,m,{x:a,y:l},{x:0,y:0},{width:i,height:s}),n[t]={data:m,pixelRatio:_,sdf:h,stretchX:c,stretchY:u,content:d};}}s(null,n);}function Ra(e){const{userImage:t}=e;return !!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ba extends e.Evented{constructor(t={}){super(),this.anisotropy=t.anisotropy||0,this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new e.RGBAImage({width:1,height:1}),this.dirty=!0;}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:e,callback:t}of this.requestors)this._notify(e,t);this.requestors=[];}}getImage(e){return this.images[e]}addImage(e,t){this._validate(e,t)&&(this.images[e]=t);}_validate(t,i){let s=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),s=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),s=!1),this._validateContent(i.content,i)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),s=!1),s}_validateStretch(e,t){if(!e)return !0;let i=0;for(const s of e){if(s[0]<i||s[1]<s[0]||t<s[1])return !1;i=s[1];}return !0}_validateContent(e,t){return !(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,t){t.version=this.images[e].version+1,this.images[e]=t,this.updatedImages[e]=!0;}removeImage(e){const t=this.images[e];delete this.images[e],delete this.patterns[e],t.userImage&&t.userImage.onRemove&&t.userImage.onRemove();}listImages(){return Object.keys(this.images)}getImages(e,t){let i=!0;if(!this.isLoaded())for(const t of e)this.images[t]||(i=!1);this.isLoaded()||i?this._notify(e,t):this.requestors.push({ids:e,callback:t});}_notify(t,i){const s={};for(const i of t){this.images[i]||this.fire(new e.Event("styleimagemissing",{id:i}));const t=this.images[i];t?s[i]={data:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)}:e.warnOnce(`Image "${i}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);}i(null,s);}getPixelSize(){const{width:e,height:t}=this.atlasImage;return {width:e,height:t}}getPattern(t){const i=this.patterns[t],s=this.getImage(t);if(!s)return null;if(i&&i.position.version===s.version)return i.position;if(i)i.position.version=s.version;else {const i={w:s.data.width+2,h:s.data.height+2,x:0,y:0},r=new e.ImagePosition(i,s);this.patterns[t]={bin:i,position:r};}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new e.Texture({context:t,image:this.atlasImage,pixelFormat:e.WebGLConstants.RGBA,anisotropy:this.anisotropy}),this.atlasTexture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE);}_updatePatternAtlas(){const t=[];for(const e in this.patterns)t.push(this.patterns[e].bin);const{w:i,h:s}=e.potpack(t),r=this.atlasImage;r.resize({width:i||1,height:s||1});for(const t in this.patterns){const{bin:i}=this.patterns[t],s=i.x+1,n=i.y+1,o=this.images[t].data,a=o.width,l=o.height;e.RGBAImage.copy(o,r,{x:0,y:0},{x:s,y:n},{width:a,height:l}),e.RGBAImage.copy(o,r,{x:0,y:l-1},{x:s,y:n-1},{width:a,height:1}),e.RGBAImage.copy(o,r,{x:0,y:0},{x:s,y:n+l},{width:a,height:1}),e.RGBAImage.copy(o,r,{x:a-1,y:0},{x:s-1,y:n},{width:1,height:l}),e.RGBAImage.copy(o,r,{x:0,y:0},{x:s+a,y:n},{width:1,height:l});}this.dirty=!0;}beginFrame(){this.callbackDispatchedThisFrame={};}dispatchRenderCallbacks(e){for(const t of e){if(this.callbackDispatchedThisFrame[t])continue;this.callbackDispatchedThisFrame[t]=!0;const e=this.images[t];Ra(e)&&this.updateImage(t,e);}}destroy(){let t=Object.keys(this.images);return t.forEach((e=>{this.removeImage(e);})),t=[],e.destroyObject(this)}}const Ia=1e20;function Da(e,t,i,s,r,n,o,a,l){for(let h=t;h<t+s;h++)Oa(e,i*n+h,n,r,o,a,l);for(let h=i;h<i+r;h++)Oa(e,h*n+t,1,s,o,a,l);}function Oa(e,t,i,s,r,n,o){n[0]=0,o[0]=-Ia,o[1]=Ia,r[0]=e[t];for(let a=1,l=0,h=0;a<s;a++){r[a]=e[t+a*i];const s=a*a;do{const e=n[l];h=(r[a]-r[e]+s-e*e)/(a-e)/2;}while(h<=o[l]&&--l>-1);l++,n[l]=a,o[l]=h,o[l+1]=Ia;}for(let a=0,l=0;a<s;a++){for(;o[l+1]<a;)l++;const s=n[l],h=a-s;e[t+a*i]=r[s]+h*h;}}class La{constructor(e,t){this.localGlyphMode=1,this.requestTransform=e,this.localIdeographFontFamily=t,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}};}setURL(e){this.url=e;}getGlyphs(t,i){const s=[];for(const e in t)for(const i of t[e])s.push({stack:e,id:i});e.asyncAll(s,(({stack:e,id:t},i)=>{let s=this.entries[e];s||(s=this.entries[e]={glyphs:{},requests:{}});let r=s.glyphs[t];if(void 0!==r)return void i(null,{stack:e,id:t,glyph:r});if(r=this._tinySDF(s,e,t),r)return void i(null,{stack:e,id:t,glyph:r});const n=Math.floor(t/256);if(256*n>65535)return void i(new Error("glyphs > 65535 not supported"));let o=s.requests[n];o||(o=s.requests[n]=[],La.loadGlyphRange(e,n,this.url,this.requestTransform,((e,t)=>{if(t)for(const e in t)s.glyphs[+e]=t[+e];for(const i of o)i(e,t);delete s.requests[n];}))),o.push(((s,r)=>{s?i(s):r&&i(null,{stack:e,id:t,glyph:r[t]||null});}));}),((e,t)=>{if(e)i(e);else if(t){const e={};for(const{stack:i,id:s,glyph:r}of t)(e[i]||(e[i]={}))[s]=r&&{id:r.id,bitmap:r.bitmap.clone(),metrics:r.metrics};i(null,e);}}));}_doesCharSupportLocalGlyph(t){return 0!==this.localGlyphMode&&(2===this.localGlyphMode?!!this.localIdeographFontFamily:!!this.localIdeographFontFamily&&(e.isChar["CJK Unified Ideographs"](t)||e.isChar["Hangul Syllables"](t)||e.isChar.Hiragana(t)||e.isChar.Katakana(t)||e.isChar["CJK Symbols and Punctuation"](t)))}_tinySDF(t,i,s){const r=this.localIdeographFontFamily;if(!r||!this._doesCharSupportLocalGlyph(s))return;let n=t.tinySDF;if(!n){let e="500";/bold/i.test(i)?e="900":/medium/i.test(i)?e="500":/light/i.test(i)&&(e="200"),n=t.tinySDF=new La.TinySDF({fontFamily:r,fontWeight:e,fontSize:24,buffer:3,radius:8}),n.fontWeight=e;}if(this.localGlyphs[n.fontWeight][s])return this.localGlyphs[n.fontWeight][s];const o=String.fromCharCode(s),{data:a,width:l,height:h,glyphWidth:_,glyphHeight:c,glyphLeft:u,glyphTop:d,glyphAdvance:m}=n.draw(o);return this.localGlyphs[n.fontWeight][s]={id:s,bitmap:new e.AlphaImage({width:l,height:h},a),metrics:{width:_/1,height:c/1,left:u/1,top:d/1-27,advance:m/1,localGlyph:!0}}}}La.loadGlyphRange=function(t,i,s,r,n){const o=256*i,a=o+255,l=r(function(e){if(!ot(e)&&!st.fontsUrl)return e;const t=mt(e);return st.fontsUrl&&`${st.fontsUrl}/{fontstack}${t.path.substr(t.path.lastIndexOf("/"))}.pbf`||`${st.SRC_URL}/fonts/{fontstack}${t.path.substr(t.path.lastIndexOf("/"))}.pbf`}(s).replace("{fontstack}",t).replace("{range}",`${o}-${a}`),e.ResourceType.Glyphs);e.getArrayBuffer(l,((t,i)=>{if(t)n(t);else if(i){const t={};for(const s of e.parseGlyphPBF(i))t[s.id]=s;n(null,t);}}));},La.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:s=.25,fontFamily:r="sans-serif",fontWeight:n="normal",fontStyle:o="normal"}={}){this.buffer=t,this.cutoff=s,this.radius=i;const a=this.size=e+4*t,l=this._createCanvas(a),h=this.ctx=l.getContext("2d",{willReadFrequently:!0});h.font=`${o} ${n} ${e}px ${r}`,h.textBaseline="alphabetic",h.textAlign="left",h.fillStyle="black",this.gridOuter=new Float32Array(a*a),this.gridInner=new Float32Array(a*a),this.f=new Float32Array(a),this.z=new Float32Array(a+1),this.v=new Uint16Array(a);}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:r,actualBoundingBoxRight:n}=this.ctx.measureText(e),o=Math.ceil(i),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(n-r))),l=Math.min(this.size-this.buffer,o+Math.ceil(s)),h=a+2*this.buffer,_=l+2*this.buffer,c=Math.max(h*_,0),u=new Uint8ClampedArray(c),d={data:u,width:h,height:_,glyphWidth:a,glyphHeight:l,glyphTop:o,glyphLeft:0,glyphAdvance:t};if(0===a||0===l)return d;const{ctx:m,buffer:p,gridInner:f,gridOuter:g}=this;m.clearRect(p,p,a,l),m.fillText(e,p,p+o);const y=m.getImageData(p,p,a,l);g.fill(Ia,0,c),f.fill(0,0,c);for(let e=0;e<l;e++)for(let t=0;t<a;t++){const i=y.data[4*(e*a+t)+3]/255;if(0===i)continue;const s=(e+p)*h+t+p;if(1===i)g[s]=0,f[s]=Ia;else {const e=.5-i;g[s]=e>0?e*e:0,f[s]=e<0?e*e:0;}}Da(g,0,0,h,_,h,this.f,this.v,this.z),Da(f,p,p,a,l,h,this.f,this.v,this.z);for(let e=0;e<c;e++){const t=Math.sqrt(g[e])-Math.sqrt(f[e]);u[e]=Math.round(255-255*(t/this.radius+this.cutoff));}return d}};class Va{constructor(t,i){this.width=t,this.height=i,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={},this._target=e.WebGLConstants.TEXTURE_2D;}getDash(e,t){const i=e.join(",")+String(t);return this.dashEntry[i]||(this.dashEntry[i]=this.addDash(e,t)),this.dashEntry[i]}getDashRanges(e,t,i){const s=[];let r=e.length%2==1?-e[e.length-1]*i:0,n=e[0]*i,o=!0;s.push({left:r,right:n,isDash:o,zeroLength:0===e[0]});let a=e[0];for(let t=1;t<e.length;t++){o=!o;const l=e[t];r=a*i,a+=l,n=a*i,s.push({left:r,right:n,isDash:o,zeroLength:0===l});}return s}addRoundDash(e,t,i){const s=t/2;for(let t=-i;t<=i;t++){const r=this.width*(this.nextRow+i+t);let n=0,o=e[n];for(let a=0;a<this.width;a++){a/o.right>1&&(o=e[++n]);const l=Math.abs(a-o.left),h=Math.abs(a-o.right),_=Math.min(l,h);let c;const u=t/i*(s+1);if(o.isDash){const e=s-Math.abs(u);c=Math.sqrt(_*_+e*e);}else c=s-Math.sqrt(_*_+u*u);this.data[r+a]=Math.max(0,Math.min(255,c+128));}}}addRegularDash(e){for(let t=e.length-1;t>=0;--t){const i=e[t],s=e[t+1];i.zeroLength?e.splice(t,1):s&&s.isDash===i.isDash&&(s.left=i.left,e.splice(t,1));}const t=e[0],i=e[e.length-1];t.isDash===i.isDash&&(t.left=i.left-this.width,i.right=t.right+this.width);const s=this.width*this.nextRow;let r=0,n=e[r];for(let t=0;t<this.width;t++){t/n.right>1&&(n=e[++r]);const i=Math.abs(t-n.left),o=Math.abs(t-n.right),a=Math.min(i,o);this.data[s+t]=Math.max(0,Math.min(255,(n.isDash?a:-a)+128));}}addDash(t,i){const s=i?7:0,r=2*s+1;if(this.nextRow+r>this.height)return e.warnOnce("LineAtlas out of space"),null;let n=0;for(let e=0;e<t.length;e++)n+=t[e];if(0!==n){const e=this.width/n,r=this.getDashRanges(t,this.width,e);i?this.addRoundDash(r,e,s):this.addRegularDash(r);}const o={y:(this.nextRow+s+.5)/this.height,height:2*s/this.height,width:n};return this.nextRow+=r,this.dirty=!0,o}bind(t){const i=t.gl;this.texture?(i.bindTexture(e.WebGLConstants.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,i.texSubImage2D(e.WebGLConstants.TEXTURE_2D,0,0,0,this.width,this.height,e.WebGLConstants.ALPHA,e.WebGLConstants.UNSIGNED_BYTE,this.data))):(this.texture=i.createTexture(),i.bindTexture(e.WebGLConstants.TEXTURE_2D,this.texture),i.texParameteri(e.WebGLConstants.TEXTURE_2D,e.WebGLConstants.TEXTURE_WRAP_S,e.WebGLConstants.REPEAT),i.texParameteri(e.WebGLConstants.TEXTURE_2D,e.WebGLConstants.TEXTURE_WRAP_T,e.WebGLConstants.REPEAT),i.texParameteri(e.WebGLConstants.TEXTURE_2D,e.WebGLConstants.TEXTURE_MIN_FILTER,e.WebGLConstants.LINEAR),i.texParameteri(e.WebGLConstants.TEXTURE_2D,e.WebGLConstants.TEXTURE_MAG_FILTER,e.WebGLConstants.LINEAR),i.texImage2D(e.WebGLConstants.TEXTURE_2D,0,e.WebGLConstants.ALPHA,this.width,this.height,0,e.WebGLConstants.ALPHA,e.WebGLConstants.UNSIGNED_BYTE,this.data));}destroy(){return this.data=null,e.destroyObject(this)}}class Na{constructor(t,i){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=e.uniqueId();const s=this.workerPool.acquire(this.id);for(let e=0;e<s.length;e++){const t=new Na.Actor(s[e],i,this.id);t.name=`Worker ${e}`,this.actors.push(t);}}broadcast(t,i,s){e.asyncAll(this.actors,((e,s)=>{e.send(t,i,s);}),s=s||function(){});}send(e,t,i,s){return (isNaN(s)||"number"!=typeof s)&&(s=this.currentActor=(this.currentActor+1)%this.actors.length),this.actors[s]&&this.actors[s].send(e,t,i),s}remove(){this.actors.forEach((e=>{e.remove();})),this.actors=[],this.workerPool.release(this.id);}}Na.Actor=e.Actor;class Fa{constructor(t,i,s){this.bounds=e.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=i||0,this.maxzoom=s||24;}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const t=e.canonical,i=Math.floor(this.lngX(this.bounds.getWest(),t.z,e.projection)),s=Math.floor(this.latY(this.bounds.getNorth(),t.z,e.projection)),r=Math.ceil(this.lngX(this.bounds.getEast(),t.z,e.projection)),n=Math.ceil(this.latY(this.bounds.getSouth(),t.z,e.projection));return t.x>=i&&t.x<r&&t.y>=s&&t.y<n}lngX(e,t,i){return "LATLON"===i?0===t?0:(e+180)*(2*Math.pow(2,t-1))/360:(e+180)*(Math.pow(2,t)/360)}latY(t,i,s){if("LATLON"===s)return 0===i?0:(90-t)*Math.pow(2,i-1)/180;{const s=e.clamp(Math.sin(Math.PI/180*t),-.9999,.9999),r=Math.pow(2,i)/(2*Math.PI);return Math.pow(2,i-1)+.5*Math.log((1+s)/(1-s))*-r}}}var Ga=e.createLayout([{name:"a_POSITION",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),ka=e.createLayout([{name:"a_POSITION",type:"Float32",components:3},{name:"a_texture_pos",type:"Float32",components:2}]);class Ua extends e.Material{constructor(t){super(t),this.isVectorMaterial=!0,this.layer=t.layer,this.tile=t.tile,this._renderState=t.renderState,this.textureFilter=e.defined(this.layer)&&"nearest"===this.layer.paint.get("raster-resampling")?e.WebGLConstants.NEAREST:e.WebGLConstants.LINEAR,this._lightColor=new e.Vector3(1,1,1),this._lightDirection=new e.Vector3,this._spinWeights=new e.Vector3,this.createUniforms();}setLayer(e){this.layer=e;}update(t,i,s={}){super.update(t,i,s),this.defines={ENCODE_DEPTH_TO_FRAGCOLOR:i.passType===e.RenderPassConsts.PICK_PASS,STATIC_IMAGE:!0};}createUniforms(){this._uniforms.set("u_brightness_low",(()=>this.layer.paint.get("raster-brightness-min"))),this._uniforms.set("u_brightness_high",(()=>this.layer.paint.get("raster-brightness-max"))),this._uniforms.set("u_saturation_factor",(()=>{return (e=this.layer.paint.get("raster-saturation"))>0?1-1/(1.001-e):-e;var e;})),this._uniforms.set("u_contrast_factor",(()=>{return (e=this.layer.paint.get("raster-contrast"))>0?1/(1-e):1+e;var e;})),this._uniforms.set("u_spin_weights",(()=>{const e=function(e){e*=Math.PI/180;const t=Math.sin(e),i=Math.cos(e);return [(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}(this.layer.paint.get("raster-hue-rotate"));return this._spinWeights.set(e[0],e[1],e[2])})),this._uniforms.set("u_Opacity",(()=>this.layer.paint.get("raster-opacity"))),this._uniforms.set("u_BaseColorSampler",(()=>(this.tile.texture.bind(this.textureFilter,e.WebGLConstants.CLAMP_TO_EDGE),this.tile.texture)));}checkLayer(){if(!this.layer)throw new Error("请在image plotter中针对image source进行layer的注册，即调用material.setLayer(layer)")}destroy(){this.layer=void 0,this.tile.texture&&(this.tile.texture.destroy(),this.tile.texture=null),this.__texture=null,this.tile=void 0,this.programId=void 0,this.type=void 0,this._uniforms=void 0,this._textures=void 0,this._program=void 0,this._programConfiguration=void 0,this._renderState=void 0,this.textureFilter=void 0,this.parentScaleBy=void 0;}}class Ha extends e.Evented{constructor(t,i,s,r){if(super(),this.id=t,this.dispatcher=s,this.coordinates=function(e){if(e[0]instanceof Array){let t=e[0][0],i=e[0][0],s=e[0][1],r=e[0][1];for(let n=1;n<e.length;n++)t=t>e[n][0]?e[n][0]:t,i=i<e[n][0]?e[n][0]:i,s=s>e[n][1]?e[n][1]:s,r=r<e[n][1]?e[n][1]:r;return [t,s,i,r]}return e}(i.coordinates),i.bounds){const t=i.bounds.map((t=>e.toRadians(t)));this.rectangle=new e.Rectangle(...t);}else this.rectangle=e.Rectangle.MAX_VALUE;this.grid=i.grid,this.wms=!!i.wms&&i.wms,this.url=i.url,this.minzoom=0,this.maxzoom=0,this.type="image",this.tileSize=512,this.tiles={},this.setEventedParent(r),this.options=i,this._imageryCache=new Map,Zo(this);}setCoordinates(e){}load(t,i){this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this.url=this.options.url,e.getImage(this.map._transformRequest(this.url,e.ResourceType.Image),((s,r)=>{this._loaded=!0,s?this.fire(new e.ErrorEvent(s)):r&&(this.image=r,t&&(this.coordinates=t),i&&i(),this._finishLoading());}));}updateImage(e){return this.image&&e.url?(this.options.url=e.url,this.load(e.coordinates,(()=>{this.texture=null;})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})));}onAdd(t){this.map=t;const i=this.coordinates.map((t=>e.toRadians(t)));if(this.map.transform.projection===e.ProjectionType.LATLON)this._tilingScheme=new Ct({rectangle:new e.Rectangle(...i),numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1}),this.projection=e.ProjectionType.LATLON;else {const t=new gt,s=t.project(new e.Cartographic(i[0],i[1],0)),r=t.project(new e.Cartographic(i[2],i[3],0));this._tilingScheme=new yt({rectangleSouthwestInMeters:new e.Vector2(s.x,s.y),rectangleNortheastInMeters:new e.Vector2(r.x,r.y),numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1}),this.projection=e.ProjectionType.MERCATOR;}if(this.wms){this.wmsUrl||(this.wmsUrl=this.options.url);const e=Math.ceil(t.transform.width),i=Math.ceil(t.transform.height),s=Math.ceil(t.style.getNearestTileZoom()),r=`${t.getBounds()._sw.lng},${t.getBounds()._sw.lat},${t.getBounds()._ne.lng},${t.getBounds()._ne.lat}`;this.options.url=this.wmsUrl.replace("{bbox}",r).replace("{width}",e.toString()).replace("{height}",i.toString()).replace("{z}",s.toString()),this.coordinates=[t.getBounds().getNorthWest().toArray(),t.getBounds().getNorthEast().toArray(),t.getBounds().getSouthEast().toArray(),t.getBounds().getSouthWest().toArray()],this.setCoordinates(this.coordinates);}this.load();}onRemove(){}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const t=this.map.painter.context;if(this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Ga.members),this.indexBuffer=t.createIndexBuffer(this._indexArray)),this.sphereBoundsBuffer||(this.sphereBoundsBuffer=t.createVertexBuffer(this._sphereBoundsArray,ka.members),this.sphereIndexBuffer=t.createIndexBuffer(this._sphereIndexArray)),!this.texture){this.texture=new e.Texture({context:t,image:this.image,pixelFormat:e.WebGLConstants.RGBA}),this.texture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE);const i=new e.Geometry({primitiveType:e.WebGLConstants.TRIANGLES,vertBuffer:this.sphereBoundsBuffer,indexBuffer:this.sphereIndexBuffer,segmentVector:this.sphereSegments}),s=new Ua({painter:this.map.painter,tile:this,defines:{},type:"sphereImage",renderState:{}});this.primitive=new e.Primitive({modelMatrix:this.matrix,geometry:i,material:s});}for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture);}}loadTile(e){"loaded"!==e.imagery.state&&this.image&&e.imagery.loadImage({data:{img:this.image},painter:this.map.painter,justReloaded:!1});}unloadTile(e){e.freeResources(e.imagery.tileID.key);}serialize(){return {type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return !1}isEarthSource(){return !0}createTileImagerySkeletons(t){const i=t.sourceCache.map._tilingScheme.tileXYToRectangle(t.tileID.canonical.x,t.tileID.canonical.y,t.sourceCache.map._tilingScheme.type===e.ProjectionType.LATLON?t.tileID.canonical.z-1:t.tileID.canonical.z);this.projection||(this.projection=t.sourceCache.map.projection,this._tilingScheme=t.sourceCache.map._tilingScheme);const s=this._tilingScheme,r=e.Rectangle.intersection(s.rectangle,this.rectangle);if(!r)return [];const n=e.Rectangle.intersection(i,r);if(!n)return [];let o=0;n.south>0?o=n.south:n.north<0&&(o=n.north);let a=function(t,i,s){const r=t._tilingScheme,n=r.ellipsoid,o=r.projection instanceof e.GeographicProjection?1:Math.cos(s),a=n.maximumRadius*r.rectangle.width*o/(t.tileSize*r.getNumberOfXTilesAtLevel(0)),l=Math.log(a/i)/Math.log(2);return 0|Math.round(l)}(this,1*t.sourceCache.terrainSource.getLevelMaximumGeometricError(t.tileID.canonical.z),o);a=Math.min(a,this.maxzoom),a=s.type===e.ProjectionType.LATLON?Math.max(1,a)-1:Math.max(0,a);const l=s.positionToTileXY(e.Rectangle.northwest(n),a),h=s.positionToTileXY(e.Rectangle.southeast(n),a);let _=i.width/512,c=i.height/512;const u=s.tileXYToRectangle(l.x,l.y,a);Math.abs(u.south-i.north)<c&&l.y<h.y&&++l.y,Math.abs(u.east-i.west)<_&&l.x<h.x&&++l.x;const d=s.tileXYToRectangle(h.x,h.y,a);Math.abs(d.north-i.south)<c&&h.y>l.y&&--h.y,Math.abs(d.west-i.east)<_&&h.x>l.x&&--h.x;const m=e.Rectangle.clone(i);let p,f,g=s.tileXYToRectangle(l.x,l.y,a),y=e.Rectangle.intersection(g,r);this.projection===e.ProjectionType.MERCATOR?(s.rectangleToNativeRectangle(m,m),s.rectangleToNativeRectangle(g,g),s.rectangleToNativeRectangle(y,y),s.rectangleToNativeRectangle(r,r),p=s.tileXYToNativeRectangle.bind(s),_=m.width/512,c=m.height/512):p=s.tileXYToRectangle.bind(s);let C,T=0,x=1;Math.abs(y.west-m.west)>=_&&(T=Math.min(1,(y.west-m.west)/m.width)),Math.abs(y.north-m.north)>=c&&(x=Math.max(0,(y.north-m.south)/m.height));const b=x,v=[];for(let i=l.x;i<=h.x;i++){f=T,g=p(i,l.y,a),y=e.Rectangle.simpleIntersection(g,r),T=Math.min(1,(y.east-m.west)/m.width),i===h.x&&Math.abs(y.east-m.east)<_&&(T=1),x=b;for(let s=l.y;s<=h.y;s++){C=x,g=p(i,s,a),y=e.Rectangle.simpleIntersection(g,r),x=Math.max(0,(y.south-m.south)/m.height),s===h.y&&Math.abs(y.south-m.south)<c&&(x=0);const n=new e.Vector4(f,1-C,T,1-x),o=m.width,l=m.height,_=o/g.width,u=l/g.height,d=new e.Vector4(_*(m.west-g.west)/o,u*(g.north-m.north)/l,_,u),b=this.getImageryFromCache(i,s,t.sourceCache.map._tilingScheme.type===e.ProjectionType.LATLON?a+1:a);v.push(new Tt(b,n,d));}}return v}getImageryFromCache(e,t,i,s){const r=`${i}_${e}_${t}`;let n=this._imageryCache.get(r);return n||(n=new bt(e,t,i,this),this._imageryCache.set(r,n)),n.addReference(s),n}removeImageryFromCache(e){this._imageryCache.delete(`${e.level}_${e.x}_${e.y}`);}}class za{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null;}bind(e,t,i,s,r,n,o,a,l,h,_){this.context=e;let c=this.boundPaintVertexBuffers.length!==s.length;for(let e=0;!c&&e<s.length;e++)this.boundPaintVertexBuffers[e]!==s[e]&&(c=!0);const u=this._requireFreshBind({program:t,layoutVertexBuffer:i,paintVertexBuffers:s,indexBuffer:r,vertexOffset:n,dynamicVertexBuffer:o,dynamicVertexBuffer2:a,dynamicVertexBuffer3:l,animationVertexBuffers:h,instanceVerterBuffers:_});if(!e.extVertexArrayObject||u)this.freshBind(t,i,s,r,n,o,a,l,h,_);else {e.bindVertexArrayOES.set(this.vao);const i=e.gl;o&&o.bind(),r&&r.dynamicDraw&&r.bind(),a&&a.bind(),l&&l.bind(),h&&this._setAnimationBoundBuffers(h,i,t,n);}}freshBind(e,t,i,s,r,n,o,a,l,h){let _;const c=e.numAttributes,u=this.context,d=u.gl;if(u.extVertexArrayObject)this.vao&&this.destroy(),this.vao=u.extVertexArrayObject.createVertexArrayOES(),u.bindVertexArrayOES.set(this.vao),_=0,this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=s,this.boundVertexOffset=r,this.boundDynamicVertexBuffer=n,this.boundDynamicVertexBuffer2=o,this.boundDynamicVertexBuffer3=a,this.instanceVerterBuffers=h,this._initAnimationBoundBuffer(l);else {_=u.currentNumAttributes||0;for(let e=c;e<_;e++)d.disableVertexAttribArray(e);}t.enableAttributes(d,e);for(const t of i)t.enableAttributes(d,e);t.setVertexAttribPointers(d,e,r);for(const t of i)t.bind("default"),t.setVertexAttribPointers(d,e,r);s&&s.bind(),n&&(n.enableAttributes(d,e),n.bind("default"),n.setVertexAttribPointers(d,e,r)),o&&(o.enableAttributes(d,e),o.bind("default"),o.setVertexAttribPointers(d,e,r)),a&&(a.enableAttributes(d,e),a.bind("default"),a.setVertexAttribPointers(d,e,r)),l&&this._setAnimationBoundBuffers(l,d,e,r),h&&h.setVertexAttribPointers(d,e),u.currentNumAttributes=c;}_requireFreshBind(e){const{program:t,layoutVertexBuffer:i,paintBuffersDiffer:s,indexBuffer:r,vertexOffset:n,dynamicVertexBuffer:o,dynamicVertexBuffer2:a,dynamicVertexBuffer3:l,animationVertexBuffers:h}=e;let _=!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==i||s||this.boundIndexBuffer!==r||this.boundVertexOffset!==n||this.boundDynamicVertexBuffer!==o||this.boundDynamicVertexBuffer2!==a||this.boundDynamicVertexBuffer3!==l;if(h)for(const e in h)Object.hasOwnProperty.call(h,e)&&(_=this[`bound${e}`]!==h[e]);return _}_initAnimationBoundBuffer(e){if(e)for(const t in e)Object.hasOwnProperty.call(e,t)&&(this[`bound${t}`]=e[t]);}_setAnimationBoundBuffers(e,t,i,s){for(const r in e)if(Object.hasOwnProperty.call(e,r)){const n=e[r];n.enableAttributes(t,i),n.bind("default"),n.setVertexAttribPointers(t,i,s);}}_destroyAnimationVertexBuffers(){}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null);}remove(){this.destroy(),this.context=null,this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=null,this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.boundDynamicVertexBuffer2=null,this.boundDynamicVertexBuffer3=null,this.instanceVerterBuffers=null,this._destroyAnimationVertexBuffers();}}class Wa extends e.Evented{constructor(t,i,s,r){super(),this.id=t,this.type="3d-model",this.minzoom=15,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this.dispatcher=s,this.setEventedParent(r),this.textures=[],this.nodes=[],this.meshes=[],this.primitives=[],this.materials=[],this._loadedTextures={},this._data=i.data,this._options=e.extend({},i),this.location=i.location||[0,0],this.upAxis=i["up-axis"]||"Y-UP",this.modelFolder=i.modelFolder,this.scale=i.scale||[1,1,1],this.rotation=i.rotation||[0,0,0],this.translation=i.translation||[0,0,0],this._collectResourceTiming=i.collectResourceTiming,this._resourceTiming=[],void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.filter=i.filter,this._pickable=i.pickable||!1,this.log=i.log||!1,this.useMipmap=void 0===i.useMipmap||i.useMipmap,this._abortListMap=new Map,this.lightingModel=i.lightingModel||e.LightingModelType.NONE,this.filter&&this.setFilter(this.filter),i.aabbFilter&&this.setAABBFilter(i.aabbFilter);}setFilter(t){this._featureFilter=e.createFilter(t);}setAABBFilter(t){this._aabbFilter=e.createFilter(t);}highlightModel(){}load(t){this.fire(new e.Event("dataloading",{dataType:"source"})),this.state="dataloading";const i=e.extend({},this.workerOptions);i.location=this.location,i.source=this.id;const s=this._data;i.request="string"==typeof s?{url:e.exported.resolveURL(lt(s)),collectResourceTiming:this._collectResourceTiming}:{url:new e.window.Blob([JSON.stringify(s)]),collectResourceTiming:this._collectResourceTiming},cs(i.request.url,ma,{gltf:{postProcess:!0,loadImages:!0},context:this.map.painter.context,useMipmap:this.useMipmap,source:this,transformRequest:this.map._transformRequest,collectResourceTiming:this._collectResourceTiming,isDestroyed:this._removed,_abortListMap:this._abortListMap,dispatcher:this.map.style.dispatcher},0,lt(this.modelFolder)).then((e=>{if(e){if(this._removed||e&&e.abandoned)return;this._loaded=!0,this.state="parsing",this.result=e,t(null,e);}else t({msg:"loaders.gl load data fail"},null);}));}onAdd(e,t){this.map=e,this.load(t);}setLocation(){}prepare(){}loadTile(e,t){e.state="loaded";}abortTile(e){e.aborted=!0;}unloadTile(e){}onRemove(){this._removed=!0,this._abortListMap.forEach(((e,t)=>{e.abort(),this._abortListMap.delete(t);})),this.dispatcher.send("removeSource",{type:this.type,source:this.id},null,this.workerID);}serialize(){return e.extend({},this._options,{type:this.type,data:this._data,maxzoom:this.maxzoom,bounds:this.bounds,location:this.location,"up-axis":this.upAxis})}hasTransition(){return !1}isEarthSource(){return !0}}class ja extends e.Evented{constructor(t,i,s,r){super(),this.id=t,this.dispatcher=s,this.minzoom=15,this.maxzoom=22,this.reparseOverscaled=!0,this.isTileClipped=!0,this.vectorLayerIds=[],this.type="3d-tiles",this.layers=i.urls,this.log=i.log||!1,this.useMipmap=void 0!==i.useMipmap&&i.useMipmap,this.allowPick=void 0===i.allowPick||i.allowPick,e.extend(this,e.pick(i,["url","urls","scheme","modelFolder","location","filter","minzoom","maxzoom"])),this._options=e.extend({type:this.type},i),this.lightingModel=i.lightingModel||e.LightingModelType.NONE,this._collectResourceTiming=i.collectResourceTiming,this.filter&&this.setFilter(this.filter),this.setEventedParent(r);}load(){this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"}));}loadTile(e,t,i){}setFilter(t){this._featureFilter=e.createFilter(t);}prepare(){this.gltfModelVAO||(this.gltfModelVAO=new za);}hasTile(e){return !0}onAdd(e){this.map=e,this.load();}onRemove(e){}serialize(){return e.extend({},this._options)}abortTile(e){this.dispatcher.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0,e.workerID);}unloadTile(e){e.unloadVectorData(),this.dispatcher.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0,e.workerID),this.dispatcher.send("removeTile",{uid:e.uid,type:this.type,source:this.id},void 0,e.workerID);}hasTransition(){return !1}isEarthSource(){return !0}setViewFrustum(e){this._eventedParent._setViewFrustum(e);}}var Xa=e.createLayout([{name:"a_POSITION",type:"Float32",components:3},{name:"a_texture_pos",type:"Float32",components:2},{name:"a_NORMAL",type:"Float32",components:3}]),qa=e.createLayout([{name:"a_GEODETIC_NORMAL",type:"Float32",components:3},{name:"a_ELEVATION",type:"Float32",components:1}]);class Ka{constructor(e){this.data=e.data,this.geometry=e.geometry,this.matrix=e.matrix;}destroy(){return this.geometry.destroy(),e.destroyObject(this)}}class Ja{constructor(e){this.data=e.data,this.geometry=e.geometry,this.matrix=e.matrix;}destroy(){return this.geometry.destroy(),e.destroyObject(this)}}class Za{constructor(e){this._tilingScheme=e,this._rootNodes=[],this._json=void 0,this.state=void 0;}addJSON(t){if(this._json=t,!this._json)throw this.state="error",new Error("地形索引文件内容为空，请检查");if(this._available=this._json.available,this._minimumLevel=this._json.minzoom,this._maximumLevel=this._json.maxzoom,!this._available)throw this.state="error",new Error("地形索引文件'available'字段不存在");if(!this._minimumLevel&&0!==this._minimumLevel)throw this.state="error",new Error("地形索引文件'minzoom'字段不存在");if(!this._maximumLevel)throw this.state="error",new Error("地形索引文件'maxzoom'字段不存在");if(this._available.length!==this._maximumLevel-this._minimumLevel+1)throw this.state="error",new Error("地形索引文件'available'数组长度与'maxzoom'和'minzoom'的差值不匹配");if(this._tilingScheme.type===e.ProjectionType.LATLON){if(0!==this._minimumLevel&&1!==this._minimumLevel)throw this.state="error",new Error("经纬度地形下，地形索引文件'minzoom'必须为0或1");this._minimumLevel=Math.max(1,this._minimumLevel);}else if(0!==this._minimumLevel)throw this.state="error",new Error("墨卡托地形下，地形索引文件'minzoom'必须为0");for(let e=this._minimumLevel;e<=this._maximumLevel;++e){const t=this._available[e];for(let i=0;i<t.length;++i){const s=t[i];this.addAvailableTileRange(e,s.startX,s.startY,s.endX,s.endY);}}}addAvailableTileRange(t,i,s,r,n){const o=this._tilingScheme,a=this._rootNodes;if(t===this._minimumLevel)for(let e=s;e<=n;++e)for(let s=i;s<=r;++s)Ya(t,s,e,a)||a.push(new sl(o,void 0,this._minimumLevel,s,e));let l=o.tileXYToRectangle(i,s,this._tilingScheme.type===e.ProjectionType.LATLON?t-1:t);const h=l.west,_=l.north;l=o.tileXYToRectangle(r,n,this._tilingScheme.type===e.ProjectionType.LATLON?t-1:t);const c={level:t,west:h,south:l.south,east:l.east,north:_};for(let e=0;e<a.length;++e){const t=a[e];Qa(t.extent,c)&&$a(this._maximumLevel,t,c);}}isTileAvailable(t){const i=this._tilingScheme.tileXYToRectangle(t.canonical.x,t.canonical.y,this._tilingScheme.type===e.ProjectionType.LATLON?t.canonical.z-1:t.canonical.z),s=e.Rectangle.center(i);return this.computeMaximumLevelAtPosition(s)>=t.canonical.z}computeMaximumLevelAtTile(t){const i=this._tilingScheme.tileXYToRectangle(t.canonical.x,t.canonical.y,this._tilingScheme.type===e.ProjectionType.LATLON?t.canonical.z-1:t.canonical.z),s=e.Rectangle.center(i);return this.computeMaximumLevelAtPosition(s)}computeMaximumLevelAtPosition(t){let i;for(let e=0;e<this._rootNodes.length;++e){const s=this._rootNodes[e];if(il(s.extent,t)){i=s;break}}return e.defined(i)?el(void 0,i,t):-1}}function Ya(e,t,i,s){const r=s.length;for(let n=0;n<r;++n){const r=s[n];if(r.x===t&&r.y===i&&r.level===e)return !0}return !1}function Qa(e,t){const i=Math.max(e.west,t.west),s=Math.max(e.south,t.south),r=Math.min(e.east,t.east);return s<Math.min(e.north,t.north)&&i<r}function $a(t,i,s){for(;i.level<t;)if(tl(i.nw.extent,s))i=i.nw;else if(tl(i.ne.extent,s))i=i.ne;else if(tl(i.sw.extent,s))i=i.sw;else {if(!tl(i.se.extent,s))break;i=i.se;}if(0===i.rectangles.length||i.rectangles[i.rectangles.length-1].level<=s.level)i.rectangles.push(s);else {let t=e.binarySearch(i.rectangles,s.level,((e,t)=>e.level-t));t<0&&(t=~t),i.rectangles.splice(t,0,s);}}function el(e,t,i){let s=0,r=!1;for(;!r;){const e=t._nw&&il(t._nw.extent,i),n=t._ne&&il(t._ne.extent,i),o=t._sw&&il(t._sw.extent,i),a=t._se&&il(t._se.extent,i);if(e+n+o+a>1){e&&(s=Math.max(s,el(t,t._nw,i))),n&&(s=Math.max(s,el(t,t._ne,i))),o&&(s=Math.max(s,el(t,t._sw,i))),a&&(s=Math.max(s,el(t,t._se,i)));break}e?t=t._nw:n?t=t._ne:o?t=t._sw:a?t=t._se:r=!0;}for(;t!==e;){const e=t.rectangles;for(let t=e.length-1;t>=0&&e[t].level>s;--t){const r=e[t];il(r,i)&&(s=r.level);}t=t.parent;}return s}function tl(e,t){return t.west>=e.west&&t.east<=e.east&&t.south>=e.south&&t.north<=e.north}function il(e,t){return t.longitude>=e.west&&t.longitude<=e.east&&t.latitude>=e.south&&t.latitude<=e.north}class sl{constructor(t,i,s,r,n){this.tilingScheme=t,this.parent=i,this.level=s,this.x=r,this.y=n,this.extent=t.tileXYToRectangle(r,n,this.tilingScheme.type===e.ProjectionType.LATLON?s-1:s),this.rectangles=[],this._sw=void 0,this._se=void 0,this._nw=void 0,this._ne=void 0;}get sw(){return this._sw||(this._sw=new sl(this.tilingScheme,this,this.level+1,2*this.x,2*this.y+1)),this._sw}get se(){return this._se||(this._se=new sl(this.tilingScheme,this,this.level+1,2*this.x+1,2*this.y+1)),this._se}get nw(){return this._nw||(this._nw=new sl(this.tilingScheme,this,this.level+1,2*this.x,2*this.y)),this._nw}get ne(){return this._ne||(this._ne=new sl(this.tilingScheme,this,this.level+1,2*this.x+1,2*this.y)),this._ne}}const rl=new e.TerrainTileParser;class nl extends e.Evented{constructor(t,i,s,r){super(),this.id=t,this.dispatcher=s,this.maxzoom=i.maxzoom||14,this.tileSize=i.tileSize||512,this._tiles=i.tiles,this.type=i.type,this.format=i.format,this.map=i.map,this.setEventedParent(r),this._levelZeroMaximumGeometricError=77067.33978,delete i.map,this._options=e.extend({},i),e.extend(this,e.pick(i,["scheme","tileSize","capabilities","service"])),this.minzoom=0,this.roundZoom=!1,this.scheme="xyz",this._terrainTiles=new Map,this._tempTerrainTiles=new Map,this._requestingSet=new Set,this._tempRequestingSet=new Set,this.workerIDMap=new Map,this.availability=new Za(this.map._tilingScheme),i.availabilities&&i.availabilities.length>0&&this.loadAvailability(i.availabilities[0]),this.load();}load(){this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ft(this._options,this.map._transformRequest,((t,i)=>{this._tileJSONRequest=null,t?this.fire(new e.ErrorEvent(t)):i&&(e.extend(this,i),i.bounds&&(this.tileBounds=new Fa(i.bounds,this.minzoom,this.maxzoom)),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})));}));}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null);}serialize(){return e.extend({},this._options)}hasTile(e){return !this.tileBounds||this.tileBounds.contains(e)}getTile(e){return this._terrainTiles.get(e.key)||this._tempTerrainTiles.get(e.key)}loadTile(t,i){if("loading"===this.availability.state)return;if(this._terrainTiles.has(t.key))return i(null,this._terrainTiles.get(t.key));if(this._tempTerrainTiles.has(t.key)){const e=this._tempTerrainTiles.get(t.key);return this._terrainTiles.set(t.key,e),this._tempTerrainTiles.delete(t.key),i(null,e)}if(this._requestingSet.has(t.key))return;if("loaded"===this.availability.state){if(!this.availability.isTileAvailable(t))return this.processOverZoomData(t,i)}else if(t.canonical.z>this.maxzoom)return this.processOverZoomData(t,i);const s=t.canonical.toRealCoord(this.scheme),r=t.canonical.url(this._tiles,this.scheme),n=ut(r,0,0,s),o={request:this.map._transformRequest(n,e.ResourceType.Tile),uid:t.key,tileID:t,type:this.type,source:this.id,skirtHeight:this.map.terrainSkirtHeight<0?5*this.getLevelMaximumGeometricError(t.canonical.z):this.map.terrainSkirtHeight},a=this.dispatcher.send("loadTile",o,function(e,s){if(this._tempRequestingSet.has(t.key)&&this._tempRequestingSet.delete(t.key),this._requestingSet.has(t.key)){if(this._requestingSet.delete(t.key),e||!s){const e=this.createReplacedMesh(this.map.projection,this.map.painter.context,this.map.style.rasterSourceCache.quadtree,t);return e.state="replaced",this._terrainTiles.set(t.key,e),i(null,e)}const r=this.parseTerrainData(s,this.map.painter.context,this.map.style.rasterSourceCache.quadtree,t);this._terrainTiles.set(t.key,r),i(null,r);}}.bind(this));this.workerIDMap.set(t.key,a),this._requestingSet.add(t.key);}abortTile(e,t){const i=this.workerIDMap.get(e.key);this.dispatcher.send("abortTile",{uid:e.key,type:this.type,source:this.id},void 0,i),this.workerIDMap.delete(e.key,i),t&&t();}unloadTile(e,t){if(this._requestingSet.has(e.key))return this._tempRequestingSet.has(e.key)||this.abortTile(e),void this._requestingSet.delete(e.key);const i=this.workerIDMap.get(e.key);this.dispatcher.send("removeTile",{uid:e.key,type:this.type,source:this.id},void 0,i),this.workerIDMap.delete(e.key,i);const s=this._terrainTiles.get(e.key);if(s&&(this._terrainTiles.delete(e.key),this._tempTerrainTiles.set(e.key,s)),this._tempTerrainTiles.size>200){let e=0;const t=parseInt(this._tempTerrainTiles.size/2);this._tempTerrainTiles.forEach(((i,s)=>{e<t&&(this._tempTerrainTiles.get(s).destroy(),this._tempTerrainTiles.delete(s)),e++;}));}t&&t();}hasTransition(){return !1}parseTerrainData(t,i,s,r){if("quantized"===this.format){const n=new e.SegmentVector,o=t.sphereMaskedBoundsArray,a=t.sphereIndexArray,l=t.terrainAnalysisArray,h=t.wireframeIndexArray,_=n.prepareSegment(0,[],[]);_.vertexLength+=t.sphereMaskedBoundsArray.length,_.primitiveLength+=t.sphereIndexArray.length,n.prepareSegment(0,o,a);const c=s.getQuadtreeTileByTileKey(r.key);c.terrainBounds.minimumHeight!=t.minimumHeight&&(c.terrainBounds.minimumHeight=t.minimumHeight),c.terrainBounds.maximumHeight!=t.maximumHeight&&(c.terrainBounds.maximumHeight=t.maximumHeight),c.tileBoundingRegion.isAmbiguousHeight=!1;const u=new e.Geometry({primitiveType:e.WebGLConstants.TRIANGLES,vertBuffer:i.createVertexBuffer(o,Xa.members),indexBuffer:i.createIndexBuffer(a),wireframeIndexBuffer:i.createIndexBuffer(h),dynamicLayoutBuffer1:i.createVertexBuffer(l,qa.members),segmentVector:n,tileBoundingRegion:s.getBoundingRegionById(r.key),tileId:r}),d=new e.Matrix4;return d[12]=t.rP[0],d[13]=t.rP[1],d[14]=t.rP[2],new Ka({data:t,geometry:u,matrix:d})}if("heightmap"===this.format)return new Ja}processOverZoomData(e,t){const i=e.canonical.z-1;let s,r=this.maxzoom;if(!("loaded"===this.availability.state&&(r=this.availability.computeMaximumLevelAtTile(e),r<0))){for(let n=i;n>=r;n--)if(s=e.scaledTo(n),this.getTile(s)){const i=this.getTile(s);if("replaced"!==i.state){const r=this.processUpsample(i.data,e,s);return t(null,r)}const r=this.createReplacedMesh(this.map.projection,this.map.painter.context,this.map.style.rasterSourceCache.quadtree,e);return r.state="replaced",this._terrainTiles.set(e.key,r),t(null,r)}if(!this._tempRequestingSet.has(s.key))return this.requestTempData(s,((i,r)=>{if(i||!r){const i=this.createReplacedMesh(this.map.projection,this.map.painter.context,this.map.style.rasterSourceCache.quadtree,e);return i.state="replaced",this._terrainTiles.set(e.key,i),t(null,i)}if("replaced"!==r.state){const i=this.processUpsample(r.data,e,s);return t(null,i)}const n=this.createReplacedMesh(this.map.projection,this.map.painter.context,this.map.style.rasterSourceCache.quadtree,e);return n.state="replaced",this._terrainTiles.set(e.key,n),t(null,n)}))}}requestTempData(t,i){const s=t.canonical.url(this._tiles,this.scheme),r=ut(s),n={request:this.map._transformRequest(r,e.ResourceType.Tile),uid:t.key,tileID:t,type:this.type,source:this.id,skirtHeight:this.map.terrainSkirtHeight<0?5*this.getLevelMaximumGeometricError(t.canonical.z):this.map.terrainSkirtHeight},o=this.dispatcher.send("loadTile",n,function(e,s){if(this._tempRequestingSet.delete(t.key),e||!s){const e=this.createReplacedMesh(this.map.projection,this.map.painter.context,this.map.style.rasterSourceCache.quadtree,t);return e.state="replaced",this._tempTerrainTiles.set(t.key,e),i(null,e)}const r=this.parseTerrainData(s,this.map.painter.context,this.map.style.rasterSourceCache.quadtree,t);this._tempTerrainTiles.set(t.key,r),i(null,r);}.bind(this));this.workerIDMap.set(t.key,o),this._tempRequestingSet.add(t.key);}createReplacedMesh(t,i,s,r){const n=e.tileSamplesGrid(r,t),o=new e.Geometry({primitiveType:e.WebGLConstants.TRIANGLES,vertBuffer:i.createVertexBuffer(n.sphereMaskedBoundsArray,Xa.members),indexBuffer:i.createIndexBuffer(n.sphereIndexArray),wireframeIndexBuffer:i.createIndexBuffer(n.wireframeIndexArray),segmentVector:n.sphereSegments,tileBoundingRegion:s.getBoundingRegionById(r.key),tileId:r}),a=new e.Matrix4;return a.translate(n.rtc),"quantized"===this.format?new Ka({data:n,geometry:o,matrix:a}):"heightmap"===this.format?new Ja:void 0}processUpsample(e,t,i){let s,r=i.canonical.z,n=e;for(;;){const e=t.scaledTo(r+1),i=Object.assign({},n,{x:e.canonical.x,y:e.canonical.y,z:e.canonical.z,isEastChild:e.canonical.x%2>0,isNorthChild:e.canonical.y%2==0,projectionType:this.map.projection,skirtHeight:this.map.terrainSkirtHeight<0?5*this.getLevelMaximumGeometricError(e.canonical.z):this.map.terrainSkirtHeight}),o=rl.createChildTerrain(i),a=this.map.style.rasterSourceCache.quadtree.getQuadtreeTileByTileKey(e.key);if(a.terrainBounds.minimumHeight!=o.minimumHeight&&(a.terrainBounds.minimumHeight=o.minimumHeight),a.terrainBounds.maximumHeight!=o.maximumHeight&&(a.terrainBounds.maximumHeight=o.maximumHeight),a.tileBoundingRegion.isAmbiguousHeight=!1,s=this.parseTerrainData(o,this.map.painter.context,this.map.style.rasterSourceCache.quadtree,e),s.state="upsampled",r++,r===t.canonical.z){this._terrainTiles.set(e.key,s);break}this._tempTerrainTiles.set(e.key,s),n=o;}return s}isLoaded(){return this._terrainTiles.size>0&&0===this._requestingSet.size&&0===this._tempRequestingSet.size}isTerrain(){return !0}loadAvailability(t){this.availability.state="loading",e.getJSON({url:t},((t,i)=>{t?(this.availability.state="error",this.fire(new e.ErrorEvent(t))):i&&(this.availability.addJSON(i),this.availability.state="loaded");}));}getAvailable(e){return this.availability.getAvailable(e)}getLevelMaximumGeometricError(e){return this._levelZeroMaximumGeometricError/(1<<e)}}function ol(t,i,s,r){let n=22;const o=Math.pow(2,n),a=Math.floor(e.ProjectionProxy.latY(t[1],o,r)),l=Math.floor(e.ProjectionProxy.lngX(t[0],o,r));if(l>o||l<0||a>o||a<0||isNaN(l)||isNaN(a))return {intersectionZ:1/0,intersectionPoint:void 0,isUnderground:!1};const h=new e.OverscaledTileID(n,0,n,l,a,r);let _=null;const c=e.Vector3.fromDegrees(t[0],t[1],0);for(c.subtract(i);n>0;){const t=h.scaledTo(n).key;let r=s._tempTerrainTiles.get(t);if(r||(r=s._terrainTiles.get(t)),r&&r.data){_=r;let t=al(_,new e.Ray(i,e.Vector3.normalize(c,new e.Vector3)));if(t.intersectionPoint)return t;if(t=al(_,new e.Ray(i,e.Vector3.normalize(c,new e.Vector3).multiplyScalar(-1))),t.intersectionPoint)return t}n--;}return {intersectionZ:1/0,intersectionPoint:null,isUnderground:!1}}function al(t,i){let s,r=1/0;const n=new e.Vector3;if(t&&t.data){const o=t.data,a=o.sphereMaskedBoundsArray.float32,l=o.sphereIndexArray.uint16,h=o.rP;for(let t=0;t<o.skirtIndex;t+=3){const o=8*l[t],_=8*l[t+1],c=8*l[t+2],u=i.intersectTriangle([a[o]+h[0],a[o+1]+h[1],a[o+2]+h[2]],[a[_]+h[0],a[_+1]+h[1],a[_+2]+h[2]],[a[c]+h[0],a[c+1]+h[1],a[c+2]+h[2]],!1,n);if(u){const t=new e.Vector3(i.origin).distance(u);if(t<r){s=new e.Vector3(u),r=t;const n=e.Transforms.cartesian3ToCartographic(i.origin)[2]<e.Transforms.cartesian3ToCartographic(u)[2];return n&&(r=e.Transforms.cartesian3ToCartographic(u)[2]),{intersectionZ:r,intersectionPoint:s,isUnderground:n}}}}}return {intersectionZ:r,intersectionPoint:s,isUnderground:!1}}function ll(t,i,s){t=e.LngLat.convert(t);let r=22;const n=Math.pow(2,r),o=Math.floor(e.ProjectionProxy.latY(t.lat,n,s)),a=Math.floor(e.ProjectionProxy.lngX(t.lng,n,s));if(a>n||a<0||o>n||o<0||isNaN(a)||isNaN(o))return;const l=new e.OverscaledTileID(r,0,r,a,o,s);for(;r>0;){const e=l.scaledTo(r).key;let n=i._tempTerrainTiles.get(e);if(n||(n=i._terrainTiles.get(e)),n&&n.data)return hl(n,t,s);r--;}}function hl(t,i,s){if(!t||!t.data)return;const r=t.data,n=e.getProjection(s),o=r.x,a=r.y,l=Math.pow(2,r.z),h=n.tileNumberToLngLat([o,a],1,l),_=n.tileNumberToLngLat([o+1,a+1],1,l),c=32767;let u=((i=e.LngLat.convert(i)).lng-h.lng)/(_.lng-h.lng);u*=c;let d=(i.lat-_.lat)/(h.lat-_.lat);d*=c;const m=r.indices,p=r.uBuffer,f=r.vBuffer,g=r.hBuffer;for(let t=0;t<r.skirtIndex;t+=3){const i=m[t],s=m[t+1],n=m[t+2],o=p[i],a=p[s],l=p[n],h=f[i],_=f[s],y=f[n];if(_l(u,d,o,h,a,_,l,y)){const t=e.Intersections2D.computeBarycentricCoordinates(u,d,o,h,a,_,l,y);if(t.x>=-1e-15&&t.y>=-1e-15&&t.z>=-1e-15)return e.lerp(r.minimumHeight,r.maximumHeight,(t.x*g[i]+t.y*g[s]+t.z*g[n])/c)}}}function _l(e,t,i,s,r,n,o,a){const l=Math.min(i,r,o),h=Math.max(i,r,o),_=Math.min(s,n,a),c=Math.max(s,n,a);return e>=l&&e<=h&&t>=_&&t<=c}class cl{constructor(e){this.data=e.data,this.geometry=e.geometry,this.matrix=e.matrix;}destroy(){return this.geometry.destroy(),e.destroyObject(this)}}class ul extends e.Evented{constructor(t,i,s,r){super(),this.id=t,this.dispatcher=s,this.map=i.map,this.setEventedParent(r),this.type="terrain",this.minzoom=0,this.maxzoom=14,this.scheme="xyz",this.tileSize=512,this._levelZeroMaximumGeometricError=78271.516964,delete i.map,this._options=e.extend({},i),e.extend(this,e.pick(i,["tileSize","minzoom","maxzoom"])),this._terrainTiles=new Map,this.workerIDMap=new Map,this.load();}load(){this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ft(this._options,this.map._transformRequest,((t,i)=>{this._tileJSONRequest=null,t?this.fire(new e.ErrorEvent(t)):i&&(e.extend(this,i),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})));}));}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null);}serialize(){}loadTile(t,i){if(this._terrainTiles.has(t.key))return i(null,this._terrainTiles.get(t.key));let s,r;try{s=e.tileSamplesGrid(t,this.map.projection);}catch(e){r=e;}((e,s)=>{if(e||!s)return i(e);if(!this.map.style.rasterSourceCache.quadtree)return i(new Error);const r=this.parseTerrainData(s,this.map.painter.context,this.map.style.rasterSourceCache.quadtree,t);this._terrainTiles.set(t.key,r),i(null,r);})(r,s);}getTile(e){return this._terrainTiles.get(e.key)}abortTile(e,t){const i=this.workerIDMap.get(e.key);this.dispatcher.send("abortTile",{uid:e.key,type:this.type,source:this.id},void 0,i),t();}unloadTile(e,t){const i=this.workerIDMap.get(e.key);this.dispatcher.send("removeTile",{uid:e.key,type:this.type,source:this.id},void 0,i),this._terrainTiles.delete(e.key),t&&t();}parseTerrainData(t,i,s,r){const n=new e.Geometry({primitiveType:e.WebGLConstants.TRIANGLES,vertBuffer:i.createVertexBuffer(t.sphereMaskedBoundsArray,Xa.members),indexBuffer:i.createIndexBuffer(t.sphereIndexArray),wireframeIndexBuffer:i.createIndexBuffer(t.wireframeIndexArray),segmentVector:t.sphereSegments,tileBoundingRegion:s.getBoundingRegionById(r.key),tileId:r}),o=new e.Matrix4;return o.translate(t.rtc),new cl({data:t,geometry:n,matrix:o})}hasTransition(){return !1}isTerrain(){return !1}getLevelMaximumGeometricError(e){return this._levelZeroMaximumGeometricError/(1<<e)}}const dl={vector:class extends e.Evented{constructor(t,i,s,r){if(super(),this.id=t,this.dispatcher=s,this.type="vector",this.minzoom=i.minzoom||0,this.maxzoom=i.maxzoom||22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,e.extend(this,e.pick(i,["url","scheme","tileSize"])),this._options=e.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,this.promoteId=i.promoteId,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this._adcode=i.adcode,this.clippingPlanes=i.clippingPlanes,this._imageryCache=new Map,this.setEventedParent(r);}set adcode(e){this._adcode!==e&&(this._adcode=e,this._eventedParent&&this._eventedParent.reload&&this._eventedParent.reload(!0));}get adcode(){return this._adcode}load(){this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ft(this._options,this.map._transformRequest,((t,i)=>{this._tileJSONRequest=null,t?this.fire(new e.ErrorEvent(t)):i&&(e.extend(this,i),i.bounds&&(this.tileBounds=new Fa(i.bounds,this.minzoom,this.maxzoom)),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})));}));}hasTile(e){return !this.tileBounds||this.tileBounds.contains(e)}onAdd(e){this.map=e,this.load();}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null);}serialize(){return e.extend({},this._options)}loadTile(t,i){const s=t.tileID.canonical.toRealCoord(this.scheme);let r=ut(t.tileID.canonical.url(this.tiles,this.scheme),0,0,s);this._adcode&&(r=`${r}&admincode=${this._adcode}`);const n={request:this.map._transformRequest(r,e.ResourceType.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:e.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,maxZoom:this.maxzoom};function o(e,s){return t.aborted?i(null):e?i(e):(s&&s.resourceTiming&&(t.resourceTiming=s.resourceTiming),this.map._refreshExpiredTiles&&t.setExpiryData(s),t.loadVectorData(s,this.map.painter),i(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}n.request.collectResourceTiming=this._collectResourceTiming,void 0===t.workerID||"expired"===t.state?t.workerID=this.dispatcher.send("loadTile",n,o.bind(this)):"loading"===t.state?t.reloadCallback=i:this.dispatcher.send("reloadTile",n,o.bind(this),t.workerID);}abortTile(e){this.dispatcher.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0,e.workerID);}unloadTile(e){e.unloadVectorData(),this.dispatcher.send("removeTile",{uid:e.uid,type:this.type,source:this.id},void 0,e.workerID);}hasTransition(){return !1}isEarthSource(){return !0}getImageryFromCache(e,t,i,s){const r=`${i}_${e}_${t}`;let n=this._imageryCache.get(r);return n||(n=new bt(e,t,i,this),this._imageryCache.set(r,n)),n.addReference(s),n}createTileImagerySkeletons(t,i){const s=t.sourceCache.map._tilingScheme.tileXYToRectangle(t.tileID.canonical.x,t.tileID.canonical.y,t.tileID.canonical.z);this.projection||(this.projection=t.sourceCache.map.projection,this._tilingScheme=t.sourceCache.map._tilingScheme);const r=this._tilingScheme,n=e.Rectangle.intersection(r.rectangle,e.Rectangle.MAX_VALUE);if(!n)return [];const o=e.Rectangle.intersection(s,n);if(!o)return [];const a=i?.canonical.z,l=r.positionToTileXY(e.Rectangle.northwest(o),a),h=r.positionToTileXY(e.Rectangle.southeast(o),a);let _=s.width/512,c=s.height/512;const u=r.tileXYToRectangle(l.x,l.y,a);Math.abs(u.south-s.north)<c&&l.y<h.y&&++l.y,Math.abs(u.east-s.west)<_&&l.x<h.x&&++l.x;const d=r.tileXYToRectangle(h.x,h.y,a);Math.abs(d.north-s.south)<c&&h.y>l.y&&--h.y,Math.abs(d.west-s.east)<_&&h.x>l.x&&--h.x;const m=e.Rectangle.clone(s);let p,f,g=r.tileXYToRectangle(l.x,l.y,a),y=e.Rectangle.intersection(g,n);this.projection===e.ProjectionType.MERCATOR?(r.rectangleToNativeRectangle(m,m),r.rectangleToNativeRectangle(g,g),r.rectangleToNativeRectangle(y,y),r.rectangleToNativeRectangle(n,n),p=r.tileXYToNativeRectangle.bind(r),_=m.width/512,c=m.height/512):p=r.tileXYToRectangle.bind(r);let C,T=0,x=1;Math.abs(y.west-m.west)>=_&&(T=Math.min(1,(y.west-m.west)/m.width)),Math.abs(y.north-m.north)>=c&&(x=Math.max(0,(y.north-m.south)/m.height));const b=x,v=[];for(let t=i.canonical.x;t<=i.canonical.x;t++){f=T,g=p(t,l.y,a),y=e.Rectangle.simpleIntersection(g,n),T=Math.min(1,(y.east-m.west)/m.width),t===h.x&&Math.abs(y.east-m.east)<_&&(T=1),x=b;for(let s=i.canonical.y;s<=i.canonical.y;s++){C=x,g=p(t,s,a),y=e.Rectangle.simpleIntersection(g,n),x=Math.max(0,(y.south-m.south)/m.height),s===h.y&&Math.abs(y.south-m.south)<c&&(x=0);const i=new e.Vector4(f,1-C,T,1-x),r=m.width,o=m.height,l=r/g.width,_=o/g.height,u=new e.Vector4(l*(m.west-g.west)/r,_*(g.north-m.north)/o,l,_),d=this.getImageryFromCache(t,s,a);v.push(new Tt(d,i,u));}}return v}},raster:class extends e.Evented{constructor(t,i,s,r){if(super(),this.id=t,this.dispatcher=s,this.setEventedParent(r),this.minzoom=i.minzoom||0,this.maxzoom=i.maxzoom||15,i.bounds){const t=i.bounds.map((t=>e.toRadians(t)));this.rectangle=new e.Rectangle(...t);}else this.rectangle=e.Rectangle.MAX_VALUE;if(this.type="raster",this.scheme="xyz",this.tileSize=i.tileSize||512,this._options=e.extend({},i),e.extend(this,e.pick(i,["url","scheme","tileSize","tiles","serviceIndexUrl","capabilities","service","projection"])),this.service&&(this.scheme=this.service.toLowerCase()),"baidu"===this.scheme){const t=new e.Vector2(-33554054,-33746824),i=new e.Vector2(33554054,33746824);this._tilingScheme=new yt({rectangleSouthwestInMeters:t,rectangleNortheastInMeters:i}),this.projection=e.ProjectionType.MERCATOR;}else this.projection===e.ProjectionType.LATLON?this._tilingScheme=new Ct:this.projection===e.ProjectionType.MERCATOR&&(this._tilingScheme=new yt);this._imageryCache=new Map,this._requestingSet=new Set,this.workerIDMap=new Map;}load(){this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ft(this._options,this.map._transformRequest,((t,i)=>{this._tileJSONRequest=null,t?this.fire(new e.ErrorEvent(t)):i&&(e.extend(this,i),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})));}));}onAdd(e){this.map=e,this.load();}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null);}serialize(){return e.extend({},this._options)}loadTile(t,i){if("loaded"===t.imagery.state)return;if(this._requestingSet.has(t.imagery.tileID.key))return;let s;s="wmts"===this.scheme?t.imagery.tileID.canonical.wmtsUrl(this.tiles,this._options.capabilities):"tms"===this.scheme?t.imagery.tileID.canonical.tmsUrl(this.tiles):"baidu"===this.scheme?t.imagery.tileID.canonical.baiduUrl(this.tiles):t.imagery.tileID.canonical.url(this.tiles,this.projection);const r=ut(s),n={request:this.map._transformRequest(r,e.ResourceType.Tile),uid:`${t.imagery.tileID.key}`,type:this.type,source:this.id};if(n.request.headers?n.request.headers.Accept="image/webp,*/*":n.request.headers={Accept:"image/webp,*/*"},"unloaded"===t.imagery.state||"errored"===t.imagery.state){const s=this.dispatcher.send("loadTile",n,function(t,s){if(a._requestingSet.has(this.imagery.tileID.key)){if(!s||t)return this.imagery.texture=new e.Texture({context:o,image:{width:1,height:1,data:new Uint8Array([0,0,0,0])},pixelFormat:e.WebGLConstants.RGBA,useMipmap:!1}),this.imagery.state="loaded",a._requestingSet.delete(this.imagery.tileID.key),i();this.loadImage({data:s,painter:a.map.painter,justReloaded:!1,callback:()=>{i(),a._requestingSet.delete(this.imagery.tileID.key);},url:r}),s=null;}}.bind(t));this.workerIDMap.set(t.imagery.tileID.key,s),t.imagery.state="loading";}this._requestingSet.add(t.imagery.tileID.key);const o=this.map.painter.context,a=this;}abortTile(e,t){const i=this.workerIDMap.get(e.key);this.dispatcher.send("abortTile",{uid:e.key,type:this.type,source:this.id},void 0,i),this.workerIDMap.delete(e.key,i),t&&t();}unloadTile(e){if(0===e.freeResources(e.imagery.tileID.key)){if(this._requestingSet.has(e.imagery.tileID.key))return this.abortTile(e.imagery.tileID),void this._requestingSet.delete(e.imagery.tileID.key);const t=this.workerIDMap.get(e.imagery.tileID.key);this.dispatcher.send("removeTile",{uid:e.imagery.tileID.key,type:this.type,source:this.id},void 0,t),this.workerIDMap.delete(e.imagery.tileID.key,t);}}hasTransition(){return !1}createTileImagerySkeletons(t){const i=t.sourceCache.map._tilingScheme.tileXYToRectangle(t.tileID.canonical.x,t.tileID.canonical.y,t.sourceCache.map._tilingScheme.type===e.ProjectionType.LATLON?t.tileID.canonical.z-1:t.tileID.canonical.z);this.projection||(this.projection=t.sourceCache.map.projection,this._tilingScheme=t.sourceCache.map._tilingScheme);const s=this._tilingScheme,r=e.Rectangle.intersection(s.rectangle,this.rectangle);if(!r)return [];const n=e.Rectangle.intersection(i,r);if(!n)return [];let o=0;n.south>0?o=n.south:n.north<0&&(o=n.north);let a=function(t,i,s){const r=t._tilingScheme,n=r.ellipsoid,o=r.projection instanceof e.GeographicProjection?1:Math.cos(s),a=n.maximumRadius*r.rectangle.width*o/(t.tileSize*r.getNumberOfXTilesAtLevel(0)),l=Math.log(a/i)/Math.log(2);return 0|Math.round(l)}(this,1*t.sourceCache.terrainSource.getLevelMaximumGeometricError(t.tileID.canonical.z),o);a=Math.min(a,this.maxzoom),a=s.type===e.ProjectionType.LATLON?Math.max(1,a)-1:Math.max(0,a);const l=s.positionToTileXY(e.Rectangle.northwest(n),a),h=s.positionToTileXY(e.Rectangle.southeast(n),a);let _=i.width/512,c=i.height/512;const u=s.tileXYToRectangle(l.x,l.y,a);Math.abs(u.south-i.north)<c&&l.y<h.y&&++l.y,Math.abs(u.east-i.west)<_&&l.x<h.x&&++l.x;const d=s.tileXYToRectangle(h.x,h.y,a);Math.abs(d.north-i.south)<c&&h.y>l.y&&--h.y,Math.abs(d.west-i.east)<_&&h.x>l.x&&--h.x;const m=e.Rectangle.clone(i);let p,f,g=s.tileXYToRectangle(l.x,l.y,a),y=e.Rectangle.intersection(g,r);this.projection===e.ProjectionType.MERCATOR?(s.rectangleToNativeRectangle(m,m),s.rectangleToNativeRectangle(g,g),s.rectangleToNativeRectangle(y,y),s.rectangleToNativeRectangle(r,r),p=s.tileXYToNativeRectangle.bind(s),_=m.width/512,c=m.height/512):p=s.tileXYToRectangle.bind(s);let C,T=0,x=1;Math.abs(y.west-m.west)>=_&&(T=Math.min(1,(y.west-m.west)/m.width)),Math.abs(y.north-m.north)>=c&&(x=Math.max(0,(y.north-m.south)/m.height));const b=x,v=[];for(let i=l.x;i<=h.x;i++){f=T,g=p(i,l.y,a),y=e.Rectangle.simpleIntersection(g,r),T=Math.min(1,(y.east-m.west)/m.width),i===h.x&&Math.abs(y.east-m.east)<_&&(T=1),x=b;for(let s=l.y;s<=h.y;s++){C=x,g=p(i,s,a),y=e.Rectangle.simpleIntersection(g,r),x=Math.max(0,(y.south-m.south)/m.height),s===h.y&&Math.abs(y.south-m.south)<c&&(x=0);const n=new e.Vector4(f,1-C,T,1-x),o=m.width,l=m.height,_=o/g.width,u=l/g.height,d=new e.Vector4(_*(m.west-g.west)/o,u*(g.north-m.north)/l,_,u),b=this.getImageryFromCache(i,s,t.sourceCache.map._tilingScheme.type===e.ProjectionType.LATLON?a+1:a);v.push(new Tt(b,n,d));}}return v}getImageryFromCache(e,t,i){const s=`${i}_${e}_${t}`;let r=this._imageryCache.get(s);return r||(r=new bt(e,t,i,this),this._imageryCache.set(s,r)),r.addReference(),r}removeImageryFromCache(e){this._imageryCache.delete(`${e.level}_${e.x}_${e.y}`);}},geojson:vt,video:class extends Ha{constructor(e,t,i,s){super(e,t,i,s),this.roundZoom=!0,this.type="video",this.options=t;}load(){const t=this.options;this.urls=[];for(const i of t.urls)this.urls.push(this.map._transformRequest(i,e.ResourceType.Source).url);e.getVideo(this.urls,((t,i)=>{t?this.fire(new e.ErrorEvent(t)):i&&(this.video=i,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.needRepaint=!0;})),this.map&&this.video.play(),this._finishLoading());}));}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)));}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,i=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Ga.members),this.indexBuffer=t.createIndexBuffer(this._indexArray)),this.sphereBoundsBuffer||(this.sphereBoundsBuffer=t.createVertexBuffer(this._sphereBoundsArray,ka.members),this.sphereIndexBuffer=t.createIndexBuffer(this._sphereIndexArray)),this.texture?this.video.paused||(this.texture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),i.texSubImage2D(e.WebGLConstants.TEXTURE_2D,0,0,0,e.WebGLConstants.RGBA,e.WebGLConstants.UNSIGNED_BYTE,this.video)):(this.texture=new e.Texture({context:t,image:this.video,pixelFormat:e.WebGLConstants.RGBA}),this.texture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE));for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture);}}serialize(){return {type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Ha,canvas:class extends Ha{constructor(t,i,s,r){super(t,i,s,r),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof e.window.HTMLCanvasElement||this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate;}load(){this.canvas||(this.canvas=this.options.canvas instanceof e.window.HTMLCanvasElement?this.options.canvas:e.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.needRepaint=!0;},this.pause=function(){this._playing=!1;},this._finishLoading());}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play();}onRemove(){this.pause();}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context,s=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,Ga.members)),this.boundsVAO||(this.boundsVAO=new za),this.texture?t?this.texture.update(this.canvas):this._playing&&(this.texture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),s.texSubImage2D(e.WebGLConstants.TEXTURE_2D,0,0,0,e.WebGLConstants.RGBA,e.WebGLConstants.UNSIGNED_BYTE,this.canvas)):(this.texture=new e.Texture({context:i,image:this.canvas,pixelFormat:e.WebGLConstants.RGBA}),this.texture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE));for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture);}}serialize(){return {type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of [this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return !0;return !1}isEarthSource(){return !1}},"3d-model":Wa,"3d-tiles":ja,terrain:nl,ellipsoid:ul},ml=function(t,i,s,r){if(!dl[i.type])return {minzoom:i.minzoom,maxzoom:i.maxzoom,unloadGPUData(){},fire(){},hasTransition(){},serialize(){}};const n=new dl[i.type](t,i,s,r);if(n.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${n.id}`);return e.bindAll(["load","abort","unload","serialize","prepare"],n),n};function pl(t,i){const s=new e.Matrix4;return s.translate([1,1,0]),s.scale([.5*t.width,.5*t.height,1]),s.multiplyRight(t.calculatePosMatrix(i.toUnwrapped()))}function fl(e,t,i,s,r,n){const o=function(e,t,i){if(e)for(const s of e){const e=t[s];if(e&&e.source===i&&("extrusion"===e.type||"histogram"===e.type))return !0}else for(const e in t){const s=t[e];if(s.source===i&&("extrusion"===s.type||"histogram"===s.type))return !0}return !1}(s&&s.layers,t,e.id),a=r.maxPitchScaleFactor(),l=e.tilesIn(i,a,o);l.sort(yl);const h=[];for(const i of l)h.push({wrappedTileID:i.tileID.wrapped().key,queryResults:i.tile.queryRenderedFeatures(t,e._state,i.queryGeometry,i.cameraQueryGeometry,i.scale,s,r,a,pl(r,i.tileID),n)});const _=function(e){const t={},i={};for(const s of e){const e=s.queryResults,r=s.wrappedTileID,n=i[r]=i[r]||{};for(const i in e){const s=e[i],r=n[i]=n[i]||{},o=t[i]=t[i]||[];for(const e of s)r[e.featureIndex]||(r[e.featureIndex]=!0,e.feature.intersectionZ=e.intersectionZ,o.push(e.feature));}}return t}(h);for(const t in _)_[t].forEach((t=>{const i=e.getFeatureState(t.layer["source-layer"],t.id);t.source=t.layer.source,t.layer["source-layer"]&&(t.sourceLayer=t.layer["source-layer"]),t.state=i;}));return _}function gl(t,i,s,r,n){const o={};if(!r.layers)return {};for(let a=0;a<r.layers.length;a++){const l=r.layers[a];if("extrusion"===i[l].type){const r=t.tilesInOfSphereExtrusion(s,n,i[l]),a=[];let h,_=1/0;const c=e.getRay({canvasX:s[0].x,canvasY:s[0].y,transform:n});r.map((t=>((t?t.featureTriangles:[]).map((t=>{const i=t.triangles;for(let s=0;s<i.length;s++){const r=c.intersectTriangle(...i[s],!1,[]);if(r){const i=new e.Vector3(c.origin).distance(r);i<_&&(_=i,h=t.feature);}}return null})),null))),h&&a.push({feature:h,intersectionZ:_}),o[`${l}`]=a;}}return o}function yl(e,t){const i=e.tileID,s=t.tileID;return i.overscaledZ-s.overscaledZ||i.canonical.y-s.canonical.y||i.wrap-s.wrap||i.canonical.x-s.canonical.x}function Cl(){return new e.window.Worker(VC.workerUrl)}class Tl{constructor(){this.active={};}acquire(e){if(!this.workers){const e=Tl.workerCount;for(this.workers=[];this.workers.length<e;)this.workers.push(new Cl);}return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],0===Object.keys(this.active).length&&(this.workers.forEach((e=>{e.terminate();})),this.workers=null);}isPreloaded(){return !!this.active.minemap_preloaded_worker_pool_id}numActive(){return Object.keys(this.active).length}}const xl=Math.floor(e.exported.hardwareConcurrency/2)-1;let bl;function vl(t,i){const s={};for(const e in t)"ref"!==e&&(s[e]=t[e]);return e.refProperties.forEach((e=>{e in i&&(s[e]=i[e]);})),s}function wl(e){e=e.slice();const t=Object.create(null);for(let i=0;i<e.length;i++)t[e[i].id]=e[i];for(let i=0;i<e.length;i++)"ref"in e[i]&&(e[i]=vl(e[i],t[e[i].ref]));return e}Tl.workerCount=Math.max(Math.min(xl,6),1);const Sl={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Al(e,t,i,s){i.push({command:Sl.addSource,args:[e,t[e],{isOriginal:s}]});}function El(e,t,i){t.push({command:Sl.removeSource,args:[e]}),i[e]=!0;}function Ml(e,t,i,s,r){El(e,i,s),Al(e,t,i,r);}function Pl(e,i,s){let r;for(r in e[s])if(e[s].hasOwnProperty(r)&&"data"!==r&&!t(e[s][r],i[s][r]))return !1;for(r in i[s])if(i[s].hasOwnProperty(r)&&"data"!==r&&!t(e[s][r],i[s][r]))return !1;return !0}function Rl(e,i,s,r,n,o){let a;for(a in i=i||{},e=e||{})e.hasOwnProperty(a)&&(t(e[a],i[a])||s.push({command:o,args:[r,a,i[a],n]}));for(a in i)i.hasOwnProperty(a)&&!e.hasOwnProperty(a)&&(t(e[a],i[a])||s.push({command:o,args:[r,a,i[a],n]}));}function Bl(e){return e.id}function Il(e,t){return e[t.id]=t,e}class Dl{constructor(e,t,i){const s=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(e/i),this.yCellCount=Math.ceil(t/i);for(let e=0;e<this.xCellCount*this.yCellCount;e++)s.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0;}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,i,s,r){this._forEachCell(t,i,s,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(s),this.bboxes.push(r);}insertCircle(e,t,i,s){this._forEachCell(t-s,i-s,t+s,i+s,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(i),this.circles.push(s);}_insertBoxCell(e,t,i,s,r,n){this.boxCells[r].push(n);}_insertCircleCell(e,t,i,s,r,n){this.circleCells[r].push(n);}_query(e,t,i,s,r,n){if(i<0||e>this.width||s<0||t>this.height)return !r&&[];const o=[];if(e<=0&&t<=0&&this.width<=i&&this.height<=s){if(r)return !0;for(let e=0;e<this.boxKeys.length;e++)o.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],i=this.circles[3*e+1],s=this.circles[3*e+2];o.push({key:this.circleKeys[e],x1:t-s,y1:i-s,x2:t+s,y2:i+s});}return n?o.filter(n):o}return this._forEachCell(e,t,i,s,this._queryCell,o,{hitTest:r,seenUids:{box:{},circle:{}}},n),r?o.length>0:o}_queryCircle(e,t,i,s,r){const n=e-i,o=e+i,a=t-i,l=t+i;if(o<0||n>this.width||l<0||a>this.height)return !s&&[];const h=[];return this._forEachCell(n,a,o,l,this._queryCellCircle,h,{hitTest:s,circle:{x:e,y:t,radius:i},seenUids:{box:{},circle:{}}},r),s?h.length>0:h}query(e,t,i,s,r){return this._query(e,t,i,s,!1,r)}hitTest(e,t,i,s,r){return this._query(e,t,i,s,!0,r)}hitTestCircle(e,t,i,s){return this._queryCircle(e,t,i,!0,s)}_queryCell(e,t,i,s,r,n,o,a){const l=o.seenUids,h=this.boxCells[r];if(null!==h){const r=this.bboxes;for(const _ of h)if(!l.box[_]){l.box[_]=!0;const h=4*_;if(e<=r[h+2]&&t<=r[h+3]&&i>=r[h+0]&&s>=r[h+1]&&(!a||a(this.boxKeys[_]))){if(o.hitTest)return n.push(!0),!0;n.push({key:this.boxKeys[_],x1:r[h],y1:r[h+1],x2:r[h+2],y2:r[h+3]});}}}const _=this.circleCells[r];if(null!==_){const r=this.circles;for(const h of _)if(!l.circle[h]){l.circle[h]=!0;const _=3*h;if(this._circleAndRectCollide(r[_],r[_+1],r[_+2],e,t,i,s)&&(!a||a(this.circleKeys[h]))){if(o.hitTest)return n.push(!0),!0;{const e=r[_],t=r[_+1],i=r[_+2];n.push({key:this.circleKeys[h],x1:e-i,y1:t-i,x2:e+i,y2:t+i});}}}}}_queryCellCircle(e,t,i,s,r,n,o,a){const l=o.circle,h=o.seenUids,_=this.boxCells[r];if(null!==_){const e=this.bboxes;for(const t of _)if(!h.box[t]){h.box[t]=!0;const i=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[i+0],e[i+1],e[i+2],e[i+3])&&(!a||a(this.boxKeys[t])))return n.push(!0),!0}}const c=this.circleCells[r];if(null!==c){const e=this.circles;for(const t of c)if(!h.circle[t]){h.circle[t]=!0;const i=3*t;if(this._circlesCollide(e[i],e[i+1],e[i+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[t])))return n.push(!0),!0}}}_forEachCell(e,t,i,s,r,n,o,a){const l=this._convertToXCellCoord(e),h=this._convertToYCellCoord(t),_=this._convertToXCellCoord(i),c=this._convertToYCellCoord(s);for(let u=l;u<=_;u++)for(let l=h;l<=c;l++)if(r.call(this,e,t,i,s,this.xCellCount*l+u,n,o,a))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,i,s,r,n){const o=s-e,a=r-t,l=i+n;return l*l>o*o+a*a}_circleAndRectCollide(e,t,i,s,r,n,o){const a=(n-s)/2,l=Math.abs(e-(s+a));if(l>a+i)return !1;const h=(o-r)/2,_=Math.abs(t-(r+h));if(_>h+i)return !1;if(l<=a||_<=h)return !0;const c=l-a,u=_-h;return c*c+u*u<=i*i}}const Ol=1e3;class Ll{constructor(t,i,s){this.style=t;const r=this.style.symbolMatrixHelper;this.grid=i||new Dl(r.width+2e3,r.height+2e3,25),this.ignoredGrid=s||new Dl(r.width+2e3,r.height+2e3,25),this.pitchfactor=Math.cos(t.symbolMatrixHelper.getMapViewParams().pitch*e.CONSTS.TRANSFORM.DEG_TO_RAD)*t.symbolMatrixHelper.cameraToCenterDistance,this.screenRightBoundary=r.width+Ol,this.screenBottomBoundary=r.height+Ol,this.gridRightBoundary=r.width+2e3,this.gridBottomBoundary=r.height+2e3;}placeCollisionBox(e,t,i,s,r){const n=this.projectAndGetPerspectiveRatio(s,e.anchorPointX,e.anchorPointY),o=i*n.perspectiveRatio,a=e.x1*o+n.point.x,l=e.y1*o+n.point.y,h=e.x2*o+n.point.x,_=e.y2*o+n.point.y;return !this.isInsideGrid(a,l,h,_)||!t&&this.grid.hitTest(a,l,h,_,r)?{box:[],offscreen:!1}:{box:[a,l,h,_],offscreen:this.isOffscreen(a,l,h,_)}}approximateTileDistance(e,t,i,s,r){const n=e.lastSegmentViewportDistance*i;return e.prevTileDistance+n+((r?1:s/this.pitchfactor)-1)*n*Math.abs(Math.sin(t))}placeCollisionCircles(t,i,s,r,n,o,a,l,h,_,c,u,d,m){const p=[],f=this.projectAnchor(_,o.anchorX,o.anchorY),g=h/24,y=o.lineOffsetX*h,C=o.lineOffsetY*h,T=new e.pointGeometry3d(o.anchorX,o.anchorY),x=e.project(T,c).point,b=e.placeFirstAndLastGlyph(g,l,y,C,!1,x,T,o,a,c,{},!0);let v=!1,w=!1,S=!0;const A=f.perspectiveRatio*r,E=1/(r*s);let M=0,P=0;b&&(M=this.approximateTileDistance(b.first.tileDistance,b.first.angle,E,f.cameraDistance,d),P=this.approximateTileDistance(b.last.tileDistance,b.last.angle,E,f.cameraDistance,d));for(let e=0;e<t.length;e+=5){const s=t[e],r=t[e+1],n=t[e+2],o=t[e+3];if(!b||o<-M||o>P){Vl(t,e,!1);continue}const a=this.projectPoint(_,s,r),l=n*A;if(p.length>0){const i=a.x-p[p.length-4],s=a.y-p[p.length-3];if(l*l*2>i*i+s*s&&e+8<t.length){const i=t[e+8];if(i>-M&&i<P){Vl(t,e,!1);continue}}}p.push(a.x,a.y,l,e/5),Vl(t,e,!0);const h=a.x-l,c=a.y-l,d=a.x+l,f=a.y+l;if(S=S&&this.isOffscreen(h,c,d,f),w=w||this.isInsideGrid(h,c,d,f),!i&&this.grid.hitTestCircle(a.x,a.y,l,m)){if(!u)return {circles:[],offscreen:!1};v=!0;}}return {circles:v||!w?[]:p,offscreen:S}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return {};const i=[];let s=1/0,r=1/0,n=-1/0,o=-1/0;for(const a of t){const t=new e.pointGeometry3d(a.x+Ol,a.y+Ol);s=Math.min(s,t.x),r=Math.min(r,t.y),n=Math.max(n,t.x),o=Math.max(o,t.y),i.push(t);}const a=this.grid.query(s,r,n,o).concat(this.ignoredGrid.query(s,r,n,o)),l={},h={};for(const t of a){const s=t.key;if(void 0===l[s.bucketInstanceId]&&(l[s.bucketInstanceId]={}),l[s.bucketInstanceId][s.featureIndex])continue;const r=[new e.pointGeometry3d(t.x1,t.y1),new e.pointGeometry3d(t.x2,t.y1),new e.pointGeometry3d(t.x2,t.y2),new e.pointGeometry3d(t.x1,t.y2)];e.polygonIntersectsPolygon(i,r)&&(l[s.bucketInstanceId][s.featureIndex]=!0,void 0===h[s.bucketInstanceId]&&(h[s.bucketInstanceId]=[]),h[s.bucketInstanceId].push(s.featureIndex));}return h}insertCollisionBox(e,t,i,s,r){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:s,collisionGroupID:r},e[0],e[1],e[2],e[3]);}insertCollisionCircles(e,t,i,s,r){const n=t?this.ignoredGrid:this.grid,o={bucketInstanceId:i,featureIndex:s,collisionGroupID:r};for(let t=0;t<e.length;t+=4)n.insertCircle(o,e[t],e[t+1],e[t+2]);}projectAnchor(t,i,s){const r=[i,s,0,1];return e.xyTransformMat4(r,r,t),{perspectiveRatio:.5+this.style.symbolMatrixHelper.cameraToCenterDistance/r[3]*.5,cameraDistance:r[3]}}projectPoint(t,i,s){const r=[i,s,0,1];return e.xyTransformMat4(r,r,t),new e.pointGeometry3d((r[0]/r[3]+1)/2*this.style.symbolMatrixHelper.width+Ol,(-r[1]/r[3]+1)/2*this.style.symbolMatrixHelper.height+Ol)}projectAndGetPerspectiveRatio(t,i,s){const r=[i,s,0,1];e.xyTransformMat4(r,r,t);const n=new e.pointGeometry3d((r[0]/r[3]+1)/2*this.style.symbolMatrixHelper.width+Ol,(-r[1]/r[3]+1)/2*this.style.symbolMatrixHelper.height+Ol),o=2*Math.cos(this.style.symbolMatrixHelper.getMapViewParams().pitch*e.CONSTS.TRANSFORM.DEG_TO_RAD);let a=3-o;return e.exported.devicePixelRatio-1<.1&&(a=2.25-.75*o),a*=720/this.style.symbolMatrixHelper.height,{point:n,perspectiveRatio:(.5+this.style.symbolMatrixHelper.cameraToCenterDistance/r[3]*.5)*a}}isOffscreen(e,t,i,s){return i<Ol||e>=this.screenRightBoundary||s<Ol||t>this.screenBottomBoundary}isInsideGrid(e,t,i,s){return !0}}function Vl(e,t,i){e[t+4]=i?1:0;}const Nl=e.properties.layout;class Fl{constructor(e,t,i,s){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):s&&i?1:0,this.placed=i;}isHidden(){return 0===this.opacity&&!this.placed}}class Gl{constructor(e,t,i,s,r){this.text=new Fl(e?e.text:null,t,i,r),this.icon=new Fl(e?e.icon:null,t,s,r);}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class kl{constructor(e,t,i){this.text=e,this.icon=t,this.skipFade=i;}}class Ul{constructor(e,t,i,s,r){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=i,this.bucketIndex=s,this.tileID=r;}}class Hl{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={};}get(e){if(this.crossSourceCollisions)return {ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t};}return this.collisionGroups[e]}}class zl{constructor(e,t,i){this.style=e,this.collisionIndex=new Ll(this.style),this.placements={},this.opacities={},this.stale=!1,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new Hl(i);}placeLayerTile(t,i,s,r){const n=i.getBucket(t),o=i.latestFeatureIndex;if(!n||!o||t.id!==n.layerIds[0])return;const a=i.collisionBoxArray,l=n.layers[0].layout,h=Math.pow(2,this.style.symbolMatrixHelper.zoom-i.tileID.overscaledZ),_=i.tileSize/e.EXTENT,c=this.style.symbolMatrixHelper.calculatePosMatrix(i.tileID.toUnwrapped()),u=e.getLabelPlaneMatrix(c,"map"===l.get("text-pitch-alignment"),"map"===l.get("text-rotation-alignment"),this.style.symbolMatrixHelper,e.pixelsToTileUnits(i,1,this.style.getNearestTileZoom())),d=e.getLabelPlaneMatrix(c,"map"===l.get("icon-pitch-alignment"),"map"===l.get("icon-rotation-alignment"),this.style.symbolMatrixHelper,e.pixelsToTileUnits(i,1,this.style.getNearestTileZoom()));this.retainedQueryData[n.bucketInstanceId]=new Ul(n.bucketInstanceId,o,n.sourceLayerIndex,n.index,i.tileID),this.placeLayerBucket(n,c,u,d,h,_,s,r,a);}placeLayerBucket(t,i,s,r,n,o,a,l,h){const _=t.layers[0].layout,c=e.evaluateSizeForZoom(t.textSizeData,this.style.getNearestTileZoom(),Nl&&Nl.properties&&Nl.properties["text-size"]),u=_.get("text-optional"),d=_.get("icon-optional"),m=this.collisionGroups.get(t.sourceID);for(const r of t.symbolInstances)if(!l[r.crossTileID]){let p=!1,f=!1,g=!0,y=null,C=null,T=null,x=0,b=0;r.collisionArrays||(r.collisionArrays=t.deserializeCollisionBoxes(h,r.textBoxStartIndex,r.textBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex)),r.collisionArrays.textFeatureIndex&&(x=r.collisionArrays.textFeatureIndex),r.collisionArrays.textBox&&(y=this.collisionIndex.placeCollisionBox(r.collisionArrays.textBox,_.get("text-allow-overlap"),o,i,m.predicate),p=y.box.length>0,g=g&&y.offscreen);const v=r.collisionArrays.textCircles;if(v){const l=t.text.placedSymbolArray.get(r.placedTextSymbolIndices[0]),h=e.evaluateSizeForFeature(t.textSizeData,c,l);C=this.collisionIndex.placeCollisionCircles(v,_.get("text-allow-overlap"),n,o,r.key,l,t.lineVertexArray,t.glyphOffsetArray,h,i,s,a,"map"===_.get("text-pitch-alignment"),m.predicate),p=_.get("text-allow-overlap")||C.circles.length>0,g=g&&C.offscreen;}r.collisionArrays.iconFeatureIndex&&(b=r.collisionArrays.iconFeatureIndex),r.collisionArrays.iconBox&&(T=this.collisionIndex.placeCollisionBox(r.collisionArrays.iconBox,_.get("icon-allow-overlap"),o,i,m.predicate),f=T.box.length>0,g=g&&T.offscreen);const w=u||0===r.numGlyphVertices&&0===r.numVerticalGlyphVertices,S=d||0===r.numIconVertices;w||S?S?w||(f=f&&p):p=f&&p:f=p=f&&p,p&&y&&this.collisionIndex.insertCollisionBox(y.box,_.get("text-ignore-placement"),t.bucketInstanceId,x,m.ID),f&&T&&this.collisionIndex.insertCollisionBox(T.box,_.get("icon-ignore-placement"),t.bucketInstanceId,b,m.ID),p&&C&&this.collisionIndex.insertCollisionCircles(C.circles,_.get("text-ignore-placement"),t.bucketInstanceId,x,m.ID),this.placements[r.crossTileID]=new kl(p,f,g||t.justReloaded),l[r.crossTileID]=!0;}t.justReloaded=!1;}commit(e,t){this.commitTime=t;let i=!1;const s=e&&0!==this.fadeDuration?(this.commitTime-e.commitTime)/this.fadeDuration:1,r=e?e.opacities:{};for(const e in this.placements){const t=this.placements[e],n=r[e];n?(this.opacities[e]=new Gl(n,s,t.text,t.icon),i=i||t.text!==n.text.placed||t.icon!==n.icon.placed):(this.opacities[e]=new Gl(null,s,t.text,t.icon,t.skipFade),i=i||t.text||t.icon);}for(const e in r){const t=r[e];if(!this.opacities[e]){const r=new Gl(t,s,!1,!1);r.isHidden()||(this.opacities[e]=r,i=i||t.text.placed||t.icon.placed);}}i?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t);}updateLayerOpacities(e,t){const i={};for(const s of t){const t=s.getBucket(e);t&&s.latestFeatureIndex&&e.id===t.layerIds[0]&&this.updateBucketOpacities(t,i,s.collisionBoxArray);}}updateBucketOpacities(t,i,s){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasCollisionBoxData()&&t.collisionBox.collisionVertexArray.clear(),t.hasCollisionCircleData()&&t.collisionCircle.collisionVertexArray.clear();const r=t.layers[0].layout,n=new Gl(null,0,!1,!1,!0),o=new Gl(null,0,r.get("text-allow-overlap"),r.get("icon-allow-overlap"),!0);for(let e=0;e<t.symbolInstances.length;e++){const r=t.symbolInstances[e],a=i[r.crossTileID];let l=this.opacities[r.crossTileID];a?l=n:l||(l=o,this.opacities[r.crossTileID]=l),i[r.crossTileID]=!0;const h=r.numIconVertices>0;if(r.numGlyphVertices>0||r.numVerticalGlyphVertices>0){const e=Ql(l.text),i=(r.numGlyphVertices+r.numVerticalGlyphVertices)/4;for(let s=0;s<i;s++)t.text.opacityVertexArray.emplaceBack(e);for(const e of r.placedTextSymbolIndices)t.text.placedSymbolArray.get(e).hidden=l.text.isHidden();}if(h){const i=Ql(l.icon);for(let e=0;e<r.numIconVertices/4;e++)t.icon.opacityVertexArray.emplaceBack(i);t.icon.placedSymbolArray.get(e).hidden=l.icon.isHidden();}r.collisionArrays||(r.collisionArrays=t.deserializeCollisionBoxes(s,r.textBoxStartIndex,r.textBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex));const _=r.collisionArrays;if(_){_.textBox&&t.hasCollisionBoxData()&&Wl(t.collisionBox.collisionVertexArray,l.text.placed,!1),_.iconBox&&t.hasCollisionBoxData()&&Wl(t.collisionBox.collisionVertexArray,l.icon.placed,!1);const e=_.textCircles;if(e&&t.hasCollisionCircleData())for(let i=0;i<e.length;i+=5)Wl(t.collisionCircle.collisionVertexArray,l.text.placed,a||0===e[i+4]);}}t.sortFeatures(this.style.symbolMatrixHelper.getMapViewParams().bearing*e.CONSTS.TRANSFORM.DEG_TO_RAD),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasCollisionBoxData()&&t.collisionBox.collisionVertexBuffer&&t.collisionBox.collisionVertexBuffer.updateData(t.collisionBox.collisionVertexArray),t.hasCollisionCircleData()&&t.collisionCircle.collisionVertexBuffer&&t.collisionCircle.collisionVertexBuffer.updateData(t.collisionCircle.collisionVertexArray);}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e){return "undefined"!==this.commitTime&&this.commitTime+this.fadeDuration>e}setStale(){this.stale=!0;}}function Wl(e,t,i){e.emplaceBack(t?1:0,i?1:0),e.emplaceBack(t?1:0,i?1:0),e.emplaceBack(t?1:0,i?1:0),e.emplaceBack(t?1:0,i?1:0);}const jl=Math.pow(2,25),Xl=Math.pow(2,24),ql=Math.pow(2,17),Kl=Math.pow(2,16),Jl=Math.pow(2,9),Zl=Math.pow(2,8),Yl=Math.pow(2,1);function Ql(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,i=Math.floor(127*e.opacity);return i*jl+t*Xl+i*ql+t*Kl+i*Jl+t*Zl+i*Yl+t}class $l{constructor(){this._currentTileIndex=0,this._seenCrossTileIDs={};}continuePlacement(e,t,i,s,r){for(;this._currentTileIndex<e.length;)if(t.placeLayerTile(s,e[this._currentTileIndex],i,this._seenCrossTileIDs),this._currentTileIndex++,r())return !0}}class eh{constructor(e,t,i,s,r,n,o){this.placement=new zl(e,n,o),this._currentPlacementIndex=i.length-1,this._forceFullPlacement=s,this._showCollisionBoxes=r,this._done=!1;}isDone(){return this._done}continuePlacement(t,i,s){const r=e.exported.now(),n=()=>{const t=e.exported.now()-r;return !this._forceFullPlacement&&t>2};for(;this._currentPlacementIndex>=0;){const e=i[t[this._currentPlacementIndex]];if("symbol"===e.type||"symtracking"===e.type){if(this._inProgressLayer||(this._inProgressLayer=new $l),this._inProgressLayer.continuePlacement(s[e.source],this.placement,this._showCollisionBoxes,e,n))return;delete this._inProgressLayer;}this._currentPlacementIndex--;}this._done=!0;}commit(e,t){return this.placement.commit(e,t),this.placement}}const th=512/e.EXTENT/2,ih=new Map([[-10,th/.0009765625],[-9,th/.001953125],[-8,th/.00390625],[-7,th/.0078125],[-6,th/.015625],[-5,th/.03125],[-4,th/.0625],[-3,th/.125],[-2,th/.25],[-1,th/.5],[0,th/1],[1,th/2],[2,th/4],[3,th/8],[4,th/16],[5,th/32],[6,th/64],[7,th/128],[8,th/256],[9,th/512],[10,th/1024]]);class sh{constructor(e,t,i){this.tileID=e,this.indexedSymbolInstances={},this.bucketInstanceId=i;for(const i of t){const t=i.key;this.indexedSymbolInstances[t]||(this.indexedSymbolInstances[t]=[]),this.indexedSymbolInstances[t].push({crossTileID:i.crossTileID,coord:this.getScaledCoordinates(i,e)});}}getScaledCoordinates(t,i){const s=ih.get(i.canonical.z-this.tileID.canonical.z),r=t.anchor;return {x:Math.floor((i.canonical.x*e.EXTENT+r.x)*s),y:Math.floor((i.canonical.y*e.EXTENT+r.y)*s)}}findMatches(e,t,i){const s=this.tileID.canonical.z<t.canonical.z?1:Math.pow(2,this.tileID.canonical.z-t.canonical.z);for(let r=0;r<e.length;r++){const n=e[r];if(n.crossTileID)continue;const o=this.indexedSymbolInstances[n.key];if(!o)continue;const a=this.getScaledCoordinates(n,t);for(let e=0;e<o.length;e++){const t=o[e];if(Math.abs(t.coord.x-a.x)<=s&&Math.abs(t.coord.y-a.y)<=s&&!i[t.crossTileID]){i[t.crossTileID]=!0,n.crossTileID=t.crossTileID;break}}}}}class rh{constructor(){this.maxCrossTileID=0;}generate(){return ++this.maxCrossTileID}}class nh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0;}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const e in this.indexes){const i=this.indexes[e],s={};for(const e in i){const r=i[e];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),s[r.tileID.key]=r;}this.indexes[e]=s;}this.lng=e;}addBucket(e,t,i){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return !1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key]);}for(const e of t.symbolInstances)e.crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const s=this.usedCrossTileIDs[e.overscaledZ];for(const i in this.indexes){const r=this.indexes[i];if(Number(i)>e.overscaledZ)for(const i in r){const n=r[i];n.tileID.isChildOf(e)&&n.findMatches(t.symbolInstances,e,s);}else {const n=r[e.scaledTo(Number(i)).key];n&&n.findMatches(t.symbolInstances,e,s);}}for(const e of t.symbolInstances)e.crossTileID||(e.crossTileID=i.generate(),s[e.crossTileID]=!0);return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new sh(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const i in t.indexedSymbolInstances)for(const s of t.indexedSymbolInstances[i])delete this.usedCrossTileIDs[e][s.crossTileID];}removeStaleBuckets(e){let t=!1;for(const i in this.indexes){const s=this.indexes[i];for(const r in s)e[s[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,s[r]),delete s[r],t=!0);}return t}}class oh{constructor(){this.layerIndexes={},this.crossTileIDs=new rh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={};}addLayer(e,t){let i=this.layerIndexes[e.id];void 0===i&&(i=this.layerIndexes[e.id]=new nh);let s=!1;const r={};for(const n of t){const t=n.getBucket(e);t&&e.id===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(n.tileID,t,this.crossTileIDs)&&(s=!0),r[t.bucketInstanceId]=!0);}return i.removeStaleBuckets(r)&&(s=!0),s}pruneUnusedLayers(e){const t={};e.forEach((e=>{t[e]=!0;}));for(const e in this.layerIndexes)t[e]||delete this.layerIndexes[e];}}const ah=e.createLayout([{name:"a_PositionHighAndSize",type:"Float32",components:4},{name:"a_PositionLowAndOutline",type:"Float32",components:4},{name:"a_CompressedAttribute0",type:"Float32",components:3},{name:"a_CompressedAttribute1",type:"Float32",components:4},{name:"a_ScaleByDistance",type:"Float32",components:4},{name:"a_DistanceDisplayCondition",type:"Float32",components:2}]);class lh{constructor(t,i){t=e.defaultValue(t,0),this._near=t,i=e.defaultValue(i,Number.MAX_VALUE),this._far=i;}get near(){return this._near}set near(e){this._near=e;}get far(){return this._far}set far(e){this._far=e;}pack(t,i,s){if(!e.defined(t))throw new Error("value is required");if(!e.defined(i))throw new Error("array is required");return s=e.defaultValue(s,0),i[s++]=t.near,i[s]=t.far,i}unpack(t,i,s){if(!e.defined(t))throw new Error("array is required");return i=e.defaultValue(i,0),e.defined(s)||(s=new lh),s.near=t[i++],s.far=t[i],s}static equals(t,i){return t===i||e.defined(t)&&e.defined(i)&&t.near===i.near&&t.far===i.far}equals(e){return lh.equals(this,e)}static clone(t,i){if(e.defined(t))return e.defined(i)||(i=new lh),i.near=t.near,i.far=t.far,i}clone(e){return lh.clone(this,e)}}class hh{constructor(t,i,s,r){this.near=e.defaultValue(t,0),this.nearValue=e.defaultValue(i,0),this.far=e.defaultValue(s,1),this.farValue=e.defaultValue(r,0);}static clone(t,i){if(e.defined(t))return e.defined(i)?(i.near=t.near,i.nearValue=t.nearValue,i.far=t.far,i.farValue=t.farValue,i):new hh(t.near,t.nearValue,t.far,t.farValue)}clone(e){return hh.clone(this,e)}pack(t,i,s){if(!e.defined(t))throw new Error("value is required");if(!e.defined(i))throw new Error("array is required");return s=e.defaultValue(s,0),i[s++]=t.near,i[s++]=t.nearValue,i[s++]=t.far,i[s]=t.farValue,i}unpack(t,i,s){if(!e.defined(t))throw new Error("array is required");return i=e.defaultValue(i,0),e.defined(s)||(s=new hh),s.near=t[i++],s.nearValue=t[i++],s.far=t[i++],s.farValue=t[i],s}static equals(t,i){return t===i||e.defined(t)&&e.defined(i)&&t.near===i.near&&t.nearValue===i.nearValue&&t.far===i.far&&t.farValue===i.farValue}equals(e){hh.equals(this,e);}}class _h{constructor(t){let i=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).translucencyByDistance,s=t.scaleByDistance,r=t.distanceDisplayCondition;if(e.defined(i)){if(i.far<=i.near)throw new Error("translucencyByDistance.far must be greater than translucencyByDistance.near.");i=hh.clone(i);}if(e.defined(s)){if(s.far<=s.near)throw new Error("scaleByDistance.far must be greater than scaleByDistance.near.");s=hh.clone(s);}if(e.defined(r)){if(r.far<=r.near)throw new Error("distanceDisplayCondition.far must be greater than distanceDisplayCondition.near.");r=lh.clone(r);}this._show=e.defaultValue(t.show,!0),this._position=e.Vector3.clone(e.defaultValue(t.position,e.Vector3.ZERO)),this._outlineColor=e.Color.clone(e.Color.parse(e.defaultValue(t.outlineColor,new e.Color(0,0,0,0)))),this._color=e.Color.clone(e.Color.parse(e.defaultValue(t?.color,new e.Color(1,1,1,1)))),this._outlineWidth=e.defaultValue(t.outlineWidth,0),this._pixelSize=e.defaultValue(t.pixelSize,10),this.properties=e.defaultValue(t.properties,void 0),this._scaleByDistance=s,this._translucencyByDistance=i,this._distanceDisplayCondition=r,this.id=t.id,this._index=-1;}get show(){return this._show}set show(t){if(!e.defined(t))throw new Error("value is required.");this._show!==t&&(this._show=t,this._pointPrimitiveCollection._dirty=!0);}get position(){return this._position}set position(t){if(!e.defined(t))throw new Error("value is required.");if(!(t instanceof e.Vector3))throw new Error("position is not the type of Vector3.");e.Vector3.equals(this._position,t)||(e.Vector3.clone(t,this._position),this._pointPrimitiveCollection._dirty=!0);}get scaleByDistance(){return this._scaleByDistance}set scaleByDistance(t){if(e.defined(t)&&t.far<=t.near)throw new Error("far distance must be greater than near distance.");const i=this._scaleByDistance;hh.equals(i,t)||(this._scaleByDistance=hh.clone(t,i),this._pointPrimitiveCollection._dirty=!0);}get translucencyByDistance(){return this._translucencyByDistance}set translucencyByDistance(t){if(e.defined(t)&&t.far<=t.near)throw new Error("far distance must be greater than near distance.");const i=this._translucencyByDistance;hh.equals(i,t)||(this._translucencyByDistance=hh.clone(t,i),this._pointPrimitiveCollection._dirty=!0);}get pixelSize(){return this._pixelSize}set pixelSize(t){if(!e.defined(t))throw new Error("value is required.");this._pixelSize!==t&&(this._pixelSize=t,this._pointPrimitiveCollection._dirty=!0);}get color(){return this._color}set color(t){if(!e.defined(t))throw new Error("value is required.");if(t instanceof e.Color||"string"==typeof t){const i=e.Color.parse(t);e.Color.equals(this._color,i)||(e.Color.clone(i,this._color),this._pointPrimitiveCollection._dirty=!0);}}get outlineColor(){return this._outlineColor}set outlineColor(t){if(!e.defined(t))throw new Error("value is required.");if(t instanceof e.Color||"string"==typeof t){const i=e.Color.parse(t);e.Color.equals(this._outlineColor,i)||(e.Color.clone(i,this._outlineColor),this._pointPrimitiveCollection._dirty=!0);}}get outlineWidth(){return this._outlineWidth}set outlineWidth(t){if(!e.defined(t))throw new Error("value is required.");this._outlineWidth!==t&&(this._outlineWidth=t,this._pointPrimitiveCollection._dirty=!0);}get distanceDisplayCondition(){return this._distanceDisplayCondition}set distanceDisplayCondition(t){if(e.defined(t)&&t.far<=t.near)throw new Error("far must be greater than near");lh.equals(this._distanceDisplayCondition,t)||(this._distanceDisplayCondition=lh.clone(t,this._distanceDisplayCondition),this._pointPrimitiveCollection._dirty=!0);}destroy(){return this._show=void 0,this._position=void 0,this._color=void 0,this._outlineColor=void 0,this._outlineWidth=void 0,this._pixelSize=void 0,this._scaleByDistance=void 0,this._translucencyByDistance=void 0,this._distanceDisplayCondition=void 0,this.id=void 0,this._pointPrimitiveCollection=void 0,this._index=void 0,e.destroyObject(this)}}const ch=e.createLayout([{name:"a_PickColor",components:4,type:"Float32"}]),uh=new e.EncodedVector3,dh=65536,mh=256;class ph{constructor(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this.id=e.defaultValue(t.id,e.uniqueId()),this._allowPick=e.defaultValue(t.allowPick,!0),this._depthTest=e.defaultValue(t.depthTest,!0),this._shaderSource=new e.ShaderSource({type:"point"}),this._createVertexArray=!1,this._pointPrimitives=[];const i=this;e.defaultValue(t.pointPrimitives,[]).forEach((e=>{if(!(e instanceof _h))throw new Error("pointPrimitives contains the type is not PointPrimitive!");i.add(e);})),this._shaderScaleByDistance=!1,this._shaderTranslucencyByDistance=!1,this._shaderDistanceDisplayCondition=!1,this._maxPixelSize=1,this._boundingSphere=void 0,this._boundingBox=void 0,this.show=e.defaultValue(t.show,!0),this.modelMatrix=e.Matrix4.clone(e.defaultValue(t.modelMatrix,e.Matrix4.IDENTITY)),this._modelMatrix=e.Matrix4.clone(e.Matrix4.IDENTITY),this._maxTotalPointSize=1,this._opaquePrimitives=[],this._transLucentPrimitives=[],this._vertexArray=new e.StructArrayLayout21f84,this._pickColorVertexArray=new e.StructArrayLayout4f16,this._vertBuffer=void 0,this._geometry=new e.Geometry({type:"pointCollection"}),this._materialOpaque=new e.Material({type:"point",renderState:{depthTest:this._depthTest?e.renderStateEnum.enableDepthTest:e.renderStateEnum.disableDepthTest,depthMask:e.renderStateEnum.enableDepthMask},defines:{OPAQUE:!0}}),this._materialOpaque._uniforms.set("u_maxTotalPointSize",(()=>i._maxTotalPointSize)),this._materialTranslucent=new e.Material({type:"point",renderState:{depthTest:this._depthTest?e.renderStateEnum.enableDepthTest:e.renderStateEnum.disableDepthTest,depthMask:e.renderStateEnum.disableDepthMask,blending:e.renderStateEnum.enableBlending}}),this._materialTranslucent._uniforms.set("u_maxTotalPointSize",(()=>i._maxTotalPointSize)),this._opaquePrimitive=void 0,this._translucentPrimitive=void 0,this._dirty=!1;}get length(){return this._pointPrimitives.length}add(e){if(!(e instanceof _h))throw new Error("pointPrimitive is not type of PointPrimitive!");return e._pointPrimitiveCollection=this,e._index=this._pointPrimitives.length,this._pointPrimitives.push(e),this._createVertexArray=!0,e}remove(e,t){if(this.contains(e)){this._pointPrimitives.splice(e._index,1),this._createVertexArray=!0,t&&e.destroy();for(let e=0,t=0;e<this._pointPrimitives.length;++e){const i=this._pointPrimitives[e];i&&(i._index=t++);}return !0}return !1}removeAll(e){const t=this._pointPrimitives.length;for(let i=0;i<t;++i)this._pointPrimitives[i]&&e&&this._pointPrimitives[i].destroy();this._pointPrimitives=[],this._createVertexArray=!0;}contains(t){return e.defined(t)&&t._pointPrimitiveCollection===this}get(t){if(!e.defined(t))throw new Error("index is required.");return this._pointPrimitives[t]}_writePointPrimitive(t){e.EncodedVector3.fromVector3(t.position,uh);const i=t.pixelSize,s=t.outlineWidth;this._maxPixelSize=Math.max(this._maxPixelSize,i+s);const r=uh.high,n=uh.low,o=t.color,a=t.outlineColor;let l=e.Color.floatToByte(o.r),h=e.Color.floatToByte(o.g),_=e.Color.floatToByte(o.b);const c=l*dh+h*mh+_;l=e.Color.floatToByte(a.r),h=e.Color.floatToByte(a.g),_=e.Color.floatToByte(a.b);const u=l*dh+h*mh+_,d=e.Color.floatToByte(o.a)*dh+e.Color.floatToByte(a.a)*mh;let m=0,p=1,f=1,g=1;const y=t.translucencyByDistance;e.defined(y)&&(m=y.near,p=y.nearValue,f=y.far,g=y.farValue,1===p&&1===g||(this._shaderTranslucencyByDistance=!0));let C=t.show;0===t.color.alpha&&0===t.outlineColor.alpha&&(C=!1),p=e.CONSTS.CesiumMath.clamp(p,0,1),p=1===p?255:255*p|0;const T=(C?1:0)*mh+p;g=e.CONSTS.CesiumMath.clamp(g,0,1),g=1===g?255:255*g|0;const x=g;let b=0,v=1,w=1,S=1;const A=t.scaleByDistance;e.defined(A)&&(b=A.near,v=A.nearValue,w=A.far,S=A.farValue,1===v&&1===S||(this._shaderScaleByDistance=!0));let E=0,M=Number.MAX_VALUE;const P=t.distanceDisplayCondition;e.defined(P)&&(E=P.near,M=P.far,E*=E,M*=M,this._shaderDistanceDisplayCondition=!0),this._vertexArray.emplaceBack(r.x,r.y,r.z,i,n.x,n.y,n.z,s,c,u,d,T,x,m,f,b,v,w,S,E,M);}_writePickColor(e,t){if(this._allowPick){const i=t.createPickId(e);this._pickColorVertexArray.emplaceBack(i.color.r,i.color.g,i.color.b,i.color.a);}}update(t){const i=t.context;if(this._opaquePrimitives=[],this._transLucentPrimitives=[],!this.show)return;this._maxTotalPointSize=e.ContextLimits.maximumAliasedPointSize;const s=this._pointPrimitives.length;if((this._createVertexArray||this._dirty)&&(this._createVertexArray=!1,this._dirty=!1,e.defined(this._vertBuffer)&&(this._vertBuffer.destroy(),this._vertBuffer=void 0,this._opaquePrimitive=void 0,this._translucentPrimitive=void 0,this._boundingSphere=void 0,this._boundingBox=void 0),s>0)){this._vertexArray=new e.StructArrayLayout21f84,this._pickColorVertexArray=new e.StructArrayLayout4f16;let t=[];for(let e=0;e<s;++e)this._writePointPrimitive(this._pointPrimitives[e]),this._writePickColor(this._pointPrimitives[e],i),t.push(this._pointPrimitives[e].position);this._boundingSphere=e.BoundingSphere.fromPoints(t),this._boundingBox=e.OrientedBoundingBox.fromPoints(t),t=[],this._shaderTranslucencyByDistance&&(this._materialOpaque.defines={EYE_DISTANCE_TRANSLUCENCY:!0},this._materialTranslucent.defines={EYE_DISTANCE_TRANSLUCENCY:!0}),this._shaderScaleByDistance&&(this._materialOpaque.defines={EYE_DISTANCE_SCALING:!0},this._materialTranslucent.defines={EYE_DISTANCE_SCALING:!0}),this._shaderDistanceDisplayCondition&&(this._materialOpaque.defines={DISTANCE_DISPLAY_CONDITION:!0},this._materialTranslucent.defines={DISTANCE_DISPLAY_CONDITION:!0}),this._vertBuffer=i.createVertexBuffer(this._vertexArray,ah.members,!1),this._geometry._vertBuffer=this._vertBuffer,this._allowPick&&(this._pickColorVertexBuffer=i.createVertexBuffer(this._pickColorVertexArray,ch.members,!1),this._geometry.dynamicLayoutBuffer1=this._pickColorVertexBuffer),this._geometry.boundingSphere=this._boundingSphere,this._geometry.boundingBox=this._boundingBox,this._geometry._segmentVector=e.SegmentVector.simpleSegment(0,0,this._pointPrimitives.length,this._pointPrimitives.length),this._geometry.primitiveType=e.WebGLConstants.POINTS,this._opaquePrimitive=new e.Primitive({geometry:this._geometry,material:this._materialOpaque,modelMatrix:this.modelMatrix,name:"pointCollection",allowPick:this._allowPick}),this._translucentPrimitive=new e.Primitive({geometry:this._geometry,material:this._materialTranslucent,modelMatrix:this.modelMatrix,name:"pointCollection",allowPick:this._allowPick});}e.defined(this._vertBuffer)&&(this._opaquePrimitives.push(this._opaquePrimitive),this._transLucentPrimitives.push(this._translucentPrimitive));}getTranslucentPrimitives(){return this._transLucentPrimitives}getOpaquePrimitives(){return this._opaquePrimitives}set depthTest(t){if(!e.isBoolean(t))throw new Error("'depthTest' option must be a boolean value!");this._depthTest=t,this._materialOpaque.depthTest=t,this._materialTranslucent.depthTest=t,this._dirty=!0;}get depthTest(){return this._depthTest}set allowPick(t){if(!e.isBoolean(t))throw new Error("'allowPick' option must be a boolean value!");this._allowPick=t,this._dirty=!0;}get allowPick(){return this._allowPick}destroy(){return this.removeAll(!0),this._boundingBox=void 0,this._boundingSphere=void 0,this.id=void 0,this._shaderSource.destroy(),this._shaderSource=void 0,this._createVertexArray=void 0,this._pointPrimitives=void 0,this._shaderScaleByDistance=void 0,this._shaderTranslucencyByDistance=void 0,this._shaderDistanceDisplayCondition=void 0,this._maxPixelSize=void 0,this.show=void 0,this.modelMatrix=void 0,this._modelMatrix=void 0,this._maxTotalPointSize=void 0,this._opaquePrimitives=void 0,this._transLucentPrimitives=void 0,this._vertexArray=void 0,this._vertBuffer=void 0,this._opaquePrimitive.destroy(),this._materialOpaque=void 0,this._translucentPrimitive.destroy(),this._materialTranslucent=void 0,this._translucentPrimitive=void 0,this._geometry=void 0,this._dirty=void 0,e.destroyObject(this)}}class fh{constructor(){this.state={},this.stateChanges={},this.deletedStates={};}updateState(t,i,s){const r=String(i);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][r]=this.stateChanges[t][r]||{},e.extend(this.stateChanges[t][r],s),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==r&&(this.deletedStates[t][e]=null);}else if(this.deletedStates[t]&&null===this.deletedStates[t][r]){this.deletedStates[t][r]={};for(const e in this.state[t][r])s[e]||(this.deletedStates[t][r][e]=null);}else for(const e in s)this.deletedStates[t]&&this.deletedStates[t][r]&&null===this.deletedStates[t][r][e]&&delete this.deletedStates[t][r][e];}removeFeatureState(e,t,i){if(null===this.deletedStates[e])return;const s=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},i&&void 0!==t)null!==this.deletedStates[e][s]&&(this.deletedStates[e][s]=this.deletedStates[e][s]||{},this.deletedStates[e][s][i]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][s])for(i in this.deletedStates[e][s]={},this.stateChanges[e][s])this.deletedStates[e][s][i]=null;else this.deletedStates[e][s]=null;else this.deletedStates[e]=null;}getState(t,i){const s=String(i),r=e.extend({},(this.state[t]||{})[s],(this.stateChanges[t]||{})[s]);if(null===this.deletedStates[t])return {};if(this.deletedStates[t]){const e=this.deletedStates[t][i];if(null===e)return {};for(const t in e)delete r[t];}return r}initializeTileState(e,t){e.setFeatureState(this.state,t);}coalesceChanges(t,i){const s={};for(const t in this.stateChanges){this.state[t]=this.state[t]||{};const i={};for(const s in this.stateChanges[t])this.state[t][s]||(this.state[t][s]={}),e.extend(this.state[t][s],this.stateChanges[t][s]),i[s]=this.state[t][s];s[t]=i;}for(const t in this.deletedStates){this.state[t]=this.state[t]||{};const i={};if(null===this.deletedStates[t])for(const e in this.state[t])i[e]={},this.state[t][e]={};else for(const e in this.deletedStates[t]){if(null===this.deletedStates[t][e])this.state[t][e]={};else for(const i of Object.keys(this.deletedStates[t][e]))delete this.state[t][e][i];i[e]=this.state[t][e];}s[t]=s[t]||{},e.extend(s[t],i);}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(s).length)for(const e in t)t[e].setFeatureState(s,i);}}class gh extends e.Material{constructor(t){super(t),this.layer=t.layer,this.tile=t.tile,this._backgroundColor=e.Vector4.fromColor(e.Color.parse(t.painter._map.style.backgroundColor),!1),this._parentTile=t.parentTile,this._renderState=t.renderState,this.textureFilter=e.WebGLConstants.LINEAR,this._lightColor=new e.Vector3(1,1,1),this._lightDirection=new e.Vector3,this._spinWeights=new e.Vector3,this.parentTL=new e.Vector2,this.updateDynamicProperty(),this.createUniforms(),this.emptyTexture=new e.Texture({context:t.painter.context,image:{width:1,height:1,data:null},pixelFormat:e.WebGLConstants.RGBA,useMipmap:!1});}setLayer(e){this.layer=e;}set parentTile(e){e?.tileID.key!=this._parentTile?.tileID.key&&(this._parentTile=e,this.updateDynamicProperty());}update(t,i,s={}){super.update(t,i,s),this.defines={ENCODE_DEPTH_TO_FRAGCOLOR:i.passType===e.RenderPassConsts.PICK_PASS,TEXTURE_UNITS:("loaded"!==this.tile.state?0:this.tile.images.length)+(this.tile.proxyImage?1:0)};}updateDynamicProperty(){this._parentTile?(this.parentScaleBy=Math.pow(2,this._parentTile.tileID.overscaledZ-this.tile.tileID.overscaledZ),this.parentTL.set(this.tile.tileID.canonical.x*this.parentScaleBy%1,this.tile.tileID.canonical.y*this.parentScaleBy%1)):(this.parentScaleBy=1,this.parentTL.set(0,0));}createUniforms(){this._uniforms.set("u_BackgroundColor",(()=>this._backgroundColor)),this._uniforms.set("u_TextureBrightnessMin",(()=>{const e=[];for(let t=0;t<this.tile.images.length;t++)e.push(this.tile.images[t].brightnessMin);return this.tile.proxyImage&&e.push(0),e.length>0?e:[0]})),this._uniforms.set("u_TextureBrightnessMax",(()=>{const e=[];for(let t=0;t<this.tile.images.length;t++)e.push(this.tile.images[t].brightnessMax);return this.tile.proxyImage&&e.push(1),e.length>0?e:[1]})),this._uniforms.set("u_TextureSaturationFactor",(()=>{const e=[];for(let t=0;t<this.tile.images.length;t++)e.push(this.tile.images[t].saturation);return this.tile.proxyImage&&e.push(0),e.length>0?e:[0]})),this._uniforms.set("u_TextureContrastFactor",(()=>{const e=[];for(let t=0;t<this.tile.images.length;t++)e.push(this.tile.images[t].contrast);return this.tile.proxyImage&&e.push(1),e.length>0?e:[1]})),this._uniforms.set("u_TextureSpinWeight",(()=>{const t=[];for(let e=0;e<this.tile.images.length;e++)t.push(this.tile.images[e].spinWeight);return this.tile.proxyImage&&t.push(new e.Vector3(1,0,0)),t.length>0?t:[new e.Vector3(1,0,0)]})),this._uniforms.set("u_TextureAlpha",(()=>{const e=[];for(let t=0;t<this.tile.images.length;t++)e.push(this.tile.images[t].opacity);return this.tile.proxyImage&&e.push(this.tile.proxyImage.opacity),e.length>0?e:[0]})),this._uniforms.set("u_Texture",(()=>{const e=[];for(let t=0;t<this.tile.images.length;t++)e.push(this.tile.images[t].imagery.texture||this.emptyTexture);return this.tile.proxyImage&&e.push(this.tile.proxyImage.imagery.texture),e})),this._uniforms.set("u_TextureTexCoordsRectangle",(()=>{const e=[];for(let t=0;t<this.tile.images.length;t++)e.push(this.tile.images[t].textureCoordinateRectangle);return this.tile.proxyImage&&e.push(this.tile.proxyImage.textureCoordinateRectangle),e})),this._uniforms.set("u_TextureTranslationAndScale",(()=>{const e=[];for(let t=0;t<this.tile.images.length;t++)e.push(this.tile.images[t].textureTranslationAndScale);return this.tile.proxyImage&&e.push(this.tile.proxyImage.textureTranslationAndScale),e})),this._uniforms.set("u_TextureAlphaPremultiplied",(()=>{const e=[];for(let t=0;t<this.tile.images.length;t++)e.push(!1);return this.tile.proxyImage&&e.push(!0),e})),this._uniforms.set("u_BackgroundLayerColor",(()=>this.tile.backgroundLayerColor));}checkLayer(){if(!this.layer)throw new Error("请在rater plotter中针对image source或者video source进行layer的注册，即调用material.setLayer(layer)")}destroy(){this.layer=void 0,this.tile.texture&&(this.tile.texture.destroy(),this.tile.texture=null),this.__texture=null,this.tile=void 0,this.programId=void 0,this.type=void 0,this._uniforms=void 0,this._textures=void 0,this._program=void 0,this._programConfiguration=void 0,this._renderState=void 0,this._parentTile=void 0,this.textureFilter=void 0,this.parentTL=void 0,this.parentScaleBy=void 0;}}class yh extends e.Material{constructor(t){super(t),this.isVectorMaterial=!0,this.layer=t.layer,this.tile=t.tile,this.programId=e.SHADER_HISTOGRAM_COLOR,this._programConfiguration=t.programConfiguration,this._renderState=t.renderState,this.type=this.getProgramType(),this._error=null,this._createUniforms(this);}getProgramType(){return this.programId}update(e,t,i){super.update(e,t,i),this.updateRenderState(i),this._uniforms.set("u_Opacity",(()=>this.layer.paint.get("histogram-opacity")));}destroy(){this.layer=void 0,this.tile=void 0,this.programId=void 0,this.plotter=void 0,this.type=void 0,this._uniforms=void 0,this._textures=void 0,this._program=void 0,this.defines=void 0,this._programConfiguration=void 0,this._renderState=void 0,this._pattern=void 0;}_createUniforms(){e.PhongLightSetter.setPhongLightUniform({material:this,phongLightConfig:this.layer.phongLightConfig});}updateRenderState(t){const{renderStateTag:i,stencilTest:s}=t;"first"===i?this.renderState={depthMask:e.renderStateEnum.enableDepthMask,depthTest:e.renderStateEnum.enableDepthTestWithLEQUAL,stencilMask:e.renderStateEnum.disableStencilMask,stencilTest:e.renderStateEnum.disableStencilTest,colorMask:e.renderStateEnum.disabledColorMask}:"second"===i&&(this.renderState={depthMask:e.renderStateEnum.enableDepthMask,depthTest:e.renderStateEnum.enableDepthTestWithLEQUAL,stencilMask:e.renderStateEnum.enableStencilMask,stencilTest:s,colorMask:e.renderStateEnum.enableColorMask,cull:e.renderStateEnum.disableCull,blending:e.renderStateEnum.enableBlending});}}class Ch extends e.Geometry{constructor(t){super(t),this.params=t,this._usedDoublePrecision=!1,this._vertexArray=this._usedDoublePrecision?new e.StructArrayLayout11f44:new e.StructArrayLayout3f2f3f32,this.parse(t),this.primitiveType=t.primitiveType||e.WebGLConstants.TRIANGLES,this.computeBoundingSphere(),this.computeBoundingBox(),this.type="SphereGeometry";}parse(t){this.needUpdate=!0,super.parse(t);const i=this.params.radius,s=this.params.widthSegments,r=this.params.heightSegments,n=this.params.phiStart,o=this.params.phiLength,a=this.params.thetaStart,l=this.params.thetaLength,h=this.params.ellipse||e.Transforms.DefaultEllipsoid;this._vertexArray=new e.StructArrayLayout3f2f3f32,this._indices=new e.StructArrayLayout3ui6,this.radius=i||1,this.widthSegments=Math.max(3,Math.floor(s)||8),this.heightSegments=Math.max(2,Math.floor(r)||6),this.phiStart=void 0!==n?n:0,this.phiStart*=e.CONSTS.TRANSFORM.RAD_TO_DEG,this.phiLength=void 0!==o?o:2*Math.PI,this.phiLength*=e.CONSTS.TRANSFORM.RAD_TO_DEG,this.thetaStart=void 0!==a?a:0,this.thetaStart*=e.CONSTS.TRANSFORM.RAD_TO_DEG,this.thetaLength=void 0!==l?l:Math.PI,this.thetaLength*=e.CONSTS.TRANSFORM.RAD_TO_DEG;const _=Math.min(this.thetaStart+this.thetaLength,Math.PI);let c,u,d=0;const m=[],p=new e.Vector3,f=new e.Vector3,g=[],y=[],C=[],T=[];for(u=0;u<=this.heightSegments;u++){const t=[],i=u/this.heightSegments;let s=0;for(0==u&&0==this.thetaStart?s=.5/this.widthSegments:u==this.heightSegments&&_==Math.PI&&(s=-.5/this.widthSegments),c=0;c<=this.widthSegments;c++){const r=c/this.widthSegments;if(this.radius===e.CONSTS.TRANSFORM.R){const t=h.cartographicToCartesian(new e.Vector3(this.phiStart+r*this.phiLength,90-(this.thetaStart+i*this.thetaLength),0));y.push(t[0],t[1],t[2]);}else {const t=h.cartographicToCartesian(new e.Vector3(this.phiStart+r*this.phiLength,90-(this.thetaStart+i*this.thetaLength),this.radius)),s=h.cartographicToCartesian(new e.Vector3(this.phiStart+r*this.phiLength,90-(this.thetaStart+i*this.thetaLength),0));y.push(t[0]-s[0],t[1]-s[1],t[2]-s[2]);}f.copy(p).normalize(),C.push(f.x,f.y,f.z),T.push(r+s+.5,i),t.push(d++);}m.push(t);}for(u=0;u<this.heightSegments;u++)for(c=0;c<this.widthSegments;c++){const e=m[u][c],t=m[u+1][c],i=m[u+1][c+1];(0!==u||this.thetaStart>0)&&g.push(m[u][c+1],e,i),(u!==this.heightSegments-1||_<Math.PI)&&g.push(e,t,i);}this.vertices=y,this.normals=C,this.uvs=T,this.indices=g,this.normals=e.PolygonGeometryLibrary.computeNormal(y,g),this.emplaceVertexBufferTriangle();for(let e=0;e<this.indices.length;e+=3)this._indices.emplaceBack(this.indices[e],this.indices[e+1],this.indices[e+2]);}update(t){if(this.needUpdate){this.needUpdate=!1;const i=t.painter.context;this._vertBuffer=i.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?e.layout.members:e.layout$1.members,!1),this._indexBuffer=i.createIndexBuffer(this._indices,!1),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/3),this.vertices=[],this.normals=[],this.uvs=[],this.indices=[],this._indices=null,this._vertexArray=null;}}serialize(){return {type:this.type,radius:this.radius,widthSegments:this.widthSegments,heightSegments:this.heightSegments,phiStart:this.phiStart/e.CONSTS.TRANSFORM.RAD_TO_DEG,phiLength:this.phiLength/e.CONSTS.TRANSFORM.RAD_TO_DEG,thetaStart:this.thetaStart/e.CONSTS.TRANSFORM.RAD_TO_DEG,thetaLength:this.thetaLength/e.CONSTS.TRANSFORM.RAD_TO_DEG}}destroy(){super.destroy(),this.type=void 0;}}function Th(t){const{bucket:i,tileBoundingRegion:s,isRegularVector:r}=t;return r?[new e.Geometry({vertBuffer:i.layoutVertexBuffer,indexBuffer:i.indexBuffer,segmentVector:i.segments,primitiveType:e.WebGLConstants.TRIANGLES,tileBoundingRegion:s}),new e.Geometry({primitiveType:e.WebGLConstants.LINES,vertBuffer:i.layoutVertexBuffer2,segmentVector:i.segments2,tileBoundingRegion:s})]:[new e.Geometry({vertBuffer:i.layoutVertexBuffer,indexBuffer:i.indexBuffer,segmentVector:i.segments,primitiveType:e.WebGLConstants.TRIANGLES,tileBoundingRegion:s})]}function xh(t){const{bucket:i,tileBoundingRegion:s,isRegularVector:r}=t;if(r){const t=new e.Geometry({vertBuffer:i.layoutVertexBuffer,indexBuffer:i.indexBuffer,segmentVector:i.segments,dynamicLayoutBuffer1:i.layoutVertexBuffer2||void 0,primitiveType:e.WebGLConstants.TRIANGLES,tileBoundingRegion:s});return i._animationFlag&&(t.animationVertexBuffers=i.animationVertexBuffers),t}return new e.Geometry({vertBuffer:i.layoutVertexBuffer,indexBuffer:i.indexBuffer,segmentVector:i.segments,primitiveType:e.WebGLConstants.TRIANGLES,tileBoundingRegion:s})}function bh(t){const{buffers:i,symbolType:s,tileBoundingRegion:r,pickColorVertexBuffer:n}=t;let o;return "icon"===s||"text"===s?o=new e.Geometry({vertBuffer:i.layoutVertexBuffer,indexBuffer:i.indexBuffer,segmentVector:i.segments,dynamicLayoutBuffer1:i.dynamicLayoutVertexBuffer,dynamicLayoutBuffer2:i.opacityVertexBuffer,dynamicLayoutBuffer3:n,primitiveType:e.WebGLConstants.TRIANGLES,tileBoundingRegion:r}):"debug"==s&&(o=new e.Geometry({vertBuffer:i.layoutVertexBuffer,indexBuffer:i.indexBuffer,segmentVector:i.segments,dynamicLayoutBuffer1:i.collisionVertexBuffer,primitiveType:e.WebGLConstants.TRIANGLES,tileBoundingRegion:r})),o}class vh extends e.Material{constructor(t){super(t),this.layer=t.layer,this.tile=t.tile,this.coord=t.tile.tileID,this.programId=t.programId,this.drawFill=t.drawFill,this._renderState=t.renderState,this._isShadowVolumeMaterial=t.shadowVolumeMaterial||!1,this.type=this.getProgramType(),this._uniforms.set("u_World",(()=>{const i=t.painter.context.gl;return new e.Vector2(i.drawingBufferWidth,i.drawingBufferHeight)})),this._uniforms.set("u_Opacity",(()=>{const e=this.layer.paint.get("fill-opacity").value.value;return void 0===e?1:e})),this._uniforms.set("u_translate",(()=>{const t=this.layer.paint.get("fill-translate");return t.value?.value?new e.Vector2(t.value.value):new e.Vector2(0,0)})),this._uniforms.set("u_translate_anchor",(()=>{const e=this.layer.paint.get("fill-translate-anchor");return "viewport"==e.value?.value?1:0}));}update(t,i,s={}){super.update(t,i,s),this._renderState.depthTest=e.renderStateEnum.disableDepthTest,this._renderState.cull=e.renderStateEnum.disableCull,this._renderState.stencilTest=e.renderStateEnum.disableStencilTest;}getProgramType(){if(this._isWater)return "WaterMaterial";let e=this.programId;return this.pattern&&(e=`${this.programId}Pattern`),e}destroy(){this.layer=void 0,this.tile=void 0,this.coord=void 0,this.programId=void 0,this.drawFill=void 0,this.type=void 0,this._uniforms=void 0,this._textures=void 0,this._program=void 0,this._programConfiguration=void 0,this._renderState=void 0;}}class wh extends e.Material{constructor(e){super(e),this.isVectorMaterial=!0,this.type=e.type,this.layer=e.layer,this.tile=e.tile,this._renderState=e.renderState,this._defines=e.defines,this._programConfiguration=e.programConfiguration,this.animationsInfo=e.animationsInfo||{},this._createUniforms(e.painter);}update(e,t,i={}){super.update(e,t,i),this._updateAnimationUniforms(i);}_createUniforms(t){this.animationsInfo.enabled&&this._createAnimationUniforms(this),this._uniforms.set("u_PixelMatrix",(()=>{const i=new e.Matrix2;return i.scale([1,Math.cos(t.transform.hpr.pitch)]),i.rotate(-t.transform.hpr.heading),i})),this._uniforms.set("u_Ratio",(()=>1/e.pixelsToTileUnits(this.tile,1,t.style.getNearestTileZoom()))),this._uniforms.set("u_GlUnitsToPixels",(()=>new e.Vector2(t.style.symbolMatrixHelper.width/2,-t.style.symbolMatrixHelper.height/2))),this._uniforms.set("u_start",(()=>("history"===this.layer.paint.get("tracking-type")?this.layer.histCount:this.layer.count)-this.layer.paint.get("tracking-seg-group"))),this._uniforms.set("u_end",(()=>"history"===this.layer.paint.get("tracking-type")?this.layer.histCount:this.layer.count)),this._uniforms.set("u_segments",(()=>this.layer.paint.get("tracking-seg-group"))),this._uniforms.set("u_reverse",(()=>this.layer.isReverse)),this._uniforms.set("u_reserve",(()=>this.layer.isReserve));}destroy(){this.layer=void 0,this.tile=void 0,this._renderState=void 0,this._defines=void 0,this.type=void 0;}static updateLayerProperty(e,t){const i=e.paint.get("tracking-delay"),s=e.paint.get("tracking-speed")?e.paint.get("tracking-speed"):1;if("history"===e.paint.get("tracking-type")){e.first||(e.first=!0,e.histStart=0,e.histCount=0,e.isReverse=!1,e.isReserve=!1);const i=t._map.timer.totalTime*s;"loop"===e.layout.get("tracking-display-mode")?(e.histCount=i,e.histCount%=e.paint.get("tracking-seg-count"),e.histCount=0===e.histCount?1:e.histCount):"reverse"===e.layout.get("tracking-display-mode")?(e.histCount>=e.paint.get("tracking-seg-count")+e.paint.get("tracking-seg-group")?e.isReverse=!0:e.histCount<=1&&(e.isReverse=!1),e.histCount=e.isReverse?e.histCount-1:e.histCount+1):"loop-reserve"===e.layout.get("tracking-display-mode")?(e.isReserve=!0,e.histCount=i,e.histCount%=e.paint.get("tracking-seg-count"),e.histCount=0===e.histCount?1:e.histCount):"reverse-reserve"===e.layout.get("tracking-display-mode")&&(e.isReserve=!0,e.histCount>=e.paint.get("tracking-seg-count")+e.paint.get("tracking-seg-group")?e.isReverse=!0:e.histCount<=1&&(e.isReverse=!1),e.histCount=e.isReverse?e.histCount-1:e.histCount+1),st.TRW&&st.TRW.setProgress(e.histCount),e.histStart=e.histEnd;}else {e.count||(e.count=1);const r=t._map.timer.totalTime*s,n=st.TRW,o=e.paint.get("tracking-run-time");e.count=r;const a=n&&n.hasOwnProperty("replaceOffset")?n.replaceOffset:o+i;e.count%=a;const l=n&&n.hasOwnProperty("requestOffset")?n.requestOffset:i;e.count===l&&n&&n.request(),0===e.count&&(n&&n.replace(),e.count=i),n&&(n.currentSeq=e.count);}wh.checkFrwardAndBackward(e,st);}static checkFrwardAndBackward(e,t){if(t&&t.TRW&&"null"!==t.TRW){t.TRW.layerForwards||(t.TRW.layerForwards=[]);for(let i=0;i<t.TRW.layerForwards.length;i++){const s=t.TRW.layerForwards[i];if(s.id===e.id){e.count&&(e.count+=s.count),t.TRW.layerForwards.splice(i,1);break}}}}_createAnimationUniforms(){this._uniforms.set("u_ANS_CurrentTime",(()=>this.animationsInfo.currentClipTime));}_updateAnimationUniforms(e){const{animationsInfo:t={}}=e;this._uniforms.set("u_ANS_CurrentTime",(()=>t.currentClipTime));}}class Sh extends e.Material{constructor(t){super(t),this.isVectorMaterial=!0,this.layer=t.layer,this.tile=t.tile,this._programConfiguration=t.programConfiguration,this._renderState=t.renderState,this._unitsToPixels=new e.Vector2,this._cameraPosition=new e.Vector3,this._pixelMatrix=new e.Matrix2,this._createUniforms(t.painter);}update(t,i,s={}){super.update(t,i,s),this.renderState.blending={enabled:!0,color:{red:0,green:0,blue:0,alpha:0},equationRgb:e.WebGLConstants.FUNC_ADD,equationAlpha:e.WebGLConstants.FUNC_ADD,functionSourceRgb:e.WebGLConstants.ONE,functionSourceAlpha:e.WebGLConstants.ONE,functionDestinationRgb:e.WebGLConstants.ONE,functionDestinationAlpha:e.WebGLConstants.ONE};}_createUniforms(e){this._uniforms.set("u_GlUnitsToPixels",(()=>this._unitsToPixels.set(e.style.symbolMatrixHelper.width/2,e.style.symbolMatrixHelper.height/2))),this._uniforms.set("u_PixelMatrix",(()=>(this._pixelMatrix.identity(),this._pixelMatrix.scale([1,Math.cos(Math.sqrt(e.transform.hpr.pitch))]),this._pixelMatrix.rotate(e.transform.hpr.heading),this._pixelMatrix))),this._uniforms.set("u_Intensity",(()=>this.layer.paint.get("heatmap-intensity")));}destroy(){this.layer=void 0,this.tile=void 0,this.pattern=void 0,this.type=void 0,this._uniforms=void 0,this._textures=void 0,this._program=void 0,this._programConfiguration=void 0,this._renderState=void 0,this._unitsToPixels=void 0,this._cameraPosition=void 0,this._pixelMatrix=void 0;}}function Ah(t){const{layer:i,painter:s,tile:r,programConfiguration:n,isRegularVector:o}=t;return o?[new e.VectorFillMaterial({layer:i,painter:s,tile:r,programId:e.SHADER_FILL_COLOR,plotter:this,renderState:{},programConfiguration:n,defines:{}}),new vh({layer:i,painter:s,tile:r,programId:e.SHADER_FILL_OUTLINE_COLOR,renderState:{},programConfiguration:n,defines:{}})]:[new e.VectorFillMaterial({layer:i,painter:s,tile:r,programId:e.SHADER_FILL_COLOR,renderState:{},programConfiguration:n,defines:{},shadowVolumeMaterial:!0})]}function Eh(t){const{layer:i,painter:s,tile:r,bucket:n,programConfiguration:o,isRegularVector:a,sourceMaxZoom:l,animationsInfo:h}=t,_={},c={},u="visible"===i.layout.get("border-visibility"),d=i.paint.get("line-gradient");let m;if(i.type==e.VectorLayerType.LINE?m=i.paint.get("line-dasharray")?e.SHADER_LINE_SDF:function(e){if(e.paint.get("line-pattern")){if(e.paint.get("line-pattern").constantOr(null))return !0;if(!e.paint.get("line-pattern").isConstant())return !0}return !1}(i)?e.SHADER_LINE_PATTERN:i.paint.get("line-gradient")?e.SHADER_LINE_GRADIENT:e.SHADER_LINE_COLOR:i.type==e.VectorLayerType.TRACKING?(wh.updateLayerProperty(i,s),m=e.SHADER_LINE_TRACKING_COLOR):i.type==e.VectorLayerType.SPRITE&&(e.SpriteMaterial.updateLayerProperty(i,s),m=n.hasPattern?e.SHADER_LINE_SPRITE_PATTERN:e.SHADER_LINE_SPRITE_COLOR),a){let t;return t="tracking"===i.type?new wh({type:m,layer:i,painter:s,tile:r,renderState:_,defines:c,programConfiguration:o,animationsInfo:h}):"sprite"===i.type?new e.SpriteMaterial({type:m,layer:i,painter:s,tile:r,renderState:_,defines:c,programConfiguration:o}):new e.VectorLineMaterial({layer:i,painter:s,tile:r,isBorder:u,sourceMaxZoom:l,bucket:n,lineGradient:d,type:m,programConfiguration:o,defines:c,renderState:_}),t}return new e.VectorLineMaterial({layer:i,painter:s,tile:r,isBorder:u,sourceMaxZoom:l,bucket:n,lineGradient:d,type:m,programConfiguration:o,defines:c,renderState:_,shadowVolumeMaterial:!0})}function Mh(t){const{layer:i,painter:s,tile:r,programConfiguration:n,isText:o,isSDF:a,sizeData:l,bucket:h}=t,_=o?h.textHaloWidth:h.iconHaloWidth;let c;return c=i.type===e.VectorLayerType.SYMTRACKING?a?e.SHADER_SYMTRACKING_SDF:e.SHADER_SYMTRACKING_ICON:a?e.SHADER_SYMBOL_SDF:e.SHADER_SYMBOL_ICON,r.tileID.posMatrix=s.style.symbolMatrixHelper.calculatePosMatrix(r.tileID.toUnwrapped()),new e.SymbolMaterial({layer:i,painter:s,tile:r,programConfiguration:n,renderState:{},isText:o,isSDF:a,sizeData:l,bucket:h,type:c,hasHalo:_,modeNum:0})}function Ph(t){const{layer:i,painter:s,tile:r,bucket:n,tileBoundingRegion:o}=t,a=!e.checkIsVectorShadowVolumeDataType(i.classificationType),l=n.programConfigurations.get(i.id),h=Th({bucket:n,tileBoundingRegion:o,isRegularVector:a}),_=Ah({layer:i,painter:s,tile:r,programConfiguration:l,isRegularVector:a}),c=n.matrix;return {fill:new e.Primitive({modelMatrix:c,geometry:h[0],material:_[0]}),outline:h[1]?new e.Primitive({modelMatrix:c,geometry:h[1],material:_[1]}):void 0}}function Rh(t){const{layer:i,painter:s,tile:r,bucket:n,tileBoundingRegion:o,sourceMaxZoom:a,animationsInfo:l}=t,h=!e.checkIsVectorShadowVolumeDataType(i.classificationType),_=n.programConfigurations.get(i.id),c=n.matrix,u=Eh({layer:i,painter:s,tile:r,bucket:n,programConfiguration:_,isRegularVector:h,sourceMaxZoom:a,animationsInfo:l}),d=xh({bucket:n,tileBoundingRegion:o,isRegularVector:h});return {line:new e.Primitive({modelMatrix:c,geometry:d,material:u})}}function Bh(t){const{layer:i,painter:s,tile:r,type:n,defines:o,bucket:a,tileBoundingRegion:l}=t,h=a.programConfigurations.get(i.id),_=new e.VectorCircleMaterial({layer:i,painter:s,tile:r,type:n,programConfiguration:h,renderState:{},defines:o}),c=function(t){const{bucket:i,tileBoundingRegion:s}=t;return new e.Geometry({vertBuffer:i.layoutVertexBuffer,indexBuffer:i.indexBuffer,segmentVector:i.segments,dynamicLayoutBuffer1:i.layoutVertexBuffer2||void 0,primitiveType:e.WebGLConstants.TRIANGLES,tileBoundingRegion:s})}({bucket:a,tileBoundingRegion:l});return new e.Primitive({modelMatrix:a.matrix,geometry:c,material:_})}function Ih(t){const{layer:i,painter:s,tile:r,defines:n,bucket:o,tileBoundingRegion:a,animationsInfo:l}=t;let h=null;const _={},c=o.programConfigurations.get(i.id);switch(i.type){case"extrusion":h=new e.VectorExtrusionMaterial({layer:i,painter:s,tile:r,bucket:o,programConfiguration:c,defines:n,renderState:_,animationsInfo:l});break;case"histogram":h=new yh({layer:i,painter:s,tile:r,bucket:o,programConfiguration:c,defines:n,renderState:_});}const u=function(t){const{bucket:i,tileBoundingRegion:s}=t;return e.Geometry.fromBucket(i,e.WebGLConstants.TRIANGLES,s)}({bucket:o,tileBoundingRegion:a});return new e.Primitive({modelMatrix:o.matrix,geometry:u,material:h})}function Dh(t){const{layer:i,painter:s,tile:r,bucket:n,tileBoundingRegion:o}=t,a=n.matrix,l=function(t){const{layer:i,painter:s,tile:r,programConfiguration:n}=t;return new Sh({layer:i,painter:s,tile:r,type:e.SHADER_HEATMAP_COLOR,renderState:{},programConfiguration:n,defines:{}})}({layer:i,painter:s,tile:r,programConfiguration:n.programConfigurations.get(i.id)}),h=function(t){const{bucket:i,tileBoundingRegion:s}=t;return new e.Geometry({vertBuffer:i.layoutVertexBuffer,indexBuffer:i.indexBuffer,segmentVector:i.segments,dynamicLayoutBuffer1:i.layoutVertexBuffer2||void 0,primitiveType:e.WebGLConstants.TRIANGLES,tileBoundingRegion:s})}({bucket:n,tileBoundingRegion:o});return new e.Primitive({modelMatrix:a,geometry:h,material:l})}function Oh(t){const{layer:i,painter:s,tile:r,bucket:n,tileBoundingRegion:o}=t,a={},l=[{name:"icon",readyToCreate:0!==i.paint.get("icon-opacity").constantOr(1)},{name:"text",readyToCreate:0!==i.paint.get("text-opacity").constantOr(1)}];let h,_;if(r.symbolPickIdObject[i.id])for(const e of r.symbolPickIdObject[i.id])e.destroy();r.symbolPickIdObject[i.id]=[];for(let t=0;t<2;t++){const c=l[t];if(!c.readyToCreate)continue;const u=c.name,d="text"==u,m=d?n.text:n.icon;if(!m||!m.segments.get().length)continue;const p=d?n.textSizeData:n.iconSizeData,f=n.matrix,g=Mh({symbolType:u,layer:i,painter:s,tile:r,isText:d,isSDF:d||n.sdfIcons,programConfiguration:m.programConfigurations.get(i.id),sizeData:p,bucket:n});if(n.pickColor&&!h&&!_){const t=new e.StructArrayLayout4f16,o=new e.StructArrayLayout4f16;for(const e of n.symbolInstances){const a=Lh(n,r,e.featureIndex,i);a.isSymbolData=!0;const l=s.context.createPickId(a);r.symbolPickIdObject[i.id].push(l);const h=e.numIconVertices>0;if(e.numGlyphVertices>0||e.numVerticalGlyphVertices>0)for(let i=0;i<e.numGlyphVertices+e.numVerticalGlyphVertices;i++)t.emplaceBack(l.color.r,l.color.g,l.color.b,l.color.a);if(h)for(let t=0;t<e.numIconVertices;t++)o.emplaceBack(l.color.r,l.color.g,l.color.b,l.color.a);}h=s.context.createVertexBuffer(t,e.pickColorAttributes.members,!0),_=s.context.createVertexBuffer(o,e.pickColorAttributes.members,!0);}const y=bh({buffers:m,symbolType:u,tileBoundingRegion:o,bucket:n,pickColorVertexBuffer:d?h:_}),C=new e.Primitive({modelMatrix:f,geometry:y,material:g,allowPick:n.pickColor});a[u]=C;}return a}function Lh(e,t,i,s){return {evaluate:()=>{const r=s.id;return t.latestFeatureIndex.lookupSymbolFeatures([i],e.index,e.sourceLayerIndex,null,[r],{[r]:s})[r][0].feature}}}class Vh{constructor(t){const{tileID:i,tileSize:s,projType:r,tilePrimitiveType:n,sourceId:o,style:a}=t;this.symbolPickIdObject={},this.tileID=i,this.uid=e.uniqueId(),this.uses=0,this.tileSize=s,this.buckets={},this.primitiveMap=new Map,this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.sourceId=o,this.style=a,this.dependencies={},this.expiredRequestCount=0,this.state="loading",this.projType=r||e.ProjectionType.MERCATOR,this.tilePrimitiveType=n;}registerFadeDuration(t){const i=t+this.timeAdded;i<e.exported.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i);}wasRequested(){return "errored"===this.state||"loaded"===this.state||"reloading"===this.state}loadVectorData(t,i,s){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){if(t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(e,t){const i={};if(!t)return i;for(const s of e){const e=s.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){s.layers=e,s.stateDependentLayers=e.filter((e=>e.isStateDependent()));for(const t of e)i[t.id]=s;}}return i}(t.buckets,i.style),s)for(const t in this.buckets){const i=this.buckets[t];i.type!=e.VectorLayerType.SYMTRACKING&&i.type!=e.VectorLayerType.SYMBOL||(i.justReloaded=!0);}this.hasSymbolBuckets=!1;for(const t in this.buckets){const i=this.buckets[t];if(i.type==e.VectorLayerType.SYMBOL){if(this.hasSymbolBuckets=!0,!s)break;i.justReloaded=!0;}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const i=this.buckets[t];if(i.type==e.VectorLayerType.SYMBOL&&i.hasRTLText){this.hasRTLText=!0,e.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const e in this.buckets){const t=this.buckets[e];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(t.layerIds[0]).queryRadius(t));}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage);}else this.collisionBoxArray=new e.CollisionBoxArray;}_releaseTileSupplierMesh(){}unloadVectorData(){this.primitiveMap.forEach((t=>{const i=t;if(i instanceof e.Primitive)this._releaseTileSupplierMesh(i),i.destroy();else if(Array.isArray(i))for(let e=0;e<i.length;e++)this._releaseTileSupplierMesh(i[e]),i[e].destroy();else for(const t in i){const s=i[t];if(s instanceof e.Primitive)this._releaseTileSupplierMesh(s),s.destroy();else if(Array.isArray(s))for(let e=0;e<s.length;e++)this._releaseTileSupplierMesh(s[e]),s[e].destroy();}})),this.primitiveMap.clear();for(const e in this.buckets){const t=this.buckets[e];if(this.symbolPickIdObject[e])for(const t of this.symbolPickIdObject[e])t.destroy();this.symbolPickIdObject[e]=[],t.destroy();}this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),this.imageAtlasTexture=null),this.glyphAtlasImage&&(this.glyphAtlasImage=null),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),this.glyphAtlasTexture=null),this.latestFeatureIndex=null,this.state="unloaded";}loadImage(t){const{painter:i,callback:s,url:r}=t;let n=t.data;const o=i.context;if(n.img)if(e.window.hasOwnProperty("createImageBitmap")){let i=e.window.createImageBitmap(n.img);i.then((r=>{const a=o.gl;this.texture=new e.Texture({context:o,image:r,pixelFormat:e.WebGLConstants.RGBA,useMipmap:!1}),this.texture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),o.extTextureFilterAnisotropic&&(a.bindTexture(this.texture._target,this.texture.texture),a.texParameterf(e.WebGLConstants.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.ContextLimits._maximumTextureFilterAnisotropy),a.bindTexture(this.texture._target,null)),n.img=null,n=null,r=null,this.state="loaded",t.url=null,t.painter=null,t=null,s(null),i=null;}));}else this.texture=new e.Texture({context:o,image:n.img,pixelFormat:e.WebGLConstants.RGBA,useMipmap:!1}),this.texture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),n.img=null,n=null,t.url=null,t.painter=null,t=null,this.state="loaded";else e.getImage({url:r},((t,i)=>{if(t)throw new Error(t);this.texture=new e.Texture({context:o,image:i,pixelFormat:e.WebGLConstants.RGBA,useMipmap:!1}),this.texture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),i=null,this.state="loaded",s(null);}));this._createOrCheckPrimitives();}checkCurrentSourceOfLayer(e){return e.source==this.sourceId}changeTexture(e){this.replacedTexture=e;}removeTexture(){this.images=void 0,this.replacedTexture=void 0;}_createOrCheckPrimitives(){const t=this.style,i=t._layers,s=t.rasterSourceCache.quadtree.getBoundingRegionById(this.tileID.key);for(const r in i){const n=i[r];if(!this.checkCurrentSourceOfLayer(n))continue;if(this.primitiveMap.has(r))continue;const o=this.getBucket(n);if(e.defined(o))if(n.type==e.VectorLayerType.CIRCLE)this.primitiveMap.set(r,Bh({layer:n,painter:t.map.painter,tile:this,type:e.SHADER_CIRCLE,bucket:o,tileBoundingRegion:s}));else if(n.type==e.VectorLayerType.EXTRUSION||n.type==e.VectorLayerType.HISTOGRAM)this.primitiveMap.set(r,Ih({layer:n,painter:t.map.painter,tile:this,bucket:o,tileBoundingRegion:s,animationsInfo:t.getSource(n.source).animationsInfo}));else if(n.type==e.VectorLayerType.FILL)this.primitiveMap.set(r,Ph({layer:n,painter:t.map.painter,tile:this,bucket:o,tileBoundingRegion:s}));else if(n.type==e.VectorLayerType.TRACKING||n.type==e.VectorLayerType.SPRITE||n.type==e.VectorLayerType.LINE){const e=t.getSource(n.source);this.primitiveMap.set(r,Rh({layer:n,painter:t.map.painter,tile:this,bucket:o,tileBoundingRegion:s,sourceMaxZoom:e.maxzoom,animationsInfo:e.animationsInfo}));}else n.type==e.VectorLayerType.SYMBOL||n.type==e.VectorLayerType.SYMTRACKING?this.primitiveMap.set(r,Oh({layer:n,painter:t.map.painter,tile:this,bucket:o,tileBoundingRegion:s})):n.type==e.VectorLayerType.HEATMAP&&this.primitiveMap.set(r,Dh({layer:n,painter:t.map.painter,tile:this,bucket:o,tileBoundingRegion:s}));}}getBucket(e){return this.buckets[e.id]}upload(t){for(const e in this.buckets){const i=this.buckets[e];i.uploadPending()&&i.upload(t);}this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new e.Texture({context:t,image:this.imageAtlas.image,pixelFormat:e.WebGLConstants.RGBA}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new e.Texture({context:t,image:this.glyphAtlasImage,pixelFormat:e.WebGLConstants.ALPHA}),this.glyphAtlasImage=null),"raster"!==this.tilePrimitiveType&&this._createOrCheckPrimitives();}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture);}queryRenderedFeatures(e,t,i,s,r,n,o,a,l,h){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:i,cameraQueryGeometry:s,scale:r,tileSize:this.tileSize,posMatrix:l,symbolMatrixHelper:o,params:n,queryPadding:this.queryPadding*a},e,t,h):{}}querySourceFeatures(t,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const s=this.latestFeatureIndex.loadVTLayers(),r=s._geojsonTileLayer||s[i?i.sourceLayer:""];if(!r)return;const n=e.createFilter(i&&i.filter),o={z:this.tileID.overscaledZ,x:this.tileID.canonical.x,y:this.tileID.canonical.y};for(let i=0;i<r.length;i++){const s=r.feature(i);if(n(new e.EvaluationParameters(this.tileID.overscaledZ),s)){const i=new e.Feature(s,o.z,o.x,o.y);i.tile=o,t.push(i);}}}clearMask(){}setMask(e){t(this.mask,e)||(this.mask=e,this.clearMask());}_xToLng(t,i,s){return t.xLng(this.tileID.canonical.x+i/e.EXTENT,s)}_yToLat(t,i,s){return t.yLat(this.tileID.canonical.y+i/e.EXTENT,s)}hasData(){if("loading"===this.state&&"raster"===this.tilePrimitiveType){for(const e of this.imagery){if("loading"==e.imagery.state)return !1;if("loaded"===e.imagery.state)return this.state="loaded",this._createOrCheckPrimitives(),!0}return this.state="errored",this._createOrCheckPrimitives(),!1}return "background"==this.tilePrimitiveType?this.primitiveMap.size>0&&("loaded"===this.state||"reloading"===this.state||"expired"===this.state):"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const i=this.expirationTime;if(t.cacheControl){const i=e.parseCacheControl(t.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"]);}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const t=Date.now();let s=!1;if(this.expirationTime>t)s=!1;else if(i)if(this.expirationTime<i)s=!0;else {const r=this.expirationTime-i;r?this.expirationTime=t+Math.max(r,e.CONSTS.SOURCE.CLOCK_SKEW_RETRY_TIMEOUT):s=!0;}else s=!0;s?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0;}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length)return;const i=this.latestFeatureIndex.loadVTLayers();for(const s in this.buckets){const r=this.buckets[s],n=r.layers[0].sourceLayer||"_geojsonTileLayer",o=i[n],a=e[n];o&&a&&0!==Object.keys(a).length&&(r.update(a,o,this.imageAtlas&&this.imageAtlas.patternPositions||{}),t&&t.style&&(this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(r.layerIds[0]).queryRadius(r))));}}setDependencies(e,t){const i={};for(const e of t)i[e]=!0;this.dependencies[e]=i;}hasDependency(e,t){for(const i of e){const e=this.dependencies[i];if(e)for(const i of t)if(e[i])return !0}return !1}destroy(){this.unloadVectorData();}}class Nh{constructor(e,t){this.max=e,this.onRemove=t,this.reset();}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,i){const s=e.wrapped().key;void 0===this.data[s]&&(this.data[s]=[]);const r={value:t,timeout:void 0};if(void 0!==i&&(r.timeout=setTimeout((()=>{this.remove(e,r);}),i)),this.data[s].push(r),this.order.push(s),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e);}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}getByKey(e){const t=this.data[e];return t?t[0].value:null}remove(e,t){if(!this.has(e))return this;const i=e.wrapped().key,s=void 0===t?0:this.data[i].indexOf(t),r=this.data[i][s];return this.data[i].splice(s,1),r.timeout&&clearTimeout(r.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(r.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e);}return this}filter(e){const t=[];for(const i in this.data)for(const s of this.data[i])e(s.value)||t.push(s);for(const e of t)this.remove(e.value.tileID,e);}}const Fh={NONE:0,CULLED:1,RENDERED:2,REFINED:3,RENDERED_AND_KICKED:6,REFINED_AND_KICKED:7,CULLED_BUT_NEEDED:9,wasKicked:e=>e>=Fh.RENDERED_AND_KICKED,originalResult:e=>3&e,kick:e=>4|e},Gh=new Map([["0_0_0",[1,1]],["1_0_0",[1,1]],["1_0_1",[1,1]],["1_1_1",[1,1]],["1_1_0",[1,1]],["2_0_0",[1,1]],["2_1_0",[1,1]],["2_0_2",[1,1]],["2_3_3",[1,1]],["2_0_3",[1,1]],["2_2_3",[1,1]],["2_3_0",[1,1]],["2_1_1",[1,1]],["2_2_2",[1,1]],["2_2_0",[1,1]],["2_2_1",[1,1]],["2_0_1",[1,1]],["2_1_3",[1,1]],["2_3_2",[1,1]],["2_1_2",[1,1]],["2_3_1",[1,1]],["3_0_4",[0,1526]],["3_1_4",[0,980]],["3_3_0",[0,8760]],["3_2_4",[0,5808]],["3_6_0",[0,913]],["3_5_4",[0,2336]],["3_2_0",[0,8757]],["3_0_0",[0,0]],["3_7_4",[-24,4044]],["3_6_4",[0,2467]],["3_1_0",[0,1906]],["3_7_5",[0,2193]],["3_2_1",[0,12397]],["3_6_1",[0,1901]],["3_4_0",[0,1308]],["3_0_1",[0,2228]],["3_5_5",[0,2709]],["3_7_6",[0,5526]],["3_3_4",[0,2078]],["3_2_2",[0,3867]],["3_4_4",[0,4218]],["3_3_1",[0,12265]],["3_0_5",[0,0]],["3_6_2",[0,4062]],["3_0_2",[0,5260]],["3_3_2",[0,4232]],["3_4_1",[0,1584]],["3_2_5",[0,2716]],["3_2_3",[-37,4510]],["3_1_1",[0,1590]],["3_6_5",[0,2297]],["3_4_5",[0,705]],["3_6_3",[-21,6345]],["3_3_3",[0,3235]],["3_5_0",[0,550]],["3_0_3",[0,3760]],["3_1_5",[0,0]],["3_7_7",[0,5133]],["3_0_6",[0,11575]],["3_4_2",[-4,4140]],["3_7_0",[0,0]],["3_2_6",[-18,10247]],["3_5_1",[0,1008]],["3_6_6",[0,14038]],["3_5_2",[-203,5434]],["3_3_5",[0,1688]],["3_2_7",[-143,11795]],["3_5_3",[-33,6516]],["3_7_1",[0,2022]],["3_4_6",[0,13614]],["3_0_7",[-271,10711]],["3_1_6",[0,12115]],["3_3_6",[0,12954]],["3_6_7",[0,13726]],["3_4_3",[-427,4065]],["3_3_7",[-150,12292]],["3_1_7",[-178,12360]],["3_4_7",[0,13461]],["3_1_2",[0,3647]],["3_1_3",[-81,4039]],["3_5_6",[0,13574]],["3_5_7",[-4,13778]],["3_7_2",[0,3509]],["3_7_3",[0,2378]],["4_10_0",[0,0]],["4_0_0",[0,0]],["4_11_0",[0,0]],["4_5_0",[0,1184]],["4_12_0",[0,0]],["4_4_0",[0,1606]],["4_0_1",[0,0]],["4_11_1",[0,132]],["4_2_0",[0,0]],["4_3_0",[0,0]],["4_11_2",[0,839]],["4_15_0",[0,0]],["4_0_2",[0,0]],["4_9_0",[0,0]],["4_12_1",[0,939]],["4_4_1",[0,2404]],["4_12_2",[0,1055]],["4_8_0",[0,0]],["4_9_1",[0,922]],["4_6_0",[0,1658]],["4_12_3",[0,1586]],["4_7_0",[0,804]],["4_1_0",[0,0]],["4_0_3",[0,1290]],["4_8_1",[0,1378]],["4_0_4",[0,1993]],["4_15_1",[0,0]],["4_8_2",[0,1580]],["4_3_1",[0,1946]],["4_10_1",[0,614]],["4_13_0",[0,0]],["4_3_2",[0,1660]],["4_12_4",[29,2179]],["4_10_2",[0,1154]],["4_1_1",[0,0]],["4_10_3",[0,1132]],["4_14_0",[0,0]],["4_10_4",[3,1455]],["4_10_5",[-137,3745]],["4_3_3",[0,596]],["4_13_1",[0,0]],["4_14_1",[0,0]],["4_8_3",[0,1764]],["4_3_4",[0,848]],["4_9_2",[0,505]],["4_8_4",[0,2167]],["4_9_3",[0,1034]],["4_9_4",[0,455]],["4_0_5",[0,2063]],["4_3_5",[90,3752]],["4_1_2",[0,0]],["4_9_5",[-8,4825]],["4_15_2",[0,0]],["4_13_2",[0,384]],["4_1_3",[0,2397]],["4_15_3",[0,1601]],["4_0_6",[0,1254]],["4_6_1",[-44,11625]],["4_15_4",[0,4197]],["4_13_3",[0,2041]],["4_4_2",[0,2070]],["4_7_1",[0,1541]],["4_9_6",[-427,3968]],["4_7_2",[0,1658]],["4_5_1",[0,9914]],["4_9_7",[-154,4255]],["4_11_3",[0,848]],["4_2_1",[0,0]],["4_2_2",[0,736]],["4_12_5",[70,4328]],["4_11_4",[0,676]],["4_11_5",[-213,5991]],["4_7_3",[0,2006]],["4_14_2",[0,222]],["4_15_5",[0,2798]],["4_3_6",[0,3918]],["4_15_6",[0,0]],["4_0_7",[0,658]],["4_7_4",[0,1956]],["4_10_6",[-35,4468]],["4_7_5",[0,2530]],["4_14_3",[0,2161]],["4_10_7",[0,2307]],["4_4_3",[0,1656]],["4_4_4",[0,742]],["4_10_8",[0,2559]],["4_0_8",[0,1567]],["4_14_4",[0,2641]],["4_10_9",[0,2406]],["4_4_5",[0,1476]],["4_2_3",[0,847]],["4_14_5",[0,1938]],["4_9_8",[0,4865]],["4_10_10",[0,545]],["4_14_6",[0,2720]],["4_9_9",[0,3283]],["4_4_6",[0,1698]],["4_8_5",[0,3853]],["4_0_9",[0,1]],["4_6_2",[5,12459]],["4_7_6",[0,3509]],["4_6_3",[0,12624]],["4_0_10",[0,15]],["4_8_6",[-47,2632]],["4_7_7",[0,1375]],["4_15_7",[0,488]],["4_8_7",[0,3292]],["4_14_7",[0,338]],["4_10_11",[0,3817]],["4_15_8",[0,1697]],["4_15_9",[0,2190]],["4_9_10",[0,974]],["4_13_4",[18,2517]],["4_9_11",[0,0]],["4_13_5",[0,2409]],["4_14_8",[0,4350]],["4_6_4",[0,5867]],["4_10_12",[0,12608]],["4_7_8",[0,459]],["4_11_6",[0,7286]],["4_11_7",[0,2303]],["4_0_11",[0,0]],["4_15_10",[0,2791]],["4_8_8",[0,2286]],["4_4_7",[-36,4886]],["4_2_4",[0,2552]],["4_9_12",[0,3323]],["4_15_11",[0,0]],["4_1_4",[0,5558]],["4_0_12",[0,0]],["4_5_2",[0,12411]],["4_5_3",[0,4924]],["4_7_9",[0,1425]],["4_15_12",[-2,4495]],["4_15_13",[0,3812]],["4_1_5",[0,0]],["4_5_4",[0,8703]],["4_11_8",[0,0]],["4_6_5",[0,0]],["4_1_6",[0,0]],["4_5_5",[0,1109]],["4_6_6",[0,1450]],["4_3_7",[0,4609]],["4_13_6",[-6,3355]],["4_11_9",[0,577]],["4_4_8",[0,5769]],["4_0_13",[0,1072]],["4_3_8",[0,1322]],["4_5_6",[0,0]],["4_4_9",[0,6286]],["4_7_10",[0,0]],["4_15_14",[0,3466]],["4_7_11",[0,0]],["4_11_10",[0,2158]],["4_6_7",[0,1868]],["4_13_7",[-6,3395]],["4_6_8",[0,2305]],["4_11_11",[0,0]],["4_6_9",[0,2386]],["4_13_8",[0,2856]],["4_4_10",[0,3100]],["4_1_7",[0,3991]],["4_5_7",[0,2467]],["4_6_10",[0,2086]],["4_1_8",[0,1014]],["4_11_12",[-4,7868]],["4_5_8",[0,5374]],["4_0_14",[-3,957]],["4_1_9",[0,0]],["4_5_9",[0,5802]],["4_15_15",[0,4115]],["4_10_13",[0,13447]],["4_8_9",[0,2048]],["4_1_10",[0,0]],["4_4_11",[0,4]],["4_7_12",[0,12650]],["4_8_10",[0,493]],["4_4_12",[0,3279]],["4_13_9",[0,1056]],["4_13_10",[0,0]],["4_14_9",[-20,1962]],["4_4_13",[-91,10609]],["4_8_11",[0,0]],["4_14_10",[0,1412]],["4_12_6",[-1,6602]],["4_3_9",[0,196]],["4_13_11",[0,2422]],["4_11_13",[0,13583]],["4_12_7",[-21,2969]],["4_4_14",[-521,11819]],["4_3_10",[0,0]],["4_3_11",[0,0]],["4_10_14",[0,13974]],["4_4_15",[-145,1758]],["4_10_15",[0,5550]],["4_6_11",[0,857]],["4_8_12",[0,13320]],["4_6_12",[0,0]],["4_12_8",[0,2832]],["4_2_5",[0,3596]],["4_3_12",[0,5676]],["4_5_10",[0,1438]],["4_0_15",[0,0]],["4_7_13",[0,12987]],["4_2_6",[-78,3816]],["4_5_11",[0,2244]],["4_1_11",[0,0]],["4_5_12",[0,2869]],["4_3_13",[-132,11849]],["4_1_12",[0,0]],["4_5_13",[-160,3822]],["4_7_14",[596,12294]],["4_6_13",[-86,11617]],["4_14_11",[0,755]],["4_12_9",[0,0]],["4_6_14",[-271,10057]],["4_5_14",[-153,10664]],["4_1_13",[0,11576]],["4_13_12",[0,13172]],["4_14_12",[0,3826]],["4_5_15",[0,1397]],["4_12_10",[0,0]],["4_14_13",[0,5744]],["4_12_11",[0,2697]],["4_12_12",[0,13699]],["4_1_14",[-317,10807]],["4_6_15",[0,1868]],["4_11_14",[0,13983]],["4_7_15",[0,7285]],["4_1_15",[-116,1345]],["4_2_7",[0,51]],["4_11_15",[0,5689]],["4_13_13",[421,13192]],["4_13_14",[556,13196]],["4_2_8",[0,0]],["4_12_13",[135,15727]],["4_14_14",[300,5249]],["4_14_15",[0,2628]],["4_2_9",[0,1]],["4_2_10",[0,0]],["4_9_13",[0,13678]],["4_13_15",[0,6038]],["4_2_11",[0,0]],["4_9_14",[0,13722]],["4_12_14",[193,13775]],["4_9_15",[0,0]],["4_2_12",[-1,3492]],["4_2_13",[-21,12159]],["4_12_15",[0,5772]],["4_3_14",[-475,12482]],["4_2_14",[-364,11988]],["4_2_15",[-220,1503]],["4_3_15",[0,2413]],["4_8_13",[0,13457]],["4_8_14",[0,12940]],["4_8_15",[0,7420]],["5_8_0",[0,0]],["5_10_0",[0,0]],["5_30_0",[0,0]],["5_16_0",[0,0]],["5_24_0",[0,0]],["5_12_0",[0,0]],["5_22_0",[0,0]],["5_20_0",[0,0]],["5_14_0",[0,0]],["5_2_0",[0,0]],["5_20_1",[0,0]],["5_18_0",[0,0]],["5_16_1",[0,0]],["5_24_1",[0,0]],["5_22_1",[0,0]],["5_10_1",[0,939]],["5_2_1",[0,0]],["5_26_0",[0,0]],["5_8_1",[0,889]],["5_12_1",[-77,1622]],["5_20_2",[0,461]],["5_30_1",[0,0]],["5_18_1",[0,0]],["5_8_2",[0,1935]],["5_12_2",[0,3140]],["5_18_2",[0,0]],["5_28_0",[0,0]],["5_14_1",[0,853]],["5_26_1",[0,0]],["5_22_2",[0,0]],["5_16_2",[0,0]],["5_0_0",[0,0]],["5_12_3",[-87,11884]],["5_22_3",[0,0]],["5_6_0",[0,0]],["5_26_2",[0,0]],["5_20_3",[-1,680]],["5_14_2",[0,1547]],["5_30_2",[0,0]],["5_18_3",[0,952]],["5_8_3",[0,1769]],["5_0_1",[0,0]],["5_4_0",[0,0]],["5_24_2",[0,650]],["5_16_3",[0,818]],["5_10_2",[0,1827]],["5_28_1",[0,0]],["5_2_2",[0,0]],["5_12_4",[430,12576]],["5_24_3",[0,974]],["5_6_1",[0,0]],["5_18_4",[0,519]],["5_24_4",[0,1005]],["5_12_5",[508,12502]],["5_22_4",[0,521]],["5_14_3",[0,1610]],["5_2_3",[0,0]],["5_10_3",[0,4560]],["5_0_2",[0,0]],["5_16_4",[0,917]],["5_8_4",[0,2185]],["5_4_1",[0,0]],["5_20_4",[0,0]],["5_30_3",[0,0]],["5_8_5",[0,2068]],["5_26_3",[0,0]],["5_20_5",[0,907]],["5_14_4",[0,1041]],["5_8_6",[0,1597]],["5_30_4",[0,0]],["5_2_4",[0,0]],["5_6_2",[0,0]],["5_22_5",[0,892]],["5_12_6",[515,12193]],["5_24_5",[0,647]],["5_20_6",[0,1152]],["5_8_7",[0,581]],["5_16_5",[0,0]],["5_10_4",[0,11369]],["5_30_5",[0,0]],["5_8_8",[0,568]],["5_12_7",[0,12721]],["5_28_2",[0,0]],["5_0_3",[0,0]],["5_30_6",[0,43]],["5_4_2",[0,0]],["5_22_6",[0,69]],["5_26_4",[0,0]],["5_30_7",[0,1573]],["5_14_5",[-1,1722]],["5_16_6",[0,0]],["5_24_6",[0,636]],["5_8_9",[0,211]],["5_12_8",[0,10004]],["5_14_6",[0,1586]],["5_26_5",[0,436]],["5_28_3",[0,0]],["5_22_7",[0,235]],["5_2_5",[0,0]],["5_20_7",[0,259]],["5_6_3",[0,50]],["5_10_5",[0,2805]],["5_4_3",[0,0]],["5_30_8",[0,1660]],["5_22_8",[0,163]],["5_8_10",[0,496]],["5_10_6",[0,682]],["5_18_5",[0,163]],["5_0_4",[0,0]],["5_26_6",[0,468]],["5_8_11",[72,680]],["5_12_9",[0,2438]],["5_26_7",[12,481]],["5_12_10",[0,0]],["5_4_4",[0,0]],["5_14_7",[0,1035]],["5_12_11",[0,0]],["5_24_7",[24,1641]],["5_22_9",[12,150]],["5_22_10",[22,1395]],["5_2_6",[0,18]],["5_6_4",[0,207]],["5_24_8",[27,997]],["5_22_11",[115,5309]],["5_28_4",[0,0]],["5_26_8",[19,675]],["5_14_8",[0,1982]],["5_24_9",[31,1011]],["5_30_9",[0,4297]],["5_12_12",[0,0]],["5_14_9",[0,0]],["5_6_5",[0,492]],["5_28_5",[0,230]],["5_22_12",[167,7715]],["5_2_7",[0,2227]],["5_12_13",[0,0]],["5_14_10",[0,0]],["5_10_7",[0,2088]],["5_16_7",[0,0]],["5_28_6",[0,489]],["5_20_8",[4,443]],["5_4_5",[0,55]],["5_12_14",[0,0]],["5_24_10",[230,3802]],["5_2_8",[10,5957]],["5_18_6",[0,612]],["5_16_8",[0,2253]],["5_14_11",[0,0]],["5_0_5",[0,0]],["5_12_15",[0,0]],["5_10_8",[-1,1729]],["5_18_7",[0,1155]],["5_24_11",[28,4447]],["5_30_10",[0,3255]],["5_0_6",[0,950]],["5_18_8",[0,495]],["5_0_7",[0,1429]],["5_12_16",[0,1238]],["5_0_8",[0,1155]],["5_18_9",[0,322]],["5_8_12",[0,1767]],["5_26_9",[106,2637]],["5_10_9",[0,1409]],["5_10_10",[0,1173]],["5_14_12",[0,1523]],["5_26_10",[265,2456]],["5_28_7",[3,2267]],["5_6_6",[0,621]],["5_16_9",[0,2173]],["5_14_13",[-23,3303]],["5_22_13",[0,5942]],["5_20_9",[31,373]],["5_10_11",[0,1061]],["5_26_11",[7,2076]],["5_0_9",[0,345]],["5_18_10",[21,1177]],["5_22_14",[0,2413]],["5_4_6",[0,237]],["5_20_10",[-11,599]],["5_12_17",[0,2571]],["5_10_12",[0,1]],["5_16_10",[0,996]],["5_26_12",[-6,2789]],["5_16_11",[0,4361]],["5_28_8",[102,2762]],["5_8_13",[0,966]],["5_8_14",[0,2702]],["5_6_7",[0,549]],["5_10_13",[0,0]],["5_12_18",[0,2474]],["5_30_11",[0,0]],["5_2_9",[0,3726]],["5_16_12",[-35,2133]],["5_10_14",[0,1173]],["5_8_15",[0,3588]],["5_10_15",[0,2718]],["5_0_10",[0,1484]],["5_2_10",[0,24]],["5_14_14",[0,1398]],["5_0_11",[0,0]],["5_0_12",[0,0]],["5_16_13",[122,2557]],["5_14_15",[0,1324]],["5_6_8",[0,624]],["5_2_11",[0,0]],["5_8_16",[0,5547]],["5_24_12",[722,6355]],["5_10_16",[1,1048]],["5_0_13",[0,0]],["5_0_14",[0,0]],["5_24_13",[0,7021]],["5_18_11",[0,2629]],["5_0_15",[0,0]],["5_14_16",[0,402]],["5_10_17",[77,5543]],["5_24_14",[0,2786]],["5_4_7",[0,628]],["5_12_19",[0,0]],["5_0_16",[0,0]],["5_20_11",[-132,4091]],["5_24_15",[0,3202]],["5_22_15",[0,2360]],["5_30_12",[0,0]],["5_22_16",[0,0]],["5_22_17",[0,0]],["5_10_18",[6,6025]],["5_4_8",[16,2518]],["5_2_12",[0,0]],["5_18_12",[0,2816]],["5_0_17",[0,1754]],["5_12_20",[0,0]],["5_8_17",[0,0]],["5_14_17",[0,0]],["5_24_16",[0,2638]],["5_18_13",[-109,1735]],["5_10_19",[0,2510]],["5_30_13",[0,0]],["5_0_18",[0,2]],["5_14_18",[0,0]],["5_30_14",[0,0]],["5_22_18",[0,0]],["5_8_18",[0,0]],["5_30_15",[0,522]],["5_22_19",[0,704]],["5_10_20",[0,1471]],["5_30_16",[0,2054]],["5_14_19",[0,1592]],["5_24_17",[0,0]],["5_12_21",[0,2536]],["5_22_20",[0,507]],["5_2_13",[0,0]],["5_10_21",[0,929]],["5_30_17",[0,1426]],["5_18_14",[171,2833]],["5_22_21",[0,2376]],["5_0_19",[0,0]],["5_8_19",[0,985]],["5_18_15",[354,4538]],["5_24_18",[0,0]],["5_2_14",[0,4036]],["5_28_9",[0,2386]],["5_18_16",[367,3981]],["5_8_20",[0,0]],["5_30_18",[0,1149]],["5_20_12",[-44,5148]],["5_2_15",[0,39]],["5_12_22",[0,326]],["5_22_22",[0,0]],["5_26_13",[-9,3531]],["5_2_16",[0,1]],["5_16_14",[135,1810]],["5_10_22",[0,85]],["5_12_23",[0,0]],["5_30_19",[0,0]],["5_0_20",[0,214]],["5_8_21",[0,0]],["5_26_14",[-7,2631]],["5_6_9",[157,856]],["5_28_10",[0,1854]],["5_20_13",[0,4117]],["5_14_20",[0,0]],["5_20_14",[0,2339]],["5_24_19",[0,0]],["5_2_17",[0,1232]],["5_10_23",[0,2545]],["5_16_15",[0,3590]],["5_30_20",[0,2291]],["5_20_15",[0,2292]],["5_14_21",[0,0]],["5_20_16",[0,511]],["5_22_23",[0,0]],["5_10_24",[0,3028]],["5_16_16",[0,820]],["5_30_21",[0,511]],["5_26_15",[0,3494]],["5_12_24",[0,0]],["5_10_25",[-1,2915]],["5_16_17",[0,0]],["5_0_21",[0,0]],["5_2_18",[0,0]],["5_20_17",[0,2643]],["5_4_9",[0,2704]],["5_6_10",[248,1748]],["5_8_22",[0,0]],["5_10_26",[0,2642]],["5_18_17",[92,2330]],["5_20_18",[0,2495]],["5_0_22",[0,0]],["5_8_23",[0,0]],["5_16_18",[0,0]],["5_28_11",[0,2055]],["5_26_16",[0,3118]],["5_8_24",[0,0]],["5_14_22",[0,0]],["5_2_19",[0,0]],["5_28_12",[0,3377]],["5_0_23",[0,0]],["5_8_25",[0,3425]],["5_16_19",[0,0]],["5_0_24",[0,0]],["5_10_27",[0,216]],["5_18_18",[0,3362]],["5_20_19",[0,0]],["5_28_13",[0,6]],["5_12_25",[0,0]],["5_28_14",[0,653]],["5_0_25",[0,0]],["5_24_20",[0,0]],["5_26_17",[0,655]],["5_22_24",[-46,2715]],["5_18_19",[0,2153]],["5_12_26",[0,0]],["5_30_22",[0,0]],["5_20_20",[0,696]],["5_28_15",[0,0]],["5_10_28",[0,0]],["5_10_29",[-169,619]],["5_16_20",[0,0]],["5_4_10",[0,3355]],["5_2_20",[0,0]],["5_26_18",[0,1039]],["5_20_21",[0,0]],["5_24_21",[0,0]],["5_10_30",[0,858]],["5_4_11",[0,1643]],["5_10_31",[0,0]],["5_0_26",[0,0]],["5_26_19",[0,671]],["5_28_16",[0,4429]],["5_14_23",[0,0]],["5_18_20",[0,0]],["5_30_23",[0,0]],["5_8_26",[-56,10819]],["5_12_27",[0,3962]],["5_28_17",[0,1268]],["5_26_20",[0,0]],["5_14_24",[0,0]],["5_20_22",[0,0]],["5_2_21",[0,0]],["5_20_23",[0,3994]],["5_4_12",[0,1428]],["5_26_21",[0,0]],["5_24_22",[0,0]],["5_20_24",[0,3968]],["5_16_21",[0,633]],["5_4_13",[0,0]],["5_11_0",[0,0]],["5_0_27",[0,0]],["5_4_14",[0,0]],["5_18_21",[0,0]],["5_0_28",[0,0]],["5_30_24",[0,2371]],["5_12_28",[-23,2282]],["5_22_25",[0,5117]],["5_28_18",[-27,910]],["5_26_22",[0,0]],["5_11_1",[0,1187]],["5_6_11",[451,3872]],["5_14_25",[0,1784]],["5_16_22",[0,0]],["5_11_2",[0,1530]],["5_6_12",[264,4098]],["5_24_23",[0,2785]],["5_0_29",[0,0]],["5_2_22",[0,0]],["5_26_23",[0,2532]],["5_30_25",[0,5374]],["5_22_26",[0,6344]],["5_2_23",[0,0]],["5_8_27",[0,6395]],["5_11_3",[-281,11457]],["5_28_19",[0,1367]],["5_16_23",[0,0]],["5_20_25",[117,12952]],["5_30_26",[0,3462]],["5_12_29",[-270,1445]],["5_0_30",[0,0]],["5_18_22",[0,0]],["5_8_28",[-44,11812]],["5_24_24",[-1,4740]],["5_0_31",[0,0]],["5_16_24",[0,2071]],["5_22_27",[0,1690]],["5_22_28",[0,14074]],["5_1_0",[0,0]],["5_8_29",[-776,11827]],["5_14_26",[-1,11632]],["5_18_23",[0,0]],["5_2_24",[0,0]],["5_26_24",[-1,3120]],["5_1_1",[0,0]],["5_14_27",[-83,12126]],["5_8_30",[-161,1803]],["5_28_20",[0,1249]],["5_6_13",[0,3194]],["5_1_2",[0,0]],["5_28_21",[0,0]],["5_22_29",[1112,8648]],["5_6_14",[0,3830]],["5_4_15",[0,0]],["5_12_30",[0,1506]],["5_24_25",[560,13714]],["5_30_27",[0,3863]],["5_2_25",[0,0]],["5_30_28",[-4,3500]],["5_22_30",[0,5588]],["5_18_24",[0,3125]],["5_26_25",[195,13069]],["5_30_29",[-36,3163]],["5_12_31",[0,0]],["5_30_30",[0,4180]],["5_6_15",[0,0]],["5_28_22",[0,0]],["5_2_26",[0,902]],["5_13_0",[0,0]],["5_8_31",[0,0]],["5_6_16",[0,0]],["5_2_27",[-9,1577]],["5_20_26",[533,11655]],["5_22_31",[0,0]],["5_30_31",[0,0]],["5_18_25",[0,3326]],["5_4_16",[0,0]],["5_11_4",[-2,12501]],["5_14_28",[444,4576]],["5_1_3",[0,0]],["5_2_28",[-29,3255]],["5_9_0",[0,0]],["5_4_17",[0,0]],["5_13_1",[0,1738]],["5_31_0",[0,0]],["5_18_26",[673,13490]],["5_1_4",[0,0]],["5_28_23",[0,770]],["5_9_1",[0,1678]],["5_13_2",[0,1446]],["5_11_5",[0,12265]],["5_23_0",[0,0]],["5_31_1",[0,0]],["5_6_17",[0,0]],["5_13_3",[0,2898]],["5_9_2",[0,2490]],["5_1_5",[0,0]],["5_23_1",[0,0]],["5_13_4",[13,3715]],["5_2_29",[-268,10423]],["5_31_2",[0,0]],["5_28_24",[0,4051]],["5_23_2",[0,0]],["5_4_18",[0,13]],["5_28_25",[74,3092]],["5_1_6",[0,18]],["5_16_25",[0,13122]],["5_9_3",[0,2167]],["5_1_7",[0,1349]],["5_4_19",[0,0]],["5_2_30",[-122,437]],["5_1_8",[-1,1108]],["5_9_4",[0,2109]],["5_28_26",[0,6106]],["5_20_27",[0,13528]],["5_9_5",[0,1052]],["5_6_18",[0,408]],["5_4_20",[0,0]],["5_9_6",[-3,1765]],["5_6_19",[0,0]],["5_2_31",[0,0]],["5_23_3",[0,213]],["5_23_4",[0,0]],["5_6_20",[0,0]],["5_1_9",[0,2236]],["5_3_0",[0,0]],["5_6_21",[0,0]],["5_9_7",[0,1653]],["5_23_5",[0,247]],["5_4_21",[0,0]],["5_31_3",[0,0]],["5_23_6",[0,454]],["5_6_22",[0,0]],["5_1_10",[0,2513]],["5_16_26",[409,13489]],["5_9_8",[0,771]],["5_31_4",[0,0]],["5_1_11",[0,0]],["5_4_22",[0,0]],["5_1_12",[0,0]],["5_6_23",[0,0]],["5_1_13",[0,1432]],["5_3_1",[0,0]],["5_23_7",[0,902]],["5_1_14",[0,925]],["5_13_5",[0,12536]],["5_31_5",[0,0]],["5_4_23",[0,0]],["5_28_27",[1462,5952]],["5_9_9",[0,655]],["5_1_15",[0,0]],["5_23_8",[2,689]],["5_9_10",[0,1056]],["5_9_11",[0,1597]],["5_16_27",[389,10452]],["5_23_9",[23,335]],["5_26_26",[308,13234]],["5_9_12",[0,1068]],["5_20_28",[-5,7884]],["5_1_16",[0,0]],["5_4_24",[0,0]],["5_6_24",[0,0]],["5_1_17",[0,16]],["5_16_28",[2115,12400]],["5_11_6",[0,8206]],["5_31_6",[0,574]],["5_3_2",[0,0]],["5_1_18",[0,0]],["5_9_13",[0,60]],["5_26_27",[87,5714]],["5_14_29",[463,11591]],["5_4_25",[0,3164]],["5_3_3",[0,0]],["5_20_29",[0,0]],["5_16_29",[932,12504]],["5_9_14",[-40,2807]],["5_23_10",[74,4066]],["5_23_11",[-216,6733]],["5_4_26",[0,12119]],["5_23_12",[725,6626]],["5_26_28",[739,13228]],["5_3_4",[0,0]],["5_9_15",[0,5165]],["5_3_5",[0,0]],["5_20_30",[0,0]],["5_9_16",[0,5929]],["5_13_6",[0,5060]],["5_1_19",[0,0]],["5_3_6",[0,0]],["5_28_28",[1817,5348]],["5_31_7",[0,1687]],["5_13_7",[0,4228]],["5_3_7",[0,2490]],["5_23_13",[0,7808]],["5_14_30",[0,6507]],["5_1_20",[0,0]],["5_11_7",[0,4372]],["5_1_21",[0,0]],["5_6_25",[0,2721]],["5_20_31",[0,0]],["5_1_22",[0,0]],["5_18_27",[568,13646]],["5_23_14",[0,1371]],["5_21_0",[0,0]],["5_14_31",[0,0]],["5_13_8",[0,1285]],["5_13_9",[0,0]],["5_21_1",[0,0]],["5_18_28",[0,13802]],["5_31_8",[0,2096]],["5_15_0",[0,0]],["5_21_2",[0,583]],["5_31_9",[0,1403]],["5_4_27",[-27,12127]],["5_21_3",[0,643]],["5_31_10",[0,902]],["5_26_29",[494,13201]],["5_18_29",[0,6978]],["5_16_30",[0,7398]],["5_13_10",[0,0]],["5_21_4",[0,522]],["5_31_11",[0,0]],["5_3_8",[112,4818]],["5_31_12",[0,0]],["5_28_29",[574,6004]],["5_31_13",[0,0]],["5_11_8",[0,11521]],["5_6_26",[0,11225]],["5_3_9",[-2,5699]],["5_15_1",[0,0]],["5_23_15",[0,2261]],["5_1_23",[0,0]],["5_13_11",[0,0]],["5_11_9",[0,2035]],["5_26_30",[0,6265]],["5_23_16",[0,0]],["5_31_14",[0,0]],["5_18_30",[0,0]],["5_21_5",[0,1376]],["5_24_26",[73,14065]],["5_11_10",[0,340]],["5_15_2",[0,0]],["5_31_15",[0,1]],["5_21_6",[0,1163]],["5_23_17",[0,0]],["5_1_24",[0,0]],["5_21_7",[0,1316]],["5_24_27",[329,14234]],["5_21_8",[2,1664]],["5_23_18",[0,0]],["5_28_30",[0,2719]],["5_21_9",[12,1411]],["5_31_16",[0,4]],["5_23_19",[0,0]],["5_9_17",[0,6084]],["5_16_31",[0,0]],["5_21_10",[6,1504]],["5_26_31",[0,0]],["5_3_10",[0,0]],["5_11_11",[0,335]],["5_21_11",[-17,931]],["5_15_3",[0,0]],["5_1_25",[0,0]],["5_3_11",[0,0]],["5_17_0",[0,0]],["5_21_12",[-20,4527]],["5_1_26",[0,0]],["5_15_4",[0,0]],["5_3_12",[0,0]],["5_13_12",[0,1912]],["5_1_27",[0,1082]],["5_31_17",[0,1117]],["5_11_12",[0,0]],["5_21_13",[0,4121]],["5_23_20",[0,0]],["5_15_5",[0,0]],["5_4_28",[-303,12031]],["5_31_18",[0,0]],["5_3_13",[0,0]],["5_23_21",[0,0]],["5_21_14",[0,243]],["5_11_13",[0,0]],["5_3_14",[0,0]],["5_27_0",[0,0]],["5_23_22",[0,0]],["5_21_15",[0,0]],["5_18_31",[0,0]],["5_11_14",[0,0]],["5_31_19",[0,2485]],["5_4_29",[-428,11054]],["5_27_1",[0,0]],["5_11_15",[0,866]],["5_9_18",[0,6513]],["5_1_28",[-9,1149]],["5_13_13",[0,0]],["5_28_31",[0,0]],["5_27_2",[0,0]],["5_11_16",[0,842]],["5_13_14",[0,2210]],["5_19_0",[0,0]],["5_23_23",[0,0]],["5_9_19",[0,6287]],["5_13_15",[0,0]],["5_1_29",[0,0]],["5_19_1",[0,0]],["5_31_20",[0,3109]],["5_9_20",[0,3541]],["5_4_30",[-396,1079]],["5_1_30",[0,0]],["5_21_16",[0,0]],["5_13_16",[0,28]],["5_19_2",[0,0]],["5_29_0",[0,0]],["5_17_1",[0,0]],["5_21_17",[0,666]],["5_9_21",[-21,3287]],["5_19_3",[0,0]],["5_13_17",[0,0]],["5_29_1",[0,0]],["5_27_3",[0,0]],["5_24_28",[339,13872]],["5_4_31",[0,0]],["5_21_18",[0,0]],["5_11_17",[109,1585]],["5_3_15",[0,0]],["5_27_4",[0,0]],["5_5_0",[0,0]],["5_13_18",[0,0]],["5_11_18",[0,2040]],["5_19_4",[0,0]],["5_3_16",[0,1029]],["5_23_24",[0,3223]],["5_1_31",[0,0]],["5_9_22",[0,93]],["5_27_5",[0,0]],["5_5_1",[0,0]],["5_11_19",[0,319]],["5_6_27",[-284,11966]],["5_15_6",[0,2078]],["5_29_2",[0,0]],["5_13_19",[0,0]],["5_17_2",[0,0]],["5_27_6",[0,898]],["5_6_28",[7,12548]],["5_21_19",[0,0]],["5_31_21",[0,395]],["5_29_3",[0,0]],["5_27_7",[4,2142]],["5_13_20",[0,0]],["5_5_2",[0,0]],["5_15_7",[0,0]],["5_3_17",[0,1]],["5_31_22",[0,0]],["5_9_23",[0,0]],["5_17_3",[0,1423]],["5_13_21",[0,0]],["5_11_20",[0,0]],["5_29_4",[0,0]],["5_6_29",[-330,11958]],["5_5_3",[0,0]],["5_15_8",[0,607]],["5_19_5",[0,0]],["5_3_18",[0,0]],["5_27_8",[19,1983]],["5_21_20",[0,0]],["5_31_23",[0,0]],["5_23_25",[0,11495]],["5_24_29",[994,13690]],["5_13_22",[0,1112]],["5_24_30",[0,5651]],["5_29_5",[0,239]],["5_27_9",[84,2090]],["5_24_31",[0,0]],["5_6_30",[0,2455]],["5_19_6",[0,0]],["5_11_21",[0,0]],["5_25_0",[0,0]],["5_29_6",[0,317]],["5_25_1",[0,0]],["5_15_9",[0,1186]],["5_5_4",[0,91]],["5_25_2",[0,0]],["5_3_19",[0,0]],["5_17_4",[0,1648]],["5_19_7",[0,1139]],["5_9_24",[0,2951]],["5_6_31",[0,0]],["5_29_7",[-16,863]],["5_11_22",[0,1864]],["5_25_3",[0,230]],["5_9_25",[-11,3402]],["5_17_5",[0,806]],["5_15_10",[0,874]],["5_5_5",[0,750]],["5_27_10",[23,2037]],["5_19_8",[0,272]],["5_9_26",[-2,4848]],["5_31_24",[0,0]],["5_11_23",[0,715]],["5_23_26",[0,13578]],["5_21_21",[0,0]],["5_27_11",[-55,2560]],["5_29_8",[0,2342]],["5_17_6",[0,245]],["5_5_6",[0,677]],["5_25_4",[0,970]],["5_7_0",[0,0]],["5_29_9",[0,1846]],["5_15_11",[0,2948]],["5_23_27",[0,13592]],["5_13_23",[0,0]],["5_19_9",[20,304]],["5_25_5",[0,1097]],["5_9_27",[-173,1991]],["5_3_20",[0,0]],["5_7_1",[0,0]],["5_5_7",[0,856]],["5_11_24",[0,0]],["5_25_6",[0,742]],["5_19_10",[8,276]],["5_25_7",[34,911]],["5_29_10",[0,2108]],["5_27_12",[0,2359]],["5_7_2",[0,883]],["5_21_22",[0,0]],["5_25_8",[153,904]],["5_27_13",[0,1669]],["5_9_28",[0,1520]],["5_21_23",[0,2113]],["5_25_9",[171,2303]],["5_19_11",[-11,5341]],["5_29_11",[0,1360]],["5_17_7",[0,1877]],["5_25_10",[346,2887]],["5_3_21",[0,0]],["5_5_8",[83,1483]],["5_17_8",[0,1683]],["5_9_29",[-256,10411]],["5_31_25",[0,3957]],["5_27_14",[0,922]],["5_29_12",[0,0]],["5_15_12",[0,3540]],["5_25_11",[691,3273]],["5_7_3",[0,1985]],["5_13_24",[0,0]],["5_29_13",[0,0]],["5_25_12",[43,4896]],["5_15_13",[0,3767]],["5_3_22",[0,0]],["5_17_9",[0,1130]],["5_7_4",[0,1739]],["5_9_30",[-200,1010]],["5_23_28",[0,13400]],["5_5_9",[133,2090]],["5_25_13",[-10,6305]],["5_19_12",[-360,4624]],["5_23_29",[0,13692]],["5_21_24",[0,4774]],["5_23_30",[0,5749]],["5_17_10",[0,2193]],["5_9_31",[0,0]],["5_31_26",[0,0]],["5_21_25",[77,4786]],["5_3_23",[0,0]],["5_29_14",[0,0]],["5_13_25",[0,0]],["5_27_15",[0,2567]],["5_21_26",[443,7322]],["5_7_5",[0,601]],["5_25_14",[-22,2598]],["5_3_24",[0,0]],["5_11_25",[0,0]],["5_27_16",[0,2587]],["5_25_15",[0,1872]],["5_31_27",[0,2285]],["5_25_16",[0,3241]],["5_7_6",[0,587]],["5_29_15",[0,14]],["5_15_14",[39,875]],["5_19_13",[-427,2405]],["5_13_26",[0,10992]],["5_25_17",[0,0]],["5_29_16",[0,3848]],["5_15_15",[0,1528]],["5_3_25",[0,0]],["5_11_26",[0,0]],["5_25_18",[0,0]],["5_11_27",[-245,3991]],["5_13_27",[-250,11653]],["5_11_28",[-2,10775]],["5_23_31",[0,0]],["5_15_16",[0,0]],["5_21_27",[0,13367]],["5_17_11",[0,3379]],["5_25_19",[0,0]],["5_13_28",[-10,2687]],["5_19_14",[-152,4329]],["5_3_26",[0,3379]],["5_11_29",[0,1965]],["5_15_17",[0,604]],["5_7_7",[0,555]],["5_17_12",[0,3016]],["5_11_30",[0,1403]],["5_27_17",[0,884]],["5_31_28",[0,0]],["5_27_18",[0,1202]],["5_17_13",[-49,2116]],["5_3_27",[0,11578]],["5_13_29",[-383,11241]],["5_25_20",[0,0]],["5_7_8",[0,583]],["5_21_28",[0,14023]],["5_15_18",[0,0]],["5_11_31",[0,0]],["5_7_9",[0,449]],["5_17_14",[160,3182]],["5_5_10",[0,3323]],["5_15_19",[0,735]],["5_7_10",[84,779]],["5_15_20",[0,0]],["5_13_30",[0,1879]],["5_31_29",[0,0]],["5_17_15",[111,2200]],["5_29_17",[0,1072]],["5_3_28",[-60,1883]],["5_29_18",[0,1488]],["5_31_30",[0,0]],["5_3_29",[-388,10871]],["5_17_16",[0,1800]],["5_7_11",[164,1053]],["5_25_21",[0,0]],["5_13_31",[0,0]],["5_29_19",[0,2057]],["5_25_22",[0,0]],["5_3_30",[-249,1410]],["5_7_12",[14,1025]],["5_15_21",[0,0]],["5_17_17",[0,2400]],["5_27_19",[0,171]],["5_5_11",[0,4189]],["5_7_13",[0,3414]],["5_21_29",[0,8657]],["5_19_15",[0,4219]],["5_31_31",[0,0]],["5_19_16",[0,5606]],["5_29_20",[0,1466]],["5_25_23",[0,2503]],["5_3_31",[0,0]],["5_17_18",[0,2193]],["5_5_12",[-90,3948]],["5_27_20",[0,0]],["5_29_21",[0,0]],["5_7_14",[0,4976]],["5_5_13",[0,2654]],["5_27_21",[0,0]],["5_19_17",[0,2663]],["5_15_22",[0,0]],["5_7_15",[0,1414]],["5_19_18",[0,1234]],["5_7_16",[0,1481]],["5_5_14",[0,0]],["5_15_23",[0,0]],["5_7_17",[0,0]],["5_21_30",[0,5578]],["5_5_15",[0,0]],["5_27_22",[0,0]],["5_19_19",[0,0]],["5_5_16",[0,0]],["5_5_17",[0,0]],["5_27_23",[0,1208]],["5_17_19",[0,1952]],["5_29_22",[0,0]],["5_7_18",[0,0]],["5_5_18",[0,0]],["5_25_24",[-20,7550]],["5_7_19",[0,0]],["5_15_24",[0,0]],["5_5_19",[0,0]],["5_21_31",[0,0]],["5_19_20",[0,1085]],["5_7_20",[0,0]],["5_25_25",[893,5278]],["5_29_23",[0,0]],["5_19_21",[0,0]],["5_27_24",[0,3358]],["5_7_21",[0,0]],["5_25_26",[398,16881]],["5_5_20",[0,0]],["5_17_20",[0,0]],["5_25_27",[409,13607]],["5_29_24",[0,3941]],["5_5_21",[0,0]],["5_7_22",[0,0]],["5_19_22",[0,0]],["5_27_25",[121,13182]],["5_7_23",[0,0]],["5_25_28",[81,11732]],["5_29_25",[206,3659]],["5_15_25",[0,12745]],["5_7_24",[0,6e3]],["5_19_23",[0,0]],["5_17_21",[0,0]],["5_7_25",[0,3818]],["5_27_26",[176,13228]],["5_27_27",[917,5156]],["5_17_22",[0,0]],["5_5_22",[0,0]],["5_19_24",[0,2322]],["5_17_23",[0,0]],["5_15_26",[720,13158]],["5_17_24",[0,2225]],["5_7_26",[-60,10925]],["5_5_23",[0,0]],["5_5_24",[0,0]],["5_25_29",[545,13435]],["5_27_28",[2024,3717]],["5_19_25",[1076,3328]],["5_29_26",[1604,4735]],["5_27_29",[1549,4189]],["5_7_27",[-266,11877]],["5_29_27",[1317,4633]],["5_17_25",[0,13322]],["5_25_30",[0,5836]],["5_29_28",[294,3461]],["5_5_25",[0,3649]],["5_15_27",[594,12372]],["5_27_30",[0,3504]],["5_25_31",[0,0]],["5_17_26",[188,13467]],["5_19_26",[560,13678]],["5_29_29",[893,6492]],["5_7_28",[48,12310]],["5_29_30",[0,2688]],["5_15_28",[1348,12294]],["5_27_31",[0,0]],["5_5_26",[-44,10679]],["5_7_29",[-775,12048]],["5_7_30",[0,2203]],["5_17_27",[0,13641]],["5_17_28",[524,12941]],["5_7_31",[0,0]],["5_15_29",[1307,12179]],["5_5_27",[-132,12220]],["5_19_27",[0,10866]],["5_5_28",[-169,11850]],["5_17_29",[0,12535]],["5_5_29",[-121,11218]],["5_5_30",[0,1513]],["5_17_30",[0,7464]],["5_19_28",[-1,12167]],["5_15_30",[0,7358]],["5_5_31",[0,0]],["5_17_31",[0,0]],["5_19_29",[0,0]],["5_15_31",[0,0]],["5_19_30",[0,0]],["5_19_31",[0,0]],["5_29_31",[0,0]],["6_60_0",[0,0]],["6_20_0",[0,0]],["6_8_0",[0,0]],["6_16_0",[0,0]],["6_40_0",[0,0]],["6_48_0",[0,0]],["6_44_0",[0,0]],["6_56_0",[0,0]],["6_32_0",[0,0]],["6_24_0",[0,0]],["6_4_0",[0,0]],["6_8_1",[0,0]],["6_16_1",[0,0]],["6_36_0",[0,0]],["6_52_0",[0,0]],["6_12_0",[0,0]],["6_0_0",[0,0]],["6_28_0",[0,0]],["6_60_1",[0,0]],["6_16_2",[0,0]],["6_20_1",[0,0]],["6_24_1",[0,0]],["6_16_3",[0,0]],["6_12_1",[0,0]],["6_0_1",[0,0]],["6_40_1",[0,0]],["6_32_1",[0,0]],["6_36_1",[0,0]],["6_44_1",[0,0]],["6_52_1",[0,0]],["6_60_2",[0,0]],["6_28_1",[0,0]],["6_56_1",[0,0]],["6_24_2",[0,0]],["6_16_4",[0,1360]],["6_48_1",[0,0]],["6_4_1",[0,0]],["6_8_2",[0,0]],["6_20_2",[0,0]],["6_0_2",[0,0]],["6_16_5",[0,1569]],["6_40_2",[0,0]],["6_36_2",[0,0]],["6_52_2",[0,0]],["6_24_3",[-80,1388]],["6_0_3",[0,0]],["6_4_2",[0,0]],["6_44_2",[0,0]],["6_56_2",[0,0]],["6_32_2",[0,0]],["6_48_2",[0,0]],["6_28_2",[0,0]],["6_52_3",[0,0]],["6_8_3",[0,0]],["6_60_3",[0,0]],["6_40_3",[0,0]],["6_24_4",[0,1630]],["6_0_4",[0,0]],["6_44_3",[0,0]],["6_36_3",[0,0]],["6_16_6",[0,1259]],["6_32_3",[0,0]],["6_20_3",[0,972]],["6_48_3",[0,0]],["6_60_4",[0,0]],["6_12_2",[0,0]],["6_40_4",[0,0]],["6_24_5",[18,3219]],["6_28_3",[0,890]],["6_44_4",[0,0]],["6_60_5",[0,0]],["6_56_3",[0,0]],["6_0_5",[0,0]],["6_40_5",[0,203]],["6_8_4",[0,0]],["6_32_4",[0,0]],["6_20_4",[0,1881]],["6_16_7",[0,1745]],["6_4_3",[0,0]],["6_48_4",[0,0]],["6_36_4",[0,0]],["6_52_4",[0,0]],["6_56_4",[0,0]],["6_20_5",[0,1374]],["6_8_5",[0,0]],["6_28_4",[0,698]],["6_20_6",[0,1412]],["6_32_5",[0,0]],["6_40_6",[0,713]],["6_4_4",[0,0]],["6_16_8",[0,1721]],["6_0_6",[0,0]],["6_16_9",[0,1668]],["6_12_3",[0,0]],["6_24_6",[-182,2951]],["6_60_6",[0,0]],["6_44_5",[0,0]],["6_48_5",[0,690]],["6_4_5",[0,0]],["6_56_5",[0,0]],["6_48_6",[0,1026]],["6_36_5",[0,0]],["6_4_6",[0,0]],["6_16_10",[0,1378]],["6_28_5",[0,1108]],["6_44_6",[0,0]],["6_16_11",[0,1062]],["6_40_7",[0,450]],["6_8_6",[0,0]],["6_52_5",[0,0]],["6_60_7",[0,0]],["6_20_7",[0,1221]],["6_0_7",[0,0]],["6_12_4",[0,0]],["6_4_7",[0,0]],["6_8_7",[0,0]],["6_56_6",[0,0]],["6_36_6",[0,571]],["6_48_7",[0,899]],["6_52_6",[0,0]],["6_16_12",[0,854]],["6_32_6",[0,0]],["6_60_8",[0,0]],["6_28_6",[0,1663]],["6_44_7",[0,0]],["6_16_13",[0,464]],["6_24_7",[45,12072]],["6_16_14",[0,580]],["6_48_8",[0,92]],["6_0_8",[0,0]],["6_12_5",[0,0]],["6_20_8",[0,3216]],["6_36_7",[0,1059]],["6_16_15",[0,482]],["6_56_7",[0,0]],["6_44_8",[0,0]],["6_60_9",[0,0]],["6_48_9",[0,7]],["6_4_8",[0,0]],["6_52_7",[0,0]],["6_40_8",[0,0]],["6_32_7",[0,0]],["6_40_9",[0,0]],["6_56_8",[0,0]],["6_40_10",[0,0]],["6_44_9",[0,526]],["6_44_10",[0,994]],["6_36_8",[0,203]],["6_16_16",[0,521]],["6_60_10",[0,0]],["6_8_8",[0,0]],["6_28_7",[0,1513]],["6_40_11",[0,0]],["6_8_9",[0,0]],["6_52_8",[0,0]],["6_60_11",[0,0]],["6_44_11",[0,0]],["6_12_6",[0,0]],["6_56_9",[0,0]],["6_4_9",[0,0]],["6_36_9",[0,563]],["6_20_9",[0,3314]],["6_32_8",[0,0]],["6_12_7",[0,0]],["6_8_10",[0,0]],["6_48_10",[0,483]],["6_48_11",[1,651]],["6_0_9",[0,0]],["6_48_12",[0,591]],["6_4_10",[0,0]],["6_16_17",[0,124]],["6_40_12",[0,0]],["6_36_10",[0,0]],["6_32_9",[0,0]],["6_40_13",[0,0]],["6_16_18",[0,0]],["6_28_8",[0,939]],["6_4_11",[0,0]],["6_60_12",[0,0]],["6_20_10",[0,1774]],["6_52_9",[0,0]],["6_60_13",[0,31]],["6_48_13",[5,186]],["6_0_10",[0,0]],["6_48_14",[29,1631]],["6_56_10",[0,127]],["6_40_14",[0,101]],["6_16_19",[0,164]],["6_8_11",[0,0]],["6_12_8",[0,66]],["6_36_11",[0,0]],["6_32_10",[0,0]],["6_0_11",[0,0]],["6_60_14",[0,955]],["6_56_11",[0,401]],["6_28_9",[0,1087]],["6_0_12",[0,0]],["6_40_15",[0,224]],["6_24_8",[550,12621]],["6_16_20",[0,329]],["6_48_15",[50,1537]],["6_36_12",[0,0]],["6_12_9",[0,85]],["6_44_12",[0,63]],["6_48_16",[18,1008]],["6_8_12",[0,0]],["6_0_13",[0,1019]],["6_40_16",[14,371]],["6_56_12",[0,32]],["6_48_17",[27,809]],["6_56_13",[0,376]],["6_44_13",[0,322]],["6_36_13",[-1,633]],["6_44_14",[0,45]],["6_4_12",[0,0]],["6_40_17",[28,454]],["6_12_10",[0,407]],["6_36_14",[0,1085]],["6_52_10",[0,516]],["6_56_14",[7,1479]],["6_44_15",[0,238]],["6_4_13",[0,14]],["6_16_21",[78,478]],["6_8_13",[0,0]],["6_32_11",[0,0]],["6_20_11",[0,0]],["6_40_18",[28,235]],["6_28_10",[0,1754]],["6_0_14",[0,656]],["6_40_19",[43,244]],["6_60_15",[2,1034]],["6_16_22",[175,555]],["6_48_18",[36,1078]],["6_44_16",[0,124]],["6_36_15",[73,785]],["6_16_23",[166,444]],["6_8_14",[0,252]],["6_44_17",[14,166]],["6_32_12",[0,0]],["6_4_14",[0,854]],["6_60_16",[114,1642]],["6_12_11",[0,398]],["6_40_20",[26,313]],["6_0_15",[0,1458]],["6_60_17",[0,1722]],["6_52_11",[0,191]],["6_16_24",[83,512]],["6_44_18",[12,105]],["6_28_11",[-2,1765]],["6_32_13",[0,0]],["6_44_19",[30,138]],["6_28_12",[0,1666]],["6_40_21",[-25,282]],["6_48_19",[63,775]],["6_12_12",[0,549]],["6_4_15",[19,2327]],["6_36_16",[0,315]],["6_0_16",[0,1330]],["6_32_14",[0,0]],["6_60_18",[0,1711]],["6_48_20",[211,2449]],["6_28_13",[0,1284]],["6_4_16",[20,1409]],["6_48_21",[516,3843]],["6_44_20",[29,784]],["6_36_17",[0,225]],["6_8_15",[0,455]],["6_24_9",[368,12580]],["6_48_22",[828,4149]],["6_16_25",[36,1188]],["6_32_15",[0,0]],["6_44_21",[169,907]],["6_60_19",[0,4630]],["6_20_12",[0,0]],["6_44_22",[122,1046]],["6_28_14",[0,1154]],["6_44_23",[121,4225]],["6_8_16",[32,2504]],["6_12_13",[0,627]],["6_20_13",[0,0]],["6_56_15",[93,2381]],["6_16_26",[0,157]],["6_20_14",[0,588]],["6_32_16",[0,0]],["6_36_18",[0,138]],["6_48_23",[-17,4577]],["6_52_12",[0,165]],["6_28_15",[0,0]],["6_0_17",[0,0]],["6_56_16",[325,2482]],["6_48_24",[722,5681]],["6_12_14",[0,310]],["6_0_18",[0,0]],["6_12_15",[0,523]],["6_40_22",[-31,40]],["6_0_19",[0,0]],["6_60_20",[0,3515]],["6_52_13",[9,413]],["6_0_20",[0,0]],["6_56_17",[94,2601]],["6_48_25",[2645,6487]],["6_40_23",[-28,4249]],["6_12_16",[144,603]],["6_0_21",[0,1593]],["6_40_24",[-39,4640]],["6_48_26",[27,7184]],["6_60_21",[0,2152]],["6_12_17",[157,462]],["6_0_22",[0,0]],["6_40_25",[8,4007]],["6_36_19",[0,227]],["6_52_14",[40,468]],["6_32_17",[0,1292]],["6_60_22",[0,0]],["6_12_18",[166,514]],["6_44_24",[243,7130]],["6_16_27",[0,11]],["6_56_18",[121,2044]],["6_20_15",[0,2104]],["6_16_28",[0,967]],["6_0_23",[0,0]],["6_32_18",[0,1161]],["6_60_23",[0,0]],["6_40_26",[0,3902]],["6_36_20",[22,271]],["6_60_24",[0,0]],["6_60_25",[0,0]],["6_32_19",[0,22]],["6_0_24",[0,0]],["6_48_27",[0,3558]],["6_24_10",[508,7191]],["6_40_27",[0,1161]],["6_52_15",[74,429]],["6_60_26",[0,0]],["6_20_16",[-2,1811]],["6_28_16",[0,2019]],["6_48_28",[0,2972]],["6_12_19",[208,863]],["6_40_28",[168,1454]],["6_32_20",[0,84]],["6_48_29",[0,631]],["6_4_17",[22,3174]],["6_32_21",[0,578]],["6_52_16",[73,683]],["6_0_25",[0,0]],["6_36_21",[112,1245]],["6_60_27",[0,0]],["6_48_30",[0,510]],["6_28_17",[0,1557]],["6_40_29",[0,2395]],["6_60_28",[0,0]],["6_4_18",[0,3346]],["6_60_29",[0,0]],["6_52_17",[95,435]],["6_20_17",[-77,1136]],["6_0_26",[0,0]],["6_12_20",[401,765]],["6_40_30",[0,2348]],["6_32_22",[35,1735]],["6_48_31",[0,1887]],["6_52_18",[131,1611]],["6_56_19",[0,1826]],["6_16_29",[0,2807]],["6_20_18",[0,1499]],["6_12_21",[500,1951]],["6_56_20",[0,1966]],["6_48_32",[0,0]],["6_0_27",[0,0]],["6_36_22",[6,2402]],["6_8_17",[518,2744]],["6_60_30",[0,630]],["6_12_22",[675,3696]],["6_28_18",[0,0]],["6_32_23",[0,3143]],["6_20_19",[0,1407]],["6_48_33",[0,0]],["6_12_23",[1110,4012]],["6_16_30",[0,2037]],["6_8_18",[1,2271]],["6_20_20",[78,913]],["6_20_21",[0,1236]],["6_28_19",[0,0]],["6_32_24",[0,1572]],["6_40_31",[0,483]],["6_12_24",[1020,4094]],["6_60_31",[0,353]],["6_0_28",[0,0]],["6_20_22",[0,1106]],["6_40_32",[0,0]],["6_16_31",[0,0]],["6_56_21",[0,1994]],["6_4_19",[0,2258]],["6_8_19",[0,2848]],["6_20_23",[0,188]],["6_16_32",[0,614]],["6_32_25",[0,2073]],["6_36_23",[0,2709]],["6_12_25",[260,3625]],["6_28_20",[0,0]],["6_20_24",[0,0]],["6_32_26",[151,801]],["6_0_29",[0,0]],["6_36_24",[0,2288]],["6_44_25",[167,7389]],["6_8_20",[0,2061]],["6_16_33",[0,0]],["6_28_21",[0,0]],["6_48_34",[0,0]],["6_12_26",[0,2932]],["6_36_25",[0,2310]],["6_60_32",[0,0]],["6_8_21",[0,541]],["6_32_27",[127,2635]],["6_8_22",[0,0]],["6_36_26",[-84,251]],["6_8_23",[0,0]],["6_16_34",[0,0]],["6_32_28",[277,878]],["6_40_33",[0,0]],["6_52_19",[190,2788]],["6_4_20",[0,0]],["6_12_27",[0,3105]],["6_48_35",[0,0]],["6_52_20",[493,2510]],["6_32_29",[151,461]],["6_16_35",[0,0]],["6_20_25",[0,0]],["6_8_24",[0,0]],["6_28_22",[0,0]],["6_60_33",[0,2164]],["6_52_21",[435,1635]],["6_8_25",[0,0]],["6_52_22",[528,1645]],["6_0_30",[0,0]],["6_36_27",[72,1475]],["6_44_26",[34,3290]],["6_56_22",[0,1921]],["6_52_23",[358,2131]],["6_16_36",[0,0]],["6_60_34",[0,0]],["6_20_26",[0,0]],["6_44_27",[0,1592]],["6_12_28",[0,886]],["6_32_30",[0,925]],["6_44_28",[0,838]],["6_28_23",[0,0]],["6_56_23",[0,1354]],["6_44_29",[0,0]],["6_8_26",[0,0]],["6_40_34",[0,2724]],["6_52_24",[-5,2949]],["6_44_30",[0,0]],["6_0_31",[0,0]],["6_36_28",[314,1800]],["6_32_31",[0,15]],["6_4_21",[0,0]],["6_52_25",[9,1728]],["6_36_29",[420,2881]],["6_8_27",[0,0]],["6_56_24",[0,2700]],["6_52_26",[-1,2081]],["6_16_37",[0,0]],["6_12_29",[0,0]],["6_36_30",[389,1303]],["6_60_35",[0,0]],["6_48_36",[0,0]],["6_4_22",[0,0]],["6_32_32",[0,3]],["6_24_11",[420,7267]],["6_44_31",[0,0]],["6_20_27",[0,0]],["6_28_24",[0,0]],["6_16_38",[0,0]],["6_44_32",[0,0]],["6_52_27",[-9,1947]],["6_36_31",[353,1020]],["6_0_32",[0,0]],["6_8_28",[0,0]],["6_4_23",[0,0]],["6_56_25",[0,3615]],["6_60_36",[0,0]],["6_32_33",[0,0]],["6_4_24",[0,0]],["6_52_28",[-7,591]],["6_12_30",[0,0]],["6_0_33",[0,0]],["6_40_35",[0,2478]],["6_8_29",[0,0]],["6_48_37",[0,0]],["6_52_29",[0,0]],["6_36_32",[367,1566]],["6_4_25",[0,0]],["6_32_34",[0,0]],["6_56_26",[0,0]],["6_28_25",[0,1637]],["6_8_30",[0,0]],["6_56_27",[0,0]],["6_48_38",[0,0]],["6_16_39",[0,0]],["6_24_12",[468,7228]],["6_20_28",[0,1188]],["6_56_28",[0,0]],["6_44_33",[0,0]],["6_12_31",[0,0]],["6_56_29",[0,0]],["6_4_26",[0,0]],["6_40_36",[0,2530]],["6_28_26",[0,2285]],["6_36_33",[550,1907]],["6_32_35",[0,0]],["6_48_39",[0,0]],["6_8_31",[0,0]],["6_0_34",[0,398]],["6_4_27",[0,0]],["6_52_30",[0,3863]],["6_44_34",[0,0]],["6_56_30",[0,0]],["6_36_34",[490,1620]],["6_20_29",[0,0]],["6_56_31",[0,0]],["6_24_13",[542,12639]],["6_60_37",[0,350]],["6_48_40",[0,0]],["6_52_31",[0,2419]],["6_0_35",[0,1019]],["6_52_32",[0,2008]],["6_44_35",[0,0]],["6_24_14",[-147,12779]],["6_4_28",[0,4124]],["6_16_40",[0,0]],["6_8_32",[0,0]],["6_52_33",[0,3487]],["6_12_32",[0,0]],["6_40_37",[0,0]],["6_48_41",[0,0]],["6_36_35",[486,1467]],["6_32_36",[0,0]],["6_20_30",[0,2449]],["6_28_27",[0,11]],["6_0_36",[0,0]],["6_52_34",[0,0]],["6_56_32",[0,4621]],["6_16_41",[0,0]],["6_0_37",[0,353]],["6_8_33",[0,0]],["6_36_36",[751,1967]],["6_40_38",[0,0]],["6_48_42",[0,0]],["6_44_36",[0,0]],["6_4_29",[0,0]],["6_32_37",[0,0]],["6_28_28",[0,12]],["6_24_15",[142,4671]],["6_16_42",[0,0]],["6_60_38",[0,0]],["6_20_31",[31,2750]],["6_12_33",[0,0]],["6_52_35",[0,709]],["6_8_34",[0,0]],["6_36_37",[712,2937]],["6_40_39",[0,0]],["6_20_32",[23,701]],["6_16_43",[0,0]],["6_36_38",[0,2300]],["6_48_43",[0,0]],["6_32_38",[0,0]],["6_44_37",[0,0]],["6_56_33",[0,96]],["6_20_33",[38,1076]],["6_28_29",[0,19]],["6_4_30",[0,0]],["6_60_39",[0,0]],["6_52_36",[0,1119]],["6_0_38",[0,0]],["6_20_34",[128,4214]],["6_8_35",[0,0]],["6_60_40",[0,0]],["6_56_34",[0,307]],["6_12_34",[0,0]],["6_48_44",[0,0]],["6_28_30",[0,0]],["6_32_39",[0,0]],["6_16_44",[0,0]],["6_0_39",[0,0]],["6_40_40",[0,0]],["6_8_36",[0,0]],["6_4_31",[0,0]],["6_24_16",[0,4978]],["6_44_38",[0,0]],["6_52_37",[0,490]],["6_60_41",[0,0]],["6_20_35",[197,5686]],["6_56_35",[0,562]],["6_24_17",[0,12078]],["6_0_40",[0,8]],["6_44_39",[0,0]],["6_32_40",[0,0]],["6_28_31",[0,0]],["6_48_45",[0,0]],["6_8_37",[0,0]],["6_4_32",[0,0]],["6_20_36",[149,6114]],["6_60_42",[0,0]],["6_16_45",[0,0]],["6_40_41",[0,767]],["6_12_35",[0,0]],["6_52_38",[0,707]],["6_28_32",[0,0]],["6_24_18",[0,2505]],["6_4_33",[0,0]],["6_44_40",[0,0]],["6_24_19",[0,0]],["6_48_46",[0,0]],["6_20_37",[63,5265]],["6_32_41",[0,0]],["6_24_20",[0,0]],["6_12_36",[0,0]],["6_40_42",[0,0]],["6_8_38",[0,0]],["6_16_46",[0,0]],["6_60_43",[0,372]],["6_0_41",[0,0]],["6_20_38",[81,2644]],["6_44_41",[0,643]],["6_52_39",[0,0]],["6_28_33",[0,0]],["6_20_39",[0,1014]],["6_48_47",[0,392]],["6_56_36",[-4,988]],["6_36_39",[0,0]],["6_4_34",[0,0]],["6_32_42",[0,0]],["6_24_21",[0,0]],["6_48_48",[0,2330]],["6_40_43",[0,0]],["6_8_39",[0,0]],["6_60_44",[0,0]],["6_0_42",[0,0]],["6_8_40",[0,0]],["6_56_37",[-20,972]],["6_32_43",[0,676]],["6_20_40",[0,1541]],["6_16_47",[0,0]],["6_52_40",[0,0]],["6_36_40",[0,0]],["6_24_22",[0,0]],["6_44_42",[0,1340]],["6_60_45",[0,0]],["6_0_43",[0,0]],["6_48_49",[814,3892]],["6_40_44",[0,0]],["6_28_34",[0,0]],["6_4_35",[0,0]],["6_28_35",[0,0]],["6_56_38",[0,854]],["6_52_41",[0,0]],["6_20_41",[0,639]],["6_40_45",[0,0]],["6_36_41",[0,0]],["6_0_44",[0,0]],["6_12_37",[0,440]],["6_48_50",[2020,6377]],["6_24_23",[0,0]],["6_28_36",[0,0]],["6_8_41",[0,0]],["6_44_43",[0,0]],["6_60_46",[0,0]],["6_32_44",[0,0]],["6_4_36",[0,0]],["6_40_46",[0,0]],["6_16_48",[0,0]],["6_28_37",[0,0]],["6_52_42",[0,0]],["6_36_42",[0,0]],["6_0_45",[0,0]],["6_56_39",[0,62]],["6_60_47",[0,0]],["6_24_24",[0,0]],["6_32_45",[0,0]],["6_16_49",[0,0]],["6_20_42",[0,35]],["6_44_44",[0,0]],["6_8_42",[0,0]],["6_48_51",[365,13720]],["6_52_43",[0,0]],["6_4_37",[0,0]],["6_56_40",[0,0]],["6_12_38",[0,0]],["6_24_25",[0,0]],["6_60_48",[0,0]],["6_24_26",[0,0]],["6_40_47",[0,1015]],["6_36_43",[0,0]],["6_20_43",[0,988]],["6_44_45",[0,0]],["6_0_46",[0,0]],["6_12_39",[0,0]],["6_16_50",[0,0]],["6_52_44",[0,0]],["6_8_43",[0,0]],["6_28_38",[0,0]],["6_40_48",[0,2624]],["6_32_46",[0,0]],["6_60_49",[0,2427]],["6_36_44",[0,0]],["6_44_46",[0,0]],["6_56_41",[0,0]],["6_24_27",[0,0]],["6_4_38",[0,0]],["6_0_47",[0,0]],["6_48_52",[554,13723]],["6_60_50",[0,3259]],["6_20_44",[0,343]],["6_16_51",[0,3613]],["6_60_51",[1054,4463]],["6_40_49",[1151,3316]],["6_28_39",[0,0]],["6_8_44",[0,0]],["6_36_45",[0,0]],["6_52_45",[0,0]],["6_16_52",[14,4923]],["6_20_45",[0,0]],["6_32_47",[0,0]],["6_24_28",[0,0]],["6_56_42",[0,0]],["6_48_53",[465,13028]],["6_8_45",[0,0]],["6_12_40",[0,0]],["6_0_48",[0,0]],["6_4_39",[0,0]],["6_52_46",[0,0]],["6_0_49",[0,0]],["6_28_40",[0,0]],["6_60_52",[0,3534]],["6_44_47",[0,0]],["6_56_43",[0,0]],["6_40_50",[1057,3106]],["6_60_53",[-35,3059]],["6_20_46",[0,1904]],["6_36_46",[0,0]],["6_32_48",[0,0]],["6_16_53",[24,4851]],["6_44_48",[0,1907]],["6_24_29",[0,0]],["6_12_41",[0,0]],["6_28_41",[0,0]],["6_8_46",[0,0]],["6_4_40",[0,0]],["6_52_47",[0,2675]],["6_0_50",[0,0]],["6_56_44",[0,0]],["6_60_54",[0,3933]],["6_32_49",[0,87]],["6_44_49",[-142,2775]],["6_24_30",[0,0]],["6_20_47",[0,2722]],["6_40_51",[1194,7588]],["6_4_41",[0,0]],["6_16_54",[9,3605]],["6_32_50",[0,2987]],["6_12_42",[0,0]],["6_0_51",[0,0]],["6_48_54",[210,14290]],["6_8_47",[0,0]],["6_56_45",[0,0]],["6_28_42",[0,0]],["6_36_47",[0,0]],["6_60_55",[0,3872]],["6_44_50",[0,1477]],["6_32_51",[434,12435]],["6_0_52",[0,0]],["6_4_42",[0,0]],["6_52_48",[0,3295]],["6_8_48",[0,0]],["6_12_43",[0,0]],["6_16_55",[301,4808]],["6_40_52",[470,6135]],["6_60_56",[-13,3133]],["6_20_48",[-16,2374]],["6_8_49",[0,0]],["6_0_53",[0,0]],["6_36_48",[0,0]],["6_44_51",[16,2714]],["6_56_46",[0,0]],["6_4_43",[0,0]],["6_28_43",[0,0]],["6_52_49",[1094,3050]],["6_12_44",[0,0]],["6_48_55",[525,13433]],["6_0_54",[0,0]],["6_36_49",[0,3232]],["6_24_31",[0,0]],["6_60_57",[0,3491]],["6_56_47",[0,817]],["6_40_53",[2471,12510]],["6_12_45",[0,0]],["6_20_49",[0,3117]],["6_4_44",[0,0]],["6_20_50",[0,3003]],["6_16_56",[688,2592]],["6_28_44",[0,0]],["6_24_32",[0,1026]],["6_40_54",[0,7309]],["6_60_58",[0,3174]],["6_32_52",[276,13384]],["6_44_52",[0,5044]],["6_8_50",[0,0]],["6_48_56",[175,5523]],["6_12_46",[0,0]],["6_0_55",[0,0]],["6_24_33",[91,1231]],["6_20_51",[0,3031]],["6_16_57",[-81,11830]],["6_52_50",[1343,3738]],["6_4_45",[0,0]],["6_16_58",[-219,11974]],["6_24_34",[50,1807]],["6_56_48",[0,2778]],["6_56_49",[645,4096]],["6_12_47",[0,0]],["6_48_57",[517,13908]],["6_60_59",[-55,3174]],["6_8_51",[0,0]],["6_0_56",[0,0]],["6_44_53",[0,5756]],["6_36_50",[0,2911]],["6_24_35",[0,2655]],["6_40_55",[0,8907]],["6_28_45",[0,0]],["6_32_53",[1395,11656]],["6_12_48",[0,0]],["6_20_52",[0,2835]],["6_52_51",[185,13045]],["6_24_36",[0,2601]],["6_44_54",[0,885]],["6_56_50",[1560,3152]],["6_8_52",[0,2468]],["6_0_57",[0,0]],["6_28_46",[0,0]],["6_48_58",[2104,13692]],["6_60_60",[0,4228]],["6_36_51",[1900,3326]],["6_24_37",[0,0]],["6_32_54",[1231,6715]],["6_40_56",[0,7784]],["6_4_46",[0,0]],["6_24_38",[0,0]],["6_52_52",[86,13187]],["6_20_53",[0,1684]],["6_56_51",[57,2899]],["6_12_49",[0,0]],["6_24_39",[0,0]],["6_0_58",[0,0]],["6_44_55",[0,0]],["6_36_52",[593,13584]],["6_60_61",[0,0]],["6_4_47",[0,0]],["6_48_59",[1539,6753]],["6_40_57",[-4,7549]],["6_8_53",[10,12171]],["6_52_53",[60,5594]],["6_16_59",[-921,2409]],["6_0_59",[0,0]],["6_32_55",[846,7866]],["6_28_47",[0,0]],["6_56_52",[0,4445]],["6_20_54",[0,0]],["6_44_56",[0,3157]],["6_24_40",[0,0]],["6_48_60",[0,5730]],["6_12_50",[0,0]],["6_0_60",[0,0]],["6_28_48",[0,0]],["6_4_48",[0,0]],["6_16_60",[-263,1876]],["6_40_58",[0,0]],["6_20_55",[0,172]],["6_8_54",[117,12130]],["6_60_62",[0,0]],["6_16_61",[0,0]],["6_32_56",[2081,6010]],["6_44_57",[1275,13810]],["6_56_53",[2201,6027]],["6_52_54",[272,4617]],["6_12_51",[0,0]],["6_4_49",[0,0]],["6_48_61",[0,0]],["6_16_62",[0,0]],["6_0_61",[0,0]],["6_36_53",[1969,13530]],["6_44_58",[923,8603]],["6_32_57",[2111,12346]],["6_52_55",[2201,4383]],["6_8_55",[9,11416]],["6_40_59",[0,0]],["6_24_41",[0,0]],["6_60_63",[0,0]],["6_28_49",[0,0]],["6_61_0",[0,0]],["6_20_56",[0,0]],["6_16_63",[0,0]],["6_12_52",[0,2595]],["6_48_62",[0,0]],["6_0_62",[0,0]],["6_56_54",[1606,5352]],["6_40_60",[0,0]],["6_24_42",[0,0]],["6_52_56",[523,13248]],["6_61_1",[0,0]],["6_28_50",[0,0]],["6_12_53",[-16,10965]],["6_36_54",[363,13474]],["6_44_59",[1608,8492]],["6_8_56",[9,11552]],["6_20_57",[0,0]],["6_4_50",[0,0]],["6_17_0",[0,0]],["6_0_63",[0,0]],["6_24_43",[0,0]],["6_8_57",[5,5057]],["6_32_58",[1415,12433]],["6_48_63",[0,0]],["6_56_55",[1863,6227]],["6_4_51",[0,0]],["6_20_58",[-2,685]],["6_52_57",[1344,4094]],["6_61_2",[0,0]],["6_44_60",[0,5626]],["6_40_61",[0,0]],["6_1_0",[0,0]],["6_24_44",[0,0]],["6_28_51",[0,0]],["6_17_1",[0,0]],["6_12_54",[-157,12153]],["6_56_56",[2306,4828]],["6_36_55",[986,13417]],["6_52_58",[328,13202]],["6_49_0",[0,0]],["6_44_61",[0,0]],["6_61_3",[0,0]],["6_40_62",[0,0]],["6_36_56",[403,13885]],["6_4_52",[0,0]],["6_20_59",[-194,648]],["6_24_45",[0,414]],["6_8_58",[-147,10842]],["6_17_2",[0,0]],["6_40_63",[0,0]],["6_32_59",[1426,7362]],["6_56_57",[2312,2552]],["6_61_4",[0,0]],["6_28_52",[0,805]],["6_20_60",[-38,741]],["6_49_1",[0,0]],["6_36_57",[0,3331]],["6_1_1",[0,0]],["6_44_62",[0,0]],["6_17_3",[0,896]],["6_8_59",[-418,1196]],["6_41_0",[0,0]],["6_20_61",[0,0]],["6_24_46",[0,0]],["6_56_58",[1732,2634]],["6_52_59",[718,4102]],["6_28_53",[0,4003]],["6_12_55",[-72,11771]],["6_4_53",[0,0]],["6_61_5",[0,0]],["6_17_4",[0,1975]],["6_1_2",[0,0]],["6_49_2",[0,0]],["6_41_1",[0,0]],["6_44_63",[0,0]],["6_56_59",[1568,2592]],["6_36_58",[0,7050]],["6_32_60",[0,7471]],["6_20_62",[0,0]],["6_17_5",[0,1936]],["6_24_47",[0,0]],["6_49_3",[0,0]],["6_1_3",[0,0]],["6_61_6",[0,0]],["6_17_6",[0,1608]],["6_4_54",[0,1418]],["6_8_60",[-410,1245]],["6_61_7",[0,0]],["6_12_56",[-3,11815]],["6_41_2",[0,0]],["6_1_4",[0,0]],["6_32_61",[0,0]],["6_28_54",[-70,11614]],["6_24_48",[0,0]],["6_36_59",[0,6507]],["6_49_4",[0,0]],["6_20_63",[0,0]],["6_56_60",[0,2637]],["6_17_7",[0,1803]],["6_4_55",[0,1552]],["6_8_61",[0,0]],["6_52_60",[0,6331]],["6_61_8",[0,0]],["6_1_5",[0,0]],["6_49_5",[0,26]],["6_36_60",[0,0]],["6_17_8",[0,2219]],["6_24_49",[0,0]],["6_32_62",[0,0]],["6_21_0",[0,0]],["6_12_57",[4,12618]],["6_41_3",[0,0]],["6_28_55",[-193,11937]],["6_17_9",[0,1779]],["6_1_6",[0,0]],["6_61_9",[0,0]],["6_45_0",[0,0]],["6_56_61",[0,0]],["6_24_50",[0,0]],["6_1_7",[0,0]],["6_21_1",[0,0]],["6_8_62",[0,0]],["6_61_10",[0,0]],["6_49_6",[0,671]],["6_17_10",[0,1641]],["6_41_4",[0,0]],["6_52_61",[0,0]],["6_4_56",[0,116]],["6_8_63",[0,0]],["6_36_61",[0,0]],["6_28_56",[511,1699]],["6_61_11",[0,0]],["6_32_63",[0,0]],["6_21_2",[0,0]],["6_45_1",[0,0]],["6_9_0",[0,0]],["6_17_11",[0,2126]],["6_12_58",[0,11961]],["6_1_8",[0,0]],["6_52_62",[0,0]],["6_17_12",[0,1667]],["6_56_62",[0,0]],["6_61_12",[0,0]],["6_17_13",[-1,1e3]],["6_61_13",[0,0]],["6_41_5",[0,490]],["6_36_62",[0,0]],["6_21_3",[0,0]],["6_49_7",[0,1002]],["6_17_14",[0,609]],["6_28_57",[408,1694]],["6_24_51",[0,0]],["6_17_15",[0,396]],["6_49_8",[0,1025]],["6_61_14",[0,1495]],["6_33_0",[0,0]],["6_17_16",[0,592]],["6_45_2",[0,0]],["6_4_57",[-6,528]],["6_21_4",[0,1070]],["6_56_63",[0,0]],["6_17_17",[0,166]],["6_28_58",[660,11644]],["6_49_9",[0,54]],["6_52_63",[0,0]],["6_9_1",[0,0]],["6_17_18",[0,0]],["6_49_10",[0,607]],["6_49_11",[3,658]],["6_1_9",[0,0]],["6_36_63",[0,0]],["6_49_12",[5,651]],["6_41_6",[0,718]],["6_49_13",[7,409]],["6_17_19",[0,24]],["6_49_14",[43,1569]],["6_45_3",[0,0]],["6_1_10",[0,0]],["6_12_59",[228,2473]],["6_61_15",[35,1660]],["6_4_58",[-293,808]],["6_24_52",[0,0]],["6_21_5",[0,1591]],["6_28_59",[395,2654]],["6_17_20",[0,138]],["6_61_16",[77,1719]],["6_49_15",[189,1463]],["6_17_21",[0,345]],["6_17_22",[173,635]],["6_53_0",[0,0]],["6_33_1",[0,0]],["6_37_0",[0,0]],["6_41_7",[0,491]],["6_57_0",[0,0]],["6_49_16",[94,1013]],["6_9_2",[0,0]],["6_1_11",[0,0]],["6_61_17",[0,1409]],["6_17_23",[70,707]],["6_45_4",[0,0]],["6_1_12",[0,0]],["6_49_17",[74,875]],["6_17_24",[129,1638]],["6_24_53",[0,0]],["6_9_3",[0,0]],["6_21_6",[0,1785]],["6_4_59",[0,814]],["6_1_13",[0,0]],["6_33_2",[0,0]],["6_49_18",[124,784]],["6_37_1",[0,0]],["6_41_8",[0,0]],["6_1_14",[0,0]],["6_28_60",[0,2969]],["6_49_19",[107,940]],["6_57_1",[0,0]],["6_45_5",[0,0]],["6_17_25",[0,1901]],["6_61_18",[0,1216]],["6_49_20",[281,2993]],["6_53_1",[0,0]],["6_41_9",[0,0]],["6_49_21",[707,3289]],["6_41_10",[0,0]],["6_17_26",[0,117]],["6_49_22",[1065,3832]],["6_41_11",[0,993]],["6_4_60",[-9,435]],["6_1_15",[0,935]],["6_61_19",[0,855]],["6_37_2",[0,0]],["6_49_23",[427,3902]],["6_9_4",[0,0]],["6_1_16",[0,1099]],["6_24_54",[0,860]],["6_41_12",[0,1213]],["6_17_27",[0,1028]],["6_49_24",[947,5558]],["6_1_17",[0,584]],["6_53_2",[0,0]],["6_1_18",[0,424]],["6_61_20",[0,632]],["6_21_7",[193,6887]],["6_45_6",[0,0]],["6_49_25",[2200,6096]],["6_33_3",[0,0]],["6_17_28",[0,887]],["6_41_13",[0,578]],["6_28_61",[0,0]],["6_57_2",[0,0]],["6_49_26",[93,6377]],["6_53_3",[0,0]],["6_61_21",[0,0]],["6_4_61",[0,0]],["6_1_19",[0,0]],["6_41_14",[0,418]],["6_45_7",[0,0]],["6_49_27",[62,4457]],["6_37_3",[0,0]],["6_1_20",[0,1456]],["6_49_28",[0,2515]],["6_24_55",[0,4020]],["6_49_29",[0,2025]],["6_61_22",[0,0]],["6_61_23",[0,0]],["6_49_30",[0,1533]],["6_57_3",[0,0]],["6_61_24",[0,0]],["6_17_29",[0,610]],["6_33_4",[0,0]],["6_1_21",[0,1372]],["6_12_60",[0,2032]],["6_49_31",[0,3334]],["6_45_8",[0,0]],["6_61_25",[0,0]],["6_41_15",[0,424]],["6_1_22",[0,0]],["6_61_26",[0,0]],["6_28_62",[0,0]],["6_4_62",[0,0]],["6_53_4",[0,0]],["6_24_56",[0,2293]],["6_9_5",[0,0]],["6_37_4",[0,0]],["6_57_4",[0,0]],["6_41_16",[8,367]],["6_49_32",[0,2781]],["6_12_61",[0,0]],["6_61_27",[0,0]],["6_1_23",[0,0]],["6_41_17",[56,487]],["6_49_33",[0,0]],["6_21_8",[346,11329]],["6_45_9",[0,0]],["6_53_5",[0,0]],["6_1_24",[0,0]],["6_1_25",[0,0]],["6_17_30",[0,3657]],["6_4_63",[0,0]],["6_49_34",[0,0]],["6_28_63",[0,0]],["6_24_57",[0,722]],["6_17_31",[0,2543]],["6_1_26",[0,0]],["6_17_32",[0,6052]],["6_9_6",[0,0]],["6_49_35",[0,0]],["6_45_10",[0,0]],["6_5_0",[0,0]],["6_33_5",[0,0]],["6_45_11",[0,0]],["6_57_5",[0,0]],["6_24_58",[0,875]],["6_29_0",[0,0]],["6_41_18",[98,324]],["6_17_33",[0,3951]],["6_45_12",[0,15]],["6_61_28",[0,0]],["6_45_13",[0,48]],["6_1_27",[0,0]],["6_17_34",[0,0]],["6_45_14",[0,82]],["6_9_7",[0,0]],["6_61_29",[0,0]],["6_45_15",[0,56]],["6_37_5",[0,0]],["6_33_6",[0,0]],["6_45_16",[7,97]],["6_49_36",[0,0]],["6_5_1",[0,0]],["6_24_59",[0,1229]],["6_57_6",[0,0]],["6_45_17",[27,130]],["6_53_6",[0,0]],["6_37_6",[0,581]],["6_21_9",[559,11586]],["6_1_28",[0,0]],["6_49_37",[0,0]],["6_61_30",[0,0]],["6_29_1",[0,0]],["6_17_35",[0,0]],["6_45_18",[25,132]],["6_49_38",[0,0]],["6_41_19",[51,315]],["6_12_62",[0,0]],["6_53_7",[0,0]],["6_45_19",[52,154]],["6_41_20",[45,585]],["6_33_7",[0,867]],["6_1_29",[0,0]],["6_17_36",[0,0]],["6_9_8",[0,0]],["6_29_2",[0,0]],["6_41_21",[-11,561]],["6_37_7",[0,538]],["6_41_22",[-33,239]],["6_24_60",[0,1352]],["6_57_7",[0,0]],["6_41_23",[-134,462]],["6_41_24",[-42,3535]],["6_21_10",[0,2913]],["6_61_31",[0,0]],["6_45_20",[30,170]],["6_17_37",[0,0]],["6_57_8",[0,0]],["6_33_8",[0,982]],["6_61_32",[0,0]],["6_41_25",[-28,5356]],["6_12_63",[0,0]],["6_5_2",[0,0]],["6_1_30",[0,0]],["6_49_39",[0,0]],["6_9_9",[0,0]],["6_45_21",[98,1454]],["6_29_3",[0,0]],["6_41_26",[0,4172]],["6_53_8",[0,0]],["6_17_38",[0,1131]],["6_24_61",[0,0]],["6_41_27",[0,1898]],["6_33_9",[0,0]],["6_37_8",[0,63]],["6_21_11",[0,1215]],["6_45_22",[187,1452]],["6_21_12",[0,763]],["6_61_33",[0,490]],["6_5_3",[0,0]],["6_29_4",[0,0]],["6_41_28",[0,1713]],["6_45_23",[337,5451]],["6_13_0",[0,0]],["6_37_9",[0,0]],["6_1_31",[0,0]],["6_57_9",[0,0]],["6_21_13",[0,0]],["6_17_39",[0,0]],["6_45_24",[889,7328]],["6_49_40",[0,0]],["6_45_25",[187,8091]],["6_24_62",[0,0]],["6_33_10",[0,0]],["6_41_29",[0,1404]],["6_37_10",[0,0]],["6_21_14",[0,0]],["6_1_32",[0,0]],["6_53_9",[0,0]],["6_5_4",[0,0]],["6_21_15",[0,1343]],["6_57_10",[0,31]],["6_45_26",[142,6319]],["6_17_40",[0,0]],["6_9_10",[0,0]],["6_45_27",[21,1187]],["6_13_1",[0,0]],["6_37_11",[0,0]],["6_1_33",[0,0]],["6_61_34",[0,1614]],["6_49_41",[0,0]],["6_45_28",[0,1398]],["6_41_30",[0,417]],["6_41_31",[0,0]],["6_45_29",[0,2490]],["6_53_10",[0,0]],["6_33_11",[0,0]],["6_21_16",[0,674]],["6_29_5",[0,1818]],["6_45_30",[0,2489]],["6_21_17",[0,0]],["6_13_2",[0,0]],["6_24_63",[0,0]],["6_41_32",[0,616]],["6_37_12",[0,0]],["6_13_3",[0,0]],["6_17_41",[0,0]],["6_45_31",[0,0]],["6_61_35",[0,1468]],["6_49_42",[0,0]],["6_9_11",[0,58]],["6_5_5",[0,0]],["6_33_12",[0,0]],["6_21_18",[0,0]],["6_25_0",[0,0]],["6_57_11",[0,375]],["6_45_32",[0,0]],["6_37_13",[0,579]],["6_17_42",[0,0]],["6_53_11",[0,0]],["6_1_34",[0,1787]],["6_57_12",[0,375]],["6_9_12",[0,135]],["6_41_33",[0,0]],["6_33_13",[0,0]],["6_29_6",[0,844]],["6_5_6",[0,0]],["6_33_14",[0,0]],["6_21_19",[0,925]],["6_25_1",[0,0]],["6_45_33",[0,0]],["6_9_13",[0,221]],["6_61_36",[0,1327]],["6_1_35",[0,46]],["6_49_43",[0,0]],["6_37_14",[0,687]],["6_21_20",[0,1150]],["6_53_12",[0,486]],["6_57_13",[0,516]],["6_17_43",[0,0]],["6_33_15",[0,0]],["6_45_34",[0,0]],["6_25_2",[0,0]],["6_21_21",[0,777]],["6_37_15",[0,1191]],["6_1_36",[0,0]],["6_5_7",[0,0]],["6_25_3",[0,1673]],["6_21_22",[0,769]],["6_41_34",[0,0]],["6_29_7",[0,316]],["6_5_8",[0,0]],["6_21_23",[0,14]],["6_13_4",[0,0]],["6_9_14",[0,445]],["6_53_13",[9,395]],["6_61_37",[0,0]],["6_45_35",[0,0]],["6_33_16",[0,636]],["6_57_14",[6,1116]],["6_21_24",[0,0]],["6_1_37",[0,0]],["6_49_44",[0,0]],["6_9_15",[25,650]],["6_5_9",[0,0]],["6_41_35",[0,2753]],["6_17_44",[0,0]],["6_53_14",[16,375]],["6_37_16",[0,525]],["6_45_36",[0,0]],["6_61_38",[0,0]],["6_57_15",[15,2370]],["6_9_16",[25,2262]],["6_53_15",[13,345]],["6_29_8",[0,0]],["6_25_4",[12,1967]],["6_1_38",[0,0]],["6_13_5",[0,0]],["6_37_17",[19,265]],["6_33_17",[0,2355]],["6_37_18",[0,224]],["6_9_17",[66,2552]],["6_49_45",[0,0]],["6_17_45",[0,0]],["6_53_16",[19,274]],["6_5_10",[0,0]],["6_41_36",[0,0]],["6_21_25",[0,0]],["6_45_37",[0,0]],["6_53_17",[61,394]],["6_13_6",[0,0]],["6_49_46",[0,0]],["6_25_5",[174,1846]],["6_61_39",[0,0]],["6_29_9",[0,0]],["6_33_18",[0,2251]],["6_1_39",[0,0]],["6_53_18",[107,1224]],["6_37_19",[16,289]],["6_5_11",[0,0]],["6_17_46",[0,0]],["6_9_18",[210,2312]],["6_57_16",[168,2829]],["6_45_38",[0,0]],["6_33_19",[0,998]],["6_49_47",[0,2876]],["6_53_19",[181,2413]],["6_29_10",[0,0]],["6_1_40",[0,0]],["6_37_20",[119,257]],["6_41_37",[0,0]],["6_21_26",[0,0]],["6_17_47",[0,0]],["6_25_6",[350,3186]],["6_57_17",[548,2789]],["6_9_19",[158,2760]],["6_13_7",[0,36]],["6_5_12",[0,0]],["6_37_21",[69,297]],["6_29_11",[0,0]],["6_1_41",[0,0]],["6_37_22",[0,387]],["6_33_20",[0,123]],["6_21_27",[0,0]],["6_57_18",[0,2462]],["6_49_48",[0,4826]],["6_41_38",[0,0]],["6_17_48",[0,0]],["6_13_8",[0,204]],["6_25_7",[34,3510]],["6_53_20",[260,1881]],["6_29_12",[0,0]],["6_45_39",[0,731]],["6_53_21",[304,1456]],["6_61_40",[0,2550]],["6_29_13",[0,0]],["6_13_9",[0,78]],["6_37_23",[0,2273]],["6_33_21",[-59,1088]],["6_57_19",[0,1081]],["6_41_39",[0,0]],["6_53_22",[136,1670]],["6_1_42",[0,0]],["6_5_13",[0,0]],["6_17_49",[0,0]],["6_53_23",[-71,1866]],["6_5_14",[0,2104]],["6_29_14",[0,0]],["6_49_49",[918,4293]],["6_21_28",[0,0]],["6_57_20",[0,874]],["6_41_40",[0,0]],["6_53_24",[-4,1688]],["6_45_40",[0,0]],["6_37_24",[0,2877]],["6_53_25",[-1,936]],["6_9_20",[0,2480]],["6_25_8",[402,11545]],["6_1_43",[0,0]],["6_37_25",[0,2875]],["6_17_50",[0,1042]],["6_57_21",[0,1417]],["6_13_10",[0,400]],["6_61_41",[0,1770]],["6_53_26",[0,1732]],["6_57_22",[0,1414]],["6_5_15",[110,2299]],["6_49_50",[1120,3339]],["6_33_22",[8,4526]],["6_29_15",[0,9]],["6_53_27",[-1,3687]],["6_17_51",[-10,2453]],["6_5_16",[48,1556]],["6_41_41",[0,846]],["6_13_11",[0,157]],["6_45_41",[0,0]],["6_21_29",[0,1267]],["6_1_44",[0,0]],["6_25_9",[400,12313]],["6_5_17",[16,5985]],["6_57_23",[0,2130]],["6_33_23",[0,3724]],["6_29_16",[0,1884]],["6_61_42",[0,578]],["6_53_28",[0,2639]],["6_37_26",[-51,1906]],["6_25_10",[470,12554]],["6_9_21",[0,3653]],["6_41_42",[0,0]],["6_13_12",[0,175]],["6_9_22",[0,1999]],["6_25_11",[692,5590]],["6_21_30",[0,2058]],["6_57_24",[0,1822]],["6_33_24",[0,1684]],["6_29_17",[0,1978]],["6_53_29",[0,2745]],["6_37_27",[19,1882]],["6_61_43",[0,0]],["6_5_18",[0,3794]],["6_45_42",[0,0]],["6_53_30",[0,2204]],["6_57_25",[0,200]],["6_33_25",[-33,2209]],["6_49_51",[304,6532]],["6_1_45",[0,0]],["6_37_28",[171,1054]],["6_41_43",[0,0]],["6_17_52",[46,10865]],["6_5_19",[0,330]],["6_29_18",[0,0]],["6_61_44",[0,0]],["6_13_13",[0,196]],["6_57_26",[0,0]],["6_45_43",[0,2592]],["6_21_31",[12,2429]],["6_33_26",[137,905]],["6_13_14",[0,197]],["6_37_29",[355,1277]],["6_41_44",[0,0]],["6_53_31",[0,2658]],["6_33_27",[404,2638]],["6_5_20",[0,0]],["6_9_23",[0,1463]],["6_57_27",[0,473]],["6_37_30",[371,1053]],["6_29_19",[0,0]],["6_57_28",[0,807]],["6_5_21",[0,0]],["6_49_52",[53,13566]],["6_33_28",[91,1847]],["6_53_32",[0,3225]],["6_13_15",[0,292]],["6_9_24",[0,1450]],["6_45_44",[0,0]],["6_29_20",[0,0]],["6_61_45",[0,0]],["6_21_32",[1,317]],["6_33_29",[283,731]],["6_37_31",[417,4672]],["6_1_46",[0,0]],["6_29_21",[0,0]],["6_21_33",[42,655]],["6_33_30",[6,2885]],["6_9_25",[0,0]],["6_13_16",[108,436]],["6_13_17",[112,427]],["6_9_26",[0,0]],["6_61_46",[0,0]],["6_21_34",[100,1028]],["6_1_47",[0,0]],["6_29_22",[0,0]],["6_5_22",[0,0]],["6_9_27",[0,0]],["6_53_33",[0,2106]],["6_57_29",[0,471]],["6_5_23",[0,0]],["6_41_45",[0,0]],["6_53_34",[0,223]],["6_17_53",[-38,4222]],["6_13_18",[210,497]],["6_57_30",[0,0]],["6_33_31",[0,3762]],["6_25_12",[228,12305]],["6_13_19",[277,617]],["6_37_32",[641,4165]],["6_49_53",[803,14171]],["6_21_35",[75,1160]],["6_17_54",[0,8849]],["6_45_45",[0,0]],["6_5_24",[0,0]],["6_25_13",[235,12792]],["6_9_28",[0,0]],["6_61_47",[0,0]],["6_13_20",[247,822]],["6_57_31",[0,0]],["6_1_48",[0,0]],["6_21_36",[48,610]],["6_41_46",[0,0]],["6_13_21",[311,877]],["6_61_48",[0,0]],["6_29_23",[0,0]],["6_33_32",[0,877]],["6_25_14",[303,12884]],["6_9_29",[0,0]],["6_53_35",[0,430]],["6_13_22",[452,1418]],["6_5_25",[0,0]],["6_57_32",[0,3749]],["6_25_15",[0,12935]],["6_21_37",[13,254]],["6_17_55",[0,3122]],["6_61_49",[0,578]],["6_41_47",[-1,4282]],["6_25_16",[0,3610]],["6_5_26",[0,0]],["6_25_17",[0,0]],["6_21_38",[0,228]],["6_29_24",[0,0]],["6_13_23",[607,3524]],["6_9_30",[0,0]],["6_1_49",[0,0]],["6_37_33",[517,2718]],["6_45_46",[0,0]],["6_25_18",[0,0]],["6_21_39",[0,679]],["6_53_36",[238,1142]],["6_25_19",[0,0]],["6_13_24",[875,4206]],["6_25_20",[0,0]],["6_5_27",[0,0]],["6_29_25",[0,1263]],["6_45_47",[0,0]],["6_57_33",[0,4231]],["6_33_33",[0,0]],["6_25_21",[0,0]],["6_37_34",[117,1746]],["6_49_54",[219,14051]],["6_13_25",[702,3815]],["6_1_50",[0,0]],["6_21_40",[0,0]],["6_5_28",[0,0]],["6_9_31",[0,0]],["6_57_34",[0,1301]],["6_45_48",[0,452]],["6_17_56",[-33,2395]],["6_53_37",[174,577]],["6_13_26",[335,2806]],["6_17_57",[257,1506]],["6_61_50",[0,5477]],["6_29_26",[0,3462]],["6_25_22",[0,0]],["6_33_34",[0,0]],["6_45_49",[0,2269]],["6_17_58",[-27,10861]],["6_1_51",[0,0]],["6_41_48",[0,4335]],["6_21_41",[0,0]],["6_13_27",[0,3307]],["6_53_38",[0,872]],["6_37_35",[90,2478]],["6_57_35",[0,1482]],["6_5_29",[0,0]],["6_61_51",[-20,3553]],["6_49_55",[871,13751]],["6_25_23",[0,0]],["6_21_42",[0,618]],["6_9_32",[0,0]],["6_13_28",[0,3973]],["6_33_35",[0,0]],["6_29_27",[0,826]],["6_1_52",[0,0]],["6_41_49",[1183,3640]],["6_13_29",[0,0]],["6_17_59",[-27,1841]],["6_45_50",[13,2542]],["6_37_36",[0,2266]],["6_9_33",[0,0]],["6_5_30",[0,0]],["6_49_56",[420,13683]],["6_61_52",[0,2663]],["6_53_39",[0,0]],["6_25_24",[0,0]],["6_57_36",[22,667]],["6_21_43",[0,0]],["6_29_28",[0,779]],["6_13_30",[0,0]],["6_33_36",[0,0]],["6_1_53",[0,0]],["6_41_50",[28,13001]],["6_61_53",[0,0]],["6_53_40",[0,0]],["6_9_34",[0,0]],["6_25_25",[0,0]],["6_5_31",[0,0]],["6_17_60",[0,1728]],["6_45_51",[41,5250]],["6_13_31",[0,0]],["6_37_37",[0,3398]],["6_21_44",[0,0]],["6_57_37",[22,324]],["6_1_54",[0,0]],["6_49_57",[587,13674]],["6_9_35",[0,0]],["6_33_37",[0,0]],["6_53_41",[0,0]],["6_25_26",[0,0]],["6_61_54",[0,3735]],["6_1_55",[0,0]],["6_5_32",[0,0]],["6_21_45",[0,0]],["6_17_61",[0,0]],["6_13_32",[0,0]],["6_41_51",[211,12913]],["6_57_38",[5,310]],["6_29_29",[0,1456]],["6_37_38",[0,1026]],["6_33_38",[0,0]],["6_25_27",[0,0]],["6_45_52",[0,6101]],["6_61_55",[0,2682]],["6_9_36",[0,0]],["6_41_52",[1476,5792]],["6_45_53",[0,6404]],["6_13_33",[0,0]],["6_53_42",[0,0]],["6_21_46",[-3,2139]],["6_17_62",[0,0]],["6_1_56",[0,0]],["6_57_39",[0,1438]],["6_61_56",[0,0]],["6_5_33",[0,0]],["6_21_47",[0,2404]],["6_57_40",[0,1413]],["6_37_39",[0,0]],["6_45_54",[0,1709]],["6_33_39",[0,0]],["6_25_28",[0,0]],["6_17_63",[0,0]],["6_41_53",[1183,6777]],["6_29_30",[0,1369]],["6_21_48",[0,0]],["6_53_43",[0,0]],["6_13_34",[0,0]],["6_5_34",[0,401]],["6_9_37",[0,0]],["6_61_57",[0,0]],["6_1_57",[0,0]],["6_37_40",[0,0]],["6_49_58",[684,13054]],["6_21_49",[0,873]],["6_57_41",[0,0]],["6_18_0",[0,0]],["6_25_29",[0,0]],["6_29_31",[0,0]],["6_33_40",[0,0]],["6_1_58",[0,0]],["6_61_58",[0,0]],["6_53_44",[0,0]],["6_21_50",[0,1373]],["6_45_55",[0,0]],["6_13_35",[0,0]],["6_21_51",[-2,1487]],["6_41_54",[0,6926]],["6_9_38",[0,0]],["6_5_35",[0,1453]],["6_29_32",[0,0]],["6_25_30",[0,0]],["6_1_59",[0,0]],["6_37_41",[0,0]],["6_57_42",[0,0]],["6_33_41",[0,0]],["6_61_59",[0,1531]],["6_1_60",[0,0]],["6_49_59",[1243,6979]],["6_41_55",[2068,13561]],["6_18_1",[0,0]],["6_45_56",[0,1283]],["6_13_36",[0,0]],["6_21_52",[0,1066]],["6_53_45",[0,0]],["6_25_31",[0,0]],["6_61_60",[0,3140]],["6_21_53",[0,0]],["6_1_61",[0,0]],["6_57_43",[0,0]],["6_33_42",[0,0]],["6_25_32",[0,692]],["6_37_42",[0,0]],["6_5_36",[0,0]],["6_29_33",[0,577]],["6_53_46",[0,0]],["6_18_2",[0,0]],["6_9_39",[0,0]],["6_13_37",[0,0]],["6_41_56",[0,7958]],["6_25_33",[0,1132]],["6_41_57",[0,6150]],["6_29_34",[0,0]],["6_49_60",[0,5788]],["6_5_37",[0,0]],["6_1_62",[0,0]],["6_45_57",[647,14080]],["6_25_34",[0,848]],["6_53_47",[0,0]],["6_33_43",[0,0]],["6_37_43",[0,0]],["6_21_54",[0,0]],["6_61_61",[0,0]],["6_9_40",[0,0]],["6_29_35",[0,0]],["6_41_58",[0,0]],["6_18_3",[0,1327]],["6_29_36",[0,0]],["6_25_35",[0,90]],["6_49_61",[0,0]],["6_13_38",[0,0]],["6_61_62",[0,0]],["6_25_36",[0,0]],["6_53_48",[0,2484]],["6_1_63",[0,0]],["6_29_37",[0,0]],["6_33_44",[0,0]],["6_5_38",[0,0]],["6_37_44",[0,0]],["6_21_55",[0,0]],["6_41_59",[0,0]],["6_53_49",[1104,3014]],["6_57_44",[0,0]],["6_13_39",[0,0]],["6_25_37",[0,0]],["6_9_41",[0,0]],["6_2_0",[0,0]],["6_49_62",[0,0]],["6_29_38",[0,0]],["6_18_4",[0,2530]],["6_57_45",[0,0]],["6_2_1",[0,0]],["6_61_63",[0,0]],["6_21_56",[0,0]],["6_37_45",[0,0]],["6_49_63",[0,0]],["6_2_2",[0,0]],["6_13_40",[0,0]],["6_18_5",[0,2548]],["6_45_58",[1584,8601]],["6_25_38",[0,0]],["6_53_50",[792,4591]],["6_62_0",[0,0]],["6_41_60",[0,0]],["6_50_0",[0,0]],["6_9_42",[0,0]],["6_18_6",[0,2161]],["6_33_45",[0,0]],["6_37_46",[0,0]],["6_21_57",[0,0]],["6_29_39",[0,1878]],["6_2_3",[0,0]],["6_57_46",[0,0]],["6_5_39",[0,0]],["6_41_61",[0,0]],["6_13_41",[0,0]],["6_50_1",[0,0]],["6_62_1",[0,0]],["6_45_59",[2290,8795]],["6_25_39",[0,0]],["6_2_4",[0,0]],["6_9_43",[0,0]],["6_33_46",[0,0]],["6_18_7",[0,2210]],["6_13_42",[0,0]],["6_37_47",[0,0]],["6_41_62",[0,0]],["6_62_2",[0,0]],["6_29_40",[0,0]],["6_18_8",[0,1881]],["6_57_47",[0,0]],["6_21_58",[0,0]],["6_50_2",[0,0]],["6_25_40",[0,0]],["6_45_60",[0,5621]],["6_33_47",[0,0]],["6_5_40",[0,0]],["6_62_3",[0,0]],["6_9_44",[0,0]],["6_2_5",[0,0]],["6_53_51",[41,13077]],["6_25_41",[0,0]],["6_21_59",[0,145]],["6_37_48",[0,0]],["6_50_3",[0,0]],["6_41_63",[0,0]],["6_18_9",[0,1239]],["6_45_61",[0,0]],["6_2_6",[0,0]],["6_29_41",[0,0]],["6_57_48",[0,2414]],["6_2_7",[0,0]],["6_37_49",[0,1188]],["6_62_4",[0,0]],["6_45_62",[0,0]],["6_5_41",[0,0]],["6_2_8",[0,0]],["6_53_52",[218,13305]],["6_42_0",[0,0]],["6_50_4",[0,0]],["6_21_60",[0,881]],["6_2_9",[0,0]],["6_9_45",[0,0]],["6_25_42",[0,0]],["6_13_43",[0,0]],["6_62_5",[0,0]],["6_45_63",[0,0]],["6_57_49",[804,2377]],["6_29_42",[0,0]],["6_33_48",[0,0]],["6_18_10",[0,835]],["6_50_5",[0,0]],["6_42_1",[0,0]],["6_2_10",[0,0]],["6_5_42",[0,0]],["6_18_11",[0,0]],["6_13_44",[0,0]],["6_2_11",[0,0]],["6_18_12",[0,1852]],["6_21_61",[0,0]],["6_25_43",[0,2779]],["6_2_12",[0,0]],["6_62_6",[0,0]],["6_46_0",[0,0]],["6_29_43",[0,0]],["6_2_13",[0,0]],["6_9_46",[0,0]],["6_33_49",[0,2362]],["6_42_2",[0,0]],["6_37_50",[0,2255]],["6_57_50",[1845,2511]],["6_18_13",[-12,1815]],["6_53_53",[369,13241]],["6_50_6",[0,0]],["6_21_62",[0,0]],["6_62_7",[0,0]],["6_13_45",[0,0]],["6_2_14",[0,583]],["6_46_1",[0,0]],["6_5_43",[0,0]],["6_25_44",[0,0]],["6_18_14",[0,1208]],["6_57_51",[2276,2653]],["6_18_15",[0,136]],["6_29_44",[0,0]],["6_2_15",[0,923]],["6_9_47",[0,0]],["6_18_16",[0,380]],["6_50_7",[0,173]],["6_42_3",[0,0]],["6_46_2",[0,0]],["6_33_50",[0,3385]],["6_37_51",[1890,3124]],["6_25_45",[0,0]],["6_2_16",[0,1278]],["6_13_46",[0,0]],["6_29_45",[0,0]],["6_5_44",[0,0]],["6_21_63",[0,0]],["6_18_17",[0,660]],["6_9_48",[0,0]],["6_62_8",[0,0]],["6_46_3",[0,0]],["6_2_17",[0,649]],["6_62_9",[0,0]],["6_18_18",[0,598]],["6_42_4",[0,0]],["6_50_8",[-51,1063]],["6_25_46",[0,0]],["6_53_54",[291,5989]],["6_22_0",[0,0]],["6_2_18",[0,466]],["6_9_49",[0,0]],["6_5_45",[0,0]],["6_18_19",[0,358]],["6_37_52",[1395,13530]],["6_62_10",[0,0]],["6_13_47",[0,0]],["6_2_19",[0,0]],["6_46_4",[0,0]],["6_18_20",[0,470]],["6_25_47",[0,0]],["6_18_21",[0,536]],["6_50_9",[0,383]],["6_57_52",[2199,6172]],["6_29_46",[0,0]],["6_62_11",[0,0]],["6_2_20",[0,2562]],["6_42_5",[0,637]],["6_25_48",[0,0]],["6_2_21",[0,0]],["6_37_53",[676,12767]],["6_53_55",[-23,4620]],["6_46_5",[0,0]],["6_33_51",[257,13225]],["6_62_12",[0,0]],["6_2_22",[0,0]],["6_18_22",[9,855]],["6_22_1",[0,0]],["6_50_10",[0,882]],["6_62_13",[0,0]],["6_29_47",[0,0]],["6_9_50",[0,0]],["6_2_23",[0,0]],["6_62_14",[0,1150]],["6_18_23",[0,1473]],["6_13_48",[0,0]],["6_5_46",[0,0]],["6_62_15",[7,1610]],["6_25_49",[0,0]],["6_57_53",[2027,5278]],["6_42_6",[0,609]],["6_37_54",[304,10339]],["6_46_6",[0,327]],["6_33_52",[683,13523]],["6_22_2",[0,0]],["6_50_11",[0,665]],["6_18_24",[0,1155]],["6_53_56",[2020,5716]],["6_50_12",[0,163]],["6_29_48",[0,0]],["6_13_49",[0,0]],["6_2_24",[0,0]],["6_18_25",[0,149]],["6_22_3",[0,359]],["6_9_51",[0,3243]],["6_46_7",[0,0]],["6_22_4",[0,1219]],["6_25_50",[0,0]],["6_62_16",[1,1114]],["6_46_8",[0,0]],["6_5_47",[0,0]],["6_50_13",[5,751]],["6_2_25",[0,0]],["6_29_49",[0,0]],["6_50_14",[18,811]],["6_42_7",[0,586]],["6_62_17",[0,2285]],["6_18_26",[0,0]],["6_53_57",[2915,3126]],["6_25_51",[0,0]],["6_18_27",[0,68]],["6_13_50",[0,1121]],["6_2_26",[0,0]],["6_5_48",[0,0]],["6_50_15",[161,949]],["6_42_8",[0,0]],["6_50_16",[172,954]],["6_57_54",[1901,6014]],["6_9_52",[0,2760]],["6_50_17",[152,846]],["6_46_9",[0,0]],["6_37_55",[566,13720]],["6_2_27",[0,0]],["6_50_18",[184,764]],["6_29_50",[0,1220]],["6_50_19",[187,1160]],["6_46_10",[0,0]],["6_22_5",[0,1587]],["6_42_9",[0,0]],["6_25_52",[0,0]],["6_50_20",[323,2034]],["6_42_10",[0,1195]],["6_46_11",[0,310]],["6_9_53",[622,3370]],["6_50_21",[406,3061]],["6_42_11",[0,1481]],["6_33_53",[1176,7380]],["6_18_28",[0,2076]],["6_50_22",[778,3296]],["6_42_12",[0,1211]],["6_13_51",[0,2872]],["6_2_28",[0,0]],["6_50_23",[694,3444]],["6_53_58",[1044,4077]],["6_57_55",[1324,5328]],["6_42_13",[0,53]],["6_37_56",[781,13866]],["6_46_12",[0,571]],["6_62_18",[0,1551]],["6_50_24",[946,4919]],["6_5_49",[0,0]],["6_18_29",[0,1753]],["6_22_6",[-312,11627]],["6_2_29",[0,0]],["6_42_14",[0,411]],["6_29_51",[0,1833]],["6_50_25",[377,5154]],["6_25_53",[0,0]],["6_46_13",[0,134]],["6_42_15",[0,182]],["6_62_19",[0,0]],["6_37_57",[0,13388]],["6_18_30",[0,5402]],["6_50_26",[121,6872]],["6_2_30",[0,0]],["6_50_27",[35,4013]],["6_46_14",[0,131]],["6_46_15",[0,139]],["6_50_28",[-1,2745]],["6_62_20",[0,852]],["6_42_16",[18,1783]],["6_9_54",[14,12129]],["6_50_29",[0,1795]],["6_46_16",[7,143]],["6_22_7",[-138,11186]],["6_5_50",[0,0]],["6_50_30",[0,1386]],["6_33_54",[299,7815]],["6_25_54",[0,1090]],["6_46_17",[17,199]],["6_29_52",[-47,2705]],["6_53_59",[623,3874]],["6_42_17",[22,1486]],["6_50_31",[0,1997]],["6_57_56",[1694,5434]],["6_62_21",[0,415]],["6_2_31",[0,0]],["6_46_18",[31,141]],["6_13_52",[0,635]],["6_42_18",[11,1499]],["6_50_32",[0,3545]],["6_18_31",[0,5561]],["6_37_58",[0,0]],["6_50_33",[0,1943]],["6_46_19",[46,202]],["6_22_8",[-38,5877]],["6_62_22",[0,0]],["6_57_57",[2096,2339]],["6_25_55",[0,2123]],["6_46_20",[84,364]],["6_9_55",[-40,11694]],["6_29_53",[55,12037]],["6_42_19",[86,833]],["6_62_23",[0,0]],["6_2_32",[0,0]],["6_46_21",[126,2546]],["6_42_20",[-84,1583]],["6_5_51",[0,0]],["6_46_22",[136,3999]],["6_53_60",[0,5562]],["6_50_34",[0,0]],["6_42_21",[93,691]],["6_42_22",[16,585]],["6_37_59",[0,0]],["6_46_23",[136,7162]],["6_62_24",[0,0]],["6_33_55",[554,10487]],["6_62_25",[0,0]],["6_2_33",[0,0]],["6_18_32",[104,5630]],["6_42_23",[1,217]],["6_62_26",[0,0]],["6_53_61",[0,0]],["6_9_56",[-280,12102]],["6_13_53",[18,11237]],["6_62_27",[0,0]],["6_29_54",[682,12229]],["6_46_24",[865,5869]],["6_57_58",[969,8901]],["6_46_25",[1620,6866]],["6_25_56",[0,264]],["6_62_28",[0,0]],["6_50_35",[0,0]],["6_42_24",[30,2979]],["6_42_25",[249,3175]],["6_5_52",[0,0]],["6_46_26",[75,7852]],["6_2_34",[0,0]],["6_18_33",[0,6286]],["6_62_29",[0,0]],["6_42_26",[0,4289]],["6_46_27",[50,1174]],["6_37_60",[0,0]],["6_33_56",[2428,12711]],["6_46_28",[0,1514]],["6_22_9",[24,12804]],["6_42_27",[0,2768]],["6_25_57",[-3,755]],["6_50_36",[0,0]],["6_53_62",[0,0]],["6_46_29",[0,1054]],["6_42_28",[0,219]],["6_42_29",[0,0]],["6_5_53",[0,961]],["6_9_57",[-307,11361]],["6_42_30",[0,0]],["6_57_59",[478,2460]],["6_46_30",[0,2402]],["6_62_30",[0,0]],["6_50_37",[0,0]],["6_18_34",[0,5435]],["6_22_10",[455,11957]],["6_29_55",[541,11875]],["6_33_57",[2477,2846]],["6_18_35",[0,0]],["6_37_61",[0,0]],["6_2_35",[0,0]],["6_42_31",[0,0]],["6_46_31",[0,0]],["6_13_54",[-478,12045]],["6_42_32",[0,0]],["6_25_58",[-323,1223]],["6_33_58",[1406,12504]],["6_18_36",[0,0]],["6_2_36",[0,0]],["6_46_32",[0,0]],["6_46_33",[0,0]],["6_53_63",[0,0]],["6_37_62",[0,0]],["6_62_31",[0,0]],["6_50_38",[0,0]],["6_5_54",[-36,1300]],["6_46_34",[0,0]],["6_57_60",[0,2776]],["6_18_37",[0,0]],["6_22_11",[0,4070]],["6_18_38",[0,0]],["6_25_59",[149,1484]],["6_46_35",[0,0]],["6_22_12",[-2,3923]],["6_9_58",[12,11078]],["6_18_39",[0,1256]],["6_22_13",[-11,10295]],["6_29_56",[767,4672]],["6_42_33",[0,0]],["6_2_37",[0,0]],["6_46_36",[0,0]],["6_54_0",[0,0]],["6_42_34",[0,0]],["6_50_39",[0,0]],["6_62_32",[0,0]],["6_37_63",[0,0]],["6_22_14",[-1,2058]],["6_13_55",[-216,12012]],["6_57_61",[0,0]],["6_18_40",[0,1175]],["6_33_59",[848,6730]],["6_25_60",[0,1530]],["6_22_15",[0,1488]],["6_2_38",[0,0]],["6_18_41",[0,3806]],["6_42_35",[0,718]],["6_5_55",[-27,1604]],["6_9_59",[-566,1566]],["6_46_37",[0,0]],["6_22_16",[0,2061]],["6_18_42",[-6,3419]],["6_54_1",[0,0]],["6_57_62",[0,0]],["6_25_61",[0,0]],["6_29_57",[628,4212]],["6_50_40",[0,0]],["6_62_33",[0,0]],["6_22_17",[0,1420]],["6_46_38",[0,0]],["6_33_60",[0,7335]],["6_2_39",[0,0]],["6_42_36",[0,0]],["6_38_0",[0,0]],["6_18_43",[0,1511]],["6_22_18",[0,0]],["6_22_19",[0,0]],["6_29_58",[954,6947]],["6_9_60",[0,1225]],["6_5_56",[-56,1612]],["6_22_20",[0,147]],["6_25_62",[0,0]],["6_62_34",[0,0]],["6_46_39",[0,0]],["6_50_41",[0,0]],["6_22_21",[0,321]],["6_2_40",[0,0]],["6_5_57",[-1,3733]],["6_42_37",[0,0]],["6_33_61",[0,0]],["6_57_63",[0,0]],["6_18_44",[0,0]],["6_54_2",[0,0]],["6_13_56",[626,12339]],["6_22_22",[0,295]],["6_62_35",[0,841]],["6_9_61",[0,0]],["6_46_40",[0,0]],["6_2_41",[0,0]],["6_58_0",[0,0]],["6_50_42",[0,0]],["6_38_1",[0,0]],["6_25_63",[0,0]],["6_42_38",[0,0]],["6_18_45",[0,0]],["6_22_23",[0,0]],["6_54_3",[0,0]],["6_2_42",[0,0]],["6_33_62",[0,0]],["6_58_1",[0,0]],["6_9_62",[0,0]],["6_5_58",[-52,10478]],["6_29_59",[675,6800]],["6_38_2",[0,0]],["6_46_41",[0,0]],["6_42_39",[0,0]],["6_18_46",[0,0]],["6_2_43",[0,0]],["6_22_24",[0,0]],["6_62_36",[0,0]],["6_29_60",[0,6820]],["6_50_43",[0,0]],["6_54_4",[0,0]],["6_5_59",[-294,1264]],["6_26_0",[0,0]],["6_58_2",[0,0]],["6_33_63",[0,0]],["6_9_63",[0,0]],["6_13_57",[129,12482]],["6_46_42",[0,0]],["6_22_25",[0,0]],["6_18_47",[0,0]],["6_62_37",[0,0]],["6_38_3",[0,0]],["6_29_61",[0,0]],["6_26_1",[0,0]],["6_2_44",[0,0]],["6_58_3",[0,0]],["6_10_0",[0,0]],["6_5_60",[-153,509]],["6_50_44",[0,0]],["6_42_40",[0,0]],["6_54_5",[0,0]],["6_18_48",[0,0]],["6_13_58",[589,11467]],["6_34_0",[0,0]],["6_46_43",[0,0]],["6_2_45",[0,0]],["6_54_6",[0,0]],["6_13_59",[-372,2950]],["6_22_26",[0,0]],["6_18_49",[0,3120]],["6_26_2",[0,0]],["6_38_4",[0,0]],["6_10_1",[0,0]],["6_29_62",[0,0]],["6_5_61",[0,0]],["6_50_45",[0,0]],["6_10_2",[0,0]],["6_46_44",[0,0]],["6_58_4",[0,0]],["6_13_60",[0,2474]],["6_22_27",[0,0]],["6_62_38",[0,685]],["6_42_41",[0,0]],["6_34_1",[0,0]],["6_10_3",[0,0]],["6_2_46",[0,0]],["6_54_7",[0,0]],["6_22_28",[0,0]],["6_29_63",[0,0]],["6_18_50",[0,2744]],["6_38_5",[0,0]],["6_13_61",[0,0]],["6_26_3",[0,1778]],["6_5_62",[0,0]],["6_62_39",[0,2281]],["6_10_4",[0,0]],["6_42_42",[0,0]],["6_46_45",[0,0]],["6_34_2",[0,0]],["6_2_47",[0,0]],["6_22_29",[0,0]],["6_58_5",[0,0]],["6_50_46",[0,0]],["6_5_63",[0,0]],["6_18_51",[-21,3450]],["6_26_4",[0,1496]],["6_10_5",[0,0]],["6_38_6",[0,0]],["6_54_8",[0,0]],["6_30_0",[0,0]],["6_22_30",[0,29]],["6_13_62",[0,0]],["6_42_43",[0,0]],["6_34_3",[0,0]],["6_62_40",[0,3359]],["6_58_6",[0,0]],["6_50_47",[0,3322]],["6_46_46",[0,0]],["6_13_63",[0,0]],["6_50_48",[400,7848]],["6_18_52",[8,4943]],["6_2_48",[0,0]],["6_58_7",[0,0]],["6_54_9",[0,0]],["6_10_6",[0,0]],["6_42_44",[0,0]],["6_22_31",[0,981]],["6_14_0",[0,0]],["6_62_41",[0,2085]],["6_6_0",[0,0]],["6_34_4",[0,0]],["6_30_1",[0,0]],["6_38_7",[0,0]],["6_58_8",[0,0]],["6_46_47",[0,0]],["6_26_5",[0,1402]],["6_42_45",[0,0]],["6_50_49",[1120,6392]],["6_10_7",[0,0]],["6_22_32",[0,808]],["6_2_49",[0,0]],["6_46_48",[0,1810]],["6_18_53",[0,3487]],["6_54_10",[0,0]],["6_14_1",[0,0]],["6_26_6",[738,2998]],["6_22_33",[156,734]],["6_62_42",[0,0]],["6_30_2",[0,0]],["6_38_8",[0,0]],["6_10_8",[0,0]],["6_6_1",[0,0]],["6_42_46",[0,0]],["6_62_43",[0,448]],["6_38_9",[0,0]],["6_22_34",[124,998]],["6_34_5",[0,0]],["6_58_9",[0,0]],["6_46_49",[306,2610]],["6_6_2",[0,0]],["6_2_50",[0,0]],["6_30_3",[0,0]],["6_50_50",[911,4935]],["6_58_10",[0,18]],["6_22_35",[115,999]],["6_18_54",[-8,2232]],["6_58_11",[0,329]],["6_10_9",[0,83]],["6_34_6",[0,0]],["6_38_10",[0,0]],["6_22_36",[94,1327]],["6_14_2",[0,0]],["6_38_11",[0,0]],["6_2_51",[0,0]],["6_42_47",[0,2455]],["6_54_11",[0,0]],["6_6_3",[0,0]],["6_22_37",[0,1130]],["6_34_7",[0,1481]],["6_58_12",[0,3]],["6_26_7",[1196,2011]],["6_38_12",[0,0]],["6_62_44",[0,0]],["6_10_10",[0,203]],["6_62_45",[0,0]],["6_22_38",[0,441]],["6_30_4",[0,0]],["6_18_55",[-285,1371]],["6_46_50",[1310,3881]],["6_26_8",[492,2991]],["6_62_46",[0,0]],["6_54_12",[0,347]],["6_38_13",[0,0]],["6_14_3",[0,0]],["6_34_8",[0,1669]],["6_58_13",[0,349]],["6_22_39",[0,0]],["6_10_11",[0,362]],["6_6_4",[0,0]],["6_2_52",[0,0]],["6_58_14",[3,723]],["6_50_51",[1021,5352]],["6_42_48",[0,2601]],["6_34_9",[0,1256]],["6_2_53",[0,0]],["6_46_51",[0,7083]],["6_50_52",[440,5261]],["6_62_47",[0,0]],["6_38_14",[0,310]],["6_10_12",[0,453]],["6_26_9",[1283,3762]],["6_14_4",[0,0]],["6_54_13",[0,937]],["6_34_10",[0,827]],["6_30_5",[0,0]],["6_38_15",[0,1175]],["6_2_54",[0,0]],["6_58_15",[6,915]],["6_22_40",[0,0]],["6_26_10",[721,12560]],["6_6_5",[0,0]],["6_18_56",[0,840]],["6_62_48",[0,0]],["6_14_5",[0,0]],["6_54_14",[4,1950]],["6_2_55",[0,712]],["6_10_13",[0,692]],["6_38_16",[0,196]],["6_58_16",[11,2425]],["6_54_15",[11,2237]],["6_62_49",[0,0]],["6_34_11",[0,0]],["6_62_50",[0,4073]],["6_38_17",[0,224]],["6_10_14",[0,862]],["6_26_11",[615,9726]],["6_22_41",[0,0]],["6_30_6",[0,0]],["6_54_16",[23,2020]],["6_18_57",[0,621]],["6_38_18",[28,238]],["6_18_58",[0,10334]],["6_2_56",[0,872]],["6_34_12",[0,0]],["6_58_17",[209,2337]],["6_14_6",[0,515]],["6_34_13",[0,0]],["6_62_51",[0,2618]],["6_50_53",[155,6420]],["6_2_57",[0,0]],["6_6_6",[0,0]],["6_42_49",[966,5113]],["6_58_18",[0,1930]],["6_10_15",[149,773]],["6_38_19",[75,253]],["6_6_7",[0,0]],["6_30_7",[0,0]],["6_18_59",[-165,1490]],["6_38_20",[89,267]],["6_54_17",[28,1127]],["6_34_14",[0,861]],["6_50_54",[612,13612]],["6_58_19",[0,0]],["6_6_8",[0,0]],["6_46_52",[0,5890]],["6_62_52",[0,0]],["6_58_20",[0,0]],["6_38_21",[52,250]],["6_2_58",[0,0]],["6_6_9",[0,0]],["6_10_16",[147,1087]],["6_14_7",[0,598]],["6_54_18",[84,770]],["6_22_42",[0,0]],["6_46_53",[413,8143]],["6_10_17",[80,1510]],["6_58_21",[0,0]],["6_46_54",[0,7481]],["6_34_15",[0,1748]],["6_38_22",[0,319]],["6_50_55",[271,13074]],["6_62_53",[0,0]],["6_2_59",[0,0]],["6_18_60",[-10,1013]],["6_22_43",[0,0]],["6_14_8",[0,213]],["6_10_18",[144,1393]],["6_38_23",[0,2447]],["6_34_16",[0,1781]],["6_10_19",[302,2254]],["6_58_22",[0,1429]],["6_46_55",[0,0]],["6_2_60",[0,0]],["6_50_56",[1473,4314]],["6_34_17",[0,1654]],["6_6_10",[0,0]],["6_62_54",[0,2338]],["6_14_9",[0,299]],["6_22_44",[0,0]],["6_54_19",[205,2122]],["6_34_18",[6,1152]],["6_18_61",[0,0]],["6_14_10",[0,383]],["6_58_23",[0,1550]],["6_30_8",[0,0]],["6_42_50",[977,5030]],["6_2_61",[0,0]],["6_58_24",[0,0]],["6_6_11",[0,0]],["6_34_19",[0,358]],["6_14_11",[0,342]],["6_62_55",[0,0]],["6_10_20",[422,3684]],["6_46_56",[0,1283]],["6_22_45",[0,2193]],["6_58_25",[0,0]],["6_26_12",[438,5131]],["6_34_20",[0,166]],["6_38_24",[0,3599]],["6_58_26",[0,0]],["6_14_12",[0,411]],["6_2_62",[0,0]],["6_18_62",[0,0]],["6_22_46",[0,840]],["6_6_12",[0,0]],["6_58_27",[0,0]],["6_50_57",[671,4094]],["6_14_13",[0,409]],["6_22_47",[0,0]],["6_54_20",[202,1597]],["6_42_51",[535,5192]],["6_2_63",[0,0]],["6_34_21",[21,1505]],["6_10_21",[0,3051]],["6_26_13",[0,4436]],["6_54_21",[110,1212]],["6_62_56",[0,0]],["6_58_28",[0,0]],["6_30_9",[0,0]],["6_6_13",[0,0]],["6_54_22",[91,1384]],["6_58_29",[0,0]],["6_34_22",[0,3468]],["6_38_25",[-372,2998]],["6_30_10",[0,0]],["6_54_23",[-84,2603]],["6_3_0",[0,0]],["6_46_57",[692,13968]],["6_54_24",[0,2456]],["6_22_48",[0,0]],["6_34_23",[0,2632]],["6_26_14",[0,4295]],["6_18_63",[0,0]],["6_42_52",[1615,5977]],["6_14_14",[0,166]],["6_38_26",[-427,2447]],["6_58_30",[0,0]],["6_62_57",[0,0]],["6_10_22",[0,4240]],["6_54_25",[0,1802]],["6_30_11",[0,0]],["6_6_14",[0,2610]],["6_54_26",[0,581]],["6_10_23",[27,4084]],["6_3_1",[0,0]],["6_22_49",[0,0]],["6_38_27",[0,2147]],["6_54_27",[0,403]],["6_42_53",[2285,5221]],["6_30_12",[0,0]],["6_14_15",[0,171]],["6_58_31",[0,0]],["6_46_58",[865,9656]],["6_50_58",[481,13441]],["6_54_28",[0,0]],["6_26_15",[0,2547]],["6_19_0",[0,0]],["6_26_16",[0,0]],["6_14_16",[6,277]],["6_3_2",[0,0]],["6_26_17",[0,0]],["6_30_13",[0,2140]],["6_6_15",[110,2003]],["6_42_54",[0,6254]],["6_62_58",[0,0]],["6_22_50",[0,0]],["6_14_17",[6,327]],["6_42_55",[0,13369]],["6_26_18",[0,0]],["6_6_16",[114,1858]],["6_10_24",[-2,4108]],["6_14_18",[65,408]],["6_54_29",[0,1217]],["6_26_19",[0,0]],["6_58_32",[0,2068]],["6_34_24",[0,3139]],["6_46_59",[0,8726]],["6_10_25",[0,4205]],["6_30_14",[0,0]],["6_3_3",[0,0]],["6_6_17",[154,4916]],["6_54_30",[0,2716]],["6_38_28",[0,2577]],["6_26_20",[0,0]],["6_22_51",[0,0]],["6_34_25",[0,923]],["6_19_1",[0,0]],["6_26_21",[0,0]],["6_34_26",[0,1003]],["6_30_15",[0,0]],["6_54_31",[0,1766]],["6_10_26",[0,1206]],["6_6_18",[0,5268]],["6_34_27",[386,1226]],["6_62_59",[0,0]],["6_22_52",[0,0]],["6_30_16",[0,0]],["6_50_59",[501,6514]],["6_26_22",[0,0]],["6_14_19",[92,401]],["6_26_23",[0,0]],["6_19_2",[0,0]],["6_3_4",[0,0]],["6_54_32",[0,2561]],["6_10_27",[0,0]],["6_42_56",[40,13645]],["6_46_60",[0,5570]],["6_38_29",[0,4415]],["6_10_28",[0,0]],["6_26_24",[0,2091]],["6_30_17",[0,735]],["6_14_20",[179,685]],["6_62_60",[0,0]],["6_54_33",[0,2744]],["6_19_3",[0,1712]],["6_19_4",[0,2129]],["6_10_29",[0,0]],["6_34_28",[208,3110]],["6_22_53",[0,0]],["6_6_19",[0,0]],["6_42_57",[0,14103]],["6_14_21",[213,784]],["6_46_61",[0,0]],["6_30_18",[0,476]],["6_62_61",[0,0]],["6_50_60",[0,5895]],["6_38_30",[395,4120]],["6_6_20",[0,0]],["6_26_25",[0,0]],["6_3_5",[0,0]],["6_10_30",[0,0]],["6_14_22",[226,678]],["6_46_62",[0,0]],["6_14_23",[310,1047]],["6_34_29",[209,675]],["6_54_34",[0,768]],["6_30_19",[0,812]],["6_6_21",[0,0]],["6_14_24",[218,1016]],["6_42_58",[0,6846]],["6_26_26",[0,0]],["6_62_62",[0,0]],["6_6_22",[0,0]],["6_38_31",[184,4176]],["6_30_20",[0,833]],["6_22_54",[0,0]],["6_19_5",[0,1784]],["6_50_61",[0,0]],["6_30_21",[0,849]],["6_14_25",[95,1027]],["6_34_30",[112,2308]],["6_3_6",[0,0]],["6_46_63",[0,0]],["6_6_23",[0,0]],["6_26_27",[0,0]],["6_42_59",[0,274]],["6_34_31",[223,1320]],["6_10_31",[0,0]],["6_14_26",[0,1613]],["6_19_6",[0,1928]],["6_30_22",[0,0]],["6_58_33",[0,3917]],["6_34_32",[0,933]],["6_54_35",[12,920]],["6_62_63",[0,0]],["6_6_24",[0,0]],["6_22_55",[0,50]],["6_30_23",[0,2178]],["6_3_7",[0,0]],["6_50_62",[0,0]],["6_30_24",[0,2311]],["6_14_27",[0,3633]],["6_26_28",[0,0]],["6_10_32",[0,0]],["6_34_33",[0,1977]],["6_38_32",[0,5758]],["6_6_25",[0,0]],["6_42_60",[0,0]],["6_63_0",[0,0]],["6_54_36",[258,910]],["6_58_34",[0,0]],["6_19_7",[0,1364]],["6_47_0",[0,0]],["6_3_8",[0,0]],["6_14_28",[0,5224]],["6_30_25",[0,3133]],["6_22_56",[0,1227]],["6_26_29",[0,0]],["6_6_26",[0,0]],["6_38_33",[0,2860]],["6_14_29",[0,3572]],["6_63_1",[0,0]],["6_47_1",[0,0]],["6_34_34",[0,2468]],["6_10_33",[0,0]],["6_3_9",[0,0]],["6_19_8",[0,1510]],["6_42_61",[0,0]],["6_6_27",[0,0]],["6_22_57",[-3,2052]],["6_54_37",[0,499]],["6_26_30",[0,0]],["6_58_35",[0,1142]],["6_3_10",[0,0]],["6_30_26",[0,3908]],["6_50_63",[0,0]],["6_63_2",[0,0]],["6_22_58",[0,0]],["6_10_34",[0,0]],["6_51_0",[0,0]],["6_63_3",[0,0]],["6_19_9",[0,2124]],["6_54_38",[0,159]],["6_26_31",[0,0]],["6_34_35",[0,2419]],["6_47_2",[0,0]],["6_42_62",[0,0]],["6_58_36",[0,1207]],["6_19_10",[0,1095]],["6_14_30",[0,0]],["6_63_4",[0,0]],["6_3_11",[0,0]],["6_22_59",[0,1975]],["6_30_27",[179,589]],["6_6_28",[0,0]],["6_26_32",[0,0]],["6_3_12",[0,0]],["6_51_1",[0,0]],["6_10_35",[0,0]],["6_6_29",[0,0]],["6_19_11",[0,0]],["6_42_63",[0,0]],["6_38_34",[37,2718]],["6_14_31",[0,0]],["6_47_3",[0,0]],["6_30_28",[111,548]],["6_58_37",[111,1501]],["6_26_33",[0,0]],["6_3_13",[0,21]],["6_34_36",[0,2306]],["6_51_2",[0,0]],["6_19_12",[0,0]],["6_47_4",[0,0]],["6_6_30",[0,0]],["6_22_60",[0,1303]],["6_3_14",[0,1230]],["6_10_36",[0,0]],["6_54_39",[0,0]],["6_38_35",[0,1760]],["6_14_32",[0,0]],["6_30_29",[48,915]],["6_3_15",[0,1428]],["6_58_38",[0,2128]],["6_26_34",[0,0]],["6_54_40",[0,0]],["6_3_16",[0,1059]],["6_51_3",[0,0]],["6_22_61",[0,0]],["6_19_13",[-1,1822]],["6_3_17",[0,976]],["6_47_5",[0,0]],["6_19_14",[0,1737]],["6_6_31",[0,0]],["6_10_37",[0,0]],["6_58_39",[0,1873]],["6_30_30",[0,1664]],["6_19_15",[0,1279]],["6_14_33",[0,0]],["6_26_35",[0,0]],["6_38_36",[0,184]],["6_54_41",[0,0]],["6_19_16",[0,707]],["6_10_38",[0,0]],["6_51_4",[0,0]],["6_22_62",[0,0]],["6_54_42",[0,0]],["6_3_18",[0,1423]],["6_63_5",[0,0]],["6_38_37",[0,0]],["6_26_36",[0,0]],["6_3_19",[0,2399]],["6_6_32",[0,0]],["6_63_6",[0,0]],["6_51_5",[0,0]],["6_47_6",[0,0]],["6_14_34",[0,0]],["6_30_31",[0,247]],["6_43_0",[0,0]],["6_19_17",[0,786]],["6_58_40",[0,1502]],["6_26_37",[0,0]],["6_63_7",[0,0]],["6_19_18",[0,609]],["6_54_43",[0,0]],["6_22_63",[0,0]],["6_19_19",[0,708]],["6_10_39",[0,0]],["6_19_20",[151,723]],["6_3_20",[0,2267]],["6_14_35",[0,0]],["6_19_21",[0,1060]],["6_38_38",[0,0]],["6_51_6",[0,0]],["6_6_33",[0,459]],["6_19_22",[0,1412]],["6_58_41",[0,0]],["6_47_7",[0,0]],["6_3_21",[0,0]],["6_51_7",[0,0]],["6_34_37",[0,1598]],["6_19_23",[0,1799]],["6_30_32",[0,0]],["6_23_0",[0,0]],["6_63_8",[0,0]],["6_54_44",[0,0]],["6_26_38",[0,0]],["6_3_22",[0,0]],["6_43_1",[0,0]],["6_6_34",[0,0]],["6_10_40",[0,0]],["6_14_36",[0,0]],["6_38_39",[0,0]],["6_3_23",[0,0]],["6_47_8",[0,0]],["6_51_8",[0,11]],["6_19_24",[0,5]],["6_23_1",[0,0]],["6_30_33",[0,0]],["6_6_35",[0,0]],["6_58_42",[0,0]],["6_34_38",[0,0]],["6_63_9",[0,0]],["6_26_39",[0,0]],["6_3_24",[0,0]],["6_10_41",[0,0]],["6_19_25",[0,0]],["6_3_25",[0,0]],["6_47_9",[0,0]],["6_43_2",[0,0]],["6_54_45",[0,0]],["6_51_9",[0,143]],["6_47_10",[0,0]],["6_38_40",[0,0]],["6_30_34",[0,670]],["6_14_37",[0,0]],["6_19_26",[0,0]],["6_51_10",[0,1113]],["6_23_2",[0,0]],["6_63_10",[0,0]],["6_19_27",[0,0]],["6_34_39",[0,0]],["6_19_28",[-39,2943]],["6_47_11",[0,209]],["6_43_3",[0,0]],["6_30_35",[0,0]],["6_26_40",[0,0]],["6_6_36",[0,0]],["6_3_26",[0,0]],["6_58_43",[0,0]],["6_63_11",[0,0]],["6_23_3",[-2,1196]],["6_34_40",[0,0]],["6_10_42",[0,0]],["6_38_41",[0,1148]],["6_14_38",[0,0]],["6_63_12",[0,0]],["6_54_46",[0,0]],["6_47_12",[0,208]],["6_63_13",[0,611]],["6_51_11",[0,1046]],["6_30_36",[0,0]],["6_19_29",[0,3026]],["6_47_13",[10,164]],["6_43_4",[0,0]],["6_3_27",[0,1476]],["6_63_14",[0,1559]],["6_58_44",[0,0]],["6_26_41",[0,0]],["6_6_37",[0,0]],["6_30_37",[0,0]],["6_14_39",[0,0]],["6_38_42",[0,0]],["6_23_4",[0,1298]],["6_10_43",[0,0]],["6_54_47",[0,469]],["6_47_14",[0,930]],["6_47_15",[1,818]],["6_34_41",[0,0]],["6_51_12",[0,149]],["6_47_16",[3,701]],["6_26_42",[0,0]],["6_3_28",[0,1095]],["6_47_17",[13,532]],["6_58_45",[0,0]],["6_43_5",[0,531]],["6_19_30",[0,5082]],["6_6_38",[0,0]],["6_47_18",[38,186]],["6_14_40",[0,0]],["6_51_13",[8,615]],["6_30_38",[0,0]],["6_26_43",[0,0]],["6_47_19",[61,351]],["6_38_43",[0,0]],["6_58_46",[0,0]],["6_51_14",[57,893]],["6_23_5",[0,1481]],["6_34_42",[0,0]],["6_43_6",[-4,708]],["6_10_44",[0,0]],["6_54_48",[0,2771]],["6_30_39",[0,788]],["6_47_20",[52,2137]],["6_63_15",[81,1763]],["6_51_15",[139,913]],["6_19_31",[73,3760]],["6_3_29",[0,0]],["6_47_21",[173,4248]],["6_23_6",[-15,2778]],["6_51_16",[129,860]],["6_6_39",[0,0]],["6_47_22",[188,3822]],["6_19_32",[58,659]],["6_51_17",[214,721]],["6_34_43",[0,0]],["6_58_47",[0,0]],["6_51_18",[178,715]],["6_47_23",[-214,4866]],["6_43_7",[0,0]],["6_26_44",[0,0]],["6_47_24",[725,6381]],["6_23_7",[237,11741]],["6_38_44",[0,0]],["6_3_30",[0,0]],["6_47_25",[4197,6508]],["6_19_33",[102,488]],["6_54_49",[479,2795]],["6_26_45",[0,0]],["6_30_40",[0,0]],["6_14_41",[0,0]],["6_51_19",[191,2431]],["6_47_26",[71,8317]],["6_6_40",[0,0]],["6_51_20",[423,2542]],["6_47_27",[0,3722]],["6_10_45",[0,0]],["6_51_21",[452,2480]],["6_43_8",[0,0]],["6_47_28",[0,1158]],["6_34_44",[0,0]],["6_3_31",[0,0]],["6_47_29",[0,0]],["6_58_48",[0,1018]],["6_63_16",[0,1260]],["6_51_22",[853,2601]],["6_43_9",[0,526]],["6_19_34",[0,6234]],["6_14_42",[0,0]],["6_47_30",[0,0]],["6_43_10",[0,1013]],["6_51_23",[742,2239]],["6_43_11",[0,79]],["6_47_31",[0,0]],["6_38_45",[0,0]],["6_51_24",[509,2686]],["6_58_49",[67,2025]],["6_10_46",[0,0]],["6_51_25",[46,3565]],["6_19_35",[0,6207]],["6_30_41",[0,0]],["6_6_41",[0,0]],["6_51_26",[6,2928]],["6_63_17",[0,1316]],["6_51_27",[-16,1949]],["6_47_32",[0,0]],["6_26_46",[0,0]],["6_14_43",[0,0]],["6_54_50",[105,13116]],["6_51_28",[-22,1651]],["6_43_12",[0,0]],["6_51_29",[0,2444]],["6_34_45",[0,0]],["6_43_13",[0,12]],["6_54_51",[273,13188]],["6_43_14",[0,560]],["6_47_33",[0,0]],["6_10_47",[0,0]],["6_23_8",[211,12220]],["6_47_34",[0,0]],["6_58_50",[1648,2277]],["6_43_15",[0,1364]],["6_30_42",[0,0]],["6_26_47",[0,0]],["6_63_18",[0,0]],["6_3_32",[0,0]],["6_19_36",[0,6523]],["6_51_30",[0,1184]],["6_14_44",[0,0]],["6_43_16",[2,1323]],["6_6_42",[0,0]],["6_38_46",[0,0]],["6_51_31",[0,1451]],["6_19_37",[0,6674]],["6_14_45",[0,0]],["6_63_19",[0,0]],["6_34_46",[0,0]],["6_58_51",[2167,2483]],["6_3_33",[0,0]],["6_43_17",[3,226]],["6_10_48",[0,0]],["6_19_38",[0,6620]],["6_51_32",[0,1491]],["6_26_48",[0,0]],["6_54_52",[338,13229]],["6_47_35",[0,0]],["6_43_18",[12,148]],["6_30_43",[0,0]],["6_43_19",[33,194]],["6_6_43",[0,0]],["6_3_34",[0,0]],["6_47_36",[0,0]],["6_38_47",[0,0]],["6_43_20",[-106,353]],["6_19_39",[0,4556]],["6_34_47",[0,0]],["6_63_20",[0,0]],["6_14_46",[0,0]],["6_19_40",[0,3095]],["6_26_49",[0,0]],["6_51_33",[0,3185]],["6_3_35",[0,320]],["6_34_48",[0,0]],["6_47_37",[0,0]],["6_63_21",[0,1058]],["6_30_44",[0,0]],["6_51_34",[0,0]],["6_63_22",[0,0]],["6_3_36",[0,0]],["6_54_53",[97,13192]],["6_6_44",[0,0]],["6_43_21",[83,580]],["6_58_52",[2202,2535]],["6_34_49",[0,2258]],["6_23_9",[284,12511]],["6_63_23",[0,0]],["6_51_35",[0,0]],["6_26_50",[0,0]],["6_43_22",[52,1020]],["6_63_24",[0,0]],["6_30_45",[0,0]],["6_43_23",[11,924]],["6_19_41",[0,3324]],["6_10_49",[0,0]],["6_58_53",[2025,4832]],["6_54_54",[656,5155]],["6_47_38",[0,0]],["6_14_47",[0,0]],["6_10_50",[0,0]],["6_26_51",[0,0]],["6_6_45",[0,0]],["6_51_36",[0,0]],["6_30_46",[0,0]],["6_63_25",[0,0]],["6_43_24",[114,3940]],["6_54_55",[2271,3083]],["6_47_39",[0,0]],["6_43_25",[261,4589]],["6_14_48",[0,0]],["6_63_26",[0,0]],["6_26_52",[0,0]],["6_38_48",[0,0]],["6_58_54",[1404,4169]],["6_23_10",[721,12536]],["6_43_26",[43,3405]],["6_43_27",[0,2005]],["6_43_28",[0,0]],["6_34_50",[0,2996]],["6_51_37",[0,0]],["6_47_40",[0,0]],["6_19_42",[0,2638]],["6_30_47",[0,0]],["6_10_51",[0,3751]],["6_6_46",[0,0]],["6_63_27",[0,0]],["6_43_29",[0,0]],["6_23_11",[592,11028]],["6_54_56",[1939,3732]],["6_14_49",[0,0]],["6_26_53",[0,10999]],["6_43_30",[0,0]],["6_58_55",[1103,3390]],["6_63_28",[0,0]],["6_34_51",[827,13323]],["6_43_31",[0,0]],["6_38_49",[0,1569]],["6_30_48",[0,0]],["6_3_37",[0,0]],["6_10_52",[-23,3395]],["6_43_32",[0,0]],["6_63_29",[0,0]],["6_47_41",[0,0]],["6_6_47",[0,0]],["6_43_33",[0,0]],["6_19_43",[0,2395]],["6_14_50",[-17,1545]],["6_47_42",[0,0]],["6_51_38",[0,0]],["6_58_56",[1801,2365]],["6_30_49",[0,0]],["6_23_12",[1133,5279]],["6_26_54",[-3,11040]],["6_47_43",[0,0]],["6_26_55",[-382,10901]],["6_54_57",[2767,2952]],["6_34_52",[189,13471]],["6_3_38",[0,0]],["6_30_50",[0,5018]],["6_10_53",[514,12108]],["6_63_30",[0,0]],["6_38_50",[975,2671]],["6_51_39",[0,0]],["6_23_13",[137,4354]],["6_19_44",[0,377]],["6_14_51",[0,2330]],["6_43_34",[0,0]],["6_58_57",[1505,2198]],["6_54_58",[2196,3249]],["6_3_39",[0,0]],["6_47_44",[0,0]],["6_26_56",[-4,2165]],["6_23_14",[0,6333]],["6_38_51",[2259,3309]],["6_26_57",[0,1688]],["6_23_15",[0,4581]],["6_51_40",[0,0]],["6_19_45",[0,0]],["6_43_35",[0,317]],["6_6_48",[0,0]],["6_63_31",[0,0]],["6_26_58",[-414,10475]],["6_14_52",[-125,3824]],["6_58_58",[1262,6574]],["6_47_45",[0,0]],["6_3_40",[0,0]],["6_30_51",[11,3047]],["6_51_41",[0,0]],["6_58_59",[285,2580]],["6_6_49",[0,0]],["6_19_46",[0,0]],["6_38_52",[898,13575]],["6_43_36",[0,0]],["6_23_16",[0,4555]],["6_51_42",[0,0]],["6_63_32",[0,0]],["6_10_54",[-33,12152]],["6_19_47",[0,0]],["6_3_41",[0,0]],["6_47_46",[0,0]],["6_54_59",[1192,4419]],["6_10_55",[-187,11884]],["6_43_37",[0,0]],["6_6_50",[0,0]],["6_14_53",[-131,10959]],["6_58_60",[0,2745]],["6_47_47",[0,0]],["6_63_33",[0,0]],["6_51_43",[0,0]],["6_54_60",[0,3685]],["6_19_48",[0,2357]],["6_34_53",[823,13234]],["6_3_42",[0,0]],["6_47_48",[0,3314]],["6_19_49",[0,2986]],["6_3_43",[0,0]],["6_58_61",[0,0]],["6_63_34",[-2,791]],["6_30_52",[761,12667]],["6_54_61",[0,0]],["6_6_51",[0,0]],["6_26_59",[323,2233]],["6_3_44",[0,0]],["6_43_38",[0,0]],["6_47_49",[319,3374]],["6_63_35",[0,1198]],["6_23_17",[0,11795]],["6_19_50",[-2,2138]],["6_14_54",[-403,11427]],["6_26_60",[0,1830]],["6_58_62",[0,0]],["6_23_18",[0,2093]],["6_23_19",[0,0]],["6_43_39",[0,0]],["6_51_44",[0,0]],["6_54_62",[0,0]],["6_47_50",[288,5858]],["6_58_63",[0,0]],["6_3_45",[0,0]],["6_6_52",[0,699]],["6_23_20",[0,0]],["6_19_51",[-26,1924]],["6_23_21",[0,0]],["6_51_45",[0,0]],["6_30_53",[621,12542]],["6_63_36",[0,0]],["6_10_56",[-216,11900]],["6_38_53",[754,13657]],["6_14_55",[270,6437]],["6_54_63",[0,0]],["6_51_46",[0,0]],["6_34_54",[0,7617]],["6_26_61",[0,0]],["6_6_53",[0,2207]],["6_59_0",[0,0]],["6_3_46",[0,0]],["6_19_52",[182,2532]],["6_26_62",[0,0]],["6_23_22",[0,0]],["6_34_55",[0,12888]],["6_59_1",[0,0]],["6_43_40",[0,0]],["6_23_23",[0,0]],["6_10_57",[-29,11427]],["6_51_47",[0,1491]],["6_19_53",[0,1750]],["6_51_48",[-76,4917]],["6_63_37",[0,0]],["6_6_54",[0,10875]],["6_55_0",[0,0]],["6_26_63",[0,0]],["6_30_54",[475,12375]],["6_47_51",[242,13175]],["6_43_41",[0,0]],["6_55_1",[0,0]],["6_59_2",[0,0]],["6_51_49",[1060,3091]],["6_63_38",[0,761]],["6_38_54",[205,4027]],["6_19_54",[0,181]],["6_3_47",[0,0]],["6_14_56",[414,12251]],["6_23_24",[0,0]],["6_34_56",[513,12946]],["6_10_58",[66,11340]],["6_43_42",[0,0]],["6_19_55",[0,1308]],["6_27_0",[0,0]],["6_6_55",[10,1731]],["6_55_2",[0,0]],["6_23_25",[0,0]],["6_10_59",[-195,1785]],["6_38_55",[1099,12918]],["6_63_39",[0,2576]],["6_59_3",[0,0]],["6_19_56",[0,1528]],["6_3_48",[0,0]],["6_30_55",[511,7590]],["6_51_50",[811,4679]],["6_27_1",[0,0]],["6_55_3",[0,0]],["6_19_57",[0,819]],["6_34_57",[2167,4563]],["6_6_56",[-110,1903]],["6_59_4",[0,0]],["6_23_26",[0,0]],["6_63_40",[0,1189]],["6_51_51",[980,7287]],["6_34_58",[695,12615]],["6_10_60",[0,1152]],["6_3_49",[0,0]],["6_23_27",[0,0]],["6_43_43",[0,0]],["6_38_56",[0,13358]],["6_3_50",[0,0]],["6_55_4",[0,0]],["6_43_44",[0,0]],["6_63_41",[0,0]],["6_47_52",[85,7548]],["6_30_56",[1526,12067]],["6_6_57",[-25,1790]],["6_38_57",[0,1548]],["6_10_61",[0,0]],["6_23_28",[0,0]],["6_59_5",[0,0]],["6_27_2",[0,0]],["6_14_57",[466,12322]],["6_3_51",[0,0]],["6_51_52",[2675,17037]],["6_30_57",[1201,6817]],["6_63_42",[0,0]],["6_55_5",[0,0]],["6_23_29",[0,0]],["6_59_6",[0,0]],["6_43_45",[0,0]],["6_47_53",[770,13586]],["6_63_43",[0,0]],["6_51_53",[234,13353]],["6_10_62",[0,0]],["6_19_58",[-120,10419]],["6_38_58",[0,0]],["6_23_30",[0,0]],["6_19_59",[-274,733]],["6_27_3",[0,1436]],["6_43_46",[0,0]],["6_30_58",[1631,11977]],["6_59_7",[0,0]],["6_55_6",[0,0]],["6_14_58",[37,12085]],["6_63_44",[0,0]],["6_51_54",[355,12003]],["6_3_52",[0,0]],["6_47_54",[0,13602]],["6_10_63",[0,0]],["6_38_59",[0,0]],["6_27_4",[0,1173]],["6_6_58",[-36,10976]],["6_23_31",[0,22]],["6_34_59",[1933,6644]],["6_43_47",[0,0]],["6_59_8",[0,0]],["6_63_45",[0,0]],["6_3_53",[0,0]],["6_34_60",[0,7565]],["6_51_55",[475,5029]],["6_55_7",[0,0]],["6_23_32",[0,319]],["6_27_5",[0,1143]],["6_43_48",[0,1831]],["6_59_9",[0,0]],["6_23_33",[105,853]],["6_38_60",[0,0]],["6_47_55",[0,12290]],["6_59_10",[0,0]],["6_3_54",[0,684]],["6_19_60",[-202,879]],["6_11_0",[0,0]],["6_59_11",[0,0]],["6_27_6",[0,1344]],["6_55_8",[0,0]],["6_23_34",[186,1617]],["6_6_59",[-422,910]],["6_63_46",[0,0]],["6_34_61",[0,0]],["6_19_61",[0,0]],["6_47_56",[0,11528]],["6_38_61",[0,0]],["6_63_47",[0,0]],["6_51_56",[263,5882]],["6_55_9",[0,0]],["6_19_62",[0,0]],["6_63_48",[0,0]],["6_14_59",[-725,2498]],["6_27_7",[0,1545]],["6_43_49",[22,3508]],["6_59_12",[0,0]],["6_3_55",[0,1266]],["6_23_35",[342,1536]],["6_59_13",[0,36]],["6_34_62",[0,0]],["6_47_57",[97,8174]],["6_11_1",[0,0]],["6_23_36",[0,2119]],["6_30_59",[1340,7406]],["6_6_60",[-198,1377]],["6_38_62",[0,0]],["6_55_10",[0,0]],["6_51_57",[12,12216]],["6_63_49",[0,0]],["6_19_63",[0,0]],["6_23_37",[0,1709]],["6_59_14",[0,583]],["6_3_56",[-37,1193]],["6_23_38",[0,0]],["6_6_61",[0,0]],["6_27_8",[398,3479]],["6_34_63",[0,0]],["6_23_39",[0,0]],["6_59_15",[0,800]],["6_51_58",[1304,13312]],["6_43_50",[13,3520]],["6_14_60",[0,2145]],["6_55_11",[0,0]],["6_3_57",[0,0]],["6_38_63",[0,0]],["6_63_50",[0,0]],["6_27_9",[12,2958]],["6_11_2",[0,0]],["6_51_59",[379,4373]],["6_55_12",[0,27]],["6_23_40",[0,0]],["6_27_10",[0,3619]],["6_35_0",[0,0]],["6_47_58",[2715,14333]],["6_30_60",[0,7523]],["6_39_0",[0,0]],["6_43_51",[141,3136]],["6_6_62",[0,0]],["6_11_3",[0,0]],["6_55_13",[0,753]],["6_63_51",[0,0]],["6_55_14",[12,1387]],["6_14_61",[0,0]],["6_23_41",[0,0]],["6_39_1",[0,0]],["6_43_52",[898,2861]],["6_55_15",[40,1848]],["6_3_58",[0,0]],["6_27_11",[0,4251]],["6_35_1",[0,0]],["6_63_52",[0,0]],["6_47_59",[0,7817]],["6_30_61",[0,0]],["6_6_63",[0,0]],["6_11_4",[0,0]],["6_55_16",[187,2056]],["6_35_2",[0,0]],["6_14_62",[0,0]],["6_59_16",[10,1305]],["6_27_12",[-12,2428]],["6_3_59",[0,0]],["6_39_2",[0,0]],["6_43_53",[201,7476]],["6_59_17",[0,1773]],["6_23_42",[0,0]],["6_47_60",[0,5751]],["6_14_63",[0,0]],["6_3_60",[0,0]],["6_35_3",[0,0]],["6_15_0",[0,0]],["6_47_61",[0,0]],["6_55_17",[52,2043]],["6_59_18",[0,1859]],["6_23_43",[0,0]],["6_7_0",[0,0]],["6_15_1",[0,0]],["6_30_62",[0,0]],["6_63_53",[0,0]],["6_39_3",[0,0]],["6_51_60",[0,5867]],["6_59_19",[0,1101]],["6_55_18",[84,786]],["6_27_13",[-10,2725]],["6_43_54",[0,7448]],["6_59_20",[0,2231]],["6_47_62",[0,0]],["6_7_1",[0,0]],["6_51_61",[0,0]],["6_23_44",[0,0]],["6_3_61",[0,0]],["6_27_14",[0,2839]],["6_35_4",[0,0]],["6_51_62",[0,0]],["6_59_21",[0,2183]],["6_63_54",[0,0]],["6_15_2",[0,0]],["6_27_15",[0,1356]],["6_11_5",[0,0]],["6_7_2",[0,0]],["6_23_45",[0,1188]],["6_43_55",[0,34]],["6_55_19",[182,2241]],["6_30_63",[0,0]],["6_59_22",[0,1264]],["6_39_4",[0,0]],["6_3_62",[0,0]],["6_47_63",[0,0]],["6_27_16",[0,1332]],["6_15_3",[0,0]],["6_51_63",[0,0]],["6_55_20",[18,2175]],["6_11_6",[0,0]],["6_39_5",[0,0]],["6_3_63",[0,0]],["6_59_23",[0,0]],["6_63_55",[0,0]],["6_23_46",[0,0]],["6_59_24",[0,0]],["6_55_21",[38,2094]],["6_7_3",[0,0]],["6_27_17",[0,37]],["6_31_0",[0,0]],["6_11_7",[0,0]],["6_27_18",[0,0]],["6_43_56",[0,7699]],["6_55_22",[8,1346]],["6_39_6",[0,0]],["6_23_47",[0,0]],["6_55_23",[0,1685]],["6_15_4",[0,0]],["6_35_5",[0,0]],["6_63_56",[0,0]],["6_59_25",[0,0]],["6_7_4",[0,0]],["6_15_5",[0,922]],["6_55_24",[0,848]],["6_63_57",[0,0]],["6_59_26",[0,0]],["6_27_19",[0,0]],["6_43_57",[1763,13666]],["6_27_20",[0,0]],["6_55_25",[0,1779]],["6_31_1",[0,0]],["6_27_21",[0,0]],["6_11_8",[0,10]],["6_7_5",[0,0]],["6_55_26",[0,1741]],["6_35_6",[0,730]],["6_59_27",[0,0]],["6_59_28",[0,0]],["6_15_6",[0,1545]],["6_7_6",[0,0]],["6_27_22",[0,0]],["6_59_29",[0,0]],["6_63_58",[0,0]],["6_31_2",[0,0]],["6_39_7",[0,0]],["6_23_48",[0,0]],["6_55_27",[0,0]],["6_11_9",[0,87]],["6_55_28",[0,0]],["6_27_23",[0,0]],["6_63_59",[0,0]],["6_35_7",[0,1401]],["6_15_7",[0,2035]],["6_39_8",[0,0]],["6_59_30",[0,0]],["6_23_49",[0,0]],["6_11_10",[0,694]],["6_43_58",[263,8731]],["6_31_3",[0,0]],["6_63_60",[0,0]],["6_39_9",[0,0]],["6_55_29",[0,0]],["6_35_8",[0,1676]],["6_39_10",[0,0]],["6_27_24",[0,964]],["6_27_25",[0,0]],["6_59_31",[0,0]],["6_39_11",[0,0]],["6_55_30",[0,0]],["6_23_50",[0,0]],["6_35_9",[0,1134]],["6_15_8",[0,1771]],["6_63_61",[0,0]],["6_27_26",[0,0]],["6_39_12",[0,0]],["6_35_10",[0,569]],["6_63_62",[0,0]],["6_15_9",[0,270]],["6_55_31",[0,0]],["6_27_27",[0,0]],["6_11_11",[0,767]],["6_31_4",[0,0]],["6_23_51",[0,0]],["6_59_32",[0,2131]],["6_7_7",[0,0]],["6_35_11",[0,18]],["6_35_12",[0,0]],["6_39_13",[0,0]],["6_15_10",[0,660]],["6_11_12",[0,388]],["6_31_5",[0,0]],["6_63_63",[0,0]],["6_59_33",[0,2603]],["6_15_11",[0,376]],["6_7_8",[0,0]],["6_11_13",[0,655]],["6_35_13",[0,217]],["6_27_28",[0,1821]],["6_23_52",[0,0]],["6_55_32",[0,2737]],["6_39_14",[0,0]],["6_43_59",[0,8511]],["6_35_14",[0,1798]],["6_31_6",[0,0]],["6_11_14",[0,449]],["6_39_15",[0,458]],["6_23_53",[0,0]],["6_15_12",[0,484]],["6_11_15",[0,736]],["6_35_15",[0,1989]],["6_15_13",[0,599]],["6_11_16",[154,521]],["6_39_16",[0,191]],["6_23_54",[-20,2934]],["6_15_14",[0,569]],["6_27_29",[0,2579]],["6_55_33",[0,765]],["6_43_60",[0,5648]],["6_7_9",[0,0]],["6_39_17",[9,228]],["6_35_16",[0,1070]],["6_15_15",[0,480]],["6_31_7",[0,0]],["6_59_34",[0,616]],["6_11_17",[149,696]],["6_23_55",[-295,4024]],["6_7_10",[0,0]],["6_43_61",[0,0]],["6_39_18",[33,246]],["6_15_16",[0,609]],["6_27_30",[0,0]],["6_15_17",[0,315]],["6_11_18",[147,963]],["6_35_17",[0,484]],["6_55_34",[0,459]],["6_11_19",[207,983]],["6_59_35",[0,0]],["6_15_18",[0,123]],["6_7_11",[0,0]],["6_39_19",[64,253]],["6_11_20",[430,3132]],["6_43_62",[0,0]],["6_31_8",[0,0]],["6_35_18",[0,99]],["6_23_56",[-71,10782]],["6_15_19",[0,215]],["6_39_20",[70,259]],["6_27_31",[0,0]],["6_59_36",[0,789]],["6_31_9",[0,0]],["6_35_19",[0,178]],["6_59_37",[0,1515]],["6_39_21",[19,234]],["6_39_22",[-6,586]],["6_15_20",[90,380]],["6_31_10",[0,0]],["6_27_32",[0,0]],["6_35_20",[0,218]],["6_7_12",[0,0]],["6_31_11",[0,0]],["6_35_21",[14,2389]],["6_59_38",[0,585]],["6_11_21",[409,3433]],["6_23_57",[-25,2076]],["6_43_63",[0,0]],["6_35_22",[45,1857]],["6_39_23",[0,5463]],["6_7_13",[0,0]],["6_31_12",[0,0]],["6_15_21",[285,519]],["6_11_22",[195,3179]],["6_27_33",[0,0]],["6_35_23",[0,2560]],["6_15_22",[179,553]],["6_23_58",[0,106]],["6_15_23",[179,491]],["6_35_24",[0,2708]],["6_11_23",[561,3577]],["6_27_34",[0,0]],["6_31_13",[0,0]],["6_23_59",[0,1131]],["6_15_24",[88,523]],["6_39_24",[0,4998]],["6_59_39",[0,0]],["6_7_14",[0,1516]],["6_11_24",[-60,3723]],["6_27_35",[0,0]],["6_55_35",[135,1012]],["6_31_14",[0,0]],["6_15_25",[16,798]],["6_39_25",[10,3263]],["6_31_15",[0,0]],["6_23_60",[0,1447]],["6_35_25",[0,1013]],["6_27_36",[0,0]],["6_15_26",[0,162]],["6_31_16",[0,0]],["6_11_25",[-95,3483]],["6_35_26",[-13,1002]],["6_35_27",[143,2145]],["6_59_40",[0,0]],["6_11_26",[0,2823]],["6_15_27",[0,0]],["6_39_26",[10,1389]],["6_23_61",[0,0]],["6_35_28",[160,3329]],["6_55_36",[167,1344]],["6_7_15",[2,1607]],["6_27_37",[0,0]],["6_11_27",[0,1492]],["6_39_27",[81,1966]],["6_31_17",[0,0]],["6_7_16",[167,2140]],["6_35_29",[192,1311]],["6_39_28",[0,2940]],["6_15_28",[0,2746]],["6_59_41",[0,0]],["6_35_30",[328,913]],["6_31_18",[0,1192]],["6_27_38",[0,0]],["6_55_37",[0,640]],["6_7_17",[295,2137]],["6_35_31",[306,697]],["6_23_62",[0,0]],["6_39_29",[-153,3747]],["6_11_28",[0,0]],["6_59_42",[0,0]],["6_23_63",[0,0]],["6_11_29",[0,0]],["6_35_32",[291,854]],["6_27_39",[0,0]],["6_7_18",[-1,5822]],["6_55_38",[0,150]],["6_15_29",[0,3926]],["6_39_30",[0,4285]],["6_31_19",[0,1237]],["6_59_43",[0,0]],["6_7_19",[0,3675]],["6_31_20",[0,979]],["6_55_39",[0,0]],["6_39_31",[0,1636]],["6_15_30",[0,0]],["6_27_40",[0,0]],["6_11_30",[0,0]],["6_35_33",[428,1669]],["6_31_21",[0,783]],["6_7_20",[0,0]],["6_59_44",[0,0]],["6_55_40",[0,0]],["6_39_32",[0,485]],["6_7_21",[0,0]],["6_15_31",[0,1604]],["6_27_41",[0,0]],["6_11_31",[0,0]],["6_31_22",[0,408]],["6_7_22",[0,0]],["6_35_34",[1021,1799]],["6_31_23",[0,3022]],["6_59_45",[0,0]],["6_55_41",[0,0]],["6_39_33",[0,628]],["6_7_23",[0,0]],["6_15_32",[0,1607]],["6_11_32",[0,0]],["6_27_42",[0,0]],["6_59_46",[0,0]],["6_39_34",[0,2282]],["6_15_33",[0,0]],["6_7_24",[0,0]],["6_11_33",[0,0]],["6_55_42",[0,0]],["6_31_24",[0,3333]],["6_35_35",[930,1977]],["6_27_43",[0,0]],["6_7_25",[0,0]],["6_59_47",[0,0]],["6_39_35",[0,838]],["6_7_26",[0,0]],["6_35_36",[661,2351]],["6_27_44",[0,1163]],["6_35_37",[0,2034]],["6_15_34",[0,0]],["6_11_34",[0,0]],["6_55_43",[0,0]],["6_7_27",[0,0]],["6_59_48",[0,1578]],["6_39_36",[0,1310]],["6_27_45",[0,969]],["6_7_28",[0,0]],["6_11_35",[0,0]],["6_35_38",[0,2115]],["6_39_37",[0,0]],["6_15_35",[0,0]],["6_55_44",[0,0]],["6_7_29",[0,0]],["6_31_25",[0,3597]],["6_27_46",[0,0]],["6_59_49",[0,3962]],["6_55_45",[0,0]],["6_35_39",[0,0]],["6_7_30",[0,0]],["6_15_36",[0,0]],["6_11_36",[0,0]],["6_27_47",[0,0]],["6_31_26",[171,3035]],["6_39_38",[0,0]],["6_15_37",[0,0]],["6_27_48",[0,0]],["6_59_50",[22,3413]],["6_35_40",[0,0]],["6_39_39",[0,0]],["6_11_37",[0,0]],["6_7_31",[0,0]],["6_55_46",[0,0]],["6_27_49",[0,0]],["6_31_27",[170,527]],["6_15_38",[0,0]],["6_59_51",[1454,3889]],["6_11_38",[0,0]],["6_39_40",[0,0]],["6_35_41",[0,0]],["6_55_47",[0,1262]],["6_7_32",[0,0]],["6_27_50",[0,0]],["6_31_28",[250,419]],["6_15_39",[0,0]],["6_59_52",[1553,3702]],["6_11_39",[0,0]],["6_39_41",[0,0]],["6_35_42",[0,0]],["6_27_51",[0,0]],["6_7_33",[0,1065]],["6_55_48",[0,2729]],["6_15_40",[0,0]],["6_59_53",[1668,2430]],["6_11_40",[0,0]],["6_27_52",[0,0]],["6_31_29",[223,956]],["6_39_42",[0,0]],["6_35_43",[0,0]],["6_7_34",[0,0]],["6_27_53",[0,10906]],["6_55_49",[403,3483]],["6_15_41",[0,0]],["6_31_30",[3,806]],["6_11_41",[0,0]],["6_55_50",[716,3188]],["6_59_54",[1098,4690]],["6_7_35",[0,0]],["6_35_44",[0,0]],["6_59_55",[1418,3708]],["6_39_43",[0,0]],["6_15_42",[0,0]],["6_27_54",[-126,11661]],["6_11_42",[0,0]],["6_31_31",[0,167]],["6_7_36",[0,0]],["6_15_43",[0,0]],["6_35_45",[0,0]],["6_11_43",[0,0]],["6_59_56",[669,2790]],["6_7_37",[0,0]],["6_27_55",[-54,3561]],["6_55_51",[607,12800]],["6_31_32",[0,0]],["6_39_44",[0,0]],["6_35_46",[0,0]],["6_15_44",[0,0]],["6_59_57",[289,3456]],["6_11_44",[0,0]],["6_31_33",[0,0]],["6_27_56",[207,2784]],["6_39_45",[0,0]],["6_35_47",[0,0]],["6_7_38",[0,0]],["6_11_45",[0,0]],["6_15_45",[0,0]],["6_31_34",[0,0]],["6_55_52",[485,12990]],["6_27_57",[321,1963]],["6_39_46",[0,0]],["6_7_39",[0,0]],["6_59_58",[1084,10297]],["6_35_48",[0,0]],["6_39_47",[0,0]],["6_31_35",[0,0]],["6_59_59",[1111,2635]],["6_11_46",[0,0]],["6_55_53",[723,4738]],["6_15_46",[0,0]],["6_7_40",[0,0]],["6_27_58",[-393,11344]],["6_31_36",[0,0]],["6_35_49",[0,2296]],["6_59_60",[0,2547]],["6_39_48",[0,1504]],["6_7_41",[0,0]],["6_15_47",[0,0]],["6_11_47",[0,0]],["6_31_37",[0,0]],["6_35_50",[0,3202]],["6_27_59",[-19,1979]],["6_55_54",[2492,3436]],["6_15_48",[0,0]],["6_39_49",[0,2325]],["6_7_42",[0,0]],["6_59_61",[0,0]],["6_11_48",[0,0]],["6_27_60",[0,1935]],["6_55_55",[2607,2922]],["6_35_51",[1901,13322]],["6_31_38",[0,0]],["6_7_43",[0,0]],["6_15_49",[0,6509]],["6_11_49",[0,0]],["6_27_61",[0,0]],["6_59_62",[0,0]],["6_39_50",[1282,2834]],["6_15_50",[0,760]],["6_31_39",[0,0]],["6_7_44",[0,0]],["6_11_50",[0,0]],["6_27_62",[0,0]],["6_55_56",[2544,2834]],["6_39_51",[1263,3332]],["6_7_45",[0,0]],["6_59_63",[0,0]],["6_31_40",[0,0]],["6_27_63",[0,0]],["6_15_51",[0,3905]],["6_35_52",[201,13482]],["6_55_57",[2518,2803]],["6_7_46",[0,0]],["6_39_52",[413,13580]],["6_11_51",[0,863]],["6_31_41",[0,0]],["6_55_58",[2516,2775]],["6_7_47",[0,0]],["6_11_52",[-71,2156]],["6_39_53",[870,13685]],["6_31_42",[0,0]],["6_7_48",[0,0]],["6_15_52",[-194,10602]],["6_35_53",[813,7434]],["6_55_59",[1695,2902]],["6_35_54",[0,13743]],["6_31_43",[0,0]],["6_39_54",[979,7078]],["6_7_49",[0,0]],["6_11_53",[117,4727]],["6_15_53",[-65,3220]],["6_31_44",[0,0]],["6_35_55",[0,10180]],["6_7_50",[0,0]],["6_11_54",[191,12240]],["6_55_60",[0,2831]],["6_7_51",[0,0]],["6_31_45",[0,0]],["6_39_55",[0,12725]],["6_15_54",[204,11480]],["6_35_56",[1224,4276]],["6_55_61",[0,0]],["6_7_52",[0,1856]],["6_55_62",[0,0]],["6_15_55",[88,11909]],["6_35_57",[1806,3426]],["6_31_46",[0,0]],["6_35_58",[555,12233]],["6_11_55",[-195,12083]],["6_39_56",[0,8159]],["6_55_63",[0,0]],["6_7_53",[-45,3407]],["6_31_47",[0,0]],["6_11_56",[-312,11807]],["6_15_56",[15,12190]],["6_35_59",[0,5831]],["6_7_54",[11,11627]],["6_39_57",[0,6919]],["6_31_48",[0,0]],["6_7_55",[30,10735]],["6_11_57",[155,2514]],["6_15_57",[426,12217]],["6_39_58",[0,0]],["6_11_58",[-154,1914]],["6_35_60",[0,5623]],["6_31_49",[0,0]],["6_7_56",[38,1485]],["6_35_61",[0,0]],["6_15_58",[-84,12061]],["6_39_59",[0,0]],["6_7_57",[13,1390]],["6_35_62",[0,0]],["6_11_59",[-103,1932]],["6_31_50",[-3,1729]],["6_39_60",[0,0]],["6_31_51",[904,12745]],["6_35_63",[0,0]],["6_39_61",[0,0]],["6_11_60",[0,1506]],["6_39_62",[0,0]],["6_7_58",[-129,10798]],["6_15_59",[-976,2797]],["6_31_52",[755,13200]],["6_11_61",[0,0]],["6_39_63",[0,0]],["6_7_59",[-337,1240]],["6_15_60",[-115,2281]],["6_11_62",[0,0]],["6_31_53",[535,13165]],["6_7_60",[-266,1519]],["6_15_61",[0,0]],["6_7_61",[0,0]],["6_15_62",[0,0]],["6_11_63",[0,0]],["6_7_62",[0,0]],["6_31_54",[1079,12383]],["6_15_63",[0,0]],["6_7_63",[0,0]],["6_31_55",[1593,12298]],["6_31_56",[1599,7064]],["6_31_57",[1965,12295]],["6_31_58",[1660,12180]],["6_31_59",[1121,8140]],["6_31_60",[0,7279]],["6_31_61",[0,0]],["6_31_62",[0,0]],["6_31_63",[0,0]]]),kh={"EPSG:4326":new Map([["0_0_0",[1,1]],["1_1_0",[1,1]],["1_0_0",[1,1]],["2_0_1",[1,1]],["2_0_0",[1,1]],["2_3_1",[1,1]],["2_1_1",[1,1]],["2_1_0",[1,1]],["2_3_0",[1,1]],["2_2_1",[1,1]],["2_2_0",[1,1]],["3_0_2",[0,0]],["3_3_2",[0,0]],["3_1_2",[0,0]],["3_0_0",[0,0]],["3_2_0",[0,0]],["3_1_0",[0,0]],["3_2_2",[0,0]],["3_7_2",[0,0]],["3_7_0",[0,409]],["3_3_0",[0,0]],["3_5_2",[0,0]],["3_4_0",[0,0]],["3_6_2",[0,0]],["3_5_0",[0,3632]],["3_4_2",[0,0]],["3_6_0",[0,3407]],["3_0_3",[0,0]],["3_0_1",[0,0]],["3_1_3",[0,0]],["3_1_1",[0,0]],["3_2_1",[0,0]],["3_3_3",[0,0]],["3_3_1",[0,0]],["3_2_3",[0,0]],["3_7_1",[0,0]],["3_5_3",[0,0]],["3_4_1",[0,0]],["3_7_3",[0,0]],["3_6_3",[0,0]],["3_4_3",[0,0]],["3_5_1",[-195,6359]],["3_6_1",[-21,6241]],["4_12_0",[0,0]],["4_4_0",[0,0]],["4_7_0",[0,0]],["4_0_0",[0,0]],["4_1_0",[0,0]],["4_3_0",[0,0]],["4_8_0",[0,0]],["4_5_0",[0,0]],["4_9_0",[0,0]],["4_11_0",[0,0]],["4_2_0",[0,0]],["4_10_0",[0,0]],["4_13_0",[0,0]],["4_14_0",[0,0]],["4_6_0",[0,0]],["4_15_0",[0,0]],["4_0_1",[0,0]],["4_4_1",[0,0]],["4_5_1",[0,0]],["4_7_1",[0,0]],["4_1_1",[0,0]],["4_3_1",[0,0]],["4_2_1",[0,0]],["4_8_1",[0,0]],["4_10_1",[0,0]],["4_12_1",[0,3587]],["4_9_1",[0,0]],["4_6_1",[0,0]],["4_13_1",[0,1540]],["4_14_1",[0,574]],["4_15_1",[0,0]],["4_11_1",[0,3785]],["4_0_2",[0,0]],["4_1_2",[0,0]],["4_4_2",[0,0]],["4_5_2",[0,0]],["4_7_2",[0,0]],["4_3_2",[0,0]],["4_2_2",[0,0]],["4_10_2",[0,0]],["4_6_2",[0,0]],["4_8_2",[0,0]],["4_9_2",[0,0]],["4_14_2",[0,0]],["4_15_2",[0,0]],["4_0_3",[0,0]],["4_1_3",[0,0]],["4_7_3",[0,0]],["4_4_3",[0,0]],["4_5_3",[0,0]],["4_3_3",[0,0]],["4_2_3",[0,0]],["4_10_3",[0,0]],["4_8_3",[0,0]],["4_13_2",[-6,3295]],["4_9_3",[0,0]],["4_6_3",[0,0]],["4_15_3",[0,0]],["4_0_4",[0,0]],["4_14_3",[0,0]],["4_7_4",[0,0]],["4_4_4",[0,0]],["4_1_4",[0,0]],["4_5_4",[0,0]],["4_3_4",[0,0]],["4_2_4",[0,0]],["4_10_4",[0,0]],["4_13_3",[-6,1245]],["4_8_4",[0,0]],["4_9_4",[0,0]],["4_15_4",[0,0]],["4_0_5",[0,0]],["4_7_5",[0,0]],["4_14_4",[0,0]],["4_1_5",[0,0]],["4_4_5",[0,0]],["4_5_5",[0,0]],["4_6_4",[0,0]],["4_3_5",[0,0]],["4_2_5",[0,0]],["4_10_5",[0,0]],["4_8_5",[0,0]],["4_13_4",[0,0]],["4_11_2",[-204,7221]],["4_0_6",[0,0]],["4_9_5",[0,0]],["4_15_5",[0,0]],["4_7_6",[0,0]],["4_1_6",[0,0]],["4_4_6",[0,0]],["4_14_5",[0,0]],["4_5_6",[0,0]],["4_3_6",[0,0]],["4_2_6",[0,0]],["4_10_6",[0,0]],["4_6_5",[0,0]],["4_13_5",[0,0]],["4_8_6",[0,0]],["4_0_7",[0,0]],["4_11_3",[0,0]],["4_7_7",[0,0]],["4_1_7",[0,0]],["4_3_7",[0,0]],["4_15_6",[0,0]],["4_9_6",[0,0]],["4_14_6",[0,0]],["4_4_7",[0,0]],["4_5_7",[0,0]],["4_2_7",[0,0]],["4_10_7",[0,0]],["4_6_6",[0,0]],["4_8_7",[0,0]],["4_13_6",[0,0]],["4_12_2",[0,6582]],["4_11_4",[0,0]],["4_14_7",[0,0]],["4_15_7",[0,0]],["4_9_7",[0,0]],["4_6_7",[0,0]],["4_13_7",[0,0]],["4_11_5",[0,0]],["4_12_3",[-21,2402]],["4_11_6",[0,0]],["4_12_4",[0,0]],["4_11_7",[0,0]],["4_12_5",[0,0]],["4_12_6",[0,0]],["4_12_7",[0,0]],["5_22_0",[0,0]],["5_14_0",[0,0]],["5_8_0",[0,0]],["5_6_0",[0,0]],["5_2_0",[0,0]],["5_0_0",[0,0]],["5_16_0",[0,0]],["5_20_0",[0,0]],["5_4_0",[0,0]],["5_28_0",[0,0]],["5_10_0",[0,0]],["5_30_0",[0,0]],["5_18_0",[0,0]],["5_26_0",[0,0]],["5_12_0",[0,0]],["5_24_0",[0,0]],["5_22_1",[0,0]],["5_14_1",[0,0]],["5_8_1",[0,0]],["5_2_1",[0,0]],["5_6_1",[0,0]],["5_28_1",[0,0]],["5_20_1",[0,0]],["5_0_1",[0,0]],["5_16_1",[0,0]],["5_4_1",[0,0]],["5_10_1",[0,0]],["5_30_1",[0,0]],["5_18_1",[0,0]],["5_26_1",[0,0]],["5_24_1",[0,0]],["5_12_1",[0,0]],["5_8_2",[0,0]],["5_14_2",[0,0]],["5_2_2",[0,0]],["5_6_2",[0,0]],["5_4_2",[0,0]],["5_20_2",[0,0]],["5_28_2",[0,0]],["5_0_2",[0,0]],["5_22_2",[0,0]],["5_16_2",[0,0]],["5_18_2",[0,0]],["5_30_2",[0,0]],["5_26_2",[0,0]],["5_10_2",[0,0]],["5_24_2",[0,0]],["5_6_3",[0,0]],["5_8_3",[0,0]],["5_14_3",[0,0]],["5_20_3",[0,0]],["5_4_3",[0,0]],["5_2_3",[0,0]],["5_12_2",[0,0]],["5_16_3",[0,0]],["5_0_3",[0,0]],["5_28_3",[0,677]],["5_18_3",[0,0]],["5_30_3",[0,0]],["5_22_3",[0,0]],["5_10_3",[0,0]],["5_24_3",[0,3766]],["5_26_3",[0,1590]],["5_14_4",[0,0]],["5_6_4",[0,0]],["5_8_4",[0,0]],["5_20_4",[0,0]],["5_2_4",[0,0]],["5_4_4",[0,0]],["5_28_4",[0,0]],["5_0_4",[0,0]],["5_18_4",[0,0]],["5_30_4",[0,0]],["5_16_4",[0,0]],["5_12_3",[0,0]],["5_10_4",[0,0]],["5_14_5",[0,0]],["5_8_5",[0,0]],["5_6_5",[0,0]],["5_20_5",[0,0]],["5_0_5",[0,0]],["5_4_5",[0,0]],["5_2_5",[0,0]],["5_16_5",[0,0]],["5_28_5",[0,0]],["5_26_4",[-6,2806]],["5_30_5",[0,0]],["5_18_5",[0,0]],["5_10_5",[0,0]],["5_14_6",[0,0]],["5_12_4",[0,0]],["5_8_6",[0,0]],["5_6_6",[0,0]],["5_24_4",[0,6300]],["5_0_6",[0,0]],["5_2_6",[0,0]],["5_20_6",[0,0]],["5_28_6",[0,0]],["5_16_6",[0,0]],["5_4_6",[0,0]],["5_18_6",[0,0]],["5_30_6",[0,0]],["5_10_6",[0,0]],["5_14_7",[0,0]],["5_22_4",[0,7224]],["5_6_7",[0,0]],["5_0_7",[0,0]],["5_8_7",[0,0]],["5_12_5",[0,0]],["5_2_7",[0,0]],["5_20_7",[0,0]],["5_4_7",[0,0]],["5_16_7",[0,0]],["5_28_7",[0,0]],["5_26_5",[-8,3465]],["5_30_7",[0,0]],["5_14_8",[0,0]],["5_10_7",[0,0]],["5_18_7",[0,0]],["5_0_8",[0,0]],["5_6_8",[0,0]],["5_2_8",[0,0]],["5_8_8",[0,0]],["5_12_6",[0,0]],["5_20_8",[0,0]],["5_4_8",[0,0]],["5_26_6",[-7,1616]],["5_22_5",[0,6245]],["5_16_8",[0,0]],["5_14_9",[0,0]],["5_30_8",[0,0]],["5_28_8",[0,0]],["5_18_8",[0,0]],["5_10_8",[0,0]],["5_0_9",[0,0]],["5_6_9",[0,0]],["5_2_9",[0,0]],["5_8_9",[0,0]],["5_20_9",[0,0]],["5_12_7",[0,0]],["5_4_9",[0,0]],["5_26_7",[0,0]],["5_14_10",[0,0]],["5_16_9",[0,0]],["5_22_6",[0,0]],["5_28_9",[0,0]],["5_30_9",[0,0]],["5_18_9",[0,0]],["5_0_10",[0,0]],["5_10_9",[0,0]],["5_6_10",[0,0]],["5_8_10",[0,0]],["5_4_10",[0,0]],["5_2_10",[0,0]],["5_20_10",[0,0]],["5_26_8",[0,0]],["5_12_8",[0,0]],["5_14_11",[0,0]],["5_16_10",[0,0]],["5_22_7",[0,0]],["5_28_10",[0,0]],["5_30_10",[0,0]],["5_0_11",[0,0]],["5_18_10",[0,0]],["5_10_10",[0,0]],["5_6_11",[0,0]],["5_26_9",[0,0]],["5_14_12",[0,0]],["5_12_9",[0,0]],["5_4_11",[0,0]],["5_20_11",[0,0]],["5_16_11",[0,0]],["5_22_8",[0,0]],["5_8_11",[0,0]],["5_2_11",[0,0]],["5_28_11",[0,0]],["5_0_12",[0,0]],["5_30_11",[0,0]],["5_6_12",[0,0]],["5_18_11",[0,0]],["5_10_11",[0,0]],["5_26_10",[0,0]],["5_14_13",[0,0]],["5_20_12",[0,0]],["5_4_12",[0,0]],["5_2_12",[0,0]],["5_8_12",[0,0]],["5_22_9",[0,0]],["5_16_12",[0,0]],["5_24_5",[0,6908]],["5_6_13",[0,0]],["5_28_12",[0,0]],["5_0_13",[0,0]],["5_30_12",[0,0]],["5_12_10",[0,0]],["5_18_12",[0,0]],["5_10_12",[0,0]],["5_14_14",[0,0]],["5_26_11",[0,0]],["5_4_13",[0,0]],["5_20_13",[0,0]],["5_2_13",[0,0]],["5_6_14",[0,0]],["5_16_13",[0,0]],["5_8_13",[0,0]],["5_28_13",[0,0]],["5_10_13",[0,0]],["5_0_14",[0,0]],["5_22_10",[0,0]],["5_18_13",[0,0]],["5_24_6",[0,2341]],["5_12_11",[0,0]],["5_30_13",[0,0]],["5_26_12",[0,0]],["5_14_15",[0,0]],["5_20_14",[0,0]],["5_4_14",[0,0]],["5_6_15",[0,0]],["5_16_14",[0,0]],["5_2_14",[0,0]],["5_8_14",[0,0]],["5_28_14",[0,0]],["5_10_14",[0,0]],["5_0_15",[0,0]],["5_22_11",[0,0]],["5_18_14",[0,0]],["5_24_7",[0,0]],["5_15_0",[0,0]],["5_30_14",[0,0]],["5_26_13",[0,0]],["5_20_15",[0,0]],["5_12_12",[0,0]],["5_2_15",[0,0]],["5_4_15",[0,0]],["5_7_0",[0,0]],["5_8_15",[0,0]],["5_1_0",[0,0]],["5_10_15",[0,0]],["5_16_15",[0,0]],["5_28_15",[0,0]],["5_18_15",[0,0]],["5_22_12",[0,0]],["5_30_15",[0,0]],["5_24_8",[0,0]],["5_15_1",[0,0]],["5_7_1",[0,0]],["5_26_14",[0,0]],["5_21_0",[0,0]],["5_3_0",[0,0]],["5_5_0",[0,0]],["5_12_13",[0,0]],["5_9_0",[0,0]],["5_1_1",[0,0]],["5_11_0",[0,0]],["5_7_2",[0,0]],["5_17_0",[0,0]],["5_29_0",[0,0]],["5_31_0",[0,0]],["5_19_0",[0,0]],["5_26_15",[0,0]],["5_24_9",[0,0]],["5_22_13",[0,0]],["5_15_2",[0,0]],["5_21_1",[0,0]],["5_3_1",[0,0]],["5_1_2",[0,0]],["5_5_1",[0,0]],["5_9_1",[0,0]],["5_11_1",[0,0]],["5_7_3",[0,0]],["5_12_14",[0,0]],["5_17_1",[0,0]],["5_29_1",[0,0]],["5_19_1",[0,0]],["5_15_3",[0,0]],["5_31_1",[0,0]],["5_27_0",[0,0]],["5_7_4",[0,0]],["5_21_2",[0,0]],["5_24_10",[0,0]],["5_1_3",[0,0]],["5_5_2",[0,0]],["5_22_14",[0,0]],["5_3_2",[0,0]],["5_9_2",[0,0]],["5_11_2",[0,0]],["5_17_2",[0,0]],["5_27_1",[0,0]],["5_12_15",[0,0]],["5_29_2",[0,0]],["5_19_2",[0,0]],["5_15_4",[0,0]],["5_31_2",[0,0]],["5_21_3",[0,0]],["5_7_5",[0,0]],["5_3_3",[0,0]],["5_9_3",[0,0]],["5_11_3",[0,0]],["5_5_3",[0,0]],["5_27_2",[0,0]],["5_24_11",[0,0]],["5_1_4",[0,0]],["5_17_3",[0,0]],["5_21_4",[0,0]],["5_29_3",[0,0]],["5_13_0",[0,0]],["5_7_6",[0,0]],["5_19_3",[0,0]],["5_31_3",[0,0]],["5_3_4",[0,0]],["5_15_5",[0,0]],["5_22_15",[0,0]],["5_5_4",[0,0]],["5_21_5",[0,0]],["5_9_4",[0,0]],["5_11_4",[0,0]],["5_17_4",[0,0]],["5_24_12",[0,0]],["5_1_5",[0,0]],["5_7_7",[0,0]],["5_27_3",[0,1306]],["5_3_5",[0,0]],["5_29_4",[0,0]],["5_13_1",[0,0]],["5_5_5",[0,0]],["5_21_6",[0,0]],["5_11_5",[0,0]],["5_31_4",[0,0]],["5_19_4",[0,0]],["5_17_5",[0,0]],["5_15_6",[0,0]],["5_9_5",[0,0]],["5_7_8",[0,0]],["5_24_13",[0,0]],["5_1_6",[0,0]],["5_3_6",[0,0]],["5_23_0",[0,0]],["5_29_5",[0,0]],["5_13_2",[0,0]],["5_27_4",[-29,2496]],["5_5_6",[0,0]],["5_21_7",[0,0]],["5_7_9",[0,0]],["5_11_6",[0,0]],["5_31_5",[0,0]],["5_19_5",[0,0]],["5_17_6",[0,0]],["5_15_7",[0,0]],["5_9_6",[0,0]],["5_27_5",[0,0]],["5_29_6",[0,0]],["5_21_8",[0,0]],["5_5_7",[0,0]],["5_1_7",[0,0]],["5_24_14",[0,0]],["5_7_10",[0,0]],["5_13_3",[0,0]],["5_3_7",[0,0]],["5_31_6",[0,0]],["5_27_6",[0,0]],["5_21_9",[0,0]],["5_15_8",[0,0]],["5_29_7",[0,0]],["5_5_8",[0,0]],["5_11_7",[0,0]],["5_23_1",[0,0]],["5_17_7",[0,0]],["5_19_6",[0,0]],["5_7_11",[0,0]],["5_9_7",[0,0]],["5_1_8",[0,0]],["5_24_15",[0,0]],["5_13_4",[0,0]],["5_3_8",[0,0]],["5_27_7",[0,0]],["5_31_7",[0,0]],["5_11_8",[0,0]],["5_29_8",[0,0]],["5_15_9",[0,0]],["5_21_10",[0,0]],["5_1_9",[0,0]],["5_17_8",[0,0]],["5_7_12",[0,0]],["5_19_7",[0,0]],["5_5_9",[0,0]],["5_9_8",[0,0]],["5_27_8",[0,0]],["5_23_2",[0,0]],["5_25_0",[0,0]],["5_29_9",[0,0]],["5_11_9",[0,0]],["5_21_11",[0,0]],["5_13_5",[0,0]],["5_31_8",[0,0]],["5_3_9",[0,0]],["5_27_9",[0,0]],["5_15_10",[0,0]],["5_1_10",[0,0]],["5_19_8",[0,0]],["5_5_10",[0,0]],["5_17_9",[0,0]],["5_7_13",[0,0]],["5_9_9",[0,0]],["5_25_1",[0,0]],["5_21_12",[0,0]],["5_29_10",[0,0]],["5_31_9",[0,0]],["5_11_10",[0,0]],["5_13_6",[0,0]],["5_27_10",[0,0]],["5_3_10",[0,0]],["5_19_9",[0,0]],["5_1_11",[0,0]],["5_5_11",[0,0]],["5_9_10",[0,0]],["5_17_10",[0,0]],["5_7_14",[0,0]],["5_15_11",[0,0]],["5_25_2",[0,0]],["5_23_3",[0,4087]],["5_11_11",[0,0]],["5_29_11",[0,0]],["5_19_10",[0,0]],["5_31_10",[0,0]],["5_21_13",[0,0]],["5_13_7",[0,0]],["5_3_11",[0,0]],["5_27_11",[0,0]],["5_17_11",[0,0]],["5_5_12",[0,0]],["5_9_11",[0,0]],["5_1_12",[0,0]],["5_7_15",[0,0]],["5_15_12",[0,0]],["5_25_3",[0,1131]],["5_29_12",[0,0]],["5_19_11",[0,0]],["5_5_13",[0,0]],["5_17_12",[0,0]],["5_15_13",[0,0]],["5_13_8",[0,0]],["5_27_12",[0,0]],["5_9_12",[0,0]],["5_21_14",[0,0]],["5_3_12",[0,0]],["5_31_11",[0,0]],["5_1_13",[0,0]],["5_11_12",[0,0]],["5_29_13",[0,0]],["5_19_12",[0,0]],["5_29_14",[0,0]],["5_5_14",[0,0]],["5_19_13",[0,0]],["5_17_13",[0,0]],["5_25_4",[0,4796]],["5_27_13",[0,0]],["5_9_13",[0,0]],["5_21_15",[0,0]],["5_11_13",[0,0]],["5_15_14",[0,0]],["5_31_12",[0,0]],["5_1_14",[0,0]],["5_13_9",[0,0]],["5_3_13",[0,0]],["5_19_14",[0,0]],["5_17_14",[0,0]],["5_29_15",[0,0]],["5_5_15",[0,0]],["5_11_14",[0,0]],["5_9_14",[0,0]],["5_17_15",[0,0]],["5_27_14",[0,0]],["5_1_15",[0,0]],["5_15_15",[0,0]],["5_13_10",[0,0]],["5_31_13",[0,0]],["5_23_4",[-216,6607]],["5_19_15",[0,0]],["5_3_14",[0,0]],["5_9_15",[0,0]],["5_11_15",[0,0]],["5_31_14",[0,0]],["5_13_11",[0,0]],["5_27_15",[0,0]],["5_3_15",[0,0]],["5_31_15",[0,0]],["5_13_12",[0,0]],["5_25_5",[-2,6318]],["5_13_13",[0,0]],["5_25_6",[-22,2600]],["5_23_5",[0,7724]],["5_25_7",[0,0]],["5_13_14",[0,0]],["5_25_8",[0,0]],["5_23_6",[0,0]],["5_13_15",[0,0]],["5_25_9",[0,0]],["5_23_7",[0,0]],["5_25_10",[0,0]],["5_23_8",[0,0]],["5_25_11",[0,0]],["5_23_9",[0,0]],["5_25_12",[0,0]],["5_23_10",[0,0]],["5_25_13",[0,0]],["5_25_14",[0,0]],["5_23_11",[0,0]],["5_25_15",[0,0]],["5_23_12",[0,0]],["5_23_13",[0,0]],["5_23_14",[0,0]],["5_23_15",[0,0]],["6_44_0",[0,0]],["6_28_0",[0,0]],["6_36_0",[0,0]],["6_4_0",[0,0]],["6_52_0",[0,0]],["6_24_0",[0,0]],["6_12_0",[0,0]],["6_40_0",[0,0]],["6_16_0",[0,0]],["6_0_0",[0,0]],["6_8_0",[0,0]],["6_48_0",[0,0]],["6_60_0",[0,0]],["6_20_0",[0,0]],["6_32_0",[0,0]],["6_56_0",[0,0]],["6_28_1",[0,0]],["6_44_1",[0,0]],["6_36_1",[0,0]],["6_24_1",[0,0]],["6_4_1",[0,0]],["6_52_1",[0,0]],["6_12_1",[0,0]],["6_0_1",[0,0]],["6_16_1",[0,0]],["6_60_1",[0,0]],["6_8_1",[0,0]],["6_48_1",[0,0]],["6_40_1",[0,0]],["6_24_2",[0,0]],["6_36_2",[0,0]],["6_4_2",[0,0]],["6_56_1",[0,0]],["6_20_1",[0,0]],["6_28_2",[0,0]],["6_44_2",[0,0]],["6_32_1",[0,0]],["6_52_2",[0,0]],["6_0_2",[0,0]],["6_16_2",[0,0]],["6_60_2",[0,0]],["6_12_2",[0,0]],["6_40_2",[0,0]],["6_8_2",[0,0]],["6_56_2",[0,0]],["6_48_2",[0,0]],["6_36_3",[0,0]],["6_24_3",[0,0]],["6_20_2",[0,0]],["6_28_3",[0,0]],["6_44_3",[0,0]],["6_32_2",[0,0]],["6_4_3",[0,0]],["6_52_3",[0,0]],["6_0_3",[0,0]],["6_16_3",[0,0]],["6_8_3",[0,0]],["6_12_3",[0,0]],["6_60_3",[0,0]],["6_40_3",[0,0]],["6_56_3",[0,0]],["6_36_4",[0,0]],["6_4_4",[0,0]],["6_48_3",[0,0]],["6_24_4",[0,0]],["6_44_4",[0,0]],["6_20_3",[0,0]],["6_28_4",[0,0]],["6_32_3",[0,0]],["6_52_4",[0,0]],["6_40_4",[0,0]],["6_60_4",[0,0]],["6_0_4",[0,0]],["6_16_4",[0,0]],["6_8_4",[0,0]],["6_12_4",[0,0]],["6_56_4",[0,0]],["6_48_4",[0,0]],["6_36_5",[0,0]],["6_4_5",[0,0]],["6_28_5",[0,0]],["6_24_5",[0,0]],["6_44_5",[0,0]],["6_20_4",[0,0]],["6_52_5",[0,0]],["6_32_4",[0,0]],["6_40_5",[0,0]],["6_60_5",[0,0]],["6_4_6",[0,0]],["6_56_5",[0,0]],["6_16_5",[0,0]],["6_0_5",[0,0]],["6_48_5",[0,0]],["6_12_5",[0,0]],["6_20_5",[0,0]],["6_36_6",[0,0]],["6_44_6",[0,0]],["6_8_5",[0,0]],["6_28_6",[0,0]],["6_24_6",[0,0]],["6_32_5",[0,0]],["6_52_6",[0,0]],["6_60_6",[0,0]],["6_4_7",[0,0]],["6_40_6",[0,0]],["6_56_6",[0,0]],["6_16_6",[0,0]],["6_48_6",[0,0]],["6_12_6",[0,0]],["6_0_6",[0,0]],["6_8_6",[0,0]],["6_20_6",[0,0]],["6_44_7",[0,0]],["6_28_7",[0,0]],["6_36_7",[0,0]],["6_24_7",[0,0]],["6_32_6",[0,0]],["6_52_7",[0,1661]],["6_8_7",[0,0]],["6_16_7",[0,0]],["6_4_8",[0,0]],["6_60_7",[0,0]],["6_12_7",[0,0]],["6_40_7",[0,0]],["6_56_7",[0,762]],["6_20_7",[0,0]],["6_44_8",[0,5632]],["6_28_8",[0,0]],["6_32_7",[0,0]],["6_24_8",[0,0]],["6_0_7",[0,0]],["6_36_8",[0,0]],["6_48_7",[0,3926]],["6_56_8",[0,0]],["6_40_8",[0,0]],["6_4_9",[0,0]],["6_8_8",[0,0]],["6_16_8",[0,0]],["6_60_8",[0,0]],["6_52_8",[-3,2660]],["6_12_8",[0,0]],["6_20_8",[0,0]],["6_28_9",[0,0]],["6_44_9",[0,6885]],["6_32_8",[0,0]],["6_24_9",[0,0]],["6_36_9",[0,0]],["6_0_8",[0,0]],["6_48_8",[0,4567]],["6_4_10",[0,0]],["6_8_9",[0,0]],["6_40_9",[0,0]],["6_56_9",[0,0]],["6_16_9",[0,0]],["6_60_9",[0,0]],["6_28_10",[0,0]],["6_12_9",[0,0]],["6_44_10",[0,0]],["6_20_9",[0,0]],["6_52_9",[-6,2882]],["6_32_9",[0,0]],["6_24_10",[0,0]],["6_4_11",[0,0]],["6_16_10",[0,0]],["6_60_10",[0,0]],["6_40_10",[0,0]],["6_44_11",[0,0]],["6_12_10",[0,0]],["6_20_10",[0,0]],["6_28_11",[0,0]],["6_36_10",[0,0]],["6_8_10",[0,0]],["6_56_10",[0,0]],["6_0_9",[0,0]],["6_32_10",[0,0]],["6_24_11",[0,0]],["6_60_11",[0,0]],["6_16_11",[0,0]],["6_4_12",[0,0]],["6_48_9",[1280,6396]],["6_44_12",[0,0]],["6_40_11",[0,0]],["6_12_11",[0,0]],["6_20_11",[0,0]],["6_36_11",[0,0]],["6_28_12",[0,0]],["6_56_11",[0,0]],["6_8_11",[0,0]],["6_52_10",[1,1587]],["6_0_10",[0,0]],["6_12_12",[0,0]],["6_44_13",[0,0]],["6_4_13",[0,0]],["6_40_12",[0,0]],["6_36_12",[0,0]],["6_32_11",[0,0]],["6_24_12",[0,0]],["6_16_12",[0,0]],["6_60_12",[0,0]],["6_20_12",[0,0]],["6_56_12",[0,0]],["6_28_13",[0,0]],["6_8_12",[0,0]],["6_0_11",[0,0]],["6_44_14",[0,0]],["6_20_13",[0,0]],["6_40_13",[0,0]],["6_60_13",[0,0]],["6_12_13",[0,0]],["6_24_13",[0,0]],["6_4_14",[0,0]],["6_36_13",[0,0]],["6_16_13",[0,0]],["6_32_12",[0,0]],["6_28_14",[0,0]],["6_8_13",[0,0]],["6_56_13",[0,0]],["6_0_12",[0,0]],["6_40_14",[0,0]],["6_4_15",[0,0]],["6_24_14",[0,0]],["6_36_14",[0,0]],["6_12_14",[0,0]],["6_32_13",[0,0]],["6_44_15",[0,0]],["6_20_14",[0,0]],["6_60_14",[0,0]],["6_16_14",[0,0]],["6_52_11",[-12,2016]],["6_4_16",[0,0]],["6_8_14",[0,0]],["6_56_14",[0,0]],["6_28_15",[0,0]],["6_0_13",[0,0]],["6_40_15",[0,0]],["6_20_15",[0,0]],["6_60_15",[0,0]],["6_12_15",[0,0]],["6_24_15",[0,0]],["6_36_15",[0,0]],["6_32_14",[0,0]],["6_44_16",[0,0]],["6_16_15",[0,0]],["6_52_12",[-7,726]],["6_56_15",[0,0]],["6_4_17",[0,0]],["6_8_15",[0,0]],["6_28_16",[0,0]],["6_12_16",[0,0]],["6_24_16",[0,0]],["6_0_14",[0,0]],["6_32_15",[0,0]],["6_60_16",[0,0]],["6_40_16",[0,0]],["6_20_16",[0,0]],["6_36_16",[0,0]],["6_44_17",[0,0]],["6_16_16",[0,0]],["6_28_17",[0,0]],["6_8_16",[0,0]],["6_4_18",[0,0]],["6_56_16",[0,0]],["6_52_13",[0,0]],["6_0_15",[0,0]],["6_12_17",[0,0]],["6_24_17",[0,0]],["6_20_17",[0,0]],["6_32_16",[0,0]],["6_60_17",[0,0]],["6_40_17",[0,0]],["6_16_17",[0,0]],["6_56_17",[0,0]],["6_44_18",[0,0]],["6_36_17",[0,0]],["6_8_17",[0,0]],["6_28_18",[0,0]],["6_52_14",[0,0]],["6_4_19",[0,0]],["6_0_16",[0,0]],["6_12_18",[0,0]],["6_32_17",[0,0]],["6_40_18",[0,0]],["6_60_18",[0,0]],["6_24_18",[0,0]],["6_20_18",[0,0]],["6_48_10",[138,6949]],["6_16_18",[0,0]],["6_44_19",[0,0]],["6_56_18",[0,0]],["6_8_18",[0,0]],["6_28_19",[0,0]],["6_36_18",[0,0]],["6_52_15",[0,0]],["6_12_19",[0,0]],["6_0_17",[0,0]],["6_32_18",[0,0]],["6_40_19",[0,0]],["6_4_20",[0,0]],["6_60_19",[0,0]],["6_24_19",[0,0]],["6_20_19",[0,0]],["6_16_19",[0,0]],["6_44_20",[0,0]],["6_8_19",[0,0]],["6_28_20",[0,0]],["6_56_19",[0,0]],["6_32_19",[0,0]],["6_52_16",[0,0]],["6_12_20",[0,0]],["6_36_19",[0,0]],["6_60_20",[0,0]],["6_0_18",[0,0]],["6_4_21",[0,0]],["6_40_20",[0,0]],["6_24_20",[0,0]],["6_20_20",[0,0]],["6_56_20",[0,0]],["6_16_20",[0,0]],["6_8_20",[0,0]],["6_44_21",[0,0]],["6_48_11",[0,7230]],["6_0_19",[0,0]],["6_36_20",[0,0]],["6_4_22",[0,0]],["6_24_21",[0,0]],["6_52_17",[0,0]],["6_12_21",[0,0]],["6_28_21",[0,0]],["6_32_20",[0,0]],["6_60_21",[0,0]],["6_40_21",[0,0]],["6_20_21",[0,0]],["6_44_22",[0,0]],["6_48_12",[0,0]],["6_56_21",[0,0]],["6_16_21",[0,0]],["6_0_20",[0,0]],["6_8_21",[0,0]],["6_24_22",[0,0]],["6_28_22",[0,0]],["6_36_21",[0,0]],["6_12_22",[0,0]],["6_20_22",[0,0]],["6_4_23",[0,0]],["6_52_18",[0,0]],["6_40_22",[0,0]],["6_60_22",[0,0]],["6_32_21",[0,0]],["6_48_13",[0,0]],["6_44_23",[0,0]],["6_8_22",[0,0]],["6_56_22",[0,0]],["6_16_22",[0,0]],["6_24_23",[0,0]],["6_0_21",[0,0]],["6_28_23",[0,0]],["6_52_19",[0,0]],["6_20_23",[0,0]],["6_12_23",[0,0]],["6_36_22",[0,0]],["6_4_24",[0,0]],["6_40_23",[0,0]],["6_60_23",[0,0]],["6_32_22",[0,0]],["6_48_14",[0,0]],["6_44_24",[0,0]],["6_8_23",[0,0]],["6_20_24",[0,0]],["6_12_24",[0,0]],["6_36_23",[0,0]],["6_52_20",[0,0]],["6_4_25",[0,0]],["6_40_24",[0,0]],["6_32_23",[0,0]],["6_56_23",[0,0]],["6_16_23",[0,0]],["6_0_22",[0,0]],["6_24_24",[0,0]],["6_28_24",[0,0]],["6_60_24",[0,0]],["6_52_21",[0,0]],["6_36_24",[0,0]],["6_32_24",[0,0]],["6_4_26",[0,0]],["6_16_24",[0,0]],["6_0_23",[0,0]],["6_56_24",[0,0]],["6_40_25",[0,0]],["6_44_25",[0,0]],["6_48_15",[0,0]],["6_20_25",[0,0]],["6_8_24",[0,0]],["6_12_25",[0,0]],["6_28_25",[0,0]],["6_24_25",[0,0]],["6_4_27",[0,0]],["6_0_24",[0,0]],["6_56_25",[0,0]],["6_36_25",[0,0]],["6_40_26",[0,0]],["6_52_22",[0,0]],["6_20_26",[0,0]],["6_16_25",[0,0]],["6_8_25",[0,0]],["6_48_16",[0,0]],["6_28_26",[0,0]],["6_44_26",[0,0]],["6_12_26",[0,0]],["6_24_26",[0,0]],["6_32_25",[0,0]],["6_60_25",[0,0]],["6_20_27",[0,0]],["6_8_26",[0,0]],["6_0_25",[0,0]],["6_4_28",[0,0]],["6_56_26",[0,0]],["6_36_26",[0,0]],["6_40_27",[0,0]],["6_48_17",[0,0]],["6_24_27",[0,0]],["6_16_26",[0,0]],["6_28_27",[0,0]],["6_52_23",[0,0]],["6_60_26",[0,0]],["6_12_27",[0,0]],["6_44_27",[0,0]],["6_32_26",[0,0]],["6_36_27",[0,0]],["6_4_29",[0,0]],["6_8_27",[0,0]],["6_48_18",[0,0]],["6_56_27",[0,0]],["6_20_28",[0,0]],["6_0_26",[0,0]],["6_40_28",[0,0]],["6_44_28",[0,0]],["6_60_27",[0,0]],["6_32_27",[0,0]],["6_36_28",[0,0]],["6_12_28",[0,0]],["6_48_19",[0,0]],["6_16_27",[0,0]],["6_52_24",[0,0]],["6_24_28",[0,0]],["6_28_28",[0,0]],["6_8_28",[0,0]],["6_0_27",[0,0]],["6_4_30",[0,0]],["6_56_28",[0,0]],["6_20_29",[0,0]],["6_48_20",[0,0]],["6_24_29",[0,0]],["6_36_29",[0,0]],["6_52_25",[0,0]],["6_16_28",[0,0]],["6_28_29",[0,0]],["6_8_29",[0,0]],["6_4_31",[0,0]],["6_56_29",[0,0]],["6_0_28",[0,0]],["6_60_28",[0,0]],["6_40_29",[0,0]],["6_44_29",[0,0]],["6_32_28",[0,0]],["6_12_29",[0,0]],["6_20_30",[0,0]],["6_48_21",[0,0]],["6_36_30",[0,0]],["6_24_30",[0,0]],["6_5_0",[0,0]],["6_0_29",[0,0]],["6_32_29",[0,0]],["6_28_30",[0,0]],["6_52_26",[0,0]],["6_16_29",[0,0]],["6_8_30",[0,0]],["6_56_30",[0,0]],["6_60_29",[0,0]],["6_20_31",[0,0]],["6_12_30",[0,0]],["6_40_30",[0,0]],["6_44_30",[0,0]],["6_48_22",[0,0]],["6_28_31",[0,0]],["6_56_31",[0,0]],["6_0_30",[0,0]],["6_12_31",[0,0]],["6_21_0",[0,0]],["6_8_31",[0,0]],["6_40_31",[0,0]],["6_24_31",[0,0]],["6_16_30",[0,0]],["6_52_27",[0,0]],["6_32_30",[0,0]],["6_36_31",[0,0]],["6_5_1",[0,0]],["6_60_30",[0,0]],["6_44_31",[0,0]],["6_48_23",[0,0]],["6_29_0",[0,0]],["6_41_0",[0,0]],["6_32_31",[0,0]],["6_52_28",[0,0]],["6_16_31",[0,0]],["6_5_2",[0,0]],["6_25_0",[0,0]],["6_37_0",[0,0]],["6_0_31",[0,0]],["6_21_1",[0,0]],["6_57_0",[0,0]],["6_13_0",[0,0]],["6_45_0",[0,0]],["6_9_0",[0,0]],["6_60_31",[0,0]],["6_48_24",[0,0]],["6_29_1",[0,0]],["6_33_0",[0,0]],["6_41_1",[0,0]],["6_52_29",[0,0]],["6_25_1",[0,0]],["6_17_0",[0,0]],["6_5_3",[0,0]],["6_57_1",[0,0]],["6_1_0",[0,0]],["6_45_1",[0,0]],["6_13_1",[0,0]],["6_9_1",[0,0]],["6_37_1",[0,0]],["6_21_2",[0,0]],["6_61_0",[0,0]],["6_29_2",[0,0]],["6_48_25",[0,0]],["6_33_1",[0,0]],["6_41_2",[0,0]],["6_5_4",[0,0]],["6_57_2",[0,0]],["6_25_2",[0,0]],["6_17_1",[0,0]],["6_1_1",[0,0]],["6_52_30",[0,0]],["6_9_2",[0,0]],["6_13_2",[0,0]],["6_37_2",[0,0]],["6_45_2",[0,0]],["6_61_1",[0,0]],["6_21_3",[0,0]],["6_5_5",[0,0]],["6_25_3",[0,0]],["6_17_2",[0,0]],["6_52_31",[0,0]],["6_33_2",[0,0]],["6_41_3",[0,0]],["6_57_3",[0,0]],["6_48_26",[0,0]],["6_29_3",[0,0]],["6_1_2",[0,0]],["6_9_3",[0,0]],["6_13_3",[0,0]],["6_45_3",[0,0]],["6_37_3",[0,0]],["6_25_4",[0,0]],["6_5_6",[0,0]],["6_41_4",[0,0]],["6_9_4",[0,0]],["6_29_4",[0,0]],["6_48_27",[0,0]],["6_57_4",[0,0]],["6_61_2",[0,0]],["6_33_3",[0,0]],["6_17_3",[0,0]],["6_21_4",[0,0]],["6_53_0",[0,0]],["6_45_4",[0,0]],["6_1_3",[0,0]],["6_13_4",[0,0]],["6_37_4",[0,0]],["6_29_5",[0,0]],["6_9_5",[0,0]],["6_17_4",[0,0]],["6_61_3",[0,0]],["6_33_4",[0,0]],["6_53_1",[0,0]],["6_25_5",[0,0]],["6_5_7",[0,0]],["6_41_5",[0,0]],["6_57_5",[0,0]],["6_48_28",[0,0]],["6_21_5",[0,0]],["6_9_6",[0,0]],["6_17_5",[0,0]],["6_25_6",[0,0]],["6_33_5",[0,0]],["6_53_2",[0,0]],["6_5_8",[0,0]],["6_61_4",[0,0]],["6_41_6",[0,0]],["6_1_4",[0,0]],["6_37_5",[0,0]],["6_13_5",[0,0]],["6_45_5",[0,0]],["6_29_6",[0,0]],["6_57_6",[0,0]],["6_48_29",[0,0]],["6_21_6",[0,0]],["6_61_5",[0,0]],["6_53_3",[0,0]],["6_41_7",[0,0]],["6_13_6",[0,0]],["6_45_6",[0,0]],["6_37_6",[0,0]],["6_57_7",[0,0]],["6_48_30",[0,0]],["6_29_7",[0,0]],["6_1_5",[0,0]],["6_17_6",[0,0]],["6_9_7",[0,0]],["6_25_7",[0,0]],["6_33_6",[0,0]],["6_5_9",[0,0]],["6_21_7",[0,0]],["6_53_4",[0,0]],["6_61_6",[0,0]],["6_41_8",[0,0]],["6_37_7",[0,0]],["6_13_7",[0,0]],["6_33_7",[0,0]],["6_17_7",[0,0]],["6_57_8",[0,0]],["6_5_10",[0,0]],["6_45_7",[0,0]],["6_9_8",[0,0]],["6_1_6",[0,0]],["6_48_31",[0,0]],["6_25_8",[0,0]],["6_21_8",[0,0]],["6_29_8",[0,0]],["6_61_7",[0,0]],["6_53_5",[0,0]],["6_41_9",[0,0]],["6_37_8",[0,0]],["6_13_8",[0,0]],["6_17_8",[0,0]],["6_33_8",[0,0]],["6_57_9",[0,0]],["6_25_9",[0,0]],["6_9_9",[0,0]],["6_5_11",[0,0]],["6_49_0",[0,0]],["6_1_7",[0,0]],["6_29_9",[0,0]],["6_21_9",[0,0]],["6_41_10",[0,0]],["6_37_9",[0,0]],["6_61_8",[0,0]],["6_13_9",[0,0]],["6_17_9",[0,0]],["6_57_10",[0,0]],["6_33_9",[0,0]],["6_53_6",[0,1427]],["6_29_10",[0,0]],["6_21_10",[0,0]],["6_41_11",[0,0]],["6_37_10",[0,0]],["6_13_10",[0,0]],["6_25_10",[0,0]],["6_9_10",[0,0]],["6_5_12",[0,0]],["6_1_8",[0,0]],["6_49_1",[0,0]],["6_61_9",[0,0]],["6_57_11",[0,0]],["6_17_10",[0,0]],["6_21_11",[0,0]],["6_13_11",[0,0]],["6_25_11",[0,0]],["6_49_2",[0,0]],["6_9_11",[0,0]],["6_1_9",[0,0]],["6_5_13",[0,0]],["6_33_10",[0,0]],["6_41_12",[0,0]],["6_29_11",[0,0]],["6_53_7",[0,1651]],["6_37_11",[0,0]],["6_61_10",[0,0]],["6_17_11",[0,0]],["6_9_12",[0,0]],["6_5_14",[0,0]],["6_41_13",[0,0]],["6_57_12",[0,0]],["6_21_12",[0,0]],["6_25_12",[0,0]],["6_49_3",[0,0]],["6_33_11",[0,0]],["6_37_12",[0,0]],["6_13_12",[0,0]],["6_29_12",[0,0]],["6_1_10",[0,0]],["6_53_8",[-27,1843]],["6_61_11",[0,0]],["6_45_8",[0,6305]],["6_17_12",[0,0]],["6_5_15",[0,0]],["6_25_13",[0,0]],["6_9_13",[0,0]],["6_57_13",[0,0]],["6_49_4",[0,0]],["6_41_14",[0,0]],["6_33_12",[0,0]],["6_37_13",[0,0]],["6_13_13",[0,0]],["6_29_13",[0,0]],["6_21_13",[0,0]],["6_5_16",[0,0]],["6_61_12",[0,0]],["6_1_11",[0,0]],["6_17_13",[0,0]],["6_53_9",[-4,913]],["6_25_14",[0,0]],["6_9_14",[0,0]],["6_57_14",[0,0]],["6_49_5",[0,0]],["6_33_13",[0,0]],["6_41_15",[0,0]],["6_61_13",[0,0]],["6_21_14",[0,0]],["6_17_14",[0,0]],["6_13_14",[0,0]],["6_5_17",[0,0]],["6_37_14",[0,0]],["6_29_14",[0,0]],["6_25_15",[0,0]],["6_1_12",[0,0]],["6_57_15",[0,0]],["6_49_6",[0,0]],["6_41_16",[0,0]],["6_33_14",[0,0]],["6_9_15",[0,0]],["6_5_18",[0,0]],["6_37_15",[0,0]],["6_13_15",[0,0]],["6_29_15",[0,0]],["6_25_16",[0,0]],["6_61_14",[0,0]],["6_21_15",[0,0]],["6_17_15",[0,0]],["6_53_10",[-1,1650]],["6_57_16",[0,0]],["6_1_13",[0,0]],["6_41_17",[0,0]],["6_49_7",[0,0]],["6_9_16",[0,0]],["6_33_15",[0,0]],["6_5_19",[0,0]],["6_13_16",[0,0]],["6_37_16",[0,0]],["6_61_15",[0,0]],["6_25_17",[0,0]],["6_17_16",[0,0]],["6_29_16",[0,0]],["6_21_16",[0,0]],["6_57_17",[0,0]],["6_41_18",[0,0]],["6_9_17",[0,0]],["6_1_14",[0,0]],["6_49_8",[0,5148]],["6_33_16",[0,0]],["6_5_20",[0,0]],["6_13_17",[0,0]],["6_57_18",[0,0]],["6_21_17",[0,0]],["6_41_19",[0,0]],["6_61_16",[0,0]],["6_37_17",[0,0]],["6_25_18",[0,0]],["6_17_17",[0,0]],["6_9_18",[0,0]],["6_29_17",[0,0]],["6_33_17",[0,0]],["6_1_15",[0,0]],["6_13_18",[0,0]],["6_61_17",[0,0]],["6_25_19",[0,0]],["6_41_20",[0,0]],["6_9_19",[0,0]],["6_17_18",[0,0]],["6_37_18",[0,0]],["6_29_18",[0,0]],["6_33_18",[0,0]],["6_5_21",[0,0]],["6_21_18",[0,0]],["6_57_19",[0,0]],["6_53_11",[-1,3634]],["6_1_16",[0,0]],["6_61_18",[0,0]],["6_13_19",[0,0]],["6_25_20",[0,0]],["6_17_19",[0,0]],["6_9_20",[0,0]],["6_21_19",[0,0]],["6_41_21",[0,0]],["6_37_19",[0,0]],["6_29_19",[0,0]],["6_5_22",[0,0]],["6_33_19",[0,0]],["6_57_20",[0,0]],["6_9_21",[0,0]],["6_17_20",[0,0]],["6_25_21",[0,0]],["6_1_17",[0,0]],["6_53_12",[-1,1766]],["6_61_19",[0,0]],["6_13_20",[0,0]],["6_29_20",[0,0]],["6_57_21",[0,0]],["6_33_20",[0,0]],["6_37_20",[0,0]],["6_21_20",[0,0]],["6_41_22",[0,0]],["6_5_23",[0,0]],["6_25_22",[0,0]],["6_17_21",[0,0]],["6_61_20",[0,0]],["6_13_21",[0,0]],["6_37_21",[0,0]],["6_33_21",[0,0]],["6_5_24",[0,0]],["6_21_21",[0,0]],["6_57_22",[0,0]],["6_41_23",[0,0]],["6_9_22",[0,0]],["6_1_18",[0,0]],["6_53_13",[0,0]],["6_29_21",[0,0]],["6_49_9",[1295,6084]],["6_17_22",[0,0]],["6_25_23",[0,0]],["6_37_22",[0,0]],["6_57_23",[0,0]],["6_61_21",[0,0]],["6_29_22",[0,0]],["6_5_25",[0,0]],["6_33_22",[0,0]],["6_13_22",[0,0]],["6_21_22",[0,0]],["6_53_14",[0,0]],["6_17_23",[0,0]],["6_9_23",[0,0]],["6_41_24",[0,0]],["6_1_19",[0,0]],["6_25_24",[0,0]],["6_33_23",[0,0]],["6_5_26",[0,0]],["6_37_23",[0,0]],["6_13_23",[0,0]],["6_61_22",[0,0]],["6_29_23",[0,0]],["6_57_24",[0,0]],["6_1_20",[0,0]],["6_9_24",[0,0]],["6_17_24",[0,0]],["6_41_25",[0,0]],["6_53_15",[0,0]],["6_21_23",[0,0]],["6_29_24",[0,0]],["6_13_24",[0,0]],["6_25_25",[0,0]],["6_37_24",[0,0]],["6_5_27",[0,0]],["6_45_9",[0,7922]],["6_17_25",[0,0]],["6_21_24",[0,0]],["6_9_25",[0,0]],["6_33_24",[0,0]],["6_61_23",[0,0]],["6_57_25",[0,0]],["6_1_21",[0,0]],["6_53_16",[0,0]],["6_41_26",[0,0]],["6_29_25",[0,0]],["6_37_25",[0,0]],["6_13_25",[0,0]],["6_5_28",[0,0]],["6_25_26",[0,0]],["6_17_26",[0,0]],["6_9_26",[0,0]],["6_57_26",[0,0]],["6_21_25",[0,0]],["6_1_22",[0,0]],["6_61_24",[0,0]],["6_33_25",[0,0]],["6_5_29",[0,0]],["6_29_26",[0,0]],["6_25_27",[0,0]],["6_37_26",[0,0]],["6_41_27",[0,0]],["6_53_17",[0,0]],["6_13_26",[0,0]],["6_57_27",[0,0]],["6_9_27",[0,0]],["6_45_10",[0,6469]],["6_17_27",[0,0]],["6_5_30",[0,0]],["6_29_27",[0,0]],["6_33_26",[0,0]],["6_25_28",[0,0]],["6_61_25",[0,0]],["6_1_23",[0,0]],["6_37_27",[0,0]],["6_21_26",[0,0]],["6_41_28",[0,0]],["6_53_18",[0,0]],["6_13_27",[0,0]],["6_9_28",[0,0]],["6_57_28",[0,0]],["6_45_11",[0,0]],["6_17_28",[0,0]],["6_5_31",[0,0]],["6_33_27",[0,0]],["6_25_29",[0,0]],["6_61_26",[0,0]],["6_29_28",[0,0]],["6_53_19",[0,0]],["6_9_29",[0,0]],["6_13_28",[0,0]],["6_45_12",[0,0]],["6_57_29",[0,0]],["6_17_29",[0,0]],["6_33_28",[0,0]],["6_6_0",[0,0]],["6_29_29",[0,0]],["6_25_30",[0,0]],["6_37_28",[0,0]],["6_21_27",[0,0]],["6_1_24",[0,0]],["6_41_29",[0,0]],["6_61_27",[0,0]],["6_45_13",[0,0]],["6_6_1",[0,0]],["6_13_29",[0,0]],["6_33_29",[0,0]],["6_9_30",[0,0]],["6_53_20",[0,0]],["6_17_30",[0,0]],["6_57_30",[0,0]],["6_29_30",[0,0]],["6_37_29",[0,0]],["6_61_28",[0,0]],["6_1_25",[0,0]],["6_25_31",[0,0]],["6_41_30",[0,0]],["6_21_28",[0,0]],["6_45_14",[0,0]],["6_6_2",[0,0]],["6_13_30",[0,0]],["6_53_21",[0,0]],["6_17_31",[0,0]],["6_33_30",[0,0]],["6_57_31",[0,0]],["6_29_31",[0,0]],["6_37_30",[0,0]],["6_9_31",[0,0]],["6_61_29",[0,0]],["6_1_26",[0,0]],["6_26_0",[0,0]],["6_41_31",[0,0]],["6_21_29",[0,0]],["6_45_15",[0,0]],["6_6_3",[0,0]],["6_58_0",[0,0]],["6_33_31",[0,0]],["6_18_0",[0,0]],["6_13_31",[0,0]],["6_30_0",[0,0]],["6_37_31",[0,0]],["6_53_22",[0,0]],["6_10_0",[0,0]],["6_21_30",[0,0]],["6_61_30",[0,0]],["6_42_0",[0,0]],["6_26_1",[0,0]],["6_45_16",[0,0]],["6_1_27",[0,0]],["6_18_1",[0,0]],["6_58_1",[0,0]],["6_6_4",[0,0]],["6_34_0",[0,0]],["6_14_0",[0,0]],["6_38_0",[0,0]],["6_30_1",[0,0]],["6_26_2",[0,0]],["6_53_23",[0,0]],["6_61_31",[0,0]],["6_10_1",[0,0]],["6_21_31",[0,0]],["6_42_1",[0,0]],["6_18_2",[0,0]],["6_34_1",[0,0]],["6_45_17",[0,0]],["6_58_2",[0,0]],["6_6_5",[0,0]],["6_1_28",[0,0]],["6_14_1",[0,0]],["6_30_2",[0,0]],["6_38_1",[0,0]],["6_62_0",[0,0]],["6_53_24",[0,0]],["6_26_3",[0,0]],["6_10_2",[0,0]],["6_42_2",[0,0]],["6_45_18",[0,0]],["6_14_2",[0,0]],["6_22_0",[0,0]],["6_34_2",[0,0]],["6_18_3",[0,0]],["6_6_6",[0,0]],["6_58_3",[0,0]],["6_30_3",[0,0]],["6_38_2",[0,0]],["6_1_29",[0,0]],["6_53_25",[0,0]],["6_42_3",[0,0]],["6_45_19",[0,0]],["6_26_4",[0,0]],["6_62_1",[0,0]],["6_10_3",[0,0]],["6_6_7",[0,0]],["6_30_4",[0,0]],["6_58_4",[0,0]],["6_34_3",[0,0]],["6_14_3",[0,0]],["6_22_1",[0,0]],["6_18_4",[0,0]],["6_53_26",[0,0]],["6_38_3",[0,0]],["6_1_30",[0,0]],["6_26_5",[0,0]],["6_62_2",[0,0]],["6_45_20",[0,0]],["6_42_4",[0,0]],["6_30_5",[0,0]],["6_10_4",[0,0]],["6_34_4",[0,0]],["6_49_10",[159,6334]],["6_6_8",[0,0]],["6_58_5",[0,0]],["6_18_5",[0,0]],["6_38_4",[0,0]],["6_14_4",[0,0]],["6_22_2",[0,0]],["6_45_21",[0,0]],["6_6_9",[0,0]],["6_26_6",[0,0]],["6_53_27",[0,0]],["6_30_6",[0,0]],["6_1_31",[0,0]],["6_62_3",[0,0]],["6_34_5",[0,0]],["6_10_5",[0,0]],["6_42_5",[0,0]],["6_58_6",[0,0]],["6_18_6",[0,0]],["6_22_3",[0,0]],["6_38_5",[0,0]],["6_45_22",[0,0]],["6_14_5",[0,0]],["6_6_10",[0,0]],["6_26_7",[0,0]],["6_53_28",[0,0]],["6_30_7",[0,0]],["6_2_0",[0,0]],["6_34_6",[0,0]],["6_62_4",[0,0]],["6_22_4",[0,0]],["6_42_6",[0,0]],["6_45_23",[0,0]],["6_10_6",[0,0]],["6_18_7",[0,0]],["6_58_7",[0,0]],["6_38_6",[0,0]],["6_14_6",[0,0]],["6_34_7",[0,0]],["6_2_1",[0,0]],["6_42_7",[0,0]],["6_22_5",[0,0]],["6_62_5",[0,0]],["6_6_11",[0,0]],["6_53_29",[0,0]],["6_30_8",[0,0]],["6_26_8",[0,0]],["6_18_8",[0,0]],["6_10_7",[0,0]],["6_58_8",[0,0]],["6_45_24",[0,0]],["6_38_7",[0,0]],["6_14_7",[0,0]],["6_53_30",[0,0]],["6_62_6",[0,0]],["6_34_8",[0,0]],["6_42_8",[0,0]],["6_22_6",[0,0]],["6_6_12",[0,0]],["6_2_2",[0,0]],["6_30_9",[0,0]],["6_10_8",[0,0]],["6_14_8",[0,0]],["6_53_31",[0,0]],["6_38_8",[0,0]],["6_62_7",[0,0]],["6_34_9",[0,0]],["6_22_7",[0,0]],["6_6_13",[0,0]],["6_30_10",[0,0]],["6_42_9",[0,0]],["6_26_9",[0,0]],["6_18_9",[0,0]],["6_45_25",[0,0]],["6_58_9",[0,0]],["6_2_3",[0,0]],["6_38_9",[0,0]],["6_10_9",[0,0]],["6_14_9",[0,0]],["6_34_10",[0,0]],["6_62_8",[0,0]],["6_54_0",[0,0]],["6_30_11",[0,0]],["6_22_8",[0,0]],["6_6_14",[0,0]],["6_42_10",[0,0]],["6_58_10",[0,0]],["6_45_26",[0,0]],["6_2_4",[0,0]],["6_26_10",[0,0]],["6_18_10",[0,0]],["6_54_1",[0,0]],["6_30_12",[0,0]],["6_6_15",[0,0]],["6_14_10",[0,0]],["6_34_11",[0,0]],["6_38_10",[0,0]],["6_10_10",[0,0]],["6_22_9",[0,0]],["6_45_27",[0,0]],["6_62_9",[0,0]],["6_58_11",[0,0]],["6_42_11",[0,0]],["6_2_5",[0,0]],["6_18_11",[0,0]],["6_26_11",[0,0]],["6_49_11",[0,5156]],["6_30_13",[0,0]],["6_54_2",[0,0]],["6_22_10",[0,0]],["6_45_28",[0,0]],["6_58_12",[0,0]],["6_42_12",[0,0]],["6_6_16",[0,0]],["6_14_11",[0,0]],["6_10_11",[0,0]],["6_38_11",[0,0]],["6_34_12",[0,0]],["6_62_10",[0,0]],["6_2_6",[0,0]],["6_30_14",[0,0]],["6_26_12",[0,0]],["6_18_12",[0,0]],["6_49_12",[0,2435]],["6_38_12",[0,0]],["6_34_13",[0,0]],["6_54_3",[0,0]],["6_45_29",[0,0]],["6_58_13",[0,0]],["6_22_11",[0,0]],["6_6_17",[0,0]],["6_14_12",[0,0]],["6_42_13",[0,0]],["6_62_11",[0,0]],["6_10_12",[0,0]],["6_18_13",[0,0]],["6_30_15",[0,0]],["6_2_7",[0,0]],["6_26_13",[0,0]],["6_49_13",[0,0]],["6_34_14",[0,0]],["6_45_30",[0,0]],["6_38_13",[0,0]],["6_58_14",[0,0]],["6_6_18",[0,0]],["6_22_12",[0,0]],["6_42_14",[0,0]],["6_14_13",[0,0]],["6_54_4",[0,0]],["6_62_12",[0,0]],["6_10_13",[0,0]],["6_18_14",[0,0]],["6_30_16",[0,0]],["6_2_8",[0,0]],["6_49_14",[0,0]],["6_38_14",[0,0]],["6_6_19",[0,0]],["6_54_5",[0,0]],["6_14_14",[0,0]],["6_34_15",[0,0]],["6_45_31",[0,0]],["6_58_15",[0,0]],["6_26_14",[0,0]],["6_42_15",[0,0]],["6_22_13",[0,0]],["6_49_15",[0,0]],["6_10_14",[0,0]],["6_62_13",[0,0]],["6_38_15",[0,0]],["6_30_17",[0,0]],["6_18_15",[0,0]],["6_2_9",[0,0]],["6_6_20",[0,0]],["6_46_0",[0,0]],["6_42_16",[0,0]],["6_58_16",[0,0]],["6_14_15",[0,0]],["6_26_15",[0,0]],["6_54_6",[0,1205]],["6_22_14",[0,0]],["6_34_16",[0,0]],["6_49_16",[0,0]],["6_46_1",[0,0]],["6_6_21",[0,0]],["6_42_17",[0,0]],["6_58_17",[0,0]],["6_22_15",[0,0]],["6_14_16",[0,0]],["6_26_16",[0,0]],["6_34_17",[0,0]],["6_38_16",[0,0]],["6_62_14",[0,0]],["6_30_18",[0,0]],["6_49_17",[0,0]],["6_54_7",[0,1392]],["6_10_15",[0,0]],["6_18_16",[0,0]],["6_2_10",[0,0]],["6_46_2",[0,0]],["6_34_18",[0,0]],["6_38_17",[0,0]],["6_30_19",[0,0]],["6_49_18",[0,0]],["6_6_22",[0,0]],["6_62_15",[0,0]],["6_42_18",[0,0]],["6_22_16",[0,0]],["6_58_18",[0,0]],["6_14_17",[0,0]],["6_26_17",[0,0]],["6_10_16",[0,0]],["6_18_17",[0,0]],["6_46_3",[0,0]],["6_38_18",[0,0]],["6_34_19",[0,0]],["6_30_20",[0,0]],["6_10_17",[0,0]],["6_22_17",[0,0]],["6_14_18",[0,0]],["6_18_18",[0,0]],["6_58_19",[0,0]],["6_49_19",[0,0]],["6_42_19",[0,0]],["6_6_23",[0,0]],["6_62_16",[0,0]],["6_26_18",[0,0]],["6_30_21",[0,0]],["6_10_18",[0,0]],["6_14_19",[0,0]],["6_18_19",[0,0]],["6_22_18",[0,0]],["6_2_11",[0,0]],["6_38_19",[0,0]],["6_46_4",[0,0]],["6_49_20",[0,0]],["6_34_20",[0,0]],["6_62_17",[0,0]],["6_42_20",[0,0]],["6_6_24",[0,0]],["6_58_20",[0,0]],["6_54_8",[-111,2607]],["6_26_19",[0,0]],["6_30_22",[0,0]],["6_10_19",[0,0]],["6_14_20",[0,0]],["6_18_20",[0,0]],["6_46_5",[0,0]],["6_38_20",[0,0]],["6_49_21",[0,0]],["6_6_25",[0,0]],["6_34_21",[0,0]],["6_22_19",[0,0]],["6_62_18",[0,0]],["6_54_9",[0,16]],["6_42_21",[0,0]],["6_58_21",[0,0]],["6_26_20",[0,0]],["6_30_23",[0,0]],["6_18_21",[0,0]],["6_14_21",[0,0]],["6_10_20",[0,0]],["6_49_22",[0,0]],["6_38_21",[0,0]],["6_46_6",[0,0]],["6_22_20",[0,0]],["6_26_21",[0,0]],["6_34_22",[0,0]],["6_58_22",[0,0]],["6_6_26",[0,0]],["6_62_19",[0,0]],["6_42_22",[0,0]],["6_54_10",[0,0]],["6_10_21",[0,0]],["6_38_22",[0,0]],["6_58_23",[0,0]],["6_34_23",[0,0]],["6_26_22",[0,0]],["6_22_21",[0,0]],["6_54_11",[0,0]],["6_6_27",[0,0]],["6_42_23",[0,0]],["6_14_22",[0,0]],["6_49_23",[0,0]],["6_62_20",[0,0]],["6_30_24",[0,0]],["6_18_22",[0,0]],["6_2_12",[0,0]],["6_38_23",[0,0]],["6_10_22",[0,0]],["6_58_24",[0,0]],["6_34_24",[0,0]],["6_22_22",[0,0]],["6_26_23",[0,0]],["6_49_24",[0,0]],["6_62_21",[0,0]],["6_30_25",[0,0]],["6_54_12",[0,0]],["6_14_23",[0,0]],["6_42_24",[0,0]],["6_6_28",[0,0]],["6_18_23",[0,0]],["6_2_13",[0,0]],["6_22_23",[0,0]],["6_10_23",[0,0]],["6_38_24",[0,0]],["6_46_7",[0,4197]],["6_34_25",[0,0]],["6_58_25",[0,0]],["6_49_25",[0,0]],["6_26_24",[0,0]],["6_62_22",[0,0]],["6_54_13",[0,0]],["6_42_25",[0,0]],["6_30_26",[0,0]],["6_22_24",[0,0]],["6_2_14",[0,0]],["6_34_26",[0,0]],["6_58_26",[0,0]],["6_49_26",[0,0]],["6_30_27",[0,0]],["6_26_25",[0,0]],["6_62_23",[0,0]],["6_42_26",[0,0]],["6_6_29",[0,0]],["6_14_24",[0,0]],["6_18_24",[0,0]],["6_10_24",[0,0]],["6_38_25",[0,0]],["6_54_14",[0,0]],["6_22_25",[0,0]],["6_2_15",[0,0]],["6_18_25",[0,0]],["6_38_26",[0,0]],["6_10_25",[0,0]],["6_49_27",[0,0]],["6_6_30",[0,0]],["6_54_15",[0,0]],["6_34_27",[0,0]],["6_14_25",[0,0]],["6_30_28",[0,0]],["6_58_27",[0,0]],["6_42_27",[0,0]],["6_26_26",[0,0]],["6_62_24",[0,0]],["6_22_26",[0,0]],["6_38_27",[0,0]],["6_34_28",[0,0]],["6_2_16",[0,0]],["6_18_26",[0,0]],["6_49_28",[0,0]],["6_10_26",[0,0]],["6_42_28",[0,0]],["6_30_29",[0,0]],["6_54_16",[0,0]],["6_26_27",[0,0]],["6_62_25",[0,0]],["6_6_31",[0,0]],["6_58_28",[0,0]],["6_14_26",[0,0]],["6_22_27",[0,0]],["6_38_28",[0,0]],["6_42_29",[0,0]],["6_34_29",[0,0]],["6_18_27",[0,0]],["6_49_29",[0,0]],["6_2_17",[0,0]],["6_10_27",[0,0]],["6_54_17",[0,0]],["6_7_0",[0,0]],["6_14_27",[0,0]],["6_58_29",[0,0]],["6_30_30",[0,0]],["6_38_29",[0,0]],["6_62_26",[0,0]],["6_26_28",[0,0]],["6_22_28",[0,0]],["6_42_30",[0,0]],["6_34_30",[0,0]],["6_18_28",[0,0]],["6_10_28",[0,0]],["6_2_18",[0,0]],["6_49_30",[0,0]],["6_54_18",[0,0]],["6_7_1",[0,0]],["6_62_27",[0,0]],["6_26_29",[0,0]],["6_30_31",[0,0]],["6_58_30",[0,0]],["6_38_30",[0,0]],["6_14_28",[0,0]],["6_22_29",[0,0]],["6_49_31",[0,0]],["6_54_19",[0,0]],["6_2_19",[0,0]],["6_58_31",[0,0]],["6_62_28",[0,0]],["6_26_30",[0,0]],["6_14_29",[0,0]],["6_34_31",[0,0]],["6_42_31",[0,0]],["6_10_29",[0,0]],["6_38_31",[0,0]],["6_7_2",[0,0]],["6_18_29",[0,0]],["6_31_0",[0,0]],["6_59_0",[0,0]],["6_22_30",[0,0]],["6_2_20",[0,0]],["6_54_20",[0,0]],["6_50_0",[0,0]],["6_35_0",[0,0]],["6_62_29",[0,0]],["6_26_31",[0,0]],["6_14_30",[0,0]],["6_39_0",[0,0]],["6_10_30",[0,0]],["6_18_30",[0,0]],["6_7_3",[0,0]],["6_31_1",[0,0]],["6_43_0",[0,0]],["6_39_1",[0,0]],["6_10_31",[0,0]],["6_35_1",[0,0]],["6_62_30",[0,0]],["6_18_31",[0,0]],["6_14_31",[0,0]],["6_22_31",[0,0]],["6_59_1",[0,0]],["6_27_0",[0,0]],["6_54_21",[0,0]],["6_50_1",[0,0]],["6_2_21",[0,0]],["6_31_2",[0,0]],["6_43_1",[0,0]],["6_7_4",[0,0]],["6_15_0",[0,0]],["6_50_2",[0,0]],["6_27_1",[0,0]],["6_59_2",[0,0]],["6_23_0",[0,0]],["6_2_22",[0,0]],["6_54_22",[0,0]],["6_31_3",[0,0]],["6_35_2",[0,0]],["6_62_31",[0,0]],["6_11_0",[0,0]],["6_39_2",[0,0]],["6_19_0",[0,0]],["6_7_5",[0,0]],["6_43_2",[0,0]],["6_50_3",[0,0]],["6_15_1",[0,0]],["6_2_23",[0,0]],["6_31_4",[0,0]],["6_39_3",[0,0]],["6_43_3",[0,0]],["6_11_1",[0,0]],["6_59_3",[0,0]],["6_27_2",[0,0]],["6_35_3",[0,0]],["6_54_23",[0,0]],["6_7_6",[0,0]],["6_23_1",[0,0]],["6_46_8",[0,6890]],["6_63_0",[0,0]],["6_19_1",[0,0]],["6_50_4",[0,0]],["6_15_2",[0,0]],["6_2_24",[0,0]],["6_31_5",[0,0]],["6_23_2",[0,0]],["6_43_4",[0,0]],["6_59_4",[0,0]],["6_63_1",[0,0]],["6_35_4",[0,0]],["6_19_2",[0,0]],["6_39_4",[0,0]],["6_54_24",[0,0]],["6_11_2",[0,0]],["6_27_3",[0,0]],["6_7_7",[0,0]],["6_50_5",[0,0]],["6_15_3",[0,0]],["6_23_3",[0,0]],["6_2_25",[0,0]],["6_31_6",[0,0]],["6_59_5",[0,0]],["6_54_25",[0,0]],["6_35_5",[0,0]],["6_63_2",[0,0]],["6_39_5",[0,0]],["6_19_3",[0,0]],["6_43_5",[0,0]],["6_11_3",[0,0]],["6_7_8",[0,0]],["6_27_4",[0,0]],["6_50_6",[0,0]],["6_23_4",[0,0]],["6_2_26",[0,0]],["6_15_4",[0,0]],["6_31_7",[0,0]],["6_11_4",[0,0]],["6_7_9",[0,0]],["6_59_6",[0,0]],["6_54_26",[0,0]],["6_35_6",[0,0]],["6_63_3",[0,0]],["6_43_6",[0,0]],["6_39_6",[0,0]],["6_19_4",[0,0]],["6_27_5",[0,0]],["6_50_7",[0,0]],["6_15_5",[0,0]],["6_23_5",[0,0]],["6_2_27",[0,0]],["6_31_8",[0,0]],["6_7_10",[0,0]],["6_54_27",[0,0]],["6_59_7",[0,0]],["6_39_7",[0,0]],["6_35_7",[0,0]],["6_43_7",[0,0]],["6_11_5",[0,0]],["6_63_4",[0,0]],["6_19_5",[0,0]],["6_27_6",[0,0]],["6_50_8",[0,2240]],["6_31_9",[0,0]],["6_23_6",[0,0]],["6_15_6",[0,0]],["6_59_8",[0,0]],["6_7_11",[0,0]],["6_43_8",[0,0]],["6_63_5",[0,0]],["6_11_6",[0,0]],["6_35_8",[0,0]],["6_39_8",[0,0]],["6_2_28",[0,0]],["6_54_28",[0,0]],["6_19_6",[0,0]],["6_27_7",[0,0]],["6_31_10",[0,0]],["6_15_7",[0,0]],["6_23_7",[0,0]],["6_43_9",[0,0]],["6_59_9",[0,0]],["6_63_6",[0,0]],["6_7_12",[0,0]],["6_11_7",[0,0]],["6_35_9",[0,0]],["6_39_9",[0,0]],["6_54_29",[0,0]],["6_27_8",[0,0]],["6_19_7",[0,0]],["6_2_29",[0,0]],["6_46_9",[979,6744]],["6_31_11",[0,0]],["6_23_8",[0,0]],["6_15_8",[0,0]],["6_59_10",[0,0]],["6_43_10",[0,0]],["6_11_8",[0,0]],["6_7_13",[0,0]],["6_63_7",[0,0]],["6_35_10",[0,0]],["6_31_12",[0,0]],["6_23_9",[0,0]],["6_19_8",[0,0]],["6_39_10",[0,0]],["6_54_30",[0,0]],["6_15_9",[0,0]],["6_27_9",[0,0]],["6_11_9",[0,0]],["6_63_8",[0,0]],["6_2_30",[0,0]],["6_43_11",[0,0]],["6_35_11",[0,0]],["6_7_14",[0,0]],["6_59_11",[0,0]],["6_50_9",[709,4891]],["6_15_10",[0,0]],["6_27_10",[0,0]],["6_39_11",[0,0]],["6_23_10",[0,0]],["6_31_13",[0,0]],["6_54_31",[0,0]],["6_19_9",[0,0]],["6_2_31",[0,0]],["6_63_9",[0,0]],["6_11_10",[0,0]],["6_43_12",[0,0]],["6_59_12",[0,0]],["6_35_12",[0,0]],["6_7_15",[0,0]],["6_55_0",[0,0]],["6_23_11",[0,0]],["6_31_14",[0,0]],["6_19_10",[0,0]],["6_43_13",[0,0]],["6_11_11",[0,0]],["6_63_10",[0,0]],["6_59_13",[0,0]],["6_7_16",[0,0]],["6_35_13",[0,0]],["6_15_11",[0,0]],["6_27_11",[0,0]],["6_39_12",[0,0]],["6_3_0",[0,0]],["6_19_11",[0,0]],["6_23_12",[0,0]],["6_43_14",[0,0]],["6_55_1",[0,0]],["6_31_15",[0,0]],["6_7_17",[0,0]],["6_63_11",[0,0]],["6_11_12",[0,0]],["6_59_14",[0,0]],["6_27_12",[0,0]],["6_15_12",[0,0]],["6_39_13",[0,0]],["6_35_14",[0,0]],["6_3_1",[0,0]],["6_23_13",[0,0]],["6_63_12",[0,0]],["6_39_14",[0,0]],["6_27_13",[0,0]],["6_15_13",[0,0]],["6_11_13",[0,0]],["6_7_18",[0,0]],["6_59_15",[0,0]],["6_35_15",[0,0]],["6_31_16",[0,0]],["6_19_12",[0,0]],["6_43_15",[0,0]],["6_55_2",[0,0]],["6_3_2",[0,0]],["6_35_16",[0,0]],["6_59_16",[0,0]],["6_7_19",[0,0]],["6_11_14",[0,0]],["6_15_14",[0,0]],["6_19_13",[0,0]],["6_55_3",[0,0]],["6_63_13",[0,0]],["6_31_17",[0,0]],["6_43_16",[0,0]],["6_23_14",[0,0]],["6_27_14",[0,0]],["6_39_15",[0,0]],["6_3_3",[0,0]],["6_19_14",[0,0]],["6_59_17",[0,0]],["6_35_17",[0,0]],["6_11_15",[0,0]],["6_15_15",[0,0]],["6_7_20",[0,0]],["6_43_17",[0,0]],["6_63_14",[0,0]],["6_31_18",[0,0]],["6_23_15",[0,0]],["6_55_4",[0,0]],["6_39_16",[0,0]],["6_27_15",[0,0]],["6_3_4",[0,0]],["6_11_16",[0,0]],["6_19_15",[0,0]],["6_55_5",[0,0]],["6_15_16",[0,0]],["6_59_18",[0,0]],["6_35_18",[0,0]],["6_7_21",[0,0]],["6_39_17",[0,0]],["6_27_16",[0,0]],["6_23_16",[0,0]],["6_31_19",[0,0]],["6_63_15",[0,0]],["6_43_18",[0,0]],["6_35_19",[0,0]],["6_59_19",[0,0]],["6_11_17",[0,0]],["6_7_22",[0,0]],["6_19_16",[0,0]],["6_15_17",[0,0]],["6_55_6",[0,0]],["6_43_19",[0,0]],["6_27_17",[0,0]],["6_3_5",[0,0]],["6_39_18",[0,0]],["6_63_16",[0,0]],["6_31_20",[0,0]],["6_23_17",[0,0]],["6_11_18",[0,0]],["6_7_23",[0,0]],["6_15_18",[0,0]],["6_19_17",[0,0]],["6_35_20",[0,0]],["6_59_20",[0,0]],["6_27_18",[0,0]],["6_43_20",[0,0]],["6_55_7",[0,1345]],["6_31_21",[0,0]],["6_23_18",[0,0]],["6_3_6",[0,0]],["6_63_17",[0,0]],["6_39_19",[0,0]],["6_19_18",[0,0]],["6_11_19",[0,0]],["6_15_19",[0,0]],["6_7_24",[0,0]],["6_35_21",[0,0]],["6_27_19",[0,0]],["6_59_21",[0,0]],["6_43_21",[0,0]],["6_46_10",[0,7429]],["6_23_19",[0,0]],["6_31_22",[0,0]],["6_63_18",[0,0]],["6_3_7",[0,0]],["6_39_20",[0,0]],["6_55_8",[0,1695]],["6_7_25",[0,0]],["6_15_20",[0,0]],["6_19_19",[0,0]],["6_11_20",[0,0]],["6_35_22",[0,0]],["6_43_22",[0,0]],["6_59_22",[0,0]],["6_27_20",[0,0]],["6_46_11",[0,0]],["6_63_19",[0,0]],["6_23_20",[0,0]],["6_31_23",[0,0]],["6_11_21",[0,0]],["6_7_26",[0,0]],["6_55_9",[0,0]],["6_19_20",[0,0]],["6_15_21",[0,0]],["6_39_21",[0,0]],["6_3_8",[0,0]],["6_59_23",[0,0]],["6_35_23",[0,0]],["6_43_23",[0,0]],["6_46_12",[0,0]],["6_27_21",[0,0]],["6_50_10",[118,6936]],["6_23_21",[0,0]],["6_63_20",[0,0]],["6_31_24",[0,0]],["6_19_21",[0,0]],["6_15_22",[0,0]],["6_11_22",[0,0]],["6_43_24",[0,0]],["6_7_27",[0,0]],["6_35_24",[0,0]],["6_55_10",[0,0]],["6_39_22",[0,0]],["6_3_9",[0,0]],["6_59_24",[0,0]],["6_46_13",[0,0]],["6_23_22",[0,0]],["6_27_22",[0,0]],["6_19_22",[0,0]],["6_31_25",[0,0]],["6_63_21",[0,0]],["6_15_23",[0,0]],["6_43_25",[0,0]],["6_11_23",[0,0]],["6_55_11",[0,0]],["6_7_28",[0,0]],["6_59_25",[0,0]],["6_27_23",[0,0]],["6_19_23",[0,0]],["6_35_25",[0,0]],["6_39_23",[0,0]],["6_3_10",[0,0]],["6_23_23",[0,0]],["6_46_14",[0,0]],["6_31_26",[0,0]],["6_63_22",[0,0]],["6_43_26",[0,0]],["6_11_24",[0,0]],["6_15_24",[0,0]],["6_7_29",[0,0]],["6_59_26",[0,0]],["6_23_24",[0,0]],["6_55_12",[0,0]],["6_27_24",[0,0]],["6_46_15",[0,0]],["6_3_11",[0,0]],["6_19_24",[0,0]],["6_39_24",[0,0]],["6_35_26",[0,0]],["6_63_23",[0,0]],["6_31_27",[0,0]],["6_27_25",[0,0]],["6_55_13",[0,0]],["6_43_27",[0,0]],["6_7_30",[0,0]],["6_15_25",[0,0]],["6_11_25",[0,0]],["6_59_27",[0,0]],["6_23_25",[0,0]],["6_46_16",[0,0]],["6_19_25",[0,0]],["6_3_12",[0,0]],["6_31_28",[0,0]],["6_39_25",[0,0]],["6_35_27",[0,0]],["6_63_24",[0,0]],["6_11_26",[0,0]],["6_55_14",[0,0]],["6_23_26",[0,0]],["6_46_17",[0,0]],["6_19_26",[0,0]],["6_59_28",[0,0]],["6_7_31",[0,0]],["6_27_26",[0,0]],["6_43_28",[0,0]],["6_15_26",[0,0]],["6_31_29",[0,0]],["6_3_13",[0,0]],["6_39_26",[0,0]],["6_63_25",[0,0]],["6_11_27",[0,0]],["6_55_15",[0,0]],["6_35_28",[0,0]],["6_31_30",[0,0]],["6_3_14",[0,0]],["6_27_27",[0,0]],["6_15_27",[0,0]],["6_59_29",[0,0]],["6_19_27",[0,0]],["6_46_18",[0,0]],["6_43_29",[0,0]],["6_23_27",[0,0]],["6_39_27",[0,0]],["6_46_19",[0,0]],["6_23_28",[0,0]],["6_63_26",[0,0]],["6_11_28",[0,0]],["6_55_16",[0,0]],["6_35_29",[0,0]],["6_15_28",[0,0]],["6_3_15",[0,0]],["6_27_28",[0,0]],["6_31_31",[0,0]],["6_59_30",[0,0]],["6_43_30",[0,0]],["6_19_28",[0,0]],["6_39_28",[0,0]],["6_50_11",[40,4118]],["6_59_31",[0,0]],["6_23_29",[0,0]],["6_27_29",[0,0]],["6_63_27",[0,0]],["6_46_20",[0,0]],["6_35_30",[0,0]],["6_55_17",[0,0]],["6_11_29",[0,0]],["6_15_29",[0,0]],["6_3_16",[0,0]],["6_43_31",[0,0]],["6_19_29",[0,0]],["6_39_29",[0,0]],["6_50_12",[-12,2781]],["6_35_31",[0,0]],["6_55_18",[0,0]],["6_3_17",[0,0]],["6_15_30",[0,0]],["6_63_28",[0,0]],["6_23_30",[0,0]],["6_46_21",[0,0]],["6_27_30",[0,0]],["6_11_30",[0,0]],["6_19_30",[0,0]],["6_39_30",[0,0]],["6_50_13",[0,0]],["6_46_22",[0,0]],["6_11_31",[0,0]],["6_15_31",[0,0]],["6_63_29",[0,0]],["6_23_31",[0,0]],["6_3_18",[0,0]],["6_19_31",[0,0]],["6_3_19",[0,0]],["6_27_31",[0,0]],["6_55_19",[0,0]],["6_39_31",[0,0]],["6_50_14",[0,0]],["6_63_30",[0,0]],["6_46_23",[0,0]],["6_46_24",[0,0]],["6_50_15",[0,0]],["6_63_31",[0,0]],["6_55_20",[0,0]],["6_3_20",[0,0]],["6_46_25",[0,0]],["6_50_16",[0,0]],["6_55_21",[0,0]],["6_3_21",[0,0]],["6_46_26",[0,0]],["6_55_22",[0,0]],["6_50_17",[0,0]],["6_3_22",[0,0]],["6_46_27",[0,0]],["6_55_23",[0,0]],["6_50_18",[0,0]],["6_3_23",[0,0]],["6_46_28",[0,0]],["6_3_24",[0,0]],["6_50_19",[0,0]],["6_55_24",[0,0]],["6_3_25",[0,0]],["6_46_29",[0,0]],["6_55_25",[0,0]],["6_50_20",[0,0]],["6_55_26",[0,0]],["6_3_26",[0,0]],["6_46_30",[0,0]],["6_50_21",[0,0]],["6_55_27",[0,0]],["6_46_31",[0,0]],["6_50_22",[0,0]],["6_3_27",[0,0]],["6_50_23",[0,0]],["6_47_0",[0,0]],["6_55_28",[0,0]],["6_3_28",[0,0]],["6_47_1",[0,0]],["6_50_24",[0,0]],["6_55_29",[0,0]],["6_3_29",[0,0]],["6_47_2",[0,0]],["6_50_25",[0,0]],["6_3_30",[0,0]],["6_55_30",[0,0]],["6_50_26",[0,0]],["6_47_3",[0,0]],["6_55_31",[0,0]],["6_3_31",[0,0]],["6_47_4",[0,0]],["6_50_27",[0,0]],["6_50_28",[0,0]],["6_47_5",[0,0]],["6_47_6",[0,0]],["6_50_29",[0,0]],["6_50_30",[0,0]],["6_50_31",[0,0]],["6_47_7",[0,4082]],["6_51_0",[0,0]],["6_51_1",[0,0]],["6_51_2",[0,0]],["6_51_3",[0,0]],["6_51_4",[0,0]],["6_47_8",[-207,4871]],["6_51_5",[0,0]],["6_51_6",[0,0]],["6_47_9",[746,6543]],["6_51_7",[0,1115]],["6_51_8",[0,2233]],["6_51_9",[105,3596]],["6_47_10",[528,7570]],["6_51_10",[7,2909]],["6_47_11",[0,8280]],["6_47_12",[0,0]],["6_51_11",[-12,2303]],["6_47_13",[0,0]],["6_51_12",[-23,1649]],["6_47_14",[0,0]],["6_51_13",[0,0]],["6_47_15",[0,0]],["6_51_14",[0,0]],["6_47_16",[0,0]],["6_51_15",[0,0]],["6_47_17",[0,0]],["6_51_16",[0,0]],["6_47_18",[0,0]],["6_51_17",[0,0]],["6_47_19",[0,0]],["6_47_20",[0,0]],["6_51_18",[0,0]],["6_47_21",[0,0]],["6_51_19",[0,0]],["6_47_22",[0,0]],["6_51_20",[0,0]],["6_47_23",[0,0]],["6_51_21",[0,0]],["6_47_24",[0,0]],["6_51_22",[0,0]],["6_47_25",[0,0]],["6_51_23",[0,0]],["6_47_26",[0,0]],["6_51_24",[0,0]],["6_47_27",[0,0]],["6_51_25",[0,0]],["6_47_28",[0,0]],["6_51_26",[0,0]],["6_47_29",[0,0]],["6_51_27",[0,0]],["6_47_30",[0,0]],["6_51_28",[0,0]],["6_47_31",[0,0]],["6_51_29",[0,0]],["6_51_30",[0,0]],["6_51_31",[0,0]]]),"EPSG:3857":Gh,MAX_LEVELS:6};class Uh{constructor(t){this.hasTerrainData=t.hasTerrainData,this._tilingScheme=t.tilingScheme,this._x=t.x,this._y=t.y,this._level=t.level,this._parent=t.parent,this._rectangle=this._tilingScheme.tileXYToRectangle(this._x,this._y,this._level),this._southwestChild=void 0,this._southeastChild=void 0,this._northwestChild=void 0,this._northeastChild=void 0,this._distance=0,this._loadPriority=0,this._lastSelectionResult=Fh.NONE,this.renderable=!1,this.upsampledFromParent=!1,this._tileIndexVisited=!1,this._tileExistOnServer=1;const i=this._tilingScheme.crs,s=this.getOverscaledTileID(),r=this.hasTerrainData;r&&s.canonical.z>kh.MAX_LEVELS&&(kh[i].has(s.canonical.key)||kh[i].set(s.canonical.key,[this._parent.terrainBounds.minimumHeight,this._parent.terrainBounds.maximumHeight]));const n=this;this._terrainBounds={get minimumHeight(){return r?kh[i].get(s.canonical.key)[0]:0},set minimumHeight(e){r&&(kh[i].get(s.canonical.key)[0]=e,n.tileBoundingRegion.minimumHeight=e,n.tileBoundingRegion.computeBoundingVolumes(n.ellipsoid),n.tileBoundingRegion.isAmbiguousHeight=!1);},get maximumHeight(){return r?kh[i].get(s.canonical.key)[1]:0},set maximumHeight(e){r&&(kh[i].get(s.canonical.key)[1]=e,n.tileBoundingRegion.maximumHeight=e,n.tileBoundingRegion.computeBoundingVolumes(n.ellipsoid),n.tileBoundingRegion.isAmbiguousHeight=!1);}};const o=e.defined(this.parent)&&e.defined(this.parent.customHeight.minimumHeight);this._customHeight={hasCustomHeight:o,minimumHeight:o?this.parent.customHeight.minimumHeight:void 0,maximumHeight:o?this.parent.customHeight.maximumHeight:void 0,tileBoundingRegion:o?new e.TileBoundingRegion({computeBoundingVolumes:!0,rectangle:this.rectangle,ellipsoid:this.ellipsoid,minimumHeight:this.parent.customHeight.minimumHeight,maximumHeight:this.parent.customHeight.maximumHeight}):void 0};}get tileBoundingRegion(){if(this._tileBoundingRegion)return this._tileBoundingRegion;if(this._customHeight.hasCustomHeight)this._tileBoundingRegion||(this._tileBoundingRegion=this.customHeight.tileBoundingRegion);else if(this.hasTerrainData){const t=this._tilingScheme.crs,i=this.getOverscaledTileID(),s=kh[t].get(i.canonical.key);if(!s)throw new Error("当前的对象未创建便有了tileBoundingRegion的访问！");if(!s[2]){let t=this.level>kh.MAX_LEVELS;this.level>=14&&!this._parent.tileBoundingRegion.isAmbiguousHeight&&(t=!1),s[2]=new e.TileBoundingRegion({computeBoundingVolumes:!0,rectangle:this.rectangle,ellipsoid:this.ellipsoid,minimumHeight:s[0],maximumHeight:s[1],isAmbiguousHeight:t});}this._tileBoundingRegion||(this._tileBoundingRegion=s[2]);}else this._tileBoundingRegion||(this._tileBoundingRegion=new e.TileBoundingRegion({computeBoundingVolumes:!0,rectangle:this.rectangle,ellipsoid:this.ellipsoid,minimumHeight:0,maximumHeight:0}));return this._tileBoundingRegion}get terrainBounds(){return this._terrainBounds}getOverscaledTileID(){if(!this.tileId){const t=this._tilingScheme.type,i=this._level+(t==e.ProjectionType.LATLON?1:0),s=this._x,r=this._y,n=Math.pow(2,i);i>=0&&i<=25&&s>=0&&s<n&&r>=0&&r<n&&(this.tileId=new e.OverscaledTileID(i,0,i,this._x,this._y,t));}return this.tileId.distance=this._distance,this.tileId}static createLevelZeroTiles(e,t){const i=e.getNumberOfXTilesAtLevel(0),s=e.getNumberOfYTilesAtLevel(0),r=new Array(i*s);let n=0;for(let o=0;o<s;++o)for(let s=0;s<i;++s)r[n++]=new Uh({tilingScheme:e,x:s,y:o,level:0,hasTerrainData:t});return r}get customHeight(){return this._customHeight}set customHeight(t){e.defined(t)&&(this._customHeight.minimumHeight=t.minimumHeight,this._customHeight.maximumHeight=t.maximumHeight);}get tilingScheme(){return this._tilingScheme}get x(){return this._x}get y(){return this._y}get level(){return this._level}get parent(){return this._parent}get rectangle(){return this._rectangle}get children(){return [this.northwestChild,this.northeastChild,this.southwestChild,this.southeastChild]}get southwestChild(){return e.defined(this._southwestChild)||(this._southwestChild=new Uh({hasTerrainData:this.hasTerrainData,tilingScheme:this.tilingScheme,x:2*this.x,y:2*this.y+1,level:this.level+1,parent:this})),this._southwestChild}get southeastChild(){return e.defined(this._southeastChild)||(this._southeastChild=new Uh({hasTerrainData:this.hasTerrainData,tilingScheme:this.tilingScheme,x:2*this.x+1,y:2*this.y+1,level:this.level+1,parent:this})),this._southeastChild}get northwestChild(){return e.defined(this._northwestChild)||(this._northwestChild=new Uh({hasTerrainData:this.hasTerrainData,tilingScheme:this.tilingScheme,x:2*this.x,y:2*this.y,level:this.level+1,parent:this})),this._northwestChild}get northeastChild(){return e.defined(this._northeastChild)||(this._northeastChild=new Uh({hasTerrainData:this.hasTerrainData,tilingScheme:this.tilingScheme,x:2*this.x+1,y:2*this.y,level:this.level+1,parent:this})),this._northeastChild}findLevelZeroTile(e,t,i){const s=this.tilingScheme.getNumberOfXTilesAtLevel(0);if(t<0?t+=s:t>=s&&(t-=s),!(i<0||i>=this.tilingScheme.getNumberOfYTilesAtLevel(0)))return e.filter((e=>e.x===t&&e.y===i))[0]}findTileToWest(e){const t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x-1,this.y);if(t.southeastChild===this)return t.southwestChild;if(t.northeastChild===this)return t.northwestChild;const i=t.findTileToWest(e);return void 0!==i?t.southwestChild===this?i.southeastChild:i.northeastChild:void 0}findTileToEast(e){const t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x+1,this.y);if(t.southwestChild===this)return t.southeastChild;if(t.northwestChild===this)return t.northeastChild;const i=t.findTileToEast(e);return void 0!==i?t.southeastChild===this?i.southwestChild:i.northwestChild:void 0}findTileToSouth(e){const t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x,this.y+1);if(t.northwestChild===this)return t.southwestChild;if(t.northeastChild===this)return t.southeastChild;const i=t.findTileToSouth(e);return void 0!==i?t.southwestChild===this?i.northwestChild:i.northeastChild:void 0}findTileToNorth(e){const t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x,this.y-1);if(t.southwestChild===this)return t.northwestChild;if(t.southeastChild===this)return t.northeastChild;const i=t.findTileToNorth(e);return void 0!==i?t.northwestChild===this?i.southwestChild:i.southeastChild:void 0}}var Hh=Object.freeze({NONE:-1,PARTIAL:0,FULL:1});class zh{constructor(){this.allAreRenderable=!0,this.anyWereRenderedLastFrame=!1,this.notYetRenderableCount=0;}}class Wh{constructor(){this.southwest=new zh,this.southeast=new zh,this.northwest=new zh,this.northeast=new zh;}combine(e){const t=this.southwest,i=this.southeast,s=this.northwest,r=this.northeast;e.allAreRenderable=t.allAreRenderable&&i.allAreRenderable&&s.allAreRenderable&&r.allAreRenderable,e.anyWereRenderedLastFrame=t.anyWereRenderedLastFrame||i.anyWereRenderedLastFrame||s.anyWereRenderedLastFrame||r.anyWereRenderedLastFrame,e.notYetRenderableCount=t.notYetRenderableCount+i.notYetRenderableCount+s.notYetRenderableCount+r.notYetRenderableCount;}}const jh=new Array(31);for(let e=0;e<jh.length;++e)jh[e]=new Wh;class Xh{constructor(t){if(this.hasTerrainData=t.hasTerrainData,this.tileScheme=t.tileScheme,this._levelZeroMaximumGeometricError=40075.16,this.maximumScreenSpaceError=t.maximumScreenSpaceError||2,this.tileSize=t.tileSize||512,this.type=t.type,this.drawingBufferHeight=t.drawingBufferHeight,this.pixelRatio=t.pixelRatio||1,this.selectedTiles=[],this._tileVisited=!1,this._tileMaxZoom=t.tileMaxZoom,this._tileMinZoom=t.tileMinZoom,this.rootTiles=Uh.createLevelZeroTiles(this.tileScheme,this.hasTerrainData),e.defined(t.customHeight)&&(e.defined(t.customHeight.minimumHeight)||e.defined(t.customHeight.maximumHeight)))for(let e=0;e<this.rootTiles.length;e++)this.rootTiles[e].customHeight={minimumHeight:t.customHeight.minimumHeight,maximumHeight:t.customHeight.maximumHeight};this._tmpQuadtreeTileBoundingRegionMap={},this._overscaledTileIDList=[];}set tileMaxZoom(e){this._tileMaxZoom=e;}get tileMaxZoom(){return this._tileMaxZoom}set tileMinZoom(e){this._tileMinZoom=e;}get tileMinZoom(){return this._tileMinZoom}tilesIn(e){this._tileVisited=!1,this._tmpQuadtreeTileBoundingRegionMap={},this._overscaledTileIDList=[],this.selectedTiles=[];for(let t=0;t<this.rootTiles.length;t++)this.visitIfVisible(this.rootTiles[t],e,!1);}getQuadtreeTileByTileKey(t){const i=t.split("_"),s=parseInt(i[0]),r=this.tileScheme.type===e.ProjectionType.LATLON&&0===s?1:s,n=parseInt(i[1]),o=parseInt(i[2]),a=new e.OverscaledTileID(r,0,r,n,o),l=a.scaledTo(this.tileScheme.type===e.ProjectionType.LATLON?1:0);let h=r,_=null;for(;h>=0;){if(!_)for(let e=0;e<this.rootTiles.length;e++){const t=this.rootTiles[e];if(t.tileId.canonical.z===l.canonical.z&&t.tileId.canonical.x===l.canonical.x&&t.tileId.canonical.y===l.canonical.y){_=t;break}}if(0===h)break;const e=a.scaledTo(r-h+1);for(let t=0;t<_.children.length;t++){const i=_.children[t];if(i.tileId.canonical.z===e.canonical.z&&i.tileId.canonical.x===e.canonical.x&&i.tileId.canonical.y===e.canonical.y){_=i;break}}h--;}return _}getBoundingRegionById(e){return this._tmpQuadtreeTileBoundingRegionMap[e]||this.getQuadtreeTileByTileKey(e).tileBoundingRegion}getOverscaledTileIDs(){if(!this._tileVisited){for(let e=0;e<this.selectedTiles.length;e++){const t=this.selectedTiles[e],i=t.getOverscaledTileID();i&&(this._tmpQuadtreeTileBoundingRegionMap[i.key]=t.tileBoundingRegion);}this.selectedTiles.sort(((e,t)=>t.tileId.canonical.z-e.tileId.canonical.z)),this.selectedTiles.sort(((e,t)=>e._loadPriority-t._loadPriority));for(let e=0;e<this.selectedTiles.length;e++){const t=this.selectedTiles[e];t.tileId.canonical.z>=this._tileMinZoom&&(t.tileId.isAmbiguousHeight=t.tileBoundingRegion.isAmbiguousHeight,this._overscaledTileIDList.push(t.tileId));}this._tileVisited=!0;}return this._overscaledTileIDList}visitIfVisible(e,t,i){if(this.computeTileVisibility(e,t)!==Hh.NONE)return this.visitTile(t,e,i)}visitTile(t,i,s){let r;r="raster"===this.type?this.screenSpaceError(t,this.drawingBufferHeight,this.pixelRatio,i)<this.maximumScreenSpaceError:i.tilingScheme.type===e.ProjectionType.LATLON?this.screenSpaceError(t,this.drawingBufferHeight,this.pixelRatio,i)<this.maximumScreenSpaceError||i.level+2-Math.log2(512/this.tileSize)>Number(t.mapZoom.toFixed(5)):this.screenSpaceError(t,this.drawingBufferHeight,this.pixelRatio,i)<this.maximumScreenSpaceError||i.level+1-Math.log2(512/this.tileSize)>Number(t.mapZoom.toFixed(5));const n=i.southwestChild,o=i.southeastChild,a=i.northwestChild,l=i.northeastChild;if(r||s)this.selectedTiles.push(i);else {if(this.canRefine(i)){if(n.upsampledFromParent&&o.upsampledFromParent&&a.upsampledFromParent&&l.upsampledFromParent)return void this.selectedTiles.push(i);if(o&&n._level<=this._tileMaxZoom)return void this.visitVisibleChildrenNearToFar(n,o,a,l,t,s)}this.selectedTiles.push(i);}}computeTileVisibility(t,i){const s=this.computeDistanceToTile(t,i);t._distance=s;const r=t.tileBoundingRegion;let n;t._loadPriority=this.computeTileLoadPriority(t,i);const o=i.frustumCrate.cullingVolume.computeVisibility(r.boundingVolume);return o===e.INTERSECTION.OUTSIDE?n=Hh.NONE:o===e.INTERSECTION.INTERSECTING?n=Hh.PARTIAL:o===e.INTERSECTION.INSIDE&&(n=Hh.FULL),n}computeTileLoadPriority(t,i){if(!e.defined(t.tileBoundingRegion)||e.defined(t.tileBoundingRegion._orientedBoundingBox))return 0;const s=i.direction,r=e.Vector3.subtract(t.tileBoundingRegion._orientedBoundingBox.center,i.position,new e.Vector3),n=e.Vector3.magnitude(r);return n<1e-5?0:(e.Vector3.divideByScalar(r,n,r),(1-e.Vector3.dot(r,s))*t._distance)}screenSpaceError(e,t,i,s){let r=this.getLevelMaximumGeometricError(s.level)*t/(s._distance*e.frustumCrate.frustum._sseDenominator);return r/=i,r}computeDistanceToTile(e,t){return e.tileBoundingRegion.distanceToCamera(t)}getLevelMaximumGeometricError(e){return this._levelZeroMaximumGeometricError/(1<<e)}visitVisibleChildrenNearToFar(t,i,s,r,n,o){const a=e.Cartographic.fromVector3(n.position);a.longitude<t.rectangle.east?a.latitude<t.rectangle.north?(this.visitIfVisible(t,n,o),this.visitIfVisible(i,n,o),this.visitIfVisible(s,n,o),this.visitIfVisible(r,n,o)):(this.visitIfVisible(s,n,o),this.visitIfVisible(t,n,o),this.visitIfVisible(r,n,o),this.visitIfVisible(i,n,o)):a.latitude<t.rectangle.north?(this.visitIfVisible(i,n,o),this.visitIfVisible(t,n,o),this.visitIfVisible(r,n,o),this.visitIfVisible(s,n,o)):(this.visitIfVisible(r,n,o),this.visitIfVisible(s,n,o),this.visitIfVisible(i,n,o),this.visitIfVisible(t,n,o));}canRefine(e){return !0}destroy(){this.hasTerrainData=null,this.tileScheme=null,this.selectedTiles=[],this._tileVisited=!1,this._tmpQuadtreeTileBoundingRegionMap={},this._overscaledTileIDList=[];}}class qh extends e.Evented{constructor(t,i,s){super(),this.id=t,this.dispatcher=s,this.on("data",(e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.map.transform&&this.update(this.map.transform));})),this.on("error",(()=>{this._sourceErrored=!0;}));const r=ml(t,i,s,this);this._source=r,this._tiles={},this._cache=new Nh(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._isIdRenderable=this._isIdRenderable.bind(this),this._coveredTiles={},this._state=new fh,this.sourceType=i.type,this.adaptTerrain=i.adaptTerrain,this._loadedParentTiles={},this._ancientCoverageTiles={},this._referenceTiles={},this.customHeight={minimumHeight:e.defined(i.customHeight)?i.customHeight.minimumHeight:void 0,maximumHeight:e.defined(i.customHeight)?i.customHeight.maximumHeight:void 0};}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(e);const t=this.coveringTiles();this.currentMaxTileZoom=Zh(t).currentMaxTileZoom,this.currentMinTileZoom=Zh(t).currentMaxTileZoom;}onRemove(e){this._source&&this._source.onRemove&&this._source.onRemove(e);}loaded(){if(this._sourceErrored)return !0;if("3d-model"===this._source.type&&"loaded"===this._source.state)return this._sourceLoaded=!0,!0;if(!this._sourceLoaded)return !1;for(const e in this._tiles){const t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return !1}return "3d-model"!==this._source.type||"loaded"===this._source.state}getSource(){return this._source}pause(){this._paused=!0;}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.map&&this.update();}_loadTile(e,t){return this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,(()=>{}))}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,(()=>{}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles)this._tiles[t].upload(e),this._tiles[t].prepare(this.map.style.imageManager);}getIds(){return Object.keys(this._tiles).map(String).sort(((e,t)=>this._tiles[e].tileID.overscaledZ-this._tiles[t].tileID.overscaledZ))}getRenderableIds(){return this.getIds().filter(this._isIdRenderable)}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return !!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else if(this._cache.reset(),e)for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(e,"expired");else for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(e,"reloading");}_reloadTile(e,t){const i=this._tiles[e];i&&("loading"!==i.state&&(i.state=t),this._loadTile(i,this._tileLoaded.bind(this,i,e,t)));}_tileLoaded(t,i,s,r){if(r){if(t.state="errored",t._createOrCheckPrimitives(),"aborted"===r)return;404!==r.status?this._source.fire(new e.ErrorEvent(r,{tile:t})):this.update();}else {if("raster"===t.tilePrimitiveType){t.imageryOrigin&&"loaded"===t.imageryOrigin[0].imagery.state&&(t.imagery[0].freeResources(t.tileID.key),t.imagery=t.imageryOrigin,delete t.imageryOrigin);for(const e of t.imagery)if("loaded"!==e.imagery.state)return;t.state="loaded",t._createOrCheckPrimitives();}t.timeAdded=e.exported.now(),"expired"===s&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new e.Event("data",{dataType:"source",tile:t,coord:t.tileID}));}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}getZoom(e){return this.map.style.getNearestTileZoom()+e.scaleZoom(e.tileSize/this._source.tileSize)}_retainLoadedChildren(e,t,i,s){for(const r in this._tiles){let n=this._tiles[r];if(s.has(r)||!n.hasData()||n.tileID.overscaledZ<=t||n.tileID.overscaledZ>i)continue;let o=n.tileID;for(;n&&n.tileID.overscaledZ>t+1;){const e=n.tileID.scaledTo(n.tileID.overscaledZ-1);n=this._tiles[e.key],n&&n.hasData()&&(o=e);}let a=o;for(;a.overscaledZ>t;)if(a=a.scaledTo(a.overscaledZ-1),e[a.key]){s.set(o.key,o);break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const i=this._loadedParentTiles[e.key];return i&&i.tileID.overscaledZ>=t?i:null}for(let i=e.overscaledZ-1;i>=t;i--){const t=e.scaledTo(i),s=this._getLoadedTile(t);if(s)return s}}updateCacheSize(){this._cache.setMaxSize(256);}createQuadtree(){e.defined(this.quadtree)||(this.quadtree=Jh({isLngLat:this.map.transform.projection===e.ProjectionType.LATLON,tileSize:this._source.tileSize,hasTerrainData:this.map.style.hasTerrainData,drawingBufferHeight:this.map.painter.context.gl.drawingBufferHeight,spaceErrorScale:this.map.spaceErrorScale,tileMinZoom:this._source.minzoom,tileMaxZoom:this._source.maxzoom,type:this.sourceType,customHeight:this.customHeight}));}coveringTiles(){return this.createQuadtree(),this.quadtree.tilesIn(this.map.transform.activeCamera),this.quadtree.getOverscaledTileIDs()}update(){if(!this._sourceLoaded||this._paused)return;let t;if(this.updateCacheSize(),this._coveredTiles={},"3d-model"===this._source.type)t=[];else if(this._source.tileID){t=this.coveringTiles().map((t=>new e.OverscaledTileID(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y,this.map.projection)));const i=[];t.forEach((e=>{e.isAmbiguousHeight||i.push(e);})),t=i;}else if(t=this.coveringTiles(),this._source.hasTile&&(t=t.filter((e=>this._source.hasTile(e)))),"raster"===this._source.type&&this._source.capabilities){const e=this._source.capabilities.tileGrid;t=t.filter((t=>function(e,t){const i=t.getFullTileRange(e.canonical.z);return !!i&&i.minX<=e.canonical.x&&e.canonical.x<i.maxX&&i.minY<=e.canonical.y&&e.canonical.y<i.maxY}(t,e)));}const i=Zh(t);this.currentMaxTileZoom=i.currentMaxTileZoom,this.currentMinTileZoom=i.currentMinTileZoom,this._source.type!==e.VectorLayerType.RASTER?t=t.slice(0,48):t.length>192&&(t=t.slice(0,192)),this.used||(t=[]);const s=this._updateRetainedTiles(t),r=e.keysDifferenceWithMap(this._tiles,s);for(let e=0;e<r.length;e++)this._removeTile(r[e]);}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let i,s=this._tiles[e].tileID;for(;s.overscaledZ>0;){if(s.key in this._loadedParentTiles){i=this._loadedParentTiles[s.key];break}t.push(s.key);const e=s.scaledTo(s.overscaledZ-1);if(i=this._getLoadedTile(e),i)break;s=e;}for(const e of t)this._loadedParentTiles[e]=i;}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}_updateRetainedTiles(e){this._referenceTiles={};const t=new Map;if(0===e.length)return t;const i={},s=e.reduce(((e,t)=>Math.min(e,t.overscaledZ)),1/0),r=e[0].overscaledZ,n=Math.max(r-qh.maxOverzooming,this._source.minzoom),o=Math.max(r+qh.maxUnderzooming,this._source.minzoom),a={};for(const i of e){const e=this._addTile(i);t.set(i.key,i),e.hasData()||(a[i.key]=i);}this._retainLoadedChildren(a,s,o,t);for(const e in a){const s=this._tiles[e],o=a[e];if(o.overscaledZ<this._source.maxzoom){const e=o.children(this._source.maxzoom);if(t.get(e[0].key)&&t.get(e[1].key)&&t.get(e[2].key)&&t.get(e[3].key))continue}let l=s.wasRequested();for(let e=o.overscaledZ-1;e>=n;--e){const s=o.scaledTo(e);if(i[s.key])break;i[s.key]=!0;let n=this.getTile(s);if(!n&&l&&r-s.canonical.z<4&&(n=this._addTile(s)),n){if(t.set(s.key,s),n.hasData())break;l=n.wasRequested();}}}return t}_refineTile(t,i,s){const r=t.imagery[0].imagery,n=this._source.getImageryFromCache(r.x,r.y,r.level,i.key),o=Math.pow(2,i.overscaledZ-r.level),a=i.canonical.x%o/o,l=i.canonical.y%o/o,h=new Tt(n,new e.Vector4(0,0,1,1),new e.Vector4(a,l,1/o,1/o));this._tiles[i.key].imageryOrigin=this._tiles[i.key].imagery,delete this._tiles[i.key].imagery,this._tiles[i.key].imagery=[h],this._tiles[i.key].state="loaded",this._tiles[i.key]._createOrCheckPrimitives(),this._referenceTiles[s.key]=!0;}_addTile(t){let i=this._tiles[t.key];if(i){if(!(i.tileID.canonical.z>this._source.maxzoom))return i.tileID=t,i;if("loaded"===i.state||"loading"===i.state||"reloading"===i.state||"errored"===i.state)return i.tileID=t,i}i=this._cache.getAndRemove(t),i&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));const s=Boolean(i);return s||(i=new Vh({tileID:t,tileSize:this._source.tileSize*t.overscaleFactor(),projType:this.map.projection,tilePrimitiveType:"raster"==this._source.type?"raster":"vector",sourceId:this._source.id,style:this.map.style}),this._loadTile(i,this._tileLoaded.bind(this,i,t.key,i.state))),i?(i.uses++,this._tiles[t.key]=i,s||this._source.fire(new e.Event("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const i=t.getExpiryTimeout();i&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e];}),i));}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))));}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache&&this._cache.reset(),this._source.unloadGPUData&&this._source.unloadGPUData();}tilesInOfSphereExtrusion(e,t,i){let s=[];s=s.concat(this.quadtree.getOverscaledTileIDs());const r=[];for(let e=0;e<s.length;e++){const t=this.getTile(s[e]);t&&r.push(t.getBucket(i));}return r}tilesIn(t,i,s){const r=[],n=this.map.transform;if(!n)return r;const o=s?this.map.style.symbolMatrixHelper.getCameraQueryGeometry(t):t,a=t.map((e=>n.pointCoordinate(e))).filter((e=>e)),l=o.map((e=>n.pointCoordinate(e))).filter((e=>e));if(0==a.length)return [];const h=this.getIds();let _=1/0,c=1/0,u=-1/0,d=-1/0;const m=a[0].zoom;for(const e of l)_=Math.min(_,e.column),c=Math.min(c,e.row),u=Math.max(u,e.column),d=Math.max(d,e.row);for(let t=0;t<h.length;t++){const s=this._tiles[h[t]],n=s.tileID,o=Math.pow(2,this.map.style.getNearestTileZoom()-s.tileID.overscaledZ),p=i*s.queryPadding*e.EXTENT/s.tileSize/o,f=[Kh(n,new e.Coordinate(_,c,m)),Kh(n,new e.Coordinate(u,d,m))];if(f[0].x-p<e.EXTENT&&f[0].y-p<e.EXTENT&&f[1].x+p>=0&&f[1].y+p>=0){const t=a.map((t=>{const i=t.zoomTo(n.canonical.z);return n.getTilePoint(new e.pointGeometry3d(i.column,i.row))})),i=l.map((t=>{const i=t.zoomTo(n.canonical.z);return n.getTilePoint(new e.pointGeometry3d(i.column,i.row))}));r.push({tile:s,tileID:n,queryGeometry:t,cameraQueryGeometry:i,scale:o});}}return r}getVisibleCoordinates(){return this.getRenderableIds().map((e=>this._tiles[e].tileID))}hasTransition(){if(this._source.hasTransition())return !0;if("raster"===(t=this._source.type)||"image"===t||"video"===t)for(const t in this._tiles){const i=this._tiles[t];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=e.exported.now())return !0}var t;return !1}setFeatureState(e,t,i){this._state.updateState(e=e||"_geojsonTileLayer",t,i);}removeFeatureState(e,t,i){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,i);}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,i){const s=this._tiles[e];s&&s.setDependencies(t,i);}reloadTilesForDependencies(e,t){for(const i in this._tiles)this._tiles[i].hasDependency(e,t)&&this._reloadTile(i,"reloading");this._cache.filter((i=>!i.hasDependency(e,t)));}resetQuadtree(){if(this.quadtree?.destroy(),delete this.quadtree,this._source.type==e.VectorLayerType.RASTER){for(const e in this._tiles){const t=this._tiles[e];t.unloadVectorData(),t.state="loading";}for(const e in this._cache.data){const t=this._cache.data[e][0].value;t&&(t.unloadVectorData(),t.state="loading");}}}}function Kh(t,i){const s=i.zoomTo(t.canonical.z);return new e.pointGeometry3d((s.column-(t.canonical.x+t.wrap*Math.pow(2,t.canonical.z)))*e.EXTENT,(s.row-t.canonical.y)*e.EXTENT)}function Jh(t){const i=e.defined(t.spaceErrorScale)?t.spaceErrorScale:1,{tileSize:s,isLngLat:r,drawingBufferHeight:n,hasTerrainData:o,tileMaxZoom:a,tileMinZoom:l,type:h,customHeight:_}=t;return new Xh({tileSize:s,hasTerrainData:o,maximumScreenSpaceError:s/512*i,tileScheme:r?new Ct({}):new yt({}),drawingBufferHeight:n,pixelRatio:e.exported.devicePixelRatio/2*2,tileMaxZoom:a||17,tileMinZoom:l||0,type:h,customHeight:_})}function Zh(e){if(0==e.length)return {currentMaxTileZoom:22,currentMinTileZoom:0};let t=e[0].canonical.z,i=e[0].canonical.z;for(const s of e)t=s.canonical.z>t?s.canonical.z:t,i=s.canonical.z<i?s.canonical.z:i;return {currentMaxTileZoom:t,currentMinTileZoom:i}}qh.maxOverzooming=10,qh.maxUnderzooming=3;class Yh{constructor(e,t,i){this.item=e,this.previous=t,this.next=i;}}class Qh{constructor(){this.head=null,this.tail=null,this._length=0;}get length(){return this._length}add(e){const t=new Yh(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length);}splice(e,t){e!==t&&(this.remove(t),this._insert(e,t));}_insert(e,t){const i=e.next;e.next=t,this.tail===e?this.tail=t:i.previous=t,t.next=i,t.previous=e,++this._length;}}function $h(e){return null!=e}class e_{constructor(){this._list=new Qh,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1;}reset(){this._list.splice(this._list.tail,this._sentinel);}touch(e){const t=e._cacheNode;$h(t)&&this._list.splice(this._sentinel,t);}add(e,t,i){$h(t._cacheNode)||(t._cacheNode=this._list.add(t),i&&i(e,t));}unloadTile(e,t,i){const s=t._cacheNode;$h(s)&&(this._list.remove(s),t._cacheNode=void 0,i&&i(e,t));}unloadTiles(e,t){const i=this._trimTiles;this._trimTiles=!1;const s=1024*e.maximumMemoryUsage*1024,r=this._sentinel;let n=this._list.head;for(;n!==r&&(e.gpuMemoryUsageInBytes>s||i);){const i=n.item;n=n.next,this.unloadTile(e,i,t);}}trim(){this._trimTiles=!0;}}function t_(e,t,i){return {camera:{position:e.camerapos,direction:e.dir,up:e.up,fov:e.fov},viewport:e,height:i.height,cullingVolume:e.cullingVolume,frameNumber:t,sseDenominator:1.15}}new e.Vector3,new e.Vector3,new e.CullingVolume([new e.Plane,new e.Plane,new e.Plane,new e.Plane,new e.Plane,new e.Plane]);const i_=6356752.314245179,s_=new e.Vector3,r_="I3S",n_="TILES3D",o_="geometricError";function a_(e){return null!=e}const l_=new e.Vector3;new e.Vector3,new e.Vector3;const h_=new e.Rectangle;function __(t,i,s){if(St(t,"3D Tile: boundingVolume must be defined"),t.box)return function(t,i,s){const r=new e.Vector3(t[0],t[1],t[2]);i.transform(r,r);let n=[];if(10===t.length){const i=t.slice(3,6),s=new e.Quaternion;s.fromArray(t,6);const r=new e.Vector3(1,0,0),o=new e.Vector3(0,1,0),a=new e.Vector3(0,0,1);r.transformByQuaternion(s),r.scale(i[0]),o.transformByQuaternion(s),o.scale(i[1]),a.transformByQuaternion(s),a.scale(i[2]),n=[...r.toArray(),...o.toArray(),...a.toArray()];}else n=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];const o=i.transformAsVector(n.slice(0,3)),a=i.transformAsVector(n.slice(3,6)),l=i.transformAsVector(n.slice(6,9)),h=new e.Matrix3([o[0],o[1],o[2],a[0],a[1],a[2],l[0],l[1],l[2]]);return a_(s)?(s.center=r,s.halfAxes=h,s):new e.OrientedBoundingBox(r,h)}(t.box,i,s);if(t.region){a_(t.region[0])&&a_(t.region[1])&&a_(t.region[2])&&a_(t.region[3])||(console.warn("注意: 当前的3dtiles bounding region给出的异常，无法正常进行飞行的定位！",JSON.stringify(t.region)),t.region[0]=-Math.PI,t.region[1]=Math.PI/2,t.region[2]=Math.PI,t.region[3]=-Math.PI/2);const i=e.Rectangle.unpack(t.region,0,h_);return new e.TileBoundingRegion({rectangle:i,minimumHeight:t.region[4],maximumHeight:t.region[5]})}if(t.sphere)return function(t,i,s){const r=!Array.isArray(t),n=r?new e.Vector3(t.center):new e.Vector3(t[0],t[1],t[2]);i.transform(n,n);const o=i.getScale(l_),a=Math.max(Math.max(o[0],o[1]),o[2]),l=(r?t.radius:t[3])*a;return a_(s)?(s.center=n,s.radius=l,s):new e.BoundingSphere(n,l)}(t.sphere,i,s);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}new e.OrientedBoundingBox,new e.Matrix4;const c_=6378137,u_=Math.PI/2;function d_([t,i,s]){const r=e.toRadians(t),n=e.toRadians(i),o=1+s/c_,a=o*Math.cos(n);return [t=a*Math.cos(r),i=a*Math.sin(r),s=o*Math.sin(n)]}function m_([e,t,i=0],[s,r,n=0]){const o=d_([s,r,n]),a=d_([e,t,i]),l=a[0]-o[0],h=a[1]-o[1],_=a[2]-o[2];return l*l+h*h+_*_}function p_(e,t){const i=t.viewport,s=e.header.mbs[3],r=[e.header.mbs[0],e.header.mbs[1],e.header.mbs[2]],n=m_(i.unprojectPosition(i.cameraPosition),r),o=s/c_,a=n-o*o;if(a<=0)return 170141175e30;let l=function(e,t){const{width:i,height:s,pixelProjectionMatrix:r}=t.viewport,n=Math.tan(Math.atan(Math.sqrt(1/(r[0]*r[0])+1/(r[5]*r[5]))));return Math.sqrt(s*s+i*i)/n}(0,t);return l*=o/Math.sqrt(a)/i.scale,l}const f_=new e.Vector3;function g_(e){return null!=e}class y_{constructor(e,t,i,s,r,n){St("object"==typeof t),this.header=t,this.tileset=e,this.id=g_(r)?r:t.id,this.url=t.url,this.parent=i,this.refine=this._getRefine(t.refine),this.type=t.type,this.transformRequest=n,this._depth=0,this.contentUrl=t.contentUrl,this.lodMetricType=null,this.lodMetricValue=null,this.boundingVolume=null,this.content=null,this.contentState=0,this.gpuMemoryUsageInBytes=0,this.children=[],this.depth=0,this.viewportIds=[],this._cacheNode=null,this._frameNumber=null,this._cacheNode=null,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),this._lodJudge=null,this._expireDate=null,this._expiredContent=null,this._getPriority=this._getPriority.bind(this),this.userData={},this._updatedVisibilityFrame=0,this._shouldSelect=!1,this._finalResolution=!0,this._ancestorWithContent=void 0,this._ancestorWithContentAvailable=void 0,this._refines=!1,this._priority=0,this._priorityHolder=this,this._priorityProgressiveResolution=!1,this._priorityProgressiveResolutionScreenSpaceErrorLeaf=!1,this._priorityReverseScreenSpaceError=0,this._foveatedFactor=0,this._wasMinPriorityChild=!1,this._screenSpaceErrorProgressiveResolution=0,this.priorityDeferred=!1,this._isClipped=!1,Object.seal(this);}destroy(){this.header=null;}isDestroyed(){return null===this.header}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return !this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return 3===this.contentState||this.hasEmptyContent}get contentAvailable(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return 0===this.contentState}get contentExpired(){return 4===this.contentState}get boundingSphere(){return this.boundingVolume.getBoundingSphere()}get contentFailed(){return 5===this.contentState}get extras(){return this.header.extras}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}getScreenSpaceError(e,t){switch(this.tileset.type){case r_:return p_(this,e);case n_:return this.getTiles3DScreenSpaceError(this,e,t);default:throw new Error("Unsupported tileset type")}}getTiles3DScreenSpaceError(e,t,i){const s=e.tileset,r=g_(e.parent)?e.parent.lodMetricValue:s.lodMetricValue,n=i?r:e.lodMetricValue;if(0===n)return 0;const o=Math.max(e._distanceToCamera,1e-7),{height:a,sseDenominator:l}=t,{viewDistanceScale:h}=s.options;let _=n*a*(h||1)/(o*l);return _-=this.getDynamicScreenSpaceError(s,o),_}fog(e,t){const i=e*t;return 1-Math.exp(-i*i)}getDynamicScreenSpaceError(e,t){if(e.dynamicScreenSpaceError&&e._dynamicScreenSpaceErrorComputedDensity){const i=e.dynamicScreenSpaceErrorFactor;return this.fog(t,e._dynamicScreenSpaceErrorComputedDensity)*i}return 0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser;if(0===this.contentState)return -1;if(this.tileset.frameNumber-this._touchedFrame>=1){const e=this.tileset._abortListMap.get(this.id);return e&&e.abort(),-1}const t=this.parent;return Math.max((e.root?e.root._screenSpaceError:0)-(t&&(0===this._screenSpaceError||t.hasTilesetContent)?t._screenSpaceError:this._screenSpaceError),0)}async loadContent(){if(this.hasEmptyContent)return !1;if(this.content)return !0;this.contentExpired&&(this._expireDate=null),this.contentState=1;const e=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!e)return this.contentState=0,!1;try{const e=this.tileset.getTileUrl(this.contentUrl),t=this.tileset.loader,i={fetch:this.tileset.fetchOptions,[t.id]:{isTileset:"json"===this.type,...this._getLoaderSpecificOptions(t.id)},json:"json"===this.type,transformRequest:this.transformRequest,context:this.tileset.options.context,useMipmap:this.tileset.options.useMipmap,clippingPlanes:this.tileset.clippingPlanes,allowPick:this.tileset.options.allowPick,nodeProperty:this.tileset.options.nodeProperty,dispatcher:this.tileset.options.dispatcher};return i.fetch.isDestroyed=this.tileset._destroyed,i.fetch._abortListMap=this.tileset._abortListMap,this.content=await cs(e,t,i),this.tileset._abortListMap.has(this.id)&&this.tileset._abortListMap.delete(this.id),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this,Ti(this.contentUrl)),this.contentState=3,this._onContentLoaded(),!0}catch(e){throw this.contentState=5,e}finally{e.done();}}unloadContent(){return this.content&&this.content.batchTable&&this.content.batchTable.destroy(),this.content&&this.content.featureTable&&(this.content.featureTable=void 0),this.content&&this.content.destroy&&this.content.destroy(),this.content&&this.content.gltf&&e.getPrimitives(this.content.gltf).forEach((e=>{e?.destroy();})),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=0,!0}updateVisibility(t,i){if(this._frameNumber===t.frameNumber)return;const s=this.parent,r=s?s._visibilityPlaneMask:e.CullingVolume.MASK_INDETERMINATE;this._updateTransform(s?s.computedTransform:this.tileset.modelMatrix),this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,r),this._visible=this._visibilityPlaneMask!==e.CullingVolume.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=i;}visibility(e,t){const{cullingVolume:i}=e,{boundingVolume:s}=this;return i.computeVisibilityWithPlaneMask(s,t)}contentVisibility(t){return g_(this.boundingVolume)?this._visibilityPlaneMask===e.CullingVolume.MASK_INSIDE?1:t.cullingVolume.computeVisibility(this.boundingVolume):1}distanceToTile(t){const i=this.boundingVolume;return i instanceof e.TileBoundingRegion?i.distanceToCamera(t.camera):Math.sqrt(Math.max(i.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth(e){return f_.subVectors(this.boundingVolume.center,e.position),e.direction.dot(f_)}insideViewerRequestVolume(e){const t=this._viewerRequestVolume;return !t||0===t.distanceToCamera(e.camera.position)}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"));}_initializeTransforms(t){this.transform=t.transform?new e.Matrix4(t.transform):new e.Matrix4;const i=this.parent,s=this.tileset,r=i&&i.computedTransform?i.computedTransform.clone():s.modelMatrix.clone();this.computedTransform=new e.Matrix4(r).multiplyRight(this.transform);const n=i&&i._initialTransform?i._initialTransform.clone():new e.Matrix4;this._initialTransform=new e.Matrix4(n).multiplyRight(this.transform);}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e);}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=0,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1);}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=e.CullingVolume.MASK_INDETERMINATE,this._visible=!1,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0;}_getRefine(e){return e||this.parent&&this.parent.refine||2}_isTileset(){return -1!==this.contentUrl.indexOf(".json")}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset.traverser.disableSkipLevelOfDetail=!0;}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes();}_updateBoundingVolume(e){this.boundingVolume=__(e.boundingVolume,this.computedTransform,this.boundingVolume);const t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=__(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=__(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)));}_updateTransform(t=new e.Matrix4){const i=t.clone().multiplyRight(this.transform);!i.equals(this.computedTransform)&&(this.computedTransform=i,this._updateBoundingVolume(this.header));}_getLoaderSpecificOptions(e){return "i3s"===e?{...this.tileset.options.i3s,tile:this.header,tileset:this.tileset.tileset,isTileHeader:!1}:{assetGltfUpAxis:(t=this.tileset.tileset).asset&&t.asset.gltfUpAxis||"Y"};var t;}updateExpiration(){if(g_(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=4,this._expiredContent=this.content);}}}class C_{constructor(e=0){this._array=new Array(e),this._map=new Map,this._length=e;}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e);}get values(){return this._array}get(e){return St(e<this._array.length),this._array[e]}set(e,t){St(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e);}delete(e){const t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--);}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const t=this.length++;this._array[t]=e,this._map.set(e,t);}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){St(e>=0),e>this._array.length&&(this._array.length=e);}resize(e){St(e>=0),this.length=e;}trim(e){null==e&&(e=this.length),this._array.length=e;}reset(){this._array=[],this._map=new Map,this._length=0;}find(e){return this._map.has(e)}}class T_{constructor(e){this.options={...e},this.traversal={stack:new C_,stackMaximumLength:0},this.emptyTraversal={stack:new C_,stackMaximumLength:0},this.descendantTraversal={stack:new C_,stackMaximumLength:0},this.selectionTraversal={stack:new C_,stackMaximumLength:0,ancestorStack:new C_,ancestorStackMaximumLength:0},this.descendantSelectionDepth=2,this.selectedTiles={},this.requestedTiles={},this.loadTiles=[],this.emptyTiles={},this.root=void 0,this._finalResolution=!0,this._ancestorWithContent=void 0,this._ancestorWithContentAvailable=void 0,this._refines=!1,this._priorityHolder=this,this._priorityProgressiveResolution=!1,this._priorityProgressiveResolutionScreenSpaceErrorLeaf=!1,this._priorityReverseScreenSpaceError=0,this._foveatedFactor=0,this._wasMinPriorityChild=!1;}traverse(e,t,i){if(this.options={...this.options,...i},this.root=e.root,e.parent&&e.parent.debugFreezeFrame)return;this.reset(),e._hasMixedContent=!1;const s=e.root;this.updateTile(e,s,t),this.isVisible(s)?s.getScreenSpaceError(t,!0)<=e._maximumScreenSpaceError?this.options.onTraversalEnd(t):(this.skipLevelOfDetail(e)?e.immediatelyLoadDesiredLevelOfDetail?this.executeSkipTraversal(e,s,t):this.executeBaseAndSkipTraversal(e,s,t):this.executeBaseTraversal(e,s,t),this.traversal.stack.reset(),this.emptyTraversal.stack.reset(),this.descendantTraversal.stack.reset(),this.selectionTraversal.stack.reset(),this.selectionTraversal.ancestorStack.reset(),this.options.onTraversalEnd&&this.options.onTraversalEnd(t)):this.options.onTraversalEnd(t);}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this.loadTiles=[];}executeBaseTraversal(e,t,i){this.executeTraversal(e,t,e._maximumScreenSpaceError,e._maximumScreenSpaceError,i);}executeSkipTraversal(e,t,i){this.executeTraversal(e,t,Number.MAX_VALUE,e._maximumScreenSpaceError,i),this.traverseAndSelect(e,t,i);}executeBaseAndSkipTraversal(e,t,i){this.executeTraversal(e,t,e.baseScreenSpaceError,e._maximumScreenSpaceError,i),this.traverseAndSelect(e,t,i);}skipLevelOfDetail(e){return e.skipLevelOfDetail}addEmptyTile(e,t){this.emptyTiles[t.id]=t;}isVisible(e){return e._visible&&e._inRequestVolume}selectTile(e,t,i){-1!==t.contentVisibility(i)&&(t._selectedFrame=i.frameNumber,this.selectedTiles[t.id]=t);}selectDescendants(e,t,i){const s=this.descendantTraversal.stack;for(s.push(t);s.length>0;){this.descendantTraversal.stackMaximumLength=Math.max(this.descendantTraversal.stackMaximumLength,s.length);const r=s.pop().children,n=r.length;for(let o=0;o<n;++o){const n=r[o];this.isVisible(n)&&(n.contentAvailable?(this.updateTile(e,n,i),this.touchTile(e,n,i),this.selectTile(e,n,i)):n.depth-t.depth<this.descendantSelectionDepth&&s.push(n));}}}selectDesiredTile(e,t,i){if(!this.skipLevelOfDetail(e))return void(t.contentAvailable&&this.selectTile(e,t,i));const s=t.contentAvailable?t:t._ancestorWithContentAvailable;x_(s)?s._shouldSelect=!0:this.selectDescendants(e,t,i);}visitTile(e,t,i){t._visitedFrame=i.frameNumber;}touchTile(e,t,i){t._touchedFrame!==i.frameNumber&&(t.tileset._cache.touch(t),t._touchedFrame=i.frameNumber);}updateMinimumMaximumPriority(e,t){e._maximumPriority.distance=Math.max(t._priorityHolder._distanceToCamera,e._maximumPriority.distance),e._minimumPriority.distance=Math.min(t._priorityHolder._distanceToCamera,e._minimumPriority.distance),e._maximumPriority.depth=Math.max(t.depth,e._maximumPriority.depth),e._minimumPriority.depth=Math.min(t.depth,e._minimumPriority.depth),e._maximumPriority.foveatedFactor=Math.max(t._priorityHolder._foveatedFactor,e._maximumPriority.foveatedFactor),e._minimumPriority.foveatedFactor=Math.min(t._priorityHolder._foveatedFactor,e._minimumPriority.foveatedFactor),e._maximumPriority.reverseScreenSpaceError=Math.max(t._priorityReverseScreenSpaceError,e._maximumPriority.reverseScreenSpaceError),e._minimumPriority.reverseScreenSpaceError=Math.min(t._priorityReverseScreenSpaceError,e._minimumPriority.reverseScreenSpaceError);}isOnScreenLongEnough(e,t,i){if(!e._cullRequestsWhileMoving)return !0;const s=Math.max(2*t.boundingSphere.radius,1),r=i.camera;return e.cullRequestsWhileMovingMultiplier*(0!==r.positionWCDeltaMagnitude?r.positionWCDeltaMagnitude:r.positionWCDeltaMagnitudeLastFrame)/s<1}loadTile(e,t,i){t.id&&this.loadTiles.push(t.id),t._requestedFrame!==i.frameNumber&&(this.hasUnloadedContent(t)||t.contentExpired)&&(t._priority=this.getPriority(t),t._requestedFrame=i.frameNumber,this.requestedTiles[t.id]=t);}updateVisibility(e,t,i){if(t._updatedVisibilityFrame===e._updatedVisibilityFrame)return;const s=[];if(this.options.viewportTraversersMap)for(const e in this.options.viewportTraversersMap)this.options.viewportTraversersMap[e]===i.viewport.id&&s.push(e);else s.push(i.viewport.id);t.updateVisibility(i,s),t._updatedVisibilityFrame=e._updatedVisibilityFrame;}anyChildrenVisible(e,t,i){let s=!1;const r=t.children,n=r.length;for(let t=0;t<n;++t){const n=r[t];this.updateVisibility(e,n,i),s=s||this.isVisible(n);}return s}meetsScreenSpaceErrorEarly(e,t,i){const s=t.parent;return !(!x_(s)||s.hasTilesetContent||1!==s.refine)&&t.getScreenSpaceError(i,!0)<=e._maximumScreenSpaceError}updateTileVisibility(e,t,i){if(this.updateVisibility(e,t,i),!this.isVisible(t))return;const s=t.children.length>0;if(t.hasTilesetContent&&s){const s=t.children[0];return this.updateTileVisibility(e,s,i),void(t._visible=s._visible)}this.meetsScreenSpaceErrorEarly(e,t,i)?t._visible=!1:2===t.refine&&s&&(this.anyChildrenVisible(e,t,i)||(t._visible=!1));}updateTile(e,t,i){this.updateTileVisibility(e,t,i),t.updateExpiration(),t._wasMinPriorityChild=!1,t._priorityHolder=t,t._shouldSelect=!1,t._finalResolution=!0;}updateTileAncestorContentLinks(e,t){e._ancestorWithContent=void 0,e._ancestorWithContentAvailable=void 0;const i=e.parent;if(x_(i)){const s=!this.hasUnloadedContent(i)||i._requestedFrame===t.frameNumber;e._ancestorWithContent=s?i:i._ancestorWithContent,e._ancestorWithContentAvailable=i.contentAvailable?i:i._ancestorWithContentAvailable;}}hasEmptyContent(e){return e.hasEmptyContent||e.hasTilesetContent}hasUnloadedContent(e){return !this.hasEmptyContent(e)&&e.contentUnloaded}reachedSkippingThreshold(e,t){const i=t._ancestorWithContent;return !e.immediatelyLoadDesiredLevelOfDetail&&(t._priorityProgressiveResolutionScreenSpaceErrorLeaf||x_(i)&&t._screenSpaceError<i._screenSpaceError/e.skipScreenSpaceErrorFactor&&t.depth>i.depth+e.skipLevels)}updateAndPushChildren(e,t,i,s){let r;const n=2===t.refine,o=t.children,a=o.length;for(r=0;r<a;++r)this.updateTile(e,o[r],s);o.sort(b_);const l=!this.skipLevelOfDetail(e)&&n&&!this.hasEmptyContent(t);let h,_=!0,c=!1;for(r=0;r<a;++r){var u;h=o[r],this.isVisible(h)?(i.push(h),c=!0):(l||e.loadSiblings)&&(this.loadTile(e,h,s),this.touchTile(e,h,s)),l&&(u=!!h._inRequestVolume&&(this.hasEmptyContent(h)?this.executeEmptyTraversal(e,h,s):h.contentAvailable),_=_&&u);}return c||(_=!1),_}inBaseTraversal(e,t,i){return !this.skipLevelOfDetail(e)||!e.immediatelyLoadDesiredLevelOfDetail&&(!x_(t._ancestorWithContent)||(0===t._screenSpaceError?t.parent._screenSpaceError>i:t._screenSpaceError>i))}canTraverse(e,t){return 0!==t.children.length&&(t.hasTilesetContent?!t.contentExpired:t._screenSpaceError>e._maximumScreenSpaceError)}executeTraversal(e,t,i,s,r){const n=this.traversal.stack;for(n.push(t);n.length>0;){this.traversal.stackMaximumLength=Math.max(this.traversal.stackMaximumLength,n.length);const t=n.pop();this.updateTileAncestorContentLinks(t,r);const s=this.inBaseTraversal(e,t,i),o=1===t.refine,a=2===t.refine,l=t.parent,h=!x_(l)||l._refines;let _=!1;this.canTraverse(e,t)&&(_=this.updateAndPushChildren(e,t,n,r)&&h);const c=!_&&h;this.hasEmptyContent(t)?(this.addEmptyTile(e,t),this.loadTile(e,t,r),c&&this.selectDesiredTile(e,t,r)):o?(this.selectDesiredTile(e,t,r),this.loadTile(e,t,r)):a&&(s?(this.loadTile(e,t,r),c&&this.selectDesiredTile(e,t,r)):c?(this.selectDesiredTile(e,t,r),this.loadTile(e,t,r)):this.reachedSkippingThreshold(e,t)&&this.loadTile(e,t,r)),this.visitTile(e,t,r),this.touchTile(e,t,r),t._refines=_;}}executeEmptyTraversal(e,t,i){let s=!0;const r=this.emptyTraversal.stack;for(r.push(t);r.length>0;){this.emptyTraversal.stackMaximumLength=Math.max(this.emptyTraversal.stackMaximumLength,r.length);const t=r.pop(),n=t.children,o=n.length,a=this.hasEmptyContent(t)&&this.canTraverse(e,t);if(a||t.contentAvailable||(s=!1),this.updateTile(e,t,i),this.isVisible(t)||(this.loadTile(e,t,i),this.touchTile(e,t,i)),a)for(let e=0;e<o;++e)r.push(n[e]);}return s}traverseAndSelect(e,t,i){const s=this.selectionTraversal.stack,r=this.selectionTraversal.ancestorStack;let n;for(s.push(t);s.length>0||r.length>0;){if(this.selectionTraversal.stackMaximumLength=Math.max(this.selectionTraversal.stackMaximumLength,s.length),this.selectionTraversal.ancestorStackMaximumLength=Math.max(this.selectionTraversal.ancestorStackMaximumLength,r.length),r.length>0){const t=r.peek();if(t._stackLength===s.length){r.pop(),t!==n&&(t._finalResolution=!1),this.selectTile(e,t,i);continue}}const t=s.pop();if(!x_(t))continue;const o=1===t.refine,a=t._shouldSelect,l=t.children,h=l.length,_=this.canTraverse(e,t);if(a)if(o)this.selectTile(e,t,i);else {if(t._selectionDepth=r.length,t._selectionDepth>0&&(e._hasMixedContent=!0),n=t,!_){this.selectTile(e,t,i);continue}r.push(t),t._stackLength=s.length;}if(_)for(let e=0;e<h;++e){const t=l[e];this.isVisible(t)&&s.push(t);}}}getPriority(e){const{options:t}=this;switch(e.refine){case 1:return e._distanceToCamera;case 2:const{parent:i}=e;return this.root._screenSpaceError-(!i||t.skipLevelOfDetail&&0!==e._screenSpaceError&&!i.hasTilesetContent?e._screenSpaceError:i._screenSpaceError);default:return assert(!1)}}}function x_(e){return null!=e}function b_(e,t){return 0===t._distanceToCamera&&0===e._distanceToCamera?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}const v_={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2};class w_{constructor(e){this.options={...v_,...e},this._traversalStack=new C_,this._emptyTraversalStack=new C_,this._frameNumber=null,this.root=null,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={};}traverse(e,t,i){this.root=e,this.options={...this.options,...i},this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t);}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset();}executeTraversal(e,t){const i=this._traversalStack;for(i.push(e);i.length>0;){const e=i.pop();let s=!1;this.canTraverse(e,t)&&(this.updateChildTiles(e,t),s=this.updateAndPushChildren(e,t,i));const r=e.parent,n=Boolean(!r||r._shouldRefine),o=!s;e.hasRenderContent?1===e.refine?(this.loadTile(e,t),this.selectTile(e,t)):2===e.refine&&(this.loadTile(e,t),o&&this.selectTile(e,t)):(this.emptyTiles[e.id]=e,this.loadTile(e,t),o&&this.selectTile(e,t)),this.touchTile(e,t),e._shouldRefine=s&&n;}this.options.onTraversalEnd&&this.options.onTraversalEnd(t);}updateChildTiles(e,t){const i=e.children;for(const e of i)this.updateTile(e,t);return !0}updateAndPushChildren(e,t,i){const{loadSiblings:s,skipLevelOfDetail:r}=this.options,n=e.children;n.sort(this.compareDistanceToCamera);const o=!r&&2===e.refine&&e.hasRenderContent;let a=!1;for(const e of n)if(e.isVisibleAndInRequestVolume?(i.find(e)&&i.delete(e),i.push(e),a=!0):(o||s)&&(this.loadTile(e,t),this.touchTile(e,t)),o){let i;if(i=!!e._inRequestVolume&&(e.hasRenderContent?e.contentAvailable:this.executeEmptyTraversal(e,t)),!i)return i}return a}updateTile(e,t){this.updateTileVisibility(e,t);}selectTile(e,t){this.shouldSelectTile(e,t)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e);}loadTile(e,t){this.shouldLoadTile(e,t)&&(e._requestedFrame=t.frameNumber,e._priority=this.getPriority(e),this.requestedTiles[e.id]=e);}touchTile(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber;}canTraverse(e,t,i=!1,s=!1){return !(!s&&!e.isVisibleAndInRequestVolume)&&!!e.hasChildren&&(e.hasTilesetContent?!e.contentExpired:this.shouldRefine(e,t,i))}shouldLoadTile(e,t){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e,t){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,t,i){let s=e._screenSpaceError;return i&&(s=e.getScreenSpaceError(t,!0)),s>this.options.maximumScreenSpaceError}updateTileVisibility(e,t){const i=[];if(this.options.viewportTraversersMap)for(const e in this.options.viewportTraversersMap)this.options.viewportTraversersMap[e]===t.viewport.id&&i.push(e);else i.push(t.viewport.id);e.updateVisibility(t,i);}compareDistanceToCamera(e,t){return e._distanceToCamera-t._distanceToCamera}getPriority(e){const{options:t}=this;switch(e.refine){case 1:return e._distanceToCamera;case 2:const{parent:i}=e;return this.root._screenSpaceError-(!i||t.skipLevelOfDetail&&0!==e._screenSpaceError&&!i.hasTilesetContent?e._screenSpaceError:i._screenSpaceError);default:return St(!1)}}anyChildrenVisible(e,t){let i=!1;for(const s of e.children)s.updateVisibility(t),i=i||s.isVisibleAndInRequestVolume;return i}executeEmptyTraversal(e,t){let i=!0;const s=this._emptyTraversalStack;for(;s.length>0;){const e=s.pop();this.updateTile(e,t),e.isVisibleAndInRequestVolume||(this.loadTile(e,t),this.touchTile(e,t));const r=!e.hasRenderContent&&this.canTraverse(e,t,!1,!0);if(r||e.contentAvailable||(i=!1),r){const t=e.children.filter((e=>e));for(const e of t)s.find(e)&&s.delete(e),s.push(e);}}return i}}class S_{constructor(){this._statusMap={};}add(e,t,i,s){this._statusMap[t]||(this._statusMap[t]={request:e,callback:i,key:t,frameState:s,status:"REQUESTED"},e().then((e=>{this._statusMap[t].status="COMPLETED",this._statusMap[t].callback(e,s);})).catch((e=>{this._statusMap[t].status="ERROR",i(e);})));}update(e,t){this._statusMap[e]&&(this._statusMap[e].frameState=t);}find(e){return this._statusMap[e]}}class A_ extends w_{constructor(e){super(e),this._tileManager=new S_;}shouldRefine(e,t){return e._lodJudge=function(e,t){const i=t.viewport,s=i.metersPerPixel,r=e.header.mbs[1],n=e.header.mbs[0],o=e.header.mbs[2],a=e.header.mbs[3],{height:l,width:h,latitude:_,longitude:c}=i,u=[c,_],d=[n,r,o],m=[c,r],p=[n,_],f=Math.sqrt(l*l+h*h)*s[0],g=m_(u,d),y=.5*l+a/c_,C=.5*h+a/c_;if(g>f+a/c_)return "OUT";if(m_(u,m)>y)return "OUT";if(m_(u,p)>C)return "OUT";if(0===e.lodMetricValue)return "DIG";let T=p_(e,t);return T*=u_,T<.5?"OUT":!e.header.children||T<=e.lodMetricValue?"DRAW":e.header.children?"DIG":"OUT"}(e,t),"DIG"===e._lodJudge}updateChildTiles(e,t){const i=e.header.children||[],s=e.children,r=e.tileset;for(const n of i){const i=`${n.id}-${t.viewport.id}`,o=s&&s.find((e=>e.id===i));if(o)o&&this.updateTile(o,t);else {let s=()=>this._loadTile(n.id,r);this._tileManager.find(i)?this._tileManager.update(i,t):(r.tileset.nodePages&&(s=()=>r.tileset.nodePagesTile.formTileFromNodePages(n.id)),this._tileManager.add(s,i,(t=>this._onTileLoad(t,e,i)),t));}}}async _loadTile(e,t){const{loader:i}=t,s=t.getTileUrl(`${t.url}/nodes/${e}`),r={i3s:{...t.fetchOptions,isTileHeader:!0,loadContent:!1}};return await cs(s,i,r)}_onTileLoad(e,t,i){const s=new y_(t.tileset,e,t,this.options.basePath,i);t.children.push(s);const r=this._tileManager.find(s.id).frameState;this.updateTile(s,r),this._frameNumber===r.frameNumber&&this.executeTraversal(s,r);}}const E_="Tiles In Tileset(s)",M_="Tiles In Memory",P_="Tiles In View",R_="Tiles To Render",B_="Tiles Loaded",I_="Tiles Loading",D_="Tiles Unloaded",O_="Failed Tile Loads",L_="Points/Vertices",V_="Tile Memory Use",N_=/\/\/.*\.[0-9]{1,4}(:[\w]+)?/g,F_=/^((http:\/\/)|(https:\/\/))?([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,6}()/g,G_={modelMatrix:new e.Matrix4,throttleRequests:!0,maximumMemoryUsage:32,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:(e,t,i)=>{},maximumScreenSpaceError:8};class k_{constructor(e,t={}){St(e),this.options={...G_,...t},this.subIPs=t.subIPs,this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||Ti(this.url),this.modelMatrix=this.options.modelMatrix,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this.fetchOptions=this.options.fetchOptions||{},this.options.headers&&(this.fetchOptions.headers=this.options.headers),this.options.token&&(this.fetchOptions.token=this.options.token),this.root=null,this.roots={},this.cartographicCenter=null,this.cartesianCenter=null,this.zoom=1,this.boundingVolume=null,this._traverser=this._initializeTraverser(),this._cache=new e_,this._requestScheduler=new gi({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this._frameNumber=0,this._updateFrameNumber=0,this._pendingCount=0,this.selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this._selectedTilesToStyle=[],this.frameStateData={},this._queryParams={},this._queryParamsString=null,this.maximumMemoryUsage=this.options.maximumMemoryUsage,this.gpuMemoryUsageInBytes=0,this.stats=new pi({id:this.url}),this._initializeStats(),this._hasMixedContent=!1,this._maximumScreenSpaceError=this.options.maximumScreenSpaceError,this._properties=void 0,this._extensionsUsed=void 0,this._gltfUpAxis=void 0,this._dynamicScreenSpaceErrorComputedDensity=0,this.extras=null,this.asset={},this.credits={},this.description=this.options.description,this._defaultGeometrySchema=[],this.loadSiblings=this.options.loadSiblings,this.skipLevelOfDetail=this.options.skipLevelOfDetail,this.baseScreenSpaceError=this.options.baseScreenSpaceError,this._updatedVisibilityFrame=0,this.skipLevels=this.options.skipLevels,this.skipScreenSpaceErrorFactor=this.options.skipScreenSpaceErrorFactor,this.immediatelyLoadDesiredLevelOfDetail=this.options.immediatelyLoadDesiredLevelOfDetail,this._hasMixedContent=!1,this.clippingPlanes=this.options.clippingPlanes,this.allowPick=this.options.allowPick,this.nodeProperty=this.options.nodeProperty,this._maximumPriority={foveatedFactor:-Number.MAX_VALUE,depth:-Number.MAX_VALUE,distance:-Number.MAX_VALUE,reverseScreenSpaceError:-Number.MAX_VALUE},this._minimumPriority={foveatedFactor:Number.MAX_VALUE,depth:Number.MAX_VALUE,distance:Number.MAX_VALUE,reverseScreenSpaceError:Number.MAX_VALUE},this.transformRequest=t.transformRequest,this._initializeTileSet(e,this.options),this.cull=!1,this._abortListMap=new Map,this._destroyed=!1,this.parent=t.parent;}isLoaded(){return 0===this._pendingCount&&0!==this._frameNumber&&0===this._requestedTiles.length}destroy(){this._destroy();}get frameNumber(){return this._frameNumber}setOptions(e){this.options={...this.options,...e};}getTileUrl(e){if(e.startsWith("data:"))return e;if(e=e.replace(/\+/g,"%2B"),this.subIPs&&this.subIPs.length>0){let t="";return N_.test(e)&&(t=`${e.replace(N_,`//${this.subIPs[Math.floor(Math.random()*this.subIPs.length)]}`)}${this.queryParams}`),F_.test(e)&&(t=`${e.split("/")[0]}//${e.replace(F_,`${this.subIPs[Math.floor(Math.random()*this.subIPs.length)]}`)}${this.queryParams}`),t}return `${e}${this.queryParams}`}update(e,t){if("loadTiles"in this.options&&!this.options.loadTiles)return;if(this.traverseCounter>0)return;e instanceof Array||(e=[e]),this._cache.reset(),this._frameNumber++,++this._updatedVisibilityFrame,this.traverseCounter=e.length;const i=[];for(const t of e){const e=t.id;this._needTraverse(e)?i.push(e):this.traverseCounter--;}for(const s of e){const e=s.id;if(this.roots[e]||(this.roots[e]=this._initializeTileHeaders(this.tileset,null,this.basePath)),!i.includes(e))continue;const r=t_(s,this._frameNumber,t);this._traverser.traverse(this.roots[e].tileset,r,this.options);}}_needTraverse(e){let t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}_onTraversalEnd(e){const t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const i=this.frameStateData[t],s=Object.values(this._traverser.selectedTiles);i.selectedTiles=s,i._requestedTiles=Object.values(this._traverser.requestedTiles),i._emptyTiles=Object.values(this._traverser.emptyTiles),this.cull=!(s.length>0),this.traverseCounter--,this.traverseCounter>0||this._updateTiles();}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles);}this._loadTiles(),this._unloadTiles(),this._updateStats();}_tilesChanged(e,t){if(e.length!==t.length)return !0;const i=new Set(e.map((e=>e.id))),s=new Set(t.map((e=>e.id)));let r=e.filter((e=>!s.has(e.id))).length>0;return r=r||t.filter((e=>!i.has(e.id))).length>0,r}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e);}_unloadTiles(){this._cache.unloadTiles(this,((e,t)=>e._unloadTile(t)));}_updateStats(){let e=0,t=0;for(const i of this.selectedTiles)i.contentAvailable&&(e++,i.content.pointCount&&(t+=i.content.pointCount));this.stats.get(P_).count=this.selectedTiles.length,this.stats.get(R_).count=e,this.stats.get(L_).count=t;}_initializeTileSet(e){this.root=this._initializeTileHeaders(e,null,this.basePath),this.type===n_&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===r_&&this._initializeI3STileset(e);}calculateViewPropsTiles3D(){const t=this.root,{center:i}=t.boundingVolume;if(!i)return console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new e.Vector3,void(this.zoom=1);0!==i[0]||0!==i[1]||0!==i[2]?(this.cartographicCenter=new e.Vector3,e.Ellipsoid.WGS84.cartesianToCartographic(i,this.cartographicCenter)):this.cartographicCenter=new e.Vector3(0,0,-e.Ellipsoid.WGS84.radii[0]),this.cartesianCenter=i,this.zoom=function(e){const{halfAxes:t,radius:i,width:s,height:r}=e;if(t){const e=function(e){e.getColumn(0,s_);const t=e.getColumn(1),i=e.getColumn(2);return s_.add(t).add(i).len()}(t);return Math.log2(i_/e)}return i?Math.log2(i_/i):r&&s?(Math.log2(6378137/s)+Math.log2(6378137/r))/2:1}(t.boundingVolume);}_initializeStats(){this.stats.get(E_),this.stats.get(I_),this.stats.get(M_),this.stats.get(P_),this.stats.get(R_),this.stats.get(B_),this.stats.get(D_),this.stats.get(O_),this.stats.get(L_,"memory"),this.stats.get(V_,"memory");}_initializeTileHeaders(e,t,i){const s=new y_(this,e.root,t,i,void 0,this.transformRequest);if(t&&(t.children.push(s),s.depth=t.depth+1),this.type===n_){const e=[];for(e.push(s);e.length>0;){const t=e.pop();this.stats.get(E_).incrementCount();const s=t.header.children||[];for(const r of s){const s=new y_(this,r,t,i,void 0,this.transformRequest);t.children.push(s),s.depth=t.depth+1,e.push(s);}}}return s}_initializeTraverser(){let e;switch(this.type){case n_:e=T_;break;case r_:e=A_;break;default:e=w_;}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e);}async _loadTile(e){let t;try{this._onStartTileLoading(),t=await e.loadContent();}catch(t){this._onTileLoadError(e,t instanceof Error?t:new Error("load failed"));}finally{this._onEndTileLoading(),this._onTileLoad(e,t);}}_onTileLoadError(e,t){this.stats.get(O_).incrementCount();const i=t.message||t.toString(),s=e.contentUrl;console.error(`A 3D tile failed to load: ${e.contentUrl} ${i}`),this.options.onTileError(e,i,s);}_onTileLoad(t,i){i&&(t&&t.content&&function(t,i){St(t),St(i);const{computedTransform:s,boundingVolume:{center:r}}=t;let n,o;if("cmpt"===i.type){for(const t of i.tiles){o=t.rtcCenter,n=t.gltfUpAxis;let i=new e.Matrix4(s);if(o){const t=(new e.Matrix4).makeTranslation(o[0],o[1],o[2]);i=i.multiplyRight(t);}if("i3dm"!==t.type)switch(n){case"Z":break;case"Y":const t=(new e.Matrix4).rotateX(Math.PI/2);i=i.multiplyRight(t);break;case"X":const s=(new e.Matrix4).rotateY(-Math.PI/2);i=i.multiplyRight(s);}t.childModelMatrix=i;}return}o=i.rtcCenter,n=i.gltfUpAxis;let a=new e.Matrix4(s);if(o&&a.translate(o),"i3dm"!==i.type)switch(n){case"Z":break;case"Y":const t=(new e.Matrix4).rotateX(Math.PI/2);a=a.multiplyRight(t);break;case"X":const i=(new e.Matrix4).rotateY(-Math.PI/2);a=a.multiplyRight(i);}const l=new e.Vector3(r);i.cartesianModelMatrix=a,i.cartesianOrigin=l;const h=e.Ellipsoid.WGS84.cartesianToCartographic(l,new e.Vector3),_=e.Ellipsoid.WGS84.eastNorthUpToFixedFrame(l).invert();i.cartographicModelMatrix=_.multiplyRight(a),i.cartographicOrigin=h,i.modelMatrix=i.cartographicModelMatrix;}(t,t.content),this._addTileToCache(t),this.options.onTileLoad(t));}_onStartTileLoading(){this._pendingCount++,this.stats.get(I_).incrementCount();}_onEndTileLoading(){this._pendingCount--,this.stats.get(I_).decrementCount();}_addTileToCache(e){this._cache.add(this,e,(t=>t._updateCacheStats(e)));}_updateCacheStats(e){this.stats.get(B_).incrementCount(),this.stats.get(M_).incrementCount(),this.gpuMemoryUsageInBytes+=e.content.byteLength||0,this.gpuMemoryUsageInBytes+=e.content.gltf?e.content.gltf.textureByteSize:0,this.stats.get(V_).count=this.gpuMemoryUsageInBytes;}_unloadTile(t){e.defined(t.content)&&(this.gpuMemoryUsageInBytes-=t.content.byteLength||0,this.gpuMemoryUsageInBytes-=t.content.gltf?t.content.gltf.textureByteSize:0,this.stats.get(M_).decrementCount(),this.stats.get(D_).incrementCount(),this.stats.get(V_).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent());}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const t=e.pop();for(const i of t.children)e.push(i);this._destroyTile(t);}this.root=null;}_destroySubtree(e){const t=e,i=[];for(i.push(t);i.length>0;){e=i.pop();for(const t of e.children)i.push(t);e!==t&&this._destroyTile(e);}t.children=[];}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy();}_initializeTiles3DTileset(e){if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version&&"1.1"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras;}_initializeI3STileset(e){"token"in this.options&&(this._queryParams.token=this.options.token),this._defaultGeometrySchema=e.store.defaultGeometrySchema;}hasExtension(e){return Boolean(this._extensionsUsed&&this._extensionsUsed.indexOf(e)>-1)}trimTiles(){this._cache.trim();}get queryParams(){return this._queryParamsString||(this._queryParamsString=function(e){const t=[];for(const i of Object.keys(e))t.push(`${i}=${e[i]}`);switch(t.length){case 0:return "";case 1:return `?${t[0]}`;default:return `?${t.join("&")}`}}(this._queryParams)),this._queryParamsString}}const U_="undefined"!=typeof __VERSION__?__VERSION__:"latest";function H_(e,t,i){St(e instanceof ArrayBuffer);const s=new TextDecoder("utf8"),r=new Uint8Array(e.slice(t,t+i));return s.decode(r)}const z_={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},W_={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,...z_},j_={[z_.DOUBLE]:Float64Array,[z_.FLOAT]:Float32Array,[z_.UNSIGNED_SHORT]:Uint16Array,[z_.UNSIGNED_INT]:Uint32Array,[z_.UNSIGNED_BYTE]:Uint8Array,[z_.BYTE]:Int8Array,[z_.SHORT]:Int16Array,[z_.INT]:Int32Array},X_={DOUBLE:z_.DOUBLE,FLOAT:z_.FLOAT,UNSIGNED_SHORT:z_.UNSIGNED_SHORT,UNSIGNED_INT:z_.UNSIGNED_INT,UNSIGNED_BYTE:z_.UNSIGNED_BYTE,BYTE:z_.BYTE,SHORT:z_.SHORT,INT:z_.INT},q_="Failed to convert GL type";class K_{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const t in j_)if(j_[t]===e)return t;throw new Error(q_)}static fromName(e){const t=X_[e];if(!t)throw new Error(q_);return t}static getArrayType(e,t=!1){switch(e){case z_.UNSIGNED_SHORT_5_6_5:case z_.UNSIGNED_SHORT_4_4_4_4:case z_.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const t=j_[e];if(!t)throw new Error(q_);return t}}static getByteSize(e){return K_.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return Boolean(K_.getArrayType(e))}static createTypedArray(e,t,i=0,s){return void 0===s&&(s=(t.byteLength-i)/K_.getByteSize(e)),new(K_.getArrayType(e))(t,i,s)}}function J_(e,t=[0,0,0]){const i=e>>5&63,s=31&e;return t[0]=(e>>11&31)<<3,t[1]=i<<2,t[2]=s<<3,t}class Z_{constructor(e,t){this.json=e,this.buffer=t,this.featuresLength=0,this._cachedTypedArrays={};}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return Boolean(this.json[e])}getGlobalProperty(e,t=W_.UNSIGNED_INT,i=1){const s=this.json[e];return s&&Number.isFinite(s.byteOffset)?this._getTypedArrayFromBinary(e,t,i,1,s.byteOffset):s}getPropertyArray(e,t,i){const s=this.json[e];return s&&Number.isFinite(s.byteOffset)?("componentType"in s&&(t=K_.fromName(s.componentType)),this._getTypedArrayFromBinary(e,t,i,this.featuresLength,s.byteOffset)):this._getTypedArrayFromArray(e,t,s)}getProperty(e,t,i,s,r){const n=this.json[e];if(!n)return n;const o=this.getPropertyArray(e,t,i);if(1===i)return o[s];for(let e=0;e<i;++e)r[e]=o[i*s+e];return r}_getTypedArrayFromBinary(e,t,i,s,r){const n=this._cachedTypedArrays;let o=n[e];return o||(o=K_.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+r,s*i),n[e]=o),o}_getTypedArrayFromArray(e,t,i){const s=this._cachedTypedArrays;let r=s[e];return r||(r=K_.createTypedArray(t,i),s[e]=r),r}}const Y_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Q_={SCALAR:(e,t)=>e[t],VEC2:(e,t)=>[e[2*t+0],e[2*t+1]],VEC3:(e,t)=>[e[3*t+0],e[3*t+1],e[3*t+2]],VEC4:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT2:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT3:(e,t)=>[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]],MAT4:(e,t)=>[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]},$_={SCALAR:(e,t,i)=>{t[i]=e;},VEC2:(e,t,i)=>{t[2*i+0]=e[0],t[2*i+1]=e[1];},VEC3:(e,t,i)=>{t[3*i+0]=e[0],t[3*i+1]=e[1],t[3*i+2]=e[2];},VEC4:(e,t,i)=>{t[4*i+0]=e[0],t[4*i+1]=e[1],t[4*i+2]=e[2],t[4*i+3]=e[3];},MAT2:(e,t,i)=>{t[4*i+0]=e[0],t[4*i+1]=e[1],t[4*i+2]=e[2],t[4*i+3]=e[3];},MAT3:(e,t,i)=>{t[9*i+0]=e[0],t[9*i+1]=e[1],t[9*i+2]=e[2],t[9*i+3]=e[3],t[9*i+4]=e[4],t[9*i+5]=e[5],t[9*i+6]=e[6],t[9*i+7]=e[7],t[9*i+8]=e[8],t[9*i+9]=e[9];},MAT4:(e,t,i)=>{t[16*i+0]=e[0],t[16*i+1]=e[1],t[16*i+2]=e[2],t[16*i+3]=e[3],t[16*i+4]=e[4],t[16*i+5]=e[5],t[16*i+6]=e[6],t[16*i+7]=e[7],t[16*i+8]=e[8],t[16*i+9]=e[9],t[16*i+10]=e[10],t[16*i+11]=e[11],t[16*i+12]=e[12],t[16*i+13]=e[13],t[16*i+14]=e[14],t[16*i+15]=e[15];}},ec=e=>void 0!==e;function tc(e,t,i){if(!e)return;const s=e.parentCounts;return e.parentIds?i(e,t):s>0?function(e,t,i){const s=e.parentCounts,r=e.parentIds,n=e.parentIndexes,o=scratchVisited;o.length=Math.max(o.length,e.classIds.length);const a=++marker,l=scratchStack;for(l.length=0,l.push(t);l.length>0;){if(o[t=l.pop()]===a)continue;o[t]=a;const h=i(e,t);if(ec(h))return h;const _=s[t],c=n[t];for(let e=0;e<_;++e){const i=r[c+e];i!==t&&l.push(i);}}return null}(e,t,i):function(e,t,i){let s=!0;for(;s;){const r=i(e,t);if(ec(r))return r;const n=e.parentIds[t];s=n!==t,t=n;}throw new Error("traverseHierarchySingleParent")}(e,t,i)}function ic(e,t,i){const s=e.parentCounts,r=e.parentIds,n=e.parentIndexes,o=e.classIds.length;if(!ec(r))return;assert(t<o,`Parent index ${t} exceeds the total number of instances: ${o}`),assert(-1===i.indexOf(t),"Circular dependency detected in the batch table hierarchy."),i.push(t);const a=ec(s)?s[t]:1,l=ec(s)?n[t]:t;for(let s=0;s<a;++s){const n=r[l+s];n!==t&&ic(e,n,i);}i.pop(t);}function sc(t,i,s,r){if("function"==typeof t.fill)return t.fill(i,s,r);const n=t.length>>>0,o=e.defaultValue(s,0);let a=o<0?Math.max(n+o,0):Math.min(o,n);const l=e.defaultValue(r,n),h=l<0?Math.max(n+l,0):Math.min(l,n);for(;a<h;)t[a]=i,a++;return t}class rc{constructor(t){const i=t.featuresLength;let s,r;if(this._showAlphaProperties=void 0,this._batchValues=void 0,this._batchValuesDirty=!1,this._batchTexture=void 0,this._defaultTexture=void 0,this._pickTexture=void 0,this._pickIds=[],i>0){const t=Math.min(i,e.ContextLimits.maximumTextureSize),n=Math.ceil(i/e.ContextLimits.maximumTextureSize),o=1/t,a=.5*o,l=1/n,h=.5*l;s=new e.Vector2(t,n),r=new e.Vector4(o,a,l,h);}this._translucentFeaturesLength=0,this._featuresLength=i,this._textureDimensions=s,this._textureStep=r,this._owner=t.owner,this._statistics=t.statistics,this._colorChangedCallback=t.colorChangedCallback;}get translucentFeaturesLength(){return this._translucentFeaturesLength}get textureDimensions(){return this._textureDimensions}get textureStep(){return this._textureStep}get batchTexture(){return this._batchTexture}get defaultTexture(){return this._defaultTexture}get pickTexture(){return this._pickTexture}setShow(t,i){if(i&&!e.defined(this._showAlphaProperties))return;const s=lc(this),r=2*t,n=i?255:0;s[r]!==n&&(s[r]=n,ac(this)[4*t+3]=i?s[r+1]:0,this._batchValuesDirty=!0);}setAllShow(e){const t=this._featuresLength;for(let i=0;i<t;++i)this.setShow(i,e);}getShow(t){return hc(t,this._featuresLength),!e.defined(this._showAlphaProperties)||255===this._showAlphaProperties[2*t]}setColor(t,i){if(hc(t,this._featuresLength),e.Color.equals(i,rc.DEFAULT_COLOR_VALUE)&&!e.defined(this._batchValues))return;const s=i.toBytes(_c),r=s[3],n=ac(this),o=4*t,a=lc(this),l=2*t;if(n[o]!==s[0]||n[o+1]!==s[1]||n[o+2]!==s[2]||a[l+1]!==r){n[o]=s[0],n[o+1]=s[1],n[o+2]=s[2];const h=255!==a[l+1];n[o+3]=0!==a[l]?r:0,a[l+1]=r;const _=255!==r;_&&!h?++this._translucentFeaturesLength:!_&&h&&--this._translucentFeaturesLength,this._batchValuesDirty=!0,e.defined(this._colorChangedCallback)&&this._colorChangedCallback(t,i);}}setAllColor(e){const t=this._featuresLength;for(let i=0;i<t;++i)this.setColor(i,e);}getColor(t,i){if(hc(t,this._featuresLength),!e.defined(this._batchValues))return e.Color.clone(rc.DEFAULT_COLOR_VALUE,i);const s=this._batchValues,r=4*t;return e.Color.fromBytes(s[r],s[r+1],s[r+2],this._showAlphaProperties[2*t+1],i)}getPickColor(e){return hc(e,this._featuresLength),this._pickIds[e]}update(t){const i=t.context;this._defaultTexture=i.defaultTexture,function(t,i){const s=t._featuresLength;if(!e.defined(t._pickTexture)&&s>0){const r=t._pickIds,n=oc(t),o=new Uint8Array(n),a=t._owner;for(let t=0;t<s;++t){const s=i.createPickId(a.getFeature(t,a.nodeProperty));r.push(s);const n=s.color,l=4*t;o[l]=e.Color.floatToByte(n.r),o[l+1]=e.Color.floatToByte(n.g),o[l+2]=e.Color.floatToByte(n.b),o[l+3]=e.Color.floatToByte(n.a);}t._pickTexture=nc(t,i,o);}}(this,i),this._batchValuesDirty&&(this._batchValuesDirty=!1,e.defined(this._batchTexture)?function(e){const t=e._textureDimensions;e._batchTexture.copyFrom({source:{width:t.x,height:t.y,arrayBufferView:e._batchValues}});}(this):this._batchTexture=nc(this,i,this._batchValues));}destroy(){this._batchTexture=this._batchTexture&&this._batchTexture.destroy(),this._pickTexture=this._pickTexture&&this._pickTexture.destroy();const t=this._pickIds,i=t.length;for(let e=0;e<i;++e)t[e].destroy();return e.destroyObject(this)}getUniformMapCallback(){if(0===this.featuresLength)return;const t=this;return function(i){i?.has("batchTexture")&&i.delete("batchTexture"),i?.has("batch_textureDimensions")&&i.delete("batch_textureDimensions"),i?.has("batch_textureStep")&&i.delete("batch_textureStep"),i?.has("pickColorTexture")&&i.delete("pickColorTexture");const s=new Map([["batchTexture",()=>{const i=e.defaultValue(t.batchTexture,t.defaultTexture);return i.bind(e.TextureMagnificationFilter.NEAREST,e.TextureWrap.CLAMP_TO_EDGE),i}],["batch_textureDimensions",()=>t.textureDimensions],["batch_textureStep",()=>t.textureStep],["pickColorTexture",()=>(t.pickTexture.bind(e.TextureMagnificationFilter.NEAREST,e.TextureWrap.CLAMP_TO_EDGE),t.pickTexture)]]);return e.combineInternalMap(i,s)}}static DEFAULT_COLOR_VALUE=e.Color.white;static DEFAULT_SHOW_VALUE=!0}function nc(t,i,s){const r=t._textureDimensions;return new e.Texture({context:i,pixelFormat:e.PixelFormat.RGBA,pixelDatatype:e.PixelDatatype.UNSIGNED_BYTE,image:{width:r.x,height:r.y,arrayBufferView:s},flipY:!1})}function oc(e){const t=e._textureDimensions;return t.x*t.y*4}function ac(t){if(!e.defined(t._batchValues)){const e=oc(t),i=new Uint8Array(e);sc(i,255),t._batchValues=i;}return t._batchValues}function lc(t){if(!e.defined(t._showAlphaProperties)){const e=new Uint8Array(2*t._featuresLength);sc(e,255),t._showAlphaProperties=e;}return t._showAlphaProperties}function hc(t,i){if(!e.defined(t)||t<0||t>=i)throw new Error(`batchId is required and between zero and featuresLength - 1 (${i}`-NaN)}const _c=new Array(4);class cc{constructor(e,t,i){this._batchId=e,this._nodeProperty=t,this._content=i,this._color=void 0;}get color(){return e.defined(this._color)||(this._color=new e.Color),this._content._batchTexture.getColor(this._batchId,this._color)}set color(t){e.defined(this._color)||(this._color=new e.Color),t[3]=0===t[3]?.98:t[3]<1?1-t[3]:t[3],this._color.set(t),this._content._batchTexture.setColor(this._batchId,this._color);}get show(){return this._content.getShow(this._batchId)}set show(e){this._content._batchTexture.setShow(this._batchId,e);}hasProperty(e){return this._content.hasProperty(this._batchId,e)}getPropertyNames(e){return this._content.getPropertyNames(this._batchId,e)}getProperty(e){return this._content.getProperty(this._batchId,e)}destroy(){this._content=void 0,this._batchId=void 0,this._color=void 0;}}function uc(e){return null!=e}const dc=(e,t)=>e,mc={HIERARCHY:!0,extensions:!0,extras:!0};class pc{constructor(e,t,i,s,r,n={}){St(i>=0),this.json=e||{},this.binary=t,this.featureCount=i,this._extensions=this.json&&this.json.extensions||{},this.nodeProperty=r,this._properties={};for(const e in this.json)mc[e]||(this._properties[e]=this.json[e]);this._binaryProperties=this._initializeBinaryProperties(),n["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=function(e,t,i){if(!t)return null;let s=e.getExtension("3DTILES_batch_table_hierarchy");const r=t.HIERARCHY;return r&&(t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=r,s=r),s?function(e,t){let i,s,r;const n=e.instancesLength,o=e.classes;let a,l=e.classIds,h=e.parentCounts,_=e.parentIds,c=n;if(ec(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,r=getBinaryAccessor(l),l=r.createArrayBufferView(t.buffer,t.byteOffset+l.byteOffset,n)),ec(h))for(ec(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,r=getBinaryAccessor(h),h=r.createArrayBufferView(t.buffer,t.byteOffset+h.byteOffset,n)),a=new Uint16Array(n),c=0,i=0;i<n;++i)a[i]=c,c+=h[i];ec(_)&&ec(_.byteOffset)&&(_.componentType=defaultValue(_.componentType,GL.UNSIGNED_SHORT),_.type=AttributeType.SCALAR,r=getBinaryAccessor(_),_=r.createArrayBufferView(t.buffer,t.byteOffset+_.byteOffset,c));const u=o.length;for(i=0;i<u;++i){const e=o[i].instances,s=getBinaryProperties(o[i].length,e,t);o[i].instances=combine(s,e);}const d=new Array(u).fill(0),m=new Uint16Array(n);for(i=0;i<n;++i)s=l[i],m[i]=d[s],++d[s];const p={classes:o,classIds:l,classIndexes:m,parentCounts:h,parentIndexes:a,parentIds:_};return function(e){const t=e.classIds.length;for(let i=0;i<t;++i)ic(e,i,stack);}(p),p}(s,i):null}(this,this.json,this.binary)),this._batchTexture=new rc({featuresLength:i,owner:this}),this._features=void 0,this._url=s;}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){return this._checkBatchId(e),St("string"==typeof t,t),!!this._hierarchy&&uc(tc(this._hierarchy,e,((e,i)=>e.classes[e.classIds[i]].name===t)))}isExactClass(e,t){return St("string"==typeof t,t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy)return this._hierarchy.classes[this._hierarchy.classIds[e]].name}hasProperty(e,t){return this._checkBatchId(e),St("string"==typeof t,t),uc(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),(t=uc(t)?t:[]).length=0;const i=Object.keys(this._properties);return t.push(...i),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),St("string"==typeof t,t),this._binaryProperties){const i=this._binaryProperties[t];if(uc(i))return this._getBinaryProperty(i,e)}const i=this._properties[t];if(uc(i))return dc(i[e]);if(this._hierarchy){const i=this._getHierarchyProperty(e,t);if(uc(i))return i}}setProperty(e,t,i){const s=this.featureCount;if(this._checkBatchId(e),St("string"==typeof t,t),this._binaryProperties){const s=this._binaryProperties[t];if(s)return void this._setBinaryProperty(s,e,i)}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,i))return;let r=this._properties[t];uc(r)||(this._properties[t]=new Array(s),r=this._properties[t]),r[e]=dc(i);}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,i){e.pack(i,e.typedArray,t);}_initializeBinaryProperties(){let e=null;for(const t in this._properties){const i=this._initializeBinaryProperty(t,this._properties[t]);i&&(e=e||{},e[t]=i);}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){const i=t;St(this.binary,`Property ${e} requires a batch table binary.`),St(i.type,`Property ${e} requires a type.`);const s=function(e,t,i,s){const{componentType:r}=e;St(e.componentType);const n="string"==typeof r?K_.fromName(r):r,o=Y_[e.type],a=Q_[e.type],l=$_[e.type];return {values:K_.createTypedArray(n,t,i+=e.byteOffset,o*s),type:n,size:o,unpacker:a,packer:l}}(i,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return {typedArray:s.values,componentCount:s.size,unpack:s.unpacker,pack:s.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return !1;const i=tc(this._hierarchy,e,((e,i)=>uc(e.classes[e.classIds[i]].instances[t])));return uc(i)}_getPropertyNamesInHierarchy(e,t){tc(this._hierarchy,e,((e,i)=>{const s=e.classes[e.classIds[i]].instances;for(const e in s)s.hasOwnProperty(e)&&-1===t.indexOf(e)&&t.push(e);}));}_getHierarchyProperty(e,t){return tc(this._hierarchy,e,((e,i)=>{const s=e.classIndexes[i],r=e.classes[e.classIds[i]].instances[t];return uc(r)?uc(r.typedArray)?this._getBinaryProperty(r,s):dc(r[s]):null}))}_setHierarchyProperty(e,t,i,s){const r=tc(this._hierarchy,t,((e,r)=>{const n=e.classIndexes[r],o=e.classes[e.classIds[r]].instances[i];return !!uc(o)&&(St(r===t,`Inherited property "${i}" is read-only.`),uc(o.typedArray)?this._setBinaryProperty(o,n,s):o[n]=dc(s),!0)}));return uc(r)}getFeature(e,t){const i=this.featuresLength;if(!uc(e)||e<0||e>=i)throw new Error(`batchId is required and between zero and featuresLength - 1 (${i-1}).`);return function(e,t){const i=t.featureCount;if(!uc(t._features)&&i>0){const s=new Array(i);for(let r=0;r<i;++r)s[r]=new cc(r,e,t);t._features=s;}}(t,this),this._features[e]}update(e,t){this._batchTexture.update(e,t);}destroy(){this._hierarchy=void 0,this.json=void 0,this.binary=void 0,this.featureCount=0,this._properties=void 0,this._extensions=void 0,this._binaryProperties=void 0,this._batchTexture.destroy();}}const fc=4;function gc(e,t,i=0){const s=new DataView(t);if(e.magic=s.getUint32(i,!0),e.version=s.getUint32(i+=fc,!0),e.byteLength=s.getUint32(i+=fc,!0),i+=fc,1!==e.version)throw new Error(`3D Tile Version ${e.version} not supported`);return i}const yc=4;function Cc(e,t,i){const s=new DataView(t);return e.header=e.header||{},e.header.featureTableJsonByteLength=s.getUint32(i,!0),e.header.featureTableBinaryByteLength=s.getUint32(i+=yc,!0),e.header.batchTableJsonByteLength=s.getUint32(i+=yc,!0),e.header.batchTableBinaryByteLength=s.getUint32(i+=yc,!0),i+yc}function Tc(e,t,i,s){return i=function(e,t,i,s){const{featureTableJsonByteLength:r,featureTableBinaryByteLength:n}=e.header;if(e.featureTableJson={BATCH_LENGTH:0},r>0){const s=H_(t,i,r);e.featureTableJson=JSON.parse(s);}return i+=r,e.featureTableBinary=new Uint8Array(t.slice(i,i+n)),i+n}(e,t,i),i=function(e,t,i,s){const{batchTableJsonByteLength:r,batchTableBinaryByteLength:n}=e.header;if(r>0){const s=H_(t,i,r);e.batchTableJson=JSON.parse(s),i+=r,n>0&&(e.batchTableBinary=new Uint8Array(t.slice(i,i+n)),e.batchTableBinary=new Uint8Array(e.batchTableBinary),i+=n);}return i}(e,t,i),i}function xc(e,t,i){if(!(t||e&&e.batchIds&&i))return null;const{isRGB565:s,pointCount:r}=e;if(s){const e=new Uint8ClampedArray(3*r);for(let i=0;i<r;i++){const s=J_(t[i]);e[3*i]=s[0],e[3*i+1]=s[1],e[3*i+2]=s[2];}return {type:W_.FLOAT,value:Float32Array.from(t),size:3,normalized:!0}}if(t&&t.length===3*r){const e=Float32Array.from(t).map((e=>e/255));return {type:W_.FLOAT,value:e,size:3,normalized:!0}}if(t&&t.length===4*r){const e=Float32Array.from(t).map((e=>e/255));return {type:W_.FLOAT,value:e,size:4,normalized:!0}}const n=new Float32Array(3*r);for(let e=0;e<r;e++)n[3*e]=0,n[3*e+1]=0,n[3*e+2]=0;return {type:W_.FLOAT,value:n,size:3,normalized:!0}}const bc=new e.Vector3;const vc={URI:0,EMBEDDED:1};function wc(t,i,s,r){t.rotateYtoZ=!0;const n=t.byteOffset+t.byteLength-s;if(0===n)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=r["3d-tiles"]&&r["3d-tiles"].assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=function(t,i,s){return function(t,i,s){let r;try{r=e.defined(s)&&s+i<=t.length?t.slice(i,i+s):t.slice(i);}catch(e){console.log(e);}finally{return r||(new Uint8Array).buffer}}(t,i,s)}(i,s,n),t.gltfByteOffset=0,t.gltfByteLength=n,s%4==0||console.warn(`${t.type}: embedded glb is not aligned to a 4-byte boundary.`),(t.byteOffset||0)+(t.byteLength||0)}async function Sc(e,t,i,s){const r=i["3d-tiles"]||{};if(function(e,t,i){switch(t){case vc.URI:const t=new Uint8Array(e.gltfArrayBuffer.slice(e.gltfByteOffset)),i=(new TextDecoder).decode(t);e.gltfUrl=i.replace(/[\s\0]+$/,""),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case vc.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}(e,t),r.loadGLTF){const{_parse:t,fetch:r}=s;e.gltfUrl&&(e.gltfArrayBuffer=await r(e.gltfUrl,i),e.gltfByteOffset=0),e.gltfArrayBuffer&&(e.instances&&(i.instances=e.instances),e.gltf=await t(e.gltfArrayBuffer,ma,i,s),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength);}}function Ac(t,i,s){return i=i||0,s||(s=new e.Vector3),s.x=t[i++],s.y=t[i++],s.z=t[i],s}function Ec(t,i,s,r){r||(r=new e.Matrix4);const n=s.x,o=s.y,a=s.z,l=i.x*i.x,h=i.x*i.y,_=i.x*i.z,c=i.x*i.w,u=i.y*i.y,d=i.y*i.z,m=i.y*i.w,p=i.z*i.z,f=i.z*i.w,g=i.w*i.w,y=2*(h-f),C=2*(_+m),T=2*(h+f),x=-l+u-p+g,b=2*(d-c),v=2*(_-m),w=2*(d+c),S=-l-u+p+g;return r[0]=(l-u-p+g)*n,r[1]=T*n,r[2]=v*n,r[3]=0,r[4]=y*o,r[5]=x*o,r[6]=w*o,r[7]=0,r[8]=C*a,r[9]=b*a,r[10]=S*a,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,r}async function Mc(t,i=0,s,r,n={}){switch(n.byteOffset=i,n.type=function(e,t=0){const i=new DataView(e);return `${String.fromCharCode(i.getUint8(t+0))}${String.fromCharCode(i.getUint8(t+1))}${String.fromCharCode(i.getUint8(t+2))}${String.fromCharCode(i.getUint8(t+3))}`}(t,i),n.type){case"cmpt":return await async function(e,t,i,s,r,n){i=gc(e,t,i);const o=new DataView(t);for(e.tilesLength=o.getUint32(i,!0),i+=4,e.tiles=[];e.tiles.length<e.tilesLength;){const o={};e.tiles.push(o),i=await n(t,i,s,r,o);}return i}(n,t,i,s,r,Mc);case"b3dm":return await async function(e,t,i,s,r){i=function(e,t,i,s,r){i=wc(e,t,i=Tc(e,t,i=Cc(e,t,i=gc(e,t,i))),s);const n=new Z_(e.featureTableJson,e.featureTableBinary);e.rtcCenter=n.getGlobalProperty("RTC_CENTER",W_.FLOAT,3),e.featureTable=n;const o=n.getGlobalProperty("BATCH_LENGTH");return e.batchTable=new pc(e.batchTableJson,e.batchTableBinary,o,r.url,s.nodeProperty),delete e.featureTableJson,delete e.featureTableBinary,delete e.batchTableJson,delete e.batchTableBinary,i}(e,t,i,s,r),await Sc(e,vc.EMBEDDED,s,r);const{extensions:n}=e.gltf||{};return n&&n.CESIUM_RTC&&(e.rtcCenter=n.CESIUM_RTC.center),i}(n,t,i,s,r);case"glTF":return await async function(e,t,i,s){if(e.rotateYtoZ=!0,e.gltfUpAxis=i?.["3d-tiles"]?.assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",i?.["3d-tiles"]?.loadGLTF){if(!s)return t.byteLength;const r=await async function(e,t,i,s){return s._parse(e,t,i,s)}(t,ma,i,s);e.gltf=na(r,i),e.gpuMemoryUsageInBytes=function(e){let{images:t,bufferViews:i}=e;t=t||[],i=i||[];const s=t.map((e=>e.bufferView));return i=i.filter((e=>!s.includes(e))),i.reduce(((e,t)=>e+t.byteLength),0)+Math.ceil(4*(e.imagesSize||0)*1.33)}(e.gltf);}else e.gltfArrayBuffer=t;for(let t=0;e.gltf.bufferViews&&t<e.gltf.bufferViews.length;t++)e.gltf.bufferViews[t].data=null,e.gltf.bufferViews[t].buffer=null;for(let t=0;e.gltf.images&&t<e.gltf.images.length;t++)e.gltf.images[t].bufferView=null,e.gltf.images[t].image=null;return t.byteLength}(n,t,s,r);case"i3dm":return await async function(t,i,s,r,n){return s=function(t,i,s,r,n){if(s=gc(t,i,s),1!==t.version)throw new Error(`Instanced 3D Model version ${t.version} is not supported`);s=Cc(t,i,s);const o=new DataView(i);if(t.gltfFormat=o.getUint32(s,!0),s=wc(t,i,s=Tc(t,i,s+=4),r),0===t.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const a=new Z_(t.featureTableJson,t.featureTableBinary),l=a.getGlobalProperty("INSTANCES_LENGTH");if(a.featuresLength=l,!Number.isFinite(l))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=a.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=a.getGlobalProperty("RTC_CENTER",W_.FLOAT,3);const h=new pc(t.batchTableJson,t.batchTableBinary,l,n.url);return h._url=n.url,function(t,i,s,r){const n=new Array(r),o=new e.Vector3,a=new e.Vector3,l=new e.Vector3,h=new e.Vector3,_=new e.Matrix3,c=new e.Quaternion,u=new e.Vector3,d={},m=new e.Matrix4,p=[],f=[],g=new e.Vector3,y=new e.Vector3;for(let s=0;s<r;s++){let r;if(i.hasProperty("POSITION"))r=i.getProperty("POSITION",W_.FLOAT,3,s,o);else if(i.hasProperty("POSITION_QUANTIZED")){r=i.getProperty("POSITION_QUANTIZED",W_.UNSIGNED_SHORT,3,s,o);const e=i.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",W_.FLOAT,3,g);if(!e)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const t=i.getGlobalProperty("QUANTIZED_VOLUME_SCALE",W_.FLOAT,3,y);if(!t)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const n=65535;for(let i=0;i<3;i++)r[i]=r[i]/n*t[i]+e[i];}if(!r)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(o.copy(r),d.translation=o,t.normalUp=i.getProperty("NORMAL_UP",W_.FLOAT,3,s,p),t.normalRight=i.getProperty("NORMAL_RIGHT",W_.FLOAT,3,s,f),t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");Ac(t.normalUp,0,l),Ac(t.normalRight,0,a),t.hasCustomOrientation=!0;}else {if(t.octNormalUp=i.getProperty("NORMAL_UP_OCT32P",W_.UNSIGNED_SHORT,2,p),t.octNormalRight=i.getProperty("NORMAL_RIGHT_OCT32P",W_.UNSIGNED_SHORT,2,f),t.octNormalUp){if(!t.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}t.eastNorthUp?(e.Ellipsoid.WGS84.eastNorthUpToFixedFrame(o,m),m.getRotationMatrix3(_)):_.identity();}t.hasCustomOrientation&&(h.copy(a).cross(l).normalize(),_.setColumn(0,a),_.setColumn(1,l),_.setColumn(2,h)),c.fromMatrix3(_),d.rotation=c,u.set(1,1,1);const C=i.getProperty("SCALE",W_.FLOAT,1,s);Number.isFinite(C)&&u.multiplyByScalar(C);const T=i.getProperty("SCALE_NON_UNIFORM",W_.FLOAT,3,s,p);T&&u.scale(T),d.scale=u;let x=i.getProperty("BATCH_ID",W_.UNSIGNED_SHORT,1,s);void 0===x&&(x=s);const b=Ec(d.translation,d.rotation,d.scale,new e.Matrix4).clone();n[s]={modelMatrix:b,batchId:x};}t.instances=n;}(t,a,0,l),t.featureTable=a,t.batchTable=h,delete t.featureTableJson,delete t.featureTableBinary,delete t.batchTableJson,delete t.batchTableBinary,s}(t,i,s,r,n),await Sc(t,t.gltfFormat,r,n),s}(n,t,i,s,r);case"pnts":return await async function(t,i,s,r,n){s=Tc(t,i,s=Cc(t,i,s=gc(t,i,s))),function(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1;}(t);const{featureTable:o,batchTable:a}=function(e,t){const i=new Z_(e.featureTableJson,e.featureTableBinary),s=i.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(s))throw new Error("POINTS_LENGTH must be defined");i.featuresLength=s,e.featuresLength=s,e.pointsLength=s,e.pointCount=s,e.rtcCenter=i.getGlobalProperty("RTC_CENTER",W_.FLOAT,3);const r=function(e,t,i){let s=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",W_.UNSIGNED_SHORT,1),e.batchIds)){const r=t.getGlobalProperty("BATCH_LENGTH");if(!r)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:n,batchTableBinary:o}=e;s=new pc(n,o,r,i.url);}return s}(e,i,t);return {featureTable:i,batchTable:r}}(t,n);return await async function(t,i,s,r,n){let o,a,l;const h=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];h&&(l=h.properties);const _=i.getExtension("3DTILES_draco_point_compression");if(_){a=_.properties;const e=_.byteOffset,i=_.byteLength;if(!a||!Number.isFinite(e)||!i)throw new Error("Draco properties, byteOffset, and byteLength must be defined");o=t.featureTableBinary.slice(e,e+i),t.hasPositions=Number.isFinite(a.POSITION),t.hasColors=Number.isFinite(a.RGB)||Number.isFinite(a.RGBA),t.hasNormals=Number.isFinite(a.NORMAL),t.hasBatchIds=Number.isFinite(a.BATCH_ID),t.isTranslucent=Number.isFinite(a.RGBA);}if(!o)return !0;const c={buffer:o,properties:{...a,...l},featureTableProperties:a,batchTableProperties:l,dequantizeInShader:!1},u=await async function(t,i,s,r){const{_parse:n}=r,o={...s,draco:{...s.draco,extraAttributes:i.batchTableProperties||{}}};delete o["3d-tiles"],delete o.context;const a=await n(i.buffer,qn,o),l=a.attributes.POSITION&&a.attributes.POSITION.value,h=a.attributes.COLOR_0&&a.attributes.COLOR_0.value,_=a.attributes.NORMAL&&a.attributes.NORMAL.value,c=a.attributes.BATCH_ID&&a.attributes.BATCH_ID.value,u=_&&a.attributes.NORMAL.value.quantization;if(l&&a.attributes.POSITION.value.quantization){const i=a.POSITION.data.quantization,s=i.range;t.quantizedVolumeScale=new e.Vector3(s,s,s),t.quantizedVolumeOffset=new e.Vector3(i.minValues),t.quantizedRange=(1<<i.quantizationBits)-1,t.isQuantizedDraco=!0;}u&&(t.octEncodedRange=(1<<a.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const d={};if(i.batchTableProperties)for(const e of Object.keys(i.batchTableProperties))a.attributes[e]&&a.attributes[e].value&&(d[e.toLowerCase()]=a.attributes[e].value);t.attributes={positions:{type:W_.FLOAT,value:l,size:3,normalized:!0},colors:xc(t,h),normals:_,batchIds:c,...d};}(t,c,r,n);return u}(t,o,0,r,n),function(t,i,s){if(!t.attributes.positions)if(i.hasProperty("POSITION"))t.attributes.positions={type:W_.FLOAT,value:i.getPropertyArray("POSITION",W_.FLOAT,3),size:3,normalized:!0};else if(i.hasProperty("POSITION_QUANTIZED")){const r=i.getPropertyArray("POSITION_QUANTIZED",W_.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65535,t.quantizedVolumeScale=i.getGlobalProperty("QUANTIZED_VOLUME_SCALE",W_.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=i.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",W_.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=function(t,i,s){return t.isQuantized?s["3d-tiles"]&&s["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,function(t,i){const s=new e.Vector3,r=new Float32Array(3*t.pointCount);for(let e=0;e<t.pointCount;e++)s.set(i[3*e],i[3*e+1],i[3*e+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(r,3*e);return r}(t,i)):{type:W_.UNSIGNED_SHORT,value:i,size:3,normalized:!0}:{type:W_.FLOAT,value:i,size:3,normalized:!0}}(t,r,s);}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}(t,o,r),function(e,t,i){if(!e.attributes.colors){let s=null;t.hasProperty("RGBA")?(s=t.getPropertyArray("RGBA",W_.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?s=t.getPropertyArray("RGB",W_.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(s=t.getPropertyArray("RGB565",W_.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=xc(e,s,i);}if(t.hasProperty("CONSTANT_RGBA")){const i=t.getGlobalProperty("CONSTANT_RGBA",W_.UNSIGNED_BYTE,4);e.constantRGBA=i.map((e=>e/255));}}(t,o,a),function(t,i){if(!t.attributes.normals){let s=null;i.hasProperty("NORMAL")?s=i.getPropertyArray("NORMAL",W_.FLOAT,3):i.hasProperty("NORMAL_OCT16P")&&(s=i.getPropertyArray("NORMAL_OCT16P",W_.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=function(t,i){if(!i)return null;if(t.isOctEncoded16P){const s=new Float32Array(3*t.pointsLength);for(let r=0;r<t.pointsLength;r++)e.octDecode(i[2*r],i[2*r+1],bc),bc.toArray(s,3*r);return {type:W_.FLOAT,size:2,value:s}}return {type:W_.FLOAT,size:2,value:i}}(t,s);}}(t,o),s}(n,t,i,s,r);default:throw new Error(`3DTileLoader: unknown type ${n.type}`)}}function Pc(e,t){return e&&e.content&&(e.contentUrl=`${t.basePath}/${e.content.uri||e.content.url}`),e.id=e.contentUrl,e.lodMetricType=o_,e.lodMetricValue=e.geometricError,e.transformMatrix=e.transform,e.type=function(e){if(!e.contentUrl)return "empty";const t=e.contentUrl.split(".").pop();switch(t){case"pnts":return "pointcloud";case"i3dm":case"b3dm":return "scenegraph";default:return t}}(e),e.refine=function(e){switch(e){case"REPLACE":case"replace":return 2;case"ADD":case"add":return 1;default:return e}}(e.refine),e}const Rc={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:U_,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:async function(e,t,i,s){const r=t["3d-tiles"]||{};let n;return n="auto"===r.isTileset?i.url&&-1!==i.url.indexOf(".json"):r.isTileset,e=n?await async function(e,t,i){const s=JSON.parse((new TextDecoder).decode(e));return s.loader=t.loader||Rc,s.url=i?.url||"",s.basePath=Ti(s.url),s.root=function(e){const t=e.basePath,i=Pc(e.root,e);e.gltfUpAxis=e?.asset?.gltfUpAxis||"Y";const s=[];for(s.push(i);s.length>0;){const e=s.pop().children||[];for(const i of e)Pc(i,{basePath:t}),s.push(i);}return i}(s),s.type=n_,s.shape="tileset3d",s.lodMetricType=o_,s.geometricError?s.lodMetricValue=s.geometricError:(s.geometricError=s.root.geometricError,s.lodMetricValue=s.root.lodMetricValue),s}(e,t,i):await async function(e,t,i){const s={content:{shape:"tile3d",featureIds:null}};return await Mc(e,0,t,i,s.content),s.content}(e,t,i),e},options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}},Bc="https://api.cesium.com/v1/assets",Ic={...Rc,id:"cesium-ion",name:"Cesium Ion",preload:async function(e,t={}){t=t["cesium-ion"]||{};const{accessToken:i}=t;let s=t.assetId;if(!Number.isFinite(s)){const t=e.match(/\/([0-9]+)\/tileset.json/);s=t&&t[1];}return async function(e,t){if(!t){const i=await async function(e){St(e);const t=Bc,i={Authorization:`Bearer ${e}`},s=await Ui(t,{headers:i,throws:!0});return await s.json()}(e);for(const e of i.items)"3DTILES"===e.type&&(t=e.id);}const i=await async function(e,t){St(e,t);const i={Authorization:`Bearer ${e}`},s=`${Bc}/${t}`;let r=await Ui(`${s}`,{headers:i,throws:!0}),n=await r.json();r=await Ui(`${s}/endpoint`,{headers:i,throws:!0});const o=await r.json();return n={...n,...o},n}(e,t),{type:s,url:r}=i;return St("3DTILES"===s&&r),i.headers={Authorization:`Bearer ${i.accessToken}`},i}(i,s)},parse:async(e,t,i,s)=>(t["3d-tiles"]=t["cesium-ion"],t.loader=Ic,Rc.parse(e,t,i)),options:{"cesium-ion":{...Rc.options["3d-tiles"],accessToken:null}}};class Dc{constructor(e,t,i){this.attributes=i,this.context=e,this.buffers={},this._parsePntsObject(t);}getBuffers(){return this.buffers}bind(){this.bindPerAttibuteBufferAndPointer();}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e);}enableAttributes(e,t){this.bindPerAttibuteBufferAndPointer(e,t);}setVertexAttribPointers(){}bindPerAttibuteBufferAndPointer(e,t){for(let i=0;i<this.attributes.length;i++){const s=this.attributes[i];this.context.bindVertexBuffer.set(this.buffers[s.name]);const r=t.attributes[s.name];void 0!==r&&(e.enableVertexAttribArray(r),e.vertexAttribPointer(r,s.components,s.type,!1,s.byteStride,s.offset)),this.context.bindVertexBuffer.set(null);}}_parsePntsObject(e){const t=this.context.gl;let i={};for(let s=0;s<this.attributes.length;s++){const r=this.attributes[s],n=r.bufferName,o=r.name;if(i[n])this.buffers[o]=i[n];else {const s=t.createBuffer();this.context.bindVertexBuffer.set(s),t.bufferData(t.ARRAY_BUFFER,e[n],t.STATIC_DRAW),i[n]=s,this.buffers[o]=s;}}i=null;}destroy(){const e=this.context.gl;for(const t in this.buffers)e.deleteBuffer(this.buffers[t]),delete this.buffers[t];this.context=null;}}const Oc={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class Lc{process(t){const{content:i,context:s,customizedColor:r,pointSize:n}=t;this.usesNormals=!1,this.isOctEncoded16P=i.isOctEncoded16P,this.isQuantized=i.isQuantized,this.isRGB565=i.isRGB565,this.isTranslucent=i.isTranslucent,this.isQuantizedDraco=i.isQuantizedDraco,this.isOctEncodedDraco=i.isOctEncodedDraco,this.usesCustomizedColor=!1,this.customizedColor=r;const o=i.attributes.positions.value,a=[];i.attributes.normals&&(this.usesNormals=!0),i.featureTableJson.POSITION?a.push({name:"a_POSITION",type:i.attributes.positions.type,components:3,offset:i.featureTableJson.POSITION.byteOffset,byteStride:3*e.WebGLSizes[i.attributes.positions.type],bufferName:"vertexBuf"}):i.featureTableJson.POSITION_QUANTIZED&&a.push({name:"a_POSITION",type:i.attributes.positions.type,components:3,offset:0,byteStride:3*e.WebGLSizes[i.attributes.positions.type],bufferName:"vertexBuf"});let l=null;i.attributes.colors&&(this.colorSize=i.attributes.colors.size,l=i.attributes.colors.value,a.push({name:"a_RGB",type:i.attributes.colors.type,components:i.attributes.colors.size,offset:0,byteStride:i.attributes.colors.size*e.WebGLSizes[i.attributes.colors.type],bufferName:"colorBuf"})),this.attributesForVertexShader="";const h=i.batchTableBinary;for(const t in i.batchTableJson){const s=i.batchTableJson[t];if(s.byteOffset){const i=`a_${t}`;this.attributesForVertexShader+=`attribute ${e.WebGLComponentToShaderVariableType[s.type]} ${i}; \n`,a.push({name:i,type:Oc[s.componentType],components:e.WebGLComponentCounts[s.type],offset:s.byteOffset,byteStride:(_=s.type,c=Oc[s.componentType]||5126,e.WebGLComponentCounts[_]*e.WebGLSizes[c]),bufferName:"propertyBuf"});}this.customizedColor&&t===this.customizedColor.property&&(this.usesCustomizedColor=!0);}var _,c;this.customizedColor&&!this.usesCustomizedColor&&console.warn(`Point cloud does not have property named ${this.customizedColor.property}`);const u=e.createLayoutPnts(a),d=new Dc(s,{propertyBuf:h,vertexBuf:o,colorBuf:l},u.members),m={segmentVector:e.SegmentVector.simpleSegment(0,0,i.pointCount,i.pointCount),layoutVertexBuffer:d,mode:e.WebGLConstants.POINTS,count:i.pointCount,u_PointSize:n};if(this.isQuantized){const t=i.featureTableJson.QUANTIZED_VOLUME_SCALE,s=i.featureTableJson.QUANTIZED_VOLUME_OFFSET;m.u_QuantizedOffset=new e.Vector3(s[0],s[1],s[2]),m.u_QuantizedVolumeScaleAndOctEncodedRange=new e.Vector4(t[0],t[1],t[2],255);}if(!i.attributes.colors)if(i.constantRGBA){const t=i.constantRGBA;m.u_ConstantColor=new e.Color(t[0],t[1],t[2],t[3]);}else m.u_ConstantColor=new e.Color(0,0,0,1);return m}genPropertyFunction(){}static genShaderScript(t,i){let s="precision highp float;\nprecision highp int;\nattribute vec3 a_POSITION; \nvarying vec4 v_color; \nuniform vec4 u_ConstantColor; \nuniform vec4 u_HighlightColor; \nuniform mat4 u_ModelMatrix; \nuniform bool u_InShadow;\nuniform mat4 u_ModelViewProjectionMatrix; \n";return s+="uniform float u_PointSize; \n",s+=t.attributesForVertexShader,(t.isQuantized||t.isQuantizedDraco||t.isOctEncodedDraco)&&(s+="uniform vec4 u_QuantizedVolumeScaleAndOctEncodedRange; \n",s+="uniform vec3 u_QuantizedOffset; \n"),t.colorSize&&(s+=3===t.colorSize?"attribute vec3 a_RGB; \n":"attribute vec4 a_RGB; \n"),s+="#include <fn_getExponentialInterpColor>\n",s+="void main() \n{ \n",t.isQuantized?(s+="    const float inv65535=1.0/65535.0;\n",s+="    vec3 position = a_POSITION * u_QuantizedVolumeScaleAndOctEncodedRange.xyz / 65535.0  + u_QuantizedOffset;\n",s+="    vec3 posOri = a_POSITION * u_QuantizedVolumeScaleAndOctEncodedRange.xyz / 65535.0 + u_QuantizedOffset;\n"):(s+="    vec3 position = a_POSITION; \n",s+="    vec3 posOri = a_POSITION; \n"),s+="    vec3 position_absolute = vec3(u_ModelMatrix * vec4(position, 1.0)); \n",s+="    vec3 normal = vec3(1.0); \n",s+="    gl_PointSize = u_PointSize; \n",t.customizedColor?(s+=e.genColorBarScript(t.customizedColor,!0),s+="    v_color = color; \n"):s+=t.colorSize?3===t.colorSize?"    v_color = vec4(a_RGB, 1.0); \n":"    v_color = a_RGB; \n":"    v_color = u_ConstantColor; \n",i&&(s+=i),s+="    const float EPS=12.0;\n",s+="    if(u_InShadow==true){gl_Position=u_ModelViewProjectionMatrix*vec4(posOri,1.0);}\n",s+="    else {gl_Position=u_ModelViewProjectionMatrix*vec4(position,1.0);}\n",s+="} \n",{vs:s,fs:"varying vec4 v_color;\n\nvoid main() {\n    gl_FragColor = v_color;\n}"}}}class Vc extends e.Material{constructor(t){super(t),this._color=t.u_ConstantColor||new e.Color(0,0,0),this.u_PointSize=t.u_PointSize||1,this.u_QuantizedOffset=t.u_QuantizedOffset,this.u_QuantizedVolumeScaleAndOctEncodedRange=t.u_QuantizedVolumeScaleAndOctEncodedRange,this.updateRenderState(),this.createUniforms(),this.buildDefines();}update(e,t,i={}){super.update(e,t,i),this.updateRenderState();}updateRenderState(){this.renderState={depthTest:{enabled:!0,func:e.WebGLConstants.LESS},blending:{enabled:!0,color:{red:0,green:0,blue:0,alpha:0},equationRgb:e.WebGLConstants.FUNC_ADD,equationAlpha:e.WebGLConstants.FUNC_ADD,functionSourceRgb:e.WebGLConstants.SRC_ALPHA,functionSourceAlpha:e.WebGLConstants.ONE,functionDestinationRgb:e.WebGLConstants.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:e.WebGLConstants.ONE_MINUS_SRC_ALPHA}};}createUniforms(){e.defined(this._color)&&(this._uniforms.set("u_ConstantColor",(()=>{let t=!1;return (this._color.r>1||this._color.g>1||this._color.b>1)&&(t=!0),e.Vector4.fromColor(this._color,t)})),this._uniforms.set("u_HighlightColor",(()=>{let t=!1;return (this._color.r>1||this._color.g>1||this._color.b>1)&&(t=!0),e.Vector4.fromColor(this._color,t)})),this._uniforms.set("u_PointSize",(()=>this.u_PointSize)),this._uniforms.set("u_QuantizedVolumeScaleAndOctEncodedRange",(()=>this.u_QuantizedVolumeScaleAndOctEncodedRange)),this._uniforms.set("u_QuantizedOffset",(()=>this.u_QuantizedOffset)));}buildDefines(){const t={USE_RGBA_COLOR:e.defined(this._color)};this.defines=t;}destroy(){}}class Nc{constructor(t){const{tileID:i,boundingVolume:s,customizedColor:r,pointSize:n}=t;this.tileID=i,this.uid=e.uniqueId(),this.uses=0,this.boundingVolume=s,this.state="loading",this.content={},this.tileType="tiles",this.customizedColor=r,this.pointSize=n;}loadVectorData(e){this.content=e,this.state="data-down-finished";}unloadVectorData(){for(let e=0;e<this.primitives.length;e++)this.primitives[e].destroy();this.state="unloaded",this.primitives=[],this.content=void 0,this.state="unloaded",this.boundingVolume=null;}upload(t,i,s){this.source=s;const r=new Lc,n=r.process({content:t,context:i,customizedColor:this.customizedColor,pointSize:this.pointSize}),o=Lc.genShaderScript(r);this.primitives=[new e.Primitive({modelMatrix:t.cartesianModelMatrix,geometry:e.Geometry.fromPointCloudData(n),material:new Vc({type:"geometry-point-cloud-pnts",vertexSource:e.reduceComma(o.vs),fragmentSource:e.reduceComma(o.fs),...n})})];}fire(e){this.source.fire(e);}destroy(){this.unloadVectorData();}}class Fc{constructor(t){let i;this._url=e.defaultValue(t.url,void 0),this._urls=e.defaultValue(t.urls,[]);try{if(i=this._getSourceUrls(this._urls,this._url),!i.length)throw new Error("urls 和 url 参数至少配置一个")}catch(e){throw new Error("urls 或 url参数不规范，请检查")}const{translation:s}=t;if(e.defined(s)&&!(s instanceof e.Vector3)&&!Array.isArray(s))throw new Error("options.translation is unKnown type!");if(this.translation=e.defaultValue(new e.Vector3(s),void 0),e.defined(t.clippingPlanes)&&!(t.clippingPlanes instanceof e.ClippingPlaneCollection))throw new Error("options.clippingPlanes is unKnown type!");if(this._clippingPlanes=e.defaultValue(t.clippingPlanes,void 0),this._maximumScreenSpaceError=e.defaultValue(t.maximumScreenSpaceError,16),this._maximumMemoryUsage=e.defaultValue(t.maximumMemoryUsage,64),this._subIPs=e.defaultValue(t.subIPs,void 0),this._loadSiblings=e.defaultValue(t.loadSiblings,!1),this.skipLevelOfDetail=e.defaultValue(t.skipLevelOfDetail,!1),this.baseScreenSpaceError=e.defaultValue(t.baseScreenSpaceError,1024),this.skipLevels=e.defaultValue(t.skipLevels,1),this.skipScreenSpaceErrorFactor=e.defaultValue(t.skipScreenSpaceErrorFactor,16),this.immediatelyLoadDesiredLevelOfDetail=e.defaultValue(t.immediatelyLoadDesiredLevelOfDetail,!1),this.useMipmap=e.defaultValue(t.useMipmap,!1),this.pointSize=e.defaultValue(t.pointSize,1),this._allowPick=e.defaultValue(t.allowPick,!0),this.customizedColor=e.defaultValue(t.customizedColor,void 0),this._lightingModel=e.defaultValue(t.lightingModel,e.LightingModelType.NONE),this.classificationType=t.classificationType,e.defined(t.sourceLoaded)&&!(t.sourceLoaded instanceof Function))throw new Error("options.sourceLoaded is not a function!");this.sourceLoadedCallback=e.defaultValue(t.sourceLoaded,void 0),this._geoBoundsOptions=e.defaultValue(t.geoBoundsOptions,{index:0,combine:!1}),this.id=t.id,this._show=e.defaultValue(t.show,!0),this.map=t.map,this._ready=!1,this._selectedTiles=[],this._opaqueList=[],this._translucentList=[],this._cacheTile=new k,this._debugFreezeFrame=e.defaultValue(t.debugFreezeFrame,!1),this._activeCamera=new a,this.backCulling=e.defaultValue(t.backCulling,void 0),this.loadTileset(i),this.visibility="visible",this.minzoom=e.defaultValue(t.minzoom,0),this.maxzoom=t.maxzoom,this.opacity=e.defaultValue(t.opacity,1);}get clippingPlanes(){return this._clippingPlanes}set clippingPlanes(t){this._clippingPlanes=t instanceof e.ClippingPlaneCollection?t:void 0;}get debugFreezeFrame(){return this._debugFreezeFrame}set debugFreezeFrame(t){e.isBoolean(t)&&null!=this.tileset3d&&(this._debugFreezeFrame=t,this.tileset3d.traverseCounter=0);}get lightingModel(){return this._lightingModel}set lightingModel(t){Object.values(e.LightingModelType).includes(t)?this._lightingModel=t:console.warn(`不支持该值的光照模型: ${t}`);}get show(){return this._show}set show(t){e.isBoolean(t)&&(this._show=t,this._opaqueList=[],this._translucentList=[],this.map.needRepaint=!0);}get allowPick(){return this._allowPick}set allowPick(e){this._allowPick=e;let t=[];t=t.concat(this._translucentList,this._opaqueList);for(let i=0;i<t.length;i++)t[i].allowPick=e;}getBounds(){let t;if(this._geoBounds.length>0){const i=this._geoBoundsOptions.index,s=this._geoBoundsOptions.combine;if(e.defined(i))t=e.defined(this._geoBounds[i])?this._geoBounds[i]:this._geoBounds[0];else if(s){t=new e.LngLatBounds(this._geoBounds[0].sw,this._geoBounds[0].ne);for(let e=this._geoBounds.length-1;e>0;e--)t.extend(this._geoBounds[e]);}}return t}buildGltfTile(t){const i=t.type;if("cmpt"===i){const i=new e.GltfTile({tileID:t.id,boundingVolume:t.boundingVolume,minemap3DType:t.type,instances:t.instances||[],normalRight:t.normalRight||[],normalUp:t.normalUp||[],relativeCenter:t.relativeCenter||[],clippingPlaneCollection:this._clippingPlaneCollection});this._cacheTile.set(t.id,i);const s=t.content.tiles;for(let r=0;r<s.length;r++){const n=s[r],o=new e.GltfTile({tileID:t.id+r,boundingVolume:t.boundingVolume,minemap3DType:n.type,instances:n.instances||[],normalRight:n.normalRight||[],normalUp:n.normalUp||[],relativeCenter:t.relativeCenter||[],clippingPlaneCollection:this._clippingPlaneCollection});e.defined(n.cartesianModelMatrix)||(n.cartesianModelMatrix=t.content.cartesianModelMatrix),e.defined(n.content)?n.content.extra={featureTable:n.featureTable,batchTable:n.batchTable,selectionDepth:n._selectionDepth,depth:t.depth,finalResolution:t._finalResolution,markAsRoot:t.userData.markAsRoot}:n.extra={featureTable:n.featureTable,batchTable:n.batchTable,selectionDepth:n._selectionDepth,depth:t.depth,finalResolution:t._finalResolution,markAsRoot:t.userData.markAsRoot},o.upload(n,this.map.painter.context,{type:"3d-tiles"}),this._selectedTiles.push(o),i.childTiles.push(o);}}else {let s;s="pointcloud"===i||"pnts"===t.content.type?new Nc({tileID:t.id,boundingVolume:t.boundingVolume,minemap3DType:t.content.type,instances:t.instances||[],normalRight:t.normalRight||[],normalUp:t.normalUp||[],relativeCenter:t.relativeCenter||[],clippingPlaneCollection:this._clippingPlaneCollection,customizedColor:this.customizedColor,pointSize:this.pointSize}):new e.GltfTile({tileID:t.id,boundingVolume:t.boundingVolume,minemap3DType:t.content.type,instances:t.instances||[],normalRight:t.normalRight||[],normalUp:t.normalUp||[],relativeCenter:t.relativeCenter||[],clippingPlaneCollection:this._clippingPlaneCollection,customizedColor:this.customizedColor}),this._cacheTile.set(t.id,s),e.defined(t.content)&&(t.content.extra={featureTable:t.content.featureTable,batchTable:t.content.batchTable,selectionDepth:t._selectionDepth,depth:t.depth,finalResolution:t._finalResolution,markAsRoot:t.userData.markAsRoot}),s.upload(t.content,this.map.painter.context,{type:"3d-tiles"}),this._selectedTiles.push(s);}}_removeTile(t){const i=this._cacheTile._hash[t];i&&(e.defined(i.childTiles)&&i.childTiles.length>0&&i.childTiles.forEach((e=>{e.unloadVectorData();})),i.unloadVectorData(),this._cacheTile.remove(t));}_unloadTiles(e){this._removeTile(e.id);}async loadTileset(t){const i=[];for(let e=0;e<t.length;e++)i.push(await cs(lt(t[e].url),Rc,{transformRequest:this.map._transformRequest,json:!0,dispatcher:this.map.style.dispatcher,lightingModel:this.lightingModel}));if(0==i.length)throw new Error("Error getting tileset data");{const t=this._unionBoundingVolume(i);this.translation&&this._shiftBoundingVolume(t,this.translation),this.tileset3d=new k_(t,{onTileLoad:()=>{this.map.repaint||(this.update(),this.map.needRepaint=!0);},onTileUnload:e=>{this._unloadTiles(e);},subIPs:this._subIPs,maximumScreenSpaceError:this._maximumScreenSpaceError,throttleRequests:!0,maximumMemoryUsage:this._maximumMemoryUsage,loadSiblings:this._loadSiblings,skipLevelOfDetail:this.skipLevelOfDetail,baseScreenSpaceError:this.baseScreenSpaceError,skipLevels:this.skipLevels,skipScreenSpaceErrorFactor:this.skipScreenSpaceErrorFactor,immediatelyLoadDesiredLevelOfDetail:this.immediatelyLoadDesiredLevelOfDetail,context:this.map.painter.context,useMipmap:this.useMipmap,maxRequests:e.defined(this.subIPs)&&e.defined(this.subIPs.length)?6*this.subIPs.length:6,modelMatrix:e.Matrix4.IDENTITY,transformRequest:this.map._transformRequest,allowPick:this.allowPick,parent:this,dispatcher:this.map.style.dispatcher}),this.tileset3d.root.boundingVolume=t.root.boundingVolume.sphere,this._geoCenters=t.tileCenters,this._geoBounds=t.tileBounds,this._ready=!0,e.defined(this.sourceLoadedCallback)&&this.sourceLoadedCallback(this),this.map.repaint||(this.update(),this.map.needRepaint=!0);}}_getSourceUrls(e,t){const i=e.filter((e=>e.url));return t&&!i.find((e=>e.url===t))&&i.push({url:t}),i}_shiftBoundingVolume(t,i){const s=new e.Vector3(e.defined(t.tileCenters[0])?t.tileCenters[0]:t.boundingVolume.sphere.center);s.z=0;const r=e.Ellipsoid.WGS84.cartographicToCartesian(s,new e.Vector3),n=e.Transforms.eastNorthUpToFixedFrame(r);let o=e.Matrix4.multiplyByVector(n,new e.Vector4(i.x,i.y,i.z,1),new e.Vector4);o=new e.Vector3(o[0],o[1],o[2]);const a=o.subVectors(o,r),l=e.Matrix4.fromRotationTranslation(e.Matrix3.IDENTITY,a,new e.Matrix4);t.root.transform=l,t.root.transformMatrix=l;const h=new e.Vector4(t.root.boundingVolume.sphere.center);h.w=1,e.Matrix4.multiplyByVector(l,h,h),t.root.boundingVolume.sphere.center=new e.Vector3(h[0],h[1],h[2]);}_unionBoundingVolume(t){const i={asset:{version:"0.0",tilesetVersion:"minemap-top-merge",gltfUpAxis:t[0].gltfUpAxis||"Y"},geometricError:1/0,root:{children:[],transform:[],boundingVolume:{sphere:null},geometricError:1/0,refine:"REPLACE"},tileCenters:[],tileBounds:[]};let s,r=0;for(let n=0;n<t.length;n++){r=Math.max(r,t[n].geometricError);const o=new e.Matrix4(t[n].root.transform);let a,l,h=__(t[n].root.boundingVolume,o);if(h instanceof e.TileBoundingRegion)h=h.boundingVolume,a=h.getBoundingSphere();else if(h instanceof e.BoundingSphere){a=h;const t=h.getBoundingMaximum(),i=e.Transforms.cartesian3ToCartographic(t.boundingMaxValue),s=e.Transforms.cartesian3ToCartographic(t.boundingMinValue);l=new e.LngLatBounds([s[0],s[1]],[i[0],i[1]]);}else h instanceof e.OrientedBoundingBox&&(a=h.getBoundingSphere());if(s=0===n?new e.BoundingSphere(a.center,a.radius):s.union(a),!e.defined(l)){const t=e.Rectangle.fromCartesianArray(h.computeCorners()),i=e.CONSTS.CesiumMath.toDegrees(t.west),s=e.CONSTS.CesiumMath.toDegrees(t.south),r=e.CONSTS.CesiumMath.toDegrees(t.east),n=e.CONSTS.CesiumMath.toDegrees(t.north);l=new e.LngLatBounds([i,s],[r,n]);}i.tileBounds.push(l),i.tileCenters.push(e.Transforms.DefaultEllipsoid.cartesianToCartographic(a.center)),i.root.children.push(t[n].root);}return i.root.geometricError=r,i.root.boundingVolume.sphere=s,i.root.id=void 0,i.root.lodMetricType=t[0].root.lodMetricType,i.root.lodMetricValue=r,i.root.refine=void 0,i.root.transform=new e.Matrix4,i.root.transformMatrix=new e.Matrix4,i.root.type=t[0].root.type,i.geometricError=r,i.basePath=t[0].basePath,i.loader=t[0].loader,i.lodMetricType=t[0].lodMetricType,i.lodMetricValue=r,i.type=t[0].type,i.url=t[0].url,i}_calcActiveCamera(){const e=this.map.transform;return this._activeCamera.updatePerspectiveOptions({fov:e.fov,aspect:e.width/e.height,near:.1,far:Math.max(e.far,1e4)}),this._activeCamera.setMatrix(e.activeCamera.matrixWorld.clone()),this._activeCamera}update(){if(!this._ready||!this._show)return;const t=this._calcActiveCamera();if(this.tileset3d.update(t.frustumCrate,{width:this.map.transform.width,height:this.map.transform.height}),e.isHiddenByMapZoom(this,this.map.getZoom())&&(this.tileset3d.selectedTiles=[]),this._selectedTiles=[],this.tileset3d.selectedTiles.length>0){let e;const t=this.tileset3d.selectedTiles.filter((e=>e._finalResolution)),i=this.tileset3d.selectedTiles.filter((e=>!e._finalResolution)),s=t.concat(i);for(let t=0;t<s.length;++t){e=s[t];const i=this._cacheTile.get(e.id);if(i)if(i.childTiles?.length>0){const t=e;i.childTiles.forEach((e=>{e.extra.selectionDepth=t._selectionDepth,e.extra.depth=t.depth,e.extra.finalResolution=t._finalResolution,i.extra?i.extra.markAsRoot=t.userData.markAsRoot:e.extra.markAsRoot=t.userData.markAsRoot,this._selectedTiles.push(e);}));}else i.extra&&(i.extra.selectionDepth=e._selectionDepth,i.extra.depth=e.depth,i.extra.finalResolution=e._finalResolution,i.extra.markAsRoot=e.userData.markAsRoot),this._selectedTiles.push(i);else this.buildGltfTile(e);}}this._opaqueList=[],this._translucentList=[];const i=this;this._selectedTiles.forEach((e=>{e.primitives.forEach((t=>{t._material&&t._geometry&&(t._material.clippingPlanes=i.clippingPlanes,t._material.backCulling=this.backCulling,t._material._opacity=this.opacity,t._material.isTranslucent?(t.boundingVolume=e.boundingVolume,t.tileUid=e.uid,i._translucentList.push(t)):i._opaqueList.push(t),Gc(t,this));}));}));}loaded(){return !!this.tileset3d&&this.tileset3d&&0===this.tileset3d.stats.get("Tiles Loading").count}destroy(){return this._selectedTiles.forEach((e=>{e.destroy();})),this._selectedTiles=null,this._opaqueList=null,this._translucentList=null,e.defined(this.tileset3d)&&this.tileset3d.destroy(),this.tileset3d=null,e.destroyObject(this)}}function Gc(t,i){i.lightingModel===e.LightingModelType.PBR?(t._material.defines.USE_PBR=!0,t._material.defines.USE_IBL=!0):(t._material.defines.USE_PBR=!1,t._material.defines.USE_IBL=!1),t._material.defines.PHONG_LIGHT=i.lightingModel==e.LightingModelType.PHONG;}class kc extends e.Evented{constructor(e,t,i){super(),this.id=e,this.dispatcher=i,this._firstLoadingTilesFlag=!0,this.on("data",(e=>{"cesium-tile"===e.dataType&&this.map&&this.update();})),this.on("error",(()=>{this._sourceErrored=!0;}));const s=ml(e,t,i,this);this._source=s,this._tiles={},this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this.idealTileIDs=[],this._glTFTiles=[],this._preCesiumTiles=[],this._cacheTile=new k,this._geoCenters=[],this._geoBounds=[],this.lastFrameHasMixedContent=void 0,this.sourceOptions=t,this._activeCamera=new a;}_verifiableSourceUrls(e,t){const i=[];if(t&&i.push({url:t}),e&&e.length)for(let s=0;s<e.length;s++){const r=e[s];t!==r.url&&r.url&&i.push(r);}return i.length?i:{msg:"urls 和 url 参数至少配置一个"}}async loadTileset(t){const{url:i,urls:s,maximumScreenSpaceError:r,maximumMemoryUsage:n,loadSiblings:o,skipLevelOfDetail:a,baseScreenSpaceError:l,skipLevels:h,skipScreenSpaceErrorFactor:_,immediatelyLoadDesiredLevelOfDetail:c,sourceLoaded:u,viewFrustum:d,subIPs:m,useMipmap:p,clippingPlanes:f,allowPick:g,translation:y}=this.sourceOptions,C=[],T=this._verifiableSourceUrls(s,i);if(!(T instanceof Array))throw new Error(T.msg);for(let e=0;e<T.length;e++)C.push(await cs(lt(T[e].url),Rc,{transformRequest:this.map._transformRequest,json:!0,dispatcher:this.map.style.dispatcher}));if(0==C.length)throw new Error("Error getting tileset data");{const i=this._unionBoundingVolume(C);y&&this._shiftBoundingVolume(i,y),this.tileset3d=new k_(i,{onTileLoad:()=>{this.update();},onTileUnload:e=>{this._unloadTiles(e);},subIPs:m,maximumScreenSpaceError:r||16,throttleRequests:!0,maximumMemoryUsage:n||64,loadSiblings:o||!1,skipLevelOfDetail:a||!1,baseScreenSpaceError:l||1024,skipLevels:h||1,skipScreenSpaceErrorFactor:_||16,immediatelyLoadDesiredLevelOfDetail:c||!1,context:this.map.painter.context,useMipmap:p||!1,maxRequests:m?.length?6*m.length:6,modelMatrix:e.Matrix4.IDENTITY,transformRequest:this.map._transformRequest,clippingPlanes:f,allowPick:g,nodeProperty:{sourceId:t,sourceOptions:this.sourceOptions},dispatcher:this.dispatcher}),this.tileset3d.root.boundingVolume=i.root.boundingVolume.sphere,this._geoCenters=i.tileCenters,this._geoBounds=i.tileBounds,this.sourceLoadedCallback=u,this.sourceLoadedCallback&&this.sourceLoadedCallback(this),this._viewFrustum=d||null,this.update(),this.map.needRepaint=!0;}}_setViewFrustum(e){this._viewFrustum=e;}update(){if(this._paused||!this.used)return;const e=this._calcActiveCamera();this.tileset3d&&e.frustumCrate&&(this.tileset3d.update(e.frustumCrate,{width:this.map.transform.width,height:this.map.transform.height}),this.traversalTileRootToFindTopMergeTile());}_calcActiveCamera(){const e=this.map.transform;return this._activeCamera.updatePerspectiveOptions({fov:e.fov,aspect:e.width/e.height,near:.1,far:e.far}),this._activeCamera.setMatrix(e.activeCamera.matrixWorld.clone()),this._activeCamera}_unloadTiles(e){this._removeTile(e.id);}prepare(e){this._source.prepare&&this._source.prepare(),this._context||(this._context=e);}get tilesForRender(){if(this._glTFTiles=[],this?.tileset3d?.selectedTiles){let e;const t=this.tileset3d.selectedTiles.filter((e=>e._finalResolution)),i=this.tileset3d.selectedTiles.filter((e=>!e._finalResolution)),s=t.concat(i);for(let t=0;t<s.length;++t){e=s[t];const i=this._cacheTile.get(e.id);i?i.childTiles?.length>0?i.childTiles.forEach((t=>{t.extra.selectionDepth=e._selectionDepth,t.extra.depth=e.depth,t.extra.finalResolution=e._finalResolution,i.extra?i.extra.markAsRoot=e.userData.markAsRoot:t.extra.markAsRoot=e.userData.markAsRoot,this._glTFTiles.push(t);})):(i.extra&&(i.extra.selectionDepth=e._selectionDepth,i.extra.depth=e.depth,i.extra.finalResolution=e._finalResolution,i.extra.markAsRoot=e.userData.markAsRoot),this._glTFTiles.push(i)):this.buildCesiumGltfTile(e);}}return this.tileset3d&&0!=this.tileset3d.stats.get("Tiles Loading").count&&(this.lastFrameHasMixedContent=this.tileset3d._hasMixedContent,this.fire(new e.Event("data",{dataType:"cesium-tile"}))),null!=this.lastFrameHasMixedContent&&this.tileset3d._hasMixedContent&&!this.lastFrameHasMixedContent&&this.fire(new e.Event("data",{dataType:"cesium-tile"})),this._glTFTiles}traversalTileRootToFindTopMergeTile(){this.tileset3d&&this.tileset3d.skipLevelOfDetail&&Hc(this.tileset3d.root.children,0);}tilesIn(){return this._glTFTiles}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._source&&(this._source.onAdd(e),this.loadTileset(this.id));}buildCesiumGltfTile(t){const i=t.type;if("cmpt"===i){const i=new e.GltfTile({tileID:t.id,modelFolder:this._source.modelFolder,boundingVolume:t.boundingVolume,minemap3DType:t.type,instances:t.instances||[],normalRight:t.normalRight||[],normalUp:t.normalUp||[],relativeCenter:t.relativeCenter||[],clippingPlaneCollection:this._clippingPlaneCollection});this._cacheTile.set(t.id,i);const s=t.content.tiles;for(let r=0;r<s.length;r++){const n=s[r],o=new e.GltfTile({tileID:t.id+r,modelFolder:this._source.modelFolder,boundingVolume:t.boundingVolume,minemap3DType:n.type,instances:n.instances||[],normalRight:n.normalRight||[],normalUp:n.normalUp||[],relativeCenter:t.relativeCenter||[],clippingPlaneCollection:this._clippingPlaneCollection});void 0===n.cartesianModelMatrix&&(n.cartesianModelMatrix=t.content.cartesianModelMatrix),n?.content?n.content.extra={featureTable:n.featureTable,batchTable:n.batchTable,selectionDepth:n._selectionDepth,depth:t.depth,finalResolution:t._finalResolution,markAsRoot:t.userData.markAsRoot}:n.extra={featureTable:n.featureTable,batchTable:n.batchTable,selectionDepth:n._selectionDepth,depth:t.depth,finalResolution:t._finalResolution,markAsRoot:t.userData.markAsRoot},o.upload(n,this._context,this._source),this._glTFTiles.push(o),i.childTiles.push(o);}}else {let s;s="pointcloud"===i||"pnts"===t.content.type?new Nc({tileID:t.id,modelFolder:this._source.modelFolder,boundingVolume:t.boundingVolume,minemap3DType:t.content.type,instances:t.instances||[],normalRight:t.normalRight||[],normalUp:t.normalUp||[],relativeCenter:t.relativeCenter||[],clippingPlaneCollection:this._clippingPlaneCollection,customizedColor:this.customizedColor}):new e.GltfTile({tileID:t.id,modelFolder:this._source.modelFolder,boundingVolume:t.boundingVolume,minemap3DType:t.content.type,instances:t.instances||[],normalRight:t.normalRight||[],normalUp:t.normalUp||[],relativeCenter:t.relativeCenter||[],clippingPlaneCollection:this._clippingPlaneCollection,customizedColor:this.customizedColor}),this._cacheTile.set(t.id,s),t?.content&&(t.content.extra={featureTable:t.content.featureTable,batchTable:t.content.batchTable,selectionDepth:t._selectionDepth,depth:t.depth,finalResolution:t._finalResolution,markAsRoot:t.userData.markAsRoot}),s.upload(t.content,this._context,this._source),this._glTFTiles.push(s);}}onRemove(e){this._source&&this._source.onRemove&&this._source.onRemove(e);}loaded(){return !!this.tileset3d&&this.tileset3d&&0===this.tileset3d.stats.get("Tiles Loading").count}getSource(){return this._source}pause(){this._paused=!0;}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.map&&this.update();}serialize(){return this._source.serialize()}reload(){}updateCacheSize(e){}hasTransition(){return !1}setFeatureState(e,t,i){}getFeatureState(e,t){}clearTiles(){if(this._shouldReloadOnResume=!1,this._paused=!1,this.tileset3d){this.tileset3d._destroyed=!0;for(const e in this._cacheTile._hash)this._removeTile(e);this.tileset3d._abortListMap.forEach(((e,t)=>{e.abort(),this.tileset3d._abortListMap.delete(t);}));}}_removeTile(e){const t=this._cacheTile._hash[e];t&&(t.childTiles&&t.childTiles.length>0&&t.childTiles.forEach((e=>{e.unloadVectorData();})),t.unloadVectorData(),this._cacheTile.remove(e));}getTilesSourceConfig(t,i="name"){if(this._geoCenters.length){const{urls:s=[],url:r}=this._source._options,n=this.map.transform;r&&(s.filter((e=>e.url===r)).length||s.push({name:"custom-tiles",url:r}));const o=s.map(((t,i)=>{let s=e.getZoomFromDistance(n._fov,this._geoCenters[i][2]+e.CONSTS.TRANSFORM.R+1e3,e.CONSTS.TRANSFORM.R);return s=isNaN(s)?n._maxZoom-1:s,{center:this._geoCenters[i],bounds:this._geoBounds.length?this._geoBounds[i]:null,zoom:s,...t}}));return t&&"string"==typeof t?o.filter((e=>e[i]===t)):o}}_unionBoundingVolume(t){const i={asset:{version:"0.0",tilesetVersion:"minemap-top-merge",gltfUpAxis:t[0].gltfUpAxis||"Y"},geometricError:1/0,root:{children:[],transform:[],boundingVolume:{sphere:null},geometricError:1/0,refine:"REPLACE"},tileCenters:[],tileBounds:[]};let s,r=0;for(let n=0;n<t.length;n++){r=Math.max(r,t[n].geometricError);const o=new e.Matrix4(t[n].root.transform);let a,l,h=__(t[n].root.boundingVolume,o);if(h instanceof e.TileBoundingRegion)h=h.boundingVolume,a=h.getBoundingSphere();else if(h instanceof e.BoundingSphere){a=h;const t=h.getBoundingMaximum(),i=e.Transforms.cartesian3ToCartographic(t.boundingMaxValue),s=e.Transforms.cartesian3ToCartographic(t.boundingMinValue);l=new e.LngLatBounds([s[0],s[1]],[i[0],i[1]]);}else h instanceof e.OrientedBoundingBox&&(a=h.getBoundingSphere());if(0===n?s=new e.BoundingSphere(a.center,a.radius):s.union(a),!e.defined(l)){const t=e.Rectangle.fromCartesianArray(h.computeCorners()),i=e.CONSTS.CesiumMath.toDegrees(t.west),s=e.CONSTS.CesiumMath.toDegrees(t.south),r=e.CONSTS.CesiumMath.toDegrees(t.east),n=e.CONSTS.CesiumMath.toDegrees(t.north);l=new e.LngLatBounds([i,s],[r,n]);}i.tileBounds.push(l),i.tileCenters.push(e.Transforms.DefaultEllipsoid.cartesianToCartographic(a.center)),i.root.children.push(t[n].root);}return i.root.geometricError=r,i.root.boundingVolume.sphere=s,i.root.id=void 0,i.root.lodMetricType=t[0].root.lodMetricType,i.root.lodMetricValue=r,i.root.refine=void 0,i.root.transform=new e.Matrix4,i.root.transformMatrix=new e.Matrix4,i.root.type=t[0].root.type,i.geometricError=r,i.basePath=t[0].basePath,i.loader=t[0].loader,i.lodMetricType=t[0].lodMetricType,i.lodMetricValue=r,i.type=t[0].type,i.url=t[0].url,i}getTranslucentPrimitives(t,i,s){const r=[];if(!(i=i||e.checkIsDepthSupportDataType)(s.classificationType))return r;const n=this.clippingPlanes;return this.tilesForRender.forEach((e=>{e.primitives.forEach((t=>{t._material.isTranslucent&&(t.boundingVolume=e.boundingVolume,t.tileUid=e.uid,t._material.clippingPlanes=n,kc.setLightDefines(t,s),r.push(t)),Gc(t,this._source);}));})),r}static setLightDefines(t,i){i&&i.lightingModel===e.LightingModelType.PBR?(t._material.defines.USE_PBR=!0,t._material.defines.USE_IBL=!0):(t._material.defines.USE_PBR=!1,t._material.defines.USE_IBL=!1),t._material.defines.PHONG_LIGHT=i.lightingModel==e.LightingModelType.PHONG;}getOpaquePrimitives(t,i,s){const r=[];if(!(i=i||e.checkIsDepthSupportDataType)(s.classificationType))return r;const n=this.clippingPlanes;return this.tilesForRender.forEach((e=>{e.primitives.forEach((t=>{t._material.isTranslucent||(t.boundingVolume=e.boundingVolume,t.tileUid=e.uid,t._material.clippingPlanes=n,kc.setLightDefines(t,s),r.push(t));}));})),r}addClippingPlanes(e){this.clippingPlanes=e;}addCustomizedStyle(e){this.customizedColor=e.get("point-cloud-color").value._parameters;}_shiftBoundingVolume(t,i){const s=new e.Vector3(t?.tileCenters[0]||t.boundingVolume.sphere.center);s.z=0;const r=e.Ellipsoid.WGS84.cartographicToCartesian(s,new e.Vector3),n=e.Transforms.eastNorthUpToFixedFrame(r);let o=e.Matrix4.multiplyByVector(n,new e.Vector4(i[0],i[1],i[2],1),new e.Vector4);o=new e.Vector3(o[0],o[1],o[2]);const a=o.subVectors(o,r),l=e.Matrix4.fromRotationTranslation(e.Matrix3.IDENTITY,a,new e.Matrix4);t.root.transform=l,t.root.transformMatrix=l;const h=new e.Vector4(t.root.boundingVolume.sphere.center);h.w=1,e.Matrix4.multiplyByVector(l,h,h),t.root.boundingVolume.sphere.center=new e.Vector3(h[0],h[1],h[2]);}}const Uc=3;function Hc(e,t){for(let i=0;i<e.length;i++){const s=e[i];"scenegraph"==s.type?(s.userData.markAsRoot=!0,t+1<=Uc&&Hc(s.children,t+1)):t<Uc&&Hc(s.children,t);}}kc.maxOverzooming=10,kc.maxUnderzooming=3;class zc extends e.Evented{constructor(e,t,i){super(),this.id=e,this.dispatcher=i,this.on("data",(e=>{"cesium-tile"===e.dataType&&this.transform&&this.update(this.transform);})),this.on("error",(()=>{this._sourceErrored=!0;}));const s=ml(e,t,i,this);this._source=s,this._tiles={},this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this.idealTileIDs=[],this._glTFTiles=[],this._preCesiumTiles=[],this._cacheTile=new k,this._geoCenter=[];}update(e){this.transform||(this.transform=e);}_unloadTiles(e){const t=this._cacheTile.get(e.id);t&&(t.childTiles.length>0&&t.childTiles.forEach((e=>{t.unloadVectorData();})),t.unloadVectorData(),this._cacheTile.remove(e.id));}prepare(e){this._source.prepare&&this._source.prepare(),this._context||(this._context=e);}get tilesForRender(){return this._glTFTiles}tilesIn(){return this._glTFTiles}onAdd(t){this.map=t,this._source&&this._source.onAdd&&this._source.onAdd(t,((t,i)=>{if(t)throw new Error("请求出错，请检查model路径问题、跨域问题或者资源是否存在");this.buildCesiumGltfTile({content:{gltf:i,cartographicOrigin:[],type:"3d-model"},id:e.uniqueId(),instances:null,normalRight:null,normalUp:null,relativeCenter:null}),this._glTFTiles.forEach((e=>{e.primitives.forEach((e=>{Gc(e,this._source);}));}));}));}buildCesiumGltfTile(t){const i=new e.GltfTile({tileID:t.id,modelFolder:this._source.modelFolder,boundingVolume:t.boundingVolume,minemap3DType:t.content.type,instances:t.instances||[],normalRight:t.normalRight||[],normalUp:t.normalUp||[],relativeCenter:t.relativeCenter||[]});this._cacheTile.set(t.id,i),t?.content&&(t.content.extra={featureTable:t.featureTable||void 0,batchTable:t.batchTable||void 0,selectionDepth:t._selectionDepth||void 0,depth:t.depth||0,finalResolution:t._finalResolution||!1}),i.upload(t.content,this._context,this._source),this._glTFTiles.push(i),this.fire(new e.Event("data",{dataType:"cesium-tile"}));}onRemove(e){this._source&&this._source.onRemove&&this._source.onRemove(e);}loaded(){return !!this.tileset3d&&this.tileset3d&&0===this.tileset3d.stats.get("Tiles Loading").count}getSource(){return this._source}pause(){this._paused=!0;}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform);}serialize(){return this._source.serialize()}reload(){}updateCacheSize(e){}hasTransition(){return !1}setFeatureState(e,t,i){}getFeatureState(e,t){}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;}getLocation(e){const{urls:t,url:i}=this._source._options;if(t){const i=t.map(((e,t)=>({center:this._geoCenter[t],...e})));return "string"!=typeof e?i:i.filter((t=>t.name===e))}return [{center:this._geoCenter[0],url:i}]}getTranslucentPrimitives(t,i,s){const r=[];return (i=i||e.checkIsDepthSupportDataType)(s.classificationType)?(this.tilesForRender.forEach((i=>{i.primitives.forEach((i=>{i._material.isTranslucent&&(i.tileUid||(i.tileUid=`3d-model${this._source.id}${Math.random()}`),t?t.computeVisibility(i.boundingVolume)!==e.INTERSECTION.OUTSIDE&&r.push(i):r.push(i));}));})),r):r}getOpaquePrimitives(t,i,s){const r=[];return (i=i||e.checkIsDepthSupportDataType)(s.classificationType)?(this.tilesForRender.forEach((i=>{i.primitives.forEach((i=>{i._material.isTranslucent||(i.tileUid||(i.tileUid=`3d-model${this._source.id}${Math.random()}`),t?t.computeVisibility(i.boundingVolume)!==e.INTERSECTION.OUTSIDE&&r.push(i):r.push(i));}));})),r):r}}zc.maxOverzooming=10,zc.maxUnderzooming=3;class Wc{constructor(t){this.tileID=t.tileID,this.sourceCache=t.sourceCache,this.uid=e.uniqueId(),this.uses=0,this.state="unloaded",this.images=[],this.terrain=null,this.primitive=null,this.proxyImage=null;}loadTile(){this.loadRaster(),this.loadTerrain(),this.state="loading";}loadRaster(){this.images=[];for(const e of this.sourceCache.order){const t=this.sourceCache.map.style._layers[e].source,i=this.sourceCache.rasterSources[t]||this.sourceCache.imageSources[t],s=i.createTileImagerySkeletons(this);for(const t of s)i.loadTile(t,(()=>{this.sourceCache.map.needRepaint=!0;})),t.layerId=e,this.images.push(t);}}loadTerrain(){this.sourceCache.terrainSource.loadTile(this.tileID,((t,i)=>{this.terrain=i,this.primitive=function(t){const{layer:i,painter:s,tile:r,defines:n,programId:o,parentTile:a,geomType:l}=t,h=s.style?.terrainAnalysis;let _;if(h){const t=e.TerrainTileParser.genShaderScript(h);_=new gh({layer:i,painter:s,tile:r,renderState:{depthTest:e.renderStateEnum.enableDepthTest},type:"background-analysis",defines:e.addColorDefines(h),vertexSource:e.reduceComma(t.vs),fragmentSource:e.reduceComma(t.fs),noCache:!0});}else _=new gh({layer:i,painter:s,tile:r,defines:n,type:o,parentTile:a,renderState:{}});return new e.Primitive({modelMatrix:l.matrix,geometry:l.geometry,material:_,allowPick:!1,keepGeometryWhenFree:!0})}({painter:this.sourceCache.map.painter,tile:this,defines:{},programId:e.SHADER_RASTER,parentTile:null,geomType:this.terrain});for(const e of this.images)if("loaded"!==e.imagery.state)return;this.state="loaded",this.sourceCache.map.needRepaint=!0;}));}addProxyTexture(e,t,i){t&&(this.proxyImage=e.createTileImagerySkeletons(this,i)[0],this.proxyImage.imagery.texture=t);}unloadTile(){for(const e of this.images)e.imagery.rasterTileSource.unloadTile(e);this.sourceCache.terrainSource.unloadTile(this.tileID),this.primitive&&this.primitive.destroy();}hasImage(){let e=!0;for(const t of this.images)"loaded"!==t.imagery.state&&(t.imagery.rasterTileSource.loadTile(t),e=!1);return e}hasTerrain(){return !!this.primitive||(this.loadTerrain(),!1)}checkTileState(){return !(!this.hasImage()||!this.hasTerrain()||(this.state="loaded",0))}wasRequested(){return "errored"===this.state||"loaded"===this.state||"reloading"===this.state}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}}class jc extends e.Evented{constructor(e,t,i){super(),this.id=e,this.map=t.map,this.dispatcher=i,this._tiles={},this._cache=new Nh(100,this._unloadTile.bind(this)),this.rasterSources={},this.imageSources={},this.order=[],this.terrainSource=new ml("ellipsoid",{type:"ellipsoid",map:this.map},this.dispatcher),this._init();}_init(){this._createQuadtree();}updateLayer(e){if(this.getRasterLayerOrder(),e)this.clearTiles();else for(const e in this._tiles)this._tiles[e].loadRaster();this._cache.reset();}addSource(e,t){const i=ml(e,t,this.dispatcher);i.onAdd(this.map),"raster"===t.type?this.rasterSources[e]=i:"image"===t.type&&(this.imageSources[e]=i);}getAllSources(){const e={};for(const t in this.imageSources)e[t]=this.imageSources[t];for(const t in this.rasterSources)e[t]=this.rasterSources[t];return e}getSource(e){return this.imageSources[e]||this.rasterSources[e]}removeSource(e){delete this.rasterSources[e],delete this.imageSources[e];}getRasterLayerOrder(){const e=this.map.style._layers,t=this.map.style._order;this.order=[];for(let i=0;i<t.length;i++)"raster"===e[t[i]].type&&this.order.push(t[i]);}_coveringTiles(){return this._createQuadtree(),this.quadtree.tilesIn(this.map.transform.activeCamera),this.quadtree.getOverscaledTileIDs()}_createQuadtree(){if(e.defined(this.quadtree))return;const t=this.map.painter.context.gl.drawingBufferHeight;this.quadtree=new Xh({hasTerrainData:this.terrainSource instanceof nl,maximumScreenSpaceError:this.map.spaceErrorScale||1,tileScheme:this.map.transform.projection===e.ProjectionType.LATLON?new Ct({}):new yt({}),drawingBufferHeight:t,pixelRatio:e.exported.devicePixelRatio,tileMinZoom:0,tileMaxZoom:22,type:"raster"});}update(){const t=this._coveringTiles();this.ambiguousSet=new Set,t.forEach((e=>{e.isAmbiguousHeight&&this.ambiguousSet.add(e.canonical.key);}));const i=this._updateRetainedTiles(t),s=e.keysDifferenceWithMap(this._tiles,i);for(let e=0;e<s.length;e++)this._removeTile(s[e]);}_updateRetainedTiles(e){const t=new Map;if(0===e.length)return t;const i={},s={};for(const i of e){const e=this._addTile(i);t.set(i.key,i),"loaded"===e.state||e.checkTileState()||(s[i.key]=i);}const r=e.reduce(((e,t)=>Math.min(e,t.overscaledZ)),1/0);this._retainLoadedChildren(s,r,t);for(const e in s){const r=this._tiles[e],n=s[e];let o=r.wasRequested();for(let e=n.overscaledZ-1;e>=0;--e){const s=n.scaledTo(e);let a=this._tiles[s.key];if(i[s.key])break;if(i[s.key]=!0,!a&&o&&(a=this._addTile(s)),a){if(o=a.wasRequested(),t.set(s.key,s),r.primitive&&"loaded"===a.state){const e=n.children(23);t.delete(e[0]?.key),t.delete(e[1]?.key),t.delete(e[2]?.key),t.delete(e[3]?.key);}if("loaded"===a.state)break}}}return t}_retainLoadedChildren(e,t,i){for(const s in this._tiles){let r=this._tiles[s];if(i.has(s)||"loaded"!==r.state||r.tileID.overscaledZ<=t)continue;let n=r.tileID;for(;r&&r.tileID.overscaledZ>t+1;){const e=r.tileID.scaledTo(r.tileID.overscaledZ-1);r=this._tiles[e.key],r&&"loaded"===r.state&&(n=e);}let o=n;for(;o.overscaledZ>t;)if(o=o.scaledTo(o.overscaledZ-1),e[o.key]){i.set(n.key,n);break}}}_addTile(e){let t=this._tiles[e.key];return t?(t.tileID=e,t):(t=this._cache.getAndRemove(e),Boolean(t)||(t=new Wc({tileID:e,sourceCache:this}),t.loadTile()),t?(t.uses++,this._tiles[e.key]=t,t):null)}_unloadTile(e){e.unloadTile();}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],t.uses>0||("loaded"===t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._unloadTile(t))));}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}clearTiles(){for(const e in this._tiles)this._removeTile(e);this._cache.reset();}getVisibleCoordinates(){return Object.keys(this._tiles).map((e=>this._tiles[e].tileID))}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const i=t.getExpiryTimeout();i&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e];}),i));}resetQuadtree(){this.quadtree?.destroy(),delete this.quadtree,this._tiles={},this._cache.reset();}setTerrain(e){if(this.clearTiles(),e&&e.tiles)e.format||(e.format="quantized"),e.type="terrain",e.map=this.map,this.terrainSource=new ml("terrain",e,this.dispatcher),this.resetQuadtree(),this.map.style.hasTerrainData=!0;else {if(this.terrainSource instanceof ul)return;this.terrainSource=new ml("ellipsoid",{type:"ellipsoid",map:this.map},this.dispatcher),this.resetQuadtree(),this.map.style.hasTerrainData=!1;}this.map.style.updateHasTerrainFlag(),this._createQuadtree(),this.map.needRepaint=!0;}}const Xc={RGBA4:e.WebGLConstants.RGBA4,RGBA8:e.WebGLConstants.RGBA8,RGBA16F:e.WebGLConstants.RGBA16F,RGBA32F:e.WebGLConstants.RGBA32F,RGB5_A1:e.WebGLConstants.RGB5_A1,RGB565:e.WebGLConstants.RGB565,DEPTH_COMPONENT16:e.WebGLConstants.DEPTH_COMPONENT16,STENCIL_INDEX8:e.WebGLConstants.STENCIL_INDEX8,DEPTH_STENCIL:e.WebGLConstants.DEPTH_STENCIL,DEPTH24_STENCIL8:e.WebGLConstants.DEPTH24_STENCIL8,validate:e=>e===Xc.RGBA4||e===Xc.RGBA8||e===Xc.RGBA16F||e===Xc.RGBA32F||e===Xc.RGB5_A1||e===Xc.RGB565||e===Xc.DEPTH_COMPONENT16||e===Xc.STENCIL_INDEX8||e===Xc.DEPTH_STENCIL||e===Xc.DEPTH24_STENCIL8,getColorFormat:t=>t===e.WebGLConstants.FLOAT?Xc.RGBA32F:t===e.WebGLConstants.HALF_FLOAT_OES?Xc.RGBA16F:Xc.RGBA8};var qc=Object.freeze(Xc);class Kc{constructor(t){const i=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).context.gl,s=e.ContextLimits.maximumRenderbufferSize,r=e.defaultValue(t.format,qc.RGBA4),n=e.defined(t.width)?t.width:i.drawingBufferWidth,o=e.defined(t.height)?t.height:i.drawingBufferHeight;if(!qc.validate(r))throw new Error("Invalid format.");if(n>s)throw new Error(`宽度必须小于等于 renderbuffer size (${s}).  Check maximumRenderbufferSize.`);if(o>s)throw new Error(`高度必须小于等于 renderbuffer size (${s}).  Check maximumRenderbufferSize.`);this._gl=i,this._format=r,this._width=n,this._height=o,this._renderbuffer=this._gl.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,this._renderbuffer),i.renderbufferStorage(i.RENDERBUFFER,r,n,o),i.bindRenderbuffer(i.RENDERBUFFER,null);}get format(){return this._format}get width(){return this._width}get height(){return this._height}_getRenderbuffer(){return this._renderbuffer}isDestroyed(){return !1}destroy(){return this._gl.deleteRenderbuffer(this._renderbuffer),e.destroyObject(this)}}function Jc(t,i,s){t.framebufferTexture2D(e.WebGLConstants.FRAMEBUFFER,i,s._target,s.texture,0);}function Zc(e,t,i){e.framebufferRenderbuffer(e.FRAMEBUFFER,t,e.RENDERBUFFER,i._getRenderbuffer());}class Yc{constructor(t){const{context:i,width:s,height:r}=t;this.context=i,this.width=s,this.height=r;const n=i.gl;this._gl=n,this.framebuffer=n.createFramebuffer(),this._colorTextures=[],this._colorRenderbuffers=[],this._activeColorAttachments=[];const o=e.ContextLimits._maximumColorAttachments;if(this.destroyAttachments=!0,e.defined(t.colorTextures)&&e.defined(t.colorRenderbuffers))throw new Error("color texture 和 color renderbuffer attachments 不能同时存在。");if(e.defined(t.depthTexture)&&e.defined(t.depthRenderbuffer))throw new Error("depth texture 和 depth renderbuffer attachment 不能同时存在。");if(e.defined(t.depthStencilTexture)&&e.defined(t.depthStencilRenderbuffer))throw new Error("depth-stencil texture 和 depth-stencil renderbuffer attachment 不能同时存在。");const a=e.defined(t.depthTexture)||e.defined(t.depthRenderbuffer),l=e.defined(t.depthStencilTexture)||e.defined(t.depthStencilRenderbuffer);if(a&&l)throw new Error("depth 和 depth-stencil attachment 不能同时存在。");if(e.defined(t.stencilRenderbuffer)&&l)throw new Error("stencil 和 depth-stencil attachment 不能同时存在。");if(a&&e.defined(t.stencilRenderbuffer))throw new Error("depth 和 stencil attachment 不能同时存在。");let h,_,c,u;if(this._bind(),e.defined(t.colorTextures)){const s=t.colorTextures;if(c=this._colorTextures.length=this._activeColorAttachments.length=s.length,c>o)throw new Error("color attachments 越界！");for(let t=0;t<c;++t){if(h=s[t],!e.PixelFormat.isColorFormat(h.pixelFormat))throw new Error("color-texture 像素格式必须是颜色格式");if(h.pixelDatatype===e.WebGLConstants.FLOAT&&!i.extColorBufferFloat)throw new Error("The color texture pixel datatype is FLOAT and the WebGL implementation does not support the EXT_color_buffer_float or WEBGL_color_buffer_float extensions. See Context.colorBufferFloat.");if(h.pixelDatatype===e.WebGLConstants.HALF_FLOAT&&!i.extColorBufferHalfFloat)throw new Error("The color texture pixel datatype is HALF_FLOAT and the WebGL implementation does not support the EXT_color_buffer_half_float extension. See Context.colorBufferHalfFloat.");u=e.WebGLConstants.COLOR_ATTACHMENT0+t,Jc(n,u,h),this._activeColorAttachments[t]=u,this._colorTextures[t]=h;}}if(e.defined(t.colorRenderbuffers)){const i=t.colorRenderbuffers;if(c=this._colorRenderbuffers.length=this._activeColorAttachments.length=i.length,c>o)throw new Error("color attachments 超过显卡数量限制");for(let t=0;t<c;++t)_=i[t],u=e.WebGLConstants.COLOR_ATTACHMENT0+t,Zc(n,u,_),this._activeColorAttachments[t]=u,this._colorRenderbuffers[t]=_;}if(e.defined(t.depthTexture)){if(h=t.depthTexture,h.pixelFormat!==e.WebGLConstants.DEPTH_COMPONENT)throw new Error("depth-texture 像素格式必须是 DEPTH_COMPONENT.");Jc(n,e.WebGLConstants.DEPTH_ATTACHMENT,h),this._depthTexture=h;}if(e.defined(t.depthRenderbuffer)&&(_=t.depthRenderbuffer,Zc(n,e.WebGLConstants.DEPTH_ATTACHMENT,_),this._depthRenderbuffer=_),e.defined(t.stencilRenderbuffer)&&(_=t.stencilRenderbuffer,Zc(n,e.WebGLConstants.STENCIL_ATTACHMENT,_),this._stencilRenderbuffer=_),e.defined(t.depthStencilTexture)){if(h=t.depthStencilTexture,h.pixelFormat!==e.WebGLConstants.DEPTH_STENCIL)throw new Error("depth-stencil 的像素格式 必须是 DEPTH_STENCIL.");Jc(n,e.WebGLConstants.DEPTH_STENCIL_ATTACHMENT,h),this._depthStencilTexture=h;}e.defined(t.depthStencilRenderbuffer)&&(_=t.depthStencilRenderbuffer,Zc(n,e.WebGLConstants.DEPTH_STENCIL_ATTACHMENT,_),this._depthStencilRenderbuffer=_),this._unBind();}get status(){this._bind();const e=this._gl.checkFramebufferStatus(this._gl.FRAMEBUFFER);return this._unBind(),e}get numberOfColorAttachments(){return this._activeColorAttachments.length}get depthTexture(){return this._depthTexture}get depthRenderbuffer(){return this._depthRenderbuffer}get stencilRenderbuffer(){return this._stencilRenderbuffer}get depthStencilTexture(){return this._depthStencilTexture}get depthStencilRenderbuffer(){return this._depthStencilRenderbuffer}get hasDepthAttachment(){return !!(this.depthTexture||this.depthRenderbuffer||this.depthStencilTexture||this.depthStencilRenderbuffer)}_bind(){this.context.gl.bindFramebuffer(e.WebGLConstants.FRAMEBUFFER,this.framebuffer);}_unBind(){this.context.gl.bindFramebuffer(e.WebGLConstants.FRAMEBUFFER,null);}bindDraw(){this.context.gl.bindFramebuffer(e.WebGLConstants.DRAW_FRAMEBUFFER,this.framebuffer);}bindRead(){this.context.gl.bindFramebuffer(e.WebGLConstants.READ_FRAMEBUFFER,this.framebuffer);}_getActiveColorAttachments(){return this._activeColorAttachments}getColorTexture(t){if(!e.defined(t)||t<0||t>=this._colorTextures.length)throw new Error("color的索引值必须输入，并且是≥0切小于color attachments的数量");return this._colorTextures[t]}getColorRenderbuffer(t){if(!e.defined(t)||t<0||t>=this._colorRenderbuffers.length)throw new Error("color的索引值必须输入，并且是≥0切小于color attachments的数量");return this._colorRenderbuffers[t]}destroy(t){const i=this.context.gl;if(this.destroyAttachments){let i=0;const s=this._colorTextures;let r=s.length;if(!t)for(;i<r;++i){const t=s[i];e.defined(t)&&t.destroy();}const n=this._colorRenderbuffers;for(r=n.length,i=0;i<r;++i){const t=n[i];e.defined(t)&&t.destroy();}this._depthTexture=this._depthTexture&&this._depthTexture.destroy(),this._depthRenderbuffer=this._depthRenderbuffer&&this._depthRenderbuffer.destroy(),this._stencilRenderbuffer=this._stencilRenderbuffer&&this._stencilRenderbuffer.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy();}return i.deleteFramebuffer(this.framebuffer),e.destroyObject(this)}}class Qc extends So{constructor(t,i){const s=e.Color.parse(t).toVector3().multiplyScalar(i);super(new e.Color(s[0],s[1],s[2],1),i),this.type="AmbientLight",this.isAmbientLight=!0,this.castShadow=void 0;}serialize(){return {color:e.Vector3.pack(this.color,new Array(3)),intensity:this.intensity,type:this.type}}}class $c{constructor(t){this.passType=t||e.RenderPassConsts.REAL_RENDER_PASS,this._sunLight=new Fo(new e.Color(1,1,1),1,1701401576180),this._lights=[new Qc("#aaaaaa",1)],this._enableLight=!0,this._shadowModel=e.ShadowsType.ShadowMapping,this.overrideMaterial=void 0,this._shadows=!1,this.frameNumber=0,this.hasDefaultAmbientLight=!0;}set shadowModel(e){this._shadowModel=e;}setShadows(e){this._shadows=e;}set passType(t){e.defined(t)&&(this._type=t);}get passType(){return this._type}set framebuffer(e){this._framebuffer=e;}get framebuffer(){return this._framebuffer}get sunLight(){return this._sunLight}set sunLight(e){this._sunLight=e;}set lights(e){this._lights=e;}get lights(){return this._lights}addLight(e){"AmbientLight"==e.type&&this.hasDefaultAmbientLight&&(this._lights.splice(0,1),this.hasDefaultAmbientLight=!1),this._lights.push(e);}set camera(e){this._camera=e;}get camera(){return this._camera}get sameLayerFrame(){return this._sameLayerFrame}set sameLayerFrame(e){this._sameLayerFrame=e;}update(e){e.hasOwnProperty("framebuffer")&&(this.framebuffer=e.framebuffer),e.hasOwnProperty("lights")&&(this.lights=e.lights),e.hasOwnProperty("camera")&&(this.camera=e.camera),e.hasOwnProperty("passType")&&(this.passType=e.passType),e.hasOwnProperty("shadowCamera")&&(this.shadowCamera=e.shadowCamera),this.frameNumber=this.frameNumber>15e6?0:this.frameNumber+1;}bindFramebuffer(e){e.bindFramebuffer.set(this.framebuffer?this.framebuffer.framebuffer:null);}applyFrameState(e){e.bindFramebuffer.set(this.framebuffer.framebuffer);}lightSerialize(){const t=[];for(let e=0;e<this.lights.length;e++)t.push(this.lights[e].serialize());return e.defined(this.sunLight)&&t.push(this.sunLight.serialize()),t.push({enableLight:this._enableLight}),t}destroy(){this._framebuffer&&this._framebuffer.destroy();}}class eu{constructor(e){const{passType:t}=e;this.passType=t,this.replaceMaterial=void 0,this._SSAASamples=1,this._SSAASamplesDirty=!0;}set SSAASamples(e){e!=this._SSAASamples&&(this._SSAASamples=e,this._SSAASamplesDirty=!0);}get SSAASamples(){return this._SSAASamples}middleRender(t,i,s,r){e.RenderState.applyRenderState(i,e.RenderState.fromCache({viewport:{x:0,y:0,width:this.width*this._SSAASamples,height:this.height*this._SSAASamples}})),i.clear({color:t._map._canvasTransparent?e.Color.transparent:e.Color.black,depth:1,stencil:0}),t.renderGroup.update({layers:t.style._layers,orders:t.style._order,frameState:s,ignoreNonePickPrimitive:r}),t.renderGroup.render({layers:t.style._layers,frameState:s}),1!=this.SSAASamples&&e.RenderState.applyRenderState(i,e.RenderState.fromCache({viewport:{x:0,y:0,width:this.width,height:this.height}}));}createFramebuffer({width:t,height:i,context:s}){const r=new e.Sampler({minificationFilter:e.TextureMinificationFilter.NEAREST,magnificationFilter:e.TextureMagnificationFilter.NEAREST}),n=t*this._SSAASamples,o=i*this._SSAASamples;return new Yc({context:s,width:n,height:o,colorTextures:[new e.Texture({width:n,height:o,context:s,pixelFormat:e.WebGLConstants.RGBA})],depthStencilTexture:new e.Texture({context:s,width:n,height:o,minFilter:e.WebGLConstants.LINEAR,magFilter:e.WebGLConstants.LINEAR,pixelFormat:e.PixelFormat.DEPTH_STENCIL,pixelDatatype:e.PixelDatatype.UNSIGNED_INT_24_8,sampler:r,anisotropy:1})})}update(t,i,s){const{context:r}=t;if(!e.defined(i)||!e.defined(s))throw new Error("pass 必须手动设定宽高");this.width===i&&this.height===s&&this.framebuffer&&!this._SSAASamplesDirty||(this.framebuffer&&this.framebuffer.destroy(),this.framebuffer=this.createFramebuffer({width:i,height:s,context:r}),this._SSAASamplesDirty=!1),t.frameState.update({framebuffer:this.framebuffer}),t.frameState.bindFramebuffer(r),this.width=i,this.height=s;}destroy(t){return this.camera=void 0,this.framebuffer&&this.framebuffer.destroy(t),this.framebuffer=void 0,this.width=void 0,this.height=void 0,this.frameState&&(this.frameState.framebuffer=void 0,this.frameState.destroy()),this.frameState=void 0,this.passType=void 0,this.replaceMaterial&&this.replaceMaterial.destroy(),this.replaceMaterial=void 0,this.geometry&&this.geometry.destroy(),this.geometry=void 0,this.material&&(e.isFunction(this.material.destroy)?this.material.destroy():(this.renderState=void 0,this.uniforms=void 0,this.shaderSource&&this.shaderSource.destroy(),this.shaderSource=void 0)),this.material=void 0,e.destroyObject(this)}}function tu(t,i,s,r,n,o=4,a=1){let l=new Uint8Array(o);n===e.WebGLConstants.FLOAT&&(l=new Float32Array(o));const h=i.bindFramebuffer.get();return i.bindFramebuffer.set(s?.framebuffer),i.gl.readPixels(t.x*e.window.devicePixelRatio*a,(r-t.y*e.window.devicePixelRatio)*a,t.width||1,t.height||1,e.WebGLConstants.RGBA,n||e.WebGLConstants.UNSIGNED_BYTE,l),i.bindFramebuffer.set(h),l}class iu extends eu{constructor(e){super(e),this.width=e.width?e.width:1024,this.height=e.height?e.height:1024,this.tileID=e.tileID,this.zoom=void 0,this.hasLine=!1,this.dirty=!0;}update(e,t,i){e.frameState.passType=this.passType,super.update(e,t,i);}render(t){const{painter:i,primitives:s,layers:r,projMatrix:n,needReload:o}=t,{context:a,frameState:l}=i;if(this.zoom!==i.style.symbolMatrixHelper.zoom&&(this.zoom=i.style.symbolMatrixHelper.zoom,this.hasLine&&(this.dirty=!0)),o&&(this.dirty=!0),!this.dirty)return;const h=i.frameState.framebuffer,_=i.frameState.passType;this.update(i,this.width,this.height),e.RenderState.applyRenderState(a,e.RenderState.fromCache({viewport:{x:0,y:0,width:this.width,height:this.height},cull:e.renderStateEnum.disableCull,depthTest:e.renderStateEnum.disableDepthTest,depthMask:e.renderStateEnum.disableDepthMask})),a.clear({color:new e.Color(0,0,0,0),depth:1,stencil:0}),this.hasLine=!1;for(let t=0;t<s.length;t++){const o=s[t],a=i.style._layers[r[t]];if(a.type===e.VectorLayerType.LINE){this.hasLine=!0,o._material._uniforms.set("u_PixelsToTileUnits",(()=>{const t=(1<<this.tileID.canonical.z)*e.EXTENT/(512*Math.pow(2,this.zoom-this.tileID.canonical.z+this.tileID.overscaledZ));return new e.Matrix2([t,0,0,t])})),o._material._uniforms.set("u_Matrix",(()=>n)),o._material._uniforms.set("u_GlUnitsToPixels",(()=>new e.Vector2(this.width/2,-this.height/2)));const t=o._material.isBorder;t&&(o.update(i,l),o.render(i,a,l)),t&&(o._material.isBorder=!1),o.update(i,l),o.render(i,a,l),t&&(o._material.isBorder=!0);}else a.type===e.VectorLayerType.FILL&&(o._material._uniforms.set("u_Matrix",(()=>n)),o.update(i,l),o.render(i,a,l));}i.frameState.passType=_,i.frameState.update({framebuffer:h}),i.frameState.bindFramebuffer(a);}readPixel(t,i){return tu(t,i,this.framebuffer,this.height,e.WebGLConstants.UNSIGNED_BYTE)}}class su{constructor(t){this.tileID=t.tileID,this.sourceCache=t.sourceCache,this.tileBoundingRegion=t.tileBoundingRegion,this.projMatrix=(new e.Matrix4).ortho({left:0,right:e.EXTENT,bottom:0,top:e.EXTENT,near:0,far:1}),this.state="initialized",this.texture=void 0,this.primitives=void 0,this.pass=void 0,this.renderlayers=void 0,this.attachedRasterTileIDSet=new Set;}unloadTile(){if(this.primitives){for(const e of this.primitives)e._geometry=void 0,e.destroy();this.primitives=void 0;}this.unbindTile(),this.texture&&(this.texture.destroy(),this.texture=void 0),this.pass&&(this.pass.destroy(!1),this.pass=void 0),this.renderlayers=void 0,this.state="unloaded";}unbindTile(){const e=this.sourceCache.map.style.rasterSourceCache;this.attachedRasterTileIDSet.forEach((t=>{const i=e._tiles[t];i?.proxyImage?.imagery?.texture&&i.proxyImage.imagery.texture===this.texture&&(i.proxyImage=void 0);})),this.attachedRasterTileIDSet.clear();}attachToMostIdealRasterTile(){if(!this.texture)return;const[,e]=this.sourceCache.sourceCaches.entries().next().value,t=this.sourceCache.map.style.rasterSourceCache,i=t.getTile(this.tileID);if(i)i.proxyImage?.imagery?.texture!==this.texture&&(this.attachedRasterTileIDSet.add(i.tileID.key),i.addProxyTexture(e._source,this.texture,this.tileID));else {const i=this.tileID.canonical.z,s=this.tileID.canonical.x,r=this.tileID.canonical.y;for(const n in t._tiles){const o=t._tiles[n],a=o.tileID;if(a.canonical.z>i){const t=a.scaledTo(i);t.canonical.x===s&&t.canonical.y===r&&o.proxyImage?.imagery?.texture!==this.texture&&(this.attachedRasterTileIDSet.add(o.tileID.key),o.addProxyTexture(e._source,this.texture,this.tileID));}}}}loadTile(){let t=!1;if("loaded"!==this.state){const i=function(t){const{tileID:i,painter:s,sourceCaches:r,tileBoundingRegion:n,layerOrder:o}=t,a=[],l=[],h=s.style,_=s.context,c=h._layers;let u=!1;for(const t of o){const o=c[t],d=r.get(o.source).getTile(i);if(!d)continue;if("loaded"!==d.state){u=!0;continue}const m=d.getBucket(o);if(e.defined(m))if(m.uploadPending()&&m.upload(_),o.type===e.VectorLayerType.FILL){const i=m.programConfigurations.get(o.id),r=m.matrix,h=Th({bucket:m,tileBoundingRegion:n,isRegularVector:!0});if(!h[0]._vertBuffer.context){u=!0;continue}const _=Ah({layer:o,painter:s,tile:d,programConfiguration:i,isRegularVector:!0});_[0].defines={CANVAS_2D:!0},_[0].renderState.blending=e.renderStateEnum.enableBlending;const c=new e.Primitive({modelMatrix:r,geometry:h[0],material:_[0]});if(a.push(c),l.push(t),h[1]&&o.paint?.get("fill-antialias")){_[1].defines={CANVAS_2D:!0},_[1].renderState.blending=e.renderStateEnum.enableBlending;const i=new e.Primitive({modelMatrix:r,geometry:h[1],material:_[1]});a.push(i),l.push(t);}}else if(o.type===e.VectorLayerType.LINE){const i=h.getSource(o.source),r=m.programConfigurations.get(o.id),_=m.matrix,c=Eh({layer:o,painter:s,tile:d,bucket:m,programConfiguration:r,isRegularVector:!0,sourceMaxZoom:i.maxzoom,animationsInfo:i.animationsInfo});c.defines={CANVAS_2D:!0},c.renderState.blending=e.renderStateEnum.enableBlending;const p=xh({bucket:m,tileBoundingRegion:n,isRegularVector:!0});if(!p._vertBuffer.context){u=!0;continue}const f=new e.Primitive({modelMatrix:_,geometry:p,material:c});a.push(f),l.push(t);}}return {primitives:a,renderLayerOrder:l,needReload:u}}({tileID:this.tileID,painter:this.sourceCache.map.painter,sourceCaches:this.sourceCache.sourceCaches,tileBoundingRegion:this.tileBoundingRegion,layerOrder:this.sourceCache.order});this.primitives=i.primitives,this.renderlayers=i.renderLayerOrder,t=i.needReload;}this.primitives&&this.primitives.length>0&&(this.pass||(this.pass=new iu({passType:e.RenderPassConsts.PROXY_PASS,tileID:this.tileID})),this.pass.render({painter:this.sourceCache.map.painter,primitives:this.primitives,layers:this.renderlayers,projMatrix:this.projMatrix,needReload:t}),this.texture=this.pass.framebuffer.getColorTexture(0),this.texture.sampler={minificationFilter:e.WebGLConstants.LINEAR,magnificationFilter:e.WebGLConstants.LINEAR,wrapS:e.WebGLConstants.CLAMP_TO_EDGE,wrapT:e.WebGLConstants.CLAMP_TO_EDGE},this.attachToMostIdealRasterTile()),this.state="loaded",t&&(this.state="loading");}}class ru extends e.Evented{constructor(e,t,i){super(),this.id=e,this.map=t.map,this.dispatcher=i,this._tiles={},this._cache=new Nh(100,this._unloadTile.bind(this)),this.sourceCaches=new Map,this.order=[],this.enabled=!1;}update(){if(!this.enabled)return;const[,t]=this.sourceCaches.entries().next().value;if(!t)return;const i=t._tiles,s=e.keysDifference(this._tiles,i);for(let e=0;e<s.length;e++)this._removeTile(s[e]);for(const e in i){const i=t.getTileByID(e),s=t.quadtree.getBoundingRegionById(e);this._loadTile(i.tileID,s);}}_removeTile(e){const t=this._tiles[e];t&&(delete this._tiles[e],"loaded"===t.state?(this._unbindTile(t),this._cache.add(t.tileID,t)):this._unloadTile(t));}_loadTile(e,t){let i=this._tiles[e.key];if(i)i.loadTile();else {if(i=this._cache.getAndRemove(e),Boolean(i))return this._tiles[e.key]=i,void i.loadTile();i=new su({tileID:e,sourceCache:this,rasterSourceCache:this.map.style.rasterSourceCache,tileBoundingRegion:t}),i.loadTile(),this._tiles[e.key]=i;}}_unloadTile(e){e.unloadTile();}_unbindTile(e){e.unbindTile();}updateLayer(){this.getLayerOrder(),this.clearTiles();}getLayerOrder(){const e=this.map.style;if(!e.hasTerrainData)return void(this.enabled=!1);const t=e._layers,i=e._order,s=e.sourceCaches;this.order=[],this.sourceCaches=new Map;for(let e=0;e<i.length;e++){const r=t[i[e]];if("visible"===r.visibility&&("line"===r.type||"fill"===r.type)){const t=s[r.source];t.adaptTerrain&&(this.sourceCaches.set(r.source,t),this.order.push(i[e]));}}this.enabled=0!==this.order.length;}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}clearTiles(){for(const e in this._tiles)this._removeTile(e);this._cache.reset();}}const nu=function(e,t,i){return "3d-tiles"===t.type?new kc(e,t,i):"3d-model"===t.type?new zc(e,t,i):"raster"===t.type?new jc(e,t,i):"proxy"===t.type?new ru(e,t,i):new qh(e,t,i)};class ou{constructor(t){this.options=t||{},this.requestPerformanceManager=new e.RequestPerformanceManger({}),this.updateSourceCaches=[];}prepare(){const e=this.options.style;this.updateSourceCaches=[];const t=[];for(const i in e.sourceCaches)t.push(e.sourceCaches[i]);this.updateSourceCaches=t;}run(){this._updateLoop();}beforeStop(){const e=this.options.style;this.updateSourceCaches=[],this.updateSourceCaches.push(e.rasterSourceCache);for(const t in e.sourceCaches)this.updateSourceCaches.push(e.sourceCaches[t]);this.updateSourceCaches.push(e.proxySourceCache);}_updateLoop(){for(const e of this.updateSourceCaches)e.update();}stop(){this._updateLoop();}clearUpdateSourceCaches(){this.updateSourceCaches=[];}}class au{constructor(t){this._style=t,this.status=3,this.resourcePerformaceManager=new ou({style:this._style,mode:e.CONSTS.PERFORMANCE.MODE.MANUAL}),this.previousTime=Date.now();}startAction(){0!==Object.keys(this._style.sourceCaches).length&&(2!==this.status?(this.status=1,this.resourcePerformaceManager.prepare(),this.previousTime=Date.now(),this.animateAction()):(this.previousTime=Date.now(),this.animateAction()));}animateAction(){this.status=2,this.resourcePerformaceManager.run();}isStopped(){return 3===this.status}stopAction(){this.status=3,this.resourcePerformaceManager.beforeStop(),this.resourcePerformaceManager.stop();}}class lu{constructor(){this._data=new Map,this._orders=[];}add(e){}get(e){return this._data.get(e)}getAll(){const e=[];for(let t=0;t<this._orders.length;t++){const i=this.get(this._orders[t]);e.push(i);}return e}has(e){return this._data.has(e)}sort(e){this._orders.sort(e);}remove(e,t){if(this.has(e)){if(t){const t=this.get(e);t.destroy&&t.destroy();}this._data.delete(e);const i=this._orders.indexOf(e);this._orders.splice(i,1);}}removeAll(e){for(;this._orders.length>0;)this.remove(this._orders[0],e);}getIgnoreClassificationPrimitiveObject(t){return {opaque:this.getOpaquePrimitives(t,e.checkIsIgnoreClassificationDataType),translucent:this.getTranslucentPrimitives(t,e.checkIsIgnoreClassificationDataType)}}getTranslucentPrimitives(){}getOpaquePrimitives(){}getIndependentPrimitiveObject(t){return {opaque:this.getOpaquePrimitives(t,e.checkIsDepthSupportDataType),translucent:this.getTranslucentPrimitives(t,e.checkIsDepthSupportDataType)}}getClassificationPrimitiveObject(t){return {opaque:this.getOpaquePrimitives(t,e.checkIsVectorShadowVolumeDataType),translucent:this.getTranslucentPrimitives(t,e.checkIsVectorShadowVolumeDataType)}}get keys(){return this._orders}get size(){return this._data.size}loaded(){return !0}}lu.RENDER_TYPE={OPAQUE_TYPE:"OPAQUE_TYPE",TRANSLUCENT_TYPE:"TRANSLUCENT_TYPE"};class hu extends lu{constructor(e){super(),this.type=e.type;}add(e){if(this.has(e.id))throw new Error(`There is already a sceneComponent with this ID: ${e.id}`);return this._orders.push(e.id),this._data.set(e.id,e),e}getTranslucentPrimitives(t,i){i=i||e.checkIsDepthSupportDataType;let s=[];for(let r=0;r<this._orders.length;r++){const n=this.get(this._orders[r]);if(i(n.classificationType))if(n instanceof Fc)s=s.concat(n._translucentList);else if(t)if(e.defined(n.modelInstanceCollection))t.computeVisibility(n.modelInstanceCollection.boundingVolume)!==e.INTERSECTION.OUTSIDE&&(s=s.concat(n.translucentList));else for(let i=0;i<n.translucentList.length;i++){const r=n.translucentList[i];t.computeVisibility(r.boundingVolume)!==e.INTERSECTION.OUTSIDE&&s.push(r);}else s=s.concat(n.translucentList);}return s}getOpaquePrimitives(t,i){i=i||e.checkIsDepthSupportDataType;let s=[];for(let r=0;r<this._orders.length;r++){const n=this.get(this._orders[r]);if(i(n.classificationType))if(n instanceof Fc)s=s.concat(n._opaqueList);else if(t)if(e.defined(n.modelInstanceCollection))t.computeVisibility(n.modelInstanceCollection.boundingVolume)!==e.INTERSECTION.OUTSIDE&&(s=s.concat(n.opaqueList));else for(let i=0;i<n.opaqueList.length;i++){const r=n.opaqueList[i];t.computeVisibility(r.boundingVolume)!==e.INTERSECTION.OUTSIDE&&s.push(r);}else s=s.concat(n.opaqueList);}return s}update(e){for(let t=0;t<this._orders.length;t++)this.get(this._orders[t]).update(e);}serialize(){if("3d-model"===this.type||"3d-model-instance"===this.type){const t=[];return this._data.forEach((i=>{const s={id:i.id,data:i._data,modelFolder:i.modelFolder,backCulling:i.backCulling,lightingModel:i.lightingModel,activeAnimation:i.activeAnimation,classificationType:i.classificationType};if(e.defined(i.modelInstanceCollection)){s.type="3d-model-instance";const t=[],r=[],n=[],o=[],a=[],l=[];i.modelInstanceCollection._instances.forEach((i=>{const s=e.Cartographic.fromVector3(i.position);s.x*=e.CONSTS.CesiumMath.DEGREES_PER_RADIAN,s.y*=e.CONSTS.CesiumMath.DEGREES_PER_RADIAN,t.push([s.x,s.y,s.z]),r.push({heading:i.rotation.heading,pitch:i.rotation.pitch,roll:i.rotation.roll}),n.push(e.Vector3.pack(i.scale,new Array(3))),o.push(i.instanceName),a.push(e.Color.pack(i.color,new Array(4))),l.push(i.show);})),s.positions=t,s.rotations=r,s.scales=n,s.instanceNames=o,s.colors=a,s.shows=l;}else s.type="3d-model",e.defined(i._options.scale)&&(s.scale=i._options.scale),e.defined(i._options.position)&&(s.position=i._options.position),s.rotation=i._rotation;e.defined(i.clippingPlanes)&&(s.clippingPlanes=i.clippingPlanes.serialize()),t.push(s);})),t.length>0?t:void 0}if("3d-tiles"===this.type){const t=[];return this._data.forEach((i=>{const s={id:i.id,type:"3d-tiles",show:i.show,translation:e.defined(i.translation)?e.Vector3.pack(i.translation,new Array(3)):void 0,skipLevelOfDetail:i.skipLevelOfDetail,maximumScreenSpaceError:i._maximumScreenSpaceError,useMipmap:i.useMipmap,allowPick:i.allowPick,lightingModel:i.lightingModel,geoBoundsOptions:i._geoBoundsOptions,clippingPlanes:e.defined(i.clippingPlanes)?i.clippingPlanes.serialize():void 0,backCulling:i.backCulling,classificationType:i.classificationType};e.defined(i._url)&&(s.url=i._url),i._urls.length>0&&(s.urls=i._urls),e.defined(i.clippingPlanes)&&(s.clippingPlanes=i.clippingPlanes.serialize()),t.push(s);})),t.length>0?t:void 0}}loaded(){for(let e=0;e<this._orders.length;e++)if(!this._data.get(this._orders[e]).loaded())return !1;return !0}destroy(){return this.removeAll(!0),e.destroyObject(this)}}class _u extends lu{constructor(){super();}add(e){if(this.has(e.id))throw new Error(`There is already a sceneComponent with this ID: ${e.id}`);this._data.set(e.id,e),this._orders.push(e.id);}getTranslucentPrimitives(t,i){let s=[];i=i||e.checkIsDepthSupportDataType;for(let e=0;e<this._orders.length;e++){const t=this.get(this._orders[e]);i(t.classificationType)&&(s=s.concat(t.getTranslucentPrimitives()));}return s}getOpaquePrimitives(t,i){let s=[];i=i||e.checkIsDepthSupportDataType;for(let e=0;e<this._orders.length;e++){const t=this.get(this._orders[e]);i(t.classificationType)&&(s=s.concat(t.getOpaquePrimitives()));}return s}update(e){this._data.forEach((t=>{t.update(e);}));}destroy(){return this.removeAll(!0),e.destroyObject(this)}}class cu extends lu{constructor(){super(),this._data=new Map;}add(e){if(this.has(e.id))throw new Error(`There is already a sceneComponent with this ID: ${e.id}`);this._data.set(e.id,e),this._orders.push(e.id);}getTranslucentPrimitives(t,i){i=i||e.checkIsDepthSupportDataType;const s=[];for(let r=0;r<this._orders.length;r++){const n=this.get(this._orders[r]);i(n.classificationType)&&n._material.isTranslucent&&(!t||!n.boundingVolume||t&&t.computeVisibility(n.boundingVolume)!==e.INTERSECTION.OUTSIDE)&&s.push(n);}return s}getOpaquePrimitives(t,i){const s=[];i=i||e.checkIsDepthSupportDataType;for(let r=0;r<this._orders.length;r++){const n=this.get(this._orders[r]);i(n.classificationType)&&(n._material.isTranslucent||(!t||!n.boundingVolume||t&&t.computeVisibility(n.boundingVolume)!==e.INTERSECTION.OUTSIDE)&&s.push(n));}return s}update(e){for(let t=0;t<this._orders.length;t++){const i=this.get(this._orders[t]);i.updateAnimation&&i.updateAnimation(e);}}serialize(){const t=[];return this._data.forEach((i=>{const s=i.serialize();e.defined(s)&&t.push(s);})),t.length>0?t:void 0}destroy(){return this.removeAll(!0),e.destroyObject(this)}}class uu extends e.Geometry{constructor(e){super(e),this.type="SkyBoxGeometry",this.parse(e);}parse({context:t}){this._vertexArray=new e.StructArrayLayout3f12,this._indices=new e.StructArrayLayout3ui6;const i=[-1,-1,1,1,-1,1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1];for(let e=0;e<i.length;e+=3)this._vertexArray.emplaceBack(i[e],i[e+1],i[e+2]);const s=[5,1,3,3,7,5,6,2,0,0,4,6,2,6,7,7,3,2,5,4,0,0,1,5,0,2,3,3,1,0,7,6,4,4,5,7];for(let e=0;e<s.length;e+=3)this._indices.emplaceBack(s[e],s[e+1],s[e+2]);this._vertBuffer=t.createVertexBuffer(this._vertexArray,ka.members,!1),this._indexBuffer=t.createIndexBuffer(this._indices,!1),this._segmentVector=e.SegmentVector.simpleSegment(0,0,36,12),this.primitiveType=e.WebGLConstants.TRIANGLES;}destroy(){super.destroy(),this.type=void 0;}}class du{constructor(t){this.context=t.context,this.pixelFormat=t.pixelFormat,this.texture=this.context.gl.createTexture(),this._powerOfTwoCalculated=!1,this.powerOfTwoNoneSquareFlag=!1,this.flipY=!(!t||!t.flipY),this._target=t.target||e.WebGLConstants.TEXTURE_CUBE_MAP,this._fboTextureParameter=t.fboTextureParameter,t.texture?this.texture=t.texture:this.update(t);}update(t){const{images:i}=t,{context:s}=this,{gl:r}=s;s.pixelStoreUnpackFlipY.set(this.flipY),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(!(!t||!t.premultiply)),r.bindTexture(this._target,this.texture);const n=e.CONSTS.SOURCE.TEXTURE_CUBE_KEYS;for(let t=0;t<6;t++)void 0===i&&this._fboTextureParameter?r.texImage2D(e.WebGLConstants.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,e.WebGLConstants.RGBA,this._fboTextureParameter.width,this._fboTextureParameter.height,0,e.WebGLConstants.RGBA,e.WebGLConstants.UNSIGNED_BYTE,null):r.texImage2D(e.WebGLConstants.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,e.WebGLConstants.RGBA,e.WebGLConstants.RGBA,e.WebGLConstants.UNSIGNED_BYTE,i[n[t]]);r.texParameteri(this._target,e.WebGLConstants.TEXTURE_MAG_FILTER,e.WebGLConstants.LINEAR),r.texParameteri(this._target,e.WebGLConstants.TEXTURE_MIN_FILTER,e.WebGLConstants.LINEAR),r.texParameteri(this._target,e.WebGLConstants.TEXTURE_WRAP_S,e.WebGLConstants.CLAMP_TO_EDGE),r.texParameteri(this._target,e.WebGLConstants.TEXTURE_WRAP_T,e.WebGLConstants.CLAMP_TO_EDGE),r.bindTexture(this._target,null);}bind(t){const{context:i}=this,{gl:s}=i;s.bindTexture(this._target,this.texture),s.texParameteri(this._target,e.WebGLConstants.TEXTURE_MAG_FILTER,e.WebGLConstants.LINEAR),s.texParameteri(this._target,e.WebGLConstants.TEXTURE_MIN_FILTER,e.WebGLConstants.LINEAR),s.texParameteri(this._target,e.WebGLConstants.TEXTURE_WRAP_S,e.WebGLConstants.CLAMP_TO_EDGE),s.texParameteri(this._target,e.WebGLConstants.TEXTURE_WRAP_T,e.WebGLConstants.CLAMP_TO_EDGE),t||s.bindTexture(this._target,null);}destroy(){if(!this.context)return;const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null,this.context=null;}}class mu extends e.Material{constructor(e){super(e),this._opacity=1,this._onGround=!1,this._fboTextureCube=void 0,this._renderState=this.createRenderState(),this.createUniforms(),this._transformValues={};}createRenderState(){const t={};return t.depthTest=e.renderStateEnum.disableDepthTest,t.depthMask=e.renderStateEnum.disableDepthMask,t.stencilTest=e.renderStateEnum.disableStencilTest,t}buildDefines(){const t={HAS_STARRY_SKY_MAP:e.defined(this.starrySkyTexture),HAS_DAY_MAP:e.defined(this.dayTexture)};this.defines=t;}update(t,i,s={}){let r;super.update(t,i,s),this._transformValues={_fov:t.style.symbolMatrixHelper.fov,aspect:t.width/t.height,width:t.width,height:t.height,pitch:t.style.symbolMatrixHelper.getMapViewParams().pitch*e.CONSTS.TRANSFORM.DEG_TO_RAD,heading:-t.transform.hpr.heading,lng:t.style.symbolMatrixHelper.getMapViewParams().lng},r=null==t.frameState.sunLight?12:new Date(t.frameState.sunLight.timestamp).getHours(),this.updateOpacity(t.style.getNearestTileZoom(),r),this._uniforms.set("u_matrixSkyBox",(()=>{const i=new e.Matrix4([0]).perspective({fov:this._transformValues._fov,aspect:this._transformValues.aspect,near:1,far:100});let s=new e.Matrix4;if(null!=t.frameState.sunLight&&(s=e.Transforms.computeTemeToPseudoFixedMatrix(new Date(t.frameState.sunLight.timestamp))),this._onGround){const t=.1,r=new e.Vector3,n=(new e.Matrix4).scale([1,-1,1]),o=this._transformValues.pitch,a=this._transformValues.heading;n.rotateX(o).rotateZ(a-this._transformValues.lng*(Math.PI/180));const l=(Math.PI/2-o)*(this._transformValues.height/this._transformValues._fov)*t;return i[8]=2*-r.x/this._transformValues.width,i[9]=2*(r.y+l)/this._transformValues.height,e.Matrix4.multiply(new e.Matrix4,n.multiplyLeft(i),s)}{const r=t.frameState.camera.matrixWorldInverse.getRotation();return e.Matrix4.multiply(new e.Matrix4,r.multiplyLeft(i),s)}}));}upload(){this._program&&this._program._setUniforms(this._uniforms);}updateOpacity(t,i){const s=[0,.3,1],r=[0,5,15],n=e.smoothstep(7,8,t);this._opacity=function(){const i=r.length;if(t<=r[0])return s[0];if(t>=r[i-1])return s[i-1];const n=e.findStopLessThanOrEqualTo(r,t),o=e.Interpolate.interpolationFactor({name:"linear"},t,r[n],r[n+1]);return e.number(s[n],s[n+1],o)}()*n*function(e){return e>6&&e<18?1:.02}(i),this._onGround=t>7;}createUniforms(){this._uniforms.set("u_cubemap",(()=>this._fboTextureCube)),this._uniforms.set("u_dayTextureMap",(()=>this.dayTexture)),this._uniforms.set("u_starrySkyTextureMap",(()=>this.starrySkyTexture)),this._uniforms.set("u_Opacity",(()=>this._opacity));}destroy(){}}class pu extends e.Material{constructor(e){super(e),this._renderState=this.createRenderState(),this.createUniforms();}createRenderState(){const t={};return t.depthTest=e.renderStateEnum.disableDepthTest,t.stencilTest=e.renderStateEnum.disableStencilTest,t.blending=e.renderStateEnum.disableBlending,t}setMatrixByFaces(t){switch(this._faceRotate=new e.Matrix4,t){case e.CONSTS.SOURCE.TEXTURE_CUBE_KEYS[0]:this._faceRotate.identity(),this._faceRotate.rotateY(.5*-Math.PI);break;case e.CONSTS.SOURCE.TEXTURE_CUBE_KEYS[1]:this._faceRotate.identity(),this._faceRotate.rotateY(.5*Math.PI);break;case e.CONSTS.SOURCE.TEXTURE_CUBE_KEYS[2]:this._faceRotate.identity(),this._faceRotate.rotateX(.5*-Math.PI);break;case e.CONSTS.SOURCE.TEXTURE_CUBE_KEYS[3]:this._faceRotate.identity(),this._faceRotate.rotateX(.5*Math.PI);break;case e.CONSTS.SOURCE.TEXTURE_CUBE_KEYS[4]:this._faceRotate.identity();break;case e.CONSTS.SOURCE.TEXTURE_CUBE_KEYS[5]:this._faceRotate.identity(),this._faceRotate.rotateY(Math.PI);}}update(e,t,i={}){super.update(e,t,i);}createUniforms(){this._uniforms.set("u_matrix_3f",(()=>{const t=new e.Matrix3;return t.set(this._faceRotate[0],this._faceRotate[1],this._faceRotate[2],this._faceRotate[4],this._faceRotate[5],this._faceRotate[6],this._faceRotate[8],this._faceRotate[9],this._faceRotate[10]),t})),this._uniforms.set("u_color_tint_r",(()=>new e.Vector4(1,1,1,1))),this._uniforms.set("u_color_tint_m",(()=>new e.Vector4(1,1,1,1))),this._uniforms.set("u_luminance",(()=>5e-5));}}class fu{constructor(t){t=t||{},this.type="scene-object",this.starrySkyTextureUrls=t.starrySkyTextureUrls,this.dayTextureUrls=t.dayTextureUrls,this.id=`skybox-${e.uniqueId()}`,this.checkInputTextureExists(t)&&(this._ready=!0),this.isSceneObject=!0,this.initialized=!1;}checkInputTextureExists(e){return !(!e.starrySkyTextureUrls||6!==Object.keys(e.starrySkyTextureUrls).length)}init(t){const{painter:i}=t,{context:s}=i;this.geometry=new uu({context:s}),this._skyMaterial=new mu({type:"skybox"}),this._cubeMapRenderingMaterial=new pu({type:"skyboxCapture"}),this.primitive=new e.Primitive({material:this._skyMaterial,geometry:this.geometry,allowPick:!1}),this.primitiveToGenerateTexture=new e.Primitive({material:this._cubeMapRenderingMaterial,geometry:this.geometry,allowPick:!1}),this._prepareTextures(i).then((()=>{this._skyMaterial.buildDefines(),this.initialized=!0;}));}getPrimitiveForPass(){return this.primitiveToGenerateTexture}updateSkyCubeTexture(e){this._skyMaterial._fboTextureCube=e,this.ready=!0;}async _requestBoxImages(t,i){const s=e.CONSTS.SOURCE.TEXTURE_CUBE_KEYS,r=[];for(let n=0;n<6;n++){const o=new Promise(((r,o)=>{e.getImage(t._map._transformRequest(i[s[n]],e.ResourceType.Image),((e,t)=>{e&&o(e),r(t);}));}));r.push(o);}const n=await Promise.all(r),o={};for(let e=0;e<s.length;e++)o[s[e]]=n[e];return this._createTexture(t,o)}async _requestSingleImage(t,i){const s=new Promise(((s,r)=>{e.getImage(t._map._transformRequest(i,e.ResourceType.Image),((e,t)=>{e&&r(e),s(t);}));})),r=await s;return this._createTexture(t,r)}async _createTexture(t,i){const s=new du({context:t.context,images:i,pixelFormat:e.WebGLConstants.RGBA,flipY:!0});return s.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),s}async _prepareTextures(e){this.starrySkyTextureUrls&&(this._skyMaterial.starrySkyTexture=await this._requestBoxImages(e,this.starrySkyTextureUrls)),this.dayTextureUrls&&(this._skyMaterial.dayTexture=await this._requestBoxImages(e,this.dayTextureUrls));}prepare(e){e.shaderProgramManager.setGlobalMacroDefinition({SKYBOX_CUBE_MAP_G:this.isCubeMap}),this._ready=!0;}get ready(){return this._ready}set ready(e){this._ready=e;}onAdd(e){this.init({painter:e.painter});}serialize(){const t={};return e.defined(this.starrySkyTextureUrls)&&(t.starrySkyTextureUrls=this.starrySkyTextureUrls),e.defined(this.dayTextureUrls)&&(t.dayTextureUrls=this.dayTextureUrls),t}destroy(){this.primitive.destroy(),this.primitiveToGenerateTexture.destroy();}loaded(){return this._ready}collect(){return this._ready?[this.primitive]:[]}}class gu extends e.Material{constructor(e){super(e),this._renderState=this.createRenderState(),this.createUniforms(e.painter),this.cloudTime=0;}createRenderState(){const t={};return t.depthTest=e.renderStateEnum.disableDepthTest,t.depthMask=e.renderStateEnum.disableDepthMask,t.stencilTest=e.renderStateEnum.disableStencilTest,t}update(e,t,i={}){super.update(e,t,i),this.cloudTime++;}createUniforms(t){this._uniforms.set("u_earthMap",(()=>(this.earthTexture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.REPEAT),this.earthTexture))),this._uniforms.set("u_earthCloudMap",(()=>(this.earthCloudTexture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.REPEAT),this.earthCloudTexture))),this._uniforms.set("u_earthNightMap",(()=>(this.nightTexture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.REPEAT),this.nightTexture))),this._uniforms.set("u_earthTime",(()=>this.cloudTime/1e3)),this._uniforms.set("u_DayTexPercent",(()=>e.clamp(.25*(t.style.getNearestTileZoom()-1),0,1))),this._uniforms.set("u_GlobalInnerColor",(()=>t._map.directionLightParameter.globalInnerColor)),this._uniforms.set("u_LightPer",(()=>t._map.directionLightParameter.globalLightPercent)),this._uniforms.set("u_NightGlobalPer",(()=>t._map.directionLightParameter.nightGlobalPer)),this._uniforms.set("u_NightVisible",(()=>t._map.directionLightParameter.nightVisible));}destroy(){}}class yu extends e.Material{constructor(t){super(t);const i=t.painter;this._renderState={depthTest:{enabled:!1,func:e.WebGLConstants.LESS},cull:{enabled:!1},blending:{enabled:!0,color:{red:0,green:0,blue:0,alpha:0},equationRgb:e.WebGLConstants.FUNC_ADD,equationAlpha:e.WebGLConstants.FUNC_ADD,functionSourceRgb:e.WebGLConstants.SRC_ALPHA,functionSourceAlpha:e.WebGLConstants.ONE,functionDestinationRgb:e.WebGLConstants.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:e.WebGLConstants.ONE_MINUS_SRC_ALPHA}},this.createUniforms(i);}update(e,t,i={}){super.update(e,t,i);}createUniforms(t){this._uniforms.set("u_GlobalOuterColor",(()=>t._map.directionLightParameter.globalOuterColor)),this._uniforms.set("u_GlobalOuterPara",(()=>t._map.directionLightParameter.globalOuterPara)),this._uniforms.set("u_DayTexPercent",(()=>e.clamp(.25*(t.style.getNearestTileZoom()-1),0,1)));}destroy(){}}function Cu(e,t,i,s){switch(t.type){case e.FLOAT:return new Tu(e,t,i,s);case e.FLOAT_VEC2:return new xu(e,t,i,s);case e.FLOAT_VEC3:return new bu(e,t,i,s);case e.FLOAT_VEC4:return new vu(e,t,i,s);case e.SAMPLER_2D:case e.SAMPLER_CUBE:return new wu(e,t,i,s);case e.INT:case e.BOOL:return new Su(e,t,i,s);case e.INT_VEC2:case e.BOOL_VEC2:return new Au(e,t,i,s);case e.INT_VEC3:case e.BOOL_VEC3:return new Eu(e,t,i,s);case e.INT_VEC4:case e.BOOL_VEC4:return new Mu(e,t,i,s);case e.FLOAT_MAT2:return new Pu(e,t,i,s);case e.FLOAT_MAT3:return new Ru(e,t,i,s);case e.FLOAT_MAT4:return new Bu(e,t,i,s);default:console.warn(`Unrecognized uniform type: ${t.type} for uniform "${i}".`);}}class Tu{constructor(e,t,i,s){this.name=i,this.value=void 0,this._value=0,this._gl=e,this._location=s;}set(){this.value!==this._value&&(this._value=this.value,this._gl.uniform1f(this._location,this.value));}}class xu{constructor(t,i,s,r){this.name=s,this.value=void 0,this._value=new e.Vector2,this._gl=t,this._location=r;}set(){const t=this.value;e.Vector2.equalsArray(t,this._value)||(this._value.copy(t),this._gl.uniform2f(this._location,t.x,t.y));}}class bu{constructor(t,i,s,r){this.name=s,this.value=void 0,this._value=new e.Vector3,this._gl=t,this._location=r;}set(){const t=this.value;t&&e.defined(t.x)&&(e.Vector3.equalsArray(t,this._value)||(this._value.copy(t),this._gl.uniform3f(this._location,t.x,t.y,t.z)));}}class vu{constructor(t,i,s,r){this.name=s,this.value=void 0,this._value=new e.Vector4,this._gl=t,this._location=r;}set(){const t=this.value;e.defined(t.x)&&(e.Vector4.equalsArray(t,this._value)||(this._value.copy(t),this._gl.uniform4f(this._location,t.x,t.y,t.z,t.w)));}}class wu{constructor(e,t,i,s){this.name=i,this.value=void 0,this._gl=e,this._location=s,this.textureUnitIndex=void 0;}set(){const e=this._gl,t=this.value;t?(e.activeTexture(e.TEXTURE0+this.textureUnitIndex),e.bindTexture(t._target,t.texture)):console.error("Error set null Texture!");}_setSampler(e){return this.textureUnitIndex=e,this._gl.uniform1i(this._location,e),e+1}}class Su{constructor(e,t,i,s){this.name=i,this.value=void 0,this._value=0,this._gl=e,this._location=s;}set(){this.value!==this._value&&(this._value=this.value,this._gl.uniform1i(this._location,this.value));}}class Au{constructor(t,i,s,r){this.name=s,this.value=void 0,this._value=new e.Vector2,this._gl=t,this._location=r;}set(){const t=this.value;e.Vector2.equalsArray(t,this._value)||(this._value.copy(t),this._gl.uniform2i(this._location,t.x,t.y));}}class Eu{constructor(t,i,s,r){this.name=s,this.value=void 0,this._value=new e.Vector3,this._gl=t,this._location=r;}set(){const t=this.value;e.Vector3.equalsArray(t,this._value)||(this._value.copy(t),this._gl.uniform3i(this._location,t.x,t.y,t.z));}}class Mu{constructor(t,i,s,r){this.name=s,this.value=void 0,this._value=new e.Vector4,this._gl=t,this._location=r;}set(){const t=this.value;e.Vector4.equalsArray(t,this._value)||(this._value.copy(t),this._gl.uniform4i(this._location,t.x,t.y,t.z,t.w));}}class Pu{constructor(t,i,s,r){this.name=s,this.value=void 0,this._value=new e.Matrix2(e.Matrix2.ZERO),this._gl=t,this._location=r;}set(){if(!e.Matrix2.equalsArray(this.value,this._value)){this._value.copy(this.value);const e=this.value.toFloat32Array();this._gl.uniformMatrix2fv(this._location,!1,e);}}}class Ru{constructor(t,i,s,r){this.name=s,this.value=void 0,this._value=new e.Matrix3(e.Matrix3.ZERO),this._gl=t,this._location=r;}set(){if(!e.Matrix3.equalsArray(this.value,this._value,0)){this._value.copy(this.value);const e=this.value.toFloat32Array();this._gl.uniformMatrix3fv(this._location,!1,e);}}}class Bu{constructor(t,i,s,r){this.name=s,this.value=void 0,this._value=new e.Matrix4(e.Matrix4.ZERO),this._gl=t,this._location=r;}set(){if(!e.Matrix4.equalsArray(this.value,this._value,0)){this._value.copy(this.value);const e=this.value.toFloat32Array();this._gl.uniformMatrix4fv(this._location,!1,e);}}}function Iu(e,t,i,s){switch(t.type){case e.FLOAT:return new Du(e,t,i,s);case e.FLOAT_VEC2:return new Ou(e,t,i,s);case e.FLOAT_VEC3:return new Lu(e,t,i,s);case e.FLOAT_VEC4:return new Vu(e,t,i,s);case e.SAMPLER_2D:case e.SAMPLER_CUBE:return new Nu(e,t,i,s);case e.INT:case e.BOOL:return new Fu(e,t,i,s);case e.INT_VEC2:case e.BOOL_VEC2:return new Gu(e,t,i,s);case e.INT_VEC3:case e.BOOL_VEC3:return new ku(e,t,i,s);case e.INT_VEC4:case e.BOOL_VEC4:return new Uu(e,t,i,s);case e.FLOAT_MAT2:return new Hu(e,t,i,s);case e.FLOAT_MAT3:return new zu(e,t,i,s);case e.FLOAT_MAT4:return new Wu(e,t,i,s);default:console.warn(`Unrecognized uniform type: ${t.type} for uniform "${i}".`);}}class Du{constructor(e,t,i,s){const r=s.length;this.name=i,this.value=new Array(r),this._value=new Float32Array(r),this._gl=e,this._location=s[0];}set(){const e=this.value,t=e.length,i=this._value;let s=!1;for(let r=0;r<t;++r){const t=e[r];t!==i[r]&&(i[r]=t,s=!0);}s&&this._gl.uniform1fv(this._location,i);}}class Ou{constructor(e,t,i,s){const r=s.length;this.name=i,this.value=new Array(r),this._value=new Float32Array(2*r),this._gl=e,this._location=s[0];}set(){const t=this.value,i=t.length,s=this._value;let r=!1,n=0;for(let o=0;o<i;++o){const i=t[o];e.Vector2.equalsArray(i,s,n)||(e.Vector2.pack(i,s,n),r=!0),n+=2;}r&&this._gl.uniform2fv(this._location,s);}}class Lu{constructor(e,t,i,s){const r=s.length;this.name=i,this.value=new Array(r),this._value=new Float32Array(3*r),this._gl=e,this._location=s[0];}set(){const t=this.value,i=t.length,s=this._value;let r=!1,n=0;for(let o=0;o<i;++o){const i=t[o];if(!e.defined(i))break;e.defined(i.r)?i.r===s[n]&&i.g===s[n+1]&&i.b===s[n+2]||(s[n]=i.r,s[n+1]=i.g,s[n+2]=i.b,r=!0):e.defined(i.x)?e.Vector3.equalsArray(i,s,n)||(e.Vector3.pack(i,s,n),r=!0):console.warn("Invalid vec3 value."),n+=3;}r&&this._gl.uniform3fv(this._location,s);}}class Vu{constructor(e,t,i,s){const r=s.length;this.name=i,this.value=new Array(r),this._value=new Float32Array(4*r),this._gl=e,this._location=s[0];}set(){const t=this.value,i=t.length,s=this._value;let r=!1,n=0;for(let o=0;o<i;++o){const i=t[o];e.defined(i.x)&&(e.Vector4.equalsArray(i,s,n)||(e.Vector4.pack(i,s,n),r=!0)),n+=4;}r&&this._gl.uniform4fv(this._location,s);}}class Nu{constructor(e,t,i,s){const r=s.length;this.name=i,this.value=new Array(r),this._value=new Float32Array(r),this._gl=e,this._locations=s,this.textureUnitIndex=void 0;}set(){const e=this._gl,t=e.TEXTURE0+this.textureUnitIndex,i=this.value,s=i.length;for(let r=0;r<s;++r){const s=i[r];e.activeTexture(t+r),e.bindTexture(s._target,s.texture);}}_setSampler(e){this.textureUnitIndex=e;const t=this._locations,i=t.length;for(let s=0;s<i;++s)this._gl.uniform1i(t[s],e+s);return e+i}}class Fu{constructor(e,t,i,s){const r=s.length;this.name=i,this.value=new Array(r),this._value=new Int32Array(r),this._gl=e,this._location=s[0];}set(){const e=this.value,t=e.length,i=this._value;let s=!1;for(let r=0;r<t;++r){const t=e[r];t!==i[r]&&(i[r]=t,s=!0);}s&&this._gl.uniform1iv(this._location,i);}}class Gu{constructor(e,t,i,s){const r=s.length;this.name=i,this.value=new Array(r),this._value=new Int32Array(2*r),this._gl=e,this._location=s[0];}set(){const t=this.value,i=t.length,s=this._value;let r=!1,n=0;for(let o=0;o<i;++o){const i=t[o];e.Vector2.equalsArray(i,s,n)||(e.Vector2.pack(i,s,n),r=!0),n+=2;}r&&this._gl.uniform2iv(this._location,s);}}class ku{constructor(e,t,i,s){const r=s.length;this.name=i,this.value=new Array(r),this._value=new Int32Array(3*r),this._gl=e,this._location=s[0];}set(){const t=this.value,i=t.length,s=this._value;let r=!1,n=0;for(let o=0;o<i;++o){const i=t[o];e.Vector3.equalsArray(i,s,n)||(e.Vector3.pack(i,s,n),r=!0),n+=3;}r&&this._gl.uniform3iv(this._location,s);}}class Uu{constructor(e,t,i,s){const r=s.length;this.name=i,this.value=new Array(r),this._value=new Int32Array(4*r),this._gl=e,this._location=s[0];}set(){const t=this.value,i=t.length,s=this._value;let r=!1,n=0;for(let o=0;o<i;++o){const i=t[o];e.Vector4.equalsArray(i,s,n)||(e.Vector4.pack(i,s,n),r=!0),n+=4;}r&&this._gl.uniform4iv(this._location,s);}}class Hu{constructor(e,t,i,s){const r=s.length;this.name=i,this.value=new Array(r),this._value=new Float32Array(4*r),this._gl=e,this._location=s[0];}set(){const t=this.value,i=t.length,s=this._value;let r=!1,n=0;for(let o=0;o<i;++o){const i=t[o];e.Matrix2.equalsArray(i,s,n)||(e.Matrix2.pack(i,s,n),r=!0),n+=4;}r&&this._gl.uniformMatrix2fv(this._location,!1,s);}}class zu{constructor(e,t,i,s){const r=s.length;this.name=i,this.value=new Array(r),this._value=new Float32Array(9*r),this._gl=e,this._location=s[0];}set(){const t=this.value,i=t.length,s=this._value;let r=!1,n=0;for(let o=0;o<i;++o){const i=t[o];if(!i)break;e.Matrix3.equalsArray(i,s,n)||(e.Matrix3.pack(i,s,n),r=!0),n+=9;}r&&this._gl.uniformMatrix3fv(this._location,!1,s);}}class Wu{constructor(e,t,i,s){const r=s.length;this.name=i,this.value=new Array(r),this._value=new Float32Array(16*r),this._gl=e,this._location=s[0];}set(){const t=this.value,i=t.length,s=this._value;let r=!1,n=0;for(let o=0;o<i;++o){const i=t[o];if(!i)break;e.Matrix4.equalsArray(i,s,n)||(e.Matrix4.pack(i,s,n),r=!0),n+=16;}r&&this._gl.uniformMatrix4fv(this._location,!1,s);}}class ju{constructor(e){this.name=e,this._value={},this._locations={},this.isUniformStruct=!0;}addLocation(e){this._locations[e.name]||(this._locations[e.name]=e.value);}set(){const e=Object.getOwnPropertyNames(this._locations);for(let t=0;t<e.length;t++)this._locations[e[t]].set();}}function Xu(e,t){return new ju(e,t)}Object.defineProperties(ju.prototype,{value:{set(e){if(!function(e,t){const i=Object.getOwnPropertyNames(e),s=Object.getOwnPropertyNames(t);if(i.length!=s.length)return !1;for(let s=0;s<i.length;s++){const r=i[s];if(e[r]!==t[r])return !1}return !0}(e,this._value)){const t=Object.getOwnPropertyNames(e);for(let i=0;i<t.length;i++)this._locations[t[i]].value=(0,e[i])();}}}});const qu={[e.WebGLConstants.POINTS]:1,[e.WebGLConstants.LINES]:2,[e.WebGLConstants.LINE_LOOP]:2,[e.WebGLConstants.LINE_STRIP]:2,[e.WebGLConstants.TRIANGLES]:3};class Ku{constructor(t,i,s){const r=t.gl;this.program=r.createProgram();const n=s?s.getBinderAttributes():[],o=s.defines().concat(this._setMicroDefines(i.defines)),a=o.concat(e.shaders.prelude.fragmentSource,e.shaders.unpackAll.fragmentSource,i.fragmentSource).join("\n"),l=o.concat(e.shaders.prelude.vertexSource,e.shaders.unpackAll.vertexSource,i.vertexSource).join("\n"),h=r.createShader(e.WebGLConstants.FRAGMENT_SHADER);r.shaderSource(h,a),r.compileShader(h),r.attachShader(this.program,h);const _=r.createShader(e.WebGLConstants.VERTEX_SHADER);r.shaderSource(_,l),r.compileShader(_),r.attachShader(this.program,_),this.attributes={},this.numAttributes=n.length;for(let e=0;e<this.numAttributes;e++)n[e]&&(r.bindAttribLocation(this.program,e,n[e]),this.attributes[n[e]]=e);r.linkProgram(this.program),r.deleteShader(_),r.deleteShader(h),this.numAttributes=r.getProgramParameter(this.program,e.WebGLConstants.ACTIVE_ATTRIBUTES);for(let e=0;e<this.numAttributes;e++){const t=r.getActiveAttrib(this.program,e);t&&(this.attributes[t.name]=r.getAttribLocation(this.program,t.name));}const c=s?s.getBinderUniforms():[],u={};for(let e=0;e<c.length;e++){const t=c[e];if(t&&!u[t]){const e=r.getUniformLocation(this.program,t);e&&(u[t]=e);}}this.binderUniforms=s?s.getUniforms(t,u):[],this.programUniforms=Ku.findUniforms(r,this.program),this.programUniforms&&this.programUniforms.samplerUniforms.length>0&&(this.maximumTextureUnitIndex=this._setSamplerUniforms(r,this.program));}_setUniforms(t){const i=this.programUniforms.uniformsByName,s=e.intersectionMapKeys(i,t);for(let e=0;e<s.length;e++){const r=s[e],n=t.get(r),o=i.get(r);if(o.isUniformStruct)for(const e in o._locations)Object.hasOwnProperty.call(o._locations,e)&&(o._locations[e].value=n[e]());else o.value=n();}const r=this.programUniforms.uniforms,n=r.length;for(let e=0;e<n;++e)if(r[e].isUniformStruct)for(const t in r[e]._locations)Object.hasOwnProperty.call(r[e]._locations,t)&&r[e]._locations[t].set();else null!=r[e].value&&r[e].set();}_setSamplerUniforms(e,t){e.useProgram(t);let i=0;const s=this.programUniforms.samplerUniforms.length;for(let e=0;e<s;++e)i=this.programUniforms.samplerUniforms[e]._setSampler(i);return e.useProgram(null),i}_setMicroDefines(e){let t="";for(const i in e)"string"==typeof e[i]&&e[i]?.includes("#define")?t+=`${e[i]}\r\n`:"boolean"==typeof e[i]?e[i]&&(t+=`#define M_${i} \r\n`):t+=`#define M_${i} ${e[i]} \r\n`;return t}draw(t){const{context:i,drawMode:s,layerID:r,layoutVertexBuffer:n,indexBuffer:o,segments:a,configuration:l,dynamicLayoutBuffer:h,dynamicLayoutBuffer2:_,dynamicLayoutBuffer3:c,animationVertexBuffers:u,instanceVerterBuffers:d,numScaleForWireframe:m}=t,p=i.gl,f=qu[s];for(let t=0;t<a.segments.length;t++){const g=a.segments[t],y=g.vaos||(g.vaos={}),C=y[r+s]||(y[r+s]=new za);if(g.isModel)o?(C.bind(i,this,n,[],o,g.vertexOffset,h),g.isInstance?i.drawInstance.drawElementsInstancedANGLE(s,g.modelVertexCount,o.type,g.modelVertexOffset,g.instancesCount):p.drawElements(s,g.modelVertexCount,o.type,g.modelVertexOffset)):(C.bind(i,this,n,[],null,g.vertexOffset,h),g.isInstance?i.drawInstance.drawArraysInstancedANGLE(s,0,g.modelVertexCount,g.instancesCount):p.drawArrays(s,g.modelVertexOffset,g.modelVertexCount));else {if(!n)return;g.isInstance&&o?(C.bind(i,this,n,l?l.getPaintVertexBuffers():[],o,g.vertexOffset,h,_,c,u,d),i.drawInstance.drawElementsInstancedANGLE(s,g.indicesCount,e.WebGLConstants.UNSIGNED_SHORT,0,g.instanceCount)):(C.bind(i,this,n,l?l.getPaintVertexBuffers():[],o||void 0,g.vertexOffset,h,_,c,u),o?p.drawElements(s,g.primitiveLength*f*(m||1),o.type?o.type:e.WebGLConstants.UNSIGNED_SHORT,g.primitiveOffset*f*2):p.drawArrays(s,0,g.vertexLength));}}}static findUniforms(t,i){const s=new Map,r=[],n=[],o=t.getProgramParameter(i,e.WebGLConstants.ACTIVE_UNIFORMS);for(let a=0;a<o;++a){const o=t.getActiveUniform(i,a),l="[0]",h=-1!==o.name.indexOf(l,o.name.length-l.length)?o.name.slice(0,o.name.length-3):o.name;if(0!==h.indexOf("gl_")){const a=t.getUniformLocation(i,h);if(o.name.indexOf(".")>0&&o.name.indexOf("[")<0){const e=o.name.slice(o.name.indexOf(".")+1,o.name.length),i=o.name.slice(0,o.name.indexOf(".")),n=Cu(t,o,e,a);let l=s.get(i);l||(l=Xu(i),s.set(i,l),r.push(l)),l.addLocation({name:e,value:n});}else if(o.name.indexOf("[")<0){if(null!==a){const e=Cu(t,o,h,a);s.set(h,e),r.push(e),e._setSampler&&n.push(e);}}else {let a,l,_,c;const u=h.indexOf("[");if(u>=0){if(a=s.get(h.slice(0,u)),!e.defined(a))continue;l=a._locations,l.length<=1&&(_=a.value,c=t.getUniformLocation(i,h),null!==c&&(l.push(c),_.push(t.getUniform(i,c))));}else {l=[];for(let e=0;e<o.size;++e)c=t.getUniformLocation(i,`${h}[${e}]`),null!==c&&l.push(c);a=Iu(t,o,h,l),s.set(h,a),r.push(a),a._setSampler&&n.push(a);}}}}return {uniformsByName:s,uniforms:r,samplerUniforms:n}}destroy(e){e.gl.deleteProgram(this.program);}}class Ju{constructor(t){this.programCache=new Map,this._context=t.context,this.globalDefinitions={DEVICE_PIXEL_RATIO:e.exported.devicePixelRatio.toFixed(1),TEXTURE_LOD_SUPPORTED:!!this._context.hasLODExtension,STANDARD_DERIVATIVES_SUPPORTED:!!this._context.hasDerivativesExt,LOG_DEPTH:!1,DEPTH_EXT:!!this._context.extFragDepth,UNSUPPORTED_COLOR_BUFFER_FLOAT:!this._context.extColorBufferFloat};}setGlobalMacroDefinition(e){for(const t in e)this.globalDefinitions[t]=e[t];}_makeSpecialKey(t){if(!t)return "";for(const i in this.globalDefinitions)e.defined(t[i])||(t[i]=this.globalDefinitions[i]);const i=Object.keys(t).sort();let s="";for(let e=0;e<i.length;e++){const r=i[e];"boolean"==typeof t[r]?t[r]&&(s+=`${r}:${t[r]},`):s+=`${r}:${t[r]},`;}return s}getFullId(e,t,i){return `${e}_${this._makeSpecialKey(t)}_${i}`}hasProgram(e){return this.programCache.has(e)}getProgramByGLSLMacroDefinition(e,t){const i=this.getFullId(e.type,e.defines,t.cacheKey);return this.hasProgram(i)||(this.globalDefinitions.LOG_DEPTH=this._context._logDepth,e.defines=Object.assign({},e.defines,this.globalDefinitions),this.programCache.set(i,new Ku(this._context,e,t))),this.programCache.get(i)}static getVectorLineDefinition(t,i){const s={};return e.checkIsVectorShadowVolumeDataType(i.classificationType)&&(s.SHADOW_VOLUME=!0),s}static getSphereCircleDefinition(t,i){const s={};return e.checkIsVectorShadowVolumeDataType(i.classificationType)&&(s.SHADOW_VOLUME=!0),s}static getSphereHeatmapDefinition(t,i){const s={};return e.checkIsVectorShadowVolumeDataType(i.classificationType)&&(s.SHADOW_VOLUME=!0),s}static getRasterSourceAndLayerMicroDefinition(){return {}}static getExtrusionMicroDefinition(t,i){const s={};return s.ANS_ENABLED=!!i&&!!i.enabled,s.PHONG_LIGHT=t.lightingModel===e.LightingModelType.PHONG,s}static getEarthMaterialDefinition(t){return {HAS_NIGHT_MAP:e.defined(t.nightTexture),HAS_BASE_MAP:e.defined(t.earthTexture),HAS_CLOUD_MAP:e.defined(t.earthCloudTexture)}}destroy(){this.programCache.forEach((e=>{e.destroy(this._context);})),this.programCache.clear();}}class Zu{constructor(t){this.type="scene-object",this.id="earthCrate-MinemapInternal",this.isSceneObject=!0,this.visible=!0,this.minzoom=t.minzoom?t.minzoom:0,this.maxzoom=t.maxzoom?t.maxzoom:3,t.radius=t.radius||e.CONSTS.TRANSFORM.R,t.widthSegments=t.widthSegments||128,t.heightSegments=t.heightSegments||64,this.url=t.url,this.cloudImageUrl=t.cloudImageUrl,this.nightImageUrl=t.nightImageUrl,this.cloudSpeed=t.cloudSpeed,this.depth=e.defaultValue(t.depth,!1),this.geometry=new Ch(t);}_requestSource(t){if(this.url){const i=new Promise(((i,s)=>{this.url?e.getImage(t._transformRequest(this.url,e.ResourceType.Image),((r,n)=>{r&&s(r);const o=new e.Texture({context:t.painter.context,image:n,pixelFormat:e.WebGLConstants.RGB,useMipmap:!1});o.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.REPEAT),this.material.earthTexture=o,i(!0);})):i(!0);})),s=new Promise(((i,s)=>{this.cloudImageUrl?e.getImage(t._transformRequest(this.cloudImageUrl,e.ResourceType.Image),((r,n)=>{r&&s(r);const o=new e.Texture({context:t.painter.context,image:n,pixelFormat:e.WebGLConstants.RGBA,useMipmap:!1});o.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.REPEAT),this.material.earthCloudTexture=o,i(!0);})):i(!0);})),r=new Promise(((i,s)=>{this.nightImageUrl?e.getImage(t._transformRequest(this.nightImageUrl,e.ResourceType.Image),((r,n)=>{r&&s(r);const o=new e.Texture({context:t.painter.context,image:n,pixelFormat:e.WebGLConstants.RGBA,useMipmap:!1});o.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.REPEAT),this.material.nightTexture=o,i(!0);})):i(!0);}));Promise.all([i,s,r]).then((()=>{this.material.defines=Ju.getEarthMaterialDefinition(this.material),this._ready=!0,t.needRepaint=!0;}));}else this._ready=!0;}onAdd(t){this.painter=t.painter;const i=this.painter._map.directionLightParameter;e.defined(this.cloudSpeed)&&(i.globalLightPercent.y=this.cloudSpeed),this.material=new gu({type:"sphere",painter:this.painter}),this.primitive=new e.Primitive({material:this.material,geometry:this.geometry,modelMatrix:new e.Matrix4}),this.primitive._afterRenderFunction=()=>{this.painter.context.clear(this.depth?{stencil:0}:{depth:1,stencil:0});},this.sphereAtmosphereMaterial=new yu({type:"sphereAtmosphere",painter:this.painter}),this.sphereAtmospherePrimitive=new e.Primitive({material:this.sphereAtmosphereMaterial,geometry:this.geometry,modelMatrix:new e.Matrix4}),this.sphereAtmospherePrimitive._afterRenderFunction=()=>{this.painter.context.clear({depth:1,stencil:0});},this.primitive._geometry.update({painter:this.painter}),this._requestSource(t);}destroy(){this.primitive.destroy();}setNightVisible(e){this.painter._map.directionLightParameter.nightVisible=e;}loaded(){return this._ready}collect(){if(this._ready){let e=!0;const t=this.painter.style.getNearestTileZoom();return t<this.minzoom&&(e=!1),t>this.maxzoom&&(e=!1),this.visible&&e?[this.sphereAtmospherePrimitive,this.primitive]:[]}return []}}const Yu=e.createLayout([{name:"a_PositionHigh",type:"Float32",components:3},{name:"a_PositionLow",type:"Float32",components:3}],4),Qu=e.createLayout([{name:"a_POSITION",type:"Float32",components:3}],4);class $u extends e.Geometry{constructor(e){super(e),this.setData(e);}setData(t){super.setData(t),this.positions=t.positions,this.colors=t.colors,this.arcType=e.defaultValue(t.arcType,e.ARCTYPE.NONE),this.colorsPerVertex=t.colorsPerVertex,this.type="SimplePolylineGeometry",this._usedDoublePrecision=!e.defined(t.referenceCenter),this._vertexArray?this._vertexArray.clear():this._vertexArray=this._usedDoublePrecision?new e.StructArrayLayout3f3f24:new e.StructArrayLayout3f12,this.primitiveType=e.WebGLConstants.LINE_STRIP,this.perSegmentColors=e.defined(t.colors)&&!this.colorsPerVertex,this.granularity=e.CONSTS.CesiumMath.RADIANS_PER_DEGREE,this.ellipsoid=e.Ellipsoid.WGS84,this.minDistance=2*this.ellipsoid.maximumRadius*Math.sin(.5*this.granularity),this._referenceCenter=e.defaultValue(t.referenceCenter,new e.Vector3),this.parse();}updateProperty(e){this.setData(e);}parse(){let t;const i=this.positions.length;let s,r,n,o,a,l;this.needUpdate=!0;let h=0;const _=e.CONSTS.CesiumMath.chordLength(this.granularity,this.ellipsoid.maximumRadius);if(this.arcType===e.ARCTYPE.GEODESIC||this.arcType===e.ARCTYPE.RHUMB){let o;this.arcType===e.ARCTYPE.GEODESIC?(o=_,s=e.PolylinePipeline.numberOfPoints,r=e.PolylinePipeline.generateArc):(o=this.granularity,s=e.PolylinePipeline.numberOfPointsRhumbLine,r=e.PolylinePipeline.generateRhumbArc);const c=e.PolylinePipeline.extractHeights(this.positions,this.ellipsoid),u=new Array(2),d=new Array(2),m={positions:u,height:d,ellipsoid:void 0,minDistance:void 0,granularity:void 0};if(this.arcType===e.ARCTYPE.GEODESIC?m.minDistance=_:m.granularity=this.granularity,m.ellipsoid=this.ellipsoid,this.perSegmentColors){let r=0;for(t=0;t<i-1;t++)r+=s(this.positions[t],this.positions[t+1],o)+1;n=new Float64Array(3*r),a=new Uint8Array(4*r),m.positions=u,m.height=d;let _=0;for(t=0;t<i-1;++t){u[0]=this.positions[t],u[1]=this.positions[t+1],d[0]=c[t],d[1]=c[t+1];const i=e.PolylinePipeline.generateArc(m);if(e.defined(this.colors)){const s=i.length/3;l=this.colors[t];for(let t=0;t<s;++t)a[_++]=e.Color.floatToByte(l.red),a[_++]=e.Color.floatToByte(l.green),a[_++]=e.Color.floatToByte(l.blue),a[_++]=e.Color.floatToByte(l.alpha);}n.set(i,h),h+=i.length;}}else if(m.positions=this.positions,m.height=c,n=new Float64Array(r(m)),e.defined(this.colors)){for(a=new Uint8Array(n.length/3*4),t=0;t<i-1;++t)h=this.interpolateColors(this.positions[t],this.positions[t+1],this.colors[t],this.colors[t+1],this.minDistance,a,h);const s=this.colors[i-1];a[h++]=e.Color.floatToByte(s.red),a[h++]=e.Color.floatToByte(s.green),a[h++]=e.Color.floatToByte(s.blue),a[h++]=e.Color.floatToByte(s.alpha);}this.vertices=n;}else {o=this.perSegmentColors?2*i-2:i,n=new Float64Array(3*o),a=e.defined(this.colors)?new Uint8Array(4*o):void 0;let s=0,r=0;for(t=0;t<i;++t){const o=this.positions[t];if(this.perSegmentColors&&t>0&&(e.Vector3.pack(o,n,s),s+=3,l=this.colors[t-1],a[r++]=e.Color.floatToByte(l.red),a[r++]=e.Color.floatToByte(l.green),a[r++]=e.Color.floatToByte(l.blue),a[r++]=e.Color.floatToByte(l.alpha)),this.perSegmentColors&&t===i-1)break;e.Vector3.pack(o,n,s),s+=3,e.defined(this.colors)&&(l=this.colors[t],a[r++]=e.Color.floatToByte(l.red),a[r++]=e.Color.floatToByte(l.green),a[r++]=e.Color.floatToByte(l.blue),a[r++]=e.Color.floatToByte(l.alpha));}this.vertices=n;}for(let e=0;e<this.vertices.length/3;e++)this.vertices[3*e]=this.vertices[3*e]-this._referenceCenter[0],this.vertices[3*e+1]=this.vertices[3*e+1]-this._referenceCenter[1],this.vertices[3*e+2]=this.vertices[3*e+2]-this._referenceCenter[2];this.computeBoundingSphere(),this.computeBoundingBox(),this.emplaceVertexBufferOfLines();}interpolateColors(t,i,s,r,n,o,a){const l=e.PolylinePipeline.numberOfPoints(t,i,n);let h;const _=s.red,c=s.green,u=s.blue,d=s.alpha,m=r.red,p=r.green,f=r.blue,g=r.alpha;if(e.Color.equals(s,r)){for(h=0;h<l;h++)o[a++]=e.Color.floatToByte(_),o[a++]=e.Color.floatToByte(c),o[a++]=e.Color.floatToByte(u),o[a++]=e.Color.floatToByte(d);return a}const y=(m-_)/l,C=(p-c)/l,T=(f-u)/l,x=(g-d)/l;let b=a;for(h=0;h<l;h++)o[b++]=e.Color.floatToByte(_+h*y),o[b++]=e.Color.floatToByte(c+h*C),o[b++]=e.Color.floatToByte(u+h*T),o[b++]=e.Color.floatToByte(d+h*x);return b}update(t){if(this.needUpdate&&t.painter){this.needUpdate=!1;const i=t.painter.context;this._vertBuffer?this._vertBuffer.updateData(this._vertexArray):this._vertBuffer=i.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?Yu.members:Qu.members,this.dynamicDraw),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.vertices.length/3/2);}}serialize(){const t=[];for(let i=0;i<this.positions.length;i++)t.push(e.Vector3.pack(this.positions[i],new Array(3)));return {type:this.type,positions:t,arcType:this.arcType}}destroy(){super.destroy(),this.vertices=null,this.indices=null,this.ellipsoid=null,this.positions=null,this.colors=null,this.arcType=null,this.colorsPerVertex=null,this.type=null,this._vertexArray=null,this.primitiveType=null,this.perSegmentColors=null,this.granularity=null,this.minDistance=null;}}class ed{constructor(){}static area(t){if(!(t instanceof Array))throw new Error("positions is not type of Array!");if(t.length<3)throw new Error("positions' length must be greater than 3!");const i=[];t.forEach((t=>{if(!(t instanceof e.Vector3))throw new Error("positions' item contains the type of not Vector3!");i.push(t.x),i.push(t.y),i.push(t.z);}));const s=new e.PolygonGeometry({polygonHierarchy:{positions:e.Vector3.fromDegreesArrayHeights(i)},perPositionHeight:!0}),r=s.vertices,n=s.indices,o=[];let a=0;for(let t=0;t<r.length/3;t++){const i=new e.Vector3;i.set(r[3*t],r[3*t+1],r[3*t+2]),o.push(i);}for(let e=0;e<n.length/3;e++)a+=ed.areaFromTriangle([o[n[3*e]],o[n[3*e+1]],o[n[3*e+2]]]);return s.destroy(),a.toFixed(2)}static areaFromTriangle(t){const i=e.Vector3.distance(t[0],t[1]),s=e.Vector3.distance(t[0],t[2]),r=e.Vector3.distance(t[1],t[2]),n=(i+s+r)/2;return Math.sqrt(n*(n-i)*(n-r)*(n-s))}static clampedArea(t,i,s=!1,r=400,n=400){if(!(t instanceof Array))throw new Error("positions is not type of Array!");if(t.length<2)throw new Error("positions' length must be greater than 2!");if(!e.isNumber(r))throw new Error("sampleRatio' is not a number!");if(r<=0)throw new Error("'sampleRatio' should be greater than zero!");if(!e.isNumber(n))throw new Error("minArea' is not a number!");if(n<=0)throw new Error("'minArea' should be greater than zero!");const o=[],a=[];t.forEach((t=>{if(t instanceof e.Vector3)o.push(new e.Vector2(t.x,t.y)),a.push(e.Vector3.fromDegrees(t.x,t.y));else {if(!(t instanceof e.Vector2))throw new Error("positions' item contains the type of not Vector2 or Vector3!");o.push(t),a.push(e.Vector3.fromDegrees(t.x,t.y));}}));const l=e.PolygonPipeline.triangulate(o);let h=l.length;if(h<3)throw new Error("cannot form valid polygon, please check your input");let _=0;for(let e=0;e<h;e+=3)_+=ed.areaFromTriangle([a[l[e]],a[l[e+1]],a[l[e+2]]]);n=Math.max(n,_/r);const c=[];for(let e=0;e<h;e+=3)ed.splitTriangle([l[e],l[e+1],l[e+2]],a,c,n);const u=a.length;if(u>1e4)throw new Error("Too many sample points, please decrease sampleRatio or shrink measured polygon");const d=[],m=new e.StructArrayLayout3f3f24;for(let t=0;t<u;t++){const s=e.Transforms.cartesian3ToCartographic(a[t]);let r=0;if(i.style.rasterSourceCache.terrainSource.isTerrain()&&(r=ll([s[0],s[1]],i.style.rasterSourceCache.terrainSource,i.projection)),!e.defined(r))throw new Error("cannot find terrain");{const t=e.Vector3.fromDegrees(s[0],s[1],r);d.push(t);const i=e.EncodedVector3.encode(t.x),n=e.EncodedVector3.encode(t.y),o=e.EncodedVector3.encode(t.z);m.emplaceBack(i.high,n.high,o.high,i.low,n.low,o.low);}}h=c.length;let p=0;const f=new e.StructArrayLayout2ui4;for(let e=0;e<h;e+=3){const t=[d[c[e]],d[c[e+1]],d[c[e+2]]];f.emplaceBack(c[e],c[e+1]),f.emplaceBack(c[e+1],c[e+2]),f.emplaceBack(c[e+2],c[e]),p+=ed.areaFromTriangle(t);}const g=i.painter.context,y=g.createVertexBuffer(m,Yu.members),C=g.createIndexBuffer(f),T=e.SegmentVector.simpleSegment(0,0,u,h),x=new e.Geometry({vertBuffer:y,indexBuffer:C,segmentVector:T,primitiveType:e.WebGLConstants.LINES});return x._usedDoublePrecision=!0,{geometry:x,area:p.toFixed(2)}}static splitTriangle(t,i,s,r){const n=[i[t[0]],i[t[1]],i[t[2]]];if(ed.areaFromTriangle(n)<r)return void s.push(t[0],t[1],t[2]);const o=[e.Cartographic.fromVector3(n[0]),e.Cartographic.fromVector3(n[1]),e.Cartographic.fromVector3(n[2])],a=[];for(let t=0;t<3;t++){const s=t<2?t+1:0;i.push(e.Vector3.fromRadians((o[t].longitude+o[s].longitude)/2,(o[t].latitude+o[s].latitude)/2)),a.push(i.length-1);}const l=[t[1],a[0],a[1]],h=[t[2],a[1],a[2]],_=[a[0],a[1],a[2]];ed.splitTriangle([t[0],a[0],a[2]],i,s,r),ed.splitTriangle(l,i,s,r),ed.splitTriangle(h,i,s,r),ed.splitTriangle(_,i,s,r);}static distance(t){if(!(t instanceof Array))throw new Error("positions is not type of Array!");if(t.length<2)throw new Error("positions' length must be greater than 2!");let i=[];t.forEach((t=>{if(!(t instanceof e.Vector3))throw new Error("positions' item contains the type of not Vector3!");i=i.concat(e.Vector3.fromDegreesArrayHeights(t));}));let s=0;for(let t=0;t<i.length-1;t++)s+=e.Vector3.distance(i[t],i[t+1]);return s.toFixed(2)}static clampedDistance(t,i,s=!1,r=30){if(!(t instanceof Array))throw new Error("positions is not type of Array!");if(t.length<2)throw new Error("positions' length must be greater than 2!");if(!e.isNumber(r))throw new Error("minDistance' is not a number!");if(r<=0)throw new Error("'minDistance' should be greater than zero!");let n=[];t.forEach((t=>{if(t instanceof e.Vector3)n=n.concat(e.Vector3.fromDegreesArrayHeights(t));else {if(!(t instanceof e.Vector2))throw new Error("positions' item contains the type of not Vector2 or Vector3!");n=n.concat(e.Vector3.fromDegreesArray(t));}}));const o=e.PolylinePipeline.generateCartesianArc({positions:n,height:0,ellipsoid:e.Transforms.DefaultEllipsoid,minDistance:r}),a=o.length;if(a>1e4)throw new Error("Too many points, please decrease sample distance or shorten measured polyline");let l,h,_=0;const c=[];for(let t=0;t<a-1;t++){if(0===t){l=o[0];const t=e.Transforms.cartesian3ToCartographic(l);let s=0;if(i.style.rasterSourceCache.terrainSource.isTerrain()&&(s=ll([t[0],t[1]],i.style.rasterSourceCache.terrainSource,i.projection)),!e.defined(s))throw new Error("cannot find terrain");l=e.Vector3.fromDegrees(t[0],t[1],s),c.push(l);}h=o[t+1];const s=e.Transforms.cartesian3ToCartographic(h);let r=0;if(i.style.rasterSourceCache.terrainSource.isTerrain()&&(r=ll([s[0],s[1]],i.style.rasterSourceCache.terrainSource,i.projection)),!e.defined(r))throw new Error("cannot find terrain");h=e.Vector3.fromDegrees(s[0],s[1],r),c.push(h),_+=e.Vector3.distance(l,h),l=h;}return {geometry:new $u({positions:c,arcType:e.ARCTYPE.NONE}),distance:_.toFixed(2)}}static height(t,i){if(!(t instanceof e.Vector3))throw new Error("startPoint is not type of Vector3!");if(!(i instanceof e.Vector3))throw new Error("endPoint is not type of Vector3!");const s=t.x,r=t.y,n=i.x,o=i.y,a=i.z,l=e.Vector3.fromDegrees(s,r,t.z),h=e.Vector3.fromDegrees(n,o,a),_=e.Vector3.distance(l,e.Vector3.fromDegrees(s,r,a)),c=e.Vector3.distance(h,e.Vector3.fromDegrees(s,r,a)),u=e.Vector3.distance(l,h);return {horizontalDistance:parseFloat(c.toFixed(2)),verticalHeight:parseFloat(_.toFixed(2)),spatialDistance:parseFloat(u.toFixed(2))}}}class td{constructor(t){if(this.type="scene-object",!e.defined(t.data))throw new Error("options.data is required.");if(this._ready=!1,this.data=t.data,this.width=e.defined(t["airline-width"])?t["airline-width"]:1,this.segGroup=e.defined(t["airline-seg-group"])?t["airline-seg-group"]:5,this.speed=e.defined(t["airline-speed"])?t["airline-speed"]:60,this.opacity=e.defined(t["airline-opacity"])?t["airline-opacity"]:1,null!=t["airline-color"]){if(this.steps=t["airline-color"].steps,this.colorIndex=t["airline-color"]["color-index"],null==this.steps||null==this.colorIndex)throw new Error("options.airline-color.steps and options.airline-color.color-index are both required.");if(this.colorIndex>t.data[0].length)throw new Error("options.airline-color.color-index 不可以超过传入数据的范围");this.steps.forEach((t=>{t.push(e.Color.parse(t[1]).toVector3());}));}this.id=e.defined(t.id)?t.id:e.uuid(),this.minzoom=1,this.maxzoom=18,this.visible=!0,this.positions=[],this.lineSegmentation=[],this.colorArray=[],this.parse(t.data),this.getGeometry(),this.material=new e.PolylineMaterial({opacity:this.opacity}),this.material.defines.VERTEX_COLOR=!0;}onAdd(t){this.painter=t.painter;const i=new e.Primitive({material:this.material,geometry:this.staticGeometry,modelMatrix:new e.Matrix4}),s=new e.Primitive({material:this.material,geometry:this.dynamicGeometry,modelMatrix:new e.Matrix4});this.primitive=[i,s],this._ready=!0;}collect(){let e=!0;const t=this.painter.style.getNearestTileZoom();return t<this.minzoom&&(e=!1),t>this.maxzoom&&(e=!1),this.visible&&e?[this.primitive]:[]}parse(e){let t=0;const i=[];e.forEach((e=>{i.push(t);const s=this.getColor(e[this.colorIndex-1]);this.getBSRPoints(e[0],e[1],e[2],e[3],1e4*e[4]).map((e=>{this.positions.push(...e),this.colorArray.push(s),t++;}));})),i.push(t);for(let e=0;e<i.length-1;e++)this.lineSegmentation.push([i[e],i[e+1],i[e],i[e+1]]);}getGeometry(){this.staticGeometry=new e.PolylineGeometry({positions:e.Vector3.fromDegreesArrayHeights(this.positions),width:this.width,arcType:e.ARCTYPE.GEODESIC,lineSegmentation:this.lineSegmentation,colorArray:this.colorArray}),this.dynamicGeometry=new e.PolylineGeometry({positions:e.Vector3.fromDegreesArrayHeights(this.positions),width:this.width+2,arcType:e.ARCTYPE.GEODESIC,lineSegmentation:this.lineSegmentation,colorArray:this.colorArray,speed:this.speed,segGroup:this.segGroup,dynamicAirLine:!0});}getColor(t){if(null==this.steps)return this.getRandomColor();{const i=this.steps.length;if(t<=this.steps[0][0])return [this.steps[0][2][0],this.steps[0][2][1],this.steps[0][2][2]];if(t>=this.steps[i-1][0])return [this.steps[i-1][2][0],this.steps[i-1][2][1],this.steps[i-1][2][2]];for(let s=0;s<i-1;s++)if(t<=this.steps[s+1][0]&&t>=this.steps[s][0]){const i=(t-this.steps[s][0])/(this.steps[s+1][0]-this.steps[s][0]),r=e.Vector3.add(e.Vector3.multiplyByScalar(this.steps[s+1][2],i),e.Vector3.multiplyByScalar(this.steps[s][2],1-i));return [r[0],r[1],r[2]]}}}getRandomColor(){return [Math.random(),Math.random(),Math.random()]}loaded(){return this._ready}destroy(){this.primitive.destroy();}getBSRPoints(t,i,s,r,n){const o=[i,0],a=[(r+i)/2,n],l=[r,0],h=ed.distance([new e.Vector3(t,i,0),new e.Vector3(s,r,0)]),_=this.getBSR(o,a,l,h),c=[];for(const e in _)c.push([(s-t)*(_[e][0]-i)/(r-i)+t,_[e][0],_[e][1]]);return c}getBSR(e,t,i,s){return this.createBezierPoints([{x:e[0],y:e[1]},{x:t[0],y:t[1]},{x:i[0],y:i[1]}],Math.floor(s/14e3))}createBezierPoints(e,t){const i=[];for(let s=0;s<t;s++){const r=this.multiPointBezier(e,s/(t-1));i.push([r.x,r.y]);}return i}multiPointBezier(e,t){const i=e.length;let s=0,r=0;const n=function(e,t){let i=1,s=1;for(;t>0;)i*=e,s*=t,e--,t--;return i/s};for(let o=0;o<i;o++){const a=e[o];s+=a.x*Math.pow(1-t,i-1-o)*Math.pow(t,o)*n(i-1,o),r+=a.y*Math.pow(1-t,i-1-o)*Math.pow(t,o)*n(i-1,o);}return {x:s,y:r}}}class id extends lu{constructor(){super(),this._hasSkyBox=!1,this._hasEarthCrate=!1,this._skyOrders=[];}add(e){if(!(e.id.indexOf("skybox-")>-1&&this._hasSkyBox)){if(!(e.id.indexOf("earthCrate-")>-1&&this._hasEarthCrate)){if(this.has(e.id))throw new Error(`There is already a sceneComponent with this ID: ${e.id}`);return -1!==e.id.indexOf("skybox-")?this._skyOrders.unshift(e.id):-1!==e.id.indexOf("earthCrate-")?this._skyOrders.push(e.id):this._orders.push(e.id),e.id.indexOf("skybox-")>-1&&(this._hasSkyBox=!0),e.id.indexOf("earthCrate-")>-1&&(this._hasEarthCrate=!0),this._data.set(e.id,e),e}console.error("The current map instance has added map skin. Please do not add it again!");}}getSkyAndEarthPrimitives(t,i){i=i||e.checkIsDepthSupportDataType;let s=[];for(let e=0;e<this._skyOrders.length;e++){const t=this.get(this._skyOrders[e]);i(t.classificationType)&&(s=s.concat(t.collect()));}return s}getEarthObject(){for(let e=0;e<this._skyOrders.length;e++){const t=this.get(this._skyOrders[e]);if(t instanceof Zu)return t}}getSkyboxObject(){for(let e=0;e<this._skyOrders.length;e++){const t=this.get(this._skyOrders[e]);if(t instanceof fu)return t}}getTranslucentPrimitives(t,i){i=i||e.checkIsDepthSupportDataType;const s=[];for(let r=0;r<this._orders.length;r++){const n=this.get(this._orders[r]).primitive;for(let r=0;r<n.length;r++){const o=n[r];i(o.classificationType)&&o._material.isTranslucent&&(!t||!o.boundingVolume||t&&t.computeVisibility(o.boundingVolume)!==e.INTERSECTION.OUTSIDE)&&s.push(o);}}return s}getOpaquePrimitives(t,i){const s=[];i=i||e.checkIsDepthSupportDataType;for(let r=0;r<this._orders.length;r++){const n=this.get(this._orders[r]).primitive;for(let r=0;r<n.length;r++){const o=n[r];i(o.classificationType)&&(o._material.isTranslucent||(!t||!o.boundingVolume||t&&t.computeVisibility(o.boundingVolume)!==e.INTERSECTION.OUTSIDE)&&s.push(o));}}return s}removeAll(e){for(super.removeAll(e);this._skyOrders.length>0;)this.removeSky(this._skyOrders[0],e);}serialize(){const e=[];for(let t=0;t<this._orders.length;t++){const i=this.get(this._orders[t]);i instanceof td&&e.push({type:"airLine",data:i.data,"airline-seg-group":i.segGroup,"airline-width":i.width,"airline-speed":i.speed,"airline-opacity":i.opacity,"airline-color":{steps:i.steps,"color-index":i.colorIndex},id:i.id});}return e.length>0?e:void 0}removeSky(e,t){if(this.has(e)){if(t){const t=this.get(e);t.destroy&&t._loaded&&t.destroy();}this._data.delete(e);const i=this._skyOrders.indexOf(e);this._skyOrders.splice(i,1);}}loaded(){for(let e=0;e<this._orders.length;e++)if(!this._data.get(this._orders[e]).loaded())return !1;for(let e=0;e<this._skyOrders.length;e++)if(!this._data.get(this._skyOrders[e]).loaded())return !1;return !0}destroy(){return this.removeAll(!0),e.destroyObject(this)}}class sd extends lu{constructor(){super(),this._data=new Map;}add(e){this.has(e.id)||(this._data.set(e.id,e),this._orders.push(e.id));}getAllPrimitives(){const e=[];for(let t=0;t<this._orders.length;t++){const i=this.get(this._orders[t]);e.push(i);}return e}getPrimitiveById(e){if(!this.has(e))return this.get(this._orders[e])}remove(e){this.get(e)&&this.get(e).destroy(),super.remove(e);}removeAll(e){for(;this._orders.length>0;)this.remove(this._orders[0],e);}getAllNeedRenderPrimitive(){return this.getAllPrimitives()}removeNeedRenderPrimitiveList(){this.removeAll(!0);}destroy(){return this.removeAll(!0),e.destroyObject(this)}}const rd=(t,i)=>e.emitValidationErrors(t,i&&i.filter((e=>"source.canvas"!==e.identifier))),nd=e.pick(Sl,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),od=e.pick(Sl,["setCenter","setZoom","setBearing","setPitch"]),ad=function(){const t={},i=e.spec.$version;for(const s in e.spec.$root){const r=e.spec.$root[s];if(r.required){let e=null;e="version"===s?i:"array"===r.type?[]:{},null!=e&&(t[s]=e);}}return t}();class ld extends e.Evented{constructor(t,i={}){super(),this.map=t,this.dispatcher=new Na((bl||(bl=new Tl),bl),this),this.imageManager=new Ba,this.imageManager.setEventedParent(this),this.glyphManager=new La(t._transformRequest,i.localIdeographFontFamily),this.lineAtlas=new Va(256,512),this.crossTileSymbolIndex=new oh,this.classificationLayer=[],this._layers={},this._customLayers=[],this._order=[],this.sourceCaches={},this.zoomHistory=new e.ZoomHistory,this._loaded=!1,this.firstClassificationTypeId=void 0,this._availableImages=[],this._videoSource=void 0,this.hasTerrainData=!1,this.backgroundColor="#00000000",this.terrainAnalysis=null,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",e.getReferrer());const s=this;this._rtlTextPluginCallback=ld.registerForPluginStateChange((t=>{s.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},((t,i)=>{if(e.triggerPluginCompletionEvent(t),i&&i.every((e=>e)))for(const e in s.sourceCaches)s.sourceCaches[e].reload();}));})),this.modelCollection=new hu({type:"3d-model"}),this.tilesetCollection=new hu({type:"3d-tiles"}),this.scenePointPrimitiveCollection=new _u,this.primitiveCollection=new cu,this.primitivePreRenderCollection=new cu,this.sceneObjectCollection=new id,this.debugBoundingBoxPrimitiveCollection=new sd,this.changWorkerProjection(i.projection||e.ProjectionType.MERCATOR),this.performanceManager=new au(this),this.symbolMatrixHelper=new Ma(this.map.transform),this.on("data",(e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.sourceCaches[e.sourceId];if(!t)return;const i=t.getSource();if(i&&i.vectorLayerIds)for(const e in this._layers){const t=this._layers[e];t.source===i.id&&this._validateLayer(t);}})),this._performanceManagerEvent=this._performanceManagerEvent.bind(this),this.map.on&&this.map.on("moveend",this._performanceManagerEvent),this.map.on&&this.map.on("handler-moveend",this._performanceManagerEvent),this.once("load",(()=>{this.performanceManager.stopAction();})),this.rasterSourceCache=nu("MINEMAP_RASTER_ID",{type:"raster",map:this.map},this.dispatcher),this.proxySourceCache=nu("MINEMAP_PROXY_ID",{type:"proxy",map:this.map},this.dispatcher);}_performanceManagerEvent(){this.performanceManager.forceServericeRequest=!0,this.performanceManager.stopAction(),this.performanceManager.eventDone=!0;}changWorkerProjection(e){this.dispatcher.broadcast("setProjection",{projection:e},(()=>{}));}loadURL(t,i={}){this.fire(new e.Event("dataloading",{dataType:"style"})),i.validate="boolean"==typeof i.validate?i.validate:!ot(t),t=at(t,i.key,i.appKey);const s=this.map._transformRequest(t,e.ResourceType.Style);this._request=e.getJSON(s,((t,s)=>{this._request=null,t?this.fire(new e.ErrorEvent(t)):s&&this._load(s,i);}));}loadJSON(t,i={}){this.fire(new e.Event("dataloading",{dataType:"style"})),this._request=e.exported.frame((()=>{this._request=null,i.validate=!1!==i.validate,this._load(t,i);}));}loadEmpty(){this.fire(new e.Event("dataloading",{dataType:"style"})),this._load(ad,!1);}markOriginalStyle(e){for(const t in e.sourceCaches)e.sourceCaches[t]._original_style=!0;for(const t in e._layers)e._layers[t]._original_style=!0;}registCommonQuadtree(e){this.commonQuadtree=e;}set commonQuadtree(e){this._commonQuadtree=e;}get commonQuadtree(){return this._commonQuadtree||(this._commonQuadtree=Jh({tileSize:512,isLngLat:this.map.transform.projection===e.ProjectionType.LATLON,drawingBufferHeight:this.map.painter.context.gl.drawingBufferHeight,hasTerrainData:this.hasTerrainData,spaceErrorScale:this.map.spaceErrorScale})),this._commonQuadtree}coveringTiles(){return this.commonQuadtree.tilesIn(this.map.transform.activeCamera),this.commonQuadtree.getOverscaledTileIDs()}_load(t,i){if(i.validate&&rd(this,e.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t;for(const e in t.sources)this.addSource(e,t.sources[e],{validate:!1});t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const s=wl(this.stylesheet.layers);this._order=s.map((e=>e.id)),this._layers={};for(let t of s)t=e.createStyleLayer(t),t.setEventedParent(this,{layer:{id:t.id}}),this._layers[t.id]=t,"background"===t.type&&t.getPaintProperty("background-terrain-analysis")&&(this.terrainAnalysis=t.getPaintProperty("background-terrain-analysis"));this.rasterSourceCache.updateLayer(),this.proxySourceCache.updateLayer(),this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.markOriginalStyle(this),this.fire(new e.Event("data",{dataType:"style"})),this.fire(new e.Event("style.load")),this.fire(new e.Event("processStyleJson",{dataType:"style",styleJsonData:t,diff:i.diff,keepUserInfo:i.keepUserInfo,useCustomCamera:i.useCustomCamera}));}_validateLayer(t){const i=this.sourceCaches[t.source];if(!i)return;const s=t.sourceLayer;if(!s)return;const r=i.getSource();("geojson"===r.type||r.vectorLayerIds&&-1===r.vectorLayerIds.indexOf(s))&&this.fire(new e.ErrorEvent(new Error(`Source layer "${s}" does not exist on source "${r.id}" as specified by style layer "${t.id}"`)));}_loadSprite(t){this._spriteRequest=function(t,i,s){const r=[],n=e.exported.devicePixelRatio>1?"@2x":"",o=(e=>{const{url:t}=e;if(!ot(t))return t;const i=mt(t);return i.path=`${st.SRC_URL}/sprite/sprite`,i.path})({url:t,format:n}),a=Array.isArray(st.spriteUrl)?st.spriteUrl:[st.spriteUrl];st.spriteUrl=a?Array.from(new Set([...a])):o;for(let e=0;e<st.spriteUrl.length;e++)(e=>{if("string"==typeof t)r.push({}),l(e,t);else if(t instanceof Array)for(let i=0;i<t.length;i++)r.push({}),l(e+i,t[i]);else console.log(`不支持当前格式的sprite${t}`);})(e);function l(t,o){const a=ct({url:o,format:n,extension:".json",index:t});e.getJSON(i(a,e.ResourceType.SpriteJSON),((e,i)=>{r[t].json=i,r[t].error||(r[t].error=e),Pa(r,st.spriteUrl.length,s);}));const l=ct({url:o,format:n,extension:".png",index:t});e.getImage(i(l,e.ResourceType.SpriteImage),((e,i)=>{r[t].image=i,r[t].error||(r[t].error=e),Pa(r,st.spriteUrl.length,s);}));}}(t,this.map._transformRequest,((t,i)=>{if(this._spriteRequest=null,t)this.fire(new e.ErrorEvent(t));else if(i)for(const e in i)this.imageManager.addImage(e,i[e]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new e.Event("data",{dataType:"style"}));}));}loaded(){if(!this._loaded)return !1;if(Object.keys(this._updatedSources).length)return !1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return !1;if(!this.imageManager.isLoaded())return !1;if(this.skybox&&!this.isSkyboxReady)return !1;if(this.earthSkin&&!this.isEarthSkinReady)return !1;for(const t in this._layers)if(Object.hasOwnProperty.call(this._layers,t)){const i=this._layers[t];if(!(i.lightingModel!==e.LightingModelType.PBR||"3d-model"!==i.type&&"3d-tiles"!==i.type||this.map._iBLtextures&&this.map._iBLtextures.isLoaded))return !1}return !0}_serializeLayers(e){const t=[];for(const i of e){const e=this._layers[i];"custom"!==e.type&&t.push(e.serialize());}return t}hasTransitions(){for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return !0;for(const e in this._layers)if(this._layers[e].hasTransition())return !0;return !1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(this._loaded){if(this._changed){const i=Object.keys(this._updatedLayers),s=Object.keys(this._removedLayers);(i.length||s.length)&&this._updateWorkerLayers(i,s);for(const e in this._updatedSources){const t=this._updatedSources[e];"reload"===t?this._reloadSource(e):"clear"===t&&this._clearSource(e);}for(const e in this._updatedPaintProps)this._layers[e].updateTransitions(t);this._resetUpdates(),this.fire(new e.Event("data",{dataType:"style"}));}for(const e in this.sourceCaches)this.sourceCaches[e].used=!1;for(const e of this._order){const i=this._layers[e];i.recalculate(t,this._availableImages),i.source&&"raster"!==i.type&&(i.isHiddenByMapZoom(this.z)||(this.sourceCaches[i.source].used=!0));}this.z=t.zoom;}}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={};}}_updateWorkerLayers(e,t){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(e),removedIds:t});}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={};}setState(i,s){if(this._checkLoaded(),rd(this,e.validateStyle(i)))return !1;(i=e.clone(i)).layers=wl(i.layers);const r=function(e,i,s){if(!e)return [{command:Sl.setStyle,args:[i]}];let r=[];try{if(!t(e.version,i.version))return [{command:Sl.setStyle,args:[i]}];t(e.center,i.center)||r.push({command:Sl.setCenter,args:[i.center]}),t(e.zoom,i.zoom)||r.push({command:Sl.setZoom,args:[i.zoom]}),t(e.bearing,i.bearing)||r.push({command:Sl.setBearing,args:[i.bearing]}),t(e.pitch,i.pitch)||r.push({command:Sl.setPitch,args:[i.pitch]}),t(e.sprite,i.sprite),t(e.glyphs,i.glyphs)||r.push({command:Sl.setGlyphs,args:[i.glyphs]}),t(e.transition,i.transition)||r.push({command:Sl.setTransition,args:[i.transition]});const n={};i.layers.forEach((e=>{e._original_style=!0;}));for(const e in i.sources)i.sources[e]._original_style=!0;const o=[];!function(e,i,s,r,n){let o;for(o in i=i||{},e=e||{})e.hasOwnProperty(o)&&(n&&!e[o]._original_style||i.hasOwnProperty(o)||El(o,s,r));for(o in i)i.hasOwnProperty(o)&&(e.hasOwnProperty(o)?t(e[o],i[o])||("geojson"===e[o].type&&"geojson"===i[o].type&&Pl(e,i,o)?s.push({command:Sl.setGeoJSONSourceData,args:[o,i[o].data]}):Ml(o,i,s,r,i[o]._original_style)):Al(o,i,s,!!i[o]._original_style));}(e.sources,i.sources,o,n,s);const a=[];e.layers&&e.layers.forEach((e=>{n[e.source]?r.push({command:Sl.removeLayer,args:[e.id]}):a.push(e);})),r=r.concat(o),s&&a.forEach((e=>{e._original_style||i.layers.push(e);})),function(e,i,s,r){i=i||[];const n=(e=e||[]).map(Bl),o=i.map(Bl),a=e.reduce(Il,{}),l=i.reduce(Il,{}),h=n.slice(),_=Object.create(null);let c,u,d,m,p,f,g;for(c=0,u=0;c<n.length;c++)d=n[c],r&&a.hasOwnProperty(d)&&!a[d]._original_style||l.hasOwnProperty(d)?u++:(s.push({command:Sl.removeLayer,args:[d]}),h.splice(h.indexOf(d,u),1));for(c=0,u=0;c<o.length;c++)d=o[o.length-1-c],h[h.length-1-c]!==d&&(a.hasOwnProperty(d)?(s.push({command:Sl.removeLayer,args:[d]}),h.splice(h.lastIndexOf(d,h.length-u),1)):u++,f=h[h.length-c],s.push({command:Sl.addLayer,args:[l[d],f,{isOriginal:l[d]._original_style}]}),h.splice(h.length-c,0,d),_[d]=!0);for(c=0;c<o.length;c++)if(d=o[c],m=a[d],p=l[d],!_[d]&&!t(m,p))if(t(m.source,p.source)&&t(m["source-layer"],p["source-layer"])&&t(m.type,p.type)){for(g in Rl(m.layout,p.layout,s,d,null,Sl.setLayoutProperty),Rl(m.paint,p.paint,s,d,null,Sl.setPaintProperty),t(m.filter,p.filter)||s.push({command:Sl.setFilter,args:[d,p.filter]}),t(m.minzoom,p.minzoom)&&t(m.maxzoom,p.maxzoom)||s.push({command:Sl.setLayerZoomRange,args:[d,p.minzoom,p.maxzoom]}),m)m.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?Rl(m[g],p[g],s,d,g.slice(6),Sl.setPaintProperty):t(m[g],p[g])||s.push({command:Sl.setLayerProperty,args:[d,g,p[g]]}));for(g in p)p.hasOwnProperty(g)&&!m.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?Rl(m[g],p[g],s,d,g.slice(6),Sl.setPaintProperty):t(m[g],p[g])||s.push({command:Sl.setLayerProperty,args:[d,g,p[g]]}));}else s.push({command:Sl.removeLayer,args:[d]}),f=h[h.lastIndexOf(d)+1],s.push({command:Sl.addLayer,args:[p,f,{isOriginal:l[d]._original_style}]});}(a,i.layers,r,s);}catch(e){r=[{command:Sl.setStyle,args:[i]}];}return r}(this.roughSerialize(),i,s).filter((e=>!(e.command in od)));if(0===r.length)return !1;const n=r.filter((e=>!(e.command in nd)));if(n.length>0)throw new Error(`Unimplemented: ${n.map((e=>e.command)).join(", ")}.`);return r.forEach((e=>{"setTransition"!==e.command&&this[e.command].apply(this,e.args);})),this.stylesheet=i,!0}updateImage(e,t){this.imageManager.updateImage(e,t);}addImage(t,i){if(this.getImage(t))return this.fire(new e.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(t,i),this._afterImageUpdated(t);}getImage(e){return this.imageManager.getImage(e)}removeImage(t){if(!this.getImage(t))return this.fire(new e.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(t),this._afterImageUpdated(t),this.fire(new e.Event("data",{dataType:"style"}));}listImages(){return this._checkLoaded(),this._availableImages.slice()}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new e.Event("data",{dataType:"style"}));}addSceneComponent(e){let t;switch(e.type){case"3d-model":t=this.addSceneModel(e);break;case"3d-tiles":t=this.addSceneTileset(e);break;case"scene-object":t=this.addSceneObject(e);}return t}addSceneModel(e){e.map=this.map;const t=new fa(e);return t.load(),this.modelCollection.add(t)}addSceneTileset(e){return e.map=this.map,this.tilesetCollection.add(new Fc(e))}addSceneObject(e){e instanceof fu&&(this._skybox=e),e instanceof Zu&&(this._earthSkin=e),e.onAdd(this.map),this.sceneObjectCollection.add(e);}getSceneComponent(e){return this.modelCollection.get(e)||this.sceneObjectCollection.get(e)||this.tilesetCollection.get(e)}removeSceneComponent(e){if(!this.getSceneComponent(e))throw new Error(`There is no one sceneComponent with this ID: ${e}`);this.modelCollection.remove(e,!0),this.sceneObjectCollection.remove(e,!0),this.tilesetCollection.remove(e,!0);}addPrimitive(e){return e instanceof ph?this.scenePointPrimitiveCollection.add(e):this.primitiveCollection.add(e),e}removePrimitive(t){if(t instanceof ph)return this.scenePointPrimitiveCollection.remove(t.id);if(!(t instanceof e.Primitive))throw new Error("There is not a primitive!");this.primitiveCollection.remove(t.id);}removePrimitiveById(e){this.primitiveCollection.has(e)&&this.primitiveCollection.remove(e);}getPrimitiveById(e){if(this.primitiveCollection.has(e))return this.primitiveCollection.get(e)}addPrimitiveForPreRender(e){this.primitivePreRenderCollection.add(e);}removePrimitiveForPreRender(t){if(!(t instanceof e.Primitive))throw new Error("There is not a primitive!");this.primitivePreRenderCollection.remove(t.id);}addSource(e,t,i){if(this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error(`There is already a source with this ID '${e}'`);if(!t.type)throw new Error(`The type property must be defined, but the only the following properties were given: ${Object.keys(t).join(", ")}.`);if("raster"===t.type||"image"===t.type)this.rasterSourceCache.addSource(e,t);else {this.map&&this.map._collectResourceTiming&&(t.collectResourceTiming=!0);const s=this.sourceCaches[e]=nu(e,t,this.dispatcher);i&&i.isOriginal&&(this.sourceCaches[e]._original_style=!0),s.style=this,s.setEventedParent(this,(()=>({isSourceLoaded:this.loaded(),source:s.serialize(),sourceId:e}))),s.onAdd(this.map);}this._changed=!0;}removeSource(t){this._checkLoaded();const i=this.rasterSourceCache.getSource(t);if(void 0===this.sourceCaches[t]&&!i)throw new Error("找不到对应id的数据源");for(const i in this._layers)if(this._layers[i].source===t)return this.fire(new e.ErrorEvent(new Error(`"${i}"正在使用数据源 "${t}"，无法执行删除操作`)));if(i)this.rasterSourceCache.removeSource(t),this._changed=!0;else {const i=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],i.fire(new e.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),i.setEventedParent(null),i.clearTiles(),i.onRemove&&i.onRemove(this.map),this._changed=!0;}}setGeoJSONSourceData(e,t){this._checkLoaded(),this.sourceCaches[e].getSource().setData(t),this._changed=!0;}getSource(e){return this.rasterSourceCache.getSource(e)||this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(t,i,s){this._checkLoaded();const r=t.id;if(this.getLayer(r))return void this.fire(new e.ErrorEvent(new Error(`Layer with id "${r}" already exists on this map`)));let n;if("custom"===t.type)return n=e.createStyleLayer(t),n.onAdd&&n.onAdd(this.map),void this._customLayers.push(n);if("object"==typeof t.source&&(this.addSource(r,t.source),t=e.clone(t),t=e.extend(t,{source:r})),this._validate(e.validateStyle.layer,`layers.${r}`,t,{arrayIndex:-1},s))return;n=e.createStyleLayer(t),this._validateLayer(n),"background"===n.type&&n.getPaintProperty("background-terrain-analysis")&&(this.terrainAnalysis=n.getPaintProperty("background-terrain-analysis")),n.setEventedParent(this,{layer:{id:r}}),n.uuid=e.uuid();const o=i?this._order.indexOf(i):this._order.length;if(i&&-1===o)this.fire(new e.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`)));else {if(null!=t.lightingModel&&(n.lightingModel=t.lightingModel),e.checkIsVectorShadowVolumeDataType(n.classificationType)?this.classificationLayer.indexOf(r)<0&&this.classificationLayer.push(r):this._order.splice(o,0,r),this.classificationLayer.length>0&&(this.classificationLayer.forEach((e=>{const t=this._order.indexOf(e);t>-1&&this._order.splice(t,1);})),this._order=this._order.concat(this.classificationLayer)),this._layerOrderChanged=!0,this._layers[r]=n,s&&s.isOriginal&&(this._layers[r]._original_style=!0),this._removedLayers[r]&&n.source&&"custom"!==n.type&&"raster"!==n.type){const e=this._removedLayers[r];delete this._removedLayers[r],e.type!==n.type?this._updatedSources[n.source]="clear":(this._updatedSources[n.source]="reload",this.sourceCaches[n.source].pause());}this._updateLayer(n),n.onAdd&&n.onAdd(this.map),"raster"===n.type?this.rasterSourceCache.updateLayer():"background"===n.type?this.rasterSourceCache.updateLayer(!0):!this.sourceCaches[n.source]?.adaptTerrain||"line"!==n.type&&"fill"!==n.type||this.proxySourceCache.updateLayer();}}updateHasTerrainFlag(){this.hasTerrainData=this.rasterSourceCache.terrainSource.isTerrain(),this.map.transform.terrainRender=this.hasTerrainData,this.map.transform.terrainSupplier=this.rasterSourceCache.terrainSource;}resetSourceQuadtree(){for(const e in this.sourceCaches)this.sourceCaches[e].resetQuadtree&&this.sourceCaches[e].resetQuadtree();}getId(e){return this._order[e]}moveLayer(t,i){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===i)return;const s=this._order.indexOf(t);this._order.splice(s,1);const r=i?this._order.indexOf(i):this._order.length;i&&-1===r?this.fire(new e.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`))):(this._order.splice(r,0,t),this.rasterSourceCache.updateLayer(),this.proxySourceCache.updateLayer(),this._layerOrderChanged=!0);}upwardMoveLayer(t,i){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===i)return;const s=this._order.indexOf(t);this._order.splice(s,1);const r=i?this._order.indexOf(i):this._order.length;i&&-1===r?this.fire(new e.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`))):(this._order.splice(r+1,0,t),this._layerOrderChanged=!0);}removeLayer(t){this._checkLoaded();const i=this._layers[t];if(!i)return void this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));this.classificationLayer.length>0&&(this.classificationLayer=this.classificationLayer.filter((e=>e!=t))),i.setEventedParent(null);const s=this._order.indexOf(t);this._order.splice(s,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=i,delete this._layers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],"raster"===i.type?(this.rasterSourceCache.updateLayer(),i.onRemove&&i.onRemove(this.map)):"background"===i.type?i.getPaintProperty("background-terrain-analysis")&&(this.terrainAnalysis=null,this.rasterSourceCache.clearTiles()):!this.sourceCaches[i.source]?.adaptTerrain||"line"!==i.type&&"fill"!==i.type||this.proxySourceCache.updateLayer();}getLayer(e){return this._layers[e]}setLayerZoomRange(t,i,s){this._checkLoaded();const r=this.getLayer(t);r?r.minzoom===i&&r.maxzoom===s||(null!=i&&(r.minzoom=i),null!=s&&(r.maxzoom=s),this._updateLayer(r)):this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)));}setSourceFilter(e,t){const i=this.getSource(e);i&&(i.setFilter(t),this._reloadSource(e));}setFilter(i,s){this._checkLoaded();const r=this.getLayer(i);if(r){if(!t(r.filter,s))return null==s?(r.filter=void 0,void this._updateLayer(r)):void(this._validate(e.validateStyle.filter,`layers.${r.id}.filter`,s)||(r.filter=e.clone(s),this._updateLayer(r)))}else this.fire(new e.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)));}getFilter(t){return e.clone(this.getLayer(t).filter)}setLayoutProperty(i,s,r){this._checkLoaded();const n=this.getLayer(i);n?t(n.getLayoutProperty(s),r)||(n.setLayoutProperty(s,r),this._updateLayer(n),!this.sourceCaches[n.source]?.adaptTerrain||"line"!==n.type&&"fill"!==n.type||this.proxySourceCache.updateLayer()):this.fire(new e.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)));}getLayoutProperty(t,i){const s=this.getLayer(t);if(s)return s.getLayoutProperty(i);this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)));}setPaintProperty(i,s,r){this._checkLoaded();const n=this.getLayer(i);n?t(n.getPaintProperty(s),r)||(n.setPaintProperty(s,r)&&this._updateLayer(n),this._changed=!0,this._updatedPaintProps[i]=!0,!this.sourceCaches[n.source]?.adaptTerrain||"line"!==n.type&&"fill"!==n.type||this.proxySourceCache.updateLayer()):this.fire(new e.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)));}getPaintProperty(e,t){return this.getLayer(e).getPaintProperty(t)}setFeatureState(t,i){this._checkLoaded();const s=t.source,r=t.sourceLayer,n=this.getSource(s);if(void 0===n)return void this.fire(new e.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)));const o=n.type;"geojson"===o&&r?this.fire(new e.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==o||r?(void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided."))),this.sourceCaches[s].setFeatureState(r,t.id,i)):this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));}removeFeatureState(t,i){this._checkLoaded();const s=t.source,r=this.getSource(s);if(void 0===r)return void this.fire(new e.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)));const n=r.type,o="vector"===n?t.sourceLayer:void 0;"vector"!==n||o?i&&"string"!=typeof t.id&&"number"!=typeof t.id?this.fire(new e.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):this.sourceCaches[s].removeFeatureState(o,t.id,i):this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));}getFeatureState(t){this._checkLoaded();const i=t.source,s=t.sourceLayer,r=this.getSource(i);if(void 0!==r){if("vector"!==r.type||s)return void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided."))),this.sourceCaches[i].getFeatureState(s,t.id);this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));}else this.fire(new e.ErrorEvent(new Error(`The source '${i}' does not exist in the map's style.`)));}getTransition(){return e.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t=this.map.getCameraPosition();return e.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:e.combine(this.stylesheet.metadata,{enableNormal:this.map._enableNormal,resolvePass:this.map._resolvePass}),sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:e.mapObject(this.map.getAllSources(),(e=>e.serialize())),layers:this._serializeLayers(this._order),IBL:this.stylesheet.IBL,animations:e.defined(this.map.animationManager.serialize())?this.map.animationManager.serialize().contents:void 0,camera:{position:[t.x,t.y,t.z],pitch:this.map.getCameraPitch(),bearing:this.map.getCameraBearing(),roll:this.map.getCameraRoll()},projection:this.map.projection,postProcess:this.map.postProcessStages.serialize(),videoProjection:this.map.videoManager.serialize(),analysis:{cutFill:this.map.analysis.cutFillCollection.serialize(),viewDome:this.map.analysis.viewDomeCollection.serialize(),viewshed:this.map.analysis.viewshed3DCollection.serialize(),sightLine:this.map.analysis.sightlineCollection.serialize(),excavation:this.map.analysis.excavationCollection.serialize(),highlight:this.map.analysis.highlightCollection.serialize()},lights:this.map.painter.frameState.lightSerialize(),sceneComponent:{sceneModels:this.modelCollection.serialize(),sceneTilesets:this.tilesetCollection.serialize(),primitives:this.primitiveCollection.serialize(),sceneObjects:this.sceneObjectCollection.serialize(),skybox:e.defined(this.skybox)?this.skybox.serialize():void 0},terrain:this.rasterSourceCache.terrainSource.serialize(),particleSystem:{}},(e=>void 0!==e))}roughSerialize(){return e.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:this.sourceCaches,layers:this._serializeLayers(this._order)},(e=>void 0!==e))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&"raster"!==e.type&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._changed=!0;}_flattenRenderedFeatures(e){const t=[],i=[];for(let s=this._order.length-1;s>=0;s--){const r=this._order[s];for(const s of e){const e=s[r],n=this._layers[r].type;if(e)if("extrusion"===n||"histogram"===n||"3d-tiles"===n||"3d-model"===n||"raster"===n)for(const t of e)i.push(t);else for(const i of e)t.push(i);}}i.sort(((e,t)=>e.intersectionZ-t.intersectionZ));for(const e of i)t.push(e);return t}queryRenderedFeatures(t,i,s,r){i&&i.filter&&this._validate(e.validateStyle.filter,"queryRenderedFeatures.filter",i.filter);const n={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new e.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const e of i.layers){const t=this._layers[e];if(!t)return [];n[t.source]=!0;}}const o=[];i.availableImages=this._availableImages,this.ray=this.map.painter.getPickRay(t[0]),this.fire(new e.Event("data",{}));for(const e in this.sourceCaches){if(i.layers&&!n[e])continue;const a=this.sourceCaches[e].getSource().type;"3d-tiles"===a||"3d-model"===a||(o.push(gl(this.sourceCaches[e],this._layers,t,i,s)),i.modelHighlight||o.push(fl(this.sourceCaches[e],this._layers,t,i,this.symbolMatrixHelper,r)));}return this.placement&&o.push(function(e,t,i,s,r){const n={},o=r.getFeatureByGPUPick(i[0],!0,!0);if(o&&o.isSymbolData){const e=o.evaluate();-1!==s.layers.indexOf(e.layer.id)&&(n[e.layer.id]=[e]);}for(const i in n)n[i].forEach((s=>{const r=t[e[i].source].getFeatureState(s.layer["source-layer"],s.id);s.source=s.layer.source,s.layer["source-layer"]&&(s.sourceLayer=s.layer["source-layer"]),s.state=r;}));return n}(this._layers,this.sourceCaches,t,i,this.map.painter)),this._flattenRenderedFeatures(o)}querySourceFeatures(t,i){i&&i.filter&&this._validate(e.validateStyle.filter,"querySourceFeatures.filter",i.filter);const s=this.sourceCaches[t];return s?function(e,t){const i=e.getRenderableIds().map((t=>e.getTileByID(t))),s=[],r={};for(let e=0;e<i.length;e++){const n=i[e],o=n.tileID.canonical.key;r[o]||(r[o]=!0,n.querySourceFeatures(s,t));}return s}(s,i):[]}addSourceType(e,t,i){return ld.getSourceType(e)?i(new Error(`A source type called "${e}" already exists.`)):(ld.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},i):i(null,null))}_validate(t,i,s,r,n){return (!n||!1!==n.validate)&&rd(this,t.call(e.validateStyle,e.extend({key:i,style:this.serialize(),value:s,styleSpec:e.spec},r)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._layers)this._layers[e].setEventedParent(null),delete this._layers[e];for(const e in this.sourceCaches)this.sourceCaches[e].clearTiles(),this.sourceCaches[e].setEventedParent(null),delete this.sourceCaches[e];this.performanceManager.resourcePerformaceManager.updateSourceCaches.length>0&&(this.map.off("moveend",this._performanceManagerEvent),this.map.off("handler-moveend",this._performanceManagerEvent),this.performanceManager=null),this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(),this.proxySourceCache.setEventedParent(null),this.proxySourceCache.clearTiles(),delete this.proxySourceCache,this.rasterSourceCache.setEventedParent(null),this.rasterSourceCache.clearTiles(),delete this.rasterSourceCache,this.debugBoundingBoxPrimitiveCollection.removeAll(!0),this.imageManager.destroy(),this.lineAtlas.destroy(),this.primitiveCollection.destroy(),this.primitivePreRenderCollection.destroy(),this.sceneObjectCollection.destroy(),this.scenePointPrimitiveCollection.destroy(),this.stylesheet=void 0,this._availableImages=[],this._order=[],this.tilesetCollection.destroy(),e.defined(this.skybox)&&this.skybox.destroy();}_clearSource(e){this.sourceCaches[e].clearTiles();}_reloadSource(e){this.sourceCaches[e]&&(this.sourceCaches[e].resume(),this.sourceCaches[e].reload());}_updateSources(){this.performanceManager.stopAction();}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e);}_updatePlacement(t,i,s,r,n=!1){let o=!1,a=!1;const l={};for(const e of this._order){const t=this._layers[e];if("symbol"!==t.type&&"symtracking"!==t.type)continue;if(!l[t.source]){const e=this.sourceCaches[t.source];l[t.source]=e.getRenderableIds().map((t=>e.getTileByID(t))).sort(((e,t)=>("string"!=typeof e.tileID&&"string"!=typeof t.tileID?t.tileID.overscaledZ-e.tileID.overscaledZ:0)||("string"!=typeof e.tileID&&"string"!=typeof t.tileID&&e.tileID.isLessThan(t.tileID)?-1:1)));}const i=this.crossTileSymbolIndex.addLayer(t,l[t.source]);o=o||i;}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((n=n||this._layerOrderChanged||0===s)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.exported.now()))&&(this.pauseablePlacement=new eh(this,t,this._order,n,i,s,r),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(this.placement,e.exported.now()),a=!0),o&&this.pauseablePlacement.placement.setStale()),a||o)for(const e of this._order){const t=this._layers[e];"symbol"!==t.type&&"symtracking"!==t.type||this.placement.updateLayerOpacities(t,l[t.source]);}return !this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.exported.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles();}getImages(e,t,i){this.imageManager.getImages(t.icons,i),this._updateTilesForChangedImages();const s=this.sourceCaches[t.source];s&&s.setDependencies(t.tileID.key,t.type,t.icons);}getGlyphs(e,t,i){this.glyphManager.getGlyphs(t.stacks,i);}getResource(t,i,s){return e.makeRequest(i,s)}clearWorkerCaches(){this.dispatcher.broadcast("clearCaches");}get skybox(){return this._skybox}get isSkyboxReady(){return this._skybox&&this._skybox.loaded()}get earthSkin(){return this._earthSkin}get isEarthSkinReady(){return this._earthSkin&&this._earthSkin.loaded()}getNearestTileZoom(){return this.symbolMatrixHelper.zoom}updateSymbolHelperMatrix(){const t=this.map.transform.activeCamera.heading,i=this.map.transform.activeCamera.pitch+.5*Math.PI,s=this.map.transform.activeCamera.roll;this.map.transform.hpr.heading=t,this.map.transform.hpr.pitch=i,this.map.transform.hpr.roll=s,this.symbolMatrixHelper.update({position:new e.Vector3(this.map.transform.activeCamera.cartographicPosition),projection:this.map.projection,screenSize:new e.Vector2(this.map.transform.width,this.map.transform.height),fov:this.map.transform.fov*e.CONSTS.TRANSFORM.DEG_TO_RAD,headingPitchRoll:new e.HeadingPitchRoll(t,i,s)});}}ld.getSourceType=function(e){return dl[e]},ld.setSourceType=function(e,t){dl[e]=t;},ld.registerForPluginStateChange=e.registerForPluginStateChange;class hd{constructor(e){this.context=e,this.default=null,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){this.current===e&&!0!==this.dirty||(this.context.gl.useProgram(e),this.current=e,this.dirty=!1);}}class _d{constructor(t){this.context=t,this.default=e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT1.VALUE,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){this.current===e&&!0!==this.dirty||(this.context.gl.activeTexture(e),this.current=e,this.dirty=!1);}}class cd{constructor(e){this.context=e,this.default=null,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(t){this.current===t&&!0!==this.dirty||(this.context.gl.bindFramebuffer(e.WebGLConstants.FRAMEBUFFER,t),this.current=t,this.dirty=!1);}}class ud{constructor(e){this.context=e,this.default=null,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(t){this.current===t&&!0!==this.dirty||(this.context.gl.bindRenderbuffer(e.WebGLConstants.RENDERBUFFER,t),this.current=t,this.dirty=!1);}}class dd{constructor(e){this.context=e,this.default=null,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(t){this.current===t&&!0!==this.dirty||(this.context.gl.bindTexture(e.WebGLConstants.TEXTURE_2D,t),this.current=t,this.dirty=!1);}}class md{constructor(e){this.context=e,this.default=null,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(t){this.current===t&&!0!==this.dirty||(this.context.gl.bindBuffer(e.WebGLConstants.ARRAY_BUFFER,t),this.current=t,this.dirty=!1);}}class pd{constructor(e){this.context=e,this.default=null,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(t){this.context.gl.bindBuffer(e.WebGLConstants.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1;}}class fd{constructor(e){this.context=e,this.default=null,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){(this.current!==e&&this.context.extVertexArrayObject||!0===this.dirty)&&(this.context.extVertexArrayObject.bindVertexArrayOES(e),this.current=e,this.dirty=!1);}}class gd{constructor(e){this.context=e,this.default=4,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(t){this.current===t&&!0!==this.dirty||(this.context.gl.pixelStorei(e.WebGLConstants.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1);}}class yd{constructor(e){this.context=e,this.default=!1,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(t){this.current===t&&!0!==this.dirty||(this.context.gl.pixelStorei(e.WebGLConstants.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1);}}class Cd{constructor(e){this.context=e,this.default=!1,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(t){this.current===t&&!0!==this.dirty||(this.context.gl.pixelStorei(e.WebGLConstants.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1);}}class Td{constructor(e){this.context=e,this.default={red:!0,green:!0,blue:!0,alpha:!0},this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.current;e.red===t.red&&e.green===t.green&&e.blue===t.blue&&e.alpha===t.alpha&&!0!==this.dirty||(this.context.gl.colorMask(e.red,e.green,e.blue,e.alpha),this.current=e,this.dirty=!1);}}class xd{constructor(e){this.context=e,this.default=255,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){this.current===e&&!0!==this.dirty||(this.context.gl.stencilMask(e),this.current=e,this.dirty=!1);}}class bd{constructor(e){this.context=e,this.default=!0,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){this.current===e&&!0!==this.dirty||(this.context.gl.depthMask(e),this.current=e,this.dirty=!1);}}class vd{constructor(e){this.context=e,this.default={near:0,far:1},this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.current;e.near===t.near&&e.far===t.far&&!0!==this.dirty||(this.context.gl.depthRange(e.near,e.far),this.current=e,this.dirty=!1);}}class wd{constructor(t){this.context=t,this.default={enabled:!1,face:e.WebGLConstants.BACK},this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){if(this.current.enabled!==e.enabled||this.current.face!==e.face||!0===this.dirty){const t=this.context.gl;Dd(t,t.CULL_FACE,e.enabled),e.enabled&&t.cullFace(e.face),this.current=e,this.dirty=!1;}}}class Sd{constructor(e){this.context=e,this.current=this.context.gl.CCW,this.default=this.context.gl.CCW,this.dirty=!1;}set(e){e!==this.current&&(this.context.gl.frontFace(e),this.current=e);}get(){return this.current||this.context.gl.CCW}setDefault(){this.set(this.default);}}class Ad{constructor(e){this.context=e;const t=this.context.gl;this.default={x:0,y:0,width:t.drawingBufferWidth,height:t.drawingBufferHeight},this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.current;e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height&&!0!==this.dirty||(this.context.gl.viewport(e.x,e.y,e.width,e.height),this.dirty=!1),this.current=e;}}class Ed{constructor(e){this.context=e;const t=this.context.gl;this.default={x:0,y:0,width:t.drawingBufferWidth,height:t.drawingBufferHeight},this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.current,i=this.context.gl;e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height&&!0!==this.dirty||(Dd(i,i.SCISSOR_TEST,e.enabled),e.enabled&&i.scissor(e.rectangle.x,e.rectangle.y,e.rectangle.width,e.rectangle.height),this.current=e);}}class Md{constructor(t){this.context=t,this.default={enabled:!1,color:{red:0,green:0,blue:0,alpha:0},equationRgb:e.WebGLConstants.FUNC_ADD,equationAlpha:e.WebGLConstants.FUNC_ADD,functionSourceRgb:e.WebGLConstants.ONE,functionSourceAlpha:e.WebGLConstants.ONE,functionDestinationRgb:e.WebGLConstants.ZERO,functionDestinationAlpha:e.WebGLConstants.ZERO},this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.current,i=this.context.gl;e.enabled==t.enabled&&e.equationRgb==t.equationRgb&&e.equationAlpha==t.equationAlpha&&e.functionSourceRgb==t.functionSourceRgb&&e.functionSourceAlpha==t.functionSourceAlpha&&e.functionDestinationRgb==t.functionDestinationRgb&&e.functionDestinationAlpha==t.functionDestinationAlpha&&e.color.red==t.color.red&&e.color.green==t.color.green&&e.color.blue==t.color.blue&&e.color.alpha==t.color.alpha&&!0!==this.dirty||(Dd(i,i.BLEND,e.enabled),e.enabled&&(i.blendColor(e.color.red,e.color.green,e.color.blue,e.color.alpha),i.blendEquationSeparate(e.equationRgb,e.equationAlpha),i.blendFuncSeparate(e.functionSourceRgb,e.functionDestinationRgb,e.functionSourceAlpha,e.functionDestinationAlpha)),this.current=e);}}class Pd{constructor(t){this.context=t,this.default={enabled:!1,frontFunction:e.WebGLConstants.ALWAYS,backFunction:e.WebGLConstants.ALWAYS,reference:0,mask:-1,frontOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.KEEP},backOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.KEEP}},this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.current,i=this.context.gl;if(e.enabled!==t.enabled||e.frontOperation.fail!==t.frontOperation.fail||e.frontOperation.zFail!==t.frontOperation.zFail||e.frontOperation.zPass!==t.frontOperation.zPass||e.backOperation.fail!==t.backOperation.fail||e.backOperation.zFail!==t.backOperation.zFail||e.backOperation.zPass!==t.backOperation.zPass||e.frontFunction!==t.frontFunction||e.backFunction!==t.backFunction||e.reference!==t.reference||e.mask!==t.mask||!0===this.dirty){if(Dd(i,i.STENCIL_TEST,e.enabled),e.enabled){const t=e.frontFunction,s=e.backFunction,r=e.reference,n=e.mask;i.stencilFunc(t,r,n),i.stencilFuncSeparate(i.BACK,s,r,n),i.stencilFuncSeparate(i.FRONT,t,r,n);const o=e.frontOperation;i.stencilOpSeparate(i.FRONT,o.fail,o.zFail,o.zPass);const a=e.backOperation;i.stencilOpSeparate(i.BACK,a.fail,a.zFail,a.zPass);}this.current=e;}}}class Rd{constructor(t){this.context=t,this.default={enabled:!1,func:e.WebGLConstants.LESS},this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.current,i=this.context.gl;e.enabled===t.enabled&&e.func===t.func&&!0!==this.dirty||(Dd(i,i.DEPTH_TEST,e.enabled),e.enabled&&i.depthFunc(e.func),this.current=e);}}class Bd{constructor(e){this.context=e,this.default={enabled:!1,factor:0,units:0},this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.current,i=this.context.gl;e.enabled===t.enabled&&e.factor===t.factor&&e.units===t.units&&!0!==this.dirty||(Dd(i,i.POLYGON_OFFSET_FILL,e.enabled),e.enabled&&i.polygonOffset(e.factor,e.units),this.current=e);}}class Id{constructor(e){this.context=e,this.default={enabled:!1,value:1,invert:!1},this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.current,i=this.context.gl;e.enabled===t.enabled&&e.invert===t.invert&&e.value===t.value&&!0!==this.dirty||(Dd(this.context,i.SAMPLE_COVERAGE,e.enabled),e.enabled&&i.sampleCoverage(e.value,e.invert),this.current=e);}}function Dd(e,t,i){i?e.enable(t):e.disable(t);}class Od{constructor(t,i){this.painter=i,this.gl=t,this._logDepth=!1,this.program=new hd(this),this.activeTexture=new _d(this),this.bindFramebuffer=new cd(this),this.bindRenderbuffer=new ud(this),this.bindTexture=new dd(this),this.bindVertexBuffer=new md(this),this.bindElementBuffer=new pd(this),this.bindVertexArrayOES=new fd(this),this.pixelStoreUnpack=new gd(this),this.pixelStoreUnpackPremultiplyAlpha=new yd(this),this.pixelStoreUnpackFlipY=new Cd(this),this._pickObjects={},this._nextPickColor=new Uint32Array(1),this._Program=void 0,this.supportPBR=!0,e.ContextLimits._maximumCombinedTextureImageUnits=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),e.ContextLimits._maximumCubeMapSize=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),e.ContextLimits._maximumFragmentUniformVectors=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),e.ContextLimits._maximumTextureImageUnits=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),e.ContextLimits._maximumRenderbufferSize=t.getParameter(t.MAX_RENDERBUFFER_SIZE),e.ContextLimits._maximumTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),e.ContextLimits._maximumVaryingVectors=t.getParameter(t.MAX_VARYING_VECTORS),e.ContextLimits._maximumVertexAttributes=t.getParameter(t.MAX_VERTEX_ATTRIBS),e.ContextLimits._maximumVertexTextureImageUnits=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),e.ContextLimits._maximumVertexUniformVectors=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS);const s=t.getParameter(t.ALIASED_LINE_WIDTH_RANGE);e.ContextLimits._minimumAliasedLineWidth=s[0],e.ContextLimits._maximumAliasedLineWidth=s[1];const r=t.getParameter(t.ALIASED_POINT_SIZE_RANGE);e.ContextLimits._minimumAliasedPointSize=r[0],e.ContextLimits._maximumAliasedPointSize=r[1];const n=t.getParameter(t.MAX_VIEWPORT_DIMS);e.ContextLimits._maximumViewportWidth=n[0],e.ContextLimits._maximumViewportHeight=n[1];const o=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);e.ContextLimits._highpFloatSupported=0!==o.precision;const a=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_INT);e.ContextLimits._highpIntSupported=0!==a.rangeMax,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic?(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT),e.ContextLimits._maximumTextureFilterAnisotropy=this.extTextureFilterAnisotropicMax):e.ContextLimits._maximumTextureFilterAnisotropy=1,this.drawBuffers=Vd(t,["WEBGL_draw_buffers"]),e.ContextLimits._maximumDrawBuffers=this.drawBuffers?t.getParameter(e.WebGLConstants.MAX_DRAW_BUFFERS):1,e.ContextLimits._maximumColorAttachments=this.drawBuffers?t.getParameter(e.WebGLConstants.MAX_COLOR_ATTACHMENTS):1,this.extDebugShaders=Vd(t,["WEBGL_debug_shaders"]),this.extTextureFloat=!!Vd(t,["OES_texture_float"]),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&t.getExtension("OES_texture_half_float_linear"),this.extTextureFloatLinear=!!Vd(t,["OES_texture_float_linear"]),this.extColorBufferFloat=!!Vd(t,["EXT_color_buffer_float","WEBGL_color_buffer_float"]),this.extFloatBlend=!!Vd(t,["EXT_float_blend"]),this.extColorBufferHalfFloat=!!Vd(t,["EXT_color_buffer_half_float"]),this.hasDerivativesExt=t.getExtension("OES_standard_derivatives"),null==this.hasDerivativesExt&&(this.supportPBR=!1,e.warnOnce("OES_standard_Derivatives are not supported")),this.drawInstance=t.getExtension("ANGLE_instanced_arrays"),null==this.drawInstance&&e.warnOnce("ANGLE_instanced_arraysd"),null==t.getExtension("EXT_SRGB")&&(this.supportPBR=!1,e.warnOnce("EXT_SRGB are not supported")),this.hasLODExtension=t.getExtension("EXT_shader_texture_lod"),null==this.hasLODExtension&&(this.supportPBR=!1,e.warnOnce("EXT_shader_texture_lod are not supported")),this.extDepthTexture=!!Vd(t,["WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]),this.extBlendMinmax=!!Vd(t,["EXT_blend_minmax"]),this.extElementIndexUint||t.getExtension("OES_element_index_uint");const l=t.getSupportedExtensions();for(let e=0;e<l.length;e++)"EXT_frag_depth"===l[e]&&(this.extFragDepth=t.getExtension("EXT_frag_depth"));this.maxTextureSize=t.getParameter(e.WebGLConstants.MAX_TEXTURE_SIZE),this._s3tc=!!Vd(t,["WEBGL_compressed_texture_s3tc","MOZ_WEBGL_compressed_texture_s3tc","WEBKIT_WEBGL_compressed_texture_s3tc"]),this._pvrtc=!!Vd(t,["WEBGL_compressed_texture_pvrtc","WEBKIT_WEBGL_compressed_texture_pvrtc"]),this._etc1=!!Vd(t,["WEBGL_compressed_texture_etc1"]),this._astc=!!Vd(t,["WEBGL_compressed_texture_astc"]),this._etc=!!Vd(t,["WEBG_compressed_texture_etc"]),this._bc7=!!Vd(t,["EXT_texture_compression_bptc"]),this._colorMask=new Td(this),this._stencilMask=new xd(this),this._depthMask=new bd(this),this._depthRange=new vd(this),this._cullFace=new wd(this),this._frontFace=new Sd(this),this.viewport=new Ad(this),this._viewport=this.viewport,this._scissorTest=new Ed(this),this._blending=new Md(this),this._stencilTest=new Pd(this),this._depthTest=new Rd(this),this._polygonOffset=new Bd(this),this._sampleCoverage=new Id(this),this._defaultTexture=void 0,this._maxFrameTextureUnitIndex=0,this._clearDepth=1,this._enableNormal=!1;}get defaultTexture(){return this._defaultTexture||(this._defaultTexture=new e.Texture({context:this,source:{width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])},flipY:!1})),this._defaultTexture}get drawingBufferHeight(){return this.gl.drawingBufferHeight}get floatingPointTexture(){return this.extTextureFloat}get drawingBufferWidth(){return this.gl.drawingBufferWidth}setDirty(){this.program.dirty=!0,this.activeTexture.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0;}createIndexBuffer(e,t){return new Go(this,e,t)}createVertexBuffer(t,i,s){return new e.VertexBuffer({context:this,array:t,attributes:i,dynamicDraw:s})}createRenderbuffer(t,i,s){const r=this.gl,n=r.createRenderbuffer();return this.bindRenderbuffer.set(n),r.renderbufferStorage(e.WebGLConstants.RENDERBUFFER,t,i,s),this.bindRenderbuffer.set(null),n}createFramebuffer(t,i){return new Yc({context:this,width:t,height:i,colorTextures:[new e.Texture({image:null,context:this,width:t,height:i,pixelFormat:e.WebGLConstants.RGBA})],depthStencilTexture:new e.Texture({context:this,width:t,height:i,pixelFormat:e.PixelFormat.DEPTH_STENCIL,pixelDatatype:e.PixelDatatype.UNSIGNED_INT_24_8,sampler:e.Sampler.NEAREST})})}draw(t){const{painter:i,layer:s,framebuffer:r,clearStates:n,frameState:o,material:{renderState:a,_uniforms:l,_shaderSource:h,_programConfiguration:_},geometry:{primitiveType:c,_vertBuffer:u,_indexBuffer:d,_segmentVector:m,dynamicLayoutBuffer1:p,dynamicLayoutBuffer2:f,dynamicLayoutBuffer3:g,animationVertexBuffers:y,instanceVerterBuffers:C}}=t,T=i.useProgram(h,_);if(this.bindFramebuffer.set(r),this.setRenderState(a,n,i),_&&_.setUniforms(this,T.binderUniforms,s.paint,{zoom:i.style.getNearestTileZoom()}),T._setUniforms(e.defined(t.material.getMinimumUniforms)?t.material.getMinimumUniforms(o):l),!e.defined(u)||!e.defined(u.context))return;let x,b=c,v=d;if(e.defined(s.drawMode))b=s.drawMode,v=t.geometry.wireframeIndexBuffer,x=3;else if(Array.isArray(s))for(let i=0;i<s.length;i++)if(e.defined(s[i].drawMode)){b=s[i].drawMode,v=t.geometry.wireframeIndexBuffer,x=3;break}T.draw({context:this,drawMode:b,layerID:s.id,layoutVertexBuffer:u,indexBuffer:v,segments:m,configuration:_,dynamicLayoutBuffer:p,dynamicLayoutBuffer2:f,dynamicLayoutBuffer3:g,animationVertexBuffers:y,instanceVerterBuffers:C,numScaleForWireframe:x});}clear({color:t,depth:i,stencil:s}){const r=this.gl;let n=0;t&&(n|=e.WebGLConstants.COLOR_BUFFER_BIT,r.clearColor(t.r,t.g,t.b,t.a)),e.defined(i)&&(i!==this._clearDepth&&(this._clearDepth=i,r.clearDepth(i)),n|=e.WebGLConstants.DEPTH_BUFFER_BIT),void 0!==s&&(n|=e.WebGLConstants.STENCIL_BUFFER_BIT,r.clearStencil(s)),r.clear(n);}setRenderState(t,i,s){t=t instanceof e.RenderState?t:e.RenderState.fromCache(t),e.RenderState.applyRenderState(this,t,s),e.defined(i)&&this.clear({color:i.color,depth:i.depth,stencil:i.stencil});}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null);}createPickId(t){++this._nextPickColor[0];const i=this._nextPickColor[0];if(0===i)throw new Error("Out of unique Pick IDs.");return this._pickObjects[i]=t,new Ld(this._pickObjects,i,e.Color.fromRgba(i))}removePickId(e){e.destroy();}getObjectByPickColor(e){return this._pickObjects[e.toRgba()]}}class Ld{constructor(e,t,i){this._pickObject=e,this.key=t,this.color=i;}get pickObject(){return this._pickObject[this.key]}set pickObject(e){this._pickObject[this.key]=e;}destroy(){this._pickObject[this.key]=void 0,this._pickObject=void 0,this.color=void 0,this.key=void 0;}}function Vd(e,t){const i=t.length;for(let s=0;s<i;++s){const i=e.getExtension(t[s]);if(i)return i}}var Nd=e.createLayout([{name:"a_POSITION",type:"Int16",components:2}]);class Fd{constructor(t){this.type="ViewportQuadGeometry",this.primitiveType=e.WebGLConstants.TRIANGLE_STRIP,this._segmentVector=e.SegmentVector.simpleSegment(0,0,4);const i=new e.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(1,0),i.emplaceBack(0,1),i.emplaceBack(1,1),this.state=e.State.PROCESSINGFISH,this._vertBuffer=t.context.createVertexBuffer(i,Nd.members);}update(){}destroy(){return this.type=void 0,this.primitiveType=void 0,this._vertBuffer.destroy(),this._vertBuffer=void 0,this._segmentVector.destroy(),this._segmentVector=void 0,e.destroyObject(this)}}const{HTMLImageElement:Gd,HTMLCanvasElement:kd,HTMLVideoElement:Ud,ImageData:Hd}=e.window,zd=/uniform\s+sampler2D\s+depthTexture/g;class Wd{constructor(t){const i=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).vertexShader||e.shaders.screen.vertexSource,s=t.fragmentShader,r=e.defaultValue(t.textureScale,1),n=e.defaultValue(t.pixelFormat,e.PixelFormat.RGBA);if(i.constructor!==String)throw new Error("options.vertexShader must be string!");if(s.constructor!==String)throw new Error("options.fragmentShader must be string!");if(r<=0)throw new Error("options.textureScale must be greater than 0!");if(r>1)throw new Error("options.textureScale must be less than 1!");if(!e.PixelFormat.isColorFormat(n))throw new Error("options.pixelFormat must be a color format.");this.extraData={},this._vertexShader=i,this._fragmentShader=s,this._uniforms=t.uniforms,this._textureScale=r,this._forcePowerOfTwo=e.defaultValue(t.forcePowerOfTwo,!1),this._sampleMode=e.defaultValue(t.sampleMode,0),this._pixelFormat=n,this._pixelDatatype=e.defaultValue(t.pixelDatatype,e.PixelDatatype.UNSIGNED_BYTE),this._clearColor=e.defaultValue(t.clearColor,e.Color.black),this._command=void 0,this.shaderSource=new e.ShaderSource({type:t.name,vertexSource:this._vertexShader,fragmentSource:this._fragmentShader}),this._colorTexture=void 0,this._depthTexture=void 0,this._idTexture=void 0,this._actualUniforms={},this._dirtyUniforms=[],this._texturesToRelease=[],this._texturesToCreate=[],this._texturePromise=void 0;const o={};o.scissorTest={enabled:!0,rectangle:e.defined(t.scissorRectangle)?e.BoundingRectangle.clone(t.scissorRectangle):new e.BoundingRectangle},this._passState=o,this._renderState={blending:e.renderStateEnum.disableBlending},this._ready=!1;let a=t.name;e.defined(a)||(a=e.uuid()),this._name=a,this._logDepthChanged=void 0,this._useLogDepth=void 0,this._selectedIdTexture=void 0,this._selected=void 0,this._selectedShadow=void 0,this._parentSelected=void 0,this._parentSelectedShadow=void 0,this._combinedSelected=void 0,this._combinedSelectedShadow=void 0,this._selectedLength=0,this._parentSelectedLength=0,this._selectedDirty=!0,this._textureCache=void 0,this._index=void 0,this.enabled=!0,this._enabled=!0;}get uniformMap(){return this._uniformMap}get ready(){return this._ready}get name(){return this._name}get fragmentShader(){return this._fragmentShader}get uniforms(){return this._uniforms}get textureScale(){return this._textureScale}get forcePowerOfTwo(){return this._forcePowerOfTwo}get sampleMode(){return this._sampleMode}get pixelFormat(){return this._pixelFormat}get pixelDatatype(){return this._pixelDatatype}get clearColor(){return this._clearColor}get scissorRectangle(){return this._passState.scissorTest.rectangle}get outputTexture(){if(e.defined(this._textureCache)){const t=this._textureCache.getFramebuffer(this._name);if(e.defined(t))return t.getColorTexture(0)}}get selected(){return this._selected}set selected(e){this._selected=e;}get parentSelected(){return this._parentSelected}set parentSelected(e){this._parentSelected=e;}_isSupported(e){return !zd.test(this._fragmentShader)||e.extDepthTexture}update(t,i){if(this.enabled===this._enabled||this.enabled||Jd(this),this._enabled=this.enabled,!this._enabled)return;if(this._logDepthChanged=i!==this._useLogDepth,this._useLogDepth=i,this._selectedDirty=function(t){let i=e.defined(t._selected)?t._selected.length:0;const s=e.defined(t._parentSelected)?t._parentSelected:0;let r=t._selected!==t._selectedShadow||i!==t._selectedLength;if(r=r||t._parentSelected!==t._parentSelectedShadow||s!==t._parentSelectedLength,t._combinedSelected=e.defined(t._selected)&&e.defined(t._parentSelected)?t._selected.concat(t._parentSelected):e.defined(t._parentSelected)?t._parentSelected:t._selected,!r&&e.defined(t._combinedSelected)){if(!e.defined(t._combinedSelectedShadow))return !0;i=t._combinedSelected.length;for(let e=0;e<i;++e)if(t._combinedSelected[e]!==t._combinedSelectedShadow[e])return !0}return r}(this),this._selectedShadow=this._selected,this._parentSelectedShadow=this._parentSelected,this._combinedSelectedShadow=this._combinedSelected,this._selectedLength=e.defined(this._selected)?this._selected.length:0,this._parentSelectedLength=e.defined(this._parentSelected)?this._parentSelected.length:0,function(t,i){if(!t._selectedDirty)return;t._selectedIdTexture=t._selectedIdTexture&&t._selectedIdTexture.destroy(),t._selectedIdTexture=void 0;const s=t._combinedSelected;if(!e.defined(s))return;let r,n,o=0;const a=s.length;for(r=0;r<a;++r)n=s[r],e.defined(n.pickIds)?o+=n.pickIds.length:e.defined(n.pickId)&&++o;if(0===a||0===o){const s=new Uint8Array(4);return s[0]=255,s[1]=255,s[2]=255,s[3]=255,void(t._selectedIdTexture=new e.Texture({context:i,pixelFormat:e.PixelFormat.RGBA,pixelDatatype:e.PixelDatatype.UNSIGNED_BYTE,source:{arrayBufferView:s,width:1,height:1},sampler:e.Sampler.NEAREST}))}let l,h=0;const _=new Uint8Array(4*o);for(r=0;r<a;++r)if(n=s[r],e.defined(n.pickIds)){const t=n.pickIds,i=t.length;for(let s=0;s<i;++s)l=t[s].color,_[h]=e.Color.floatToByte(l.red),_[h+1]=e.Color.floatToByte(l.green),_[h+2]=e.Color.floatToByte(l.blue),_[h+3]=e.Color.floatToByte(l.alpha),h+=4;}else e.defined(n.pickId)&&(l=n.pickId.color,_[h]=e.Color.floatToByte(l.red),_[h+1]=e.Color.floatToByte(l.green),_[h+2]=e.Color.floatToByte(l.blue),_[h+3]=e.Color.floatToByte(l.alpha),h+=4);t._selectedIdTexture=new e.Texture({context:i,pixelFormat:e.PixelFormat.RGBA,pixelDatatype:e.PixelDatatype.UNSIGNED_BYTE,source:{arrayBufferView:_,width:o,height:1},sampler:e.Sampler.NEAREST});}(this,t),function(t,i){if(e.defined(t._uniformMap))return;const s=new Map,r={},n=t._uniforms,o=t._actualUniforms;for(const i in n)if(n.hasOwnProperty(i)){"function"!=typeof n[i]?(s.set(i,Xd(t,i)),r[i]=jd(t,n,i)):(s.set(i,n[i]),r[i]=n[i]),o[i]=n[i];const a=s.get(i);("string"==typeof a||a instanceof e.Texture||a instanceof Gd||a instanceof kd||a instanceof Ud)&&(s[`${i}Dimensions`]=qd(s,i));}t._uniforms={},Object.defineProperties(t._uniforms,r),t._uniformMap=e.combineInternalMap(s,new Map([["u_ModelViewProjectionMatrix",()=>(new e.Matrix4).ortho({left:0,right:i.drawingBufferWidth,bottom:i.drawingBufferHeight,top:0,near:0,far:1})],["u_World",()=>new e.Vector2(i.drawingBufferWidth,i.drawingBufferHeight)],["u_Resolution",()=>new e.Vector2(i.painter.width,i.painter.height)],["colorTexture",()=>t._colorTexture],["colorTextureDimensions",()=>t._colorTexture.dimensions],["depthTexture",()=>t._depthTexture],["u_depthTexture",()=>t._depthTexture],["depthTextureDimensions",()=>t._depthTexture.dimensions],["idTexture",()=>t._idTexture],["czm_selectedIdTexture",()=>t._selectedIdTexture],["czm_selectedIdTextureStep",()=>1/t._selectedIdTexture.width],["u_Viewport",()=>{const t=i.viewport.current;return new e.Vector4(t.x,t.y,t.width,t.height)}],["u_FrameTime",()=>Date.now()],["u_PixelRatio",()=>e.exported.devicePixelRatio],["u_ViewportTransformation",()=>{const t=i.viewport.current,s=new e.Matrix4;return e.Matrix4.computeViewportTransformation(t,0,1,s),s}],["u_FrustumPlanes",()=>new e.Vector4(i.painter.frameState.camera.frustumCrate.frustum._offCenterFrustum.top,i.painter.frameState.camera.frustumCrate.frustum._offCenterFrustum.bottom,i.painter.frameState.camera.frustumCrate.frustum._offCenterFrustum.left,i.painter.frameState.camera.frustumCrate.frustum._offCenterFrustum.right)],["u_CurrentFrustum",()=>new e.Vector2(i.painter.transform.near,i.painter.transform.far)],["u_InverseProjection",()=>i.painter.frameState.camera.projectionMatrixInverse]]));}(this,t),function(t,i){let s,r,n;const o=t._texturesToRelease;let a=o.length;for(s=0;s<a;++s)r=o[s],r=r&&r.destroy();o.length=0;const l=t._texturesToCreate;for(a=l.length,s=0;s<a;++s){const r=l[s];n=r.name,t._actualUniforms[n]=new e.Texture({context:i,source:r.source});}l.length=0;const h=t._dirtyUniforms;if(0===h.length&&!e.defined(t._texturePromise))return void(t._ready=!0);if(0===h.length||e.defined(t._texturePromise))return;a=h.length;const _=t._uniforms,c=[];for(s=0;s<a;++s){n=h[s];const i=_[n],r=t._textureCache.getStageByName(i);e.defined(r)?t._actualUniforms[n]=Kd(t,i):"string"==typeof i?c.push(new Promise(((t,s)=>{e.getImage({url:i},((e,i)=>{e&&s(e),t(i);}));}))):t._texturesToCreate.push({name:n,source:i});}h.length=0,c.length>0?(t._ready=!1,t._texturePromise=Promise.all(c).then((()=>{t._ready=!0,t._texturePromise=void 0;}))):t._ready=!0;}(this,t),function(t,i){if(e.defined(t._command)&&!t._logDepthChanged&&!t._selectedDirty)return;let s=t._fragmentShader;if(e.defined(t._selectedIdTexture)){const e=t._selectedIdTexture.width;s=s.replace(/varying\s+vec2\s+v_TexCoord;/g,""),s=`#define CZM_SELECTED_FEATURE \nuniform sampler2D idTexture; \nuniform sampler2D czm_selectedIdTexture; \nuniform float czm_selectedIdTextureStep; \nvarying vec2 v_TexCoord; \nbool czm_selected(vec2 offset) \n{ \n    bool selected = false;\n    vec4 id = texture2D(idTexture, v_TexCoord + offset); \n    for (int i = 0; i < ${e}; ++i) \n    { \n        vec4 selectedId = texture2D(czm_selectedIdTexture, vec2((float(i) + 0.5) * czm_selectedIdTextureStep, 0.5)); \n        if (all(equal(id, selectedId))) \n        { \n            return true; \n        } \n    } \n    return false; \n} \n\nbool czm_selected() \n{ \n    return czm_selected(vec2(0.0)); \n} \n\n${s}`;}t.shaderSource.fragmentSource=e.reduceComma(s),-1!==t.shaderSource.fragmentSource.indexOf("#include")&&console.error("检查着色器文件，里面的#include <>没有被正确替换。请将其前面和后面输入换行符\r\n或者\n，因为它没有被当成一行可以替换的代码。"),t._command={painter:i.painter,framebuffer:void 0,layer:{id:"postprocess"},geometry:new Fd(i.painter),material:{renderState:t._renderState,_uniforms:t._uniformMap,_shaderSource:t.shaderSource}};}(this,t),function(t){let i,s;1===t._sampleMode?(i=e.TextureMinificationFilter.LINEAR,s=e.TextureMagnificationFilter.LINEAR):(i=e.TextureMinificationFilter.NEAREST,s=e.TextureMagnificationFilter.NEAREST);const r=t._sampler;e.defined(r)&&r.minificationFilter===i&&r.magnificationFilter===s||(t._sampler=new e.Sampler({wrapS:e.TextureWrap.CLAMP_TO_EDGE,wrapT:e.TextureWrap.CLAMP_TO_EDGE,minificationFilter:i,magnificationFilter:s}));}(this),this._selectedDirty=!1,!this._ready)return;const s=this._textureCache.getFramebuffer(this._name);if(this._command.framebuffer=s.framebuffer,!e.defined(s))return;const r=s.getColorTexture(0);let n;const[o,a]=r.size;o===t.drawingBufferWidth&&a===t.drawingBufferHeight||(n=this._renderState,e.defined(n)&&o===n.viewport.width&&a===n.viewport.height||(this._renderState=e.RenderState.fromCache({viewport:new e.BoundingRectangle(0,0,o,a)}))),this._command.material.renderState=n;}execute(t,i,s,r){if(!e.defined(this._command)||!this._ready||!this._enabled)return;this._colorTexture=i,this._depthTexture=s,this._idTexture=r,e.Sampler.equals(this._colorTexture.sampler,this._sampler)||(this._colorTexture.sampler=this._sampler,this._depthTexture.sampler=this._sampler);const n=this.scissorRectangle.width>0&&this.scissorRectangle.height>0?this._passState:void 0;e.defined(n)&&e.RenderState.applyRenderState(t,n),t.draw(this._command);}isDestroyed(){return !1}destroy(){return Jd(this),e.destroyObject(this)}}function jd(t,i,s){const r=i[s];return ("string"==typeof r||r instanceof kd||r instanceof Gd||r instanceof Ud||r instanceof Hd)&&t._dirtyUniforms.push(s),{get:()=>i[s],set(r){const n=i[s];i[s]=r;const o=t._actualUniforms,a=o[s];e.defined(a)&&a!==n&&a instanceof e.Texture&&!e.defined(t._textureCache.getStageByName(s))&&(t._texturesToRelease.push(a),delete o[s],delete o[`${s}Dimensions`]),n instanceof e.Texture&&t._texturesToRelease.push(n),"string"==typeof r||r instanceof kd||r instanceof Gd||r instanceof Ud||r instanceof Hd?t._dirtyUniforms.push(s):o[s]=r;}}}function Xd(e,t){return function(){const i=e._actualUniforms[t];return "function"==typeof i?i():i}}function qd(t,i){return function(){const s=t[i]();if(e.defined(s))return s.dimensions}}function Kd(e,t){return function(){return e._textureCache.getOutputTexture(t)}}function Jd(t){e.defined(t._command)&&(t._command=void 0),t._selectedIdTexture=t._selectedIdTexture&&t._selectedIdTexture.destroy();const i=t._textureCache;if(!e.defined(i))return;const s=t._uniforms,r=t._actualUniforms;for(const n in r)r.hasOwnProperty(n)&&r[n]instanceof e.Texture&&(e.defined(i.getStageByName(s[n]))||r[n].destroy(),t._dirtyUniforms.push(n));}class Zd{constructor(t){if(!t.stages)throw new Error("options.stages must be defined!");if(t.stages.length<=0)throw new Error("options.stages length must greater than 0!");this._stages=t.stages,this._inputPreviousStageTexture=e.defaultValue(t.inputPreviousStageTexture,!0);let i=t.name;e.defined(i)||(i=e.uuid()),this._name=i,this._uniforms=t.uniforms,this._textureCache=void 0,this._index=void 0,this._selected=void 0,this._selectedShadow=void 0,this._parentSelected=void 0,this._parentSelectedShadow=void 0,this._combinedSelected=void 0,this._combinedSelectedShadow=void 0,this._selectedLength=0,this._parentSelectedLength=0,this._selectedDirty=!0;}get ready(){const e=this._stages,t=e.length;for(let i=0;i<t;++i)if(!e[i].ready)return !1;return !0}get name(){return this._name}get enabled(){return this._stages[0].enabled}set enabled(e){const t=this._stages,i=t.length;for(let s=0;s<i;++s)t[s].enabled=e;}get uniforms(){return this._uniforms}get inputPreviousStageTexture(){return this._inputPreviousStageTexture}get length(){return this._stages.length}get selected(){return this._selected}set selected(e){this._selected=e;}get parentSelected(){return this._parentSelected}set parentSelected(e){this._parentSelected=e;}_isSupported(e){const t=this._stages,i=t.length;for(let s=0;s<i;++s)if(!t[s]._isSupported(e))return !1;return !0}get(e){if(e<0)throw new Error("index must be greater than 0!");if(e>=this.length)throw new Error("index must be less than stages length!");return this._stages[e]}update(t,i){this._selectedDirty=function(t){let i=e.defined(t._selected)?t._selected.length:0;const s=e.defined(t._parentSelected)?t._parentSelected:0;let r=t._selected!==t._selectedShadow||i!==t._selectedLength;if(r=r||t._parentSelected!==t._parentSelectedShadow||s!==t._parentSelectedLength,t._combinedSelected=e.defined(t._selected)&&e.defined(t._parentSelected)?t._selected.concat(t._parentSelected):e.defined(t._parentSelected)?t._parentSelected:t._selected,!r&&e.defined(t._combinedSelected)){if(!e.defined(t._combinedSelectedShadow))return !0;i=t._combinedSelected.length;for(let e=0;e<i;++e)if(t._combinedSelected[e]!==t._combinedSelectedShadow[e])return !0}return r}(this),this._selectedShadow=this._selected,this._parentSelectedShadow=this._parentSelected,this._combinedSelectedShadow=this._combinedSelected,this._selectedLength=e.defined(this._selected)?this._selected.length:0,this._parentSelectedLength=e.defined(this._parentSelected)?this._parentSelected.length:0;const s=this._stages,r=s.length;for(let e=0;e<r;++e){const r=s[e];this._selectedDirty&&(r.parentSelected=this._combinedSelected),r.update(t,i);}}destroy(){const t=this._stages,i=t.length;for(let e=0;e<i;++e)t[e].destroy();return e.destroyObject(this)}}class Yd{constructor(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this.color=t.color,this.depth=t.depth,this.stencil=t.stencil,this.renderState=t.renderState,this.framebuffer=t.framebuffer,this.owner=t.owner;}static ALL=Object.freeze(new Yd({color:new e.Color(0,0,0,0),depth:1,stencil:0}));execute(e){const t=e.bindFramebuffer.get();e.bindFramebuffer.set(this.framebuffer.framebuffer),e.clear(this),e.bindFramebuffer.set(t);}}class Qd{constructor(t){const i=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).context,s=t.height;this._width=t.width,this._height=s;const r=t.colorRenderbuffers,n=t.colorTextures;if(e.defined(r)!==e.defined(n))throw new Error("Both color renderbuffer and texture attachments must be provided.");const o=t.depthStencilRenderbuffer,a=t.depthStencilTexture;if(e.defined(o)!==e.defined(a))throw new Error("Both depth-stencil renderbuffer and texture attachments must be provided.");this._renderFramebuffer=new Yc({context:i,colorRenderbuffers:r,depthStencilRenderbuffer:o,destroyAttachments:t.destroyAttachments}),this._colorFramebuffer=new Yc({context:i,colorTextures:n,depthStencilTexture:a,destroyAttachments:t.destroyAttachments});}getRenderFramebuffer(){return this._renderFramebuffer}getColorFramebuffer(){return this._colorFramebuffer}blitFramebuffers(t,i){this._renderFramebuffer.bindRead(),this._colorFramebuffer.bindDraw();const s=t.gl;let r=0;this._colorFramebuffer._colorTextures.length>0&&(r|=e.WebGLConstants.COLOR_BUFFER_BIT),e.defined(this._colorFramebuffer.depthStencilTexture)&&(r|=e.WebGLConstants.DEPTH_BUFFER_BIT|(i?e.WebGLConstants.STENCIL_BUFFER_BIT:0)),s.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,r,e.WebGLConstants.NEAREST),s.bindFramebuffer(e.WebGLConstants.READ_FRAMEBUFFER,null),s.bindFramebuffer(e.WebGLConstants.DRAW_FRAMEBUFFER,null);}isDestroyed(){return !1}destroy(){return this._renderFramebuffer.destroy(),this._colorFramebuffer.destroy(),e.destroyObject(this)}}class $d{constructor(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this._numSamples=e.defaultValue(t.numSamples,1),this._colorAttachmentsLength=e.defaultValue(t.colorAttachmentsLength,1),this._color=e.defaultValue(t.color,!0),this._depth=e.defaultValue(t.depth,!1),this._depthStencil=e.defaultValue(t.depthStencil,!1),this._supportsDepthTexture=e.defaultValue(t.supportsDepthTexture,!1),this._createColorAttachments=e.defaultValue(t.createColorAttachments,!0),this._createDepthAttachments=e.defaultValue(t.createDepthAttachments,!0),this._pixelDatatype=t.pixelDatatype,this._pixelFormat=t.pixelFormat,this._width=void 0,this._height=void 0,this._framebuffer=void 0,this._multisampleFramebuffer=void 0,this._colorTextures=void 0,this._color&&(this._colorTextures=new Array(this._colorAttachmentsLength),this._colorRenderbuffers=new Array(this._colorAttachmentsLength)),this._colorRenderbuffer=void 0,this._depthStencilRenderbuffer=void 0,this._depthStencilTexture=void 0,this._depthRenderbuffer=void 0,this._depthTexture=void 0,this._attachmentsDirty=!1;}get framebuffer(){return this._numSamples>1?this._multisampleFramebuffer.getRenderFramebuffer():this._framebuffer}get numSamples(){return this._numSamples}get status(){return this.framebuffer.status}isDirty(t,i,s,r,n){s=e.defaultValue(s,1);const o=this._width!==t||this._height!==i,a=this._numSamples!==s,l=e.defined(r)&&this._pixelDatatype!==r||e.defined(n)&&this._pixelFormat!==n,h=e.defined(1===s?this._framebuffer:this._multisampleFramebuffer);return this._attachmentsDirty||o||a||l||!h||this._color&&!e.defined(this._colorTextures[0])}update(t,i,s,r,n,o){if(r=t.msaa?e.defaultValue(r,1):1,n=e.defaultValue(n,this._color?e.defaultValue(this._pixelDatatype,e.PixelDatatype.UNSIGNED_BYTE):void 0),o=e.defaultValue(o,this._color?e.defaultValue(this._pixelFormat,e.PixelFormat.RGBA):void 0),this.isDirty(i,s,r,n,o)){if(this.destroy(),this._width=i,this._height=s,this._numSamples=r,this._pixelDatatype=n,this._pixelFormat=o,this._attachmentsDirty=!1,this._color&&this._createColorAttachments)for(let r=0;r<this._colorAttachmentsLength;++r)if(this._colorTextures[r]=new e.Texture({context:t,width:i,height:s,pixelFormat:o,pixelDatatype:n,sampler:e.Sampler.NEAREST}),this._numSamples>1){const e=qc.getColorFormat(n);this._colorRenderbuffers[r]=new Kc({context:t,width:i,height:s,format:e,numSamples:this._numSamples});}this._depthStencil&&this._createDepthAttachments&&(this._supportsDepthTexture&&t.depthTexture?(this._depthStencilTexture=new e.Texture({context:t,width:i,height:s,pixelFormat:e.PixelFormat.DEPTH_STENCIL,pixelDatatype:e.PixelDatatype.UNSIGNED_INT_24_8,sampler:e.Sampler.NEAREST}),this._numSamples>1&&(this._depthStencilRenderbuffer=new Kc({context:t,width:i,height:s,format:qc.DEPTH24_STENCIL8,numSamples:this._numSamples}))):this._depthStencilRenderbuffer=new Kc({context:t,width:i,height:s,format:qc.DEPTH_STENCIL})),this._depth&&this._createDepthAttachments&&(this._supportsDepthTexture&&t.depthTexture?this._depthTexture=new e.Texture({context:t,width:i,height:s,pixelFormat:e.PixelFormat.DEPTH_COMPONENT,pixelDatatype:e.PixelDatatype.UNSIGNED_INT,sampler:e.Sampler.NEAREST}):this._depthRenderbuffer=new Kc({context:t,width:i,height:s,format:qc.DEPTH_COMPONENT16})),this._numSamples>1?this._multisampleFramebuffer=new Qd({context:t,width:this._width,height:this._height,colorTextures:this._colorTextures,colorRenderbuffers:this._colorRenderbuffers,depthStencilTexture:this._depthStencilTexture,depthStencilRenderbuffer:this._depthStencilRenderbuffer,destroyAttachments:!1}):this._framebuffer=new Yc({context:t,colorTextures:this._colorTextures,depthTexture:this._depthTexture,depthRenderbuffer:this._depthRenderbuffer,depthStencilTexture:this._depthStencilTexture,depthStencilRenderbuffer:this._depthStencilRenderbuffer,destroyAttachments:!1});}}getColorTexture(t){return t=e.defaultValue(t,0),this._colorTextures[t]}setColorTexture(t,i){i=e.defaultValue(i,0),this._attachmentsDirty=t!==this._colorTextures[i],this._colorTextures[i]=t;}getColorRenderbuffer(t){return t=e.defaultValue(t,0),this._colorRenderbuffers[t]}setColorRenderbuffer(t,i){i=e.defaultValue(i,0),this._attachmentsDirty=t!==this._colorRenderbuffers[i],this._colorRenderbuffers[i]=t;}getDepthRenderbuffer(){return this._depthRenderbuffer}setDepthRenderbuffer(e){this._attachmentsDirty=e!==this._depthRenderbuffer,this._depthRenderbuffer=e;}getDepthTexture(){return this._depthTexture}setDepthTexture(e){this._attachmentsDirty=e!==this._depthTexture,this._depthTexture=e;}getDepthStencilRenderbuffer(){return this._depthStencilRenderbuffer}setDepthStencilRenderbuffer(e){this._attachmentsDirty=e!==this._depthStencilRenderbuffer,this._depthStencilRenderbuffer=e;}getDepthStencilTexture(){return this._depthStencilTexture}setDepthStencilTexture(e){this._attachmentsDirty=e!==this._depthStencilTexture,this._depthStencilTexture=e;}prepareTextures(e,t){this._numSamples>1&&this._multisampleFramebuffer.blitFramebuffers(e,t);}clear(e,t,i){const s=t.framebuffer;t.framebuffer=this.framebuffer,e.bindFramebuffer.set(this.framebuffer.framebuffer),t.execute(e,i),t.framebuffer=s;}destroyFramebuffer(){this._framebuffer=this._framebuffer&&this._framebuffer.destroy(),this._multisampleFramebuffer=this._multisampleFramebuffer&&this._multisampleFramebuffer.destroy();}destroy(){if(this._color){let t;const i=this._colorTextures.length;for(t=0;t<i;++t){const i=this._colorTextures[t];this._createColorAttachments&&e.defined(i)&&!i.isDestroyed()&&(this._colorTextures[t].destroy(),this._colorTextures[t]=void 0),e.defined(i)&&i.isDestroyed()&&(this._colorTextures[t]=void 0);const s=this._colorRenderbuffers[t];this._createColorAttachments&&e.defined(s)&&!s.isDestroyed()&&(this._colorRenderbuffers[t].destroy(),this._colorRenderbuffers[t]=void 0),e.defined(s)&&s.isDestroyed()&&(this._colorRenderbuffers[t]=void 0);}}this._depthStencil&&(this._createDepthAttachments&&(this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy()),e.defined(this._depthStencilTexture)&&this._depthStencilTexture.isDestroyed()&&(this._depthStencilTexture=void 0),e.defined(this._depthStencilRenderbuffer)&&this._depthStencilRenderbuffer.isDestroyed()&&(this._depthStencilRenderbuffer=void 0)),this._depth&&(this._createDepthAttachments&&(this._depthTexture=this._depthTexture&&this._depthTexture.destroy(),this._depthRenderbuffer=this._depthRenderbuffer&&this._depthRenderbuffer.destroy()),e.defined(this._depthTexture)&&this._depthTexture.isDestroyed()&&(this._depthTexture=void 0),e.defined(this._depthRenderbuffer)&&this._depthRenderbuffer.isDestroyed()&&(this._depthRenderbuffer=void 0)),this.destroyFramebuffer();}}class em{constructor(){this._uniformMap=void 0,this._colorTexture=void 0,this._depthTexture=void 0,this._ready=!1,this._name="czm_autoexposure",this._logDepthChanged=void 0,this._useLogDepth=void 0,this._framebuffers=void 0,this._previousLuminance=new $d,this._commands=void 0,this._clearCommand=void 0,this._minMaxLuminance=new e.Vector2,this.enabled=!0,this._enabled=!0,this.minimumLuminance=.1,this.maximumLuminance=10;}get ready(){return this._ready}get name(){return this._name}get outputTexture(){const t=this._framebuffers;if(e.defined(t))return t[t.length-1].getColorTexture(0)}update(t){const i=t.drawingBufferWidth,s=t.drawingBufferHeight;i===this._width&&s===this._height||(this._width=i,this._height=s,function(t,i){tm(t);let s=t._width,r=t._height;const n=i.extTextureHalfFloat?e.PixelDatatype.HALF_FLOAT:e.PixelDatatype.FLOAT,o=Math.ceil(Math.log(Math.max(s,r))/Math.log(3)),a=new Array(o);for(let e=0;e<o;++e)s=Math.max(Math.ceil(s/3),1),r=Math.max(Math.ceil(r/3),1),a[e]=new $d,a[e].update(i,s,r,1,n);const l=a[o-1].getColorTexture(0);t._previousLuminance.update(i,l.width,l.height,1,n),t._framebuffers=a;}(this,t),function(e,t){im(e);const i=e._framebuffers,s=i.length,r=new Array(s);for(let n=0;n<s;++n)r[n]=nm(t,rm(n,s),i[n].framebuffer,sm(e,n));e._commands=r;}(this,t),this._ready||(this._ready=!0)),this._minMaxLuminance.x=this.minimumLuminance,this._minMaxLuminance.y=this.maximumLuminance;const r=this._framebuffers,n=r[r.length-1];r[r.length-1]=this._previousLuminance,this._commands[this._commands.length-1].framebuffer=this._previousLuminance.framebuffer,this._previousLuminance=n;}execute(t,i){this._colorTexture=i;const s=this._commands;if(!e.defined(s))return;const r=s.length;for(let e=0;e<r;++e)t.draw(s[e]);}isDestroyed(){return !1}destroy(){return tm(this),im(this),e.destroyObject(this)}clear(t){const i=this._framebuffers;if(!e.defined(i))return;let s=this._clearCommand;e.defined(s)||(s=this._clearCommand=new Yd({color:new e.Color(0,0,0,0),framebuffer:void 0}));const r=i.length;for(let e=0;e<r;++e)i[e].clear(t,s);}}function tm(t){const i=t._framebuffers;if(!e.defined(i))return;const s=i.length;for(let e=0;e<s;++e)i[e].destroy();t._framebuffers=void 0,t._previousLuminance.destroy(),t._previousLuminance=void 0;}function im(t){const i=t._commands;if(!e.defined(i))return;const s=i.length;for(let e=0;e<s;++e)i[e].shaderProgram.destroy();t._commands=void 0;}function sm(e,t){const i=new Map;if(0===t)i.set("colorTexture",(()=>e._colorTexture)),i.set("colorTextureDimensions",(()=>e._colorTexture.dimensions));else {const s=e._framebuffers[t-1].getColorTexture(0);i.set("colorTexture",(()=>s)),i.set("colorTextureDimensions",(()=>s.dimensions));}return i.set("minMaxLuminance",(()=>e._minMaxLuminance)),i.set("previousLuminance",(()=>e._previousLuminance.getColorTexture(0))),i}function rm(e,t){let i="uniform sampler2D colorTexture; \nvarying vec2 v_TexCoord; \nfloat sampleTexture(vec2 offset) { \n";return i+=0===e?"    vec4 color = texture2D(colorTexture, v_TexCoord + offset); \n    return czm_luminance(color.rgb); \n":"    return texture2D(colorTexture, v_TexCoord + offset).r; \n",i+="}\n\n",i+="uniform vec2 colorTextureDimensions; \nuniform vec2 minMaxLuminance; \nuniform sampler2D previousLuminance; \nvoid main() { \n    float color = 0.0; \n    float xStep = 1.0 / colorTextureDimensions.x; \n    float yStep = 1.0 / colorTextureDimensions.y; \n    int count = 0; \n    for (int i = 0; i < 3; ++i) { \n        for (int j = 0; j < 3; ++j) { \n            vec2 offset; \n            offset.x = -xStep + float(i) * xStep; \n            offset.y = -yStep + float(j) * yStep; \n            if (offset.x < 0.0 || offset.x > 1.0 || offset.y < 0.0 || offset.y > 1.0) { \n                continue; \n            } \n            color += sampleTexture(offset); \n            ++count; \n        } \n    } \n    if (count > 0) { \n        color /= float(count); \n    } \n",e===t-1&&(i+="    float previous = texture2D(previousLuminance, vec2(0.5)).r; \n    color = clamp(color, minMaxLuminance.x, minMaxLuminance.y); \n    color = previous + (color - previous) / (60.0 * 1.5); \n    color = clamp(color, minMaxLuminance.x, minMaxLuminance.y); \n"),i+="    gl_FragColor = vec4(color); \n} \n",i}function nm(t,i,s,r){this._copyColorCommand={painter:t.painter,framebuffer:s,layer:{id:`postprocess-autoExposure${Date.now()}`},geometry:new Fd(t.painter),material:{_uniforms:r,_shaderSource:new e.ShaderSource({vertexSource:e.shaders.screen.vertexSource,fragmentSource:i})}};}const om="skyline",am="mm_fog_effect";function lm(t){const i=`#define USE_STEP_SIZE\n${e.shaders.GaussianBlur1D.fragmentSource}`,s=new Wd({name:`${t}_x_direction`,fragmentShader:i,uniforms:{delta:1,sigma:2,stepSize:1,direction:0},sampleMode:1}),r=new Wd({name:`${t}_y_direction`,fragmentShader:i,uniforms:{delta:1,sigma:2,stepSize:1,direction:1},sampleMode:1}),n={};return Object.defineProperties(n,{delta:{get:()=>s.uniforms.delta,set(e){s.uniforms.delta=r.uniforms.delta=e;}},sigma:{get:()=>s.uniforms.sigma,set(e){s.uniforms.sigma=r.uniforms.sigma=e;}},stepSize:{get:()=>s.uniforms.stepSize,set(e){s.uniforms.stepSize=r.uniforms.stepSize=e;}}}),new Zd({name:t,stages:[s,r],uniforms:n})}class hm{static createBlurStage(){return lm("czm_blur")}static createDepthOfFieldStage(){const t=lm("czm_depth_of_field_blur"),i=new Wd({name:"czm_depth_of_field_composite",fragmentShader:e.shaders.DepthOfField.fragmentSource,uniforms:{focalDistance:5,blurTexture:t.name}}),s={};return Object.defineProperties(s,{focalDistance:{get:()=>i.uniforms.focalDistance,set(e){i.uniforms.focalDistance=e;}},delta:{get:()=>t.uniforms.delta,set(e){t.uniforms.delta=e;}},sigma:{get:()=>t.uniforms.sigma,set(e){t.uniforms.sigma=e;}},stepSize:{get:()=>t.uniforms.stepSize,set(e){t.uniforms.stepSize=e;}}}),new Zd({name:"czm_depth_of_field",stages:[t,i],inputPreviousStageTexture:!1,uniforms:s})}static isDepthOfFieldSupported(e){return e.extDepthTexture}static createEdgeDetectionStage(t={}){const i=Date.now();return new Wd({name:`czm_edge_detection_${i}`,fragmentShader:e.shaders.EdgeDetection.fragmentSource,uniforms:{length:e.defaultValue(t.length,.25),color:new e.Vector4(0,0,0,1)}})}static isEdgeDetectionSupported(e){return e.extDepthTexture}static createSilhouetteStage(t){const i=function(t){if(!e.defined(t))return hm.createEdgeDetectionStage();const i=new Zd({name:"czm_edge_detection_multiple",stages:t,inputPreviousStageTexture:!1}),s={};let r="",n="";for(let e=0;e<t.length;++e)r+=`uniform sampler2D edgeTexture${e}; \n`,n+=`        vec4 edge${e} = texture2D(edgeTexture${e}, v_TexCoord); \n        if (edge${e}.a > 0.0) \n        { \n            color = edge${e}; \n            break; \n        } \n`,s[`edgeTexture${e}`]=t[e].name;const o=new Wd({name:"czm_edge_detection_combine",fragmentShader:`${r}varying vec2 v_TexCoord; \nvoid main() { \n    vec4 color = vec4(0.0); \n    for (int i = 0; i < ${t.length}; i++) \n    { \n${n}    } \n    gl_FragColor = color; \n} \n`,uniforms:s});return new Zd({name:"czm_edge_detection_composite",stages:[i,o]})}(t),s=new Wd({name:"czm_silhouette_color_edges",fragmentShader:e.shaders.Silhouette.fragmentSource,uniforms:{silhouetteTexture:i.name}});return new Zd({name:"czm_silhouette",stages:[i,s],inputPreviousStageTexture:!1,uniforms:i.uniforms})}static isSilhouetteSupported(e){return e.extDepthTexture}static createBloomStage(){const t=new Wd({name:"czm_bloom_contrast_bias",fragmentShader:e.shaders.ContrastBias.fragmentSource,uniforms:{contrast:128,brightness:-.3}}),i=lm("czm_bloom_blur"),s=new Zd({name:"czm_bloom_contrast_bias_blur",stages:[t,i]}),r=new Wd({name:"czm_bloom_generate_composite",fragmentShader:e.shaders.BloomComposite.fragmentSource,uniforms:{glowOnly:!1,bloomTexture:s.name}}),n={};return Object.defineProperties(n,{glowOnly:{get:()=>r.uniforms.glowOnly,set(e){r.uniforms.glowOnly=e;}},contrast:{get:()=>t.uniforms.contrast,set(e){t.uniforms.contrast=e;}},brightness:{get:()=>t.uniforms.brightness,set(e){t.uniforms.brightness=e;}},delta:{get:()=>i.uniforms.delta,set(e){i.uniforms.delta=e;}},sigma:{get:()=>i.uniforms.sigma,set(e){i.uniforms.sigma=e;}},stepSize:{get:()=>i.uniforms.stepSize,set(e){i.uniforms.stepSize=e;}}}),new Zd({name:"czm_bloom",stages:[s,r],inputPreviousStageTexture:!1,uniforms:n})}static createAmbientOcclusionStage(){const t=new Wd({name:"czm_ambient_occlusion_generate",fragmentShader:e.shaders.AmbientOcclusionGenerate.fragmentSource,uniforms:{intensity:3,bias:.1,lengthCap:.26,stepSize:1.95,frustumLength:1e3,randomTexture:void 0}}),i=lm("czm_ambient_occlusion_blur");i.uniforms.stepSize=.86;const s=new Zd({name:"czm_ambient_occlusion_generate_blur",stages:[t,i]}),r=new Wd({name:"czm_ambient_occlusion_composite",fragmentShader:e.shaders.AmbientOcclusionModulate.fragmentSource,uniforms:{ambientOcclusionOnly:!1,ambientOcclusionTexture:s.name}}),n={};return Object.defineProperties(n,{intensity:{get:()=>t.uniforms.intensity,set(e){t.uniforms.intensity=e;}},bias:{get:()=>t.uniforms.bias,set(e){t.uniforms.bias=e;}},lengthCap:{get:()=>t.uniforms.lengthCap,set(e){t.uniforms.lengthCap=e;}},stepSize:{get:()=>t.uniforms.stepSize,set(e){t.uniforms.stepSize=e;}},frustumLength:{get:()=>t.uniforms.frustumLength,set(e){t.uniforms.frustumLength=e;}},randomTexture:{get:()=>t.uniforms.randomTexture,set(e){t.uniforms.randomTexture=e;}},delta:{get:()=>i.uniforms.delta,set(e){i.uniforms.delta=e;}},sigma:{get:()=>i.uniforms.sigma,set(e){i.uniforms.sigma=e;}},blurStepSize:{get:()=>i.uniforms.stepSize,set(e){i.uniforms.stepSize=e;}},ambientOcclusionOnly:{get:()=>r.uniforms.ambientOcclusionOnly,set(e){r.uniforms.ambientOcclusionOnly=e;}}}),new Zd({name:"czm_ambient_occlusion",stages:[s,r],inputPreviousStageTexture:!1,uniforms:n})}static isAmbientOcclusionSupported(e){return e.extDepthTexture}static createFXAAStage(){return new Wd({name:"czm_FXAA",fragmentShader:`#define M_FXAA_QUALITY_PRESET 39 \n${e.shaders.FXAA.fragmentSource}`,sampleMode:1})}static createAcesTonemappingStage(t){let i=t?"#define AUTO_EXPOSURE\n":"";return i+=e.shaders.AcesTonemappingStage.fragmentSource,new Wd({name:"czm_aces",fragmentShader:i,uniforms:{autoExposure:void 0,u_Gamma:1.53846}})}static createFilmicTonemappingStage(t){let i=t?"#define AUTO_EXPOSURE\n":"";return i+=e.shaders.FilmicTonemapping.fragmentSource,new Wd({name:"czm_filmic",fragmentShader:i,uniforms:{autoExposure:void 0,u_Gamma:1.53846}})}static createReinhardTonemappingStage(t){let i=t?"#define AUTO_EXPOSURE\n":"";return i+=e.shaders.ReinhardTonemapping.fragmentSource,new Wd({name:"czm_reinhard",fragmentShader:i,uniforms:{autoExposure:void 0,u_Gamma:1.53846}})}static createModifiedReinhardTonemappingStage(t){let i=t?"#define AUTO_EXPOSURE\n":"";return i+=e.shaders.ModifiedReinhardTonemapping.fragmentSource,new Wd({name:"czm_modified_reinhard",fragmentShader:i,uniforms:{white:e.Color.white,autoExposure:void 0,u_Gamma:1.53846}})}static createAutoExposureStage(){return new em}static createBlackAndWhiteStage(){return new Wd({name:"czm_black_and_white",fragmentShader:e.shaders.BlackAndWhite.fragmentSource,uniforms:{gradations:5}})}static createBrightnessStage(){return new Wd({name:"czm_brightness",fragmentShader:e.shaders.Brightness.fragmentSource,uniforms:{brightness:.5}})}static createNightVisionStage(){return new Wd({name:"czm_night_vision",fragmentShader:e.shaders.NightVision.fragmentSource})}static createDepthViewStage(){return new Wd({name:"czm_depth_view",fragmentShader:e.shaders.DepthView.fragmentSource})}static createSkyline(t={}){const i=t.color||[.5,1,0],s=e.defined(t.width)?t.width:1,r=e.Color.parse(i);if(!r)throw new Error("color's type is not support! please use minemap.Color or minemap.Math.Vector3 or minemap.Math.Vector3 or Array<number,3>,4 or Array<number,4> or css color string instead!");(r.r>1||r.g>1||r.b>1)&&(r.r=e.Color.byteToFloat(r.r),r.g=e.Color.byteToFloat(r.g),r.b=e.Color.byteToFloat(r.b),console.warn("请检查，传入的color是否有标准，错误示范如 new minemap.Color(255,0,0); 非0-1， 或 new minemap.Math.Vector3(255,0,0); 或者 [123, 1,5]等数值传入！"));const n=e.Vector4.fromColor(r),o=hm.createEdgeDetectionStage({length:t.edgeDetectionLength||1e-4}),a=new Wd({name:"mm_skyline_red",fragmentShader:"uniform sampler2D colorTexture;uniform sampler2D depthTexture;varying vec2 v_TexCoord;\r\n#include <fn_readDepth> \r\nvoid main(void){float depth = readDepth(depthTexture, v_TexCoord, true);vec4 color = texture2D(colorTexture, v_TexCoord);if (depth < 1.0 - 0.00001) {gl_FragColor = vec4(0.0);}else{gl_FragColor = vec4(1.0,0.0,0.0,1.0);}}"}),l=new Wd({name:"mm_skyline_merge_edge",fragmentShader:"uniform sampler2D colorTexture;uniform sampler2D redTexture;uniform sampler2D silhouetteTexture;uniform vec4 u_Viewport;uniform vec4 linecolor;uniform float u_PixelRatio;uniform float width;varying vec2 v_TexCoord;void main(void){ vec2 offxy = width* u_PixelRatio / u_Viewport.zw;vec4 redcolor=texture2D(redTexture, v_TexCoord);vec4 silhouetteColor = texture2D(silhouetteTexture, v_TexCoord);silhouetteColor += texture2D(silhouetteTexture, v_TexCoord+vec2(offxy.x,0.));silhouetteColor += texture2D(silhouetteTexture, v_TexCoord+vec2(-offxy.x,0.));silhouetteColor += texture2D(silhouetteTexture, v_TexCoord+vec2(0.,offxy.y));silhouetteColor += texture2D(silhouetteTexture, v_TexCoord+vec2(0.,-offxy.y));vec4 color = texture2D(colorTexture, v_TexCoord);if(redcolor.r == 1.0 &&silhouetteColor.a!=0.){gl_FragColor = linecolor;}else{gl_FragColor = color;}}",uniforms:{redTexture:a.name,silhouetteTexture:o.name,linecolor:()=>n,width:()=>s}});return new Zd({stages:[o,a,l],inputPreviousStageTexture:!1,uniforms:o.uniforms,name:om})}static createFogEffect(t){let i=e.defaultValue(t?.fogDensity,50);const s=e.Vector4.fromColor(e.Color.parse(e.defaultValue(t?.fogColor,"rgba(255,255,255,1)")),!1);i<=0?(i=1,s.w=0):i>100&&(i=100);const r=e.defined(t.fogFar)?t.fogFar:function(){return 1e4/i},n=e.defined(t.fogNear)?t.fogNear:function(){return 10},o=new Wd({name:`${am}${Math.random()}`,fragmentShader:"#define GLSLIFY 1\n#include <infinity>\n#include <u_FrustumPlanes>\n#include <u_CurrentFrustum>\n#include <u_Viewport>\nuniform mat4 u_ViewportTransformation;uniform mat4 u_InverseProjection;uniform float u_PixelRatio;\n#include <fn_windowToEyeCoordinates>\n#include <fn_readDepth>\nuniform sampler2D colorTexture;uniform sampler2D depthTexture;uniform vec4 fogByDistance;uniform vec4 fogColor;uniform bool u_HasSkyline;uniform vec4 u_SkipColor;uniform bool u_AtmosphereFlag;float getDistance(sampler2D depthTexture,vec2 texCoords){float depth=readDepth(depthTexture,texCoords,true);if(depth==0.0){return infinity;}vec4 eyeCoordinate=windowToEyeCoordinates(gl_FragCoord.xy,depth);return-eyeCoordinate.z/(eyeCoordinate.w*2.5);}float interpolateByDistance(vec4 nearFarScalar,float distance){float startDistance=nearFarScalar.x;float startValue=nearFarScalar.y;float endDistance=nearFarScalar.z;float endValue=nearFarScalar.w;float t=clamp((distance-startDistance)/(endDistance-startDistance),0.0,1.0);return mix(startValue,endValue,t);}vec4 alphaBlend(vec4 sourceColor,vec4 destinationColor){return sourceColor*vec4(sourceColor.aaa,1.0)+destinationColor*(1.0-sourceColor.a);}void main(void){vec2 v_textureCoordinates=vec2(gl_FragCoord.x,gl_FragCoord.y)/u_Viewport.zw;float distance=getDistance(depthTexture,v_textureCoordinates);vec4 sceneColor=texture2D(colorTexture,v_textureCoordinates);if(u_HasSkyline&&abs(sceneColor.x-u_SkipColor.x)<0.005&&abs(sceneColor.y-u_SkipColor.y)<0.005&&abs(sceneColor.z-u_SkipColor.z)<0.005){gl_FragColor=sceneColor;}else{float blendAmount=interpolateByDistance(fogByDistance,distance);vec4 finalFogColor=vec4(fogColor.rgb,fogColor.a*blendAmount);if(u_AtmosphereFlag){sceneColor.a=sceneColor.a*(1.-blendAmount/4.0);}gl_FragColor=alphaBlend(finalFogColor,sceneColor);}}",uniforms:{fogByDistance:()=>new e.Vector4(n(),0,r(),1),fogColor:()=>o.extraData.color,u_SkipColor:()=>new e.Vector4,u_HasSkyline:()=>!1,u_AtmosphereFlag:()=>!!o.extraData.atmosphereFlag},inputPreviousStageTexture:!1});return o.extraData.color=s,o}}class _m{constructor(e){this._collection=e,this._framebuffers=[],this._stageNameToFramebuffer={},this._width=void 0,this._height=void 0,this._updateDependencies=!1;}updateDependencies(){this._updateDependencies=!0;}update(t){const i=this._collection,s=this._updateDependencies,r=e.defined(i.ambientOcclusion)&&i.ambientOcclusion.enabled&&i.ambientOcclusion._isSupported(t),n=e.defined(i.bloom)&&i.bloom.enabled&&i.bloom._isSupported(t),o=e.defined(i._tonemapping)&&i._tonemapping.enabled&&i._tonemapping._isSupported(t),a=e.defined(i.fxaa)&&i.fxaa.enabled&&i.fxaa._isSupported(t),l=e.defined(i.atmosphere)&&i.atmosphere.enabled&&i.atmosphere._isSupported(t),h=!e.defined(i._activeStages)||i._activeStages.length>0||r||n||o||a||l;if((s||!h&&this._framebuffers.length>0)&&(pm(this),this._framebuffers.length=0,this._stageNameToFramebuffer={},this._width=void 0,this._height=void 0),!s&&!h)return;0===this._framebuffers.length&&function(t,i){const s=function(t,i){const s={};if(e.defined(t.ambientOcclusion)){const e=t.bloom,r=t._tonemapping,n=t.fxaa,o=t.atmosphere;let a=dm(t,i,s,t.ambientOcclusion,void 0);a=dm(t,i,s,e,a),a=um(t,i,s,r,a),a=dm(t,i,s,t,a),a=um(t,i,s,n,a),um(t,i,s,o,a);}else dm(t,i,s,t,void 0);return s}(t._collection,i);for(const e in s)s.hasOwnProperty(e)&&(t._stageNameToFramebuffer[e]=mm(t,e,s[e]));}(this,t);const _=t.drawingBufferWidth,c=t.drawingBufferHeight;(s||this._width!==_||this._height!==c)&&(this._width=_,this._height=c,this._updateDependencies=!1,pm(this),function(t,i){const s=t._width,r=t._height,n=t._framebuffers,o=n.length;for(let t=0;t<o;++t){const o=n[t],a=o.textureScale;let l=Math.ceil(s*a),h=Math.ceil(r*a),_=Math.min(l,h);o.forcePowerOfTwo&&(e.isPowerOfTwo(_)||(_=e.nextPowerOfTwo(_)),l=_,h=_),o.buffer.update(i,l,h),o.clear=new Yd({color:o.clearColor,framebuffer:o.buffer.framebuffer});}}(this,t));}clear(e){const t=this._framebuffers;for(let i=0;i<t.length;++i)t[i].clear.execute(e);}getStageByName(e){return this._collection.getStageByName(e)}getOutputTexture(e){return this._collection.getOutputTexture(e)}getFramebuffer(t){const i=this._stageNameToFramebuffer[t];if(e.defined(i))return i.buffer.framebuffer}isDestroyed(){return !1}destroy(){return pm(this),e.destroyObject(this)}}function cm(t){for(;e.defined(t.length);)t=t.get(t.length-1);return t.name}function um(t,i,s,r,n){if(!r.enabled||!r._isSupported(i))return n;const o=s[r.name]={};e.defined(n)&&(o[cm(t.getStageByName(n))]=!0);const a=r.uniforms;if(e.defined(a)){const i=Object.getOwnPropertyNames(a),s=i.length;for(let r=0;r<s;++r){const s=a[i[r]];if("string"==typeof s){const i=t.getStageByName(s);e.defined(i)&&(o[cm(i)]=!0);}}}return r.name}function dm(t,i,s,r,n){if(e.defined(r.enabled)&&!r.enabled||e.defined(r._isSupported)&&!r._isSupported(i))return n;const o=n,a=!e.defined(r.inputPreviousStageTexture)||r.inputPreviousStageTexture;let l=n;const h=r.length;for(let o=0;o<h;++o){const h=r.get(o);l=e.defined(h.length)?dm(t,i,s,h,n):um(t,i,s,h,n),a&&(n=l);}let _,c;if(a)for(_=1;_<h;++_)c=cm(r.get(_)),e.defined(s[c])||(s[c]={}),s[c][o]=!0;else for(_=1;_<h;++_){c=cm(r.get(_));const e=s[c];for(let t=0;t<_;++t)e[cm(r.get(t))]=!0;}return l}function mm(t,i,s){const r=t._collection.getStageByName(i),n=r._textureScale,o=r._forcePowerOfTwo,a=r._pixelFormat,l=r._pixelDatatype,h=r._clearColor;let _,c;const u=t._framebuffers,d=u.length;for(_=0;_<d;++_){if(c=u[_],n!==c.textureScale||o!==c.forcePowerOfTwo||a!==c.pixelFormat||l!==c.pixelDatatype||!e.Color.equals(h,c.clearColor))continue;const t=c.stages,i=t.length;let r=!1;for(let e=0;e<i;++e)if(s[t[e]]){r=!0;break}if(!r)break}return e.defined(c)&&_<d?(c.stages.push(i),c):(c={textureScale:n,forcePowerOfTwo:o,pixelFormat:a,pixelDatatype:l,clearColor:h,stages:[i],buffer:new $d({pixelFormat:a,pixelDatatype:l}),clear:void 0},u.push(c),c)}function pm(e){const t=e._framebuffers,i=t.length;for(let e=0;e<i;++e)t[e].buffer.destroy();}const fm={REINHARD:0,MODIFIED_REINHARD:1,FILMIC:2,ACES:3,validate:e=>e===fm.REINHARD||e===fm.MODIFIED_REINHARD||e===fm.FILMIC||e===fm.ACES};var gm=Object.freeze(fm);const ym=[];class Cm{constructor(t){const i=hm.createFXAAStage(),s=hm.createAmbientOcclusionStage(),r=hm.createBloomStage(),n=hm.createFogEffect({fogColor:"rgba(172, 205, 255, 0.88)",fogNear:t.fogNearFunction,fogFar:t.fogFarFunction});n.extraData.atmosphereFlag=!0,this._autoExposureEnabled=!1,this._autoExposure=hm.createAutoExposureStage(),this._tonemapping=void 0,this._tonemapper=void 0,this.useHdr=!1,this.tonemapper=gm.ACES;const o=this._tonemapping;i.enabled=!1,s.enabled=!1,r.enabled=!1,o.enabled=!1,n.enabled=!0;const a=new _m(this),l={},h=ym;for(h.push(i,s,r,o,n);h.length>0;){const t=h.pop();l[t.name]=t,t._textureCache=a;const i=t.length;if(e.defined(i))for(let e=0;e<i;++e)h.push(t.get(e));}this._stages=[],this._activeStages=[],this._previousActiveStages=[],this._randomTexture=void 0;const _=this;s.uniforms.randomTexture=function(){return _._randomTexture},this._ao=s,this._bloom=r,this._fxaa=i,this._atmosphere=n,this._aoEnabled=void 0,this._bloomEnabled=void 0,this._tonemappingEnabled=void 0,this._fxaaEnabled=void 0,this._fogEnabled=!0,this._activeStagesChanged=!1,this._stagesRemoved=!1,this._textureCacheDirty=!1,this._stageNames=l,this._textureCache=a;}get ready(){let e=!1;const t=this._stages;for(let i=t.length-1;i>=0;--i){const s=t[i];e=e||s.ready&&s.enabled;}const i=this._fxaa,s=this._ao,r=this._bloom,n=this._tonemapping,o=this._atmosphere;return e=e||i.ready&&i.enabled,e=e||s.ready&&s.enabled,e=e||r.ready&&r.enabled,e=e||n.ready&&n.enabled,e=e||o.ready&&o.enabled,e}get atmosphere(){return this._atmosphere}get fxaa(){return this._fxaa}get ambientOcclusion(){return this._ao}get bloom(){return this._bloom}get length(){return Tm(this),this._stages.length}get outputTexture(){const t=this._atmosphere;if(t.enabled&&t.ready)return this.getOutputTexture(t.name);const i=this._fxaa;if(i.enabled&&i.ready)return this.getOutputTexture(i.name);const s=this._stages;for(let t=s.length-1;t>=0;--t){const i=s[t];if(e.defined(i)&&i.ready&&i.enabled)return this.getOutputTexture(i.name)}const r=this._tonemapping;if(r.enabled&&r.ready)return this.getOutputTexture(r.name);const n=this._bloom;if(n.enabled&&n.ready)return this.getOutputTexture(n.name);const o=this._ao;return o.enabled&&o.ready?this.getOutputTexture(o.name):void 0}get hasSelected(){const t=this._stages.slice();for(;t.length>0;){const i=t.pop();if(!e.defined(i))continue;if(e.defined(i.selected))return !0;const s=i.length;if(e.defined(s))for(let e=0;e<s;++e)t.push(i.get(e));}return !1}get tonemapper(){return this._tonemapper}set tonemapper(t){if(this._tonemapper===t)return;e.defined(this._tonemapping)&&(delete this._stageNames[this._tonemapping.name],this._tonemapping.destroy());const i=this._autoExposureEnabled;let s;switch(t){case gm.REINHARD:s=hm.createReinhardTonemappingStage(i);break;case gm.MODIFIED_REINHARD:s=hm.createModifiedReinhardTonemappingStage(i);break;case gm.FILMIC:s=hm.createFilmicTonemappingStage(i);break;default:s=hm.createAcesTonemappingStage(i);}if(i){const e=this._autoExposure;s.uniforms.autoExposure=function(){return e.outputTexture};}this._tonemapper=t,this._tonemapping=s,e.defined(this._stageNames)&&(this._stageNames[s.name]=s,s._textureCache=this._textureCache),this._textureCacheDirty=!0;}add(t){const i=this._stageNames,s=ym;for(s.push(t);s.length>0;){const t=s.pop();if(e.defined(i[t.name]))throw new Error(`${t.name} has already been added to the collection or does not have a unique name.`);i[t.name]=t,t._textureCache=this._textureCache;const r=t.length;if(e.defined(r))for(let e=0;e<r;++e)s.push(t.get(e));}const r=this._stages;return t._index=r.length,r.push(t),this._textureCacheDirty=!0,t}remove(t){if(!this.contains(t))return !1;const i=this._stageNames,s=ym;for(s.push(t);s.length>0;){const t=s.pop();delete i[t.name];const r=t.length;if(e.defined(r))for(let e=0;e<r;++e)s.push(t.get(e));}return this._stages[t._index]=void 0,this._stagesRemoved=!0,this._textureCacheDirty=!0,t._index=void 0,t._textureCache=void 0,t.destroy(),!0}contains(t){return e.defined(t)&&e.defined(t._index)&&t._textureCache===this._textureCache}get(e){Tm(this);const t=this._stages,i=t.length;if(i<0)throw new Error("stages length is 0!");if(e<0)throw new Error("index must be greater than 0!");if(e>=i)throw new Error("index must be less than stages length!");return t[e]}removeAll(){const e=this._stages,t=e.length;for(let i=0;i<t;++i)this.remove(e[i]);e.length=0;}getStageByName(e){return this._stageNames[e]}update(t,i){Tm(this);const s=this.useHdr,r=this._activeStages,n=this._activeStages=this._previousActiveStages;this._previousActiveStages=r;const o=this._stages;let a,l,h=n.length=o.length,_=0;for(a=0;a<h;++a)l=o[a],l.ready&&l.enabled&&l._isSupported(t)&&(n[_++]=l);n.length=_;let c=_!==r.length;if(!c)for(a=0;a<_;++a)if(n[a]!==r[a]){c=!0;break}const u=this._ao,d=this._bloom,m=this._autoExposure,p=this._tonemapping,f=this._fxaa,g=this._atmosphere;p.enabled=s;const y=u.enabled&&u._isSupported(t),C=d.enabled&&d._isSupported(t),T=p.enabled&&p._isSupported(t),x=f.enabled&&f._isSupported(t),b=g.enabled&&g._isSupported(t);if((c||this._textureCacheDirty||y!==this._aoEnabled||C!==this._bloomEnabled||T!==this._tonemappingEnabled||x!==this._fxaaEnabled||b!==this._fogEnabled)&&(this._textureCache.updateDependencies(),this._aoEnabled=y,this._bloomEnabled=C,this._tonemappingEnabled=T,this._fxaaEnabled=x,this._fogEnabled=b,this._textureCacheDirty=!1),e.defined(this._randomTexture)&&!y&&(this._randomTexture.destroy(),this._randomTexture=null),!e.defined(this._randomTexture)&&y){h=196608;const i=new Uint8Array(h);for(a=0;a<h;a+=3)i[a]=Math.floor(255*Math.random());this._randomTexture=new e.Texture({context:t,pixelFormat:e.PixelFormat.RGB,pixelDatatype:e.PixelDatatype.UNSIGNED_BYTE,source:{arrayBufferView:i,width:256,height:256},sampler:new e.Sampler({wrapS:e.TextureWrap.REPEAT,wrapT:e.TextureWrap.REPEAT,minificationFilter:e.TextureMinificationFilter.NEAREST,magnificationFilter:e.TextureMagnificationFilter.NEAREST})});}this._textureCache.update(t),f.update(t,i),u.update(t,i),d.update(t,i),p.update(t,i),g.update(t,i),this._autoExposureEnabled&&m.update(t,i),h=o.length;let v=!1;for(a=0;a<h;++a){if(o[a].name==om){v=!0;const e=o[a].get(o[a].length-1).uniforms.linecolor;"function"==typeof e&&(g.uniformMap?.set("u_SkipColor",e),g.uniformMap?.set("u_HasSkyline",(()=>!0)));}o[a].update(t,i);}for(v||(g.uniformMap?.set("u_SkipColor",(()=>new e.Vector4)),g.uniformMap?.set("u_HasSkyline",(()=>!1))),_=0,a=0;a<h;++a)l=o[a],l.ready&&l.enabled&&l._isSupported(t)&&_++;c=_!==n.length,c&&this.update(t,i,s);}clear(e){this._textureCache.clear(e),this._autoExposure&&this._autoExposure.clear(e);}getOutputTexture(t){const i=this.getStageByName(t);if(e.defined(i))return xm(i)}execute(e,t,i,s){const r=this._activeStages,n=r.length,o=this._fxaa,a=this._ao,l=this._bloom,h=this._autoExposure,_=this._tonemapping,c=this._atmosphere,u=a.enabled&&a._isSupported(e),d=l.enabled&&l._isSupported(e),m=this._autoExposureEnabled,p=_.enabled&&_._isSupported(e),f=o.enabled&&o._isSupported(e),g=c.enabled&&c._isSupported(e);if(!(f||u||d||p||g||0!==n))return;let y=t;u&&a.ready&&(bm(a,e,y,i,s),y=xm(a)),d&&l.ready&&(bm(l,e,y,i,s),y=xm(l)),m&&h.ready&&bm(h,e,y,i,s),p&&_.ready&&(bm(_,e,y,i,s),y=xm(_));let C=y;if(n>0){bm(r[0],e,y,i,s);for(let t=1;t<n;++t)bm(r[t],e,xm(r[t-1]),i,s);C=xm(r[n-1]);}g&&c.ready&&(bm(c,e,C,i,s),C=xm(c)),f&&o.ready&&bm(o,e,C,i,s);}createViewportQuadCommand(t){const i=this;return e.defined(this._copyColorCommand)||(this._copyColorCommand={painter:t.painter,framebuffer:void 0,layer:{id:"postprocess"},geometry:new Fd(t.painter),material:{_uniforms:new Map([["colorTexture",()=>i.outputTexture]]),_shaderSource:new e.ShaderSource({vertexSource:e.shaders.screen.vertexSource,fragmentSource:e.shaders.PassThrough.fragmentSource})}}),this._copyColorCommand}copy(e,t){this._copyColorCommand=this.createViewportQuadCommand(e),this._copyColorCommand.framebuffer=t.framebuffer,e.draw(this._copyColorCommand);}serialize(){const t={fxaa:this.fxaa.enabled,bloom:this.bloom.enabled,hdr:this.useHdr,nightVision:!1},i={color:[112,78,200],width:10},s={fogColor:[],fogDensity:[]};for(let r=0;r<this._stages.length;r++){const n=this._stages[r];if(e.defined(n)){if("czm_black_and_white"===n.name&&(t.blackWhite=!0),"czm_night_vision"===n.name&&(t.nightVision=!0),"skyline"===n.name){const s=n._stages[2]._uniformMap.get("linecolor")(),r=n._stages[2]._uniformMap.get("width")();i.color=e.Vector4.pack(s,new Array(4)),i.width=r,t.skyline=i;}if(n.name===am){s.fogColor=e.Vector4.pack(n._uniformMap.get("fogColor")(),new Array(4));const i=1e4/n._uniformMap.get("fogByDistance")()[2];s.fogDensity=Math.max(Math.min(i,100),1),t.fog=s;}}}return t}destroy(){return this._fxaa.destroy(),this._ao.destroy(),this._bloom.destroy(),this._autoExposure.destroy(),this._tonemapping.destroy(),this._atmosphere.destroy(),this.removeAll(),this._textureCache=this._textureCache&&this._textureCache.destroy(),e.destroyObject(this)}}function Tm(e){if(!e._stagesRemoved)return;e._stagesRemoved=!1;const t=[],i=e._stages,s=i.length;for(let e=0,r=0;e<s;++e){const s=i[e];s&&(s._index=r++,t.push(s));}e._stages=t;}function xm(t){for(;e.defined(t.length);)t=t.get(t.length-1);return t.outputTexture}function bm(t,i,s,r,n){if(e.defined(t.execute))return void t.execute(i,s,r,n);const o=t.length;let a;if(t.inputPreviousStageTexture)for(bm(t.get(0),i,s,r,n),a=1;a<o;++a)bm(t.get(a),i,xm(t.get(a-1)),r,n);else for(a=0;a<o;++a)bm(t.get(a),i,s,r,n);}const vm=e.createLayout([{name:"a_POSITION",components:3,type:"Float32"}],4),{members:wm}=vm;class Sm{constructor(t){this._tileCount=0,this.cache={},this.keys=[],this._context=t.context,this._projectionType=t.projection||e.ProjectionType.MERCATOR,this.debugVAO=new za;}setProjection(e){this._projectionType=e;}setMaxTile(e){for(this._tileCount=e;this.keys.length>this._tileCount;)this.removeTileById(this.keys[0]);}addTileByCoord(t){const i=t.canonical,s=i.z,r=i.x,n=i.y,o=t.key,a=new e.StructArrayLayout3f12;let l=8-s;l<1&&(l=1);let h=0,_=[];for(let t=0;t<l+1;t++){const i=e.getSpherePos(t/(l+1)*e.EXTENT,5,0,r,n,s,this._projectionType);0===_.length&&(_=i),a.emplaceBack(i[0]-_[0],i[1]-_[1],i[2]-_[2]),h++;}for(let t=0;t<l+1;t++){const i=e.getSpherePos(e.EXTENT,t/(l+1)*e.EXTENT,5,r,n,s,this._projectionType);a.emplaceBack(i[0]-_[0],i[1]-_[1],i[2]-_[2]),h++;}for(let t=l+1;t>0;t--){const i=e.getSpherePos(t/(l+1)*e.EXTENT,e.EXTENT,5,r,n,s,this._projectionType);a.emplaceBack(i[0]-_[0],i[1]-_[1],i[2]-_[2]),h++;}for(let t=l+1;t>=0;t--){const i=e.getSpherePos(0,t/(l+1)*e.EXTENT,5,r,n,s,this._projectionType);a.emplaceBack(i[0]-_[0],i[1]-_[1],i[2]-_[2]),h++;}const c=function(e,t,i,s){s=s||1;const r=[];let n,o,a,l,h,_,c,u;for(n=0,o=e.length;n<o;n++)if(h=Am[e[n]],h){for(u=null,a=0,l=h[1].length;a<l;a+=2)-1===h[1][a]&&-1===h[1][a+1]?u=null:(_=t+h[1][a]*s,c=800-h[1][a+1]*s,u&&r.push(u.x,u.y,_,c),u={x:_,y:c});t+=h[0]*s;}return r}(t.toString(),50,0,20);let u=0;for(let t=0;t<c.length;t+=2){const i=e.getSpherePos(c[t],c[t+1],5,r,n,s,this._projectionType);a.emplaceBack(i[0]-_[0],i[1]-_[1],i[2]-_[2]),u++;}const d=this._context.createVertexBuffer(a,wm);return this.keys.push(o),this.cache[o]={rP:_,matrix:(new e.Matrix4).translate(_),debugBuffer:d,lineVerticesCount:h,textVerticesCount:u},this.cache[o]}getTileByCoord(e){if(!this.hasTile(e.key))return this.addTileByCoord(e);for(let t=0;t<this.keys.length;t++)if(this.keys[t]===e.key)return this.keys.splice(t,1),this.keys.push(e.key),this.cache[e.key]}removeTileById(e){this.cache[e].debugBuffer.destroy(),this.cache[e]=null,delete this.cache[e];for(let t=0;t<this.keys.length;t++)if(this.keys[t]===e){this.keys.splice(t,1);break}}hasTile(e){return !!this.cache[e]}release(){for(;this.keys.length>0;)this.removeTileById(this.keys[0]);}}const Am={" ":[16,[]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]]},Em=Object.freeze({ENCODE_DEPTH_TO_FRAGCOLOR:!1,RENDER_GRAY_IMAGE:!1});function Mm({source:t,layer:i,isInstance:s,passType:r,animationsInfo:n}){const o=function(t,i,s){const{animationsInfo:r}=s,n={};return n.ANS_ENABLED=!!r&&e.defaultValue(r.enabled,!1),i&&e.checkIsVectorShadowVolumeDataType(i.classificationType)&&(n.SHADOW_VOLUME=!0),t&&t.clampEnabled&&(n.HAS_CLIPPING=!0,t.clampPlane?n.IS_CLIPPING_PLANE=!0:t.clampBox?n.IS_CLIPPING_BOX=!0:t.clampRange&&(n.IS_CLIPPING_RANGE=!0)),i&&i.lightingModel===e.LightingModelType.PBR?(n.USE_PBR=!0,n.USE_IBL=!0):(n.USE_PBR=!1,n.USE_IBL=!1),n.PHONG_LIGHT=i?.lightingModel===e.LightingModelType.PHONG,n}(t,i,{isInstance:s,passType:r,animationsInfo:n}),a=function(t){switch(t){case e.RenderPassConsts.PICK_PASS:return e.extend({},Em,{ENCODE_DEPTH_TO_FRAGCOLOR:!0});case e.RenderPassConsts.SHADOW_PASS:case e.RenderPassConsts.VIEWSHED_PASS:case e.RenderPassConsts.REAL_RENDER_PASS:case e.RenderPassConsts.BLOOM_PASS:case e.RenderPassConsts.FXAA_PASS:case e.RenderPassConsts.HDR_PASS:case e.RenderPassConsts.TOON_SHADING_PASS:return e.extend({},Em,{});case e.RenderPassConsts.PICK_COLOR_PASS:return e.extend({},Em,{USE_PICKING:!0});default:return e.extend({},Em,{})}}(r);return e.extend(o,a)}class Pm{constructor(e){this.textures={},this.requests={},this.source=e||{fire(){}};}addTexture(t,i,s,r,n){if(this.getTexture(t)||this.requests[t])r&&(r.state="loaded"),this.source.fire(new e.Event("data",{dataType:"gltf-data-loaded"}));else {if(i)this.requests[t]=e.getImage({url:i},((i,r)=>{if(i)throw new e.ErrorEvent(i);if(r){const i=new e.Texture({context:s,image:r,pixelFormat:e.WebGLConstants.RGBA,useMipmap:!0});i.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),this.textures[t]=i,this.requests[t]=null,delete this.requests[t];}}));else {const i=new e.window.Image,o=e.window.URL||e.window.webkitURL;i.onload=()=>{const r=new e.Texture({context:s,image:i,pixelFormat:e.WebGLConstants.RGBA,useMipmap:!0});r.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),this.textures[t]=r,this.requests[t]=null,delete this.requests[t];};const a=t.slice(t.lastIndexOf("_")+1),l=new e.window.Blob([new Uint8Array(n)],{type:r.result.gltf.images[a].mimeType});i.src=n.length?o.createObjectURL(l):e.CONSTS.SOURCE.TRANSPARENT_PNG_URL;}r.requestImages++;}}getTexture(e){return this.textures[e]}removeTexture(e){this.textures[e]&&(this.requests[e]&&(this.requests[e].cancel(),this.requests[e]=null,delete this.requests[e]),this.textures[e].destroy(),this.textures[e]=null,delete this.textures[e]);}getCanvasData(e){}removeAllTexture(){for(const e in this.textures)this.removeTexture(e),this.requests[e].cancel();}}class Rm extends e.Evented{constructor(){super(),this._drawCommands=new k,this.sharedTextures=new Pm,this.isPlotter=!0;}update(){}updateFrameState(e){this.frameState=e;}parse(e,t,i,s){}render(e){}createMaterial(e){}parseMaterial(){}parseGeometry(){}static parseRenderState(t,i){if(e.checkIsVectorShadowVolumeDataType(i.classificationType)){const t={};t.blending=e.renderStateEnum.disableBlending,t.cull=e.renderStateEnum.disableCull,t.depthTest=e.renderStateEnum.enableDepthTest,t.depthRange=e.renderStateEnum.depthRange,t.depthMask=e.renderStateEnum.disableDepthMask,t.stencilTest=e.renderStateEnum.enableClassificationStencilTest,t.stencilMask=e.renderStateEnum.enableStencilMask,t.colorMask=e.renderStateEnum.disabledColorMask;const i={};return i.blending=e.renderStateEnum.enableBlending,i.cull=e.renderStateEnum.disableCull,i.depthTest=e.renderStateEnum.disableDepthTest,i.depthRange=e.renderStateEnum.depthRange,i.depthMask=e.renderStateEnum.disableDepthMask,i.stencilTest=e.renderStateEnum.openClassificationStencilTest,i.colorMask=e.renderStateEnum.enableColorMask,i.stencilMask=e.renderStateEnum.enableStencilMask,e.deepCopyObj({pass1:t,pass2:i})}{const t={};return t.blending=e.renderStateEnum.enableBlending,t.depthRange=e.renderStateEnum.depthRange,i.depthTest?(t.depthTest=e.renderStateEnum.enableDepthTest,t.depthMask=e.renderStateEnum.enableDepthMask):(t.depthTest=e.renderStateEnum.disableDepthTest,t.depthMask=e.renderStateEnum.disableDepthMask),t.cull=e.renderStateEnum.enableCull,t.frontFace=e.WebGLConstants.CW,t.stencilTest=e.renderStateEnum.disableStencilTest,t.stencilMask=e.renderStateEnum.disableStencilMask,e.deepCopyObj(t)}}}const Bm={[e.RenderPassConsts._USER_DEFINED_PRE_PASS]:(e,t)=>t(e),[e.RenderPassConsts.PICK_PASS]:e=>e,[e.RenderPassConsts.SHADOW_PASS]:e=>e,[e.RenderPassConsts.VIEWSHED_PASS]:e=>e,[e.RenderPassConsts.REAL_RENDER_PASS]:e=>e,[e.RenderPassConsts.FXAA_PASS]:e=>e,[e.RenderPassConsts.BLOOM_PASS]:()=>[],[e.RenderPassConsts.TOON_SHADING_PASS]:()=>[],[e.RenderPassConsts.HDR_PASS]:()=>[],[e.RenderPassConsts.USER_DEFINED_POST_PROCESS_PASS]:()=>[],[e.RenderPassConsts.PICK_COLOR_PASS]:e=>e,[e.RenderPassConsts.CUBE_MAP_RENDER_FOR_SKYBOX]:t=>{const i=[];for(let s=0;s<t.length;s++)if(e.RenderPassConsts.CUBE_MAP_RENDER_FOR_SKYBOX in t[s].filterPassIds)return i.push(t[s]);return i},[e.RenderPassConsts.EARTH_EFFECT_PASS]:e=>e,[e.RenderPassConsts.PROXY_PASS]:e=>e};class Im extends Rm{constructor(e){super(e),this._renderPrimitives=[],this._needClearStencilPrimitives=[],this.isRegularVector=!0,this.plotterType="fill";}update(e,t,i,s,r){this.parse(e,t,i,s,r),this.render(e,i,r);}render(t,i,s){const r=Bm[s.passType](this._renderPrimitives);let n;this.isRegularVector||(n=this._createRenderState(t,i));let o=!0;for(let a=0;a<r.length;a++){const l=r[a];this.isRegularVector?(l._material instanceof e.VectorFillMaterial&&(l.update(t,s),l._material.renderState.stencilTest={enabled:!0,frontFunction:e.WebGLConstants.NOTEQUAL,backFunction:e.WebGLConstants.NOTEQUAL,reference:t.tileClippingMask.vectorLayerStencilID,mask:255,frontOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.KEEP},backOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.KEEP}},l._material.renderState.colorMask=e.renderStateEnum.enableColorMask,l.render(t,i,s),l._material.renderState.stencilTest={enabled:!0,frontFunction:e.WebGLConstants.NOTEQUAL,backFunction:e.WebGLConstants.NOTEQUAL,reference:t.tileClippingMask.vectorLayerStencilID,mask:255,frontOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.REPLACE},backOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.REPLACE}},l._material.renderState.colorMask=e.renderStateEnum.disabledColorMask,l.render(t,i,s)),l._material instanceof vh&&(o&&(t.clearStencil(),o=!1),l.update(t,s),l.render(t,i,s))):(l._material.renderState=n.pass1,l.update(t,s),l.render(t,i,s),l._material.renderState=n.pass2,l.update(t,s),l.render(t,i,s));}this._renderPrimitives=[],t.tileClippingMask.status=!1;}parse(t,i,s,r,n){if(r.length>0){this.isRegularVector=!e.checkIsVectorShadowVolumeDataType(s.classificationType);const o=s.paint?.get("fill-antialias");for(let e=0;e<r.length;e++){const a=r[e],l=i.getTile(r[e]);if(!l.getBucket(s))continue;const h=Mm({source:null,layer:s,isInstance:!1,passType:n.passType}),_=l.primitiveMap.get(s.id);if(_)if(this.isRegularVector){const e=this._createRenderState(t,s,a),i=_.fill;i&&(i._material.defines=h,i._material.renderState=e,this._renderPrimitives.unshift(i));const r=_.outline;r&&o&&(!i?.material?.hasPattern()||i?.material?.hasPattern()&&!s.outlineFromFillColor)&&(r._material.defines=h,r._material.renderState=e,this._renderPrimitives.push(r));}else {const e=_.fill;e._material.defines=h,this._renderPrimitives.push(e);}}}}_createRenderState(e,t){let i;return i=Im.parseRenderState(e,t),i}destroy(){this.programId=void 0,this._renderPrimitives=void 0,this.isRegularVector=void 0,this.plotterType=void 0;}}class Dm{constructor(){this.writeMaskRs=void 0,this.useMaskRs=void 0,this.uniforms={},this.programType="sphereClipping";}renderMask(){}createProgram(){}}class Om extends Dm{constructor(){super(),this.status=!1,this.nextStencilID=1,this.vectorLayerStencilID=1,this.requestedVectorLayerIDs=[1];}increaseVectorLayerID(e){this.requestedVectorLayerIDs=[];for(let t=0;t<e;t++)this.vectorLayerStencilID++,this.vectorLayerStencilID>255&&(this.vectorLayerStencilID=1),this.requestedVectorLayerIDs.push(this.vectorLayerStencilID);}}const Lm="Classification",Vm=Object.freeze({});class Nm{constructor(e){this.setup(e);}setup(e){this._setRenderListEmpty(),this.painter=e.painter,e.painter.style&&this.update(e);}_setRenderListEmpty(){this.globeRaster=[],this.raster=[],this.sphereLayerOrder=[],this.classificationLayers=[],this.modelPrimitiveList=[],this.modelOpaquePrimitiveList=[],this.modelTranslucentPrimitiveList=[],this.modelClassificationPrimitiveList=[],this.modelClassificationOpaquePrimitiveList=[],this.modelClassificationTranslucentPrimitiveList=[],this.modelIgnoreClassificationPrimitiveList=[],this.modelIgnoreClassificationOpaquePrimitiveList=[],this.modelIgnoreClassificationTranslucentPrimitiveList=[],this.forceOverModelVectorLayerList=[];}getNearFarPlane(t,i){const s=i.activeCamera.positionWC;let r=+Number.MAX_VALUE,n=-Number.MAX_VALUE;for(const t in this.painter.style.rasterSourceCache._tiles){const i=t.split("_");if(parseInt(i[0])<10)continue;const o=this.painter.style.rasterSourceCache._tiles[t];if("loaded"===o.state&&e.defined(o.primitive)){const t=o.primitive.boundingVolume;let i;for(let r=0;r<3;r++){const n=new e.Vector3(t.halfAxes.slice(3*r,3*r+3)).normalize().multiplyScalar(-1),o=t.computePlaneDistances(s,n);isNaN(o.start)||(i?o.start>i.start&&(i=o):i=o);}if(!i)continue;let a=i.start,l=i.stop;a<0&&l<0&&(a=-l,l=-a),a<0&&l>0&&(a=.1),r=Math.min(r,a),n=Math.max(n,l);}}const o=this.modelPrimitiveList;for(let t=0;t<o.length;t++){const i=o[t];let a=i.boundingVolume;if(e.defined(i.modelInstanceCollection)&&(a=i.modelInstanceCollection.boundingVolume),a){let t;for(let i=0;i<3;i++){const r=new e.Vector3(a.halfAxes.slice(3*i,3*i+3)).normalize().multiplyScalar(-1),n=a.computePlaneDistances(s,r);isNaN(n.start)||(t?n.start>t.start&&(t=n):t=n);}if(!t)continue;let i=t.start,o=t.stop;if(i<0&&o<0&&(i=-o,o=-i),i<0&&o>0){if(Math.abs(o-i)>50)continue;i=.1;}r=Math.min(r,i),n=Math.max(n,o);}}return {near:r,far:.6*n}}update(t){const{layers:i,orders:s,frameState:r}=t,n=this.painter,o=r.camera.frustumCrate.cullingVolume;this._setRenderListEmpty();for(let t=0;t<s.length;t++){const r=i[s[t]];if((!r||n.style.map._cameraUnderground||!r.isHiddenByMapZoom(n.transform.zoom))&&"visible"===r.visibility&&r.paint)if(r.type==e.VectorLayerType.TILES||r.type==e.VectorLayerType.MODEL)n.style.sourceCaches[r.source].addClippingPlanes&&n.style.sourceCaches[r.source].addClippingPlanes(r.clippingPlanes),n.style.sourceCaches[r.source].addCustomizedStyle&&n.style.sourceCaches[r.source].addCustomizedStyle(r.paint),r.classificationType===e.ClassificationType.IGNORECLASSIFICATION?(this.modelIgnoreClassificationOpaquePrimitiveList=this.modelIgnoreClassificationOpaquePrimitiveList.concat(n.style.sourceCaches[r.source].getOpaquePrimitives(o,void 0,r)),this.modelIgnoreClassificationTranslucentPrimitiveList=this.modelIgnoreClassificationTranslucentPrimitiveList.concat(n.style.sourceCaches[r.source].getTranslucentPrimitives(o,void 0,r))):(this.modelOpaquePrimitiveList=this.modelOpaquePrimitiveList.concat(n.style.sourceCaches[r.source].getOpaquePrimitives(o,void 0,r)),this.modelTranslucentPrimitiveList=this.modelTranslucentPrimitiveList.concat(n.style.sourceCaches[r.source].getTranslucentPrimitives(o,void 0,r)));else {if(r.type===e.VectorLayerType.RASTER){if(r.depthTest||n.style.map.style.hasTerrainData){this.globeRaster.push(s[t]);continue}this.raster.push(s[t]);}e.checkIsVectorShadowVolumeDataType(r.classificationType)?this.classificationLayers.push(s[t]):r.classificationType==e.ClassificationType.FORCE_VECTOR_OVER_MODEL||r.classificationType==e.ClassificationType.IGNORECLASSIFICATION?this.forceOverModelVectorLayerList.push(s[t]):this.sphereLayerOrder.push(s[t]);}}if(t.vectorQuery)return;n.style.tilesetCollection.update(r),n.style.modelCollection.update(r),n.style.primitiveCollection.update(r),n._map.videoManager.clear3DModel(),n._map.videoManager.clear3DTiles(),[n.style.modelCollection,n.style.tilesetCollection,n.style.primitiveCollection,n.style.scenePointPrimitiveCollection,n.style.sceneObjectCollection].forEach(((e,t)=>{const i=e.getIndependentPrimitiveObject(o);e instanceof hu&&t<=2&&(n._map.videoManager.update3DModel(i.opaque),n._map.videoManager.update3DModel(i.translucent)),this.modelOpaquePrimitiveList=this.modelOpaquePrimitiveList.concat(i.opaque),this.modelTranslucentPrimitiveList=this.modelTranslucentPrimitiveList.concat(i.translucent);const s=e.getIgnoreClassificationPrimitiveObject(o);this.modelIgnoreClassificationOpaquePrimitiveList=this.modelIgnoreClassificationOpaquePrimitiveList.concat(s.opaque),this.modelIgnoreClassificationTranslucentPrimitiveList=this.modelIgnoreClassificationTranslucentPrimitiveList.concat(s.translucent);})),this.modelPrimitiveList=this.modelOpaquePrimitiveList.concat(this.modelTranslucentPrimitiveList);const a=n.style.primitiveCollection.getClassificationPrimitiveObject(o);this.modelClassificationOpaquePrimitiveList=this.modelClassificationOpaquePrimitiveList.concat(a.opaque),this.modelClassificationTranslucentPrimitiveList=this.modelClassificationTranslucentPrimitiveList.concat(a.translucent),this.modelClassificationPrimitiveList=this.modelClassificationOpaquePrimitiveList.concat(this.modelClassificationTranslucentPrimitiveList),this.modelIgnoreClassificationPrimitiveList=this.modelIgnoreClassificationOpaquePrimitiveList.concat(this.modelIgnoreClassificationTranslucentPrimitiveList),t.ignoreNonePickPrimitive&&(this.modelPrimitiveList=this.modelPrimitiveList.filter((e=>e.allowPick)),this.modelClassificationPrimitiveList=this.modelClassificationPrimitiveList.filter((e=>e.allowPick)),this.modelIgnoreClassificationPrimitiveList=this.modelIgnoreClassificationPrimitiveList.filter((e=>e.allowPick)));}setFilter(){}render(e){const{layers:t,frameState:i}=e,s=this.painter;this.currentLayer=0,this._renderPrimitives({primitives:s.style.sceneObjectCollection.getSkyAndEarthPrimitives(),frameState:i}),this._renderRasterLayers(t,i),this.renderLayers(this.sphereLayerOrder,t,i),this._renderPrimitives({primitives:this.modelPrimitiveList,frameState:i}),this.renderLayers(this.classificationLayers,t,i),this._renderPrimitives({primitives:this.modelClassificationPrimitiveList,frameState:i,renderType:Lm}),this.modelClassificationPrimitiveList.length>0&&this.globeRaster.length<1&&(Fm(!0,i,s),this._renderPrimitives({primitives:this.modelClassificationPrimitiveList,frameState:i,renderType:Lm}),Fm(!1,i,s)),this._renderPrimitives({primitives:this.modelIgnoreClassificationPrimitiveList,frameState:i}),this.renderLayers(this.forceOverModelVectorLayerList,t,i);}renderLayers(t,i,s){if(0===t.length)return;let r,n=[];const o=[],a=this.painter;for(let l=0;l<t.length;l++){if("raster"===i[t[l]].type){o.push(i[t[l]]),this.raster[this.raster.length-1]===t[l]&&(n=a.style.rasterSourceCache.getVisibleCoordinates(!1),this.executePaint({sourceCache:a.style.rasterSourceCache,layer:o,coords:n,frameState:s}));continue}if("background"===i[t[l]].type){n=a.style.rasterSourceCache.getVisibleCoordinates(!1),this.executePaint({sourceCache:a.style.rasterSourceCache,layer:[i[t[l]]],coords:n,frameState:s});continue}const h=i[t[l]];if(h?.source!==(r&&r.id))r=a.style.sourceCaches[h.source],r&&r.getVisibleCoordinates&&(n=r.getVisibleCoordinates(h.type===e.VectorLayerType.SYMBOL||h.type===e.VectorLayerType.SYMTRACKING));else {const t=h.layout&&h.layout.get("symbol-placement"),i=n.every((e=>e.posMatrix));!t||"point"!==t&&"line"!==t&&"line-center"!==t||i||r&&r.getVisibleCoordinates&&(n=r.getVisibleCoordinates(h.type===e.VectorLayerType.SYMBOL||h.type===e.VectorLayerType.SYMTRACKING));}this.executePaint({sourceCache:r,layer:h,coords:n,frameState:s});}}_renderRasterLayers(e,t){const i=this.painter,s=[];for(let t=0;t<this.globeRaster.length;t++)s.push(e[this.globeRaster[t]]);if(s.length>0||i.style.proxySourceCache.enabled&&i.style.map.style.hasTerrainData){const e=i.style.rasterSourceCache.getVisibleCoordinates(!1);this.executePaint({sourceCache:i.style.rasterSourceCache,layer:s,coords:e,frameState:t});}}executePaint(t){const{sourceCache:i,layer:s,coords:r,primitives:n,frameState:o}=t,a=void 0===o.overrideMaterial,l=this.painter;if(e.defined(n)&&e.defined(o.overrideMaterial)&&"depthMaterial"===o.overrideMaterial._type)for(let t=0;t<n.length;t++)e.defined(n[t]._material)&&"BillboardMaterial"===n[t]._material._type&&n.splice(t--,1);let h=!1;if(s){if(s instanceof Array)l.rasterPlotter.update(l,i,s,r,o);else if(s.type===e.VectorLayerType.LINE&&a&&!1!==s.stencilTest){const e=s.paint.get("line-opacity"),t=s.getPaintProperty("line-pattern");(e.constantOr(1)<1||!e.isConstant()||t)&&r.length&&(l.tileClippingMask.increaseVectorLayerID(2),l.tileClippingMask.status=!0,h=!0);}else if(s.type===e.VectorLayerType.FILL&&a){const t=s.paint.get("fill-opacity").constantOr(1),i=!s.paint.get("fill-opacity").isConstant(),r=s.paint.get("fill-color").constantOr(new e.Color(1,1,1,1)),n=s.getPaintProperty("fill-outline-color"),o=s.getPaintProperty("fill-pattern");(t<1||i||n||r.a<1||o)&&(l.tileClippingMask.increaseVectorLayerID(1),l.tileClippingMask.status=!0,h=!0);}if(s.type===e.VectorLayerType.FILL){if(!i.adaptTerrain||!l.style.hasTerrainData){const e=this.filterTile(i,s,r,l);l.fillPlotter.update(l,i,s,e,o);}}else if(s.type===e.VectorLayerType.SYMBOL||s.type===e.VectorLayerType.SYMTRACKING){const e=this.filterTile(i,s,r,l);e.length&&l.symbolPlotter.update(l,i,s,e,o);}else if(s.type===e.VectorLayerType.MODEL||s.type===e.VectorLayerType.TILES)l.modelPlotter.update(l,i,s,o,n);else if(s.type===e.VectorLayerType.LINE){if(!i.adaptTerrain||!l.style.hasTerrainData){const e=this.filterTile(i,s,r,l);e.length&&l.linePlotter.update(l,i,s,e,o);}}else if(s.type===e.VectorLayerType.TRACKING||s.type===e.VectorLayerType.SPRITE){const e=this.filterTile(i,s,r,l);e.length&&l.linePlotter.update(l,i,s,e,o);}else if(s.type===e.VectorLayerType.CIRCLE)l.circlePlotter.update(l,i,s,r,o);else if(s.type===e.VectorLayerType.HEATMAP){const e=this.filterTile(i,s,r,l);e.length&&l.heatmapPlotter.update(l,i,s,e,o);}else if(s.type===e.VectorLayerType.EXTRUSION||s.type===e.VectorLayerType.HISTOGRAM){const e=this.filterTile(i,s,r,l);e.length&&l.extrusionPlotter.update(l,i,s,e,o);}l.tileClippingMask.status=!1,s.type!==e.VectorLayerType.RASTER&&s.type!==e.VectorLayerType.MODEL&&s.type!==e.VectorLayerType.TILES||!l.options.showDebugBoundingBox||l.debugBoundingBoxPlotter.update(l,i,s,o),h&&l.clearStencil();}o.sameLayerFrame=!1;}filterTile(t,i,s,r){const n=[];e.checkIsVectorShadowVolumeDataType(i.classificationType)&&r.clearStencil();for(let e=0;e<s.length;e++)t.getTile(s[e]).getBucket(i)&&n.push(s[e]);return n}_renderPrimitives({primitives:t,frameState:i,renderType:s}){0!==t.length&&this.executePaint({sourceCache:Vm,layer:{lightingModel:this.painter._map.lightingModel,type:e.VectorLayerType.MODEL,isHidden:()=>!1,classificationType:s===Lm?e.ClassificationType.ALL:e.ClassificationType.NONE},primitives:t,frameState:i});}}function Fm(t,i,s){if(t){i.preMainDepthStencilTexture=s.mainPass.framebuffer.depthStencilTexture;const t=s.backgroundPass.framebuffer.depthStencilTexture;s.context.gl.framebufferTexture2D(e.WebGLConstants.FRAMEBUFFER,e.WebGLConstants.DEPTH_STENCIL_ATTACHMENT,t._target,t.texture,0);}else s.context.gl.framebufferTexture2D(e.WebGLConstants.FRAMEBUFFER,e.WebGLConstants.DEPTH_STENCIL_ATTACHMENT,i.preMainDepthStencilTexture._target,i.preMainDepthStencilTexture.texture,0),i.preMainDepthStencilTexture=void 0;}class Gm extends Rm{constructor(e){super(e),this._renderPrimitives=[],this.plotterType="symbol";}update(t,i,s,r,n){void 0!==s.paint&&n.passType!==e.RenderPassConsts.PICK_PASS&&(this.parse(t,i,s,r,n),this.render(t,s,n));}render(e,t,i){const s=Bm[i.passType](this._renderPrimitives);for(let r=0;r<s.length;r++){const n=s[r];n._material.isSDF&&n._material.hasHalo&&(n._material.ishalo=!0,n.update(e,i),n.render(e,t,i)),n._material.ishalo=!1,n.update(e,i),n.render(e,t,i);}this._renderPrimitives=[];}removePrimitive(e,t){}parse(t,i,s,r,n){if(r.length>0){"symtracking"===s.type&&e.SymbolMaterial.updateSymtrackingLayerProperty(s,t,i);const o=Mm({source:null,layer:null,isInstance:!1,passType:n.passType}),a=this._createRenderState();for(const e of r){const t=i.getTile(e);if(!t.getBucket(s))continue;const r=t.primitiveMap.get(s.id);if(!r)continue;const n=r.icon;n&&(n._material.defines=o,n._material.renderState=a,this._renderPrimitives.unshift(n));const l=r.text;l&&(l._material.defines=o,l._material.renderState=a,this._renderPrimitives.push(l));}}}_createRenderState(){const t={};return t.blending=e.renderStateEnum.enableBlending,t.depthTest=e.renderStateEnum.disableDepthTest,t.depthMask=e.renderStateEnum.disableDepthMask,t.cull=e.renderStateEnum.disableCull,t.stencilTest=e.renderStateEnum.disableStencilTest,t.stencilMask=e.renderStateEnum.disableStencilMask,t}destroy(){this._renderPrimitives=[],this.plotterType=void 0;}}class km extends Rm{constructor(e){super(e),this._renderPrimitives=[],this.plotterType="extrusion";}update(e,t,i,s,r){if(!i.paint||0===i.paint.get("extrusion-opacity")?.value?.value)return;const n=t.getSource();this._updateAnimation(n),this.parse(e,t,i,s,r,n.animationsInfo),this._error||this.render(e,i,r,n.animationsInfo);}render(t,i,s,r){const n=Bm[s.passType](this._renderPrimitives);t.clearStencil();const o=i.paint.get("extrusion-opacity")?.value?.value,a=i.paint.get("histogram-opacity")?.value?.value,l=1===o||1===a,h=e.stencilModeforExtrusion(t);for(let e=0;e<n.length;e++){const o=n[e];o.update(t,s,{renderStateTag:"first",enableColorMask:l,animationsInfo:r}),o.render(t,i,s);}if(!l)for(let e=0;e<n.length;e++){const o=n[e];o.update(t,s,{renderStateTag:"second",stencilTest:h,animationsInfo:r}),o.render(t,i,s);}this._renderPrimitives=[];}parse(e,t,i,s,r,n){if(s.length>0){const o=this.getMicroDefinition(e,i,r,n);for(const r of s){const s=t.getTile(r).primitiveMap.get(i.id);s&&(s._material.initializedRenderState||(s._material.renderState=this._createRenderState(e,i),s._material.initializedRenderState=!0),s._material.defines=o,this._renderPrimitives.push(s));}}}_createRenderState(){return {depthMask:e.renderStateEnum.enableDepthMask,depthTest:e.renderStateEnum.enableDepthTestWithLEQUAL,stencilMask:e.renderStateEnum.enableStencilMask,colorMask:e.renderStateEnum.enableColorMask,cull:e.renderStateEnum.disableCull,blending:e.renderStateEnum.enableBlending}}destroy(){this._renderPrimitives=void 0,this.isRegularVector=void 0,this.plotterType=void 0;}getMicroDefinition(t,i,s,r){const n=Mm({source:null,layer:null,isInstance:!1,passType:s.passType}),o=Ju.getExtrusionMicroDefinition(i,r);return e.extend(n,o)}_updateAnimation(e){if(!e.animationPropertyCollection||0===e.animationPropertyCollection.size)return;const t=e?.animationPropertyCollection,i=t.getAll();1===i.length&&i[0].updateAnimation(e);}}class Um extends e.Geometry{constructor(t){super(t),this.type="BoxOutlineGeometry",this.primitiveType=e.WebGLConstants.LINES,this.setData(t);}setData(t){if(super.setData(t),t.minPoint&&t.maxPoint){t.minPoint=e.Vector3.unpack(t.minPoint),t.maxPoint=e.Vector3.unpack(t.maxPoint);const i=(t.maxPoint.x-t.minPoint.x)/2,s=(t.maxPoint.y-t.minPoint.y)/2,r=(t.maxPoint.z-t.minPoint.z)/2;this.minPoint=new e.Vector3(-i,-s,-r),this.maxPoint=new e.Vector3(i,s,r);}else this.maxPoint=e.Vector3.multiplyByScalar(new e.Vector3(t.width,t.height,t.depth),.5,new e.Vector3),this.minPoint=e.Vector3.negate(this.maxPoint,new e.Vector3);this._usedDoublePrecision=!1,this._vertexArray?(this._vertexArray.clear(),this._indices.clear()):(this._vertexArray=this._usedDoublePrecision?new e.StructArrayLayout3f3f24:new e.StructArrayLayout3f12,this._indices=new e.StructArrayLayout2ui4),this.parse(),this.computeBoundingSphere(),this.computeBoundingBox();}parse(){this.computeNearFarPlanes(),this.emplaceVertexBufferOfLines(),this.computeIndices();for(let e=0;e<this.indices.length;e+=2)this._indices.emplaceBack(this.indices[e],this.indices[e+1]);this.needUpdate=!0;}computeNearFarPlanes(){const e=new Float64Array(24);e[0]=this.minPoint.x,e[1]=this.minPoint.y,e[2]=this.minPoint.z,e[3]=this.maxPoint.x,e[4]=this.minPoint.y,e[5]=this.minPoint.z,e[6]=this.maxPoint.x,e[7]=this.maxPoint.y,e[8]=this.minPoint.z,e[9]=this.minPoint.x,e[10]=this.maxPoint.y,e[11]=this.minPoint.z,e[12]=this.minPoint.x,e[13]=this.minPoint.y,e[14]=this.maxPoint.z,e[15]=this.maxPoint.x,e[16]=this.minPoint.y,e[17]=this.maxPoint.z,e[18]=this.maxPoint.x,e[19]=this.maxPoint.y,e[20]=this.maxPoint.z,e[21]=this.minPoint.x,e[22]=this.maxPoint.y,e[23]=this.maxPoint.z,this.vertices=e;}computeIndices(){const e=new Uint16Array(24);e[0]=4,e[1]=5,e[2]=5,e[3]=6,e[4]=6,e[5]=7,e[6]=7,e[7]=4,e[8]=0,e[9]=1,e[10]=1,e[11]=2,e[12]=2,e[13]=3,e[14]=3,e[15]=0,e[16]=0,e[17]=4,e[18]=1,e[19]=5,e[20]=2,e[21]=6,e[22]=3,e[23]=7,this.indices=e;}update(t){if(this.needUpdate&&t.painter){this.needUpdate=!1;const i=t.painter.context;this._vertBuffer&&this._indexBuffer?(this._vertBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indices)):(this._vertBuffer=i.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?Yu.members:Qu.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indices,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/2);}}serialize(){return {type:this.type,maxPoint:e.Vector3.pack(this.maxPoint,new Array(3)),minPoint:e.Vector3.pack(this.minPoint,new Array(3))}}destroy(){super.destroy(),this.type=null,this.primitiveType=null,this._vertexArray=null,this._indices=null,this.maxPoint=null,this.minPoint=null,this.vertices=null;}static fromDiagonal(t,i){if(!e.defined(t)||!e.defined(i))throw new Error("diagonal positios must be defined!");if(!e.Vector3.equals(t,i))return new Um({minPoint:t,maxPoint:i});console.error("两点不能是同一个点");}}class Hm extends Rm{constructor(e){super(e);}update(e,t,i,s){this.render(e,i,s,t);}render(e,t,i,s){e.clearStencil();const r=e.style.debugBoundingBoxPrimitiveCollection.getAllNeedRenderPrimitive();for(let s=0;s<r.length;s++){const n=r[s];n.update(e,i,{}),n.render(e,t,i);}e.style.debugBoundingBoxPrimitiveCollection.removeNeedRenderPrimitiveList();}removePrimitive(){}static createDebugBoundingBoxPrimitive(t){const i=e.Matrix4.fromRotationTranslation(t.halfAxes,t.center,new e.Matrix4),s=new Um({width:2,height:2,depth:2}),r=e.StandardMaterial.fromType("Color",{color:"white",opacity:1,lightingModel:e.LightingModelType.NONE}),n=new e.Primitive({modelMatrix:i,geometry:s,material:r});return n.id=t.id,t.painter.style.debugBoundingBoxPrimitiveCollection.add(n),n}destroy(){this.programId=void 0,this.sharedTextures=void 0;}}class zm extends Rm{constructor(e){super(e),this.programId="gltfPBR",this._renderPrimitives=[],this.plotterType="model";}update(e,t,i,s,r){this.parse(e,t,i,s,r),this.render(e,i,s,t);}render(t,i,s,r){const n=Bm[s.passType](this._renderPrimitives),o=!e.checkIsVectorShadowVolumeDataType(i.classificationType);let a;o||(t.clearStencil(),a=zm._createRenderState(t,i));for(let r=0;r<n.length;r++){const l=n[r];if(void 0!==s.overrideMaterial&&l.framebuffer)continue;if(null!=l.rootId){const e=t._map.getSceneComponent(l.rootId);i.lightingModel=void 0===e?0:e.lightingModel,kc.setLightDefines(l,i);}const h=s.overrideMaterial||l._material;o?(l._material.overrideRenderState=void 0,l.update(t,s,{}),l.render(t,i,s)):(h.overrideRenderState=a.pass1,l.update(t,s,{}),l.render(t,i,s),h.overrideRenderState=a.pass2,h instanceof e.PickColorMaterial&&(h.overrideRenderState.blending=e.renderStateEnum.disableBlending),l.update(t,s,{}),l.render(t,i,s)),l._afterRenderFunction&&l.afterRender(l._afterRenderFunction),h.overrideRenderState=void 0;}this._renderPrimitives=[];}parse(t,i,s,r,n){const o=Mm({source:i?._source,layer:s,passType:r.passType}),a=i?.tilesForRender||[];for(let e=0;e<a.length;e++){const t=a[e];t.animations&&t.animations.length>0&&(t.animations[0].isRunning||t.animations[0].play(),t.rootNode.updateMatrixWorld(!0));}this._renderPrimitives=n,this._renderPrimitives.forEach((i=>{(r.overrideMaterial||i._material).defines=o;let s=i.boundingVolume;e.defined(i.modelInstanceCollection)&&(s=i.modelInstanceCollection.boundingVolume),t.options.showDebugBoundingBox&&this.createDebugBoundingBox(t,s,i.tileUid||i.id);}));}createDebugBoundingBox(e,t,i){if(!t)return;let s=e.style.debugBoundingBoxPrimitiveCollection.get(i);s||(s=Hm.createDebugBoundingBoxPrimitive({painter:e,center:t.center,halfAxes:t.halfAxes,id:i})),e.style.debugBoundingBoxPrimitiveCollection.add(s);}static _createRenderState(e,t){return zm.parseRenderState(e,t)}destroy(){this.programId=void 0,this._renderPrimitives=void 0;}}class Wm extends Rm{constructor(e){super(e),this._renderPrimitives=[],this.isRegularVector=!0,this.plotterType="line",this.lastCoords=[];}update(t,i,s,r,n){if(void 0===s.paint)return;if(n.overrideMaterial instanceof e.PickColorMaterial)return;const o=s.paint.get("line-opacity")||s.paint.get("tracking-opacity")||s.paint.get("sprite-opacity"),a=s.paint.get("line-width")||s.paint.get("tracking-width")||s.paint.get("sprite-width");if(0===o.constantOr(1)||0===a.constantOr(1))return;const l=i.getSource();l.animationsInfo={},"trips"===s.paint.get("tracking-type")&&this._updateAnimation(l),this.parse(t,i,s,r,n,l.animationsInfo),this.render(t,s,n,l.animationsInfo);}render(e,t,i,s){const r=Bm[i.passType](this._renderPrimitives);let n;this.isRegularVector||(n=this._createRenderState(e,t));for(let o=0;o<r.length;o++){const a=r[o],l=a._material.isBorder;this.isRegularVector?(l&&(a.update(e,i,{animationsInfo:s}),a.render(e,t,i)),l&&(a._material.isBorder=!1),a.update(e,i,{animationsInfo:s}),a.render(e,t,i),l&&(a._material.isBorder=!0)):(l&&(a._material.renderState=n.pass1,a.update(e,i,{animationsInfo:s}),a.render(e,t,i),a._material.renderState=n.pass2,a.update(e,i,{animationsInfo:s}),a.render(e,t,i)),l&&(a._material.isBorder=!1),a._material.renderState=n.pass1,a.update(e,i,{animationsInfo:s}),a.render(e,t,i),a._material.renderState=n.pass2,a.update(e,i,{animationsInfo:s}),a.render(e,t,i),l&&(a._material.isBorder=!0));}this._renderPrimitives=[],e.tileClippingMask.status=!1;}parse(t,i,s,r,n,o){if(r.length>0){this.isRegularVector=!e.checkIsVectorShadowVolumeDataType(s.classificationType),"tracking"===s.type&&wh.updateLayerProperty(s,t);const a=Mm({source:null,layer:null,isInstance:!1,passType:n.passType,animationsInfo:o}),l=Ju.getVectorLineDefinition(null,s);e.extend(a,l);const h=s.getCrossfadeParameters();for(let e=0;e<r.length;e++){const n=r[e],o=i.getTile(n),l=o.getBucket(s);if(!l)continue;"sprite"==s.type&&l.programConfigurations.get(s.id).updatePaintBuffers(h);const _=o.primitiveMap.get(s.id);if(_)if(this.isRegularVector){const e=this._createRenderState(t,s,n),i=_.line;i._material.defines=a,i._material.renderState=e,this._renderPrimitives.push(i);}else {const e=_.line;e._material.defines=a,this._renderPrimitives.push(e);}}}}_createRenderState(t,i){const s=Wm.parseRenderState(t,i);return this.isRegularVector&&(s.cull=e.renderStateEnum.disableCull),s}destroy(){this.programId=void 0,this._renderPrimitives=void 0,this.isRegularVector=void 0,this.plotterType=void 0;}_updateAnimation(e){if(!e.animationPropertyCollection||0===e.animationPropertyCollection.size)return;const t=e?.animationPropertyCollection,i=t.getAll();1===i.length&&i[0].updateAnimation(e);}}class jm extends Rm{constructor(e){super(e),this.sourceType=void 0,this._renderPrimitives=[],this.programId="sphereRaster",this.plotterType="raster";}update(e,t,i,s,r){this.parse(e,t,i,s),this.render(e,i,r);}render(t,i,s){const r=Bm[s.passType](this._renderPrimitives);if(t._map.analysis.excavationCollection.length>0){t._map.analysis.excavationCollection.update(t,r,i);for(let t=0;t<r.length;t++)r[t]._material.renderState.stencilMask=255,r[t]._material.renderState.stencilTest={enabled:!0,frontFunction:e.WebGLConstants.EQUAL,backFunction:e.WebGLConstants.EQUAL,reference:0,mask:255,frontOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.KEEP},backOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.KEEP}};}for(const n of i)if(n.maskingEnabled){const i=n.maskingPolygonPrimitive;i&&(i._material.renderState.depthTest=e.renderStateEnum.disableDepthTest,i.update(t,s),i.render(t,n,s));for(let t=0;t<r.length;t++)r[t]._material.renderState.stencilMask=255,r[t]._material.renderState.stencilTest={enabled:!0,frontFunction:e.WebGLConstants.EQUAL,backFunction:e.WebGLConstants.EQUAL,reference:n.maskingId,mask:255,frontOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.REPLACE},backOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.REPLACE}};}for(let e=0;e<r.length;e++){const n=r[e];n.update(t,s),n.render(t,i,s);}this._renderPrimitives=[];}parse(t,i,s){const r={};let n=!1;for(const e of s)r[e.id]=e,"background"===e.type&&(n=!e.getPaintProperty("background-terrain-analysis"));const o=t.style.rasterSourceCache._tiles;let a=!0;const l=s.length>0?this._createRenderState(t,s[0]):{blending:e.renderStateEnum.enableBlending,depthRange:e.renderStateEnum.depthRange,stencilTest:e.renderStateEnum.disableStencilTest,stencilMask:e.renderStateEnum.disableStencilMask,depthTest:e.renderStateEnum.enableDepthTest,depthMask:e.renderStateEnum.enableDepthMask};for(const i in o){const c=o[i];if(c.terrain&&"replaced"!==c.terrain.state&&t.style.rasterSourceCache.ambiguousSet.has(i))continue;if(!c.primitive)continue;let u;if(n){a=s[0].depthTest;const t=s[0].paint.get("background-color"),i=s[0].paint.get("background-opacity");c.backgroundLayerColor=new e.Vector4(t.r,t.g,t.b,i);}else {for(const t of c.images){const i=r[t.layerId];i?(t.opacity=i.paint.get("raster-opacity"),t.brightnessMin=i.paint.get("raster-brightness-min"),t.brightnessMax=i.paint.get("raster-brightness-max"),t.saturation=(_=i.paint.get("raster-saturation"))>0?1-1/(1.001-_):-_,t.contrast=(h=i.paint.get("raster-contrast"))>0?1/(1-h):1+h,t.spinWeight=Xm(i.paint.get("raster-hue-rotate")),i.lightingModel&&(u=i.lightingModel),a=i.depthTest):(t.opacity=0,t.brightnessMin=0,t.brightnessMax=1,t.saturation=0,t.contrast=1,t.spinWeight=new e.Vector3(1,0,0));}c.proxyImage&&(c.proxyImage.opacity=t.frameState.passType===e.RenderPassConsts.PICK_PASS?0:1);}const d=Ju.getRasterSourceAndLayerMicroDefinition();d.DISABLE_DEPTHTEST=!a&&!t.style.map.style.hasTerrainData,d.BACKGROUND_LAYER=!!n;const m=c.primitive;m&&(m._material.renderState=l,m._material.defines=d,kc.setLightDefines(m,{lightingModel:u}),t.options.showDebugBoundingBox&&this.createDebugBoundingBox(t,m.boundingBox,i),this._renderPrimitives.push(m));}var h,_;}_createRenderState(t,i){const s={};s.blending=e.renderStateEnum.enableBlending,s.depthRange=e.renderStateEnum.depthRange,s.stencilTest=e.renderStateEnum.disableStencilTest,s.stencilMask=e.renderStateEnum.disableStencilMask,s.cull=e.renderStateEnum.enableCull,s.frontFace=e.WebGLConstants.CCW;const r=t.style._layers;for(const n in r)void 0===r[n].classificationType?i.depthTest||t.style.map.style.hasTerrainData?(s.depthTest=e.renderStateEnum.enableDepthTest,s.depthMask=e.renderStateEnum.enableDepthMask):(s.cull=e.renderStateEnum.enableCull,s.frontFace=e.WebGLConstants.CCW,s.depthTest=e.renderStateEnum.disableDepthTest,s.depthMask=e.renderStateEnum.disableDepthMask):i.depthTest||t.style.map.style.hasTerrainData||r[n].classificationType===e.ClassificationType.ALL?(s.depthTest=e.renderStateEnum.enableDepthTest,s.depthMask=e.renderStateEnum.enableDepthMask):(s.cull=e.renderStateEnum.enableCull,s.frontFace=e.WebGLConstants.CCW,s.depthTest=e.renderStateEnum.disableDepthTest,s.depthMask=e.renderStateEnum.disableDepthMask),t._map.enableUnderGround&&(s.cull=e.renderStateEnum.disableCull);return s}destroy(){this.sourceType=void 0,this._renderPrimitives=void 0,this.programId=void 0,this.plotterType=void 0;}createDebugBoundingBox(e,t,i){if(!t)return;let s=e.style.debugBoundingBoxPrimitiveCollection.get(i);s||(s=Hm.createDebugBoundingBoxPrimitive({painter:e,center:t.center,halfAxes:t.halfAxes,id:i})),e.style.debugBoundingBoxPrimitiveCollection.add(s);}}function Xm(t){t*=Math.PI/180;const i=Math.sin(t),s=Math.cos(t);return new e.Vector3((2*s+1)/3,(-Math.sqrt(3)*i-s+1)/3,(Math.sqrt(3)*i-s+1)/3)}class qm extends Rm{constructor(e){super(e),this._renderPrimitives=[],this.plotterType="circle";}update(e,t,i,s,r){this.parse(e,t,i,s,r),this.render(e,t,i,s,r);}render(e,t,i,s,r){const n=Bm[r.passType](this._renderPrimitives);for(let t=0;t<n.length;t++){const s=n[t];s.update(e,r),s.render(e,i,r);}this._renderPrimitives=[],e.tileClippingMask.status=!1;}parse(t,i,s,r,n){if(r.length>0){const o=Mm({source:null,layer:null,isInstance:!1,passType:n.passType}),a=Ju.getSphereCircleDefinition(null,s);e.extend(o,a);for(let e=0;e<r.length;e++){const n=i.getTile(r[e]).primitiveMap.get(s.id);n&&(n._material.renderState=this._createRenderState(t,s),n._material.defines=o,this._renderPrimitives.push(n));}}}_createRenderState(t,i){const s=qm.parseRenderState(t,i);return s.cull=e.renderStateEnum.disableCull,s}destroy(){this.isPlotter=void 0,this.plotterType=void 0,this._renderPrimitives=void 0;}}class Km extends e.Material{constructor(t){super(t),this.layer=t.layer,this.tile=t.tile,this.coord=t.coord,this._programConfiguration=t.programConfiguration,this._renderState=t.renderState,this._unitsToPixels=new e.Vector2,this._cameraPosition=new e.Vector3,this._pixelMatrix=new e.Matrix2;const i=t.painter;this.matrix=new e.Matrix4,this.matrix.ortho({left:0,right:i.width,bottom:i.height,top:0,near:0,far:1}),this.colorRampTexture=new e.Texture({context:i.context,image:this.layer.colorRamp,pixelFormat:e.WebGLConstants.RGBA}),this._createUniforms(i);}update(t,i,s={}){super.update(t,i,s),this.basecolorTexture=s.texture,this._uniforms.set("u_ModelViewProjectionMatrix",(()=>this.matrix)),this.renderState.blending={enabled:!0,color:{red:0,green:0,blue:0,alpha:0},equationRgb:e.WebGLConstants.FUNC_ADD,equationAlpha:e.WebGLConstants.FUNC_ADD,functionSourceRgb:e.WebGLConstants.SRC_ALPHA,functionSourceAlpha:e.WebGLConstants.ONE,functionDestinationRgb:e.WebGLConstants.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:e.WebGLConstants.ONE_MINUS_SRC_ALPHA};}_createUniforms(t){this._uniforms.set("u_GlUnitsToPixels",(()=>this._unitsToPixels.set(t.style.symbolMatrixHelper.width/2,t.style.symbolMatrixHelper.height/2))),this._uniforms.set("u_PixelMatrix",(()=>(this._pixelMatrix.identity(),this._pixelMatrix.scale([1,Math.cos(t.transform.hpr.pitch)]),this._pixelMatrix.rotate(-t.transform.hpr.heading),this._pixelMatrix))),this._uniforms.set("u_Opacity",(()=>this.layer.paint.get("heatmap-opacity"))),this._uniforms.set("u_BaseColorSampler",(()=>(this.basecolorTexture.sampler={minificationFilter:e.WebGLConstants.LINEAR,magnificationFilter:e.WebGLConstants.LINEAR,wrapS:e.WebGLConstants.CLAMP_TO_EDGE,wrapT:e.WebGLConstants.CLAMP_TO_EDGE},this.basecolorTexture))),this._uniforms.set("u_color_ramp",(()=>(this.colorRampTexture.sampler={minificationFilter:e.WebGLConstants.LINEAR,magnificationFilter:e.WebGLConstants.LINEAR,wrapS:e.WebGLConstants.CLAMP_TO_EDGE,wrapT:e.WebGLConstants.CLAMP_TO_EDGE},this.colorRampTexture))),this._uniforms.set("u_World",(()=>new e.Vector2(t.context.drawingBufferWidth,t.context.drawingBufferHeight)));}destroy(){this.layer=void 0,this.tile=void 0,this.coord=void 0,this.pattern=void 0,this.type=void 0,this._uniforms=void 0,this._textures=void 0,this._program=void 0,this._programConfiguration=void 0,this._renderState=void 0,this._unitsToPixels=void 0,this._cameraPosition=void 0,this._pixelMatrix=void 0;}}class Jm extends e.Geometry{constructor(t){super(),this.type="HeatMapViewPortGeometry",this.primitiveType=e.WebGLConstants.TRIANGLES,this.widthSegments=t.widthSegments,this.heightSegments=t.heightSegments,this.transform=t.transform,this._vertexArray=void 0,this._indices=void 0,this._width=1,this._height=1,this._vertexLength=0,this._primitiveLength=0,this._needUpdate=!1,this.parse();}parse(){this._vertexArray=new e.StructArrayLayout5f20,this._indices=new e.StructArrayLayout3ul12;const t=Math.floor(this.widthSegments),i=Math.floor(this.heightSegments),s=t+1,r=i+1,n=this._width/t,o=this._height/i;for(let e=0;e<r;e++){const r=e*o;for(let o=0;o<s;o++)this._vertexArray.emplaceBack(o*n/this._width*2-1,1-r/this._height*2,1,o/t,1-e/i);}this._vertexLength=s*r;for(let e=0;e<i;e++)for(let i=0;i<t;i++){const t=i+s*(e+1),r=i+1+s*(e+1),n=i+1+s*e;this._indices.emplaceBack(i+s*e,n,t),this._indices.emplaceBack(n,t,r);}this._primitiveLength=t*i*2,this._needUpdate=!0;}update(t){const i=t.painter.context;this.transform=t.painter.transform,this.widthSegments===this.transform.width/4&&this.heightSegments===this.transform.height/4||(this.widthSegments=this.transform.width/4,this.heightSegments=this.transform.height/4,this.parse()),this._needUpdate&&(this._vertBuffer&&this._indexBuffer&&this._segmentVector?(this._vertBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indices),this._segmentVector.destroy(),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this._vertexLength,this._primitiveLength)):(this._vertBuffer=i.createVertexBuffer(this._vertexArray,ya.members,!0),this._indexBuffer=new Go(i,this._indices,!0,e.WebGLConstants.UNSIGNED_INT),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this._vertexLength,this._primitiveLength)),this._needUpdate=!1);}destroy(){return this.type=void 0,this.primitiveType=void 0,this.widthSegments=void 0,this.heightSegments=void 0,this.transform=void 0,this._vertexArray=void 0,this._indices=void 0,this._width=void 0,this._height=void 0,this._vertexLength=void 0,this._primitiveLength=void 0,this._needUpdate=void 0,this._segmentVector.destroy(),this._segmentVector=void 0,this._vertBuffer.destroy(),this._vertBuffer=void 0,this._indexBuffer.destroy(),this._indexBuffer=void 0,e.destroyObject(this)}}class Zm extends e.Material{constructor(t){super(t),this.layer=t.layer,this.tile=t.tile,this.coord=t.coord,this._programConfiguration=t.programConfiguration,this._renderState=t.renderState,this.colorRampTexture=new e.Texture({context:t.painter.context,image:this.layer.colorRamp,pixelFormat:e.WebGLConstants.RGBA}),this._createUniforms();}update(t,i,s={}){super.update(t,i,s),this.basecolorTexture=s.texture;const r=this.getCamera(i);this._uniforms.set("u_ModelViewProjectionMatrix",(()=>r.getVPMatrix())),this._uniforms.set("u_InvertViewMatrix",(()=>r.getViewMatrix().invert())),this._uniforms.set("u_ViewMatrix",(()=>r.getViewMatrix().setTranslation(new e.Vector3(0,0,0)))),this._uniforms.set("u_HeightFactor",(()=>this.layer.paint.get("heatmap-height-factor").value.value)),this.renderState.blending={enabled:!0,color:{red:0,green:0,blue:0,alpha:0},equationRgb:e.WebGLConstants.FUNC_ADD,equationAlpha:e.WebGLConstants.FUNC_ADD,functionSourceRgb:e.WebGLConstants.SRC_ALPHA,functionSourceAlpha:e.WebGLConstants.ONE,functionDestinationRgb:e.WebGLConstants.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:e.WebGLConstants.ONE_MINUS_SRC_ALPHA};}_createUniforms(){this._uniforms.set("u_Opacity",(()=>this.layer.paint.get("heatmap-opacity"))),this._uniforms.set("u_BaseColorSampler",(()=>(this.basecolorTexture.sampler={minificationFilter:e.WebGLConstants.LINEAR,magnificationFilter:e.WebGLConstants.LINEAR,wrapS:e.WebGLConstants.CLAMP_TO_EDGE,wrapT:e.WebGLConstants.CLAMP_TO_EDGE},this.basecolorTexture))),this._uniforms.set("u_color_ramp",(()=>(this.colorRampTexture.sampler={minificationFilter:e.WebGLConstants.LINEAR,magnificationFilter:e.WebGLConstants.LINEAR,wrapS:e.WebGLConstants.CLAMP_TO_EDGE,wrapT:e.WebGLConstants.CLAMP_TO_EDGE},this.colorRampTexture))),this._uniforms.set("u_Bezier",(()=>new e.Vector4(.5,0,1,.5)));}destroy(){this.layer=void 0,this.tile=void 0,this.coord=void 0,this.pattern=void 0,this.type=void 0,this._uniforms=void 0,this._textures=void 0,this._program=void 0,this._programConfiguration=void 0,this._renderState=void 0,this.colorRampTexture.destroy(),this.colorRampTexture=void 0;}}class Ym extends Rm{constructor(e){super(e),this._renderPrimitives=[],this.plotterType="heatmap",this._texturePrimitive=null,this.framebuffer=null;}update(e,t,i,s,r){this.parse(e,t,i,s,r),this.render(e,t,i,s,r);}render(t,i,s,r,n){const o=Bm[n.passType](this._renderPrimitives);if(0==o.length||!this._texturePrimitive)return;const a=t.context,l=n.framebuffer;n.framebuffer=this.framebuffer,a.bindFramebuffer.set(this.framebuffer.framebuffer),a.clear({color:e.Color.transparent,depth:1,stencil:0});for(let e=0;e<o.length;e++){const i=o[e];i.update(t,n),i.render(t,s,n);}n.framebuffer=l,this._texturePrimitive.update(t,n,{texture:this.framebuffer.getColorTexture(0)}),this._texturePrimitive.render(t,s,n),this._renderPrimitives=[],t.tileClippingMask.status=!1;}parse(t,i,s,r,n){if(r.length>0){const o=Mm({source:null,layer:null,isInstance:!1,passType:n.passType}),a=Ju.getSphereHeatmapDefinition(null,s);e.extend(o,a);for(let e=0;e<r.length;e++){const n=i.getTile(r[e]);if(!n.getBucket(s))continue;const a=n.primitiveMap.get(s.id);a&&(a._material.renderState=this._createRenderState(t,s),a._material.defines=o,this._renderPrimitives.push(a));}if(!this._texturePrimitive||!this.framebuffer||s.colorRampChanged){s.colorRampChanged&&this.resize();const e=s.getLayoutProperty("display-mode");if("3d"===e||"3D"===e){const e=new Jm({widthSegments:t.transform.width/4,heightSegments:t.transform.height/4,transform:t.transform});this._create3DTexturePrimitive({layer:s,painter:t,type:"heatmap3DTexture",geometry:e});}else this._createTexturePrimitive({layer:s,painter:t,type:"heatmapTexture"});this._createFramebuffer(t.width,t.height,t.context),s.colorRampChanged=!1;}}}_createFramebuffer(t,i,s){this.framebuffer||(this.framebuffer=new Yc({context:s,width:t,height:i,colorTextures:[new e.Texture({width:t,height:i,context:s,pixelFormat:e.WebGLConstants.RGBA,pixelDatatype:e.WebGLConstants.FLOAT})],depthStencilRenderbuffer:new Kc({context:s,width:t,height:i,format:qc.DEPTH_STENCIL})}));}_create3DTexturePrimitive(t){const{layer:i,painter:s,type:r,geometry:n}=t;if(!this._texturePrimitive){const t=this._create3DTextureMaterial({layer:i,painter:s,type:r});this._texturePrimitive=new e.Primitive({geometry:n,material:t});}}_create3DTextureMaterial(e){const{layer:t,painter:i,type:s}=e,r=this._createRenderState(i,t);return new Zm({layer:t,painter:i,type:s,renderState:r})}_createTexturePrimitive(t){const{layer:i,painter:s,type:r}=t;if(!this._texturePrimitive){const t=this._createTextureMaterial({layer:i,painter:s,type:r}),n=new Fd(s),o=new e.Primitive({geometry:n,material:t});this._texturePrimitive=o;}}_createTextureMaterial(e){const{layer:t,painter:i,type:s}=e,r=this._createRenderState(i,t);return new Km({layer:t,painter:i,type:s,renderState:r})}_createRenderState(t,i){const s=Ym.parseRenderState(t,i);return s.cull=e.renderStateEnum.disableCull,s}resize(){this.framebuffer&&(this.framebuffer.destroy(),this.framebuffer=null),this._texturePrimitive=null;}destroy(){this.isPlotter=void 0,this.plotterType=void 0,this._renderPrimitives=void 0;}}class Qm{constructor(){this.texMap=new Map;}getTexture(t){const i=e.defaultValue(t.name,""),s=e.defaultValue(t.texUrl,"");let r=i;""==i&&(r=s);const n=this.texMap.get(r);if(n)return n.addReference(),n;{const i=new e.Texture(t);return r&&""!=r&&this.texMap.set(r,i),i}}getTextureByName(e){const t=this.texMap.get(e);return t&&t.addReference(),t}addTexture(e,t){e&&""!=e&&this.texMap.set(e,t);}removeTexture(e){const t=this.texMap.get(e);t&&(t.reduceReference(),0===t.referenceCount&&(this.texMap.delete(e),t.destroy()));}}class $m{constructor(t){this.context=t.context,this.map=t.savedMap;const{gl:i}=this.context,s=i.getExtension("EXT_SRGB"),r=s?s.SRGB_EXT:e.WebGLConstants.RGBA,n=this.map.getStyle(),o="minemap://assets/IBLtextures_BlueSky";this.IBLUrl=(e=>{if(!ot(e))return e;const t=mt(e);return `${st.SRC_URL}/${t.authority}${t.path}`})(n.IBL?n.IBL:o),n.IBL||this.map.testMode||e.warnOnce(`map.style has no IBL defined, minemap.js sets the default value to ${o}`),this.getIBLImage(`${this.IBLUrl}/SkyBox0/brdfLUT.png`,r,i),this.mDiffuseEnvTex=this.loadCubeMap(i,"diffuse"),this.mSpecularEnvTex=this.loadCubeMap(i,"specular"),this.isLoaded=!0;}async getIBLImage(t,i){const s=await(()=>new Promise(((i,s)=>{e.getImage(this.map._transformRequest(t,e.ResourceType.Image),((e,t)=>{e&&s(e),i(t);}));})))();if(!(s.nodeName||s.width&&s.height))throw this.isLoaded=!1,new Error("load IBL image error");{const t=new e.Texture({context:this.context,image:s,pixelFormat:i,useMipmap:!1});t.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),this.mBrdfTex=t;}}loadCubeMap(t,i){const s=t.getExtension("EXT_SRGB"),r=t.createTexture();let n=-1,o=e.WebGLConstants.TEXTURE0,a=0;if("diffuse"===i?(o=e.WebGLConstants.TEXTURE1,n=1,a=1):"specular"===i?(o=e.WebGLConstants.TEXTURE2,n=2,a=1):"environment"===i&&(o=e.WebGLConstants.TEXTURE0,n=0,a=1),-1===n)return null;t.activeTexture(o),t.bindTexture(e.WebGLConstants.TEXTURE_CUBE_MAP,r),t.texParameteri(e.WebGLConstants.TEXTURE_CUBE_MAP,e.WebGLConstants.TEXTURE_WRAP_S,e.WebGLConstants.CLAMP_TO_EDGE),t.texParameteri(e.WebGLConstants.TEXTURE_CUBE_MAP,e.WebGLConstants.TEXTURE_WRAP_T,e.WebGLConstants.CLAMP_TO_EDGE),a<2?(t.texParameteri(e.WebGLConstants.TEXTURE_CUBE_MAP,e.WebGLConstants.TEXTURE_MIN_FILTER,e.WebGLConstants.LINEAR),t.texParameteri(e.WebGLConstants.TEXTURE_CUBE_MAP,e.WebGLConstants.TEXTURE_MAG_FILTER,e.WebGLConstants.LINEAR)):(t.texParameteri(e.WebGLConstants.TEXTURE_CUBE_MAP,e.WebGLConstants.TEXTURE_MIN_FILTER,e.WebGLConstants.LINEAR_MIPMAP_LINEAR),t.texParameteri(e.WebGLConstants.TEXTURE_CUBE_MAP,e.WebGLConstants.TEXTURE_MAG_FILTER,e.WebGLConstants.LINEAR));const l=`${this.IBLUrl}/SkyBox0/${i}/${i}`;for(let i=0;i<a;i++){const n=[[`${l}_right_${i}.jpg`,e.WebGLConstants.TEXTURE_CUBE_MAP_POSITIVE_X],[`${l}_left_${i}.jpg`,e.WebGLConstants.TEXTURE_CUBE_MAP_NEGATIVE_X],[`${l}_top_${i}.jpg`,e.WebGLConstants.TEXTURE_CUBE_MAP_POSITIVE_Y],[`${l}_bottom_${i}.jpg`,e.WebGLConstants.TEXTURE_CUBE_MAP_NEGATIVE_Y],[`${l}_front_${i}.jpg`,e.WebGLConstants.TEXTURE_CUBE_MAP_POSITIVE_Z],[`${l}_back_${i}.jpg`,e.WebGLConstants.TEXTURE_CUBE_MAP_NEGATIVE_Z]];for(let e=0;e<n.length;e++)this.loadCubeImage(0,n[e][1],n[e][0],o,s,r,t);}return new du({context:this.context,texture:r})}async loadCubeImage(t,i,s,r,n,o,a){const l=await(()=>new Promise(((t,i)=>e.getImage(this.map._transformRequest(s,e.ResourceType.Image),((e,s)=>{e&&i(e),t(s);})))))();if(l.nodeName||l.width&&l.height)this.onLoadEnvironmentURLImage(r,n,o,i,l,t,a);else if(l)throw this.isLoaded=!1,new Error("load IBL image error")}onLoadEnvironmentURLImage(t,i,s,r,n,o,a){const l=i?i.SRGB_EXT:e.WebGLConstants.RGBA;a.activeTexture(t),a.bindTexture(e.WebGLConstants.TEXTURE_CUBE_MAP,s),a.pixelStorei(e.WebGLConstants.UNPACK_FLIP_Y_WEBGL,!1),a.texImage2D(r,o,l,l,e.WebGLConstants.UNSIGNED_BYTE,n),s[r]=!0;}}class ep extends e.Material{constructor(e){super(e),this.type="distanceMaterial",this.renderState=this._createRenderState(),this.dirty=!1,this.bUniformCreated=!1;}update(e,t,i={}){super.update(e,t,i),this._updateDefines(i.primitive,e),this.bUniformCreated||this._createUniform();}_updateDefines(t,i){this.defines={JOINT_MATRIX_CNT:e.defaultValue(t?._material?.defines?.JOINT_MATRIX_CNT,!1),INSTANCE_MATRIX:e.defaultValue(t?._material?.defines?.INSTANCE_MATRIX,!1),USE_MORPHTARGETS:e.defaultValue(t?._material?.defines?.USE_MORPHTARGETS,!1),LOG_DEPTH:e.defaultValue(i._logDepth,!1)};}_createRenderState(){return {cull:{enabled:!1},depthTest:{enabled:!0,func:e.WebGLConstants.LESS},blending:e.renderStateEnum.disableBlending,stencilTest:{enabled:!1,frontFunction:e.WebGLConstants.ALWAYS,backFunction:e.WebGLConstants.ALWAYS,reference:0,mask:0,frontOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.REPLACE},backOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.REPLACE}}}}_createUniform(){this.bUniformCreated=!0;}destroy(){return this.type=void 0,this._renderState=void 0,this.dirty=void 0,this.bUniformCreated=void 0,this._uniforms=void 0,this._programConfiguration=void 0,this._shaderSource.destroy(),this._shaderSource=void 0,this.layer=void 0,this._pickColor=void 0,this._usePickColorTexture=void 0,this._isOneDimensionBatchTexture=void 0,this._pickTextureUniformsCallBack=void 0,e.destroyObject(this)}}function tp(e){return (e[0]+e[1]/255+e[2]/65025+e[3]/16581375)/255}class ip extends eu{constructor(e){super(e),this.replaceMaterial=new ep({});}update(e,t,i){e.frameState.overrideMaterial=this.replaceMaterial,super.update(e,t,i);}createFramebuffer({width:e,height:t,context:i}){return super.createFramebuffer({width:e,height:t,context:i})}initSize(t,i){e.defined(this.width)&&e.defined(this.height)||(this.width=t,this.height=i,this.bufferSize=this.width*this.height*4);}render(e){const{painter:t}=e,{context:i,frameState:s}=t,r=t.frameState.framebuffer,{width:n,height:o}=t.getMaxFramebufferSize();this.initSize(Math.floor(n/20),Math.floor(o/20)),this.update(t,this.width,this.height),super.middleRender(t,i,s),t.frameState.overrideMaterial=void 0,t.frameState.update({framebuffer:r}),t.frameState.bindFramebuffer(i);}getDistance(t){if(!this.height||!this.width)return Number.MAX_VALUE;const i=tu({x:0,y:this.height/e.window.devicePixelRatio,height:this.height,width:this.width},t,this.framebuffer,this.height,e.WebGLConstants.UNSIGNED_BYTE,this.bufferSize),s=new e.Vector4,r=new e.Vector4(1,1/255,1/65025,1/16581375);let n=Number.MAX_VALUE;for(let e=0;e<this.bufferSize;e+=4){if(0==i[e]&&0==i[e+1]&&0==i[e+2]&&0==i[e+3])continue;s.set(i[e],i[e+1],i[e+2],i[e+3]);const t=s.dot(r);n=Math.min(n,64.25*t);}return n<=0?.01:n}readPixel(e,t){return tp(tu(e,t,this.framebuffer,this.height))}}class sp extends eu{constructor(t){super(t),this.replaceMaterial=new e.DepthMaterial({});}update(e,t,i){e.frameState.overrideMaterial=this.replaceMaterial;const{context:s}=e;this.width===t&&this.height===i&&this.framebuffer||(this.framebuffer&&this.framebuffer.destroy(),this.framebuffer=this.createFramebuffer({width:t,height:i,context:s})),e.frameState.update({framebuffer:this.framebuffer}),e.frameState.bindFramebuffer(s),this.width=t,this.height=i;}createFramebuffer({width:t,height:i,context:s}){const r={width:t,height:i,context:s,pixelFormat:e.WebGLConstants.RGBA,pixelDatatype:e.WebGLConstants.FLOAT};return s.extColorBufferFloat||delete r.pixelDatatype,new Yc({context:s,width:t,height:i,colorTextures:[new e.Texture(r)]})}render(t){const{painter:i}=t,{context:s,mainPass:r,backgroundPass:n}=i,o=i.frameState.framebuffer,a=i.frameState.passType,{width:l,height:h}=i.getMaxFramebufferSize();this.update(i,l,h),s.clear({color:e.Color.white,depth:1,stencil:0}),this._uniforms||(this._uniforms=new Map([["u_ModelViewProjectionMatrix",()=>(new e.Matrix4).ortho({left:0,right:s.drawingBufferWidth,bottom:s.drawingBufferHeight,top:0,near:0,far:1})],["u_BaseColorSampler",()=>r.framebuffer.depthStencilTexture],["u_BackgroundSampler",()=>n.framebuffer.depthStencilTexture],["u_World",()=>new e.Vector2(s.drawingBufferWidth,s.drawingBufferHeight)]])),this.geometry=new Fd(i),this.material={renderState:e.RenderState.fromCache({depthTest:{enabled:!1},depthMask:!1,blending:e.renderStateEnum.disableBlending}),_uniforms:this._uniforms,_shaderSource:new e.ShaderSource({type:"showDepth"})},s.draw({painter:i,framebuffer:this.framebuffer.framebuffer,layer:{id:"depth"},geometry:this.geometry,material:this.material}),i.frameState.overrideMaterial=void 0,i.frameState.passType=a,i.frameState.update({framebuffer:o}),i.frameState.bindFramebuffer(s);}readPixel(t,i){const s=tu(t,i,this.framebuffer,this.height,i.extColorBufferFloat?e.WebGLConstants.FLOAT:e.WebGLConstants.UNSIGNED_BYTE);return i.extColorBufferFloat?s[0]:tp(s)}}class rp extends eu{constructor(t){super(t),this.replaceMaterial=new e.NormalMaterial({});}update(e,t,i){e.frameState.overrideMaterial=this.replaceMaterial,super.update(e,t,i);}createFramebuffer({width:t,height:i,context:s}){return new Yc({context:s,width:t,height:i,colorTextures:[new e.Texture({width:t,height:i,context:s,pixelFormat:e.WebGLConstants.RGBA,pixelDatatype:e.PixelDatatype.UNSIGNED_BYTE})],depthStencilRenderbuffer:new Kc({context:s,width:t,height:i,format:qc.DEPTH_STENCIL})})}render(e){const{painter:t}=e,{context:i,frameState:s}=t,r=t.frameState.framebuffer,{width:n,height:o}=t.getMaxFramebufferSize();this.update(t,n,o),super.middleRender(t,i,s),t.frameState.overrideMaterial=void 0,t.frameState.update({framebuffer:r}),t.frameState.bindFramebuffer(i);}readPixel(e,t){return tp(tu(e,t,this.framebuffer,this.height))}}class np extends e.Material{constructor(t){super(t),this.type="depthMaterial",this.renderState=this.createRenderState(),this.updateMVPMatrix=(t,i,s)=>{this._uniforms.set("u_ModelViewProjectionMatrix",(()=>{const i=t.transform.shadowCamera.vpMatrix.clone();return e.defined(s)?i.multiplyRight(s.matrixWorld):i}));};}createRenderState(){return {blending:{enabled:!1}}}}class op extends eu{constructor(e){super(e),this.replaceMaterial=new np({});}update(e,t,i){e.frameState.overrideMaterial=this.replaceMaterial,super.update(e,t,i);}createFramebuffer({width:e,height:t,context:i}){return super.createFramebuffer({width:e,height:t,context:i})}render(e){const{painter:t}=e,{context:i,frameState:s}=t,r=t.frameState.framebuffer,{width:n,height:o}=t.getMaxFramebufferSize();this.update(t,n,o),super.middleRender(t,i,s),t.frameState.overrideMaterial=void 0,t.frameState.update({framebuffer:r}),t.frameState.bindFramebuffer(i);}readPixel(e,t){return tp(tu(e,t,this.framebuffer,this.height))}}class ap extends eu{constructor(t){super(t),this.replaceMaterial=new e.PickColorMaterial({});}update(e,t,i){e.frameState.overrideMaterial=this.replaceMaterial;const{context:s}=e;this.width===t&&this.height===i&&this.framebuffer&&!this._SSAASamplesDirty||(this.framebuffer&&this.framebuffer.destroy(),this.framebuffer=this.createFramebuffer({width:t,height:i,context:s}),this._SSAASamplesDirty=!1),e.frameState.update({framebuffer:this.framebuffer}),e.frameState.bindFramebuffer(s),this.bindDepthTexture(e),this.width=t,this.height=i;}createFramebuffer({width:t,height:i,context:s}){return new Yc({context:s,width:t*this.SSAASamples,height:i*this.SSAASamples,colorTextures:[new e.Texture({width:t*this.SSAASamples,height:i*this.SSAASamples,context:s,pixelFormat:e.WebGLConstants.RGBA})]})}render(t){const{painter:i,ignoreNonePickPrimitive:s,vectorQuery:r}=t,{context:n,frameState:o}=i,a=i.frameState.framebuffer,{width:l,height:h}=i.getMaxFramebufferSize(),_=i.mainPass.SSAASamples;this.SSAASamples=_,this.update(i,l,h),e.RenderState.applyRenderState(n,e.RenderState.fromCache({viewport:{x:0,y:0,width:l*_,height:h*_}})),n.clear({color:e.Color.transparent,stencil:0}),i.renderGroup.update({layers:i.style._layers,orders:i.style._order,painter:i,frameState:o,ignoreNonePickPrimitive:s,vectorQuery:r}),i.renderGroup.render({layers:i.style._layers,painter:i,frameState:o}),i.frameState.overrideMaterial=void 0,i.frameState.update({framebuffer:a}),i.frameState.bindFramebuffer(n);}readPixel(e,t){return tu(e,t,this.framebuffer,this.height,void 0,void 0,this.SSAASamples)}bindDepthTexture(t){if(!t.mainPass.framebuffer)return;const{gl:i}=t.context,s=t.mainPass.framebuffer.depthStencilTexture;i.framebufferTexture2D(e.WebGLConstants.FRAMEBUFFER,e.WebGLConstants.DEPTH_STENCIL_ATTACHMENT,s._target,s.texture,0);}}class lp extends eu{constructor(t){t.passType=e.RenderPassConsts.REAL_RENDER_PASS,super(t),this.width=32,this.height=32;}update(e,t,i){this.framebuffer||(this.framebuffer=this._createFramebuffer({width:t,height:i,context:e.context})),e.frameState.update({framebuffer:this.framebuffer}),this.cameraStatusStore=null;}_createFramebuffer({width:e,height:t,context:i}){return i.createFramebuffer(e,t)}render(t){const{painter:i,skybox:s}=t,r=i.context,n=r.gl;if(s.ready)return;this.update(i,this.width,this.height);const o=i.frameState.framebuffer,a=i.frameState.passType;i.frameState.passType=this.passType,i.frameState.bindFramebuffer(r),e.RenderState.applyRenderState(r,e.RenderState.fromCache({viewport:{x:0,y:0,width:this.width,height:this.height}})),r.clear({color:e.Color.transparent,depth:1,stencil:0});const l=new du({context:r,pixelFormat:e.WebGLConstants.RGBA,fboTextureParameter:{width:this.width,height:this.height}});for(let t=0;t<6;t++)n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,e.WebGLConstants.TEXTURE_CUBE_MAP_POSITIVE_X+t,l.texture,0),s.primitiveToGenerateTexture._material.setMatrixByFaces(e.CONSTS.SOURCE.TEXTURE_CUBE_KEYS[t]),i.renderGroup.executePaint({sourceCache:{},layer:{type:"3d-model",isHidden(){}},primitives:[s.primitiveToGenerateTexture],frameState:i.frameState});s.updateSkyCubeTexture(l),e.RenderState.applyRenderState(r,e.RenderState.fromCache({viewport:{x:0,y:0,width:i.width,height:i.height}})),i.frameState.passType=a,i.frameState.update({framebuffer:o}),i.frameState.bindFramebuffer(r);}}class hp{constructor(t,i,s){this.texture=t.createTexture(),this._target=e.WebGLConstants.TEXTURE_CUBE_MAP,t.bindTexture(this._target,this.texture);for(let r=0;r<6;r++)t.texImage2D(e.WebGLConstants.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,e.WebGLConstants.RGBA,i,s,0,e.WebGLConstants.RGBA,e.WebGLConstants.UNSIGNED_BYTE,null);t.texParameteri(e.WebGLConstants.TEXTURE_CUBE_MAP,e.WebGLConstants.TEXTURE_MAG_FILTER,e.WebGLConstants.LINEAR),t.texParameteri(e.WebGLConstants.TEXTURE_CUBE_MAP,e.WebGLConstants.TEXTURE_MIN_FILTER,e.WebGLConstants.LINEAR),t.texParameteri(e.WebGLConstants.TEXTURE_CUBE_MAP,e.WebGLConstants.TEXTURE_WRAP_S,e.WebGLConstants.CLAMP_TO_EDGE),t.texParameteri(e.WebGLConstants.TEXTURE_CUBE_MAP,e.WebGLConstants.TEXTURE_WRAP_T,e.WebGLConstants.CLAMP_TO_EDGE),t.bindTexture(this._target,null);}}class _p extends eu{constructor(t){t.passType=e.RenderPassConsts.REAL_RENDER_PASS,super(t),this.width=t.textureSize?t.textureSize:512,this.height=t.textureSize?t.textureSize:512;}update(e,t,i){this.framebuffer||(this.framebuffer=this._createFramebuffer({width:t,height:i,context:e.context})),e.frameState.update({framebuffer:this.framebuffer}),this.cameraStatusStore=null;}_createFramebuffer({width:e,height:t,context:i}){return i.createFramebuffer(e,t)}render(t){const{painter:i,cubeMap:s,position:r,near:n,far:o}=t,{frameState:l,context:h}=i,{gl:_}=h,c=i.frameState.camera,u=new a(90,1,n,o);this.update(i,this.width,this.height),i.frameState.bindFramebuffer(h),e.RenderState.applyRenderState(h,e.RenderState.fromCache({viewport:{x:0,y:0,width:this.width,height:this.height}})),h.clear({color:e.Color.transparent,depth:1,stencil:0});const d=new hp(h.gl,this.width,this.height);this.renderCubeTexture(i,l,_,d,r,u),i.frameState.camera=c,s.cubeMap=d;}renderCubeTexture(t,i,s,r,n,o){for(let a=0;a<6;a++){s.clear(s.DEPTH_BUFFER_BIT),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,e.WebGLConstants.TEXTURE_CUBE_MAP_POSITIVE_X+a,r.texture,0);const l=e.Transforms.cartographicToFixedFrame(n);0==a?o.setMatrix(l.clone().rotateY(.5*-Math.PI).rotateZ(Math.PI)):1==a?o.setMatrix(l.clone().rotateY(.5*Math.PI).rotateZ(Math.PI)):2==a?o.setMatrix(l.clone().rotateX(.5*Math.PI)):3==a?o.setMatrix(l.clone().rotateX(.5*-Math.PI)):4==a?o.setMatrix(l.clone().rotateY(-Math.PI).rotateZ(Math.PI)):5==a&&o.setMatrix(l.clone().rotateZ(Math.PI)),t.frameState.camera=o,t.renderGroup.update({layers:t.style._layers,orders:t.style._order,frameState:i}),t.renderGroup.render({layers:t.style._layers,frameState:i});}}}class cp extends eu{constructor(e){super(e);}update(e,t,i){e.frameState.passType=this.passType,super.update(e,t,i);}render(e){const{painter:t,ignoreNonePickPrimitive:i}=e,{context:s,frameState:r}=t,n=t.frameState.framebuffer,o=t.frameState.passType,{width:a,height:l}=t.getMaxFramebufferSize();this.update(t,a,l),super.middleRender(t,s,r,i),t.frameState.passType=o,t.frameState.update({framebuffer:n}),t.frameState.bindFramebuffer(s);}}class up{constructor(e,t){this.painter=e,this.pass=t,this._init();}_init(){this.shaderSource=new e.ShaderSource({type:"screen"}),this.geometry=new Fd(this.painter),this.uniforms=new Map([["u_World",()=>new e.Vector2(this.painter.context.drawingBufferWidth,this.painter.context.drawingBufferHeight)],["u_ModelViewProjectionMatrix",()=>(new e.Matrix4).ortho({left:0,right:this.painter.context.drawingBufferWidth,bottom:this.painter.context.drawingBufferHeight,top:0,near:0,far:1})],["u_BaseColorSampler",()=>{let t;return t=this.painter.usePostProcess?this.painter.postProcessStages.outputTexture:this.pass.framebuffer.getColorTexture(0),t.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),t}],["u_Resolution",()=>new e.Vector2(this.painter.width,this.painter.height)]]),this.renderState={depthTest:{enabled:!0,func:e.WebGLConstants.LESS},blending:{color:{red:0,green:0,blue:0,alpha:0},enabled:!1,equationRgb:e.WebGLConstants.FUNC_ADD,equationAlpha:e.WebGLConstants.FUNC_ADD,functionSourceRgb:e.WebGLConstants.SRC_ALPHA,functionSourceAlpha:e.WebGLConstants.ONE,functionDestinationRgb:e.WebGLConstants.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:e.WebGLConstants.ONE_MINUS_SRC_ALPHA},stencilTest:{enabled:!1,frontFunction:e.WebGLConstants.ALWAYS,backFunction:e.WebGLConstants.ALWAYS,reference:0,mask:0,frontOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.REPLACE},backOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.REPLACE}}};}resolveFramebufferToScreen(){this.painter.context.bindFramebuffer.set(null),this.painter.context.clear({color:this.painter._map._canvasTransparent?e.Color.transparent:e.Color.black,depth:1,stencil:0}),this.shaderSource._defines.SSAASamples=this.painter._map.SSAASamples,this.painter.context.draw({painter:this.painter,framebuffer:null,layer:{id:"resovescreeen"},geometry:this.geometry,material:{renderState:this.renderState,_uniforms:this.uniforms,_shaderSource:this.shaderSource}});}destroy(){this.uniforms=null,this.painter=null,this._segmentVector=null,this.pass=null,this.shaderSource=null;}}class dp{constructor(){this.framebuffer=void 0;}initialize(t){const i=t.context,s=t.width,r=t.height;this.framebuffer=new Yc({context:i,width:s,height:r,colorTextures:[new e.Texture({width:s,height:r,context:i,pixelFormat:e.WebGLConstants.RGBA})],depthStencilRenderbuffer:new Kc({context:i,width:s,height:r,format:qc.DEPTH_STENCIL})});}update(t){e.defined(this.framebuffer)||this.initialize(t);}destroy(){}}class mp extends eu{constructor(t){t.passType=e.RenderPassConsts.REAL_RENDER_PASS,super(t);}update(e,t,i){}static render(t){const{painter:i,style:s}=t,{context:r}=i,{width:n,height:o}=i.getMaxFramebufferSize();if(!i||!s||!r)return;const a=i.frameState.framebuffer,l=i.frameState.passType;e.RenderState.applyRenderState(r,e.RenderState.fromCache({viewport:{x:0,y:0,width:n,height:o},blending:e.renderStateEnum.disableBlending})),r.clear({color:i._map._canvasTransparent?e.Color.transparent:e.Color.black,depth:1,stencil:0});const h=s.primitivePreRenderCollection.getAll();h.length>0&&i.renderGroup.executePaint({sourceCache:{},layer:{type:"3d-model",isHidden(){}},primitives:h,frameState:i.frameState}),i.frameState.passType=l,i.frameState.update({framebuffer:a}),i.frameState.bindFramebuffer(r);}}class pp extends Rm{constructor(e){super(e),this._renderPrimitives=[],this.plotterType="tile-debug",this.layerId="tile-debug";}update(e,t,i,s,r){this.parse(e,t,i,s,r),this.render(e,t,i,s,r);}render(e,t,i,s,r){const n=Bm[r.passType](this._renderPrimitives);for(let t=0;t<n.length;t++){const i=n[t];i.update(e,r),i.render(e,{id:this.layerId},r);}this._renderPrimitives=[];}parse(e,t,i,s){if(s.length>0){let t=this._drawCommands.get(this.layerId);t||(t=this._drawCommands.set(this.layerId,new k)),this._createMaterial();const i={};for(let r=0;r<s.length;r++){const n=s[r],o=e.debugTileCache.getTileByCoord(n);if(!o)continue;const a=o.matrix,l=t.get(n.key);l?(l.line._material.defines=i,this._renderPrimitives.push(l.line),l.text._material.defines=i,this._renderPrimitives.push(l.text)):this._createPrimitive({painter:e,tile:o,tileID:n,modelMatrix:a,currentLayerDrawCommands:t});}}}_createPrimitive(t){const{painter:i,tile:s,tileID:r,modelMatrix:n,currentLayerDrawCommands:o}=t,a=this._createGeometry(s,i.style.rasterSourceCache.quadtree.getBoundingRegionById(r.key)),l=new e.Primitive({modelMatrix:n,geometry:a.lineGeom,material:this.redColorMaterial}),h=new e.Primitive({modelMatrix:n,geometry:a.textGeom,material:this.blackColorMaterial});this._renderPrimitives.push(l,h),o.set(r.key,{line:l,text:h});}_createMaterial(){if(!this.redColorMaterial||!this.blackColorMaterial){const t=this._createRenderState();this.redColorMaterial=new e.Material({type:"debug"}),this.redColorMaterial._uniforms.set("u_Color",(()=>new e.Vector4(1,1,0,1))),this.redColorMaterial.renderState=t,this.blackColorMaterial=new e.Material({type:"debug"}),this.blackColorMaterial._uniforms.set("u_Color",(()=>new e.Vector4(0,1,0,1))),this.blackColorMaterial.renderState=t;}}_createRenderState(){return e.TileDebugJSONRenderState}_createGeometry(t,i){return {lineGeom:new e.Geometry({vertBuffer:t.debugBuffer,segmentVector:e.SegmentVector.simpleSegment(0,0,t.lineVerticesCount,0),primitiveType:e.WebGLConstants.LINE_STRIP,tileBoundingRegion:i}),textGeom:new e.Geometry({vertBuffer:t.debugBuffer,segmentVector:e.SegmentVector.simpleSegment(t.lineVerticesCount,0,t.textVerticesCount,0),primitiveType:e.WebGLConstants.LINES,tileBoundingRegion:i})}}removePrimitive(e){const t=e.tileID.key,i=this._drawCommands.get(this.layerId);if(i){const e=i.remove(t);e.line&&e.line.destroy(),e.text&&e.text.destroy();}}removeAllPrimitives(){const e=this._drawCommands.get(this.layerId).values;for(let t=0;t<e.length;t++)e[t].line&&e[t].line.destroy(),e[t].text&&e[t].text.destroy();this._drawCommands.remove(this.layerId),this.blackColorMaterial=void 0,this.redColorMaterial=void 0;}destroy(){this.isPlotter=void 0,this.plotterType=void 0,this._drawCommands=void 0,this._renderPrimitives=void 0;}}class fp{constructor(t){t=t||{},this.type="scene-object",this.id=`skybox-${e.uniqueId()}`,this.isSceneObject=!0,this._ready=!1,this.initialized=!1,this.cubeMap=void 0,this.init(t.painter);}init(t){const{context:i}=t;this.geometry=new uu({context:i}),this._cubeMapRenderingMaterial=new pu({type:"skyboxCapture"}),this.primitiveToGenerateTexture=new e.Primitive({material:this._cubeMapRenderingMaterial,geometry:this.geometry,allowPick:!1});}getPrimitiveForPass(){return this.primitiveToGenerateTexture}updateSkyCubeTexture(e){this._skyMaterial._fboTextureCube=e,this._ready=!0;}async _requestBoxImages(t,i){const s=e.CONSTS.SOURCE.TEXTURE_CUBE_KEYS,r=[];for(let n=0;n<6;n++){const o=new Promise(((r,o)=>{e.getImage(t._map._transformRequest(i[s[n]],e.ResourceType.Image),((e,t)=>{e&&o(e),r(t);}));}));r.push(o);}const n=await Promise.all(r),o={};for(let e=0;e<s.length;e++)o[s[e]]=n[e];return this._createTexture(t,o)}async _requestSingleImage(t,i){const s=new Promise(((s,r)=>{e.getImage(t._map._transformRequest(i,e.ResourceType.Image),((e,t)=>{e&&r(e),s(t);}));})),r=await s;return this._createTexture(t,r)}async _createTexture(t,i){const s=new du({context:t.context,images:i,pixelFormat:e.WebGLConstants.RGBA});return s.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),s}async _prepareTextures(e){this.starrySkyTextureUrls&&(this._skyMaterial.starrySkyTexture=await this._requestBoxImages(e,this.starrySkyTextureUrls)),this.dayTextureUrls&&(this._skyMaterial.dayTexture=await this._requestBoxImages(e,this.dayTextureUrls));}prepare(e){e.shaderProgramManager.setGlobalMacroDefinition({SKYBOX_CUBE_MAP_G:this.isCubeMap}),this._ready=!0;}get ready(){return this._ready}set ready(e){this._ready=e;}onAdd(e){this.init({painter:e.painter});}loaded(){return this._ready}destroy(){this.primitive.destroy(),this.primitiveToGenerateTexture.destroy();}collect(){return this._ready?[this.primitive]:[]}}class gp extends Ao{constructor(){super(new a(90,1,.5,500)),this._frameExtents=new e.Vector2(4,2),this._viewportCount=6,this._viewports=[new e.Vector4(2,1,1,1),new e.Vector4(0,1,1,1),new e.Vector4(3,1,1,1),new e.Vector4(1,1,1,1),new e.Vector4(3,0,1,1),new e.Vector4(1,0,1,1)],this._cubeDirections=[new e.Vector3(1,0,0),new e.Vector3(-1,0,0),new e.Vector3(0,0,1),new e.Vector3(0,0,-1),new e.Vector3(0,1,0),new e.Vector3(0,-1,0)],this._cubeUps=[new e.Vector3(0,1,0),new e.Vector3(0,1,0),new e.Vector3(0,1,0),new e.Vector3(0,1,0),new e.Vector3(0,0,1),new e.Vector3(0,0,-1)];}updateMatrices(e,t,i){const s=this.camera,r=this.matrix,n=this._lightPositionWorld,o=this._lookTarget;let a=this._projScreenMatrix;n.setFromMatrixPosition(e.matrixWorld),s.position.copy(n),o.copy(s.position),o.add(this._cubeDirections[i]),s.up.copy(this._cubeUps[i]),s.lookAt(o),s.updateMatrixWorld(),r.makeTranslation(-n.x,-n.y,-n.z),a=s.projectionMatrix.clone().multiplyRight(s.matrixWorldInverse),this._frustum.setFromMatrix(a);}}class yp extends So{constructor(e,t){super(e,t),this.type="PointLight",this.isPointLight=!0,this.shadow=new gp;}setPosition(t){this.position=e.Vector3.unpack(t);}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI);}serialize(){return {color:e.Vector3.pack(this.color,new Array(3)),intensity:this.intensity,position:e.Vector3.pack(this.position,new Array(3)),distane:this.distane,decay:this.decay,type:this.type}}}class Cp extends e.Material{constructor(t){t.type="mirrorMaterial",super(t),this.renderState=this._createRenderState(),this._reflectNear=e.defaultValue(t.reflectNear,1),this._reflectFar=e.defaultValue(t.reflectFar,1e3);}enableSSR(){this._enableSSR=!0;}disableSSR(){this._enableSSR=!1;}update(e,t,i={}){super.update(e,t,i),this._uniforms.set("u_EnvMap",(()=>{if(null!=e.cubeMapCollection[this.id])return e.cubeMapCollection[this.id].cubeMap}));}createRenderState(){const t={};return t.depthTest=e.renderStateEnum.disableDepthTest,t.depthMask=e.renderStateEnum.disableDepthMask,t.stencilTest=e.renderStateEnum.disableStencilTest,t}_createRenderState(){const t=e.Material.getDefaultRenderState();return t.cull.enabled=!0,t.polygonOffset={enabled:!0,factor:1,units:1},t}set reflectNear(e){this._reflectNear=e;}get reflectNear(){return this._reflectNear}set reflectFar(e){this._reflectNear=e;}get reflectFar(){return this._reflectFar}serialize(){return {reflectFar:this._reflectFar,reflectNear:this._reflectNear}}destroy(){}}class Tp extends _p{constructor(t){super(t),this.replaceMaterial=new e.DepthMaterial({}),this.replaceMaterial.defines.DEPTH_DISTANCE=!0;}update(e,t,i){e.frameState.overrideMaterial=this.replaceMaterial,super.update(e,t,i);}render(e){super.render(e),e.painter.frameState.overrideMaterial=null;}}class xp extends eu{constructor(e){super(e);}update(e,t,i){e.frameState.passType=this.passType;const{context:s}=e;this.width===t&&this.height===i&&this.framebuffer||(this.framebuffer&&this.framebuffer.destroy(),this.framebuffer=this.createFramebuffer({width:t,height:i,context:s})),e.frameState.update({framebuffer:this.framebuffer}),e.frameState.bindFramebuffer(s),this.width=t,this.height=i;}createFramebuffer({width:t,height:i,context:s}){const r=new e.Sampler({minificationFilter:e.TextureMinificationFilter.NEAREST,magnificationFilter:e.TextureMagnificationFilter.NEAREST});return new Yc({context:s,width:t,height:i,colorTextures:[new e.Texture({width:t,height:i,context:s,pixelFormat:e.WebGLConstants.RGBA})],depthStencilTexture:new e.Texture({context:s,width:t,height:i,minFilter:e.WebGLConstants.LINEAR,magFilter:e.WebGLConstants.LINEAR,pixelFormat:e.PixelFormat.DEPTH_STENCIL,pixelDatatype:e.PixelDatatype.UNSIGNED_INT_24_8,sampler:r,anisotropy:1,name:"background_depth_stencil"})})}render(t){const{painter:i}=t,{context:s}=i,r=i.frameState.framebuffer,n=i.frameState.passType,{width:o,height:a}=i.getMaxFramebufferSize();this.update(i,o,a),e.RenderState.applyRenderState(s,e.RenderState.fromCache({viewport:{x:0,y:0,width:o,height:a}})),s.clear({color:e.Color.white,depth:1,stencil:0}),i.renderGroup.executePaint({sourceCache:{},layer:[],frameState:i.frameState,coords:[]}),i.frameState.passType=n,i.frameState.update({framebuffer:r}),i.frameState.bindFramebuffer(s);}readPixel(t,i){return tu(t,i,this.framebuffer,this.height,e.WebGLConstants.UNSIGNED_BYTE)}}const bp=new e.ProgramConfiguration;class vp{constructor(t,i){this.textureResourceManager=new Qm,this.context=new Od(t,this),this.transform=i.transform,this.transform.shadowCamera._painter=this,this.setup(),this._logDepth=i._logDepth,this.context._logDepth=this._logDepth,this.shadowOff=e.CONSTS.EFFECTS.SHADOW_OFFSET,this._map=i,this.emptyTileTextureCanvas=null,this.shaderProgramManager=new Ju({context:this.context}),this.fillPlotter=new Im({}),this.extrusionPlotter=new km({}),this.tileClippingMask=new Om,this.symbolPlotter=new Gm({}),this.modelPlotter=new zm({}),this.linePlotter=new Wm({}),this.debugBoundingBoxPlotter=new Hm({}),this.rasterPlotter=new jm({}),this.circlePlotter=new qm({}),this.heatmapPlotter=new Ym({}),this.debugTilePlotter=new pp({}),this.plotterMap={[e.VectorLayerType.SYMBOL]:this.symbolPlotter,[e.VectorLayerType.SYMTRACKING]:this.symbolPlotter,[e.VectorLayerType.LINE]:this.linePlotter,[e.VectorLayerType.SPRITE]:this.linePlotter,[e.VectorLayerType.TRACKING]:this.linePlotter,[e.VectorLayerType.DYNAMIC_LINE]:this.linePlotter,[e.VectorLayerType.FILL]:this.fillPlotter,[e.VectorLayerType.RASTER]:this.rasterPlotter,[e.VectorLayerType.MODEL]:this.modelPlotter,[e.VectorLayerType.EXTRUSION]:this.extrusionPlotter,[e.VectorLayerType.HISTOGRAM]:this.extrusionPlotter,[e.VectorLayerType.CIRCLE]:this.circlePlotter,[e.VectorLayerType.DEBUG_TILE]:this.debugTilePlotter,[e.VectorLayerType.HEATMAP]:this.heatmapPlotter},this.renderGroup=new Nm({layers:{},orders:[],painter:this}),this.backgroundPass=new xp({passType:e.RenderPassConsts.PICK_PASS}),this.distancePass=new ip({context:this.context,passType:e.RenderPassConsts.PICK_PASS}),this.depthPass=new sp({context:this.context,passType:e.RenderPassConsts.PICK_PASS}),this.commonDepthPass=new sp({context:this.context,passType:e.RenderPassConsts.PICK_PASS}),this.normalPass=new rp({context:this.context,passType:e.RenderPassConsts.PICK_PASS}),this.shadowPass=new op({context:this.context,passType:e.RenderPassConsts.PICK_PASS}),this.mainPass=new cp({passType:e.RenderPassConsts.REAL_RENDER_PASS}),this.ssrPass=new cp({passType:e.RenderPassConsts.REAL_RENDER_PASS}),this.colorPass=new ap({context:this.context,passType:e.RenderPassConsts.PICK_COLOR_PASS}),this.frameState=new $c,this.resolveFramebuffer=new up(this,this.mainPass),this.postProcessStages=new Cm({fogNearFunction:()=>{if(i._cameraUnderground)return 1e5;const e=i.camera.cartographicPosition[2]/2;return e<200?200:e},fogFarFunction:()=>{if(i._cameraUnderground)return 2e5;const e=10*i.camera.cartographicPosition[2];return e<2e3?2e3:e}}),this.usePostProcess=!1,this.usePostProcessSelected=!1,this.postProcessFramebuffer=new dp,this.shadowOptions={EPSILON:.005,MapSizeScale:.1},this.cubeMapCollection={},this.cubeMapRenderPassCollection={};}setShadowOptions(e,t){this.shadowOptions[e]=t;}get iBLTextures(){return this._iBLTextures||(this._iBLTextures=new $m({context:this.context,savedMap:this._map})),this._iBLTextures}get getAllPlotter(){return [this.symbolPlotter,this.fillPlotter,this.modelPlotter,this.debugBoundingBoxPlotter,this.linePlotter,this.rasterPlotter,this.circlePlotter,this.heatmapPlotter,this.extrusionPlotter,this.debugTilePlotter]}getPlotterByKey(e){return this.plotterMap[e]}get projection(){return this._projection}set projection(t){t!==e.ProjectionType.MERCATOR&&t!==e.ProjectionType.LATLON||(this._projection=t);}getMaxFramebufferSize(){let t=this.width,i=this.height;const s=Math.min(e.ContextLimits.maximumViewportWidth,e.ContextLimits.maximumRenderbufferSize),r=Math.min(e.ContextLimits.maximumViewportHeight,e.ContextLimits.maximumRenderbufferSize);return (this.width>s||this.height>r)&&(this.width/s>this.height/r?(t=s,i=t/(this.width/this.height)):(i=r,t=this.width/this.height*i)),{width:t,height:i}}resize(t,i){if(this.width=t*e.exported.devicePixelRatio,this.height=i*e.exported.devicePixelRatio,this.context.viewport.set({x:0,y:0,width:this.width,height:this.height}),this.style)for(const e of this.style._order)this.style._layers[e].resize();this.heatmapPlotter.resize();}getPickRay(e){return this.frameState.camera.getPickRay(e,this._map._canvas)}getDistance(){return this.distancePass.render({painter:this}),this.distancePass.getDistance(this.context)}getPositionByGPUPick(t,i,s=this.depthPass){i?.ignoreNoneAllowPick&&(this.mainPass.render({painter:this,ignoreNonePickPrimitive:!0}),s.render({painter:this,ignoreNonePickPrimitive:!0}));const r=this.context,n=t,o=new e.Vector2(n.x*(r.drawingBufferWidth/this._map._canvas.clientWidth),n.y*(r.drawingBufferHeight/this._map._canvas.clientHeight));o.y=r.drawingBufferHeight-o.y;const a=s.readPixel(n,r);if(1===a)return;const l=new e.Vector4;l.x=(o.x-r._viewport.current.x)/r._viewport.current.width*2-1,l.y=(o.y-r._viewport.current.y)/r._viewport.current.height*2-1,l.z=2*a-1,l.w=1;let h=this.frameState.camera?.getVPMatrix().invert();h||(h=new e.Matrix4);const _=new e.Vector4;e.Matrix4.multiplyByVector(h,l,_);const c=1/_.w,u=new e.Vector3;return e.Vector3.multiplyByScalar(_,c,u),new e.Vector3(e.Transforms.cartesian3ToCartographic(u))}getFeatureByGPUPick(t,i,s){if(!this._map.unproject(t))return null;const r=t;i||this.mainPass.render({painter:this,ignoreNonePickPrimitive:!0}),this.colorPass.render({painter:this,ignoreNonePickPrimitive:!0,vectorQuery:s});const n=this.colorPass.readPixel(r,this.context);return this.context.getObjectByPickColor(new e.Color(e.Color.byteToFloat(n[0]),e.Color.byteToFloat(n[1]),e.Color.byteToFloat(n[2]),e.Color.byteToFloat(n[3])))}getFeatureByPickColor(t){const i=new e.Color(e.Color.byteToFloat(t[0]),e.Color.byteToFloat(t[1]),e.Color.byteToFloat(t[2]),e.Color.byteToFloat(t[3]));return this.context.getObjectByPickColor(i)}queryPixelColor(t){const i=tu(t[0],this.context,null,this.height),s=`rgba(${i[0]}, ${i[1]}, ${i[2]}, ${+parseFloat(i[3]/255).toFixed(2)})`;return {rgba:s,hex:e.rgba2Hex(s),color:new e.Color(i[0]/255,i[1]/255,i[2]/255,i[3]/255)}}setup(){}clearStencil(){this.context.clear({stencil:0});}_onBeforeRender(t,i){this.tileClippingMask.nextStencilID=1,this.style=t,this.options=i,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.imageManager.beginFrame(),this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.exported.now());for(const e in t.sourceCaches){const t=this.style.sourceCaches[e];t.used&&t.prepare(this.context);}this.frameState.update({camera:this.transform.activeCamera,shadowCamera:this.transform.shadowCamera});}_updateObjectsNeedCubeMap(){this.objectsNeedCubeMap=[],this.frameState._lights.length>0&&this.frameState._shadows&&this.frameState._lights.forEach((e=>{e instanceof yp&&this.objectsNeedCubeMap.push(e);}));const e=this.frameState.camera.frustumCrate.cullingVolume;this.style.primitiveCollection.getOpaquePrimitives(e).forEach((e=>{e._material instanceof Cp&&this.objectsNeedCubeMap.push(e);})),this.style.primitiveCollection.getTranslucentPrimitives(e).forEach((e=>{e._material instanceof Cp&&(e._material.id=e.id,this.objectsNeedCubeMap.push(e));}));}_updateObjectCollectionNeedCubeMap(){this.objectsNeedCubeMap.forEach((e=>{null==this.cubeMapCollection[e.id]&&(this.cubeMapCollection[e.id]=new fp({painter:this}));}));}_renderCubeMapTexture(){this._updateObjectsNeedCubeMap(),this._updateObjectCollectionNeedCubeMap(),this.objectsNeedCubeMap.forEach((t=>{const i=e.Transforms.cartesian3ToCartographic(t.position);let s;t instanceof yp?(null==this.cubeMapRenderPassCollection[t.id]?(s=new Tp({passType:e.RenderPassConsts.CUBE_MAP_RENDER,textureSize:t.textureSize}),this.cubeMapRenderPassCollection[t.id]=s):s=this.cubeMapRenderPassCollection[t.id],t.shadowRepaint&&(s.render({painter:this,cubeMap:this.cubeMapCollection[t.id],position:new e.Vector3(i[0],i[1],i[2]),near:t.shadowNear,far:t.shadowFar}),t.shadowRepaint=!1)):(null==this.cubeMapRenderPassCollection[t.id]?(s=new _p({passType:e.RenderPassConsts.CUBE_MAP_RENDER}),this.cubeMapRenderPassCollection[t.id]=s):s=this.cubeMapRenderPassCollection[t.id],s.render({painter:this,cubeMap:this.cubeMapCollection[t.id],position:new e.Vector3(i[0],i[1],i[2]),near:t._material.reflectNear,far:t._material.reflectFar}));}));}_onPreRender(){const t=this.renderGroup.getNearFarPlane(this.style,this.transform);this.transform.updateNearFarPlane(t),mp.render({painter:this,style:this.style}),!this.style.isSkyboxReady&&this.style.skybox&&(this.frameState.update({camera:this.transform.activeCamera}),new lp({passType:e.RenderPassConsts.CUBE_MAP_RENDER_FOR_SKYBOX}).render({painter:this,skybox:this.style.skybox})),this._shadows&&this.shadowPass.render({painter:this}),this.style.scenePointPrimitiveCollection.update(this),this._map.videoManager.update(this),this._map.analysis.cutFillCollection.update(this),this._map.analysis.highlightCollection.update(this),this._map.analysis.sightlineCollection.update(this),this._map.analysis.viewDomeCollection.update(this),this._map.analysis.viewshed3DCollection.update(this),this.backgroundPass.render({painter:this});}_onRealRender(){this.mainPass.render({painter:this}),this._onCustomLayersRender(),this.depthPass.render({painter:this}),this._enableNormal&&this.normalPass.render({painter:this});}_onCustomLayersRender(){if(this.style._customLayers.length>0){this.context.bindFramebuffer.set(this.mainPass.framebuffer.framebuffer);for(let e=0;e<this.style._customLayers.length;e++)this.style._customLayers[e].implementation.render(this.context.gl,this.mainPass.framebuffer.framebuffer);this.context.bindFramebuffer.set(null);}}_onPostProcessRender(){for(let e=0;e<this._map.analysis.viewshed3DCollection.length;e++)this._map.analysis.viewshed3DCollection.getByIndex(e).render(this);for(let e=0;e<this._map.analysis.viewDomeCollection.length;e++)this._map.analysis.viewDomeCollection.getByIndex(e).render(this);for(let e=0;e<this._map.analysis.highlightCollection.length;e++)this._map.analysis.highlightCollection.getByIndex(e).render(this);for(let e=0;e<this._map.analysis.cutFillCollection.length;e++)this._map.analysis.cutFillCollection.getByIndex(e).render(this);for(let e=0;e<this._map.analysis.sightlineCollection.length;e++)this._map.analysis.sightlineCollection.getByIndex(e).render(this);const e=this.postProcessStages;let t=this.usePostProcess=e.length>0||e.fxaa.enabled||e.bloom.enabled||e.atmosphere.enabled;if(this.usePostProcessSelected=!1,t&&(e.update(this.context,!1),e.clear(this.context),t=this.usePostProcess=e.ready,this.usePostProcessSelected=t&&e.hasSelected),this._handleFogs(),t){const e=this.postProcessStages,t=this.mainPass.framebuffer.getColorTexture(0),i=this.colorPass.framebuffer?.getColorTexture(0),s=this.depthPass.framebuffer.getColorTexture(0);e.execute(this.context,t,s,i),e.copy(this.context,this.mainPass.framebuffer);}this.enableSSR?(this._SSRRender(),this.resolveFramebuffer.pass=this.ssrPass):"main"==this._resolvePass?this.resolveFramebuffer.pass=this.mainPass:"normal"==this._resolvePass?this.resolveFramebuffer.pass=this.normalPass:"depth"==this._resolvePass?this.resolveFramebuffer.pass=this.depthPass:"shadow"==this._resolvePass&&(this.resolveFramebuffer.pass=this.shadowPass),this.resolveFramebuffer.resolveFramebufferToScreen();}_SSRRender(){this.depthTexture=this.depthPass.framebuffer.getColorTexture(0),this.normalTexture=this.normalPass.framebuffer.getColorTexture(0),this.colorTexture=this.mainPass.framebuffer.getColorTexture(0),this.normalTexture.sampler={wrapS:e.WebGLConstants.REPEAT,wrapT:e.WebGLConstants.REPEAT},this.depthTexture.sampler={wrapS:e.WebGLConstants.REPEAT,wrapT:e.WebGLConstants.REPEAT},this.colorTexture.sampler={wrapS:e.WebGLConstants.REPEAT,wrapT:e.WebGLConstants.REPEAT},this.SSRState=!0,this.ssrPass.render({painter:this}),this.SSRState=!1;}_onAfterRender(){}_processRenderLoops(e,t){this._onBeforeRender(e,t),this._onPreRender(),this._onRealRender(),this._onPostProcessRender(),this._onAfterRender();}render(e,t){this._processRenderLoops(e,t),this._debugRender();}_debugRender(){const e=this.options.showTileBoundaries;if(e){let t;this.debugTileCache||(this.debugTileCache=new Sm({projection:this._map.projection,context:this.context})),this.frameState.framebuffer=null,t="string"==typeof e?this.style.sourceCaches[e]:this.style.rasterSourceCache;const i=t.getVisibleCoordinates();this.debugTilePlotter.update(this,t,null,i,this.frameState);}else this.debugTileCache&&(this.debugTileCache.release(),this.debugTileCache=null,this.debugTilePlotter.removeAllPrimitives());}useProgram(e,t){const i=this.shaderProgramManager.getProgramByGLSLMacroDefinition(e,t||bp);return this.context.program.set(i.program),this.context._Program=i,i}setBaseState(){const t=e.RenderState.fromCache({viewport:{x:0,y:0,width:this.width,height:this.height}});e.RenderState.applyRenderState(this.context,t);}setShadows(e){this._shadows=e;}setNearDetection(e){this._nearDetection=e;}setNormalPass(e){this._enableNormal=e,this.context._enableNormal=e;}setResolvePass(e){this._resolvePass=e;}_handleFogs(){if(Object.keys(this.postProcessStages._stageNames).filter((e=>e.includes("mm_fog_effect"))).length>1)this._map.atmosphere=!1;else {if(!this._map.atmosphere)return;this._map.atmosphere=!0;}}destroy(){this.shaderProgramManager.destroy(),this.resolveFramebuffer.destroy(),this.backgroundPass.destroy(),this.distancePass.destroy(),this.depthPass.destroy(),this.commonDepthPass.destroy(),this.normalPass.destroy(),this.shadowPass.destroy(),this.mainPass.destroy(),this.colorPass.destroy(),this.ssrPass.destroy();}}class wp{constructor(){e.bindAll(["_onHashChange","_updateHash"],this),this._updateHash=function(e,t){let i=!1,s=0;const r=()=>{s=0,i&&(e(),s=setTimeout(r,300),i=!1);};return ()=>(i=!0,s||r(),s)}(this._updateHashUnthrottled.bind(this));}addTo(t){return this._map=t,e.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return e.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(e){const t=this._map.getCenter(),i=Math.round(100*this._map.getZoom())/100,s=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),r=Math.pow(10,s),n=Math.round(t.lng*r)/r,o=Math.round(t.lat*r)/r,a=this._map.getBearing(),l=this._map.getPitch();let h="";return h+=e?`#/${n}/${o}/${i}`:`#${i}/${o}/${n}`,(a||l)&&(h+="/"+Math.round(10*a)/10),l&&(h+=`/${Math.round(l)}`),h}_onHashChange(){const t=e.window.location.hash.replace("#","").split("/");return t.length>=3&&(this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:+(t[3]||0),pitch:+(t[4]||0)}),!0)}_updateHashUnthrottled(){const t=this.getHashString();e.window.history.replaceState(e.window.history.state,"",t);}}const Sp=function(){let e=[];return {getAll:()=>e,removeAll(){e=[];},add(t){e.push(t);},remove(t){const i=e.indexOf(t);-1!==i&&e.splice(i,1);},update(t,i){if(0===e.length)return !1;let s=0;for(t=void 0!==t?t:Sp.now();s<e.length;)e[s].update(t)||i?s++:e.splice(s,1);return !0}}}();Sp.now=void 0!==e.window&&void 0!==e.window.performance&&void 0!==e.window.performance.now?e.window.performance.now.bind(e.window.performance):void 0!==Date.now?Date.now:function(){return (new Date).getTime()},Sp.Tween=function(e){const t=e,i={};let s={};const r={};let n,o=1e3,a=0,l=!1,h=!1,_=0,c=null,u=Sp.Easing.Linear.None,d=Sp.Interpolation.Linear,m=[],p=null,f=!1,g=null,y=null,C=null;this.to=function(e,t){return s=e,void 0!==t&&(o=t),this},this.start=function(e){Sp.add(this),h=!0,f=!1,c=void 0!==e?e:Sp.now(),c+=_;for(const e in s){if(s[e]instanceof Array){if(0===s[e].length)continue;s[e]=[t[e]].concat(s[e]);}void 0!==t[e]&&(i[e]=t[e],i[e]instanceof Array==0&&(i[e]*=1),r[e]=i[e]||0);}return this},this.stop=function(){return h?(Sp.remove(this),h=!1,null!==C&&C.call(t,t),this.stopChainedTweens(),this):this},this.end=function(){return this.update(c+o),this},this.stopChainedTweens=function(){let e=0;const t=m.length;for(;e<t;e++)m[e].stop();},this.delay=function(e){return _=e,this},this.repeat=function(e){return a=e,this},this.repeatDelay=function(e){return n=e,this},this.yoyo=function(e){return l=e,this},this.easing=function(e){return u=e,this},this.interpolation=function(e){return d=e,this},this.chain=function(){return m=arguments,this},this.onStart=function(e){return p=e,this},this.onUpdate=function(e){return g=e,this},this.onComplete=function(e){return y=e,this},this.onStop=function(e){return C=e,this},this.update=function(e){let h,C,T;if(e<c)return !0;for(h in !1===f&&(null!==p&&p.call(t,t),f=!0),C=(e-c)/o,C=C>1?1:C,T=u(C),s){if(void 0===i[h])continue;const e=i[h]||0;let r=s[h];r instanceof Array?t[h]=d(r,T):("string"==typeof r&&(r="+"===r.charAt(0)||"-"===r.charAt(0)?e+parseFloat(r):parseFloat(r)),"number"==typeof r&&(t[h]=e+(r-e)*T));}if(null!==g&&g.call(t,T),1===C){if(a>0){for(h in isFinite(a)&&a--,r){if("string"==typeof s[h]&&(r[h]=r[h]+parseFloat(s[h])),l){const e=r[h];r[h]=s[h],s[h]=e;}i[h]=r[h];}return c=void 0!==n?e+n:e+_,!0}{null!==y&&y.call(t,t);let e=0;const i=m.length;for(;e<i;e++)m[e].start(c+o);return !1}}return !0};},Sp.Easing={Linear:{None:e=>e},Quadratic:{In:e=>e*e,Out:e=>e*(2-e),InOut:e=>(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},Cubic:{In:e=>e*e*e,Out:e=>--e*e*e+1,InOut:e=>(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},Quartic:{In:e=>e*e*e*e,Out:e=>1- --e*e*e*e,InOut:e=>(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)},Quintic:{In:e=>e*e*e*e*e,Out:e=>--e*e*e*e*e+1,InOut:e=>(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},Sinusoidal:{In:e=>1-Math.cos(e*Math.PI/2),Out:e=>Math.sin(e*Math.PI/2),InOut:e=>.5*(1-Math.cos(Math.PI*e))},Exponential:{In:e=>0===e?0:Math.pow(1024,e-1),Out:e=>1===e?1:1-Math.pow(2,-10*e),InOut:e=>0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))},Circular:{In:e=>1-Math.sqrt(1-e*e),Out:e=>Math.sqrt(1- --e*e),InOut:e=>(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},Elastic:{In:e=>0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI),Out:e=>0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1,InOut:e=>0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1},Back:{In(e){const t=1.70158;return e*e*((t+1)*e-t)},Out(e){const t=1.70158;return --e*e*((t+1)*e+t)+1},InOut(e){const t=2.5949095;return (e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:e=>1-Sp.Easing.Bounce.Out(1-e),Out:e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,InOut:e=>e<.5?.5*Sp.Easing.Bounce.In(2*e):.5*Sp.Easing.Bounce.Out(2*e-1)+.5}},Sp.Interpolation={Linear(e,t){const i=e.length-1,s=i*t,r=Math.floor(s),n=Sp.Interpolation.Utils.Linear;return t<0?n(e[0],e[1],s):t>1?n(e[i],e[i-1],i-s):n(e[r],e[r+1>i?i:r+1],s-r)},Bezier(e,t){let i=0;const s=e.length-1,r=Math.pow,n=Sp.Interpolation.Utils.Bernstein;for(let o=0;o<=s;o++)i+=r(1-t,s-o)*r(t,o)*e[o]*n(s,o);return i},CatmullRom(e,t){const i=e.length-1;let s=i*t,r=Math.floor(s);const n=Sp.Interpolation.Utils.CatmullRom;return e[0]===e[i]?(t<0&&(r=Math.floor(s=i*(1+t))),n(e[(r-1+i)%i],e[r],e[(r+1)%i],e[(r+2)%i],s-r)):t<0?e[0]-(n(e[0],e[0],e[1],e[1],-s)-e[0]):t>1?e[i]-(n(e[i],e[i],e[i-1],e[i-1],s-i)-e[i]):n(e[r?r-1:0],e[r],e[i<r+1?i:r+1],e[i<r+2?i:r+2],s-r)},Utils:{Linear:(e,t,i)=>(t-e)*i+e,Bernstein(e,t){const i=Sp.Interpolation.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:function(){const e=[1];return function(t){let i=1;if(e[t])return e[t];for(let e=t;e>1;e--)i*=e;return e[t]=i,i}}(),CatmullRom(e,t,i,s,r){const n=.5*(i-e),o=.5*(s-t),a=r*r;return (2*t-2*i+n+o)*(r*a)+(-3*t+3*i-2*n-o)*a+n*r+t}}};var Ap=Object.freeze({LINEAR_NONE:Sp.Easing.Linear.None,QUADRATIC_IN:Sp.Easing.Quadratic.In,QUADRATIC_OUT:Sp.Easing.Quadratic.Out,QUADRATIC_IN_OUT:Sp.Easing.Quadratic.InOut,CUBIC_IN:Sp.Easing.Cubic.In,CUBIC_OUT:Sp.Easing.Cubic.Out,CUBIC_IN_OUT:Sp.Easing.Cubic.InOut,QUARTIC_IN:Sp.Easing.Quartic.In,QUARTIC_OUT:Sp.Easing.Quartic.Out,QUARTIC_IN_OUT:Sp.Easing.Quartic.InOut,QUINTIC_IN:Sp.Easing.Quintic.In,QUINTIC_OUT:Sp.Easing.Quintic.Out,QUINTIC_IN_OUT:Sp.Easing.Quintic.InOut,SINUSOIDAL_IN:Sp.Easing.Sinusoidal.In,SINUSOIDAL_OUT:Sp.Easing.Sinusoidal.Out,SINUSOIDAL_IN_OUT:Sp.Easing.Sinusoidal.InOut,EXPONENTIAL_IN:Sp.Easing.Exponential.In,EXPONENTIAL_OUT:Sp.Easing.Exponential.Out,EXPONENTIAL_IN_OUT:Sp.Easing.Exponential.InOut,CIRCULAR_IN:Sp.Easing.Circular.In,CIRCULAR_OUT:Sp.Easing.Circular.Out,CIRCULAR_IN_OUT:Sp.Easing.Circular.InOut,ELASTIC_IN:Sp.Easing.Elastic.In,ELASTIC_OUT:Sp.Easing.Elastic.Out,ELASTIC_IN_OUT:Sp.Easing.Elastic.InOut,BACK_IN:Sp.Easing.Back.In,BACK_OUT:Sp.Easing.Back.Out,BACK_IN_OUT:Sp.Easing.Back.InOut,BOUNCE_IN:Sp.Easing.Bounce.In,BOUNCE_OUT:Sp.Easing.Bounce.Out,BOUNCE_IN_OUT:Sp.Easing.Bounce.InOut});const{CesiumMath:Ep}=e.CONSTS,Mp={},Pp=new e.Vector3,Rp=new e.Vector3;function Bp(e,t){return Ep.equalsEpsilon(e,Ep.TWO_PI,Ep.EPSILON11)&&(e=0),t>e+Math.PI?e+=Ep.TWO_PI:t<e-Math.PI&&(e-=Ep.TWO_PI),e}function Ip(t,i,r,n,o,a,l,h,_,c,u,d){const m=t.activeCamera,p=e.Cartographic.fromDegrees(m.cartographicPosition[0],m.cartographicPosition[1],m.cartographicPosition[2],Pp),f=t.pitch*e.CONSTS.TRANSFORM.DEG_TO_RAD,g=Bp(t.bearing*e.CONSTS.TRANSFORM.DEG_TO_RAD,n),y=Bp(t.roll*e.CONSTS.TRANSFORM.DEG_TO_RAD,a),C=new e.Cartographic;e.Cartographic.fromDegrees(r[0],r[1],r[2],C),p.longitude=Ep.zeroToTwoPi(p.longitude),C.longitude=Ep.zeroToTwoPi(C.longitude);let T=!1;if(e.defined(h)){const t=Ep.zeroToTwoPi(h),i=Math.min(p.longitude,C.longitude),s=Math.max(p.longitude,C.longitude),r=t>=i&&t<=s;if(e.defined(_)){const e=Math.abs(p.longitude-C.longitude),t=Ep.TWO_PI-e;(r?e:t)<(r?t:e)*_&&!r&&(T=!0);}else r||(T=!0);}T?function(e,t){e.longitude<t.longitude?e.longitude+=Ep.TWO_PI:t.longitude+=Ep.TWO_PI;}(p,C):function(e,t){const i=e.longitude-t.longitude;i<-Ep.PI?e.longitude+=Ep.TWO_PI:i>Ep.PI&&(t.longitude+=Ep.TWO_PI);}(p,C);const x=function(t,i,r,n,o,a){let l=o;const h=Math.max(r,n);if(!a){if(!e.defined(l)){const r=t.position,n=e.Vector3.fromDegrees(i[0],i[1],i[2]),o=t.up,a=t.right,h=t.frustumCrate.frustum,_=e.Vector3.subtract(r,n,Pp),c=e.Vector3.magnitude(e.Vector3.multiplyByScalar(o,e.Vector3.dot(_,o),Rp)),u=e.Vector3.magnitude(e.Vector3.multiplyByScalar(a,e.Vector3.dot(_,a),Rp));l=Math.min(.2*function(t,i,r){let n,o,a;if(t instanceof s){const e=Math.tan(.5*t.fovy);return n=t.near,o=t.near*e,a=t.aspectRatio*o,Math.max(i*n/a,r*n/o)}return t instanceof e.PerspectiveOffCenterFrustum?(n=t.near,o=t.top,a=t.right,Math.max(i*n/a,r*n/o)):Math.max(i,r)}(h,c,u),1e9);}if(h<l){const e=8,t=1e6,i=-Math.pow((l-r)*t,1/e),s=Math.pow((l-n)*t,1/e);return function(r){return -Math.pow(r*(s-i)+i,e)/t+l}}}return function(t){return e.lerp(r,n,t)}}(m,r,p.height,C.height,l,d),b=function(t,i,s,r){if(e.defined(r)&&s(.5)>r){const r=s(0),n=s(1),o=s(.5),a=o-r,l=o-n;return function(o){const h=s(o);return o<=.5?e.lerp(t,-Ep.PI_OVER_TWO,(h-r)/a):e.lerp(-Ep.PI_OVER_TWO,i,1-(h-n)/l)}}return function(s){return e.lerp(t,i,Math.pow(s,i>t?4:1/4))}}(f,o,x,c);return function(){const s=p.longitude,r=C.longitude,o=p.latitude,l=C.latitude;return function(h){const _=h.time/i,c=e.lerp(s,r,_),d=e.lerp(o,l,_),m=x(_);t.activeCamera.setView({destination:e.Vector3.fromDegrees(c*e.CONSTS.TRANSFORM.RAD_TO_DEG,d*e.CONSTS.TRANSFORM.RAD_TO_DEG,m),orientation:{heading:e.lerp(g,n,_),pitch:b(_)-.5*Math.PI,roll:e.lerp(y,a,_)}}),u();}}()}function Dp(e,t){return {startObject:{},stopObject:{},duration:0,complete:e,cancel:t}}Mp.createTween=function(t,i){const s=t.activeCamera,r=(i=e.defaultValue(i,e.defaultValue.EMPTY_OBJECT)).destination,n=i.maximumHeight,o=i.flyOverLongitude,a=i.flyOverLongitudeWeight,l=i.pitchAdjustHeight;let h=i.easingFunction;const _=i.updateExtraFunction,c=i.isEaseToType;let u=i.duration;e.defined(u)||(u=Math.ceil(e.Vector3.distance(s.position,r)/1e6)+2,u=Math.min(u,3));const d=e.defaultValue(i.heading,0),m=e.defaultValue(i.pitch,-Ep.PI_OVER_TWO),p=e.defaultValue(i.roll,0),f=i.complete,g=i.cancel;let y=!1;y=y||e.Vector3.equalsEpsilon(e.Vector3.fromDegrees(r[0],r[1],r[2]),s.position,Ep.EPSILON10),y=y&&Ep.equalsEpsilon(Ep.negativePiToPi(d),Ep.negativePiToPi(t.bearing*e.CONSTS.TRANSFORM.DEG_TO_RAD),Ep.EPSILON10)&&Ep.equalsEpsilon(Ep.negativePiToPi(m),Ep.negativePiToPi(t.pitch*e.CONSTS.TRANSFORM.DEG_TO_RAD),Ep.EPSILON10)&&Ep.equalsEpsilon(Ep.negativePiToPi(p),Ep.negativePiToPi(t.roll*e.CONSTS.TRANSFORM.DEG_TO_RAD,p),Ep.EPSILON10);const C=t.minZoom,T=t.maxZoom,x=e.getZoomFromDistance(t._fov,r[2]+e.CONSTS.TRANSFORM.R,e.CONSTS.TRANSFORM.R);if((x>T+e.CONSTS.CesiumMath.EPSILON4||x<C-e.CONSTS.CesiumMath.EPSILON4)&&(y=!0,console.error("FlyTo的目标点超出了map的minzoom/maxzoom限制,请使用map.setMinZoom或map.setMaxZoom方法合理设置map的限制zoom层级,或修改该目标数据的高度保持在合理的zoom层级!")),y)return Dp(f,g);const b=new Array(4);if(b.SCENE3D=Ip,u<=0)return Dp((function(){b.SCENE3D(t,1,r,d,m,p,n,o,a,l,_,c)({time:1}),"function"==typeof f&&f();}),g);const v=b.SCENE3D(t,u,r,d,m,p,n,o,a,l,_,c);if(!e.defined(h)){const e=t.cameraHeightToSurface;h=e>r[2]&&e>11500?Ap.CUBIC_OUT:Ap.QUINTIC_IN_OUT;}return {duration:u,easingFunction:h,startObject:{time:0},stopObject:{time:u},update:v,complete:f,cancel:g}};var Op=Object.freeze({SECONDS_PER_MILLISECOND:.001,SECONDS_PER_MINUTE:60,MINUTES_PER_HOUR:60,HOURS_PER_DAY:24,SECONDS_PER_HOUR:3600,MINUTES_PER_DAY:1440,SECONDS_PER_DAY:86400,DAYS_PER_JULIAN_CENTURY:36525,PICOSECOND:1e-9,MODIFIED_JULIAN_DATE_DIFFERENCE:2400000.5});class Lp{constructor(e,t,i,s,r,n,o,a,l,h){this._tweens=e,this._tweenjs=t,this._startObject=Qo(i),this._stopObject=Qo(s),this._duration=r,this._delay=n,this._easingFunction=o,this._update=a,this._complete=l,this.cancel=h,this.needsStart=!0;}get startObject(){return this._startObject}get stopObject(){return this._stopObject}get duration(){return this._duration}get delay(){return this._delay}get easingFunction(){return this._easingFunction}get update(){return this._update}get complete(){return this._complete}get tweenjs(){return this._tweenjs}cancelTween(){this._tweens.remove(this);}}class Vp{constructor(){this._tweens=[];}get length(){return this._tweens.length}add(t){if(0===(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).duration)return e.defined(t.complete)&&t.complete(),new Lp(this);const i=t.duration/Op.SECONDS_PER_MILLISECOND,s=e.defaultValue(t.delay,0),r=s/Op.SECONDS_PER_MILLISECOND,n=e.defaultValue(t.easingFunction,Ap.LINEAR_NONE),o=t.startObject,a=new Sp.Tween(o);a.to(Qo(t.stopObject),i),a.delay(r),a.easing(n),e.defined(t.update)&&a.onUpdate((()=>{t.update(o);})),a.onComplete(e.defaultValue(t.complete,null)),a.repeat(e.defaultValue(t._repeat,0));const l=new Lp(this,a,t.startObject,t.stopObject,t.duration,s,n,t.update,t.complete,t.cancel);return this._tweens.push(l),l}addProperty(t){const i=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).object,s=t.property;return this.add({startObject:{value:t.startValue},stopObject:{value:t.stopValue},duration:e.defaultValue(t.duration,3),delay:t.delay,easingFunction:t.easingFunction,update:function(e){i[s]=e.value;},complete:t.complete,cancel:t.cancel,_repeat:t._repeat})}addAlpha(t){const i=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).material,s=[];for(const t in i.uniforms)i.uniforms.hasOwnProperty(t)&&e.defined(i.uniforms[t])&&e.defined(i.uniforms[t].alpha)&&s.push(t);return this.add({startObject:{alpha:e.defaultValue(t.startValue,0)},stopObject:{alpha:e.defaultValue(t.stopValue,1)},duration:e.defaultValue(t.duration,3),delay:t.delay,easingFunction:t.easingFunction,update:function(e){const t=s.length;for(let r=0;r<t;++r)i.uniforms[s[r]].alpha=e.alpha;},complete:t.complete,cancel:t.cancel})}addOffsetIncrement(t){const i=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).material.uniforms;return this.addProperty({object:i,property:"offset",startValue:i.offset,stopValue:i.offset+1,duration:t.duration,delay:t.delay,easingFunction:t.easingFunction,update:t.update,cancel:t.cancel,_repeat:1/0})}remove(t){if(!e.defined(t))return !1;const i=this._tweens.indexOf(t);return -1!==i&&(t.tweenjs.stop(),e.defined(t.cancel)&&t.cancel(),this._tweens.splice(i,1),!0)}removeAll(){const t=this._tweens;for(let i=0;i<t.length;++i){const s=t[i];s.tweenjs.stop(),e.defined(s.cancel)&&s.cancel();}t.length=0;}contains(t){return e.defined(t)&&-1!==this._tweens.indexOf(t)}get(e){return this._tweens[e]}update(t){const i=this._tweens;let s=0;for(t=e.defined(t)?t/Op.SECONDS_PER_MILLISECOND:H();s<i.length;){const e=i[s],r=e.tweenjs;e.needsStart?(e.needsStart=!1,r.start(t)):r.update(t)?s++:(r.stop(),i.splice(s,1));}}}class Np{constructor(){}static createUpdateFunction(t,i,s,r,n){let o=0;return function(a){const l=a.time/i;t._pinchOperationData._headingDiff=(s*l-o)*e.CONSTS.TRANSFORM.DEG_TO_RAD||0,o=s*l,t.pinchPosition=r,n();}}static createTween(e,t){const i=t.duration,s=t.complete,r=t.cancel;return {duration:i,easingFunction:t.easingFunction,startObject:{time:0},stopObject:{time:i},update:Np.createUpdateFunction(e,i,t.heading,t.pinchPosition,t.updateExtraFunction),complete:s,cancel:r}}}class Fp{constructor(){}static reduceVertices(t,i){const s=new e.Vector3,r=new e.Vector3,n=[],o=t.length;if(o<=2)return t;let a=0,l=0;for(n.push(e.clone(t[0]));a<o-1;){let h=a+1;for(Up(t,a,s),Up(t,h,r),l=zp(s,r);l<=i&&(h+=1,!(h>o-1));)Up(t,h,r),l=zp(s,r);n.push(e.clone(r)),a=h;}return e.clone(n)}static chaiken(t,i,s){let r=0,n=new e.Vector3,o=new e.Vector3,a=[];if(r=t.length,r<3)return t;const l=1/(1+s),h=s/(1+s);n=Up(t,0,n),o=Up(t,r-1,o);let _=e.clone(t);for(let t=0;t<i;t++)kp(_,a,l,h),_=e.clone(a),a=[];return _.unshift(n),_.push(o),e.clone(_)}static boyle(t,i){const s=new e.Vector3,r=new e.Vector3;let n=new e.Vector3,o=1,a=0,l=0,h=0,_=0;const c=t.length;if(i<2||i>c)return t;for(Up(t,0,n),h=1/(i-1),_=1-h;a<c-2;)l=a+i,l>=c&&(l=c-1),Up(t,l,s),Hp(s,h,s),Hp(n,_,n),(m=r).x=(u=n).x+(d=s).x,m.y=u.y+d.y,m.z=u.z+d.z,t[o]=e.clone(r),o+=1,a+=1,n=e.clone(r);var u,d,m;return function(e,t){const i=e.length;e[t].x=e[i-1].x,e[t].y=e[i-1].y,e[t].z=e[i-1].z;}(t,o),t}}function Gp(e,t,i,s){s.x=e.x+(t.x-e.x)*i,s.y=e.y+(t.y-e.y)*i,s.z=e.z+(t.z-e.z)*i;}function kp(t,i,s,r){const n=new e.Vector3,o=new e.Vector3,a=new e.Vector3,l=new e.Vector3;for(let h=0;h<t.length&&h!==t.length-1;h++)Up(t,h,n),Up(t,h+1,o),Gp(n,o,s,a),Gp(n,o,r,l),i.push(e.clone(a)),i.push(e.clone(l));}function Up(e,t,i){return i.x=e[t].x,i.y=e[t].y,i.z=e[t].z,i}function Hp(e,t,i){return i.x=e.x*t,i.y=e.y*t,i.z=e.z*t,i}function zp(e,t){const i=e.x-t.x,s=e.y-t.y,r=e.z-t.z;return Math.sqrt(i*i+s*s+r*r)}class Wp{constructor(t,i){this.roamingOptions=t,this.map=i,this.roamInterval=t.roamInterval,this.roamPitch=t.pitch,this.bearing=t.bearing,this.heightOffset=t.heightOffset,this.currentMileage=0,this.currentIndex=0,this.roamLength=0,this.roamSegments=[],this.points=[],this.stages=[];let s=t.positions;if(s&&s.length%3!=0)throw new Error("Incorrect number of positions!");let r,n=s.length/3,o=[];for(let t=0;t<n;t++)o.push(e.Vector3.fromArray(s.slice(3*t,3*t+3)));t.pathOptimization&&n>50?(o=Fp.reduceVertices(o,5e-5),o=Fp.boyle(o,7),o=Fp.boyle(o,5),r=Fp.chaiken(o,1,3),s=r.map((e=>[e[0],e[1],e[2]])).flat()):r=o,n=r.length;for(let t=0;t<n-1;t++){const i=e.Vector3.fromArray(e.Transforms.cartographicToCartesian3(s.slice(3*t,3*t+3))),r=e.Vector3.fromArray(e.Transforms.cartographicToCartesian3(s.slice(3*(t+1),3*(t+1)+3))),n=e.Vector3.distance(i,r);this.roamSegments.push(n),this.roamLength+=n;}let a=0;for(let t=0;t<n;t++)this.points.push(e.Vector3.fromArray(e.Transforms.cartographicToCartesian3(s.slice(3*t,3*t+3)))),0===t?this.stages.push(0):(a+=this.roamSegments[t-1],this.stages.push(a));}getRoamingParam(){this.update();const{weight:t,pointCurrent:i,pointNext:s,currentIndex:r}=this.getWeightAndPoints(this.stages,this.points,this.currentMileage);let n;this.currentIndex=r,n=0===this.currentMileage?this.points[0]:this.map.camera.position;const o=this.getLinearInterpolationPosition(t,i,s);1===t&&(this.currentMileage=this.stages.at(r+1)),o[0]===this.points.at(-1)[0]&&o[1]===this.points.at(-1)[1]&&o[2]===this.points.at(-1)[2]&&(this.map._roaming=!1);const a=e.Transforms.cartesian3ToCartographic(n),l=e.Transforms.cartesian3ToCartographic(o),h=ze(a[1],a[0],l[1],l[0]).bearing,_=Math.asin((l[2]-a[2])/e.Vector3.distance(e.Vector3.fromArray(o),e.Vector3.fromArray(n)));return {position:[l[0],l[1],l[2]+this.heightOffset],bearing:e.defined(this.bearing)?this.bearing+h:h,pitch:this.roamPitch+_,trackIndex:this.currentIndex+1,currentPosition:l,currentMileage:this.currentMileage,totalMileage:this.roamLength}}getWeightAndPoints(e,t,i){const s=this.leftBinarySearch(e,i,0,e.length-2),r=e[s];return {weight:Math.min((i-r)/(e[s+1]-r),1),pointCurrent:t[s],pointNext:t[s+1],currentIndex:s}}getLinearInterpolationPosition(e,t,i){return [(i[0]-t[0])*e+t[0],(i[1]-t[1])*e+t[1],(i[2]-t[2])*e+t[2]]}leftBinarySearch(e,t,i,s){const r=Math.floor((i+s)/2),n=e[r];return i>s?r:n>t?this.leftBinarySearch(e,t,i,r-1):n<t?this.leftBinarySearch(e,t,r+1,s):r}update(){this.roamInterval=this.map.roamingOptions.roamInterval,this.roamPitch=this.map.roamingOptions.pitch,this.bearing=this.map.roamingOptions.bearing,this.heightOffset=this.map.roamingOptions.heightOffset,this.currentMileage+=this.roamInterval;}}class jp extends e.Evented{_minimumCameraCheckHeight=2e3;_minimumCameraCheckHeightNoTerrain=1;_maxmumCameraCheckHeight=1e4;constructor(t,i){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=i.bearingSnap,this.latRange=[e.CONSTS.TRANSFORM.MIN_LAT,e.CONSTS.TRANSFORM.MAX_LAT],this._roaming=!1,this.roamObject=void 0,this.tweens=new Vp,e.bindAll(["_renderFrameCallback"],this);}getCenter(){return this.transform.center}setCenter(e,t){return this.jumpTo({center:e,zoom:this.getZoom()},t)}getCameraPosition(){return new e.Vector3(this.transform.activeCamera.cartographicPosition)}setCameraPosition(e,t){return this.jumpTo({target:e},t),this}panBy(t,i,s){return t=e.pointGeometry3d.convert(t).mult(-1),this.panTo(this.transform.center,e.extend({offset:t},i),s)}panTo(t,i,s){return this.easeTo(e.extend({center:t},i),s)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e,center:this.getCenter()},t),this}setCameraHeight(e,t){return this.jumpTo({target:[this.transform.activeCamera.cartographicPosition[0],this.transform.activeCamera.cartographicPosition[1],e]},t),this}zoomTo(t,i,s){return this.easeTo(e.extend({center:this.getCenter(),zoom:e.clamp(t,this.transform.minZoom,this.transform.maxZoom)},i),s)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.getMapViewParams().bearing}getCameraBearing(){return this.transform.bearing}setBearing(e,t){const i=this.transform.getMapViewParams();return this.jumpTo({bearing:e,center:i.center,zoom:i.zoom},t),this}setCameraBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(t,i,s){return this.easeTo(e.extend({bearing:t,center:this.getCenter(),zoom:this.getZoom()},i),s)}resetNorth(t,i){return this.rotateTo(0,e.extend({duration:1e3},t),i),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.getMapViewParams().pitch}getCameraPitch(){return this.transform.pitch}setPitch(e,t){const i=this.transform.getMapViewParams();return this.jumpTo({pitch:e,center:i.center,zoom:i.zoom},t),this}setCameraPitch(e,t){return this.jumpTo({pitch:e},t),this}getRoll(){return this.transform.getMapViewParams().roll}getCameraRoll(){return this.transform.roll}setRoll(e,t){const i=this.transform.getMapViewParams();return this.jumpTo({roll:e,center:i.center,zoom:i.zoom},t),this}setCameraRoll(e,t){return this.jumpTo({roll:e},t),this}cameraForBounds(t,i){return t=e.LngLatBounds.convert(t),this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),0,i)}_cameraForBoxAndBearing(i,s,r,n){if("number"==typeof(n=e.extend({padding:{top:0,bottom:0,right:0,left:0},offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding){const e=n.padding;n.padding={top:e,bottom:e,right:e,left:e};}if(!t(Object.keys(n.padding).sort(((e,t)=>e<t?-1:e>t?1:0)),["bottom","left","right","top"]))return void e.warnOnce("options.padding must be a positive number, or an Object with keys 'bottom', 'left', 'right', 'top'");const o=[(n.padding.left-n.padding.right)/2,(n.padding.top-n.padding.bottom)/2],a=Math.min(n.padding.right,n.padding.left),l=Math.min(n.padding.top,n.padding.bottom);n.offset=[n.offset[0]+o[0],n.offset[1]+o[1]];const h=e.pointGeometry3d.convert(n.offset),_=this.transform,c=this._calcOffsetDifLngLat(h);n.center={lng:(i.lng+s.lng)/2-c[0],lat:(i.lat+s.lat)/2-c[1]};const u=e.Transforms.cartographicToCartesian3([(i.lng+s.lng)/2,i.lat,0]),d=e.Transforms.cartographicToCartesian3([(i.lng+s.lng)/2,s.lat,0]),m=Math.sqrt(Math.pow(u[0]-d[0],2)+Math.pow(u[1]-d[1],2)+Math.pow(u[2]-d[2],2)),p=Math.atan((_.height-l)/_.height*Math.tan(_._fov/2)),f=e.Transforms.cartographicToCartesian3([i.lng,(i.lat+s.lat)/2,0]),g=e.Transforms.cartographicToCartesian3([s.lng,(i.lat+s.lat)/2,0]),y=Math.sqrt(Math.pow(f[0]-g[0],2)+Math.pow(f[1]-g[1],2)+Math.pow(f[2]-g[2],2)),C=Math.atan((_.width-a)/_.height*Math.tan(_._fov/2)),T=_.width/y,x=_.height/m;if(x<0||T<0)return void e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");let b,v;x<T?(b=p,v=m):(b=C,v=y);const w=Math.asin(v/2/e.CONSTS.TRANSFORM.R),S=Math.sin(Math.PI-b-w)*e.CONSTS.TRANSFORM.R/Math.sin(b);return n.zoom=e.getZoomFromDistance(_._fov,S,e.CONSTS.TRANSFORM.R),n.bearing=0,n}fitBounds(t,i,s,r){const n=this.boundsToPosition(t,i,r);return i=i||{},this.flyTo(void 0!==(s=s||void 0)?{target:[n[0],n[1],n[2]+s],bearing:0,pitch:e.defined(i.pitch)?i.pitch:0,roll:0,duration:i.duration,complete:i.complete,cancel:i.cancel,endTransform:i.endTransform,maximumHeight:i.maximumHeight,easingFunction:i.easing,flyOverLongitude:i.flyOverLongitude,flyOverLongitudeWeight:i.flyOverLongitudeWeight,pitchAdjustHeight:i.pitchAdjustHeight}:{center:[n[0],n[1]],zoom:e.defined(i.zoom)?i.zoom:n[3],bearing:0,pitch:e.defined(i.pitch)?i.pitch:0,roll:0,duration:i.duration,complete:i.complete,cancel:i.cancel,endTransform:i.endTransform,maximumHeight:i.maximumHeight,easingFunction:i.easing,flyOverLongitude:i.flyOverLongitude,flyOverLongitudeWeight:i.flyOverLongitudeWeight,pitchAdjustHeight:i.pitchAdjustHeight},r)}boundsToPosition(t,i,s){const r=(t=e.LngLatBounds.convert(t)).getNorthWest(),n=t.getSouthEast(),o=180;let a=o;(i=i||{})&&i.padding&&null!=i.padding.left&&(a=i.padding.left);let l=o;i&&i.padding&&null!=i.padding.right&&(l=i.padding.right);let h=o;i&&i.padding&&null!=i.padding.top&&(h=i.padding.top);let _=o;i&&i.padding&&null!=i.padding.bottom&&(_=i.padding.bottom);const c=r.lat>n.lat?r.lat:n.lat,u=r.lat<n.lat?r.lat:n.lat;let d=(c+u)/2;const m=r.lng<n.lng?r.lng:n.lng,p=r.lng>n.lng?r.lng:n.lng;let f=(m+p)/2;const g=new e.Vector3(e.Transforms.DefaultEllipsoid.cartographicToCartesian([f,c,0])),y=new e.Vector3(e.Transforms.DefaultEllipsoid.cartographicToCartesian([f,u,0]));let C=e.Vector3.distance(g,y);C*=this.transform.height/(this.transform.height-h-_),C=C/2/Math.tan(this.transform._fov/2);const T=new e.Vector3(e.Transforms.DefaultEllipsoid.cartographicToCartesian([m,d,0])),x=new e.Vector3(e.Transforms.DefaultEllipsoid.cartographicToCartesian([p,d,0]));let b=e.Vector3.distance(T,x);b*=this.transform.width/(this.transform.width-a-l),b=b/2/Math.tan(this.transform._fov/2*this.transform.width/this.transform.height);const v=C>b?C:b;f-=(a-l)/(this.transform.width-a-l)*((p-m)/2),d-=(_-h)/(this.transform.height-h-_)*((c-u)/2);const w=new e.Vector3(e.Transforms.DefaultEllipsoid.cartographicToCartesian([f,d,0])),S=e.Vector3.normalize(w,new e.Vector3).multiplyScalar(v);S.add(w);const A=e.Transforms.DefaultEllipsoid.cartesianToCartographic(S,new e.Vector3),E=e.getZoomFromDistance(this.transform._fov,A[2]+e.CONSTS.TRANSFORM.R,e.CONSTS.TRANSFORM.R);return [A[0],A[1],A[2],E]}fitScreenCoordinates(t,i,s,r,n){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(e.pointGeometry3d.convert(t)),this.transform.pointLocation(e.pointGeometry3d.convert(i)),s,r),r,n)}_fitInternal(t,i,s){return t?(i=e.extend(t,i)).linear?this.easeTo(i,s):this.flyTo(i,s):this}async jumpTo(t,i){const s=t={...t},r=await this._convertToMainCameraOptions(s);if(1==r.unchanged)return void(t.callback&&t.callback(i));const n=this.transform.minZoom,o=this.transform.maxZoom,a=e.getZoomFromDistance(this.transform._fov,r.position[2]+e.CONSTS.TRANSFORM.R,e.CONSTS.TRANSFORM.R);if(!this.enableUnderGround&&(a>o+e.CONSTS.CesiumMath.EPSILON4||a<n-e.CONSTS.CesiumMath.EPSILON4))return void console.error("jumpTo的目标点超出了map的minzoom/maxzoom限制,请使用map.setMinZoom或map.setMaxZoom方法合理设置map的限制zoom层级,或修改该目标数据的高度保持在合理的zoom层级!");let l;return a-this.transform.zoom>e.CONSTS.CesiumMath.EPSILON3&&(l=!0),this.jumpTo3D(r,i),l&&(Fe.executeEvent(this,"zoomstart"),Fe.executeEvent(this,"zoom"),Fe.executeEvent(this,"zoomend")),this}jumpTo3D(t){this.stop();const i=this.transform,s=e.Vector3.unpack(t.position);let r=!1,n=!1,o=!1;"bearing"in t&&i.bearing!==+t.bearing&&(r=!0,i.bearing=+t.bearing),"pitch"in t&&i.pitch!==+t.pitch&&(n=!0,i.pitch=+t.pitch),"roll"in t&&i.roll!==+t.roll&&(o=!0,i.roll=+t.roll),i.activeCamera.setView({destination:e.Vector3.fromDegrees(s.x,s.y,s.z),orientation:{heading:e.defined(t.bearing)?t.bearing*Math.PI/180:void 0,pitch:e.defined(t.pitch)?t.pitch*Math.PI/180-.5*Math.PI:void 0,roll:e.defined(t.roll)?t.roll*Math.PI/180:void 0}}),Fe.executeEvent(this,"movestart"),Fe.executeEvent(this,"move"),r&&(Fe.executeEvent(this,"rotatestart"),Fe.executeEvent(this,"rotate"),Fe.executeEvent(this,"rotateend")),n&&(Fe.executeEvent(this,"pitchstart"),Fe.executeEvent(this,"pitch"),Fe.executeEvent(this,"pitchend")),o&&(Fe.executeEvent(this,"rollstart"),Fe.executeEvent(this,"roll"),Fe.executeEvent(this,"rollend")),Fe.executeEvent(this,"moveend");}easeToByPinchPosition(e,t){this._stop(!1,e.easeId);const i=Np.createTween(this.transform,{duration:e.duration/1e3||3,heading:e.bearing,pinchPosition:e.pinchPosition,easingFunction:e.easing||Ap.QUINTIC_OUT,cancel:()=>{this._afterEase(t);},complete:()=>{this.transform.pinchPosition=null,this._afterEase(t),e.callback&&e.callback(t);},updateExtraFunction:()=>{this._fireMoveEvents(t);}});0!==i.duration?(this._currentFlight=this.tweens.add(i),this._rotating=this._rotating||!0,this._prepareEase(t,!1),this._ease()):"function"==typeof i.complete&&i.complete();}roam(){if(!this._roaming||!this.roamingOptions)return;this.roamObject||(this.roamObject=new Wp(this.roamingOptions,this));const e=this.roamObject.getRoamingParam();this.jumpTo({target:e.position,bearing:e.bearing,pitch:e.pitch}),this.callback&&this.callback({trackIndex:e.trackIndex,currentPosition:e.currentPosition,currentMileage:e.currentMileage,totalMileage:e.totalMileage});}initRoam(e){this._roaming=!0,e&&(this.callback=e);}pauseRoam(){this._roaming=!1;}resumeRoam(){this._roaming=!0;}stopRoam(){this._roaming=!1,this.roamObject=void 0,this.roamingOptions=null;}async _convertToMainCameraOptions(t){const i=this.transform,s=this.transform.minZoom,r=this.transform.maxZoom;if(e.defined(t.center)&&e.defined(t.zoom)){const n=i.getMapViewParams(),o=n.bearing,a=n.pitch,l=n.roll;t.bearing=e.defined(t.bearing)?this._normalizeBearing(t.bearing,o):o,t.pitch=e.defined(t.pitch)?this._normalizeBearing(t.pitch,a):a,t.roll=e.defined(t.roll)?this._normalizeBearing(t.roll,l):l,t.center=e.LngLat.convert(e.defined(t.center)?t.center:n.center).toArray(),t.zoom=e.defined(t.zoom)?t.zoom:n.zoom;const h=n.center,_=n.zoom,c=n.bearing,u=n.pitch,d=n.roll;let m=!0;const p=e.LngLat.convert(t.center);if((Math.abs(p.lng-h.lng)>e.CONSTS.CesiumMath.EPSILON11||Math.abs(p.lat-h.lat)>e.CONSTS.CesiumMath.EPSILON11||e.defined(t.zoom)&&Math.abs(t.zoom-_)>e.CONSTS.CesiumMath.EPSILON9||e.defined(t.bearing)&&Math.abs(t.bearing-c)>e.CONSTS.CesiumMath.EPSILON8||e.defined(t.pitch)&&Math.abs(t.pitch-u)>e.CONSTS.CesiumMath.EPSILON8||e.defined(t.roll)&&Math.abs(t.roll-d)>e.CONSTS.CesiumMath.EPSILON8)&&(m=!1),m)return {unchanged:!0,callback:t.callback};const f=[t.center[0],t.center[1],e.clamp(t.zoom,s,r),t.bearing,t.pitch,t.roll],g=e.Transforms.convertV34Pos2V4(f);return t.position=[g[0],g[1],Math.min(g[6][2],38268822)],delete t.zoom,delete t.center,t.bearing=g[3],t.pitch=g[4],t.roll=g[5],t}if(e.defined(t.target)||e.defined(t.center)&&e.defined(t.zoom)){if(e.defined(t.target)||(t.target=i.activeCamera.cartographicPosition),t.target instanceof Array||t.target instanceof e.Vector3){const e=await async function(e){return {target:e,range:0}}(t.target);t.position=e.target,t.position[2]+=t.range?t.range+e.range:e.range;}else if(t.target instanceof e.Primitive){const i=await async function(t){if(!t.boundingSphere)throw new Error("当前的飞行目标没有包围球");const i=2*t.boundingSphere.radius;return {target:e.Transforms.cartesian3ToCartographic(t.boundingSphere.center),range:i}}(t.target);t.position=i.target,t.position[2]+=t.range?t.range+i.range:i.range;}else if(t.target instanceof e.BoundingSphere||t.target instanceof e.OrientedBoundingBox||t.target instanceof e.AxisAlignedBoundingBox){const i=await async function(t){let i,s;if(t instanceof e.BoundingSphere)i=t.center,s=t.radius;else if(t instanceof e.OrientedBoundingBox){const e=t.getBoundingSphere();i=e.center,s=e.radius;}else if(t instanceof e.AxisAlignedBoundingBox){i=t.center;const e=t.halfDiagonal;s=Math.max(e[0],e[1],e[2]);}return {target:e.Transforms.cartesian3ToCartographic(i),range:2*s}}(t.target);t.position=i.target,t.position[2]+=t.range?t.range+i.range:i.range;}else if(t.target instanceof Wa){const i=this.style.sourceCaches[t.target.id];let s=[],r=[];s=s.concat(i.getOpaquePrimitives(),i.getTranslucentPrimitives()),s.forEach((e=>{r.push(e.boundingBox.center);})),r=r.filter((e=>!isNaN(e[0])&&!isNaN(e[1])&&!isNaN(e[2])));const n=Math.min.apply(null,r.map((e=>e.x))),o=Math.max.apply(null,r.map((e=>e.x))),a=Math.min.apply(null,r.map((e=>e.y))),l=Math.max.apply(null,r.map((e=>e.y))),h=Math.min.apply(null,r.map((e=>e.z))),_=Math.max.apply(null,r.map((e=>e.z)));t.position=e.Transforms.cartesian3ToCartographic(new e.Vector3((n+o)/2,(a+l)/2,(h+_)/2)),t.range&&(t.position[2]+=t.range);}else if(t.target instanceof ja){const e=this.boundsToPosition(this.style.sourceCaches[t.target.id]._geoBounds[0]);t.position=e,t.range&&(t.position[2]+=t.range);}else if(t.target instanceof fa||t.target instanceof e.ModelInstance){const e=this.boundsToPosition(t.target.getBounds());t.position=e,t.range&&(t.position[2]+=t.range);}else if(t.target instanceof Fc){const e=this.boundsToPosition(t.target.getBounds());t.position=e,t.range&&(t.position[2]+=t.range);}const s=i.activeCamera.cartographicPosition,r=this.getCameraBearing(),n=this.getCameraPitch(),o=this.getCameraRoll();let a=!0;return (Math.abs(s[0]-t.position[0])>e.CONSTS.CesiumMath.EPSILON11||Math.abs(s[1]-t.position[1])>e.CONSTS.CesiumMath.EPSILON11||Math.abs(s[2]-t.position[2])>e.CONSTS.CesiumMath.EPSILON10||e.defined(t.bearing)&&Math.abs(t.bearing-r)>e.CONSTS.CesiumMath.EPSILON8||e.defined(t.pitch)&&Math.abs(t.pitch-n)>e.CONSTS.CesiumMath.EPSILON8||e.defined(t.roll)&&Math.abs(t.roll-o)>e.CONSTS.CesiumMath.EPSILON8)&&(a=!1),a?{unchanged:!0,callback:t.callback}:(t.position[2]=Math.min(t.position[2],38268822),t.target[2]=Math.min(t.position[2],38268822),e.defined(t.pitch)||(t.pitch=n),e.defined(t.bearing)||(t.bearing=r),e.defined(t.roll)||(t.roll=o),t)}{const n=i.getMapViewParams();t.center=e.LngLat.convert(t.center||n.center).toArray(),e.defined(t.zoom)||(t.zoom=n.zoom);const o=[t.center[0],t.center[1],e.clamp(t.zoom,s,r),e.defined(t.bearing)?t.bearing:n.bearing,e.defined(t.pitch)?t.pitch:n.pitch,e.defined(t.roll)?t.roll:n.roll],a=e.Transforms.convertV34Pos2V4(o);return t.position=[a[0],a[1],Math.min(a[6][2],38268822)],delete t.center,t.bearing=a[3],t.pitch=a[4],t.roll=a[5],t}}async easeTo(t,i){if(t={...t},1==(t=await this._convertToMainCameraOptions(t)).unchanged)return void(t.callback&&t.callback(i));this._stop(!1,t.easeId),!1===(t=e.extend({offset:[0,0],duration:500},t)).animate&&(t.duration=0);const s=this.getBearing(),r=this.getPitch(),n=this.getRoll(),o="bearing"in t?this._normalizeBearing(t.bearing,s):s,a="pitch"in t?+t.pitch:r,l="roll"in t?this._normalizeBearing(t.roll,n):n;let h;h=t.position&&0==t.offset[0]&&0==t.offset[1]?[0,0]:this._calcOffsetDifLngLat(t.offset),this._easeId=t.easeId;const _={};_.cancel=()=>{this._afterEase(i),t.cancel&&t.cancel(i);},_.complete=()=>{this._afterEase(i),t.callback&&t.callback(i);},_.updateExtraFunction=()=>{this._fireMoveEvents(i);},_.destination=[t.position[0]+h[0],t.position[1]+h[1],t.position[2]],_.heading=o*e.CONSTS.TRANSFORM.DEG_TO_RAD,_.pitch=a*e.CONSTS.TRANSFORM.DEG_TO_RAD,_.roll=l*e.CONSTS.TRANSFORM.DEG_TO_RAD,_.duration=e.defined(t.duration)?t.duration:1e3,_.duration/=1e3,_.maximumHeight=t.maximumHeight,_.pitchAdjustHeight=t.pitchAdjustHeight,_.flyOverLongitude=t.flyOverLongitude,_.flyOverLongitudeWeight=t.flyOverLongitudeWeight,_.isEaseToType=!0,_.easingFunction=t.easing||Ap.QUINTIC_OUT;const c=Mp.createTween(this.transform,_);if(0===c.duration)return void("function"==typeof c.complete&&c.complete());let u;return this._currentFlight=this.tweens.add(c),e.getZoomFromDistance(this.transform._fov,t.position[2]+e.CONSTS.TRANSFORM.R,e.CONSTS.TRANSFORM.R)-this.transform.zoom>e.CONSTS.CesiumMath.EPSILON3&&(u=!0),this._zooming=u,this._rotating=this._rotating||s!==o,this._pitching=this._pitching||a!==r,this._rolling=this._rolling||l!==n,this._prepareEase(i,!1,{moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling}),this._ease(),this}_calcOffsetDifLngLat(t){t instanceof Array&&(t={x:t[0],y:t[1]});const i=this.transform;let s=0,r=0,n=0;if(0!==t.x&&0!==t.y)Math.abs(t.x)>Math.abs(t.y)?(s=10,r=10*t.y/t.x,n=t.x/10):(s=10*t.x/t.y,r=10,n=t.y/10);else if(0!==t.x&&0===t.y)s=10,n=t.x/10;else {if(0!==t.x||0===t.y)return [0,0];r=10,n=t.y/10;}const o=i.pointLocation(new e.pointGeometry3d(i.width/2+s,i.height/2+10+r)),a=i.pointLocation(new e.pointGeometry3d(i.width/2,i.height/2+10));return o&&a?[(a.lng-o.lng)*n,(a.lat-o.lat)*n]:[0,0]}_prepareEase(e,t,i={}){this._moving=!0,t||i.moving||Fe.executeEvent(this,"movestart"),this._zooming&&!i.zooming&&Fe.executeEvent(this,"zoomstart"),this._rotating&&!i.rotating&&Fe.executeEvent(this,"rotatestart"),this._pitching&&!i.pitching&&Fe.executeEvent(this,"pitchstart"),this._rolling&&!i.rolling&&Fe.executeEvent(this,"rollstart");}_fireMoveEvents(){Fe.executeEvent(this,"move"),this._zooming&&Fe.executeEvent(this,"zoom"),this._rotating&&Fe.executeEvent(this,"rotate"),this._pitching&&Fe.executeEvent(this,"pitch"),this._rolling&&Fe.executeEvent(this,"roll");}_afterEase(e,t){if(this._easeId&&t&&this._easeId===t)return;delete this._easeId;const i=this._zooming,s=this._rotating,r=this._pitching,n=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,i&&Fe.executeEvent(this,"zoomend"),s&&Fe.executeEvent(this,"rotateend"),r&&Fe.executeEvent(this,"pitchend"),n&&Fe.executeEvent(this,"rollend"),Fe.executeEvent(this,"moveend");}flyToBoundingSphere(e,t){console.error("此方法已经废弃！ //替代方案，采用map.flyTo({target: boundingSphere}); 或参考开发文档");}async flyTo(t,i){if(t={...t},1==(t=await this._convertToMainCameraOptions(t)).unchanged)return void(t.callback&&t.callback(i));this.stop(),t=e.extend({offset:[0,0],speed:1.2,curve:1.42,easing:e.ease},t);const s=this.getCameraBearing(),r=this.getCameraPitch(),n=this.getCameraRoll(),o="bearing"in t?this._normalizeBearing(t.bearing,s):s,a="pitch"in t?+t.pitch:r,l="roll"in t?this._normalizeBearing(t.roll,n):n,h={};h.cancel=()=>{this._afterEase(i),t.cancel&&t.cancel(i);},h.complete=()=>{this._afterEase(i),t.callback&&t.callback(i);},h.updateExtraFunction=()=>{this._fireMoveEvents(i);},h.destination=t.position,h.heading=o*e.CONSTS.TRANSFORM.DEG_TO_RAD,h.pitch=a*e.CONSTS.TRANSFORM.DEG_TO_RAD,h.roll=l*e.CONSTS.TRANSFORM.DEG_TO_RAD,h.duration=e.defined(t.duration)?t.duration:1e3,h.duration/=1e3,h.maximumHeight=t.maximumHeight,h.pitchAdjustHeight=t.pitchAdjustHeight,h.flyOverLongitude=t.flyOverLongitude,h.flyOverLongitudeWeight=t.flyOverLongitudeWeight,h.easingFunction=t.easing,h.isEaseToType=t.isEaseToType;const _=Mp.createTween(this.transform,h);if(0===_.duration)return void("function"==typeof _.complete&&_.complete());let c;return this._currentFlight=this.tweens.add(_),e.getZoomFromDistance(this.transform._fov,t.position[2]+e.CONSTS.TRANSFORM.R,e.CONSTS.TRANSFORM.R)-this.transform.zoom>e.CONSTS.CesiumMath.EPSILON3&&(c=!0),this._zooming=c,this._rotating=Math.abs(s-o)>1e-4,this._pitching=Math.abs(r-a)>1e-4,this._rolling=Math.abs(n-l)>1e-4,this._prepareEase(i,!1,{moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling}),this._ease(),this}isEasing(){return !!this._easeFrameId}stop(){return this._stop()}_stop(t,i){if(this._currentFlight&&(this._currentFlight.cancelTween(),this._currentFlight=null),this.tweens.removeAll(),this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const e=this._onEaseEnd;delete this._onEaseEnd,e.call(this,i);}if(!t){const e=this.handlers;e&&e.stop(!1);}return e.defined(this._screenSpaceCameraController)&&this._screenSpaceCameraController._stopInertia(),this}_ease(){e.defined(this._easeFrameId)||(this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback));}_renderFrameCallback(){this.tweens.update(),this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback);}_normalizeBearing(t,i){t=e.wrap(t,-180,180);const s=Math.abs(t-i);return Math.abs(t-360-i)<s&&(t-=360),Math.abs(t+360-i)<s&&(t+=360),t}get staticState(){return !(this._moving||this._mouseAnimating)}_addHandOperationEventListener(){this.on("mousedown",(()=>{this._mouseAnimating=!0;})),this.on("zoomstart",(()=>{this._mouseAnimating=!0;})),this.on("touchstart",(()=>{this._mouseAnimating=!0;})),this.on("mouseup",(()=>{this._mouseAnimating=!1;})),this.on("zoomend",(()=>{this._mouseAnimating=!1;})),this.on("touchend",(()=>{this._mouseAnimating=!1;}));}}class Xp{constructor(t={}){this.options=t,e.bindAll(["_updateEditLink","_updateData","_updateCompact"],this);}getDefaultPosition(){return "bottom-right"}onAdd(e){const t=this.options&&this.options.compact;return this._map=e,this._container=z.create("div","minemap-ctrl minemap-ctrl-attrib"),t&&this._container.classList.add("minemap-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){z.remove(this._container),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0;}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".minemap-improve-map"));const t=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:st.ACCESS_TOKEN}];if(e){const i=t.reduce(((e,i,s)=>(i.value&&(e+=`${i.key}=${i.value}${s<t.length-1?"&":""}`),e)),"?");e.href=`https://www.minemap.com/feedback/${i}${this._map._hash?this._map._hash.getHashString(!0):""}`;}}_updateData(e){e&&"metadata"===e.sourceDataType&&(this._updateAttributions(),this._updateEditLink());}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id;}const t=this._map.style.sourceCaches;for(const i in t){const s=t[i].getSource();s.attribution&&e.indexOf(s.attribution)<0&&e.push(s.attribution);}e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,i)=>{for(let s=i+1;s<e.length;s++)if(e[s].indexOf(t)>=0)return !1;return !0})),e.length?(this._container.innerHTML=e.join(" | "),this._container.classList.remove("minemap-attrib-empty")):this._container.classList.add("minemap-attrib-empty"),this._editLink=null;}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("minemap-compact"):this._container.classList.remove("minemap-compact");}}class qp{constructor(){e.bindAll(["_updateLogo"],this);}onAdd(e,t){this._map=e,this._container=z.create("div","minemap-ctrl");const i=z.create("a","minemap-ctrl-logo");return i.target="_blank",i.href=t||"https://www.minedata.cn/",i.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),i.setAttribute("rel","noopener"),this._container.appendChild(i),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._container}onRemove(){z.remove(this._container),this._map.off("sourcedata",this._updateLogo);}getDefaultPosition(){return "bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none");}_logoRequired(){if(this._map.style)return !0}}class Kp{constructor(){}max(e){return Math.max.apply(null,e)}min(e){return Math.min.apply(null,e)}range(e){return this.max(e)-this.min(e)}midrange(e){return this.range(e)/2}sum(e){let t=0;for(let i=0,s=e.length;i<s;i++)t+=e[i];return t}mean(e){return this.sum(e)/e.length}median(e){e.sort(((e,t)=>e-t));const t=e.length/2;return t%1?e[t-.5]:(e[t-1]+e[t])/2}modes(e){if(!e.length)return [];const t={};let i=0,s=[];return e.forEach((e=>{t[e]?t[e]++:t[e]=1,t[e]>i?(s=[e],i=t[e]):t[e]===i&&(s.push(e),i=t[e]);})),s}variance(e){const t=this.mean(e);return this.mean(e.map((e=>Math.pow(e-t,2))))}standardDeviation(e){return Math.sqrt(this.variance(e))}meanAbsoluteDeviation(e){const t=this.mean(e);return this.mean(e.map((e=>Math.abs(e-t))))}zScores(e){const t=this.mean(e),i=this.standardDeviation(e);return e.map((e=>(e-t)/i))}average(e){return this.mean(e)}}const Jp=function(){return window&&window.performance?window.performance.now():Date.now()};class Zp{constructor(e={}){this.options=e,this.framesCounter=0,this.lastFPSTimestamp=null,this.lastFPSMeasure=0,this.measurements=[],this.lastMeasurementTimestamp=null,this.started=!1,this.stat=new Kp;}startMeasuring(e){this.started=!0,this.updateFPS(),e&&!isNaN(e)&&e>0&&setTimeout(this.stopMeasuring.bind(this),e);}stopMeasuring(){this.started=!1;}registerRenderFrame(){this.started&&(this.framesCounter++,this.updateFPS());}getLastMeasurement(){return this.measurements.length?this.measurements[this.measurements.length-1]:0}updateFPS(){null===this.lastFPSTimestamp&&(this.lastFPSTimestamp=Jp());const e=Jp(),t=e-this.lastFPSTimestamp;if(t>500){let i=Math.round(this.framesCounter/(t/1e3)*10)/10;i=i>60?60:i,this.lastFPSTimestamp=e,this.framesCounter=0,this.recordMeasurement(i,t);}}recordMeasurement(e){this.measurements.push(e);}getMeasurements(){return this.measurements.slice()}getMeasurementsReport(){const e=this.getMeasurements();return {measurements:e,median:Number(this.stat.median(e).toFixed(1)),average:Number(this.stat.average(e).toFixed(1)),variance:Number(this.stat.variance(e).toFixed(1)),stdDev:Number(this.stat.standardDeviation(e).toFixed(1))}}}class Yp{constructor(e={className:"minemap-fps-control"}){this.measurer=new Zp,this.options=e,this.countRenderBound=this.measurer.registerRenderFrame.bind(this.measurer),this.updateFPSCounterBound=this.updateFPSCounter.bind(this),this.lastFPSMeasure=null;}updateFPSCounter(){const e=this.measurer.getLastMeasurement(),t=this.measurer.getMeasurementsReport();if(e===this.lastFPSMeasure)return;let i=`FPS:${e.toFixed(1)}<br />`;i+=`平均值:${t.median}<br />`,this._container.innerHTML=i;}onAdd(e){return this._map=e,this._container=document.createElement("div"),this._container.className=`${this.options.className} minemap-ctrl-group minemap-ctrl`,this.addEventListeners(),this.measurer.startMeasuring(),this._container}remove(){this.onRemove();}onRemove(){this.removeEventListeners(),this.measurer.stopMeasuring(),this._container.remove();}addEventListeners(){this._map.on("render",this.countRenderBound),this._map.on("render",this.updateFPSCounterBound);}removeEventListeners(){this._map.off("render",this.countRenderBound),this._map.off("render",this.updateFPSCounterBound);}}var Qp=e.createCommonjsModule((function(e){function t(e){return !i(e)}function i(e){return "undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return !1;var e,t,i=new Blob([""],{type:"text/javascript"}),s=URL.createObjectURL(i);try{t=new Worker(s),e=!0;}catch(t){e=!1;}return t&&t.terminate(),URL.revokeObjectURL(s),e}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){const e=document.createElement("canvas");e.width=e.height=1;const t=e.getContext("2d");if(!t)return !1;const i=t.getImageData(0,0,1,1);return i&&i.width===e.width}()?(void 0===s[i=e&&e.failIfMajorPerformanceCaveat]&&(s[i]=function(e){const i=function(e){var i=document.createElement("canvas"),s=Object.create(t.webGLContextAttributes);return s.failIfMajorPerformanceCaveat=e,i.probablySupportsContext?i.probablySupportsContext("webgl",s)||i.probablySupportsContext("experimental-webgl",s):i.supportsContext?i.supportsContext("webgl",s)||i.supportsContext("experimental-webgl",s):i.getContext("webgl",s)||i.getContext("experimental-webgl",s)}(e);if(!i)return !1;const s=i.createShader(i.VERTEX_SHADER);return !(!s||i.isContextLost())&&(i.shaderSource(s,"void main() {}"),i.compileShader(s),!0===i.getShaderParameter(s,i.COMPILE_STATUS))}(i)),s[i]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var i;}e.exports?e.exports=t:window&&(window.minemap=window.minemap||{},window.minemap.supported=t,window.minemap.notSupportedReason=i);var s={};t.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};}));class $p{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1;}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,i=t?this._queue.concat(t):this._queue;for(const t of i)if(t.id===e)return void(t.cancelled=!0)}run(e=0){const t=this._currentlyRunning=this._queue;this._queue=[];for(const i of t)if(!i.cancelled&&(i.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1;}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[];}}class ef{constructor(t,i){this.map=i,this._sphereRender=t.sphereRender||!1,this._projection=t.projection||e.ProjectionType.MERCATOR,this.options=t;}get projection(){return this._projection}set projection(t){this._projection=t||e.ProjectionType.MERCATOR,this.map.transform.projection=this._projection,this.map.style.changWorkerProjection(this._projection),this.map.painter.projection=this._projection,this.map.isLatLon="LATLON"===t,this.map._tilingScheme="LATLON"===t?new Ct:new yt;}}class tf{constructor(e){this.camera=e,this._cameraClone=a.clone(e),this._cameraStartFired=!1,this._cameraMovedTime=void 0;}checkForCameraUpdates(){const t=this.camera,i=this._cameraClone;return nf(t,i,e.CONSTS.CesiumMath.EPSILON15)?(this._cameraStartFired&&H()-this._cameraMovedTime>500&&(this._cameraStartFired=!1),!1):(this._cameraStartFired||(this._cameraStartFired=!0),this._cameraMovedTime=H(),a.clone(t,i),!0)}}const sf=new e.Vector3,rf=new e.Vector3,nf=(t,i,s)=>{const r=1/Math.max(1,((e,t)=>{const i=Math.max(Math.abs(e.x),Math.abs(t.x)),s=Math.max(Math.abs(e.y),Math.abs(t.y)),r=Math.max(Math.abs(e.z),Math.abs(t.z));return Math.max(Math.max(i,s),r)})(t.positionWC,i.positionWC));return e.Vector3.multiplyByScalar(t.positionWC,r,sf),e.Vector3.multiplyByScalar(i.positionWC,r,rf),e.Vector3.equalsEpsilon(sf,rf,s)&&e.Vector3.equalsEpsilon(t.directionWC,i.directionWC,s)&&e.Vector3.equalsEpsilon(t.upWC,i.upWC,s)&&e.Vector3.equalsEpsilon(t.rightWC,i.rightWC,s)&&e.Matrix4.equalsEpsilon(t.transform,i.transform,s)&&t.frustumCrate.frustum.equalsEpsilon(i.frustumCrate.frustum,s)};class of{constructor(t,i,s,r,n){this.tileSize=512,this._minZoom=t||0,this._maxZoom=i||22,this.width=0,this.height=0,this._position=new e.Vector3(0,0,0),this._cameraHeightConvertedZoom=0,this.scale=this.zoomScale(0),this._fov=e.CONSTS.TRANSFORM.FOV_IN_RADIANS,this._3dNearPlaneNumber=Number.MAX_VALUE,this._3dFarPlaneNumber=Number.MIN_VALUE,this._unmodified=!0,this._posMatrixCache={},this.latRange=[e.CONSTS.TRANSFORM.MIN_LAT,e.CONSTS.TRANSFORM.MAX_LAT],this._projection=s,this._terrainRender=!1,this.pixelMatrix=new e.Matrix4,this._hpr=new e.HeadingPitchRoll(0,0,0),this._pinchOperationData={lastMatrix:new e.Matrix4,_rollDiff:0,_pitchDiff:0,_headingDiff:0},this.near=.1,this.far=1e4,this._pinchPosition=null,this._adjustHeightStep=10,this._minHeightToDemSurface=1,this._maximumCameraCheckHeight=1e4,this._minimumCameraCheckHeightNoTerrain=1,this.activeCamera=new a,this.cameraCheck=new tf(this.activeCamera),this.shadowCamera=new l,this._calcProjectionsMatrix(),this._minPitch=e.defined(r)?r:0,this._maxPitch=e.defined(n)?n:90,this._zoomDelta=0,this._panDelta=new e.Vector3(0,0,0),this._justTerrain=!1;}clone(){const e=new of(this._minZoom,this._maxZoom,this._projection);return e.width=this.width,e.height=this.height,e._position=this._position,e._cameraHeightConvertedZoom=this._cameraHeightConvertedZoom,e._fov=this._fov,e.hpr=this.hpr,e._unmodified=this._unmodified,e.update(),e}set minHeightToDemSurface(t){this._minHeightToDemSurface=e.defined(t)?t:1;}get minHeightToDemSurface(){return this._minHeightToDemSurface}updateNearFarPlane(e){this._3dNearPlaneNumber=e.near,this._3dFarPlaneNumber=e.far,this._calcProjectionsMatrix();}get terrainRender(){return this._terrainRender}set terrainRender(e){this._terrainRender=e;}set terrainSupplier(e){e instanceof nl&&(this._terrainSupplier=e);}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.cameraPitch=Math.max(this.pitch,e));}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.cameraPitch=Math.min(this.pitch,e));}resize(t,i){this.width=t,this.height=i,this.pixelsToGLUnits=[2/t,-2/i],this._constrain(),this.cameraHeightToCartesianCenter=e.getDistanceFromZoom(this._fov,this.cameraHeightConvertedZoom,e.CONSTS.TRANSFORM.R),this.position[2]=this.cameraHeightToCartesianCenter-e.CONSTS.TRANSFORM.R,this.pixelMatrix=(new e.Matrix4).scale([this.width/2,-this.height/2,1]),this.pixelMatrix=new e.Matrix4(this.pixelMatrix).translate([1,-1,0]),this.update();}get zoom(){return Math.min(this.getMapViewParams().zoom,22)}get cameraHeightConvertedZoom(){return this._cameraHeightConvertedZoom}set zoomDelta(e){this._zoomDelta=e;}get zoomDelta(){return this._zoomDelta}set panDelta(e){this._panDelta=e;}get panDelta(){return this._panDelta}set positionHeight(t){this._fov&&this.positionHeight!==t&&(this._unmodified=!1,this._cameraHeightConvertedZoom=e.getZoomFromDistance(this._fov,t+e.CONSTS.TRANSFORM.R,e.CONSTS.TRANSFORM.R),this.scale=this.zoomScale(this._cameraHeightConvertedZoom),this.tileZoom=Math.floor(this._cameraHeightConvertedZoom),this.cameraHeightToCartesianCenter=e.CONSTS.TRANSFORM.R+t,this._position[2]=t,this._constrain(),this.update());}get positionHeight(){return this.position[2]}set pinchPosition(e){this._pinchPosition=e,this.update();}get pinchPosition(){return this._pinchPosition}_calcProjectionsMatrix(){if(0===this.width||0===this.height)return;const t=this._getIntersectionResultFromSharedTerrainTileCache(this.position[0],this.position[1],this.position[2]);let i,s;if(this.cameraHeightToTerrainSurface=Number.isFinite(t.intersectionZ)?t.intersectionZ:this.position[2],i=this.cameraHeightToTerrainSurface/40,this.zoom>5){const t=e.binaryFindRayIntersectionTop(this);s=t?1.5*e.Vector3.distance(t.cartesian,this.getCameraPos()):3*this.position[2],this._3dNearPlaneNumber<i&&(i=this._3dNearPlaneNumber),this._3dFarPlaneNumber>s&&(s=this._3dFarPlaneNumber);}else s=this.position[2]+e.CONSTS.TRANSFORM.R/Math.pow(1.2,this.zoom);i<.1&&(i=.1),s<=i+500&&(s=i+500),this.near=i,this.far=s,this.activeCamera.updatePerspectiveOptions({fov:this.fov,aspect:this.width/this.height,near:i,far:s}),this.activeCamera.updateCullingVolume(),this.shadowCamera.update();}set projection(e){this._projection=e;}get projection(){return this._projection}locationPoint(t,i){const s=e.Transforms.cartographicToCartesian3([t.lng,t.lat,i||0]),r=e.Transforms.pointToWindowCoordinates(this.activeCamera.getVPMatrix(),this.pixelMatrix,new e.Vector3(s));return new e.pointGeometry3d(r.x,r.y)}set hpr(e){this._hpr=e,this.update();}get hpr(){return this._hpr}get pitch(){return (this.activeCamera.pitch+.5*Math.PI)*e.CONSTS.TRANSFORM.RAD_TO_DEG}set pitch(t){const i=e.clamp(t,this.minPitch,this.maxPitch)*e.CONSTS.TRANSFORM.DEG_TO_RAD;this._hpr.pitch!==i&&(this._unmodified=!1,this._hpr.pitch=i,this.update());}get bearing(){return e.wrap(this.activeCamera.heading,-Math.PI,Math.PI)*e.CONSTS.TRANSFORM.RAD_TO_DEG}set bearing(t){const i=e.wrap(t,-180,180)*e.CONSTS.TRANSFORM.DEG_TO_RAD;this._hpr.heading!==i&&(this._unmodified=!1,this._hpr.heading=i,this.update());}get roll(){return e.wrap(this.activeCamera.roll,-Math.PI,Math.PI)*e.CONSTS.TRANSFORM.RAD_TO_DEG}set roll(t){const i=e.wrap(t,-180,180)*Math.PI/180;this._hpr.roll!==i&&(this._unmodified=!1,this._hpr.roll=i,this.update());}get center(){return this.getMapViewParams().center}checkCameraChanged(){const e=this.__oldVal;return !e||e[0]!==this.activeCamera.cartographicPosition[0]||e[1]!==this.activeCamera.cartographicPosition[1]||e[2]!==this._cameraHeightConvertedZoom||e[3]!==this.bearing||e[4]!==this.pitch||e[5]!==this.roll}getMapViewParams(){if(!this.checkCameraChanged())return this.__oldVal[6];this._cameraHeightConvertedZoom=e.getZoomFromDistance(this._fov,this.position[2]+e.CONSTS.TRANSFORM.R,e.CONSTS.TRANSFORM.R);const t=[this.activeCamera.cartographicPosition[0],this.activeCamera.cartographicPosition[1],this._cameraHeightConvertedZoom,this.bearing,this.pitch,this.roll],i=e.Transforms.convertV4Pos2V34Traversal(t,this);let s;return this.scale=this.zoomScale(this._cameraHeightConvertedZoom),this.tileZoom=Math.floor(this._cameraHeightConvertedZoom),this.cameraHeightToCartesianCenter=e.CONSTS.TRANSFORM.R+this.position[2],s=i?{center:new e.LngLat(i[0],i[1]),zoom:i[2],bearing:i[3],pitch:i[4],roll:i[5]}:{center:new e.LngLat(this.activeCamera.cartographicPosition[0],this.activeCamera.cartographicPosition[1]),zoom:this._cameraHeightConvertedZoom,pitch:this.pitch,bearing:this.bearing,roll:this.roll},s.zoom<0&&(s.zoom=0),this.activeCamera.mapZoom=s.zoom,this._position=this.activeCamera.cartographicPosition,this.activeCamera.heightZoom=this._cameraHeightConvertedZoom,this.__oldVal=t,this.__oldVal.push(s),s}get position(){return this.activeCamera.cartographicPosition}set position(e){!e||e[0]===this.position[0]&&e[1]===this.position[1]&&e[2]===this.position[2]||(this._unmodified=!1,this._position[0]=e[0],this._position[1]=e[1],this._constrain(),this.update(),this.positionHeight=e[2]);}_constrain(){}pointLocation(t,i){return e.getPickPositionOfSurface({canvasX:t.x,canvasY:t.y,transform:this,ellipsoid:i}).lngLat}getLocationAtPointDiff(t,i,s){const r=e.getPickPositionOfSurface({canvasX:i.x,canvasY:i.y,transform:this,ellipsoid:s});return r.lngLat&&t?[r.lngLat.lng-t.lng,r.lngLat.lat-t.lat]:[0,0]}setLocationAtPoint(e,t){const i=this.getLocationAtPointDiff(e,t);0==i[0]&&0==i[1]||(this.position=[this.position[0]-i[0],this.position[1]-i[1],this.position[2]]);}_getIntersectionResultFromSharedTerrainTileCache(t,i,s){if(this._terrainRender&&this._terrainSupplier){const r=e.defined(s)?s:this.position[2];return ol([t,i,r],e.Vector3.fromDegrees(t,i,r),this._terrainSupplier,this._projection)}return {intersectionZ:1/0,intersectionPoint:null,isUnderground:!1}}pointCoordinate(t,i){const s=e.getPickPositionOfSurface({canvasX:t.x,canvasY:t.y,transform:this});return s.lngLat?new e.Coordinate(e.ProjectionProxy.lngX(s.lngLat.lng,this.worldSize,this._projection)/this.tileSize,e.ProjectionProxy.latY(s.lngLat.lat,this.worldSize,this._projection)/this.tileSize,this.cameraHeightConvertedZoom)._zoomTo(i||this.cameraHeightConvertedZoom):null}_calculateTDSceneMatrix(){this._calcProjectionsMatrix();const t={destination:e.Vector3.fromDegrees(this._position[0],this._position[1],this._position[2]),orientation:new e.HeadingPitchRoll(this.hpr.heading,this.hpr.pitch-.5*Math.PI,this.hpr.roll)};this.activeCamera.setView(t);}update(){this.height&&(e.Vector3.equals(new e.Vector3(this._position),e.Vector3.ZERO)&&(this._position=this.activeCamera.cartographicPosition),this._calculateTDSceneMatrix());}calculateVPMatrix(){return this.activeCamera.getVPMatrix()}getCameraPos(){return this.activeCamera.positionWC}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e);}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e);}get worldSize(){return this.tileSize*this.scale}get centerPoint(){return this.size._div(2)}get size(){return new e.pointGeometry3d(this.width,this.height)}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this.update());}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(t){return new e.pointGeometry3d(e.ProjectionProxy.lngX(t.lng,this.worldSize,this._projection),e.ProjectionProxy.latY(t.lat,this.worldSize,this._projection))}unproject(t){return new e.LngLat(e.ProjectionProxy.xLng(t.x,this.worldSize,this._projection),e.ProjectionProxy.yLat(t.y,this.worldSize,this._projection))}get x(){return e.ProjectionProxy.lngX(this.center.lng,this.worldSize,this._projection)}get y(){return e.ProjectionProxy.latY(this.center.lat,this.worldSize,this._projection)}get point(){return new e.pointGeometry3d(this.x,this.y)}locationCoordinate(t){const i=e.ProjectionProxy.latY(t.lat,this.worldSize,this._projection);return this.tileZoom||(this.tileZoom=this.cameraHeightConvertedZoom),new e.Coordinate(e.ProjectionProxy.lngX(t.lng,this.worldSize,this._projection)/this.tileSize,i/this.tileSize,this.cameraHeightConvertedZoom).zoomTo(this.tileZoom)}}const af={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class lf extends e.Evented{constructor(t){if(super(),(arguments[0]instanceof e.window.HTMLElement||2===arguments.length)&&(t=e.extend({element:t},arguments[1])),e.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._lngLat=new e.LngLat(0,0),this._anchor=t&&t.anchor||"top-left",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this.heightToSurface=0,this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&"auto"!==t.pitchAlignment?t.pitchAlignment:this._rotationAlignment,this._uuid=e.uuid(),this._updateMoving=()=>this._update(!0),t&&t.element)this._element=t.element,this._offset=e.pointGeometry3d.convert(t&&t.offset||[0,0]);else {this._defaultMarker=!0,this._element=z.create("div"),this._element.oncontextmenu=()=>!1;const i=41,s=27,r=z.createNS("http://www.w3.org/2000/svg","svg");r.setAttributeNS(null,"height",`${i}px`),r.setAttributeNS(null,"width",`${s}px`),r.setAttributeNS(null,"viewBox",`0 0 ${s} ${i}`);const n=z.createNS("http://www.w3.org/2000/svg","g");n.setAttributeNS(null,"stroke","none"),n.setAttributeNS(null,"stroke-width","1"),n.setAttributeNS(null,"fill","none"),n.setAttributeNS(null,"fill-rule","evenodd");const o=z.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"fill-rule","nonzero");const a=z.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"transform","translate(3.0, 29.0)"),a.setAttributeNS(null,"fill","#000000");const l=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const e of l){const t=z.createNS("http://www.w3.org/2000/svg","ellipse");t.setAttributeNS(null,"opacity","0.04"),t.setAttributeNS(null,"cx","10.5"),t.setAttributeNS(null,"cy","5.80029008"),t.setAttributeNS(null,"rx",e.rx),t.setAttributeNS(null,"ry",e.ry),a.appendChild(t);}const h=z.createNS("http://www.w3.org/2000/svg","g");h.setAttributeNS(null,"fill",this._color);const _=z.createNS("http://www.w3.org/2000/svg","path");_.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),h.appendChild(_);const c=z.createNS("http://www.w3.org/2000/svg","g");c.setAttributeNS(null,"opacity","0.25"),c.setAttributeNS(null,"fill","#000000");const u=z.createNS("http://www.w3.org/2000/svg","path");u.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),c.appendChild(u);const d=z.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"transform","translate(6.0, 7.0)"),d.setAttributeNS(null,"fill","#FFFFFF");const m=z.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(8.0, 8.0)");const p=z.createNS("http://www.w3.org/2000/svg","circle");p.setAttributeNS(null,"fill","#000000"),p.setAttributeNS(null,"opacity","0.25"),p.setAttributeNS(null,"cx","5.5"),p.setAttributeNS(null,"cy","5.5"),p.setAttributeNS(null,"r","5.4999962");const f=z.createNS("http://www.w3.org/2000/svg","circle");f.setAttributeNS(null,"fill","#FFFFFF"),f.setAttributeNS(null,"cx","5.5"),f.setAttributeNS(null,"cy","5.5"),f.setAttributeNS(null,"r","5.4999962"),m.appendChild(p),m.appendChild(f),o.appendChild(a),o.appendChild(h),o.appendChild(c),o.appendChild(d),o.appendChild(m),r.appendChild(o),r.setAttributeNS(null,"height",i*this._scale+"px"),r.setAttributeNS(null,"width",s*this._scale+"px"),this._element.appendChild(r),this._offset=e.pointGeometry3d.convert(t&&t.offset||[-13.5*this._scale,-35*this._scale]);}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("minemap-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault();})),this._element.addEventListener("mousedown",(e=>{"INPUT"!==e.view.document.activeElement.tagName&&e.preventDefault();}));const i=this._element.classList;for(const e in af)i.remove(`minemap-marker-anchor-${e}`);i.add(`minemap-marker-anchor-${this._anchor}`),this._popup=null,this.updateBoundingVolume();}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),e._markers.push(this)),this}remove(){const e=this._map;if(e){e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer);const t=e._markers.indexOf(this);-1!==t&&e._markers.splice(t,1),this._draggable&&(this._map._screenSpaceCameraController.enableInputs=!0),this._map=void 0;}return this._clearFadeTimer(),z.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return t=e.LngLat.convert(t),this._lngLat=t,this._pos=null,this.updateBoundingVolume(),this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getAltitude(){return this.heightToSurface}setAltitude(e){return this.heightToSurface=e,this.updateBoundingVolume(),this._pos=null,this._popup&&this._popup.setAltitude(this.heightToSurface),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,i=13.5,s=Math.sqrt(Math.pow(i,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[s,-1*(t-i+s)],"bottom-right":[-s,-1*(t-i+s)],left:[i,-1*(t-i)],right:[-i,-1*(t-i)]}:this._offset;}e._markerBinded=!0,this._popup=e,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false");}return this}_onKeyPress(e){const t=e.code,i=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==i&&13!==i||this.togglePopup();}_onMapClick(e){const t=e.originalEvent.target,i=this._element;this._popup&&(t===i||i.contains(t))&&this.togglePopup();}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null);}_updateDOM(){const t=this._pos||new e.pointGeometry3d(0,0),i=this._calculatePitch(),s=this._calculateRotation();this._element.style.transform=`${af[this._anchor]} translate(${t.x}px, ${t.y}px) rotateX(${i}deg) rotateZ(${s}deg)`;}_calculatePitch(){return "viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?0:"map"===this._pitchAlignment?this._map.getPitch():0}_calculateRotation(){return "viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?this._rotation:"map"===this._rotationAlignment?this._rotation-this._map.getBearing():0}_calculatePanoramaMode(){const t=this._map.transform.activeCamera.frustumCrate.cullingVolume.computeVisibility(this.boundingVolume);if(this._element.style.visibility=t===e.INTERSECTION.OUTSIDE?"hidden":"visible","visible"==this._element.style.visibility){const t=e.Transforms.cartographicToCartesian3([this._lngLat.lng,this._lngLat.lat,this.heightToSurface]),i=new e.Vector3(this._map.transform.getCameraPos()),s=new e.Vector3(t[0]-i[0],t[1]-i[1],t[2]-i[2]).normalize(),r=e.getPickPositionOfSurfaceByOriginAndDir(i,s);r&&i.distance(r)<i.distance(t)-1e4&&(this._element.style.visibility="hidden");}}_calculateOffset(){return "viewport"===this._rotationAlignment||"auto"===this._rotationAlignment||"map"===this._rotationAlignment||"map"===this._pitchAlignment?this._offset:e.pointGeometry3d.convert([0,0])}calculateScreenCoordinates(){const t=e.Transforms.cartographicToCartesian3(new e.Vector3(this._lngLat.lng,this._lngLat.lat,this.heightToSurface||0)),i=this._map.transform,s=e.Transforms.pointToWindowCoordinatesFrontCheck(i.activeCamera.getVPMatrix(),i.pixelMatrix,new e.Vector3(t));return new e.pointGeometry3d(s.x*s.z,s.y*s.z)}_update(t){if(e.window.cancelAnimationFrame(this._updateFrameId),!this._map)return;this._pos=this.calculateScreenCoordinates()._add(this._offset),this._calculatePanoramaMode(),!0===t?this._updateFrameId=e.window.requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM());})):this._pos=this._pos.round();const i=this._calculateOffset(),s=Math.abs(i.x)/parseFloat(z.getAllStyle(this._element).width)*100,r=Math.abs(i.y)/parseFloat(z.getAllStyle(this._element).height)*100;z.setTransformOrigin(this._element,`${s}% ${r}%`),this._map._requestDomTask((()=>{this._element&&this._pos&&this._anchor&&this._updateDOM();}));}getOffset(){return this._offset}setOffset(t){return this._offset=e.pointGeometry3d.convert(t),this._update(),this}updateBoundingVolume(){this.boundingVolume=new e.BoundingSphere(e.Vector3.fromDegrees(this._lngLat.lng,this._lngLat.lat,this.heightToSurface),100);}_onMove(t){if(!this._isDragging){const e=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=e;}if(!this._isDragging)return;this._pos=t.point.sub(this._positionDelta);const i=new e.Ellipsoid(e.WGS84_RADIUS_X+this.heightToSurface,e.WGS84_RADIUS_Y+this.heightToSurface,e.WGS84_RADIUS_Z+this.heightToSurface),s=this._map.isTerrain(),r=s?this._map.getPositionByGPUPick(this._pos):this._map.unproject(this._pos,i);r&&(this._lngLat=s?e.LngLat.convert([r[0],r[1]]):r,s&&this.setAltitude(r[2]),this.setLngLat(this._lngLat),this.updateBoundingVolume(),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.Event("dragstart"))),this.fire(new e.Event("drag")));}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),"active"===this._state&&this.fire(new e.Event("dragend")),this._state="inactive",this._map._screenSpaceCameraController.enableInputs=!0;}_addDragHandler(e){this._element.contains(e.originalEvent.target)&&(this._positionDelta=e.point.sub(this._pos).add(this._offset),this._pointerdownPos=e.point,this._map._screenSpaceCameraController.enableInputs=!1,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.on("mouseup",this._onUp),this._map.on("touchend",this._onUp));}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}enableDragging(){return this.setDraggable(!0),this}disableDragging(){return this.setDraggable(!1),this}isDraggable(){return this._draggable}getDraggable(){return this.isDraggable()}getMap(){return this._map}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&"auto"!==e?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class hf{constructor(){this.startTime=_f(),this.oldTime=this.startTime,this.totalTime=0,this._running=!1,this.needClearTime=!0,this._pause=!1,this.delta=0,this.counter=0;}update(t){if(this._running){const i=e.defaultValue(t,_f());this.needClearTime?this.needClearTime=!1:(this.delta=(i-this.oldTime)/1e3,this.counter+=(i-this.oldTime)/1e3,this.totalTime+=this.delta),this.oldTime=i;}}reset(){return this.startTime=_f(),this.oldTime=this.startTime,this.totalTime=0,this._running=!1,this.needClearTime=!0,this._pause=!1,this.delta=0,this.counter=0,this.totalTime}get state(){return this._running}set state(e){this._running=e,e||(this.needClearTime=!0);}pauseTimer(){this.state=!1;}resumeTimer(){this.state=!0;}getDelta(){let e=0;return this._running&&(e=this.delta),e}}function _f(){return ("undefined"==typeof performance?Date:performance).now()}const cf={"FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","GeolocateControl.Geolocate":"Geolocate","LogoControl.Title":"MineMap logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},uf=["u_VIDEOMATCH_MVPMATRIX","u_VIDEOMATCH_RTP","u_ClipColors","u_VideoSampler","u_HAS_VIDEOMATCHMAP","u_Alpha","u_ActiveClipVideoTexture","u_ClipVideo","u_ClipMatrix","u_MaskSample","u_TextureSize"];class df{constructor(e,t){this._videoManager=e,this._usedVideos=[],this._videoUniform=void 0,this.type=t,"Raster"===this.type?this._rasterTiles=[]:"3DTiles"===this.type?this._selectedTiles=[]:"3DModel"===this.type?this._selectedModelTiles=[]:"Polygon"===this.type&&(this._selectedPolygons=[]);}update(t){"3DModel"!==this.type&&"3DTiles"!==this.type?(this.selectTiles(t),this._usedVideos.length<1||(e.defined(this._videoUniform)||(this._videoUniform=this.getVideoUniformsCallback()),this.addUniforms())):this._usedVideos=[];}addUniforms(){if("Raster"===this.type)for(let t=0;t<this._rasterTiles.length;t++)this._rasterTiles[t]._material._uniforms=e.combineInternalMap(this._rasterTiles[t]._material._uniforms,this._videoUniform),this._rasterTiles[t]._material.defines={NUM_VIDEOS:this._usedVideos.length};else if("3DTiles"===this.type){if(this._selectedTiles.length>0)for(let t=0;t<this._selectedTiles.length;t++){const i=this._selectedTiles[t]._material;i._uniforms=e.combineInternalMap(i._uniforms,this._videoUniform),i.defines={NUM_VIDEOS:this._usedVideos.length};}}else if("3DModel"===this.type){if(this._selectedModelTiles.length>0)for(let t=0;t<this._selectedModelTiles.length;t++){const i=this._selectedModelTiles[t]._material;i._uniforms=e.combineInternalMap(i._uniforms,this._videoUniform),i.defines={NUM_VIDEOS:this._usedVideos.length};}}else if("Polygon"===this.type){const t=this._selectedPolygons;if(t.length>0)for(let i=0;i<t.length;i++){const s=t[i]._material;s._uniforms=e.combineInternalMap(s._uniforms,this._videoUniform),s.defines={NUM_VIDEOS:this._usedVideos.length};}}}removeUniforms(){if("Raster"===this.type){if(this._rasterTiles.length>0){for(let t=0;t<this._rasterTiles.length;t++)if(e.defined(this._rasterTiles[t]._material&&this._rasterTiles[t]._material._uniforms)){for(let e=0;e<uf.length;e++)this._rasterTiles[t]._material._uniforms.delete(uf[e]);this._rasterTiles[t]._material.defines={NUM_VIDEOS:0};}this._rasterTiles=[];}}else if("3DTiles"===this.type){if(this._selectedTiles.length>0){for(let e=0;e<this._selectedTiles.length;e++){const t=this._selectedTiles[e]._material;if(null!=t&&null!=t._uniforms){for(let e=0;e<uf.length;e++)t._uniforms.delete(uf[e]);t.defines={NUM_VIDEOS:0};}}this._selectedTiles=[];}}else if("3DModel"===this.type){if(this._selectedModelTiles.length>0){for(let e=0;e<this._selectedModelTiles.length;e++){const t=this._selectedModelTiles[e]._material;if(null!=t&&null!=t._uniforms){for(let e=0;e<uf.length;e++)t._uniforms.delete(uf[e]);t.defines={NUM_VIDEOS:0};}}this._selectedModelTiles=[];}}else if("Polygon"===this.type){const e=this._selectedPolygons;if(e.length>0){for(let t=0;t<e.length;t++){const i=e[t]._material;for(let e=0;e<uf.length;e++)i._uniforms.delete(uf[e]);i.defines={NUM_VIDEOS:0};}this._selectedPolygons=[];}}}selectTiles(t){this._usedVideos=[],e.defined(t.style)&&("Raster"===this.type&&this._selectRaster(t.style.rasterSourceCache),"Polygon"===this.type&&this._selectPolygons(t));}_selectRaster(e){let t=[];if(e&&e.getVisibleCoordinates){t=e.getVisibleCoordinates(!1);const i=this._videoManager.getAll(),s=i.length<=this._videoManager._maxUsedVideoUnit?i.length:this._videoManager._maxUsedVideoUnit;for(let r=0;r<s;r++){if(!i[r].usedRaster||!i[r].enabled)continue;const s=i[r]._perspectiveCamera.frustumCrate.cullingVolume;let n=!1;for(let i=0;i<t.length;i++){const r=e.getTile(t[i]).primitive;r&&-1!==(s?s.computeVisibility(r.boundingBox):-1)&&(this._rasterTiles.push(r),n=!0);}n&&this._usedVideos.push(i[r]);}}}select3DModel(t){e.defined(t)&&t.length>0&&this._select3DModel(t),this._usedVideos.length<1||(e.defined(this._videoUniform)||(this._videoUniform=this.getVideoUniformsCallback()),this.addUniforms());}_select3DModel(e){let t;const i=this._videoManager.getAll(),s=i.length<=this._videoManager._maxUsedVideoUnit?i.length:this._videoManager._maxUsedVideoUnit;for(let r=0;r<s;r++){if(!i[r].used3DModel||!i[r].enabled)continue;let s=!1;const n=i[r]._perspectiveCamera.frustumCrate.cullingVolume;if(e.length>0)for(let i=0;i<e.length;i++)t=e[i],void 0!==t&&(t.updateMatrixWorld(!0),-1!==(n?n.computeVisibility(t.boundingVolume):-1)&&(this._selectedModelTiles.push(t),s=!0));s&&this._usedVideos.push(i[r]);}}select3DTiles(t){e.defined(t)&&t.length>0&&this._select3DTiles(t),this._usedVideos.length<1||(e.defined(this._videoUniform)||(this._videoUniform=this.getVideoUniformsCallback()),this.addUniforms());}_select3DTiles(e){let t;const i=this._videoManager.getAll(),s=i.length<=this._videoManager._maxUsedVideoUnit?i.length:this._videoManager._maxUsedVideoUnit;for(let r=0;r<s;r++){if(!i[r].used3DTiles||!i[r].enabled)continue;let s=!1;const n=i[r]._perspectiveCamera.frustumCrate.cullingVolume;if(e.length>0)for(let i=0;i<e.length;i++)t=e[i],void 0!==t&&(t.updateMatrixWorld(!0),-1!==(n?n.computeVisibility(t.boundingVolume):-1)&&(this._selectedTiles.push(t),s=!0));s&&this._usedVideos.push(i[r]);}}_selectPolygons(e){let t;const i=e.style.primitiveCollection.getAll(),s=this._videoManager.getAll(),r=s.length<=this._videoManager._maxUsedVideoUnit?s.length:this._videoManager._maxUsedVideoUnit;for(let e=0;e<r;e++){if(!s[e].usedPolygon||!s[e].enabled)continue;let r=!1;const n=s[e]._perspectiveCamera.frustumCrate.cullingVolume;if(i.length>0)for(let e=0;e<i.length;e++)t=i[e],void 0!==t&&t.usedVideoProjection&&(i[e].updateMatrixWorld(!0),-1!==(n?n.computeVisibility(t.boundingVolume):-1)&&(-1===this._selectedPolygons.indexOf(t)&&this._selectedPolygons.push(t),r=!0));r&&this._usedVideos.push(s[e]);}}getVideoUniformsCallback(){const t=this;let i=[],s=[],r=[],n=[],o=[],a=[],l=[];return new Map([["u_VIDEOMATCH_MVPMATRIX",()=>{const e=t._usedVideos,s=e.length;i=[];for(let t=0;t<s;t++){const s=e[t];s.enabled&&i.push(s.videoMatrix);}return i}],["u_VIDEOMATCH_RTP",()=>{const e=t._usedVideos,i=e.length;s=[];for(let t=0;t<i;t++){const i=e[t];i.enabled&&s.push(i.cartographic);}return s}],["u_ClipColors",()=>{const e=t._usedVideos,i=e.length;r=[];for(let t=0;t<i;t++){const i=e[t];i.enabled&&r.push(i._clipColor);}return r}],["u_VideoSampler",()=>{const e=t._usedVideos,i=e.length;n=[];for(let t=0;t<i;t++){const i=e[t];void 0!==i.videoTexture&&i.enabled&&n.push(i.videoTexture);}return n}],["u_HAS_VIDEOMATCHMAP",()=>{const e=t._usedVideos,i=e.length;o=[];for(let t=0;t<i;t++){const i=e[t].enabled;i&&o.push(i);}return o}],["u_Alpha",()=>{const e=t._usedVideos,i=e.length;a=[];for(let t=0;t<i;t++){const i=e[t];i.enabled&&a.push(i._alpha);}return a}],["u_ActiveClipVideoTexture",()=>{const e=t._usedVideos,i=e.length;l=[];for(let t=0;t<i;t++)e[t].enabled&&l.push(e[t]._clip&&this._videoManager._clipManager.getByName(e[t].uniqueId).length>0);return l}],["u_ClipVideo",()=>t._videoManager.enableClip],["u_ClipMatrix",()=>t._videoManager._projectionMatrix],["u_MaskSample",()=>{const e=t._usedVideos,i=e.length;n=[];for(let t=0;t<i;t++){const i=e[t];void 0!==i.videoTexture&&i.enabled&&n.push(i.videoTexture);}const s=t._videoManager._clipFill.framebuffer.getColorTexture(0);return s.bind(),s}],["u_TextureSize",()=>new e.Vector2(t._videoManager._clipFill.framebuffer.width,t._videoManager._clipFill.framebuffer.height)]])}empty(){this._selectedModelTiles=[],this._rasterTiles=[],this._selectedTiles=[],this._selectedPolygons=[];}}class mf extends e.Geometry{constructor(t){super({}),this.type="FrustumGeometry",this.primitiveType=e.WebGLConstants.TRIANGLES,this.setData(t);}setData(t){super.setData({}),this.near=t.near,this.far=t.far,this.frustumType=t.type,this.position=new e.Vector3,this.quaternion=new e.Quaternion,this.camera=t,this._usedDoublePrecision=!1,this._vertexArray?(this._vertexArray.clear(),this._indices.clear()):(this._vertexArray=this._usedDoublePrecision?new e.StructArrayLayout11f44:new e.StructArrayLayout3f2f3f32,this._indices=new e.StructArrayLayout3ui6),this.numberOfPlanes=6,this.parse(),this.computeBoundingSphere(),this.computeBoundingBox();}parse(){let e=new Float64Array(72);e=this.computeNearFarPlanes(this.position,this.quaternion,this.frustumType,this.camera,e),e=this.computerOthersPlans(e),this.vertices=e,this.computerNormalAndUvAndIndices();for(let e=0;e<this.indices.length;e+=3)this._indices.emplaceBack(this.indices[e],this.indices[e+2],this.indices[e+1]);this.emplaceVertexBufferTriangle(),this.needUpdate=!0;}computeNearFarPlanes(t,i,s,r,n,o,a,l){const h=new e.Matrix3,_=new e.Matrix4,c=new e.Matrix4;this.scratchXDirection=new e.Vector3,this.scratchYDirection=new e.Vector3,this.scratchZDirection=new e.Vector3;const u=new Array(3),d=new Array(4);d[0]=new e.Vector4(-1,-1,1,1),d[1]=new e.Vector4(1,-1,1,1),d[2]=new e.Vector4(1,1,1,1),d[3]=new e.Vector4(-1,1,1,1);const m=(new e.Matrix3).fromQuaternion(i,h);let p=e.defaultValue(o,this.scratchXDirection),f=e.defaultValue(a,this.scratchYDirection),g=e.defaultValue(l,this.scratchZDirection);p=e.Matrix3.getColumn(m,0,p),f=e.Matrix3.getColumn(m,1,f),g=e.Matrix3.getColumn(m,2,g),e.Vector3.normalize(p,p),e.Vector3.normalize(f,f),e.Vector3.normalize(g,g),e.Vector3.negate(p,p),e.Vector3.negate(g,g);const y=e.Matrix4.computeView(t,g,f,p,_),C=new Array(4);for(let t=0;t<4;++t)C[t]=new e.Vector4;let T,x;if("PerspectiveCamera"===this.frustumType){const t=e.Matrix4.multiply(c,y,r.frustumCrate.frustum.projectionMatrix);x=e.Matrix4.inverse(t,c);}else "OrthographicCamera"===this.frustumType&&(T=e.Matrix4.inverseTransformation(y,c));e.defined(x)?(u[0]=this.near,u[1]=this.far):(u[0]=0,u[1]=this.near,u[2]=this.far);for(let i=0;i<2;++i)for(let s=0;s<4;++s){let o=e.Vector4.clone(d[s],C[s]);if(e.defined(x)){o=e.Matrix4.multiplyByVector(x,o,o),e.Vector3.multiplyByScalar(o,1/o.w,o),e.Vector3.subtract(o,t,o),e.Vector3.normalize(o,o);const s=e.Vector3.dot(g,o);e.Vector3.multiplyByScalar(o,u[i]/s,o),e.Vector3.add(o,t,o);}else {e.defined(r.frustumCrate.frustum._offCenterFrustum)&&(r.frustumCrate.frustum=r.frustumCrate.frustum._offCenterFrustum);const t=u[i],s=u[i+1];o.x=.5*(o.x*(r.frustumCrate.frustum.right-r.frustumCrate.frustum.left)+r.frustumCrate.frustum.left+r.frustumCrate.frustum.right),o.y=.5*(o.y*(r.frustumCrate.frustum.top-r.frustumCrate.frustum.bottom)+r.frustumCrate.frustum.bottom+r.frustumCrate.frustum.top),o.z=.5*(o.z*(t-s)-t-s),o.w=1,e.Matrix4.multiplyByVector(T,o,o);}n[12*i+3*s]=o.x,n[12*i+3*s+1]=o.y,n[12*i+3*s+2]=o.z;}return n}computerOthersPlans(e){let t=24;return e[t]=e[12],e[t+1]=e[13],e[t+2]=e[14],e[t+3]=e[0],e[t+4]=e[1],e[t+5]=e[2],e[t+6]=e[9],e[t+7]=e[10],e[t+8]=e[11],e[t+9]=e[21],e[t+10]=e[22],e[t+11]=e[23],t+=12,e[t]=e[15],e[t+1]=e[16],e[t+2]=e[17],e[t+3]=e[3],e[t+4]=e[4],e[t+5]=e[5],e[t+6]=e[0],e[t+7]=e[1],e[t+8]=e[2],e[t+9]=e[12],e[t+10]=e[13],e[t+11]=e[14],t+=12,e[t]=e[3],e[t+1]=e[4],e[t+2]=e[5],e[t+3]=e[15],e[t+4]=e[16],e[t+5]=e[17],e[t+6]=e[18],e[t+7]=e[19],e[t+8]=e[20],e[t+9]=e[6],e[t+10]=e[7],e[t+11]=e[8],t+=12,e[t]=e[6],e[t+1]=e[7],e[t+2]=e[8],e[t+3]=e[18],e[t+4]=e[19],e[t+5]=e[20],e[t+6]=e[21],e[t+7]=e[22],e[t+8]=e[23],e[t+9]=e[9],e[t+10]=e[10],e[t+11]=e[11],e}getAttributes(t,i,s,r,n,o,a,l){const h=t/3*2;for(let n=0;n<4;++n)e.defined(i)&&(i[t]=o.x,i[t+1]=o.y,i[t+2]=o.z),e.defined(s)&&(s[t]=a.x,s[t+1]=a.y,s[t+2]=a.z),e.defined(r)&&(r[t]=l.x,r[t+1]=l.y,r[t+2]=l.z),t+=3;n[h]=0,n[h+1]=0,n[h+2]=1,n[h+3]=0,n[h+4]=1,n[h+5]=1,n[h+6]=0,n[h+7]=1;}computerNormalAndUvAndIndices(){const t=new Float32Array(12*this.numberOfPlanes),i=new Float32Array(12*this.numberOfPlanes),s=new Float32Array(12*this.numberOfPlanes),r=new Float32Array(8*this.numberOfPlanes),n=this.scratchXDirection,o=this.scratchYDirection,a=this.scratchZDirection,l=new e.Vector3,h=new e.Vector3,_=new e.Vector3,c=e.Vector3.negate(n,l),u=e.Vector3.negate(o,h),d=e.Vector3.negate(a,_);let m=0;this.getAttributes(m,t,i,s,r,a,c,o),m+=12,this.getAttributes(m,t,i,s,r,c,d,o),m+=12,this.getAttributes(m,t,i,s,r,u,d,c),m+=12,this.getAttributes(m,t,i,s,r,n,a,o),m+=12,this.getAttributes(m,t,i,s,r,o,a,c),this.indices=new Uint16Array(6*this.numberOfPlanes),this.normals=t,this.uvs=r;for(let e=0;e<this.numberOfPlanes;++e){const t=6*e,i=4*e;this.indices[t]=i,this.indices[t+1]=i+1,this.indices[t+2]=i+2,this.indices[t+3]=i,this.indices[t+4]=i+2,this.indices[t+5]=i+3;}}update(t){if(this.needUpdate&&t.painter){this.needUpdate=!1;const i=t.painter.context;this._vertBuffer&&this._indexBuffer?(this._vertBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indices)):(this._vertBuffer=i.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?e.layout.members:e.layout$1.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indices,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/3);}}serialize(){return {type:this.type,camera:this.camera.serialize()}}destroy(){super.destroy(),this.needUpdate=null,this.indices=null,this.vertices=null,this.uvs=null,this.vertices=null;}}class pf extends e.Geometry{constructor(t){super({}),this.type="FrustumOutlineGeometry",this.primitiveType=e.WebGLConstants.LINES,this.setData(t);}setData(t){super.setData({}),this.frustumType=t.type,this.position=new e.Vector3,this.quaternion=new e.Quaternion,this.camera=t,this.numberOfPlanes=6,this.vertices=new Float64Array(24),this.indices=new Uint16Array(24),this._usedDoublePrecision=!1,this._vertexArray?(this._vertexArray.clear(),this._indices.clear()):(this._vertexArray=this._usedDoublePrecision?new e.StructArrayLayout3f3f24:new e.StructArrayLayout3f12,this._indices=new e.StructArrayLayout2ui4),this.needUpdate=!0,this.parse(),this.computeBoundingSphere(),this.computeBoundingBox();}parse(){this._computeNearFarPlanes(),this._computeIndices(),this._createStructArray();}update(t){if(this.needUpdate&&t.painter){this.needUpdate=!1;const i=t.painter.context;this._vertBuffer&&this._indexBuffer?(this._vertBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indices)):(this._vertBuffer=i.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?Yu.members:Qu.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indices,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/2);}}_createStructArray(){this.emplaceVertexBufferOfLines();for(let e=0;e<this.indices.length;e+=2)this._indices.emplaceBack(this.indices[e],this.indices[e+1]);}_computeNearFarPlanes(){const t=new e.Matrix3,i=(new e.Matrix3).fromQuaternion(this.quaternion,t),s=new e.Matrix4,r=new Array(4);r[0]=new e.Vector4(-1,-1,1,1),r[1]=new e.Vector4(1,-1,1,1),r[2]=new e.Vector4(1,1,1,1),r[3]=new e.Vector4(-1,1,1,1);const n=new Array(4);for(let t=0;t<4;++t)n[t]=new e.Vector4;let o=new e.Vector3,a=new e.Vector3,l=new e.Vector3;o=e.Matrix3.getColumn(i,0,o),a=e.Matrix3.getColumn(i,1,a),l=e.Matrix3.getColumn(i,2,l),e.Vector3.normalize(o,o),e.Vector3.normalize(a,a),e.Vector3.normalize(l,l),e.Vector3.negate(o,o),e.Vector3.negate(l,l);const h=e.Matrix4.computeView(this.position,l,a,o,new e.Matrix4);let _,c;if("PerspectiveCamera"===this.frustumType){const t=e.Matrix4.multiply(s,this.camera.frustumCrate.frustum.projectionMatrix,h);c=e.Matrix4.inverse(t,s);}else _=e.Matrix4.inverseTransformation(h,s);const u=new Array(3);e.defined(c)?(u[0]=this.camera.near,u[1]=this.camera.far):(u[0]=0,u[1]=this.camera.near,u[2]=this.camera.far);for(let t=0;t<2;++t)for(let i=0;i<4;++i){let s=e.Vector4.clone(r[i],n[i]);if(e.defined(c)){s=e.Matrix4.multiplyByVector(c,s,s),e.Vector3.multiplyByScalar(s,1/s.w,s),e.Vector3.subtract(s,this.position,s),e.Vector3.normalize(s,s);const i=e.Vector3.dot(l,s);e.Vector3.multiplyByScalar(s,u[t]/i,s),e.Vector3.add(s,this.position,s);}else {e.defined(this.camera.frustumCrate.frustum._offCenterFrustum)&&(this.camera.frustumCrate.frustum=this.camera.frustumCrate.frustum._offCenterFrustum);const i=u[t],r=u[t+1];s.x=.5*(s.x*(this.camera.frustumCrate.frustum.right-this.camera.frustumCrate.frustum.left)+this.camera.frustumCrate.frustum.left+this.camera.frustumCrate.frustum.right),s.y=.5*(s.y*(this.camera.frustumCrate.frustum.top-this.camera.frustumCrate.frustum.bottom)+this.camera.frustumCrate.frustum.bottom+this.camera.frustumCrate.frustum.top),s.z=.5*(s.z*(i-r)-i-r),s.w=1,e.Matrix4.multiplyByVector(_,s,s);}this.vertices[12*t+3*i]=s.x,this.vertices[12*t+3*i+1]=s.y,this.vertices[12*t+3*i+2]=s.z;}}_computeIndices(){let e,t,i=0;for(;i<2;++i)e=8*i,t=4*i,this.indices[e]=t,this.indices[e+1]=t+1,this.indices[e+2]=t+1,this.indices[e+3]=t+2,this.indices[e+4]=t+2,this.indices[e+5]=t+3,this.indices[e+6]=t+3,this.indices[e+7]=t;for(i=0;i<2;++i)e=8*(2+i),t=4*i,this.indices[e]=t,this.indices[e+1]=t+4,this.indices[e+2]=t+1,this.indices[e+3]=t+5,this.indices[e+4]=t+2,this.indices[e+5]=t+6,this.indices[e+6]=t+3,this.indices[e+7]=t+7;}serialize(){return {type:this.type,camera:this.camera.serialize()}}destroy(){super.destroy(),this.frustumType=void 0,this.position=void 0,this.quaternion=void 0,this.camera=void 0,this.type=void 0,this.primitiveType=void 0,this.numberOfPlanes=void 0,this.vertices=void 0,this.indices=void 0,this._vertexArray=void 0,this._indices=void 0,this.needUpdate=void 0;}}const ff=new Uint32Array(1);class gf extends e.Evented{constructor(t){if(super(),this.videoTextureFun=t.videoTextureFun,!t.location)throw new Error("location is null!");if(!Array.isArray(t.location))throw new Error("location is not array!");if(this._location=[parseFloat(t.location[0]),parseFloat(t.location[1])],this.altitude=e.defaultValue(parseFloat(t.altitude),60),this._oldAltitude=this._altitude,this._aspect=e.defaultValue(t.aspect,e.window.document.body.clientWidth/e.window.document.body.clientHeight),this._oldAspect=this._aspect,this._fov=e.defaultValue(t.fov,45),this._oldFov=this._fov,this._near=e.defaultValue(t.near,.1),this._oldNear=this._near,this._far=e.defaultValue(t.far,this._altitude+100),this._oldFar=this._far,this._alpha=e.defaultValue(t.alpha,1),this._enabled=e.defaultValue(t.enabled,!0),this._visible=!1,this.uniqueId=(ff[0]++,ff[0]),this._heading=e.defaultValue(t.heading,0),this._oldHeading=this._heading,this._pitch=e.defaultValue(t.pitch,0),this._oldPitch=this._pitch,this._roll=e.defaultValue(t.roll,0),this._oldRoll=this._roll,this.videoTexture=void 0,this.customOptions=t.customOptions,this._videoManager=void 0,this._clip=e.defaultValue(t.clip,!0),this._clipColor=this._getColor(),this._clipRegions=e.defaultValue([t.clipRegions],[]),this._shouldAddClipRegion=this._clipRegions.length>0,this._camTransformMatrix=void 0,this._debugVideo=!1,this.debugVideo=e.defaultValue(t.debugVideo,!1),this._debugFrustum=void 0,this._debugFrustumOutline=void 0,t.minzoom>t.maxzoom)throw new Error("minzoom must be less than maxzoom");this._minzoom=e.defaultValue(t.minzoom,0),this._maxzoom=e.defaultValue(t.maxzoom,22),this._used3DModel=e.defaultValue(t.used3DModel,!0),this._used3DTiles=e.defaultValue(t.used3DTiles,!0),this._usedPolygon=e.defaultValue(t.usedPolygon,!0),this._usedRaster=e.defaultValue(t.usedRaster,!0);const i=e.defaultValue(t.callback,(()=>{}));this.on("visible",i),this._perspectiveCamera=new a(this._fov,this._aspect,this._near,this._far),this.videoMatrix=void 0,this._computerMatrix();}get alpha(){return this._alpha}set alpha(t){e.isNumber(t)&&(this._alpha=t);}get altitude(){return this._altitude}set altitude(t){e.isNumber(t)&&(this._altitude=t);}get aspect(){return this._aspect}set aspect(t){e.isNumber(t)&&(this._aspect=t);}get enabled(){return this._enabled}set enabled(t){e.isBoolean(t)&&(this._enabled=t),e.defined(this._debugFrustum)&&(this._debugFrustum.show=t,this._debugFrustumOutline.show=t);}get far(){return this._far}set far(t){e.isNumber(t)&&(this._far=t);}get fov(){return this._fov}set fov(t){e.isNumber(t)&&(this._fov=t);}get heading(){return this._heading}set heading(t){e.isNumber(t)&&(this._heading=t);}get location(){return this._location}set location(e){Array.isArray(e)&&(this._location=e);}get near(){return this._near}set near(t){e.isNumber(t)&&(this._near=t);}get pitch(){return this._pitch}set pitch(t){e.isNumber(t)&&(this._pitch=t);}get roll(){return this._roll}set roll(t){e.isNumber(t)&&(this._roll=t);}get used3DModel(){return this._used3DModel}set used3DModel(t){e.isBoolean(t)&&(this._used3DModel=t);}get used3DTiles(){return this._used3DTiles}set used3DTiles(t){e.isBoolean(t)&&(this._used3DTiles=t);}get usedPolygon(){return this._usedPolygon}set usedPolygon(t){e.isBoolean(t)&&(this._usedPolygon=t);}get usedRaster(){return this._usedRaster}set usedRaster(t){e.isBoolean(t)&&(this._usedRaster=t);}get visible(){return this._visible}get minzoom(){return this._minzoom}set minzoom(t){e.isNumber(t)&&(this._minzoom=t);}get maxzoom(){return this._maxzoom}set maxzoom(t){e.isNumber(t)&&(this._maxzoom=t);}_limitZoom(e){const t=e.style.getNearestTileZoom();return t<=this._maxzoom&&t>=this._minzoom}update(t,i){this._limitZoom(t)&&this._enabled&&(e.defined(this._videoManager)||(this._videoManager=i),this._shouldAddClipRegion&&(this.removeClipRegion(),this._videoManager._clipManager.add({positions:this._clipRegions,uniqueId:this.uniqueId,clipColor:this._clipColor}),this._shouldAddClipRegion=!1,this._clipRegions=[]),this._updateTransform(t),this._updateVisibility(t),this._updateVideoTexture(t),this.debugVideo!==this._debugVideo&&(this.debugVideo?this._addDebugVideo(t):this._removeDebugVideo(t),this._debugVideo=this.debugVideo),e.defined(this._debugFrustum)&&e.defined(t.frameState.camera)&&(this._debugFrustum.update(t,t.frameState),this._debugFrustumOutline.update(t,t.frameState)));}_addDebugVideo(t){this._debugFrustum=new e.Primitive({geometry:new mf(this._perspectiveCamera),material:e.StandardMaterial.fromType("Color",{color:new e.Color(0,1,1,.1)}),name:`debugVideo_${this.uniqueId}`,modelMatrix:this._camTransformMatrix}),t.style.addPrimitive(this._debugFrustum),this._debugFrustumOutline=new e.Primitive({geometry:new pf(this._perspectiveCamera),material:e.StandardMaterial.fromType("Color",{color:new e.Color(1,0,0,1),lightingModel:e.LightingModelType.NONE}),name:`debugVideo_${this.uniqueId}`,modelMatrix:this._camTransformMatrix}),t.style.addPrimitive(this._debugFrustumOutline);}_removeDebugVideo(e){e.style.removePrimitive(this._debugFrustum),this._debugFrustum=void 0,e.style.removePrimitive(this._debugFrustumOutline),this._debugFrustumOutline=void 0;}addClipRegion(e){if(!(e instanceof Array))throw new Error("请正确添加视频裁剪区域位置数组！");this._clipRegions.push(e),this._shouldAddClipRegion=!0;}getClipRegion(){return e.defined(this._videoManager)?this._videoManager._clipManager.getByName(this.uniqueId):[]}removeClipRegion(){e.defined(this._videoManager)?this._videoManager._clipManager.removeByName(this.uniqueId):(this._clipRegions=[],this._shouldAddClipRegion=!1);}positioning(e,t){if(!Array.isArray(e))throw new Error("请输入正确视频点坐标!");if(!Array.isArray(t))throw new Error("请输入正确球面点坐标!");const i=parseFloat(t[0]-e[0]),s=parseFloat(t[1]-e[1]);this.location=[this.location[0]+i,this.location[1]+s];}_updateTransform(e){this._location===this._oldLocation&&this._heading===this._oldHeading&&this._pitch===this._oldPitch&&this._roll===this._oldRoll&&this._fov===this._oldFov&&this._altitude===this._oldAltitude&&this._near===this._oldNear&&this._far===this._oldFar&&this._aspect===this._oldAspect||(this._computerMatrix(),this._debugFrustum&&(this._fov!==this._oldFov||this._aspect!==this._oldAspect||this._near!==this._oldNear||this._far!==this._oldFar?(this._removeDebugVideo(e),this._addDebugVideo(e)):(this._debugFrustum.setMatrix(this._camTransformMatrix),this._debugFrustum.updateMatrixWorld(!0),this._debugFrustumOutline.setMatrix(this._camTransformMatrix),this._debugFrustumOutline.updateMatrixWorld(!0))),this._oldLocation=this._location,this._oldHeading=this._heading,this._oldPitch=this._pitch,this._oldRoll=this._roll,this._oldLocation=this._location,this._oldAltitude=this._altitude,this._oldFov=this._fov,this._oldAspect=this._aspect,this._oldNear=this._near,this._oldFar=this._far);}_computerMatrix(){const t=e.Vector3.fromDegrees(this.location[0],this.location[1],this.altitude);this._camTransformMatrix=e.Transforms.headingPitchRollToFixedFrame(t,new e.HeadingPitchRoll(e.CONSTS.CesiumMath.toRadians(this.heading),e.CONSTS.CesiumMath.toRadians(this.pitch),e.CONSTS.CesiumMath.toRadians(this.roll))),this.cartographic=new e.Vector3(this._camTransformMatrix[12],this._camTransformMatrix[13],this._camTransformMatrix[14]);const i=this._camTransformMatrix.clone();i[12]=0,i[13]=0,i[14]=0,i.invert(),this.videoMatrix=(new e.Matrix4).perspective({fov:this.fov*e.CONSTS.TRANSFORM.DEG_TO_RAD,aspect:this.aspect,near:this.near,far:this.far}).multiplyRight(i),this._perspectiveCamera.updatePerspectiveOptions({fov:this._fov,aspect:this._aspect,near:this._near,far:this.far}),this._perspectiveCamera.setMatrix(this._camTransformMatrix.clone());const s=[],r=(new e.Quaternion).fromHeadingPitchRoll(new e.HeadingPitchRoll(e.CONSTS.CesiumMath.toRadians(this.heading),e.CONSTS.CesiumMath.toRadians(this.pitch),e.CONSTS.CesiumMath.toRadians(this.roll))),n=new mf(this._perspectiveCamera);n.computeNearFarPlanes(this._perspectiveCamera.position,r,"PerspectiveCamera",this._perspectiveCamera,s),n.computerOthersPlans(s);const o=[];for(let t=0;t<s.length;t+=3)o.push(e.Vector3.unpack(s,t));this._boundingSphere=e.OrientedBoundingBox.fromPoints(o);}_updateVisibility(t){const i=-1!==t.transform.activeCamera.frustumCrate.cullingVolume.computeVisibility(this._boundingSphere);this._visible!==i&&(this._visible=i,this.fire(new e.Event("visible")));}_updateVideoTexture(t){if(e.defined(this.videoTexture)||(this.videoTexture=new e.Texture({context:t.context,image:void 0,pixelFormat:e.WebGLConstants.RGBA})),e.defined(this.videoTextureFun)&&this._enabled){const t=this.videoTextureFun();e.defined(t)&&0!==t.videoHeight&&0!==t.videoWidth&&(this.videoTexture.upload(t),this.videoTexture._hasSetSampler=!1,this.videoTexture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE));}}_getColor(){const t=e.Color.fromRgba(this.uniqueId);return t.a=1,t}destroy(){this._location=void 0,this._altitude=void 0,this._oldAltitude=void 0,this._aspect=void 0,this._oldAspect=void 0,this._fov=void 0,this._oldFov=void 0,this._near=void 0,this._oldNear=void 0,this._far=void 0,this._oldFar=void 0,this._alpha=void 0,this._enabled=void 0,this.uniqueId=void 0,this._heading=void 0,this._oldHeading=void 0,this._pitch=void 0,this._oldPitch=void 0,this._roll=void 0,this._oldRoll=void 0;}}class yf{constructor(e){this._clipRegions=[],this._clipPrimitives=[],this._painter=void 0,this._videoManager=e.videoManager;}get length(){return this._clipPrimitives.length}add(e){this._clipRegions.push(e);}remove(e){const t=this.indexOf(e);return -1!==t&&(this.removeByIndex(t),!0)}removeByName(e){const t=this.getByName(e);if(t.length>0)for(let e=0;e<t.length;e++)this.remove(t[e]);}removeByIndex(t){const i=this.getByIndex(t);e.defined(i)&&(this._clipPrimitives.splice(t,1),this.removePrimitiveFromScene(i));}removeAll(){for(let e=this._clipPrimitives.length;e>=0;e--)this.remove(this._clipPrimitives[e-1]);}removePrimitiveFromScene(e){this._painter&&(this._painter.style.removePrimitiveForPreRender(e),e.destroy());}indexOf(e){return this._clipPrimitives.indexOf(e)}getByName(e){const t=[];return this._clipPrimitives.forEach((i=>{i.name===e&&t.push(i);})),t}getByIndex(e){return this._clipPrimitives[e]}getAll(){return this._clipPrimitives}createPrimitives(){for(let e=0;e<this._clipRegions.length;e++)this.createPrimitive(this._clipRegions.splice(0,1)[0]);}_updateExtraCamera(){if(0===this._clipPrimitives.length)return;const t=this._painter,i=this._clipPrimitives,s=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];let n=0;for(let o=0;o<i.length;o++){const a=i[o];if(t.frameState.camera.frustumCrate.cullingVolume.computeVisibility(a.boundingBox)==e.INTERSECTION.OUTSIDE)continue;n++;const l=a.boundingBox.getBoundingMaximum(),h=l.boundingMinValue,_=l.boundingMaxValue;h[0]<s[0]&&(s[0]=h[0]),h[1]<s[1]&&(s[1]=h[1]),h[2]<s[2]&&(s[2]=h[2]),_[0]>r[0]&&(r[0]=_[0]),_[1]>r[1]&&(r[1]=_[1]),_[2]>r[2]&&(r[2]=_[2]);}if(0===n)return;const o=[(s[0]+r[0])/2,(s[1]+r[1])/2,(s[2]+r[2])/2];1===n&&(s[0]-=2*(o[0]-s[0]),s[1]-=2*(o[1]-s[1]),s[2]-=2*(o[2]-s[2]),r[0]+=2*(r[0]-o[0]),r[1]+=2*(r[1]-o[1]),r[2]+=2*(r[2]-o[2]));const a=Math.max(r[0]-s[0],r[1]-s[1],r[2]-s[2]),h=new l(a,t.style.symbolMatrixHelper.width/t.style.symbolMatrixHelper.height,1,1e4),_=e.Transforms.cartesian3ToCartographic(o),c=e.Transforms.cartographicToCartesian3([_[0],_[1],_[2]+50]),u=e.Transforms.localFrameToFixedFrame(c);h.setMatrix(u);for(let e=0;e<i.length;e++)i[e]._material._extraCamera=h;this._extraCameraOfOrthographic=h;}createPrimitive(t){if(e.defined(t.positions)&&Array.isArray(t.positions[0])){const i=new e.Primitive({geometry:new e.PolygonGeometry({polygonHierarchy:{positions:e.Vector3.fromDegreesArrayHeights(t.positions[0])}}),material:e.StandardMaterial.fromType("Color",{color:t.clipColor,lightingModel:e.LightingModelType.NONE}),framebuffer:this._videoManager._clipFill.framebuffer.framebuffer,name:t.uniqueId});i.visible=!1,this._painter.style.addPrimitiveForPreRender(i),this._clipPrimitives.push(i);}}update(t){let i;e.defined(this._painter)||(this._painter=t),this._clipRegions.length>0&&this.createPrimitives(),this._updateExtraCamera();for(let t=0;t<this._clipPrimitives.length;t++)i=0===t?{color:new e.Color(0,0,0,1),depth:1,stencil:0}:void 0,this._clipPrimitives[t].clearStates=i;}destroy(){this._painter=void 0;}}class Cf{constructor(){this._videos=[],this._videoModelMaterial=new df(this,"3DModel"),this._videoRasterMaterial=new df(this,"Raster"),this._videoTilesMaterial=new df(this,"3DTiles"),this._videoPolygonMaterial=new df(this,"Polygon"),this._enabled=!0,this._maxUsedVideoUnit=0,this._enabledClip=!0,this._clipManager=new yf({videoManager:this}),this._clipFill=new dp,this._projectionMatrix=void 0;}get enabled(){return this._enabled}set enabled(t){if(e.isBoolean(t)){this._enabled=t;for(let e=0;e<this.length;e++)this._videos[e].enabled=t;}}get enableClip(){return this._enabledClip}set enableClip(t){e.isBoolean(t)&&(this._enabledClip=t);}get length(){return this._videos.length}get enabledLength(){let e=0;for(let t=0;t<this._videos.length;t++)this._videos[t].enabled&&e++;return e}add(t,i){if(!(t instanceof gf))return console.error("当前添加的不是视频文件，请检查！"),!1;const s=e.defined(i);if(s){if(i<0)throw new Error("index must be greater than or equal to zero.");if(i>this._videos.length)throw new Error("index must be less than or equal to the number of videos.")}return s?this._videos.splice(i,0,t):this._videos.push(t),!0}lower(e){const t=this.indexOf(e);this._swapLayers(t,t-1);}raise(e){const t=this.indexOf(e);this._swapLayers(t,t+1);}_swapLayers(t,i){const s=this._videos;if((t=e.clamp(t,0,s.length-1))===(i=e.clamp(i,0,s.length-1)))return;const r=s[t];s[t]=s[i],s[i]=r;}remove(e){const t=this.indexOf(e);return -1!==t&&(e.removeClipRegion(),this._videos.splice(t,1),!0)}removeById(e){const t=this.getById(e);this.remove(t);}removeAll(){for(let e=0;e<this.length;e++)this.getByIndex(e).removeClipRegion();this._videos=[],this._videoModelMaterial.empty();}removeAllClipRegions(){this._clipManager.removeAll();}getById(e){let t;return this._videos.forEach((i=>{i.uniqueId===e&&(t=i);})),t}getByIndex(e){return this._videos[e]}getAll(){return this._videos}contains(e){return -1!==this.indexOf(e)}containsById(e){return -1!==this.getById(e)}indexOf(e){return this._videos.indexOf(e)}indexOfById(e){return this.containsById(e)?this.indexOf(this.getById(e)):-1}update(e){if(this._videoModelMaterial.removeUniforms(),this._videoRasterMaterial.removeUniforms(),this._videoTilesMaterial.removeUniforms(),this._videoPolygonMaterial.removeUniforms(),!this._enabled||this.length<1)return;this._clipManager.update(e),this._updateClipRegionsVisibility(e),this._clipFill.update(e),this._calculateMaxTextureUnits(e);const t=this.length;for(let i=0;i<t;i++)this.getByIndex(i).update(e,this);this._videoModelMaterial.update(e),this._videoRasterMaterial.update(e),this._videoTilesMaterial.update(e),this._videoPolygonMaterial.update(e);}clear3DModel(){this._videoModelMaterial.removeUniforms(),!this._enabled||this.length<1||(this._videoModelMaterial._usedVideos=[]);}update3DModel(e){!this._enabled||this.length<1||this._videoModelMaterial.select3DModel(e);}clear3DTiles(){this._videoTilesMaterial.removeUniforms(),!this._enabled||this.length<1||(this._videoTilesMaterial._usedVideos=[]);}update3DTiles(e){!this._enabled||this.length<1||this._videoTilesMaterial.select3DTiles(e);}_calculateMaxTextureUnits(t){let i,s,r,n=[],o=0,a=0,l=0,h=0;for(let _=0;_<t.style._order.length;_++){if(i=t.style._layers[t.style._order[_]],s=t.style.sourceCaches[i.source],"raster"===i.type){if(s&&s.getVisibleCoordinates){n=s.getVisibleCoordinates(!1),r=i.id;for(let i=0;i<n.length;i++){const s=t.rasterPlotter._drawCommands.get(r),a=s?s.get(n[i].key):void 0;if(void 0!==a){const t=a._material._uniforms.entries();for(;;){const i=t.next();if(i.done)break;const s=i.value[0],r=i.value[1]();r instanceof e.Texture?h++:r instanceof Array&&r[0]instanceof e.Texture&&"u_VideoSampler"!==s&&(h+=r.length);}o=Math.max(o,h);break}}}}else if("3d-tiles"===i.type){const t=s.tileset3d;if(e.defined(t)){const i=t.selectedTiles;let s=[];for(let e=0;e<i.length;e++){let t=[];"cmpt"===i[e].content.type?i[e].content.tiles.forEach((e=>{t=t.concat(e.gltf.meshes);})):t=t.concat(i[e].content.gltf.meshes);for(let e=0;e<t.length;e++)s=s.concat(t[e].primitives);}if(e.defined(s))for(let t=0;t<s.length;t++)if(void 0!==s[t]&&e.defined(s[t]._material.pickColor)){const i=s[t]._material._uniforms.entries();for(;;){const t=i.next();if(t.done)break;const s=t.value[0],r=t.value[1];if(r instanceof Function){const t=r();t instanceof e.Texture?h++:t instanceof Array&&t[0]instanceof e.Texture&&"u_VideoSampler"!==s&&(h+=t.length);}}a=Math.max(a,h);break}}}else if("3d-model"===i.type){let t=[];for(let e=0;e<s._glTFTiles.length;e++)t=t.concat(s._glTFTiles[0].primitives);for(let i=0;i<t.length;i++)if(void 0!==t[i]&&e.defined(t[i]._material.pickColor)){const s=t[i]._material._uniforms.entries();for(;;){const t=s.next();if(t.done)break;const i=t.value[0],r=t.value[1];if(r instanceof Function){const t=r();t instanceof e.Texture?h++:t instanceof Array&&t[0]instanceof e.Texture&&"u_VideoSampler"!==i&&(h+=t.length);}}l=Math.max(l,h);break}}h=0;}const _=Math.max(o,a,l),c=t.context.gl.getParameter(e.WebGLConstants.MAX_TEXTURE_IMAGE_UNITS)-_;this._maxUsedVideoUnit=c;}_updateClipRegionsVisibility(t){e.defined(t.frameState.camera)&&this._clipManager._extraCameraOfOrthographic&&(this._projectionMatrix=this._clipManager._extraCameraOfOrthographic.getVPMatrix().clone());}serialize(){const e=[];for(let t=0;t<this.length;t++){const i=this.getByIndex(t);e[t]={location:i.location,altitude:i.altitude,aspect:i.aspect,fov:i.fov,alpha:i.alpha,heading:i.heading,pitch:i.pitch,roll:i.roll,near:i.near,enabled:i.enabled,far:i.far,customOptions:i.customOptions,minzoom:i.minzoom,maxzoom:i.maxzoom,used3DModel:i.used3DModel,used3DTiles:i.used3DTiles,usedRaster:i.usedRaster,usedPolygon:i.usedPolygon,debugVideo:i.debugVideo};}return e.length>0?e:void 0}}class Tf{constructor(){this.mViewshedVisibleColor=new e.Vector3(0,0,0),this.mViewshedInVisibleColor=new e.Vector3(0,0,0),this.mViewshedVisibleDefaultColor=new e.Vector3(0,1,0),this.mViewshedInVisibleDefaultColor=new e.Vector3(1,0,0),this.mCurNodeCountRender=0,this.mSceneLightDir3=new e.Vector3(0,0,1),this.shadowOff=.0025,this.shadowMapInvScale=.3,this.mShadowCenter=new e.Vector3,this.mShadowCenterLocal=new e.Vector3,this.mShadowCenterMode=!1,this.globalInnerColor=new e.Vector4(41/255,52/255,71/255,8),this.globalOuterColor=new e.Vector4(166/255,184/255,213/255,0),this.globalOuterPara=new e.Vector4(543146,2.3,6,0),this.globalLightPercent=new e.Vector4(1,.01,3.5,1.2),this.nightGlobalPer=new e.Vector2(.01,.1),this.nightVisible=!0;}getGlobalInnerColor(){return this.globalInnerColor}getGlobalOuterColor(){return this.globalOuterColor}getGlobalLightPercent(){return this.globalLightPercent}setViewshedVisibleColor(e){this.mViewshedVisibleColor.set(e[0],e[1],e[2]);}setViewshedInVisibleColor(e){this.mViewshedInVisibleColor.set(e[0],e[1],e[2]);}setShadowCenterLngLat(t,i){this.mShadowCenterLngLat=t;const s=e.Transforms.cartographicToCartesian3([t[0],t[1],0]);this.mShadowCenter.set(s[0],s[1],s[2]),this.mShadowRadius=i;}}class xf{constructor(t){if(t=e.defined(t)?t:{},e.defined(t.geometry)&&!(t.geometry instanceof e.Geometry))throw new Error("Geometry is not valid!");if(this._geometry=e.defaultValue(t.geometry,new e.Geometry({})),e.defined(t.color)&&!(t.color instanceof e.Color)&&"string"!=typeof t.color)throw new Error("Color type must be Color or String!");if(this._color=e.Color.parse(e.defaultValue(t.color,new e.Color(1,0,0,.3))),e.defined(t.opacity)&&!e.isNumber(t.opacity))throw new Error("'opacity' option must be a number!");if(this._opacity=e.defaultValue(t.opacity,1),e.defined(t.modelMatrix)&&!(t.modelMatrix instanceof e.Matrix4))throw new Error("'modelMatrix' is not valid");if(this._modelMatrix=e.defaultValue(t.modelMatrix,e.Matrix4.IDENTITY),e.defined(t.enabled)&&!e.isBoolean(t.enabled))throw new Error("'enabled' option must be true or false!");this._enabled=e.defaultValue(t.enabled,!0),this._initialized=!1,this._geometryUpdated=!1,this._colorUpdated=!1,this._opacityUpdated=!1,this._modelMatrixUpdated=!1,this.id=e.uuid();}get geometry(){return this._geometry}set geometry(t){if(!(t instanceof e.Geometry))throw new Error("Geometry is not valid!");this._geometry=t,this._geometryUpdated=!1;}get color(){return this._color}set color(t){if(!(t instanceof e.Color||"string"==typeof t))throw new Error("Color type must be Color or String!");this._color=e.Color.parse(t),this._colorUpdated=!1;}get opacity(){return this._opacity}set opacity(t){if(!e.isNumber(t))throw new Error("'opacity' option must be a number!");this._opacity=t,this._opacityUpdated=!1;}get modelMatrix(){return this._modelMatrix}set modelMatrix(t){if(!(t instanceof e.Matrix4))throw new Error("Model matrix is not valid!");this._modelMatrix=t,this._modelMatrixUpdated=!1;}get enabled(){return this._enabled}set enabled(t){if(!e.isBoolean(t))throw new Error("'enabled' option must be true or false!");this._enabled=t;}_initialize(){this._passFrontRenderState={},this._passFrontRenderState.blending=e.renderStateEnum.disableBlending,this._passFrontRenderState.cull=e.renderStateEnum.disableCull,this._passFrontRenderState.depthTest=e.renderStateEnum.enableDepthTest,this._passFrontRenderState.depthRange=e.renderStateEnum.depthRange,this._passFrontRenderState.depthMask=e.renderStateEnum.disableDepthMask,this._passFrontRenderState.stencilTest=e.renderStateEnum.enableClassificationStencilTest,this._passFrontRenderState.stencilMask=e.renderStateEnum.enableStencilMask,this._passFrontRenderState.colorMask=e.renderStateEnum.disabledColorMask,this._passBackRenderState={},this._passBackRenderState.blending=e.renderStateEnum.enableBlending,this._passBackRenderState.cull=e.renderStateEnum.disableCull,this._passBackRenderState.depthTest=e.renderStateEnum.disableDepthTest,this._passBackRenderState.depthRange=e.renderStateEnum.depthRange,this._passBackRenderState.depthMask=e.renderStateEnum.disableDepthMask,this._passBackRenderState.stencilTest=e.renderStateEnum.openClassificationStencilTest,this._passBackRenderState.colorMask=e.renderStateEnum.enableColorMask,this._passBackRenderState.stencilMask=e.renderStateEnum.enableStencilMask,this._material=e.StandardMaterial.fromType("Color",{color:this._color,opacity:this._opacity,lightingModel:e.LightingModelType.NONE,doubleSided:!0}),this._primitive=new e.Primitive({geometry:this._geometry,material:this._material,modelMatrix:this._modelMatrix}),this._initialized=!0,this._geometryUpdated=!0,this._colorUpdated=!0,this._opacityUpdated=!0,this._modelMatrixUpdated=!0;}_updateGeometry(){this._primitive._geometry=this._geometry,this._geometryUpdated=!0;}_updateColor(){this._material.updateProperty({color:this._color}),this._colorUpdated=!0;}_updateOpacity(){this._material.updateProperty({opacity:this._opacity}),this._opacityUpdated=!0;}_updateModelMatrix(){this._primitive.setMatrix(this._modelMatrix),this._primitive.updateMatrixWorld(!0),this._primitive.modelMatrix=this._modelMatrix,this._modelMatrixUpdated=!0;}update(){this._initialized?(this._geometryUpdated||this._updateGeometry(),this._colorUpdated||this._updateColor(),this._opacityUpdated||this._updateOpacity(),this._modelMatrixUpdated||this._updateModelMatrix()):this._initialize();}render(e){this._enabled&&(this._primitive.framebuffer=e.mainPass.framebuffer.framebuffer,this._material.renderState=this._passFrontRenderState,this._primitive.update(e,e.frameState),this._primitive.render(e,{id:"highlightFront"},e.frameState),this._material.renderState=this._passBackRenderState,this._primitive.update(e,e.frameState),this._primitive.render(e,{id:"highlightBack"},e.frameState),this._primitive.framebuffer=null);}destroy(){this._initialized?this._primitive instanceof e.Primitive&&this._primitive.destroy():(this._geometry instanceof e.Geometry&&this._geometry.destroy(),this._material instanceof e.Material&&this._material.destroy()),this._primitive=void 0,this._material=void 0,this._geometry=void 0,this._passFrontRenderState=void 0,this._passBackRenderState=void 0,this._enabled=void 0,this._color=void 0,this._modelMatrix=void 0,this._initialized=void 0,this._geometryUpdated=void 0,this._colorUpdated=void 0,this._opacityUpdated=void 0,this._modelMatrixUpdated=void 0,this.id=void 0;}}const bf=e.CONSTS.CesiumMath;class vf extends e.Geometry{constructor(t){super(t),this.type="PolygonOutlineGeometry",this.primitiveType=e.WebGLConstants.LINES,this.setData(t);}setData(t){if(!e.defined(t.polygonHierarchy)||!e.defined(t.polygonHierarchy.positions))throw new Error("positions must be defined!");if(t.perPositionHeight&&e.defined(t.height))throw new Error("Cannot use both options.perPositionHeight and options.height");if(e.defined(t.arcType)&&t.arcType!==e.ARCTYPE.GEODESIC&&t.arcType!==e.ARCTYPE.RHUMB)throw new Error("Invalid arcType. Valid options are minemap.ARCTYPE.GEODESIC and minemap.ARCTYPE.RHUMB.");if(e.defined(t.perPositionHeight)&&t.perPositionHeight&&e.defined(t.height))throw new Error("Cannot use both options.perPositionHeight and options.height");this._polygonHierarchy=t.polygonHierarchy,this._ellipsoid=e.defaultValue(t.ellipsoid,e.Ellipsoid.WGS84),this._granularity=e.defaultValue(t.granularity,bf.RADIANS_PER_DEGREE),this._perPositionHeight=e.defaultValue(t.perPositionHeight,!1),this._perPositionHeightExtrude=this._perPositionHeight&&e.defined(t.extrudedHeight),this._arcType=e.defaultValue(t.arcType,e.ARCTYPE.GEODESIC),this._referenceCenter=e.defaultValue(t.referenceCenter,new e.Vector3);let i=e.defaultValue(t.height,0),s=e.defaultValue(t.extrudedHeight,i);if(!this._perPositionHeightExtrude){const e=Math.max(i,s);s=Math.min(i,s),i=e;}this._height=i,this._extrudedHeight=s,this.vertices=void 0,this.indices=void 0,this._usedDoublePrecision=!e.defined(t.referenceCenter),this._vertexArray?(this._vertexArray.clear(),this._indices.clear()):(this._vertexArray=this._usedDoublePrecision?new e.StructArrayLayout3f3f24:new e.StructArrayLayout3f12,this._indices=new e.StructArrayLayout2ui4),this._polygonHierarchy.positions.length<3||(this.needUpdate=!0,this._parse(),this.computeBoundingSphere(),this.computeBoundingBox());}_parse(){const t=this._ellipsoid,i=this._granularity,s=this._perPositionHeight,r=this._arcType,n=e.PolygonGeometryLibrary.polygonOutlinesFromHierarchy(this._polygonHierarchy,!s,t);if(0===n.length)return;let o;const a=[],l=bf.chordLength(i,t.maximumRadius),h=this._height,_=this._extrudedHeight;if(this._perPositionHeightExtrude||!bf.equalsEpsilon(h,_,0,bf.EPSILON2))for(let i=0;i<n.length;i++)o=e.PolygonGeometryLibrary.createOutlineGeometryFromPositionsExtruded(t,n[i],l,s,r),o=e.PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(o,h,_,t,s),a.push(o);else for(let i=0;i<n.length;i++)o=e.PolygonGeometryLibrary.createOutlineGeometryFromPositions(t,n[i],l,s,r),o.positions=e.PolygonPipeline.scaleToGeodeticHeight(o.positions,h,t,!s),a.push(o);const c=e.PolygonGeometryLibrary.combineGeometries(a);this.indices=c.indices,this.vertices=e.PolygonPipeline.scaleToGeodeticHeight(c.positions,h,this._ellipsoid,!this._perPositionHeight);for(let e=0;e<this.vertices.length/3;e++)this.vertices[3*e]=this.vertices[3*e]-this._referenceCenter[0],this.vertices[3*e+1]=this.vertices[3*e+1]-this._referenceCenter[1],this.vertices[3*e+2]=this.vertices[3*e+2]-this._referenceCenter[2];this.emplaceVertexBufferOfLines();for(let e=0;e<this.indices.length/2;e++)this._indices.emplaceBack(this.indices[2*e],this.indices[2*e+1]);}update(t){if(this.needUpdate&&t.painter){this.needUpdate=!1;const i=t.painter.context;this._vertBuffer&&this._indexBuffer?(this._vertBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indices)):(this._vertBuffer=i.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?Yu.members:Qu.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indices,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/2);}}serialize(){const t={type:this.type,polygonHierarchy:e.PolygonPipeline.hierarchyPack(this._polygonHierarchy,{}),perPositionHeight:this._perPositionHeight,arcType:this._arcType};return (this._perPositionHeightExtrude||!e.CONSTS.CesiumMath.equalsEpsilon(this._height,this._extrudedHeight,0,e.CONSTS.CesiumMath.EPSILON2))&&(t.extrudedHeight=this._extrudedHeight),this._perPositionHeight||(t.height=this._height),t}destroy(){return super.destroy(),this._polygonHierarchy=void 0,this._ellipsoid=void 0,this._granularity=void 0,this._perPositionHeight=void 0,this._perPositionHeightExtrude=void 0,this._arcType=void 0,this._height=void 0,this._extrudedHeight=void 0,this.vertices=void 0,this.indices=void 0,this._vertexArray=void 0,this._indices=void 0,this.type=void 0,this.primitiveType=void 0,this.needUpdate=void 0,this._vertBuffer=void 0,this._indexBuffer=void 0,this._segmentVector=void 0,this.boundingBox=void 0,this.boundingSphere=void 0,e.destroyObject(this)}}class wf{constructor(t){if(e.defined(t.baseHeight)&&!e.isNumber(t.baseHeight))throw new Error("'baseHeight' must be a number");if(this._baseHeight=e.defaultValue(t.baseHeight,void 0),e.defined(t.minHeight)){if(!e.isNumber(t.minHeight))throw new Error("'minHeight' must be a number");if(t.minHeight>this._baseHeight)throw new Error("'minHeight' must not be bigger than 'baseHeight'")}if(this._minHeight=e.defaultValue(t.minHeight,void 0),e.defined(t.maxHeight)){if(!e.isNumber(t.maxHeight))throw new Error("'maxHeight' must be a number");if(t.maxHeight<this._baseHeight)throw new Error("'maxHeight' must not be smaller than 'baseHeight'")}this._maxHeight=e.defaultValue(t.maxHeight,void 0),this.fillColor=e.defaultValue(t.fillColor,new e.Color(0,1,0,1)),this.fillOpacity=e.defaultValue(t.fillOpacity,.5),this.cutColor=e.defaultValue(t.cutColor,new e.Color(.7,.4,.2,1)),this.cutOpacity=e.defaultValue(t.cutOpacity,.5),this.baseColor=e.defaultValue(t.baseColor,new e.Color(.2,0,1,1)),this.baseOpacity=e.defaultValue(t.baseOpacity,.5),this._baseMaterial=e.StandardMaterial.fromType("Color",{color:this._baseColor,opacity:this._baseOpacity,lightingModel:e.LightingModelType.NONE,doubleSided:!0}),this._baseMaterialUpdated=!1,this.baseOutlineColor=e.defaultValue(t.baseOutlineColor,new e.Color(1,1,1,1)),this.baseOutlineOpacity=e.defaultValue(t.baseOutlineOpacity,1),this._baseOutlineMaterial=e.StandardMaterial.fromType("Color",{color:this._baseOutlineColor,opacity:this._baseOutlineOpacity,lightingModel:e.LightingModelType.NONE,doubleSided:!0}),this.wallColor=e.defaultValue(t.wallColor,new e.Color(0,.7,0,1)),this.wallOpacity=e.defaultValue(t.wallOpacity,.5),this._wallMaterial=e.StandardMaterial.fromType("Color",{color:this._wallColor,opacity:this._wallOpacity,lightingModel:e.LightingModelType.NONE,doubleSided:!0}),this._wallMaterial.renderState.depthMask=!1,this._wallMaterialUpdated=!1,this.wallOutlineColor=e.defaultValue(t.wallOutlineColor,new e.Color(0,0,0,1)),this.wallOutlineOpacity=e.defaultValue(t.wallOutlineOpacity,1),this._wallOutlineMaterial=e.StandardMaterial.fromType("Color",{color:this._wallOutlineColor,opacity:this._wallOutlineOpacity,lightingModel:e.LightingModelType.NONE,doubleSided:!0}),this._wallOutlineMaterialUpdated=!1,this.positions=e.defaultValue(t.positions,[]),this.enabled=e.defaultValue(t.enabled,!0),this.id=e.uuid();}get positions(){return this._positions}set positions(t){if(!(t instanceof Array))throw new Error("positions is not type of Array!");if(0!==t.length&&t.length<3)throw new Error("positions' length must greater than 2!");if(0!==t.length&&!this._baseHeight){let i=0;for(let s=0;s<t.length;s++)i+=e.Cartographic.fromVector3(t[s]).height;i/=t.length,this._baseHeight=i;}this._minHeight||(this._minHeight=this._baseHeight-500),this._maxHeight||(this._maxHeight=this._baseHeight+500),this._positions=t,this._sameHeightPositions=wf.updateHeight(this._positions,this._baseHeight),this._createCutArea(),this._createFillArea(),this._createWall(),this._createBase();}get baseHeight(){return this._baseHeight}set baseHeight(t){if(e.isNumber(t))this._baseHeight=t;else {if(t)throw new Error("baseHeight must be a number or empty");{let i=0;for(let s=0;s<this._positions.length;s++)i+=e.Cartographic.fromVector3(t[s]).height;i/=this._positions.length,this._baseHeight=i;}}this._sameHeightPositions=wf.updateHeight(this._positions,this._baseHeight),this._createCutArea(),this._createFillArea(),this._createWall(),this._createBase();}get minHeight(){return this._minHeight}set minHeight(t){if(!e.isNumber(t))throw new Error("'minHeight' must be a number");if(t>this._baseHeight)throw new Error("'minHeight' must not be bigger than 'baseHeight'");this._minHeight=t,this._createFillArea(),this._createWall();}get maxHeight(){return this._maxHeight}set maxHeight(t){if(!e.isNumber(t))throw new Error("'maxHeight' must be a number");if(t<this._baseHeight)throw new Error("'maxHeight' must not be smaller than 'baseHeight'");this._maxHeight=t,this._createCutArea(),this._createWall();}get fillColor(){return this._fillColor}set fillColor(t){if(!(t instanceof e.Color||"string"==typeof t))throw new Error("'fillColor' type must be Color or String!");this._fillColor=e.Color.parse(t),this._fillHighlight&&(this._fillHighlight.color=this._fillColor);}get fillOpacity(){return this._fillOpacity}set fillOpacity(t){if(!e.isNumber(t))throw new Error("'fillOpacity' option must be a number!");this._fillOpacity=t,this._fillHighlight&&(this._fillHighlight.opacity=this._fillOpacity);}get cutColor(){return this._cutColor}set cutColor(t){if(!(t instanceof e.Color||"string"==typeof t))throw new Error("'cutColor' type must be Color or String!");this._cutColor=e.Color.parse(t),this._cutHighlight&&(this._cutHighlight.color=this._cutColor);}get cutOpacity(){return this._cutOpacity}set cutOpacity(t){if(!e.isNumber(t))throw new Error("'cutOpacity' option must be a number!");this._cutOpacity=t,this._cutHighlight&&(this._cutHighlight.opacity=this._cutOpacity);}get baseColor(){return this._baseColor}set baseColor(t){if(!(t instanceof e.Color||"string"==typeof t))throw new Error("'baseColor' type must be Color or String!");this._baseColor=e.Color.parse(t),this._baseMaterialUpdated=!1;}get baseOpacity(){return this._baseOpacity}set baseOpacity(t){if(!e.isNumber(t))throw new Error("'baseOpacity' option must be a number!");this._baseOpacity=t,this._baseMaterialUpdated=!1;}get baseOutlineColor(){return this._baseOutlineColor}set baseOutlineColor(t){if(!(t instanceof e.Color||"string"==typeof t))throw new Error("'baseOutlineColor' type must be Color or String!");this._baseOutlineColor=e.Color.parse(t),this._baseOutlineMaterialUpdated=!1;}get baseOutlineOpacity(){return this._baseOutlineOpacity}set baseOutlineOpacity(t){if(!e.isNumber(t))throw new Error("'baseOutlineOpacity' option must be a number!");this._baseOutlineOpacity=t,this._baseOutlineMaterialUpdated=!1;}get wallColor(){return this._wallColor}set wallColor(t){if(!(t instanceof e.Color||"string"==typeof t))throw new Error("'wallColor' type must be Color or String!");this._wallColor=e.Color.parse(t),this._wallMaterialUpdated=!1;}get wallOpacity(){return this._wallOpacity}set wallOpacity(t){if(!e.isNumber(t))throw new Error("'wallOpacity' option must be a number!");this._wallOpacity=t,this._wallMaterialUpdated=!1;}get wallOutlineColor(){return this._wallOutlineColor}set wallOutlineColor(t){if(!(t instanceof e.Color||"string"==typeof t))throw new Error("'wallOutlineColor' type must be Color or String!");this._wallOutlineColor=e.Color.parse(t),this._wallOutlineMaterialUpdated=!1;}get wallOutlineOpacity(){return this._wallOutlineOpacity}set wallOutlineOpacity(t){if(!e.isNumber(t))throw new Error("'wallOutlineOpacity' option must be a number!");this._wallOutlineOpacity=t,this._wallOutlineMaterialUpdated=!1;}get enabled(){return this._enabled}set enabled(t){if(!e.isBoolean(t))throw new Error("'enabled' option must be true or false!");this._enabled=t;}static updateHeight(t,i){if(0===t.length)return [];let s=[];for(let r=0;r<t.length;r++){const n=e.Transforms.cartesian3ToCartographic(t[r]);s=s.concat([n[0],n[1],i]);}return e.Vector3.fromDegreesArrayHeights(s)}_createCutArea(){this._cutGeometry=wf.createPolygon(this._sameHeightPositions,this._maxHeight),this._cutHighlight?this._cutHighlight.geometry=this._cutGeometry:this._cutHighlight=new xf({geometry:this._cutGeometry,color:this._cutColor,opacity:this._cutOpacity});}_createFillArea(){this._fillGeometry=wf.createPolygon(this._sameHeightPositions,this._minHeight),this._fillHighlight?this._fillHighlight.geometry=this._fillGeometry:this._fillHighlight=new xf({geometry:this._fillGeometry,color:this._fillColor,opacity:this._fillOpacity});}_createWall(){const e=wf.updateHeight(this._positions,this._minHeight);this._wallGeometry=wf.createPolygon(e,this._maxHeight,!0,!1),this._wallGeometryUpdated=!1,this._wallOutlineGeometry=wf.createPolygonOutline(e,this._maxHeight,!0,!1),this._wallOutlineGeometryUpdated=!1;}_createBase(){this._baseGeometry=wf.createPolygon(this._sameHeightPositions,this._baseHeight,!1),this._baseGeometryUpdated=!1,this._baseOutlineGeometry=wf.createPolygonOutline(this._sameHeightPositions,this._baseHeight,!1),this._baseOutlineGeometryUpdated=!1;}static createPolygon(t,i,s=!0,r=!0){return new e.PolygonGeometry(0===t.length?{polygonHierarchy:{positions:[]},arcType:e.ARCTYPE.GEODESIC}:{polygonHierarchy:{positions:t},perPositionHeight:!0,extrudedHeight:s?i:void 0,closeTop:!!r,closeBottom:!!r,arcType:e.ARCTYPE.GEODESIC})}static createPolygonOutline(t,i,s=!0,r=!0){return new vf(0===t.length?{polygonHierarchy:{positions:[]},arcType:e.ARCTYPE.GEODESIC}:{polygonHierarchy:{positions:t},perPositionHeight:!0,extrudedHeight:s?i:void 0,closeTop:!!r,closeBottom:!!r,arcType:e.ARCTYPE.GEODESIC})}get json(){const t=[];for(let i=0;i<this._positions.length;i++){const s=e.Transforms.cartesian3ToCartographic(this._positions[i]);t.push([s[0],s[1]]);}return 0===t.length?void 0:e.turfPolygon([[...t,t[0]]])}update(){this._cutHighlight.update(),this._fillHighlight.update(),this._base?(this._baseGeometryUpdated||(this._base._geometry=this._baseGeometry,this._baseGeometryUpdated=!0),this._baseMaterialUpdated||(this._baseMaterial.updateProperty({color:this._baseColor,opacity:this._baseOpacity}),this._baseMaterialUpdated=!0)):(this._base=new e.Primitive({geometry:this._baseGeometry,material:this._baseMaterial}),this._baseGeometryUpdated=!0,this._baseMaterialUpdated=!0),this._wall?(this._wallGeometryUpdated||(this._wall._geometry=this._wallGeometry,this._wallGeometryUpdated=!0),this._wallMaterialUpdated||(this._wallMaterial.updateProperty({color:this._wallColor,opacity:this._wallOpacity}),this._wallMaterialUpdated=!0)):(this._wall=new e.Primitive({geometry:this._wallGeometry,material:this._wallMaterial}),this._wallGeometryUpdated=!0,this._wallMaterialUpdated=!0),this._baseOutline?(this._baseOutlineGeometryUpdated||(this._baseOutline._geometry=this._baseOutlineGeometry,this._baseOutlineGeometryUpdated=!0),this._baseOutlineMaterialUpdated||(this._baseOutlineMaterial.updateProperty({color:this._baseOutlineColor,opacity:this._baseOutlineOpacity}),this._baseOutlineMaterialUpdated=!0)):(this._baseOutline=new e.Primitive({geometry:this._baseOutlineGeometry,material:this._baseOutlineMaterial}),this._baseOutlineGeometryUpdated=!0,this._baseOutlineMaterialUpdated=!0),this._wallOutline?(this._wallOutlineGeometryUpdated||(this._wallOutline._geometry=this._wallOutlineGeometry,this._wallOutlineGeometryUpdated=!0),this._wallOutlineMaterialUpdated||(this._wallOutlineMaterial.updateProperty({color:this._wallOutlineColor,opacity:this._wallOutlineOpacity}),this._wallOutlineMaterialUpdated=!0)):(this._wallOutline=new e.Primitive({geometry:this._wallOutlineGeometry,material:this._wallOutlineMaterial}),this._wallOutlineGeometryUpdated=!0,this._wallOutlineMaterialUpdated=!0);}render(e){this._enabled&&(this._cutHighlight.render(e),this._fillHighlight.render(e),this._base.framebuffer=e.mainPass.framebuffer.framebuffer,this._base.update(e,e.frameState),this._base.render(e,{id:"base"},e.frameState),this._base.framebuffer=null,this._wall.framebuffer=e.mainPass.framebuffer.framebuffer,this._wall.update(e,e.frameState),this._wall.render(e,{id:"wall"},e.frameState),this._wall.framebuffer=null,this._baseOutline.framebuffer=e.mainPass.framebuffer.framebuffer,this._baseOutline.update(e,e.frameState),this._baseOutline.render(e,{id:"baseOutline"},e.frameState),this._baseOutline.framebuffer=null,this._wallOutline.framebuffer=e.mainPass.framebuffer.framebuffer,this._wallOutline.update(e,e.frameState),this._wallOutline.render(e,{id:"wallOutline"},e.frameState),this._wallOutline.framebuffer=null);}destroy(){this._positions=void 0,this._baseHeight=void 0,this._minHeight=void 0,this._maxHeight=void 0,this._fillHighlight&&this._fillHighlight.destroy(),this._cutHighlight&&this._cutHighlight.destroy(),this._base&&this._base instanceof e.Primitive?this._base.destroy():(this._baseGeometry&&this._baseGeometry instanceof e.Geometry&&this._baseGeometry.destroy(),this._baseMaterial&&this._baseMaterial instanceof e.Material&&this._baseMaterial.destroy()),this._baseOutline&&this._baseOutline instanceof e.Primitive?this._baseOutline.destroy():(this._baseOutlineGeometry&&this._baseOutlineGeometry instanceof e.Geometry&&this._baseOutlineGeometry.destroy(),this._baseOutlineMaterial&&this._baseOutlineMaterial instanceof e.Material&&this._baseOutlineMaterial.destroy()),this._wall&&this._wall instanceof e.Primitive?this._wall.destroy():(this._wallGeometry&&this._wallGeometry instanceof e.Geometry&&this._wallGeometry.destroy(),this._wallMaterial&&this._wallMaterial instanceof e.Material&&this._wallMaterial.destroy()),this._wallOutline&&this._wallOutline instanceof e.Primitive?this._wallOutline.destroy():(this._wallOutlineGeometry&&this._wallOutlineGeometry instanceof e.Geometry&&this._wallOutlineGeometry.destroy(),this._wallOutlineMaterial&&this._wallOutlineMaterial instanceof e.Material&&this._wallOutlineMaterial.destroy()),this._fillColor=void 0,this._fillOpacity=void 0,this._fillHighlight=void 0,this._cutColor=void 0,this._cutOpacity=void 0,this._cutHighlight=void 0,this._baseColor=void 0,this._baseOpacity=void 0,this._base=void 0,this._baseGeometry=void 0,this._baseMaterial=void 0,this._baseGeometryUpdated=void 0,this._baseMaterialUpdated=void 0,this._baseOutlineColor=void 0,this._baseOutlineOpacity=void 0,this._baseOutlineGeometry=void 0,this._baseOutlineMaterial=void 0,this._baseOutlineGeometryUpdated=void 0,this._baseOutlineMaterialUpdated=void 0,this._wallColor=void 0,this._wallOpacity=void 0,this._wall=void 0,this._wallGeometry=void 0,this._wallMaterial=void 0,this._wallGeometryUpdated=void 0,this._wallMaterialUpdated=void 0,this._wallOutlineColor=void 0,this._wallOutlineOpacity=void 0,this._wallOutlineGeometry=void 0,this._wallOutlineMaterial=void 0,this._wallOutlineGeometryUpdated=void 0,this._wallOutlineMaterialUpdated=void 0,this._enabled=void 0,this.id=void 0;}}class Sf{constructor(e){this._painter=e,this._cutFills=[];}get length(){return this._cutFills.length}add(t,i){if(!(t instanceof wf))return console.error("The current addition is not of type CutFill!"),!1;const s=e.defined(i);if(s){if(i<0)throw new Error("index must be greater than or equal to zero.");if(i>this._cutFills.length)throw new Error("index must be less than or equal to the number of CutFill.")}return s?this._cutFills.splice(i,0,t):this._cutFills.push(t),!0}getById(e){let t;return this._cutFills.forEach((i=>{i.id===e&&(t=i);})),t}getByIndex(t){if(e.isNumber(t)&&!(t>this.length))return this._cutFills[t]}indexOf(e){return this._cutFills.indexOf(e)}remove(e){const t=this.indexOf(e);return -1!==t&&(this._cutFills.splice(t,1),e.destroy(),!0)}removeById(e){const t=this.getById(e);this.remove(t);}removeByIndex(t){if(e.isNumber(t)){if(t<0)throw new Error("index must be greater than or equal to zero.");if(t>this._cutFills.length)throw new Error("index must be less than or equal to the number of CutFill.");const e=this.getByIndex(t);this.remove(e);}return !1}removeAll(){for(;this.length>0;)this.removeByIndex(0);this._cutFills=[];}update(e){for(let t=0;t<this.length;t++)this.getByIndex(t).update(e);}serialize(){const t=[];for(let i=0;i<this.length;i++){const s=this.getByIndex(i),r=[];for(let t=0;t<s.positions.length;t++)r.push(e.Vector3.pack(s.positions[t],new Array(3)));const n={positions:r,baseHeight:s.baseHeight,minHeight:s.minHeight,maxHeight:s.maxHeight,fillColor:e.Color.pack(s.fillColor,new Array(4)),fillOpacity:s.fillOpacity,cutColor:e.Color.pack(s.cutColor,new Array(4)),cutOpacity:s.cutOpacity,baseColor:e.Color.pack(s.baseColor,new Array(4)),baseOpacity:s.baseOpacity,baseOutlineColor:e.Color.pack(s.baseOutlineColor,new Array(4)),baseOutlineOpacity:s.baseOutlineOpacity,wallColor:e.Color.pack(s.wallColor,new Array(4)),wallOpacity:s.wallOpacity,wallOutlineColor:e.Color.pack(s.wallOutlineColor,new Array(4)),wallOutlineOpacity:s.wallOutlineOpacity,enabled:s.enabled};t.push(n);}return t.length>0?t:void 0}}const Af={};function Ef(t,i){return e.CONSTS.CesiumMath.equalsEpsilon(t.latitude,i.latitude,e.CONSTS.CesiumMath.EPSILON10)&&e.CONSTS.CesiumMath.equalsEpsilon(t.longitude,i.longitude,e.CONSTS.CesiumMath.EPSILON10)}Af.computePositions=function(t,i,s,r,n,o){const a=function(t,i,s,r){const n=new e.Cartographic,o=new e.Cartographic,a=(i=e.arrayRemoveDuplicates(i,e.Vector3.equalsEpsilon)).length;if(a<2)return;const l=e.defined(r),h=e.defined(s),_=new Array(a),c=new Array(a),u=new Array(a),d=i[0];_[0]=d;const m=t.cartesianToCartographic(d,n);e.fromCartographicToRadians(m,m),h&&(m.height=s[0]),c[0]=m.height,u[0]=l?r[0]:0;let p=c[0]===u[0],f=1;for(let n=1;n<a;++n){const a=i[n],d=t.cartesianToCartographic(a,o);e.fromCartographicToRadians(d,d),h&&(d.height=s[n]),p=p&&0===d.height,Ef(m,d)?m.height<d.height&&(c[f-1]=d.height):(_[f]=a,c[f]=d.height,u[f]=l?r[n]:0,p=p&&c[f]===u[f],e.Cartographic.clone(d,m),++f);}return p||f<2?void 0:(_.length=f,c.length=f,u.length=f,{positions:_,topHeights:c,bottomHeights:u})}(t,i,s,r);if(!e.defined(a))return;s=a.topHeights,r=a.bottomHeights;const l=(i=a.positions).length,h=l-2;let _,c;const u=e.CONSTS.CesiumMath.chordLength(n,t.maximumRadius),d={positions:void 0,height:void 0,granularity:void 0,ellipsoid:void 0};if(d.minDistance=u,d.ellipsoid=t,o){let t,n=0;for(t=0;t<l-1;t++)n+=e.PolylinePipeline.numberOfPoints(i[t],i[t+1],u)+1;_=new Float64Array(3*n),c=new Float64Array(3*n);const o=new Array(2),a=new Array(2);d.positions=o,d.height=a;let h=0;for(t=0;t<l-1;t++){o[0]=i[t],o[1]=i[t+1],a[0]=s[t],a[1]=s[t+1];const n=e.PolylinePipeline.generateArc(d);_.set(n,h),a[0]=r[t],a[1]=r[t+1],c.set(e.PolylinePipeline.generateArc(d),h),h+=n.length;}}else d.positions=i,d.height=s,_=new Float64Array(e.PolylinePipeline.generateArc(d)),d.height=r,c=new Float64Array(e.PolylinePipeline.generateArc(d));return {bottomPositions:c,topPositions:_,numCorners:h}};class Mf extends e.Geometry{constructor(t){if(super(t),!e.defined(t.positions))throw new Error("options.positions is required.");if(e.defined(t.maximumHeights)&&t.maximumHeights.length!==t.positions.length)throw new Error("options.positions and options.maximumHeights must have the same length.");if(e.defined(t.minimumHeights)&&t.minimumHeights.length!==t.positions.length)throw new Error("options.positions and options.minimumHeights must have the same length.");this._indices=new e.StructArrayLayout3ui6,this.primitiveType=e.WebGLConstants.TRIANGLES,this.type="WallGeometry",this._usedDoublePrecision=!0,this._vertexArray=new e.StructArrayLayout11f44,this.updateProperty(t);}updateProperty(e){this.setData(e);}setData(t){this.vertices=void 0,this.indices=void 0,this.normals=void 0,this.uvs=void 0,this._vertexArray?(this._vertexArray.clear(),this._indices.clear()):(this._indices=new e.StructArrayLayout3ui6,this._vertexArray=new e.StructArrayLayout11f44),this._positions=t.positions,this._maximumHeights=t.maximumHeights,this._minimumHeights=t.minimumHeights,this._granularity=e.defaultValue(t.granularity,e.CONSTS.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=e.defaultValue(t.ellipsoid,e.Ellipsoid.WGS84),this._needUpdate=!0,this._parse(),this.computeBoundingSphere(),this.computeBoundingBox();}static fromConstantHeights(t){const i=t.positions;if(!e.defined(i))throw new Error("options.positions is required.");let s,r;const n=t.minimumHeight,o=t.maximumHeight,a=e.defined(n),l=e.defined(o);if(a||l){const e=i.length;s=a?new Array(e):void 0,r=l?new Array(e):void 0;for(let t=0;t<e;++t)a&&(s[t]=n),l&&(r[t]=o);}return new Mf({positions:i,maximumHeights:r,minimumHeights:s})}_parse(){const t=new e.Vector3,i=new e.Vector3,s=new e.Vector3,r=new e.Vector3,n=this._ellipsoid,o=Af.computePositions(n,this._positions,this._maximumHeights,this._minimumHeights,this._granularity,!0);if(!e.defined(o))return;const a=o.bottomPositions,l=o.topPositions,h=o.numCorners;let _=l.length,c=2*_,u=0;for(let t=0;t<_/3;t++)u=Math.max(u,e.Vector3.distance(e.Vector3.fromArray(l,3*t),e.Vector3.fromArray(a,3*t)));const d=new Float64Array(c),m=new Float32Array(c),p=new Float32Array(c/3*2);let f,g=0,y=0,C=0,T=new e.Vector3,x=!0;_/=3;let b=0;const v=1/(_-h-1);for(f=0;f<_;++f){const o=3*f,h=e.Vector3.fromArray(l,o,t),c=e.Vector3.fromArray(a,o,i);d[g++]=c.x,d[g++]=c.y,d[g++]=c.z,d[g++]=h.x,d[g++]=h.y,d[g++]=h.z,p[C++]=b,p[C++]=0,p[C++]=b,p[C++]=1;let u=e.Vector3.clone(e.Vector3.ZERO,r);const w=e.Vector3.subtract(h,n.geodeticSurfaceNormal(h,i),i);if(f+1<_&&(u=e.Vector3.fromArray(l,o+3,r)),x){const i=e.Vector3.subtract(u,h,s),r=e.Vector3.subtract(w,h,t);T=e.Vector3.normalize(e.Vector3.cross(r,i,T),T),x=!1;}e.Vector3.equalsEpsilon(h,u,e.CONSTS.CesiumMath.EPSILON10)?x=!0:b+=v,m[y++]=T.x,m[y++]=T.y,m[y++]=T.z,m[y++]=T.x,m[y++]=T.y,m[y++]=T.z;}const w=c/3;c-=6*(h+1);const S=new Uint16Array(c);let A=0;for(f=0;f<w-2;f+=2){const s=f,r=f+2,n=e.Vector3.fromArray(d,3*s,t),o=e.Vector3.fromArray(d,3*r,i);if(e.Vector3.equalsEpsilon(n,o,e.CONSTS.CesiumMath.EPSILON10))continue;const a=f+1,l=f+3;S[A++]=s,S[A++]=a,S[A++]=l,S[A++]=s,S[A++]=l,S[A++]=r;}this.vertices=d,this.indices=S,this.normals=m,this.uvs=p;for(let e=0;e<S.length;e+=3)this._indices.emplaceBack(S[e],S[e+1],S[e+2]);const E=new e.Vector3;for(let t=0;t<this.vertices.length;t+=3)e.Vector3.fromArray(this.vertices,t,E),this.vertices[t]=E.x,this.vertices[t+1]=E.y,this.vertices[t+2]=E.z;this.emplaceVertexBufferTriangle();}update(t){if(this._needUpdate&&t.painter){const i=t.painter.context;this._vertBuffer?(this._vertBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indices)):(this._vertBuffer=i.createVertexBuffer(this._vertexArray,e.layout.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indices,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/3),this._needUpdate=!1;}}serialize(){return {type:this.type,positions:this._positions,maximumHeights:this._maximumHeights,minimumHeights:this._minimumHeights}}destroy(){return super.destroy(),this._vertBuffer=void 0,this._indexBuffer=void 0,this._segmentVector=void 0,this._needUpdate=void 0,this._positions=void 0,this._maximumHeights=void 0,this._minimumHeights=void 0,this._granularity=void 0,this._ellipsoid=void 0,this.vertices=void 0,this.indices=void 0,this.normals=void 0,this.uvs=void 0,this._vertexArray=void 0,this._indices=void 0,this.primitiveType=void 0,this.type=void 0,this._segmentVector?.destroy(),this._segmentVector=void 0,e.destroyObject(this)}}const Pf=new e.Matrix4,Rf=new e.Vector4;class Bf extends e.Material{constructor(t){super(t),this.frame=void 0,this._texType=e.defaultValue(t.texType,void 0),this._flowOptions=void 0,this._count=0,this._pickColorDepthTest=e.defaultValue(t.pickColorDepthTest,void 0),this.totalTime=0,this._clippingPlanes=e.defaultValue(t.clippingPlanes,void 0);}get pickColorDepthTest(){return this._pickColorDepthTest}set pickColorDepthTest(e){this._pickColorDepthTest=e;}update(t,i,s={}){if(this.totalTime=t._map.timer.totalTime,this._flowOptions&&this.animateTexture(),super.update(t,i,s),this._batchTable&&(this.uniforms=this._batchTable.getUniformMapCallback(),t.commonDepthPass.render({painter:t}),this._depthTexture=t.commonDepthPass.framebuffer.getColorTexture(0).bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),this._uniforms.set("u_DepthTexture",(()=>this._depthTexture)),this._uniforms.set("u_InvertViewMatrix",(()=>i.camera.getViewMatrix().invert())),this.defines=s.primitive._adaptTerrain?i.preMainDepthStencilTexture?{HAS_SHADOWVOLUME:!0,SHADOWVOLUME_DISCARD:!0}:{HAS_SHADOWVOLUME:!0,SHADOWVOLUME_DISCARD:!1}:{HAS_SHADOWVOLUME:!1,SHADOWVOLUME_DISCARD:!1}),this._clippingPlanes&&this._clippingPlanes.enabled&&0!==this._clippingPlanes.length){this._clippingPlanes.update(t,i),this._uniforms.set("u_model_clippingPlanesEdgeStyle",(()=>(Rf.set(this._clippingPlanes.edgeColor.r,this._clippingPlanes.edgeColor.g,this._clippingPlanes.edgeColor.b,this._clippingPlanes.edgeWidth),Rf))),this._uniforms.set("u_model_clippingPlanes",(()=>this._clippingPlanes.texture)),this._uniforms.set("u_model_clippingPlanesMatrix",(()=>{const t=e.Matrix4.multiply(Pf,i.camera.matrixWorldInverse,this._clippingPlanes.modelMatrix);return e.Matrix4.inverseTranspose(t,t),t})),this.defines.HAS_CLIPPING_PLANES=!0,this.defines.USE_CLIPPING_PLANES_FLOAT_TEXTURE=!!this._clippingPlanes._useFloatTexture;const s=e.ClippingPlaneCollection.getTextureResolution(this._clippingPlanes);this.defines.CLIPPING_PLANES_LENGTH=this._clippingPlanes.length,this.defines.CLIPPING_PLANES_TEXTURE_WIDTH=s.x,this.defines.CLIPPING_PLANES_TEXTURE_HEIGHT=s.y,this.defines.UNION_CLIPPING_REGIONS=!!this._clippingPlanes._unionClippingRegions;}else this.defines.HAS_CLIPPING_PLANES=!1,this.defines.USE_CLIPPING_PLANES_FLOAT_TEXTURE=!1,this.defines.CLIPPING_PLANES_LENGTH=0,this.defines.CLIPPING_PLANES_TEXTURE_WIDTH=1,this.defines.CLIPPING_PLANES_TEXTURE_HEIGHT=1;this._uniforms.set("u_FrameTime",(()=>t._map.timer.totalTime));}_updateTexOffsetScale(t){this._uniforms.set("u_TexOffsetScale",(()=>{const i=new e.Vector4(0,0,1,1);return t&&t.texCoordOffset&&t.texCoordOffset[0]&&(i.x=t.texCoordOffset[0]),t&&t.texCoordOffset&&t.texCoordOffset[1]&&(i.y=t.texCoordOffset[1]),t&&t.texCoordRepeat&&t.texCoordRepeat[0]&&(i.z=t.texCoordRepeat[0]),t&&t.texCoordRepeat&&t.texCoordRepeat[1]&&(i.w=t.texCoordRepeat[1]),i})),this._uniforms.set("u_TexRotate",(()=>{const i=new e.Vector3(.5,.5,0);return t&&t.texCoordCenter&&t.texCoordCenter[0]&&(i.x=t.texCoordCenter[0]),t&&t.texCoordCenter&&t.texCoordCenter[1]&&(i.y=t.texCoordCenter[1]),t&&t.texCoordRotation&&(i.z=t.texCoordRotation*e.CONSTS.TRANSFORM.DEG_TO_RAD),i}));}flowTexture(e){e.speed||(e.speed=1),e.rotation||(e.rotation=0),e.direction||(e.direction="right"),e.texRepeat||(e.repeat=[0,0]),e.speed>10&&(e.speed=10),e.speed<1&&(e.speed=1),this._flowOptions=e;}animateTexture(){const t=this.totalTime*this._flowOptions.speed/5,i=new e.Vector4(0,0,1,1);switch(i.x>1&&(i.x=i.x-1),i.y>1&&(i.y=i.y-1),this._flowOptions.direction){case"right":i.x=i.x-t+1;break;case"left":default:i.x+=t;break;case"up":i.y=i.y-t+1;break;case"down":i.y+=t;}this._updateTexOffsetScale({texCoordCenter:[.5,.5],texCoordRotation:this._flowOptions.rotation,texCoordOffset:[i.x,i.y],texCoordRepeat:this._flowOptions.texRepeat});}updateTexture(t,i){let s;return this._flowOptions||e.window.cancelAnimationFrame(this.frame),t==e.StandardMaterialType.COLOR?s=Bf.fromType(e.StandardMaterialType.COLOR,{color:i.baseColor,opacity:i.opacity,lightingModel:i.lightingModel,doubleSided:i.doubleSided}):t==e.StandardMaterialType.TEXTURE?s=Bf.fromType(e.StandardMaterialType.TEXTURE,{baseColorTexture:i.baseColorTexture,opacity:i.opacity,lightingModel:i.lightingModel,doubleSided:i.doubleSided}):t==e.StandardMaterialType.RADAR_SCAN?s=Bf.fromType(e.StandardMaterialType.RADAR_SCAN,{color:i.baseColor,opacity:i.opacity,lightingModel:i.lightingModel,doubleSided:i.doubleSided}):t==e.StandardMaterialType.DIFFUSING_RING&&(s=Bf.fromType(e.StandardMaterialType.DIFFUSING_RING,{color:i.baseColor,opacity:i.opacity,lightingModel:i.lightingModel,doubleSided:i.doubleSided})),s}updateProperty(t){if(t.color){const i=e.Color.parse(t.color);this._uniforms.set("u_Color",(()=>e.Vector4.fromColor(i,!1)));}t.baseColorTexture&&(this._uniforms.set("u_BaseColorSampler",(()=>Bf.bindTextureSampler(t.baseColorTexture))),Bf.buildDefines(this,t)),e.defined(t.opacity)&&this._uniforms.set("u_Opacity",(()=>t.opacity)),this._flowOptions||e.window.cancelAnimationFrame(this.frame),this._updateTexOffsetScale(t);}static buildDefines(t,i={}){const s={};if(s.PHONG_LIGHT=i.phongLight,s.HAS_BASECOLORMAP=i.hasBaseColorMap,s.HAS_RADARSCAN=i.radarScan,s.HAS_DIFFUSINGRING=i.diffusingRing,s.HAS_CLIPPING_PLANES=i.clippingPlanes,s.HAS_CLIPPING_PLANES){s.HAS_CLIPPING_PLANES=!0,s.USE_CLIPPING_PLANES_FLOAT_TEXTURE=!!t._clippingPlanes._useFloatTexture;const i=e.ClippingPlaneCollection.getTextureResolution(t._clippingPlanes);s.CLIPPING_PLANES_LENGTH=t._clippingPlanes.length,s.CLIPPING_PLANES_TEXTURE_WIDTH=i.x,s.CLIPPING_PLANES_TEXTURE_HEIGHT=i.y,s.UNION_CLIPPING_REGIONS=!!t._clippingPlanes._unionClippingRegions;}else s.HAS_CLIPPING_PLANES=!1,s.USE_CLIPPING_PLANES_FLOAT_TEXTURE=!1,s.CLIPPING_PLANES_LENGTH=0,s.CLIPPING_PLANES_TEXTURE_WIDTH=1,s.CLIPPING_PLANES_TEXTURE_HEIGHT=1;t.defines=s;}get texType(){return this._texType}set texType(e){this._texType=e;}get clippingPlanes(){return this._clippingPlanes}set clippingPlanes(t){this._clippingPlanes=t instanceof e.ClippingPlaneCollection?t:void 0;}static fromType(t,i){const s=Bf.getPresetMaterial(t,i),r=new Bf({renderState:i.renderState?i.renderState:s.renderState,defines:i.defines,type:"StandardMaterial",texType:t,baseColorTexture:s.baseColorTexture,color:s.color,doubleSided:s.doubleSided,opacity:s.opacity,lightingModel:s.lightingModel,depthTest:i.depthTest,clippingPlanes:i.clippingPlanes});Bf.buildDefines(r,s.microDefineOptions),e.PhongLightSetter.setPhongLightUniform({material:r});for(const e in s.uniforms)r._uniforms.set(`u_${e}`,s.uniforms[e]);return r._updateTexOffsetScale({texCoordRepeat:e.defaultValue(i.texRepeat,[0,0])}),r}static bindTextureSampler(t){return t.sampler={minificationFilter:t.minFilter||e.WebGLConstants.LINEAR_MIPMAP_NEAREST,magnificationFilter:t.magFilter||e.WebGLConstants.LINEAR,wrapS:t.wrapS||e.WebGLConstants.REPEAT,wrapT:t.wrapT||e.WebGLConstants.REPEAT},t}static getPresetMaterial(t,i){const s=e.defaultValue(i?.lightingModel,e.LightingModelType.PHONG),r={renderState:e.Material.getDefaultRenderState(),videoOptions:{},uniforms:{},baseColorTexture:void 0,doubleSided:void 0,lightingModel:void 0,defines:void 0,microDefineOptions:{phongLight:s===e.LightingModelType.PHONG,hasBaseColorMap:e.defaultValue(!!i.baseColorTexture,!1),radarScan:e.defaultValue(t===e.StandardMaterialType.RADAR_SCAN,!1),diffusingRing:e.defaultValue(t===e.StandardMaterialType.DIFFUSING_RING,!1),clippingPlanes:e.defaultValue(!!i.clippingPlanes,!1)},color:void 0,opacity:void 0};r.renderState.polygonOffset={enabled:!0,factor:1,units:1},r.renderState.cull.enabled=e.defaultValue(!i.doubleSided,!0);const n=e.defaultValue(i?.opacity,1),o=e.Color.parse(e.defaultValue(i?.color,new e.Color(1,0,0,1)));r.color=o,r.doubleSided=e.defaultValue(i.doubleSided,!1),r.opacity=n,r.lightingModel=s,r.baseColorTexture=i.baseColorTexture;const a=e.defaultValue(i?.speed,1);if(t==e.StandardMaterialType.COLOR)r.uniforms={Color:()=>e.Vector4.fromColor(o,!1),Opacity:()=>n};else if(t==e.StandardMaterialType.TEXTURE)r.uniforms={BaseColorSampler:()=>Bf.bindTextureSampler(i.baseColorTexture),Color:()=>new e.Vector4(o.r,o.g,o.b,o.a),Opacity:()=>n};else if(t==e.StandardMaterialType.RADAR_SCAN)r.uniforms={Color:()=>e.Vector4.fromColor(o,!1),Opacity:()=>n,Speed:()=>a};else {if(t!=e.StandardMaterialType.DIFFUSING_RING)throw new Error(`material with type '${t}' does not exist.`);r.uniforms={Color:()=>e.Vector4.fromColor(o,!1),Opacity:()=>n,Speed:()=>a};}return r}serialize(){const t={type:"StandardMaterial",texTYpe:this._texType,opacity:this._opacity,doubleSided:this._doubleSided,lightingModel:this._lightingModel};return this._texType===e.StandardMaterialType.COLOR?t.color=e.Color.pack(this._color,new Array(4)):this._texType===e.StandardMaterialType.TEXTURE&&(t.texUrl=this._baseColorTexture.texUrl),e.defined(this._flowOptions)&&(t.flowOptions=this._flowOptions),e.defined(this.clippingPlanes)&&(t.clippingPlanes=this.clippingPlanes.serialize()),t}destroy(){return super.destroy(),e.window.cancelAnimationFrame(this.frame),e.destroyObject(this)}}class If{constructor(t){if(e.defined(t.positions)){if(!(t.positions instanceof Array))throw new Error("options.positions is not type of Array!");if(t.positions.length<3)throw new Error("options.positions's length must greater than 2!");t.positions.forEach((t=>{if(!(t instanceof e.Vector3))throw new Error("options.positions contains the type of not Vector3!")}));}if(this.bottomTextureUrl=t.bottomTextureUrl,this.sideTextureUrl=t.sideTextureUrl,this._minHeight=0,this._maxHeights=[],this._wallPositions=[],this._positions=e.defaultValue(t.positions,void 0),this.positions=this._positions,this._shadowVolumePositions=[],this._positionsUpdated=!1,e.defined(t.depth)&&!e.isNumber(t.depth))throw new Error("options.depth contains the type of not Number!");if(this._depth=e.defaultValue(t.depth,100),this.depth=this._depth,this._depthUpdated=!1,e.defined(t.sampleDistance)&&!e.isNumber(t.sampleDistance))throw new Error("options.sampleDistance is not a Number!");if(this._sampleDistance=e.defaultValue(t.sampleDistance,5),this.sampleDistance=this._sampleDistance,this._sampleDistanceUpdated=!1,e.defined(t.enabled)&&!e.isBoolean(t.enabled))throw new Error("options.sampleDistance is not a bool!");this._enabled=e.defaultValue(t.enabled,!0),this._bodyMaterial=void 0,this._bodyPrimitive=void 0,this._bottomMaterial=void 0,this._bottomPrimitive=void 0,this._backPrimitive=void 0,this._frontPrimitive=void 0,this._initialized=!1,this.id=e.uuid();}get depth(){return this._depth}set depth(t){e.isNumber(t)&&t>=0&&(this._depth=t,this._depthUpdated=!1);}get enabled(){return this._enabled}set enabled(t){e.isBoolean&&(this._enabled=t);}get positions(){return this._positions}set positions(t){(t instanceof Array||t.length>2)&&(t.forEach((t=>{if(!(t instanceof e.Vector3))throw new Error("positions contains the type of not Vector3!")})),this._positions=t,this._positions.push(t[0]),this._positionsUpdated=!1);}get sampleDistance(){return this._sampleDistance}set sampleDistance(t){e.isNumber(t)&&(this._sampleDistance=Math.max(t,1),this._sampleDistanceUpdated=!1);}_prepareVertex(t){const i=this;this._shadowVolumePositions=[];const s=new e.Cartographic,r=[];let n;for(let t=0;t<this.positions.length-1;t++){const o=this.positions[t];e.Cartographic.fromVector3(o,void 0,s),i._maxHeights.push(s.height),r.push(s.height),n=e.Cartographic.fromVector3(o),i._shadowVolumePositions.push(e.Vector3.fromRadians(n.longitude,n.latitude,9e3));}this._minHeight=r.sort(((e,t)=>e-t))[0]-this._depth;const o=e.Vector3.unpackArray(e.PolylinePipeline.generateRhumbArc({positions:this.positions,minDistance:this.sampleDistance}));this._wallPositions=[];for(let i=0;i<o.length;i++){const s=e.Cartographic.fromVector3(o[i]),r=180*s.longitude/Math.PI,n=180*s.latitude/Math.PI;if(t.style.rasterSourceCache.terrainSource.isTerrain()){const i=ol([r,n,0],e.Vector3.fromDegrees(r,n,1e4),t.style.rasterSourceCache.terrainSource,t.transform.projection);e.defined(i.intersectionPoint)&&this._wallPositions.push(i.intersectionPoint);}else this._wallPositions.push(e.Vector3.fromDegrees(r,n,0));}}_prepareMaterial(t){e.defined(this._bottomMaterial)||(this._bottomMaterial=Bf.fromType("Texture",{baseColorTexture:(new ko).load({map:t._map,texUrl:this.bottomTextureUrl||ht("minemap://assets/DigBottom.jpg")}),lightingModel:e.LightingModelType.NONE,doubleSided:!0})),e.defined(this._bodyMaterial)||(this._bodyMaterial=Bf.fromType("Texture",{baseColorTexture:(new ko).load({map:t._map,texUrl:this.sideTextureUrl||ht("minemap://assets/DigBody.jpg"),flipY:!0}),lightingModel:e.LightingModelType.NONE,doubleSided:!0}));}_createBody(t){e.defined(this._bodyPrimitive)&&t._map.removePrimitive(this._bodyPrimitive),this._bodyPrimitive=new e.Primitive({geometry:Mf.fromConstantHeights({positions:this._wallPositions,minimumHeight:this._minHeight}),material:this._bodyMaterial,name:"excavationBody",classificationType:e.ClassificationType.IGNORECLASSIFICATION}),t._map.addPrimitive(this._bodyPrimitive);}_createBottom(t){e.defined(this._bottomPrimitive)&&t._map.removePrimitive(this._bottomPrimitive);const i=[];for(let t=0;t<this._positions.length-1;t++)i.push(e.Vector3.clone(this._positions[t]));this._bottomPrimitive=new e.Primitive({geometry:new e.PolygonGeometry({polygonHierarchy:{positions:i},height:this._minHeight}),material:this._bottomMaterial,name:"excavationBottom",classificationType:e.ClassificationType.IGNORECLASSIFICATION}),t._map.addPrimitive(this._bottomPrimitive);}_createShadowVolume(){const t=new e.PolygonGeometry({polygonHierarchy:{positions:this._shadowVolumePositions},extrudedHeight:-this._depth,perPositionHeight:!0});this._frontPrimitive=new e.Primitive({geometry:t,material:Bf.fromType("Color",{renderState:{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},cull:{enabled:!0,face:e.WebGLConstants.FRONT},depthMask:!1,depthTest:{enabled:!0,func:e.WebGLConstants.LESS},stencilMask:255,stencilTest:{enabled:!0,frontFunction:e.WebGLConstants.ALWAYS,frontOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.KEEP},backOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.DECR_WRAP,zPass:e.WebGLConstants.KEEP},reference:0,mask:255}}})}),this._backPrimitive=new e.Primitive({geometry:t,material:Bf.fromType("Color",{renderState:{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},cull:{enabled:!0,face:e.WebGLConstants.BACK},depthMask:!1,depthTest:{enabled:!0,func:e.WebGLConstants.LESS},depthRange:{near:0,far:1},stencilMask:255,stencilTest:{enabled:!0,frontFunction:e.WebGLConstants.ALWAYS,frontOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.INCR_WRAP,zPass:e.WebGLConstants.KEEP},backOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.KEEP},reference:0,mask:255}}})});}_createPrimitive(e){this._prepareVertex(e),this._prepareMaterial(e),this._createBody(e),this._createBottom(e),this._createShadowVolume();}_initialize(e){this._createPrimitive(e),this._initialized=!0,this._positionsUpdated=!0,this._sampleDistanceUpdated=!0,this._depthUpdated=!0;}update(t){this._enabled&&e.defined(this._positions)&&(this._initialized&&this._positionsUpdated&&this._sampleDistanceUpdated&&this._depthUpdated||this._initialize(t),e.defined(this._backPrimitive)&&e.defined(this._frontPrimitive)&&(this._backPrimitive.update(t,t.frameState),this._backPrimitive.render(t,{id:"shadowVolumeBack"},t.frameState),this._frontPrimitive.update(t,t.frameState),this._frontPrimitive.render(t,{id:"shadowVolumeFront"},t.frameState)));}destroy(){return this._minHeight=void 0,this._maxHeights=void 0,this._wallPositions=void 0,this._positions=void 0,this._shadowVolumePositions=void 0,this._positionsUpdated=void 0,this._depth=void 0,this._depthUpdated=void 0,this._sampleDistance=void 0,this._sampleDistanceUpdated=void 0,this._enabled=void 0,this._bodyPrimitive.destroy(),this._bodyPrimitive=void 0,this._bodyMaterial=void 0,this._bottomPrimitive.destroy(),this._bottomPrimitive=void 0,this._bottomMaterial=void 0,this._backPrimitive.destroy(),this._frontPrimitive.destroy(),this._initialized=void 0,e.destroyObject(this)}}class Df{constructor(e){this._painter=e,this._excavations=[],this._terrainCreated=!1;}get length(){return this._excavations.length}add(t,i){if(!(t instanceof If))return console.error("The current addition is not of type Excavation!"),!1;const s=e.defined(i);if(s){if(i<0)throw new Error("index must be greater than or equal to zero.");if(i>this._excavations.length)throw new Error("index must be less than or equal to the number of Excavation.")}return s?this._excavations.splice(i,0,t):this._excavations.push(t),!0}getById(e){let t;return this._excavations.forEach((i=>{i.id===e&&(t=i);})),t}getByIndex(t){if(e.isNumber(t)&&!(t>this.length))return this._excavations[t]}indexOf(e){return this._excavations.indexOf(e)}remove(e){const t=this.indexOf(e);return -1!==t&&(this._removePrimitive(e),this._excavations.splice(t,1),!0)}removeById(e){const t=this.getById(e);this.remove(t);}removeByIndex(t){if(e.isNumber(t)){if(t<0)throw new Error("index must be greater than or equal to zero.");if(t>this._excavations.length)throw new Error("index must be less than or equal to the number of Excavation.");const e=this.getByIndex(t);this.remove(e);}return !1}removeAll(){for(let e=0;e<this.length;e++)this._removePrimitive(this.getByIndex(e));this._excavations=[];}_removePrimitive(e){this._painter._map.removePrimitive(e._bottomPrimitive),this._painter._map.removePrimitive(e._bodyPrimitive);}update(t,i,s){if(!this._terrainCreated){if(t.style.rasterSourceCache.terrainSource.isTerrain()&&!t.style.rasterSourceCache.terrainSource.isLoaded())return;this._terrainCreated=!0;}const r={colorMask:{red:!1,green:!1,blue:!1,alpha:!1},depthTest:{enabled:!0}};let n,o;for(let e=0;e<i.length;e++)n=i[e],o=n._material.renderState,n._material._renderState=r,n.update(t,t.frameState),n.render(t,s,t.frameState),n._material._renderState=o;t.clearStencil();for(let e=0;e<this.length;e++)this.getByIndex(e).update(t);e.RenderState.applyRenderState(t.context,e.RenderState.fromCache({colorMask:{red:!0,green:!0,blue:!0,alpha:!0},depthMask:!0})),t.context.clear({depth:1});}serialize(){const t=[];for(let i=0;i<this.length;i++){const s=this.getByIndex(i),r=[];for(let t=0;t<s.positions.length;t++){let i=s.positions[t];i=e.Cartographic.fromVector3(i),i.x=e.CONSTS.CesiumMath.toDegrees(i.x),i.y=e.CONSTS.CesiumMath.toDegrees(i.y),e.Vector3.pack(i,r,r.length);}t[i]={positions:r,depth:s.depth,sampleDistance:s.sampleDistance,enabled:s.enabled};}return t.length>0?t:void 0}}const Of={VISIBLE_DOME:0,HIDDEN_DOME:1,ALL_DOME:2};class Lf extends eu{constructor(t){super(t),this.camera=t.camera,this.framebuffer=void 0,this.width=t.width,this.height=t.height,this.frameState=void 0,this.replaceMaterial=new e.DepthMaterial({});}_createFramebuffer({context:t,width:i,height:s}){const r=new e.Sampler({minificationFilter:e.TextureMinificationFilter.NEAREST,magnificationFilter:e.TextureMagnificationFilter.NEAREST});this.framebuffer=new Yc({context:t,width:i,height:s,colorTextures:[new e.Texture({image:null,context:t,width:i,height:s,pixelFormat:e.WebGLConstants.RGBA})],depthStencilTexture:new e.Texture({context:t,width:i,height:s,minFilter:e.WebGLConstants.LINEAR,magFilter:e.WebGLConstants.LINEAR,pixelFormat:e.PixelFormat.DEPTH_STENCIL,pixelDatatype:e.PixelDatatype.UNSIGNED_INT_24_8,sampler:r,anisotropy:1})});}update(t,i,s){const r=t.context;e.defined(this.frameState)||(this.frameState=new $c(this.passType)),this.frameState.overrideMaterial=this.replaceMaterial,e.defined(this.framebuffer)||this._createFramebuffer({context:r,width:i,height:s}),this.frameState.update({framebuffer:this.framebuffer,camera:this.camera}),this.frameState.bindFramebuffer(r);}render(t){const i=t.context,s=i.bindFramebuffer.get();this.update(t,this.width,this.height),e.RenderState.applyRenderState(i,e.RenderState.fromCache({blending:e.renderStateEnum.enableBlending,depthMask:!0,depthTest:{enabled:!0,depthTest:e.WebGLConstants.LESS},viewport:{x:0,y:0,width:this.width,height:this.height}})),i.clear({depth:1}),t.renderGroup.update({layers:t.style._layers,orders:t.style._order,frameState:this.frameState}),t.renderGroup.render({layers:t.style._layers,frameState:this.frameState}),this.frameState.overrideMaterial=void 0,i.bindFramebuffer.set(s),e.RenderState.applyRenderState(i,e.RenderState.fromCache({viewport:{x:0,y:0,width:t.width,height:t.height}}));}}class Vf{constructor(t){if(e.defined(t.viewPosition)&&!(t.viewPosition instanceof e.Vector3))throw new Error("viewerPosition is not type of Vector3!");if(this._viewPosition=e.defaultValue(t.viewPosition,new e.Vector3),this._radius=e.defaultValue(t.radius,100),this._domeType=e.defaultValue(t.domeType,Of.ALL_DOME),this._visible=e.defaultValue(t.visible,!0),this._visibleAreaColor=e.defaultValue(e.Color.parse(t.visibleAreaColor),new e.Color(0,1,0,1)),this._hiddenAreaColor=e.defaultValue(e.Color.parse(t.hiddenAreaColor),new e.Color(1,0,0,1)),this._startAngle=e.defaultValue(t.startAngle,0),this._endAngle=e.defaultValue(t.endAngle,360),this._isClosed=e.defaultValue(t.isClosed,!1),this._sholdCalculateVisibleRatio=e.defaultValue(t.sholdCalculateVisibleRatio,!0),this._hasCalculated=!1,this._visibleRatio=0,e.defined(t.ratioCalculated)&&!(t.ratioCalculated instanceof Function))throw new Error("options.ratioCalculated is not a function!");this.ratioCalculatedCallback=e.defaultValue(t.ratioCalculated,void 0),this._pointIndicator=void 0,this._indicatorVisible=e.defaultValue(t.indicatorVisible,10),this._indicatorSize=e.defaultValue(t.indicatorSize,10),this._indicatorColor=e.Color.parse(t.indicatorColor)||new e.Color(1,0,0,1),this._indicatorOutlineColor=e.Color.parse(t.indicatorOutlineColor)||new e.Color(0,0,0,0),this._indicatorOutlineWidth=e.defaultValue(t.indicatorOutlineWidth,0),this._initialized=!1,this._worldMatrix=new e.Matrix4,this._geometry=void 0,this._viewDomeCommand=void 0,this._calculateFramebuffers=[],this._calculateCommands=[],this._renderTextureMatrix=[],this._viewshedPass=[],this._windowSize={height:0,width:0},this.id=e.uuid();}get viewPosition(){return this._viewPosition}set viewPosition(t){if(t instanceof e.Vector3){this._viewPosition=t;const i=e.Vector3.fromDegrees(t.x,t.y,t.z);this._worldMatrix=e.Transforms.headingPitchRollToFixedFrame(i,new e.HeadingPitchRoll(0,0,0)),this._initialized=!1,this._hasCalculated=!1;}}get radius(){return this._radius}set radius(t){e.isNumber(t)&&(this._radius=t,this._initialized=!1,this._hasCalculated=!1);}get domeType(){return this._domeType}set domeType(e){this._domeType=e;}get visible(){return this._visible}set visible(t){e.isBoolean(t)&&(this._visible=t);}get sholdCalculateVisibleRatio(){return this._sholdCalculateVisibleRatio}set sholdCalculateVisibleRatio(t){e.isBoolean(t)&&(this._sholdCalculateVisibleRatio=t);}get visibleRatio(){return this._visibleRatio}get visibleAreaColor(){return this._visibleAreaColor}set visibleAreaColor(t){const i=e.Color.parse(t);e.defined(i)&&(this._visibleAreaColor=i);}get hiddenAreaColor(){return this._hiddenAreaColor}set hiddenAreaColor(t){const i=e.Color.parse(t);e.defined(i)&&(this._hiddenAreaColor=i);}get startAngle(){return this._startAngle}set startAngle(t){if(e.isNumber(t)){let e=Math.max(0,Math.min(360,t));e=Math.min(this._endAngle,e),this._startAngle=e,this._initialized=!1,this._hasCalculated=!1;}}get endAngle(){return this._endAngle}set endAngle(t){if(e.isNumber(t)){let e=Math.max(0,Math.min(360,t));e=Math.max(this._startAngle,e),this._endAngle=e,this._initialized=!1,this._hasCalculated=!1;}}get isClosed(){return this._isClosed}set isClosed(t){e.isBoolean(t)&&(this._isClosed=t,this._initialized=!1,this._hasCalculated=!1);}get indicatorVisible(){return this._indicatorVisible}set indicatorVisible(t){e.isBoolean(t)&&(this._indicatorVisible=t,this._addIndicator());}get indicatorSize(){return this._indicatorSize}set indicatorSize(t){e.isNumber(t)&&(this._indicatorSize=t,this._addIndicator());}get indicatorColor(){return this._indicatorColor}set indicatorColor(t){const i=e.Color.parse(t);e.defined(i)&&(this._indicatorColor=e.Color.parse(i),this._addIndicator());}get indicatorOutlineColor(){return this._indicatorOutlineColor}set indicatorOutlineColor(t){this._indicatorOutlineColor=e.Color.parse(t),this._addIndicator();}get indicatorOutlineWidth(){return this._indicatorOutlineWidth}set indicatorOutlineWidth(e){this._indicatorOutlineWidth=e,this._addIndicator();}_addIndicator(){if(!this._indicatorVisible)return;const t=e.Vector3.fromDegrees(this._viewPosition.x,this._viewPosition.y,this._viewPosition.z);e.defined(this._pointIndicator)?(this._pointIndicator.remove(this._pointPrimitive,!0),this._pointPrimitive=new _h({show:!0,position:t,pixelSize:this._indicatorSize,color:this._indicatorColor,outlineColor:this._indicatorOutlineColor,outlineWidth:this._indicatorOutlineWidth}),this._pointIndicator.add(this._pointPrimitive)):(this._pointIndicator=new ph,this._pointPrimitive=new _h({show:!0,position:t,pixelSize:this._indicatorSize,color:this._indicatorColor,outlineColor:this._indicatorOutlineColor,outlineWidth:this._indicatorOutlineWidth}),this._pointIndicator.add(this._pointPrimitive));}_drawPointIndicator(e){if(!this._indicatorVisible)return;this._pointIndicator.update(e);const t=this._pointIndicator.getTranslucentPrimitives();for(let i=0;i<t.length;i++)t[i].update(e,e.frameState,{}),t[i].framebuffer=e.mainPass.framebuffer.framebuffer;for(let i=0;i<t.length;i++)t[i].render(e,{id:"viewdom-indicator"},e.frameState),t[i].framebuffer=null;}_createDepthCamera(t){this._viewshedPass=[],this._renderTextureMatrix=[new e.Matrix4,new e.Matrix4,new e.Matrix4,new e.Matrix4,new e.Matrix4];const i=new e.Matrix4;for(let s=0;s<5;s++){const r=new a(90,1,Math.max(.001*this._radius,.1),Math.max(this._radius+100,10)),n=e.Transforms.headingPitchRollToFixedFrame(e.Vector3.fromDegrees(this.viewPosition.x,this.viewPosition.y,this.viewPosition.z),new e.HeadingPitchRoll(e.CONSTS.CesiumMath.toRadians(90*s),e.CONSTS.CesiumMath.toRadians(4===s?180:90),e.CONSTS.CesiumMath.toRadians(0)));r.setMatrix(n),e.Matrix4.multiply(i,r.getViewMatrix(),this._worldMatrix),e.Matrix4.multiply(this._renderTextureMatrix[s],r.getProjectionMatrix(),i),this._viewshedPass[s]=new Lf({camera:r,context:t.context,width:2048,height:2048,passType:e.RenderPassConsts.VIEWSHED_PASS});}}_createDomeGeometry(t,i,s,r,n,o){const a=(n-r)*e.CONSTS.CesiumMath.RADIANS_PER_DEGREE/i,l=Math.PI/(2*t);let h=0,_=0,c=!1;!o||0===r&&360===n||(c=!0);const u=new Array(3*(c?(t+1)*i+1:(t+1)*i));let d=0;for(let n=0;n<i;n++){_=n*a+r*e.CONSTS.CesiumMath.RADIANS_PER_DEGREE;for(let e=0;e<=t;e++)h=e*l,u[d++]=s*Math.sin(h)*Math.cos(_),u[d++]=s*Math.sin(h)*Math.sin(_),u[d++]=s*Math.cos(h);}return c&&(u[d++]=0,u[d++]=0,u[d++]=0),u}_createViewDomeIndices(e,t,i,s,r){const n=0==i&&360==s?t:t-1;let o;const a=[];for(o=0;o<e;o++)for(let i=0;i<n;i++){const s=o+i*(e+1),r=s+1,n=i==t-1?o+1:s+e+2;a.push(s),a.push(r),a.push(n),a.push(s),a.push(n),a.push(n-1);}if(r&&(0!=i||360!=s)){const i=(e+1)*t,s=n*(e+1);for(o=0;o<e;o++)a.push(o),a.push(o+1),a.push(i),a.push(o+s+1),a.push(o+s),a.push(i);}return a}_createViewDomeCommand(t){e.defined(this._geometry)&&this._geometry.destroy(),e.defined(this._viewDomeCommand)&&(this._viewDomeCommand.material=void 0,this._viewDomeCommand=void 0);const i=e.Vector3.fromDegrees(this.viewPosition.x,this.viewPosition.y,this.viewPosition.z);this._worldMatrix=e.Transforms.headingPitchRollToFixedFrame(i,new e.HeadingPitchRoll(0,0,0));const s=this._createDomeGeometry(129,129,1,this._startAngle,this._endAngle,this._isClosed),r=new e.StructArrayLayout3f2f3f32;for(let e=0;e<s.length;e+=3)r.emplaceBack(s[e],s[e+1],s[e+2],0,0,0,0,0);const n=this._createViewDomeIndices(129,129,this._startAngle,this._endAngle,this._isClosed),o=new e.StructArrayLayout3ui6;for(let e=0;e<n.length;e+=3)o.emplaceBack(n[e],n[e+1],n[e+2]);this._geometry=new e.Geometry({primitiveType:e.WebGLConstants.TRIANGLES,vertBuffer:t.context.createVertexBuffer(r,e.layout$1.members),indexBuffer:t.context.createIndexBuffer(o),segmentVector:e.SegmentVector.simpleSegment(0,0,s.length/3,n.length/3)});const a=new Map([["u_ModelViewProjectionMatrix",()=>t.frameState.camera.getVPMatrix().multiplyRight(this._worldMatrix)],["u_Radius",()=>this._radius],["u_VisibleAreaColor",()=>e.Vector4.fromColor(this._visibleAreaColor,!1)],["u_HiddenAreaColor",()=>e.Vector4.fromColor(this._hiddenAreaColor,!1)],["u_DomeType",()=>this._domeType]]);for(let e=0;e<5;e++)a.set(`u_TexWorldViewProjMatrix${e}`,(()=>this._renderTextureMatrix[e])),a.set(`u_DepthMap${e}`,(()=>this._viewshedPass[e].framebuffer.depthStencilTexture));this._viewDomeCommand={painter:t,framebuffer:t.mainPass.framebuffer.framebuffer,layer:{id:"viewDomeAnalysis"},geometry:this._geometry,material:{renderState:{blending:e.renderStateEnum.enableBlending,depthTest:e.renderStateEnum.enableDepthTest},_uniforms:a,_shaderSource:new e.ShaderSource({type:"viewDomeAnalysis"})}};}_createCalculateCommand(t){const i=new e.Sampler({minificationFilter:e.TextureMinificationFilter.NEAREST,magnificationFilter:e.TextureMagnificationFilter.NEAREST});this._calculateCommands=[],this._calculateFramebuffers=[];for(let s=0;s<5;s++){const r=new e.Texture({context:t.context,width:2048,height:2048,minFilter:e.WebGLConstants.NEAREST,magFilter:e.WebGLConstants.NEAREST,pixelFormat:e.PixelFormat.RGBA,pixelDatatype:e.PixelDatatype.UNSIGNED_BYTE,sampler:i,anisotropy:1}),n=new Yc({context:t.context,colorTextures:[r]});this._calculateFramebuffers.push(n);const o=new a(90,1,.1,Math.max(this._radius,1)),l=4===s?180:Math.PI/2,h=Math.PI/2*s,_=(new e.Matrix4).rotateX(l).rotateY(h);o.setMatrix(_);const c=new Map([["u_ModelViewProjectionMatrix",()=>o.getVPMatrix()],["u_DepthMap",()=>this._viewshedPass[s].framebuffer.depthStencilTexture]]);this._calculateCommands.push({painter:t,framebuffer:this._calculateFramebuffers[s].framebuffer,layer:{id:"viewDomeCalculateAnalysis"},geometry:this._geometry,material:{renderState:{blending:e.renderStateEnum.disableBlending,depthTest:e.renderStateEnum.enableDepthTest},_uniforms:c,_shaderSource:new e.ShaderSource({type:"viewDomeCalculateAnalysis"})}});}}_calculateVisibleRatio(t){this._visibleRatio=0;const i=[];for(let s=0;s<this._calculateCommands.length;s++)t.frameState.update({framebuffer:this._calculateFramebuffers[s]}),t.frameState.bindFramebuffer(t.context),t.context.clear({color:e.Color.transparent,depth:1,stencil:0}),t.context.draw(this._calculateCommands[s]),i.push(tu({x:0,y:2048/e.window.devicePixelRatio,height:2048,width:2048},t.context,this._calculateFramebuffers[s],2048,e.WebGLConstants.UNSIGNED_BYTE,16777216)),t.context.bindFramebuffer.set(null);this._hasCalculated=!0,this.workerID=t.style.dispatcher.send("caculateViewdomeRatio",{data:i},((t,i)=>{this._visibleRatio=i,e.defined(this.ratioCalculatedCallback)&&this.ratioCalculatedCallback(this._visibleRatio);}),void 0);}update(e){if(this._visible&&(this._windowSize.height===e.height&&this._windowSize.width===e.width||(this._windowSize.height=e.height,this._windowSize.width=e.width,this._initialized=!1),!this._initialized)){this._addIndicator(),this._createViewDomeCommand(e),this._createDepthCamera(e),this._createCalculateCommand(e);for(let t=0;t<this._viewshedPass.length;t++)this._viewshedPass[t].render(e);this._initialized=!0;}}render(t){this._visible&&(e.RenderState.applyRenderState(t.context,e.RenderState.fromCache({viewport:{x:0,y:0,width:t.width*t._map.SSAASamples,height:t.height*t._map.SSAASamples}})),this._drawPointIndicator(t),this._sholdCalculateVisibleRatio&&!this._hasCalculated&&this._calculateVisibleRatio(t),t.context.draw(this._viewDomeCommand),e.RenderState.applyRenderState(t.context,e.RenderState.fromCache({viewport:{x:0,y:0,width:t.width,height:t.height}})));}destroy(){this._viewPosition=void 0,this._radius=void 0,this._domeType=void 0,this._visible=void 0,this._visibleAreaColor=void 0,this._hiddenAreaColor=void 0,this._startAngle=void 0,this._endAngle=void 0,this._isClosed=void 0,this._sholdCalculateVisibleRatio=void 0,this._hasCalculated=void 0,this._visibleRatio=void 0,this.ratioCalculatedCallback=void 0,e.defined(this._pointIndicator)&&(this._pointIndicator.removeAll(!0),this._pointIndicator=void 0),this._indicatorSize=void 0,this._indicatorColor=void 0,this._indicatorOutlineColor=void 0,this._indicatorOutlineWidth=void 0,this._initialized=void 0,this._worldMatrix=void 0,e.defined(this._geometry)&&(this._geometry.destroy(),this._geometry=void 0),this._viewDomeCommand.material=void 0,this._viewDomeCommand=void 0;for(let e=0;e<this._calculateFramebuffers;e++)this._calculateFramebuffers[e].destroy(!1);this._calculateFramebuffers=[];for(let e=0;e<this._calculateCommands;e++)this._calculateCommands[e].material=void 0,this._calculateCommands[e]=void 0;this._calculateCommands=[],this._renderTextureMatrix=[];for(let e=0;e<this._viewshedPass;e++)this._viewshedPass[e].destroy(),this._viewshedPass[e]=void 0;return this._viewshedPass=[],e.destroyObject(this)}}class Nf{constructor(){this._viewDomes=[];}get length(){return this._viewDomes.length}add(t,i){if(!(t instanceof Vf))return console.error("The current addition is not of type ViewDome!"),!1;const s=e.defined(i);if(s){if(i<0)throw new Error("index must be greater than or equal to zero.");if(i>this._viewDomes.length)throw new Error("index must be less than or equal to the number of ViewDome.")}return s?this._viewDomes.splice(i,0,t):this._viewDomes.push(t),!0}getById(e){let t;return this._viewDomes.forEach((i=>{i.id===e&&(t=i);})),t}getByIndex(t){if(e.isNumber(t)&&!(t>this.length))return this._viewDomes[t]}indexOf(e){return this._viewDomes.indexOf(e)}remove(e){const t=this.indexOf(e);return -1!==t&&(this._viewDomes.splice(t,1),!0)}removeById(e){const t=this.getById(e);this.remove(t);}removeByIndex(t){if(e.isNumber(t)){if(t<0)throw new Error("index must be greater than or equal to zero.");if(t>this._viewDomes.length)throw new Error("index must be less than or equal to the number of ViewDome.");const e=this.getByIndex(t);this.remove(e);}return !1}removeAll(){for(let e=0;e<this.length;e++)this._viewDomes[e].destroy();this._viewDomes=[];}update(e){for(let t=0;t<this.length;t++)this.getByIndex(t).update(e);}serialize(){const t=[];for(let i=0;i<this.length;i++){const s=this.getByIndex(i),r={viewPosition:e.Vector3.pack(s.viewPosition,new Array(3)),radius:s.radius,domeType:s.domeType,visible:s.visible,visibleAreaColor:e.Color.pack(s.visibleAreaColor,new Array(4)),hiddenAreaColor:e.Color.pack(s.hiddenAreaColor,new Array(4)),startAngle:s.startAngle,endAngle:s.endAngle,isClosed:s.isClosed,sholdCalculateVisibleRatio:s.sholdCalculateVisibleRatio,indicatorVisible:s.indicatorVisible,indicatorSize:s.indicatorSize,indicatorColor:e.Color.pack(s.indicatorColor,new Array(4)),indicatorOutlineColor:e.Color.pack(s.indicatorOutlineColor,new Array(4)),indicatorOutlineWidth:s.indicatorOutlineWidth};t.push(r);}return t.length>0?t:void 0}}class Ff extends e.Geometry{constructor(){super(),this.vertices=new Float64Array(633),this.indices=new Uint16Array(408);const t=this.indices;let i=0;t[i++]=0,t[i++]=1,t[i++]=0,t[i++]=21,t[i++]=0,t[i++]=85,t[i++]=0,t[i++]=105;let s=0;for(let e=0;e<5;++e){s++;for(let e=0;e<20;++e)t[i++]=s++,t[i++]=s;}s++;for(let e=0;e<20;++e)for(let e=0;e<5;++e)t[i++]=s,t[i++]=5+s++;this._boundingSphere=void 0,this.type="Viewshed3DHintLineGeometry",this._usedDoublePrecision=!1,this._vertexArray=this._usedDoublePrecision?new e.StructArrayLayout3f3f24:new e.StructArrayLayout3f12,this._indices=new e.StructArrayLayout2ui4;for(let e=0;e<this.indices.length/2;e++)this._indices.emplaceBack(this.indices[2*e],this.indices[2*e+1]);this.primitiveType=e.WebGLConstants.LINES,this._vertBuffer=void 0,this._indexBuffer=void 0,this._segmentVector=void 0,this.needUpdate=!0,this._ready=!1;}updatePositions(t){const i=t.verticalFov,s=t.distance,r=t.modelMatrix,n=this.vertices,o=e.CONSTS.CesiumMath.toRadians(t.horizontalFov),a=e.CONSTS.CesiumMath.toRadians(i),l=s*Math.tan(.5*o),h=s*Math.tan(.5*a),_=new e.Vector3(-l,-h,-s),c=new e.Vector3(l,h,0);e.Matrix4.multiplyByPoint(r,_,_),e.Matrix4.multiplyByPoint(r,c,c),this._boundingSphere=e.BoundingSphere.fromCornerPoints(_,c);let u=0;n[u++]=0,n[u++]=0,n[u++]=0;const d=Math.PI-.5*o;let m,p,f=o/4;for(let e=0;e<5;++e){m=d+e*f;const t=h/(s/Math.cos(m)),i=Math.atan(t),r=-i,o=i/10;for(let e=0;e<21;++e)p=r+e*o,n[u++]=s*Math.cos(p)*Math.sin(m),n[u++]=s*Math.sin(p),n[u++]=s*Math.cos(p)*Math.cos(m);}f=o/20;for(let e=0;e<21;++e){m=d+e*f;const t=h/(s/Math.cos(m)),i=Math.atan(t),r=-i,o=i/2;for(let e=0;e<5;++e)p=r+e*o,n[u++]=s*Math.cos(p)*Math.sin(m),n[u++]=s*Math.sin(p),n[u++]=s*Math.cos(p)*Math.cos(m);}this.emplaceVertexBufferOfLines();}update(t){if(this.needUpdate&&t.painter){this.needUpdate=!1;const i=t.painter.context;e.defined(this._vertBuffer)&&this._vertBuffer.destroy(),this._vertBuffer=i.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?Yu.members:Qu.members,!0),this._indexBuffer=i.createIndexBuffer(this._indices,!1),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/2),this._ready=!0;}}destroy(){return this.vertices=void 0,this.indices=void 0,this._boundingSphere=void 0,this.type=void 0,this._vertexArray=void 0,this._indexBuffer=void 0,this._segmentVector=void 0,this._indices=void 0,this.primitiveType=void 0,this._vertBuffer=void 0,this.needUpdate=void 0,this._ready=void 0,e.destroyObject(this)}}class Gf{constructor(t){if(t=e.defined(t)?t:{},e.defined(t.viewerPosition)&&!(t.viewerPosition instanceof e.Vector3))throw new Error("viewerPosition is not type of Vector3!");if(this._viewerPosition=e.defaultValue(t.viewerPosition,new e.Vector3(0,0,0)),e.defined(t.direction)&&(t.direction>360||t.direction<0))throw new Error("direction should be between 0 and 360!");if(this._direction=e.defaultValue(t.direction,0),e.defined(t.pitch)&&(t.pitch>180||t.pitch<0))throw new Error("pitch should be between 0 and 180!");if(this._pitch=e.defaultValue(t.pitch,90),e.defined(t.horizontalFov)&&(t.horizontalFov>180||t.horizontalFov<0))throw new Error("horizontalFov should be between 0 and 180!");if(this._horizontalFov=e.defaultValue(t.horizontalFov,60),e.defined(t.verticalFov)&&(t.verticalFov>180||t.verticalFov<0))throw new Error("horizontalFov should be between 0 and 180!");if(this._verticalFov=e.defaultValue(t.verticalFov,60),e.defined(t.distance)&&t.distance<=0)throw new Error("distance should be greater than 0!");if(this._distance=e.defaultValue(t.distance,100),e.defined(t.visibleAreaColor)&&!(t.visibleAreaColor instanceof e.Color)&&"string"!=typeof t.visibleAreaColor)throw new Error("visibleAreaColor type must be Color or String!");if(this._visibleAreaColor=e.Color.parse(e.defaultValue(t.visibleAreaColor,new e.Color(0,1,0,.3))),e.defined(t.hiddenAreaColor)&&!(t.hiddenAreaColor instanceof e.Color)&&"string"!=typeof t.hiddenAreaColor)throw new Error("hiddenAreaColor type must be Color or String!");if(this._hiddenAreaColor=e.Color.parse(e.defaultValue(t.hiddenAreaColor,new e.Color(1,0,0,.3))),e.defined(t.lineColor)&&!(t.lineColor instanceof e.Color)&&"string"!=typeof t.lineColor)throw new Error("lineColor type must be Color  or String!");this._lineColor=e.Color.parse(e.defaultValue(t.lineColor,new e.Color(1,1,1,1))),this._aspectRatio=this._calculateAspectRatio(),this._targetPoint=new e.Vector3(0,0,0),this._modelMatrix=new e.Matrix4,this._hintLine=void 0,this._hintLineUpdated=!1,this._cameraUpdated=!1,this._depthCamera=void 0,this.viewshedPass=void 0,this._initialized=!1,this._visible=!1,this._currentFrustum=new e.Vector2,this._textureViewMatrix=new e.Matrix4,this._textureProjMatrix=new e.Matrix4,this._sceneDepthTexture=void 0,this._analysisCommand=void 0,this._mixDrawCommand=void 0,this._resultFrameBuffer=[],this._resultTextures=[],this._lastResultTexture=void 0,this.id=e.uuid();}get direction(){return this._direction}set direction(t){e.isNumber(t)&&(this._direction=t,this._direction=(this._direction>=0?this._direction:this._direction+=360)<360?this._direction:this._direction-=360,this._cameraUpdated=!1,this._hintLineUpdated=!1);}get distance(){return this._distance}set distance(t){e.isNumber(t)&&(this._distance=t,this._cameraUpdated=!1,this._hintLineUpdated=!1);}get hiddenAreaColor(){return this._hiddenAreaColor}set hiddenAreaColor(t){(t instanceof e.Color||"string"==typeof t)&&(this._hiddenAreaColor=e.Color.parse(t));}get horizontalFov(){return this._horizontalFov}set horizontalFov(t){e.isNumber(t)&&t>0&&t<180&&(this._horizontalFov=t,this._calculateAspectRatio(),this._cameraUpdated=!1,this._hintLineUpdated=!1);}get lineColor(){return this._lineColor}set lineColor(t){(t instanceof e.Color||"string"==typeof t)&&(this._lineColor=e.Color.parse(t),e.defined(this._hintLine)&&(this._hintLine._material.destroy(),this._hintLine._material=void 0,this._hintLine._material=e.StandardMaterial.fromType("Color",{color:this._lineColor,lightingModel:e.LightingModelType.NONE})));}get pitch(){return this._pitch}set pitch(t){e.isNumber(t)&&e.isNumber(t)&&t>=0&&t<=180&&(this._pitch=t,this._cameraUpdated=!1,this._hintLineUpdated=!1);}get verticalFov(){return this._verticalFov}set verticalFov(t){e.isNumber(t)&&t>0&&t<180&&(this._verticalFov=t,this._calculateAspectRatio(),this._cameraUpdated=!1,this._hintLineUpdated=!1);}get viewerPosition(){return this._viewerPosition}set viewerPosition(t){t instanceof e.Vector3&&(this._viewerPosition=t,this._cameraUpdated=!1,this._hintLineUpdated=!1);}get visibleAreaColor(){return this._visibleAreaColor}set visibleAreaColor(t){(t instanceof e.Color||"string"==typeof t)&&(this._visibleAreaColor=e.Color.parse(t));}_calculateAspectRatio(){this._aspectRatio=Math.tan(.5*this._horizontalFov*e.CONSTS.CesiumMath.RADIANS_PER_DEGREE)/Math.tan(.5*this._verticalFov*e.CONSTS.CesiumMath.RADIANS_PER_DEGREE);}_initialize(t){e.defined(this._depthCamera)||(this._depthCamera=new a(this._verticalFov,this._aspectRatio,.001*this._distance,this._distance)),e.defined(this.viewshedPass)||(this.viewshedPass=new Lf({camera:this._depthCamera,context:t.context,width:2048,height:2048,passType:e.RenderPassConsts.VIEWSHED_PASS})),this._initialized=!0;}setTargetPoint(t){this._distance=e.Vector3.distance(e.Vector3.fromDegrees(this._viewerPosition.x,this._viewerPosition.y,this._viewerPosition.z),e.Vector3.fromDegrees(t.x,t.y,t.z)),this._distance=this._distance<1?1:this._distance;const i=new e.Vector3,s=e.Transforms.eastNorthUpToFixedFrame(e.Vector3.fromDegrees(this._viewerPosition.x,this._viewerPosition.y,this._viewerPosition.z));e.Matrix4.inverse(s,s),e.Matrix4.multiplyByPoint(s,e.Vector3.fromDegrees(t.x,t.y,t.z),i),e.Vector3.normalize(i,i),this._direction=e.CONSTS.CesiumMath.toDegrees(Math.atan2(i.x,i.y)),this._direction=(this._direction>=0?this._direction:this._direction+=360)<360?this._direction:this._direction-=360,this.pitch=e.CONSTS.CesiumMath.toDegrees(Math.asin(i.z))+90;}update(t){this._initialized||this._initialize(t),this._cameraUpdated||this._updateCamera(),this._hintLineUpdated||(e.defined(this._hintLine)||(this._hintLine=new e.Primitive({geometry:new Ff,material:e.StandardMaterial.fromType("Color",{color:this._lineColor,lightingModel:e.LightingModelType.NONE}),name:"Viewshed3DHintLine",modelMatrix:this._modelMatrix})),this._updateHintLine(t)),this._visible&&(e.Matrix4.multiply(this._textureViewMatrix,t.transform.activeCamera.projectionMatrix,t.transform.activeCamera.getViewMatrix()),e.Matrix4.inverse(this._textureViewMatrix,this._textureViewMatrix),e.Matrix4.multiply(this._textureViewMatrix,this._depthCamera.getViewMatrix(),this._textureViewMatrix),e.Matrix4.clone(this._depthCamera.projectionMatrix,this._textureProjMatrix),this.viewshedPass.render(t));}_updateHintLine(t){this._hintLine._geometry.needUpdate=!0,this._hintLine._geometry.updatePositions({horizontalFov:this._horizontalFov,verticalFov:this._verticalFov,distance:this._distance,modelMatrix:this._modelMatrix}),this._hintLine.setMatrix(this._modelMatrix),this._hintLine.updateMatrixWorld(!0),this._hintLine._modelMatrix=this._modelMatrix,t.transform.activeCamera.frustumCrate.cullingVolume.computeVisibility(this._hintLine._geometry._boundingSphere)!==e.INTERSECTION.OUTSIDE?(this._visible=!0,this._hintLineUpdated=!0):this._visible=!1;}_updateCamera(){const t=e.Transforms.headingPitchRollToFixedFrame(e.Vector3.fromDegrees(this._viewerPosition.x,this._viewerPosition.y,this._viewerPosition.z),new e.HeadingPitchRoll(e.CONSTS.CesiumMath.toRadians(this.direction),e.CONSTS.CesiumMath.toRadians(this.pitch),0)),i=Math.tan(.5*this._horizontalFov*e.CONSTS.CesiumMath.RADIANS_PER_DEGREE)/Math.tan(.5*this._verticalFov*e.CONSTS.CesiumMath.RADIANS_PER_DEGREE);this._depthCamera.updatePerspectiveOptions({fov:this._verticalFov,aspect:i,near:.001*this._distance,far:this.distance}),this._depthCamera.setMatrix(t),this._modelMatrix=t,this._cameraUpdated=!0,e.defined(this.viewshedPass)&&(this.viewshedPass.camera=this._depthCamera);}render(t){const i=t.width,s=t.height;if(0===this._resultTextures.length||this._resultTextures[0].width!=i||this._resultTextures[0].height!=s){this._resultTextures=[],this._resultFrameBuffer=[];const r=new e.Sampler({minificationFilter:e.TextureMinificationFilter.NEAREST,magnificationFilter:e.TextureMagnificationFilter.NEAREST});for(let n=0;n<2;++n){const n=new e.Texture({context:t.context,width:i,height:s,minFilter:e.WebGLConstants.NEAREST,magFilter:e.WebGLConstants.NEAREST,pixelFormat:e.PixelFormat.RGBA,pixelDatatype:e.PixelDatatype.UNSIGNED_BYTE,sampler:r,anisotropy:1});this._resultTextures.push(n);const o=new Yc({context:t.context,colorTextures:[n]});this._resultFrameBuffer.push(o);}}const r=t.context.bindFramebuffer.get();t.frameState.update({framebuffer:this._resultFrameBuffer[0]}),t.frameState.bindFramebuffer(t.context),t.context.clear({color:e.Color.black}),this._lastResultTexture=this._resultTextures[0],this._doAnalysis(this,t),e.RenderState.applyRenderState(t.context,e.RenderState.fromCache({viewport:{x:0,y:0,width:i*t._map.SSAASamples,height:s*t._map.SSAASamples}})),t.frameState.update({framebuffer:null}),t.frameState.bindFramebuffer(t.context),t.context.bindFramebuffer.set(r),e.defined(this._mixDrawCommand)||(this._mixDrawCommand=this._createMixCommand(this,t)),t.context.draw(this._mixDrawCommand),this._hintLine.update(t,t.frameState,{}),t.context.draw({painter:t,framebuffer:t.mainPass.framebuffer.framebuffer,layer:{id:"Viewshed3DHintLine"},geometry:this._hintLine._geometry,material:this._hintLine._material}),e.RenderState.applyRenderState(t.context,e.RenderState.fromCache({viewport:{x:0,y:0,width:i,height:s}}));}_doAnalysis(t,i){if(!this._visible)return;const s=this._resultFrameBuffer[1];i.frameState.update({framebuffer:s}),i.frameState.bindFramebuffer(i.context),i.context.clear({color:e.Color.black}),e.defined(this._analysisCommand)||(this._analysisCommand=this._createAnalysisCommand(t,this,i)),t._analysisCommand.framebuffer=s.framebuffer,i.context.draw(t._analysisCommand),this._lastResultTexture=s._colorTextures[0];}_createAnalysisCommand(t,i,s){const r=new Map([["u_DepthTexture",()=>s.depthPass.framebuffer.getColorTexture(0).bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE)],["u_ViewshedDepthTexture",()=>t.viewshedPass.framebuffer.depthStencilTexture],["u_textureViewMatrix",()=>t._textureViewMatrix],["u_textureProjMatrix",()=>t._textureProjMatrix],["u_farDist",()=>t._distance],["u_ModelViewProjectionMatrix",()=>(new e.Matrix4).ortho({left:0,right:s.context.drawingBufferWidth,bottom:s.context.drawingBufferHeight,top:0,near:0,far:1})],["u_World",()=>new e.Vector2(s.context.drawingBufferWidth,s.context.drawingBufferHeight)],["u_CurrentFrustum",()=>(t._currentFrustum.x=s.transform.near,t._currentFrustum.y=s.transform.far,t._currentFrustum)]]);return {painter:s,framebuffer:void 0,layer:{id:"viewshedAnalysis"},geometry:new Fd(s),material:{renderState:e.RenderState.fromCache({depthTest:{enabled:!1},depthMask:!1}),_uniforms:r,_shaderSource:new e.ShaderSource({type:"viewshedAnalysis"})}}}_createMixCommand(t,i){const s=new Map([["u_resultTexture",()=>t._lastResultTexture],["u_visibleAreaColor",()=>e.Vector4.fromColor(t._visibleAreaColor,!1)],["u_hiddenAreaColor",()=>e.Vector4.fromColor(t._hiddenAreaColor,!1)],["u_ModelViewProjectionMatrix",()=>(new e.Matrix4).ortho({left:0,right:i.context.drawingBufferWidth,bottom:i.context.drawingBufferHeight,top:0,near:0,far:1})],["u_World",()=>new e.Vector2(i.context.drawingBufferWidth,i.context.drawingBufferHeight)]]);return {painter:i,framebuffer:i.mainPass.framebuffer.framebuffer,layer:{id:"viewshed"},geometry:new Fd(i),material:{renderState:{blending:e.renderStateEnum.enableBlending},_uniforms:s,_shaderSource:new e.ShaderSource({type:"viewshedMix"})}}}destroy(){return this._viewerPosition=void 0,this._direction=void 0,this._pitch=void 0,this._horizontalFov=void 0,this._verticalFov=void 0,this._distance=void 0,this._visibleAreaColor=void 0,this._hiddenAreaColor=void 0,this._aspectRatio=void 0,this._targetPoint=void 0,this._modelMatrix=void 0,this._hintLine.destroy(),this._hintLine=void 0,this._hintLineUpdated=void 0,this._lineColor=void 0,this._cameraUpdated=void 0,this._depthCamera=void 0,this.viewshedPass.destroy(),this.viewshedPass=void 0,this._initialized=void 0,this._visible=void 0,this._textureViewMatrix=void 0,this._textureProjMatrix=void 0,this._sceneDepthTexture=void 0,this._analysisCommand=void 0,this._mixDrawCommand=void 0,this._resultFrameBuffer=void 0,this._resultTextures=void 0,this._lastResultTexture=void 0,e.destroyObject(this)}}class kf{constructor(e){this._painter=e,this._viewshed3ds=[];}get length(){return this._viewshed3ds.length}add(t,i){if(!(t instanceof Gf))return console.error("The current addition is not of type Viewshed3D!"),!1;const s=e.defined(i);if(s){if(i<0)throw new Error("index must be greater than or equal to zero.");if(i>this._viewshed3ds.length)throw new Error("index must be less than or equal to the number of Viewshed3D.")}return s?this._viewshed3ds.splice(i,0,t):this._viewshed3ds.push(t),!0}getById(e){let t;return this._viewshed3ds.forEach((i=>{i.id===e&&(t=i);})),t}getByIndex(t){if(e.isNumber(t)&&!(t>this.length))return this._viewshed3ds[t]}indexOf(e){return this._viewshed3ds.indexOf(e)}remove(e){const t=this.indexOf(e);return -1!==t&&(this._painter.style.removePrimitive(e._hintLine),this._viewshed3ds.splice(t,1),!0)}removeById(e){const t=this.getById(e);this.remove(t);}removeByIndex(t){if(e.isNumber(t)){if(t<0)throw new Error("index must be greater than or equal to zero.");if(t>this._viewshed3ds.length)throw new Error("index must be less than or equal to the number of Viewshed3D.");const e=this.getByIndex(t);this.remove(e);}return !1}removeAll(){for(let e=0;e<this.length;e++)this._viewshed3ds[e].destroy();this._viewshed3ds=[];}update(e){for(let t=0;t<this.length;t++)this.getByIndex(t).update(e);}serialize(){const t=[];for(let i=0;i<this.length;i++){const s=this.getByIndex(i),r={viewerPosition:e.Vector3.pack(s.viewerPosition,new Array(3)),direction:s.direction,distance:s.distance,pitch:s.pitch,horizontalFov:s.horizontalFov,verticalFov:s.verticalFov,visibleAreaColor:e.Color.pack(s.visibleAreaColor,new Array(4)),hiddenAreaColor:e.Color.pack(s.hiddenAreaColor,new Array(4)),lineColor:e.Color.pack(s.lineColor,new Array(4))};t.push(r);}return t.length>0?t:void 0}}function Uf(t){return !function(t){return "undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return !1;var e,t,i=new Blob([""],{type:"text/javascript"}),s=URL.createObjectURL(i);try{t=new Worker(s),e=!0;}catch(t){e=!1;}return t&&t.terminate(),URL.revokeObjectURL(s),e}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return !1;var i=t.getImageData(0,0,1,1);return i&&i.width===e.width}()?(void 0===Hf[i=t&&t.failIfMajorPerformanceCaveat]&&(Hf[i]=function(t){var i,s=function(e){var t=document.createElement("canvas"),i=Object.create(Uf.webGLContextAttributes);return i.failIfMajorPerformanceCaveat=e,t.getContext("webgl",i)||t.getContext("experimental-webgl",i)}(t);if(!s)return !1;try{i=s.createShader(e.WebGLConstants.VERTEX_SHADER);}catch(e){return !1}return !(!i||s.isContextLost())&&(s.shaderSource(i,"void main() {}"),s.compileShader(i),!0===s.getShaderParameter(i,e.WebGLConstants.COMPILE_STATUS))}(i)),Hf[i]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var i;}(t)}var Hf={};Uf.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class zf{constructor(e){this.collection=[],this._map=e;}add(e){this.collection.push(e);}remove(e,t){if(!t)throw new Error("请输入minemap的Map实例化对象！");let i=-1;for(let t=0;t<this.collection.length;t++)this.collection[t].id===e&&(i=t);return -1!=i&&(this.collection[i].destroy(t),this.collection.splice(i,1),!0)}removeAll(){for(let e=0;e<this.collection.length;e++)this.collection[e].destroy(this._map);this.collection=[];}}class Wf{constructor(t){this._visibleColor=e.Color.parse(e.defaultValue(t.visibleColor,new e.Color(0,1,0,1))),this._hiddenColor=e.Color.parse(e.defaultValue(t.hiddenColor,new e.Color(1,0,0,1))),this._lineWidth=e.defaultValue(t.lineWidth,1),this._viewerPosition=new e.Vector3(e.defaultValue(t.viewerPosition,[0,0,0])),this._targetPointsMap=new Map,this._targets=[],this.targets=e.defaultValue(t.targets,this._targets),this._barrierPointMap=new Map,this._initialized=!1,this._resultTextures=[],this._mainCameraInvisibleDetection=!!t.mainCameraInvisibleDetection,this._indicatorSize=e.defaultValue(t.indicatorSize,10),this._indicatorColor=e.Color.parse(t.indicatorColor)||new e.Color(.5,0,0,1),this._indicatorOutlineColor=e.Color.parse(t.indicatorOutlineColor)||new e.Color(0,.6,1,.5),this._indicatorOutlineWidth=e.defaultValue(t.indicatorOutlineWidth,2),this.id=e.uuid();}get targets(){const t=[];return this._targetPointsMap.forEach(((i,s)=>{t.push({name:s,position:e.Vector3.pack(i.position,new Array(3))});})),t}set targets(e){if(e instanceof Array)for(let t=0;t<e.length;t++)this.addTargetPoint(e[t]);}set mainCameraInvisibleDetection(e){this._mainCameraInvisibleDetection=e;}get mainCameraInvisibleDetection(){return this._mainCameraInvisibleDetection}set indicatorSize(e){this._indicatorSize=e,this._addIndicator();}get indicatorSize(){return this._indicatorSize}set indicatorColor(t){this._indicatorColor=e.Color.parse(t),this._addIndicator();}get indicatorColor(){return this._indicatorColor}set indicatorOutlineColor(t){this._indicatorOutlineColor=e.Color.parse(t),this._addIndicator();}get indicatorOutlineColor(){return this._indicatorOutlineColor}set indicatorOutlineWidth(e){this._indicatorOutlineWidth=e,this._addIndicator();}get indicatorOutlineWidth(){return this._indicatorOutlineWidth}_addIndicator(){const t=e.Vector3.fromDegrees(this._viewerPosition.x,this._viewerPosition.y,this._viewerPosition.z);this.rtcModelMatrix=(new e.Matrix4).translate(t),this.rtcPosition=t,e.defined(this._pointIndicator)?(this._pointIndicator.remove(this._pointPrimitive,!0),this._pointPrimitive=new _h({show:!0,position:t,pixelSize:this._indicatorSize,color:this._indicatorColor,outlineColor:this._indicatorOutlineColor,outlineWidth:this._indicatorOutlineWidth}),this._pointIndicator.add(this._pointPrimitive)):(this._pointIndicator=new ph,this._pointPrimitive=new _h({show:!0,position:t,pixelSize:this._indicatorSize,color:this._indicatorColor,outlineColor:this._indicatorOutlineColor,outlineWidth:this._indicatorOutlineWidth}),this._pointIndicator.add(this._pointPrimitive));}_initialize(t){this._addIndicator();const i=this._targetPointsMap.values();for(;;){const s=i.next();if(s.done)break;const r=s.value;if(!e.defined(r.camera)){const t=e.Vector3.distance(e.Vector3.fromDegrees(this._viewerPosition.x,this._viewerPosition.y,this._viewerPosition.z),e.Vector3.fromDegrees(r.position.x,r.position.y,r.position.z));r.distance=t,r.camera=new a(60,1,.001*t,t);}e.defined(r.viewshedPass)||(r.viewshedPass=new Lf({camera:r.camera,context:t.context,width:2048,height:2048,passType:e.RenderPassConsts.VIEWSHED_PASS}));}this._initialized=!0;}get viewerPosition(){return this._viewerPosition}set viewerPosition(t){this._viewerPosition=new e.Vector3(t[0],t[1],t[2]);const i=this._targetPointsMap.values();for(;;){const e=i.next();if(e.done)break;e.value.needsUpdate=!0;}this._addIndicator();}set visibleColor(t){this._visibleColor=e.Color.parse(t);}get visibleColor(){return this._visibleColor}set hiddenColor(t){this._hiddenColor=e.Color.parse(t);}get hiddenColor(){return this._hiddenColor}addTargetPoint(t){if(!t.position)throw new Error("当前添加的点位数据为空",t,"method: addTargetPoint");this._targetPointsMap.set(t.name,{name:t.name,position:new e.Vector3(t.position),needsUpdate:!0}),this._initialized=!1;}updateTargetPoint(e){if(this._targetPointsMap.has(e.name)){const t=this._targetPointsMap.get(e.name);t.position=e.position,t.needsUpdate=!0;}}getBarrierPoint(e){return this._barrierPointMap.get(e)}removeTargetPoint(e){const t=this._barrierPointMap.get(e.name);return t?.viewshedPass?.destroy(),this._barrierPointMap.delete(e.name),this._targetPointsMap.delete(e.name)}removeAllTargetPoint(){const e=this._targetPointsMap.values();for(;;){const t=e.next();if(t.done)break;t.value.viewshedPass.destroy();}this._barrierPointMap.clear(),this._targetPointsMap.clear();}update(e){this._initialized||this._initialize(e),this._targetPointsMap.forEach(((t,i)=>{this._updateTargetPointCamera(i),t.viewshedPass.render(e);}));}render(t){const i=t.width,s=t.height;let r=!1;if(0===this._resultTextures.length||this._resultTextures[0].width!=i||this._resultTextures[0].height!=s){this._resultTextures=[],this._resultFrameBuffer=[],r=!0;const n=new e.Sampler({minificationFilter:e.TextureMinificationFilter.NEAREST,magnificationFilter:e.TextureMagnificationFilter.NEAREST});for(let r=0;r<2;++r){const r=new e.Texture({context:t.context,width:i,height:s,minFilter:e.WebGLConstants.NEAREST,magFilter:e.WebGLConstants.NEAREST,pixelFormat:e.PixelFormat.RGBA,pixelDatatype:e.PixelDatatype.UNSIGNED_BYTE,sampler:n,anisotropy:1});this._resultTextures.push(r);const o=new Yc({context:t.context,colorTextures:[r]});this._resultFrameBuffer.push(o);}}const n=t.context.bindFramebuffer.get();t.frameState.update({framebuffer:this._resultFrameBuffer[0]}),t.frameState.bindFramebuffer(t.context),t.context.clear({color:e.Color.black}),this._lastResultTexture=this._resultTextures[0];const o=this._targetPointsMap.values();t.frameState.update({framebuffer:this._resultFrameBuffer[1]}),t.frameState.bindFramebuffer(t.context),t.context.clear({color:e.Color.transparent});let a=!1;for(;;){const e=o.next();if(e.done)break;a=this._doAnalysis(e.value,t)||a;}e.RenderState.applyRenderState(t.context,e.RenderState.fromCache({viewport:{x:0,y:0,width:i*t._map.SSAASamples,height:s*t._map.SSAASamples}})),a&&(t.frameState.update({framebuffer:null}),t.frameState.bindFramebuffer(t.context),t.context.bindFramebuffer.set(n),e.defined(this._mixDrawCommand)&&!r||(this._mixDrawCommand=this._createMixCommand(this,t)),t.context.draw(this._mixDrawCommand)),this._pointIndicator.update(t);const l=this._pointIndicator.getTranslucentPrimitives();for(let e=0;e<l.length;e++)l[e].update(t,t.frameState,{}),l[e].framebuffer=t.mainPass.framebuffer.framebuffer;for(let e=0;e<l.length;e++)l[e].render(t,{id:"sightline-indicator"},t.frameState),l[e].framebuffer=null;e.RenderState.applyRenderState(t.context,e.RenderState.fromCache({viewport:{x:0,y:0,width:i,height:s}}));}_doAnalysis(t,i){if(e.defined(t._analysisCommand)||(t._analysisCommand=this._createAnalysisCommand(t,i)),i.transform.activeCamera.frustumCrate.cullingVolume.computeVisibility(t._analysisCommand.geometry.boundingSphere.clone().transform(this.rtcModelMatrix))===e.INTERSECTION.OUTSIDE)return this._visible=!1,!1;const s=this._resultFrameBuffer[1];return t._analysisCommand.framebuffer=s.framebuffer,i.context.draw(t._analysisCommand),this._lastResultTexture=s._colorTextures[0],!0}_createAnalysisCommand(t,i){const s=this,r=new Map([["u_DepthTexture",()=>i.depthPass.framebuffer.getColorTexture(0).bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE)],["u_ViewshedDepthTexture",()=>t.viewshedPass.framebuffer.depthStencilTexture],["u_HiddenColor",()=>e.Vector4.fromColor(s._hiddenColor,!1)],["u_VisibleColor",()=>e.Vector4.fromColor(s._visibleColor,!1)],["u_ModelViewProjectionMatrix",()=>i.transform.activeCamera.getVPMatrix().multiplyRight(s.rtcModelMatrix)],["u_ModelViewProjectionMatrixOnViewshed",()=>t.camera.getVPMatrix().multiplyRight(s.rtcModelMatrix)],["u_MainCameraDetection",()=>s._mainCameraInvisibleDetection]]),n=e.Vector3.fromDegreesArrayHeights([...this._viewerPosition,...t.position]),o=new $u({positions:n,width:10,arcType:e.ARCTYPE.NONE,referenceCenter:new e.Vector3(s.rtcPosition)});return o.update({painter:i}),{painter:i,framebuffer:void 0,layer:{id:"sightlineAnalysis"},geometry:o,material:{renderState:{depthTest:{enabled:!1},depthMask:!1,blending:e.renderStateEnum.disableBlending},_uniforms:r,_shaderSource:new e.ShaderSource({type:"sightlineAnalysis"})}}}_createMixCommand(t,i){const s=this,r=new Map([["u_resultTexture",()=>s._lastResultTexture],["u_ModelViewProjectionMatrix",()=>(new e.Matrix4).ortho({left:0,right:i.context.drawingBufferWidth,bottom:i.context.drawingBufferHeight,top:0,near:0,far:1})],["u_World",()=>new e.Vector2(i.context.drawingBufferWidth,i.context.drawingBufferHeight)],["u_HiddenColor",()=>e.Vector4.fromColor(s._hiddenColor,!1)],["u_VisibleColor",()=>e.Vector4.fromColor(s._visibleColor,!1)]]);return {painter:i,framebuffer:i.mainPass.framebuffer.framebuffer,layer:{id:"sightlineMix"},geometry:new Fd(i),material:{renderState:{blending:e.renderStateEnum.enableBlending},_uniforms:r,_shaderSource:new e.ShaderSource({type:"sightlineMix",defines:{LINE_WIDTH:this._lineWidth}})}}}_updateTargetPointCamera(t){const i=this._targetPointsMap.get(t),s=this._getHeadingPitch(i.position),r=e.Vector3.fromDegrees(this._viewerPosition.x,this._viewerPosition.y,this._viewerPosition.z),n=e.Transforms.headingPitchRollToFixedFrame(r,new e.HeadingPitchRoll(e.CONSTS.CesiumMath.toRadians(s.x),e.CONSTS.CesiumMath.toRadians(s.y),0)),o=e.Vector3.distance(r,e.Vector3.fromDegrees(i.position.x,i.position.y,i.position.z));i.distance=o,i.camera.updatePerspectiveOptions({near:.5,far:o<=1?1:o}),i.camera.setMatrix(n);}_getHeadingPitch(t){const i=new e.Vector3,s=e.Transforms.eastNorthUpToFixedFrame(e.Vector3.fromDegrees(this._viewerPosition.x,this._viewerPosition.y,this._viewerPosition.z));e.Matrix4.inverse(s,s),e.Matrix4.multiplyByPoint(s,e.Vector3.fromDegrees(t.x,t.y,t.z),i),e.Vector3.normalize(i,i);let r=e.CONSTS.CesiumMath.toDegrees(Math.atan2(i.x,i.y));r=(r>=0?r:r+=360)<360?r:r-=360;const n=e.CONSTS.CesiumMath.toDegrees(Math.asin(i.z))+90;return new e.Vector2(r,n)}destroy(){this.removeAllTargetPoint(),this._mixDrawCommand&&(this._mixDrawCommand.geometry.destroy(),this._mixDrawCommand.material=void 0),this._pointIndicator.removeAll(!0);for(let e=0;e<this._resultFrameBuffer.length;e++)this._resultFrameBuffer[e].destroy();this._resultFrameBuffer=[];for(let e=0;e<this._resultTextures.length;e++)this._resultTextures[e].destroy();this._resultTextures=[],this._visibleColor=null,this._hiddenColor=null,this._viewerPosition=null;}}class jf{constructor(e){this._painter=e,this._sightlines=[];}get length(){return this._sightlines.length}add(t,i){if(!(t instanceof Wf))return console.error("The current addition is not of type Sightline!"),!1;const s=e.defined(i);if(s){if(i<0)throw new Error("index must be greater than or equal to zero.");if(i>this._sightlines.length)throw new Error("index must be less than or equal to the number of Sightline.")}return s?this._sightlines.splice(i,0,t):this._sightlines.push(t),!0}getById(e){let t;return this._sightlines.forEach((i=>{i.id===e&&(t=i);})),t}getByIndex(t){if(e.isNumber(t)&&!(t>this.length))return this._sightlines[t]}indexOf(e){return this._sightlines.indexOf(e)}remove(e){const t=this.indexOf(e);return -1!==t&&(this._sightlines.splice(t,1),e.destroy(),!0)}removeById(e){const t=this.getById(e);this.remove(t);}removeByIndex(t){if(e.isNumber(t)){if(t<0)throw new Error("index must be greater than or equal to zero.");if(t>this._sightlines.length)throw new Error("index must be less than or equal to the number of Sightline.");const e=this.getByIndex(t);this.remove(e);}return !1}removeAll(){for(;this.length>0;)this.removeByIndex(0);this._sightlines=[];}update(e){for(let t=0;t<this.length;t++)this.getByIndex(t).update(e);}serialize(){const t=[];for(let i=0;i<this.length;i++){const s=this.getByIndex(i),r={viewerPosition:e.Vector3.pack(s.viewerPosition,new Array(3)),targets:s.targets,visibleColor:e.Color.pack(s.visibleColor,new Array(4)),hiddenColor:e.Color.pack(s.hiddenColor,new Array(4)),indicatorSize:s.indicatorSize,indicatorColor:e.Color.pack(s.indicatorColor,new Array(4)),indicatorOutlineColor:e.Color.pack(s.indicatorOutlineColor,new Array(4)),indicatorOutlineWidth:s.indicatorOutlineWidth,mainCameraInvisibleDetection:s.mainCameraInvisibleDetection};t.push(r);}return t.length>0?t:void 0}}class Xf extends xf{constructor(t){if(t=e.defined(t)?t:{},e.defined(t.validColor)&&!(t.validColor instanceof e.Color)&&"string"!=typeof t.validColor)throw new Error("'validColor' type must be Color or String!");const i=e.Color.parse(e.defaultValue(t.validColor,new e.Color(0,1,0,1)));if(e.defined(t.validOpacity)&&!e.isNumber(t.validOpacity))throw new Error("'validOpacity' option must be a number!");const s=e.defaultValue(t.validOpacity,.5);if(e.defined(t.validOutlineColor)&&!(t.validOutlineColor instanceof e.Color)&&"string"!=typeof t.validOutlineColor)throw new Error("'validOutlineColor' type must be Color or String!");const r=e.Color.parse(e.defaultValue(t.validOutlineColor,new e.Color(0,0,0,1)));if(e.defined(t.validOutlineOpacity)&&!e.isNumber(t.validOutlineOpacity))throw new Error("'validOutlineOpacity' option must be a number!");const n=e.defaultValue(t.validOutlineOpacity,1);if(e.defined(t.invalidColor)&&!(t.invalidColor instanceof e.Color)&&"string"!=typeof t.invalidColor)throw new Error("'invalidColor' type must be Color or String!");if(t.color=e.Color.parse(e.defaultValue(t.invalidColor,new e.Color(1,0,0,1))),e.defined(t.invalidOpacity)&&!e.isNumber(t.invalidOpacity))throw new Error("'invalidOpacity' option must be a number!");if(t.opacity=e.defaultValue(t.invalidOpacity,.5),e.defined(t.baseHeight)&&!e.isNumber(t.baseHeight))throw new Error("'baseHeight' must be a number");const o=e.defaultValue(t.baseHeight,void 0);if(e.defined(t.limitHeight)&&!e.isNumber(t.limitHeight))throw new Error("'limitHeight' must be a number");const a=e.defaultValue(t.limitHeight,0);if(e.defined(t.positions)){if(!(t.positions instanceof Array))throw new Error("'positions' is not type of Array!");if(0!==t.positions.length&&t.positions.length<3)throw new Error("'positions' length must greater than 2!")}const l=e.defaultValue(t.positions,[]);if(e.defined(t.extrudeValidArea)&&!e.isBoolean(t.extrudeValidArea))throw new Error("'extrudeValidArea' option must be true or false!");const h=e.defaultValue(t.extrudeValidArea,!0);super(t),this._extrudeValidArea=h,this._validColor=i,this._validOpacity=s,this._validMaterial=e.StandardMaterial.fromType("Color",{color:this._validColor,opacity:this._validOpacity,lightingModel:e.LightingModelType.NONE,doubleSided:!0}),this._validGeometryUpdated=!1,this._validMaterialUpdated=!1,this._validOutlineColor=r,this._validOutlineOpacity=n,this._validOutlineMaterial=e.StandardMaterial.fromType("Color",{color:this._validOutlineColor,opacity:this._validOutlineOpacity,lightingModel:e.LightingModelType.NONE,doubleSided:!0}),this._validOutlineGeometryUpdated=!1,this._validOutlineMaterialUpdated=!1,this._baseHeight=o,this._limitHeight=a,this.positions=l;}get invalidColor(){return this._color}set invalidColor(e){this.color=e;}get invalidOpacity(){return this._opacity}set invalidOpacity(e){this.opacity=e;}get validColor(){return this._validColor}set validColor(t){if(!(t instanceof e.Color||"string"==typeof t))throw new Error("'validColor' type must be Color or String!");this._validColor=e.Color.parse(t),this._validMaterialUpdated=!1;}get validOpacity(){return this._validOpacity}set validOpacity(t){if(!e.isNumber(t))throw new Error("'validOpacity' option must be a number!");this._validOpacity=t,this._validMaterialUpdated=!1;}get validOutlineColor(){return this._validOutlineColor}set validOutlineColor(t){if(!(t instanceof e.Color||"string"==typeof t))throw new Error("'validOutlineColor' type must be Color or String!");this._validOutlineColor=e.Color.parse(t),this._validOutlineMaterialUpdated=!1;}get validOutlineOpacity(){return this._validOutlineOpacity}set validOutlineOpacity(t){if(!e.isNumber(t))throw new Error("'validOutlineOpacity' option must be a number!");this._validOutlineOpacity=t,this._validOutlineMaterialUpdated=!1;}get baseHeight(){return this._baseHeight}set baseHeight(t){if(e.isNumber(t))this._baseHeight=t,this.geometry=Xf.createInvalidArea(this._positions,this._baseHeight,this._limitHeight),this._createValidArea();else {if(t)throw new Error("baseHeight must be a number or empty");if(0===this._positions.length)this._baseHeight=void 0;else {let t=+Number.MAX_VALUE;for(let i=0;i<this._positions.length;i++){const s=e.Cartographic.fromVector3(this._positions[i]).height;t=Math.min(t,s);}this._baseHeight=t;}this.geometry=Xf.createInvalidArea(this._positions,this._baseHeight,this._limitHeight),this._createValidArea();}}get positions(){return this._positions}set positions(t){if(!(t instanceof Array))throw new Error("positions is not type of Array!");if(0!==t.length&&t.length<3)throw new Error("positions' length must greater than 2!");if(0!==t.length&&!this._baseHeight){let i=+Number.MAX_VALUE;for(let s=0;s<t.length;s++){const r=e.Cartographic.fromVector3(t[s]).height;i=Math.min(i,r);}this._baseHeight=i;}this._positions=t,this.geometry=Xf.createInvalidArea(this._positions,this._baseHeight,this._limitHeight),this._createValidArea();}get limitHeight(){return this._limitHeight}set limitHeight(t){if(!e.isNumber(t))throw new Error("limitHeight must be a number");this._limitHeight=t,this.geometry=Xf.createInvalidArea(this._positions,this._baseHeight,this._limitHeight),this._createValidArea();}get extrudeValidArea(){return this._extrudeValidArea}set extrudeValidArea(t){if(!e.isBoolean(t))throw new Error("'extrudeValidArea' option must be true or false!");this._extrudeValidArea=t,this._createValidArea();}_createValidArea(){const{polygon:e,outline:t}=Xf.createValidArea(this._positions,this._baseHeight,this._limitHeight,this._extrudeValidArea);this._validGeometry=e,this._validGeometryUpdated=!1,this._validOutlineGeometry=t,this._validOutlineGeometryUpdated=!1;}update(){super.update(),this._validArea?(this._validGeometryUpdated||(this._validArea._geometry=this._validGeometry,this._validGeometryUpdated=!0),this._validMaterialUpdated||(this._validMaterial.updateProperty({color:this._validColor,opacity:this._validOpacity}),this._validMaterialUpdated=!0)):(this._validArea=new e.Primitive({geometry:this._validGeometry,material:this._validMaterial}),this._validGeometryUpdated=!0,this._validMaterialUpdated=!0),this._validOutline?(this._validOutlineGeometryUpdated||(this._validOutline._geometry=this._validOutlineGeometry,this._validOutlineGeometryUpdated=!0),this._validOutlineMaterialUpdated||(this._validOutlineMaterial.updateProperty({color:this._validOutlineColor,opacity:this._validOutlineOpacity}),this._validOutlineMaterialUpdated=!0)):(this._validOutline=new e.Primitive({geometry:this._validOutlineGeometry,material:this._validOutlineMaterial}),this._validOutlineGeometryUpdated=!0,this._validOutlineMaterialUpdated=!0);}render(e){super.render(e),this._enabled&&(this._validArea.framebuffer=e.mainPass.framebuffer.framebuffer,this._validArea.update(e,e.frameState),this._validArea.render(e,{id:"validArea"},e.frameState),this._validArea.framebuffer=null,this._validOutline.framebuffer=e.mainPass.framebuffer.framebuffer,this._validOutline.update(e,e.frameState),this._validOutline.render(e,{id:"validOutline"},e.frameState),this._validOutline.framebuffer=null);}destroy(){super.destroy(),this._positions=void 0,this._baseHeight=void 0,this._limitHeight=void 0,this._validArea&&this._validArea instanceof e.Primitive?this._validArea.destroy():(this._validGeometry&&this._validGeometry instanceof e.Geometry&&this._validGeometry.destroy(),this._validMaterial&&this._validMaterial instanceof e.Material&&this._validMaterial.destroy()),this._validOutline&&this._validOutline instanceof e.Primitive?this._validOutline.destroy():(this._validOutlineGeometry&&this._validOutlineGeometry instanceof e.Geometry&&this._validOutlineGeometry.destroy(),this._validOutlineMaterial&&this._validOutlineMaterial instanceof e.Material&&this._validOutlineMaterial.destroy()),this._extrudeValidArea=void 0,this._validColor=void 0,this._validOpacity=void 0,this._validArea=void 0,this._validGeometry=void 0,this._validMaterial=void 0,this._validGeometryUpdated=void 0,this._validMaterialUpdated=void 0,this._validOutlineColor=void 0,this._validOutlineOpacity=void 0,this._validOutlineGeometry=void 0,this._validOutlineMaterial=void 0,this._validOutlineGeometryUpdated=void 0,this._validOutlineMaterialUpdated=void 0;}static createValidArea(t,i,s,r=!0){if(0===t.length)return {polygon:new e.PolygonGeometry({polygonHierarchy:{positions:[]},arcType:e.ARCTYPE.GEODESIC}),outline:new vf({polygonHierarchy:{positions:[]},arcType:e.ARCTYPE.GEODESIC})};if(r){let r=[];for(let s=0;s<t.length;s++){const n=e.Transforms.cartesian3ToCartographic(t[s]);r=r.concat([n[0],n[1],i]);}return r=e.Vector3.fromDegreesArrayHeights(r),{polygon:new e.PolygonGeometry({polygonHierarchy:{positions:r},perPositionHeight:!0,extrudedHeight:i+s,arcType:e.ARCTYPE.GEODESIC}),outline:new vf({polygonHierarchy:{positions:r},perPositionHeight:!0,extrudedHeight:i+s,arcType:e.ARCTYPE.GEODESIC})}}return {polygon:new e.PolygonGeometry({polygonHierarchy:{positions:t},height:i+s,arcType:e.ARCTYPE.GEODESIC}),outline:new vf({polygonHierarchy:{positions:t},height:i+s,arcType:e.ARCTYPE.GEODESIC})}}static createInvalidArea(t,i,s){if(0===t.length)return new e.PolygonGeometry({polygonHierarchy:{positions:[]},arcType:e.ARCTYPE.GEODESIC});let r=[];for(let n=0;n<t.length;n++){const o=e.Transforms.cartesian3ToCartographic(t[n]);r=r.concat([o[0],o[1],i+s]);}return r=e.Vector3.fromDegreesArrayHeights(r),new e.PolygonGeometry({polygonHierarchy:{positions:r},perPositionHeight:!0,extrudedHeight:1e4,arcType:e.ARCTYPE.GEODESIC})}}class qf{constructor(e){this._painter=e,this._highlights=[];}get length(){return this._highlights.length}add(t,i){if(!(t instanceof xf))return console.error("The current addition is not of type Highlight!"),!1;const s=e.defined(i);if(s){if(i<0)throw new Error("index must be greater than or equal to zero.");if(i>this._highlights.length)throw new Error("index must be less than or equal to the number of Highlight.")}return s?this._highlights.splice(i,0,t):this._highlights.push(t),!0}getById(e){let t;return this._highlights.forEach((i=>{i.id===e&&(t=i);})),t}getByIndex(t){if(e.isNumber(t)&&!(t>this.length))return this._highlights[t]}indexOf(e){return this._highlights.indexOf(e)}remove(e){const t=this.indexOf(e);return -1!==t&&(this._highlights.splice(t,1),e.destroy(),!0)}removeById(e){const t=this.getById(e);this.remove(t);}removeByIndex(t){if(e.isNumber(t)){if(t<0)throw new Error("index must be greater than or equal to zero.");if(t>this._highlights.length)throw new Error("index must be less than or equal to the number of Highlight.");const e=this.getByIndex(t);this.remove(e);}return !1}removeAll(){for(;this.length>0;)this.removeByIndex(0);this._highlights=[];}update(e){for(let t=0;t<this.length;t++)this.getByIndex(t).update(e);}serialize(){const t=[];for(let i=0;i<this.length;i++){const s=this.getByIndex(i),r=[];for(let t=0;t<s.positions.length;t++)r.push(e.Vector3.pack(s.positions[t],new Array(3)));const n={positions:r,baseHeight:s.baseHeight,limitHeight:s.limitHeight,invalidColor:e.Color.pack(s.invalidColor,new Array(4)),invalidOpacity:s.invalidOpacity,validColor:e.Color.pack(s.validColor,new Array(4)),validOpacity:s.validOpacity,validOutlineColor:e.Color.pack(s.validOutlineColor,new Array(4)),validOutlineOpacity:s.validOutlineOpacity,extrudeValidArea:s.extrudeValidArea,enabled:s.enabled};t[i]=n;}return t.length>0?t:void 0}}const Kf="geometry的数据更新已经全面采用了setData,参数不变，方法名变更了，建议修改";class Jf extends e.Geometry{constructor(e){super(e),this.type="BoxGeometry",this.setData(e);}parse(){super.parse(),this.indices=[],this.vertices=[],this.normals=[],this.uvs=[],this.needUpdate=!0,this._ready=!0,this.numberOfVertices=0,this.groupStart=0,this.buildPlane("z","y","x",-1,-1,this.depth,this.height,this.width,this.depthSegments,this.heightSegments,0),this.buildPlane("z","y","x",1,-1,this.depth,this.height,-this.width,this.depthSegments,this.heightSegments,1),this.buildPlane("x","z","y",1,1,this.width,this.depth,this.height,this.widthSegments,this.depthSegments,2),this.buildPlane("x","z","y",1,-1,this.width,this.depth,-this.height,this.widthSegments,this.depthSegments,3),this.buildPlane("x","y","z",1,-1,this.width,this.height,this.depth,this.widthSegments,this.heightSegments,4),this.buildPlane("x","y","z",-1,-1,this.width,this.height,-this.depth,this.widthSegments,this.heightSegments,5);for(let e=0;e<this.indices.length;e+=3)this._indices.emplaceBack(this.indices[e],this.indices[e+1],this.indices[e+2]);this.emplaceVertexBufferTriangle();}buildPlane(t,i,s,r,n,o,a,l,h,_,c){const u=o/h,d=a/_,m=o/2,p=a/2,f=l/2,g=h+1,y=_+1;let C,T,x=0,b=0;const v=new e.Vector3;for(T=0;T<y;T++){const e=T*d-p;for(C=0;C<g;C++)v[t]=(C*u-m)*r,v[i]=e*n,v[s]=f,this.vertices.push(v.x,v.y,v.z),v[t]=0,v[i]=0,v[s]=l>0?1:-1,this.normals.push(v.x,v.y,v.z),this.uvs.push(C/h),this.uvs.push(1-T/_),x+=1;}for(T=0;T<_;T++)for(C=0;C<h;C++){const e=this.numberOfVertices+C+g*(T+1),t=this.numberOfVertices+(C+1)+g*(T+1),i=this.numberOfVertices+(C+1)+g*T;this.indices.push(this.numberOfVertices+C+g*T,e,i),this.indices.push(e,t,i),b+=6;}this.groupStart+=b,this.numberOfVertices+=x;}setData(t){this.width=t.width?t.width:1,this.height=t.height?t.height:1,this.depth=t.depth?t.depth:1,this.widthSegments=t.widthSegments?Math.floor(t.widthSegments):1,this.heightSegments=t.heightSegments?Math.floor(t.heightSegments):1,this.depthSegments=t.depthSegments?Math.floor(t.depthSegments):1,this._usedDoublePrecision=!1,this._vertexArray?(this._vertexArray.clear(),this._indices.clear()):(this._vertexArray=this._usedDoublePrecision?new e.StructArrayLayout11f44:new e.StructArrayLayout3f2f3f32,this._indices=new e.StructArrayLayout3ui6),this._ready=!1,this.primitiveType=e.WebGLConstants.TRIANGLES,this.parse(),this.computeBoundingSphere(),this.computeBoundingBox();}updateBoxGeometry(e){console.warn(Kf),this.setData(e);}update(t){if(this._ready&&this.needUpdate&&t.painter){this._ready=!1,this.needUpdate=!1;const i=t.painter.context;this._vertBuffer&&this._indexBuffer?(this._vertBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indices)):(this._vertBuffer=i.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?e.layout.members:e.layout$1.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indices,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/3);}}serialize(){return {type:this.type,width:this.width,height:this.height,depth:this.depth}}destroy(){super.destroy(),this.width=void 0,this.height=void 0,this.depth=void 0,this.widthSegments=void 0,this.heightSegments=void 0,this.depthSegments=void 0,this.type=void 0,this._vertexArray=void 0,this._indices=void 0,this._ready=void 0,this.needUpdate=void 0,this.primitiveType=void 0;}}class Zf extends e.Geometry{constructor(t){super(t),this.type="ConeGeometry",this.primitiveType=e.WebGLConstants.TRIANGLES,this.setData(t);}setData(t){super.setData(t),this.radiusTop=0,this.radiusBottom=t.radiusBottom?t.radiusBottom:0,this.height=t.height?t.height:1,this.radialSegments=Math.floor(t.radialSegments?t.radialSegments:8),this.heightSegments=Math.floor(t.heightSegments?t.heightSegments:1),this.openEnded=!!t.openEnded&&t.openEnded,this.thetaStart=t.thetaStart?t.thetaStart:0,this.thetaLength=t.thetaLength?t.thetaLength:2*Math.PI,this._vertexArray?(this._vertexArray.clear(),this._indices.clear()):(this._vertexArray=new e.StructArrayLayout3f2f3f32,this._indices=new e.StructArrayLayout3ui6),this._ready=!1,this.parse(),this.computeBoundingSphere(),this.computeBoundingBox();}parse(){this._createGeometry(),this._ready=!0,this.needUpdate=!0;for(let e=0;e<this.indices.length;e+=3)this._indices.emplaceBack(this.indices[e],this.indices[e+1],this.indices[e+2]);for(let e=0;e<this.normals.length/3;e++)this._vertexArray.emplaceBack(this.vertices[3*e],this.vertices[3*e+1],this.vertices[3*e+2],this.uvs[2*e],this.uvs[2*e+1],this.normals[3*e],this.normals[3*e+1],this.normals[3*e+2]);}_createGeometry(){this.indices=[],this.vertices=[],this.normals=[],this.uvs=[],this.index=0,this.indexArray=[],this.halfHeight=this.height/2,this.generateTorso(),!1===this.openEnded&&(this.radiusTop>0&&this.generateCap(!0),this.radiusBottom>0&&this.generateCap(!1));}generateTorso(){const t=new e.Vector3,i=new e.Vector3,s=(this.radiusBottom-this.radiusTop)/this.height;for(let e=0;e<=this.heightSegments;e++){const r=[],n=e/this.heightSegments,o=n*(this.radiusBottom-this.radiusTop)+this.radiusTop;for(let e=0;e<=this.radialSegments;e++){const a=e/this.radialSegments,l=a*this.thetaLength+this.thetaStart,h=Math.sin(l),_=Math.cos(l);i.x=o*h,i.y=-n*this.height+this.halfHeight,i.z=o*_,this.vertices.push(i.x,i.y,i.z),t.set(h,s,_).normalize(),this.normals.push(t.x,t.y,t.z),this.uvs.push(a,1-n),r.push(this.index++);}this.indexArray.push(r);}for(let e=0;e<this.radialSegments;e++)for(let t=0;t<this.heightSegments;t++){const i=this.indexArray[t+1][e],s=this.indexArray[t+1][e+1],r=this.indexArray[t][e+1];this.indices.push(this.indexArray[t][e],i,r),this.indices.push(i,s,r);}}generateCap(t){const i=this.index,s=new e.Vector2,r=new e.Vector3,n=!0===t?this.radiusTop:this.radiusBottom,o=!0===t?1:-1;for(let e=1;e<=this.radialSegments;e++)this.vertices.push(0,this.halfHeight*o,0),this.normals.push(0,o,0),this.uvs.push(.5,.5),this.index++;const a=this.index;for(let e=0;e<=this.radialSegments;e++){const t=e/this.radialSegments*this.thetaLength+this.thetaStart,i=Math.cos(t),a=Math.sin(t);r.x=n*a,r.y=this.halfHeight*o,r.z=n*i,this.vertices.push(r.x,r.y,r.z),this.normals.push(0,o,0),s.x=.5*i+.5,s.y=.5*a*o+.5,this.uvs.push(s.x,s.y),this.index++;}for(let e=0;e<this.radialSegments;e++){const s=i+e,r=a+e;!0===t?this.indices.push(r,r+1,s):this.indices.push(r+1,r,s);}}updateConeGeometry(e){console.warn(Kf),this.setData(e);}update(t){if(this._ready&&this.needUpdate&&t.painter){this.needUpdate=!1;const i=t.painter.context;this._vertBuffer&&this._indexBuffer?(this._vertBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indices)):(this._vertBuffer=i.createVertexBuffer(this._vertexArray,e.layout$1.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indices,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/3);}}serialize(){return {type:this.type,radiusTop:this.radiusTop,radiusBottom:this.radiusBottom,height:this.height,radialSegments:this.radialSegments,heightSegments:this.heightSegments,openEnded:this.openEnded,thetaStart:this.thetaStart,thetaLength:this.thetaLength}}destroy(){super.destroy(),this._ready=void 0,this.needUpdate=void 0,this._vertexArray=void 0,this.indices=void 0,this.vertices=void 0,this.uvs=void 0;}}class Yf extends e.Geometry{constructor(t){super(t),this.type="CylinderGeometry",this.primitiveType=e.WebGLConstants.TRIANGLES,this.setData(t);}setData(t){super.setData(t),this.radiusTop=t.radiusTop?t.radiusTop:0,this.radiusBottom=t.radiusBottom?t.radiusBottom:0,this.height=t.height?t.height:1,this.radialSegments=Math.floor(t.radialSegments?t.radialSegments:8),this.heightSegments=Math.floor(t.heightSegments?t.heightSegments:1),this.openEnded=!!t.openEnded&&t.openEnded,this.thetaStart=t.thetaStart?t.thetaStart:0,this.thetaLength=t.thetaLength?t.thetaLength:2*Math.PI,this._usedDoublePrecision=!1,this._vertexArray?(this._vertexArray.clear(),this._indices.clear()):(this._vertexArray=this._usedDoublePrecision?new e.StructArrayLayout11f44:new e.StructArrayLayout3f2f3f32,this._indices=new e.StructArrayLayout3ui6),this._ready=!1,this.parse(),this.computeBoundingSphere(),this.computeBoundingBox();}parse(){this._createGeometry(),this._ready=!0,this.needUpdate=!0;for(let e=0;e<this.indices.length;e+=3)this._indices.emplaceBack(this.indices[e],this.indices[e+1],this.indices[e+2]);this.emplaceVertexBufferTriangle();}_createGeometry(){this.indices=[],this.vertices=[],this.normals=[],this.uvs=[],this.index=0,this.indexArray=[],this.halfHeight=this.height/2,this.generateTorso(),!1===this.openEnded&&(this.radiusTop>0&&this.generateCap(!0),this.radiusBottom>0&&this.generateCap(!1));}generateTorso(){const t=new e.Vector3,i=new e.Vector3,s=(this.radiusBottom-this.radiusTop)/this.height;for(let e=0;e<=this.heightSegments;e++){const r=[],n=e/this.heightSegments,o=n*(this.radiusBottom-this.radiusTop)+this.radiusTop;for(let e=0;e<=this.radialSegments;e++){const a=e/this.radialSegments,l=a*this.thetaLength+this.thetaStart,h=Math.sin(l),_=Math.cos(l);i.x=o*h,i.y=-n*this.height+this.halfHeight,i.z=o*_,this.vertices.push(i.x,i.y,i.z),t.set(h,s,_).normalize(),this.normals.push(t.x,t.y,t.z),this.uvs.push(a,1-n),r.push(this.index++);}this.indexArray.push(r);}for(let e=0;e<this.radialSegments;e++)for(let t=0;t<this.heightSegments;t++){const i=this.indexArray[t+1][e],s=this.indexArray[t+1][e+1],r=this.indexArray[t][e+1];this.indices.push(this.indexArray[t][e],i,r),this.indices.push(i,s,r);}}generateCap(t){const i=this.index,s=new e.Vector2,r=new e.Vector3,n=!0===t?this.radiusTop:this.radiusBottom,o=!0===t?1:-1;for(let e=1;e<=this.radialSegments;e++)this.vertices.push(0,this.halfHeight*o,0),this.normals.push(0,o,0),this.uvs.push(.5,.5),this.index++;const a=this.index;for(let e=0;e<=this.radialSegments;e++){const t=e/this.radialSegments*this.thetaLength+this.thetaStart,i=Math.cos(t),a=Math.sin(t);r.x=n*a,r.y=this.halfHeight*o,r.z=n*i,this.vertices.push(r.x,r.y,r.z),this.normals.push(0,o,0),s.x=.5*i+.5,s.y=.5*a*o+.5,this.uvs.push(s.x,s.y),this.index++;}for(let e=0;e<this.radialSegments;e++){const s=i+e,r=a+e;!0===t?this.indices.push(r,r+1,s):this.indices.push(r+1,r,s);}}update(t){if(this._ready&&this.needUpdate&&t.painter){this.needUpdate=!1;const i=t.painter.context;this._vertBuffer&&this._indexBuffer?(this._vertBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indices)):(this._vertBuffer=i.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?e.layout.members:e.layout$1.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indices,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/3);}}serialize(){return {type:this.type,radiusTop:this.radiusTop,radiusBottom:this.radiusBottom,height:this.height,radialSegments:this.radialSegments,heightSegments:this.heightSegments,openEnded:this.openEnded,thetaStart:this.thetaStart,thetaLength:this.thetaLength}}destroy(){super.destroy(),this._ready=!1,this.needUpdate=!1,this.indices=null,this.vertices=null,this.uvs=null,this.vertices=null;}}class Qf extends e.Geometry{constructor(t){super(),this.primitiveType=e.WebGLConstants.TRIANGLES,this.type="FenceGeometry",this.setData(t);}setData(t){if(super.setData(t),!e.defined(t.positions))throw new Error("options.positions is required.");if(e.defined(t.maximumHeights)&&t.maximumHeights.length!==t.positions.length)throw new Error("options.positions and options.maximumHeights must have the same length.");if(e.defined(t.minimumHeights)&&t.minimumHeights.length!==t.positions.length)throw new Error("options.positions and options.minimumHeights must have the same length.");if(this._positions=t.positions,this._maximumHeights=t.maximumHeights,this._minimumHeights=t.minimumHeights,this._granularity=e.defaultValue(t.granularity,e.CONSTS.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=e.defaultValue(t.ellipsoid,e.Ellipsoid.WGS84),this.vertices=void 0,this.indices=void 0,this.normals=void 0,this.uvs=void 0,this._evennessUV=[],this._needUpdate=!0,this._usedDoublePrecision=!0,this._vertexArray?(this._vertexArray.clear(),this._indices.clear()):(this._vertexArray=this._usedDoublePrecision?new e.StructArrayLayout11f44:new e.StructArrayLayout3f2f3f32,this._indices=new e.StructArrayLayout3ui6),t.useEvennessUV){this._evennessUV.push(0,0,0,1);const t=[0];for(let i=1;i<this._positions.length;i++){const s=t[i-1]+e.Vector3.distance(this._positions[i-1],this._positions[i]);t.push(s);}for(let e=1;e<t.length-1;e++){const i=t[e]/t[t.length-1];this._evennessUV.push(i,0,i,1,i,0,i,1);}this._evennessUV.push(1,0,1,1);}this._parse(),this.computeBoundingSphere(),this.computeBoundingBox();}static fromConstantHeights(t){const i=t.positions;if(!e.defined(i))throw new Error("options.positions is required.");let s,r;const n=t.minimumHeight,o=t.maximumHeight,a=e.defaultValue(t.useEvennessUV,!1),l=e.defined(n),h=e.defined(o);if(l||h){const e=i.length;s=l?new Array(e):void 0,r=h?new Array(e):void 0;for(let t=0;t<e;++t)l&&(s[t]=n),h&&(r[t]=o);}return new Qf({positions:i,maximumHeights:r,minimumHeights:s,useEvennessUV:a})}_parse(){const t=new e.Vector3,i=new e.Vector3,s=new e.Vector3,r=new e.Vector3,n=this._ellipsoid,o=Af.computePositions(n,this._positions,this._maximumHeights,this._minimumHeights,this._granularity,!0);if(!e.defined(o))return;const a=o.bottomPositions,l=o.topPositions,h=o.numCorners;let _=l.length,c=2*_,u=0;for(let t=0;t<_/3;t++)u=Math.max(u,e.Vector3.distance(e.Vector3.fromArray(l,3*t),e.Vector3.fromArray(a,3*t)));const d=new Float64Array(c),m=new Float32Array(c),p=new Float32Array(c/3*2);let f,g=0,y=0,C=0,T=new e.Vector3,x=!0;_/=3;let b=0;const v=1/(_-h-1);for(f=0;f<_;++f){const o=3*f,h=e.Vector3.fromArray(l,o,t),c=e.Vector3.fromArray(a,o,i);d[g++]=c.x,d[g++]=c.y,d[g++]=c.z,d[g++]=h.x,d[g++]=h.y,d[g++]=h.z,p[C++]=b,p[C++]=0,p[C++]=b,p[C++]=e.Vector3.distance(h,c)/u;let w=e.Vector3.clone(e.Vector3.ZERO,r);const S=e.Vector3.subtract(h,n.geodeticSurfaceNormal(h,i),i);if(f+1<_&&(w=e.Vector3.fromArray(l,o+3,r)),x){const i=e.Vector3.subtract(w,h,s),r=e.Vector3.subtract(S,h,t);T=e.Vector3.normalize(e.Vector3.cross(r,i,T),T),x=!1;}e.Vector3.equalsEpsilon(h,w,e.CONSTS.CesiumMath.EPSILON10)?x=!0:b+=v,m[y++]=T.x,m[y++]=T.y,m[y++]=T.z,m[y++]=T.x,m[y++]=T.y,m[y++]=T.z;}const w=c/3;c-=6*(h+1);const S=new Uint16Array(c);let A=0;for(f=0;f<w-2;f+=2){const s=f,r=f+2,n=e.Vector3.fromArray(d,3*s,t),o=e.Vector3.fromArray(d,3*r,i);if(e.Vector3.equalsEpsilon(n,o,e.CONSTS.CesiumMath.EPSILON10))continue;const a=f+1,l=f+3;S[A++]=s,S[A++]=a,S[A++]=l,S[A++]=s,S[A++]=l,S[A++]=r;}this.vertices=d,this.indices=S,this.normals=m;for(let e=0;e<this._evennessUV.length;e++)p[e]=this._evennessUV[e];this.uvs=p;for(let e=0;e<S.length;e+=3)this._indices.emplaceBack(S[e],S[e+1],S[e+2]);const E=new e.Vector3;for(let t=0;t<this.vertices.length;t+=3)e.Vector3.fromArray(this.vertices,t,E),this.vertices[t]=E.x,this.vertices[t+1]=E.y,this.vertices[t+2]=E.z;this.emplaceVertexBufferTriangle();}update(t){if(this._needUpdate&&t.painter){const i=t.painter.context;this._vertBuffer&&this._indexBuffer?(this._vertBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indices)):(this._vertBuffer=i.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?e.layout.members:e.layout$1.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indices,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/3),this._needUpdate=!1;}}serialize(){const t=[];for(let i=0;i<this._positions.length;i++)t.push(e.Vector3.pack(this._positions[i],new Array(3)));return {type:this.type,positions:t,maximumHeights:this._maximumHeights,minimumHeights:this._minimumHeights}}destroy(){return super.destroy(),this._vertBuffer=void 0,this._indexBuffer=void 0,this._segmentVector=void 0,this._needUpdate=void 0,this._positions=void 0,this._maximumHeights=void 0,this._minimumHeights=void 0,this._granularity=void 0,this._ellipsoid=void 0,this.vertices=void 0,this.indices=void 0,this.normals=void 0,this.uvs=void 0,this._vertexArray=void 0,this._indices=void 0,this.primitiveType=void 0,this.type=void 0,this._segmentVector?.destroy(),this._segmentVector=void 0,e.destroyObject(this)}}class $f extends e.Geometry{constructor(e){super(e),this.setData(e);}setData(t){if(super.setData(t),!t.positions)throw new Error("gradient color 数据为空");this.vertices=t.positions.flat(),this.uvs=t.values,this.index=t.index,this.type="GradientColorBoxGeometry",this._usedDoublePrecision=!1,this._vertexArray?(this._vertexArray.clear(),this._indices.clear()):(this._vertexArray=this._usedDoublePrecision?new e.StructArrayLayout11f44:new e.StructArrayLayout3f2f3f32,this._indices=new e.StructArrayLayout3ui6),this._needUpdate=!0,this.primitiveType=e.WebGLConstants.TRIANGLES,this.parse();}updateProperty(e){this.setData(e);}updateGradientColorBoxGeometry(e){console.warn("geometry的数据更新已经全面采用了setData,参数不变，方法名变更了！"),this.setData(e);}parse(){for(let e=0;e<this.index.length;e+=3)this._indices.emplaceBack(this.index[e],this.index[e+1],this.index[e+2]);if(this._usedDoublePrecision){let t,i,s;for(let r=0;r<this.vertices.length;r+=3)t=e.EncodedVector3.encode(this.vertices[r]),i=e.EncodedVector3.encode(this.vertices[r+1]),s=e.EncodedVector3.encode(this.vertices[r+2]),this._vertexArray.emplaceBack(t.high,i.high,s.high,t.low,i.low,s.low,this.uvs[r/3],0,0,0,0);}else for(let e=0;e<this.vertices.length;e+=3)this._vertexArray.emplaceBack(this.vertices[e],this.vertices[e+1],this.vertices[e+2],this.uvs[e/3],0,0,0,0);}update(t){if(this._needUpdate&&t.painter){const i=t.painter.context;this._vertBuffer&&this._indexBuffer?(this._vertBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indices)):(this._vertBuffer=i.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?e.layout.members:e.layout$1.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indices,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.index.length/3),this._needUpdate=!1;}}serialize(){return {type:this.type,positions:this.vertices,index:this.index,values:this.uvs}}destroy(){return super.destroy(),this.vertices=void 0,this.uvs=void 0,this.index=void 0,this._vertexArray=void 0,this._indices=void 0,this._needUpdate=!1,e.destroyObject(this)}}class eg extends e.Geometry{constructor(t){super(t),this.type="PlaneGeometry",this.primitiveType=e.WebGLConstants.TRIANGLES,this.setData(t);}setData(t){if(super.setData(t),!e.defined(t.position))throw new Error("options.position is required.");if(!e.defined(t.normal))throw new Error("options.normal is required.");if(!e.defined(t.dimensions))throw new Error("options.dimensions is required.");this._origin=t.position,this._normal=t.normal,this._distance=e.defaultValue(t.distance,0),this._dimensions=t.dimensions,this._modelMatrix=void 0,this.vertices=new Float64Array(12),this.normals=new Float32Array(12),this.indices=new Uint16Array(6),this.uvs=new Float32Array(8),this._vertexArray?(this._vertexArray.clear(),this._indices.clear()):(this._vertexArray=new e.StructArrayLayout11f44,this._indices=new e.StructArrayLayout3ui6),this.needUpdate=!0,this._usedDoublePrecision=!0,this._parse(),this.computeBoundingSphere(),this.computeBoundingBox();}updateProperty(e){console.warn("geometry的数据更新已经全面采用了setData,参数不变，方法名变更了！"),this.setData(e);}_parse(){this._computeMatrix(),this._computeVertices(),this._computeNormals(),this._computeUvs(),this._computeIndices(),this._recalculateGeometry(),this._createGeometry();}_computeMatrix(){const t=new e.Vector3,i=new e.Vector3,s=new e.Vector3,r=new e.Vector3,n=new e.Matrix3,o=new e.Matrix4,a=this._normal,l=e.Vector3.multiplyByScalar(a,-this._distance,s);let h=e.Vector3.clone(e.Vector3.UNIT_Z,i);e.CONSTS.CesiumMath.equalsEpsilon(Math.abs(e.Vector3.dot(h,a)),1,e.CONSTS.CesiumMath.EPSILON8)&&(h=e.Vector3.clone(e.Vector3.UNIT_Y,h));const _=e.Vector3.cross(h,a,t);h=e.Vector3.cross(a,_,h),e.Vector3.normalize(_,_),e.Vector3.normalize(h,h);const c=new e.Matrix3;e.Matrix3.setColumn(c,0,_,c),e.Matrix3.setColumn(c,1,h,c),e.Matrix3.setColumn(c,2,a,c);const u=e.Vector3.fromElements(this._dimensions.x,this._dimensions.y,1,r),d=e.Matrix3.multiplyByScale(c,u,n),m=e.Matrix4.fromRotationTranslation(d,l,o);this._modelMatrix=e.Transforms.eastNorthUpToFixedFrame(this._origin,void 0),e.Matrix4.multiplyTransformation(this._modelMatrix,m,this._modelMatrix);}_computeVertices(){const t=new e.Vector3(-.5,-.5,0),i=new e.Vector3(.5,.5,0);this.vertices[0]=t.x,this.vertices[1]=t.y,this.vertices[2]=0,this.vertices[3]=i.x,this.vertices[4]=t.y,this.vertices[5]=0,this.vertices[6]=i.x,this.vertices[7]=i.y,this.vertices[8]=0,this.vertices[9]=t.x,this.vertices[10]=i.y,this.vertices[11]=0;}_computeNormals(){this.normals[0]=0,this.normals[1]=0,this.normals[2]=1,this.normals[3]=0,this.normals[4]=0,this.normals[5]=1,this.normals[6]=0,this.normals[7]=0,this.normals[8]=1,this.normals[9]=0,this.normals[10]=0,this.normals[11]=1;}_computeUvs(){this.uvs[0]=0,this.uvs[1]=0,this.uvs[2]=1,this.uvs[3]=0,this.uvs[4]=1,this.uvs[5]=1,this.uvs[6]=0,this.uvs[7]=1;}_computeIndices(){this.indices[0]=0,this.indices[1]=1,this.indices[2]=2,this.indices[3]=0,this.indices[4]=2,this.indices[5]=3;}_recalculateGeometry(){let t=new e.Vector3,i=this.vertices.length;for(let s=0;s<i;s+=3)e.Vector3.unpack(this.vertices,s,t),e.Matrix4.multiplyByPoint(this._modelMatrix,t,t),e.Vector3.pack(t,this.vertices,s);const s=new e.Matrix4,r=new e.Matrix3;e.Matrix4.inverse(this._modelMatrix,s),e.Matrix4.transpose(s,s),e.Matrix4.getMatrix3(s,r),i=this.normals.length;for(let s=0;s<i;s+=3)e.Vector3.unpack(this.normals,s,t),e.Matrix3.multiplyByVector(r,t,t),t=e.Vector3.normalize(t,t),e.Vector3.pack(t,this.normals,s);}_createGeometry(){for(let e=0;e<this.indices.length;e+=3)this._indices.emplaceBack(this.indices[e],this.indices[e+2],this.indices[e+1]);this.emplaceVertexBufferTriangle();}update(t){if(this.needUpdate&&t.painter){this.needUpdate=!1;const i=t.painter.context;this._vertBuffer&&this._indexBuffer?(this._vertBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indices)):(this._vertBuffer=i.createVertexBuffer(this._vertexArray,e.layout.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indices,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/3);}}serialize(){return {type:this.type,position:e.Vector3.pack(this._origin,new Array(3)),normal:e.Vector3.pack(this._normal,new Array(3)),distance:this._distance,dimensions:e.Vector2.pack(this._dimensions,new Array(2))}}destroy(){return super.destroy(),this._origin=void 0,this._dimensions=void 0,this._distance=void 0,this._normal=void 0,this._modelMatrix=void 0,this.vertices=void 0,this.normals=void 0,this.indices=void 0,this.uvs=void 0,this.type=void 0,this.primitiveType=void 0,this._vertexArray=void 0,this._indices=void 0,this.needUpdate=void 0,this._segmentVector=void 0,e.destroyObject(this)}}class tg extends e.Geometry{constructor(t){super(t),this.type="PlaneOutlineGeometry",this.primitiveType=e.WebGLConstants.LINE_LOOP,this.setData(t);}setData(t){if(super.setData(t),!e.defined(t.position))throw new Error("options.position is required.");if(!e.defined(t.normal))throw new Error("options.normal is required.");if(!e.defined(t.dimensions))throw new Error("options.dimensions is required.");this._origin=t.position,this._dimensions=t.dimensions,this._normal=t.normal,this._distance=e.defaultValue(t.distance,0),this._modelMatrix=void 0,this.vertices=new Float64Array(12),this.indices=new Uint16Array(6),this._vertexArray?(this._vertexArray.clear(),this._indices.clear()):(this._vertexArray=new e.StructArrayLayout3f3f24,this._indices=new e.StructArrayLayout2ui4),this.needUpdate=!0,this._usedDoublePrecision=!0,this.parse(),this.computeBoundingSphere(),this.computeBoundingBox();}parse(){this._computeMatrix(),this._computeVertices(),this._computeIndices(),this._recalculateGeometry(),this._createGeometry();}_computeMatrix(){const t=new e.Vector3,i=new e.Vector3,s=new e.Vector3,r=new e.Vector3,n=new e.Matrix3,o=new e.Matrix4,a=this._normal,l=e.Vector3.multiplyByScalar(a,-this._distance,s);let h=e.Vector3.clone(e.Vector3.UNIT_Z,i);e.CONSTS.CesiumMath.equalsEpsilon(Math.abs(e.Vector3.dot(h,a)),1,e.CONSTS.CesiumMath.EPSILON8)&&(h=e.Vector3.clone(e.Vector3.UNIT_Y,h));const _=e.Vector3.cross(h,a,t);h=e.Vector3.cross(a,_,h),e.Vector3.normalize(_,_),e.Vector3.normalize(h,h);const c=new e.Matrix3;e.Matrix3.setColumn(c,0,_,c),e.Matrix3.setColumn(c,1,h,c),e.Matrix3.setColumn(c,2,a,c);const u=e.Vector3.fromElements(this._dimensions.x,this._dimensions.y,1,r),d=e.Matrix3.multiplyByScale(c,u,n),m=e.Matrix4.fromRotationTranslation(d,l,o);this._modelMatrix=e.Transforms.eastNorthUpToFixedFrame(this._origin,void 0),e.Matrix4.multiplyTransformation(this._modelMatrix,m,this._modelMatrix);}_computeVertices(){const t=new e.Vector3(-.5,-.5,0),i=new e.Vector3(.5,.5,0);this.vertices[0]=t.x,this.vertices[1]=t.y,this.vertices[2]=t.z,this.vertices[3]=i.x,this.vertices[4]=t.y,this.vertices[5]=t.z,this.vertices[6]=i.x,this.vertices[7]=i.y,this.vertices[8]=t.z,this.vertices[9]=t.x,this.vertices[10]=i.y,this.vertices[11]=t.z;}_computeIndices(){this.indices[0]=0,this.indices[1]=1,this.indices[2]=1,this.indices[3]=2,this.indices[4]=2,this.indices[5]=3,this.indices[6]=3,this.indices[7]=0;}_recalculateGeometry(){const t=new e.Vector3,i=this.vertices.length;for(let s=0;s<i;s+=3)e.Vector3.unpack(this.vertices,s,t),e.Matrix4.multiplyByPoint(this._modelMatrix,t,t),e.Vector3.pack(t,this.vertices,s);}_createGeometry(){this.emplaceVertexBufferOfLines();for(let e=0;e<this.indices.length/2;e++)this._indices.emplaceBack(this.indices[2*e],this.indices[2*e+1]);}update(t){if(this.needUpdate&&t.painter){this.needUpdate=!1;const i=t.painter.context;this._vertBuffer&&this._indexBuffer?(this._vertBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indices)):(this._vertBuffer=i.createVertexBuffer(this._vertexArray,Yu.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indices,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/2);}}serialize(){return {type:this.type,position:e.Vector3.pack(this._origin,new Array(3)),normal:e.Vector3.pack(this._normal,new Array(3)),distance:this._distance,dimensions:e.Vector2.pack(this._dimensions,new Array(2))}}destroy(){return super.destroy(),this._origin=void 0,this._dimensions=void 0,this._normal=void 0,this._distance=void 0,this._modelMatrix=void 0,this.vertices=void 0,this.indices=void 0,this.type=void 0,this._vertexArray=void 0,this._indices=void 0,this.primitiveType=void 0,this.needUpdate=void 0,this._segmentVector?.destroy(),this._segmentVector=void 0,e.destroyObject(this)}}class ig extends e.Geometry{constructor(t){if(super(t),!e.defined(t.positions))throw new Error("options.positions is required.");if(e.defined(t.maximumHeights)&&t.maximumHeights.length!==t.positions.length)throw new Error("options.positions and options.maximumHeights must have the same length.");if(e.defined(t.minimumHeights)&&t.minimumHeights.length!==t.positions.length)throw new Error("options.positions and options.minimumHeights must have the same length.");this._positions=t.positions,this._maximumHeights=t.maximumHeights,this._minimumHeights=t.minimumHeights,this._granularity=e.defaultValue(t.granularity,e.CONSTS.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=e.defaultValue(t.ellipsoid,e.Ellipsoid.WGS84),this.vertices=void 0,this.indices=void 0,this._usedDoublePrecision=!0,this._vertexArray=new e.StructArrayLayout3f3f24,this._indices=new e.StructArrayLayout2ui4,this.primitiveType=e.WebGLConstants.LINES,this.type="WallOutlineGeometry",this.updateProperty(t);}updateProperty(e){this.setData(e);}setData(t){this.vertices=void 0,this.indices=void 0,this.normals=void 0,this.uvs=void 0,this._vertexArray?(this._vertexArray.clear(),this._indices.clear()):(this._indices=new e.StructArrayLayout2ui4,this._vertexArray=new e.StructArrayLayout3f3f24),this._positions=t.positions,this._maximumHeights=t.maximumHeights,this._minimumHeights=t.minimumHeights,this._granularity=e.defaultValue(t.granularity,e.CONSTS.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=e.defaultValue(t.ellipsoid,e.Ellipsoid.WGS84),this._needUpdate=!0,this.parse(),this.computeBoundingSphere(),this.computeBoundingBox();}static fromConstantHeights(t){const i=t.positions;if(!e.defined(i))throw new Error("options.positions is required.");let s,r;const n=t.minimumHeight,o=t.maximumHeight,a=e.defined(n),l=e.defined(o);if(a||l){const e=i.length;s=a?new Array(e):void 0,r=l?new Array(e):void 0;for(let t=0;t<e;++t)a&&(s[t]=n),l&&(r[t]=o);}return new ig({positions:i,maximumHeights:r,minimumHeights:s,ellipsoid:t.ellipsoid})}parse(){const t=new e.Vector3,i=new e.Vector3,s=Af.computePositions(this._ellipsoid,this._positions,this._maximumHeights,this._minimumHeights,this._granularity,!1);if(!e.defined(s))return;const r=s.bottomPositions,n=s.topPositions;let o=n.length,a=2*o;const l=new Float64Array(a);let h,_=0;for(o/=3,h=0;h<o;++h){const s=3*h,o=e.Vector3.fromArray(n,s,t),a=e.Vector3.fromArray(r,s,i);l[_++]=a.x,l[_++]=a.y,l[_++]=a.z,l[_++]=o.x,l[_++]=o.y,l[_++]=o.z;}this.vertices=l;const c=a/3;a=2*c-4+c;const u=new Uint16Array(a);let d=0;for(h=0;h<c-2;h+=2){const s=h,r=h+2,n=e.Vector3.fromArray(l,3*s,t),o=e.Vector3.fromArray(l,3*r,i);if(e.Vector3.equalsEpsilon(n,o,e.CONSTS.CesiumMath.EPSILON10))continue;const a=h+1,_=h+3;u[d++]=a,u[d++]=s,u[d++]=a,u[d++]=_,u[d++]=s,u[d++]=r;}for(u[d++]=c-2,u[d++]=c-1,this.indices=u,this.emplaceVertexBufferOfLines(),h=0;h<this.indices.length/2;h++)this._indices.emplaceBack(this.indices[2*h],this.indices[2*h+1]);}update(t){if(this._needUpdate&&t.painter){const i=t.painter.context;this._vertBuffer?(this._vertBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indices)):(this._vertBuffer=i.createVertexBuffer(this._vertexArray,Yu.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indices,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/2),this._needUpdate=!1;}}serialize(){return {type:this.type,positions:this._positions,maximumHeights:this._maximumHeights,minimumHeights:this._minimumHeights}}destroy(){return super.destroy(),this._positions=void 0,this._maximumHeights=void 0,this._minimumHeights=void 0,this._granularity=void 0,this._ellipsoid=void 0,this.vertices=void 0,this.indices=void 0,this._vertexArray=void 0,this._indices=void 0,this.primitiveType=void 0,this._needUpdate=void 0,this.type=void 0,this._segmentVector?.destroy(),this._segmentVector=void 0,e.destroyObject(this)}}class sg extends e.Material{constructor(t){t.defines=null,t.type="GradientColorBoxMaterial";let i="attribute vec3 a_POSITION; \nattribute vec2 a_TEXCOORD_0; \nvarying vec4 v_color; \nuniform mat4 u_ModelViewProjectionMatrix; \nuniform vec3 a_NORMAL; \n";i+="void main() { \n",i+="gl_Position = u_ModelViewProjectionMatrix * vec4(a_POSITION.xyz, 1.0); \n";const s=t.gradientColor.slice();for(let t=0;t<s.length-1;t++){const r=e.Color.parse(s[t][1]),n=`vec4(float(${r.r}) , float(${r.g}), float(${r.b}), float(${r.a}))`,o=e.Color.parse(s[t+1][1]);i+=`if(float(${s[t][0]}) <= a_TEXCOORD_0.s && a_TEXCOORD_0.s <= float(${s[t+1][0]})) \n`,i+="{ \n",i+=`float mixParam = (a_TEXCOORD_0.s - float(${s[t][0]})) / (float(${s[t+1][0]}) - float(${s[t][0]})); \n`,i+=`v_color = mix(${n}, vec4(float(${o.r}), float(${o.g}), float(${o.b}), float(${o.a})), mixParam);`,i+="} \n";}i+="}",t.fragmentSource="precision highp float;\nvarying vec4 v_color;\n\nvoid main() {\n    gl_FragColor = v_color;\n}",t.vertexSource=i;const r=e.Material.getDefaultRenderState();r.cull.enabled=e.defaultValue(!t.doubleSided,!0),t.renderState=r,super(t),this.gradientColor=e.defaultValue(t.gradientColor,void 0);}updateMaterialProperty(e){this._shaderSource=void 0;const t=new sg(e);this._shaderSource&&this._shaderSource.destroy(),this._shaderSource=t._shaderSource;}serialize(){return {type:this.type,gradientColor:this.gradientColor,doubleSided:this._doubleSided}}destroy(){}}class rg extends e.Material{constructor(t){t.type="WaterMaterial",super(t),this._speed=void 0!==t.speed?1*t.speed/60:1/60,this._alpha=t.opacity;try{this._waterColor=e.defined(t.color)?e.Color.parse(t.color).toVector3():new e.Vector3(0,0,1);}catch(i){if("object"==typeof t.color&&e.defined(t.color.r)&&e.defined(t.color.g)&&e.defined(t.color.b))throw new Error("当前类型的Color为非法！请修改为标准的Color Input类型！")}this._texture=void 0!==t.texture?t.texture:null,this._sunLightDirection=void 0!==t.sunLightDirection?new e.Vector3(t.sunLightDirection):null,this._sunLightColor=void 0!==t.sunLightColor?new e.Vector3(t.sunLightColor.r,t.sunLightColor.g,t.sunLightColor.b):new e.Vector3(1,1,1),this._waveSize=e.defaultValue(1/t.waveSize,1),this._time=0,this._skyColor=e.defined(t.skyColor)?new e.Vector3(t.skyColor.r,t.skyColor.g,t.skyColor.b):new e.Vector3(1,1,1),this._enableSSR=!!e.defined(t.enableSSR)&&t.enableSSR,this._enableSSR&&(this._colorTexture=null,this._depthTexture=null,this._normalTexture=null,this.SSRState=!1);}enableSSR(){this._enableSSR=!0;}disableSSR(){this._enableSSR=!1;}update(t,i,s={}){super.update(t,i,s),t.enableSSR=this._enableSSR,this._uniforms.set("u_SkyColor",(()=>this._skyColor)),this._uniforms.set("u_Opacity",(()=>this._alpha)),this._uniforms.set("u_Time",(()=>(this._time=this._time+this._speed,this._time))),this._uniforms.set("u_BaseColorSampler",(()=>(this._texture.sampler={minificationFilter:e.WebGLConstants.LINEAR_MIPMAP_LINEAR,magnificationFilter:e.WebGLConstants.LINEAR,wrapS:e.WebGLConstants.REPEAT,wrapT:e.WebGLConstants.REPEAT},this._texture))),this._uniforms.set("u_NormalSampler",(()=>{if(this.SSRState)return this._normalTexture})),this._uniforms.set("u_ColorSampler",(()=>{if(this.SSRState)return this._colorTexture})),this._uniforms.set("u_DepthSampler",(()=>{if(this.SSRState)return this._depthTexture})),this._uniforms.set("u_Width",(()=>t.width)),this._uniforms.set("u_Height",(()=>t.height)),this._uniforms.set("u_Color",(()=>this._waterColor)),this._uniforms.set("u_DistortionScale",(()=>3.7)),this._uniforms.set("u_SunColor",(()=>this._sunLightColor)),this._uniforms.set("u_SunDirection",(()=>this._sunLightDirection)),this._uniforms.set("u_WaveSize",(()=>this._waveSize));}serialize(){return {type:this.type,texture:this._texture.serialize(),opacity:this._alpha,color:e.Vector3.pack(this._waterColor,new Array(3)),sunLightColor:e.Vector3.pack(this._sunLightColor,new Array(3)),sunLightDirection:e.Vector3.pack(this._sunLightDirection,new Array(3)),waveSize:1/this._waveSize,skyColor:e.Vector3.pack(this._skyColor,new Array(3)),speed:60*this._speed,enableSSR:this._enableSSR}}destroy(){}}const ng={BoxGeometry:Jf,BoxOutlineGeometry:Um,ConeGeometry:Zf,CylinderGeometry:Yf,FenceGeometry:Qf,FrustumGeometry:mf,FrustumOutlineGeometry:pf,GradientColorBoxGeometry:$f,PlaneGeometry:eg,PlaneOutlineGeometry:tg,PolygonGeometry:e.PolygonGeometry,PolygonOutlineGeometry:vf,PolylineGeometry:e.PolylineGeometry,SimplePolylineGeometry:$u,SphereGeometry:Ch,WallGeometry:Mf,WallOutlineGeometry:ig},og={GradientColorBoxMaterial:sg,PolylineMaterial:e.PolylineMaterial,StandardMaterial:e.StandardMaterial,PhongMaterial:zo,gltfPBR:Uo,WaterMaterial:rg};function ag(t,i){const s=i.geometry;if(!e.defined(s))throw new Error("geometry's options is not defined!");const r=i.material;if(!e.defined(s))throw new Error("material's options is not defined!");if(!e.defined(s)&&!e.defined(r))return;const n=function(t){const i=t.type;let s;switch(i){case"BoxGeometry":case"ConeGeometry":case"CylinderGeometry":case"GradientColorBoxGeometry":case"SphereGeometry":break;case"BoxOutlineGeometry":t.minPoint=e.Vector3.unpack(t.minPoint),t.maxPoint=e.Vector3.unpack(t.maxPoint);break;case"FenceGeometry":case"PolylineGeometry":case"SimplePolylineGeometry":case"WallGeometry":case"WallOutlineGeometry":if(e.defined(t.positions))for(let i=0;i<t.positions.length;i++)t.positions[i]=e.Vector3.unpack(t.positions[i]);break;case"FrustumGeometry":case"FrustumOutlineGeometry":"PerspectiveCamera"===t.camera.type?s=new a(t.camera.fov,t.camera.aspect,t.camera.near,t.camera.far):"OrthographicCamera"===t.camera.type&&(s=new l(t.camera.width,t.camera.aspect,t.camera.near,t.camera.far),s.setMatrix(new e.Matrix4(t.camera.matrix))),t=s;break;case"PlaneGeometry":case"PlaneOutlineGeometry":t.position=e.Vector3.unpack(t.position),t.normal=e.Vector3.unpack(t.normal),t.dimensions=e.Vector2.unpack(t.dimensions);break;case"PolygonGeometry":case"PolygonOutlineGeometry":t.polygonHierarchy=e.PolygonPipeline.hierarchyUnpack(t.polygonHierarchy,{});break;default:throw new Error("Unknown geometry type!")}return new ng[i](t)}(s),o=function(t,i){const s=t.type;let r;switch(s){case"StandardMaterial":e.defined(t.color)&&(t.color=e.Color.unpack(t.color)),e.defined(t.texUrl)&&(t.baseColorTexture=(new ko).load({map:i,texUrl:t.texUrl})),r=og[s].fromType(t.texTYpe,t),e.defined(t.flowOptions)&&r.flowTexture(t.flowOptions);break;case"GradientColorBoxMaterial":case"PolylineMaterial":case"PhongMaterial":case"gltfPBR":case"WaterMaterial":e.defined(t.color)&&(t.color=e.Color.unpack(t.color).toVector3()),e.defined(t.sunLightColor)&&(t.sunLightColor=e.Color.unpack(t.sunLightColor)),e.defined(t.skyColor)&&(t.skyColor=e.Color.unpack(t.skyColor)),e.defined(t.texture)&&e.defined(t.texture.texUrl)&&(t.texture=(new ko).load({map:i,texUrl:t.texture.texUrl})),e.defined(t.baseColorTextureUrl)&&(t.baseColorTexture=(new ko).load({map:i,texUrl:t.baseColorTextureUrl})),e.defined(t.normalTextureUrl)&&(t.normalTexture=(new ko).load({map:i,texUrl:t.normalTextureUrl})),e.defined(t.metallicRoughnessTextureUrl)&&(t.metallicRoughnessTexture=(new ko).load({map:i,texUrl:t.metallicRoughnessTextureUrl})),r=new og[s](t);break;default:throw new Error("Unknown material type!")}return r}(r,t),h={geometry:n,material:o},_=i.modelMatrix;return e.defined(_)&&(h.modelMatrix=new e.Matrix4(_)),e.defined(i.id)&&(h.id=i.id),new e.Primitive(h)}class lg{constructor(){}static deserialize(t,i,s){if(e.defined(i.projection)&&(t.projection=i.projection),s.useCustomCamera){const s=i.camera;e.defined(s)&&t.jumpTo({target:s.position,bearing:e.defined(s.bearing)?s.bearing:0,pitch:e.defined(s.pitch)?s.pitch:0,roll:e.defined(s.roll)?s.roll:0});}!function(t,i){e.defined(i.metadata)&&(i.metadata.enableNormal?t.enableNormalPass():t.disableNormalPass(),i.metadata.resolvePass&&t.setResolvePass(i.metadata.resolvePass));}(t,i),e.defined(i.terrain)&&t.setTerrain(i.terrain),function(t,i){if(e.defined(i.lights)){let s,r;i.lights.forEach((i=>{switch(i.type){case"AmbientLight":t.addLight(new Qc(e.Color.unpack(i.color),i.intensity));break;case"DirectionalLight":i.color=e.Color.unpack(i.color),s=new Mo(i.color,i.intensity),s.setPosition(i.lightPosition,i.targetPosition),t.addLight(s);break;case"PointLight":i.color=e.Color.unpack(i.color),r=new yp(i.color,i.intensity,i.distane,i.decay),r.setPosition(i.position),t.addLight(r);break;case"SunLight":i.color=e.Color.unpack(i.color),t.addLight(new Fo(i.color,i.intensity,i.timeStamp));break;default:t.enableLight(i.enableLight);}}));}}(t,i),function(t,i){if(e.defined(i.sceneComponent)){if(e.defined(i.sceneComponent.sceneModels))for(let s=0;s<i.sceneComponent.sceneModels.length;s++){const r=i.sceneComponent.sceneModels[s];if(e.defined(r.positions))for(let t=0;t<r.positions.length;t++)r.positions[t]=e.Vector3.unpack(r.positions[t]);if(e.defined(r.rotations))for(let t=0;t<r.rotations.length;t++)r.rotations[t]=new e.HeadingPitchRoll(r.rotations[t].heading,r.rotations[t].pitch,r.rotations[t].roll);if(e.defined(r.scales))for(let t=0;t<r.scales.length;t++)r.scales[t]=e.Vector3.unpack(r.scales[t]);if(e.defined(r.colors))for(let t=0;t<r.colors.length;t++)r.colors[t]=e.Color.unpack(r.colors[t]);if(r.type="3d-model",e.defined(r.clippingPlanes)&&e.defined(r.clippingPlanes.planes)){const t=[];for(let i=0;i<r.clippingPlanes.planes.length;i++){const s=r.clippingPlanes.planes[i];s.position=e.Vector3.unpack(s.position),s.normal=e.Vector3.unpack(s.normal),t.push(new e.ClippingPlane(s));}r.clippingPlanes=new e.ClippingPlaneCollection({modelMatrix:new e.Matrix4(r.clippingPlanes.modelMatrix),edgeColor:e.Color.unpack(r.clippingPlanes.edgeColor),edgeWidth:r.clippingPlanes.edgeWidth,enabled:r.clippingPlanes.enabled,unionClippingRegions:r.clippingPlanes.unionClippingRegions,planes:t});}t.addSceneComponent(r);}if(e.defined(i.sceneComponent.sceneTilesets))for(let s=0;s<i.sceneComponent.sceneTilesets.length;s++){const r=i.sceneComponent.sceneTilesets[s];if(e.defined(r.translation)&&(r.translation=e.Vector3.unpack(r.translation)),e.defined(r.clippingPlanes)){const t=[];for(let i=0;i<r.clippingPlanes.planes.length;i++){const s=r.clippingPlanes.planes[i];s.position=e.Vector3.unpack(s.position),s.normal=e.Vector3.unpack(s.normal),t.push(new e.ClippingPlane(s));}r.clippingPlanes=new e.ClippingPlaneCollection({modelMatrix:new e.Matrix4(r.clippingPlanes.modelMatrix),edgeColor:e.Color.unpack(r.clippingPlanes.edgeColor),edgeWidth:r.clippingPlanes.edgeWidth,enabled:r.clippingPlanes.enabled,planes:t});}t.addSceneComponent(r);}if(e.defined(i.sceneComponent.primitives))for(let e=0;e<i.sceneComponent.primitives.length;e++)t.addPrimitive(ag(t,i.sceneComponent.primitives[e]));if(e.defined(i.sceneComponent.sceneObjects))for(let e=0;e<i.sceneComponent.sceneObjects.length;e++){const s=i.sceneComponent.sceneObjects[e];"airLine"==s.type&&t.addSceneComponent(new td(s));}const s=i.sceneComponent.skybox;e.defined(s)&&t.addSceneComponent(new fu({starrySkyTextureUrls:s.starrySkyTextureUrls,dayTextureUrls:s.dayTextureUrls}));}}(t,i),function(t,i){if(e.defined(i.animations))for(let e=0;e<i.animations.length;e++)t.animationManager.add(i.animations[e]).then((e=>{e.forEach((e=>{e.play();}));}));}(t,i),function(t,i){if(e.defined(i.videoProjection))for(let e=0;e<i.videoProjection.length;e++)t.videoManager.add(new gf(i.videoProjection[e]));}(t,i),function(t,i){if(e.defined(i.analysis)){if(e.defined(i.analysis.viewDome))for(let s=0;s<i.analysis.viewDome.length;s++){const r=i.analysis.viewDome[s];r.viewPosition=e.Vector3.unpack(r.viewPosition),r.visibleAreaColor=e.Color.unpack(r.visibleAreaColor),r.hiddenAreaColor=e.Color.unpack(r.hiddenAreaColor),r.indicatorColor=e.Color.unpack(r.indicatorColor),r.indicatorOutlineColor=e.Color.unpack(r.indicatorOutlineColor),t.analysis.viewDomeCollection.add(new Vf(r));}if(e.defined(i.analysis.viewshed))for(let s=0;s<i.analysis.viewshed.length;s++){const r=i.analysis.viewshed[s];r.viewerPosition=e.Vector3.unpack(r.viewerPosition),r.visibleAreaColor=e.Color.unpack(r.visibleAreaColor),r.hiddenAreaColor=e.Color.unpack(r.hiddenAreaColor),r.lineColor=e.Color.unpack(r.lineColor),t.analysis.viewshed3DCollection.add(new Gf(r));}if(e.defined(i.analysis.sightLine))for(let s=0;s<i.analysis.sightLine.length;s++){const r=i.analysis.sightLine[s];r.viewerPosition=e.Vector3.unpack(r.viewerPosition),r.visibleColor=e.Color.unpack(r.visibleColor),r.hiddenColor=e.Color.unpack(r.hiddenColor),r.indicatorColor=e.Color.unpack(r.indicatorColor),r.indicatorOutlineColor=e.Color.unpack(r.indicatorOutlineColor),t.analysis.sightlineCollection.add(new Wf(r));}if(e.defined(i.analysis.excavation))for(let s=0;s<i.analysis.excavation.length;s++){const r=i.analysis.excavation[s];r.positions=e.Vector3.fromDegreesArrayHeights(r.positions),t.analysis.excavationCollection.add(new If(r));}if(e.defined(i.analysis.highlight))for(let s=0;s<i.analysis.highlight.length;s++){const r=i.analysis.highlight[s];for(let t=0;t<r.positions.length;t++)r.positions[t]=e.Vector3.unpack(r.positions[t]);r.invalidColor=e.Color.unpack(r.invalidColor),r.validColor=e.Color.unpack(r.validColor),r.validOutlineColor=e.Color.unpack(r.validOutlineColor),t.analysis.highlightCollection.add(new Xf(r));}if(e.defined(i.analysis.cutFill))for(let s=0;s<i.analysis.cutFill.length;s++){const r=i.analysis.cutFill[s];for(let t=0;t<r.positions.length;t++)r.positions[t]=e.Vector3.unpack(r.positions[t]);r.fillColor=e.Color.unpack(r.fillColor),r.cutColor=e.Color.unpack(r.cutColor),r.baseColor=e.Color.unpack(r.baseColor),r.baseOutlineColor=e.Color.unpack(r.baseOutlineColor),r.wallColor=e.Color.unpack(r.wallColor),r.wallOutlineColor=e.Color.unpack(r.wallOutlineColor),t.analysis.cutFillCollection.add(new wf(r));}}}(t,i),function(t,i){if(e.defined(i.postProcess)&&i.postProcess.blackWhite&&t.postProcessStages.add(hm.createBlackAndWhiteStage()),e.defined(i.postProcess)&&i.postProcess.bloom&&(t.bloom=i.postProcess.bloom),e.defined(i.postProcess)&&i.postProcess.fxaa&&(t.fxaa=i.postProcess.fxaa),e.defined(i.postProcess)&&i.postProcess.nightVision&&t.postProcessStages.add(hm.createNightVisionStage()),e.defined(i.postProcess)&&i.postProcess.hdr&&(t.hdr=i.postProcess.hdr),e.defined(i.postProcess)&&e.defined(i.postProcess.fog)){const s=hm.createFogEffect({fogColor:e.Color.unpack(i.postProcess.fog.fogColor),fogDensity:i.postProcess.fog.fogDensity});t.postProcessStages.add(s);}e.defined(i.postProcess)&&e.defined(i.postProcess.skyline)&&t.postProcessStages.add(hm.createSkyline({width:i.postProcess.skyline.width,color:new e.Color(e.Color.floatToByte(i.postProcess.skyline.color[0]),e.Color.floatToByte(i.postProcess.skyline.color[1]),e.Color.floatToByte(i.postProcess.skyline.color[2]),e.Color.floatToByte(i.postProcess.skyline.color[3]))}));}(t,i);}}class hg{constructor(t,i){this._map=t,this._enabled=e.defaultValue(i.scrollZoom,!0),this._enabled||this.disable();}setZoomRate(e){this._defaultZoomRate=e;}setWheelZoomRate(e){this._wheelZoomRate=e;}isEnabled(){return !!this._enabled}isActive(){return !!this._active}isZooming(){return !!this._zooming}enable(){this._enabled=!0,this._map._screenSpaceCameraController.enableZoom=!0;}disable(){this._enabled=!1,this._map._screenSpaceCameraController.enableZoom=!1;}blur(){this.reset();}reset(){this._active=!1;}_isFullscreen(){return !!e.window.document.fullscreenElement}}class _g{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=i.clickTolerance||1,this._enabled=e.defaultValue(i.boxZoom,!0),this._enabled||this.disable();}isEnabled(){return !!this._enabled}isActive(){return !!this._active}enable(){this.isEnabled()||(this._enabled=!0);}disable(){this.isEnabled()&&(this._enabled=!1);}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(z.disableDrag(),this._startPos=this._lastPos=t,this._active=!0);}mousemoveWindow(e,t){if(!this._active)return;const i=t;if(this._lastPos.equals(i)||!this._box&&i.dist(this._startPos)<this._clickTolerance)return;const s=this._startPos;this._lastPos=i,this._box||(this._box=z.create("div","minemap-boxzoom",this._container),this._container.classList.add("minemap-crosshair"),this._fireEvent("boxzoomstart",e));const r=Math.min(s.x,i.x),n=Math.max(s.x,i.x),o=Math.min(s.y,i.y),a=Math.max(s.y,i.y);this._map._requestDomTask((()=>{this._box&&(z.setTransform(this._box,`translate(${r}px,${o}px)`),this._box.style.width=n-r+"px",this._box.style.height=a-o+"px");}));}mouseupWindow(t){if(!this._active)return;if(0!==t.button)return;const i=this._startPos,s=z.mousePos(this._el,t);this.reset(),z.suppressClick(),i.x===s.x&&i.y===s.y?this._fireEvent("boxzoomcancel",t):(this._map.fitScreenCoordinates(i,s,this._map.getBearing(),{linear:!0}),this._map.fire(new e.Event("boxzoomend",{originalEvent:t})));}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e));}blur(){this.reset();}reset(){this._active=!1,this._container.classList.remove("minemap-crosshair"),this._box&&(z.remove(this._box),this._box=null),z.enableDrag(),delete this._startPos,delete this._lastPos;}_fireEvent(t,i){return this._map.fire(new e.Event(t,{originalEvent:i}))}}class cg{constructor(t,i){this._map=t,this._enable=e.defaultValue(i.dragRotate,!0),this._enable||this.disable();}enable(){this._enable=!0,this._map._screenSpaceCameraController.enableTilt=!0;}disable(){this._enable=!1,this._map._screenSpaceCameraController.enableTilt=!1;}isEnabled(){return this._enable}isActive(){}}class ug{constructor(t,i){this._map=t,this._enable=e.defaultValue(i.dragRotate,!0),this._enable||this.disable();}enable(){this._enable=!0,this._map._screenSpaceCameraController.enableRotate=!0;}disable(){this._enable=!1,this._map._screenSpaceCameraController.enableRotate=!1;}isEnabled(){return this._enable}isActive(){}}const dg={panStep:100,bearingStep:15,pitchStep:10};class mg{constructor(t,i){this._map=t;const s=dg;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1,this._enabled=e.defaultValue(i.keyboard,!0),this._enabled||this.disable();}blur(){this.reset();}reset(){this._active=!1;}keydown(t){if(!this._enabled||!this._map._interactive)return;let i;switch(t.keyCode){case 38:i="moveForward";break;case 40:i="moveBackward";break;case 39:i="moveRight";break;case 37:i="moveLeft";break;default:i=void 0;}if(!e.defined(i))return;const s=this._map.transform.activeCamera,r=this._map._tilingScheme._ellipsoid.cartesianToCartographic(s.position)[2]/100;"moveForward"===i&&s.moveForward(r),"moveBackward"===i&&s.moveBackward(r),"moveLeft"===i&&s.moveLeft(r),"moveRight"===i&&s.moveRight(r);}enable(){this._enabled=!0;}disable(){this._enabled=!1,this.reset();}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0;}enableRotation(){this._rotationDisabled=!1;}}class pg{constructor(t,i){this._map=t,this._enable=e.defaultValue(i.doubleClickZoom,!0),this._enable||this.disable();}enable(){this._enable=!0,this._map._screenSpaceCameraController.enableDoubleZoomClickFly=!0;}disable(){this._enable=!1,this._map._screenSpaceCameraController.enableDoubleZoomClickFly=!1;}isEnabled(){return this._enable}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class fg{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),this._enabled=e.defaultValue(i.touchPan,!0),this._enabled||this.disable();}reset(){this._active=!1,this._touches={},this._sum=new e.pointGeometry3d(0,0);}touchstart(){}touchmove(){}touchend(){}touchcancel(){}_calculateTransform(){}enable(){this._enabled=!0,this._map._screenSpaceCameraController.enableRotate=!0;}disable(){this._enabled=!1,this._map._screenSpaceCameraController.enableRotate=!1,this.reset();}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){}_showTouchPanBlockerAlert(){}}class gg{constructor(t,i){this._map=t,this._active=!1,this._enabled=e.defaultValue(i.touchZoomRotate,!0),this._enabled||this.disable();}reset(){this._active=!1,delete this._firstTwoTouches;}_start(){}_move(){}touchstart(){}touchmove(){}touchend(){}touchcancel(){}enable(e){this._enabled=!0,this._map._screenSpaceCameraController.enableTouchZoomRotate=!0,this._aroundCenter=!!e&&"center"===e.around;}disable(){this._enabled=!1,this._map._screenSpaceCameraController.enableTouchZoomRotate=!1,this.reset();}isEnabled(){return this._enabled}isActive(){return this._active}}class yg{constructor(t,i){this._map=t,this._enabled=e.defaultValue(i.touchPitch,!0),this._enabled||this.disable();}reset(){this._valid=void 0,delete this._firstMove,delete this._lastPoints;}_start(){}_move(){}gestureBeginsVertically(){}touchstart(){}touchmove(){}touchend(){}touchcancel(){}enable(e){this._enabled=!0,this._map._screenSpaceCameraController.enableTouchPitch=!0,this._aroundCenter=!!e&&"center"===e.around;}disable(){this._enabled=!1,this._map._screenSpaceCameraController.enableTouchPitch=!1,this.reset();}isEnabled(){return this._enabled}isActive(){return this._active}}const Cg={0:1,2:2};class Tg{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1;}blur(){this.reset();}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton;}_correctButton(e,t){return !1}_move(e,t){return {}}mousedown(t,i){if(this._lastPoint)return;const s=z.mouseButton(t);this._correctButton(t,s)&&(this._mousedownClickPoint=new e.pointGeometry3d(i.x,i.y),this._lastPoint=i,this._eventButton=s);}mousemoveWindow(e,t){const i=this._lastPoint;if(i)if(e.preventDefault(),function(e,t){const i=Cg[t];return void 0===e.buttons||(e.buttons&i)!==i}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(i,t)}mouseupWindow(e){this._mousedownClickPoint=null,this._lastPoint&&z.mouseButton(e)===this._eventButton&&(this._moved&&z.suppressClick(),this.reset());}enable(){this._enabled=!0;}disable(){this._enabled=!1,this.reset();}isEnabled(){return this._enabled}isActive(){return this._active}}class xg extends Tg{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const i=.8*(t.x-e.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(e){e.preventDefault();}}class bg extends Tg{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const i=-.5*(t.y-e.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(e){e.preventDefault();}}const vg={showCompass:!0,showZoom:!0,visualizePitch:!1};class wg{constructor(t){this.options=e.extend({},vg,t),this._container=z.create("div","minemap-ctrl minemap-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(e.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("minemap-ctrl-icon minemap-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),z.create("span","minemap-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("minemap-ctrl-icon minemap-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),z.create("span","minemap-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(e.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("minemap-ctrl-icon minemap-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e});})),this._compassIcon=z.create("span","minemap-ctrl-compass-arrow",this._compass),this._compassIcon.setAttribute("aria-hidden",!0));}_updateZoomButtons(){const e=this._map.getZoom(),t=e>=this._map.getMaxZoom(),i=e<=this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString());}_rotateCompassArrow(){const e=`rotate(${-this._map.transform.bearing}deg)`;this._map._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=e);}));}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Sg(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){this._container.remove(),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._map.off("panorama-change-bearing",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map;}_createButton(e,t){const i=z.create("button",e,this._container);return i.type="button",i.addEventListener("click",t),i}_setButtonTitle(e,t){const i=this._map._getUIString(`NavigationControl.${t}`);e.setAttribute("aria-label",i),e.firstElementChild&&e.firstElementChild.setAttribute("title",i);}}class Sg{constructor(t,i,s=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new xg({clickTolerance:3}),this.map=t,s&&(this.mousePitch=new bg({clickTolerance:3})),e.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),z.addEventListener(i,"mousedown",this.mousedown),z.addEventListener(i,"touchstart",this.touchstart,{passive:!1}),z.addEventListener(i,"touchmove",this.touchmove),z.addEventListener(i,"touchend",this.touchend),z.addEventListener(i,"touchcancel",this.reset);}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),z.disableDrag();}move(e,t){const i=this.map,s=this.mouseRotate.mousemoveWindow(e,t);if(s&&s.bearingDelta&&i.setBearing(i.getBearing()+s.bearingDelta),this.mousePitch){const s=this.mousePitch.mousemoveWindow(e,t);s&&s.pitchDelta&&i.setPitch(i.getPitch()+s.pitchDelta);}}off(){const e=this.element;z.removeEventListener(e,"mousedown",this.mousedown),z.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),z.removeEventListener(e,"touchmove",this.touchmove),z.removeEventListener(e,"touchend",this.touchend),z.removeEventListener(e,"touchcancel",this.reset),this.offTemp();}offTemp(){z.enableDrag(),z.removeEventListener(e.window,"mousemove",this.mousemove),z.removeEventListener(e.window,"mouseup",this.mouseup);}mousedown(t){this.down(e.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),z.mousePos(this.element,t)),z.addEventListener(e.window,"mousemove",this.mousemove),z.addEventListener(e.window,"mouseup",this.mouseup);}mousemove(e){this.move(e,z.mousePos(this.element,e));}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp();}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=z.touchPos(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos));}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=z.touchPos(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos));}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset();}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp();}}var Ag=Object.freeze({LEFT_DRAG:0,RIGHT_DRAG:1,MIDDLE_DRAG:2,WHEEL:3,PINCH:4,LEFT_DOUBLE_FLY:5});const Eg=(t,i)=>{let s=t;return e.defined(i)&&(s+=`+${i}`),s},Mg=(t,i,s)=>{const r=Eg(Ag.PINCH,i),n=t._update,o=t._isDown,a=t._eventStartPosition,l=t._pressTime,h=t._releaseTime;n[r]=!0,o[r]=!1,a[r]=new e.Vector2;let _=t._movement[r];e.defined(_)||(_=t._movement[r]={}),_.distance={startPosition:new e.Vector2,endPosition:new e.Vector2},_.angleAndHeight={startPosition:new e.Vector2,endPosition:new e.Vector2},_.preAngle=0,t._eventHandler.setInputAction((i=>{t._buttonsDown++,o[r]=!0,l[r]=new Date,e.Vector2.lerp(i.position1,i.position2,.5,a[r]);}),ee.PINCH_START,i),t._eventHandler.setInputAction((()=>{t._buttonsDown=Math.max(t._buttonsDown-1,0),o[r]=!1,h[r]=new Date;}),ee.PINCH_END,i),t._eventHandler.setInputAction((t=>{if(o[r]){n[r]?(e.Vector2.clone((i=t).distance.startPosition,(a=_).distance.startPosition),e.Vector2.clone(i.distance.endPosition,a.distance.endPosition),e.Vector2.clone(i.angleAndHeight.startPosition,a.angleAndHeight.startPosition),e.Vector2.clone(i.angleAndHeight.endPosition,a.angleAndHeight.endPosition),n[r]=!1,_.prevAngle=_.angleAndHeight.startPosition.x):(e.Vector2.clone(t.distance.endPosition,_.distance.endPosition),e.Vector2.clone(t.angleAndHeight.endPosition,_.angleAndHeight.endPosition));let o=_.angleAndHeight.endPosition.x;const l=_.prevAngle,h=2*Math.PI;for(;o>=l+Math.PI;)o-=h;for(;o<l-Math.PI;)o+=h;_.angleAndHeight.endPosition.x=-o*s.clientWidth/12,_.angleAndHeight.startPosition.x=-l*s.clientWidth/12;}var i,a;}),ee.PINCH_MOVE,i);};function Pg(t,i){e.Vector2.clone(t.startPosition,i.startPosition),e.Vector2.clone(t.endPosition,i.endPosition);}function Rg(t,i){const s=t._update,r=t._movement,n=t._lastMovement,o=t._isDown;for(const r in Ag)if(Ag.hasOwnProperty(r)){const n=Ag[r];if(e.defined(n)){const r=Eg(n,i);s[r]=!0,e.defined(t._lastMovement[r])||(t._lastMovement[r]={startPosition:new e.Vector2,endPosition:new e.Vector2,valid:!1}),e.defined(t._movement[r])||(t._movement[r]={startPosition:new e.Vector2,endPosition:new e.Vector2});}}t._eventHandler.setInputAction((a=>{for(const t in Ag)if(Ag.hasOwnProperty(t)){const l=Ag[t];if(e.defined(l)){const t=Eg(l,i);o[t]&&(s[t]?a.startPosition.equals(a.endPosition)||(Pg(r[t],n[t]),n[t].valid=!0,Pg(a,r[t]),s[t]=!1):e.Vector2.clone(a.endPosition,r[t].endPosition));}}e.Vector2.clone(a.endPosition,t._currentMousePosition);}),ee.MOUSE_MOVE,i);}const Bg=(t,i,s)=>{const r=Eg(s,i),n=t._isDown,o=t._eventStartPosition,a=t._pressTime,l=t._releaseTime;n[r]=!1,o[r]=new e.Vector2;let h,_,c=t._lastMovement[r];e.defined(c)||(c=t._lastMovement[r]={startPosition:new e.Vector2,endPosition:new e.Vector2,valid:!1}),s===Ag.LEFT_DRAG?(h=ee.LEFT_DOWN,_=ee.LEFT_UP):s===Ag.RIGHT_DRAG?(h=ee.RIGHT_DOWN,_=ee.RIGHT_UP):s===Ag.MIDDLE_DRAG&&(h=ee.MIDDLE_DOWN,_=ee.MIDDLE_UP),t._eventHandler.setInputAction((i=>{t._buttonsDown++,c.valid=!1,n[r]=!0,a[r]=new Date,e.Vector2.clone(i.position,o[r]);}),h,i),t._eventHandler.setInputAction((()=>{t._buttonsDown=Math.max(t._buttonsDown-1,0),n[r]=!1,l[r]=new Date;}),_,i);};class Ig{constructor(t,i){if(!e.defined(t))throw new Error("canvas is required.");this._eventHandler=new Fe(t,i),t.addEventListener("touchstart",(e=>{e.preventDefault();})),t.addEventListener("touchmove",(e=>{e.preventDefault();})),t.addEventListener("touch",(e=>{e.preventDefault();})),this._update={},this._movement={},this._lastMovement={},this._isDown={},this._eventStartPosition={},this._pressTime={},this._releaseTime={},this._buttonsDown=0,this._currentMousePosition=new e.Vector2,((t,i)=>{const s=Eg(Ag.WHEEL,i),r=t._pressTime,n=t._releaseTime,o=t._update;o[s]=!0;let a=t._movement[s];e.defined(a)||(a=t._movement[s]={});let l=t._lastMovement[s];e.defined(l)||(l=t._lastMovement[s]={startPosition:new e.Vector2,endPosition:new e.Vector2,valid:!1}),a.startPosition=new e.Vector2,e.Vector2.clone(e.Vector2.ZERO,a.startPosition),a.endPosition=new e.Vector2,t._eventHandler.setInputAction((i=>{const h=7.5*e.toRadians(i);r[s]=n[s]=new Date,a.endPosition.x=0,a.endPosition.y=h,e.Vector2.clone(a.endPosition,l.endPosition),l.valid=!0,o[s]=!1,e.Vector2.clone(t._eventHandler._primaryPosition,t._currentMousePosition);}),ee.WHEEL,i);})(this,void 0),Mg(this,void 0,t),Bg(this,void 0,Ag.LEFT_DRAG),Bg(this,void 0,Ag.RIGHT_DRAG),Bg(this,void 0,Ag.MIDDLE_DRAG),Rg(this,void 0),((t,i)=>{const s=Ag.LEFT_DOUBLE_FLY,r=Eg(s,i),n=t._update;n[r]=!0;const o=t._isDown,a=t._eventStartPosition,l=t._pressTime;o[r]=!1,a[r]=new e.Vector2;let h=t._movement[r];e.defined(h)||(h=t._movement[r]={}),h.startPosition=new e.Vector2,h.endPosition=new e.Vector2;let _,c=t._lastMovement[r];e.defined(c)||(c=t._lastMovement[r]={startPosition:new e.Vector2,endPosition:new e.Vector2,valid:!1}),s===Ag.LEFT_DOUBLE_FLY&&(_=ee.LEFT_DOUBLE_CLICK),t._eventHandler.setInputAction((t=>{c.valid=!1,o[r]=!0,n[r]=!0,l[r]=new Date,e.Vector2.clone(t.position,a[r]);const i=15*e.CONSTS.CesiumMath.toRadians(1);e.Vector2.clone(e.Vector2.ZERO,h.startPosition),h.endPosition.x=0,h.endPosition.y=i;}),_,i);})(this,void 0);for(const i in $)if($.hasOwnProperty(i)){const s=$[i];e.defined(s)&&(Mg(this,s,t),Bg(this,s,Ag.LEFT_DRAG),Bg(this,s,Ag.RIGHT_DRAG),Bg(this,s,Ag.MIDDLE_DRAG),Rg(this,s));}}get currentMousePosition(){return this._currentMousePosition}get anyButtonDown(){const e=!(this._update[Eg(Ag.WHEEL)]&&this._update[Eg(Ag.WHEEL,$.SHIFT)]&&this._update[Eg(Ag.WHEEL,$.CTRL)]&&this._update[Eg(Ag.WHEEL,$.ALT)]);return this._buttonsDown>0||e}isMoving(t,i){if(!e.defined(t))throw new Error("type is required.");const s=Eg(t,i);return !this._update[s]}getMovement(t,i){if(!e.defined(t))throw new Error("type is required.");const s=Eg(t,i);return this._movement[s]}getLastMovement(t,i){if(!e.defined(t))throw new Error("type is required.");const s=Eg(t,i),r=this._lastMovement[s];if(r.valid)return r}isButtonDown(t,i){if(!e.defined(t))throw new Error("type is required.");const s=Eg(t,i);return this._isDown[s]}getStartMousePosition(t,i){if(!e.defined(t))throw new Error("type is required.");if(t===Ag.WHEEL)return this._currentMousePosition;const s=Eg(t,i);return this._eventStartPosition[s]}getButtonPressTime(t,i){if(!e.defined(t))throw new Error("type is required.");const s=Eg(t,i);return this._pressTime[s]}getButtonReleaseTime(t,i){if(!e.defined(t))throw new Error("type is required.");const s=Eg(t,i);return this._releaseTime[s]}reset(){for(const e in this._update)this._update.hasOwnProperty(e)&&(this._update[e]=!0);}isDestroyed(){return !1}destroy(){return this._eventHandler=this._eventHandler&&this._eventHandler.destroy(),e.destroyObject(this)}}class Dg{static wgs84ToWindowCoordinates(t,i,s){return Dg.wgs84WithEyeOffsetToWindowCoordinates(t,i,e.Vector3.ZERO,s)}static wgs84WithEyeOffsetToWindowCoordinates(t,i,s,r){if(!e.defined(t))throw new Error("map is required.");if(!e.defined(i))throw new Error("position is required.");const n=Dg.computeActualWgs84Position(i,new e.Vector4(0,0,0,1));if(!e.defined(n))return;const o=t.getCanvas(),a=new e.BoundingRectangle;a.x=0,a.y=0,a.width=o.clientWidth,a.height=o.clientHeight;const l=t.camera;let h=new e.Vector4;return h=function(t,i,s,r){const n=s.getViewMatrix(),o=e.Matrix4.multiplyByVector(n,e.Vector4.fromElements(t.x,t.y,t.z,1,new e.Vector4),new e.Vector4),a=e.Vector3.multiplyComponents(i,e.Vector3.normalize(o,new e.Vector3),new e.Vector3);return o.x+=i.x+a.x,o.y+=i.y+a.y,o.z+=a.z,e.Matrix4.multiplyByVector(s.frustumCrate.frustum.projectionMatrix,o,r)}(n,s,l,h),h.z<0?void 0:((r=Dg.clipToGLWindowCoordinates(a,h,r)).y=o.clientHeight-r.y,r)}static computeActualWgs84Position(t,i){return e.Vector3.clone(t,i)}static clipToGLWindowCoordinates(t,i,s){const r=new e.Vector3;e.Vector3.divideByScalar(i,i.w,r);const n=new e.Matrix4;e.Matrix4.computeViewportTransformation(t,0,1,n);const o=new e.Vector3;return e.Matrix4.multiplyByPoint(n,r,o),e.Vector2.clone(o,s)}static transformWindowToDrawingBuffer(t,i,s){const r=t.canvas;return e.Vector2.fromElements(i.x*(t.drawingBufferWidth/r.clientWidth),i.y*(t.drawingBufferHeight/r.clientHeight),s)}}const Og=(t,i,s,r,n,o,a)=>{let l=o[a];e.defined(l)||(l=o[a]={startPosition:new e.Vector2,endPosition:new e.Vector2,motion:new e.Vector2,inertiaEnabled:!0});const h=t.getButtonPressTime(i,s),_=t.getButtonReleaseTime(i,s),c=h&&_&&(_.getTime()-h.getTime())/1e3,u=new Date,d=_&&(u.getTime()-_.getTime())/1e3;if(h&&_&&c<.4){const a=(p=d)<0?0:Math.exp(-25*(1-r)*p),h=t.getLastMovement(i,s);if(!e.defined(h)||e.Vector2.equalsEpsilon((m=h).startPosition,m.endPosition,e.CONSTS.CesiumMath.EPSILON14)||!l.inertiaEnabled)return Ng(o,i),void Hg(o,i);if(l.motion.x=.5*(h.endPosition.x-h.startPosition.x),l.motion.y=.5*(h.endPosition.y-h.startPosition.y),l.startPosition=e.Vector2.clone(h.startPosition,l.startPosition),l.endPosition=e.Vector2.multiplyByScalar(l.motion,a,l.endPosition),l.endPosition=e.Vector2.add(l.startPosition,l.endPosition,l.endPosition),isNaN(l.endPosition.x)||isNaN(l.endPosition.y)||e.Vector2.distance(l.startPosition,l.endPosition)<.5)return Ng(o,i),kg(o,i),void Hg(o,i);if(!t.isButtonDown(i,s)){const e=t.getStartMousePosition(i,s);o._eventType=i,n(o,e,l),o._map.style._performanceManagerEvent();}}else h&&_&&c>.4&&(Ng(o,i),kg(o,i),Hg(o,i));var m,p;},Lg=(t,i)=>{if(e.defined(i)){let s=t[i];e.defined(s)&&(s.inertiaEnabled=!0);const r=t._inertiaDisablers[i];if(e.defined(r)){const i=r.length;for(let n=0;n<i;++n)s=t[r[n]],e.defined(s)&&(s.inertiaEnabled=!1);}}},Vg=(e,t)=>{!e._wheelEventStart&&e._aggregator._eventHandler._isRollerWheel&&t===Ag.WHEEL&&(e._wheelEventStart=!0,e._map._zooming=!0,zg(e),Fe.executeEvent(e._map,"zoomstart"));},Ng=(e,t)=>{e._wheelEventStart&&e._aggregator._eventHandler._isRollerWheel&&t===Ag.WHEEL&&(e._wheelEventStart=!1,e._aggregator._eventHandler._isRollerWheel=!1,e._map._zooming=!1,jg(e),Fe.executeEvent(e._map,"zoomend"));},Fg=(e,t)=>{e._rotateEvent||t!==Ag.LEFT_DRAG&&t!==Ag.RIGHT_DRAG&&t!==Ag.PINCH||(e._rotateEvent=!0,e._map._rotating=!0,zg(e),Fe.executeEvent(e._map,"rotatestart"));},Gg=e=>{e._rotateEvent&&(Wg(e),Fe.executeEvent(e._map,"rotate"));},kg=(t,i)=>{if(t._rotateEvent&&(i===Ag.LEFT_DRAG||i===Ag.RIGHT_DRAG||i===Ag.PINCH&&"touchend"===t._map._screenSpaceEventHandler._elementEvent.type)){const s=i===Ag.LEFT_DRAG?t._aggregator._eventHandler._buttonDown[0]:t._aggregator._eventHandler._buttonDown[2];!e.defined(s)||s||t._aggregator.anyButtonDown||(delete t._aggregator._eventHandler._buttonDown[i],t._map._rotating=!1,t._rotateEvent=!1,jg(t),Fe.executeEvent(t._map,"rotateend"));}},Ug=(e,t)=>{e._pitchEvent||t!==Ag.RIGHT_DRAG&&t!==Ag.PINCH||(e._pitchEvent=!0,e._map._pitching=!0,zg(e),Fe.executeEvent(e._map,"pitchstart"));},Hg=(t,i)=>{if(t._pitchEvent&&(i===Ag.RIGHT_DRAG||i===Ag.PINCH&&"touchend"===t._map._screenSpaceEventHandler._elementEvent.type)){const i=t._aggregator._eventHandler._buttonDown[2];e.defined(i)&&!i&&(t._pitchEvent=!1,t._map._pitching=!1,delete t._aggregator._eventHandler._buttonDown[2],jg(t),Fe.executeEvent(t._map,"pitchend"),t._lastDeltaTheta=void 0);}},zg=(e,t)=>{!e._moveEvent&&(e._wheelEventStart||e._rotateEvent||e._pitchEvent||t)&&(e._moveEvent=!0,Fe.executeEvent(e._map,"movestart"));},Wg=e=>{e._moveEvent&&Fe.executeEvent(e._map,"move");},jg=e=>{!e._moveEvent||e._wheelEventStart||e._rotateEvent||e._pitchEvent||(e._moveEvent=!1,Fe.executeEvent(e._map,"moveend"));},Xg=(t,i,s,r,n,o)=>{if(!e.defined(s))return;const a=[],l=t._aggregator;Array.isArray(s)||(a[0]=s,s=a);const h=s.length;for(let a=0;a<h;++a){const h=s[a],_=e.defined(h.eventType)?h.eventType:h,c=h.modifier,u=l.isMoving(_,c)&&l.getMovement(_,c),d=l.getStartMousePosition(_,c);t._map._interactive&&t.enableInputs&&i&&(u?(Vg(t,_),Fg(t,_),Ug(t,_),t._map._stop(!0),t._eventType=_,r(t,d,u),Lg(t,o),t._map.style._performanceManagerEvent()):n<1&&Og(l,_,c,n,r,t,o));}},qg=(t,i,s)=>{const r=t._map.getPositionByGPUPick(i);if(e.defined(r))return e.Vector3.fromDegrees(r.x,r.y,r.z,t._ellipsoid,s),s},Kg=t=>{let i=0;const s=t._ellipsoid.cartesianToCartographic(t._map.camera.positionNew,new e.Cartographic);e.defined(s)&&(i=s.height);const r=e.defaultValue(t._map._globeHeight,0);return Math.abs(r-i)},Jg=(t,i,s)=>{const r=t._map,n=r.transform.activeCamera,o=r.getCanvas(),a=n.getPickRay(i.endPosition,o,new e.Ray);let l=e.Vector3.clone(n.directionNew,new e.Vector3);const h=e.Plane.fromPointNormal(s,l,new e.Plane(e.Vector3.UNIT_X,0)),_=e.IntersectionTests.rayPlane(a,h,new e.Vector3);e.defined(_)&&(l=e.Vector3.subtract(s,_,l),n.position=e.Vector3.add(n.positionNew,l,n.positionNew));},Zg=(t,i,s)=>{const r=new e.Vector3,n=t._map,o=n.transform.activeCamera,a=n.getCanvas(),l=t._cameraUnderground;let h=t._ellipsoid;const _={orientation:new e.HeadingPitchRoll};let c,u;const d=h.geodeticSurfaceNormal(o.positionNew,new e.Vector3);if(e.Vector2.equals(i,t._rotateMousePosition)){if(t._looking)iy(t,i,s,d);else if(t._rotating){Yg(t,i,s,void 0,void 0,void 0,n.transform.bearing>90||n.transform.bearing<-90?-1:1);const e=_.orientation;o._initializedHeadingPitchRoll(),e.heading=o.heading,e.pitch=o.pitch,e.roll=o.roll,o.setView(_);}else if(t._strafing)((t,i)=>{const s=i.endPosition,r=e.Vector2.subtract(i.endPosition,i.startPosition,new e.Vector2),n=t._strafeEndMousePosition;e.Vector2.add(n,r,n),i.endPosition=n,Jg(t,i,t._strafeStartPosition),i.endPosition=s;})(t,s);else {if(e.Vector3.magnitude(o.position)<e.Vector3.magnitude(t._rotateStartPosition))return;c=e.Vector3.magnitude(t._rotateStartPosition),u=new e.Vector3,u.x=u.y=u.z=c,h=e.Ellipsoid.fromCartesian3(u,new e.Ellipsoid),Qg(t,i,s,h);}return void Gg(t)}t._looking=!1,t._rotating=!1,t._strafing=!1;const m=h.cartesianToCartographic(o.positionWC,new e.Cartographic).height;if(m<t._minimumPickingTerrainHeight){const r=qg(t,s.startPosition,new e.Vector3);if(e.defined(r)){let n;const _=o.getPickRay(s.startPosition,a,new e.Ray);if(l)n=!0,((t,i,s,r)=>{let n;e.defined(s)?(n=e.Vector3.distance(i.origin,s),n>t._maximumUndergroundPickDistance&&(n=Kg(t))):n=Kg(t),e.Ray.getPoint(i,n,r);})(t,_,r,r);else {const t=h.geodeticSurfaceNormal(r,new e.Vector3);n=!!(Math.abs(e.Vector3.dot(_.direction,t))<.05)||e.Vector3.magnitude(o.positionNew)<e.Vector3.magnitude(r);}n?(e.Vector2.clone(i,t._strafeEndMousePosition),e.Vector3.clone(r,t._strafeStartPosition),t._strafing=!0,Jg(t,s,t._strafeStartPosition)):(c=e.Vector3.magnitude(r),u=new e.Vector3,u.x=u.y=u.z=c,h=e.Ellipsoid.fromCartesian3(u,new e.Ellipsoid),Qg(t,i,s,h),e.Vector3.clone(r,t._rotateStartPosition));}else t._looking=!0,iy(t,i,s,d);}else if(e.defined(o.pickEllipsoid(s.startPosition,a,t._ellipsoid,r)))Qg(t,i,s,t._ellipsoid),e.Vector3.clone(r,t._rotateStartPosition);else if(m>t._minimumTrackBallHeight){t._rotating=!0,Yg(t,i,s);const e=_.orientation;o._initializedHeadingPitchRoll(),e.heading=o.heading,e.pitch=o.pitch,e.roll=o.roll,o.setView(_);}else t._looking=!0,iy(t,i,s,d);e.Vector2.clone(i,t._rotateMousePosition),Gg(t);},Yg=(t,i,s,r,n,o,a=1)=>{n=e.defaultValue(n,!1),o=e.defaultValue(o,!1);const l=t._map,h=l.transform.activeCamera,_=l.getCanvas(),c=h.constrainedAxis;e.defined(r)&&(h.constrainedAxis=r);const u=e.Vector3.magnitude(h.positionNew);let d=t._rotateFactor*(u-t._rotateRateRangeAdjustment);d>t._maximumRotateRate&&(d=t._maximumRotateRate),d<t._minimumRotateRate&&(d=t._minimumRotateRate);let m=(s.startPosition.x-s.endPosition.x)/_.clientWidth,p=(s.startPosition.y-s.endPosition.y)/_.clientHeight;m=Math.min(m,t.maximumMovementRatio),p=Math.min(p,t.maximumMovementRatio);const f=d*m*Math.PI*2*a,g=d*p*Math.PI*a;t._eventType===Ag.PINCH&&!t.enableTouchZoomRotate||n||h.rotateRight(f),t._eventType===Ag.PINCH&&!t.enableTouchPitch||o||(h.rotateUp(g),Fg(t),Gg(t)),h.constrainedAxis=c;},Qg=(t,i,s,r)=>{const n=t._map,o=n.transform.activeCamera,a=n.getCanvas(),l=e.Vector4.clone(e.Vector4.UNIT_W),h=e.Vector4.clone(e.Vector4.UNIT_W),_=new e.Vector3,c=new e.Vector3,u=new e.Vector3,d=new e.Vector3,m=new e.Vector2,p=new e.Vector2,f=e.Vector2.clone(s.startPosition,m),g=e.Vector2.clone(s.endPosition,p),y={orientation:new e.HeadingPitchRoll};let C=o.pickEllipsoid(f,a,r,l),T=o.pickEllipsoid(g,a,r,h);if(!e.defined(C)||!e.defined(T)){t._rotating=!0,Yg(t,i,s);const e=y.orientation;return o._initializedHeadingPitchRoll(),e.heading=o.heading,e.pitch=o.pitch,e.roll=o.roll,void o.setView(y)}if(C=o.worldToCameraCoordinates(C,C),T=o.worldToCameraCoordinates(T,T),e.defined(o.constrainedAxis)){const t=o.constrainedAxis,i=e.Vector3.mostOrthogonalAxis(t,_);e.Vector3.cross(i,t,i),e.Vector3.normalize(i,i);const s=e.Vector3.cross(t,i,c),r=e.Vector3.magnitude(C),n=e.Vector3.dot(t,C),a=Math.acos(n/r),l=e.Vector3.multiplyByScalar(t,n,u);e.Vector3.subtract(C,l,l),e.Vector3.normalize(l,l);const h=e.Vector3.magnitude(T),m=e.Vector3.dot(t,T),p=Math.acos(m/h),f=e.Vector3.multiplyByScalar(t,m,d);e.Vector3.subtract(T,f,f),e.Vector3.normalize(f,f);let g=Math.acos(e.Vector3.dot(l,i));e.Vector3.dot(l,s)<0&&(g=e.CONSTS.CesiumMath.TWO_PI-g);let x=Math.acos(e.Vector3.dot(f,i));e.Vector3.dot(f,s)<0&&(x=e.CONSTS.CesiumMath.TWO_PI-x);const b=g-x;let v;v=e.Vector3.equalsEpsilon(t,o.positionNew,e.CONSTS.CesiumMath.EPSILON2)?o.rightNew:e.Vector3.cross(t,o.positionNew,_);const w=e.Vector3.cross(t,v,_),S=e.Vector3.dot(w,e.Vector3.subtract(C,t,c)),A=e.Vector3.dot(w,e.Vector3.subtract(T,t,c));let E;E=S>0&&A>0?p-a:S>0&&A<=0?e.Vector3.dot(o.positionNew,t)>0?-a-p:a+p:a-p,o.rotateRight(b),o.rotateUp(E);const M=y.orientation;o._initializedHeadingPitchRoll(),M.heading=o.heading,M.pitch=o.pitch,M.roll=o.roll,o.setView(y);}else {e.Vector3.normalize(C,C),e.Vector3.normalize(T,T);const t=e.Vector3.dot(C,T),i=e.Vector3.cross(C,T,_);if(t<1&&!e.Vector3.equalsEpsilon(i,e.Vector3.ZERO,e.CONSTS.CesiumMath.EPSILON14)){const e=Math.acos(t);o.rotate(i,e);}}},$g=(t,i,s)=>{if(e.defined(s.distance)&&(s=s.distance),t._eventType===Ag.PINCH&&!t.enableTouchZoomRotate)return;const r=s.inertiaEnabled,n=t._ellipsoid,o=t._map,a=o.transform.activeCamera,l=o.getCanvas(),h=o.transform.minZoom,_=o.transform.maxZoom,c=t._cameraUnderground,u=e.Vector3.clone(a.positionNew,new e.Vector3),d=e.Vector3.clone(a.directionNew,new e.Vector3),m=e.Vector3.clone(a.upNew,new e.Vector3),p=e.Vector3.clone(a.rightNew,new e.Vector3);let f;c?f=i:(f=new e.Vector2,f.x=l.clientWidth/2,f.y=l.clientHeight/2);const g=a.getPickRay(f,l,new e.Ray);let y;const C=n.cartesianToCartographic(a.positionNew,new e.Cartographic).height;let T;if((r?t.minimumPickingTerrainDistanceWithInertia>0:C<t._minimumPickingTerrainHeight)&&(y=qg(t,f,new e.Vector3)),e.defined(y)&&(T=e.Vector3.distance(g.origin,y)),c){const i=((t,i)=>{const s=i.origin,r=i.direction,n=Kg(t),o=e.Vector3.normalize(s,new e.Vector3);let a=Math.abs(e.Vector3.dot(o,r));return a=2*Math.max(a,.5),n*a})(t,g);T=e.defined(T)?Math.min(T,i):i;}e.defined(T)||(T=C);const x=e.Vector3.normalize(a.positionNew,new e.Vector3);o.transform.zoomPickedDistance=T,((t,i,s,r,n,o)=>{let a=1;e.defined(o)&&(a=e.CONSTS.CesiumMath.clamp(Math.abs(o),.25,1));const l=s.endPosition.y-s.startPosition.y,h=l>0?t.minimumZoomDistance*a:0,_=t.maximumZoomDistance;let c=r*(n-h);c=e.CONSTS.CesiumMath.clamp(c,t._minimumZoomRate,t._maximumZoomRate);let u=l/t._map.getCanvas().clientHeight;u=Math.min(u,t.maximumMovementRatio);let d=c*u;if(t.enableCollisionDetection||0===t.minimumZoomDistance){if(d>0&&Math.abs(n-h)<1)return;if(d<0&&Math.abs(n-_)<1)return;n-d<h?d=n-h-1:n-d>_&&(d=n-_);}t._awayFrom=d<0;const m=t._map,p=m.transform.activeCamera,f=m.getCanvas(),g={orientation:new e.HeadingPitchRoll},y=g.orientation;p._initializedHeadingPitchRoll(),y.heading=p.heading,y.pitch=p.pitch,y.roll=p.roll;const C=e.defaultValue(s.inertiaEnabled,e.Vector2.equals(i,t._zoomMouseStart));let T,x=t._zoomingOnVector,b=t._rotatingZoom;if(C||(t._zoomMouseStart=e.Vector2.clone(i,t._zoomMouseStart),T=qg(t,i,new e.Vector3),e.defined(T)?(t._useZoomWorldPosition=!0,t._zoomWorldPosition=e.Vector3.clone(T,t._zoomWorldPosition)):t._useZoomWorldPosition=!1,x=t._zoomingOnVector=!1,b=t._rotatingZoom=!1,t._zoomingUnderground=t._cameraUnderground),!t._useZoomWorldPosition)return void p.zoomIn(d);let v=!1;if(p.cartographicPosition[2]<2e6&&(b=!0),!C||b){const i=e.Vector3.normalize(p.positionNew,new e.Vector3);if(t._cameraUnderground||t._zoomingUnderground||p.cartographicPosition[2]<3e3&&Math.abs(e.Vector3.dot(p.directionNew,i))<.6)v=!0;else {const s=new e.Vector2;s.x=f.clientWidth/2,s.y=f.clientHeight/2;const r=qg(t,s,new e.Vector3);if(e.defined(r))if(p.cartographicPosition[2]<1e6){if(!(e.Vector3.dot(p.directionNew,i)>=-.5)){const s=new e.Vector3;e.Vector3.clone(p.positionNew,s);const r=t._zoomWorldPosition;let n=new e.Vector3;if(n=e.Vector3.normalize(r,n),e.Vector3.dot(n,i)<0)return;const o=new e.Vector3,a=new e.Vector3;e.Vector3.clone(p.directionNew,a),e.Vector3.add(s,e.Vector3.multiplyByScalar(a,1e3,new e.Vector3),o);const l=new e.Vector3,h=new e.Vector3;e.Vector3.subtract(r,s,l),e.Vector3.normalize(l,h);const _=Math.min(Math.max(e.Vector3.dot(i,h),-1),1);if(_>=0)return void(t._zoomMouseStart.x=-1);const c=Math.acos(-_),u=e.Vector3.magnitude(s),m=e.Vector3.magnitude(r),f=u-d,y=e.Vector3.magnitude(l),C=Math.asin(e.CONSTS.CesiumMath.clamp(y/m*Math.sin(c),-1,1))-Math.asin(e.CONSTS.CesiumMath.clamp(f/m*Math.sin(c),-1,1))+c,T=new e.Vector3;e.Vector3.normalize(s,T);let x=new e.Vector3;x=e.Vector3.cross(h,T,x),x=e.Vector3.normalize(x,x),e.Vector3.normalize(e.Vector3.cross(T,x,new e.Vector3),a),e.Vector3.multiplyByScalar(e.Vector3.normalize(o,new e.Vector3),e.Vector3.magnitude(o)-d,o),e.Vector3.normalize(s,s),e.Vector3.multiplyByScalar(s,f,s);const b=new e.Vector3;e.Vector3.multiplyByScalar(e.Vector3.add(e.Vector3.multiplyByScalar(T,Math.cos(C)-1,new e.Vector3),e.Vector3.multiplyByScalar(a,Math.sin(C),new e.Vector3),new e.Vector3),f,b),e.Vector3.add(s,b,s),e.Vector3.normalize(o,T),e.Vector3.normalize(e.Vector3.cross(T,x,new e.Vector3),a);const v=new e.Vector3;return e.Vector3.multiplyByScalar(e.Vector3.add(e.Vector3.multiplyByScalar(T,Math.cos(C)-1,new e.Vector3),e.Vector3.multiplyByScalar(a,Math.sin(C),new e.Vector3),new e.Vector3),e.Vector3.magnitude(o),v),e.Vector3.add(o,v,o),p.position=e.Vector3.clone(s),e.Vector3.clone(s,p.positionNew),e.Vector3.normalize(e.Vector3.subtract(o,s,new e.Vector3),p.directionNew),e.Vector3.clone(p.directionNew,p.directionNew),e.Vector3.cross(p.directionNew,p.upNew,p.rightNew),e.Vector3.cross(x,p.directionNew,p.upNew),void p.setView(g)}v=!0;}else {const i=e.Vector3.normalize(r,new e.Vector3),s=e.Vector3.normalize(t._zoomWorldPosition,new e.Vector3),n=e.Vector3.dot(s,i);if(n>0&&n<1){const t=e.CONSTS.CesiumMath.acosClamped(n),r=e.Vector3.cross(s,i,new e.Vector3),o=Math.abs(t)>e.CONSTS.CesiumMath.toRadians(20)?.75*p.cartographicPosition[2]:p.cartographicPosition[2]-d;p.rotate(r,t*(d/o)),p._initializedHeadingPitchRoll(),y.heading=p.heading,y.pitch=p.pitch,y.roll=p.roll,p.setView(g);}}else v=!0;}t._rotatingZoom=!v;}if(!C&&v||x){let s;const r=Dg.wgs84ToWindowCoordinates(m,t._zoomWorldPosition,new e.Vector2),o=new e.Ray;s=e.Vector2.equals(i,t._zoomMouseStart)&&e.defined(r)?p.getPickRay(r,f,o):p.getPickRay(i,f,o),p.move(s.direction,d>n-.1?n-.1:d),t._zoomingOnVector=!0;}else p.zoomIn(d>n-.1?n-.1:d);t._cameraUnderground||p.setView(g);})(t,i,s,t._zoomFactor,T,e.Vector3.dot(x,a.directionNew)),t.enableCollisionDetection&&o.transform.zoom-_>e.CONSTS.CesiumMath.EPSILON4&&!1===t._awayFrom||h-o.transform.zoom>e.CONSTS.CesiumMath.EPSILON4&&!0===t._awayFrom?ry(a,u,d,m,p):(e=>{e._wheelEventStart&&(Wg(e),Fe.executeEvent(e._map,"zoom"));})(t);},ey=(t,i,s)=>{const r=t._map,n=r.transform.activeCamera,o=e.Vector3.clone(n.positionNew,new e.Vector3),a=e.Vector3.clone(n.directionNew,new e.Vector3),l=e.Vector3.clone(n.upNew,new e.Vector3),h=e.Vector3.clone(n.rightNew,new e.Vector3);if(e.Matrix4.equals(n.transform,e.Matrix4.IDENTITY))if(e.defined(s.angleAndHeight)&&(s=s.angleAndHeight),e.Vector2.equals(i,t._tiltCenterMousePosition)||(t._tiltOnEllipsoid=!1,t._looking=!1),t._looking){const r=t._ellipsoid.geodeticSurfaceNormal(n.positionNew,new e.Vector3);iy(t,i,s,r);}else {t._tilting=!0,ty(t,i,s);for(let e=0;e<t._map._controls.length;e++)t._map._controls[e]instanceof wg&&t._map._controls[e]._rotateCompassArrow();(e=>{e._pitchEvent&&(Wg(e),Fe.executeEvent(e._map,"pitch"));})(t),(r.getPitch()<r.transform.minPitch||r.getPitch()>r.transform.maxPitch)&&ry(n,o,a,l,h);}},ty=(t,i,s)=>{const r=t._ellipsoid,n=t._map,o=n.transform.activeCamera,a=n.getCanvas(),l=t._cameraUnderground,h={orientation:new e.HeadingPitchRoll};let _,c,u;if(e.Vector2.equals(i,t._tiltCenterMousePosition))_=e.Vector3.clone(t._tiltCenter,new e.Vector3);else {if(_=qg(t,i,new e.Vector3),!e.defined(_)){if(c=o.getPickRay(i,a,new e.Ray),u=e.IntersectionTests.rayEllipsoid(c,r),!e.defined(u)){if(r.cartesianToCartographic(o.positionNew,new e.Cartographic).height<=t._minimumTrackBallHeight){t._looking=!0;const r=t._ellipsoid.geodeticSurfaceNormal(o.positionNew,new e.Vector3);iy(t,i,s,r),e.Vector2.clone(i,t._tiltCenterMousePosition);}return}_=e.Ray.getPoint(c,u.start,new e.Vector3);}l&&(e.defined(c)||(c=o.getPickRay(i,a,new e.Ray)),((t,i,s,r)=>{let n=e.Vector3.distance(i.origin,s);const o=Kg(t);n>e.CONSTS.CesiumMath.clamp(5*o,t._minimumUndergroundPickDistance,t._maximumUndergroundPickDistance)&&(n=Math.min(n,o/5),n=Math.max(n,100)),e.Ray.getPoint(i,n,r);})(t,c,_,_)),e.Vector2.clone(i,t._tiltCenterMousePosition),e.Vector3.clone(_,t._tiltCenter);}const d=new e.Vector2(a.clientWidth/2,t._tiltCenterMousePosition.y);c=o.getPickRay(d,a,new e.Ray);const m=e.Vector3.magnitude(_),p=e.Vector3.fromElements(m,m,m,new e.Vector3),f=e.Ellipsoid.fromCartesian3(p,new e.Ellipsoid);if(u=e.IntersectionTests.rayEllipsoid(c,f),!e.defined(u))return;const g=e.Vector3.magnitude(c.origin)>m?u.start:u.stop,y=e.Ray.getPoint(c,g,new e.Vector3),C=e.Transforms.eastNorthUpToFixedFrame(y,f,new e.Matrix4);t._rotateFactor=1,t._rotateRateRangeAdjustment=1;const T=e.Matrix4.clone(o.transform,new e.Matrix4);t._aggregator._isDown[1]&&(t._lastDeltaTheta=void 0);const x=((t,i,s)=>{const r=t._map,n=r.transform.activeCamera,o=r.getCanvas(),a=e.Vector3.magnitude(n.positionNew);let l=t._rotateFactor*(a-t._rotateRateRangeAdjustment);l>t._maximumRotateRate&&(l=t._maximumRotateRate),l<t._minimumRotateRate&&(l=t._minimumRotateRate);let h=(s.startPosition.x-s.endPosition.x)/o.clientWidth,_=(s.startPosition.y-s.endPosition.y)/o.clientHeight;h=Math.min(h,t.maximumMovementRatio),_=Math.min(_,t.maximumMovementRatio);const c=l*h*Math.PI*2,u=l*_*Math.PI;return (t._eventType!==Ag.PINCH||t.enableTouchPitch)&&(Fg(t),Gg(t)),{deltaPhi:c,deltaTheta:u}})(t,0,s),b=_,v=o.matrix.clone(),w=e.Transforms.fixedFrameToHeadingPitchRoll(v),S=Math.min(Math.max(w.roll,0),Math.PI);(S+x.deltaTheta<=0||S+x.deltaTheta>=Math.PI)&&(t._lastDeltaTheta=0),0===t._lastDeltaTheta&&(x.deltaTheta=0),v[12]-=b[0],v[13]-=b[1],v[14]-=b[2];const A=new e.Vector3(v[0],v[1],v[2]),E=new e.Vector3(b).normalize(),M=(new e.Matrix4).rotateAxis(x.deltaTheta,A),P=(new e.Matrix4).rotateAxis(x.deltaPhi,E);v.multiplyLeft(M).multiplyLeft(P),v[12]+=b[0],v[13]+=b[1],v[14]+=b[2],o.positionNew=new e.Vector3(v[12],v[13],v[14]),o.directionNew=new e.Vector3(-v[8],-v[9],-v[10]),o.rightNew=new e.Vector3(v[0],v[1],v[2]),o.upNew=new e.Vector3(v[4],v[5],v[6]),o._updateCameraChanged(),o.setMatrix(v),o._updateCameraChanged();const R=h.orientation;o._initializedHeadingPitchRoll(),R.heading=o.heading,R.pitch=o.pitch,R.roll=0,o.setView(h);const B=e.Vector3.clone(o.positionWC,new e.Vector3);if(t.enableCollisionDetection&&sy(t),!e.Vector3.equals(o.positionWC,B)){o._setTransform(C),o.worldToCameraCoordinatesPoint(B,B);const t=e.Vector3.magnitudeSquared(B);e.Vector3.magnitudeSquared(o.positionNew)>t&&(e.Vector3.normalize(o.positionNew,o.positionNew),e.Vector3.multiplyByScalar(o.positionNew,Math.sqrt(t),o.positionNew));const i=e.Vector3.angleBetween(B,o.positionNew),s=e.Vector3.cross(B,o.positionNew,B);e.Vector3.normalize(s,s);const r=e.Quaternion.fromAxisAngle(s,i,new e.Quaternion),n=e.Matrix3.fromQuaternion(r,new e.Matrix3);e.Matrix3.multiplyByVector(n,o.directionNew,o.directionNew),e.Matrix3.multiplyByVector(n,o.upNew,o.upNew),e.Vector3.cross(o.directionNew,o.upNew,o.rightNew),e.Vector3.cross(o.rightNew,o.directionNew,o.upNew),o._setTransform(T);const a=h.orientation;o._initializedHeadingPitchRoll(),a.heading=o.heading,a.pitch=o.pitch,a.roll=0,o.setView(h);}},iy=(t,i,s,r)=>{const n=t._map,o=n.transform.activeCamera,a=n.getCanvas(),l={orientation:new e.HeadingPitchRoll},h=new e.Vector2(s.startPosition.x,0),_=new e.Vector2(s.endPosition.x,0);let c,u,d=o.getPickRay(h,a,new e.Ray),m=o.getPickRay(_,a,new e.Ray),p=0;c=d.direction,u=m.direction;let f=e.Vector3.dot(c,u);f<1&&(p=Math.acos(f)),p=s.startPosition.x>s.endPosition.x?-p:p;const g=t._horizontalRotationAxis;if(e.defined(r)?o.look(r,-p):e.defined(g)&&o.look(g,-p),h.x=0,h.y=s.startPosition.y,_.x=0,_.y=s.endPosition.y,d=o.getPickRay(h,a,new e.Ray),m=o.getPickRay(_,a,new e.Ray),p=0,c=d.direction,u=m.direction,f=e.Vector3.dot(c,u),f<1&&(p=Math.acos(f)),p=s.startPosition.y>s.endPosition.y?-p:p,r=e.defaultValue(r,g),e.defined(r)){const t=o.directionNew,i=e.Vector3.negate(r,new e.Vector3),s=e.Vector3.equalsEpsilon(t,r,e.CONSTS.CesiumMath.EPSILON2),n=e.Vector3.equalsEpsilon(t,i,e.CONSTS.CesiumMath.EPSILON2);if(s||n)(s&&p<0||n&&p>0)&&o.look(o.rightNew,-p);else {f=e.Vector3.dot(t,r);let s=e.CONSTS.CesiumMath.acosClamped(f);p>0&&p>s&&(p=s-e.CONSTS.CesiumMath.EPSILON4),f=e.Vector3.dot(t,i),s=e.CONSTS.CesiumMath.acosClamped(f),p<0&&-p>s&&(p=-s+e.CONSTS.CesiumMath.EPSILON4);const n=e.Vector3.cross(r,t,new e.Vector3);o.look(n,p);}}else o.lookUp(p);const y=l.orientation;o._initializedHeadingPitchRoll(),y.heading=o.heading,y.pitch=o.pitch,y.roll=o.roll,o.setView(l),(n.getPitch()<n.transform.minPitch||n.getPitch()>n.transform.maxPitch)&&n.setPitch(Math.min(n.transform.maxPitch,Math.max(n.transform.minPitch,n.getPitch())));},sy=t=>{t._adjustedHeightForTerrain=!0;const i=t._ellipsoid,s=t._map.transform.activeCamera;let r,n;e.Matrix4.equals(s.transform,e.Matrix4.IDENTITY)||(r=e.Matrix4.clone(s.transform,new e.Matrix4),n=e.Vector3.magnitude(s.positionNew),s._setTransform(e.Matrix4.IDENTITY));const o=new e.Cartographic;i.cartesianToCartographic(s.positionNew,o);let a=!1;if(o.height<t._minimumCollisionTerrainHeight){const r=t._map._globeHeight;if(e.defined(r)){const e=r+t.minimumZoomDistance;o.height<e&&(o.height=e,i.cartographicToCartesian(o,s.positionNew),a=!0);}}if(e.defined(r)&&(s._setTransform(r),a)){e.Vector3.normalize(s.positionNew,s.positionNew),e.Vector3.negate(s.positionNew,s.directionNew),e.Vector3.multiplyByScalar(s.positionNew,Math.max(n,t.minimumZoomDistance),s.positionNew),e.Vector3.normalize(s.directionNew,s.directionNew),e.Vector3.cross(s.directionNew,s.upNew,s.rightNew),e.Vector3.cross(s.rightNew,s.directionNew,s.upNew);const i={orientation:new e.HeadingPitchRoll},r=i.orientation;s._initializedHeadingPitchRoll(),r.heading=s.heading,r.pitch=s.pitch,r.roll=0,s.setView(i);}},ry=(t,i,s,r,n)=>{t.positionNew=i,t.directionNew=s,t.upNew=r,t.rightNew=n;const o={orientation:new e.HeadingPitchRoll},a=o.orientation;t._initializedHeadingPitchRoll(),a.heading=t.heading,a.pitch=t.pitch,a.roll=t.roll,t.setView(o);};class ny{constructor(t){this.enableInputs=!0,this.enableZoom=!0,this.enableRotate=!0,this.enableTilt=!0,this.enableDoubleZoomClickFly=!0,this.enableTouchZoomRotate=!0,this.enableTouchPitch=!0,this.inertiaSpin=.9,this.inertiaTranslate=.9,this.inertiaZoom=.8,this.maximumMovementRatio=.1,this.minimumZoomDistance=1,this.maximumZoomDistance=Number.POSITIVE_INFINITY,this.zoomEventTypes=[Ag.WHEEL,Ag.PINCH],this.rotateEventTypes=Ag.LEFT_DRAG,this.tiltEventTypes=[Ag.RIGHT_DRAG,Ag.PINCH],this.minimumPickingTerrainHeight=15e4,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight,this.minimumTrackBallHeight=75e5,this._minimumTrackBallHeight=this.minimumTrackBallHeight,this.minimumPickingTerrainDistanceWithInertia=4e3,this.minimumCollisionTerrainHeight=3e4,this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight,this.enableCollisionDetection=e.defaultValue(!t.enableUnderGround,!0),this._ellipsoid=void 0,this._map=t;const i=t.getCanvas();i.oncontextmenu=function(){return !1},i.onselectstart=function(){return !1},this._aggregator=new Ig(this._map.getCanvasContainer(),this._map),this._lastInertiaSpinMovement=void 0,this._lastInertiaZoomMovement=void 0,this._lastInertiaTiltMovement=void 0,this._inertiaDisablers={_lastInertiaZoomMovement:["_lastInertiaSpinMovement","_lastInertiaTiltMovement"],_lastInertiaTiltMovement:["_lastInertiaSpinMovement"]},this._horizontalRotationAxis=void 0,this._tiltCenterMousePosition=new e.Vector2(-1,-1),this._tiltCenter=new e.Vector3,this._rotateMousePosition=new e.Vector2(-1,-1),this._rotateStartPosition=new e.Vector3,this._strafeStartPosition=new e.Vector3,this._strafeEndMousePosition=new e.Vector2,this._zoomMouseStart=new e.Vector2(-1,-1),this._zoomWorldPosition=new e.Vector3,this._useZoomWorldPosition=!1,this._panLastMousePosition=new e.Vector2,this._panLastWorldPosition=new e.Vector3,this._lastDeltaTheta=void 0,this._looking=!1,this._rotating=!1,this._tilting=!1,this._strafing=!1,this._zoomingOnVector=!1,this._zoomingUnderground=!1,this._rotatingZoom=!1,this._adjustedHeightForTerrain=!1,this._cameraUnderground=!1,this._zoomFactor=5,this._rotateFactor=void 0,this._rotateRateRangeAdjustment=void 0,this._maximumRotateRate=1.77,this._minimumRotateRate=2e-4,this._minimumZoomRate=20,this._maximumZoomRate=5906376272e3,this._minimumUndergroundPickDistance=2e3,this._maximumUndergroundPickDistance=1e4,this._wheelEventStart=!1,this._rotateEvent=!1,this._pitchEvent=!1,this._moveEvent=!1,this._awayFrom=!1,this._eventType=void 0;}_stopInertia(){e.defined(this._lastInertiaSpinMovement)&&(this._lastInertiaSpinMovement.inertiaEnabled=!1),e.defined(this._lastInertiaZoomMovement)&&(this._lastInertiaZoomMovement.inertiaEnabled=!1),e.defined(this._lastInertiaTiltMovement)&&(this._lastInertiaTiltMovement.inertiaEnabled=!1);}update(){const t=this._map,i=t.transform.activeCamera;this._ellipsoid=e.Matrix4.equals(i.transform,e.Matrix4.IDENTITY)?t._tilingScheme._ellipsoid:e.Ellipsoid.UNIT_SPHERE,this._cameraUnderground=t._cameraUnderground;const s=this._ellipsoid.maximumRadius;this._rotateFactor=1/s,this._rotateRateRangeAdjustment=s,this._tilting=!1,this._adjustedHeightForTerrain=!1;const r=e.Vector3.clone(i.positionNew,new e.Vector3),n=e.Vector3.clone(i.directionNew,new e.Vector3),o=e.Vector3.clone(i.upNew,new e.Vector3),a=e.Vector3.clone(i.rightNew,new e.Vector3);this._horizontalRotationAxis=void 0,this._awayFrom=void 0,(t=>{const i=t._aggregator;if(i.isButtonDown(Ag.LEFT_DOUBLE_FLY,void 0)){const s=i.getMovement(Ag.LEFT_DOUBLE_FLY,void 0),r=i.getStartMousePosition(Ag.LEFT_DOUBLE_FLY,void 0);t.enableDoubleZoomClickFly&&!t._cameraUnderground&&((t,i,s)=>{e.defined(s.distance)&&(s=s.distance);const r=t._map.transform.activeCamera,n=t._ellipsoid,o=qg(t,i,new e.Vector3);let a;a=e.defined(o)?e.Vector3.distance(r.positionNew,o):n.cartesianToCartographic(r.positionNew,new e.Cartographic).height,((t,i,s,r,n,o)=>{const a=t._map,l=.9*n,h={orientation:new e.HeadingPitchRoll},_=a.transform.activeCamera;if(!e.defined(o))return;const c=h.orientation;_._initializedHeadingPitchRoll(),c.heading=_.heading,c.pitch=_.pitch,c.roll=_.roll;const u=e.Vector3.clone(_.positionNew),d=e.Vector3.clone(_.rightNew),m=e.Vector3.clone(_.directionNew),p=e.Vector3.clone(_.upNew),f=o,g=new e.Vector3;e.Vector3.subtract(f,_.positionNew,g),e.Vector3.normalize(g,g),_.move(g,l),_.setView(h);const y=_.positionNew.clone();if(_.position=_.positionNew=u,_.rightNew=d,_.directionNew=m,_.upNew=p,_.setView(h),e.Vector3.distance(y,f)<1)return;const C=e.Cartographic.fromVector3(y);a.flyTo({target:[e.CONSTS.CesiumMath.toDegrees(C.longitude),e.CONSTS.CesiumMath.toDegrees(C.latitude),C.height],bearing:a.transform.bearing,pitch:a.transform.pitch,roll:a.transform.roll,duration:500,easing:Ap.LINEAR_NONE,isEaseToType:!0,callback:jg},t),zg(t,!0);})(t,0,0,0,a,o);})(t,r,s),i._isDown[Ag.LEFT_DOUBLE_FLY]=!1;}else Xg(t,t.enableRotate,t.rotateEventTypes,Zg,t.inertiaSpin,"_lastInertiaSpinMovement"),Xg(t,t.enableTilt,t.tiltEventTypes,ey,t.inertiaSpin,"_lastInertiaTiltMovement"),Xg(t,t.enableZoom,t.zoomEventTypes,$g,t.inertiaZoom,"_lastInertiaZoomMovement");})(this),this._ellipsoid.cartesianToCartographic(i.positionNew,new e.Cartographic).height>38268822&&ry(i,r,n,o,a),this.enableCollisionDetection&&!this._adjustedHeightForTerrain&&(!e.Vector3.equals(r,i.position)||!e.Vector3.equals(n,i.direction))&&sy(this),this._aggregator.reset();}isDestroyed(){return !1}destroy(){return this._aggregator=this._aggregator&&this._aggregator.destroy(),e.destroyObject(this)}}const oy=180,ay={bearing:0,pitch:0,roll:0,minZoom:0,maxZoom:22,minPitch:0,maxPitch:oy,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,dragZoom:!1,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!1,fps:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,transformRequest:null,fadeDuration:300,crossSourceCollisions:!0,sphereRender:!0,projection:e.ProjectionType.MERCATOR,localIdeographFontFamily:"PingFang SC,Microsoft YaHei,微软雅黑,Arial,sans-serif,黑体",defaultCursor:null,logoControl:!0,logoUrl:"",skyBox:!0,earthSkin:!0,earthSkinDepth:!1,terrainSkirtHeight:-1,minHeightToDemSurface:1,lightingModel:e.LightingModelType.NONE},{HTMLImageElement:ly,HTMLElement:hy,ImageBitmap:_y}=e.window;class cy extends jp{needRepaint=!1;constructor(t){if("undefined"==typeof global&&!Uf(void 0))throw new Error("minemap.js is not supported in the current environment");if(t=e.extend({},ay,t),e.defined(t.center)||e.defined(t.zoom)||e.defined(t.position)||(t.center=[0,0],t.zoom=0),e.defined(t.center)&&e.defined(t.zoom)&&e.defined(t.position))throw new Error("You must specify either center and zoom, or position");if(null!=t.minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>oy)throw new Error("maxPitch must be less than or equal to 180");const i=new of(t.minZoom,t.maxZoom,t.projection,t.minPitch,t.maxPitch);i.minHeightToDemSurface=t.minHeightToDemSurface,super(i,t),this.spaceErrorScale=t.spaceErrorScale,this.lightingModel=t.lightingModel,this._logDepth=t.logDepth||!1,this._canvasTransparent=void 0===t.canvasTransparent||t.canvasTransparent,this.testMode=t.testMode||!1,this._shadowFlag=!1,this._viewShedFlag=!1,this.mapProjection=new ef(t,this),this._interactive=t.interactive,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._crossSourceCollisions=t.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=t.collectResourceTiming,this._renderTaskQueue=new $p,this._domRenderTaskQueue=new $p,this._fxaaRender=t.fxaa||!1,this._bloomRender=t.bloom||!1,this._bloomOptions={step:9,extent:6},this._controls=[],this._markers=[],this.__popupList=[],this.particleSystemCollection=new zf(this),this.isLatLon="LATLON"===t.projection,this._tilingScheme="LATLON"===t.projection?new Ct:new yt,this._cooperativeGestures=t.cooperativeGestures,this._locale=e.extend({},cf,t.locale),this._clickTolerance=t.clickTolerance,this._containerWidth=0,this._containerHeight=0,this._showDebugBoundingBox=e.defaultValue(t.showDebugBoundingBox,!1),this._shadows=t.shadows||!1,this._shadowsType=this._shadows?t.shadowsType||e.ShadowsType.ShadowMapping:e.ShadowsType.NONE,this._enableUnderGround=e.defaultValue(t.enableUnderGround,!1),this._enableNormal=!!t.enableNormal&&t.enableNormal,this._resolvePass=t.resolvePass?t.resolvePass:"main";const s=t.transformRequest;if(this._transformRequest=s?(e,t)=>s(e,t)||{url:e,type:t}:e=>({url:e}),this.timer=new hf,this._SSAASamples=t.SSAASamples?t.SSAASamples:1,this._trackingOptions=null,this._roamingOptions=null,"string"==typeof t.container){if(this._container=e.window.document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container}' not found.`)}else {if(!(t.container instanceof hy))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container;}if(this._container.childNodes.length>0&&e.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the MineMap Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),e.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored","_update","_render","_onData","_onDataLoading"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");void 0!==e.window&&(e.window.addEventListener("online",this._onWindowOnline,!1),e.window.addEventListener("resize",this._onWindowResize,!1),e.window.addEventListener("orientationchange",this._onWindowResize,!1),e.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this._globeHeight=void 0,this._cameraUnderground=!1,this._screenSpaceCameraController=new ny(this),this._screenSpaceEventHandler=new Fe(this.getCanvasContainer(),this,!0),this._addHandOperationEventListener(),this.keyboard=new mg(this,t),this.dragPan=new ug(this,t),this.dragRotate=new cg(this,t),this.scrollZoom=new hg(this,t),this.boxZoom=new _g(this,t),this.doubleClickZoom=new pg(this,t),this.touchPan=new fg(this,t),this.touchZoomRotate=new gg(this,t),this.touchPitch=new yg(this,t),this._hash=t.hash&&(new wp).addTo(this),this._hash&&this._hash._onHashChange()||(e.defined(t.center)&&e.defined(t.zoom)&&!e.defined(t.position)?this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch,roll:t.roll}):this.jumpTo({target:t.position,bearing:t.bearing,pitch:t.pitch,roll:t.roll}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,e.extend({},t.fitBoundsOptions,{duration:0})))),this.resize(),this.directionLightParameter=new Tf,this.animationManager=new Ta(this),this.videoManager=new Cf,this.analysis={cutFillCollection:new Sf(this.painter),excavationCollection:new Df(this.painter),highlightCollection:new qf(this.painter),sightlineCollection:new jf(this.painter),viewDomeCollection:new Nf(this.painter),viewshed3DCollection:new kf(this.painter)},t.style&&this.setStyle(t.style,{localIdeographFontFamily:t.localIdeographFontFamily,projection:t.projection}),t.attributionControl&&this.addControl(new Xp),t.fps&&this.addFPSControl(),t.logoControl&&this.addControl(new qp,t.logoPosition,t.logoUrl),this.on("style.load",(()=>{if(Object.getOwnPropertyDescriptor(this,"testMode").hasOwnProperty("get"))throw new Error("The introduction framework modifies the properties of minemap itself. Please check whether the instantiated object uses the Object.defineproperty method (P.S. may be due to Vue or React)");this.transform.unmodified&&this.jumpTo(this.style.stylesheet);})),this.on("data",this._onData),this.on("dataloading",this._onDataLoading),this.on("processStyleJson",this._processStyleJson),this._overviewMapOptions=t,t.overviewMap?(this._overviewMap=!0,this.addOverviewMap()):this._overviewMap=!1,this._terrainSkirtHeight=t.terrainSkirtHeight,this.setCursor(t.defaultCursor);const{skyBox:r,earthSkin:n,earthSkinDepth:o}=t;this._earthSkin=n,this._earthSkinDepth=o,this._addBaseEarthImage(r,n,o),this._printInfo(),this._rerender();}enableRequestManage(){}disableRequestManage(){}setRequestManageDuration(){}_addBaseEarthImage(e,t,i){const s=`${st.SRC_URL}/assets`;if(e){const e=new fu({starrySkyTextureUrls:{nx:`${s}/tycho2t3_80_pz/tycho2t3_80_mx.jpg`,px:`${s}/tycho2t3_80_pz/tycho2t3_80_px.jpg`,ny:`${s}/tycho2t3_80_pz/tycho2t3_80_my.jpg`,py:`${s}/tycho2t3_80_pz/tycho2t3_80_py.jpg`,nz:`${s}/tycho2t3_80_pz/tycho2t3_80_mz.jpg`,pz:`${s}/tycho2t3_80_pz/tycho2t3_80_pz.jpg`},dayTextureUrls:{nx:`${s}/penguins-skybox-pack/penguins (44)/yonder_lf.jpg`,px:`${s}/penguins-skybox-pack/penguins (44)/yonder_rt.jpg`,ny:`${s}/penguins-skybox-pack/penguins (44)/yonder_dn.jpg`,py:`${s}/penguins-skybox-pack/penguins (44)/yonder_up.jpg`,nz:`${s}/penguins-skybox-pack/penguins (44)/yonder_ft.jpg`,pz:`${s}/penguins-skybox-pack/penguins (44)/yonder_bk.jpg`}});this.addSceneComponent(e);}if(t){const e=new Zu({url:`${s}/Earth_Diffuse22.png`,cloudImageUrl:`${s}/Earth_Clouds4.png`,nightImageUrl:`${s}/imageNightLightEarth.png`,widthSegments:128,heightSegments:64,depth:i});this.addSceneComponent(e);}}getCurrentLocation(){return {center:this.getCenter().toArray(),zoom:this.getZoom(),pitch:this.getPitch(),bearing:this.getBearing(),roll:this.getRoll()}}_onMove(t){if(!t.overviewMapInstance)return;t.overviewMapInstance.jumpTo({center:t.getCenter(),zoom:t.getZoom()<6?3:t.getZoom()-3,bearing:t.getBearing(),pitch:0,roll:0});const i=t.getCurrentViewBounds(),s={positions:e.Vector3.fromDegreesArrayHeights([...i[0].toArray(),0,...i[1].toArray(),0,...i[2].toArray(),0,...i[3].toArray(),0,...i[0].toArray(),0]),width:1,arcType:e.ARCTYPE.GEODESIC};t.getZoom()>2?(t.overviewMapInstance.style.primitiveCollection._data.forEach((e=>{e.visible=!0;})),t.overviewMapInstance.overViewPolyline?.setData(s)):t.overviewMapInstance.style.primitiveCollection._data.forEach((e=>{e.visible=!1;}));}disableDrag(){this.dragPan.disable();}enableDrag(){this.dragPan.enable();}setCursor(e){this._canvas.style.cursor=e||"";}getZoomFromDistance(t){return e.getZoomFromDistance(this.transform._fov,e.CONSTS.TRANSFORM.R+t,e.CONSTS.TRANSFORM.R)}getZoomFromDistanceForUser(){console.error("很抱歉，当前方法已经迁移，调用新的方法getZoomFromDistance");}getDistanceFromZoom(t){return e.getDistanceFromZoom(this.transform._fov,t,e.CONSTS.TRANSFORM.R)-e.CONSTS.TRANSFORM.R}getDistanceFromZoomForUser(e){console.error("很抱歉，当前方法已经迁移，调用新的方法getDistanceFromZoom");}getCursor(){return this.getCanvas().style.cursor}setZoomAndCenter(e,t){this.jumpTo({center:t,zoom:e});}getAllMarkers(){return this._markers}addMarker(e){if(e instanceof lf){if(this._markers.filter((t=>t._uuid===e._uuid)).length)return;e.addTo(this);}}addMarkers(e){for(let t=0;t<e.length;t++)this.addMarker(e[t]);}removeMarker(e){e instanceof lf&&e.remove();}removeMarkers(e){if(e&&e.length)for(let t=0;t<e.length;t++)this.removeMarker(e[t]);else console.error("removeMarkers need a array of marker");}removeAllMarkers(){const e=[...this._markers];this.removeMarkers(e);}removeOverviewMap(){this.overviewMapInstance&&(this._overviewDrag&&this._overviewDrag.remove(),this.off("move",this._onMove),this.overviewMapInstance.remove(),this.overviewMapInstance=null,this.getContainer().parentNode.parentNode.removeChild(this._overviewMapElement),this._overviewMapElement=null);}updateOverviewMap(e){this.overviewMapInstance.getLayer(e.id)||(void 0===this.overviewMapInstance.getSource(e.source)&&this.overviewMapInstance.style.addSource(e.source,this.getSource(e.source)._options),this.overviewMapInstance.style.addLayer(e),this.overviewMapInstance._update(!0));}addOverviewMap(){this.overviewMapInstance||(this._overviewMapElement=e.window.document.createElement("div"),this._overviewMapElement.id=`overviewMap_${Math.random()}`,this._overviewMapElement.style.position="absolute",this._overviewMapElement.style.width="160px",this._overviewMapElement.style.height="160px",this._overviewMapElement.style.bottom="0px",this._overviewMapElement.style.right="0px",this._overviewMapElement.style.zIndex=200,this._overviewMapElement.style.boxSizing="border-box",this._overviewMapElement.style.border="2px solid rgba(187,187,187,0.5)",this._overviewMapElement.style.borderRadius="2px",this.getContainer().parentNode.parentNode.appendChild(this._overviewMapElement),this.overviewMapInstance=new cy({container:this._overviewMapElement,style:this._overviewMapOptions.style,center:this.getCenter(),zoom:this.getZoom()<7?3:this.getZoom()-4,pitch:0,dragPan:!1,doubleClickZoom:!1,scrollZoom:!1,dragRotate:!1,dragZoom:!1,maxZoom:22,minZoom:3,logoControl:!1,preserveDrawingBuffer:!0,projection:this.isLatLon?"LATLON":"MERCATOR"}),this.on("move",this._onMove.bind(null,this)),setTimeout((()=>{const t=this.getCurrentViewBounds(),i=new e.PolylineGeometry({positions:e.Vector3.fromDegreesArrayHeights([...t[0].toArray(),0,...t[1].toArray(),0,...t[2].toArray(),0,...t[3].toArray(),0,...t[0].toArray(),0]),width:1,arcType:e.ARCTYPE.GEODESIC}),s=e.PolylineMaterial.fromType("Color",{color:"red"}),r=new e.Primitive({geometry:i,material:s,name:"overViewPolyline"});this.overviewMapInstance.overViewPolyline=i;const n=Object.keys(this.getAllLayers()).reduce(((e,t)=>("raster"!==this.getAllLayers()[t].type&&"vector"!==this.getAllLayers()[t].type||(e[t]=this.getAllLayers()[t]),e)),{});if(Object.keys(n).length>0)for(const e in n){const t=n[e].source;this.overviewMapInstance.style.addSource(t,this.getSource(t)._options),this.overviewMapInstance.addLayer({id:e,type:n[e].type,source:t,minzoom:n[e].minzoom,maxzoom:n[e].maxzoom});}this.overviewMapInstance.addPrimitive(r);}),100));}openOverviewMap(e){this._overviewMap=e,this.overviewMapInstance?this._overviewMapElement.style.display="block":this.addOverviewMap();}closeOverviewMap(){this.overviewMapInstance&&(this._overviewMapElement.style.display="none");}getOverviewMap(){return this._overviewMap}addControl(t,i,s){if(void 0===i&&(i=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=t.onAdd(this,s);this._controls.push(t);const n=this._controlPositions[i];return -1!==i.indexOf("bottom")?n.insertBefore(r,n.firstChild):n.appendChild(r),this}convertV34Pos2V4(t){return e.V34Pos2V4PosUtil(t,e.CONSTS.TRANSFORM.FOV_IN_RADIANS)}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(t);return i>-1&&this._controls.splice(i,1),t.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&(this.fire(new e.Event("movestart",t)).fire(new e.Event("move",t)),Fe.executeEvent(this,"movestart"),Fe.executeEvent(this,"move")),this.fire(new e.Event("resize",t)),i&&(this.fire(new e.Event("moveend",t)),Fe.executeEvent(this,"moveend")),this}getBounds(){return (new e.LngLatBounds).extend(this.transform.pointLocation(new e.pointGeometry3d(0,0))).extend(this.transform.pointLocation(new e.pointGeometry3d(this.transform.width,0))).extend(this.transform.pointLocation(new e.pointGeometry3d(this.transform.width,this.transform.height))).extend(this.transform.pointLocation(new e.pointGeometry3d(0,this.transform.height)))}getCurrentViewBounds(){const t=[],i=[new e.pointGeometry3d(0,0),new e.pointGeometry3d(this.transform.width,0),new e.pointGeometry3d(this.transform.width,this.transform.height),new e.pointGeometry3d(0,this.transform.height)];return i.forEach((s=>{let r=this.transform.pointLocation(s),n=0;for(;!r&&n<this.transform.width/2;)s.x+=s===i[0]||s===i[3]?1:-1,s.y+=s===i[0]||s===i[1]?1:-1,r=this.transform.pointLocation(s),n++;t.push(r||new e.LngLat(0,0));})),t}getMaxBounds(){return this.transform.latRange&&2===this.transform.latRange.length&&this.transform.lngRange&&2===this.transform.lngRange.length?new e.LngLatBounds([this.transform.lngRange[0],this.transform.latRange[0]],[this.transform.lngRange[1],this.transform.latRange[1]]):null}setMaxBounds(t){if(t){const i=e.LngLatBounds.convert(t);this.transform.lngRange=[i.getWest(),i.getEast()],this.transform.latRange=[i.getSouth(),i.getNorth()],this._update();}else null==t&&(this.transform.lngRange=null,this._update());return this}setMinZoom(e){if((e=null==e?0:e)>=0&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between 0 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}project(t,i){return this.transform.locationPoint(e.LngLat.convert(t),i)}unproject(t,i){return this.transform.pointLocation(e.pointGeometry3d.convert(t),i)}isMoving(){return this._moving}isZooming(){return this._zooming}isRotating(){return this._rotating}_createDelegatedListener(e,t,i){if("mouseenter"===e||"mouseover"===e){let s=!1;const r=r=>{const n=t.filter((e=>this.getLayer(e))),o=n.length?this.queryRenderedFeatures(r.point,{layers:n}):[];o.length?s||(s=!0,i.call(this,new Y(e,this,r.originalEvent,{features:o}))):s=!1;},n=()=>{s=!1;};return {layers:new Set(t),listener:i,delegates:{mousemove:r,mouseout:n}}}if("mouseleave"===e||"mouseout"===e){let s=!1;const r=r=>{const n=t.filter((e=>this.getLayer(e)));(n.length?this.queryRenderedFeatures(r.point,{layers:n}):[]).length?s=!0:s&&(s=!1,i.call(this,new Y(e,this,r.originalEvent)));},n=t=>{s&&(s=!1,i.call(this,new Y(e,this,t.originalEvent)));};return {layers:new Set(t),listener:i,delegates:{mousemove:r,mouseout:n}}}{const s=e=>{const s=t.filter((e=>this.getLayer(e))),r=s.length?this.queryRenderedFeatures(e.point,{layers:s}):[];r.length&&(e.features=r,i.call(this,e),delete e.features);};return {layers:new Set(t),listener:i,delegates:{[e]:s}}}}on(e,t,i){const s=Fe.addEventListeners(e,t,this,!1);if(s.length>0)return s;if(void 0===i){if(null==t)return;return super.on(e,t)}Array.isArray(t)||(t=[t]);const r=this._createDelegatedListener(e,t,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(r);for(const e in r.delegates)this.on(e,r.delegates[e]);return this}once(e,t,i){const s=Fe.addEventListeners(e,t,this,!0);if(s.length>0)return s;if(void 0===i)return super.once(e,t);Array.isArray(t)||(t=[t]);const r=this._createDelegatedListener(e,t,i);for(const e in r.delegates)this.once(e,r.delegates[e]);return this}off(e,t,i){if(Fe.removeEventListeners(e,t,this))return;if(void 0===i)return super.off(e,t);t=new Set(Array.isArray(t)?t:[t]);const s=(e,t)=>{if(e.size!==t.size)return !1;for(const i of e)if(!t.has(i))return !1;return !0},r=this._delegatedListeners?this._delegatedListeners[e]:void 0;return r&&(e=>{for(let r=0;r<e.length;r++){const n=e[r];if(n.listener===i&&s(n.layers,t)){for(const e in n.delegates)this.off(e,n.delegates[e]);return e.splice(r,1),this}}})(r),this}queryRenderedFeatures(t,i,s){if(!this.style)return [];let r;if(void 0!==i||void 0===t||t instanceof e.pointGeometry3d||Array.isArray(t)||(i=t,t=void 0),i=i||{},(t=t||[[0,0],[this.transform.width,this.transform.height]])instanceof e.pointGeometry3d||"number"==typeof t[0]){r=[e.pointGeometry3d.convert(t)];const n=this.style.queryRenderedFeatures(r,i,this.transform,s);return e.sortFeaturesDependsAnchor(n,this.unproject(t))}{const n=e.pointGeometry3d.convert(t[0]),o=e.pointGeometry3d.convert(t[1]);r=[n,new e.pointGeometry3d(o.x,n.y),o,new e.pointGeometry3d(n.x,o.y),n];const a=this.style.queryRenderedFeatures(r,i,this.transform,s),l=e.pointGeometry3d.convert([(n.x+o.x)/2,(n.y+o.y)/2]);return e.sortFeaturesDependsAnchor(a,this.unproject(l))}}queryPixelColor(t,i){if(!this.painter)return [];let s;if(void 0!==i||void 0===t||t instanceof e.pointGeometry3d||Array.isArray(t)||(i=t,t=void 0),i=i||{},(t=t||[[0,0],[this.transform.width,this.transform.height]])instanceof e.pointGeometry3d||"number"==typeof t[0])t=e.pointGeometry3d.convert(t),s=[new e.pointGeometry3d(t.x,t.y,0)];else {const i=e.pointGeometry3d.convert(t[0]),r=e.pointGeometry3d.convert(t[1]);s=[i,new e.pointGeometry3d(r.x,i.y),r,new e.pointGeometry3d(i.x,r.y),i];}return this.painter.queryPixelColor(s,i)}querySpherePosition(e,t){return this.queryDEMSourceHeightByPoint(e,t)}queryDEMSourceHeightByPoint(e,t){return []}queryDEMHeightByPoint(e){const t=this.getPositionByGPUPick(e);let i;return this.style.rasterSourceCache.terrainSource.isTerrain()&&(i=ll([t.x,t.y],this.style.rasterSourceCache.terrainSource,this.projection)),t.z=i||0,t}async queryAccurateDEMHeightByPoint(t){const i=this.getPositionByGPUPick(t);let s;return this.style.rasterSourceCache.terrainSource.isTerrain()&&(s=await function(t,i,s){t=e.LngLat.convert(t);const r={longitude:e.toRadians(t.lng),latitude:e.toRadians(t.lat),height:0};if(!i.availability)return void console.error("没有提供地形索引文件，无法查询当前位置最高精度的dem");const n=i.availability.computeMaximumLevelAtPosition(r);if(n<0)return;const o=i.map._tilingScheme.positionToTileXY(r,n),a=new e.OverscaledTileID(n,0,n,o.x,o.y,s);let l=i._tempTerrainTiles.get(a.key);return l||(l=i._terrainTiles.get(a.key)),l&&l.data?hl(l,t,s):new Promise(((e,t)=>i.requestTempData(a,((i,s)=>{i&&t(i),e(s);})))).then((e=>{if("replaced"!==e.state)return hl(e,t,s)}))}([i.x,i.y],this.style.rasterSourceCache.terrainSource,this.projection)),i.z=s||0,i}queryDEMHeightByLngLat(t){let i;return t=e.LngLat.convert(t),this.style.rasterSourceCache.terrainSource.isTerrain()&&(i=ll([t.lng,t.lat],this.style.rasterSourceCache.terrainSource,this.projection)),new e.Vector3(t.lng,t.lat,i||0)}querySourceFeatures(e,t){return this.style.querySourceFeatures(e,t)}getStyle(){if(this.style)return this.style.serialize()}setStyle(t,i){return (i=e.extend({},{localIdeographFontFamily:ay.localIdeographFontFamily},i)).diff=e.defaultValue(i.diff,!1),i.keepUserInfo=e.defaultValue(i.keepUserInfo,!1),i.useCustomCamera=e.defaultValue(i.useCustomCamera,!0),this.projection===e.ProjectionType.LATLON&&(i.projection=e.ProjectionType.LATLON),e.defined(this.style)&&(this.style.fristClassificationTypeId=void 0),(i.keepUserInfo||i.diff)&&e.defined(this.style)&&e.defined(t)?(this._diffStyle(t,i),this):(this._clearScene(),this._updateStyle(t,i))}set minHeightToDemSurface(e){this.transform.minHeightToDemSurface=null!=e&&null!=e?e:1;}get minHeightToDemSurface(){return this.transform.minHeightToDemSurface}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove()),e?(this.style=new ld(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e,t):this.style.loadJSON(e,t),this):(delete this.style,this)}_clearScene(){this.animationManager.removeAll(),this.videoManager.removeAll(),this.postProcessStages.removeAll(),this.analysis.cutFillCollection.removeAll(),this.analysis.excavationCollection.removeAll(),this.analysis.viewDomeCollection.removeAll(),this.analysis.viewshed3DCollection.removeAll(),this.analysis.sightlineCollection.removeAll(),this.analysis.highlightCollection.removeAll(),this.particleSystemCollection.removeAll();}_lazyInitEmptyStyle(){this.style||(this.style=new ld(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty());}_diffStyle(t,i){if("string"==typeof t){const s=at(t),r=this._transformRequest(s,e.ResourceType.Style);e.getJSON(r,((t,s)=>{t?this.fire(new e.ErrorEvent(t)):s&&this._updateDiff(s,i);}));}else "object"==typeof t&&this._updateDiff(t,i);}_updateDiff(t,i){try{this.style.setState(t,i.keepUserInfo)&&(this._update(!0),this.fire(new e.Event("style.load")),this.fire(new e.Event("processStyleJson",{dataType:"style",diff:i.diff,keepUserInfo:i.keepUserInfo,styleJsonData:t})));}catch(s){e.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(t,i);}}isStyleLoaded(){return this.style?this.style.loaded():e.warnOnce("There is no style added to the map.")}addSceneComponent(e){let t;if(Array.isArray(e)){t=[];for(let i=0;i<e.length;i++)t.push(this.style.addSceneComponent(e[i]));}else t=this.style.addSceneComponent(e);return t}getSceneComponent(e){if(this.style)return this.style.getSceneComponent(e)}removeSceneComponent(e){if(this.style)return this.style.removeSceneComponent(e)}addPrimitive(e){if(Array.isArray())for(let t=0;t<e.length;t++)this.style.addPrimitive(e[t]);else this.style.addPrimitive(e);return e}removePrimitive(e){this.style.removePrimitive(e);}removePrimitiveById(e){this.style.removePrimitiveById(e);}getPrimitiveById(e){return this.style.getPrimitiveById(e)}addParticleSystem(e){this.particleSystemCollection.add(e);}removeParticleSystemById(e){return this.particleSystemCollection.remove(e,this)}addSource(e,t){return "3d-tiles"===t.type&&console.warn("该添加3d-tiles到source方法已被废弃，请使用addSceneComponent替换！"),this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0),this}isSourceLoaded(t){const i=this.style&&this.style.sourceCaches[t];if(void 0!==i)return i.loaded();this.fire(new e.ErrorEvent(new Error(`There is no source with ID '${t}'`)));}areTilesLoaded(){const e=this.style&&this.style.sourceCaches;for(const t in e)if(!e[t].loaded())return !1;return !!(this.style.modelCollection.loaded()&&this.style.tilesetCollection.loaded()&&this.style.sceneObjectCollection.loaded()&&this.style.scenePointPrimitiveCollection.loaded())}addSourceType(e,t,i){return this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,i)}removeSource(e){return this.style.removeSource(e),this._update(!0),this}getSource(e){if(this.style)return this.style.getSource(e)}addImage(t,i,{pixelRatio:s=1,sdf:r=!1,stretchX:n,stretchY:o,content:a}={}){if(this._lazyInitEmptyStyle(),i instanceof ly||_y&&i instanceof _y){const{width:l,height:h,data:_}=e.exported.getImageData(i);this.style.addImage(t,{data:new e.RGBAImage({width:l,height:h},_),pixelRatio:s,stretchX:n,stretchY:o,content:a,sdf:r,version:0});}else {if(void 0===i.width||void 0===i.height)return this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:l,height:h,data:_}=i,c=i;this.style.addImage(t,{data:new e.RGBAImage({width:l,height:h},new Uint8Array(_)),pixelRatio:s,stretchX:n,stretchY:o,content:a,sdf:r,version:0,userImage:c}),c.onAdd&&c.onAdd(this,t);}}}updateImage(t,i){const s=this.style.getImage(t);if(!s)return this.fire(new e.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const r=i instanceof ly||_y&&i instanceof _y?e.exported.getImageData(i):i,{width:n,height:o,data:a}=r;return void 0===n||void 0===o?this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):n!==s.data.width||o!==s.data.height?this.fire(new e.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(s.data.replace(a,!(i instanceof ly||_y&&i instanceof _y)),void this.style.updateImage(t,s))}hasImage(t){return t?!!this.style.getImage(t):(this.fire(new e.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e);}loadImage(t,i){e.getImage(this._transformRequest(t,e.ResourceType.Image),i);}loadImages(e,t){const i={};e.forEach((s=>{this.loadImage(s,((r,n)=>{r?t(r):(i[s]=n,Object.keys(i).length===e.length&&t(null,i));}));}));}listImages(){return this.style.listImages()}addLayer(e,t){return this._lazyInitEmptyStyle(),"3d-tiles"===e.type&&console.warn("该添加3d-tiles到layer方法已被废弃，请使用addSceneComponent替换！"),this.style.addLayer(e,t),this._update(!0),this.overviewMapInstance&&this.updateOverviewMap(e),this}addLight(e){e&&"SunLight"==e.type?this.painter.frameState.sunLight=e:this.painter.frameState.addLight(e);}removeLight(e){e instanceof Fo?e.id==this.painter.frameState._sunLight.id?this.painter.frameState._sunLight=void 0:console.warn("不存在此光源"):this.painter.frameState._lights=this.painter.frameState._lights.filter((t=>t.id!=e.id));}updatePointLightShadow(){this.painter.frameState._lights.length>0&&this.painter.frameState._lights.forEach((e=>{e instanceof yp&&(e.shadowRepaint=!0);}));}getLights(){const e=[];return this.painter.frameState._lights.length>0&&this.painter.frameState._lights.forEach((t=>{e.push(t);})),null!=this.painter.frameState._sunLight&&e.push(this.painter.frameState._sunLight),e}enableLight(){this.painter.frameState._enableLight=!0;}disableLight(){this.painter.frameState._enableLight=!1;}getId(e){return this.style.getId(e)}moveLayer(e,t){return this.style.moveLayer(e,t),this._update(!0),this}upwardMoveLayer(e,t){return this.style.upwardMoveLayer(e,t),this._update(!0),this}removeLayer(e){return this.style.removeLayer(e),this._update(!0),this.overviewMapInstance&&void 0!==this.overviewMapInstance.style.getLayer(e)&&(this.overviewMapInstance.style.removeLayer(e),this.overviewMapInstance._update(!0)),this}getLayer(e){return this.style.getLayer(e)}setFilter(e,t){return this.style.setFilter(e,t),this._update(!0),this}setSourceFilter(e,t){return this.style.setSourceFilter(e,t),this._update(!0),this}setLayerZoomRange(e,t,i){return this.style.setLayerZoomRange(e,t,i),this._update(!0),this}getFilter(e){return this.style.getFilter(e)}setPaintProperty(e,t,i){return this.style.setPaintProperty(e,t,i),this._update(!0),this}getPaintProperty(e,t){return this.style.getPaintProperty(e,t)}setLayoutProperty(e,t,i){return this.style.setLayoutProperty(e,t,i),this._update(!0)}getLayoutProperty(e,t){return this.style.getLayoutProperty(e,t)}setTime(){let e;void 0===this._time?(e=(new Date).getTime(),this.painter?.frameState?.sunLight&&(this.painter.frameState.sunLight.timestamp=e),this._update(!0)):this.setSunLight(this._time);}setSunLight(e){const t=new Date,i=new Date(e.year||t.getFullYear(),e.month-1,e.day,e.hour,e.minute,0).getTime();this.painter?.frameState?.sunLight&&(this.painter.frameState.sunLight.timestamp=i),this._update(!0);}getSunDuration(e,t){const i=function(e,t){const i=Vo(t.month),s=23.45*Math.sin(360*(i+t.day-80)/370*Math.PI/180),r=Math.PI/180,n=180/Math.PI,o=Math.tan(e*r)*Math.tan(s*r);let a;a=o>=1?Math.PI:o<-1?0:Math.acos(-o);const l=2/15*a*n;return [12-l/2,12+l/2]}(e,t);return i}setCameraFlyingHeight(e){console.error("调用的setCameraFlyingHeight的方法无效，请参见文档的迁移建议");}setViewshedVisibleColor(){}setViewshedInVisibleColor(){}enableShadow(t){t==e.ShadowsType.ShadowMapping||t==e.ShadowsType.PCF?(this._shadows=!0,this.painter.setShadows(this._shadows),this.painter.frameState.setShadows(this._shadows),this.painter.frameState._shadowModel=t,this._update(!0),console.warn("点光源阴影效果当前仅支持最多6个点光源,多余的点光源将不产生阴影!!")):console.warn(`不支持输入阴影类型: ${t}`);}disableShadow(){this._shadows=!1,this.painter.setShadows(this._shadows),this.painter.frameState.setShadows(this._shadows),this.painter.frameState._shadowModel=e.ShadowsType.NONE,this._update(!0);}enableNearDetection(){}disableNearDetection(){}enableNormalPass(){this._enableNormal=!0,this.painter.setNormalPass(this._enableNormal);}disableNormalPass(){this._enableNormal=!1,this.painter.setNormalPass(this._enableNormal);}setResolvePass(e){this._resolvePass=e,this.painter.setResolvePass(e);}setFeatureState(e,t){return this.style.setFeatureState(e,t),this._update()}removeFeatureState(e,t){return this.style.removeFeatureState(e,t),this._update()}getFeatureState(e){return this.style.getFeatureState(e)}get trackingOptions(){return this._trackingOptions}set trackingOptions(e){this._trackingOptions=e;}get roamingOptions(){return this._roamingOptions}set roamingOptions(e){this._roamingOptions=e;}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}get enableUnderGround(){return this._enableUnderGround}set enableUnderGround(t){e.isBoolean(t)&&(this._enableUnderGround=t,this._screenSpaceCameraController.enableCollisionDetection=!t);}get cameraController(){return this._screenSpaceCameraController}_updateContainerDimensions(){if(!this._container)return;const t=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let s,r=this._container;for(;r&&!s;){const t=e.window.getComputedStyle(r).transform;t&&"none"!==t&&(s=t.match(/matrix.*\((.+)\)/)[1].split(", ")),r=r.parentElement;}s?(this._containerWidth=s[0]&&"0"!==s[0]?Math.abs(t/s[0]):t,this._containerHeight=s[3]&&"0"!==s[3]?Math.abs(i/s[3]):i):(this._containerWidth=t,this._containerHeight=i);}_detectMissingCSS(){"rgb(250, 128, 114)"!==e.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.warnOnce("当前页面没有找到minemap.css声明，可能会产生一些页面布局或者渲染错误。");}_setupContainer(){const e=this._container;e.classList.add("minemap-map"),(this._missingCSSCanary=z.create("div","minemap-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=z.create("div","minemap-canvas-container",e);this._interactive&&t.classList.add("minemap-interactive"),this._canvas=z.create("canvas","minemap-canvas",t),this._canvas.style.position="absolute",this._canvas.style.left="0",this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=z.create("div","minemap-control-container",e),s=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((e=>{s[e]=z.create("div",`minemap-ctrl-${e}`,i);})),this._container.addEventListener("scroll",this._onMapScroll,!1);}_resizeCanvas(t,i){const s=e.window.devicePixelRatio||1;this._canvas.width=s*Math.ceil(t),this._canvas.height=s*Math.ceil(i),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${i}px`;}_setupPainter(){const t=e.extend({failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer},Qp.webGLContextAttributes),i=this._canvas.getContext("webgl",t)||this._canvas.getContext("experimental-webgl",t);i?(this.painter=new vp(i,this),this.painter.postProcessStages.fxaa.enabled=this._fxaaRender,this.painter.setShadows(this._shadows),1==this._shadows&&console.warn("点光源阴影效果当前仅支持最多6个点光源,多余的点光源将不产生阴影!!"),this.painter.frameState.setShadows(this._shadows),this.painter.setNormalPass(this._enableNormal),this.painter.setResolvePass(this._resolvePass),this.painter.frameState._shadowModel=this._shadowsType,this.painter.mainPass.SSAASamples=this._SSAASamples):this.fire(new e.ErrorEvent(new Error("Failed to initialize WebGL")));}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.Event("webglcontextlost",{originalEvent:t}));}_contextRestored(t){this._setupPainter(),this.resize(),this._update(),this.fire(new e.Event("webglcontextrestored",{originalEvent:t}));}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return !this._styleDirty&&!(!this.style||!this.style.loaded())}_update(e){this.style&&(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.needRepaint=!0);}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e);}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e);}_render(t){if(this.painter.setBaseState(),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;let i=!1;if(this.style.updateSymbolHelperMatrix(),this.style&&this._styleDirty){this._styleDirty=!1;const t=this.style.symbolMatrixHelper.zoom,s=e.exported.now();this.style.zoomHistory.update(t,s);const r=new e.EvaluationParameters(t,{now:s,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),n=r.crossFadingFactor();1===n&&n===this._crossFadingFactor||(i=!0,this._crossFadingFactor=n),this.style.update(r);}return this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.style._updateSources()):this.style&&!this.style.performanceManager.eventDone&&this.style._updateSources(),this.style.performanceManager.eventDone=!1,this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions,!1,this._symbolNumStrategy),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,showDebugBoundingBox:this._showDebugBoundingBox,rotating:this.isRotating(),zooming:this.isZooming(),fadeDuration:this._fadeDuration}),this.fire(new e.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new e.Event("load"))),this.style&&(this.style.hasTransitions()||i)&&(this._styleDirty=!0),!this.isMoving()&&this.loaded()&&this.fire(new e.Event("idle")),this}setTerrain(e){this.style.rasterSourceCache.setTerrain(e);for(const e in this.style.sourceCaches)this.style.sourceCaches[e].quadtree?.destroy(),delete this.style.sourceCaches[e].quadtree;this.style.proxySourceCache.updateLayer();}remove(){this._hash&&this._hash.remove(),this._screenSpaceCameraController.destroy(),this._screenSpaceEventHandler.destroy();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style?.clearWorkerCaches(),this.painter.destroy(),this.setStyle(null),void 0!==e.window&&(e.window.removeEventListener("resize",this._onWindowResize,!1),e.window.removeEventListener("orientationchange",this._onWindowResize,!1),e.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),e.window.removeEventListener("online",this._onWindowOnline,!1));const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),uy(this._canvasContainer),uy(this._controlContainer),uy(this._missingCSSCanary),this._container.classList.remove("minemap-map"),this._removed=!0,this.fire(new e.Event("remove")),this.removeOverviewMap();}triggerRepaint(e){this.style&&(this.timer.update(e),this._updateSyncAnimation(this.timer.getDelta()),this._render(e),this.roam());}getAllLayers(){return this.style._layers||{}}getAllSources(){const e=this.style.sourceCaches,t=this.style.rasterSourceCache.getAllSources();if(Object.keys(e).length>0)for(const i in e)e.hasOwnProperty(i)&&(t[i]=this.getSource(i));return t}getAllPopups(){return this.__popupList}_getGlobeHeight(){let t;if(e.defined(this.transform.activeCamera)&&e.defined(this.transform.activeCamera.cartographicPosition)&&this.style.rasterSourceCache.terrainSource.isTerrain()&&this.style.rasterSourceCache.terrainSource.isLoaded()){const i=this.transform.activeCamera.cartographicPosition[0],s=this.transform.activeCamera.cartographicPosition[1],r=ol([i,s,0],e.Vector3.fromDegrees(i,s,1e4),this.style.rasterSourceCache.terrainSource,this.projection);t=e.defined(r.intersectionPoint)?e.Cartographic.fromVector3(r.intersectionPoint).height:void 0;}return t}_isCameraUnderground(){const t=this.transform.activeCamera.cartographicPosition;if(!e.defined(t))return !1;if(t[2]<0)return !0;const i=this._globeHeight;return e.defined(i)&&t[2]<i}_rerender(){this._frame||(this._frame=e.exported.frame((e=>{this._globeHeight=this._getGlobeHeight()||this._globeHeight,this._cameraUnderground=this._isCameraUnderground(this),this._screenSpaceCameraController.update(),this.transform.activeCamera._updateCameraChanged(),this.transform.cameraCheck.checkForCameraUpdates()?(this._styleDirty=!0,this.triggerRepaint(e)):(this._sourcesDirty||this._repaint||this._styleDirty||this._placementDirty||this.needRepaint)&&this.triggerRepaint(e),this.needRepaint=!1,this._frame=null,this._rerender();})));}_onWindowOnline(){this._update();}_onWindowResize(){this._trackResize&&this.resize()._update();}get showTileBoundaries(){return this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update());}get showCollisionBoxes(){return !!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update());}get showOverdrawInspector(){return !!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update());}get showDebugBoundingBox(){return !!this._showDebugBoundingBox}set showDebugBoundingBox(e){this._showDebugBoundingBox!==e&&(this._showDebugBoundingBox=e,this._update());}get repaint(){return !!this._repaint}set repaint(e){this._repaint=e,this.timer.state=!!e,this._update();}set atmosphere(e){this.painter.postProcessStages.atmosphere.enabled=e,this.needRepaint=!0;}get atmosphere(){return this.painter.postProcessStages.atmosphere.enabled}set atmosphereColor(t){const i=e.Vector4.fromColor(e.Color.parse(t));this.painter.postProcessStages.atmosphere.extraData.color=i,this.needRepaint=!0;}set fxaa(e){this._fxaaRender=e,this.painter.postProcessStages.fxaa.enabled=e;}get fxaa(){return this._fxaaRender}set SSAASamples(e){const t=Math.floor(Math.min(this.painter.context.gl.getParameter(this.painter.context.gl.MAX_TEXTURE_SIZE)/this.painter.width,this.painter.context.gl.getParameter(this.painter.context.gl.MAX_TEXTURE_SIZE)/this.painter.height));this._SSAASamples=Math.max(1,Math.min(e,t)),this.painter.mainPass.SSAASamples=this._SSAASamples;}get SSAASamples(){return this._SSAASamples}set hdr(e){this.painter.postProcessStages.useHdr=e;}get hdr(){return this.painter.postProcessStages.useHdr}set bloom(e){this._bloomRender=e,this.painter.postProcessStages.bloom.enabled=e;}get bloom(){return this._bloomRender}get postProcessStages(){return this.painter.postProcessStages}get projection(){return this.mapProjection._projection}set projection(t){t!==e.ProjectionType.MERCATOR&&t!==e.ProjectionType.LATLON||(this.mapProjection._projection=t);}get vertices(){return !!this._vertices}set vertices(e){this._vertices=e,this._update();}get earthSkinDepth(){return this._earthSkinDepth}set earthSkinDepth(e){this._earthSkinDepth=e;const t=this.style.getSceneComponent("earthCrate-MinemapInternal");t&&(t.depth=e,this.needRepaint=!0);}get terrainSkirtHeight(){return this._terrainSkirtHeight}set terrainSkirtHeight(e){this._terrainSkirtHeight=e,this.style.rasterSourceCache.setTerrain(this.style.rasterSourceCache.terrainSource._options);}isTerrain(){return this.style.rasterSourceCache.terrainSource.isTerrain()}setBloomOptions(e){e&&(this._bloomOptions=e);}_onData(t){if("cesium-tile"===t.dataType)this._sourcesDirty=!1,this.needRepaint=!0;else if("gltf-data-loaded"===t.dataType)this._update(!1,!0);else {this._update("style"===t.dataType,!1);const i=t.styleJsonData;e.defined(i)&&e.defined(i.cameraPosition)&&this.setCameraPosition(i.cameraPosition),this.fire(new e.Event(`${t.dataType}data`,t));}}_processStyleJson(t){const i=t.styleJsonData;"style"===t.dataType&&e.defined(i)&&lg.deserialize(this,i,t);}_onDataLoading(t){this.fire(new e.Event(`${t.dataType}dataloading`,t));}getTDSpaceCoord(t){if(t.disableLayer){const i=this.unproject(t.point,0);return {lngLat:i,geographic:i?e.Transforms.cartographicToCartesian3([i.lng,i.lat,0]):null,altitude:0}}{const i=this.queryRenderedFeatures(t.point,{disableLayer:!1,modelHighlight:t.modelHighlight,highlightRange:t.highlightRange||e.CONSTS.HIGHLIGHT_TYPE.PRIMITIVE});if(0===i.length){const i=this.unproject(t.point,0);return {lngLat:i,geographic:i?e.Transforms.cartographicToCartesian3([i.lng,i.lat,0]):null,altitude:0}}{let s=null;for(let e=0;e<i.length;e++)i[e].hasOwnProperty("intersectionPoint")&&(s=i[e].intersectionPoint);if(s){const t=e.Transforms.cartesian3ToCartographic(new e.Vector3(s));return {geographic:s,lngLat:new e.LngLat(t[0],t[1]),altitude:t[2]*e.CONSTS.TRANSFORM.R_ZOOM}}{const i=this.unproject(t.point,0);return {lngLat:i,geographic:i?e.Transforms.cartographicToCartesian3([i.lng,i.lat,0]):null,altitude:0}}}}}setTimerCount(e){this.timer.totalTime=e,this._stopTimerCount=!1,this.timer.resumeTimer();}pauseTimerCount(){this._stopTimerCount||this.timer.pauseTimer();}resumeTimerCount(){this._stopTimerCount||this.timer.resumeTimer();}stopTimerCount(){this._stopTimerCount=!0,this.timer.pauseTimer();}getCameraHeight(){return +this.transform.activeCamera.cartographicPosition[2].toFixed(2)}get camera(){return this.painter.frameState.camera}setMinPitch(t){if((t=e.defaultValue(t,0))<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=e.defaultValue(t,oy))>oy)throw new Error("maxPitch must be less than or equal to 180");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}addFPSControl(){return this.fpsControl||(this.fpsControl=new Yp,this.addControl(this.fpsControl,"top-right")),this.fpsControl}removeFPSControl(){this.fpsControl&&(this.removeControl(this.fpsControl),this.fpsControl=null);}getFeatureByGPUPick(e){return this.painter.getFeatureByGPUPick(e)}getFeatureByPickColor(e){return this.painter.getFeatureByPickColor(e)}getPositionByGPUPick(e,t){return this.painter.getPositionByGPUPick(e,t)}_updateSyncAnimation(e){this.animationManager.update(e),this.particleSystemCollection.collection.length>0&&this.particleSystemCollection.collection.forEach((t=>{t.update(e,this);}));}getEarthSkinObject(){return this.style.sceneObjectCollection.getEarthObject()}_printInfo(){console.log("███╗   ███╗██╗███╗   ██╗███████╗███╗   ███╗ █████╗ ██████╗     ████████╗███████╗ █████╗ ███╗   ███╗██╗\n████╗ ████║██║████╗  ██║██╔════╝████╗ ████║██╔══██╗██╔══██╗    ╚══██╔══╝██╔════╝██╔══██╗████╗ ████║██║\n██╔████╔██║██║██╔██╗ ██║█████╗  ██╔████╔██║███████║██████╔╝       ██║   █████╗  ███████║██╔████╔██║██║\n██║╚██╔╝██║██║██║╚██╗██║██╔══╝  ██║╚██╔╝██║██╔══██║██╔═══╝        ██║   ██╔══╝  ██╔══██║██║╚██╔╝██║╚═╝\n██║ ╚═╝ ██║██║██║ ╚████║███████╗██║ ╚═╝ ██║██║  ██║██║            ██║   ███████╗██║  ██║██║ ╚═╝ ██║██╗\n╚═╝     ╚═╝╚═╝╚═╝  ╚═══╝╚══════╝╚═╝     ╚═╝╚═╝  ╚═╝╚═╝            ╚═╝   ╚══════╝╚═╝  ╚═╝╚═╝     ╚═╝╚═╝\n                                                                                                      \n"),console.log(`%cMineMap4.0\r\n版本：${et}\r\n时间：${"/**\n * minemap-3d-engine\n * version: v4.7.2\n * submission time: 2024-04-12 17:35:55 +0800\n * build time: 2024-04-12 17:38:41\n * branch: master\n * SHA: dfddb36eebaac68dc8aff87a6f4971191ec55749\n */"?.split("*")[6].substring(13,32)||(new Date).toLocaleDateString()}\r\n分支：master\r\n电话：400-650-0295\r\n邮箱：tujieyong11188@navinfo.com\r\n`,"color: red; font-size: 16px;");}}function uy(e){e.parentNode&&e.parentNode.removeChild(e);}const dy={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0},my="minemap-ctrl";let py;const fy={maxWidth:100,unit:"metric"};function gy(t,i,s,r){const n=r&&r.maxWidth||100,o=t._container.getBoundingClientRect().height/2,a=t._container.getBoundingClientRect().width/2,l=t.unproject([a,o]),h=t.unproject([a+1,o]);if(!l||!h)return;const _=function(t,i){const s=e.CONSTS.TRANSFORM.R,r=Math.PI/180,n=t.lat*r,o=i.lat*r,a=Math.sin(n)*Math.sin(o)+Math.cos(n)*Math.cos(o)*Math.cos((i.lng-t.lng)*r);return s*Math.acos(Math.min(a,1))}(t.unproject([a,o]),t.unproject([a+1,o]))*n;if(r&&"imperial"===r.unit){const e=3.2808*_;e>5280?yy(i,s,n,e/5280,t._getUIString("ScaleControl.Miles"),t):yy(i,s,n,e,t._getUIString("ScaleControl.Feet"),t);}else r&&"nautical"===r.unit?yy(i,s,n,_/1852,t._getUIString("ScaleControl.NauticalMiles"),t):_>=1e3?yy(i,s,n,_/1e3,t._getUIString("ScaleControl.Kilometers"),t):yy(i,s,n,_,t._getUIString("ScaleControl.Meters"),t);}function yy(e,t,i,s,r,n){const o=function(e){const t=Math.pow(10,`${Math.floor(e)}`.length-1);let i=e/t;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1,t*i}(s),a=o/s;n._requestDomTask((()=>{e.style.width=i*a+"px",e.innerHTML=`${o}&nbsp;${r}`;})),t.innerHTML=o+r;}const Cy={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ty=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");var xy=Object.freeze({DISABLED:0,ENABLED:1,CAST_ONLY:2,RECEIVE_ONLY:3});class by{constructor(t,i){t=e.defaultValue(t,0),this._near=t,i=e.defaultValue(i,Number.MAX_VALUE),this._far=i;}get near(){return this._near}set near(e){this._near=e;}get far(){return this._far}set far(e){this._far=e;}pack(t,i,s){if(!e.defined(t))throw new Error("value is required");if(!e.defined(i))throw new Error("array is required");return s=e.defaultValue(s,0),i[s++]=t.near,i[s]=t.far,i}unpack(t,i,s){if(!e.defined(t))throw new Error("array is required");return i=e.defaultValue(i,0),e.defined(s)||(s=new by),s.near=t[i++],s.far=t[i],s}static equals(t,i){return t===i||e.defined(t)&&e.defined(i)&&t.near===i.near&&t.far===i.far}equals(e){return by.equals(this,e)}static clone(t,i){if(e.defined(t))return e.defined(i)||(i=new by),i.near=t.near,i.far=t.far,i}clone(e){return by.clone(this,e)}}const vy=new e.Vector3(.005,.005,1),wy=new e.Vector3;class Sy{constructor(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this.mass=e.defaultValue(t.mass,1),this.position=e.Vector3.clone(e.defaultValue(t.position,e.Vector3.ZERO)),this.positionClone=e.Vector3.clone(e.defaultValue(t.positionClone,e.Vector3.ZERO)),this.velocity=e.Vector3.clone(e.defaultValue(t.velocity,e.Vector3.ZERO)),this.life=e.defaultValue(t.life,Number.MAX_VALUE),this.image=t.image,this.texture=t.texture,this.imageUrl=t.imageUrl,this.startColor=e.Color.clone(e.Color.parse(e.defaultValue(t.startColor,e.Color.white))),this.endColor=e.Color.clone(e.Color.parse(e.defaultValue(t.endColor,e.Color.white))),this.startScale=e.defaultValue(t.startScale,1),this.endScale=e.defaultValue(t.endScale,1),this.imageSize=e.Vector3.clone(e.defaultValue(t.imageSize,vy)),this._age=0,this._normalizedAge=0,this._billboard=void 0,this.show=!0;}get age(){return this._age}get normalizedAge(){return this._normalizedAge}update(t,i){return e.Vector3.multiplyByScalar(this.velocity,t,wy),e.Vector3.add(this.position,wy,this.position),e.defined(i)&&i(this,t),this._age+=t,this._normalizedAge=this.life===Number.MAX_VALUE?0:this._age/this.life,this._age<=this.life}}class Ay{constructor(t){t=e.defaultValue(t,1),this._radius=e.defaultValue(t,1);}emit(t){const i=e.randomBetween(0,e.CONSTS.TRANSFORM.TWO_PI),s=e.randomBetween(0,this._radius),r=s*Math.cos(i),n=s*Math.sin(i);t.position=e.Vector3.fromElements(r,n,0,t.position),t.velocity=e.Vector3.clone(e.Vector3.UNIT_Z,t.velocity);}}const Ey=new e.Vector3;function My(t){let i=t._particlePool.pop();return e.defined(i)||(i=new Sy),i}function Py(e,t){e._particlePool.push(t);}function Ry(t){e.defined(t)&&(t.show=!1);}function By(t,i){i.show=!0;const s=e.lerp(i.startScale,i.endScale,i.normalizedAge);i.scale=s;const r=e.lerp(i.startColor.r,i.endColor.r,i.normalizedAge),n=e.lerp(i.startColor.g,i.endColor.g,i.normalizedAge),o=e.lerp(i.startColor.b,i.endColor.b,i.normalizedAge),a=e.lerp(i.startColor.a,i.endColor.a,i.normalizedAge);i.color=new e.Color(r,n,o,a);}function Iy(t,i){i.startColor=e.Color.clone(t._startColor,i.startColor),i.endColor=e.Color.clone(t._endColor,i.endColor),i.startScale=t._startScale,i.endScale=t._endScale,i.image=t.image,i.imageUrl=t.imageUrl,i.texture=t.texture,i.life=t.particleLife,i.mass=e.randomBetween(t._minimumMass,t._maximumMass),i._normalizedAge=0,i._age=0,i.show=!0,i.imageSize=t.imageSize,e.Vector3.multiplyByScalar(i.velocity,t._speed,i.velocity),t._particles.push(i);}function Dy(t,i){const s=e.defaultValue(Math.sign,(e=>0==(e=+e)||e!=e?e:e>0?1:-1)),r=e.defaultValue(Math.sign,(e=>0==(e=+e)||e!=e?e:e>0?1:-1));return s===r&&Math.abs(t)<Math.abs(i)?t:(t%i+i)%i}const Oy=e.CONSTS.CesiumMath.toDegrees(30),Ly=new e.Vector3(1,1,1),Vy=new e.Vector3,Ny=new e.Vector3(1,1,1),Fy=new e.Vector3;class Gy{read(t){if(!t)return null;if("string"==typeof t){const s=(i=t,(new e.window.DOMParser).parseFromString(i,"application/xml"));return this.readFromDocument(s)}return "documentElement"in t?this.readFromDocument(t):this.readFromNode(t);var i;}readFromDocument(t){for(let i=t.firstChild;i;i=i.nextSibling)if(i.nodeType==e.window.Node.ELEMENT_NODE)return this.readFromNode(i);return null}readFromNode(e){}}function ky(e,t){return Uy(e,t,[]).join("")}function Uy(t,i,s){if(t.nodeType==e.window.Node.CDATA_SECTION_NODE||t.nodeType==e.window.Node.TEXT_NODE)s.push(i?String(t.nodeValue).replace(/(\r\n|\r|\n)/g,""):t.nodeValue);else {let e;for(e=t.firstChild;e;e=e.nextSibling)Uy(e,i,s);}return s}function Hy(e,t){return function(i,s){const r=e.call(void 0!==t?t:this,i,s);void 0!==r&&s[s.length-1].push(r);}}function zy(e,t,i){return function(s,r){const n=e.call(void 0!==i?i:this,s,r);if(void 0!==n){const e=r[r.length-1],i=void 0!==t?t:s.localName;let o;i in e?o=e[i]:(o=[],e[i]=o),o.push(n);}}}function Wy(e,t,i){return function(s,r){const n=e.call(void 0!==i?i:this,s,r);void 0!==n&&(r[r.length-1][void 0!==t?t:s.localName]=n);}}function jy(e,t,i){let s,r;for(i=void 0!==i?i:{},s=0,r=e.length;s<r;++s)i[e[s]]=t;return i}function Xy(e,t,i,s,r){return s.push(e),function(e,t,i,s){let r;for(r=t.firstElementChild;r;r=r.nextElementSibling){const t=e[r.namespaceURI];if(void 0!==t){const e=t[r.localName];void 0!==e&&e.call(s,r,i);}}}(t,i,s,r),s.pop()}function qy(e){return e.getAttributeNS("http://www.w3.org/1999/xlink","href")}function Ky(e){return function(e){const t=/^\s*(\d+)\s*$/.exec(e);if(t)return parseInt(t[1],10)}(ky(e,!1))}function Jy(e){return ky(e,!1).trim()}const Zy=[null,"http://www.opengis.net/ows/1.1"],Yy=jy(Zy,{ServiceIdentification:Wy((function(e,t){return Xy({},_C,e,t)})),ServiceProvider:Wy((function(e,t){return Xy({},cC,e,t)})),OperationsMetadata:Wy((function(e,t){return Xy({},oC,e,t)}))});class Qy extends Gy{constructor(){super();}readFromNode(e){return Xy({},Yy,e,[])||null}}const $y=jy(Zy,{DeliveryPoint:Wy(Jy),City:Wy(Jy),AdministrativeArea:Wy(Jy),PostalCode:Wy(Jy),Country:Wy(Jy),ElectronicMailAddress:Wy(Jy)}),eC=jy(Zy,{Value:zy((function(e){return Jy(e)}))}),tC=jy(Zy,{AllowedValues:Wy((function(e,t){return Xy({},eC,e,t)}))}),iC=jy(Zy,{Phone:Wy((function(e,t){return Xy({},aC,e,t)})),Address:Wy((function(e,t){return Xy({},$y,e,t)}))}),sC=jy(Zy,{HTTP:Wy((function(e,t){return Xy({},rC,e,t)}))}),rC=jy(Zy,{Get:zy((function(e,t){const i=qy(e);if(i)return Xy({href:i},lC,e,t)})),Post:void 0}),nC=jy(Zy,{DCP:Wy((function(e,t){return Xy({},sC,e,t)}))}),oC=jy(Zy,{Operation:function(e,t){const i=e.getAttribute("name"),s=Xy({},nC,e,t);s&&(t[t.length-1][i]=s);}}),aC=jy(Zy,{Voice:Wy(Jy),Facsimile:Wy(Jy)}),lC=jy(Zy,{Constraint:zy((function(e,t){const i=e.getAttribute("name");if(i)return Xy({name:i},tC,e,t)}))}),hC=jy(Zy,{IndividualName:Wy(Jy),PositionName:Wy(Jy),ContactInfo:Wy((function(e,t){return Xy({},iC,e,t)}))}),_C=jy(Zy,{Abstract:Wy(Jy),AccessConstraints:Wy(Jy),Fees:Wy(Jy),Title:Wy(Jy),ServiceTypeVersion:Wy(Jy),ServiceType:Wy(Jy)}),cC=jy(Zy,{ProviderName:Wy(Jy),ProviderSite:Wy(qy),ServiceContact:Wy((function(e,t){return Xy({},hC,e,t)}))}),uC=[null,"http://www.opengis.net/wmts/1.0"],dC=[null,"http://www.opengis.net/ows/1.1"],mC=jy(uC,{Contents:Wy((function(e,t){return Xy({},pC,e,t)}))}),pC=jy(uC,{Layer:zy((function(e,t){return Xy({},fC,e,t)})),TileMatrixSet:zy((function(e,t){return Xy({},vC,e,t)}))}),fC=jy(uC,{Style:zy((function(e,t){const i=Xy({},gC,e,t);if(!i)return;const s="true"===e.getAttribute("isDefault");return i.isDefault=s,i})),Format:zy(Jy),TileMatrixSetLink:zy((function(e,t){return Xy({},yC,e,t)})),Dimension:zy((function(e,t){return Xy({},xC,e,t)})),ResourceURL:zy((function(e){const t=e.getAttribute("format"),i=e.getAttribute("template"),s=e.getAttribute("resourceType"),r={};return t&&(r.format=t),i&&(r.template=i),s&&(r.resourceType=s),r}))},jy(dC,{Title:Wy(Jy),Abstract:Wy(Jy),WGS84BoundingBox:Wy(SC),Identifier:Wy(Jy)})),gC=jy(uC,{LegendURL:zy((function(e){const t={};return t.format=e.getAttribute("format"),t.href=qy(e),t}))},jy(dC,{Title:Wy(Jy),Identifier:Wy(Jy)})),yC=jy(uC,{TileMatrixSet:Wy(Jy),TileMatrixSetLimits:Wy((function(e,t){return Xy([],CC,e,t)}))}),CC=jy(uC,{TileMatrixLimits:Hy((function(e,t){return Xy({},TC,e,t)}))}),TC=jy(uC,{TileMatrix:Wy(Jy),MinTileRow:Wy(Ky),MaxTileRow:Wy(Ky),MinTileCol:Wy(Ky),MaxTileCol:Wy(Ky)}),xC=jy(uC,{Default:Wy(Jy),Value:zy(Jy)},jy(dC,{Identifier:Wy(Jy)})),bC=jy(dC,{LowerCorner:Hy(AC),UpperCorner:Hy(AC)}),vC=jy(uC,{WellKnownScaleSet:Wy(Jy),TileMatrix:zy((function(e,t){return Xy({},wC,e,t)}))},jy(dC,{SupportedCRS:Wy(Jy),Identifier:Wy(Jy),BoundingBox:Wy(SC)})),wC=jy(uC,{TopLeftCorner:Wy(AC),ScaleDenominator:Wy((function(e){return function(e){const t=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(e);if(t)return parseFloat(t[1])}(ky(e,!1))})),TileWidth:Wy(Ky),TileHeight:Wy(Ky),MatrixWidth:Wy(Ky),MatrixHeight:Wy(Ky)},jy(dC,{Identifier:Wy(Jy)}));function SC(e,t){const i=Xy([],bC,e,t);if(2==i.length)return function(e){const t=[1/0,1/0,-1/0,-1/0];for(let i=0,s=e.length;i<s;++i)EC(t,e[i]);return t}(i)}function AC(e){const t=Jy(e).split(/\s+/);if(!t||2!=t.length)return;const i=+t[0],s=+t[1];return isNaN(i)||isNaN(s)?void 0:[i,s]}function EC(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1]);}const MC=[0,0,0];class PC{constructor(e){let t;if(this.minZoom=void 0!==e.minZoom?e.minZoom:0,this.resolutions=e.resolutions,!e.origins)for(let e=0,i=this.resolutions.length-1;e<i;++e)if(t){if(this.resolutions[e]/this.resolutions[e+1]!==t){t=void 0;break}}else t=this.resolutions[e]/this.resolutions[e+1];this.zoomFactor=t,this.maxZoom=this.resolutions.length-1,this.origin=void 0!==e.origin?e.origin:null,this.origins=null,void 0!==e.origins&&(this.origins=e.origins);const i=e.extent;void 0===i||this.origin||this.origins||(this.origin=[i[0],i[3]]),this.tileSizes=null,void 0!==e.tileSizes&&(this.tileSizes=e.tileSizes),this.tileSize=void 0!==e.tileSize?e.tileSize:this.tileSizes?null:256,this.extent=void 0!==i?i:null,this.fullTileRanges=null,this.tmpSize=[0,0],this.tmpExtent=[0,0,0,0],void 0!==e.sizes?this.fullTileRanges=e.sizes.map((function(e,t){const s={minX:Math.min(0,e[0]),maxX:Math.max(e[0]-1,-1),minY:Math.min(0,e[1]),maxY:Math.max(e[1]-1,-1)};if(i){const e=this.getTileRangeForExtentAndZ(i,t);s.minX=Math.max(e.minX,s.minX),s.maxX=Math.min(e.maxX,s.maxX),s.minY=Math.max(e.minY,s.minY),s.maxY=Math.min(e.maxY,s.maxY);}return s}),this):i&&this.calculateTileRanges(i);}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin?this.origin:this.origins[e]}getResolution(e){return this.resolutions[e]}getTileRangeForExtentAndZ(e,t){this.getTileCoordForXYAndZ(e[0],e[3],t,!1,MC);const i=MC[1],s=MC[2];return this.getTileCoordForXYAndZ(e[2],e[1],t,!0,MC),{minX:i,maxX:MC[1],minY:s,maxY:MC[2]}}getTileCoordForXYAndZ(e,t,i,s,r){const n=this.getOrigin(i),o=this.getResolution(i),a=(l=this.getTileSize(i),h=this.tmpSize,Array.isArray(l)?l:(void 0===h?h=[l,l]:(h[0]=l,h[1]=l),h));var l,h;let _=(e-n[0])/o/a[0],c=(n[1]-t)/o/a[1];return s?(_=Math.ceil(RC(_,5))-1,c=Math.ceil(RC(c,5))-1):(_=Math.floor(RC(_,5)),c=Math.floor(RC(c,5))),r[0]=i,r[1]=_,r[2]=c,r}getTileSize(e){return this.tileSize?this.tileSize:this.tileSizes[e]}getFullTileRange(e){return this.fullTileRanges?this.fullTileRanges[e]:this.extent?this.getTileRangeForExtentAndZ(this.extent,e):null}calculateTileRanges(e){const t=this.resolutions.length,i=new Array(t);for(let s=this.minZoom;s<t;++s)i[s]=this.getTileRangeForExtentAndZ(e,s);this.fullTileRanges=i;}}function RC(e,t){const i=Math.pow(10,t);return Math.round(e*i)/i}function BC(e){if("EPSG:4326"!==(e=e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3"))&&"EPSG:3857"!==e)throw Error(`WTMS服务中含有不支持的坐标系统${e}`);return e}class IC extends PC{constructor(e){super({extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes}),this.matrixIds=e.matrixIds;}getMatrixId(e){return this.matrixIds[e]}getMatrixIds(){return this.matrixIds}}const DC={getJSON:e.getJSON,getString:e.getString},OC={RenderState:e.RenderState,ArcType:e.ArcType,ARCTYPE:e.ARCTYPE,AnimationConstants:h,AnimationTrackingMode:We,AnimationTrackingEffects:_,ClassificationType:e.ClassificationType,LightingModelType:e.LightingModelType,ShadowsModelType:xy,ShadowsType:e.ShadowsType,ViewDomeType:Of,ProjectionType:e.ProjectionType,WebGLConstants:e.WebGLConstants,AnimationClip:Ue,AnimationBlender:Ke,MultiTrackingKeyframeTrack:Qe,MultiPositionKeyframeTrack:$e,TrackingKeyframeTrack:Ye,PositionKeyframeTrack:Ze,Attribution:Xp,FPSControl:Yp,Fullscreen:class{constructor(){this._fullscreen=!1,e.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in e.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in e.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in e.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in e.window.document&&(this._fullscreenchange="MSFullscreenChange"),this._className="minemap-ctrl";}onAdd(t){return this._map=t,this._mapContainer=this._map.getContainer(),this._container=z.create("div",`${this._className} minemap-ctrl-group`),this._checkFullscreenSupport()?this._setupUI():(this._container.style.display="none",e.warnOnce("This device does not support fullscreen mode.")),this._container}onRemove(){z.remove(this._container),this._map=null,e.window.document.removeEventListener(this._fullscreenchange,this._changeIcon);}_checkFullscreenSupport(){return !!(e.window.document.fullscreenEnabled||e.window.document.mozFullScreenEnabled||e.window.document.msFullscreenEnabled||e.window.document.webkitFullscreenEnabled)}_setupUI(){const t=this._fullscreenButton=z.create("button",`${this._className}-icon ${this._className}-fullscreen`,this._container);t.setAttribute("aria-label","Toggle fullscreen"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),e.window.document.addEventListener(this._fullscreenchange,this._changeIcon);}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.title=e;}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(e.window.document.fullscreenElement||e.window.document.mozFullScreenElement||e.window.document.webkitFullscreenElement||e.window.document.msFullscreenElement)===this._mapContainer!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle(`${this._className}-shrink`),this._fullscreenButton.classList.toggle(`${this._className}-fullscreen`));}_onClickFullscreen(){this._isFullscreen()?e.window.document.exitFullscreen?e.window.document.exitFullscreen():e.window.document.mozCancelFullScreen?e.window.document.mozCancelFullScreen():e.window.document.msExitFullscreen?e.window.document.msExitFullscreen():e.window.document.webkitCancelFullScreen&&e.window.document.webkitCancelFullScreen():this._mapContainer.requestFullscreen?this._mapContainer.requestFullscreen():this._mapContainer.mozRequestFullScreen?this._mapContainer.mozRequestFullScreen():this._mapContainer.msRequestFullscreen?this._mapContainer.msRequestFullscreen():this._mapContainer.webkitRequestFullscreen&&this._mapContainer.webkitRequestFullscreen();}},Geolocate:class extends e.Evented{constructor(t){super(),this.options=e.extend({},dy,t),e.bindAll(["_onSuccess","_onError","_finish","_setupUI","_updateCamera","_updateMarker"],this);}onAdd(t){var i;return this._map=t,this._container=z.create("div",`${my} ${my}-group`),i=this._setupUI,void 0!==py?i(py):void 0!==e.window.navigator.permissions?e.window.navigator.permissions.query({name:"geolocation"}).then((e=>{py="denied"!==e.state,i(py);})):(py=!!e.window.navigator.geolocation,i(py)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(e.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker.remove(),z.remove(this._container),this._map=void 0;}_onSuccess(t){if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-background");}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("minemap-user-location-dot-stale"),this.fire(new e.Event("geolocate",t)),this._finish();}_updateCamera(t){const i=new e.LngLat(t.coords.longitude,t.coords.latitude);this._map.fitBounds(i.toBounds(t.coords.accuracy),this.options.fitBoundsOptions,{geolocateSource:!0});}_updateMarker(e){e?this._userLocationDotMarker.setLngLat([e.coords.longitude,e.coords.latitude]).addTo(this._map):this._userLocationDotMarker.remove();}_onError(t){if(this.options.trackUserLocation)if(1===t.code)this._watchState="OFF",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background-error"),void 0!==this._geolocationWatchID&&this._clearWatch();else switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting");}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("minemap-user-location-dot-stale"),this.fire(new e.Event("error",t)),this._finish();}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0;}_setupUI(t){!1!==t?(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=z.create("button",`${my}-icon ${my}-geolocate`,this._container),this._geolocateButton.type="button",this._geolocateButton.setAttribute("aria-label",this._map._getUIString("GeolocateControl.Geolocate")),this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=z.create("div","minemap-user-location-dot"),this._userLocationDotMarker=new lf(this._dotElement),this.options.trackUserLocation&&(this._watchState="OFF")),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("minemap-ctrl-geolocate-background"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this.fire(new e.Event("trackuserlocationend")));}))):e.warnOnce("Geolocation support is not available, the GeolocateControl will not be visible.");}trigger(){if(!this._setup)return e.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._watchState="OFF",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background-error"),this.fire(new e.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.Event("trackuserlocationstart"));}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("minemap-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("minemap-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-background-error");}"OFF"===this._watchState&&void 0!==this._geolocationWatchID?this._clearWatch():void 0===this._geolocationWatchID&&(this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._geolocationWatchID=e.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,this.options.positionOptions));}else e.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return !0}_clearWatch(){e.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null);}},Navigation:wg,Scale:class{constructor(t){this.options=e.extend({},fy,t),e.bindAll(["_onMove","setUnit"],this);}getDefaultPosition(){return "bottom-left"}onAdd(t){this._map=t,this._container=z.create("div","minemap-ctrl minemap-ctrl-scale",t.getContainer()),this._content=z.create("div","minemap-ctrl-scale-text",this._container),this._container.appendChild(this._content);const i=z.create("div","minemap-ctrl-scale-left-bar",this._container),s=z.create("div","minemap-ctrl-scale-right-bar",this._container),r=z.create("div","minemap-ctrl-scale-bottom-bar",this._container);return this._container.appendChild(i),this._container.appendChild(s),this._container.appendChild(r),this._onMove=(n=()=>{gy(this._map,this._container,this._content,this.options);},a=!0,l=!0,e.isObject(o)&&(a="leading"in o?!!o.leading:a,l="trailing"in o?!!o.trailing:l),function(t,i,s){var r,n,o,a,l,h,_=0,c=!1,u=!1,d=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function m(e){var i=r,s=n;return r=n=void 0,_=e,a=t.apply(s,i)}function p(e){var t=e-h;return void 0===h||t>=i||t<0||u&&e-_>=o}function f(){var e=bo();if(p(e))return g(e);l=setTimeout(f,function(e){var t=i-(e-h);return u?wo(t,o-(e-_)):t}(e));}function g(e){return l=void 0,d&&r?m(e):(r=n=void 0,a)}function y(){var e=bo(),t=p(e);if(r=arguments,n=this,h=e,t){if(void 0===l)return function(e){return _=e,l=setTimeout(f,i),c?m(e):a}(h);if(u)return clearTimeout(l),l=setTimeout(f,i),m(h)}return void 0===l&&(l=setTimeout(f,i)),a}return i=xo(i)||0,e.isObject(s)&&(c=!!s.leading,o=(u="maxWait"in s)?vo(xo(s.maxWait)||0,i):o,d="trailing"in s?!!s.trailing:d),y.cancel=function(){void 0!==l&&clearTimeout(l),_=0,r=h=n=l=void 0;},y.flush=function(){return void 0===l?a:g(bo())},y}(n,200,{leading:a,maxWait:200,trailing:l})),this._map.on("mousemove",this._onMove),this._onMove(),this._container;var n,o,a,l;}onRemove(){z.remove(this._container),this._map.off("mousemove",this._onMove),this._map=void 0;}setUnit(e){this.options.unit=e,gy(this._map,this._container,this._content,this.options);}},Marker:lf,Popup:class extends e.Evented{constructor(t){super(),this.options=e.extend(Object.create(Cy),t),this.heightToSurface=0,e.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[]);}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("minemap-track-pointer")):this._map.on("move",this._update),t.__popupList.push(this),this.fire(new e.Event("open")),this}isOpen(){return !!this._map}remove(){if(this._content&&this._content.remove(),this._container&&(this._container.remove(),delete this._container),this._map){for(let e=0;e<this._map.__popupList.length;e++)this._map.__popupList[e]===this&&this._map.__popupList.splice(e,1);this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map;}return this.fire(new e.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(t){return t=e.LngLat.convert(t),e.LngLat.equals(t,this._lngLat||new e.LngLat(0,0))&&this.boundingVolume||(this.boundingVolume=new e.BoundingSphere(e.Vector3.fromDegrees(t.lng,t.lat,this.heightToSurface),100)),this._lngLat=e.LngLat.convert(t),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("minemap-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("minemap-track-pointer")),this}getAltitude(){return this.heightToSurface}setAltitude(t){return this.heightToSurface=t,this.boundingVolume=new e.BoundingSphere(e.Vector3.fromDegrees(this._lngLat.lng,this._lngLat.lat,this.heightToSurface),100),this._pos=null,this._update(),this._trackPointer=!1,this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("minemap-popup-track-pointer"),this._map._canvasContainer.classList.remove("minemap-track-pointer")),this}setText(t){return this.setDOMContent(e.window.document.createTextNode(t))}setHTML(t){const i=e.window.document.createDocumentFragment(),s=e.window.document.createElement("body");let r;for(s.innerHTML=t;r=s.firstChild,r;)i.appendChild(r);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=z.create("div","minemap-popup-content",this._container);return this._content.appendChild(e),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._container&&this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._container&&this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._container&&this._updateClassList(),t}_createCloseButton(){this.options.closeButton&&(this._closeButton=z.create("button","minemap-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose));}_createContent(){this._content&&z.remove(this._content),this._content=z.create("div","minemap-popup-content",this._container),this.options.closeButton&&(this._closeButton=z.create("button","minemap-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClickClose));}_updateClassList(){const e=[...this._classList];e.push("minemap-popup"),this._anchor&&e.push(`minemap-popup-anchor-${this._anchor}`),this._trackPointer&&e.push("minemap-popup-track-pointer"),this._container.className=e.join(" ");}calculateScreenCoordinates(){const t=e.Transforms.cartographicToCartesian3(new e.Vector3(this._lngLat.lng,this._lngLat.lat,this.heightToSurface||0)),i=this._map.transform,s=e.Transforms.pointToWindowCoordinatesFrontCheck(i.activeCamera.getVPMatrix(),i.pixelMatrix,new e.Vector3(t));return new e.pointGeometry3d(s.x*s.z,s.y*s.z)}_update(t){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=z.create("div","minemap-popup",this._map.getContainer()),this._tip=z.create("div","minemap-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),!this._trackPointer||t){const i=this._pos=this._trackPointer&&t?t:this.calculateScreenCoordinates(),s=function(t){if(t||(t=new e.pointGeometry3d(0,0)),"number"==typeof t){const i=Math.round(Math.sqrt(.5*Math.pow(t,2)));return {center:new e.pointGeometry3d(0,0),top:new e.pointGeometry3d(0,t),"top-left":new e.pointGeometry3d(i,i),"top-right":new e.pointGeometry3d(-i,i),bottom:new e.pointGeometry3d(0,-t),"bottom-left":new e.pointGeometry3d(i,-i),"bottom-right":new e.pointGeometry3d(-i,-i),left:new e.pointGeometry3d(t,0),right:new e.pointGeometry3d(-t,0)}}if(t instanceof e.pointGeometry3d||Array.isArray(t)){const i=e.pointGeometry3d.convert(t);return {center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return {center:e.pointGeometry3d.convert(t.center||[0,0]),top:e.pointGeometry3d.convert(t.top||[0,0]),"top-left":e.pointGeometry3d.convert(t["top-left"]||[0,0]),"top-right":e.pointGeometry3d.convert(t["top-right"]||[0,0]),bottom:e.pointGeometry3d.convert(t.bottom||[0,0]),"bottom-left":e.pointGeometry3d.convert(t["bottom-left"]||[0,0]),"bottom-right":e.pointGeometry3d.convert(t["bottom-right"]||[0,0]),left:e.pointGeometry3d.convert(t.left||[0,0]),right:e.pointGeometry3d.convert(t.right||[0,0])}}(this.options.offset),r=this._anchor=this._getAnchor(s),n=i.add(s[r]).round();this._map._requestDomTask((()=>{this._container&&r&&(this._container.style.transform=`${af[r]} translate(${n.x}px,${n.y}px)`);})),this._updatePanoramaMode();}this._updateClassList();}}_updatePanoramaMode(){if(!this._trackPointer){const t=this._map.transform.activeCamera.frustumCrate.cullingVolume.computeVisibility(this.boundingVolume);if(this._container.style.visibility=t===e.INTERSECTION.OUTSIDE?"hidden":"visible","visible"==this._container.style.visibility){const t=e.Transforms.cartographicToCartesian3([this._lngLat.lng,this._lngLat.lat,this.heightToSurface]),i=new e.Vector3(this._map.transform.getCameraPos()),s=new e.Vector3(t[0]-i[0],t[1]-i[1],t[2]-i[2]).normalize(),r=e.getPickPositionOfSurfaceByOriginAndDir(i,s);r&&i.distance(r)<i.distance(t)-1e4&&(this._container.style.visibility="hidden");}}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(Ty);e&&e.focus();}_onClose(){this.remove();}_setOpacity(e){this._content&&(this._content.style.opacity=e),this._tip&&(this._tip.style.opacity=e);}getElement(){return this._container}getMap(){return this._map}_onMouseUp(e){this._update(e.point);}_onMouseMove(e){this._update(e.point);}_onDrag(e){this._update(e.point);}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._pos,i=this._container.offsetWidth,s=this._container.offsetHeight;let r;return r=t.y+e.bottom.y<s?["top"]:t.y>this._map.transform.height-s?["bottom"]:[],t.x<i/2?r.push("left"):t.x>this._map.transform.width-i/2&&r.push("right"),0===r.length?"bottom":r.join("-")}},OrthographicCamera:l,PerspectiveCamera:a,OrthographicFrustum:e.OrthographicFrustum,OrthographicOffCenterFrustum:e.OrthographicOffCenterFrustum,PerspectiveFrustum:s,PerspectiveOffCenterFrustum:e.PerspectiveOffCenterFrustum,Plane:e.Plane,INTERSECTION:e.INTERSECTION,BillboardMaterial:ga,GradientColorBoxMaterial:sg,PhysicalMaterial:Uo,StandardMaterial:e.StandardMaterial,StandardMaterialType:e.StandardMaterialType,WaterMaterial:rg,MirrorMaterial:Cp,PhongMaterial:zo,LambertMaterial:class extends e.Material{constructor(t){t.type="LambertMaterial",super(t),this.color=new e.Color(1,1,1).toVector3(),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new e.Color(0,0,0).toVector3(),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new e.Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.opacity=1,this.setValues(t);}setValues(e){super.setValues(e);}update(e,t,i={}){super.update(e,t,i),this._uniforms.set("u_Color",(()=>this.color)),this._uniforms.set("u_Reflectivity",(()=>this.reflectivity)),this._uniforms.set("u_Opacity",(()=>this.opacity));}serialize(){return {type:this.type,color:e.Vector3.pack(this.color,new Array(3)),reflectivity:this.reflectivity,opacity:this.opacity}}destroy(){}},PolylineMaterial:e.PolylineMaterial,BoxGeometry:Jf,BoxOutlineGeometry:Um,ConeGeometry:Zf,CylinderGeometry:Yf,FrustumGeometry:mf,FrustumOutlineGeometry:pf,PlaneGeometry:eg,PlaneOutlineGeometry:tg,PolygonGeometry:e.PolygonGeometry,PolygonOutlineGeometry:vf,SimplePolylineGeometry:$u,SphereGeometry:Ch,GradientColorBoxGeometry:$f,WallGeometry:Mf,WallOutlineGeometry:ig,PolylineGeometry:e.PolylineGeometry,BillboardGeometry:Ca,FenceGeometry:Qf,Geometries:{BoxGeometry:Jf,BoxOutlineGeometry:Um,ConeGeometry:Zf,CylinderGeometry:Yf,FrustumGeometry:mf,FrustumOutlineGeometry:pf,PlaneGeometry:eg,PlaneOutlineGeometry:tg,PolygonGeometry:e.PolygonGeometry,PolygonOutlineGeometry:vf,SimplePolylineGeometry:$u,SphereGeometry:Ch,GradientColorBoxGeometry:$f,WallGeometry:Mf,WallOutlineGeometry:ig,PolylineGeometry:e.PolylineGeometry,BillboardGeometry:Ca,FenceGeometry:Qf},PointPrimitive:_h,PointPrimitiveCollection:ph,Primitive:e.Primitive,AmbientLight:Qc,SunLight:Fo,DirectionalLight:Mo,PointLight:yp,AxisAlignedBoundingBox:e.AxisAlignedBoundingBox,BoundingRectangle:e.BoundingRectangle,BoundingSphere:e.BoundingSphere,OrientedBoundingBox:e.OrientedBoundingBox,Bounds:{AxisAlignedBoundingBox:e.AxisAlignedBoundingBox,BoundingRectangle:e.BoundingRectangle,BoundingSphere:e.BoundingSphere,OrientedBoundingBox:e.OrientedBoundingBox},SphereEmitter:class{constructor(t){t=e.defaultValue(t,1),this._radius=e.defaultValue(t,1);}emit(t){const i=e.randomBetween(0,e.CONSTS.TRANSFORM.TWO_PI),s=e.randomBetween(0,e.CONSTS.TRANSFORM.PI),r=e.randomBetween(0,this._radius),n=r*Math.cos(i)*Math.sin(s),o=r*Math.sin(i)*Math.sin(s),a=r*Math.cos(s);t.position=e.Vector3.fromElements(n,o,a,t.position),t.velocity=e.Vector3.normalize(t.position,t.velocity);}},CircleEmitter:Ay,ConeEmitter:class{constructor(t){this._angle=e.defaultValue(t,Oy);}emit(t){const i=Math.tan(this._angle),s=e.randomBetween(0,e.CONSTS.TRANSFORM.TWO_PI),r=e.randomBetween(0,i),n=r*Math.cos(s),o=r*Math.sin(s);t.velocity=e.Vector3.fromElements(n,o,1,t.velocity),e.Vector3.normalize(t.velocity,t.velocity),t.position=e.Vector3.clone(e.Vector3.ZERO,t.position);}},BoxEmitter:class{constructor(t){t=e.defaultValue(t,Ly),this._dimensions=e.Vector3.clone(t);}emit(t){const i=e.Vector3.multiplyByScalar(this._dimensions,.5,Vy),s=e.randomBetween(-i.x,i.x),r=e.randomBetween(-i.y,i.y),n=e.randomBetween(-i.z,i.z);t.position=e.Vector3.fromElements(s,r,n,t.position),t.velocity=e.Vector3.normalize(t.position,t.velocity);}},RandomBoxEmitter:class{constructor(t){t=e.defaultValue(t,Ny),this._dimensions=e.Vector3.clone(t),this._isComplete=!1,this.isRandomBoxEmitter=!0;}emit(t){const i=e.Vector3.multiplyByScalar(this._dimensions,.5,Fy),s=e.randomBetween(-i.x,i.x),r=e.randomBetween(-i.y,i.y),n=e.randomBetween(-i.z,i.z);t.position=e.Vector3.fromElements(s,r,n,t.position);}},ParticleBurst:class{constructor(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this.time=e.defaultValue(t.time,0),this.minimum=e.defaultValue(t.minimum,0),this.maximum=e.defaultValue(t.maximum,50),this._complete=!1;}get complete(){return this._complete}},ParticleSystem:class{constructor(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this.show=e.defaultValue(t.show,!0),this.updateCallback=t.updateCallback,this.loop=e.defaultValue(t.loop,!0),this.image=e.defaultValue(t.image,void 0);let i=t.emitter;e.defined(i)||(i=new Ay(.5)),this._emitter=i,this._bursts=t.bursts,this._modelMatrix=e.Matrix4.clone(e.defaultValue(t.modelMatrix,e.Matrix4.IDENTITY),new e.Matrix4),this._emitterModelMatrix=e.Matrix4.clone(e.defaultValue(t.emitterModelMatrix,e.Matrix4.IDENTITY),new e.Matrix4),this._matrixDirty=!0,this._combinedMatrix=new e.Matrix4,this._startColor=e.Color.clone(e.Color.parse(e.defaultValue(t.startColor,e.Color.white))),this._endColor=e.Color.clone(e.Color.parse(e.defaultValue(t.endColor,e.Color.white))),this._particleNumber=e.defaultValue(t.particleNumber,1e4),this._startScale=e.defaultValue(t.startScale,1),this._endScale=e.defaultValue(t.endScale,1),this._emissionRate=e.defaultValue(t.emissionRate,5),this.sizeattenuation=e.defaultValue(t.sizeattenuation,!0),this._speed=e.defaultValue(t.speed,1),this._particleLife=e.defaultValue(t.particleLife,5),this._minimumMass=e.defaultValue(t.minimumMass,1),this._maximumMass=e.defaultValue(t.maximumMass,1),this._lifetime=e.defaultValue(t.lifetime,Number.MAX_VALUE),this._plummeting=e.defaultValue(t.plummeting,!1),this._billboardCollection=void 0,this._particles=[],this._particlePool=[],this._previousTime=void 0,this._currentTime=0,this._carryOver=0,this._isComplete=!1,this._updateParticlePool=!0,this._particleEstimate=0,this._primitive=null,this.imageSize=t.imageSize,this.imageUrl=t.imageUrl,this.texture=t.texture,this.id=e.defaultValue(t.id,e.uuid());}get emitter(){return this._emitter}set emitter(e){this._emitter=e;}get bursts(){return this._bursts}set bursts(e){this._bursts=e,this._updateParticlePool=!0;}get modelMatrix(){return this._modelMatrix}set modelMatrix(t){e.defined(t)&&(this._matrixDirty=this._matrixDirty||!e.Matrix4.equals(this._modelMatrix,t),e.Matrix4.clone(t,this._modelMatrix));}get emitterModelMatrix(){return this._emitterModelMatrix}set emitterModelMatrix(t){this._matrixDirty=this._matrixDirty||!e.Matrix4.equals(this._emitterModelMatrix,t),e.Matrix4.clone(t,this._emitterModelMatrix);}get startColor(){return this._startColor}set startColor(t){e.Color.clone(t,this._startColor);}get endColor(){return this._endColor}set endColor(t){e.Color.clone(t,this._endColor);}get startScale(){return this._startScale}set startScale(t){e.Color.clone(t,this._startScale);}get endScale(){return this._endScale}set endScale(t){e.Color.clone(t,this._endScale);}get emissionRate(){return this._emissionRate}set emissionRate(e){this._emissionRate=e,this._updateParticlePool=!0;}get speed(){return this._speed}set speed(e){this._speed=e;}get particleLife(){return this._particleLife}set particleLife(e){this._particleLife=e;}get lifetime(){return this._lifetime}set lifetime(e){this._lifetime=e;}get isComplete(){return this._isComplete}get particleNumber(){return this._particleNumber}set particleNumber(e){this._particleNumber=e,this._emitter.isComplete=!1,this._particles=[];}update(t,i){if(!this.show)return;e.defined(this._billboardCollection)||(this._billboardCollection=[]),this._updateParticlePool&&(function(t,i){const s=t._emissionRate,r=t._maximumParticleLife;let n=0;const o=t._bursts;if(e.defined(o)){const e=o.length;for(let t=0;t<e;++t)n+=o[t].maximum;}const a=t.image,l=t.imageUrl,h=t.texture,_=Math.ceil(s*r+n),c=t._particlePool;let u;u=t._emitter.isRandomBoxEmitter?t._particleNumber:Math.max(_-t._particles.length-c.length,0);for(let e=0;e<u;++e){const e=new Sy({imageSize:t.imageSize});e.image=a,c.push(e);}if(t._particleEstimate=_,!t._primitive){const s=new Ca;let r;a?r=new ga({image:a,sizeattenuation:t.sizeattenuation,scale:t.imageSize}):l?r=new ga({imageUrl:l,sizeattenuation:t.sizeattenuation,scale:t.imageSize}):h?r=new ga({texture:h,sizeattenuation:t.sizeattenuation,scale:t.imageSize}):console.error("请传入纹理texture或图片路径imageUrl或是canvas图片image");const n=new e.Primitive({id:t.id,geometry:s,material:r,particleSystem:!0});i.addPrimitive(n),t._primitive=n;}}(this,i),this._updateParticlePool=!1);let s=0;s+=t,s<0&&(s=0);const r=this._particles,n=this._emitter,o=this.updateCallback;let a,l;if(this._emitter.isRandomBoxEmitter){if(this._emitter.isComplete){this._matrixDirty&&(this._combinedMatrix=e.Matrix4.multiply(this._combinedMatrix,this.modelMatrix,this.emitterModelMatrix),this._matrixDirty=!1);const t=this._combinedMatrix,i=-this._emitter._dimensions.z/2,r=-this._emitter._dimensions.y/2,n=-this._emitter._dimensions.x/2;for(a=0;a<this._particles.length;a++){if(this._plummeting){const e=10*Math.cos(.15*s*this._particles[a].velocity.z);this._particles[a].positionClone.z-=e*this._speed;}else {const e=1e3*Math.sin(.5*s*this._particles[a].velocity.x),t=10*Math.cos(.15*s*this._particles[a].velocity.z);this._particles[a].positionClone.x+=e,this._particles[a].positionClone.y+=5*this._particles[a].velocity.y,this._particles[a].positionClone.z-=t*this._speed;}i>this._particles[a].positionClone.z&&(this._particles[a].positionClone.z+=this._emitter._dimensions.z),r>this._particles[a].positionClone.y&&(this._particles[a].positionClone.y+=this._emitter._dimensions.y),-r<this._particles[a].positionClone.y&&(this._particles[a].positionClone.y+=-this._emitter._dimensions.y),n>this._particles[a].positionClone.x&&(this._particles[a].positionClone.x+=this._emitter._dimensions.x),-n<this._particles[a].positionClone.x&&(this._particles[a].positionClone.x+=-this._emitter._dimensions.x),e.Matrix4.multiplyByPoint(t,this._particles[a].positionClone,this._particles[a].position),By(0,this._particles[a]);}}if(!this._emitter.isComplete){this._matrixDirty&&(this._combinedMatrix=e.Matrix4.multiply(this._combinedMatrix,this.modelMatrix,this.emitterModelMatrix),this._matrixDirty=!1);const t=this._combinedMatrix;for(a=0;a<this._particleNumber;a++){l=My(this),this._emitter.emit(l);const i=.1*Math.floor(6*Math.random()-3),s=-.05*Math.floor(10*Math.random()+3),r=.1*Math.floor(6*Math.random()-3);l.velocity=new e.Vector3(i,s,r),e.Vector3.add(l.position,l.velocity,Ey),e.Matrix4.multiplyByPoint(t,Ey,Ey),l.positionClone=e.Vector3.clone(e.defaultValue(l.position,Ey)),e.Matrix4.multiplyByPoint(t,l.position,l.position),Iy(this,l),By(0,l);}this._emitter.isComplete=!0;}}else {let t=r.length;for(a=0;a<t;++a)l=r[a],l.update(s,o)?By(0,l):(Ry(l),Py(this,l),r[a]=r[t-1],--a,--t);r.length=t;const i=function(t,i){if(t._isComplete)return 0;const s=(i=Dy(i,t._lifetime))*t._emissionRate;let r=Math.floor(s);if(t._carryOver+=s-r,t._carryOver>1&&(r++,t._carryOver-=1),e.defined(t.bursts)){const i=t.bursts.length;for(let s=0;s<i;s++){const i=t.bursts[s],n=t._currentTime;e.defined(i)&&!i._complete&&n>i.time&&(r+=e.randomBetween(i.minimum,i.maximum),i._complete=!0);}}return r}(this,s);if(i>0&&e.defined(n)){this._matrixDirty&&(this._combinedMatrix=e.Matrix4.multiply(this._combinedMatrix,this.modelMatrix,this.emitterModelMatrix),this._matrixDirty=!1);const t=this._combinedMatrix;for(a=0;a<i;a++)l=My(this),this._emitter.emit(l),e.Vector3.add(l.position,l.velocity,Ey),e.Matrix4.multiplyByPoint(t,Ey,Ey),e.Matrix4.multiplyByPoint(t,l.position,l.position),e.Vector3.subtract(Ey,l.position,l.velocity),e.Vector3.normalize(l.velocity,l.velocity),Iy(this,l),By(0,l);}}const h=[],_=[],c=[];for(let e=0;e<this._particles.length;e++){const t=this._particles[e];t.show&&(h.push(t.position),_.push(t.color.r,t.color.g,t.color.b,t.color.a),c.push(t.scale));}if(this._primitive.particleSystemInstanceCollection.updateData({positions:h,colorArr:_,scaleArr:c,frameState:i.painter.frameState}),this._currentTime+=s,this._lifetime!==Number.MAX_VALUE&&this._currentTime>this._lifetime)if(this.loop){if(this._currentTime=Dy(this._currentTime,this._lifetime),this.bursts){const e=this.bursts.length;for(a=0;a<e;a++)this.bursts[a]._complete=!1;}}else this._isComplete=!0;}destroy(e){this._billboardCollection=[],this._particlePool=[],this._primitive.particleSystemInstanceCollection.destroy(),this.texture&&e.painter.textureResourceManager.removeTexture(this.texture.texUrl),this.texture=null,this.image=null,this.imageUrl=null,this.modelMatrix=null,this.startColor=null,this.endColor=null,this._emitter=null,this._bursts=null,this._combinedMatrix=null,this.speed=null,this._emissionRate=null,this._lifetime=null,this._endScale=null,this._isComplete=null,this._particleNumber=null,this._particles=[],this._startColor=null,e.removePrimitive(this._primitive);}},Highlight:xf,LimitHeight:Xf,Sightline:Wf,ViewDome:Vf,Viewshed3D:Gf,Measurement3D:ed,Excavation:If,Earth:Zu,AirLine:td,Skybox:fu,SceneModel:fa,SceneTileset:Fc,ModelInstance:e.ModelInstance,ModelInstanceCollection:e.ModelInstanceCollection,ClippingPlane:e.ClippingPlane,ClippingPlaneCollection:e.ClippingPlaneCollection,PostProcessStageLibrary:hm,PostProcessStage:Wd,PostProcessStageComposite:Zd,Math:xt,Transforms:e.Transforms,Event:e.Event,Evented:e.Evented,Map:cy,Color:e.Color,Ellipsoid:e.Ellipsoid,DistanceDisplayCondition:by,LngLat:e.LngLat,LngLatBounds:e.LngLatBounds,NearFarScalar:hh,TextureLoader:ko,Texture:e.Texture,VideoProjection:gf,CutFill:wf,WMTSCapabilities:class extends Gy{constructor(){super(),this.owsParser_=new Qy;}readFromNode(e){let t=e.getAttribute("version");t&&(t=t.trim());let i=this.owsParser_.readFromNode(e);return i?(i.version=t,i=Xy(i,mC,e,[]),i||null):null}},util:DC},LC={optionsFromCapabilities:function(e,t){const i=e.Contents.Layer.find((e=>e.Identifier===t.layer));if(!i)throw Error(`WTMS服务中未找到${t.layer}图层`);const s=e.Contents.TileMatrixSet;let r;r=i.TileMatrixSetLink.length>1?i.TileMatrixSetLink.findIndex("projection"in t?e=>{const i=s.find((t=>t.Identifier===e.TileMatrixSet)).SupportedCRS,r=BC(i),n=BC(t.projection);return r&&n?r===n:i===t.projection}:e=>e.TileMatrixSet===t.matrixSet):0,r<0&&(r=0);const n=i.TileMatrixSetLink[r].TileMatrixSet,o=i.TileMatrixSetLink[r].TileMatrixSetLimits;let a=i.Format[0];"format"in t&&(a=t.format),r=i.Style.findIndex((e=>"style"in t?e.Title===t.style:e.isDefault)),r<0&&(r=0);const l=i.Style[r].Identifier,h=new Map;"Dimension"in i&&i.Dimension.forEach((e=>{let t=e.Default;void 0===t&&(t=e.Value[0]),h.set(e.Identifier,t);}));const _=e.Contents.TileMatrixSet.find((e=>e.Identifier===n));let c;const u=_.SupportedCRS;if(u&&(c=BC(u)),"projection"in t){const e=BC(t.projection);e&&(c&&e!==c||(c=e));}let d,m;if("EPSG:4326"===c)d=6378137*Math.PI/180,m=!0;else {if("EPSG:3857"!==c)throw Error(`WTMS服务中含有不支持的坐标系统${c}`);d=1,m=!1;}let p=_.TileMatrix[0],f={MinTileCol:0,MinTileRow:0,MaxTileCol:p.MatrixWidth-1,MaxTileRow:p.MatrixHeight-1};if(o){f=o[o.length-1];const e=_.TileMatrix.find((e=>e.Identifier===f.TileMatrix||`${_.Identifier}:${e.Identifier}`===f.TileMatrix));e&&(p=e);}const g=28e-5*p.ScaleDenominator/d,y=m?[p.TopLeftCorner[1],p.TopLeftCorner[0]]:p.TopLeftCorner,C=p.TileWidth*g,T=p.TileHeight*g;let x=_.BoundingBox;x&&m&&(x=[x[1],x[0],x[3],x[2]]);let b=[y[0]+C*f.MinTileCol,y[1]-T*(1+f.MaxTileRow),y[0]+C*(1+f.MaxTileCol),y[1]-T*f.MinTileRow];var v,w;void 0===x||(v=x)[0]<=(w=b)[0]&&w[2]<=v[2]&&v[1]<=w[1]&&w[3]<=v[3]||(b=x);const S=function(e,t,i){const s=[],r=[],n=[],o=[],a=[];i=void 0!==i?i:[];const l="TileMatrix",h="Identifier",_="ScaleDenominator",c="TopLeftCorner",u=BC(e.SupportedCRS);let d,m;if("EPSG:4326"===u)d=6378137*Math.PI/180,m=!0;else {if("EPSG:3857"!==u)throw Error(`WTMS服务中含有不支持的坐标系统${u}`);d=1,m=!1;}return e[l].sort(((e,t)=>t[_]-e[_])),e[l].forEach((t=>{let u;if(u=!(i.length>0)||i.find((i=>t[h]===i[l]||!t[h].includes(":")&&`${e[h]}:${t[h]}`===i[l])),u){r.push(t[h]);const e=28e-5*t[_]/d,i=t.TileWidth,l=t.TileHeight;n.push(m?[t[c][1],t[c][0]]:t[c]),s.push(e),o.push(i===l?i:[i,l]),a.push([t.MatrixWidth,t.MatrixHeight]);}})),new IC({extent:t,origins:n,resolutions:s,matrixIds:r,tileSizes:o,sizes:a})}(_,b,o),A=[];let E=t.requestEncoding;if(E=void 0!==E?E:"","OperationsMetadata"in e&&"GetTile"in e.OperationsMetadata){const t=e.OperationsMetadata.GetTile.DCP.HTTP.Get;for(let e=0,i=t.length;e<i;++e)if(t[e].Constraint){const i=t[e].Constraint.find((e=>"GetEncoding"===e.name)).AllowedValues.Value;if(""===E&&(E=i[0]),"KVP"!==E)break;i.includes("KVP")&&A.push(t[e].href);}else t[e].href&&(E="KVP",A.push(t[e].href));}if(0===A.length&&(E="REST",i.ResourceURL.forEach((e=>{"tile"===e.resourceType&&a&&e.format===a&&A.push(e.template);})),0===A.length))throw Error("未找到对应图层的url, 请检查参数是否正确");return {urls:A,layer:t.layer,matrixSet:n,format:a,projection:c,requestEncoding:E,tileGrid:S,style:l,dimensions:h,wrapX:!1,crossOrigin:t.crossOrigin}},setRTLTextPlugin:e.setRTLTextPlugin,getRTLTextPluginStatus:e.getRTLTextPluginStatus},VC={get accessToken(){return st.ACCESS_TOKEN},set accessToken(e){st.ACCESS_TOKEN=e;},get appKey(){return st.APP_KEY},set appKey(e){st.APP_KEY=e;},get key(){return st.KEY},set key(e){st.KEY=e;},get solution(){return st.SOLU},set solution(e){st.SOLU=e;},get dataVersion(){return st.DATA_VERSION},set dataVersion(e){st.DATA_VERSION=e;},get spriteUrl(){return st.spriteUrl},set spriteUrl(e){st.spriteUrl=e;},get fontsUrl(){return st.fontsUrl},set fontsUrl(e){st.fontsUrl=e;},get serviceUrl(){return st.SERVICE_URL},set serviceUrl(e){st.SERVICE_URL=e;},get domainUrl(){return st.DOMAIN},set domainUrl(e){st.DOMAIN=e,st.SRC_URL=st.DOMAIN+st.SRC_BASE,st.SERVICE_URL=st.DOMAIN+st.SERVICE_BASE;},get dataDomainUrl(){return st.DATA_DOMAIN},set dataDomainUrl(e){st.DATA_DOMAIN=e,Array.isArray(e)?(st.API_URL=st.DATA_DOMAIN.map((e=>e+st.API_BASE)),st.DYN_URL=st.DATA_DOMAIN.map((e=>e+st.DYN_BASE)),st.MERGE_URL=st.DATA_DOMAIN.map((e=>e+st.MERGE_BASE)),st.OTHER_URL=st.DATA_DOMAIN.map((e=>e+st.OTHER_BASE))):(st.API_URL=st.DATA_DOMAIN+st.API_BASE,st.DYN_URL=st.DATA_DOMAIN+st.DYN_BASE,st.MERGE_URL=st.DATA_DOMAIN+st.MERGE_BASE,st.OTHER_URL=st.DATA_DOMAIN+st.OTHER_BASE);},get serverDomainUrl(){return st.SERVER_DOMAIN},set serverDomainUrl(e){st.SERVER_DOMAIN=e,st.SERVER_URL=Array.isArray(e)?st.SERVER_DOMAIN.map((e=>`${e}/service/`)):`${st.SERVER_DOMAIN}/service/`;},workerUrl:""};return e.extend(VC,OC,LC,{version:et}),VC}));

//

var minemap$1 = minemap;

return minemap$1;

}));
