/**
 * minemap-3d-engine
 * version: v4.8.2
 * submission time: 2024-06-19 19:36:13 +0800
 * build time: 2024-06-19 19:39:09
 * branch: master
 * SHA: f36999e8667124c569f3749f876e39797ee72ca5
 */
(function (global, factory) {
typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
typeof define === 'function' && define.amd ? define(factory) :
(global = typeof globalThis !== 'undefined' ? globalThis : global || self, global.minemap = factory());
})(this, (function () { 'use strict';

/* eslint-disable */
var shared, worker, minemap;
function define(_, chunk) {
	if (!shared) {
		shared = chunk;
	} else if (!worker) {
		worker = chunk;
	} else {
		var workerBundleString =
			"self.onerror = function() { console.error('解析webworker附属包出问题'); }; var sharedChunk = {}; (" +
			shared +
			")(sharedChunk); (" +
			worker +
			")(sharedChunk); self.onerror = null;";
		var sharedChunk = {};
		shared(sharedChunk);
		minemap = chunk(sharedChunk);
		if (typeof window !== "undefined" && window && window.URL && window.URL.createObjectURL) {
			minemap.workerUrl = window.URL.createObjectURL(new Blob([workerBundleString], { type: "text/javascript" }));
		}
	}
}


define(["exports"],(function(e){"use strict";const t=1/Math.PI*180,i=1/180*Math.PI,n=1e-12;function r(e,t,i){if(o(e)){i=i||((n=e).clone?n.clone():new Array(...n));for(let n=0;n<i.length&&n<e.length;++n)i[n]=t(e[n],n,i);return i}var n;return t(e)}function o(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function a(e){return r(e,(e=>e*i))}function s(e){return r(e,(e=>e*t))}function l(e,t,i){return r(e,(e=>Math.max(t,Math.min(i,e))))}function u(e,t){if(e===t)return !0;if(o(e)&&o(t)){if(e.length!==t.length)return !1;for(let i=0;i<e.length;++i)if(!u(e[i],t[i]))return !1;return !0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):!(!Number.isFinite(e)||!Number.isFinite(t))&&Math.abs(e-t)<=n*Math.max(1,Math.abs(e),Math.abs(t))}class c extends Array{get ELEMENTS(){return this.length}get elements(){return this}clone(){return (new this.constructor).copy(this)}from(e){return o(e)?this.copy(e):this.fromObject(e)}fromArray(e,t=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+t];return this.check()}to(e){return e===this?this:o(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toArray(e=[],t=0){for(let i=0;i<this.ELEMENTS;++i)e[t+i]=this[i];return e}toObject(e={}){for(let t=0;t<this.ELEMENTS;++t)e[t]=this[t];return e}toFloat32Array(){return new Float32Array(this.toArray())}toString(){return this._formatString()}_formatString(){let e="";for(let i=0;i<this.ELEMENTS;++i)e+=(i>0?", ":"")+(t=function(e){return Math.round(e/n)*n}(t=this[i]),`${parseFloat(t.toPrecision(4))}`);var t;return `[${e}]`}equals(e){if(!e||this.length!==e.length)return !1;for(let t=0;t<this.ELEMENTS;++t)if(!u(this[t],e[t]))return !1;return !0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}add(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]+=t[e];return this.check()}subtract(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]-=t[e];return this.check()}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyScalar(1/e)}clampScalar(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),t);return this.check()}multiplyByScalar(e){return this.multiplyScalar(e)}divideByScalar(e){return this.divideScalar(e)}check(){return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}}const h={};function d(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${e}`);return e}function p(e,t,i=""){if(!function(e,t){if(e.length!==t)return !1;for(let t=0;t<e.length;++t)if(!Number.isFinite(e[t]))return !1;return !0}(e,t))throw new Error(`math.gl: ${i} some fields set to invalid numbers'`);return e}function f(e,t){h[e]||(h[e]=!0,console.warn(`${e} has been removed in version ${t}, see upgrade guide for more information`));}var m=1e-6,_="undefined"!=typeof Float32Array?Float32Array:Array;function g(e,t,i){var n=t[0],r=t[1],o=t[2],a=t[3],s=i[0],l=i[1],u=i[2],c=i[3];return e[0]=n*s+o*l,e[1]=r*s+a*l,e[2]=n*u+o*c,e[3]=r*u+a*c,e}function y(e,t,i){var n=t[1],r=t[2],o=t[3],a=i[0],s=i[1];return e[0]=t[0]*a,e[1]=n*a,e[2]=r*s,e[3]=o*s,e}function x(e,t,i){var n=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=i[0],p=i[1],f=i[2],m=i[3],_=i[4],g=i[5],y=i[6],x=i[7],v=i[8];return e[0]=d*n+p*a+f*u,e[1]=d*r+p*s+f*c,e[2]=d*o+p*l+f*h,e[3]=m*n+_*a+g*u,e[4]=m*r+_*s+g*c,e[5]=m*o+_*l+g*h,e[6]=y*n+x*a+v*u,e[7]=y*r+x*s+v*c,e[8]=y*o+x*l+v*h,e}function v(e,t,i){var n=i[0],r=i[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function w(e,t,i){var n=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=t[9],p=t[10],f=t[11],m=t[12],_=t[13],g=t[14],y=t[15],x=i[0],v=i[1],w=i[2],T=i[3];return e[0]=x*n+v*s+w*h+T*m,e[1]=x*r+v*l+w*d+T*_,e[2]=x*o+v*u+w*p+T*g,e[3]=x*a+v*c+w*f+T*y,e[4]=(x=i[4])*n+(v=i[5])*s+(w=i[6])*h+(T=i[7])*m,e[5]=x*r+v*l+w*d+T*_,e[6]=x*o+v*u+w*p+T*g,e[7]=x*a+v*c+w*f+T*y,e[8]=(x=i[8])*n+(v=i[9])*s+(w=i[10])*h+(T=i[11])*m,e[9]=x*r+v*l+w*d+T*_,e[10]=x*o+v*u+w*p+T*g,e[11]=x*a+v*c+w*f+T*y,e[12]=(x=i[12])*n+(v=i[13])*s+(w=i[14])*h+(T=i[15])*m,e[13]=x*r+v*l+w*d+T*_,e[14]=x*o+v*u+w*p+T*g,e[15]=x*a+v*c+w*f+T*y,e}function T(){var e=new _(3);return _!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function b(e){return Math.hypot(e[0],e[1],e[2])}function P(e,t,i){var n=new _(3);return n[0]=e,n[1]=t,n[2]=i,n}function S(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function E(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function A(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function C(e,t){var i=t[0]-e[0],n=t[1]-e[1],r=t[2]-e[2];return i*i+n*n+r*r}function M(e,t){var i=t[0],n=t[1],r=t[2],o=i*i+n*n+r*r;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function I(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function L(e,t,i){var n=t[0],r=t[1],o=t[2],a=i[0],s=i[1],l=i[2];return e[0]=r*l-o*s,e[1]=o*a-n*l,e[2]=n*s-r*a,e}function N(e,t,i){var n=t[0],r=t[1],o=t[2],a=i[3]*n+i[7]*r+i[11]*o+i[15];return e[0]=(i[0]*n+i[4]*r+i[8]*o+i[12])/(a=a||1),e[1]=(i[1]*n+i[5]*r+i[9]*o+i[13])/a,e[2]=(i[2]*n+i[6]*r+i[10]*o+i[14])/a,e}function R(e,t,i){var n=t[0],r=t[1],o=t[2];return e[0]=n*i[0]+r*i[3]+o*i[6],e[1]=n*i[1]+r*i[4]+o*i[7],e[2]=n*i[2]+r*i[5]+o*i[8],e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var O=function(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e},D=b;function F(e,t,i){var n=t[0],r=t[1],o=t[2],a=t[3];return e[0]=i[0]*n+i[4]*r+i[8]*o+i[12]*a,e[1]=i[1]*n+i[5]*r+i[9]*o+i[13]*a,e[2]=i[2]*n+i[6]*r+i[10]*o+i[14]*a,e[3]=i[3]*n+i[7]*r+i[11]*o+i[15]*a,e}function z(e,t,i){var n=t[0],r=t[1],o=t[2],a=i[0],s=i[1],l=i[2],u=i[3],c=u*n+s*o-l*r,h=u*r+l*n-a*o,d=u*o+a*r-s*n,p=-a*n-s*r-l*o;return e[0]=c*u+p*-a+h*-l-d*-s,e[1]=h*u+p*-s+d*-a-c*-l,e[2]=d*u+p*-l+c*-s-h*-a,e[3]=t[3],e}function B(){var e=new _(4);return _!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function V(e,t,i){i*=.5;var n=Math.sin(i);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(i),e}function k(e,t,i){var n=t[0],r=t[1],o=t[2],a=t[3],s=i[0],l=i[1],u=i[2],c=i[3];return e[0]=n*c+a*s+r*u-o*l,e[1]=r*c+a*l+o*s-n*u,e[2]=o*c+a*u+n*l-r*s,e[3]=a*c-n*s-r*l-o*u,e}T(),function(){var e;e=new _(4),_!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0);}();var U,G,H,Y,q=(U=T(),G=P(1,0,0),H=P(0,1,0),function(e,t,i){var n=I(t,i);return n<-.999999?(L(U,G,t),D(U)<1e-6&&L(U,H,t),M(U,U),V(e,U,Math.PI),e):n>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(L(U,t,i),e[0]=U[0],e[1]=U[1],e[2]=U[2],e[3]=1+n,function(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],a=i*i+n*n+r*r+o*o;return a>0&&(a=1/Math.sqrt(a)),e[0]=i*a,e[1]=n*a,e[2]=r*a,e[3]=o*a,e}(e,e))});function X(e,t,i){var n=t[0],r=t[1];return e[0]=i[0]*n+i[2]*r,e[1]=i[1]*n+i[3]*r,e}function W(e,t,i){var n=t[0],r=t[1];return e[0]=i[0]*n+i[3]*r+i[6],e[1]=i[1]*n+i[4]*r+i[7],e}function j(e,t,i){var n=t[0],r=t[1];return e[0]=i[0]*n+i[4]*r+i[12],e[1]=i[1]*n+i[5]*r+i[13],e}function $(e){return null!=e}function Z(e,t){return null!=e?e:t}B(),B(),Y=new _(9),_!=Float32Array&&(Y[1]=0,Y[2]=0,Y[3]=0,Y[5]=0,Y[6]=0,Y[7]=0),Y[0]=1,Y[4]=1,Y[8]=1,function(){var e=new _(2);_!=Float32Array&&(e[0]=0,e[1]=0);}(),Z.EMPTY_OBJECT=Object.freeze({});var K=Q;function Q(e,t,i,n){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=i,this.p2y=n;}Q.prototype.sampleCurveX=function(e){return ((this.ax*e+this.bx)*e+this.cx)*e},Q.prototype.sampleCurveY=function(e){return ((this.ay*e+this.by)*e+this.cy)*e},Q.prototype.sampleCurveDerivativeX=function(e){return (3*this.ax*e+2*this.bx)*e+this.cx},Q.prototype.solveCurveX=function(e,t){var i,n,r,o,a;for(void 0===t&&(t=1e-6),r=e,a=0;a<8;a++){if(o=this.sampleCurveX(r)-e,Math.abs(o)<t)return r;var s=this.sampleCurveDerivativeX(r);if(Math.abs(s)<1e-6)break;r-=o/s;}if((r=e)<(i=0))return i;if(r>(n=1))return n;for(;i<n;){if(o=this.sampleCurveX(r),Math.abs(o-e)<t)return r;e>o?i=r:n=r,r=.5*(n-i)+i;}return r},Q.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var J="undefined"!=typeof self?self:{};class ee{constructor(e,t,i){this.column=e,this.row=t,this.zoom=i;}clone(){return new ee(this.column,this.row,this.zoom)}zoomTo(e){return this.clone()._zoomTo(e)}sub(e){return this.clone()._sub(e)}_zoomTo(e){const t=Math.pow(2,e-this.zoom);return this.column*=t,this.row*=t,this.zoom=e,this}_sub(e){return e=e.zoomTo(this.zoom),this.column-=e.column,this.row-=e.row,this}}var te=ie;function ie(e,t,i){this.x=e,this.y=t,this.z=i||0;}ie.prototype={clone:function(){return new ie(this.x,this.y,this.z)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),n=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=n,this},_rotateAround:function(e,t){var i=Math.cos(e),n=Math.sin(e),r=t.y+n*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-n*(this.y-t.y),this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ie.convert=function(e){return e instanceof ie?e:Array.isArray(e)?new ie(e[0],e[1],e[2]):e};var ne=6371008.8,re={centimeters:100*ne,centimetres:100*ne,degrees:ne/111325,feet:3.28084*ne,inches:39.37*ne,kilometers:ne/1e3,kilometres:ne/1e3,meters:ne,metres:ne,miles:ne/1609.344,millimeters:1e3*ne,millimetres:1e3*ne,nauticalmiles:ne/1852,radians:1,yards:1.0936*ne};function oe(e,t,i){void 0===i&&(i={});var n={type:"Feature"};return (0===i.id||i.id)&&(n.id=i.id),i.bbox&&(n.bbox=i.bbox),n.properties=t||{},n.geometry=e,n}function ae(e,t,i){if(void 0===i&&(i={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!fe(e[0])||!fe(e[1]))throw new Error("coordinates must contain numbers");return oe({type:"Point",coordinates:e},t,i)}function se(e,t,i){void 0===i&&(i={});for(var n=0,r=e;n<r.length;n++){var o=r[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<o[o.length-1].length;a++)if(o[o.length-1][a]!==o[0][a])throw new Error("First and last Position are not equivalent.")}return oe({type:"Polygon",coordinates:e},t,i)}function le(e,t,i){if(void 0===i&&(i={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return oe({type:"LineString",coordinates:e},t,i)}function ue(e,t){void 0===t&&(t={});var i={type:"FeatureCollection"};return t.id&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.features=e,i}function ce(e,t,i){return void 0===i&&(i={}),oe({type:"MultiPolygon",coordinates:e},t,i)}function he(e,t){void 0===t&&(t="kilometers");var i=re[t];if(!i)throw new Error(t+" units is invalid");return e*i}function de(e){return e%360*Math.PI/180}function pe(e,t,i){if(void 0===t&&(t="kilometers"),void 0===i&&(i="kilometers"),!(e>=0))throw new Error("length must be a positive number");return he(function(e,t){void 0===t&&(t="kilometers");var i=re[t];if(!i)throw new Error(t+" units is invalid");return e/i}(e,t),i)}function fe(e){return !isNaN(e)&&null!==e&&!Array.isArray(e)}function me(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function _e(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function ge(e,t,i){if(!e)throw new Error("No feature passed");if(!i)throw new Error(".featureOf() requires a name");if(!e||"Feature"!==e.type||!e.geometry)throw new Error("Invalid input to "+i+", Feature with geometry required");if(!e.geometry||e.geometry.type!==t)throw new Error("Invalid input to "+i+": must be a "+t+", given "+e.geometry.type)}function ye(e){return "Feature"===e.type?e.geometry:e}function xe(e,t,i){void 0===i&&(i={});var n=me(e),r=me(t),o=de(r[1]-n[1]),a=de(r[0]-n[0]),s=de(n[1]),l=de(r[1]),u=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(l);return he(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),i.units)}function ve(e,t,i){if(null!==e)for(var n,r,o,a,s,l,u,c,h=0,d=0,p=e.type,f="FeatureCollection"===p,m="Feature"===p,_=f?e.features.length:1,g=0;g<_;g++){s=(c=!!(u=f?e.features[g].geometry:m?e.geometry:e)&&"GeometryCollection"===u.type)?u.geometries.length:1;for(var y=0;y<s;y++){var x=0,v=0;if(null!==(a=c?u.geometries[y]:u)){l=a.coordinates;var w=a.type;switch(h=!i||"Polygon"!==w&&"MultiPolygon"!==w?0:1,w){case null:break;case"Point":if(!1===t(l,d,g,x,v))return !1;d++,x++;break;case"LineString":case"MultiPoint":for(n=0;n<l.length;n++){if(!1===t(l[n],d,g,x,v))return !1;d++,"MultiPoint"===w&&x++;}"LineString"===w&&x++;break;case"Polygon":case"MultiLineString":for(n=0;n<l.length;n++){for(r=0;r<l[n].length-h;r++){if(!1===t(l[n][r],d,g,x,v))return !1;d++;}"MultiLineString"===w&&x++,"Polygon"===w&&v++;}"Polygon"===w&&x++;break;case"MultiPolygon":for(n=0;n<l.length;n++){for(v=0,r=0;r<l[n].length;r++){for(o=0;o<l[n][r].length-h;o++){if(!1===t(l[n][r][o],d,g,x,v))return !1;d++;}v++;}x++;}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)if(!1===ve(a.geometries[n],t,i))return !1;break;default:throw new Error("Unknown Geometry Type")}}}}}function we(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var i=0;i<e.features.length&&!1!==t(e.features[i],i);i++);}function Te(e,t){!function(e,t){var i,n,r,o,a,s,l,u,c,h,d=0,p="FeatureCollection"===e.type,f="Feature"===e.type,m=p?e.features.length:1;for(i=0;i<m;i++){for(u=p?e.features[i].properties:f?e.properties:{},c=p?e.features[i].bbox:f?e.bbox:void 0,h=p?e.features[i].id:f?e.id:void 0,a=(l=!!(s=p?e.features[i].geometry:f?e.geometry:e)&&"GeometryCollection"===s.type)?s.geometries.length:1,r=0;r<a;r++)if(null!==(o=l?s.geometries[r]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,d,u,c,h))return !1;break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(!1===t(o.geometries[n],d,u,c,h))return !1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,d,u,c,h))return !1;d++;}}(e,(function(e,i,n,r,o){var a,s=null===e?null:e.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return !1!==t(oe(e,n,{bbox:r,id:o}),i,0)&&void 0}switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";}for(var l=0;l<e.coordinates.length;l++)if(!1===t(oe({type:a,coordinates:e.coordinates[l]},n),i,l))return !1}));}function be(e,t){Te(e,(function(e,i,n){var r=0;if(e.geometry){var o=e.geometry.type;if("Point"!==o&&"MultiPoint"!==o){var a,s=0,l=0,u=0;return !1!==ve(e,(function(o,c,h,d,p){if(void 0===a||i>s||d>l||p>u)return a=o,s=i,l=d,u=p,void(r=0);var f=le([a,o],e.properties);if(!1===t(f,i,n,p,r))return !1;r++,a=o;}))&&void 0}}}));}function Pe(e,t,i){if(void 0===i&&(i={}),i.method||(i.method="geodesic"),i.units||(i.units="kilometers"),!e)throw new Error("pt is required");if(Array.isArray(e)?e=ae(e):"Point"===e.type?e=oe(e):ge(e,"Point","point"),!t)throw new Error("line is required");Array.isArray(t)?t=le(t):"LineString"===t.type?t=oe(t):ge(t,"LineString","line");var n=1/0,r=e.geometry.coordinates;return be(t,(function(e){var t=function(e,t,i,n){var r=[i[0]-t[0],i[1]-t[1]],o=Se([e[0]-t[0],e[1]-t[1]],r);if(o<=0)return Ee(e,t,{method:n.method,units:"degrees"});var a=Se(r,r);if(a<=o)return Ee(e,i,{method:n.method,units:"degrees"});var s=o/a;return Ee(e,[t[0]+s*r[0],t[1]+s*r[1]],{method:n.method,units:"degrees"})}(r,e.geometry.coordinates[0],e.geometry.coordinates[1],i);t<n&&(n=t);})),pe(n,"degrees",i.units)}function Se(e,t){return e[0]*t[0]+e[1]*t[1]}function Ee(e,t,i){return "planar"===i.method?function(e,t,i){void 0===i&&(i={});var n=me(e),r=me(t);r[0]+=r[0]-n[0]>180?-360:n[0]-r[0]>180?360:0;var o=function(e,t,i){var n=i=void 0===i?ne:Number(i),r=e[1]*Math.PI/180,o=t[1]*Math.PI/180,a=o-r,s=Math.abs(t[0]-e[0])*Math.PI/180;s>Math.PI&&(s-=2*Math.PI);var l=Math.log(Math.tan(o/2+Math.PI/4)/Math.tan(r/2+Math.PI/4)),u=Math.abs(l)>1e-11?a/l:Math.cos(r);return Math.sqrt(a*a+u*u*s*s)*n}(n,r);return pe(o,"meters",i.units)}(e,t,i):xe(e,t,i)}function Ae(e,t){return e.length>1?function(e,t,i){return void 0===i&&(i={}),oe({type:"MultiLineString",coordinates:e},t,i)}(e,t):le(e[0],t)}var Ce=Array.isArray||function(e){return "[object Array]"===Object.prototype.toString.call(e)},Me=function(e,t){if(!Ce(e))throw new Error("Coordinates must be an array");if(e.length<2)throw new Error("Coordinates must be at least 2 numbers long");return {type:"Feature",geometry:{type:"Point",coordinates:e},properties:t||{}}},Ie=function(e,t){if(!e)throw new Error("No coordinates passed");return {type:"Feature",geometry:{type:"LineString",coordinates:e},properties:t||{}}},Le=function(e,t){if(null===e)throw new Error("No coordinates passed");for(var i=0;i<e.length;i++)for(var n=e[i],r=0;r<n[n.length-1].length;r++){if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(n[n.length-1][r]!==n[0][r])throw new Error("First and last Position are not equivalent.")}var o={type:"Feature",geometry:{type:"Polygon",coordinates:e},properties:t};return o.properties||(o.properties={}),o};const Ne=Math.pow(2,53)-1;function Re(e){return "function"==typeof e||"object"==typeof e&&null!==e&&!Array.isArray(e)}function Oe(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,i=t*e;return 4*(e<.5?i:3*(e-t)+i-.75)}function De(e,t,i,n){const r=new K(e,t,i,n);return function(e){return r.solve(e)}}const Fe=De(.25,.1,.25,1);function ze(e,t,i){return Math.min(i,Math.max(t,e))}function Be(e,t,i){const n=i-t,r=((e-t)%n+n)%n+t;return r===t?i:r}function Ve(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}De(0,.7,1,.3),De(0,0,1,1),De(.42,0,1,1),De(0,0,.58,1),De(.42,0,.58,1);let ke=1;function Ue(){return ke++}function Ge(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function He(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Ye(e,t){e.forEach((e=>{t[e]&&(t[e]=t[e].bind(t));}));}function qe(e,t){return -1!==e.indexOf(t,e.length-t.length)}function Xe(e,t,i){const n={};for(const r in e)n[r]=t.call(i||this,e[r],r,e);return n}function We(e,t,i){const n={};for(const r in e)t.call(i||this,e[r],r,e)&&(n[r]=e[r]);return n}function je(e){return Array.isArray(e)?e.map(je):"object"==typeof e&&e?Xe(e,je):e}const $e={};function Ze(e){$e[e]||("undefined"!=typeof console&&console.warn(e),$e[e]=!0);}function Ke(e,t,i){return (i.y-e.y)*(t.x-e.x)>(t.y-e.y)*(i.x-e.x)}function Qe(e){let t=0;for(let i,n,r=0,o=e.length,a=o-1;r<o;a=r++)i=e[r],n=e[a],t+=(n.x-i.x)*(i.y+n.y);return t}function Je(){return "undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function et(e){return "number"==typeof e}function tt(e){return "boolean"==typeof e}function it(e,t){let i;if("Feature"===t.type&&(t=t.geometry),"MultiPolygon"===t.type)i=t.coordinates.map((t=>it(e,Le(t)))).reduce(((e,t)=>t<e?t:e));else if(t.coordinates.length>1){const[n,...r]=t.coordinates.map((t=>it(e,Le([t]).geometry)));if(n<0){const e=r.reduce(((e,t)=>t<e?t:e));i=e<0||e<n?e:n;}else i=n;}else i=Pe(e,function(e,t){void 0===t&&(t={});var i=ye(e);switch(t.properties||"Feature"!==e.type||(t.properties=e.properties),i.type){case"Polygon":return function(e,t){return void 0===t&&(t={}),Ae(ye(e).coordinates,t.properties?t.properties:"Feature"===e.type?e.properties:{})}(i,t);case"MultiPolygon":return function(e,t){void 0===t&&(t={});var i=ye(e),n=t.properties?t.properties:"Feature"===e.type?e.properties:{},r=[];return i.coordinates.forEach((function(e){r.push(Ae(e,n));})),ue(r)}(i,t);default:throw new Error("invalid poly")}}(t),{units:"miles"});return i}const nt=6378137,rt=3.141592653589793,ot={DEFAULT_SPHERE_TRIANGLES:[],SCROLL_ZOOM_SPHERE_CONTROL:4,TILE_GRIDSAMPLES_SPLIT:{SMALL:4,MIDDLE:6,LARGE:9,LARGE_S:20,SMALL_Z_SAMPLES:16,MIDDLE_Z_SAMPLES:8,LARGE_Z_SAMPLES:2,LARGE_S_Z_SAMPLES:1,THE_MIN_SAMPLES:1},TRANSFORM:{PROJECTION_CHANGE_SMALL_ZOOM:5,PROJECTION_CHANGE_MIDDLE_ZOOM:10,PROJECTION_CHANGE_LARGE_ZOOM:15,MAX_LAT:90,MIN_LAT:-90,SPHERE_MAX_PITCH:90,PLAIN_MAX_PITCH:90,SPHERE_DRAG_PAN_MAX_PITCH:45,DEG_TO_RAD:rt/180,RAD_TO_DEG:180/rt,R:nt,R1:6356752.314245179,REAL_R:6378137,R2:40680631590769,R_SCALE:1,R_ZOOM:1,CIR:2*rt*nt,COVERING_TILE_ZOOM:6,EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,UNIT_Z:[0,0,1],UNIT_Z_REVERSE:[0,0,-1],VIEW_MAX_BOUNDING:{west:-180,south:-85.05113,east:180,north:85.05113},PI:rt,TWO_PI:2*rt,PI_OVER_TWO:rt/2,FP_ZOOM:17,TERRAIN_FIND_ZOOM_MIN:5,TERRAIN_SIMPLIFY_ZOOM_MAX:15,ERR_TERRAIN_ALT:-nt,OFFSCREEN_WIDTH:2048,OFFSCREEN_HEIGHT:2048,SHADOW_VIEWPORT_SIZE:[8192,8192],RAY_PICK_MIN_ZOOM:4,BOUND_KEYS:["topLeft","topMidL","topMiddle","topMidR","topRight","bottomRight","bottomMiddle","bottomLeft"],FOV_IN_RADIANS:.6435011087932844,FOV_IN_DEGREES:36.86989764584402},CesiumMath:{EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,EPSILON21:1e-21,GRAVITATIONALPARAMETER:3986004418e5,SOLAR_RADIUS:6955e5,LUNAR_RADIUS:1737400,SIXTY_FOUR_KILOBYTES:65536,FOUR_GIGABYTES:4294967296,PI:Math.PI,ONE_OVER_PI:1/Math.PI,PI_OVER_TWO:Math.PI/2,PI_OVER_THREE:Math.PI/3,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,THREE_PI_OVER_TWO:3*Math.PI/2,TWO_PI:2*Math.PI,ONE_OVER_TWO_PI:1/(2*Math.PI),RADIANS_PER_DEGREE:Math.PI/180,DEGREES_PER_RADIAN:180/Math.PI,RADIANS_PER_ARCSECOND:Math.PI/180/3600,log2:Z(Math.log2,(e=>Math.log(e)*Math.LOG2E)),clamp:(e,t,i)=>e<t?t:e>i?i:e,equalsEpsilon(e,t,i,n){i=i||0,n=n||i;const r=Math.abs(e-t);return r<=n||r<=i*Math.max(Math.abs(e),Math.abs(t))},toRadians:e=>e*ot.CesiumMath.RADIANS_PER_DEGREE,toDegrees:e=>e*ot.CesiumMath.DEGREES_PER_RADIAN,negativePiToPi:e=>e>=-ot.CesiumMath.PI&&e<=ot.CesiumMath.PI?e:ot.CesiumMath.zeroToTwoPi(e+ot.CesiumMath.PI)-ot.CesiumMath.PI,zeroToTwoPi(e){if(e>=0&&e<=ot.CesiumMath.TWO_PI)return e;const t=ot.CesiumMath.mod(e,ot.CesiumMath.TWO_PI);return Math.abs(t)<ot.CesiumMath.EPSILON14&&Math.abs(e)>ot.CesiumMath.EPSILON14?ot.CesiumMath.TWO_PI:t},mod:(e,t)=>Math.sign(e)===Math.sign(t)&&Math.abs(e)<Math.abs(t)?e:(e%t+t)%t,acosClamped:e=>Math.acos(ze(e,-1,1)),asinClamped:e=>Math.asin(ze(e,-1,1)),chordLength(e,t){if(void 0===e)throw new Error("angle is required.");if(void 0===t)throw new Error("radius is required.");return 2*t*Math.sin(.5*e)},fastApproximateAtan2(e,t){let i,n=Math.abs(e);i=Math.abs(t);const r=Math.max(n,i);i=Math.min(n,i);const o=i/r;if(isNaN(o))throw new Error("either x or y must be nonzero");return n=ot.CesiumMath.fastApproximateAtan(o),n=Math.abs(t)>Math.abs(e)?ot.CesiumMath.PI_OVER_TWO-n:n,n=e<0?ot.CesiumMath.PI-n:n,n=t<0?-n:n,n},fastApproximateAtan:e=>e*(-.1784*Math.abs(e)-.0663*e*e+1.0301)},TEXTUREWRAP:{REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648},TEXTUREMAGNIFICATIONFILTER:{NEAREST:9728,LINEAR:9729},TEXTUREMINNIFICATIONFILTER:{NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987},SOURCE:{MAX_BOUNDS:[[-180,90],[180,90],[180,-90],[-180,-90]],ERROR_IMG_INDEX:-999,CLOCK_SKEW_RETRY_TIMEOUT:3e4,TRANSPARENT_PNG_URL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",MAX_PARALLEL_IMAGE_REQUESTS:16,GLOBAL_SOURCE_ID:"sphere-image-globe",SKYBOX_SOURCE_ID:"sphere-image-skybox",PANORAMA_SOURCE_ID:"panorama-special-source",ATMOSPHERE_SOURCE_ID:"sphere-atmosphere",COSMOS_SOURCE_ID:"sphere-cosmos",MAX_GLTF_TILE_COUNT:300,MAX_GLTF_TILE_TO_FIND_PARENT:64,MAX_IMAGE_CONCURRENCY:32,TEXTURE_CUBE_KEYS:["px","nx","py","ny","pz","nz"],ION_ACCESS_TOKEN:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIzMGY4ODczYy1mNTk4LTRiMDUtYmIxYy0xZWYwOWZmMGY4NjQiLCJpZCI6NDQsInNjb3BlcyI6WyJhc3IiLCJnYyJdLCJhc3NldHMiOlsxLDIsMyw0LDYxOTMsNjI3Myw3MTYyLDczNTMsNzE0Ml0sImlhdCI6MTU0MTYxODM0NX0.lWnGs9ySXO4QK3HagcMsDpZ8L01DpmUDQm38-2QAQuE"},HIGHLIGHT_TYPE:{PRIMITIVE:"PRIMITIVE",NODE:"NODE",SCENE:"SCENE"},MODEL_TYPE:{OSGB:"osgb",E3DCM:"e3dcm",TDMODEL:"3dmodel"},LAYER:{PANORAMA_LAYER_ID:"panorama-special-layer",RADIATION_REGIONS:5},TILE:{EXTENT:8192,DEPTH_MAX_RANGE:1,OFFSCREEN_SIZE:1024},FRAMEBUFFER:{DEPTH_IMAGE_SCALE:1},EFFECTS:{FOG_START_DISTANCE:4e3,FOG_CALC_LENGTH:2e4,SHADOW_OFFSET:25e-8},CAMERA:{SUNLIGHT_CAMERA_ID:"SUNLIGHT_CAMERA_ID",SKYBOX_CAMERA_ID:"SKYBOX_CAMERA_ID",ATMOSPHERE_BLEND_CAMERA_ID:"ATMOSPHERE_BLEND_CAMERA_ID",DRAW_MODE:{NORMAL:"NORMAL",OFFSCREEN:"OFFSCREEN",OFFSCREEN_VIEWSHED:"OFFSCREEN_VIEWSHED",ONSCREEN_SHADOW:"SHADOW",ONSCREEN_VIEWSHED:"VIEWSHED",ONSCREEN_ALL:"ONSCREEN_ALL"},SUNLIGHT_FIXED_MODE:{FIXED:"FIXED",DYNAMIC:"DYNAMIC"}},GL_CONST:{SHADOW_TEXTURE_UNIT1:{VALUE:33984,INDEX:0},SHADOW_TEXTURE_UNIT2:{VALUE:33985,INDEX:1},SHADOW_BASE_TEXTURE_UNIT:{VALUE:33986,INDEX:2},FXAA_TEXTURE_UNIT1:{VALUE:33987,INDEX:3},BLUR_TEXTURE_UNIT1:{VALUE:33988,INDEX:4},BLUR_TEXTURE_UNIT2:{VALUE:33989,INDEX:5},MODEL_TEXTURE_UNIT1:{VALUE:33990,INDEX:6},MODEL_TEXTURE_UNIT2:{VALUE:33991,INDEX:7},MODEL_TEXTURE_UNIT3:{VALUE:33992,INDEX:8},MODEL_TEXTURE_UNIT4:{VALUE:33993,INDEX:9},MODEL_TEXTURE_UNIT5:{VALUE:33994,INDEX:10},VIDEO_TEXTURE_UNIT1:{VALUE:33995,INDEX:11},PATTERN_TEXTURE_UNIT1:{VALUE:33996,INDEX:12},BRDF_TEXTURE_UNIT:{VALUE:33997,INDEX:13},TEXTURE14:{VALUE:33998,INDEX:14},TEXTURE15:{VALUE:33999,INDEX:15},TEXTURE16:{VALUE:34e3,INDEX:16},TEXTURE17:{VALUE:34001,INDEX:17},TEXTURE18:{VALUE:34002,INDEX:18}},PERFORMANCE:{MODE:{FLIGHT:"FLIGHT",MANUAL:"MANUAL"},SMOOTH_CONSTS:{FRAME_RATE:30,FRAME_DURATION:33.33}},COMPRESSED_TEXTURE_TYPE:{COMPRESSED_RGB_S3TC:{COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779},COMPRESSED_RGB_PVRTC:{COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843},COMPRESSED_RGB_ETC1_WEBGL:36196},COLORTYPEANDLENGTH:{ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,FRAGMENT_SHADER:35632},PixelDatatype:{UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126,HALF_FLOAT_OES:36193,UNSIGNED_INT_24_8:34042,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635}},at={SYMTRACKING_DISPLAY_MODE:{DEFAULT:"default",SEQUENCE:"time-sequence",TIMESTAMP:"timestamp"}};class st{constructor(e=0,t=0,i=0){this.heading=e,this.pitch=t,this.roll=i;}static fromQuaternion(e,t=new st){const i=2*(e.w*e.y-e.z*e.x),n=1-2*(e.x*e.x+e.y*e.y),r=2*(e.w*e.x+e.y*e.z);return t.heading=-Math.atan2(2*(e.w*e.z+e.x*e.y),1-2*(e.y*e.y+e.z*e.z)),t.roll=Math.atan2(r,n),t.pitch=-ot.CesiumMath.asinClamped(i),t}static fromDegrees(e,t,i,n=new st){return n.heading=e*ot.CesiumMath.RADIANS_PER_DEGREE,n.pitch=t*ot.CesiumMath.RADIANS_PER_DEGREE,n.roll=i*ot.CesiumMath.RADIANS_PER_DEGREE,n}static clone(e,t=new st){return t.heading=e.heading,t.pitch=e.pitch,t.roll=e.roll,t}static equals(e,t){return e===t||$(e)&&$(t)&&e.heading===t.heading&&e.pitch===t.pitch&&e.roll===t.roll}static equalsEpsilon(e,t,i=0,n=i){return e===t||$(e)&&$(t)&&ot.CesiumMath.equalsEpsilon(e.heading,t.heading,i,n)&&ot.CesiumMath.equalsEpsilon(e.pitch,t.pitch,i,n)&&ot.CesiumMath.equalsEpsilon(e.roll,t.roll,i,n)}clone(e=new st){return st.clone(this,e)}equals(e){return st.equals(this,e)}equalsEpsilon(e,t=0,i=t){return st.equalsEpsilon(this,e,t,i)}toString(){return `(${this.heading}, ${this.pitch}, ${this.roll})`}}class lt extends c{copy(e){for(let t=0;t<this.ELEMENTS;t++)this[t]=e[t];return this}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let i=0;i<this.ELEMENTS;++i){const n=this[i]-e[i];t+=n*n;}return d(t)}dot(e){let t=0;for(let i=0;i<this.ELEMENTS;++i)t+=this[i]*e[i];return d(t)}normalize(){const e=this.magnitude();if(0!==e)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]*=t[e];return this.check()}divide(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t[e];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return d(this[e])}setComponent(e,t){return this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}scale(e){if(o(e))for(let t=0;t<this.ELEMENTS;++t)this[t]*=e[t];else this.multiplyScalar(e);return this}lerp(e,t,i){void 0===i&&"number"==typeof t&&(i=t,t=e,e=this);for(let n=0;n<this.ELEMENTS;++n){const r=e[n];this[n]=r+i*(t[n]-r);}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),t[i]);return this.check()}}function ut(e,t,i){const n=t[0],r=t[1],o=i[3]*n+i[7]*r||1;return e[0]=(i[0]*n+i[4]*r)/o,e[1]=(i[1]*n+i[5]*r)/o,e}function ct(e,t,i){const n=t[0],r=t[1],o=t[2],a=i[3]*n+i[7]*r+i[11]*o||1;return e[0]=(i[0]*n+i[4]*r+i[8]*o)/a,e[1]=(i[1]*n+i[5]*r+i[9]*o)/a,e[2]=(i[2]*n+i[6]*r+i[10]*o)/a,e}function ht(e,t,i){const n=t[0],r=t[1],o=t[2];return e[0]=i[0]*n+i[3]*r+i[6]*o,e[1]=i[1]*n+i[4]*r+i[7]*o,e[2]=i[2]*n+i[5]*r+i[8]*o,e[3]=t[3],e}const dt=[0,0,0],pt={},ft=e=>e;function mt(e,t,i){return t=t||new _t,i=i||ft,o(e)?(t[0]=i(e[0]),t[1]=i(e[1]),t[2]=e[2]):"longitude"in e?(t[0]=i(e.longitude),t[1]=i(e.latitude),t[2]=e.height):(t[0]=i(e.x),t[1]=i(e.y),t[2]=e.z),t}class _t extends lt{static get ZERO(){return pt.ZERO=pt.ZERO||Object.freeze(new _t(0,0,0))}static get ONE(){return pt.ONE=pt.ONE||Object.freeze(new _t(1,1,1))}static get UNIT_X(){return pt.UNIT_X=pt.UNIT_X||Object.freeze(new _t(1,0,0))}static get UNIT_Y(){return pt.UNIT_Y=pt.UNIT_Y||Object.freeze(new _t(0,1,0))}static get UNIT_Z(){return pt.UNIT_Z=pt.UNIT_Z||Object.freeze(new _t(0,0,1))}constructor(e,t,i){o(e)?super(e[0],e[1],e[2]):super(e||0,t||0,i||0);}get x(){return this[0]}set x(e){this[0]=d(e);}get y(){return this[1]}set y(e){this[1]=d(e);}get z(){return this[2]}set z(e){this[2]=d(e);}get ELEMENTS(){return 3}set(e,t,i){return this[0]=e,this[1]=t,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e={}){return e.x=this[0],e.y=this[1],e.z=this[2],e}angle(e,t=this){return r=(i=t)[0],o=i[1],a=i[2],s=(n=e)[0],l=n[1],u=n[2],h=(c=Math.sqrt(r*r+o*o+a*a)*Math.sqrt(s*s+l*l+u*u))&&I(i,n)/c,Math.acos(Math.min(Math.max(h,-1),1));var i,n,r,o,a,s,l,u,c,h;}cross(e,t=this){return L(t,this,e),t.check()}rotateX({radians:e,origin:t=dt,result:i=this}){return function(e,t,i,n){var r=[],o=[];r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],o[0]=r[0],o[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n),o[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n),e[0]=o[0]+i[0],e[1]=o[1]+i[1],e[2]=o[2]+i[2];}(i,this,t,e),i.check()}rotateY({radians:e,origin:t=dt,result:i=this}){return function(e,t,i,n){var r=[],o=[];r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],o[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n),o[1]=r[1],o[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n),e[0]=o[0]+i[0],e[1]=o[1]+i[1],e[2]=o[2]+i[2];}(i,this,t,e),i.check()}rotateZ({radians:e,origin:t=dt,result:i=this}){return function(e,t,i,n){var r=[],o=[];r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],o[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),o[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),o[2]=r[2],e[0]=o[0]+i[0],e[1]=o[1]+i[1],e[2]=o[2]+i[2];}(i,this,t,e),i.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e,t=this){return N(t,this,e),t.check()}transformAsVector(e,t=this){return ct(t,this,e),t.check()}transformByMatrix3(e,t=this){return R(t,this,e),t.check()}transformByMatrix2(e,t=this){return function(e,t,i){const n=t[0],r=t[1];e[0]=i[0]*n+i[2]*r,e[1]=i[1]*n+i[3]*r,e[2]=t[2];}(t,this,e),t.check()}transformByQuaternion(e,t=this){return function(e,t,i){var n=i[0],r=i[1],o=i[2],a=t[0],s=t[1],l=t[2],u=r*l-o*s,c=o*a-n*l,h=n*s-r*a,d=r*h-o*c,p=o*u-n*h,f=n*c-r*u,m=2*i[3];c*=m,h*=m,p*=2,f*=2,e[0]=a+(u*=m)+(d*=2),e[1]=s+c+p,e[2]=l+h+f;}(t,this,e),t.check()}applyMatrix3(e){const t=this[0],i=this[1],n=this[2],r=e.elements;return this[0]=r[0]*t+r[3]*i+r[6]*n,this[1]=r[1]*t+r[4]*i+r[7]*n,this[2]=r[2]*t+r[5]*i+r[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this[0],i=this[1],n=this[2],r=e.elements,o=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this[0]=(r[0]*t+r[4]*i+r[8]*n+r[12])*o,this[1]=(r[1]*t+r[5]*i+r[9]*n+r[13])*o,this[2]=(r[2]*t+r[6]*i+r[10]*n+r[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*n-a*i,u=s*i+a*t-r*n,c=s*n+r*i-o*t,h=-r*t-o*i-a*n;return this[0]=l*s+h*-r+u*-a-c*-o,this[1]=u*s+h*-o+c*-r-l*-a,this[2]=c*s+h*-a+l*-o-u*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this[0],i=this[1],n=this[2],r=e.elements;return this[0]=r[0]*t+r[4]*i+r[8]*n,this[1]=r[1]*t+r[5]*i+r[9]*n,this[2]=r[2]*t+r[6]*i+r[10]*n,this.normalize()}clampLength(e,t){const i=this.len();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this[0]=Math.floor(this[0]),this[1]=Math.floor(this[1]),this[2]=Math.floor(this[2]),this}ceil(){return this[0]=Math.ceil(this[0]),this[1]=Math.ceil(this[1]),this[2]=Math.ceil(this[2]),this}round(){return this[0]=Math.round(this[0]),this[1]=Math.round(this[1]),this[2]=Math.round(this[2]),this}roundToZero(){return this[0]=this[0]<0?Math.ceil(this[0]):Math.floor(this[0]),this[1]=this[1]<0?Math.ceil(this[1]):Math.floor(this[1]),this[2]=this[2]<0?Math.ceil(this[2]):Math.floor(this[2]),this}manhattanLength(){return Math.abs(this[0])+Math.abs(this[1])+Math.abs(this[2])}setLength(e){return this.normalize().multiplyScalar(e)}lerpVectors(e,t,i){return this[0]=e[0]+(t[0]-e[0])*i,this[1]=e[1]+(t[1]-e[1])*i,this[2]=e[2]+(t[2]-e[2])*i,this}crossVectors(e,t){const i=e[0],n=e[1],r=e[2],o=t[0],a=t[1],s=t[2];return this[0]=n*s-r*a,this[1]=r*o-i*s,this[2]=i*a-n*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){const t=(new _t).copy(this).projectOnVector(e);return this.sub(t)}reflect(e){return this.sub((new _t).copy(e).multiplyScalar(2*this.dot(e)))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this[0]-e[0],i=this[1]-e[1],n=this[2]-e[2];return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this[0]-e[0])+Math.abs(this[1]-e[1])+Math.abs(this[2]-e[2])}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const n=Math.sin(t)*e;return this[0]=n*Math.sin(i),this[1]=Math.cos(t)*e,this[2]=n*Math.cos(i),this}setFromMatrixPosition(e){const t=e.elements;return this[0]=t[12],this[1]=t[13],this[2]=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).len(),i=this.setFromMatrixColumn(e,1).len(),n=this.setFromMatrixColumn(e,2).len();return this[0]=t,this[1]=i,this[2]=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}static toCartographicFromRadians(e){return mt(e)}static toCartographicFromDegrees(e){return mt(e,new _t,a)}random(){return this[0]=Math.random(),this[1]=Math.random(),this[2]=Math.random(),this}static multiplyByScalar(e,t,i=new _t){return i.x=e.x*t,i.y=e.y*t,i.z=e.z*t,i}static fromElements(e,t,i,n=new _t){return n.x=e,n.y=t,n.z=i,n}static fromDegrees(e,t,i=0,n,r=new _t){return e=ot.CesiumMath.toRadians(e),t=ot.CesiumMath.toRadians(t),_t.fromRadians(e,t,i,n,r)}static fromRadians(e,t,i=0,n,r=new _t){let o;i=Z(i,0),o=$(n)?n.radiiSquared:gt;const a=Math.cos(t);yt.x=a*Math.cos(e),yt.y=a*Math.sin(e),yt.z=Math.sin(t),yt=_t.normalize(yt,yt),_t.multiplyComponents(o,yt,xt);const s=Math.sqrt(_t.dot(yt,xt));return xt=_t.divideByScalar(xt,s,xt),yt=_t.multiplyByScalar(yt,i,yt),_t.add(xt,yt,r)}static fromDegreesArray(e,t,i=new Array(e.length/2)){const n=e.length;for(let r=0;r<n;r+=2){const n=r/2;i[n]=_t.fromDegrees(e[r],e[r+1],0,t,i[n]);}return i}static fromRadiansArray(e,t,i=new Array(e.length/2)){const n=e.length;i.length=n/2;for(let r=0;r<n;r+=2){const n=r/2;i[n]=_t.fromRadians(e[r],e[r+1],0,t,i[n]);}return i}static fromDegreesArrayHeights(e,t,i=new Array(e.length/3)){const n=e.length;i.length=n/3;for(let r=0;r<n;r+=3){const n=r/3;i[n]=_t.fromDegrees(e[r],e[r+1],e[r+2],t,i[n]);}return i}static fromRadiansArrayHeights(e,t,i=new Array(e.length/3)){const n=e.length;i.length=n/3;for(let r=0;r<n;r+=3){const n=r/3;i[n]=_t.fromRadians(e[r],e[r+1],e[r+2],t,i[n]);}return i}clone(e){return _t.clone(this,e)}static clone(e,t=new _t(e.x,e.y,e.z)){return t.x=e.x,t.y=e.y,t.z=e.z,t}equals(e){return _t.equals(this,e)}static equals(e,t){return e===t||$(e)&&$(t)&&e.x===t.x&&e.y===t.y&&e.z===t.z}equalsEpsilon(e,t=0,i=t){return _t.equalsEpsilon(this,e,t,i)}static equalsEpsilon(e,t,i=0,n=i){return e===t||$(e)&&$(t)&&ot.CesiumMath.equalsEpsilon(e.x,t.x,i,n)&&ot.CesiumMath.equalsEpsilon(e.y,t.y,i,n)&&ot.CesiumMath.equalsEpsilon(e.z,t.z,i,n)}toString(){return `(${this.x}, ${this.y}, ${this.z})`}static pack(e,t,i=0){return t[i++]=e.x,t[i++]=e.y,t[i]=e.z,t}static unpack(e,t=0,i=new _t){return i.x=e[t++],i.y=e[t++],i.z=e[t],i}static packArray(e,t=new Array(3*e.length)){const i=e.length,n=3*i;if(!Array.isArray(t)&&t.length!==n)throw new Error("If result is a typed array, it must have exactly array.length * 3 elements");t.length!==n&&(t.length=n);for(let n=0;n<i;++n)_t.pack(e[n],t,3*n);return t}static unpackArray(e,t=new Array(e.length/3)){const i=e.length;t.length=i/3;for(let n=0;n<i;n+=3){const i=n/3;t[i]=_t.unpack(e,n,t[i]);}return t}static maximumComponent(e){return Math.max(e.x,e.y,e.z)}static minimumComponent(e){return Math.min(e.x,e.y,e.z)}static minimumByComponent(e,t,i=new _t){return i.x=Math.min(e.x,t.x),i.y=Math.min(e.y,t.y),i.z=Math.min(e.z,t.z),i}static maximumByComponent(e,t,i=new _t){return i.x=Math.max(e.x,t.x),i.y=Math.max(e.y,t.y),i.z=Math.max(e.z,t.z),i}static magnitudeSquared(e){return e.x*e.x+e.y*e.y+e.z*e.z}static magnitude(e){return Math.sqrt(_t.magnitudeSquared(e))}static distance(e,t){const i=new _t;return _t.subtract(e,t,i),_t.magnitude(i)}static distanceSquared(e,t){const i=new _t;return _t.subtract(e,t,i),_t.magnitudeSquared(i)}static normalize(e,t=new _t){const i=_t.magnitude(e);return t.x=e.x/i,t.y=e.y/i,t.z=e.z/i,t}static dot(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}static multiplyComponents(e,t,i=new _t){return i.x=e.x*t.x,i.y=e.y*t.y,i.z=e.z*t.z,i}static divideComponents(e,t,i=new _t){return i.x=e.x/t.x,i.y=e.y/t.y,i.z=e.z/t.z,i}static add(e,t,i=new _t){return i.x=e.x+t.x,i.y=e.y+t.y,i.z=e.z+t.z,i}static subtract(e,t,i=new _t){return i.x=e.x-t.x,i.y=e.y-t.y,i.z=e.z-t.z,i}static divideByScalar(e,t,i=new _t){return i.x=e.x/t,i.y=e.y/t,i.z=e.z/t,i}static negate(e,t=new _t){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t}static abs(e,t=new _t){return t.x=Math.abs(e.x),t.y=Math.abs(e.y),t.z=Math.abs(e.z),t}static lerp(e,t,i,n=new _t){const r=new _t;return _t.multiplyByScalar(t,i,r),n=_t.multiplyByScalar(e,1-i,n),_t.add(r,n,n)}static angleBetween(e,t){const i=new _t,n=new _t;_t.normalize(e,i),_t.normalize(t,n);const r=_t.dot(i,n),o=_t.magnitude(_t.cross(i,n,i));return Math.atan2(o,r)}static mostOrthogonalAxis(e,t=new _t){const i=new _t,n=_t.normalize(e,i);return _t.abs(n,n),_t.clone(n.x<=n.y?n.x<=n.z?_t.UNIT_X:_t.UNIT_Z:n.y<=n.z?_t.UNIT_Y:_t.UNIT_Z,t)}static projectVector(e,t,i=new _t){const n=_t.dot(e,t)/_t.dot(t,t);return _t.multiplyByScalar(t,n,i)}static equalsArray(e,t,i=0){return e.x===t[i]&&e.y===t[i+1]&&e.z===t[i+2]}static cross(e,t,i=new _t){const n=e.x,r=e.y,o=e.z,a=t.x,s=t.y,l=t.z,u=o*a-n*l,c=n*s-r*a;return i.x=r*l-o*s,i.y=u,i.z=c,i}static midpoint(e,t,i=new _t){return i.x=.5*(e.x+t.x),i.y=.5*(e.y+t.y),i.z=.5*(e.z+t.z),i}static fromCartesian4(...e){return this.clone(...e)}static fromArray(...e){return this.unpack(...e)}}_t.packedLength=3;const gt=new _t(40680631590769,40680631590769,40408299984661.445);let yt=new _t,xt=new _t;const vt={},wt=new Float32Array(1),Tt=new Uint8Array(wt.buffer),bt=new Uint32Array([287454020]),Pt=68===new Uint8Array(bt.buffer)[0];class St extends lt{static get ZERO(){return vt.ZERO=vt.ZERO||Object.freeze(new St(0,0,0,0))}static get ONE(){return vt.ONE=vt.ONE||Object.freeze(new St(1,1,1,1))}static get UNIT_X(){return vt.UNIT_X=vt.UNIT_X||Object.freeze(new St(1,0,0,0))}static get UNIT_Y(){return vt.UNIT_Y=vt.UNIT_Y||Object.freeze(new St(0,1,0,0))}static get UNIT_Z(){return vt.UNIT_Z=vt.UNIT_Z||Object.freeze(new St(0,0,1,0))}static get UNIT_W(){return vt.UNIT_W=vt.UNIT_W||Object.freeze(new St(0,0,0,1))}constructor(e,t,i,n){o(e)?super(e[0],e[1],e[2],e[3]):super(e||0,t||0,i||0,n||0);}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=d(e);}get y(){return this[1]}set y(e){this[1]=d(e);}get z(){return this[2]}set z(e){this[2]=d(e);}get w(){return this[3]}set w(e){this[3]=d(e);}set(e,t,i,n){return this[0]=e,this[1]=t,this[2]=i,this[3]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}transform(e,t=this){return F(t,this,e),t.check()}transformByMatrix3(e,t=this){return ht(t,this,e),t.check()}transformByMatrix2(e,t=this){return function(e,t,i){const n=t[0],r=t[1];e[0]=i[0]*n+i[2]*r,e[1]=i[1]*n+i[3]*r,e[2]=t[2],e[3]=t[3];}(t,this,e),t.check()}transformByQuaternion(e,t){return z(t,this,e),t.check()}applyMatrix4(e){return e.transform(this,this),this}static fromElements(e,t,i,n,r=new St){return r.x=e,r.y=t,r.z=i,r.w=n,r}static clone(e,t=new St){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}static pack(e,t,i=0){return t[i++]=e.x,t[i++]=e.y,t[i++]=e.z,t[i]=e.w,t}static unpack(e,t=0,i=new St){return i.x=e[t++],i.y=e[t++],i.z=e[t++],i.w=e[t],i}static packArray(e,t=new Array(4*e.length)){const i=e.length,n=4*i;if(!Array.isArray(t)&&t.length!==n)throw new Error("If result is a typed array, it must have exactly array.length * 4 elements");t.length!==n&&(t.length=n);for(let n=0;n<i;++n)St.pack(e[n],t,4*n);return t}static unpackArray(e,t=new Array(e.length/4)){const i=e.length;t.length=i/4;for(let n=0;n<i;n+=4){const i=n/4;t[i]=St.unpack(e,n,t[i]);}return t}static maximumComponent(e){return Math.max(e.x,e.y,e.z,e.w)}static minimumComponent(e){return Math.min(e.x,e.y,e.z,e.w)}static minimumByComponent(e,t,i=new St){return i.x=Math.min(e.x,t.x),i.y=Math.min(e.y,t.y),i.z=Math.min(e.z,t.z),i.w=Math.min(e.w,t.w),i}static maximumByComponent(e,t,i=new St){return i.x=Math.max(e.x,t.x),i.y=Math.max(e.y,t.y),i.z=Math.max(e.z,t.z),i.w=Math.max(e.w,t.w),i}static magnitudeSquared(e){return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w}static magnitude(e){return Math.sqrt(St.magnitudeSquared(e))}static distance(e,t){const i=new St;return St.subtract(e,t,i),St.magnitude(i)}static distanceSquared(e,t){const i=new St;return St.subtract(e,t,i),St.magnitudeSquared(i)}static normalize(e,t=new St){const i=St.magnitude(e);return t.x=e.x/i,t.y=e.y/i,t.z=e.z/i,t.w=e.w/i,t}static dot(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w}static multiplyComponents(e,t,i=new St){return i.x=e.x*t.x,i.y=e.y*t.y,i.z=e.z*t.z,i.w=e.w*t.w,i}static divideComponents(e,t,i=new St){return i.x=e.x/t.x,i.y=e.y/t.y,i.z=e.z/t.z,i.w=e.w/t.w,i}static add(e,t,i=new St){return i.x=e.x+t.x,i.y=e.y+t.y,i.z=e.z+t.z,i.w=e.w+t.w,i}static subtract(e,t,i=new St){return i.x=e.x-t.x,i.y=e.y-t.y,i.z=e.z-t.z,i.w=e.w-t.w,i}static multiplyByScalar(e,t,i){return i.x=e.x*t,i.y=e.y*t,i.z=e.z*t,i.w=e.w*t,i}static divideByScalar(e,t,i){return i.x=e.x/t,i.y=e.y/t,i.z=e.z/t,i.w=e.w/t,i}static negate(e,t=new St){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t}static abs(e,t=new St){return t.x=Math.abs(e.x),t.y=Math.abs(e.y),t.z=Math.abs(e.z),t.w=Math.abs(e.w),t}static lerp(e,t,i,n=new St){const r=new St;return St.multiplyByScalar(t,i,r),n=St.multiplyByScalar(e,1-i,n),St.add(r,n,n)}static mostOrthogonalAxis(e,t=new St){const i=new St,n=St.normalize(e,i);return St.abs(n,n),St.clone(n.x<=n.y?n.x<=n.z?n.x<=n.w?St.UNIT_X:St.UNIT_W:n.z<=n.w?St.UNIT_Z:St.UNIT_W:n.y<=n.z?n.y<=n.w?St.UNIT_Y:St.UNIT_W:n.z<=n.w?St.UNIT_Z:St.UNIT_W,t)}static equals(e,t){return e===t||$(e)&&$(t)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}static equalsArray(e,t,i=0){return e.x===t[i]&&e.y===t[i+1]&&e.z===t[i+2]&&e.w===t[i+3]}static equalsEpsilon(e,t,i=0,n=i){return e===t||$(e)&&$(t)&&ot.CesiumMath.equalsEpsilon(e.x,t.x,i,n)&&ot.CesiumMath.equalsEpsilon(e.y,t.y,i,n)&&ot.CesiumMath.equalsEpsilon(e.z,t.z,i,n)&&ot.CesiumMath.equalsEpsilon(e.w,t.w,i,n)}clone(e=new St){return St.clone(this,e)}equals(e){return St.equals(this,e)}equalsEpsilon(e,t=0,i=t){return St.equalsEpsilon(this,e,t,i)}toString(){return `(${this.x}, ${this.y}, ${this.z}, ${this.w})`}static packFloat(e,t=new St){return wt[0]=e,Pt?(t.x=Tt[0],t.y=Tt[1],t.z=Tt[2],t.w=Tt[3]):(t.x=Tt[3],t.y=Tt[2],t.z=Tt[1],t.w=Tt[0]),t}static unpackFloat(e){return Pt?(Tt[0]=e.x,Tt[1]=e.y,Tt[2]=e.z,Tt[3]=e.w):(Tt[0]=e.w,Tt[1]=e.z,Tt[2]=e.y,Tt[3]=e.x),wt[0]}static fromColor(e,t,i=new St){return void 0!==e.r&&void 0!==e.g&&void 0!==e.b&&void 0!==e.a&&(t?(i.x=e.r/255,i.y=e.g/255,i.z=e.b/255,i.w=e.a):(i.x=e.r,i.y=e.g,i.z=e.b,i.w=e.a)),i}static convert(e){return Array.isArray(e)?new St(e):e}}class Et extends c{constructor(e,t,i,n){o(e)?super(e[0],e[1],e[2],e[3]):super(e||0,t||0,i||0,n||1);}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=d(e);}get y(){return this[1]}set y(e){this[1]=d(e);}get z(){return this[2]}set z(e){this[2]=d(e);}get w(){return this[3]}set w(e){this[3]=d(e);}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,i,n){return this[0]=e,this[1]=t,this[2]=i,this[3]=n,this.check()}fromMatrix3(e){return function(e,t){var i,n=t[0]+t[4]+t[8];if(n>0)i=Math.sqrt(n+1),e[3]=.5*i,e[0]=(t[5]-t[7])*(i=.5/i),e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else {var r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);var o=(r+1)%3,a=(r+2)%3;i=Math.sqrt(t[3*r+r]-t[3*o+o]-t[3*a+a]+1),e[r]=.5*i,e[3]=(t[3*o+a]-t[3*a+o])*(i=.5/i),e[o]=(t[3*o+r]+t[3*r+o])*i,e[a]=(t[3*a+r]+t[3*r+a])*i;}}(this,e),this.check()}fromRotationMatrix4(e){const t=e.elements,i=t[0],n=t[4],r=t[8],o=t[1],a=t[5],s=t[9],l=t[2],u=t[6],c=t[10],h=i+a+c;let d;return h>0?(d=.5/Math.sqrt(h+1),this[3]=.25/d,this[0]=(u-s)*d,this[1]=(r-l)*d,this[2]=(o-n)*d):i>a&&i>c?(d=2*Math.sqrt(1+i-a-c),this[3]=(u-s)/d,this[0]=.25*d,this[1]=(n+o)/d,this[2]=(r+l)/d):a>c?(d=2*Math.sqrt(1+a-i-c),this[3]=(r-l)/d,this[0]=(n+o)/d,this[1]=.25*d,this[2]=(s+u)/d):(d=2*Math.sqrt(1+c-i-a),this[3]=(o-n)/d,this[0]=(r+l)/d,this[1]=(s+u)/d,this[2]=.25*d),this}fromHeadingPitchRoll(e){if(!(e instanceof st))throw new Error("There is not a HeadingPitchRoll!");const t=(new Et).setFromAxisAngle([1,0,0],e.roll),i=(new Et).setFromAxisAngle([0,1,0],-e.pitch),n=(new Et).setFromAxisAngle([0,0,1],-e.heading);return this.multiply(n).multiply(i).multiply(t),this}identity(){return function(e){e[0]=0,e[1]=0,e[2]=0,e[3]=1;}(this),this.check()}fromAxisRotation(e,t){return V(this,e,t),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}len(){return e=this,Math.hypot(e[0],e[1],e[2],e[3]);var e;}lengthSquared(){return (t=(e=this)[0])*t+(i=e[1])*i+(n=e[2])*n+(r=e[3])*r;var e,t,i,n,r;}dot(e){return function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}(this,e)}getAxisAngle(e={}){var t,i,n,r;return e.axis=new _t,e.angle=(t=e.axis,i=this,n=2*Math.acos(i[3]),(r=Math.sin(n/2))>m?(t[0]=i[0]/r,t[1]=i[1]/r,t[2]=i[2]/r):(t[0]=1,t[1]=0,t[2]=0),n),e}rotationTo(e,t){return q(this,e,t),this.check()}add(e){return function(e,t,i){e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3];}(this,this,e),this.check()}calculateW(){return function(e,t){var i=t[0],n=t[1],r=t[2];e[0]=i,e[1]=n,e[2]=r,e[3]=Math.sqrt(Math.abs(1-i*i-n*n-r*r));}(this,this),this.check()}conjugate(){return function(e,t){e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3];}(this,this),this.check()}invert(){return function(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],a=i*i+n*n+r*r+o*o,s=a?1/a:0;e[0]=-i*s,e[1]=-n*s,e[2]=-r*s,e[3]=o*s;}(this,this),this.check()}lerp(e,t,i){return function(e,t,i,n){var r=t[0],o=t[1],a=t[2],s=t[3];e[0]=r+n*(i[0]-r),e[1]=o+n*(i[1]-o),e[2]=a+n*(i[2]-a),e[3]=s+n*(i[3]-s);}(this,e,t,i),this.check()}multiplyRight(e){return k(this,this,e),this.check()}multiplyLeft(e){return k(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,0===e&&(this[3]=1),this.check()}rotateX(e){return function(e,t,i){i*=.5;var n=t[0],r=t[1],o=t[2],a=t[3],s=Math.sin(i),l=Math.cos(i);e[0]=n*l+a*s,e[1]=r*l+o*s,e[2]=o*l-r*s,e[3]=a*l-n*s;}(this,this,e),this.check()}rotateY(e){return function(e,t,i){i*=.5;var n=t[0],r=t[1],o=t[2],a=t[3],s=Math.sin(i),l=Math.cos(i);e[0]=n*l-o*s,e[1]=r*l+a*s,e[2]=o*l+n*s,e[3]=a*l-r*s;}(this,this,e),this.check()}rotateZ(e){return function(e,t,i){i*=.5;var n=t[0],r=t[1],o=t[2],a=t[3],s=Math.sin(i),l=Math.cos(i);e[0]=n*l+r*s,e[1]=r*l-n*s,e[2]=o*l+a*s,e[3]=a*l-o*s;}(this,this,e),this.check()}scale(e){return function(e,t,i){e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i;}(this,this,e),this.check()}slerp(e,t,i){return function(e,t,i,n){var r,o,a,s,l,u=t[0],c=t[1],h=t[2],d=t[3],p=i[0],f=i[1],_=i[2],g=i[3];(o=u*p+c*f+h*_+d*g)<0&&(o=-o,p=-p,f=-f,_=-_,g=-g),1-o>m?(r=Math.acos(o),a=Math.sin(r),s=Math.sin((1-n)*r)/a,l=Math.sin(n*r)/a):(s=1-n,l=n),e[0]=s*u+l*p,e[1]=s*c+l*f,e[2]=s*h+l*_,e[3]=s*d+l*g;}(this,e,t,i),this.check()}transformVector4(e,t=new St){return z(t,e,this),p(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}static fromAxisAngle(e,t,i=new Et){let n=new _t;const r=t/2,o=Math.sin(r);n=_t.normalize(e,n);const a=n.x*o,s=n.y*o,l=n.z*o,u=Math.cos(r);return i.x=a,i.y=s,i.z=l,i.w=u,i}static multiply(e,t,i=new Et){const n=e.x,r=e.y,o=e.z,a=e.w,s=t.x,l=t.y,u=t.z,c=t.w,h=a*l-n*u+r*c+o*s,d=a*u+n*l-r*s+o*c,p=a*c-n*s-r*l-o*u;return i.x=a*s+n*c+r*u-o*l,i.y=h,i.z=d,i.w=p,i}}Et.IDENTITY=Object.freeze(new Et(0,0,0,1));class At extends c{get RANK(){return 0}toString(){let e="[";e+="row-major:";for(let t=0;t<this.RANK;++t)for(let i=0;i<this.RANK;++i)e+=` ${this[i*this.RANK+t]}`;return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,i){return this[t*this.RANK+e]=d(i),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let e=0;e<this.RANK;++e)t[e]=this[i+e];return t}setColumn(e,t){const i=e*this.RANK;for(let e=0;e<this.RANK;++e)this[i+e]=t[e];return this}}const Ct=Object.freeze([1,0,0,0,1,0,0,0,1]),Mt=Object.freeze([0,0,0,0,0,0,0,0,0]),It=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL1ROW0:3,COL1ROW1:4,COL1ROW2:5,COL2ROW0:6,COL2ROW1:7,COL2ROW2:8}),Lt={};class Nt extends At{static get IDENTITY(){return Lt.IDENTITY=Lt.IDENTITY||Object.freeze(new Nt(Ct)),Lt.IDENTITY}static get ZERO(){return Lt.ZERO=Lt.ZERO||Object.freeze(new Nt(Mt)),Lt.ZERO}constructor(e){o(e)?super(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]):super(...Ct);}get ELEMENTS(){return 9}get RANK(){return 3}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}set(e,t,i,n,r,o,a,s,l){return this[0]=e,this[1]=t,this[2]=i,this[3]=n,this[4]=r,this[5]=o,this[6]=a,this[7]=s,this[8]=l,this.check()}setRowMajor(e,t,i,n,r,o,a,s,l){return this[0]=e,this[1]=n,this[2]=a,this[3]=t,this[4]=r,this[5]=s,this[6]=i,this[7]=o,this[8]=l,this.check()}determinant(){return (e=this)[0]*((a=e[8])*(i=e[4])-(n=e[5])*(o=e[7]))+e[1]*(-a*(t=e[3])+n*(r=e[6]))+e[2]*(o*t-i*r);var e,t,i,n,r,o,a;}identity(){return this.copy(Ct)}fromQuaternion(e,t=this){return function(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],a=i+i,s=n+n,l=r+r,u=i*a,c=n*a,h=n*s,d=r*a,p=r*s,f=r*l,m=o*a,_=o*s,g=o*l;e[0]=1-h-f,e[3]=c-g,e[6]=d+_,e[1]=c+g,e[4]=1-u-f,e[7]=p-m,e[2]=d-_,e[5]=p+m,e[8]=1-u-h;}(t,e),t.check()}transpose(e=this){return function(e,t){if(e===t){var i=t[1],n=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=n,e[7]=r;}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];}(e,this),e.check()}invert(e=this){return function(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],a=t[4],s=t[5],l=t[6],u=t[7],c=t[8],h=c*a-s*u,d=-c*o+s*l,p=u*o-a*l,f=i*h+n*d+r*p;f&&(e[0]=h*(f=1/f),e[1]=(-c*n+r*u)*f,e[2]=(s*n-r*a)*f,e[3]=d*f,e[4]=(c*i-r*l)*f,e[5]=(-s*i+r*o)*f,e[6]=p*f,e[7]=(-u*i+n*l)*f,e[8]=(a*i-n*o)*f);}(e,this),e.check()}multiplyLeft(e,t=this){return x(t,e,this),t.check()}multiplyRight(e,t=this){return t?(x(t,this,e),t.check()):(x(this,this,e),this.check())}rotate(e,t=this){return function(e,t,i){var n=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=Math.sin(i),p=Math.cos(i);e[0]=p*n+d*a,e[1]=p*r+d*s,e[2]=p*o+d*l,e[3]=p*a-d*n,e[4]=p*s-d*r,e[5]=p*l-d*o,e[6]=u,e[7]=c,e[8]=h;}(t,this,e),t.check()}scale(e,t=this){return o(e)?v(t,this,e):v(t,this,[e,e,e]),t.check()}translate(e,t=this){return function(e,t,i){var n=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=i[0],p=i[1];e[0]=n,e[1]=r,e[2]=o,e[3]=a,e[4]=s,e[5]=l,e[6]=d*n+p*a+u,e[7]=d*r+p*s+c,e[8]=d*o+p*l+h;}(t,this,e),t.check()}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transform(e,t){switch(e.length){case 2:t=W(t||[-0,-0],e,this);break;case 3:t=R(t||[-0,-0,-0],e,this);break;case 4:t=ht(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return p(t,e.length),t}setFromMatrix4(e){const t=e.elements;return this.setRowMajor(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}static multiply(e,t,i=new Nt){const n=e[1]*t[0]+e[4]*t[1]+e[7]*t[2],r=e[2]*t[0]+e[5]*t[1]+e[8]*t[2],o=e[0]*t[3]+e[3]*t[4]+e[6]*t[5],a=e[1]*t[3]+e[4]*t[4]+e[7]*t[5],s=e[2]*t[3]+e[5]*t[4]+e[8]*t[5],l=e[0]*t[6]+e[3]*t[7]+e[6]*t[8],u=e[1]*t[6]+e[4]*t[7]+e[7]*t[8],c=e[2]*t[6]+e[5]*t[7]+e[8]*t[8];return i[0]=e[0]*t[0]+e[3]*t[1]+e[6]*t[2],i[1]=n,i[2]=r,i[3]=o,i[4]=a,i[5]=s,i[6]=l,i[7]=u,i[8]=c,i}static multiplyByScale(e,t,i){return i[0]=e[0]*t.x,i[1]=e[1]*t.x,i[2]=e[2]*t.x,i[3]=e[3]*t.y,i[4]=e[4]*t.y,i[5]=e[5]*t.y,i[6]=e[6]*t.z,i[7]=e[7]*t.z,i[8]=e[8]*t.z,i}static multiplyByVector(e,t,i=new _t){const n=t.x,r=t.y,o=t.z,a=e[1]*n+e[4]*r+e[7]*o,s=e[2]*n+e[5]*r+e[8]*o;return i.x=e[0]*n+e[3]*r+e[6]*o,i.y=a,i.z=s,i}static fromScale(e,t=new Nt){return t[0]=e.x,t[1]=0,t[2]=0,t[3]=0,t[4]=e.y,t[5]=0,t[6]=0,t[7]=0,t[8]=e.z,t}static setColumn(e,t,i,n=new Nt){const r=3*t;return (n=Nt.clone(e,n))[r]=i.x,n[r+1]=i.y,n[r+2]=i.z,n}static getColumn(e,t,i=new _t){const n=3*t,r=e[n+1],o=e[n+2];return i.x=e[n],i.y=r,i.z=o,i}static clone(e,t=new Nt){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}static equalsArray(e,t,i=0){return e[0]===t[0+i]&&e[1]===t[1+i]&&e[2]===t[2+i]&&e[3]===t[3+i]&&e[4]===t[4+i]&&e[5]===t[5+i]&&e[6]===t[6+i]&&e[7]===t[7+i]&&e[8]===t[8+i]}static pack(e,t,i=0){return t[i++]=e[0],t[i++]=e[1],t[i++]=e[2],t[i++]=e[3],t[i++]=e[4],t[i++]=e[5],t[i++]=e[6],t[i++]=e[7],t[i++]=e[8],t}static equalsEpsilon(e,t,i=0){return e===t||$(e)&&$(t)&&Math.abs(e[0]-t[0])<=i&&Math.abs(e[1]-t[1])<=i&&Math.abs(e[2]-t[2])<=i&&Math.abs(e[3]-t[3])<=i&&Math.abs(e[4]-t[4])<=i&&Math.abs(e[5]-t[5])<=i&&Math.abs(e[6]-t[6])<=i&&Math.abs(e[7]-t[7])<=i&&Math.abs(e[8]-t[8])<=i}static fromQuaternion(e,t=new Nt){const i=e.x*e.x,n=e.x*e.y,r=e.x*e.z,o=e.x*e.w,a=e.y*e.y,s=e.y*e.z,l=e.y*e.w,u=e.z*e.z,c=e.z*e.w,h=e.w*e.w,d=2*(n-c),p=2*(r+l),f=2*(n+c),m=-i+a-u+h,_=2*(s-o),g=2*(r-l),y=2*(s+o),x=-i-a+u+h;return t[0]=i-a-u+h,t[1]=f,t[2]=g,t[3]=d,t[4]=m,t[5]=y,t[6]=p,t[7]=_,t[8]=x,t}static transpose(e,t=new Nt){const i=e[3],n=e[6],r=e[1],o=e[4],a=e[7],s=e[2],l=e[5],u=e[8];return t[0]=e[0],t[1]=i,t[2]=n,t[3]=r,t[4]=o,t[5]=a,t[6]=s,t[7]=l,t[8]=u,t}static getElementIndex(e,t){return 3*e+t}static computeFrobeniusNorm(e){let t=0;for(let i=0;i<9;++i){const n=e[i];t+=n*n;}return Math.sqrt(t)}static offDiagonalFrobeniusNorm(e){const t=[2,2,1],i=[1,0,0];let n=0;for(let r=0;r<3;++r){const o=e[Nt.getElementIndex(t[r],i[r])];n+=2*o*o;}return Math.sqrt(n)}static shurDecomposition(e,t){const i=[1,0,0],n=[2,2,1];let r=0,o=1;for(let t=0;t<3;++t){const a=Math.abs(e[Nt.getElementIndex(n[t],i[t])]);a>r&&(o=t,r=a);}let a=1,s=0;const l=i[o],u=n[o];if(Math.abs(e[Nt.getElementIndex(u,l)])>1e-15){const t=(e[Nt.getElementIndex(u,u)]-e[Nt.getElementIndex(l,l)])/2/e[Nt.getElementIndex(u,l)];let i;i=t<0?-1/(-t+Math.sqrt(1+t*t)):1/(t+Math.sqrt(1+t*t)),a=1/Math.sqrt(1+i*i),s=i*a;}return (t=Nt.clone(Nt.IDENTITY,t))[Nt.getElementIndex(l,l)]=t[Nt.getElementIndex(u,u)]=a,t[Nt.getElementIndex(u,l)]=s,t[Nt.getElementIndex(l,u)]=-s,t}static computeEigenDecomposition(e,t={}){const i=new Nt,n=new Nt;let r=0,o=0;const a=t.unitary=Nt.clone(Nt.IDENTITY,t.unitary),s=t.diagonal=Nt.clone(e,t.diagonal),l=1e-20*Nt.computeFrobeniusNorm(s);for(;o<10&&Nt.offDiagonalFrobeniusNorm(s)>l;)Nt.shurDecomposition(s,i),Nt.transpose(i,n),Nt.multiply(s,i,s),Nt.multiply(n,s,s),Nt.multiply(a,i,a),++r>2&&(++o,r=0);return t}transformVector(e,t){return f("Matrix3.transformVector"),this.transform(e,t)}transformVector2(e,t){return f("Matrix3.transformVector"),this.transform(e,t)}transformVector3(e,t){return f("Matrix3.transformVector"),this.transform(e,t)}}const Rt={};class Ot extends lt{static get ONE(){return Rt.ONE=Rt.ONE||Object.freeze(new Ot(1,1))}static get ZERO(){return Rt.ZERO=Rt.ZERO||Object.freeze(new Ot(0,0))}static get UNIT_X(){return Rt.UNIT_X=Rt.UNIT_X||Object.freeze(new Ot(1,0))}static get UNIT_Y(){return Rt.UNIT_Y=Rt.UNIT_Y||Object.freeze(new Ot(0,1))}constructor(e,t){o(e)?super(e[0],e[1]):super(e||0,t||0);}get ELEMENTS(){return 2}get x(){return this[0]}set x(e){this[0]=d(e);}get y(){return this[1]}set y(e){this[1]=d(e);}set(e,t){return this[0]=e,this[1]=t,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this.check()}toObject(e={}){return e.x=this[0],e.y=this[1],e}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}rotate(e,t,i){const n=e[0]-t[0],r=e[1]-t[1],o=Math.sin(i),a=Math.cos(i);return this[0]=n*a-r*o+t[0],this[1]=n*o+r*a+t[1],this.check()}transform(e,t=this){return this.transformAsPoint(e,t)}transformAsPoint(e,t=this){return j(t,this,e),t.check()}transformAsVector(e,t=this){return ut(t,this,e),t.check()}transformByMatrix3(e,t=this){return W(t,this,e),t.check()}transformByMatrix2(e,t=this){return X(t,this,e),t.check()}perp(){const e=this.x;return this.x=this.y,this.y=-e,this.check()}mostOrthogonalAxis(e,t=new Ot){const i=new Ot,n=Ot.normalize(e,i);return Ot.abs(n,n),Ot.clone(n.x<=n.y?Ot.UNIT_X:Ot.UNIT_Y,t)}clone(e=new Ot){return Ot.clone(this,e)}equals(e){return Ot.equals(this,e)}equalsEpsilon(e,t=0,i=t){return Ot.equalsEpsilon(this,e,t,i)}toString(){return `(${this.x}, ${this.y})`}static fromElements(e,t,i=new Ot){return i.x=e,i.y=t,i}static clone(e,t=new Ot){return t.x=e.x,t.y=e.y,t}static pack(e,t,i=0){return t[i++]=e.x,t[i]=e.y,t}static unpack(e,t=0,i=new Ot){return i.x=e[t++],i.y=e[t],i}static packArray(e,t){const i=e.length,n=2*i;if($(t)){if(!Array.isArray(t)&&t.length!==n)throw new Error("If result is a typed array, it must have exactly array.length * 2 elements");t.length!==n&&(t.length=n);}else t=new Array(n);for(let n=0;n<i;++n)Ot.pack(e[n],t,2*n);return t}static unpackArray(e,t){const i=e.length;$(t)?t.length=i/2:t=new Array(i/2);for(let n=0;n<i;n+=2){const i=n/2;t[i]=Ot.unpack(e,n,t[i]);}return t}static maximumComponent(e){return Math.max(e.x,e.y)}static minimumComponent(e){return Math.min(e.x,e.y)}static minimumByComponent(e,t,i=new Ot){return i.x=Math.min(e.x,t.x),i.y=Math.min(e.y,t.y),i}static maximumByComponent(e,t,i=new Ot){return i.x=Math.max(e.x,t.x),i.y=Math.max(e.y,t.y),i}static magnitudeSquared(e){return e.x*e.x+e.y*e.y}static magnitude(e){return Math.sqrt(Ot.magnitudeSquared(e))}static distance(e,t){const i=new Ot;return Ot.subtract(e,t,i),Ot.magnitude(i)}static distanceSquared(e,t){const i=new Ot;return Ot.subtract(e,t,i),Ot.magnitudeSquared(i)}static normalize(e,t=new Ot){const i=Ot.magnitude(e);return t.x=e.x/i,t.y=e.y/i,t}static dot(e,t){return e.x*t.x+e.y*t.y}static cross(e,t){return e.x*t.y-e.y*t.x}static multiplyComponents(e,t,i){return i.x=e.x*t.x,i.y=e.y*t.y,i}static divideComponents(e,t,i=new Ot){return i.x=e.x/t.x,i.y=e.y/t.y,i}static add(e,t,i=new Ot){return i.x=e.x+t.x,i.y=e.y+t.y,i}static subtract(e,t,i=new Ot){return i.x=e.x-t.x,i.y=e.y-t.y,i}static multiplyByScalar(e,t,i=new Ot){return i.x=e.x*t,i.y=e.y*t,i}static divideByScalar(e,t,i=new Ot){return i.x=e.x/t,i.y=e.y/t,i}static negate(e,t){return t.x=-e.x,t.y=-e.y,t}static abs(e,t){return t.x=Math.abs(e.x),t.y=Math.abs(e.y),t}static lerp(e,t,i,n=new Ot){const r=new Ot;return Ot.multiplyByScalar(t,i,r),n=Ot.multiplyByScalar(e,1-i,n),Ot.add(r,n,n)}static angleBetween(e,t){const i=new Ot,n=new Ot;return Ot.normalize(e,i),Ot.normalize(t,n),ot.CesiumMath.acosClamped(Ot.dot(i,n))}static equals(e,t){return e===t||e.x===t.x&&e.y===t.y}static equalsArray(e,t,i=0){return e.x===t[i]&&e.y===t[i+1]}static equalsEpsilon(e,t,i=0,n=i){return e===t||ot.CesiumMath.equalsEpsilon(e.x,t.x,i,n)&&ot.CesiumMath.equalsEpsilon(e.y,t.y,i,n)}static convert(e){return Array.isArray(e)?new Ot(e):e}}const Dt=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Ft=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),zt={};Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15});class Bt extends At{static get IDENTITY(){return zt.IDENTITY=zt.IDENTITY||Object.freeze(new Bt(Dt)),zt.IDENTITY}static get ZERO(){return zt.ZERO=zt.ZERO||Object.freeze(new Bt(Ft)),zt.ZERO}constructor(e){o(e)?super(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]):super(...Dt);}get ELEMENTS(){return 16}get RANK(){return 4}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,i,n,r,o,a,s,l,u,c,h,d,p,f,m){return this[0]=e,this[1]=t,this[2]=i,this[3]=n,this[4]=r,this[5]=o,this[6]=a,this[7]=s,this[8]=l,this[9]=u,this[10]=c,this[11]=h,this[12]=d,this[13]=p,this[14]=f,this[15]=m,this.check()}setRowMajor(e,t,i,n,r,o,a,s,l,u,c,h,d,p,f,m){return this[0]=e,this[1]=r,this[2]=l,this[3]=d,this[4]=t,this[5]=o,this[6]=u,this[7]=p,this[8]=i,this[9]=a,this[10]=c,this[11]=f,this[12]=n,this[13]=s,this[14]=h,this[15]=m,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}setFromMatrix3(e){return this.set(e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1),this.check()}identity(){return this.copy(Dt)}fromQuaternion(e){return function(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],a=i+i,s=n+n,l=r+r,u=i*a,c=n*a,h=n*s,d=r*a,p=r*s,f=r*l,m=o*a,_=o*s,g=o*l;e[0]=1-h-f,e[1]=c+g,e[2]=d-_,e[3]=0,e[4]=c-g,e[5]=1-u-f,e[6]=p+m,e[7]=0,e[8]=d+_,e[9]=p-m,e[10]=1-u-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1;}(this,e),this.check()}frustum({left:e,right:t,bottom:i,top:n,near:r,far:o}){return o===1/0?Bt.computeInfinitePerspectiveOffCenter(this,e,t,i,n,r):function(e,t,i,n,r,o,a){var s=1/(i-t),l=1/(r-n),u=1/(o-a);e[0]=2*o*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*l,e[6]=0,e[7]=0,e[8]=(i+t)*s,e[9]=(r+n)*l,e[10]=(a+o)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o*2*u,e[15]=0;}(this,e,t,i,n,r,o),this.check()}static computeInfinitePerspectiveOffCenter(e,t,i,n,r,o){const a=2*o/(r-n),s=(i+t)/(i-t),l=(r+n)/(r-n),u=-2*o;return e[0]=2*o/(i-t),e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=s,e[9]=l,e[10]=-1,e[11]=-1,e[12]=0,e[13]=0,e[14]=u,e[15]=0,e}lookAt(e,t,i){return 1===arguments.length&&({eye:e,center:t,up:i}=e),function(e,t,i,n){var r,o,a,s,l,u,c,h,d,p,f=t[0],_=t[1],g=t[2],y=n[0],x=n[1],v=n[2],w=i[0],T=i[1],b=i[2];Math.abs(f-w)<m&&Math.abs(_-T)<m&&Math.abs(g-b)<m?function(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1;}(e):(c=f-w,h=_-T,d=g-b,r=x*(d*=p=1/Math.hypot(c,h,d))-v*(h*=p),o=v*(c*=p)-y*d,a=y*h-x*c,(p=Math.hypot(r,o,a))?(r*=p=1/p,o*=p,a*=p):(r=0,o=0,a=0),s=h*a-d*o,l=d*r-c*a,u=c*o-h*r,(p=Math.hypot(s,l,u))?(s*=p=1/p,l*=p,u*=p):(s=0,l=0,u=0),e[0]=r,e[1]=s,e[2]=c,e[3]=0,e[4]=o,e[5]=l,e[6]=h,e[7]=0,e[8]=a,e[9]=u,e[10]=d,e[11]=0,e[12]=-(r*f+o*_+a*g),e[13]=-(s*f+l*_+u*g),e[14]=-(c*f+h*_+d*g),e[15]=1);}(this,e,t=t||[0,0,0],i=i||[0,1,0]),this.check()}ortho({left:e,right:t,bottom:i,top:n,near:r=.1,far:o=500}){return function(e,t,i,n,r,o,a){var s=1/(t-i),l=1/(n-r),u=1/(o-a);e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+i)*s,e[13]=(r+n)*l,e[14]=(a+o)*u,e[15]=1;}(this,e,t,i,n,r,o),this.check()}perspective({fov:e=.25*Math.PI,aspect:t=1,near:i=.1,far:n=500}){if(e>2*Math.PI)throw Error("radians");return function(e,t,i,n,r){var o,a=1/Math.tan(t/2);e[0]=a/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(e[10]=(r+n)*(o=1/(n-r)),e[14]=2*r*n*o):(e[10]=-1,e[14]=-2*n);}(this,e,t,i,n),this.check()}determinant(){return ((t=(e=this)[0])*(a=e[5])-(i=e[1])*(o=e[4]))*((h=e[10])*(_=e[15])-(d=e[11])*(m=e[14]))-(t*(s=e[6])-(n=e[2])*o)*((c=e[9])*_-d*(f=e[13]))+(t*(l=e[7])-(r=e[3])*o)*(c*m-h*f)+(i*s-n*a)*((u=e[8])*_-d*(p=e[12]))-(i*l-r*a)*(u*m-h*p)+(n*l-r*s)*(u*f-c*p);var e,t,i,n,r,o,a,s,l,u,c,h,d,p,f,m,_;}getScale(e=new _t){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}setTranslation(e){return this[12]=e[0],this[13]=e[1],this[14]=e[2],this.check()}getTranslation(e=new _t){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getTranslationMatrix4(e=new Bt){return e.identity(),e[12]=this[12],e[13]=this[13],e[14]=this[14],e}getRotation(e=new Bt){const t=this.getScale(),i=1/t[0],n=1/t[1],r=1/t[2];return e[0]=this[0]*i,e[1]=this[1]*n,e[2]=this[2]*r,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*n,e[6]=this[6]*r,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*n,e[10]=this[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e=new Nt){const t=this.getScale(),i=1/t[0],n=1/t[1],r=1/t[2];return e[0]=this[0]*i,e[1]=this[1]*n,e[2]=this[2]*r,e[3]=this[4]*i,e[4]=this[5]*n,e[5]=this[6]*r,e[6]=this[8]*i,e[7]=this[9]*n,e[8]=this[10]*r,e}transpose(e=this){return function(e,t){if(e===t){var i=t[1],n=t[2],r=t[3],o=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=o,e[11]=t[14],e[12]=r,e[13]=a,e[14]=s;}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];}(e,this),e.check()}invert(e=this){return function(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],a=t[4],s=t[5],l=t[6],u=t[7],c=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],_=t[14],g=t[15],y=i*s-n*a,x=i*l-r*a,v=i*u-o*a,w=n*l-r*s,T=n*u-o*s,b=r*u-o*l,P=c*m-h*f,S=c*_-d*f,E=c*g-p*f,A=h*_-d*m,C=h*g-p*m,M=d*g-p*_,I=y*M-x*C+v*A+w*E-T*S+b*P;I&&(e[0]=(s*M-l*C+u*A)*(I=1/I),e[1]=(r*C-n*M-o*A)*I,e[2]=(m*b-_*T+g*w)*I,e[3]=(d*T-h*b-p*w)*I,e[4]=(l*E-a*M-u*S)*I,e[5]=(i*M-r*E+o*S)*I,e[6]=(_*v-f*b-g*x)*I,e[7]=(c*b-d*v+p*x)*I,e[8]=(a*C-s*E+u*P)*I,e[9]=(n*E-i*C-o*P)*I,e[10]=(f*T-m*v+g*y)*I,e[11]=(h*v-c*T-p*y)*I,e[12]=(s*S-a*A-l*P)*I,e[13]=(i*A-n*S+r*P)*I,e[14]=(m*x-f*w-_*y)*I,e[15]=(c*w-h*x+d*y)*I);}(e,this),e.check()}inverseTranspose(e=this){return this.transpose(e).invert(e)}multiplyLeft(e,t=this){return w(t,e,this),t.check()}multiplyRight(e,t=this){return w(t,this,e),t.check()}rotateX(e,t=this){return function(e,t,i){var n=Math.sin(i),r=Math.cos(i),o=t[4],a=t[5],s=t[6],l=t[7],u=t[8],c=t[9],h=t[10],d=t[11];t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*r+u*n,e[5]=a*r+c*n,e[6]=s*r+h*n,e[7]=l*r+d*n,e[8]=u*r-o*n,e[9]=c*r-a*n,e[10]=h*r-s*n,e[11]=d*r-l*n;}(t,this,e),t.check()}rotateY(e,t=this){return function(e,t,i){var n=Math.sin(i),r=Math.cos(i),o=t[0],a=t[1],s=t[2],l=t[3],u=t[8],c=t[9],h=t[10],d=t[11];t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r-u*n,e[1]=a*r-c*n,e[2]=s*r-h*n,e[3]=l*r-d*n,e[8]=o*n+u*r,e[9]=a*n+c*r,e[10]=s*n+h*r,e[11]=l*n+d*r;}(t,this,e),t.check()}rotateZ(e,t=this){return function(e,t,i){var n=Math.sin(i),r=Math.cos(i),o=t[0],a=t[1],s=t[2],l=t[3],u=t[4],c=t[5],h=t[6],d=t[7];t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r+u*n,e[1]=a*r+c*n,e[2]=s*r+h*n,e[3]=l*r+d*n,e[4]=u*r-o*n,e[5]=c*r-a*n,e[6]=h*r-s*n,e[7]=d*r-l*n;}(t,this,e),t.check()}rotateXYZ([e,t,i]){return this.rotateX(e).rotateY(t).rotateZ(i)}rotateAxis(e,t,i=this){return function(e,t,i,n){var r,o,a,s,l,u,c,h,d,p,f,_,g,y,x,v,w,T,b,P,S,E,A,C,M=n[0],I=n[1],L=n[2],N=Math.hypot(M,I,L);N<m||(M*=N=1/N,I*=N,L*=N,r=Math.sin(i),o=Math.cos(i),l=t[1],u=t[2],c=t[3],d=t[5],p=t[6],f=t[7],g=t[9],y=t[10],x=t[11],b=M*I*(a=1-o)-L*r,P=I*I*a+o,S=L*I*a+M*r,E=M*L*a+I*r,A=I*L*a-M*r,C=L*L*a+o,e[0]=(s=t[0])*(v=M*M*a+o)+(h=t[4])*(w=I*M*a+L*r)+(_=t[8])*(T=L*M*a-I*r),e[1]=l*v+d*w+g*T,e[2]=u*v+p*w+y*T,e[3]=c*v+f*w+x*T,e[4]=s*b+h*P+_*S,e[5]=l*b+d*P+g*S,e[6]=u*b+p*P+y*S,e[7]=c*b+f*P+x*S,e[8]=s*E+h*A+_*C,e[9]=l*E+d*A+g*C,e[10]=u*E+p*A+y*C,e[11]=c*E+f*A+x*C,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]));}(i,this,e,t),i.check()}scale(e,t=this){return function(e,t,i){var n=i[0],r=i[1],o=i[2];e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15];}(t,this,"number"!=typeof e?e:[e,e,e]),t.check()}translate(e,t=this){return function(e,t,i){var n,r,o,a,s,l,u,c,h,d,p,f,m=i[0],_=i[1],g=i[2];t===e?(e[12]=t[0]*m+t[4]*_+t[8]*g+t[12],e[13]=t[1]*m+t[5]*_+t[9]*g+t[13],e[14]=t[2]*m+t[6]*_+t[10]*g+t[14],e[15]=t[3]*m+t[7]*_+t[11]*g+t[15]):(r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=n=t[0],e[1]=r,e[2]=o,e[3]=a,e[4]=s,e[5]=l,e[6]=u,e[7]=c,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=n*m+s*_+h*g+t[12],e[13]=r*m+l*_+d*g+t[13],e[14]=o*m+u*_+p*g+t[14],e[15]=a*m+c*_+f*g+t[15]);}(t,this,e),t.check()}transform(e,t){return 4===e.length?(p(t=F(t||new St,e,this),4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:i}=e.toArray();switch(i){case 2:t=j(t||new Ot,e,this);break;case 3:t=N(t||new _t,e,this);break;default:throw new Error("Illegal vector")}return p(t,e.length),t}transformAsVector(e,t){switch(e.length){case 2:t=ut(t||new Ot,e,this);break;case 3:t=ct(t||new _t,e,this);break;default:throw new Error("Illegal vector")}return p(t,e.length),t}makeRotationX(e){return this.identity().rotateX(e)}makeRotationY(e){return this.identity().rotateY(e)}makeRotationZ(e){return this.identity().rotateZ(e)}makeTranslation(e,t,i){return this.identity().translate([e,t,i])}makeScale(e,t,i){return this.identity().scale([e,t,i])}compose(e,t,i){const n=this.elements,r=t[0],o=t[1],a=t[2],s=t[3],l=r+r,u=o+o,c=a+a,h=r*l,d=r*u,p=r*c,f=o*u,m=o*c,_=a*c,g=s*l,y=s*u,x=s*c,v=i[0],w=i[1],T=i[2];return n[0]=(1-(f+_))*v,n[1]=(d+x)*v,n[2]=(p-y)*v,n[3]=0,n[4]=(d-x)*w,n[5]=(1-(h+_))*w,n[6]=(m+g)*w,n[7]=0,n[8]=(p+y)*T,n[9]=(m-g)*T,n[10]=(1-(h+f))*T,n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,this}decompose(e,t,i){const n=this.elements;let r=new _t(n[0],n[1],n[2]).len();const o=new _t(n[4],n[5],n[6]).len(),a=new _t(n[8],n[9],n[10]).len();this.determinant()<0&&(r=-r),e[0]=n[12],e[1]=n[13],e[2]=n[14];const s=this.clone(),l=1/r,u=1/o,c=1/a;return s[0]*=l,s[1]*=l,s[2]*=l,s[4]*=u,s[5]*=u,s[6]*=u,s[8]*=c,s[9]*=c,s[10]*=c,t.fromRotationMatrix4(s),i[0]=r,i[1]=o,i[2]=a,this}extractRotation(e=this){const t=this,i=e,n=1/new _t(t[0],t[1],t[2]).len(),r=1/new _t(t[4],t[5],t[6]).len(),o=1/new _t(t[8],t[9],t[10]).len();return i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i[3]=0,i[4]=t[4]*r,i[5]=t[5]*r,i[6]=t[6]*r,i[7]=0,i[8]=t[8]*o,i[9]=t[9]*o,i[10]=t[10]*o,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}static equalsEpsilon(e,t,i){return i=Z(i,0),e===t||$(e)&&$(t)&&Math.abs(e[0]-t[0])<=i&&Math.abs(e[1]-t[1])<=i&&Math.abs(e[2]-t[2])<=i&&Math.abs(e[3]-t[3])<=i&&Math.abs(e[4]-t[4])<=i&&Math.abs(e[5]-t[5])<=i&&Math.abs(e[6]-t[6])<=i&&Math.abs(e[7]-t[7])<=i&&Math.abs(e[8]-t[8])<=i&&Math.abs(e[9]-t[9])<=i&&Math.abs(e[10]-t[10])<=i&&Math.abs(e[11]-t[11])<=i&&Math.abs(e[12]-t[12])<=i&&Math.abs(e[13]-t[13])<=i&&Math.abs(e[14]-t[14])<=i&&Math.abs(e[15]-t[15])<=i}static getTranslation(e,t=new _t){return t.x=e[12],t.y=e[13],t.z=e[14],t}static multiplyByPoint(e,t,i=new _t){const n=t.x,r=t.y,o=t.z,a=e[1]*n+e[5]*r+e[9]*o+e[13],s=e[2]*n+e[6]*r+e[10]*o+e[14];return i.x=e[0]*n+e[4]*r+e[8]*o+e[12],i.y=a,i.z=s,i}static multiply(e,t,i){if(!e||!t||!i)throw new Error("multiply error para");return w(e,t,i),e.check()}static getMaximumScale(e){const t=new _t;return Bt.getScale(e,t),_t.maximumComponent(t)}static multiplyByVector(e,t,i=new St){const n=t.x,r=t.y,o=t.z,a=t.w,s=e[1]*n+e[5]*r+e[9]*o+e[13]*a,l=e[2]*n+e[6]*r+e[10]*o+e[14]*a,u=e[3]*n+e[7]*r+e[11]*o+e[15]*a;return i.x=e[0]*n+e[4]*r+e[8]*o+e[12]*a,i.y=s,i.z=l,i.w=u,i}static getScale(e,t=new _t){const i=new _t;return t.x=_t.magnitude(_t.fromElements(e[0],e[1],e[2],i)),t.y=_t.magnitude(_t.fromElements(e[4],e[5],e[6],i)),t.z=_t.magnitude(_t.fromElements(e[8],e[9],e[10],i)),t}static getColumn(e,t,i=new St){const n=4*t,r=e[n+1],o=e[n+2],a=e[n+3];return i.x=e[n],i.y=r,i.z=o,i.w=a,i}static inverseTransformation(e,t=new Bt){const i=e[0],n=e[1],r=e[2],o=e[4],a=e[5],s=e[6],l=e[8],u=e[9],c=e[10],h=e[12],d=e[13],p=e[14],f=-i*h-n*d-r*p,m=-o*h-a*d-s*p,_=-l*h-u*d-c*p;return t[0]=i,t[1]=o,t[2]=l,t[3]=0,t[4]=n,t[5]=a,t[6]=u,t[7]=0,t[8]=r,t[9]=s,t[10]=c,t[11]=0,t[12]=f,t[13]=m,t[14]=_,t[15]=1,t}static inverse(e,t=new Bt){const i=new Nt,n=new Nt,r=new St,o=new St(0,0,0,1),a=e[0],s=e[4],l=e[8],u=e[12],c=e[1],h=e[5],d=e[9],p=e[13],f=e[2],m=e[6],_=e[10],g=e[14],y=e[3],x=e[7],v=e[11],w=e[15];let T=_*w,b=g*v,P=m*w,S=g*x,E=m*v,A=_*x,C=f*w,M=g*y,I=f*v,L=_*y,N=f*x,R=m*y;const O=T*h+S*d+E*p-(b*h+P*d+A*p),D=b*c+C*d+L*p-(T*c+M*d+I*p),F=P*c+M*h+N*p-(S*c+C*h+R*p),z=A*c+I*h+R*d-(E*c+L*h+N*d),B=b*s+P*l+A*u-(T*s+S*l+E*u),V=T*a+M*l+I*u-(b*a+C*l+L*u),k=S*a+C*s+R*u-(P*a+M*s+N*u),U=E*a+L*s+N*l-(A*a+I*s+R*l);T=l*p,b=u*d,P=s*p,S=u*h,E=s*d,A=l*h,C=a*p,M=u*c,I=a*d,L=l*c,N=a*h,R=s*c;const G=T*x+S*v+E*w-(b*x+P*v+A*w),H=b*y+C*v+L*w-(T*y+M*v+I*w),Y=P*y+M*x+N*w-(S*y+C*x+R*w),q=A*y+I*x+R*v-(E*y+L*x+N*v),X=P*_+A*g+b*m-(E*g+T*m+S*_),W=I*g+T*f+M*_-(C*_+L*g+b*f),j=C*m+R*g+S*f-(N*g+P*f+M*m),$=N*_+E*f+L*m-(I*m+R*_+A*f);let Z=a*O+s*D+l*F+u*z;if(Math.abs(Z)<ot.CesiumMath.EPSILON21){if(Nt.equalsEpsilon(Bt.getMatrix3(e,i),n,ot.CesiumMath.EPSILON7)&&St.equals(Bt.getRow(e,3,r),o))return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=0,t[11]=0,t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=1,t;throw new Error("matrix is not invertible because its determinate is zero.")}return Z=1/Z,t[0]=O*Z,t[1]=D*Z,t[2]=F*Z,t[3]=z*Z,t[4]=B*Z,t[5]=V*Z,t[6]=k*Z,t[7]=U*Z,t[8]=G*Z,t[9]=H*Z,t[10]=Y*Z,t[11]=q*Z,t[12]=X*Z,t[13]=W*Z,t[14]=j*Z,t[15]=$*Z,t}static transpose(e,t=new Bt){return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t}static inverseTranspose(e,t=new Bt){const i=new Bt;return Bt.inverse(Bt.transpose(e,i),t)}static getMatrix3(e,t=new Nt){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}static getRow(e,t,i=new St){const n=e[t+4],r=e[t+8],o=e[t+12];return i.x=e[t],i.y=n,i.z=r,i.w=o,i}static equals(e,t){return e===t||$(e)&&$(t)&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[3]===t[3]&&e[7]===t[7]&&e[11]===t[11]&&e[15]===t[15]}static equalsArray(e,t,i=0){return e[0]===t[0+i]&&e[1]===t[1+i]&&e[2]===t[2+i]&&e[3]===t[3+i]&&e[4]===t[4+i]&&e[5]===t[5+i]&&e[6]===t[6+i]&&e[7]===t[7+i]&&e[8]===t[8+i]&&e[9]===t[9+i]&&e[10]===t[10+i]&&e[11]===t[11+i]&&e[12]===t[12+i]&&e[13]===t[13+i]&&e[14]===t[14+i]&&e[15]===t[15+i]}static pack(e,t,i=0){return t[i++]=e[0],t[i++]=e[1],t[i++]=e[2],t[i++]=e[3],t[i++]=e[4],t[i++]=e[5],t[i++]=e[6],t[i++]=e[7],t[i++]=e[8],t[i++]=e[9],t[i++]=e[10],t[i++]=e[11],t[i++]=e[12],t[i++]=e[13],t[i++]=e[14],t[i]=e[15],t}static computeView(e,t,i,n,r=new Bt){return r[0]=n.x,r[1]=i.x,r[2]=-t.x,r[3]=0,r[4]=n.y,r[5]=i.y,r[6]=-t.y,r[7]=0,r[8]=n.z,r[9]=i.z,r[10]=-t.z,r[11]=0,r[12]=-_t.dot(n,e),r[13]=-_t.dot(i,e),r[14]=_t.dot(t,e),r[15]=1,r}static fromRotationTranslation(e,t=_t.ZERO,i=new Bt){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=0,i[4]=e[3],i[5]=e[4],i[6]=e[5],i[7]=0,i[8]=e[6],i[9]=e[7],i[10]=e[8],i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,i}static fromTranslationQuaternionRotationScale(e=_t.ZERO,t=new Et,i=_t.ONE,n=new Bt){const r=i.x,o=i.y,a=i.z,s=t.x*t.x,l=t.x*t.y,u=t.x*t.z,c=t.x*t.w,h=t.y*t.y,d=t.y*t.z,p=t.y*t.w,f=t.z*t.z,m=t.z*t.w,_=t.w*t.w,g=2*(l-m),y=2*(u+p),x=2*(l+m),v=-s+h-f+_,w=2*(d-c),T=2*(u-p),b=2*(d+c),P=-s-h+f+_;return n[0]=(s-h-f+_)*r,n[1]=x*r,n[2]=T*r,n[3]=0,n[4]=g*o,n[5]=v*o,n[6]=b*o,n[7]=0,n[8]=y*a,n[9]=w*a,n[10]=P*a,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,n}static fromTranslationHeadingPitchRollRotationScale(e=_t.ZERO,t=new st,i=_t.ONE,n=new Bt){const r=(new Et).fromHeadingPitchRoll(t),o=i.x,a=i.y,s=i.z,l=r.x*r.x,u=r.x*r.y,c=r.x*r.z,h=r.x*r.w,d=r.y*r.y,p=r.y*r.z,f=r.y*r.w,m=r.z*r.z,_=r.z*r.w,g=r.w*r.w,y=2*(u-_),x=2*(c+f),v=2*(u+_),w=-l+d-m+g,T=2*(p-h),b=2*(c-f),P=2*(p+h),S=-l-d+m+g;return n[0]=(l-d-m+g)*o,n[1]=v*o,n[2]=b*o,n[3]=0,n[4]=y*a,n[5]=w*a,n[6]=P*a,n[7]=0,n[8]=x*s,n[9]=T*s,n[10]=S*s,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,n}static multiplyTransformation(e,t,i=new Bt){const n=e[0],r=e[1],o=e[2],a=e[4],s=e[5],l=e[6],u=e[8],c=e[9],h=e[10],d=t[0],p=t[1],f=t[2],m=t[4],_=t[5],g=t[6],y=t[8],x=t[9],v=t[10],w=t[12],T=t[13],b=t[14],P=r*d+s*p+c*f,S=o*d+l*p+h*f,E=n*m+a*_+u*g,A=r*m+s*_+c*g,C=o*m+l*_+h*g,M=n*y+a*x+u*v,I=r*y+s*x+c*v,L=o*y+l*x+h*v,N=n*w+a*T+u*b+e[12],R=r*w+s*T+c*b+e[13],O=o*w+l*T+h*b+e[14];return i[0]=n*d+a*p+u*f,i[1]=P,i[2]=S,i[3]=0,i[4]=E,i[5]=A,i[6]=C,i[7]=0,i[8]=M,i[9]=I,i[10]=L,i[11]=0,i[12]=N,i[13]=R,i[14]=O,i[15]=1,i}static multiplyByPointAsVector(e,t,i=new _t){const n=t.x,r=t.y,o=t.z,a=e[1]*n+e[5]*r+e[9]*o,s=e[2]*n+e[6]*r+e[10]*o;return i.x=e[0]*n+e[4]*r+e[8]*o,i.y=a,i.z=s,i}static clone(e,t=new Bt){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}static computeOrthographicOffCenter(e,t,i,n,r,o,a=new Bt){let s=1/(t-e),l=1/(n-i),u=1/(o-r);const c=-(t+e)*s,h=-(n+i)*l,d=-(o+r)*u;return s*=2,l*=2,u*=-2,a[0]=s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=l,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=u,a[11]=0,a[12]=c,a[13]=h,a[14]=d,a[15]=1,a}static fromTranslation(e,t=new Bt){return Bt.fromRotationTranslation(Nt.IDENTITY,e,t)}static multiplyByTranslation(e,t,i=new Bt){const n=t.x,r=t.y,o=t.z,a=n*e[0]+r*e[4]+o*e[8]+e[12],s=n*e[1]+r*e[5]+o*e[9]+e[13],l=n*e[2]+r*e[6]+o*e[10]+e[14];return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=a,i[13]=s,i[14]=l,i[15]=e[15],i}static computeViewportTransformation(e={},t=0,i=1,n=new Bt){const r=Z(e.x,0),o=Z(e.y,0),a=.5*Z(e.width,0),s=.5*Z(e.height,0),l=.5*(i-t),u=s,c=l,h=r+a,d=o+s,p=t+l;return n[0]=a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=u,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=c,n[11]=0,n[12]=h,n[13]=d,n[14]=p,n[15]=1,n}transformPoint(e,t){return f("Matrix4.transformPoint","3.0"),this.transformAsPoint(e,t)}transformVector(e,t){return f("Matrix4.transformVector","3.0"),this.transformAsPoint(e,t)}transformDirection(e,t){return f("Matrix4.transformDirection","3.0"),this.transformAsVector(e,t)}static fromCamera(e,t=new Bt){const i=new _t,n=new _t,r=new _t,o=e.position,a=e.up;_t.normalize(e.direction,i),_t.normalize(_t.cross(i,a,n),n),_t.normalize(_t.cross(n,i,r),r);const s=n.x,l=n.y,u=n.z,c=i.x,h=i.y,d=i.z,p=r.x,f=r.y,m=r.z,_=o.x,g=o.y,y=o.z,x=s*-_+l*-g+u*-y,v=p*-_+f*-g+m*-y,w=c*_+h*g+d*y;return $(t)?(t[0]=s,t[1]=p,t[2]=-c,t[3]=0,t[4]=l,t[5]=f,t[6]=-h,t[7]=0,t[8]=u,t[9]=m,t[10]=-d,t[11]=0,t[12]=x,t[13]=v,t[14]=w,t[15]=1,t):new Bt(s,l,u,x,p,f,m,v,-c,-h,-d,w,0,0,0,1)}}const Vt="Unknown Euler angle order",kt=.99999;class Ut extends c{constructor(e=0,t=0,i=0,n=Ut.DefaultOrder){super(-0,-0,-0,-0),o(e)?this.fromVector3(e,n):this.set(e,t,i,n);}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=d(e);}get y(){return this[1]}set y(e){this[1]=d(e);}get z(){return this[2]}set z(e){this[2]=d(e);}get alpha(){return this[0]}set alpha(e){this[0]=d(e);}get beta(){return this[1]}set beta(e){this[1]=d(e);}get gamma(){return this[2]}set gamma(e){this[2]=d(e);}get phi(){return this[0]}set phi(e){this[0]=d(e);}get theta(){return this[1]}set theta(e){this[1]=d(e);}get psi(){return this[2]}set psi(e){this[2]=d(e);}get roll(){return this[0]}set roll(e){this[0]=d(e);}get pitch(){return this[1]}set pitch(e){this[1]=d(e);}get yaw(){return this[2]}set yaw(e){this[2]=d(e);}get order(){return this[3]}set order(e){this[3]=function(e){if(e<0&&e>=6)throw new Error(Vt);return e}(e);}fromQuaternion(e){const[t,i,n,r]=e,o=i*i,a=-2*(o+n*n)+1,s=2*(t*i+r*n);let l=-2*(t*n-r*i);l=l>1?1:l,l=l<-1?-1:l;const u=Math.atan2(2*(i*n+r*t),-2*(t*t+o)+1),c=-Math.asin(l),h=-Math.atan2(s,a);return this.set(u,c,h,Ut.RollPitchYaw)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=Number.isFinite(e[3])||this.order,this.check()}set(e,t,i,n=Ut.ZYX){return this[0]=e,this[1]=t,this[2]=i,this[3]=Number.isFinite(n)?n:this[3],this.check()}validate(){return (e=this[3])>=0&&e<6&&Number.isFinite(this[0])&&Number.isFinite(this[1])&&Number.isFinite(this[2]);var e;}toArray(e=[],t=0){return e[t]=this[0],e[t+1]=this[1],e[t+2]=this[2],e}toArray4(e=[],t=0){return e[t]=this[0],e[t+1]=this[1],e[t+2]=this[2],e[t+3]=this[3],e}toVector3(e=new _t){return e[0]=this[0],e[1]=this[1],e[2]=this[2],e}fromVector3(e,t){return this.set(e[0],e[1],e[2],Number.isFinite(t)?t:this[3])}fromArray(e,t=0){return this[0]=e[t],this[1]=e[1+t],this[2]=e[2+t],void 0!==e[3]&&(this[3]=e[3]),this.check()}fromRollPitchYaw(e,t,i){return this.set(e,t,i,Ut.RollPitchYaw)}fromHeadingPitchRoll(e){return this.set(e.pitch,-e.roll,-e.heading,Ut.RollPitchYaw)}fromRotationMatrix(e,t=Ut.DefaultOrder){return this._fromRotationMatrix(e,t),this.check()}getRotationMatrix(){return this._getRotationMatrix()}getQuaternion(){const e=new Et;switch(this[3]){case Ut.XYZ:return e.rotateX(this[0]).rotateY(this[1]).rotateZ(this[2]);case Ut.YXZ:return e.rotateY(this[0]).rotateX(this[1]).rotateZ(this[2]);case Ut.ZXY:return e.rotateZ(this[0]).rotateX(this[1]).rotateY(this[2]);case Ut.ZYX:return e.rotateZ(this[0]).rotateY(this[1]).rotateX(this[2]);case Ut.YZX:return e.rotateY(this[0]).rotateZ(this[1]).rotateX(this[2]);case Ut.XZY:return e.rotateX(this[0]).rotateZ(this[1]).rotateY(this[2]);default:throw new Error(Vt)}}_fromRotationMatrix(e,t=Ut.DefaultOrder){const i=e.elements,n=i[0],r=i[4],o=i[8],a=i[1],s=i[5],u=i[9],c=i[2],h=i[6],d=i[10];switch(t=t||this[3]){case Ut.XYZ:this[1]=Math.asin(l(o,-1,1)),Math.abs(o)<kt?(this[0]=Math.atan2(-u,d),this[2]=Math.atan2(-r,n)):(this[0]=Math.atan2(h,s),this[2]=0);break;case Ut.YXZ:this[0]=Math.asin(-l(u,-1,1)),Math.abs(u)<kt?(this[1]=Math.atan2(o,d),this[2]=Math.atan2(a,s)):(this[1]=Math.atan2(-c,n),this[2]=0);break;case Ut.ZXY:this[0]=Math.asin(l(h,-1,1)),Math.abs(h)<kt?(this[1]=Math.atan2(-c,d),this[2]=Math.atan2(-r,s)):(this[1]=0,this[2]=Math.atan2(a,n));break;case Ut.ZYX:this[1]=Math.asin(-l(c,-1,1)),Math.abs(c)<kt?(this[0]=Math.atan2(h,d),this[2]=Math.atan2(a,n)):(this[0]=0,this[2]=Math.atan2(-r,s));break;case Ut.YZX:this[2]=Math.asin(l(a,-1,1)),Math.abs(a)<kt?(this[0]=Math.atan2(-u,s),this[1]=Math.atan2(-c,n)):(this[0]=0,this[1]=Math.atan2(o,d));break;case Ut.XZY:this[2]=Math.asin(-l(r,-1,1)),Math.abs(r)<kt?(this[0]=Math.atan2(h,s),this[1]=Math.atan2(o,n)):(this[0]=Math.atan2(-u,d),this[1]=0);break;default:throw new Error(Vt)}return this[3]=t,this}_getRotationMatrix(e=new Bt){const t=e,i=this.x,n=this.y,r=this.z,o=Math.cos(i),a=Math.cos(n),s=Math.cos(r),l=Math.sin(i),u=Math.sin(n),c=Math.sin(r);switch(this[3]){case Ut.XYZ:{const e=o*s,i=o*c,n=l*s,r=l*c;t[0]=a*s,t[4]=-a*c,t[8]=u,t[1]=i+n*u,t[5]=e-r*u,t[9]=-l*a,t[2]=r-e*u,t[6]=n+i*u,t[10]=o*a;break}case Ut.YXZ:{const e=a*s,i=a*c,n=u*s,r=u*c;t[0]=e+r*l,t[4]=n*l-i,t[8]=o*u,t[1]=o*c,t[5]=o*s,t[9]=-l,t[2]=i*l-n,t[6]=r+e*l,t[10]=o*a;break}case Ut.ZXY:{const e=a*s,i=a*c,n=u*s,r=u*c;t[0]=e-r*l,t[4]=-o*c,t[8]=n+i*l,t[1]=i+n*l,t[5]=o*s,t[9]=r-e*l,t[2]=-o*u,t[6]=l,t[10]=o*a;break}case Ut.ZYX:{const e=o*s,i=o*c,n=l*s,r=l*c;t[0]=a*s,t[4]=n*u-i,t[8]=e*u+r,t[1]=a*c,t[5]=r*u+e,t[9]=i*u-n,t[2]=-u,t[6]=l*a,t[10]=o*a;break}case Ut.YZX:{const e=o*a,i=o*u,n=l*a,r=l*u;t[0]=a*s,t[4]=r-e*c,t[8]=n*c+i,t[1]=c,t[5]=o*s,t[9]=-l*s,t[2]=-u*s,t[6]=i*c+n,t[10]=e-r*c;break}case Ut.XZY:{const e=o*a,i=o*u,n=l*a,r=l*u;t[0]=a*s,t[4]=-c,t[8]=u*s,t[1]=e*c+r,t[5]=o*s,t[9]=i*c-n,t[2]=n*c-i,t[6]=l*s,t[10]=r*c+e;break}default:throw new Error(Vt)}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}toQuaternion(){const e=Math.cos(.5*this.yaw),t=Math.sin(.5*this.yaw),i=Math.cos(.5*this.roll),n=Math.sin(.5*this.roll),r=Math.cos(.5*this.pitch),o=Math.sin(.5*this.pitch);return new Et(e*n*r-t*i*o,e*i*o+t*n*r,t*i*r-e*n*o,e*i*r+t*n*o)}}Ut.ZYX=0,Ut.YXZ=1,Ut.XZY=2,Ut.ZXY=3,Ut.YZX=4,Ut.XYZ=5,Ut.RollPitchYaw=0,Ut.DefaultOrder=Ut.ZYX;const Gt=6378137,Ht=6378137,Yt=6356752.314245179,qt=6378137,Xt=e=>e;let Wt,jt,$t,Zt,Kt;function Qt(e,t){return Wt||(Wt=new _t),function(e,t,i=Xt){return o(e)?(t[0]=i(e[0]),t[1]=i(e[1]),t[2]=e[2]):"longitude"in e?(t[0]=i(e.longitude),t[1]=i(e.latitude),t[2]=e.height):(t[0]=i(e.x),t[1]=i(e.y),t[2]=e.z),t}(e,t||Wt,a)}function Jt(e,t){return function(e,t,i=Xt){return o(t)?(t[0]=i(e[0]),t[1]=i(e[1]),t[2]=e[2]):"longitude"in t?(t.longitude=i(e[0]),t.latitude=i(e[1]),t.height=e[2]):(t.x=i(e[0]),t.y=i(e[1]),t.z=e[2]),t}(e,t,s)}function ei(e,t,i=new _t){const{oneOverRadii:n,oneOverRadiiSquared:r,centerToleranceSquared:o}=t;jt||(jt=new _t,$t=new _t,Zt=new _t),jt.from(e);const a=e.x,s=e.y,l=e.z,u=n.x,c=n.y,h=n.z,d=a*a*u*u,p=s*s*c*c,f=l*l*h*h,m=d+p+f,_=Math.sqrt(1/m);if(!Number.isFinite(_))return;const g=$t;if(g.copy(e).scale(_),m<o)return g.to(i);const y=r.x,x=r.y,v=r.z,w=Zt;w.set(g.x*y*2,g.y*x*2,g.z*v*2);let T,b,P,S,E=(1-_)*e.len()/(.5*w.len()),A=0;do{E-=A,T=1/(1+E*y),b=1/(1+E*x),P=1/(1+E*v);const e=T*T,t=b*b,i=P*P;S=d*e+p*t+f*i-1,A=S/(-2*(d*(e*T)*y+p*(t*b)*x+f*(i*P)*v));}while(Math.abs(S)>ot.TRANSFORM.EPSILON12);return jt.scale([T,b,P]).to(i)}const ti={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]};let ii,ni,ri,oi,ai,si,li={};function ui(e,t,i,n,r,o){let a,s,l;Kt||(Kt=new _t,li={east:new _t,north:new _t,up:new _t,west:new _t,south:new _t,down:new _t},ii=new _t,ni=new _t,ri=new _t);const c=Kt.copy(r);if(u(c.x,0)&&u(c.y,0)){const e=Math.sign(c.z);a=ii.fromArray(ti[t]),"east"!==t&&"west"!==t&&a.scale(e),s=ni.fromArray(ti[i]),"east"!==i&&"west"!==i&&s.scale(e),l=ri.fromArray(ti[n]),"east"!==n&&"west"!==n&&l.scale(e);}else {const{up:r,east:o,north:u}=li;o.set(-c.y,c.x,0).normalize(),e.geodeticSurfaceNormal(c,r),u.copy(r).cross(o);const{down:h,west:d,south:p}=li;h.copy(r).scale(-1),d.copy(o).scale(-1),p.copy(u).scale(-1),a=li[t],s=li[i],l=li[n];}return o[0]=a.x,o[1]=a.y,o[2]=a.z,o[3]=0,o[4]=s.x,o[5]=s.y,o[6]=s.z,o[7]=0,o[8]=l.x,o[9]=l.y,o[10]=l.z,o[11]=0,o[12]=c.x,o[13]=c.y,o[14]=c.z,o[15]=1,o}function ci(e,t,i,n){e.radii=new _t(t,i,n),e.radiiSquared=new _t(t*t,i*i,n*n),e.radiiToTheFourth=new _t(t*t*t*t,i*i*i*i,n*n*n*n),e.oneOverRadii=new _t(0===t?0:1/t,0===i?0:1/i,0===n?0:1/n),e.oneOverRadiiSquared=new _t(0===t?0:1/(t*t),0===i?0:1/(i*i),0===n?0:1/(n*n)),e.minimumRadius=Math.min(t,i,n),e.maximumRadius=Math.max(t,i,n),e.centerToleranceSquared=ot.TRANSFORM.EPSILON1,0!==e.radiiSquared.z&&(e.squaredXOverSquaredZ=e.radiiSquared.x/e.radiiSquared.z),Object.freeze(this);}class hi{constructor(e=0,t=0,i=0){this._scratchNormal=new _t,this._scratchK=new _t,this._scratchPosition=new _t,this._scratchHeight=new _t,this._scratchCartesian=new _t,this._scratchVector=new _t,ci(this,e,t,i);}equals(e){return this===e||Boolean(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,t=[0,0,0],i){const n=this._scratchNormal,r=this._scratchK,o=e[2];this.geodeticSurfaceNormalCartographic(e,n,i),r.copy(this.radiiSquared).scale(n);const a=Math.sqrt(n.dot(r));return r.multiplyScalar(1/a),n.multiplyScalar(o),r.add(n),r.to(t)}cartographicToCartesianInRadians(e,t=[0,0,0]){const i=this._scratchNormal,n=this._scratchK,[,,r]=e;this.geodeticSurfaceNormalCartographic(e,i,!0),n.copy(this.radiiSquared).scale(i);const o=Math.sqrt(i.dot(n));return n.scale(1/o),i.scale(r),n.add(i),n.to(t)}cartesianToCartographic(e,t=[0,0,0]){this._scratchCartesian.from(e);const i=this.scaleToGeodeticSurface(this._scratchCartesian,this._scratchPosition);if(!i)return;const n=this.geodeticSurfaceNormal(i,this._scratchNormal),r=this._scratchHeight;return r.copy(this._scratchCartesian).subtract(i),Jt([Math.atan2(n.y,n.x),Math.asin(n.z),Math.sign(I(r,this._scratchCartesian))*b(r)],t)}eastNorthUpToFixedFrame(e,t=new Bt){return ui(this,"east","north","up",e,t)}localFrameToFixedFrame(e,t,i,n,r=new Bt){return ui(this,e,t,i,n,r)}geocentricSurfaceNormal(e,t=[0,0,0]){return this._scratchVector.from(e).normalize().to(t)}geodeticSurfaceNormalCartographic(e,t=[0,0,0],i){const n=i?e:Qt(e),r=n[0],o=n[1],a=Math.cos(o);return this._scratchVector.set(a*Math.cos(r),a*Math.sin(r),Math.sin(o)).normalize(),this._scratchVector.to(t)}geodeticSurfaceNormal(e,t=[0,0,0]){return this._scratchVector.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}scaleToGeodeticSurface(e,t){return ei(e,this,t)}scaleToGeocentricSurface(e,t=[0,0,0]){this._scratchPosition.from(e);const i=this._scratchPosition.x,n=this._scratchPosition.y,r=this._scratchPosition.z,o=this.oneOverRadiiSquared,a=1/Math.sqrt(i*i*o.x+n*n*o.y+r*r*o.z);return this._scratchPosition.multiplyScalar(a).to(t)}transformPositionToScaledSpace(e,t=[0,0,0]){return this._scratchPosition.from(e).scale(this.oneOverRadii).to(t)}transformPositionFromScaledSpace(e,t=[0,0,0]){return this._scratchPosition.from(e).scale(this.radii).to(t)}getSurfaceNormalIntersectionWithZAxis(e,t=0,i=[0,0,0]){this._scratchPosition.from(e);const n=this._scratchPosition.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-t))return this._scratchPosition.set(0,0,n).to(i)}static fromCartesian3(e,t){return ci(t,e.x,e.y,e.z),t}static clone(e){return new hi(e.radii.x,e.radii.y,e.radii.z)}static get WGS84(){return oi=oi||new hi(Gt,Ht,Yt),oi}static get RegularEllipsoid(){return ai=ai||new hi(Gt,Ht,qt),ai}static get UNIT_SPHERE(){return si=si||new hi(1,1,1),si}}class di{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]));}setNorthEast(e){return this._ne=e instanceof fi?new fi(e.lng,e.lat):fi.convert(e),this}setSouthWest(e){return this._sw=e instanceof fi?new fi(e.lng,e.lat):fi.convert(e),this}extend(e){const t=this._sw,i=this._ne;let n,r;if(e instanceof fi)n=e,r=e;else {if(!(e instanceof di))return Array.isArray(e)?e.every(Array.isArray)?this.extend(di.convert(e)):this.extend(fi.convert(e)):this;if(n=e._sw,r=e._ne,!n||!r)return this}return t||i?(t.lng=Math.min(n.lng,t.lng),t.lat=Math.min(n.lat,t.lat),i.lng=Math.max(r.lng,i.lng),i.lat=Math.max(r.lat,i.lat)):(this._sw=new fi(n.lng,n.lat),this._ne=new fi(r.lng,r.lat)),this}getCenter(){return new fi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new fi(this.getWest(),this.getNorth())}getSouthEast(){return new fi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return [this._sw.toArray(),this._ne.toArray()]}toString(){return `LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return !(this._sw&&this._ne)}contains(e){const{lng:t,lat:i}=fi.convert(e);let n=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&n}static convert(e){return !e||e instanceof di?e:new di(e)}}const pi=ot.TRANSFORM.R;class fi{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);this.lng=+e,this.lat=+t,(this.lat>90||this.lat<-90)&&(this.lat=function(e){return e>90?90:e<-90?-90:e}(this.lat));}wrap(){return new fi(Be(this.lng,-180,180),this.lat)}toArray(){return [this.lng,this.lat]}toString(){return `LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,i=this.lat*t,n=e.lat*t,r=Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos((e.lng-this.lng)*t);return pi*Math.acos(Math.min(r,1))}toBounds(e=0){const t=360*e/40075017,i=t/Math.cos(Math.PI/180*this.lat);return new di(new fi(this.lng-i,this.lat-t),new fi(this.lng+i,this.lat+t))}static convert(e){if(e instanceof fi)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new fi(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new fi(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}static equals(e,t){return e.lng===t.lng&&e.lat===t.lat}}const mi={LATLON:"LATLON",MERCATOR:"MERCATOR"},_i={R:ot.TRANSFORM.R,CIR:ot.TRANSFORM.CIR,projectType:"LATLON",project(e){return new te(this.lngX(e.lng,this.CIR),this.latY(e.lat,this.CIR))},unproject(e){return new fi(this.xLng(e.x,this.CIR),this.yLat(e.y,this.CIR))},projectWithWorldSize(e,t){return new te(this.lngX(e.lng,t),this.latY(e.lat,t))},unprojectWithWorldSize(e,t){return new fi(this.xLng(e.x,t),this.yLat(e.y,t))},lngX:(e,t)=>(180+e)*t/360,latY:(e,t)=>(90-e)/180*t*.5,xLng:(e,t)=>360*e/t-180,yLat:(e,t)=>90-e/(.5*t)*180,tileNumberToLngLat(e,t,i){return new fi(this.xLng(e[0]*t,i),this.yLat(e[1]*t,i))},lngLatToTileNumber(e,t,i){return [this.lngX(e.lng,i)/t,this.latY(e.lat,i)/t]}},gi={R:ot.TRANSFORM.R,CIR:ot.TRANSFORM.CIR,projectType:"MERCATOR",project(e){return new te(this.lngX(e.lng,this.CIR),this.latY(e.lat,this.CIR))},unproject(e){return new fi(this.xLng(e.x,this.CIR),this.yLat(e.y,this.CIR))},projectWithWorldSize(e,t){return new te(this.lngX(e.lng,t),this.latY(e.lat,t))},unprojectWithWorldSize(e,t){return new fi(this.xLng(e.x,t),this.yLat(e.y,t))},lngX:(e,t)=>(180+e)*t/360,latY:(e,t)=>(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))*t/360,xLng:(e,t)=>360*e/t-180,yLat:(e,t)=>360/Math.PI*Math.atan(Math.exp((180-360*e/t)*Math.PI/180))-90,tileNumberToLngLat(e,t,i){return new fi(this.xLng(e[0]*t,i),this.yLat(e[1]*t,i))},lngLatToTileNumber(e,t,i){return [this.lngX(e.lng,i)/t,this.latY(e.lat,i)/t]}};function yi(e){return e===mi.LATLON?_i:gi}const xi={lngX:(e,t,i)=>yi(i).lngX(e,t),lngXRoundZoom:(e,t,i)=>yi(i).lngX(e,Math.pow(2,Math.floor(t))),latY:(e,t,i)=>yi(i).latY(e,t),latYRoundZoom:(e,t,i)=>yi(i).latY(e,Math.pow(2,Math.floor(t))),xLng:(e,t,i)=>yi(i).xLng(e,t),yLat:(e,t,i)=>yi(i).yLat(e,t)},vi={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class wi{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8;}}class Ti{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0);}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews());}clear(){this.length=0;}resize(e){this.reserve(e),this.length=e;}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t);}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function bi(e,t=1){let i=0,n=0;return {members:e.map((e=>{const r=vi[e.type].BYTES_PER_ELEMENT,o=i=Pi(i,Math.max(t,r)),a=e.components||1;return n=Math.max(n,r),i+=r*a,{name:e.name,type:e.type,components:a,offset:o}})),size:Pi(i,Math.max(n,t)),alignment:t}}function Pi(e,t){return Math.ceil(e/t)*t}var Si=Ai,Ei=3;function Ai(e,t,i){var n=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var r=new Int32Array(this.arrayBuffer);e=r[0],this.d=(t=r[1])+2*(i=r[2]);for(var o=0;o<this.d*this.d;o++){var a=r[Ei+o],s=r[Ei+o+1];n.push(a===s?null:r.subarray(a,s));}var l=r[Ei+n.length+1];this.keys=r.subarray(r[Ei+n.length],l),this.bboxes=r.subarray(l),this.insert=this._insertReadonly;}else {this.d=t+2*i;for(var u=0;u<this.d*this.d;u++)n.push([]);this.keys=[],this.bboxes=[];}this.n=t,this.extent=e,this.padding=i,this.scale=t/e,this.uid=0;var c=i/t*e;this.min=-c,this.max=e+c;}Ai.prototype.insert=function(e,t,i,n,r){this._forEachCell(t,i,n,r,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r);},Ai.prototype._insertReadonly=function(){throw "Cannot insert into a GridIndex created from an ArrayBuffer."},Ai.prototype._insertCell=function(e,t,i,n,r,o){this.cells[r].push(o);},Ai.prototype.query=function(e,t,i,n,r){var o=this.min,a=this.max;if(e<=o&&t<=o&&a<=i&&a<=n&&!r)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(e,t,i,n,this._queryCell,s,{},r),s},Ai.prototype._queryCell=function(e,t,i,n,r,o,a,s){var l=this.cells[r];if(null!==l)for(var u=this.keys,c=this.bboxes,h=0;h<l.length;h++){var d=l[h];if(void 0===a[d]){var p=4*d;(s?s(c[p+0],c[p+1],c[p+2],c[p+3]):e<=c[p+2]&&t<=c[p+3]&&i>=c[p+0]&&n>=c[p+1])?(a[d]=!0,o.push(u[d])):a[d]=!1;}}},Ai.prototype._forEachCell=function(e,t,i,n,r,o,a,s){for(var l=this._convertToCellCoord(e),u=this._convertToCellCoord(t),c=this._convertToCellCoord(i),h=this._convertToCellCoord(n),d=l;d<=c;d++)for(var p=u;p<=h;p++){var f=this.d*p+d;if((!s||s(this._convertFromCellCoord(d),this._convertFromCellCoord(p),this._convertFromCellCoord(d+1),this._convertFromCellCoord(p+1)))&&r.call(this,e,t,i,n,f,o,a,s))return}},Ai.prototype._convertFromCellCoord=function(e){return (e-this.padding)/this.scale},Ai.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Ai.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=Ei+this.cells.length+1+1,i=0,n=0;n<this.cells.length;n++)i+=this.cells[n].length;var r=new Int32Array(t+i+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var o=t,a=0;a<e.length;a++){var s=e[a];r[Ei+a]=o,r.set(s,o),o+=s.length;}return r[Ei+e.length]=o,r.set(this.keys,o),r[Ei+e.length+1]=o+=this.keys.length,r.set(this.bboxes,o),o+=this.bboxes.length,r.buffer};const Ci={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Mi(e){return (e=Math.round(e))<0?0:e>255?255:e}function Ii(e){return e<0?0:e>1?1:e}function Li(e){return Mi("%"===e[e.length-1]?Number(e.slice(0,-1))/100*255:Number(e))}function Ni(e){return "%"!==e[e.length-1]?null:Ii(Number(e.slice(0,-1))/100)}function Ri(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}function Oi(e){return e<48?NaN:e<=57?e-48:e<97?NaN:e<=102?e-87:NaN}const Di=new Set([" ","\t","\n","\r",",","/"]);function Fi(e){const t=e.trim().toLowerCase();if(t in Ci)return Ci[t].slice();if("#"===t[0]){const e=4===t.length||5===t.length;if(!e&&7!==t.length&&9!==t.length)return null;const i=e?1:2,n=[0,0,0,255],r=5===t.length||9===t.length?4:3;for(let o=0;o<r;o++){const r=Oi(t.charCodeAt(o*i+1));if(n[o]=16*r+(e?r:Oi(t.charCodeAt(o*i+2))),Number.isNaN(n[o]))return null}return n[3]/=255,n}const i=t.indexOf("(");let n=t.indexOf(")");if(-1===n&&(n=t.length),-1!==i&&(n+1===t.length||n===t.length)){const e=t.substr(0,i),r=[];let o="";for(let e=i+1;e<n;e++)Di.has(t[e])?0!==o.length&&(r.push(o),o=""):o+=t[e];0!==o.length&&r.push(o);const a=4===r.length?function(e){return Ni(e)??Ii(Number(e))}(r.pop()):1;if(3!==r.length)return null;let s,l,u,c,h,d;switch(e){case"rgba":case"rgb":return d=[...r.map(Li),a],d.some(Number.isNaN)?null:d;case"hsla":case"hsl":return s=(function(e){return e.endsWith("deg")?Number(e.slice(0,-3)):e.endsWith("grad")?360*Number(e.slice(0,-4))/400:e.endsWith("rad")?360*Number(e.slice(0,-3))/(2*Math.PI):e.endsWith("turn")?360*Number(e.slice(0,-4)):Number(e)}(r[0])%360+360)%360/360,Number.isNaN(s)?null:(l=Ni(r[1]),Number.isNaN(l)||null===l?null:(u=Ni(r[2]),Number.isNaN(u)||null===u?null:(h=u<=.5?u*(l+1):u+l-u*l,c=2*u-h,[Mi(255*Ri(c,h,s+1/3)),Mi(255*Ri(c,h,s)),Mi(255*Ri(c,h,s-1/3)),a])));default:return null}}return null}class zi{constructor(e,t,i,n=1){this.r=e,this.g=t,this.b=i,this.a=n;}set(e){this.r=e[0],this.g=e[1],this.b=e[2],this.a=e[3];}toBytes(e){const t=zi.floatToByte(this.r),i=zi.floatToByte(this.g),n=zi.floatToByte(this.b),r=zi.floatToByte(this.a);return $(e)?(e[0]=t,e[1]=i,e[2]=n,e[3]=r,e):[t,i,n,r]}static equals(e,t){return e===t||$(e)&&$(t)&&e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}static parse(e){if(!e)return;if(e instanceof zi)return e;if(Array.isArray(e))return new zi(...e);if(e instanceof _t)return new zi(e[0],e[1],e[2]);if(e instanceof St)return new zi(e[0],e[1],e[2],e[3]);if("string"!=typeof e)return;const t=Fi(e);return t?new zi(t[0]/255,t[1]/255,t[2]/255,t[3]):void 0}toString(){const[e,t,i,n]=this.toArray();return `rgba(${Math.round(e)},${Math.round(t)},${Math.round(i)},${n})`}toArray(){const{r:e,g:t,b:i,a:n}=this;return 0===n?[0,0,0,0]:[255*e/n,255*t/n,255*i/n,n]}toArrayFloat(){const{r:e,g:t,b:i,a:n}=this;return 0===n?[0,0,0,0]:[e/n,t/n,i/n,n]}toVector3(){const{r:e,g:t,b:i}=this;return new _t(e,t,i)}toVector4(){return new St(this.r,this.g,this.b,this.a)}static floatToByte(e){return 1===e?255:256*e|0}static byteToFloat(e){return e/255}toRgba(){return ki[0]=zi.floatToByte(this.r),ki[1]=zi.floatToByte(this.g),ki[2]=zi.floatToByte(this.b),ki[3]=zi.floatToByte(this.a),Vi[0]}static toHex(e){return function(e){const t=e.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),i=parseFloat(t[3]||1),n=Math.floor(i*parseInt(t[0])+255*(1-i)),r=Math.floor(i*parseInt(t[1])+255*(1-i)),o=Math.floor(i*parseInt(t[2])+255*(1-i));return `#${`0${n.toString(16)}`.slice(-2)}${`0${r.toString(16)}`.slice(-2)}${`0${o.toString(16)}`.slice(-2)}`.toLocaleUpperCase()}(this.parse(e).toString())}static fromRgba(e,t){return Vi[0]=e,zi.fromBytes(ki[0],ki[1],ki[2],ki[3],t)}static fromBytes(e,t,i,n,r){return e=zi.byteToFloat(Z(e,255)),t=zi.byteToFloat(Z(t,255)),i=zi.byteToFloat(Z(i,255)),n=zi.byteToFloat(Z(n,255)),$(r)?(r.r=e,r.g=t,r.b=i,r.a=n,r):new zi(e,t,i,n)}static pack(e,t,i){return i=Z(i,0),t[i++]=e.r,t[i++]=e.g,t[i++]=e.b,t[i]=e.a,t}static unpack(e,t,i){return t=Z(t,0),$(i)||(i=new zi),i.r=e[t++],i.g=e[t++],i.b=e[t++],i.a=e[t],i}static clone(e,t){if($(e))return $(t)?(t.r=e.r,t.g=e.g,t.b=e.b,t.a=e.a,t):new zi(e.r,e.g,e.b,e.a)}copy(e){this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a;}}const Bi=new ArrayBuffer(4),Vi=new Uint32Array(Bi),ki=new Uint8Array(Bi);zi.black=new zi(0,0,0,1),zi.white=new zi(1,1,1,1),zi.transparent=new zi(0,0,0,0),zi.packedLength=4;var Ui=zi;function Gi(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}class Hi extends Error{constructor(e,t){super(t),this.message=t,this.key=e;}}var Yi=Hi;class qi{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,i]of t)this.bindings[e]=i;}concat(e){return new qi(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return !!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Xi=qi;const Wi={kind:"null"},ji={kind:"number"},$i={kind:"string"},Zi={kind:"boolean"},Ki={kind:"color"},Qi={kind:"object"},Ji={kind:"value"},en={kind:"collator"},tn={kind:"formatted"},nn={kind:"resolvedImage"};function rn(e,t){return {kind:"array",itemType:e,N:t}}function on(e){if("array"===e.kind){const t=on(e.itemType);return "number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const an=[Wi,ji,$i,Zi,Ki,tn,Qi,rn(Ji),nn];function sn(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!sn(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else {if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of an)if(!sn(e,t))return null}return `Expected ${on(e)} but found ${on(t)} instead.`}function ln(e,t){return t.some((t=>t.kind===e.kind))}function un(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}class cn{constructor(e,t,i){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"});}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class hn{constructor(e,t,i){this.type=en,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=t;}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const i=e[1];if("object"!=typeof i||Array.isArray(i))return t.error("Collator options argument must be an object.");const n=t.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,Zi);if(!n)return null;const r=t.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,Zi);if(!r)return null;let o=null;return i.locale&&(o=t.parse(i.locale,1,$i),!o)?null:new hn(n,r,o)}evaluate(e){return new cn(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale);}possibleOutputs(){return [void 0]}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var dn={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519};function pn(e){for(const t of e)if(mn(t.charCodeAt(0)))return !0;return !1}function fn(e){return !(dn.Arabic(e)||dn["Arabic Supplement"](e)||dn["Arabic Extended-A"](e)||dn["Arabic Presentation Forms-A"](e)||dn["Arabic Presentation Forms-B"](e))}function mn(e){return !(746!==e&&747!==e&&(e<4352||!(dn["Bopomofo Extended"](e)||dn.Bopomofo(e)||dn["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||dn["CJK Compatibility Ideographs"](e)||dn["CJK Compatibility"](e)||dn["CJK Radicals Supplement"](e)||dn["CJK Strokes"](e)||!(!dn["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||dn["CJK Unified Ideographs Extension A"](e)||dn["CJK Unified Ideographs"](e)||dn["Enclosed CJK Letters and Months"](e)||dn["Hangul Compatibility Jamo"](e)||dn["Hangul Jamo Extended-A"](e)||dn["Hangul Jamo Extended-B"](e)||dn["Hangul Jamo"](e)||dn["Hangul Syllables"](e)||dn.Hiragana(e)||dn["Ideographic Description Characters"](e)||dn.Kanbun(e)||dn["Kangxi Radicals"](e)||dn["Katakana Phonetic Extensions"](e)||dn.Katakana(e)&&12540!==e||!(!dn["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!dn["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||dn["Unified Canadian Aboriginal Syllabics"](e)||dn["Unified Canadian Aboriginal Syllabics Extended"](e)||dn["Vertical Forms"](e)||dn["Yijing Hexagram Symbols"](e)||dn["Yi Syllables"](e)||dn["Yi Radicals"](e))))}function _n(e){return !(mn(e)||function(e){return !!(dn["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||dn["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||dn["Letterlike Symbols"](e)||dn["Number Forms"](e)||dn["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||dn["Control Pictures"](e)&&9251!==e||dn["Optical Character Recognition"](e)||dn["Enclosed Alphanumerics"](e)||dn["Geometric Shapes"](e)||dn["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||dn["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||dn["CJK Symbols and Punctuation"](e)||dn.Katakana(e)||dn["Private Use Area"](e)||dn["CJK Compatibility Forms"](e)||dn["Small Form Variants"](e)||dn["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function gn(e){return e>=1424&&e<=2303||dn["Arabic Presentation Forms-A"](e)||dn["Arabic Presentation Forms-B"](e)}function yn(e,t){return !(!t&&gn(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||dn.Khmer(e))}function xn(e){for(const t of e)if(gn(t.charCodeAt(0)))return !0;return !1}class vn{constructor(e,t,i){this.text="string"==typeof e?e:e.toString(),this.scale=t,this.fontStack=i;}}class wn{constructor(e){this.sections=e;}static fromString(e){return new wn([new vn(e,null,null,null)])}static factory(e){return e instanceof wn?e:wn.fromString(e)}toString(){return this.sections.map((e=>e.text)).join("")}containsRTLText(){for(const e of this.sections)if(xn(e.text))return !0;return !1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.text);const i=t.fontStack?["literal",t.fontStack.split(",")]:null;e.push({"text-font":i,"font-scale":t.scale});}return e}}class Tn{constructor(e){this.name=e.name,this.available=e.available;}toString(){return this.name}static fromString(e){return e?new Tn({name:e,available:!1}):null}serialize(){return ["image",this.name]}}function bn(e,t,i,n){return "number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[e,t,i,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof n?[e,t,i,n]:[e,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Pn(e){if(null===e)return !0;if("string"==typeof e)return !0;if("boolean"==typeof e)return !0;if("number"==typeof e)return !0;if(e instanceof Ui)return !0;if(e instanceof cn)return !0;if(e instanceof wn)return !0;if(e instanceof Tn)return !0;if(Array.isArray(e)){for(const t of e)if(!Pn(t))return !1;return !0}if("object"==typeof e){for(const t in e)if(!Pn(e[t]))return !1;return !0}return !1}function Sn(e){if(null===e)return Wi;if("string"==typeof e)return $i;if("boolean"==typeof e)return Zi;if("number"==typeof e)return ji;if(e instanceof Ui)return Ki;if(e instanceof cn)return en;if(e instanceof wn)return tn;if(e instanceof Tn)return nn;if(Array.isArray(e)){const t=e.length;let i;for(const t of e){const e=Sn(t);if(i){if(i===e)continue;i=Ji;break}i=e;}return rn(i||Ji,t)}return Qi}function En(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof Ui||e instanceof wn||e instanceof Tn?e.toString():JSON.stringify(e)}class An{constructor(e,t){this.type=e,this.value=t;}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Pn(e[1]))return t.error("invalid value");const i=e[1];let n=Sn(i);const r=t.expectedType;return "array"!==n.kind||0!==n.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(n=r),new An(n,i)}evaluate(){return this.value}eachChild(){}possibleOutputs(){return [this.value]}serialize(){return "array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Ui?["rgba"].concat(this.value.toArray()):this.value instanceof wn?this.value.serialize():this.value}}var Cn=An,Mn=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e;}toJSON(){return this.message}};const In={string:$i,number:ji,boolean:Zi,object:Qi};class Ln{constructor(e,t){this.type=e,this.args=t;}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=In[e[0]],n=[];for(let i=1;i<e.length;i++){const r=t.parse(e[i],i,Ji);if(!r)return null;n.push(r);}return new Ln(i,n)}evaluate(e){for(let t=0;t<this.args.length;t++){const i=this.args[t].evaluate(e);if(!sn(this.type,Sn(i)))return i;if(t===this.args.length-1)throw new Mn(`Expected value to be of type ${on(this.type)}, but found ${on(Sn(i))} instead.`)}return null}eachChild(e){this.args.forEach(e);}possibleOutputs(){return [].concat(...this.args.map((e=>e.possibleOutputs())))}serialize(){return [this.type.kind].concat(this.args.map((e=>e.serialize())))}}var Nn=Ln;const Rn={string:$i,number:ji,boolean:Zi};class On{constructor(e,t){this.type=e,this.input=t;}static parse(e,t){if(e.length<2||e.length>4)return t.error(`Expected 1, 2, or 3 arguments, but found ${e.length-1} instead.`);let i,n;if(e.length>2){const n=e[1];if("string"!=typeof n||!(n in Rn))return t.error('The item type argument of "array" must be one of string, number, boolean',1);i=Rn[n];}else i=Ji;if(e.length>3){if("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2]))return t.error('The length argument to "array" must be a positive integer literal',2);n=e[2];}const r=rn(i,n),o=t.parse(e[e.length-1],e.length-1,Ji);return o?new On(r,o):null}evaluate(e){const t=this.input.evaluate(e);if(sn(this.type,Sn(t)))throw new Mn(`Expected value to be of type ${on(this.type)}, but found ${on(Sn(t))} instead.`);return t}eachChild(e){e(this.input);}possibleOutputs(){return this.input.possibleOutputs()}serialize(){const e=["array"],t=this.type.itemType;if("string"===t.kind||"number"===t.kind||"boolean"===t.kind){e.push(t.kind);const i=this.type.N;"number"==typeof i&&e.push(i);}return e.push(this.input.serialize()),e}}var Dn=On;function Fn(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}const zn={"to-boolean":Zi,"to-color":Ki,"to-number":ji,"to-string":$i};class Bn{constructor(e,t){this.type=e,this.args=t;}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[0],n=[];let r=Wi;if("to-array"===i){if(!Array.isArray(e[1]))return null;const i=e[1].length;if(t.expectedType){if("array"!==t.expectedType.kind)return t.error(`Expected ${t.expectedType.kind} but found array.`);r=rn(t.expectedType.itemType,i);}else {if(!(i>0&&Pn(e[1][0])))return null;r=rn(Sn(e[1][0]),i);}for(let o=0;o<i;o++){const i=e[1][o];let a;if("array"===Fn(i))a=t.parse(i,void 0,r.itemType);else {const e=Fn(i);if(e!==r.itemType.kind)return t.error(`Expected ${r.itemType.kind} but found ${e}.`);a=t.registry.literal.parse(["literal",void 0===i?null:i],t);}if(!a)return null;n.push(a);}}else {if(("to-boolean"===i||"to-string"===i)&&2!==e.length)return t.error("Expected one argument.");r=zn[i];for(let i=1;i<e.length;i++){const r=t.parse(e[i],i,Ji);if(!r)return null;n.push(r);}}return new Bn(r,n)}evaluate(e){if("color"===this.type.kind){let t,i;for(const n of this.args)if(t=n.evaluate(e),i=null,"string"==typeof t){const i=e.parseColor(t);if(i)return i}else if(Array.isArray(t)&&(i=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:bn(t[0],t[1],t[2],t[3]),!i))return new Ui(t[0]/255,t[1]/255,t[2]/255,t[3]);throw new Mn(i||`Could not parse color from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}if("formatted"===this.type.kind)return wn.fromString(En(this.args[0].evaluate(e)));if("resolvedImage"===this.type.kind)return Tn.fromString(En(this.args[0].evaluate(e)));{let t=null;for(const i of this.args){if(t=i.evaluate(e),null===t)continue;const n=Number(t);if(!isNaN(n))return n}throw new Mn(`Could not convert ${JSON.stringify(t)} to number.`)}}eachChild(e){this.args.forEach(e);}possibleOutputs(){return [].concat(...this.args.map((e=>e.possibleOutputs())))}serialize(){const e=[`to-${this.type.kind}`];return this.eachChild((t=>{e.push(t.serialize());})),e}}var Vn=Bn;const kn=["Unknown","Point","LineString","Polygon"];var Un=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null;}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?this.feature._feature?"number"==typeof this.feature._feature.type?kn[this.feature._feature.type]:this.feature._feature.type:"number"==typeof this.feature.type?kn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&this.feature.hasOwnProperty("geometry")?this.feature.geometry:this.feature&&this.feature._feature&&this.feature._feature.hasOwnProperty("geometry")?this.feature._feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Ui.parse(e)),t}};class Gn{constructor(e,t,i,n){this.name=e,this.type=t,this._evaluate=i,this.args=n;}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e);}possibleOutputs(){return [void 0]}serialize(){return [this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const i=e[0],n=Gn.definitions[i];if(!n)return t.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const r=Array.isArray(n)?n[0]:n.type,o=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,a=o.filter((([t])=>!Array.isArray(t)||t.length===e.length-1)),s=[];for(let i=1;i<e.length;i++){const n=e[i];let r;if(1===a.length){const e=a[0][0];r=Array.isArray(e)?e[i-1]:e.type;}const o=t.parse(n,1+s.length,r);if(!o)return null;s.push(o);}let l=null;for(const[e,n]of a)if(l=new fr(t.registry,t.path,null,t.scope),Array.isArray(e)&&e.length!==s.length)l.error(`Expected ${e.length} arguments, but found ${s.length} instead.`);else {for(let t=0;t<s.length;t++){const i=Array.isArray(e)?e[t]:e.type,n=s[t];l.concat(t+1).checkSubtype(i,n.type);}if(0===l.errors.length)return new Gn(i,r,n,s)}if(1===a.length)t.errors.push.apply(t.errors,l.errors);else {const e=(a.length?a:o).map((([e])=>{return t=e,Array.isArray(t)?`(${t.map(on).join(", ")})`:`(${on(t.type)}...)`;var t;})).join(" | "),i=s.map((e=>on(e.type))).join(", ");t.error(`Expected arguments of type ${e}, but found (${i}) instead.`);}return null}static register(e,t){Gn.definitions=t;for(const i in t)e[i]=Gn;}}var Hn=Gn;const Yn=8192;function qn(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1]);}function Xn(e,t){return !(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Wn(e,t){const i=(180+e[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,r=Math.pow(2,t.z);return [Math.round(i*r*Yn),Math.round(n*r*Yn)]}function jn(e,t,i){const n=e[0]-t[0],r=e[1]-t[1],o=e[0]-i[0],a=e[1]-i[1];return n*a-o*r==0&&n*o<=0&&r*a<=0}function $n(e,t){let i=!1;for(let a=0,s=t.length;a<s;a++){const s=t[a];for(let t=0,a=s.length;t<a-1;t++){if(jn(e,s[t],s[t+1]))return !1;(r=s[t])[1]>(n=e)[1]!=(o=s[t+1])[1]>n[1]&&n[0]<(o[0]-r[0])*(n[1]-r[1])/(o[1]-r[1])+r[0]&&(i=!i);}}var n,r,o;return i}function Zn(e,t){for(let i=0;i<t.length;i++)if($n(e,t[i]))return !0;return !1}function Kn(e,t,i,n){const r=n[0]-i[0],o=n[1]-i[1],a=(e[0]-i[0])*o-r*(e[1]-i[1]),s=(t[0]-i[0])*o-r*(t[1]-i[1]);return a>0&&s<0||a<0&&s>0}function Qn(e,t,i){for(const u of i)for(let i=0;i<u.length-1;++i)if(0!=(s=[(a=u[i+1])[0]-(o=u[i])[0],a[1]-o[1]])[0]*(l=[(r=t)[0]-(n=e)[0],r[1]-n[1]])[1]-s[1]*l[0]&&Kn(n,r,o,a)&&Kn(o,a,n,r))return !0;var n,r,o,a,s,l;return !1}function Jn(e,t){for(let i=0;i<e.length;++i)if(!$n(e[i],t))return !1;for(let i=0;i<e.length-1;++i)if(Qn(e[i],e[i+1],t))return !1;return !0}function er(e,t){for(let i=0;i<t.length;i++)if(Jn(e,t[i]))return !0;return !1}function tr(e,t,i){const n=[];for(let r=0;r<e.length;r++){const o=[];for(let n=0;n<e[r].length;n++){const a=Wn(e[r][n],i);qn(t,a),o.push(a);}n.push(o);}return n}function ir(e,t,i){const n=[];for(let r=0;r<e.length;r++){const o=tr(e[r],t,i);n.push(o);}return n}function nr(e,t,i,n){if(e[0]<i[0]||e[0]>i[2]){const t=.5*n;let r=e[0]-i[0]>t?-n:i[0]-e[0]>t?n:0;0===r&&(r=e[0]-i[2]>t?-n:i[2]-e[0]>t?n:0),e[0]+=r;}qn(t,e);}function rr(e,t,i,n){const r=Math.pow(2,n.z)*Yn,o=[n.x*Yn,n.y*Yn],a=[];for(const n of e)if(n.length)for(let e=0;e<n.length;e++){let s;s=n[e].x?[n[e].x+o[0],n[e].y+o[1]]:[n[e]+o[0],n[e]+o[1]],nr(s,t,i,r),a.push(s);}else for(const e of n){const n=[e.x+o[0],e.y+o[1]];nr(n,t,i,r),a.push(n);}return a}function or(e,t,i,n){const r=Math.pow(2,n.z)*Yn,o=[n.x*Yn,n.y*Yn],a=[];for(const i of e){const e=[];if(i.length)for(let n=0;n<i.length;n++){const r=[i[n][0]+o[0],i[n][1]+o[1]];qn(t,r),e.push(r);}else for(const n of i){const i=[n.x+o[0],n.y+o[1]];qn(t,i),e.push(i);}a.push(e);}if(t[2]-t[0]<=r/2){!function(e){e[0]=e[1]=1/0,e[2]=e[3]=-1/0;}(t);for(const e of a)for(const n of e)nr(n,t,i,r);}return a}class ar{constructor(e,t){this.type=Zi,this.geojson=e,this.geometries=t;}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Pn(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const i=t.features[e].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new ar(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new ar(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new ar(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if("Polygon"===t.type){const o=tr(t.coordinates,n,r),a=rr(e.geometry(),i,n,r);if(!Xn(i,n))return !1;for(const e of a)if(!$n(e,o))return !1}if("MultiPolygon"===t.type){const o=ir(t.coordinates,n,r),a=rr(e.geometry(),i,n,r);if(!Xn(i,n))return !1;for(const e of a)if(!Zn(e,o))return !1}return !0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if("Polygon"===t.type){const o=tr(t.coordinates,n,r),a=or(e.geometry(),i,n,r);if(!Xn(i,n))return !1;for(const e of a)if(!Jn(e,o))return !1}if("MultiPolygon"===t.type){const o=ir(t.coordinates,n,r),a=or(e.geometry(),i,n,r);if(!Xn(i,n))return !1;for(const e of a)if(!er(e,o))return !1}return !0}(e,this.geometries)}return !1}eachChild(){}possibleOutputs(){return [void 0]}serialize(){return ["within",this.geojson]}}var sr=ar;function lr(e){if(e instanceof Hn){if("get"===e.name&&1===e.args.length)return !1;if("feature-state"===e.name)return !1;if("has"===e.name&&1===e.args.length)return !1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return !1;if(/^filter-/.test(e.name))return !1}if(e instanceof sr)return !1;let t=!0;return e.eachChild((e=>{t&&!lr(e)&&(t=!1);})),t}function ur(e){if(e instanceof Hn&&"feature-state"===e.name)return !1;let t=!0;return e.eachChild((e=>{t&&!ur(e)&&(t=!1);})),t}function cr(e,t){if(e instanceof Hn&&t.indexOf(e.name)>=0)return !1;let i=!0;return e.eachChild((e=>{i&&!cr(e,t)&&(i=!1);})),i}class hr{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t;}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const i=e[1];return t.scope.has(i)?new hr(i,t.scope.get(i)):t.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}possibleOutputs(){return [void 0]}serialize(){return ["var",this.name]}}var dr=hr;class pr{constructor(e,t=[],i,n=new Xi,r=[],o){this.registry=e,this.path=t,this.key=t.map((e=>`[${e}]`)).join(""),this.scope=n,this.errors=r,this.expectedType=i,this.options=o;}parse(e,t,i,n,r={}){return t||i?this.concat(t,i,n)._parse(e,r):this._parse(e,r)}_parse(e,t){function i(e,t,i){return "assert"===i?new Nn(t,[e]):"coerce"===i?new Vn(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n="string"==typeof e[0]?this.registry[e[0]]:void 0;if(n){let r=n.parse(e,this);if(!r)return null;if(this.expectedType){const e=this.expectedType,n=r.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==n.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==n.kind&&"string"!==n.kind){if(this.checkSubtype(e,n))return null}else r=i(r,e,t.typeAnnotation||"coerce");else r=i(r,e,t.typeAnnotation||"assert");}if(!(r instanceof Cn)&&"resolvedImage"!==r.type.kind&&mr(r)){const e=new Un(this.options);try{r=new Cn(r.type,r.evaluate(e));}catch(e){return this.error(e.message),null}}return r}return Vn.parse(["to-array",e],this)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,i){const n="number"==typeof e?this.path.concat(e):this.path,r=i?this.scope.concat(i):this.scope;return new pr(this.registry,n,t||null,r,this.errors,this.options)}error(e,...t){const i=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new Yi(i,e));}checkSubtype(e,t){const i=sn(e,t);return i&&this.error(i),i}}var fr=pr;function mr(e){if(e instanceof dr)return mr(e.boundExpression);if(e instanceof Hn&&"error"===e.name)return !1;if(e instanceof Hn&&"config"===e.name)return !1;if(e instanceof hn)return !1;if(e instanceof sr)return !1;const t=e instanceof Vn||e instanceof Nn||e instanceof Dn;let i=!0;return e.eachChild((e=>{i=t?i&&mr(e):i&&e instanceof Cn;})),!!i&&lr(e)&&cr(e,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function _r(e,t){let i,n,r=0,o=e.length-1,a=0;for(;r<=o;){if(a=Math.floor((r+o)/2),i=e[a],n=e[a+1],t===i||t>i&&t<n)return a;if(i<t)r=a+1;else {if(!(i>t))throw new Mn("Input is not a number.");o=a-1;}}return Math.max(a-1,0)}class gr{constructor(e,t,i){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of i)this.labels.push(e),this.outputs.push(t);}static parse(e,t){let[,i,...n]=e;if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(i=t.parse(i,1,ji),!i)return null;const r=[];let o=null;t.expectedType&&"value"!==t.expectedType.kind&&(o=t.expectedType),n.unshift(-1/0);for(let e=0;e<n.length;e+=2){const i=n[e],a=n[e+1],s=e+1,l=e+2;if("number"!=typeof i)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(r.length&&r[r.length-1][0]>=i)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',s);const u=t.parse(a,l,o);if(!u)return null;o=o||u.type,r.push([i,u]);}return new gr(o,i,r)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return i[0].evaluate(e);const r=t.length;return n>=t[r-1]?i[r-1].evaluate(e):i[_r(t,n)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t);}possibleOutputs(){return [].concat(...this.outputs.map((e=>e.possibleOutputs())))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var yr=gr;function xr(e,t,i){return e*(1-i)+t*i}var vr=Object.freeze({__proto__:null,number:xr,color:function(e,t,i){return new Ui(xr(e.r,t.r,i),xr(e.g,t.g,i),xr(e.b,t.b,i),xr(e.a,t.a,i))},array:function(e,t,i){return e.map(((e,n)=>xr(e,t[n],i)))}});class wr{constructor(e,t,i,n){this.type=e,this.interpolation=t,this.input=i,this.labels=[],this.outputs=[];for(const[e,t]of n)this.labels.push(e),this.outputs.push(t);}static interpolationFactor(e,t,i,n){let r=0;if("exponential"===e.name)r=Tr(t,e.base,i,n);else if("linear"===e.name)r=Tr(t,1,i,n);else if("cubic-bezier"===e.name){const o=e.controlPoints;r=new K(o[0],o[1],o[2],o[3]).solve(Tr(t,1,i,n));}return r}static parse(e,t){let[,i,n,...r]=e;if(!Array.isArray(i)||0===i.length)return t.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){const e=i[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:e};}else {if("cubic-bezier"!==i[0])return t.error(`Unknown interpolation type ${String(i[0])}`,1,0);{const e=i.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:e};}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(n=t.parse(n,2,ji),!n)return null;const o=[];let a=null;t.expectedType&&"value"!==t.expectedType.kind&&(a=t.expectedType);for(let e=0;e<r.length;e+=2){const i=r[e],n=r[e+1],s=e+3,l=e+4;if("number"!=typeof i)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(o.length&&o[o.length-1][0]>=i)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',s);const u=t.parse(n,l,a);if(!u)return null;a=a||u.type,o.push([i,u]);}return "number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new wr(a,i,n,o):t.error(`Type ${on(a)} is not interpolatable.`)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return i[0].evaluate(e);const r=t.length;if(n>=t[r-1])return i[r-1].evaluate(e);const o=_r(t,n),a=wr.interpolationFactor(this.interpolation,n,t[o],t[o+1]),s=i[o].evaluate(e),l=i[o+1].evaluate(e);return vr[this.type.kind.toLowerCase()](s,l,a)}eachChild(e){e(this.input);for(const t of this.outputs)e(t);}possibleOutputs(){return [].concat(...this.outputs.map((e=>e.possibleOutputs())))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=["interpolate",e,this.input.serialize()];for(let e=0;e<this.labels.length;e++)t.push(this.labels[e],this.outputs[e].serialize());return t}}function Tr(e,t,i,n){const r=n-i,o=e-i;return 0===r?0:1===t?o/r:(Math.pow(t,o)-1)/(Math.pow(t,r)-1)}var br=wr;class Pr{constructor(e,t){this.type=e,this.args=t;}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let i=null;const n=t.expectedType;n&&"value"!==n.kind&&(i=n);const r=[];for(const n of e.slice(1)){const e=t.parse(n,1+r.length,i,void 0,{omitTypeAnnotations:!0});if(!e)return null;i=i||e.type,r.push(e);}const o=n&&r.some((e=>sn(n,e.type)));return new Pr(o?Ji:i,r)}evaluate(e){let t,i=null,n=0;for(const r of this.args)if(n++,i=r.evaluate(e),i&&i instanceof Tn&&!i.available&&(t||(t=i.name),i=null,n===this.args.length&&(i=t)),null!==i)break;return i}eachChild(e){this.args.forEach(e);}possibleOutputs(){return [].concat(...this.args.map((e=>e.possibleOutputs())))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize());})),e}}var Sr=Pr;class Er{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t;}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result);}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const i=[];for(let n=1;n<e.length-1;n+=2){const r=e[n];if("string"!=typeof r)return t.error(`Expected string, but found ${typeof r} instead.`,n);if(/[^a-zA-Z0-9_]/.test(r))return t.error("Variable names must contain only alphanumeric characters or '_'.",n);const o=t.parse(e[n+1],n+1);if(!o)return null;i.push([r,o]);}const n=t.parse(e[e.length-1],e.length-1,void 0,i);return n?new Er(i,n):null}possibleOutputs(){return this.result.possibleOutputs()}serialize(){const e=["let"];for(const[t,i]of this.bindings)e.push(t,i.serialize());return e.push(this.result.serialize()),e}}var Ar=Er;class Cr{constructor(e,t,i){this.type=e,this.index=t,this.input=i;}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,ji),n=t.parse(e[2],2,rn(t.expectedType||Ji));return i&&n?new Cr(n.type.itemType,i,n):null}evaluate(e){const t=this.index.evaluate(e),i=this.input.evaluate(e);if(t<0)throw new Mn(`Array index out of bounds: ${t} < 0.`);if(t>=i.length)throw new Mn(`Array index out of bounds: ${t} > ${i.length-1}.`);if(t!==Math.floor(t))throw new Mn(`Array index must be an integer, but found ${t} instead.`);return i[t]}eachChild(e){e(this.index),e(this.input);}possibleOutputs(){return [void 0]}serialize(){return ["at",this.index.serialize(),this.input.serialize()]}}var Mr=Cr;class Ir{constructor(e,t,i,n,r,o){this.inputType=e,this.type=t,this.input=i,this.cases=n,this.outputs=r,this.otherwise=o;}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let i,n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const r={},o=[];for(let a=2;a<e.length-1;a+=2){let s=e[a];const l=e[a+1];Array.isArray(s)||(s=[s]);const u=t.concat(a);if(0===s.length)return u.error("Expected at least one branch label.");for(const e of s){if("number"!=typeof e&&"string"!=typeof e)return u.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return u.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return u.error("Numeric branch labels must be integer values.");if(i){if(u.checkSubtype(i,Sn(e)))return null}else i=Sn(e);if(void 0!==r[String(e)])return u.error("Branch labels must be unique.");r[String(e)]=o.length;}const c=t.parse(l,a,n);if(!c)return null;n=n||c.type,o.push(c);}const a=t.parse(e[1],1,Ji);if(!a)return null;const s=t.parse(e[e.length-1],e.length-1,n);return s?"value"!==a.type.kind&&t.concat(1).checkSubtype(i,a.type)?null:new Ir(i,n,a,r,o,s):null}evaluate(e){const t=this.input.evaluate(e);return (Sn(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise);}possibleOutputs(){const e=[].concat(...this.outputs.map((e=>e.possibleOutputs()))).concat(this.otherwise.possibleOutputs());return e}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),i=[],n={};for(const e of t){const t=n[this.cases[e]];void 0===t?(n[this.cases[e]]=i.length,i.push([this.cases[e],[e]])):i[t][1].push(e);}const r=e=>"number"===this.inputType.kind?Number(e):e;for(const[t,n]of i){if(1===n.length)e.push(r(n[0]));else {const t=n.map(r);e.push(t);}e.push(this.outputs[t].serialize());}return e.push(this.otherwise.serialize()),e}}var Lr=Ir;class Nr{constructor(e,t,i){this.type=e,this.branches=t,this.otherwise=i;}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const n=[];for(let r=1;r<e.length-1;r+=2){const o=t.parse(e[r],r,Zi);if(!o)return null;const a=t.parse(e[r+1],r+1,i);if(!a)return null;n.push([o,a]),i=i||a.type;}const r=t.parse(e[e.length-1],e.length-1,i);return r?new Nr(i,n,r):null}evaluate(e){for(const[t,i]of this.branches)if(t.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,i]of this.branches)e(t),e(i);e(this.otherwise);}possibleOutputs(){const e=[].concat(...this.branches.map((([e,t])=>t.possibleOutputs()))).concat(this.otherwise.possibleOutputs());return e}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize());})),e}}var Rr=Nr;class Or{constructor(e){this.type=nn,this.input=e;}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,$i);return i?new Or(i):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),i=Tn.fromString(t);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(t)>-1),i}eachChild(e){e(this.input);}possibleOutputs(){return [void 0]}serialize(){return ["image",this.input.serialize()]}}class Dr{constructor(e,t,i){this.type=ji,this.needle=e,this.haystack=t,this.fromIndex=i;}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Ji),n=t.parse(e[2],2,Ji);if(!i||!n)return null;if(!ln(i.type,[Zi,$i,ji,Wi,Ji]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${on(i.type)} instead`);if(4===e.length){const r=t.parse(e[3],3,ji);return r?new Dr(i,n,r):null}return new Dr(i,n)}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!un(t,["boolean","string","number","null"]))throw new Mn(`Expected first argument to be of type boolean, string, number or null, but found ${on(Sn(t))} instead.`);if(!un(i,["string","array"]))throw new Mn(`Expected second argument to be of type array or string, but found ${on(Sn(i))} instead.`);if(this.fromIndex){const n=this.fromIndex.evaluate(e);return i.indexOf(t,n)}return i.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex);}possibleOutputs(){return [void 0]}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return ["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return ["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Fr=Dr;function zr(e,t){return "=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function Br(e,t,i,n){return 0===n.compare(t,i)}function Vr(e,t,i){const n="=="!==e&&"!="!==e;return class r{constructor(e,t,i){this.type=Zi,this.lhs=e,this.rhs=t,this.collator=i,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind;}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const i=e[0];let o=t.parse(e[1],1,Ji);if(!o)return null;if(!zr(i,o.type))return t.concat(1).error(`"${i}" comparisons are not supported for type '${on(o.type)}'.`);let a=t.parse(e[2],2,Ji);if(!a)return null;if(!zr(i,a.type))return t.concat(2).error(`"${i}" comparisons are not supported for type '${on(a.type)}'.`);if(o.type.kind!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return t.error(`Cannot compare types '${on(o.type)}' and '${on(a.type)}'.`);n&&("value"===o.type.kind&&"value"!==a.type.kind?o=new Nn(a.type,[o]):"value"!==o.type.kind&&"value"===a.type.kind&&(a=new Nn(o.type,[a])));let s=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return t.error("Cannot use collator to compare non-string types.");if(s=t.parse(e[3],3,en),!s)return null}return new r(o,a,s)}evaluate(r){const o=this.lhs.evaluate(r),a=this.rhs.evaluate(r);if(n&&this.hasUntypedArgument){const t=Sn(o),i=Sn(a);if(t.kind!==i.kind||"string"!==t.kind&&"number"!==t.kind)throw new Mn(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${i.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const e=Sn(o),i=Sn(a);if("string"!==e.kind||"string"!==i.kind)return t(r,o,a)}return this.collator?i(r,o,a,this.collator.evaluate(r)):t(r,o,a)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator);}possibleOutputs(){return [void 0]}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize());})),t}}}const kr=Vr("==",(function(e,t,i){return t===i}),Br),Ur=Vr("!=",(function(e,t,i){return t!==i}),(function(e,t,i,n){return !Br(0,t,i,n)})),Gr=Vr("<",(function(e,t,i){return t<i}),(function(e,t,i,n){return n.compare(t,i)<0})),Hr=Vr(">",(function(e,t,i){return t>i}),(function(e,t,i,n){return n.compare(t,i)>0})),Yr=Vr("<=",(function(e,t,i){return t<=i}),(function(e,t,i,n){return n.compare(t,i)<=0})),qr=Vr(">=",(function(e,t,i){return t>=i}),(function(e,t,i,n){return n.compare(t,i)>=0}));class Xr{constructor(e){this.type=ji,this.input=e;}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=t.parse(e[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?t.error(`Expected argument of type string or array, but found ${on(i.type)} instead.`):new Xr(i):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new Mn(`Expected value to be of type string or array, but found ${on(Sn(t))} instead.`)}eachChild(e){e(this.input);}possibleOutputs(){return [void 0]}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize());})),e}}var Wr=Xr;class jr{constructor(e,t,i,n){this.type=e,this.input=t,this.beginIndex=i,this.endIndex=n;}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Ji),n=t.parse(e[2],2,ji);if(!i||!n)return null;if(!ln(i.type,[rn(Ji),$i,Ji]))return t.error(`Expected first argument to be of type array or string, but found ${on(i.type)} instead`);if(4===e.length){const r=t.parse(e[3],3,ji);return r?new jr(i.type,i,n,r):null}return new jr(i.type,i,n)}evaluate(e){const t=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!un(t,["string","array"]))throw new Mn(`Expected first argument to be of type array or string, but found ${on(Sn(t))} instead.`);if(this.endIndex){const n=this.endIndex.evaluate(e);return t.slice(i,n)}return t.slice(i)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex);}possibleOutputs(){return [void 0]}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return ["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return ["slice",this.input.serialize(),this.beginIndex.serialize()]}}var $r=jr;class Zr{constructor(e,t,i,n,r){this.type=$i,this.number=e,this.locale=t,this.currency=i,this.minFractionDigits=n,this.maxFractionDigits=r;}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,ji);if(!i)return null;const n=e[2];if("object"!=typeof n||Array.isArray(n))return t.error("NumberFormat options argument must be an object.");let r=null;if(n.locale&&(r=t.parse(n.locale,1,$i),!r))return null;let o=null;if(n.currency&&(o=t.parse(n.currency,1,$i),!o))return null;let a=null;if(n["min-fraction-digits"]&&(a=t.parse(n["min-fraction-digits"],1,ji),!a))return null;let s=null;return n["max-fraction-digits"]&&(s=t.parse(n["max-fraction-digits"],1,ji),!s)?null:new Zr(i,r,o,a,s)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits);}possibleOutputs(){return [void 0]}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Kr{constructor(e,t){this.type=Zi,this.needle=e,this.haystack=t;}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Ji),n=t.parse(e[2],2,Ji);return i&&n?ln(i.type,[Zi,$i,ji,Wi,Ji])?new Kr(i,n):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${on(i.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!i)return !1;if(!un(t,["boolean","string","number","null"]))throw new Mn(`Expected first argument to be of type boolean, string, number or null, but found ${on(Sn(t))} instead.`);if(!un(i,["string","array"]))throw new Mn(`Expected second argument to be of type array or string, but found ${on(Sn(i))} instead.`);return i.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack);}possibleOutputs(){return [void 0]}serialize(){return ["in",this.needle.serialize(),this.haystack.serialize()]}}var Qr=Kr;class Jr{constructor(e){this.type=tn,this.sections=e;}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&"object"==typeof i)return t.error("First argument must be an image or text section.");const n=[];let r=!1;for(let i=1;i<=e.length-1;++i){const o=e[i];if(r&&"object"==typeof o&&!Array.isArray(o)){r=!1;let e=null;if(o["font-scale"]&&(e=t.parse(o["font-scale"],1,ji),!e))return null;let i=null;if(o["text-font"]&&(i=t.parse(o["text-font"],1,rn($i)),!i))return null;let a=null;if(o["text-color"]&&(a=t.parse(o["text-color"],1,Ki),!a))return null;const s=n[n.length-1];s.scale=e,s.font=i,s.textColor=a;}else {const o=t.parse(e[i],1,Ji);if(!o)return null;const a=o.type.kind;if("string"!==a&&"value"!==a&&"null"!==a&&"resolvedImage"!==a)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,n.push({content:o,scale:null,font:null,textColor:null});}}return new Jr(n)}evaluate(e){return new wn(this.sections.map((t=>{const i=t.content.evaluate(e);return Sn(i)===nn?new vn("",i,null,null,null):new vn(En(i),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor);}possibleOutputs(){return [void 0]}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const i={};t.scale&&(i["font-scale"]=t.scale.serialize()),t.font&&(i["text-font"]=t.font.serialize()),t.textColor&&(i["text-color"]=t.textColor.serialize()),e.push(i);}return e}}const eo={"==":kr,"!=":Ur,">":Hr,"<":Gr,">=":qr,"<=":Yr,array:Dn,at:Mr,boolean:Nn,case:Rr,coalesce:Sr,collator:hn,format:Jr,image:Or,in:Qr,"index-of":Fr,interpolate:br,"interpolate-hcl":br,"interpolate-lab":br,length:Wr,let:Ar,literal:Cn,match:Lr,number:Nn,"number-format":Zr,object:Nn,slice:$r,step:yr,string:Nn,"to-boolean":Vn,"to-color":Vn,"to-number":Vn,"to-string":Vn,var:dr,within:sr};function to(e,[t,i,n,r]){t=t.evaluate(e),i=i.evaluate(e),n=n.evaluate(e);const o=r?r.evaluate(e):1,a=bn(t,i,n,o);if(a)throw new Mn(a);return new Ui(t/255*o,i/255*o,n/255*o,o)}function io(e,t){return e in t}function no(e,t){const i=t[e];return void 0===i?null:i}function ro(e){return {type:e}}Hn.register(eo,{error:[{kind:"error"},[$i],(e,[t])=>{throw new Mn(t.evaluate(e))}],typeof:[$i,[Ji],(e,[t])=>on(Sn(t.evaluate(e)))],"to-rgba":[rn(ji,4),[Ki],(e,[t])=>t.evaluate(e).toArray()],rgb:[Ki,[ji,ji,ji],to],rgba:[Ki,[ji,ji,ji,ji],to],has:{type:Zi,overloads:[[[$i],(e,[t])=>io(t.evaluate(e),e.properties())],[[$i,Qi],(e,[t,i])=>io(t.evaluate(e),i.evaluate(e))]]},get:{type:Ji,overloads:[[[$i],(e,[t])=>no(t.evaluate(e),e.properties())],[[$i,Qi],(e,[t,i])=>no(t.evaluate(e),i.evaluate(e))]]},"feature-state":[Ji,[$i],(e,[t])=>no(t.evaluate(e),e.featureState||{})],properties:[Qi,[],e=>e.properties()],"geometry-type":[$i,[],e=>e.geometryType()],id:[Ji,[],e=>e.id()],zoom:[ji,[],e=>e.globals.zoom],"heatmap-density":[ji,[],e=>e.globals.heatmapDensity||0],"line-progress":[ji,[],e=>e.globals.lineProgress||0],accumulated:[Ji,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[ji,ro(ji),(e,t)=>{let i=0;for(const n of t)i+=n.evaluate(e);return i}],"*":[ji,ro(ji),(e,t)=>{let i=1;for(const n of t)i*=n.evaluate(e);return i}],"-":{type:ji,overloads:[[[ji,ji],(e,[t,i])=>t.evaluate(e)-i.evaluate(e)],[[ji],(e,[t])=>-t.evaluate(e)]]},"/":[ji,[ji,ji],(e,[t,i])=>t.evaluate(e)/i.evaluate(e)],"%":[ji,[ji,ji],(e,[t,i])=>t.evaluate(e)%i.evaluate(e)],ln2:[ji,[],()=>Math.LN2],pi:[ji,[],()=>Math.PI],e:[ji,[],()=>Math.E],"^":[ji,[ji,ji],(e,[t,i])=>Math.pow(t.evaluate(e),i.evaluate(e))],sqrt:[ji,[ji],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[ji,[ji],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[ji,[ji],(e,[t])=>Math.log(t.evaluate(e))],log2:[ji,[ji],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[ji,[ji],(e,[t])=>Math.sin(t.evaluate(e))],cos:[ji,[ji],(e,[t])=>Math.cos(t.evaluate(e))],tan:[ji,[ji],(e,[t])=>Math.tan(t.evaluate(e))],asin:[ji,[ji],(e,[t])=>Math.asin(t.evaluate(e))],acos:[ji,[ji],(e,[t])=>Math.acos(t.evaluate(e))],atan:[ji,[ji],(e,[t])=>Math.atan(t.evaluate(e))],min:[ji,ro(ji),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[ji,ro(ji),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[ji,[ji],(e,[t])=>Math.abs(t.evaluate(e))],round:[ji,[ji],(e,[t])=>{const i=t.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[ji,[ji],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[ji,[ji],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[Zi,[$i,Ji],(e,[t,i])=>e.properties()[t.value]===i.value],"filter-id-==":[Zi,[Ji],(e,[t])=>e.id()===t.value],"filter-type-==":[Zi,[$i],(e,[t])=>e.geometryType()===t.value],"filter-<":[Zi,[$i,Ji],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n<r}],"filter-id-<":[Zi,[Ji],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i<n}],"filter->":[Zi,[$i,Ji],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n>r}],"filter-id->":[Zi,[Ji],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i>n}],"filter-<=":[Zi,[$i,Ji],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n<=r}],"filter-id-<=":[Zi,[Ji],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i<=n}],"filter->=":[Zi,[$i,Ji],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n>=r}],"filter-id->=":[Zi,[Ji],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i>=n}],"filter-like":[Zi,[$i,Ji],(e,[t,i])=>e.properties()[t.value].indexOf(i.value)>=0],"filter-id-like":[Zi,[Ji],(e,[t])=>e.id().indexOf(t.value)>=0],"filter-type-like":[Zi,[$i],(e,[t])=>e.geometryType().indexOf(t.value)>=0],"filter-start":[Zi,[$i,Ji],(e,[t,i])=>0===e.properties()[t.value].indexOf(i.value)],"filter-id-start":[Zi,[Ji],(e,[t])=>0===e.id().indexOf(t.value)],"filter-type-start":[Zi,[$i],(e,[t])=>0===e.geometryType().indexOf(t.value)],"filter-end":[Zi,[$i,Ji],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return n.slice(-r.length)===r}],"filter-id-end":[Zi,[Ji],(e,[t])=>{const i=e.id(),n=t.value;return i.slice(-n.length)===n}],"filter-type-end":[Zi,[$i],(e,[t])=>{const i=e.geometryType(),n=t.value;return i.slice(-n.length)===n}],"filter-has":[Zi,[Ji],(e,[t])=>t.value in e.properties()],"filter-has-id":[Zi,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[Zi,[rn($i)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-type-arrin":[Zi,[rn($i)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-arrin":[Zi,[$i,rn(Ji)],(e,[t,i])=>function(e,t,i,n){for(;i<=n;){if(!e)return !1;if(e.indexOf(t[i])>-1)return !0;i+=1;}return !1}(e.properties()[t.value],i.value,0,i.value.length-1)],"filter-id-in":[Zi,[rn(Ji)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[Zi,[$i,rn(Ji)],(e,[t,i])=>i.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[Zi,[$i,rn(Ji)],(e,[t,i])=>function(e,t,i,n){for(;i<=n;){const r=i+n>>1;if(t[r]===e)return !0;t[r]>e?n=r-1:i=r+1;}return !1}(e.properties()[t.value],i.value,0,i.value.length-1)],all:{type:Zi,overloads:[[[Zi,Zi],(e,[t,i])=>t.evaluate(e)&&i.evaluate(e)],[ro(Zi),(e,t)=>{for(const i of t)if(!i.evaluate(e))return !1;return !0}]]},any:{type:Zi,overloads:[[[Zi,Zi],(e,[t,i])=>t.evaluate(e)||i.evaluate(e)],[ro(Zi),(e,t)=>{for(const i of t)if(i.evaluate(e))return !0;return !1}]]},"!":[Zi,[Zi],(e,[t])=>!t.evaluate(e)],"is-supported-script":[Zi,[$i],(e,[t])=>{const i=e.globals&&e.globals.isSupportedScript;return !i||i(t.evaluate(e))}],upcase:[$i,[$i],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[$i,[$i],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[$i,ro(Ji),(e,t)=>t.map((t=>En(t.evaluate(e)))).join("")],"resolved-locale":[$i,[en],(e,[t])=>t.evaluate(e).resolvedLocale()]});var oo=eo;function ao(e){return {result:"success",value:e}}function so(e){return {result:"error",value:e}}function lo(e){return "data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function uo(e){return !!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function co(e){return !!e.expression&&e.expression.interpolated}const ho=.95047,po=1.08883,fo=4/29,mo=6/29,_o=3*mo*mo,go=mo*mo*mo,yo=Math.PI/180,xo=180/Math.PI;function vo(e){return e>go?Math.pow(e,1/3):e/_o+fo}function wo(e){return e>mo?e*e*e:_o*(e-fo)}function To(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function bo(e){return (e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Po(e){const t=bo(e.r),i=bo(e.g),n=bo(e.b),r=vo((.4124564*t+.3575761*i+.1804375*n)/ho),o=vo((.2126729*t+.7151522*i+.072175*n)/1);return {l:116*o-16,a:500*(r-o),b:200*(o-vo((.0193339*t+.119192*i+.9503041*n)/po)),alpha:e.a}}function So(e){let t=(e.l+16)/116,i=isNaN(e.a)?t:t+e.a/500,n=isNaN(e.b)?t:t-e.b/200;return t=1*wo(t),i=ho*wo(i),n=po*wo(n),new Ui(To(3.2404542*i-1.5371385*t-.4985314*n),To(-.969266*i+1.8760108*t+.041556*n),To(.0556434*i-.2040259*t+1.0572252*n),e.alpha)}function Eo(e,t,i){const n=t-e;return e+i*(n>180||n<-180?n-360*Math.round(n/360):n)}var Ao=Object.freeze({__proto__:null,lab:{forward:Po,reverse:So,interpolate:function(e,t,i){return {l:xr(e.l,t.l,i),a:xr(e.a,t.a,i),b:xr(e.b,t.b,i),alpha:xr(e.alpha,t.alpha,i)}}},hcl:{forward:function(e){const{l:t,a:i,b:n}=Po(e),r=Math.atan2(n,i)*xo;return {h:r<0?r+360:r,c:Math.sqrt(i*i+n*n),l:t,alpha:e.a}},reverse:function(e){const t=e.h*yo,i=e.c;return So({l:e.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:e.alpha})},interpolate:function(e,t,i){return {h:Eo(e.h,t.h,i),c:xr(e.c,t.c,i),l:xr(e.l,t.l,i),alpha:xr(e.alpha,t.alpha,i)}}}});function Co(e){return "object"==typeof e&&null!==e&&!Array.isArray(e)}function Mo(e){return e}function Io(e,t){const i="color"===t.type,n=e.stops&&"object"==typeof e.stops[0][0],r=n||!(n||void 0!==e.property),o=e.type||(co(t)?"exponential":"interval");if(i&&((e=Gi({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],Ui.parse(e[1])]))),e.default=Ui.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!Ao[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let a,s,l;if("exponential"===o)a=Oo;else if("interval"===o)a=Ro;else if("categorical"===o){a=No,s=Object.create(null);for(const t of e.stops)s[t[0]]=t[1];l=typeof e.stops[0][0];}else {if("identity"!==o)throw new Error(`Unknown function type "${o}"`);a=Do;}if(n){const i={},n=[];for(let t=0;t<e.stops.length;t++){const r=e.stops[t],o=r[0].zoom;void 0===i[o]&&(i[o]={zoom:o,type:e.type,property:e.property,default:e.default,stops:[]},n.push(o)),i[o].stops.push([r[0].value,r[1]]);}const r=[];for(const e of n)r.push([i[e].zoom,Io(i[e],t)]);return {kind:"composite",interpolationFactor:br.interpolationFactor.bind(void 0,{name:"linear"}),zoomStops:r.map((e=>e[0])),evaluate:({zoom:i},n)=>Oo({stops:r,base:e.base},t,i).evaluate(i,n)}}return r?{kind:"camera",interpolationFactor:"exponential"===o?br.interpolationFactor.bind(void 0,{name:"exponential",base:void 0!==e.base?e.base:1}):()=>0,zoomStops:e.stops.map((e=>e[0])),evaluate:({zoom:i})=>a(e,t,i,s,l)}:{kind:"source",evaluate(i,n){const r=n&&n.properties?n.properties[e.property]:void 0;return void 0===r?Lo(e.default,t.default):a(e,t,r,s,l)}}}function Lo(e,t,i){return void 0!==e?e:void 0!==t?t:void 0!==i?i:void 0}function No(e,t,i,n,r){return Lo(typeof i===r?n[i]:void 0,e.default,t.default)}function Ro(e,t,i){if("number"!==Fn(i))return Lo(e.default,t.default);const n=e.stops.length;if(1===n)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[n-1][0])return e.stops[n-1][1];const r=Fo(e.stops,i);return e.stops[r][1]}function Oo(e,t,i){const n=void 0!==e.base?e.base:1;if("number"!==Fn(i))return Lo(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[r-1][0])return e.stops[r-1][1];const o=Fo(e.stops,i),a=function(e,t,i,n){const r=n-i,o=e-i;return 0===r?0:1===t?o/r:(Math.pow(t,o)-1)/(Math.pow(t,r)-1)}(i,n,e.stops[o][0],e.stops[o+1][0]),s=e.stops[o][1],l=e.stops[o+1][1];let u=vr[t.type]||Mo;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=Ao[e.colorSpace];u=(e,i)=>t.reverse(t.interpolate(t.forward(e),t.forward(i),a));}return "function"==typeof s.evaluate?{evaluate(...e){const t=s.evaluate.apply(void 0,e),i=l.evaluate.apply(void 0,e);if(void 0!==t&&void 0!==i)return u(t,i,a)}}:u(s,l,a)}function Do(e,t,i){return "color"===t.type?"x-color"!==t.units&&(i=Ui.parse(i)):"formatted"===t.type?i=wn.fromString(i.toString()):"resolvedImage"===t.type?i=Tn.fromString(i.toString()):Fn(i)===t.type||"enum"===t.type&&t.values[i]||(i=void 0),Lo(i,e.default,t.default)}function Fo(e,t){let i,n,r=0,o=e.length-1,a=0;for(;r<=o;){if(a=Math.floor((r+o)/2),i=e[a][0],n=e[a+1][0],t===i||t>i&&t<n)return a;i<t?r=a+1:i>t&&(o=a-1);}return Math.max(a-1,0)}class zo{constructor(e,t,i){this.expression=e,this._warningHistory={},this._evaluator=new Un(i),this._defaultValue=t?function(e){return "color"===e.type&&(Co(e.default)||Array.isArray(e.default))?new Ui(0,0,0,0):"color"===e.type?Ui.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null;}evaluateWithoutErrorHandling(e,t,i){return this._evaluator||(this._evaluator=new Un),this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=i,this.expression.evaluate(this._evaluator)}evaluate(e,t,i,n,r,o){this._evaluator||(this._evaluator=new Un),this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=i,this._evaluator.canonical=n,this._evaluator.availableImages=r,this._evaluator.formattedSection=o;try{const e=this.expression.evaluate(this._evaluator);if(null==e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new Mn(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function Bo(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in oo}function Vo(e,t){const i=new fr(oo,[],t?function(e){const t={color:Ki,string:$i,number:ji,enum:$i,boolean:Zi,formatted:tn,resolvedImage:nn};return "array"===e.type?rn(t[e.value]||Ji,e.length):t[e.type]||null}(t):void 0),n=i.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return n?ao(new zo(n,t)):so(i.errors)}class ko{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!ur(t.expression);}evaluateWithoutErrorHandling(e,t,i,n,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,n,r,o)}evaluate(e,t,i,n,r,o){return this._styleExpression.evaluate(e,t,i,n,r,o)}}class Uo{constructor(e,t,i){this.kind=e,this.zoomStops=i.labels,this._styleExpression=t,this.isStateDependent="camera"!==e&&!ur(t.expression),i instanceof br&&(this._interpolationType=i.interpolation);}evaluateWithoutErrorHandling(e,t,i,n,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,n,r,o)}evaluate(e,t,i,n,r,o){return this._styleExpression.evaluate(e,t,i,n,r,o)}interpolationFactor(e,t,i){return this._interpolationType?br.interpolationFactor(this._interpolationType,e,t,i):0}}function Go(e,t){if("error"===(e=Vo(e,t)).result)return e;const i=e.value.expression,n=lr(i);if(!n&&!lo(t))return so([new Yi("","data expressions not supported")]);const r=cr(i,["zoom"]);if(!r&&!uo(t))return so([new Yi("","zoom expressions not supported")]);const o=qo(i);return o||r?o instanceof Yi?so([o]):o instanceof br&&!co(t)?so([new Yi("",'"interpolate" expressions cannot be used with this property')]):ao(o?new Uo(n?"camera":"composite",e.value,o):new ko(n?"constant":"source",e.value)):so([new Yi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ho{constructor(e,t){this._parameters=e,this._specification=t,Gi(this,Io(this._parameters,this._specification));}static deserialize(e){return new Ho(e._parameters,e._specification)}static serialize(e){return {_parameters:e._parameters,_specification:e._specification}}}function Yo(e,t){if(Co(e))return new Ho(e,t);if(Bo(e)){const i=Go(e,t);if("error"===i.result)throw new Error(i.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return i.value}{let i=e;return "string"==typeof e&&"color"===t.type&&(i=Ui.parse(e)),{kind:"constant",evaluate:()=>i}}}function qo(e){let t=null;if(e instanceof Ar)t=qo(e.result);else if(e instanceof Sr){for(const i of e.args)if(t=qo(i),t)break}else (e instanceof yr||e instanceof br)&&e.input instanceof Hn&&"zoom"===e.input.name&&(t=e);return t instanceof Yi||e.eachChild((e=>{const i=qo(e);i instanceof Yi?t=i:!t&&i?t=new Yi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&i&&t!==i&&(t=new Yi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'));})),t}const{ImageData:Xo,ImageBitmap:Wo}=J,jo={};function $o(e,t,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),jo[e]={klass:t,omit:i.omit||[],shallow:i.shallow||[]};}$o("Object",Object),Si.serialize=function(e,t){const i=e.toArrayBuffer();return t&&t.push(i),i},Si.deserialize=function(e){return new Si(e)},$o("Grid",Si),$o("Color",Ui),$o("Error",Error),$o("StylePropertyFunction",Ho),$o("StyleExpression",zo,{omit:["_evaluator"]}),$o("ZoomDependentExpression",Uo),$o("ZoomConstantExpression",ko),$o("CompoundExpression",Hn,{omit:["_evaluate"]});for(const e in oo)oo[e]._classRegistryKey||$o(`Expression_${e}`,oo[e]);function Zo(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Ko(e){return Wo&&e instanceof Wo}function Qo(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||e instanceof J.Blob)return e;if(Zo(e)||Ko(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){const i=e;return t&&t.push(i.buffer),i}if(e instanceof Xo)return t&&t.push(e.data.buffer),e;if(o(e)){const i=[];for(const n of e)i.push(Qo(n,t));return i}if("object"==typeof e){const i=e.constructor,n=i._classRegistryKey;if(!n)throw new Error("can't serialize object of unregistered class");const r={};if(i.serialize)r._serialized=i.serialize(e,t);else {for(const i in e){if(!e.hasOwnProperty(i))continue;if(jo[n].omit.indexOf(i)>=0)continue;const o=e[i];r[i]=jo[n].shallow.indexOf(i)>=0?o:Qo(o,t);}e instanceof Error&&(r.message=e.message);}return {name:n,properties:r}}throw new Error("can't serialize object of type "+typeof e)}function Jo(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Zo(e)||Ko(e)||ArrayBuffer.isView(e)||e instanceof Xo||e instanceof J.Blob)return e;if(Array.isArray(e))return e.map((e=>Jo(e)));if("object"==typeof e){const{name:t,properties:i}=e;if(!t)throw new Error("can't deserialize object of anonymous class");const{klass:n}=jo[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(i._serialized);const r=Object.create(n.prototype);for(const e of Object.keys(i))r[e]=jo[t].shallow.indexOf(e)>=0?i[e]:Jo(i[e]);return r}throw new Error("can't deserialize object of type "+typeof e)}class ea extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(e,t){const i=this.length;this.resize(i+1);const n=2*i;return this.int16[n+0]=e,this.int16[n+1]=t,i}emplace(e,t,i){const n=2*e;return this.int16[n+0]=t,this.int16[n+1]=i,e}}ea.prototype.bytesPerElement=4,$o("StructArrayLayout2i4",ea);class ta extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(e,t,i,n){const r=this.length;this.resize(r+1);const o=4*r;return this.int16[o+0]=e,this.int16[o+1]=t,this.int16[o+2]=i,this.int16[o+3]=n,r}emplace(e,t,i,n,r){const o=4*e;return this.int16[o+0]=t,this.int16[o+1]=i,this.int16[o+2]=n,this.int16[o+3]=r,e}}ta.prototype.bytesPerElement=8,$o("StructArrayLayout4i8",ta);class ia extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r){const o=this.length;this.resize(o+1);const a=5*o;return this.float32[a+0]=e,this.float32[a+1]=t,this.float32[a+2]=i,this.float32[a+3]=n,this.float32[a+4]=r,o}emplace(e,t,i,n,r,o){const a=5*e;return this.float32[a+0]=t,this.float32[a+1]=i,this.float32[a+2]=n,this.float32[a+3]=r,this.float32[a+4]=o,e}}ia.prototype.bytesPerElement=20,$o("StructArrayLayout5f20",ia);class na extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s){const l=this.length;this.resize(l+1);const u=8*l;return this.float32[u+0]=e,this.float32[u+1]=t,this.float32[u+2]=i,this.float32[u+3]=n,this.float32[u+4]=r,this.float32[u+5]=o,this.float32[u+6]=a,this.float32[u+7]=s,l}emplace(e,t,i,n,r,o,a,s,l){const u=8*e;return this.float32[u+0]=t,this.float32[u+1]=i,this.float32[u+2]=n,this.float32[u+3]=r,this.float32[u+4]=o,this.float32[u+5]=a,this.float32[u+6]=s,this.float32[u+7]=l,e}}na.prototype.bytesPerElement=32,$o("StructArrayLayout8f32",na);class ra extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s){const l=this.length;this.resize(l+1);const u=8*l;return this.float32[u+0]=e,this.float32[u+1]=t,this.float32[u+2]=i,this.float32[u+3]=n,this.float32[u+4]=r,this.float32[u+5]=o,this.float32[u+6]=a,this.float32[u+7]=s,l}emplace(e,t,i,n,r,o,a,s,l){const u=8*e;return this.float32[u+0]=t,this.float32[u+1]=i,this.float32[u+2]=n,this.float32[u+3]=r,this.float32[u+4]=o,this.float32[u+5]=a,this.float32[u+6]=s,this.float32[u+7]=l,e}}ra.prototype.bytesPerElement=32,$o("StructArrayLayout3f2f3f32",ra);class oa extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,u,c,h,d,p,f,m,_,g,y,x,v){const w=this.length;this.resize(w+1);const T=21*w;return this.float32[T+0]=e,this.float32[T+1]=t,this.float32[T+2]=i,this.float32[T+3]=n,this.float32[T+4]=r,this.float32[T+5]=o,this.float32[T+6]=a,this.float32[T+7]=s,this.float32[T+8]=l,this.float32[T+9]=u,this.float32[T+10]=c,this.float32[T+11]=h,this.float32[T+12]=d,this.float32[T+13]=p,this.float32[T+14]=f,this.float32[T+15]=m,this.float32[T+16]=_,this.float32[T+17]=g,this.float32[T+18]=y,this.float32[T+19]=x,this.float32[T+20]=v,w}emplace(e,t,i,n,r,o,a,s,l,u,c,h,d,p,f,m,_,g,y,x,v,w){const T=21*e;return this.float32[T+0]=t,this.float32[T+1]=i,this.float32[T+2]=n,this.float32[T+3]=r,this.float32[T+4]=o,this.float32[T+5]=a,this.float32[T+6]=s,this.float32[T+7]=l,this.float32[T+8]=u,this.float32[T+9]=c,this.float32[T+10]=h,this.float32[T+11]=d,this.float32[T+12]=p,this.float32[T+13]=f,this.float32[T+14]=m,this.float32[T+15]=_,this.float32[T+16]=g,this.float32[T+17]=y,this.float32[T+18]=x,this.float32[T+19]=v,this.float32[T+20]=w,e}}oa.prototype.bytesPerElement=84,$o("StructArrayLayout21f84",oa);class aa extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,u,c,h,d,p,f,m,_,g,y,x,v,w){const T=this.length;this.resize(T+1);const b=22*T;return this.float32[b+0]=e,this.float32[b+1]=t,this.float32[b+2]=i,this.float32[b+3]=n,this.float32[b+4]=r,this.float32[b+5]=o,this.float32[b+6]=a,this.float32[b+7]=s,this.float32[b+8]=l,this.float32[b+9]=u,this.float32[b+10]=c,this.float32[b+11]=h,this.float32[b+12]=d,this.float32[b+13]=p,this.float32[b+14]=f,this.float32[b+15]=m,this.float32[b+16]=_,this.float32[b+17]=g,this.float32[b+18]=y,this.float32[b+19]=x,this.float32[b+20]=v,this.float32[b+21]=w,T}emplace(e,t,i,n,r,o,a,s,l,u,c,h,d,p,f,m,_,g,y,x,v,w,T){const b=22*e;return this.float32[b+0]=t,this.float32[b+1]=i,this.float32[b+2]=n,this.float32[b+3]=r,this.float32[b+4]=o,this.float32[b+5]=a,this.float32[b+6]=s,this.float32[b+7]=l,this.float32[b+8]=u,this.float32[b+9]=c,this.float32[b+10]=h,this.float32[b+11]=d,this.float32[b+12]=p,this.float32[b+13]=f,this.float32[b+14]=m,this.float32[b+15]=_,this.float32[b+16]=g,this.float32[b+17]=y,this.float32[b+18]=x,this.float32[b+19]=v,this.float32[b+20]=w,this.float32[b+21]=T,e}}aa.prototype.bytesPerElement=88,$o("StructArrayLayout22f88",aa);class sa extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,u,c,h,d,p,f,m,_,g,y,x,v,w,T,b,P,S,E){const A=this.length;this.resize(A+1);const C=27*A;return this.float32[C+0]=e,this.float32[C+1]=t,this.float32[C+2]=i,this.float32[C+3]=n,this.float32[C+4]=r,this.float32[C+5]=o,this.float32[C+6]=a,this.float32[C+7]=s,this.float32[C+8]=l,this.float32[C+9]=u,this.float32[C+10]=c,this.float32[C+11]=h,this.float32[C+12]=d,this.float32[C+13]=p,this.float32[C+14]=f,this.float32[C+15]=m,this.float32[C+16]=_,this.float32[C+17]=g,this.float32[C+18]=y,this.float32[C+19]=x,this.float32[C+20]=v,this.float32[C+21]=w,this.float32[C+22]=T,this.float32[C+23]=b,this.float32[C+24]=P,this.float32[C+25]=S,this.float32[C+26]=E,A}emplace(e,t,i,n,r,o,a,s,l,u,c,h,d,p,f,m,_,g,y,x,v,w,T,b,P,S,E,A){const C=27*e;return this.float32[C+0]=t,this.float32[C+1]=i,this.float32[C+2]=n,this.float32[C+3]=r,this.float32[C+4]=o,this.float32[C+5]=a,this.float32[C+6]=s,this.float32[C+7]=l,this.float32[C+8]=u,this.float32[C+9]=c,this.float32[C+10]=h,this.float32[C+11]=d,this.float32[C+12]=p,this.float32[C+13]=f,this.float32[C+14]=m,this.float32[C+15]=_,this.float32[C+16]=g,this.float32[C+17]=y,this.float32[C+18]=x,this.float32[C+19]=v,this.float32[C+20]=w,this.float32[C+21]=T,this.float32[C+22]=b,this.float32[C+23]=P,this.float32[C+24]=S,this.float32[C+25]=E,this.float32[C+26]=A,e}}sa.prototype.bytesPerElement=108,$o("StructArrayLayout27f108",sa);class la extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,u,c,h,d,p,f,m,_,g,y,x,v,w,T,b,P){const S=this.length;this.resize(S+1);const E=25*S;return this.float32[E+0]=e,this.float32[E+1]=t,this.float32[E+2]=i,this.float32[E+3]=n,this.float32[E+4]=r,this.float32[E+5]=o,this.float32[E+6]=a,this.float32[E+7]=s,this.float32[E+8]=l,this.float32[E+9]=u,this.float32[E+10]=c,this.float32[E+11]=h,this.float32[E+12]=d,this.float32[E+13]=p,this.float32[E+14]=f,this.float32[E+15]=m,this.float32[E+16]=_,this.float32[E+17]=g,this.float32[E+18]=y,this.float32[E+19]=x,this.float32[E+20]=v,this.float32[E+21]=w,this.float32[E+22]=T,this.float32[E+23]=b,this.float32[E+24]=P,S}emplace(e,t,i,n,r,o,a,s,l,u,c,h,d,p,f,m,_,g,y,x,v,w,T,b,P,S){const E=25*e;return this.float32[E+0]=t,this.float32[E+1]=i,this.float32[E+2]=n,this.float32[E+3]=r,this.float32[E+4]=o,this.float32[E+5]=a,this.float32[E+6]=s,this.float32[E+7]=l,this.float32[E+8]=u,this.float32[E+9]=c,this.float32[E+10]=h,this.float32[E+11]=d,this.float32[E+12]=p,this.float32[E+13]=f,this.float32[E+14]=m,this.float32[E+15]=_,this.float32[E+16]=g,this.float32[E+17]=y,this.float32[E+18]=x,this.float32[E+19]=v,this.float32[E+20]=w,this.float32[E+21]=T,this.float32[E+22]=b,this.float32[E+23]=P,this.float32[E+24]=S,e}}la.prototype.bytesPerElement=100,$o("StructArrayLayout25f100",la);class ua extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,u,c){const h=this.length;this.resize(h+1);const d=11*h;return this.float32[d+0]=e,this.float32[d+1]=t,this.float32[d+2]=i,this.float32[d+3]=n,this.float32[d+4]=r,this.float32[d+5]=o,this.float32[d+6]=a,this.float32[d+7]=s,this.float32[d+8]=l,this.float32[d+9]=u,this.float32[d+10]=c,h}emplace(e,t,i,n,r,o,a,s,l,u,c,h){const d=11*e;return this.float32[d+0]=t,this.float32[d+1]=i,this.float32[d+2]=n,this.float32[d+3]=r,this.float32[d+4]=o,this.float32[d+5]=a,this.float32[d+6]=s,this.float32[d+7]=l,this.float32[d+8]=u,this.float32[d+9]=c,this.float32[d+10]=h,e}}ua.prototype.bytesPerElement=44,$o("StructArrayLayout11f44",ua);class ca extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o){const a=this.length;this.resize(a+1);const s=6*a;return this.float32[s+0]=e,this.float32[s+1]=t,this.float32[s+2]=i,this.float32[s+3]=n,this.float32[s+4]=r,this.float32[s+5]=o,a}emplace(e,t,i,n,r,o,a){const s=6*e;return this.float32[s+0]=t,this.float32[s+1]=i,this.float32[s+2]=n,this.float32[s+3]=r,this.float32[s+4]=o,this.float32[s+5]=a,e}}ca.prototype.bytesPerElement=24,$o("StructArrayLayout3f3f24",ca);class ha extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a){const s=this.length;this.resize(s+1);const l=7*s;return this.float32[l+0]=e,this.float32[l+1]=t,this.float32[l+2]=i,this.float32[l+3]=n,this.float32[l+4]=r,this.float32[l+5]=o,this.float32[l+6]=a,s}emplace(e,t,i,n,r,o,a,s){const l=7*e;return this.float32[l+0]=t,this.float32[l+1]=i,this.float32[l+2]=n,this.float32[l+3]=r,this.float32[l+4]=o,this.float32[l+5]=a,this.float32[l+6]=s,e}}ha.prototype.bytesPerElement=28,$o("StructArrayLayout3f4f28",ha);class da extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,u){const c=this.length;this.resize(c+1);const h=10*c;return this.float32[h+0]=e,this.float32[h+1]=t,this.float32[h+2]=i,this.float32[h+3]=n,this.float32[h+4]=r,this.float32[h+5]=o,this.float32[h+6]=a,this.float32[h+7]=s,this.float32[h+8]=l,this.float32[h+9]=u,c}emplace(e,t,i,n,r,o,a,s,l,u,c){const h=10*e;return this.float32[h+0]=t,this.float32[h+1]=i,this.float32[h+2]=n,this.float32[h+3]=r,this.float32[h+4]=o,this.float32[h+5]=a,this.float32[h+6]=s,this.float32[h+7]=l,this.float32[h+8]=u,this.float32[h+9]=c,e}}da.prototype.bytesPerElement=40,$o("StructArrayLayout10f40",da);class pa extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int8=new Int8Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r){const o=this.length;this.resize(o+1);const a=4*o,s=16*o;return this.float32[a+0]=e,this.float32[a+1]=t,this.float32[a+2]=i,this.int8[s+12]=n,this.int8[s+13]=r,o}emplace(e,t,i,n,r,o){const a=4*e,s=16*e;return this.float32[a+0]=t,this.float32[a+1]=i,this.float32[a+2]=n,this.int8[s+12]=r,this.int8[s+13]=o,e}}pa.prototype.bytesPerElement=16,$o("StructArrayLayout3f2b16",pa);class fa extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l){const u=this.length;this.resize(u+1);const c=9*u;return this.float32[c+0]=e,this.float32[c+1]=t,this.float32[c+2]=i,this.float32[c+3]=n,this.float32[c+4]=r,this.float32[c+5]=o,this.float32[c+6]=a,this.float32[c+7]=s,this.float32[c+8]=l,u}emplace(e,t,i,n,r,o,a,s,l,u){const c=9*e;return this.float32[c+0]=t,this.float32[c+1]=i,this.float32[c+2]=n,this.float32[c+3]=r,this.float32[c+4]=o,this.float32[c+5]=a,this.float32[c+6]=s,this.float32[c+7]=l,this.float32[c+8]=u,e}}fa.prototype.bytesPerElement=36,$o("StructArrayLayout3f3f3f36",fa);class ma extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s){const l=this.length;this.resize(l+1);const u=8*l;return this.float32[u+0]=e,this.float32[u+1]=t,this.float32[u+2]=i,this.float32[u+3]=n,this.float32[u+4]=r,this.float32[u+5]=o,this.float32[u+6]=a,this.float32[u+7]=s,l}emplace(e,t,i,n,r,o,a,s,l){const u=8*e;return this.float32[u+0]=t,this.float32[u+1]=i,this.float32[u+2]=n,this.float32[u+3]=r,this.float32[u+4]=o,this.float32[u+5]=a,this.float32[u+6]=s,this.float32[u+7]=l,e}}ma.prototype.bytesPerElement=32,$o("StructArrayLayout1f1f3f3f32",ma);class _a extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,u){const c=this.length;this.resize(c+1);const h=4*c,d=16*c;return this.float32[h+0]=e,this.float32[h+1]=t,this.uint8[d+8]=i,this.uint8[d+9]=n,this.uint8[d+10]=r,this.uint8[d+11]=o,this.uint8[d+12]=a,this.uint8[d+13]=s,this.uint8[d+14]=l,this.uint8[d+15]=u,c}emplace(e,t,i,n,r,o,a,s,l,u,c){const h=4*e,d=16*e;return this.float32[h+0]=t,this.float32[h+1]=i,this.uint8[d+8]=n,this.uint8[d+9]=r,this.uint8[d+10]=o,this.uint8[d+11]=a,this.uint8[d+12]=s,this.uint8[d+13]=l,this.uint8[d+14]=u,this.uint8[d+15]=c,e}}_a.prototype.bytesPerElement=16,$o("StructArrayLayout2f8ub16",_a);class ga extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int8=new Int8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,u,c,h,d,p){const f=this.length;this.resize(f+1);const m=7*f,_=28*f,g=14*f;return this.float32[m+0]=e,this.float32[m+1]=t,this.float32[m+2]=i,this.int8[_+12]=n,this.int8[_+13]=r,this.uint8[_+16]=o,this.uint8[_+17]=a,this.uint8[_+18]=s,this.uint8[_+19]=l,this.uint8[_+20]=u,this.uint8[_+21]=c,this.uint8[_+22]=h,this.int16[g+12]=d,this.int16[g+13]=p,f}emplace(e,t,i,n,r,o,a,s,l,u,c,h,d,p,f){const m=7*e,_=28*e,g=14*e;return this.float32[m+0]=t,this.float32[m+1]=i,this.float32[m+2]=n,this.int8[_+12]=r,this.int8[_+13]=o,this.uint8[_+16]=a,this.uint8[_+17]=s,this.uint8[_+18]=l,this.uint8[_+19]=u,this.uint8[_+20]=c,this.uint8[_+21]=h,this.uint8[_+22]=d,this.int16[g+12]=p,this.int16[g+13]=f,e}}ga.prototype.bytesPerElement=28,$o("StructArrayLayout3f2b4ub3ub2i28",ga);class ya extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,u,c,h,d){const p=this.length;this.resize(p+1);const f=8*p,m=32*p,_=16*p;return this.float32[f+0]=e,this.float32[f+1]=t,this.float32[f+2]=i,this.float32[f+3]=n,this.uint8[m+16]=r,this.uint8[m+20]=o,this.uint8[m+21]=a,this.uint8[m+22]=s,this.uint8[m+23]=l,this.uint8[m+24]=u,this.uint8[m+25]=c,this.int16[_+14]=h,this.int16[_+15]=d,p}emplace(e,t,i,n,r,o,a,s,l,u,c,h,d,p){const f=8*e,m=32*e,_=16*e;return this.float32[f+0]=t,this.float32[f+1]=i,this.float32[f+2]=n,this.float32[f+3]=r,this.uint8[m+16]=o,this.uint8[m+20]=a,this.uint8[m+21]=s,this.uint8[m+22]=l,this.uint8[m+23]=u,this.uint8[m+24]=c,this.uint8[m+25]=h,this.int16[_+14]=d,this.int16[_+15]=p,e}}ya.prototype.bytesPerElement=32,$o("StructArrayLayout3f1f1ub4ub2ub2i32",ya);class xa extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,u){const c=this.length;this.resize(c+1);const h=10*c;return this.uint16[h+0]=e,this.uint16[h+1]=t,this.uint16[h+2]=i,this.uint16[h+3]=n,this.uint16[h+4]=r,this.uint16[h+5]=o,this.uint16[h+6]=a,this.uint16[h+7]=s,this.uint16[h+8]=l,this.uint16[h+9]=u,c}emplace(e,t,i,n,r,o,a,s,l,u,c){const h=10*e;return this.uint16[h+0]=t,this.uint16[h+1]=i,this.uint16[h+2]=n,this.uint16[h+3]=r,this.uint16[h+4]=o,this.uint16[h+5]=a,this.uint16[h+6]=s,this.uint16[h+7]=l,this.uint16[h+8]=u,this.uint16[h+9]=c,e}}xa.prototype.bytesPerElement=20,$o("StructArrayLayout10ui20",xa);class va extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,u,c){const h=this.length;this.resize(h+1);const d=7*h,p=28*h,f=14*h;return this.float32[d+0]=e,this.float32[d+1]=t,this.float32[d+2]=i,this.uint8[p+12]=n,this.uint8[p+16]=r,this.uint8[p+17]=o,this.uint8[p+18]=a,this.uint8[p+19]=s,this.uint16[f+10]=l,this.uint16[f+12]=u,this.uint16[f+13]=c,h}emplace(e,t,i,n,r,o,a,s,l,u,c,h){const d=7*e,p=28*e,f=14*e;return this.float32[d+0]=t,this.float32[d+1]=i,this.float32[d+2]=n,this.uint8[p+12]=r,this.uint8[p+16]=o,this.uint8[p+17]=a,this.uint8[p+18]=s,this.uint8[p+19]=l,this.uint16[f+10]=u,this.uint16[f+12]=c,this.uint16[f+13]=h,e}}va.prototype.bytesPerElement=28,$o("StructArrayLayout3f1ub4ub1ui2ui28",va);class wa extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r){const o=this.length;this.resize(o+1);const a=5*o;return this.float32[a+0]=e,this.float32[a+1]=t,this.float32[a+2]=i,this.float32[a+3]=n,this.float32[a+4]=r,o}emplace(e,t,i,n,r,o){const a=5*e;return this.float32[a+0]=t,this.float32[a+1]=i,this.float32[a+2]=n,this.float32[a+3]=r,this.float32[a+4]=o,e}}wa.prototype.bytesPerElement=20,$o("StructArrayLayout3f2f20",wa);class Ta extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int8=new Int8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,u){const c=this.length;this.resize(c+1);const h=6*c,d=24*c,p=12*c;return this.float32[h+0]=e,this.float32[h+1]=t,this.float32[h+2]=i,this.int8[d+12]=n,this.int8[d+13]=r,this.uint8[d+16]=o,this.uint8[d+17]=a,this.uint8[d+18]=s,this.uint8[d+19]=l,this.uint16[p+10]=u,c}emplace(e,t,i,n,r,o,a,s,l,u,c){const h=6*e,d=24*e,p=12*e;return this.float32[h+0]=t,this.float32[h+1]=i,this.float32[h+2]=n,this.int8[d+12]=r,this.int8[d+13]=o,this.uint8[d+16]=a,this.uint8[d+17]=s,this.uint8[d+18]=l,this.uint8[d+19]=u,this.uint16[p+10]=c,e}}Ta.prototype.bytesPerElement=24,$o("StructArrayLayout3f2b4ub1ui24",Ta);class ba extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i){const n=this.length;this.resize(n+1);const r=3*n;return this.float32[r+0]=e,this.float32[r+1]=t,this.float32[r+2]=i,n}emplace(e,t,i,n){const r=3*e;return this.float32[r+0]=t,this.float32[r+1]=i,this.float32[r+2]=n,e}}ba.prototype.bytesPerElement=12,$o("StructArrayLayout1f1f1f12",ba);class Pa extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r){const o=this.length;this.resize(o+1);const a=4*o,s=8*o;return this.float32[a+0]=e,this.float32[a+1]=t,this.float32[a+2]=i,this.int16[s+6]=n,this.int16[s+7]=r,o}emplace(e,t,i,n,r,o){const a=4*e,s=8*e;return this.float32[a+0]=t,this.float32[a+1]=i,this.float32[a+2]=n,this.int16[s+6]=r,this.int16[s+7]=o,e}}Pa.prototype.bytesPerElement=16,$o("StructArrayLayout3f2i16",Pa);class Sa extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i){const n=this.length;this.resize(n+1);const r=3*n;return this.float32[r+0]=e,this.float32[r+1]=t,this.float32[r+2]=i,n}emplace(e,t,i,n){const r=3*e;return this.float32[r+0]=t,this.float32[r+1]=i,this.float32[r+2]=n,e}}Sa.prototype.bytesPerElement=12,$o("StructArrayLayout3f12",Sa);class Ea extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t){const i=this.length;this.resize(i+1);const n=2*i;return this.float32[n+0]=e,this.float32[n+1]=t,i}emplace(e,t,i){const n=2*e;return this.float32[n+0]=t,this.float32[n+1]=i,e}}Ea.prototype.bytesPerElement=8,$o("StructArrayLayout2f8",Ea);class Aa extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l){const u=this.length;this.resize(u+1);const c=6*u,h=24*u;return this.float32[c+0]=e,this.float32[c+1]=t,this.float32[c+2]=i,this.float32[c+3]=n,this.float32[c+4]=r,this.uint8[h+20]=o,this.uint8[h+21]=a,this.uint8[h+22]=s,this.uint8[h+23]=l,u}emplace(e,t,i,n,r,o,a,s,l,u){const c=6*e,h=24*e;return this.float32[c+0]=t,this.float32[c+1]=i,this.float32[c+2]=n,this.float32[c+3]=r,this.float32[c+4]=o,this.uint8[h+20]=a,this.uint8[h+21]=s,this.uint8[h+22]=l,this.uint8[h+23]=u,e}}Aa.prototype.bytesPerElement=24,$o("StructArrayLayout3f2f4ub24",Aa);class Ca extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer);}emplaceBack(e){const t=this.length;return this.resize(t+1),this.uint32[1*t+0]=e,t}emplace(e,t){return this.uint32[1*e+0]=t,e}}Ca.prototype.bytesPerElement=4,$o("StructArrayLayout1ul4",Ca);class Ma extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,u,c){const h=this.length;this.resize(h+1);const d=12*h,p=6*h;return this.int16[d+0]=e,this.int16[d+1]=t,this.int16[d+2]=i,this.int16[d+3]=n,this.int16[d+4]=r,this.int16[d+5]=o,this.uint32[p+3]=a,this.uint16[d+8]=s,this.uint16[d+9]=l,this.int16[d+10]=u,this.int16[d+11]=c,h}emplace(e,t,i,n,r,o,a,s,l,u,c,h){const d=12*e,p=6*e;return this.int16[d+0]=t,this.int16[d+1]=i,this.int16[d+2]=n,this.int16[d+3]=r,this.int16[d+4]=o,this.int16[d+5]=a,this.uint32[p+3]=s,this.uint16[d+8]=l,this.uint16[d+9]=u,this.int16[d+10]=c,this.int16[d+11]=h,e}}Ma.prototype.bytesPerElement=24,$o("StructArrayLayout6i1ul2ui2i24",Ma);class Ia extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer);}emplaceBack(e,t){const i=this.length;this.resize(i+1);const n=4*i;return this.uint8[n+0]=e,this.uint8[n+1]=t,i}emplace(e,t,i){const n=4*e;return this.uint8[n+0]=t,this.uint8[n+1]=i,e}}Ia.prototype.bytesPerElement=4,$o("StructArrayLayout2ub4",Ia);class La extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,u,c,h,d,p){const f=this.length;this.resize(f+1);const m=20*f,_=10*f,g=40*f;return this.int16[m+0]=e,this.int16[m+1]=t,this.uint16[m+2]=i,this.uint16[m+3]=n,this.uint32[_+2]=r,this.uint32[_+3]=o,this.uint32[_+4]=a,this.uint16[m+10]=s,this.uint16[m+11]=l,this.uint16[m+12]=u,this.float32[_+7]=c,this.float32[_+8]=h,this.uint8[g+36]=d,this.uint8[g+37]=p,f}emplace(e,t,i,n,r,o,a,s,l,u,c,h,d,p,f){const m=20*e,_=10*e,g=40*e;return this.int16[m+0]=t,this.int16[m+1]=i,this.uint16[m+2]=n,this.uint16[m+3]=r,this.uint32[_+2]=o,this.uint32[_+3]=a,this.uint32[_+4]=s,this.uint16[m+10]=l,this.uint16[m+11]=u,this.uint16[m+12]=c,this.float32[_+7]=h,this.float32[_+8]=d,this.uint8[g+36]=p,this.uint8[g+37]=f,e}}La.prototype.bytesPerElement=40,$o("StructArrayLayout2i2ui3ul3ui2f2ub40",La);class Na extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e){const t=this.length;return this.resize(t+1),this.float32[1*t+0]=e,t}emplace(e,t){return this.float32[1*e+0]=t,e}}Na.prototype.bytesPerElement=4,$o("StructArrayLayout1f4",Na);class Ra extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(e,t,i){const n=this.length;this.resize(n+1);const r=3*n;return this.int16[r+0]=e,this.int16[r+1]=t,this.int16[r+2]=i,n}emplace(e,t,i,n){const r=3*e;return this.int16[r+0]=t,this.int16[r+1]=i,this.int16[r+2]=n,e}}Ra.prototype.bytesPerElement=6,$o("StructArrayLayout3i6",Ra);class Oa extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l){const u=this.length;this.resize(u+1);const c=6*u,h=12*u;return this.float32[c+0]=e,this.float32[c+1]=t,this.float32[c+2]=i,this.int16[h+6]=n,this.int16[h+7]=r,this.uint16[h+8]=o,this.uint16[h+9]=a,this.uint16[h+10]=s,this.uint16[h+11]=l,u}emplace(e,t,i,n,r,o,a,s,l,u){const c=6*e,h=12*e;return this.float32[c+0]=t,this.float32[c+1]=i,this.float32[c+2]=n,this.int16[h+6]=r,this.int16[h+7]=o,this.uint16[h+8]=a,this.uint16[h+9]=s,this.uint16[h+10]=l,this.uint16[h+11]=u,e}}Oa.prototype.bytesPerElement=24,$o("StructArrayLayout3f2i4ui24",Oa);class Da extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a){const s=this.length;this.resize(s+1);const l=5*s,u=10*s;return this.float32[l+0]=e,this.float32[l+1]=t,this.float32[l+2]=i,this.int16[u+6]=n,this.int16[u+7]=r,this.int16[u+8]=o,this.int16[u+9]=a,s}emplace(e,t,i,n,r,o,a,s){const l=5*e,u=10*e;return this.float32[l+0]=t,this.float32[l+1]=i,this.float32[l+2]=n,this.int16[u+6]=r,this.int16[u+7]=o,this.int16[u+8]=a,this.int16[u+9]=s,e}}Da.prototype.bytesPerElement=20,$o("StructArrayLayout3f2i2i20",Da);class Fa extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(e,t,i,n,r,o,a,s,l,u,c,h){const d=this.length;this.resize(d+1);const p=8*d,f=16*d;return this.float32[p+0]=e,this.float32[p+1]=t,this.float32[p+2]=i,this.int16[f+6]=n,this.int16[f+7]=r,this.uint16[f+8]=o,this.uint16[f+9]=a,this.uint16[f+10]=s,this.uint16[f+11]=l,this.uint16[f+12]=u,this.uint16[f+13]=c,this.uint16[f+14]=h,d}emplace(e,t,i,n,r,o,a,s,l,u,c,h,d){const p=8*e,f=16*e;return this.float32[p+0]=t,this.float32[p+1]=i,this.float32[p+2]=n,this.int16[f+6]=r,this.int16[f+7]=o,this.uint16[f+8]=a,this.uint16[f+9]=s,this.uint16[f+10]=l,this.uint16[f+11]=u,this.uint16[f+12]=c,this.uint16[f+13]=h,this.uint16[f+14]=d,e}}Fa.prototype.bytesPerElement=32,$o("StructArrayLayout3f2i7ui32",Fa);class za extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(e,t,i){const n=this.length;this.resize(n+1);const r=4*n;return this.uint32[2*n+0]=e,this.uint16[r+2]=t,this.uint16[r+3]=i,n}emplace(e,t,i,n){const r=4*e;return this.uint32[2*e+0]=t,this.uint16[r+2]=i,this.uint16[r+3]=n,e}}za.prototype.bytesPerElement=8,$o("StructArrayLayout1ul2ui8",za);class Ba extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(e,t,i){const n=this.length;this.resize(n+1);const r=3*n;return this.uint16[r+0]=e,this.uint16[r+1]=t,this.uint16[r+2]=i,n}emplace(e,t,i,n){const r=3*e;return this.uint16[r+0]=t,this.uint16[r+1]=i,this.uint16[r+2]=n,e}}Ba.prototype.bytesPerElement=6,$o("StructArrayLayout3ui6",Ba);class Va extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer);}emplaceBack(e,t,i){const n=this.length;this.resize(n+1);const r=3*n;return this.uint32[r+0]=e,this.uint32[r+1]=t,this.uint32[r+2]=i,n}emplace(e,t,i,n){const r=3*e;return this.uint32[r+0]=t,this.uint32[r+1]=i,this.uint32[r+2]=n,e}}Va.prototype.bytesPerElement=12,$o("StructArrayLayout3ul12",Va);class ka extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(e,t){const i=this.length;this.resize(i+1);const n=2*i;return this.uint16[n+0]=e,this.uint16[n+1]=t,i}emplace(e,t,i){const n=2*e;return this.uint16[n+0]=t,this.uint16[n+1]=i,e}}ka.prototype.bytesPerElement=4,$o("StructArrayLayout2ui4",ka);class Ua extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(e,t,i,n){const r=this.length;this.resize(r+1);const o=4*r;return this.float32[o+0]=e,this.float32[o+1]=t,this.float32[o+2]=i,this.float32[o+3]=n,r}emplace(e,t,i,n,r){const o=4*e;return this.float32[o+0]=t,this.float32[o+1]=i,this.float32[o+2]=n,this.float32[o+3]=r,e}}Ua.prototype.bytesPerElement=16,$o("StructArrayLayout4f16",Ua);class Ga extends wi{get anchorPointX(){return this._structArray.int16[this._pos2+0]}set anchorPointX(e){this._structArray.int16[this._pos2+0]=e;}get anchorPointY(){return this._structArray.int16[this._pos2+1]}set anchorPointY(e){this._structArray.int16[this._pos2+1]=e;}get x1(){return this._structArray.int16[this._pos2+2]}set x1(e){this._structArray.int16[this._pos2+2]=e;}get y1(){return this._structArray.int16[this._pos2+3]}set y1(e){this._structArray.int16[this._pos2+3]=e;}get x2(){return this._structArray.int16[this._pos2+4]}set x2(e){this._structArray.int16[this._pos2+4]=e;}get y2(){return this._structArray.int16[this._pos2+5]}set y2(e){this._structArray.int16[this._pos2+5]=e;}get featureIndex(){return this._structArray.uint32[this._pos4+3]}set featureIndex(e){this._structArray.uint32[this._pos4+3]=e;}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}set sourceLayerIndex(e){this._structArray.uint16[this._pos2+8]=e;}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}set bucketIndex(e){this._structArray.uint16[this._pos2+9]=e;}get radius(){return this._structArray.int16[this._pos2+10]}set radius(e){this._structArray.int16[this._pos2+10]=e;}get signedDistanceFromAnchor(){return this._structArray.int16[this._pos2+11]}set signedDistanceFromAnchor(e){this._structArray.int16[this._pos2+11]=e;}get anchorPoint(){return new te(this.anchorPointX,this.anchorPointY)}}Ga.prototype.size=24;class Ha extends Ma{get(e){return new Ga(this,e)}}$o("CollisionBoxArray",Ha);class Ya extends wi{get anchorX(){return this._structArray.int16[this._pos2+0]}set anchorX(e){this._structArray.int16[this._pos2+0]=e;}get anchorY(){return this._structArray.int16[this._pos2+1]}set anchorY(e){this._structArray.int16[this._pos2+1]=e;}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}set glyphStartIndex(e){this._structArray.uint16[this._pos2+2]=e;}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}set numGlyphs(e){this._structArray.uint16[this._pos2+3]=e;}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}set vertexStartIndex(e){this._structArray.uint32[this._pos4+2]=e;}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}set lineStartIndex(e){this._structArray.uint32[this._pos4+3]=e;}get lineLength(){return this._structArray.uint32[this._pos4+4]}set lineLength(e){this._structArray.uint32[this._pos4+4]=e;}get segment(){return this._structArray.uint16[this._pos2+10]}set segment(e){this._structArray.uint16[this._pos2+10]=e;}get lowerSize(){return this._structArray.uint16[this._pos2+11]}set lowerSize(e){this._structArray.uint16[this._pos2+11]=e;}get upperSize(){return this._structArray.uint16[this._pos2+12]}set upperSize(e){this._structArray.uint16[this._pos2+12]=e;}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}set lineOffsetX(e){this._structArray.float32[this._pos4+7]=e;}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}set lineOffsetY(e){this._structArray.float32[this._pos4+8]=e;}get writingMode(){return this._structArray.uint8[this._pos1+36]}set writingMode(e){this._structArray.uint8[this._pos1+36]=e;}get hidden(){return this._structArray.uint8[this._pos1+37]}set hidden(e){this._structArray.uint8[this._pos1+37]=e;}}Ya.prototype.size=40;class qa extends La{get(e){return new Ya(this,e)}}$o("PlacedSymbolArray",qa);class Xa extends wi{get offsetX(){return this._structArray.float32[this._pos4+0]}set offsetX(e){this._structArray.float32[this._pos4+0]=e;}}Xa.prototype.size=4;class Wa extends Na{getoffsetX(e){return this.float32[1*e+0]}get(e){return new Xa(this,e)}}$o("GlyphOffsetArray",Wa);class ja extends wi{get x(){return this._structArray.int16[this._pos2+0]}set x(e){this._structArray.int16[this._pos2+0]=e;}get y(){return this._structArray.int16[this._pos2+1]}set y(e){this._structArray.int16[this._pos2+1]=e;}get tileUnitDistanceFromAnchor(){return this._structArray.int16[this._pos2+2]}set tileUnitDistanceFromAnchor(e){this._structArray.int16[this._pos2+2]=e;}}ja.prototype.size=6;class $a extends Ra{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}get(e){return new ja(this,e)}}$o("SymbolLineVertexArray",$a);class Za extends wi{get featureIndex(){return this._structArray.uint32[this._pos4+0]}set featureIndex(e){this._structArray.uint32[this._pos4+0]=e;}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}set sourceLayerIndex(e){this._structArray.uint16[this._pos2+2]=e;}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}set bucketIndex(e){this._structArray.uint16[this._pos2+3]=e;}}Za.prototype.size=8;class Ka extends za{get(e){return new Za(this,e)}}$o("FeatureIndexArray",Ka);const Qa={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};Object.freeze(Qa);const Ja=new _t,es=new _t;class ts{constructor(e=[0,0,1],t=0){this.normal=new _t,this.distance=-0,this.fromNormalDistance(e,t);}fromNormalDistance(e,t){return this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=Ja.from(e),this.normal.from(t).normalize();const i=-this.normal.dot(e);return this.distance=i,this}fromCoefficients(e,t,i,n){return this.normal.set(e,t,i),this.distance=n,this}clone(){return new ts(this.normal,this.distance)}equals(e){return u(this.distance,e.distance)&&u(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=es.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,t)}projectPointOntoPlane(e,t=[0,0,0]){e=Ja.from(e);const i=this.getPointDistance(e),n=es.copy(this.normal).scale(i);return e.subtract(n).to(t)}static fromPointNormal(e,t,i){const n=-_t.dot(t,e);return $(i)?(_t.clone(t,i.normal),i.distance=n,i):new ts(t,n)}static fromCartesian4(e,t){const i=new _t,n=_t.fromCartesian4(e,i),r=e.w;return $(t)?(_t.clone(n,t.normal),t.distance=r,t):new ts(n,r)}static getPointDistance(e,t){return _t.dot(e.normal,t)+e.distance}static projectPointOntoPlane(e,t,i){const n=new _t;$(i)||(i=new _t);const r=ts.getPointDistance(e,t),o=_t.multiplyByScalar(e.normal,r,n);return _t.subtract(t,o,i)}static transform(e,t,i){const n=new Bt,r=new St,o=new _t,a=e.normal,s=e.distance,l=Bt.inverseTranspose(t,n);let u=St.fromElements(a.x,a.y,a.z,s,r);u=Bt.multiplyByVector(l,u,u);const c=_t.fromCartesian4(u,o);return u=St.divideByScalar(u,_t.magnitude(c),u),ts.fromCartesian4(u,i)}static clone(e,t){return $(t)?(_t.clone(e.normal,t.normal),t.distance=e.distance,t):new ts(e.normal,e.distance)}static equals(e,t){return e.distance===t.distance&&_t.equals(e.normal,t.normal)}}const is=[new _t(1,0,0),new _t(0,1,0),new _t(0,0,1)],ns=new _t,rs=new _t;new ts(new _t(1,0,0),0);class os{static get MASK_OUTSIDE(){return 4294967295}static get MASK_INSIDE(){return 0}static get MASK_INDETERMINATE(){return 2147483647}constructor(e=[]){this.planes=e;}fromBoundingSphere(e){this.planes.length=2*is.length;const t=e.center,i=e.radius;let n=0;for(const e of is){let r=this.planes[n],o=this.planes[n+1];r||(r=this.planes[n]=new ts),o||(o=this.planes[n+1]=new ts);const a=ns.copy(e).scale(-i).add(t);e.dot(a),r.fromPointNormal(a,e);const s=ns.copy(e).scale(i).add(t),l=rs.copy(e).negate();l.dot(s),o.fromPointNormal(s,l),n+=2;}return this}computeVisibility(e){let t=Qa.INSIDE;for(let i=0;i<6;i++)switch(e.intersectPlane(this.planes[i])){case Qa.OUTSIDE:return Qa.OUTSIDE;case Qa.INTERSECTING:t=Qa.INTERSECTING;}return t}computeVisibilityWithPlaneMask(e,t){if(t===os.MASK_OUTSIDE||t===os.MASK_INSIDE)return t;let i=os.MASK_INSIDE;const n=this.planes;for(let r=0;r<this.planes.length;++r){const o=r<31?1<<r:0;if(r<31&&!(t&o))continue;const a=e.intersectPlane(n[r]);if(a===Qa.OUTSIDE)return os.MASK_OUTSIDE;a===Qa.INTERSECTING&&(i|=o);}return i}}const as=new _t,ss=new _t,ls=new _t,us=new _t,cs=new _t;class hs{constructor(e={}){e={near:1,far:5e8,...e},this.left=e.left,this._left=void 0,this.right=e.right,this._right=void 0,this.top=e.top,this._top=void 0,this.bottom=e.bottom,this._bottom=void 0,this.near=e.near,this._near=this.near,this.far=e.far,this._far=this.far,this._cullingVolume=new os([new ts,new ts,new ts,new ts,new ts,new ts]),this._perspectiveMatrix=new Bt,this._infinitePerspective=new Bt;}clone(e){return $(e)||(e=new hs),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e._left=void 0,e._right=void 0,e._top=void 0,e._bottom=void 0,e._near=void 0,e._far=void 0,e}equals(e){return e&&e instanceof hs&&this.right===e.right&&this.left===e.left&&this.top===e.top&&this.bottom===e.bottom&&this.near===e.near&&this.far===e.far}equalsEpsilon(e,t,i){return e===this||$(e)&&e instanceof hs&&ot.CesiumMath.equalsEpsilon(this.right,e.right,t,i)&&ot.CesiumMath.equalsEpsilon(this.left,e.left,t,i)&&ot.CesiumMath.equalsEpsilon(this.top,e.top,t,i)&&ot.CesiumMath.equalsEpsilon(this.bottom,e.bottom,t,i)&&ot.CesiumMath.equalsEpsilon(this.near,e.near,t,i)&&ot.CesiumMath.equalsEpsilon(this.far,e.far,t,i)}get projectionMatrix(){return ds(this),this._perspectiveMatrix}get infiniteProjectionMatrix(){return ds(this),this._infinitePerspective}computeCullingVolume(e,t,i){const n=this._cullingVolume.planes;i=as.copy(i).normalize();const r=ss.copy(t).cross(i).normalize(),o=ls.copy(t).multiplyByScalar(this.near).add(e),a=us.copy(t).multiplyByScalar(this.far).add(e);let s=cs;return s.copy(r).multiplyByScalar(this.left).add(o).subtract(e).cross(i),n[0].fromPointNormal(e,s),s.copy(r).multiplyByScalar(this.right).add(o).subtract(e).cross(i).negate(),n[1].fromPointNormal(e,s),s.copy(i).multiplyByScalar(this.bottom).add(o).subtract(e).cross(r).negate(),n[2].fromPointNormal(e,s),s.copy(i).multiplyByScalar(this.top).add(o).subtract(e).cross(r),n[3].fromPointNormal(e,s),s=(new _t).copy(t),n[4].fromPointNormal(o,s),s.negate(),n[5].fromPointNormal(a,s),this._cullingVolume}setFromMatrix(e){const t=this._cullingVolume.planes,i=e[0],n=e[1],r=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],_=e[14],g=e[15];t[0].fromNormalDistance([o-i,u-a,p-c],g-f),t[1].fromNormalDistance([o+i,u+a,p+c],g+f),t[2].fromNormalDistance([o+n,u+s,p+h],g+m),t[3].fromNormalDistance([o-n,u-s,p-h],g-m),t[4].fromNormalDistance([o-r,u-l,p-d],g-_),t[5].fromNormalDistance([o+r,u+l,p+d],g+_);}getPixelDimensions(e,t,i,n,r){ds(this);const o=1/this.near;let a=this.top*o;const s=2*n*i*a/t;return a=this.right*o,r.x=2*n*i*a/e,r.y=s,r}}function ds(e){const{top:t,bottom:i,right:n,left:r,near:o,far:a}=e;t===e._top&&i===e._bottom&&r===e._left&&n===e._right&&o===e._near&&a===e._far||(e._left=r,e._right=n,e._top=t,e._bottom=i,e._near=o,e._far=a,e._perspectiveMatrix=(new Bt).frustum({left:r,right:n,bottom:i,top:t,near:o,far:a}),e._infinitePerspective=(new Bt).frustum({left:r,right:n,bottom:i,top:t,near:o,far:1/0}));}const ps=new _t,fs=new _t,ms=new _t,_s=new _t;class gs{constructor(e){e=Z(e,Z.EMPTY_OBJECT),this.left=e.left,this._left=void 0,this.right=e.right,this._right=void 0,this.top=e.top,this._top=void 0,this.bottom=e.bottom,this._bottom=void 0,this.near=Z(e.near,1),this._near=this.near,this.far=Z(e.far,5e8),this._far=this.far,this._cullingVolume=new os([new ts,new ts,new ts,new ts,new ts,new ts]),this._orthographicMatrix=new Bt;}get projectionMatrix(){return ys(this),this._orthographicMatrix}computeCullingVolume(e,t,i){const n=this._cullingVolume.planes,r=this.top,o=this.bottom,a=this.right,s=this.left,l=this.near,u=this.far,c=ps.copy(t).cross(i);c.normalize();const h=fs;h.copy(t).multiplyByScalar(l),h.add(e);const d=ms;d.copy(c).multiplyByScalar(s),d.add(h);let p=n[0];$(p)||(p=n[0]=new ts);let f=-c.dot(d);return p.fromCoefficients(c[0],c[1],c[2],f),d.copy(c).multiplyByScalar(a),d.add(h),p=n[1],$(p)||(p=n[1]=new ts),f=-_s.copy(c).negate().dot(d),p.fromCoefficients(-c[0],-c[1],-c[2],f),d.copy(i).multiplyByScalar(o),d.add(h),p=n[2],$(p)||(p=n[2]=new ts),f=-i.dot(d),_t.normalize(i,i),p.fromCoefficients(i[0],i[1],i[2],f),d.copy(i).multiplyByScalar(r),d.add(h),p=n[3],$(p)||(p=n[3]=new ts),f=-_s.copy(i).negate().dot(d),p.fromCoefficients(-i[0],-i[1],-i[2],f),p=n[4],$(p)||(p=n[4]=new ts),f=-t.dot(h),_t.normalize(t,t),p.fromCoefficients(t[0],t[1],t[2],f),d.copy(t).multiplyByScalar(u),d.add(e),p=n[5],$(p)||(p=n[5]=new ts),f=-_s.copy(t).negate().dot(d),p.fromCoefficients(-t[0],-t[1],-t[2],f),this._cullingVolume}getPixelDimensions(e,t,i,n,r){ys(this);const o=n*(this.top-this.bottom)/t;return r.x=n*(this.right-this.left)/e,r.y=o,r}clone(e){return $(e)||(e=new gs),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e._left=void 0,e._right=void 0,e._top=void 0,e._bottom=void 0,e._near=void 0,e._far=void 0,e}equals(e){return $(e)&&e instanceof gs&&this.right===e.right&&this.left===e.left&&this.top===e.top&&this.bottom===e.bottom&&this.near===e.near&&this.far===e.far}equalsEpsilon(e,t,i){return e===this||$(e)&&e instanceof gs&&ot.CesiumMath.equalsEpsilon(this.right,e.right,t,i)&&ot.CesiumMath.equalsEpsilon(this.left,e.left,t,i)&&ot.CesiumMath.equalsEpsilon(this.top,e.top,t,i)&&ot.CesiumMath.equalsEpsilon(this.bottom,e.bottom,t,i)&&ot.CesiumMath.equalsEpsilon(this.near,e.near,t,i)&&ot.CesiumMath.equalsEpsilon(this.far,e.far,t,i)}}function ys(e){e.top===e._top&&e.bottom===e._bottom&&e.left===e._left&&e.right===e._right&&e.near===e._near&&e.far===e._far||(e._left=e.left,e._right=e.right,e._top=e.top,e._bottom=e.bottom,e._near=e.near,e._far=e.far,e._orthographicMatrix=(new Bt).ortho({left:e.left,right:e.right,bottom:e.bottom,top:e.top,near:e.near,far:e.far}));}class xs{constructor(e){e=Z(e,Z.EMPTY_OBJECT),this._offCenterFrustum=new gs,this.width=e.width,this._width=void 0,this.aspectRatio=e.aspectRatio,this._aspectRatio=void 0,this.near=Z(e.near,1),this._near=this.near,this.far=Z(e.far,5e8),this._far=this.far;}static pack(e,t,i){return i=Z(i,0),t[i++]=e.width,t[i++]=e.aspectRatio,t[i++]=e.near,t[i]=e.far,t}static unpack(e,t,i){return t=Z(t,0),$(i)||(i=new xs),i.width=e[t++],i.aspectRatio=e[t++],i.near=e[t++],i.far=e[t],i}get projectionMatrix(){return vs(this),this._offCenterFrustum.projectionMatrix}computeCullingVolume(e,t,i){return vs(this),this._offCenterFrustum.computeCullingVolume(e,t,i)}getPixelDimensions(e,t,i,n,r){return vs(this),this._offCenterFrustum.getPixelDimensions(e,t,i,n,r)}clone(e){return $(e)||(e=new xs),e.aspectRatio=this.aspectRatio,e.width=this.width,e.near=this.near,e.far=this.far,e._aspectRatio=void 0,e._width=void 0,e._near=void 0,e._far=void 0,this._offCenterFrustum.clone(e._offCenterFrustum),e}equals(e){return !!($(e)&&e instanceof xs)&&(vs(this),vs(e),this.width===e.width&&this.aspectRatio===e.aspectRatio&&this._offCenterFrustum.equals(e._offCenterFrustum))}equalsEpsilon(e,t,i){return !!($(e)&&e instanceof xs)&&(vs(this),vs(e),ot.CesiumMath.equalsEpsilon(this.width,e.width,t,i)&&ot.CesiumMath.equalsEpsilon(this.aspectRatio,e.aspectRatio,t,i)&&this._offCenterFrustum.equalsEpsilon(e._offCenterFrustum,t,i))}}function vs(e){const t=e._offCenterFrustum;if(e.width!==e._width||e.aspectRatio!==e._aspectRatio||e.near!==e._near||e.far!==e._far){e._aspectRatio=e.aspectRatio,e._width=e.width,e._near=e.near,e._far=e.far;const i=1/e.aspectRatio;t.right=.5*e.width,t.left=-t.right,t.top=i*t.right,t.bottom=-t.top,t.near=e.near,t.far=e.far;}}xs.packedLength=4;const ws=new _t,Ts=new _t,bs=new _t;class Ps extends _t{constructor(e=0,t=0,i=0){super(e,t,i);}get longitude(){return this[0]}set longitude(e){this[0]=e;}get latitude(){return this[1]}set latitude(e){this[1]=e;}get height(){return this[2]}set height(e){this[2]=e;}clone(e=new Ps){return Ps.clone(this,e)}equals(e){return Ps.equals(this,e)}equalsEpsilon(e,t=0){return Ps.equalsEpsilon(this,e,t)}toString(){return `(${this.longitude}, ${this.latitude}, ${this.height})`}static fromRadians(e,t,i=0,n=new Ps){return n.longitude=e,n.latitude=t,n.height=i,n}static fromDegrees(e,t,i=0,n=new Ps){return e=ot.CesiumMath.toRadians(e),t=ot.CesiumMath.toRadians(t),Ps.fromRadians(e,t,i,n)}static fromVector3(e,t=hi.WGS84,i=new Ps){const n=ei(e,t,Ts);if(!$(n))return;let r=_t.multiplyComponents(n,t.oneOverRadiiSquared,ws);r=_t.normalize(r,r);const o=_t.subtract(e,n,bs),a=Math.atan2(r.y,r.x),s=Math.asin(r.z),l=Math.sign(_t.dot(o,e))*_t.magnitude(o);return i.longitude=a,i.latitude=s,i.height=l,i}static toVector3(e,t,i=new _t){return _t.fromRadians(e.longitude,e.latitude,e.height,t,i)}static clone(e,t=new Ps){return t.longitude=e.longitude,t.latitude=e.latitude,t.height=e.height,t}static equals(e,t){return e===t||$(e)&&$(t)&&e.longitude===t.longitude&&e.latitude===t.latitude&&e.height===t.height}static equalsEpsilon(e,t,i=0){return e===t||$(e)&&$(t)&&Math.abs(e.longitude-t.longitude)<=i&&Math.abs(e.latitude-t.latitude)<=i&&Math.abs(e.height-t.height)<=i}}class Ss{constructor(e,t,i,n){this.west=Z(e,0),this.south=Z(t,0),this.east=Z(i,0),this.north=Z(n,0);}get width(){return Ss.computeWidth(this)}get height(){return Ss.computeHeight(this)}static pack(e,t,i){return i=Z(i,0),t[i++]=e.west,t[i++]=e.south,t[i++]=e.east,t[i]=e.north,t}static unpack(e,t,i){return t=Z(t,0),$(i)||(i=new Ss),i.west=e[t++],i.south=e[t++],i.east=e[t++],i.north=e[t],i}static computeWidth(e){let t=e.east;const i=e.west;return t<i&&(t+=ot.CesiumMath.TWO_PI),t-i}static computeHeight(e){return e.north-e.south}static fromDegrees(e,t,i,n,r){return e=ot.CesiumMath.toRadians(Z(e,0)),t=ot.CesiumMath.toRadians(Z(t,0)),i=ot.CesiumMath.toRadians(Z(i,0)),n=ot.CesiumMath.toRadians(Z(n,0)),$(r)?(r.west=e,r.south=t,r.east=i,r.north=n,r):new Ss(e,t,i,n)}static fromRadians(e,t,i,n,r){return $(r)?(r.west=Z(e,0),r.south=Z(t,0),r.east=Z(i,0),r.north=Z(n,0),r):new Ss(e,t,i,n)}static fromCartographicArray(e,t){let i=Number.MAX_VALUE,n=-Number.MAX_VALUE,r=Number.MAX_VALUE,o=-Number.MAX_VALUE,a=Number.MAX_VALUE,s=-Number.MAX_VALUE;for(let t=0,l=e.length;t<l;t++){const l=e[t];i=Math.min(i,l.longitude),n=Math.max(n,l.longitude),a=Math.min(a,l.latitude),s=Math.max(s,l.latitude);const u=l.longitude>=0?l.longitude:l.longitude+ot.CesiumMath.TWO_PI;r=Math.min(r,u),o=Math.max(o,u);}return n-i>o-r&&(i=r,n=o,n>ot.CesiumMath.PI&&(n-=ot.CesiumMath.TWO_PI),i>ot.CesiumMath.PI&&(i-=ot.CesiumMath.TWO_PI)),$(t)?(t.west=i,t.south=a,t.east=n,t.north=s,t):new Ss(i,a,n,s)}static fromVector3Array(e,t,i){t=Z(t,hi.WGS84);let n=Number.MAX_VALUE,r=-Number.MAX_VALUE,o=Number.MAX_VALUE,a=-Number.MAX_VALUE,s=Number.MAX_VALUE,l=-Number.MAX_VALUE;const u=new Ps;for(let i=0,c=e.length;i<c;i++){const c=Ps.fromVector3(e[i],t,u);n=Math.min(n,c.longitude),r=Math.max(r,c.longitude),s=Math.min(s,c.latitude),l=Math.max(l,c.latitude);const h=c.longitude>=0?c.longitude:c.longitude+ot.CesiumMath.TWO_PI;o=Math.min(o,h),a=Math.max(a,h);}return r-n>a-o&&(n=o,r=a,r>ot.CesiumMath.PI&&(r-=ot.CesiumMath.TWO_PI),n>ot.CesiumMath.PI&&(n-=ot.CesiumMath.TWO_PI)),$(i)?(i.west=n,i.south=s,i.east=r,i.north=l,i):new Ss(n,s,r,l)}static clone(e,t){if($(e))return $(t)?(t.west=e.west,t.south=e.south,t.east=e.east,t.north=e.north,t):new Ss(e.west,e.south,e.east,e.north)}static equalsEpsilon(e,t,i){return i=Z(i,0),e===t||$(e)&&$(t)&&Math.abs(e.west-t.west)<=i&&Math.abs(e.south-t.south)<=i&&Math.abs(e.east-t.east)<=i&&Math.abs(e.north-t.north)<=i}clone(e){return Ss.clone(this,e)}equals(e){return Ss.equals(this,e)}static equals(e,t){return e===t||$(e)&&$(t)&&e.west===t.west&&e.south===t.south&&e.east===t.east&&e.north===t.north}equalsEpsilon(e,t){return Ss.equalsEpsilon(this,e,t)}static validate(e){const t=e.north;if(t<-ot.CesiumMath.PI_OVER_TWO||t>ot.CesiumMath.PI_OVER_TWO)throw new Error("north 范围越界！");const i=e.south;if(i<-ot.CesiumMath.PI_OVER_TWO||i>ot.CesiumMath.PI_OVER_TWO)throw new Error("south 范围越界！");const n=e.west;if(n<-ot.CesiumMath.PI||n>ot.CesiumMath.PI)throw new Error("west 范围越界！");const r=e.east;if(r<-ot.CesiumMath.PI||r>ot.CesiumMath.PI)throw new Error("east 范围越界！")}static southwest(e,t){return $(t)?(t.longitude=e.west,t.latitude=e.south,t.height=0,t):new Ps(e.west,e.south)}static northwest(e,t){return $(t)?(t.longitude=e.west,t.latitude=e.north,t.height=0,t):new Ps(e.west,e.north)}static northeast(e,t){return $(t)?(t.longitude=e.east,t.latitude=e.north,t.height=0,t):new Ps(e.east,e.north)}static southeast(e,t){return $(t)?(t.longitude=e.east,t.latitude=e.south,t.height=0,t):new Ps(e.east,e.south)}static center(e,t){let i=e.east;const n=e.west;i<n&&(i+=ot.CesiumMath.TWO_PI);const r=ot.CesiumMath.negativePiToPi(.5*(n+i)),o=.5*(e.south+e.north);return $(t)?(t.longitude=r,t.latitude=o,t.height=0,t):new Ps(r,o)}static intersection(e,t,i){let n=e.east,r=e.west,o=t.east,a=t.west;n<r&&o>0?n+=ot.CesiumMath.TWO_PI:o<a&&n>0&&(o+=ot.CesiumMath.TWO_PI),n<r&&a<0?a+=ot.CesiumMath.TWO_PI:o<a&&r<0&&(r+=ot.CesiumMath.TWO_PI);const s=ot.CesiumMath.negativePiToPi(Math.max(r,a)),l=ot.CesiumMath.negativePiToPi(Math.min(n,o));if((e.west<e.east||t.west<t.east)&&l<=s)return;const u=Math.max(e.south,t.south),c=Math.min(e.north,t.north);return u>=c?void 0:$(i)?(i.west=s,i.south=u,i.east=l,i.north=c,i):new Ss(s,u,l,c)}static simpleIntersection(e,t,i){const n=Math.max(e.west,t.west),r=Math.max(e.south,t.south),o=Math.min(e.east,t.east),a=Math.min(e.north,t.north);if(!(r>=a||n>=o))return $(i)?(i.west=n,i.south=r,i.east=o,i.north=a,i):new Ss(n,r,o,a)}static union(e,t,i){$(i)||(i=new Ss);let n=e.east,r=e.west,o=t.east,a=t.west;n<r&&o>0?n+=ot.CesiumMath.TWO_PI:o<a&&n>0&&(o+=ot.CesiumMath.TWO_PI),n<r&&a<0?a+=ot.CesiumMath.TWO_PI:o<a&&r<0&&(r+=ot.CesiumMath.TWO_PI);const s=ot.CesiumMath.negativePiToPi(Math.min(r,a)),l=ot.CesiumMath.negativePiToPi(Math.max(n,o));return i.west=s,i.south=Math.min(e.south,t.south),i.east=l,i.north=Math.max(e.north,t.north),i}static expand(e,t,i){return $(i)||(i=new Ss),i.west=Math.min(e.west,t.longitude),i.south=Math.min(e.south,t.latitude),i.east=Math.max(e.east,t.longitude),i.north=Math.max(e.north,t.latitude),i}static contains(e,t){let i=t.longitude;const n=t.latitude,r=e.west;let o=e.east;return o<r&&(o+=ot.CesiumMath.TWO_PI,i<0&&(i+=ot.CesiumMath.TWO_PI)),(i>r||ot.CesiumMath.equalsEpsilon(i,r,ot.CesiumMath.EPSILON14))&&(i<o||ot.CesiumMath.equalsEpsilon(i,o,ot.CesiumMath.EPSILON14))&&n>=e.south&&n<=e.north}static subsample(e,t,i,n){t=Z(t,hi.WGS84),i=Z(i,0);const r=new Ps;$(n)||(n=[]);let o=0;const a=e.north,s=e.south,l=e.east,u=e.west,c=r;c.height=i,c.longitude=u,c.latitude=a,n[o]=t.cartographicToCartesian(c,n[o]),o++,c.longitude=l,n[o]=t.cartographicToCartesian(c,n[o]),o++,c.latitude=s,n[o]=t.cartographicToCartesian(c,n[o]),o++,c.longitude=u,n[o]=t.cartographicToCartesian(c,n[o]),o++,c.latitude=a<0?a:s>0?s:0;for(let i=1;i<8;++i)c.longitude=-Math.PI+i*ot.CesiumMath.PI_OVER_TWO,Ss.contains(e,c)&&(n[o]=t.cartographicToCartesian(c,n[o]),o++);return 0===c.latitude&&(c.longitude=u,n[o]=t.cartographicToCartesian(c,n[o]),o++,c.longitude=l,n[o]=t.cartographicToCartesian(c,n[o]),o++),n.length=o,n}}Ss.packedLength=4,Ss.MAX_VALUE=Object.freeze(new Ss(-Math.PI,-ot.CesiumMath.PI_OVER_TWO,Math.PI,ot.CesiumMath.PI_OVER_TWO));const Es={};function As(e,t,i){const n=e+t;return Math.sign(e)!==Math.sign(t)&&Math.abs(n/Math.max(Math.abs(e),Math.abs(t)))<i?0:n}Es.computeDiscriminant=function(e,t,i){return t*t-4*e*i},Es.computeRealRoots=function(e,t,i){let n;if(0===e)return 0===t?[]:[-i/t];if(0===t){if(0===i)return [0,0];const t=Math.abs(i),r=Math.abs(e);if(t<r&&t/r<ot.CesiumMath.EPSILON14)return [0,0];if(t>r&&r/t<ot.CesiumMath.EPSILON14)return [];if(n=-i/e,n<0)return [];const o=Math.sqrt(n);return [-o,o]}if(0===i)return n=-t/e,n<0?[n,0]:[0,n];const r=As(t*t,-4*e*i,ot.CesiumMath.EPSILON14);if(r<0)return [];const o=-.5*As(t,Math.sign(t)*Math.sqrt(r),ot.CesiumMath.EPSILON14);return t>0?[o/e,i/o]:[i/o,o/e]};const Cs={};function Ms(e,t,i,n){const r=e,o=t/3,a=i/3,s=n,l=r*a,u=o*s,c=o*o,h=a*a,d=r*a-c,p=r*s-o*a,f=o*s-h,m=4*d*f-p*p;let _,g;if(m<0){let e,t,i;c*u>=l*h?(e=r,t=d,i=-2*o*d+r*p):(e=s,t=f,i=-s*p+2*a*f);const n=-(i<0?-1:1)*Math.abs(e)*Math.sqrt(-m);g=-i+n;const y=g/2,x=y<0?-Math.pow(-y,1/3):Math.pow(y,1/3),v=g===n?-x:-t/x;return _=t<=0?x+v:-i/(x*x+v*v+t),c*u>=l*h?[(_-o)/r]:[-s/(_+a)]}const y=d,x=-2*o*d+r*p,v=f,w=-s*p+2*a*f,T=Math.sqrt(m),b=Math.sqrt(3)/2;let P=Math.abs(Math.atan2(r*T,-x)/3);_=2*Math.sqrt(-y);let S=Math.cos(P);g=_*S;let E=_*(-S/2-b*Math.sin(P));const A=g+E>2*o?g-o:E-o,C=r,M=A/C;P=Math.abs(Math.atan2(s*T,-w)/3),_=2*Math.sqrt(-v),S=Math.cos(P),g=_*S,E=_*(-S/2-b*Math.sin(P));const I=-s,L=g+E<2*a?g+a:E+a,N=I/L,R=-A*L-C*I,O=(a*R-o*(A*I))/(-o*R+a*(C*L));return M<=O?M<=N?O<=N?[M,O,N]:[M,N,O]:[N,M,O]:M<=N?[O,M,N]:O<=N?[O,N,M]:[N,O,M]}Cs.computeDiscriminant=function(e,t,i,n){const r=t*t,o=i*i;return 18*e*t*i*n+r*o-e*e*27*(n*n)-4*(e*o*i+r*t*n)},Cs.computeRealRoots=function(e,t,i,n){let r,o;if(0===e)return Es.computeRealRoots(t,i,n);if(0===t){if(0===i){if(0===n)return [0,0,0];o=-n/e;const t=o<0?-Math.pow(-o,1/3):Math.pow(o,1/3);return [t,t,t]}return 0===n?(r=Es.computeRealRoots(e,0,i),0===r.Length?[0]:[r[0],0,r[1]]):Ms(e,0,i,n)}return 0===i?0===n?(o=-t/e,o<0?[o,0,0]:[0,0,o]):Ms(e,t,0,n):0===n?(r=Es.computeRealRoots(e,t,i),0===r.length?[0]:r[1]<=0?[r[0],r[1],0]:r[0]>=0?[0,r[0],r[1]]:[r[0],0,r[1]]):Ms(e,t,i,n)};const Is={computeDiscriminant:function(e,t,i,n,r){const o=e*e,a=t*t,s=a*t,l=i*i,u=l*i,c=n*n,h=c*n,d=r*r;return a*l*c-4*s*h-4*e*u*c+18*e*t*i*h-27*o*c*c+o*e*256*(d*r)+r*(18*s*i*n-4*a*u+16*e*l*l-80*e*t*l*n-6*e*a*c+144*o*i*c)+d*(144*e*a*i-27*a*a-128*o*l-192*o*t*n)},computeRealRoots:function(e,t,i,n,r){if(Math.abs(e)<ot.CesiumMath.EPSILON15)return Cs.computeRealRoots(t,i,n,r);const o=t/e,a=i/e,s=n/e,l=r/e;let u=o<0?1:0;switch(u+=a<0?u+1:u,u+=s<0?u+1:u,u+=l<0?u+1:u,u){case 0:case 3:case 4:case 6:case 7:case 9:case 10:case 12:case 13:case 14:case 15:return function(e,t,i,n){const r=e*e,o=t-3*r/8,a=i-t*e/2+r*e/8,s=n-i*e/4+t*r/16-3*r*r/256,l=Cs.computeRealRoots(1,2*o,o*o-4*s,-a*a);if(l.length>0){const t=-e/4,i=l[l.length-1];if(Math.abs(i)<ot.CesiumMath.EPSILON14){const e=Es.computeRealRoots(1,o,s);if(2===e.length){const i=e[0],n=e[1];let r;if(i>=0&&n>=0){const e=Math.sqrt(i),r=Math.sqrt(n);return [t-r,t-e,t+e,t+r]}if(i>=0&&n<0)return r=Math.sqrt(i),[t-r,t+r];if(i<0&&n>=0)return r=Math.sqrt(n),[t-r,t+r]}return []}if(i>0){const e=Math.sqrt(i),n=(o+i+a/e)/2,r=Es.computeRealRoots(1,e,(o+i-a/e)/2),s=Es.computeRealRoots(1,-e,n);return 0!==r.length?(r[0]+=t,r[1]+=t,0!==s.length?(s[0]+=t,s[1]+=t,r[1]<=s[0]?[r[0],r[1],s[0],s[1]]:s[1]<=r[0]?[s[0],s[1],r[0],r[1]]:r[0]>=s[0]&&r[1]<=s[1]?[s[0],r[0],r[1],s[1]]:s[0]>=r[0]&&s[1]<=r[1]?[r[0],s[0],s[1],r[1]]:r[0]>s[0]&&r[0]<s[1]?[s[0],r[0],s[1],r[1]]:[r[0],s[0],r[1],s[1]]):r):0!==s.length?(s[0]+=t,s[1]+=t,s):[]}}return []}(o,a,s,l);case 1:case 2:case 5:case 8:case 11:return function(e,t,i,n){const r=e*e,o=Cs.computeRealRoots(1,-2*t,i*e+t*t-4*n,r*n-i*t*e+i*i);if(o.length>0){const a=o[0],s=t-a,l=s*s,u=e/2,c=s/2,h=l-4*n,d=l+4*Math.abs(n),p=r-4*a,f=r+4*Math.abs(a);let m,_,g,y,x,v;if(a<0||h*f<p*d){const t=Math.sqrt(p);m=t/2,_=0===t?0:(e*c-i)/t;}else {const t=Math.sqrt(h);m=0===t?0:(e*c-i)/t,_=t/2;}0===u&&0===m?(g=0,y=0):Math.sign(u)===Math.sign(m)?(g=u+m,y=a/g):(y=u-m,g=a/y),0===c&&0===_?(x=0,v=0):Math.sign(c)===Math.sign(_)?(x=c+_,v=n/x):(v=c-_,x=n/v);const w=Es.computeRealRoots(1,g,x),T=Es.computeRealRoots(1,y,v);if(0!==w.length)return 0!==T.length?w[1]<=T[0]?[w[0],w[1],T[0],T[1]]:T[1]<=w[0]?[T[0],T[1],w[0],w[1]]:w[0]>=T[0]&&w[1]<=T[1]?[T[0],w[0],w[1],T[1]]:T[0]>=w[0]&&T[1]<=w[1]?[w[0],T[0],T[1],w[1]]:w[0]>T[0]&&w[0]<T[1]?[T[0],w[0],T[1],w[1]]:[w[0],T[0],w[1],T[1]]:w;if(0!==T.length)return T}return []}(o,a,s,l);default:return}}},Ls=new _t,Ns=new _t,Rs=new _t,Os=new _t;class Ds{constructor(e,t){this.origin=new _t(void 0!==e?e:[0,0,0]),this.direction=new _t(void 0!==t?t:[0,0,0]);}set(e,t){return S(this.origin,e),S(this.direction,t),this}clone(){return new Ds(this.origin,this.direction)}copy(e){S(this.origin,e.origin),S(this.direction,e.direction);}at(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=[0,0,0]),S(t,this.direction),A(t,t,e),E(t,t,this.origin),t}lookAt(e){return S(this.direction,e),O(this.direction,this.direction,this.origin),M(this.direction,this.direction),this}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=[0,0,0]),O(t,e,this.origin);const i=I(t,this.direction);return i<0?S(t,this.origin):(S(t,this.direction),A(t,t,i),E(t,t,this.origin),t)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(){const e=[0,0,0],t=I(O(e,point,this.origin),this.direction);return t<0?C(this.origin,point):(S(e,this.direction),A(e,e,t),E(e,e,this.origin),C(e,point))}distanceSqToSegment(e,t,i,n){const r=[0,0,0],o=[0,0,0],a=[0,0,0];r.copy(e).add(t).multiplyScalar(.5),o.copy(t).sub(e).normalize(),a.copy(this.origin).sub(r);const s=.5*e.distanceTo(t),l=-this.direction.dot(o),u=a.dot(this.direction),c=-a.dot(o),h=a.lengthSq(),d=Math.abs(1-l*l);let p,f,m,_;if(d>0)if(p=l*c-u,f=l*u-c,_=s*d,p>=0)if(f>=-_)if(f<=_){const e=1/d;p*=e,f*=e,m=p*(p+l*f+2*u)+f*(l*p+f+2*c)+h;}else f=s,p=Math.max(0,-(l*f+u)),m=-p*p+f*(f+2*c)+h;else f=-s,p=Math.max(0,-(l*f+u)),m=-p*p+f*(f+2*c)+h;else f<=-_?(p=Math.max(0,-(-l*s+u)),f=p>0?-s:Math.min(Math.max(-s,-c),s),m=-p*p+f*(f+2*c)+h):f<=_?(p=0,f=Math.min(Math.max(-s,-c),s),m=f*(f+2*c)+h):(p=Math.max(0,-(l*s+u)),f=p>0?s:Math.min(Math.max(-s,-c),s),m=-p*p+f*(f+2*c)+h);else f=l>0?-s:s,p=Math.max(0,-(l*f+u)),m=-p*p+f*(f+2*c)+h;return i&&i.copy(this.direction).multiplyScalar(p).add(this.origin),n&&n.copy(o).multiplyScalar(f).add(r),m}intersectSphere(e,t){const i=[0,0,0];O(i,e.center,this.origin);const n=I(i,this.direction),r=I(i,i)-n*n,o=e.radius*e.radius;if(r>o)return null;const a=Math.sqrt(o-r),s=n-a,l=n+a;return s<0&&l<0?null:this.at(s<0?l:s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,n,r,o,a,s;const l=1/this.direction[0],u=1/this.direction[1],c=1/this.direction[2],h=this.origin;return l>=0?(i=(e[0][0]-h[0])*l,n=(e[1][0]-h[0])*l):(i=(e[1][0]-h[0])*l,n=(e[0][0]-h[0])*l),u>=0?(r=(e[0][1]-h[1])*u,o=(e[1][1]-h[1])*u):(r=(e[1][1]-h[1])*u,o=(e[0][1]-h[1])*u),i>o||r>n?null:((r>i||i!=i)&&(i=r),(o<n||n!=n)&&(n=o),c>=0?(a=(e[0][2]-h[2])*c,s=(e[1][2]-h[2])*c):(a=(e[1][2]-h[2])*c,s=(e[0][2]-h[2])*c),i>s||a>n?null:((a>i||i!=i)&&(i=a),(s<n||n!=n)&&(n=s),n<0?null:this.at(i>=0?i:n,t)))}intersectTriangle(e,t,i,n,r){Ns.subVectors(t,e),Rs.subVectors(i,e),Os.crossVectors(Ns,Rs);let o,a=this.direction.dot(Os);if(a>0){if(n)return null;o=1;}else {if(!(a<0))return null;o=-1,a=-a;}Ls.subVectors(this.origin,e);const s=o*this.direction.dot(Rs.crossVectors(Ls,Rs));if(s<0)return null;const l=o*this.direction.dot(Ns.cross(Ls));if(l<0)return null;if(s+l>a)return null;const u=-o*Ls.dot(Os);return u<0?null:this.at(u/a,r)}applyMatrix4(e){return F(this.origin,this.origin,e),F(this.direction,this.direction,e),this}equals(e){return e.origin===this.origin&&e.direction===this.direction}static getPoint(e,t,i){return $(i)||(i=new _t),i=_t.multiplyByScalar(e.direction,t,i),_t.add(e.origin,i,i)}}const Fs={rayPlane:function(e,t,i){$(i)||(i=new _t);const n=e.origin,r=e.direction,o=t.normal,a=_t.dot(o,r);if(Math.abs(a)<ot.CesiumMath.EPSILON15)return;const s=(-t.distance-_t.dot(o,n))/a;return s<0?void 0:(i=_t.multiplyByScalar(r,s,i),_t.add(n,i,i))}},zs=new _t,Bs=new _t,Vs=new _t,ks=new _t,Us=new _t;Fs.rayTriangleParametric=function(e,t,i,n,r){r=Z(r,!1);const o=e.origin,a=e.direction,s=_t.subtract(i,t,zs),l=_t.subtract(n,t,Bs),u=_t.cross(a,l,Vs),c=_t.dot(s,u);let h,d,p,f,m;if(r){if(c<ot.CesiumMath.EPSILON6)return;if(h=_t.subtract(o,t,ks),p=_t.dot(h,u),p<0||p>c)return;if(d=_t.cross(h,s,Us),f=_t.dot(a,d),f<0||p+f>c)return;m=_t.dot(l,d)/c;}else {if(Math.abs(c)<ot.CesiumMath.EPSILON6)return;const e=1/c;if(h=_t.subtract(o,t,ks),p=_t.dot(h,u)*e,p<0||p>1)return;if(d=_t.cross(h,s,Us),f=_t.dot(a,d)*e,f<0||p+f>1)return;m=_t.dot(l,d)*e;}return m},Fs.rayTriangle=function(e,t,i,n,r,o){const a=Fs.rayTriangleParametric(e,t,i,n,r);if($(a)&&!(a<0))return $(o)||(o=new _t),_t.multiplyByScalar(e.direction,a,o),_t.add(e.origin,o,o)};const Gs=new Ds;Fs.lineSegmentTriangle=function(e,t,i,n,r,o,a){const s=Gs;_t.clone(e,s.origin),_t.subtract(t,e,s.direction),_t.normalize(s.direction,s.direction);const l=Fs.rayTriangleParametric(s,i,n,r,o);if(!(!$(l)||l<0||l>_t.distance(e,t)))return $(a)||(a=new _t),_t.multiplyByScalar(s.direction,l,a),_t.add(s.origin,a,a)};const Hs={root0:0,root1:0};function Ys(e,t,i){$(i)||(i={start:0,stop:0});const n=e.direction,r=t.radius*t.radius,o=_t.subtract(e.origin,t.center,Vs),a=function(e,t,i,n){const r=t*t-4*e*i;if(r<0)return;if(r>0){const i=1/(2*e),o=Math.sqrt(r),a=(-t+o)*i,s=(-t-o)*i;return a<s?(n.root0=a,n.root1=s):(n.root0=s,n.root1=a),n}const o=-t/(2*e);return 0!==o?(n.root0=n.root1=o,n):void 0}(_t.dot(n,n),2*_t.dot(n,o),_t.magnitudeSquared(o)-r,Hs);if($(a))return i.start=a.root0,i.stop=a.root1,i}Fs.raySphere=function(e,t,i){if($(i=Ys(e,t,i))&&!(i.stop<0))return i.start=Math.max(i.start,0),i};const qs=new Ds;Fs.lineSegmentSphere=function(e,t,i,n){const r=qs;_t.clone(e,r.origin);const o=_t.subtract(t,e,r.direction),a=_t.magnitude(o);if(_t.normalize(o,o),!(!$(n=Ys(r,i,n))||n.stop<0||n.start>a))return n.start=Math.max(n.start,0),n.stop=Math.min(n.stop,a),n};const Xs=new _t,Ws=new _t;function js(e,t,i){const n=e+t;return Math.sign(e)!==Math.sign(t)&&Math.abs(n/Math.max(Math.abs(e),Math.abs(t)))<i?0:n}Fs.rayEllipsoid=function(e,t){const i=t.oneOverRadii,n=_t.multiplyComponents(i,e.origin,Xs),r=_t.multiplyComponents(i,e.direction,Ws),o=_t.magnitudeSquared(n),a=_t.dot(n,r);let s,l,u,c,h;if(o>1){if(a>=0)return;const e=a*a;if(s=o-1,l=_t.magnitudeSquared(r),u=l*s,e<u)return;if(e>u){c=a*a-u,h=-a+Math.sqrt(c);const e=h/l,t=s/h;return e<t?{start:e,stop:t}:{start:t,stop:e}}const t=Math.sqrt(s/l);return {start:t,stop:t}}return o<1?(s=o-1,l=_t.magnitudeSquared(r),u=l*s,c=a*a-u,h=-a+Math.sqrt(c),{start:0,stop:h/l}):a<0?(l=_t.magnitudeSquared(r),{start:0,stop:-a/l}):void 0};const $s=new _t,Zs=new _t,Ks=new _t,Qs=new _t,Js=new _t,el=new Nt,tl=new Nt,il=new Nt,nl=new Nt,rl=new Nt,ol=new Nt,al=new Nt,sl=new _t,ll=new _t;Fs.grazingAltitudeLocation=function(e,t){const i=e.origin,n=e.direction;if(!_t.equals(i,_t.ZERO)){const e=t.geodeticSurfaceNormal(i,$s);if(_t.dot(n,e)>=0)return i}const r=$(this.rayEllipsoid(e,t)),o=t.transformPositionToScaledSpace(n,$s),a=_t.normalize(o,o),s=_t.mostOrthogonalAxis(o,Qs),l=_t.normalize(_t.cross(s,a,Zs),Zs),u=_t.normalize(_t.cross(a,l,Ks),Ks),c=el;c[0]=a.x,c[1]=a.y,c[2]=a.z,c[3]=l.x,c[4]=l.y,c[5]=l.z,c[6]=u.x,c[7]=u.y,c[8]=u.z;const h=c.transpose(tl),d=Nt.fromScale(t.radii,il),p=Nt.fromScale(t.oneOverRadii,nl),f=rl;f[0]=0,f[1]=-n.z,f[2]=n.y,f[3]=n.z,f[4]=0,f[5]=-n.x,f[6]=-n.y,f[7]=n.x,f[8]=0;const m=Nt.multiply(Nt.multiply(h,p,ol),f,ol),_=Nt.multiply(Nt.multiply(m,d,al),c,al),g=Nt.multiplyByVector(m,i,Js),y=function(e,t,i,n,r){const o=1*(e[It.COL1ROW1]-e[It.COL2ROW2]),a=1*(0*js(e[It.COL1ROW0],e[It.COL0ROW1],ot.CesiumMath.EPSILON15)+t.y),s=0*e[It.COL0ROW0]+1*e[It.COL2ROW2]+0*t.x+0,l=1*js(e[It.COL2ROW1],e[It.COL1ROW2],ot.CesiumMath.EPSILON15),u=1*(0*js(e[It.COL2ROW0],e[It.COL0ROW2])+t.z);let c;const h=[];if(0===u&&0===l){if(c=Es.computeRealRoots(o,a,s),0===c.length)return h;const e=c[0],t=Math.sqrt(Math.max(1-e*e,0));if(h.push(new _t(0,1*e,1*-t)),h.push(new _t(0,1*e,1*t)),2===c.length){const e=c[1],t=Math.sqrt(Math.max(1-e*e,0));h.push(new _t(0,1*e,1*-t)),h.push(new _t(0,1*e,1*t));}return h}const d=u*u,p=l*l,f=u*l,m=o*o+p,_=2*(a*o+f),g=2*s*o+a*a-p+d,y=2*(s*a-f);if(0===m&&0===_&&0===g&&0===y)return h;c=Is.computeRealRoots(m,_,g,y,s*s-d);const x=c.length;if(0===x)return h;for(let e=0;e<x;++e){const t=c[e],i=t*t,n=Math.max(1-i,0),r=Math.sqrt(n);let d;d=Math.sign(o)===Math.sign(s)?js(o*i+s,a*t,ot.CesiumMath.EPSILON12):Math.sign(s)===Math.sign(a*t)?js(o*i,a*t+s,ot.CesiumMath.EPSILON12):js(o*i+a*t,s,ot.CesiumMath.EPSILON12);const p=d*js(l*t,u,ot.CesiumMath.EPSILON15);p<0?h.push(new _t(0,1*t,1*r)):p>0?h.push(new _t(0,1*t,1*-r)):0!==r?(h.push(new _t(0,1*t,1*-r)),h.push(new _t(0,1*t,1*r)),++e):h.push(new _t(0,1*t,1*r));}return h}(_,_t.negate(g,$s));let x,v;const w=y.length;if(w>0){let e=_t.clone(_t.ZERO,ll),o=Number.NEGATIVE_INFINITY;for(let t=0;t<w;++t){x=Nt.multiplyByVector(d,Nt.multiplyByVector(c,y[t],sl),sl);const r=_t.normalize(_t.subtract(x,i,Qs),Qs),a=_t.dot(r,n);a>o&&(o=a,e=_t.clone(x,e));}const a=new Ps,s=t.cartesianToCartographic(e,a);return o=ze(o,0,1),v=_t.magnitude(_t.subtract(e,i,Qs))*Math.sqrt(1-o*o),v=r?-v:v,s.height=v,t.cartographicToCartesianInRadians(s,new _t)}};const ul=new _t;Fs.lineSegmentPlane=function(e,t,i,n){$(n)||(n=new _t);const r=_t.subtract(t,e,ul),o=i.normal,a=_t.dot(o,r);if(Math.abs(a)<ot.CesiumMath.EPSILON6)return;const s=_t.dot(o,e),l=-(i.distance+s)/a;return l<0||l>1?void 0:(_t.multiplyByScalar(r,l,n),_t.add(e,n,n),n)},Fs.trianglePlaneIntersection=function(e,t,i,n){const r=n.normal,o=n.distance,a=_t.dot(r,e)+o<0,s=_t.dot(r,t)+o<0,l=_t.dot(r,i)+o<0;let u,c,h=0;if(h+=a?1:0,h+=s?1:0,h+=l?1:0,1!==h&&2!==h||(u=new _t,c=new _t),1===h){if(a)return Fs.lineSegmentPlane(e,t,n,u),Fs.lineSegmentPlane(e,i,n,c),{positions:[e,t,i,u,c],indices:[0,3,4,1,2,4,1,4,3]};if(s)return Fs.lineSegmentPlane(t,i,n,u),Fs.lineSegmentPlane(t,e,n,c),{positions:[e,t,i,u,c],indices:[1,3,4,2,0,4,2,4,3]};if(l)return Fs.lineSegmentPlane(i,e,n,u),Fs.lineSegmentPlane(i,t,n,c),{positions:[e,t,i,u,c],indices:[2,3,4,0,1,4,0,4,3]}}else if(2===h){if(!a)return Fs.lineSegmentPlane(t,e,n,u),Fs.lineSegmentPlane(i,e,n,c),{positions:[e,t,i,u,c],indices:[1,2,4,1,4,3,0,3,4]};if(!s)return Fs.lineSegmentPlane(i,t,n,u),Fs.lineSegmentPlane(e,t,n,c),{positions:[e,t,i,u,c],indices:[2,0,4,2,4,3,1,3,4]};if(!l)return Fs.lineSegmentPlane(e,i,n,u),Fs.lineSegmentPlane(t,i,n,c),{positions:[e,t,i,u,c],indices:[0,1,4,0,4,3,2,3,4]}}};class cl{constructor(e,t,i){const n=Z(i,hi.WGS84);this._ellipsoid=n,this._start=new _t,this._end=new _t,this._constants={},this._startHeading=void 0,this._endHeading=void 0,this._distance=void 0,this._uSquared=void 0;}get ellipsoid(){return this._ellipsoid}get surfaceDistance(){return this._distance}get start(){return this._start}get end(){return this._end}get startHeading(){return this._startHeading}get endHeading(){return this._endHeading}setConstants(e){const t=e._uSquared,i=e._ellipsoid.maximumRadius,n=e._ellipsoid.minimumRadius,r=(i-n)/i,o=Math.cos(e._startHeading),a=Math.sin(e._startHeading),s=(1-r)*Math.tan(e._start.y),l=1/Math.sqrt(1+s*s),u=l*s,c=Math.atan2(s,o),h=l*a,d=h*h,p=1-d,f=Math.sqrt(p),m=t/4,_=m*m,g=_*m,y=_*_,x=1+m-3*_/4+5*g/4-175*y/64,v=1-m+15*_/8-35*g/8,w=1-3*m+35*_/4,T=1-5*m,b=x*c-v*Math.sin(2*c)*m/2-w*Math.sin(4*c)*_/16-T*Math.sin(6*c)*g/48-5*Math.sin(8*c)*y/512,P=e._constants;P.a=i,P.b=n,P.f=r,P.cosineHeading=o,P.sineHeading=a,P.tanU=s,P.cosineU=l,P.sineU=u,P.sigma=c,P.sineAlpha=h,P.sineSquaredAlpha=d,P.cosineSquaredAlpha=p,P.cosineAlpha=f,P.u2Over4=m,P.u4Over16=_,P.u6Over64=g,P.u8Over256=y,P.a0=x,P.a1=v,P.a2=w,P.a3=T,P.distanceRatio=b;}computeC(e,t){return e*t*(4+e*(4-3*t))/16}computeDeltaLambda(e,t,i,n,r,o,a){const s=this.computeC(e,i);return (1-s)*e*t*(n+s*r*(a+s*o*(2*a*a-1)))}vincentyInverseFormula(e,t,i,n,r,o,a){const s=(t-i)/t,l=o-n,u=Math.atan((1-s)*Math.tan(r)),c=Math.atan((1-s)*Math.tan(a)),h=Math.cos(u),d=Math.sin(u),p=Math.cos(c),f=Math.sin(c),m=h*p,_=h*f,g=d*f,y=d*p;let x,v,w,T,b,P=l,S=ot.TRANSFORM.TWO_PI,E=Math.cos(P),A=Math.sin(P);do{E=Math.cos(P),A=Math.sin(P);const e=_-y*E;let t;w=Math.sqrt(p*p*A*A+e*e),v=g+m*E,x=Math.atan2(w,v),0===w?(t=0,T=1):(t=m*A/w,T=1-t*t),S=P,b=v-2*g/T,isFinite(b)||(b=0),P=l+this.computeDeltaLambda(s,t,T,x,w,v,b);}while(Math.abs(P-S)>ot.TRANSFORM.EPSILON12);const C=T*(t*t-i*i)/(i*i),M=C*(256+C*(C*(74-47*C)-128))/1024,I=b*b,L=i*(1+C*(4096+C*(C*(320-175*C)-768))/16384)*(x-M*w*(b+M*(v*(2*I-1)-M*b*(4*w*w-3)*(4*I-3)/6)/4)),N=Math.atan2(p*A,_-y*E),R=Math.atan2(h*A,_*E-y);e._distance=L,e._startHeading=N,e._endHeading=R,e._uSquared=C;}computeProperties(e,t,i,n){this.vincentyInverseFormula(e,n.maximumRadius,n.minimumRadius,t.x,t.y,i.x,i.y),e._start=_t.clone(t,e._start),e._end=_t.clone(i,e._end),e._start.z=0,e._end.z=0,this.setConstants(e);}setEndPoints(e,t,i){this.computeProperties(this,e,t,this._ellipsoid,i);}interpolateUsingFraction(e,t){return this.interpolateUsingSurfaceDistance(this._distance*e,t)}interpolateUsingSurfaceDistance(e,t){const i=this._constants,n=i.distanceRatio+e/i.b,r=Math.cos(2*n),o=Math.cos(4*n),a=Math.cos(6*n),s=Math.sin(2*n),l=Math.sin(4*n),u=Math.sin(6*n),c=Math.sin(8*n),h=n*n,d=i.u8Over256,p=i.u2Over4,f=i.u6Over64,m=i.u4Over16;let _=n*h*2*d*r/3+n*(1-p+7*m/4-15*f/4+579*d/64-(m-15*f/4+187*d/16)*r-(5*f/4-115*d/16)*o-29*d*a/16)+(p/2-m+71*f/32-85*d/16)*s+(5*m/16-5*f/4+383*d/96)*l-h*((f-11*d/2)*s+5*d*l/2)+(29*f/96-29*d/16)*u+539*d*c/1536;const g=Math.asin(Math.sin(_)*i.cosineAlpha),y=Math.atan(i.a/i.b*Math.tan(g));_-=i.sigma;const x=Math.cos(2*i.sigma+_),v=Math.sin(_),w=Math.cos(_),T=Math.atan2(v*i.sineHeading,i.cosineU*w-i.sineU*v*i.cosineHeading)-this.computeDeltaLambda(i.f,i.sineAlpha,i.cosineSquaredAlpha,_,v,w,x);return $(t)?(t.x=this._start.x+T,t.y=y,t.z=0,t):new _t(this._start.x+T,y,0)}}class hl{constructor(e){let t;this.name="DeveloperError",this.message=e;try{throw new Error}catch(e){t=e.stack;}this.stack=t;}toString(){let e=`${this.name}: ${this.message}`;return $(this.stack)&&(e+=`\n${this.stack.toString()}`),e}static throwInstantiationError(){throw new hl("This function defines an interface and should not be called directly.")}}function dl(e,t,i){i[e]&&-1!==i[e].indexOf(t)||(i[e]=i[e]||[],i[e].push(t));}function pl(e,t,i){if(i&&i[e]){const n=i[e].indexOf(t);-1!==n&&i[e].splice(n,1);}}class fl{constructor(e,t={}){Ve(this,t),this.type=e;}}class ml extends fl{constructor(e,t={}){super("error",Ve({error:e},t));}}class _l{on(e,t){return this._listeners=this._listeners||{},dl(e,t,this._listeners),this}off(e,t){return pl(e,t,this._listeners),pl(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},dl(e,t,this._oneTimeListeners),this):new Promise((t=>this.once(e,t)))}fire(e,t){"string"==typeof e&&(e=new fl(e,t||{}));const i=e.type;if(this.listens(i)){e.target=this;const t=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const i of t)i&&i.call(this,e);const n=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const t of n)pl(i,t,this._oneTimeListeners),t&&t.call(this,e);const r=this._eventedParent;r&&(Ve(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),r.fire(e));}else e instanceof ml&&console.error(e.error);return this}listens(e){return !!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}const gl=Object.freeze(new _t(1,0,0)),yl=Object.freeze(new _t(0,1,0)),xl=Object.freeze(new _t(0,0,1));class vl extends _l{constructor(){super(),this.isObject3D=!0,this.type="Object3D",this._rotation=new _t(0,0,0),this._quaternion=new Et,this._scale=new _t(1,1,1),this._position=new _t(0,0,0),this._matrix=new Bt,this._matrixWorld=new Bt,this.matrixAutoUpdate=wl,this.matrixWorldNeedsUpdate=!1,this.unmodified=!1,this.parent=null,this.visible=!0,this.children=[],this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!1;}get target(){return this._target}set target(e){this.unmodified=!1,this._target=e;}set up(e){this.unmodified=!1,this._up=e;}get up(){return this._up||_t.normalize(new _t(this.matrix[4],this.matrix[5],this.matrix[6]),new _t)}get right(){return _t.normalize(new _t(this.matrix[0],this.matrix[1],this.matrix[2]),new _t)}get direction(){return _t.normalize(new _t(this.matrix[8],this.matrix[9],this.matrix[10]),new _t)}get quaternion(){return this._quaternion}set quaternion(e){this.unmodified=!1,this._quaternion=e;}get position(){return this._position}set position(e){if(this.unmodified=!1,3!==e.length)throw new Error("position must be a array of length 3!");this._position=e,this.updateMatrixWorld(!0);}get cartographicPosition(){const e=Nu.cartesian3ToCartographic(this._position);return $(e)?e:this._position}set cartographicPosition(e){if(this.unmodified=!1,3!==e.length)throw new Error("position must be a array of length 3!");const t=Nu.cartographicToCartesian3([...e]);this._position=t,this.updateMatrixWorld(!0);}get rotation(){return this._rotation}set rotation(e){this.unmodified=!1,this._rotation=e;}get scale(){return this._scale}set scale(e){this.unmodified=!1,this._scale=e,this.updateMatrixWorld(!0);}get matrix(){return this._matrix}set matrix(e){this.unmodified=!1,this._matrix=e;}get matrixWorld(){return this._matrixWorld}set matrixWorld(e){this.unmodified=!1,this._matrixWorld=e;}get modelViewMatrix(){return new Bt}get normalMatrix(){return new Nt}setMatrix(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix=e,this.matrix.decompose(this.position,this.quaternion,this.scale);}applyMatrix(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.multiplyLeft(e),this.matrix.decompose(this.position,this.quaternion,this.scale);}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromEuler(e){this.quaternion=e.getQuaternion();}setRotationFromMatrix(e){this.quaternion.fromRotationMatrix4(e);}setRotationFromQuaternion(e){this.quaternion.copy(e);}rotateOnAxis(e,t){const i=(new Et).fromAxisRotation(e,t);return this.quaternion.multiplyRight(i),this}rotateOnWorldAxis(e,t){const i=(new Et).fromAxisRotation(e,t);return this.quaternion.multiplyLeft(i),this}rotateX(e){return this.rotateOnAxis(gl,e)}rotateY(e){return this.rotateOnAxis(yl,e)}rotateZ(e){return this.rotateOnAxis(xl,e)}translateOnAxis(e,t){const i=new _t;return i.copy(e).applyQuaternion(this.quaternion),this.position.add(i.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(gl,e)}translateY(e){return this.translateOnAxis(yl,e)}translateZ(e){return this.translateOnAxis(xl,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.transform(this.matrixWorld.clone().invert())}lookAt(e){const t=new _t(e),i=this.parent;this.updateWorldMatrix(!0,!1);const n=new _t;n.setFromMatrixPosition(this.matrixWorld);let r=new Bt;if(this.isCamera||this.isLight?r.lookAt(n,t,this.up):r.lookAt(t,n,this.up),this.quaternion.fromRotationMatrix4(r),i){r=i.matrixWorld.clone().extractRotation();const e=(new Et).fromRotationMatrix4(r);this.quaternion.multiplyLeft(e.invert());}}addObject3DsWithoutParent(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.addObject3DsWithoutParent(arguments[e]);return this}return e===this?(console.error("不能将自己添加为自己的child",e),this):(e&&e.isObject3D?e.parent||(e.parent=this,this.children.push(e)):console.error("添加的object必须是Object3D的类型",e),this)}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("不能将自己添加为自己的child",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e)):console.error("添加的object必须是Object3D的类型",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return -1!==t&&(e.parent=null,this.children.splice(t,1)),this}attach(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.clone().invert();return null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),t.multiplyRight(e.parent.matrixWorld)),e.applyMatrix(t),e.updateWorldMatrix(!1,!1),this.add(e),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(e,t);if(void 0!==n)return n}}getWorldPosition(e){return void 0===e&&(e=new _t),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return void 0===e&&(e=new Et),this.updateMatrixWorld(!0),this.matrixWorld.decompose(new _t,e,new _t),e}getWorldScale(e){return void 0===e&&(e=new _t),this.updateMatrixWorld(!0),this.matrixWorld.decompose(new _t,new _t,e),e}getWorldDirection(e){void 0===e&&(e=new _t),this.updateMatrixWorld(!0);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e);}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e);}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e));}updateMatrix(){const e=this._computedScale?_t.multiplyByScalar(this.scale,this._computedScale):this.scale;this.matrix.compose(this.position,this.quaternion,e),this.matrixWorldNeedsUpdate=!0;}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld=this.parent.matrixWorld.clone().multiplyRight(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].updateMatrixWorld(e);this.unmodified=!0;}updateWorldMatrix(e,t){const i=this.parent;if(!0===e&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld=this.parent.matrixWorld.clone().multiplyRight(this.matrix),!0===t){const e=this.children;for(let t=0,i=e.length;t<i;t++)e[t].updateWorldMatrix(!1,!0);}this.unmodified=!0;}clone(e){return (new this.constructor).copy(this,e)}copy(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.visible=e.visible,this.frustumCulled=e.frustumCulled,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++)this.add(e.children[t].clone());return this}}const wl=!0,Tl=new _t(0,1,0),bl=new _t,Pl=new _t;function Sl(e){const t=e.transform.getCameraPos(),i=new Ds(t,Al(e.canvasX,e.canvasY,.999999,e.transform)),n=Fs.rayEllipsoid(i,e.ellipsoid?e.ellipsoid:Nu.DefaultEllipsoid);if(n){const t=i.origin.clone().add(i.direction.clone().multiplyScalar(n.start)),r=Nu.cartesian3ToCartographic(t,e.ellipsoid?e.ellipsoid:Nu.DefaultEllipsoid);return {lngLat:new fi(r[0],r[1]),cartographic:r,cartesian:t,ray:i}}return {lngLat:null,cartesian:null,cartographic:null,ray:i}}function El(e){const t=Fs.rayEllipsoid(e,Nu.DefaultEllipsoid);if(t){const i=e.origin.clone().add(e.direction.clone().multiplyScalar(t.start));return {cartographic:Nu.cartesian3ToCartographic(i),cartesian:i}}return {cartographic:null,cartesian:null}}function Al(e,t,i,n){const r=n.getCameraPos(),o=new St(n.width?2*e/n.width-1:0,n.height?1-2*t/n.height:0,i,1);return function(e,t){e.transform(t.activeCamera.projectionMatrixInverse),e.scale(1/e[3]),e.transform(t.activeCamera.matrixWorld);}(o,n),new _t(o).sub(r).normalize()}function Cl(e,t,i){if(t<2)return 18040095.69614729*(2-t)+18040095.69614729;if(t<=24){const n=1/Math.tan(e/2),r=1;return i*Math.sqrt(Math.pow(n,2)+Math.pow(r,2))*Math.sin(Math.PI/Math.pow(2,t)+e/2)}return 6378140.582985588-t+24}function Ml(e,t,i){if(t>18040095.69614729)return 3-t/18040095.69614729;if(t<6378140.582985588)return 6378164.582985588-t;{const n=1/Math.tan(e/2),r=1,o=t/i/Math.sqrt(Math.pow(n,2)+Math.pow(r,2)),a=Math.asin(o);return Math.log2(Math.PI/(a-e/2))}}function Il(e,t,i,n,r,o,a){const s=Math.pow(2,o),l=n+e/8192,u=r+t/8192,c=yi(a),h=c.xLng(l,s),d=c.yLat(u,s);return Nu.cartographicToCartesian3([h,d,i])}function Ll(e,t,i,n){const r=i,o=e,a=t,s=yi(n);return [s.xLng(o,r),s.yLat(a,r)]}function Nl(e,t,i,n,r){const o=Ll(e,t,Math.pow(2,i),n);return Nu.cartographicToCartesian3([o[0],o[1],r||0])}function Rl(e){const t=new Bt;return t[12]=e[0],t[13]=e[1],t[14]=e[2],t}function Ol(e,t,i){return (1-i)*e+i*t}function Dl(e,t,i){return e<t?t:e>i?i:e}function Fl(e){return (new Nt).getNormalMatrix(e)}function zl(e,t){const i=Cl(t,e[2],ot.TRANSFORM.R)-ot.TRANSFORM.R,n=function(e){const t=new _t(e.cartographic[0],e.cartographic[1],0),i=Nu.cartographicToCartesian3(t),n=Nu.localFrameToFixedFrame(i),r=(new Bt).rotateZ(-e.bearing*ot.TRANSFORM.DEG_TO_RAD).rotateY(-e.roll*ot.TRANSFORM.DEG_TO_RAD).rotateX(e.pitch*ot.TRANSFORM.DEG_TO_RAD),o=new _t(0,0,e.cartographic[2]).transform(r);return r[12]=o.x,r[13]=o.y,r[14]=o.z,n.multiplyRight(r),n}({cartographic:[e[0],e[1],i],bearing:e[3],pitch:e[4],roll:e.length>5?e[5]:0}),r=Nu.fixedFrameToHeadingPitchRoll(n),o=Nu.cartesian3ToCartographic(new _t(n[12],n[13],n[14])),a=Ml(t,o[2]+ot.TRANSFORM.R,ot.TRANSFORM.R),s=Dl(r.roll,0,Math.PI/2),l=Be(r.heading,-Math.PI,Math.PI),u=Be(r.pitch,-Math.PI,Math.PI);return [o[0],o[1],a,l*ot.TRANSFORM.RAD_TO_DEG,s*ot.TRANSFORM.RAD_TO_DEG,u*ot.TRANSFORM.RAD_TO_DEG,new _t(o)]}function Bl(e){let t=Math.floor(0),i=e.height;const n=e.width/2;let r,o,a,s=Sl({canvasX:n,canvasY:i,transform:e});for(r=s.ray;i>t;){const l=Math.floor((t+i)/2);if(s=Sl({canvasX:n,canvasY:l,transform:e}),r=s.ray,s.lngLat?(o=[s.lngLat.lng,s.lngLat.lat,0],a=s.cartesian,i=l):t=l,i-t<4)break}return o?{cartesian:a,cartographic:o,ray:r}:null}function Vl(e){let t=Math.floor(e.height/2),i=e.height;const n=e.width/2;let r,o,a,s=Sl({canvasX:n,canvasY:i,transform:e});if(r=s.ray,s.lngLat)return {cartesian:s.cartesian,cartographic:[s.lngLat.lng,s.lngLat.lat,0],ray:r};for(;i>t;){const l=Math.floor((t+i)/2);if(s=Sl({canvasX:n,canvasY:l,transform:e}),r=s.ray,s.lngLat?(o=[s.lngLat.lng,s.lngLat.lat,0],a=s.cartesian,t=l):i=l,i-t<4)break}return o?{cartesian:a,cartographic:o,ray:r}:null}function kl(e,t,i){let n,r;const o=Cl(t,e[2],ot.TRANSFORM.R)-ot.TRANSFORM.R,a=_t.fromDegrees(e[0],e[1],o),s=Nu.headingPitchRollToFixedFrame(a,new st(e[3]*ot.TRANSFORM.DEG_TO_RAD,e[4]*ot.TRANSFORM.DEG_TO_RAD,e[5]*ot.TRANSFORM.DEG_TO_RAD));if(Sl({canvasX:i.width/2,canvasY:0,transform:i}).lngLat){const e=El(new Ds([s[12],s[13],s[14]],new _t(s[8],s[9],s[10]).normalize().multiplyScalar(-1)));n=e.cartographic,r=e.cartesian;}else if(Sl({canvasX:i.width/2,canvasY:i.height,transform:i}).lngLat){const e=Bl(i);if(!e||!e.cartographic||!e.cartesian)return null;const t=Vl(i),o=e.ray,a=new Ds(o.origin,_t.add(o.direction,t.ray.direction).normalize()),s=Fs.rayEllipsoid(a,Nu.DefaultEllipsoid);r=a.origin.clone().add(a.direction.clone().multiplyScalar(s.start)),n=Nu.cartesian3ToCartographic(r,Nu.DefaultEllipsoid),n[2]=0;}else {const e=Sl({canvasX:i.width/2,canvasY:i.height/2,transform:i});if(!e.lngLat)return null;n=e.cartographic,r=e.cartesian;}if(!r||!n)return null;const l=Nu.localFrameToFixedFrame(r).invert().multiplyRight(s),u=new Nt;u[0]=l[0],u[1]=l[1],u[2]=l[2],u[3]=l[4],u[4]=l[5],u[5]=l[6],u[6]=l[8],u[7]=l[9],u[8]=l[10];const c=new Et;c.fromMatrix3(u);const h=st.fromQuaternion(c);let d=h.heading*ot.TRANSFORM.RAD_TO_DEG;Math.abs(e[3]-d)<.01&&(d=e[3]);const p=h.roll*ot.TRANSFORM.RAD_TO_DEG,f=h.pitch*ot.TRANSFORM.RAD_TO_DEG,m=Ml(t,new _t(s[12]-r[0],s[13]-r[1],s[14]-r[2]).len()+ot.TRANSFORM.R,ot.TRANSFORM.R);return [n[0],n[1],m,d,Dl(p,0,180),f]}const Ul={};function Gl(e,t,i){return `Expected ${i} to be typeof ${t}, actual typeof was ${e}`}function Hl(e,t,i){Ul.defined("array",e),Ul.defined("itemToFind",t),Ul.defined("comparator",i);let n,r,o=0,a=e.length-1;for(;o<=a;)if(n=~~((o+a)/2),r=i(e[n],t),r<0)o=n+1;else {if(!(r>0))return n;a=n-1;}return ~(a+1)}function Yl(e,t,i,n,r,o,a,s){this.year=e,this.month=t,this.day=i,this.hour=n,this.minute=r,this.second=o,this.millisecond=a,this.isLeapSecond=s;}function ql(e){if(null===e||isNaN(e))throw new hl("year is required and must be a number.");return e%4==0&&e%100!=0||e%400==0}function Xl(e,t){this.julianDate=e,this.offset=t;}Ul.typeOf={},Ul.defined=function(e,t){if(!$(t))throw new hl(function(e){return `${e} is required, actual value was undefined`}(e))},Ul.typeOf.func=function(e,t){if("function"!=typeof t)throw new hl(Gl(typeof t,"function",e))},Ul.typeOf.string=function(e,t){if("string"!=typeof t)throw new hl(Gl(typeof t,"string",e))},Ul.typeOf.number=function(e,t){if("number"!=typeof t)throw new hl(Gl(typeof t,"number",e))},Ul.typeOf.number.lessThan=function(e,t,i){if(Ul.typeOf.number(e,t),t>=i)throw new hl(`Expected ${e} to be less than ${i}, actual value was ${t}`)},Ul.typeOf.number.lessThanOrEquals=function(e,t,i){if(Ul.typeOf.number(e,t),t>i)throw new hl(`Expected ${e} to be less than or equal to ${i}, actual value was ${t}`)},Ul.typeOf.number.greaterThan=function(e,t,i){if(Ul.typeOf.number(e,t),t<=i)throw new hl(`Expected ${e} to be greater than ${i}, actual value was ${t}`)},Ul.typeOf.number.greaterThanOrEquals=function(e,t,i){if(Ul.typeOf.number(e,t),t<i)throw new hl(`Expected ${e} to be greater than or equal to ${i}, actual value was ${t}`)},Ul.typeOf.object=function(e,t){if("object"!=typeof t)throw new hl(Gl(typeof t,"object",e))},Ul.typeOf.bool=function(e,t){if("boolean"!=typeof t)throw new hl(Gl(typeof t,"boolean",e))},Ul.typeOf.bigint=function(e,t){if("bigint"!=typeof t)throw new hl(Gl(typeof t,"bigint",e))},Ul.typeOf.number.equals=function(e,t,i,n){if(Ul.typeOf.number(e,i),Ul.typeOf.number(t,n),i!==n)throw new hl(`${e} must be equal to ${t}, the actual values are ${i} and ${n}`)};var Wl=Object.freeze({SECONDS_PER_MILLISECOND:.001,SECONDS_PER_MINUTE:60,MINUTES_PER_HOUR:60,HOURS_PER_DAY:24,SECONDS_PER_HOUR:3600,MINUTES_PER_DAY:1440,SECONDS_PER_DAY:86400,DAYS_PER_JULIAN_CENTURY:36525,PICOSECOND:1e-9,MODIFIED_JULIAN_DATE_DIFFERENCE:2400000.5}),jl=Object.freeze({UTC:0,TAI:1});const $l=new Yl,Zl=[31,28,31,30,31,30,31,31,30,31,30,31];function Kl(e,t){return pu.compare(e.julianDate,t.julianDate)}const Ql=new Xl;function Jl(e){Ql.julianDate=e;const t=pu.leapSeconds;let i=Hl(t,Ql,Kl);i<0&&(i=~i),i>=t.length&&(i=t.length-1);let n=t[i].offset;i>0&&pu.secondsDifference(t[i].julianDate,e)>n&&(i--,n=t[i].offset),pu.addSeconds(e,n,e);}function eu(e,t){Ql.julianDate=e;const i=pu.leapSeconds;let n=Hl(i,Ql,Kl);if(n<0&&(n=~n),0===n)return pu.addSeconds(e,-i[0].offset,t);if(n>=i.length)return pu.addSeconds(e,-i[n-1].offset,t);const r=pu.secondsDifference(i[n].julianDate,e);return 0===r?pu.addSeconds(e,-i[n].offset,t):r<=1?void 0:pu.addSeconds(e,-i[--n].offset,t)}function tu(e,t,i){const n=t/Wl.SECONDS_PER_DAY|0;return e+=n,(t-=Wl.SECONDS_PER_DAY*n)<0&&(e--,t+=Wl.SECONDS_PER_DAY),i.dayNumber=e,i.secondsOfDay=t,i}function iu(e,t,i,n,r,o,a){const s=(t-14)/12|0,l=e+4800+s;let u=(1461*l/4|0)+(367*(t-2-12*s)/12|0)-(3*((l+100)/100|0)/4|0)+i-32075;(n-=12)<0&&(n+=24);const c=o+(n*Wl.SECONDS_PER_HOUR+r*Wl.SECONDS_PER_MINUTE+a*Wl.SECONDS_PER_MILLISECOND);return c>=43200&&(u-=1),[u,c]}const nu=/^(\d{4})$/,ru=/^(\d{4})-(\d{2})$/,ou=/^(\d{4})-?(\d{3})$/,au=/^(\d{4})-?W(\d{2})-?(\d{1})?$/,su=/^(\d{4})-?(\d{2})-?(\d{2})$/,lu=/([Z+\-])?(\d{2})?:?(\d{2})?$/,uu=/^(\d{2})(\.\d+)?/.source+lu.source,cu=/^(\d{2}):?(\d{2})(\.\d+)?/.source+lu.source,hu=/^(\d{2}):?(\d{2}):?(\d{2})(\.\d+)?/.source+lu.source,du="Invalid ISO 8601 date.";function pu(e,t,i){this.dayNumber=void 0,this.secondsOfDay=void 0,e=Z(e,0),t=Z(t,0),i=Z(i,jl.UTC);const n=0|e;tu(n,t+=(e-n)*Wl.SECONDS_PER_DAY,this),i===jl.UTC&&Jl(this);}pu.fromGregorianDate=function(e,t){if(!(e instanceof Yl))throw new hl("date must be a valid GregorianDate.");const i=iu(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond);return $(t)?(tu(i[0],i[1],t),Jl(t),t):new pu(i[0],i[1],jl.UTC)},pu.fromDate=function(e,t){if(!(e instanceof Date)||isNaN(e.getTime()))throw new hl("date must be a valid JavaScript Date.");const i=iu(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds());return $(t)?(tu(i[0],i[1],t),Jl(t),t):new pu(i[0],i[1],jl.UTC)},pu.fromIso8601=function(e,t){if("string"!=typeof e)throw new hl(du);let i,n=(e=e.replace(",",".")).split("T"),r=1,o=1,a=0,s=0,l=0,u=0;const c=n[0],h=n[1];let d,p,f,m;if(!$(c))throw new hl(du);if(n=c.match(su),null!==n){if(f=c.split("-").length-1,f>0&&2!==f)throw new hl(du);i=+n[1],r=+n[2],o=+n[3];}else if(n=c.match(ru),null!==n)i=+n[1],r=+n[2];else if(n=c.match(nu),null!==n)i=+n[1];else {let e;if(n=c.match(ou),null!==n){if(i=+n[1],e=+n[2],p=ql(i),e<1||p&&e>366||!p&&e>365)throw new hl(du)}else {if(n=c.match(au),null===n)throw new hl(du);{i=+n[1];const t=+n[2],r=+n[3]||0;if(f=c.split("-").length-1,f>0&&(!$(n[3])&&1!==f||$(n[3])&&2!==f))throw new hl(du);e=7*t+r-new Date(Date.UTC(i,0,4)).getUTCDay()-3;}}d=new Date(Date.UTC(i,0,1)),d.setUTCDate(e),r=d.getUTCMonth()+1,o=d.getUTCDate();}if(p=ql(i),r<1||r>12||o<1||(2!==r||!p)&&o>Zl[r-1]||p&&2===r&&o>29)throw new hl(du);if($(h)){if(n=h.match(hu),null!==n){if(f=h.split(":").length-1,f>0&&2!==f&&3!==f)throw new hl(du);a=+n[1],s=+n[2],l=+n[3],u=1e3*+(n[4]||0),m=5;}else if(n=h.match(cu),null!==n){if(f=h.split(":").length-1,f>2)throw new hl(du);a=+n[1],s=+n[2],l=60*+(n[3]||0),m=4;}else {if(n=h.match(uu),null===n)throw new hl(du);a=+n[1],s=60*+(n[2]||0),m=3;}if(s>=60||l>=61||a>24||24===a&&(s>0||l>0||u>0))throw new hl(du);const e=+n[m+1],t=+(n[m+2]||0);switch(n[m]){case"+":a-=e,s-=t;break;case"-":a+=e,s+=t;break;case"Z":break;default:s+=new Date(Date.UTC(i,r-1,o,a,s)).getTimezoneOffset();}}const _=60===l;for(_&&l--;s>=60;)s-=60,a++;for(;a>=24;)a-=24,o++;for(d=p&&2===r?29:Zl[r-1];o>d;)o-=d,r++,r>12&&(r-=12,i++),d=p&&2===r?29:Zl[r-1];for(;s<0;)s+=60,a--;for(;a<0;)a+=24,o--;for(;o<1;)r--,r<1&&(r+=12,i--),d=p&&2===r?29:Zl[r-1],o+=d;const g=iu(i,r,o,a,s,l,u);return $(t)?(tu(g[0],g[1],t),Jl(t)):t=new pu(g[0],g[1],jl.UTC),_&&pu.addSeconds(t,1,t),t},pu.now=function(e){return pu.fromDate(new Date,e)};const fu=new pu(0,0,jl.TAI);function mu(e,t,i){if(0===e)return t*i;const n=e*e,r=n*n,o=r*n,a=o*n,s=a*n,l=s*n,u=i;return t*((1-n/4-3*r/64-5*o/256-175*a/16384-441*s/65536-4851*l/1048576)*u-(3*n/8+3*r/32+45*o/1024+105*a/4096+2205*s/131072+6237*l/524288)*Math.sin(2*u)+(15*r/256+45*o/1024+525*a/16384+1575*s/65536+155925*l/8388608)*Math.sin(4*u)-(35*o/3072+175*a/12288+3675*s/262144+13475*l/1048576)*Math.sin(6*u)+(315*a/131072+2205*s/524288+43659*l/8388608)*Math.sin(8*u)-(693*s/1310720+6237*l/5242880)*Math.sin(10*u)+1001*l/8388608*Math.sin(12*u))}function _u(e,t){if(0===e)return Math.log(Math.tan(.5*(ot.CesiumMath.PI_OVER_TWO+t)));const i=e*Math.sin(t);return Math.log(Math.tan(.5*(ot.CesiumMath.PI_OVER_TWO+t)))-e/2*Math.log((1+i)/(1-i))}function gu(e,t,i,n){const r=n.maximumRadius,o=n.minimumRadius,a=r*r;e._ellipticitySquared=(a-o*o)/a,e._ellipticity=Math.sqrt(e._ellipticitySquared),e._start=Ps.clone(t,e._start),e._start.height=0,e._end=Ps.clone(i,e._end),e._end.height=0,e._heading=function(e,t,i,n,r){const o=_u(e._ellipticity,i),a=_u(e._ellipticity,r);return Math.atan2(ot.CesiumMath.negativePiToPi(n-t),a-o)}(e,t.longitude,t.latitude,i.longitude,i.latitude),e._distance=function(e,t,i,n,r,o,a){const s=e._heading,l=o-n;let u=0;if(ot.CesiumMath.equalsEpsilon(Math.abs(s),ot.CesiumMath.PI_OVER_TWO,ot.CesiumMath.EPSILON8))if(t===i)u=t*Math.cos(r)*ot.CesiumMath.negativePiToPi(l);else {const i=Math.sin(r);u=t*Math.cos(r)*ot.CesiumMath.negativePiToPi(l)/Math.sqrt(1-e._ellipticitySquared*i*i);}else {const i=mu(e._ellipticity,t,r);u=(mu(e._ellipticity,t,a)-i)/Math.cos(s);}return Math.abs(u)}(e,n.maximumRadius,n.minimumRadius,t.longitude,t.latitude,i.longitude,i.latitude);}function yu(e,t,i,n,r,o){if(0===i)return Ps.clone(e,o);const a=r*r;let s,l,u;if(Math.abs(ot.CesiumMath.PI_OVER_TWO-Math.abs(t))>ot.CesiumMath.EPSILON8){l=function(e,t,i){const n=e/i;if(0===t)return n;const r=n*n,o=r*n,a=o*n,s=t*t,l=s*s,u=l*s,c=u*s,h=c*s,d=h*s,p=Math.sin(2*n),f=Math.cos(2*n),m=Math.sin(4*n),_=Math.cos(4*n),g=Math.sin(6*n),y=Math.cos(6*n),x=Math.sin(8*n),v=Math.cos(8*n),w=Math.sin(10*n);return n+n*s/4+7*n*l/64+15*n*u/256+579*n*c/16384+1515*n*h/65536+16837*n*d/1048576+(3*n*l/16+45*n*u/256-n*(32*r-561)*c/4096-n*(232*r-1677)*h/16384+n*(399985-90560*r+512*a)*d/5242880)*f+(21*n*u/256+483*n*c/4096-n*(224*r-1969)*h/16384-n*(33152*r-112599)*d/1048576)*_+(151*n*c/4096+4681*n*h/65536+1479*n*d/16384-453*o*d/32768)*y+(1097*n*h/65536+42783*n*d/1048576)*v+8011*n*d/1048576*Math.cos(10*n)+(3*s/8+3*l/16+213*u/2048-3*r*u/64+255*c/4096-33*r*c/512+20861*h/524288-33*r*h/512+a*h/1024+28273*d/1048576-471*r*d/8192+9*a*d/4096)*p+(21*l/256+21*u/256+533*c/8192-21*r*c/512+197*h/4096-315*r*h/4096+584039*d/16777216-12517*r*d/131072+7*a*d/2048)*m+(151*u/6144+151*c/4096+5019*h/131072-453*r*h/16384+26965*d/786432-8607*r*d/131072)*g+(1097*c/131072+1097*h/65536+225797*d/10485760-1097*r*d/65536)*x+(8011*h/2621440+8011*d/1048576)*w+293393*d/251658240*Math.sin(12*n)}(mu(r,n,e.latitude)+i*Math.cos(t),r,n);const o=_u(r,e.latitude),a=_u(r,l);u=Math.tan(t)*(a-o),s=ot.CesiumMath.negativePiToPi(e.longitude+u);}else {let o;if(l=e.latitude,0===r)o=n*Math.cos(e.latitude);else {const t=Math.sin(e.latitude);o=n*Math.cos(e.latitude)/Math.sqrt(1-a*t*t);}u=i/o,s=ot.CesiumMath.negativePiToPi(t>0?e.longitude+u:e.longitude-u);}return $(o)?(o.longitude=s,o.latitude=l,o.height=0,o):new Ps(s,l,0)}function xu(e,t,i){const n=Z(i,hi.WGS84);this._ellipsoid=n,this._start=new Ps,this._end=new Ps,this._heading=void 0,this._distance=void 0,this._ellipticity=void 0,this._ellipticitySquared=void 0,$(e)&&$(t)&&gu(this,e,t,n);}pu.toGregorianDate=function(e,t){if(!$(e))throw new hl("julianDate is required.");let i=!1,n=eu(e,fu);$(n)||(pu.addSeconds(e,-1,fu),n=eu(fu,fu),i=!0);let r=n.dayNumber;const o=n.secondsOfDay;o>=43200&&(r+=1);let a=r+68569|0;const s=4*a/146097|0;a=a-((146097*s+3)/4|0)|0;const l=4e3*(a+1)/1461001|0;a=a-(1461*l/4|0)+31|0;const u=80*a/2447|0,c=a-(2447*u/80|0)|0;a=u/11|0;const h=u+2-12*a|0,d=100*(s-49)+l+a|0;let p=o/Wl.SECONDS_PER_HOUR|0,f=o-p*Wl.SECONDS_PER_HOUR;const m=f/Wl.SECONDS_PER_MINUTE|0;f-=m*Wl.SECONDS_PER_MINUTE;let _=0|f;const g=(f-_)/Wl.SECONDS_PER_MILLISECOND;return p+=12,p>23&&(p-=24),i&&(_+=1),$(t)?(t.year=d,t.month=h,t.day=c,t.hour=p,t.minute=m,t.second=_,t.millisecond=g,t.isLeapSecond=i,t):new Yl(d,h,c,p,m,_,g,i)},pu.toDate=function(e){if(!$(e))throw new hl("julianDate is required.");const t=pu.toGregorianDate(e,$l);let i=t.second;return t.isLeapSecond&&(i-=1),new Date(Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,i,t.millisecond))},pu.toIso8601=function(e,t){if(!$(e))throw new hl("julianDate is required.");const i=pu.toGregorianDate(e,$l);let n=i.year,r=i.month,o=i.day,a=i.hour;const s=i.minute,l=i.second,u=i.millisecond;let c;return 1e4===n&&1===r&&1===o&&0===a&&0===s&&0===l&&0===u&&(n=9999,r=12,o=31,a=24),$(t)||0===u?$(t)&&0!==t?(c=(.01*u).toFixed(t).replace(".","").slice(0,t),`${n.toString().padStart(4,"0")}-${r.toString().padStart(2,"0")}-${o.toString().padStart(2,"0")}T${a.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}.${c}Z`):`${n.toString().padStart(4,"0")}-${r.toString().padStart(2,"0")}-${o.toString().padStart(2,"0")}T${a.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}Z`:(c=(.01*u).toString().replace(".",""),`${n.toString().padStart(4,"0")}-${r.toString().padStart(2,"0")}-${o.toString().padStart(2,"0")}T${a.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}.${c}Z`)},pu.clone=function(e,t){if($(e))return $(t)?(t.dayNumber=e.dayNumber,t.secondsOfDay=e.secondsOfDay,t):new pu(e.dayNumber,e.secondsOfDay,jl.TAI)},pu.compare=function(e,t){if(!$(e))throw new hl("left is required.");if(!$(t))throw new hl("right is required.");const i=e.dayNumber-t.dayNumber;return 0!==i?i:e.secondsOfDay-t.secondsOfDay},pu.equals=function(e,t){return e===t||$(e)&&$(t)&&e.dayNumber===t.dayNumber&&e.secondsOfDay===t.secondsOfDay},pu.equalsEpsilon=function(e,t,i){return i=Z(i,0),e===t||$(e)&&$(t)&&Math.abs(pu.secondsDifference(e,t))<=i},pu.totalDays=function(e){if(!$(e))throw new hl("julianDate is required.");return e.dayNumber+e.secondsOfDay/Wl.SECONDS_PER_DAY},pu.secondsDifference=function(e,t){if(!$(e))throw new hl("left is required.");if(!$(t))throw new hl("right is required.");return (e.dayNumber-t.dayNumber)*Wl.SECONDS_PER_DAY+(e.secondsOfDay-t.secondsOfDay)},pu.daysDifference=function(e,t){if(!$(e))throw new hl("left is required.");if(!$(t))throw new hl("right is required.");return e.dayNumber-t.dayNumber+(e.secondsOfDay-t.secondsOfDay)/Wl.SECONDS_PER_DAY},pu.computeTaiMinusUtc=function(e){Ql.julianDate=e;const t=pu.leapSeconds;let i=Hl(t,Ql,Kl);return i<0&&(i=~i,--i,i<0&&(i=0)),t[i].offset},pu.addSeconds=function(e,t,i){if(!$(e))throw new hl("julianDate is required.");if(!$(t))throw new hl("seconds is required.");if(!$(i))throw new hl("result is required.");return tu(e.dayNumber,e.secondsOfDay+t,i)},pu.addMinutes=function(e,t,i){if(!$(e))throw new hl("julianDate is required.");if(!$(t))throw new hl("minutes is required.");if(!$(i))throw new hl("result is required.");return tu(e.dayNumber,e.secondsOfDay+t*Wl.SECONDS_PER_MINUTE,i)},pu.addHours=function(e,t,i){if(!$(e))throw new hl("julianDate is required.");if(!$(t))throw new hl("hours is required.");if(!$(i))throw new hl("result is required.");return tu(e.dayNumber,e.secondsOfDay+t*Wl.SECONDS_PER_HOUR,i)},pu.addDays=function(e,t,i){if(!$(e))throw new hl("julianDate is required.");if(!$(t))throw new hl("days is required.");if(!$(i))throw new hl("result is required.");return tu(e.dayNumber+t,e.secondsOfDay,i)},pu.lessThan=function(e,t){return pu.compare(e,t)<0},pu.lessThanOrEquals=function(e,t){return pu.compare(e,t)<=0},pu.greaterThan=function(e,t){return pu.compare(e,t)>0},pu.greaterThanOrEquals=function(e,t){return pu.compare(e,t)>=0},pu.prototype.clone=function(e){return pu.clone(this,e)},pu.prototype.equals=function(e){return pu.equals(this,e)},pu.prototype.equalsEpsilon=function(e,t){return pu.equalsEpsilon(this,e,t)},pu.prototype.toString=function(){return pu.toIso8601(this)},pu.leapSeconds=[new Xl(new pu(2441317,43210,jl.TAI),10),new Xl(new pu(2441499,43211,jl.TAI),11),new Xl(new pu(2441683,43212,jl.TAI),12),new Xl(new pu(2442048,43213,jl.TAI),13),new Xl(new pu(2442413,43214,jl.TAI),14),new Xl(new pu(2442778,43215,jl.TAI),15),new Xl(new pu(2443144,43216,jl.TAI),16),new Xl(new pu(2443509,43217,jl.TAI),17),new Xl(new pu(2443874,43218,jl.TAI),18),new Xl(new pu(2444239,43219,jl.TAI),19),new Xl(new pu(2444786,43220,jl.TAI),20),new Xl(new pu(2445151,43221,jl.TAI),21),new Xl(new pu(2445516,43222,jl.TAI),22),new Xl(new pu(2446247,43223,jl.TAI),23),new Xl(new pu(2447161,43224,jl.TAI),24),new Xl(new pu(2447892,43225,jl.TAI),25),new Xl(new pu(2448257,43226,jl.TAI),26),new Xl(new pu(2448804,43227,jl.TAI),27),new Xl(new pu(2449169,43228,jl.TAI),28),new Xl(new pu(2449534,43229,jl.TAI),29),new Xl(new pu(2450083,43230,jl.TAI),30),new Xl(new pu(2450630,43231,jl.TAI),31),new Xl(new pu(2451179,43232,jl.TAI),32),new Xl(new pu(2453736,43233,jl.TAI),33),new Xl(new pu(2454832,43234,jl.TAI),34),new Xl(new pu(2456109,43235,jl.TAI),35),new Xl(new pu(2457204,43236,jl.TAI),36),new Xl(new pu(2457754,43237,jl.TAI),37)],Object.defineProperties(xu.prototype,{ellipsoid:{get(){return this._ellipsoid}},surfaceDistance:{get(){return this._distance}},start:{get(){return this._start}},end:{get(){return this._end}},heading:{get(){return this._heading}}}),xu.fromStartHeadingDistance=function(e,t,i,n,r){const o=Z(n,hi.WGS84),a=o.maximumRadius,s=o.minimumRadius,l=a*a,u=Math.sqrt((l-s*s)/l),c=yu(e,t=ot.CesiumMath.negativePiToPi(t),i,o.maximumRadius,u);return !$(r)||$(n)&&!n.equals(r.ellipsoid)?new xu(e,c,o):(r.setEndPoints(e,c),r)},xu.prototype.setEndPoints=function(e,t){gu(this,e,t,this._ellipsoid);},xu.prototype.interpolateUsingFraction=function(e,t){return this.interpolateUsingSurfaceDistance(e*this._distance,t)},xu.prototype.interpolateUsingSurfaceDistance=function(e,t){if(!$(this._distance)||0===this._distance)throw new Error("EllipsoidRhumbLine must have distinct start and end set.");return yu(this._start,this._heading,e,this._ellipsoid.maximumRadius,this._ellipticity,t)},xu.prototype.findIntersectionWithLongitude=function(e,t){if(!$(this._distance)||0===this._distance)throw new Error("EllipsoidRhumbLine must have distinct start and end set.");const i=this._ellipticity,n=this._heading,r=Math.abs(n),o=this._start;if(e=ot.CesiumMath.negativePiToPi(e),ot.CesiumMath.equalsEpsilon(Math.abs(e),Math.PI,ot.CesiumMath.EPSILON14)&&(e=ot.CesiumMath.sign(o.longitude)*Math.PI),$(t)||(t=new Ps),Math.abs(ot.CesiumMath.PI_OVER_TWO-r)<=ot.CesiumMath.EPSILON8)return t.longitude=e,t.latitude=o.latitude,t.height=0,t;if(ot.CesiumMath.equalsEpsilon(Math.abs(ot.CesiumMath.PI_OVER_TWO-r),ot.CesiumMath.PI_OVER_TWO,ot.CesiumMath.EPSILON8)){if(ot.CesiumMath.equalsEpsilon(e,o.longitude,ot.CesiumMath.EPSILON12))return;return t.longitude=e,t.latitude=ot.CesiumMath.PI_OVER_TWO*ot.CesiumMath.sign(ot.CesiumMath.PI_OVER_TWO-n),t.height=0,t}const a=o.latitude,s=i*Math.sin(a),l=Math.tan(.5*(ot.CesiumMath.PI_OVER_TWO+a))*Math.exp((e-o.longitude)/Math.tan(n)),u=(1+s)/(1-s);let c,h=o.latitude;do{c=h;const e=i*Math.sin(c);h=2*Math.atan(l*Math.pow((1+e)/(1-e)/u,i/2))-ot.CesiumMath.PI_OVER_TWO;}while(!ot.CesiumMath.equalsEpsilon(h,c,ot.CesiumMath.EPSILON12));return t.longitude=e,t.latitude=h,t.height=0,t},xu.prototype.findIntersectionWithLatitude=function(e,t){if(!$(this._distance)||0===this._distance)throw new Error("EllipsoidRhumbLine must have distinct start and end set.");const i=this._ellipticity,n=this._heading,r=this._start;if(ot.CesiumMath.equalsEpsilon(Math.abs(n),ot.CesiumMath.PI_OVER_TWO,ot.CesiumMath.EPSILON8))return;const o=_u(i,r.latitude),a=_u(i,e),s=Math.tan(n)*(a-o),l=ot.CesiumMath.negativePiToPi(r.longitude+s);return $(t)?(t.longitude=l,t.latitude=e,t.height=0,t):new Ps(l,e,0)};const vu={};function wu(e,t,i){const n=[];let r;if(n.length=e,t===i){for(r=0;r<e;r++)n[r]=t;return n}const o=(i-t)/e;for(r=0;r<e;r++)n[r]=t+r*o;return n}function Tu(e,t,i,n,r,o,a,s){const l=new Ps,u=new Ps,c=new _t,h=new _t,d=new _t,p=n.scaleToGeodeticSurface(e,h),f=n.scaleToGeodeticSurface(t,d),m=new cl,_=vu.numberOfPoints(e,t,i),g=n.cartesianToCartographic(p,l);Qt(g,g);const y=n.cartesianToCartographic(f,u);Qt(y,y);const x=wu(_,r,o);m.setEndPoints(g,y,!0);const v=m.surfaceDistance/_;let w=s;g.height=r;let T=n.cartographicToCartesian(g,c,!0);_t.pack(T,a,w),w+=3;for(let e=1;e<_;e++){const t=m.interpolateUsingSurfaceDistance(e*v,u);t.height=x[e],T=n.cartographicToCartesian(t,c,!0),_t.pack(T,a,w),w+=3;}return w}function bu(e,t,i,n,r,o,a,s){const l=new Ps,u=new Ps,c=new _t,h=n.cartesianToCartographic(e,l);Qt(h,h);const d=n.cartesianToCartographic(t,u);Qt(d,d);let p=new xu;const f=vu.numberOfPointsRhumbLine(h,d,i);h.height=0,d.height=0;const m=wu(f,r,o);p.ellipsoid.equals(n)||(p=new xu(void 0,void 0,n)),p.setEndPoints(h,d);const _=p.surfaceDistance/f;let g=s;h.height=r;let y=n.cartographicToCartesian(h,c,!0);_t.pack(y,a,g),g+=3;for(let e=1;e<f;e++){const t=p.interpolateUsingSurfaceDistance(e*_,u);t.height=m[e],y=n.cartographicToCartesian(t,c,!0),_t.pack(y,a,g),g+=3;}return g}vu.numberOfPoints=function(e,t,i){const n=_t.distance(e,t);return Math.ceil(n/i)},vu.numberOfPointsRhumbLine=function(e,t,i){const n=Math.pow(e.longitude-t.longitude,2)+Math.pow(e.latitude-t.latitude,2);return Math.max(1,Math.ceil(Math.sqrt(n/(i*i))))},vu.extractHeights=function(e,t){const i=new Ps,n=e.length,r=new Array(n);for(let o=0;o<n;o++)r[o]=t.cartesianToCartographic(e[o],i).height;return r},vu.wrapLongitude=function(e,t){const i=[],n=[],r=new Bt,o=new _t,a=new _t,s=new ts(_t.UNIT_X,0),l=new _t,u=new ts(_t.UNIT_X,0),c=new _t,h=new _t;if($(e)&&e.length>0){t=Z(t,Bt.IDENTITY);const d=Bt.inverseTransformation(t,r),p=Bt.multiplyByPoint(d,_t.ZERO,o),f=_t.normalize(Bt.multiplyByPointAsVector(d,_t.UNIT_Y,a),a),m=ts.fromPointNormal(p,f,s),_=_t.normalize(Bt.multiplyByPointAsVector(d,_t.UNIT_X,l),l),g=ts.fromPointNormal(p,_,u);let y=1;i.push(_t.clone(e[0]));let x=i[0];const v=e.length;for(let t=1;t<v;++t){const r=e[t];if(ts.getPointDistance(g,x)<0||ts.getPointDistance(g,r)<0){const e=Fs.lineSegmentPlane(x,r,m,c);if($(e)){const t=_t.multiplyByScalar(f,5e-9,h);ts.getPointDistance(m,x)<0&&_t.negate(t,t),i.push(_t.add(e,t,new _t)),n.push(y+1),_t.negate(t,t),i.push(_t.add(e,t,new _t)),y=1;}}i.push(_t.clone(e[t])),y++,x=r;}n.push(y);}return {positions:i,lengths:n}},vu.generateArc=function(e){$(e)||(e={});const t=e.positions;if(!$(t))throw new Error("options.positions is required.");const i=new _t,n=new _t,r=t.length,o=Z(e.ellipsoid,hi.WGS84);let a=Z(e.height,0);const s=Array.isArray(a);if(r<1)return [];if(1===r){const e=o.scaleToGeodeticSurface(t[0],n);if(a=s?a[0]:a,0!==a){const t=o.geodeticSurfaceNormal(e,i);_t.multiplyByScalar(t,a,t),_t.add(e,t,e);}return [e.x,e.y,e.z]}let l=e.minDistance;if(!$(l)){const t=Z(e.granularity,ot.CesiumMath.RADIANS_PER_DEGREE);l=ot.CesiumMath.chordLength(t,o.maximumRadius);}let u,c=0;for(u=0;u<r-1;u++)c+=vu.numberOfPoints(t[u],t[u+1],l);const h=3*(c+1),d=new Array(h);let p=0;for(u=0;u<r-1;u++)p=Tu(t[u],t[u+1],l,o,s?a[u]:a,s?a[u+1]:a,d,p);const f=t[r-1],m=new Ps,_=o.cartesianToCartographic(f,m);Qt(_,_),_.height=s?a[r-1]:a;const g=o.cartographicToCartesian(_,i,!0);return _t.pack(g,d,h-3),d};const Pu=new Ps,Su=new Ps;vu.generateRhumbArc=function(e){$(e)||(e={});const t=e.positions;if(!$(t))throw new Error("options.positions is required.");const i=new _t,n=new _t,r=t.length,o=Z(e.ellipsoid,hi.WGS84);let a=Z(e.height,0);const s=Array.isArray(a);if(r<1)return [];if(1===r){const e=o.scaleToGeodeticSurface(t[0],n);if(a=s?a[0]:a,0!==a){const t=o.geodeticSurfaceNormal(e,i);_t.multiplyByScalar(t,a,t),_t.add(e,t,e);}return [e.x,e.y,e.z]}const l=Z(e.granularity,ot.CesiumMath.RADIANS_PER_DEGREE);let u,c,h=0,d=o.cartesianToCartographic(t[0],Pu);for(Qt(d,d),u=0;u<r-1;u++)c=o.cartesianToCartographic(t[u+1],Su),Qt(c,c),h+=vu.numberOfPointsRhumbLine(d,c,l),d=Ps.clone(c,Pu);const p=3*(h+1),f=new Array(p);let m=0;for(u=0;u<r-1;u++)m=bu(t[u],t[u+1],l,o,s?a[u]:a,s?a[u+1]:a,f,m);const _=t[r-1],g=new Ps,y=o.cartesianToCartographic(_,g);Qt(y,y),y.height=s?a[r-1]:a;const x=o.cartographicToCartesian(y,i,!0);return _t.pack(x,f,p-3),f},vu.generateCartesianArc=function(e){const t=vu.generateArc(e),i=t.length/3,n=new Array(i);for(let e=0;e<i;e++)n[e]=_t.unpack(t,3*e);return n},vu.generateCartesianRhumbArc=function(e){const t=vu.generateRhumbArc(e),i=t.length/3,n=new Array(i);for(let e=0;e<i;e++)n[e]=_t.unpack(t,3*e);return n};const Eu=hi.RegularEllipsoid,Au=hi.WGS84,Cu=hi.WGS84,Mu=2*Math.PI/86400;let Iu=new pu;const Lu={normalScratch:new _t,rightScratch:new _t,upScratch:new _t,WGS84Ellipsoid:Au,RegularEllipsoid:Eu,DefaultEllipsoid:Cu,cartesian3ToCartographic:(e,t=Cu)=>t.cartesianToCartographic(e),cartographicToCartesian3:(e,t=Cu)=>t.cartographicToCartesian(e),cartographicToFixedFrame(e,t=Cu){const i=t.cartographicToCartesian(e);return t.eastNorthUpToFixedFrame(i)},cartesianToFixedFrame:(e,t=Cu)=>t.eastNorthUpToFixedFrame(e),localFrameToFixedFrame:(e,t=Cu)=>t.eastNorthUpToFixedFrame(e),headingPitchRollToFixedFrame(e,t,i=Cu){const n=new Ut;return n.fromHeadingPitchRoll(t),Lu.localFrameToFixedFrame(e,i).multiplyRight(n.getRotationMatrix())},fixedFrameToHeadingPitchRoll(e,t=Cu){const i=e.getTranslation(),n=Lu.localFrameToFixedFrame(i,t).invert(),r=e.clone().setTranslation([0,0,0]);n.multiplyRight(r);const o=(new Et).fromRotationMatrix4(n.extractRotation());return o.normalize(),st.fromQuaternion(o)},computeTemeToPseudoFixedMatrix(e,t){e=pu.fromDate(e),Iu=pu.addSeconds(e,-pu.computeTaiMinusUtc(e),Iu);const i=Iu.dayNumber,n=Iu.secondsOfDay;let r;const o=i-2451545;r=n>=43200?(o+.5)/Wl.DAYS_PER_JULIAN_CENTURY:(o-.5)/Wl.DAYS_PER_JULIAN_CENTURY;const a=(24110.54841+r*(8640184.812866+r*(.093104+-62e-7*r)))*Mu%(2*Math.PI)+(n+.5*Wl.SECONDS_PER_DAY)%Wl.SECONDS_PER_DAY*(72921158553e-15+11772758384668e-32*(i-2451545.5)),s=Math.cos(a),l=Math.sin(a);return $(t)?(t[0]=s,t[1]=-l,t[2]=0,t[3]=0,t[4]=l,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t):new Bt([s,l,0,0,-l,s,0,0,0,0,1,0,0,0,0,1])},pointToWindowCoordinates(e,t,i){const n=i.clone().transformAsPoint(e);return n.transformAsPoint(t),new Ot(n)},pointToWindowCoordinatesFrontCheck(e,t,i){const n=new St(i.x,i.y,i.z,1);n.transform(e),n.transform(t);const r=n.z>0?1:-1;return n.divideScalar(n.w),new _t(n.x,n.y,r)},pointToGLWindowCoordinates(e,t){const i=t.clone().transformAsPoint(e);return new _t(i)},eastNorthUpToFixedFrame:(e,t=Cu)=>t.eastNorthUpToFixedFrame(e),rotationMatrixFromPositionVelocity(e,t,i=Cu,n){const r=Z(i,Cu).geodeticSurfaceNormal(e,Lu.normalScratch);let o=_t.cross(t,r,Lu.rightScratch);_t.equalsEpsilon(o,_t.ZERO,ot.TRANSFORM.EPSILON6)&&(o=_t.clone(_t.UNIT_X,o));const a=_t.cross(o,t,Lu.upScratch);return _t.normalize(a,a),_t.cross(t,a,o),_t.negate(o,o),_t.normalize(o,o),$(n)||(n=new Nt),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=o.x,n[4]=o.y,n[5]=o.z,n[6]=a.x,n[7]=a.y,n[8]=a.z,n},convertV34Pos2V4:e=>zl(e,ot.TRANSFORM.FOV_IN_RADIANS),convertMapCenterOptions2CameraPositionOptions:e=>Lu.convertV34Pos2V4(e),convertV4Pos2V34:e=>kl(e,ot.TRANSFORM.FOV_IN_RADIANS),convertV4Pos2V34Traversal:(e,t)=>kl(e,ot.TRANSFORM.FOV_IN_RADIANS,t),convertCameraPositionOptions2MapCenterOptions:e=>Lu.convertV4Pos2V34(e),convertMapCenterFromCameraPosition:e=>function(e){const t=Nu.cartographicToFixedFrame(e);return El(new Ds([t[12],t[13],t[14]],new _t(t[8],t[9],t[10]).normalize().multiplyScalar(-1)))}(e),convertMapCenterFromCameraCartesian3Position:e=>function(e){const t=Nu.localFrameToFixedFrame(e);return El(new Ds([t[12],t[13],t[14]],new _t(t[8],t[9],t[10]).normalize().multiplyScalar(-1)))}(e),generateArc:e=>vu.generateArc(e)};var Nu=Lu;function Ru(){return !0}function Ou(e,t){function i(){throw new Error(t)}for(const t in e)"function"==typeof e[t]&&(e[t]=i);e.isDestroyed=Ru;}var Du=Object.freeze({DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_ASTC_4x4_WEBGL:37808,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_BPTC_UNORM:36492,HALF_FLOAT_OES:36193,DOUBLE:5130,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,CESIUM_3D_TILE_MASK:128,SKIP_LOD_MASK:112,SKIP_LOD_BIT_SHIFT:4,CLASSIFICATION_MASK:15});class Fu{constructor(e){this._ellipsoid=Z(e,hi.WGS84),this._semimajorAxis=this._ellipsoid.maximumRadius,this._oneOverSemimajorAxis=1/this._semimajorAxis;}get ellipsoid(){return this._ellipsoid}project(e,t){const i=this._semimajorAxis,n=e.longitude*i,r=e.latitude*i,o=e.height;return $(t)?(t.x=n,t.y=r,t.z=o,t):new _t(n,r,o)}unproject(e,t){const i=this._oneOverSemimajorAxis,n=e.x*i,r=e.y*i,o=e.z;return $(t)?(t.longitude=n,t.latitude=r,t.height=o,t):new Ps(n,r,o)}}const zu=new _t,Bu=new _t,Vu=new _t,ku=new _t,Uu=new _t,Gu=new _t,Hu=new _t,Yu=new _t,qu=new _t,Xu=new _t,Wu=new _t,ju=new _t,$u=new _t,Zu=new _t,Ku=new Fu,Qu=new _t,Ju=new _t,ec=new Ps(0,0,0),tc=new Ps(0,0,0),ic=[],nc=new _t,rc=new _t,oc=new _t,ac=new _t,sc=new _t,lc=new _t,uc=new _t,cc=new _t,hc=new _t,dc=new Fu,pc=new _t,fc=new _t,mc=new _t,_c=new _t,gc=new _t,yc=new Ps,xc=new Array(8);for(let e=0;e<8;++e)xc[e]=new _t;class vc{constructor(e=[0,0,0],t=0){this.radius=-0,this.center=new _t,this.fromCenterRadius(e,t);}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=zu.from(t),this.center=(new _t).from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.radius===e.radius}clone(e){return vc.clone(this,e)}union(e){const t=this.center,i=this.radius,n=e.radius,r=zu.copy(e.center).subtract(t),o=r.magnitude();if(i>=o+n)return this.clone();if(n>=o+i)return e.clone();const a=.5*(i+o+n);return Bu.copy(r).scale((-i+a)/o).add(t),this.center.copy(Bu),this.radius=a,this}expand(e){const t=(e=zu.from(e)).subtract(this.center).magnitude();return t>this.radius&&(this.radius=t),this}transform(e){this.center.transform(e);const t=function(e,t){var i=t[4],n=t[5],r=t[6],o=t[8],a=t[9],s=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(i,n,r),e[2]=Math.hypot(o,a,s),e}(zu,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}computePlaneDistances(e,t,i){return vc.computePlaneDistances(this,e,t,i)}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const t=(e=zu.from(e)).subtract(this.center);return Math.max(0,t.len()-this.radius)}intersectPlane(e){const t=this.radius,i=e.normal.dot(this.center)+e.distance;return i<-t?Qa.OUTSIDE:i<t?Qa.INTERSECTING:Qa.INSIDE}setFromPoints(e){if(!e||0==e.length)return this;let t;if(o(e[0])&&e[0]instanceof _t)t=e;else {t=[];for(let i=0;i<e.length;i+=3)t.push(new _t(e[i],e[i+1],e[i+2]));}return vc.fromPoints(t,this)}static fromPoints(e,t){if($(t)||(t=new vc),!$(e)||0===e.length)return t.center=_t.clone(_t.ZERO,t.center),t.radius=0,t;const i=_t.clone(e[0],qu),n=_t.clone(i,Vu),r=_t.clone(i,ku),o=_t.clone(i,Uu),a=_t.clone(i,Gu),s=_t.clone(i,Hu),l=_t.clone(i,Yu),u=e.length;let c;for(c=1;c<u;c++){_t.clone(e[c],i);const t=i.x,u=i.y,h=i.z;t<n.x&&_t.clone(i,n),t>a.x&&_t.clone(i,a),u<r.y&&_t.clone(i,r),u>s.y&&_t.clone(i,s),h<o.z&&_t.clone(i,o),h>l.z&&_t.clone(i,l);}const h=_t.magnitudeSquared(_t.subtract(a,n,Xu)),d=_t.magnitudeSquared(_t.subtract(s,r,Xu)),p=_t.magnitudeSquared(_t.subtract(l,o,Xu));let f=n,m=a,_=h;d>_&&(_=d,f=r,m=s),p>_&&(_=p,f=o,m=l);const g=Wu;g.x=.5*(f.x+m.x),g.y=.5*(f.y+m.y),g.z=.5*(f.z+m.z);let y=_t.magnitudeSquared(_t.subtract(m,g,Xu)),x=Math.sqrt(y);const v=ju;v.x=n.x,v.y=r.y,v.z=o.z;const w=$u;w.x=a.x,w.y=s.y,w.z=l.z;const T=_t.midpoint(v,w,Zu);let b=0;for(c=0;c<u;c++){_t.clone(e[c],i);const t=_t.magnitude(_t.subtract(i,T,Xu));t>b&&(b=t);const n=_t.magnitudeSquared(_t.subtract(i,g,Xu));if(n>y){const e=Math.sqrt(n);x=.5*(x+e),y=x*x;const t=e-x;g.x=(x*g.x+t*i.x)/e,g.y=(x*g.y+t*i.y)/e,g.z=(x*g.z+t*i.z)/e;}}return x<b?(_t.clone(g,t.center),t.radius=x):(_t.clone(T,t.center),t.radius=b),t}static fromRectangle2D(e,t,i){return vc.fromRectangleWithHeights2D(e,t,0,0,i)}static fromRectangleWithHeights2D(e,t,i,n,r){if($(r)||(r=new vc),!$(e))return r.center=_t.clone(_t.ZERO,r.center),r.radius=0,r;t=Z(t,Ku),Ss.southwest(e,ec),ec.height=i,Ss.northeast(e,tc),tc.height=n;const o=t.project(ec,Qu),a=t.project(tc,Ju),s=a.x-o.x,l=a.y-o.y,u=a.z-o.z;r.radius=.5*Math.sqrt(s*s+l*l+u*u);const c=r.center;return c.x=o.x+.5*s,c.y=o.y+.5*l,c.z=o.z+.5*u,r}static fromRectangle3D(e,t,i,n){if(t=Z(t,hi.WGS84),i=Z(i,0),$(n)||(n=new vc),!$(e))return n.center=_t.clone(_t.ZERO,n.center),n.radius=0,n;const r=Ss.subsample(e,t,i,ic);return vc.fromPoints(r,n)}static fromVertices(e,t,i,n){if($(n)||(n=new vc),!$(e)||0===e.length)return n.center=_t.clone(_t.ZERO,n.center),n.radius=0,n;t=Z(t,_t.ZERO),i=Z(i,3);const r=qu;r.x=e[0]+t.x,r.y=e[1]+t.y,r.z=e[2]+t.z;const o=_t.clone(r,Vu),a=_t.clone(r,ku),s=_t.clone(r,Uu),l=_t.clone(r,Gu),u=_t.clone(r,Hu),c=_t.clone(r,Yu),h=e.length;let d;for(d=0;d<h;d+=i){const i=e[d]+t.x,n=e[d+1]+t.y,h=e[d+2]+t.z;r.x=i,r.y=n,r.z=h,i<o.x&&_t.clone(r,o),i>l.x&&_t.clone(r,l),n<a.y&&_t.clone(r,a),n>u.y&&_t.clone(r,u),h<s.z&&_t.clone(r,s),h>c.z&&_t.clone(r,c);}const p=_t.magnitudeSquared(_t.subtract(l,o,Xu)),f=_t.magnitudeSquared(_t.subtract(u,a,Xu)),m=_t.magnitudeSquared(_t.subtract(c,s,Xu));let _=o,g=l,y=p;f>y&&(y=f,_=a,g=u),m>y&&(y=m,_=s,g=c);const x=Wu;x.x=.5*(_.x+g.x),x.y=.5*(_.y+g.y),x.z=.5*(_.z+g.z);let v=_t.magnitudeSquared(_t.subtract(g,x,Xu)),w=Math.sqrt(v);const T=ju;T.x=o.x,T.y=a.y,T.z=s.z;const b=$u;b.x=l.x,b.y=u.y,b.z=c.z;const P=_t.midpoint(T,b,Zu);let S=0;for(d=0;d<h;d+=i){r.x=e[d]+t.x,r.y=e[d+1]+t.y,r.z=e[d+2]+t.z;const i=_t.magnitude(_t.subtract(r,P,Xu));i>S&&(S=i);const n=_t.magnitudeSquared(_t.subtract(r,x,Xu));if(n>v){const e=Math.sqrt(n);w=.5*(w+e),v=w*w;const t=e-w;x.x=(w*x.x+t*r.x)/e,x.y=(w*x.y+t*r.y)/e,x.z=(w*x.z+t*r.z)/e;}}return w<S?(_t.clone(x,n.center),n.radius=w):(_t.clone(P,n.center),n.radius=S),n}static fromEncodedCartesianVertices(e,t,i){if($(i)||(i=new vc),!$(e)||!$(t)||e.length!==t.length||0===e.length)return i.center=_t.clone(_t.ZERO,i.center),i.radius=0,i;const n=qu;n.x=e[0]+t[0],n.y=e[1]+t[1],n.z=e[2]+t[2];const r=_t.clone(n,Vu),o=_t.clone(n,ku),a=_t.clone(n,Uu),s=_t.clone(n,Gu),l=_t.clone(n,Hu),u=_t.clone(n,Yu),c=e.length;let h;for(h=0;h<c;h+=3){const i=e[h]+t[h],c=e[h+1]+t[h+1],d=e[h+2]+t[h+2];n.x=i,n.y=c,n.z=d,i<r.x&&_t.clone(n,r),i>s.x&&_t.clone(n,s),c<o.y&&_t.clone(n,o),c>l.y&&_t.clone(n,l),d<a.z&&_t.clone(n,a),d>u.z&&_t.clone(n,u);}const d=_t.magnitudeSquared(_t.subtract(s,r,Xu)),p=_t.magnitudeSquared(_t.subtract(l,o,Xu)),f=_t.magnitudeSquared(_t.subtract(u,a,Xu));let m=r,_=s,g=d;p>g&&(g=p,m=o,_=l),f>g&&(g=f,m=a,_=u);const y=Wu;y.x=.5*(m.x+_.x),y.y=.5*(m.y+_.y),y.z=.5*(m.z+_.z);let x=_t.magnitudeSquared(_t.subtract(_,y,Xu)),v=Math.sqrt(x);const w=ju;w.x=r.x,w.y=o.y,w.z=a.z;const T=$u;T.x=s.x,T.y=l.y,T.z=u.z;const b=_t.midpoint(w,T,Zu);let P=0;for(h=0;h<c;h+=3){n.x=e[h]+t[h],n.y=e[h+1]+t[h+1],n.z=e[h+2]+t[h+2];const i=_t.magnitude(_t.subtract(n,b,Xu));i>P&&(P=i);const r=_t.magnitudeSquared(_t.subtract(n,y,Xu));if(r>x){const e=Math.sqrt(r);v=.5*(v+e),x=v*v;const t=e-v;y.x=(v*y.x+t*n.x)/e,y.y=(v*y.y+t*n.y)/e,y.z=(v*y.z+t*n.z)/e;}}return v<P?(_t.clone(y,i.center),i.radius=v):(_t.clone(b,i.center),i.radius=P),i}static fromCornerPoints(e,t,i){$(i)||(i=new vc);const n=_t.midpoint(e,t,i.center);return i.radius=_t.distance(n,t),i}static fromEllipsoid(e,t){return $(t)||(t=new vc),_t.clone(_t.ZERO,t.center),t.radius=e.maximumRadius,t}static fromBoundingSpheres(e,t){if($(t)||(t=new vc),!$(e)||0===e.length)return t.center=_t.clone(_t.ZERO,t.center),t.radius=0,t;const i=e.length;if(1===i)return vc.clone(e[0],t);if(2===i)return vc.union(e[0],e[1],t);const n=[];let r;for(r=0;r<i;r++)n.push(e[r].center);const o=(t=vc.fromPoints(n,t)).center;let a=t.radius;for(r=0;r<i;r++){const t=e[r];a=Math.max(a,_t.distance(o,t.center,nc)+t.radius);}return t.radius=a,t}static fromOrientedBoundingBox(e,t){$(t)||(t=new vc);const i=e.halfAxes,n=Nt.getColumn(i,0,rc),r=Nt.getColumn(i,1,oc),o=Nt.getColumn(i,2,ac);return _t.add(n,r,n),_t.add(n,o,n),t.center=_t.clone(e.center,t.center),t.radius=_t.magnitude(n),t}static clone(e,t){if($(e))return $(t)?(t.center=_t.clone(e.center,t.center),t.radius=e.radius,t):new vc(e.center,e.radius)}static pack(e,t,i){i=Z(i,0);const n=e.center;return t[i++]=n.x,t[i++]=n.y,t[i++]=n.z,t[i]=e.radius,t}static unpack(e,t,i){t=Z(t,0),$(i)||(i=new vc);const n=i.center;return n.x=e[t++],n.y=e[t++],n.z=e[t++],i.radius=e[t],i}static union(e,t,i){$(i)||(i=new vc);const n=e.center,r=e.radius,o=t.radius,a=_t.subtract(t.center,n,sc),s=_t.magnitude(a);if(r>=s+o)return vc.clone(e,i),i;if(o>=s+r)return vc.clone(t,i),i;const l=.5*(r+s+o),u=_t.multiplyByScalar(a,(-r+l)/s,lc);return _t.add(u,n,u),_t.clone(u,i.center),i.radius=l,i}static expand(e,t,i){i=vc.clone(e,i);const n=_t.magnitude(_t.subtract(t,i.center,uc));return n>i.radius&&(i.radius=n),i}static intersectPlane(e,t){const i=e.radius,n=_t.dot(t.normal,e.center)+t.distance;return n<-i?Qa.OUTSIDE:n<i?Qa.INTERSECTING:Qa.INSIDE}static transform(e,t,i){return $(i)||(i=new vc),i.center=Bt.multiplyByPoint(t,e.center,i.center),i.radius=Bt.getMaximumScale(t)*e.radius,i}static distanceSquaredTo(e,t){const i=_t.subtract(e.center,t,cc),n=_t.magnitude(i)-e.radius;return n<=0?0:n*n}static transformWithoutScale(e,t,i){return $(i)||(i=new vc),i.center=Bt.multiplyByPoint(t,e.center,i.center),i.radius=e.radius,i}static computePlaneDistances(e,t,i,n){$(n)||(n=new wc);const r=_t.subtract(e.center,t,hc),o=_t.dot(i,r);return n.start=o-e.radius,n.stop=o+e.radius,n}static projectTo2D(e,t,i){const n=(t=Z(t,dc)).ellipsoid;let r=e.center;const o=e.radius;let a;a=_t.equals(r,_t.ZERO)?_t.clone(_t.UNIT_X,pc):n.geodeticSurfaceNormal(r,pc);const s=_t.cross(_t.UNIT_Z,a,fc);_t.normalize(s,s);const l=_t.cross(a,s,mc);_t.normalize(l,l),_t.multiplyByScalar(a,o,a),_t.multiplyByScalar(l,o,l),_t.multiplyByScalar(s,o,s);const u=_t.negate(l,gc),c=_t.negate(s,_c),h=xc;let d=h[0];_t.add(a,l,d),_t.add(d,s,d),d=h[1],_t.add(a,l,d),_t.add(d,c,d),d=h[2],_t.add(a,u,d),_t.add(d,c,d),d=h[3],_t.add(a,u,d),_t.add(d,s,d),_t.negate(a,a),d=h[4],_t.add(a,l,d),_t.add(d,s,d),d=h[5],_t.add(a,l,d),_t.add(d,c,d),d=h[6],_t.add(a,u,d),_t.add(d,c,d),d=h[7],_t.add(a,u,d),_t.add(d,s,d);const p=h.length;for(let e=0;e<p;++e){const i=h[e];_t.add(r,i,i);const o=n.cartesianToCartographic(i,yc);t.project(o,i);}r=(i=vc.fromPoints(h,i)).center;const f=r.x,m=r.y;return r.x=r.z,r.y=f,r.z=m,i}static equals(e,t){return e===t||$(e)&&$(t)&&_t.equals(e.center,t.center)&&e.radius===t.radius}getBoundingMaximum(){return {boundingMaxValue:new _t(this.center.x+this.radius,this.center.y+this.radius,this.center.z+this.radius),boundingMinValue:new _t(this.center.x-this.radius,this.center.y-this.radius,this.center.z-this.radius)}}}function wc(e,t){this.start=Z(e,0),this.stop=Z(t,0);}vc.packedLength=4;const Tc=new _t,bc=new _t;class Pc{constructor(e=[0,0,0],t=[0,0,0],i=null){i=i||Tc.copy(e).add(t).scale(.5),this.center=new _t(i),this.halfDiagonal=new _t(t).subtract(this.center),this.minimum=new _t(e),this.maximum=new _t(t);}setFromPoints(e){if(!o(e)||0===e.length)return this;let t;if(o(e[0]))t=e;else {t=[];for(let i=0;i<e.length;i+=3)t.push(new _t(e[i],e[i+1],e[i+2]));}return Pc.fromPoints(t,this)}clone(){return new Pc(this.minimum,this.maximum,this.center)}equals(e){return this===e||Boolean(e)&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:t}=this,i=bc.from(e.normal),n=t.x*Math.abs(i.x)+t.y*Math.abs(i.y)+t.z*Math.abs(i.z),r=this.center.dot(i)+e.distance;return r-n>0?Qa.INSIDE:r+n<0?Qa.OUTSIDE:Qa.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=Tc.from(e).subtract(this.center),{halfDiagonal:i}=this;let n,r=0;return n=Math.abs(t.x)-i.x,n>0&&(r+=n*n),n=Math.abs(t.y)-i.y,n>0&&(r+=n*n),n=Math.abs(t.z)-i.z,n>0&&(r+=n*n),r}getBoundingMaximum(e=1){return {boundingMinValue:this.minimum.clone().multiplyByScalar(e),boundingMaxValue:this.maximum.clone().multiplyByScalar(e)}}static fromPoints(e,t){let i;if(o(e[0])&&e[0]instanceof _t)i=e;else {i=[];for(let t=0;t<e.length;t+=3)i.push(new _t(e[t],e[t+1],e[t+2]));}if($(t)||(t=new Pc),!$(i)||0===i.length)return t.minimum=_t.clone(_t.ZERO,t.minimum),t.maximum=_t.clone(_t.ZERO,t.maximum),t.center=_t.clone(_t.ZERO,t.center),t.halfDiagonal=_t.clone(_t.ZERO,t.halfDiagonal),t;let n=i[0].x,r=i[0].y,a=i[0].z,s=i[0].x,l=i[0].y,u=i[0].z;const c=i.length;for(let e=1;e<c;e++){const t=i[e],o=t.x,c=t.y,h=t.z;n=Math.min(o,n),s=Math.max(o,s),r=Math.min(c,r),l=Math.max(c,l),a=Math.min(h,a),u=Math.max(h,u);}const h=t.minimum;h.x=n,h.y=r,h.z=a;const d=t.maximum;return d.x=s,d.y=l,d.z=u,t.center=_t.midpoint(h,d,t.center),t.halfDiagonal=new _t(t.maximum).subtract(t.center),t}static clone(e){return new Pc(e.minimum,e.maximum,e.center)}}const Sc=new St,Ec=new Pc,Ac=new Ds,Cc=new _t,Mc=new _t;class Ic{constructor(e,t){e=(t=Z(t,hi.WGS84)).scaleToGeodeticSurface(e);const i=Nu.eastNorthUpToFixedFrame(e,t);this._ellipsoid=t,this._origin=e,this._xAxis=_t.fromCartesian4(Bt.getColumn(i,0,Sc)),this._yAxis=_t.fromCartesian4(Bt.getColumn(i,1,Sc));const n=_t.fromCartesian4(Bt.getColumn(i,2,Sc));this._plane=ts.fromPointNormal(e,n);}get ellipsoid(){return this._ellipsoid}get origin(){return this._origin}get plane(){return this._plane}get xAxis(){return this._xAxis}get yAxis(){return this._yAxis}get zAxis(){return this._plane.normal}static fromPoints(e,t){const i=Pc.fromPoints(e,Ec);return new Ic(i.center,t)}projectPointOntoPlane(e,t){const i=Ac;i.origin=e,_t.normalize(e,i.direction);let n=Fs.rayPlane(i,this._plane,Cc);if($(n)||(_t.negate(i.direction,i.direction),n=Fs.rayPlane(i,this._plane,Cc)),$(n)){const e=_t.subtract(n,this._origin,n),i=_t.dot(this._xAxis,e),r=_t.dot(this._yAxis,e);return $(t)?(t.x=i,t.y=r,t):new Ot(i,r)}}projectPointsOntoPlane(e,t){$(t)||(t=[]);let i=0;const n=e.length;for(let r=0;r<n;r++){const n=this.projectPointOntoPlane(e[r],t[i]);$(n)&&(t[i]=n,i++);}return t.length=i,t}projectPointToNearestOnPlane(e,t){$(t)||(t=new Ot);const i=Ac;i.origin=e,_t.clone(this._plane.normal,i.direction);let n=Fs.rayPlane(i,this._plane,Cc);$(n)||(_t.negate(i.direction,i.direction),n=Fs.rayPlane(i,this._plane,Cc));const r=_t.subtract(n,this._origin,n),o=_t.dot(this._xAxis,r),a=_t.dot(this._yAxis,r);return t.x=o,t.y=a,t}projectPointsToNearestOnPlane(e,t){$(t)||(t=[]);const i=e.length;t.length=i;for(let n=0;n<i;n++)t[n]=this.projectPointToNearestOnPlane(e[n],t[n]);return t}projectPointOntoEllipsoid(e,t){$(t)||(t=new _t);const i=this._ellipsoid,n=this._origin,r=this._yAxis,o=Mc;return _t.multiplyByScalar(this._xAxis,e.x,o),t=_t.add(n,o,t),_t.multiplyByScalar(r,e.y,o),_t.add(t,o,t),i.scaleToGeocentricSurface(t,t),t}projectPointsOntoEllipsoid(e,t){const i=e.length;$(t)?t.length=i:t=new Array(i);for(let n=0;n<i;++n)t[n]=this.projectPointOntoEllipsoid(e[n],t[n]);return t}}const Lc=new _t,Nc=new _t,Rc=new _t,Oc=new _t,Dc=new _t,Fc=new _t,zc=new _t,Bc=new _t,Vc=new _t,kc=new _t;class Uc{constructor(e=[0,0,0],t=[0,0,0,0,0,0,0,0,0]){this.center=(new _t).from(e),this.halfAxes=new Nt(t);}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return [new _t(e).len(),new _t(t).len(),new _t(i).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),n=new _t(e).normalize(),r=new _t(t).normalize(),o=new _t(i).normalize();return (new Et).fromMatrix3(new Nt([...n,...r,...o]))}fromCenterHalfSizeQuaternion(e,t,i){const n=new Et(i),r=(new Nt).fromQuaternion(n);return r[0]=r[0]*t[0],r[1]=r[1]*t[0],r[2]=r[2]*t[0],r[3]=r[3]*t[1],r[4]=r[4]*t[1],r[5]=r[5]*t[1],r[6]=r[6]*t[2],r[7]=r[7]*t[2],r[8]=r[8]*t[2],this.center=(new _t).from(e),this.halfAxes=r,this}clone(){return new Uc(this.center,this.halfAxes)}equals(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new vc){const t=this.halfAxes,i=t.getColumn(0,Rc),n=t.getColumn(1,Oc),r=t.getColumn(2,Dc),o=Lc.copy(i).add(n).add(r);return e.center.copy(this.center),e.radius=o.magnitude(),e}getBoundingMaximum(e){e=e||1;const t=new _t(this.halfAxes[0],this.halfAxes[1],this.halfAxes[2]).scale(e),i=new _t(this.halfAxes[3],this.halfAxes[4],this.halfAxes[5]).scale(e),n=new _t(this.halfAxes[6],this.halfAxes[7],this.halfAxes[8]).scale(e),r=_t.add(_t.add(t,i),n);return {boundingMaxValue:_t.add(this.center,r),boundingMinValue:_t.subtract(this.center,r)}}intersectPlane(e){const t=this.center,i=e.normal,n=this.halfAxes,r=i.x,o=i.y,a=i.z,s=Math.abs(r*n[It.COL0ROW0]+o*n[It.COL0ROW1]+a*n[It.COL0ROW2])+Math.abs(r*n[It.COL1ROW0]+o*n[It.COL1ROW1]+a*n[It.COL1ROW2])+Math.abs(r*n[It.COL2ROW0]+o*n[It.COL2ROW1]+a*n[It.COL2ROW2]),l=i.dot(t)+e.distance;return l<=-s?Qa.OUTSIDE:l>=s?Qa.INSIDE:Qa.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=Nc.from(e).subtract(this.center),i=this.halfAxes,n=i.getColumn(0,Rc),r=i.getColumn(1,Oc),o=i.getColumn(2,Dc),a=n.magnitude(),s=r.magnitude(),l=o.magnitude();n.normalize(),r.normalize(),o.normalize();let u,c=0;return u=Math.abs(t.dot(n))-a,u>0&&(c+=u*u),u=Math.abs(t.dot(r))-s,u>0&&(c+=u*u),u=Math.abs(t.dot(o))-l,u>0&&(c+=u*u),c}computePlaneDistances(e,t,i){return Uc.computePlaneDistances(this,e,t,i)}static computePlaneDistances(e,t,i,n){$(n)||(n=new wc);let r=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;const a=e.center,s=e.halfAxes,l=Nt.getColumn(s,0,Bc),u=Nt.getColumn(s,1,Vc),c=Nt.getColumn(s,2,kc),h=_t.add(l,u,Fc);_t.add(h,c,h),_t.add(h,a,h);const d=_t.subtract(h,t,zc);let p=_t.dot(i,d);return r=Math.min(p,r),o=Math.max(p,o),_t.add(a,l,h),_t.add(h,u,h),_t.subtract(h,c,h),_t.subtract(h,t,d),p=_t.dot(i,d),r=Math.min(p,r),o=Math.max(p,o),_t.add(a,l,h),_t.subtract(h,u,h),_t.add(h,c,h),_t.subtract(h,t,d),p=_t.dot(i,d),r=Math.min(p,r),o=Math.max(p,o),_t.add(a,l,h),_t.subtract(h,u,h),_t.subtract(h,c,h),_t.subtract(h,t,d),p=_t.dot(i,d),r=Math.min(p,r),o=Math.max(p,o),_t.subtract(a,l,h),_t.add(h,u,h),_t.add(h,c,h),_t.subtract(h,t,d),p=_t.dot(i,d),r=Math.min(p,r),o=Math.max(p,o),_t.subtract(a,l,h),_t.add(h,u,h),_t.subtract(h,c,h),_t.subtract(h,t,d),p=_t.dot(i,d),r=Math.min(p,r),o=Math.max(p,o),_t.subtract(a,l,h),_t.subtract(h,u,h),_t.add(h,c,h),_t.subtract(h,t,d),p=_t.dot(i,d),r=Math.min(p,r),o=Math.max(p,o),_t.subtract(a,l,h),_t.subtract(h,u,h),_t.subtract(h,c,h),_t.subtract(h,t,d),p=_t.dot(i,d),r=Math.min(p,r),o=Math.max(p,o),n.start=r,n.stop=o,n}transform(e){this.center.transformAsPoint(e);const t=e.clone();t[12]=0,t[13]=0,t[14]=0,t[15]=1;const i=this.halfAxes.getColumn(0,Rc);i.transformAsPoint(t);const n=this.halfAxes.getColumn(1,Oc);n.transformAsPoint(t);const r=this.halfAxes.getColumn(2,Dc);return r.transformAsPoint(t),this.halfAxes=new Nt([...i,...n,...r]),this}getTransform(){return Bt.fromRotationTranslation(this.halfAxes,this.center)}static fromRectangle(e,t,i,n,r){const o=new Ps,a=new _t,s=new Ps,l=new Ps,u=new Ps,c=new Ps,h=new Ps,d=new _t,p=new _t,f=new _t,m=new _t,_=new _t,g=new Ot,y=new Ot,x=new Ot,v=new Ot,w=new Ot,T=new _t,b=new _t,P=new _t,S=new _t,E=new Ot,A=new _t,C=new _t,M=new _t,I=new ts(_t.UNIT_X,0);let L,N,R,O,D,F,z;if(t=Z(t,0),i=Z(i,0),n=Z(n,hi.WGS84),e.width<=ot.CesiumMath.PI){const T=Ss.center(e,o),b=n.cartographicToCartesianInRadians(T,a),P=new Ic(b,n);z=P.plane;const S=T.longitude,E=e.south<0&&e.north>0?0:T.latitude,A=Ps.fromRadians(S,e.north,i,s),C=Ps.fromRadians(e.west,e.north,i,l),M=Ps.fromRadians(e.west,E,i,u),I=Ps.fromRadians(e.west,e.south,i,c),B=Ps.fromRadians(S,e.south,i,h),V=n.cartographicToCartesianInRadians(A,d);let k=n.cartographicToCartesianInRadians(C,p);const U=n.cartographicToCartesianInRadians(M,f);let G=n.cartographicToCartesianInRadians(I,m);const H=n.cartographicToCartesianInRadians(B,_),Y=P.projectPointToNearestOnPlane(V,g),q=P.projectPointToNearestOnPlane(k,y),X=P.projectPointToNearestOnPlane(U,x),W=P.projectPointToNearestOnPlane(G,v),j=P.projectPointToNearestOnPlane(H,w);return L=Math.min(q.x,X.x,W.x),N=-L,O=Math.max(q.y,Y.y),R=Math.min(W.y,j.y),C.height=I.height=t,k=n.cartographicToCartesianInRadians(C,p),G=n.cartographicToCartesianInRadians(I,m),D=Math.min(ts.getPointDistance(z,k),ts.getPointDistance(z,G)),F=i,Hc(P.origin,P.xAxis,P.yAxis,P.zAxis,L,N,R,O,D,F,r)}const B=e.south>0,V=e.north<0,k=B?e.south:V?e.north:0,U=Ss.center(e,o).longitude,G=_t.fromRadians(U,k,i,n,T);G.z=0;const H=Math.abs(G.x)<ot.CesiumMath.EPSILON10&&Math.abs(G.y)<ot.CesiumMath.EPSILON10?_t.UNIT_X:_t.normalize(G,b),Y=_t.UNIT_Z,q=_t.cross(H,Y,P);z=ts.fromPointNormal(G,H,I);const X=_t.fromRadians(U+ot.CesiumMath.PI_OVER_TWO,k,i,n,S);N=_t.dot(ts.projectPointOntoPlane(z,X,E),q),L=-N,O=_t.fromRadians(0,e.north,V?t:i,n,A).z,R=_t.fromRadians(0,e.south,B?t:i,n,C).z;const W=_t.fromRadians(e.east,k,i,n,M);return D=ts.getPointDistance(z,W),F=0,Hc(G,q,Y,H,L,N,R,O,D,F,r)}setFromPoints(e){let t;if(o(e[0])&&e[0]instanceof _t)t=e;else {t=[];for(let i=0;i<e.length;i+=3)t.push(new _t(e[i],e[i+1],e[i+2]));}return Uc.fromPoints(t,this)}static fromPoints(e,t){const i=new _t,n=new _t,r=new _t,o=new _t,a=new _t,s=new _t,l=new Nt,u={unitary:new Nt,diagonal:new Nt};if($(t)||(t=new Uc),!$(e)||0===e.length)return t.halfAxes=Nt.ZERO,t.center=_t.ZERO,t;let c;const h=e.length,d=_t.clone(e[0],i);for(c=1;c<h;c++)_t.add(d,e[c],d);const p=1/h;_t.multiplyByScalar(d,p,d);let f,m=0,_=0,g=0,y=0,x=0,v=0;for(c=0;c<h;c++)f=_t.subtract(e[c],d,n),m+=f.x*f.x,_+=f.x*f.y,g+=f.x*f.z,y+=f.y*f.y,x+=f.y*f.z,v+=f.z*f.z;m*=p,_*=p,g*=p,y*=p,x*=p,v*=p;const w=l;w[0]=m,w[1]=_,w[2]=g,w[3]=_,w[4]=y,w[5]=x,w[6]=g,w[7]=x,w[8]=v;const T=Nt.computeEigenDecomposition(w,u),b=Nt.clone(T.unitary,t.halfAxes);let P=Nt.getColumn(b,0,o),S=Nt.getColumn(b,1,a),E=Nt.getColumn(b,2,s),A=-Number.MAX_VALUE,C=-Number.MAX_VALUE,M=-Number.MAX_VALUE,I=Number.MAX_VALUE,L=Number.MAX_VALUE,N=Number.MAX_VALUE;for(c=0;c<h;c++)f=e[c],A=Math.max(_t.dot(P,f),A),C=Math.max(_t.dot(S,f),C),M=Math.max(_t.dot(E,f),M),I=Math.min(_t.dot(P,f),I),L=Math.min(_t.dot(S,f),L),N=Math.min(_t.dot(E,f),N);P=_t.multiplyByScalar(P,.5*(I+A),P),S=_t.multiplyByScalar(S,.5*(L+C),S),E=_t.multiplyByScalar(E,.5*(N+M),E);const R=_t.add(P,S,t.center);_t.add(R,E,R);const O=r;return O.x=A-I,O.y=C-L,O.z=M-N,_t.multiplyByScalar(O,.5,O),Nt.multiplyByScale(t.halfAxes,O,t.halfAxes),P=Nt.getColumn(t.halfAxes,0),S=Nt.getColumn(t.halfAxes,1),E=Nt.getColumn(t.halfAxes,2),_t.equals(P,_t.ZERO)?(P=_t.cross(S,E).setLength(.1),t.halfAxes.setColumn(0,P)):_t.equals(S,_t.ZERO)?(S=_t.cross(E,P).setLength(.1),t.halfAxes.setColumn(1,S)):_t.equals(E,_t.ZERO)&&(E=_t.cross(P,S).setLength(.1),t.halfAxes.setColumn(2,E)),t}static clone(e){return new Uc(e.center,e.halfAxes)}static computeCorners(e,t){const i=new _t,n=new _t,r=new _t;$(t)||(t=[new _t,new _t,new _t,new _t,new _t,new _t,new _t,new _t]);const o=e.center,a=e.halfAxes,s=Nt.getColumn(a,0,i),l=Nt.getColumn(a,1,n),u=Nt.getColumn(a,2,r);return _t.clone(o,t[0]),_t.subtract(t[0],s,t[0]),_t.subtract(t[0],l,t[0]),_t.subtract(t[0],u,t[0]),_t.clone(o,t[1]),_t.subtract(t[1],s,t[1]),_t.subtract(t[1],l,t[1]),_t.add(t[1],u,t[1]),_t.clone(o,t[2]),_t.subtract(t[2],s,t[2]),_t.add(t[2],l,t[2]),_t.subtract(t[2],u,t[2]),_t.clone(o,t[3]),_t.subtract(t[3],s,t[3]),_t.add(t[3],l,t[3]),_t.add(t[3],u,t[3]),_t.clone(o,t[4]),_t.add(t[4],s,t[4]),_t.subtract(t[4],l,t[4]),_t.subtract(t[4],u,t[4]),_t.clone(o,t[5]),_t.add(t[5],s,t[5]),_t.subtract(t[5],l,t[5]),_t.add(t[5],u,t[5]),_t.clone(o,t[6]),_t.add(t[6],s,t[6]),_t.add(t[6],l,t[6]),_t.subtract(t[6],u,t[6]),_t.clone(o,t[7]),_t.add(t[7],s,t[7]),_t.add(t[7],l,t[7]),_t.add(t[7],u,t[7]),t}computeCorners(e){return Uc.computeCorners(this,e)}union(e,t){if(!(e instanceof Uc))throw new Error("包围盒的类型不正确！");$(t)||(t=new Uc);let i=[];const n=Uc.computeCorners(this),r=Uc.computeCorners(e);return i=i.concat(n,r),Uc.fromPoints(i,t)}static union(e,t,i){if(!(e instanceof Uc&&t instanceof Uc))throw new Error("包围盒的类型不正确！");$(i)||(i=new Uc);let n=[];const r=Uc.computeCorners(e),o=Uc.computeCorners(t);return n=n.concat(r,o),Uc.fromPoints(n)}}const Gc=new _t;function Hc(e,t,i,n,r,o,a,s,l,u,c){$(c)||(c=new Uc);const h=c.halfAxes;Nt.setColumn(h,0,t,h),Nt.setColumn(h,1,i,h),Nt.setColumn(h,2,n,h);let d=Nc;d.x=(r+o)/2,d.y=(a+s)/2,d.z=(l+u)/2;const p=Gc;p.x=(o-r)/2,p.y=(s-a)/2,p.z=(u-l)/2;const f=c.center;return d=Nt.multiplyByVector(h,d,d),_t.add(e,d,f),Nt.multiplyByScale(h,p,h),c}const Yc={_maximumCombinedTextureImageUnits:0,_maximumCubeMapSize:0,_maximumFragmentUniformVectors:0,_maximumTextureImageUnits:0,_maximumRenderbufferSize:0,_maximumTextureSize:0,_maximumVaryingVectors:0,_maximumVertexAttributes:0,_maximumVertexTextureImageUnits:0,_maximumVertexUniformVectors:0,_minimumAliasedLineWidth:0,_maximumAliasedLineWidth:0,_minimumAliasedPointSize:0,_maximumAliasedPointSize:0,_maximumViewportWidth:0,_maximumViewportHeight:0,_maximumTextureFilterAnisotropy:0,_maximumDrawBuffers:0,_maximumColorAttachments:0,_highpFloatSupported:!1,_highpIntSupported:!1};Object.defineProperties(Yc,{maximumCombinedTextureImageUnits:{get:()=>Yc._maximumCombinedTextureImageUnits},maximumCubeMapSize:{get:()=>Yc._maximumCubeMapSize},maximumFragmentUniformVectors:{get:()=>Yc._maximumFragmentUniformVectors},maximumTextureImageUnits:{get:()=>Yc._maximumTextureImageUnits},maximumRenderbufferSize:{get:()=>Yc._maximumRenderbufferSize},maximumTextureSize:{get:()=>Yc._maximumTextureSize},maximumVaryingVectors:{get:()=>Yc._maximumVaryingVectors},maximumVertexAttributes:{get:()=>Yc._maximumVertexAttributes},maximumVertexTextureImageUnits:{get:()=>Yc._maximumVertexTextureImageUnits},maximumVertexUniformVectors:{get:()=>Yc._maximumVertexUniformVectors},minimumAliasedLineWidth:{get:()=>Yc._minimumAliasedLineWidth},maximumAliasedLineWidth:{get:()=>Yc._maximumAliasedLineWidth},minimumAliasedPointSize:{get:()=>Yc._minimumAliasedPointSize},maximumAliasedPointSize:{get:()=>Yc._maximumAliasedPointSize},maximumViewportWidth:{get:()=>Yc._maximumViewportWidth},maximumViewportHeight:{get:()=>Yc._maximumViewportHeight},maximumTextureFilterAnisotropy:{get:()=>Yc._maximumTextureFilterAnisotropy},maximumDrawBuffers:{get:()=>Yc._maximumDrawBuffers},maximumColorAttachments:{get:()=>Yc._maximumColorAttachments},highpFloatSupported:{get:()=>Yc._highpFloatSupported},highpIntSupported:{get:()=>Yc._highpIntSupported}});const qc={NEAREST:Du.NEAREST,LINEAR:Du.LINEAR,validate:function(e){return e===qc.NEAREST||e===qc.LINEAR}};var Xc=Object.freeze(qc);const Wc={NEAREST:Du.NEAREST,LINEAR:Du.LINEAR,NEAREST_MIPMAP_NEAREST:Du.NEAREST_MIPMAP_NEAREST,LINEAR_MIPMAP_NEAREST:Du.LINEAR_MIPMAP_NEAREST,NEAREST_MIPMAP_LINEAR:Du.NEAREST_MIPMAP_LINEAR,LINEAR_MIPMAP_LINEAR:Du.LINEAR_MIPMAP_LINEAR,validate:function(e){return e===Wc.NEAREST||e===Wc.LINEAR||e===Wc.NEAREST_MIPMAP_NEAREST||e===Wc.LINEAR_MIPMAP_NEAREST||e===Wc.NEAREST_MIPMAP_LINEAR||e===Wc.LINEAR_MIPMAP_LINEAR}};var jc=Object.freeze(Wc);const $c={CLAMP_TO_EDGE:Du.CLAMP_TO_EDGE,REPEAT:Du.REPEAT,MIRRORED_REPEAT:Du.MIRRORED_REPEAT,validate:e=>e===$c.CLAMP_TO_EDGE||e===$c.REPEAT||e===$c.MIRRORED_REPEAT};var Zc=Object.freeze($c);class Kc{constructor(e){const t=(e=e||{}).wrapS||Zc.CLAMP_TO_EDGE,i=e.wrapT||Zc.CLAMP_TO_EDGE,n=e.minificationFilter||jc.LINEAR,r=e.magnificationFilter||Xc.LINEAR,o=$(e.maximumAnisotropy)?e.maximumAnisotropy:1;if(!Zc.validate(t))throw new hl("Invalid sampler.wrapS.");if(!Zc.validate(i))throw new hl("Invalid sampler.wrapT.");if(!jc.validate(n))throw new hl("Invalid sampler.minificationFilter.");if(!Xc.validate(r))throw new hl("Invalid sampler.magnificationFilter.");this._wrapS=t,this._wrapT=i,this._minificationFilter=n,this._magnificationFilter=r,this._maximumAnisotropy=o;}get wrapS(){return this._wrapS}get wrapT(){return this._wrapT}get minificationFilter(){return this._minificationFilter}get magnificationFilter(){return this._magnificationFilter}get maximumAnisotropy(){return this._maximumAnisotropy}static equals(e,t){return e===t||$(e)&&$(t)&&e._wrapS===t._wrapS&&e._wrapT===t._wrapT&&e._minificationFilter===t._minificationFilter&&e._magnificationFilter===t._magnificationFilter&&e._maximumAnisotropy===t._maximumAnisotropy}}Kc.NEAREST=Object.freeze(new Kc({wrapS:Zc.CLAMP_TO_EDGE,wrapT:Zc.CLAMP_TO_EDGE,minificationFilter:jc.NEAREST,magnificationFilter:Xc.NEAREST}));const Qc={ALPHA:ot.COLORTYPEANDLENGTH.ALPHA,RGB:ot.COLORTYPEANDLENGTH.RGB,RGBA:ot.COLORTYPEANDLENGTH.RGBA,LUMINANCE:ot.COLORTYPEANDLENGTH.LUMINANCE,LUMINANCE_ALPHA:ot.COLORTYPEANDLENGTH.LUMINANCE_ALPHA,RGB_DXT1:ot.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_S3TC.COMPRESSED_RGB_S3TC_DXT1_EXT,RGBA_DXT1:ot.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_S3TC.COMPRESSED_RGBA_S3TC_DXT1_EXT,RGBA_DXT3:ot.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_S3TC.COMPRESSED_RGBA_S3TC_DXT3_EXT,RGBA_DXT5:ot.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_S3TC.COMPRESSED_RGBA_S3TC_DXT5_EXT,RGB_PVRTC_4BPPV1:ot.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_PVRTC.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,RGB_PVRTC_2BPPV1:ot.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_PVRTC.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,RGBA_PVRTC_4BPPV1:ot.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_PVRTC.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,RGBA_PVRTC_2BPPV1:ot.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_PVRTC.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,RGB_ETC1:ot.COMPRESSED_TEXTURE_TYPE.COMPRESSED_RGB_ETC1_WEBGL,isCompressedFormat(e){let t;return t=Array.isArray(e)&&e.length>0?e[0].format:e.format||"",t===Qc.RGB_DXT1||t===Qc.RGBA_DXT1||t===Qc.RGBA_DXT3||t===Qc.RGBA_DXT5||t===Qc.RGB_PVRTC_4BPPV1||t===Qc.RGB_PVRTC_2BPPV1||t===Qc.RGBA_PVRTC_4BPPV1||t===Qc.RGBA_PVRTC_2BPPV1||t===Qc.RGB_ETC1},isDXTFormat:e=>e===Qc.RGB_DXT1||e===Qc.RGBA_DXT1||e===Qc.RGBA_DXT3||e===Qc.RGBA_DXT5,isPVRTCFormat:e=>e===Qc.RGB_PVRTC_4BPPV1||e===Qc.RGB_PVRTC_2BPPV1||e===Qc.RGBA_PVRTC_4BPPV1||e===Qc.RGBA_PVRTC_2BPPV1,isETC1Format:e=>e===Qc.RGB_ETC1,compressedTextureSizeInBytes(e,t,i){switch(e){case Qc.RGB_DXT1:case Qc.RGBA_DXT1:case Qc.RGB_ETC1:return Math.floor((t+3)/4)*Math.floor((i+3)/4)*8;case Qc.RGBA_DXT3:case Qc.RGBA_DXT5:return Math.floor((t+3)/4)*Math.floor((i+3)/4)*16;case Qc.RGB_PVRTC_4BPPV1:case Qc.RGBA_PVRTC_4BPPV1:return Math.floor((Math.max(t,8)*Math.max(i,8)*4+7)/8);case Qc.RGB_PVRTC_2BPPV1:case Qc.RGBA_PVRTC_2BPPV1:return Math.floor((Math.max(t,16)*Math.max(i,8)*2+7)/8);default:return 0}},componentsLength(e){switch(e){case Qc.RGB:return 3;case Qc.RGBA:return 4;case Qc.LUMINANCE_ALPHA:return 2;default:return 1}},textureSizeInBytes(e,t,i,n){let r=Qc.componentsLength(e);return Qc.isPacked(t)&&(r=1),r*Qc.sizeInBytes(t)*i*n},sizeInBytes(e){switch(e){case ot.PixelDatatype.UNSIGNED_BYTE:return 1;case ot.PixelDatatype.UNSIGNED_SHORT:case ot.PixelDatatype.UNSIGNED_SHORT_4_4_4_4:case ot.PixelDatatype.UNSIGNED_SHORT_5_5_5_1:case ot.PixelDatatype.UNSIGNED_SHORT_5_6_5:case ot.PixelDatatype.HALF_FLOAT:return 2;case ot.PixelDatatype.UNSIGNED_INT:case ot.PixelDatatype.FLOAT:case ot.PixelDatatype.UNSIGNED_INT_24_8:return 4}},isPacked:e=>e===ot.PixelDatatype.UNSIGNED_INT_24_8||e===ot.PixelDatatype.UNSIGNED_SHORT_4_4_4_4||e===ot.PixelDatatype.UNSIGNED_SHORT_5_5_5_1||e===ot.PixelDatatype.UNSIGNED_SHORT_5_6_5},Jc={UNSIGNED_BYTE:Du.UNSIGNED_BYTE,UNSIGNED_SHORT:Du.UNSIGNED_SHORT,UNSIGNED_INT:Du.UNSIGNED_INT,FLOAT:Du.FLOAT,HALF_FLOAT:Du.HALF_FLOAT_OES,UNSIGNED_INT_24_8:Du.UNSIGNED_INT_24_8,UNSIGNED_SHORT_4_4_4_4:Du.UNSIGNED_SHORT_4_4_4_4,UNSIGNED_SHORT_5_5_5_1:Du.UNSIGNED_SHORT_5_5_5_1,UNSIGNED_SHORT_5_6_5:Du.UNSIGNED_SHORT_5_6_5,toWebGLConstant(e,t){switch(e){case Jc.UNSIGNED_BYTE:return Du.UNSIGNED_BYTE;case Jc.UNSIGNED_SHORT:return Du.UNSIGNED_SHORT;case Jc.UNSIGNED_INT:return Du.UNSIGNED_INT;case Jc.FLOAT:return Du.FLOAT;case Jc.HALF_FLOAT:return t.webgl2?Du.HALF_FLOAT:Du.HALF_FLOAT_OES;case Jc.UNSIGNED_INT_24_8:return Du.UNSIGNED_INT_24_8;case Jc.UNSIGNED_SHORT_4_4_4_4:return Du.UNSIGNED_SHORT_4_4_4_4;case Jc.UNSIGNED_SHORT_5_5_5_1:return Du.UNSIGNED_SHORT_5_5_5_1;case Jc.UNSIGNED_SHORT_5_6_5:return Jc.UNSIGNED_SHORT_5_6_5}},isPacked:e=>e===Jc.UNSIGNED_INT_24_8||e===Jc.UNSIGNED_SHORT_4_4_4_4||e===Jc.UNSIGNED_SHORT_5_5_5_1||e===Jc.UNSIGNED_SHORT_5_6_5,sizeInBytes(e){switch(e){case Jc.UNSIGNED_BYTE:return 1;case Jc.UNSIGNED_SHORT:case Jc.UNSIGNED_SHORT_4_4_4_4:case Jc.UNSIGNED_SHORT_5_5_5_1:case Jc.UNSIGNED_SHORT_5_6_5:case Jc.HALF_FLOAT:return 2;case Jc.UNSIGNED_INT:case Jc.FLOAT:case Jc.UNSIGNED_INT_24_8:return 4}},validate:e=>e===Jc.UNSIGNED_BYTE||e===Jc.UNSIGNED_SHORT||e===Jc.UNSIGNED_INT||e===Jc.FLOAT||e===Jc.HALF_FLOAT||e===Jc.UNSIGNED_INT_24_8||e===Jc.UNSIGNED_SHORT_4_4_4_4||e===Jc.UNSIGNED_SHORT_5_5_5_1||e===Jc.UNSIGNED_SHORT_5_6_5};var eh=Object.freeze(Jc);const th={DEPTH_COMPONENT:Du.DEPTH_COMPONENT,DEPTH_STENCIL:Du.DEPTH_STENCIL,ALPHA:Du.ALPHA,RGB:Du.RGB,RGBA:Du.RGBA,LUMINANCE:Du.LUMINANCE,LUMINANCE_ALPHA:Du.LUMINANCE_ALPHA,RGB_DXT1:Du.COMPRESSED_RGB_S3TC_DXT1_EXT,RGBA_DXT1:Du.COMPRESSED_RGBA_S3TC_DXT1_EXT,RGBA_DXT3:Du.COMPRESSED_RGBA_S3TC_DXT3_EXT,RGBA_DXT5:Du.COMPRESSED_RGBA_S3TC_DXT5_EXT,RGB_PVRTC_4BPPV1:Du.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,RGB_PVRTC_2BPPV1:Du.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,RGBA_PVRTC_4BPPV1:Du.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,RGBA_PVRTC_2BPPV1:Du.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,RGBA_ASTC:Du.COMPRESSED_RGBA_ASTC_4x4_WEBGL,RGB_ETC1:Du.COMPRESSED_RGB_ETC1_WEBGL,RGB8_ETC2:Du.COMPRESSED_RGB8_ETC2,RGBA8_ETC2_EAC:Du.COMPRESSED_RGBA8_ETC2_EAC,RGBA_BC7:Du.COMPRESSED_RGBA_BPTC_UNORM,componentsLength:function(e){switch(e){case th.RGB:return 3;case th.RGBA:return 4;case th.LUMINANCE_ALPHA:return 2;default:return 1}},validate:function(e){return e===th.DEPTH_COMPONENT||e===th.DEPTH_STENCIL||e===th.ALPHA||e===th.RGB||e===th.RGBA||e===th.LUMINANCE||e===th.LUMINANCE_ALPHA||e===th.RGB_DXT1||e===th.RGBA_DXT1||e===th.RGBA_DXT3||e===th.RGBA_DXT5||e===th.RGB_PVRTC_4BPPV1||e===th.RGB_PVRTC_2BPPV1||e===th.RGBA_PVRTC_4BPPV1||e===th.RGBA_PVRTC_2BPPV1||e===th.RGBA_ASTC||e===th.RGB_ETC1||e===th.RGB8_ETC2||e===th.RGBA8_ETC2_EAC||e===th.RGBA_BC7},isColorFormat:function(e){return e===th.ALPHA||e===th.RGB||e===th.RGBA||e===th.LUMINANCE||e===th.LUMINANCE_ALPHA},isDepthFormat:function(e){return e===th.DEPTH_COMPONENT||e===th.DEPTH_STENCIL},isCompressedFormat:function(e){return e===th.RGB_DXT1||e===th.RGBA_DXT1||e===th.RGBA_DXT3||e===th.RGBA_DXT5||e===th.RGB_PVRTC_4BPPV1||e===th.RGB_PVRTC_2BPPV1||e===th.RGBA_PVRTC_4BPPV1||e===th.RGBA_PVRTC_2BPPV1||e===th.RGBA_ASTC||e===th.RGB_ETC1||e===th.RGB8_ETC2||e===th.RGBA8_ETC2_EAC||e===th.RGBA_BC7},isDXTFormat:function(e){return e===th.RGB_DXT1||e===th.RGBA_DXT1||e===th.RGBA_DXT3||e===th.RGBA_DXT5},isPVRTCFormat:function(e){return e===th.RGB_PVRTC_4BPPV1||e===th.RGB_PVRTC_2BPPV1||e===th.RGBA_PVRTC_4BPPV1||e===th.RGBA_PVRTC_2BPPV1},isASTCFormat:function(e){return e===th.RGBA_ASTC},isETC1Format:function(e){return e===th.RGB_ETC1},isETC2Format:function(e){return e===th.RGB8_ETC2||e===th.RGBA8_ETC2_EAC},isBC7Format:function(e){return e===th.RGBA_BC7},compressedTextureSizeInBytes:function(e,t,i){switch(e){case th.RGB_DXT1:case th.RGBA_DXT1:case th.RGB_ETC1:case th.RGB8_ETC2:return Math.floor((t+3)/4)*Math.floor((i+3)/4)*8;case th.RGBA_DXT3:case th.RGBA_DXT5:case th.RGBA_ASTC:case th.RGBA8_ETC2_EAC:return Math.floor((t+3)/4)*Math.floor((i+3)/4)*16;case th.RGB_PVRTC_4BPPV1:case th.RGBA_PVRTC_4BPPV1:return Math.floor((Math.max(t,8)*Math.max(i,8)*4+7)/8);case th.RGB_PVRTC_2BPPV1:case th.RGBA_PVRTC_2BPPV1:return Math.floor((Math.max(t,16)*Math.max(i,8)*2+7)/8);case th.RGBA_BC7:return Math.ceil(t/4)*Math.ceil(i/4)*16;default:return 0}},textureSizeInBytes:function(e,t,i,n){let r=th.componentsLength(e);return eh.isPacked(t)&&(r=1),r*eh.sizeInBytes(t)*i*n},alignmentInBytes:function(e,t,i){const n=th.textureSizeInBytes(e,t,i,1)%4;return 0===n?4:2===n?2:1},createTypedArray:function(e,t,i,n){let r;const o=eh.sizeInBytes(t);return r=o===Uint8Array.BYTES_PER_ELEMENT?Uint8Array:o===Uint16Array.BYTES_PER_ELEMENT?Uint16Array:o===Float32Array.BYTES_PER_ELEMENT&&t===eh.FLOAT?Float32Array:Uint32Array,new r(th.componentsLength(e)*i*n)},flipY:function(e,t,i,n,r){if(1===r)return e;const o=th.createTypedArray(t,i,n,r),a=th.componentsLength(t),s=n*a;for(let t=0;t<r;++t){const i=t*n*a,l=(r-t-1)*n*a;for(let t=0;t<s;++t)o[l+t]=e[i+t];}return o},toInternalFormat:function(e,t,i){if(!i.webgl2)return e;if(e===th.DEPTH_STENCIL)return Du.DEPTH24_STENCIL8;if(e===th.DEPTH_COMPONENT){if(t===eh.UNSIGNED_SHORT)return e;if(t===eh.UNSIGNED_INT)return Du.DEPTH_COMPONENT24}if(t===eh.FLOAT)switch(e){case th.RGBA:return Du.RGBA32F;case th.RGB:return Du.RGB32F;case th.RG:return Du.RG32F;case th.R:return Du.R32F}if(t===eh.HALF_FLOAT)switch(e){case th.RGBA:return Du.RGBA16F;case th.RGB:return Du.RGB16F;case th.RG:return Du.RG16F;case th.R:return Du.R16F}return e}};var ih=Object.freeze(th);const nh={supported:!1,testSupport:function(e){!ah&&oh&&(sh?lh(e):rh=e);}};let rh,oh,ah=!1,sh=!1;function lh(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,oh),e.isContextLost())return;nh.supported=!0;}catch(e){}e.deleteTexture(t),ah=!0;}function uh(e,t){if(t&&-1!==t.indexOf("?")){const i=t.split("?")[1],n=new RegExp(`(^|&)${e}=([^&]*)(&|$)`),r=i.match(n);if(null!=r)return unescape(r[2])}return null}function ch(e,t,i){if(1===arguments.length)return e;e.set(e.subarray(t+i),t);}function hh(e){const t=e.responseURL||e.__responseURL,i=e.response,n=i?i.byteLength:0,r=uh("token",t)||"",o=uh("appKey",t)||"",a=uh("key",t)||"";return n>8?dh(i,n,a.length>0?a:o.length>0?o:r,e):i}function dh(e,t,i,n){let r=new Uint8Array(e);if("MEMM"===String.fromCharCode.apply(null,r.subarray(0,4))){const t=new Uint8Array([r[4],r[5],r[6],r[7]]),i=new Uint32Array(t.buffer);r=new Uint8Array(e,16+i[0]);const o=new Uint8Array(e,16,i),a=String.fromCharCode.apply(null,o),s=JSON.parse(a);n.bbx=s;}const o=String.fromCharCode.apply(null,r.subarray(r.length-8,r.length)),a=String.fromCharCode.apply(null,r.subarray(0,9));if(o&&"minedata"===o.toLowerCase())return i&&function(e,t){const i=e.length-8;if(i<=t)for(let t=0;t<i/2;t++){const n=e[t];e[t]=e[i-t-1],e[i-t-1]=n;}else {const n=parseInt(i/t),r=parseInt(t/2);for(let i=0;i<n;i++){const n=i*t,o=(i+1)*t-1;for(let t=n,i=0;t<n+r;t++,i++){const n=o-i,r=e[t];e[t]=e[n],e[n]=r;}}}}(r,function(e){let t=0;const i=e.length;for(let n=0;n<i;n++)t+=e.charCodeAt(n);return parseInt(t/i)}(i)),r.slice(0,t-8);if(a&&"mineearth"===a.toLowerCase()){const e=r[9],t=r[10];return function(e,t,i){const n=e.length-t*i,r=Math.floor(n/t);let o=0,a=r;for(let n=0;n<t;n++)ch(e,a,i),o=a,a=o+r;return e.subarray(0,n)}(r.slice(11,r.length),e,t)}return r=null,e}J.document&&(oh=J.document.createElement("img"),oh.onload=function(){rh&&lh(rh),rh=null,sh=!0;},oh.onerror=function(){ah=!0,rh=null;},oh.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ph=new Set,fh={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",PanoramaImage:"PanoramaImage",PanoramaJson:"PanoramaJson"};"function"==typeof Object.freeze&&Object.freeze(fh);class mh extends Error{constructor(e,t,i){401===t&&i.includes("minemap")&&(e+=": you may have provided an invalid MineMap key."),super(e),this.status=t,this.url=i;}toString(){return `${this.name}: ${this.message} (${this.status}): ${this.url}`}}const _h=Je()?()=>self.worker&&self.worker.referrer:()=>("blob:"===J.location.protocol?J.parent:J).location.href,gh=function(e,t){if(!(/^file:/.test(i=e.url)||/^file:/.test(_h())&&!/^\w+:/.test(i))){if(J.fetch&&J.Request&&J.AbortController&&J.Request.prototype.hasOwnProperty("signal"))return function(e,t){const i=new J.AbortController,n=new J.Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:_h(),signal:i.signal});let r=!1,o=!1;"json"===e.type&&n.headers.set("Accept","application/json");return o||(ph.has(n.url)?t(new Error("error")):J.fetch(n).then((i=>i.ok?(i=>{("arrayBuffer"===e.type?i.arrayBuffer():"json"===e.type?i.json():i.text()).then((n=>{if(o)return;r=!0;let a=n;const s=i.url.includes("png")||i.url.includes("jpg");let l;"arrayBuffer"!==e.type||s||(l={responseURL:i.url,response:n,bbx:null},a=hh(l),l.bbx&&(l.bbx.minimumHeight=l.bbx.minHeight,l.bbx.maximumHeight=l.bbx.maxHeight,delete l.bbx.minHeight,delete l.bbx.maxHeight)),t(null,a,i.headers.get("Cache-Control"),i.headers.get("Expires"),l?.bbx);})).catch((e=>{o||t(new Error(e.message));}));})(i):(i.text(),r=!0,t(new mh(i.statusText,i.status,e.url))))).catch((e=>{20!==e.code&&(ph.add(n.url),t(new Error(e.message)));}))),{cancel:()=>{o=!0,r||i.abort();}}}(e,t);if(Je()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var i;return function(e,t){const i=new J.XMLHttpRequest;i.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(i.responseType="arraybuffer");for(const t in e.headers)i.setRequestHeader(t,e.headers[t]);return "json"===e.type&&(i.responseType="text",i.setRequestHeader("Accept","application/json")),i.withCredentials="include"===e.credentials,i.onerror=()=>{t(new Error(i.statusText));},i.onload=()=>{if((i.status>=200&&i.status<300||0===i.status)&&null!==i.response){let n=i.response;if("json"===e.type)try{n=JSON.parse(i.response);}catch(e){return t(e)}let r=n;const o=e.url.includes("png")||e.url.includes("jpg");"arrayBuffer"!==e.type||o||(r=hh(i)),t(null,r,i.getResponseHeader("Cache-Control"),i.getResponseHeader("Expires"));}else t(new mh(i.statusText,i.status,e.url));},i.send(e.body),{cancel:()=>i.abort()}}(e,t)},yh=function(e,t){return gh(Ve(e,{type:"arrayBuffer"}),t)};function xh(e){const t=J.document.createElement("a");return t.href=e,t.protocol===J.document.location.protocol&&t.host===J.document.location.host}function vh(e,t){const i=new J.Image,n=J.URL;let r=new J.Blob([e],{type:"image/png"});i.onload=()=>{e=null,r=null,t(null,i),n.revokeObjectURL(i.src),i.onload=null,i.src=null;},i.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),i.src=e?.byteLength?n.createObjectURL(r):ot.SOURCE.TRANSPARENT_PNG_URL;}let wh,Th,bh=!1;wh=[],Th=0;const Ph=function(e,t){if(nh.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Th>=ot.SOURCE.MAX_PARALLEL_IMAGE_REQUESTS){const i={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0;}};return wh.push(i),i}Th++;let i=!1;const n=()=>{if(!i)for(i=!0,Th--;wh.length&&Th<ot.SOURCE.MAX_PARALLEL_IMAGE_REQUESTS;){const e=wh.shift(),{requestParameters:t,callback:i,cancelled:n}=e;n||(e.cancel=Ph(t,i).cancel);}},r=yh(e,((i,r,o,a)=>{n(),i?t(i):r&&(!J.createImageBitmap||e.isImageBitmap||e.isImageBitmap?vh(r,((e,i)=>t(e,i,o,a))):function(e,t,i){if(bh)return vh(e,((e,t)=>i(e,t)));let n=new J.Blob([e],{type:"image/png"});J.createImageBitmap(n,t).then((t=>{n=null,e=null,i(null,t);})).catch((()=>{bh=!0,vh(e,((e,t)=>i(e,t)));}));}(r,e.imageBitmapOptions,((e,i)=>t(e,i,o,a))));}));return {cancel:()=>{r.cancel(),n();}}},{HTMLImageElement:Sh,HTMLCanvasElement:Eh,HTMLVideoElement:Ah,ImageData:Ch,ImageBitmap:Mh}=J;class Ih{constructor(e){const{map:t,context:i,pixelFormat:n,compressed:r,premultiply:o,flipY:a,texUrl:s,name:l,target:u,pixelDatatype:c,sampler:h}=e;this.map=Z(t,null),null!=i&&null!=i||!this.map||(this.context=this.map.painter.context);let d=e.image;this.mIsGenerateMipmap=!1,this.anisotropy=Math.min(Yc._maximumTextureFilterAnisotropy,void 0===e.anisotropy?Yc._maximumTextureFilterAnisotropy:e.anisotropy),s&&(this.texUrl=s),e.warpS&&(this.warpS=e.warpS),e.warpT&&(this.warpT=e.warpT),e.minFilter&&(this.minFilter=e.minFilter),e.magFilter&&(this.magFilter=e.magFilter),this.referenceCount=1,this.name=l||"",i&&(this.context=i),this.pixelFormat=Z(n,ih.RGBA),this.pixelDatatype=Z(c,eh.UNSIGNED_BYTE),this.internalFormat=ih.toInternalFormat(this.pixelFormat,this.pixelDatatype,this.context),this.texture=this.context.gl.createTexture(),this._powerOfTwoCalculated=!1,this.powerOfTwoNoneSquareFlag=!1,this.flipY=!!a,this.premultiply=!!o,r?(this.compressed=r,d={data:d[0].data,width:d[0].width,height:d[0].height},Qc.isDXTFormat(n)&&!this.context._s3tc?Ze("When options.pixelFormat is S3TC compressed, this WebGL implementation must support the WEBGL_texture_compression_s3tc extension. Check context.s3tc."):Qc.isPVRTCFormat(n)&&!this.context._pvrtc?Ze("When options.pixelFormat is PVRTC compressed, this WebGL implementation must support the WEBGL_texture_compression_pvrtc extension. Check context.pvrtc."):Qc.isETC1Format(n)&&!this.context._etc1&&Ze("When options.pixelFormat is ETC1 compressed, this WebGL implementation must support the WEBGL_texture_compression_etc1 extension. Check context.etc1.")):this.compressed=!1,this._target=u||Du.TEXTURE_2D,this._hasSetSampler=!1,this.update(d,e),h&&(this.sampler=h);}update(e,t){const i=e?.width||t.width,n=e?.height||t.height,r=!this.size||this.size[0]!==i||this.size[1]!==n,{context:o}=this,{gl:a}=o;if(this.useMipmap=Boolean(t?.useMipmap),this.premultiply=Boolean(t?.premultiply),null==i&&null==n&&this.map)this.useMipmap=Z(t?.useMipmap,!0);else {if(a.bindTexture(this._target,this.texture),o.pixelStoreUnpackFlipY.set(this.flipY),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.premultiply),r)if(this.size=[i,n],this.compressed)a.compressedTexImage2D(this._target,0,this.internalFormat,i,n,0,e.data);else if(t&&t.hasOwnProperty("framebuffer"))a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),null!==t.framebuffer&&t.framebuffer._bind(),a.copyTexImage2D(this._target,0,this.internalFormat,t.xOffset,t.yOffset,i,n,0),null!==t.framebuffer&&t.framebuffer._unBind();else if(e?.arrayBufferView){let t=4;t=ih.alignmentInBytes(this.pixelFormat,this.pixelDatatype,i),a.pixelStorei(a.UNPACK_ALIGNMENT,t),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1),a.texImage2D(this._target,0,this.internalFormat,i,n,0,this.pixelFormat,eh.toWebGLConstant(this.pixelDatatype,o),e.arrayBufferView);}else if(o.pixelStoreUnpackPremultiplyAlpha.set(this.premultiply),e instanceof Sh||e instanceof Eh||e instanceof Ah||e instanceof Ch||Mh&&e instanceof Mh)a.texImage2D(this._target,0,this.internalFormat,this.pixelFormat,eh.toWebGLConstant(this.pixelDatatype,o),e);else {let t=4;t=ih.alignmentInBytes(this.pixelFormat,this.pixelDatatype,i),a.pixelStorei(a.UNPACK_ALIGNMENT,t),a.texImage2D(this._target,0,this.internalFormat,i,n,0,this.pixelFormat,eh.toWebGLConstant(this.pixelDatatype,o),e?.data);}else e instanceof Sh||e instanceof Eh||e instanceof Ah||e instanceof Ch||Mh&&e instanceof Mh?a.texSubImage2D(this._target,0,0,0,this.pixelFormat,eh.toWebGLConstant(this.pixelDatatype,o),e):a.texSubImage2D(this._target,0,0,0,i,n,this.pixelFormat,eh.toWebGLConstant(this.pixelDatatype,o),e?.data);e=null,r&&(this._powerOfTwoCalculated=!1),this.isSizePowerOfTwoNoneSquare()&&this.useMipmap?(a.generateMipmap(this._target),this.mIsGenerateMipmap=!0):this.mIsGenerateMipmap=!1,this._dimensions=new Ot(i,n),this._width=i,this._height=n;}}get width(){return this._width}get height(){return this._height}get sampler(){return this._sampler}get dimensions(){return this._dimensions}set sampler(e){if(this._hasSetSampler)return;this._hasSetSampler=!0;let t=e.minificationFilter,i=e.magnificationFilter;const n=this.context;let r=e.wrapS,o=e.wrapT;this.isSizePowerOfTwoNoneSquare()||(t!==Du.LINEAR_MIPMAP_NEAREST&&t!==Du.LINEAR_MIPMAP_LINEAR&&t!==Du.NEAREST_MIPMAP_NEAREST&&t!==Du.NEAREST_MIPMAP_LINEAR||(t=Du.LINEAR),r===Du.REPEAT&&(r=Du.CLAMP_TO_EDGE),o===Du.REPEAT&&(o=Du.CLAMP_TO_EDGE)),t&&i||(this.isSizePowerOfTwoNoneSquare()&&this.useMipmap?(t=Du.LINEAR_MIPMAP_NEAREST,i=Du.LINEAR):(t=Du.LINEAR,i=Du.LINEAR)),this.useMipmap||(t=Du.LINEAR,i=Du.LINEAR);const a=n.gl,s=this._target;a.activeTexture(a.TEXTURE0),a.bindTexture(s,this.texture),a.texParameteri(s,Du.TEXTURE_MIN_FILTER,t),a.texParameteri(s,Du.TEXTURE_MAG_FILTER,i),a.texParameteri(s,Du.TEXTURE_WRAP_S,r),a.texParameteri(s,Du.TEXTURE_WRAP_T,o),this.anisotropy&&$(n.extTextureFilterAnisotropic)&&a.texParameteri(s,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropy),a.bindTexture(s,null),this._sampler=e;}bind(e,t){return this.sampler={minificationFilter:this.useMipmap?Du.LINEAR_MIPMAP_NEAREST:e,magnificationFilter:e||Du.LINEAR,wrapS:t||Du.CLAMP_TO_EDGE,wrapT:t||Du.CLAMP_TO_EDGE,continueBindTextureOnExit:!0},this}addReference(){this.referenceCount+=1;}reduceReference(){this.referenceCount-=1;}upload(e){const{context:t}=this,{gl:i}=t;this.size=[e.width,e.height],i.deleteTexture(this.texture),this.texture=i.createTexture(),i.pixelStorei(Du.UNPACK_FLIP_Y_WEBGL,this.flipY),i.bindTexture(this._target,this.texture),this.compressed?i.compressedTexImage2D(this._target,0,this.internalFormat,e.width,e.height,0,e.data):e instanceof Sh||e instanceof Eh||e instanceof Ah||e instanceof Ch||Mh&&e instanceof Mh?i.texImage2D(this._target,0,this.internalFormat,this.pixelFormat,this.pixelDatatype,e):i.texImage2D(this._target,0,this.internalFormat,this.size[0],this.size[1],0,this.pixelFormat,this.pixelDatatype,e.data);}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}isSizePowerOfTwoNoneSquare(){return this._powerOfTwoCalculated?this.powerOfTwoNoneSquareFlag:!!this.size&&(this._powerOfTwoCalculated=!0,this.powerOfTwoNoneSquareFlag=Math.log(this.size[0])/Math.LN2%1==0&&Math.log(this.size[1])/Math.LN2%1==0,this.powerOfTwoNoneSquareFlag)}destroy(){if(this.context){if(this.referenceCount-=1,0===this.referenceCount){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null,this.context=null;}Ou(this);}}copyFrom(e){const t=this.context.gl,i=Z(e.xOffset,0),n=Z(e.yOffset,0);if(ih.isDepthFormat(this.pixelFormat))throw new Error("Cannot call copyFrom when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(ih.isCompressedFormat(this.pixelFormat))throw new Error("Cannot call copyFrom with a compressed texture pixel format.");const r=e.source,o=this.context,a=this._target;t.bindTexture(a,this.texture);const s=r.width,l=r.height;let u=r.arrayBufferView;const c=this.internalFormat,h=this.pixelFormat,d=this.pixelDatatype,p=this.flipY;let f=4;$(u)&&(f=ih.alignmentInBytes(h,d,s)),t.pixelStorei(t.UNPACK_ALIGNMENT,f),$(u)?(t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),p&&(u=ih.flipY(u,h,d,s,l)),t.texSubImage2D(a,0,i,n,s,l,h,eh.toWebGLConstant(d,o),u)):(t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(Du.UNPACK_FLIP_Y_WEBGL,p),t.texImage2D(a,0,c,h,eh.toWebGLConstant(d,o),r));}copyFromFramebuffer(e,t,i,n,r,o){if(e=Z(e,0),t=Z(t,0),i=Z(i,0),n=Z(n,0),r=Z(r,this._width),o=Z(o,this._height),ih.isDepthFormat(this.pixelFormat))throw new Error("Cannot call copyFromFramebuffer when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(this.pixelDatatype===eh.FLOAT)throw new Error("Cannot call copyFromFramebuffer when the texture pixel data type is FLOAT.");if(this.pixelDatatype===eh.HALF_FLOAT)throw new Error("Cannot call copyFromFramebuffer when the texture pixel data type is HALF_FLOAT.");if(ih.isCompressedFormat(this.pixelFormat))throw new Error("Cannot call copyFrom with a compressed texture pixel format.");const a=this.context.gl,s=this._target;a.activeTexture(a.TEXTURE0),a.bindTexture(s,this.texture),a.copyTexSubImage2D(s,0,e,t,i,n,r,o),a.bindTexture(s,null),this._initialized=!0;}async load(e,t){this.texUrl=e;const i=await(()=>new Promise(((t,i)=>{Ph({url:this.map._transformRequest(e,fh.Image).url,imageBitmapOptions:{imageOrientation:this.flipY?"flipY":"none",premultiplyAlpha:this.premultiply?"premultiply":"none"}},((e,n)=>{e&&i(e),t(n);}));})))();if(!i.width||!i.height)throw new Error(`load image error, url is ${e}`);this.uploadTexData(i),t&&t();}uploadTexData(e){const t=e.width,i=e.height,{context:n}=this,{gl:r}=n;r.bindTexture(Du.TEXTURE_2D,this.texture),n.pixelStoreUnpackFlipY.set(this.flipY),n.pixelStoreUnpack.set(1),n.pixelStoreUnpackPremultiplyAlpha.set(!1),this.size=[t,i],r.texImage2D(Du.TEXTURE_2D,0,this.internalFormat,this.pixelFormat,eh.toWebGLConstant(this.pixelDatatype,n),e),this._powerOfTwoCalculated=!1,this.isSizePowerOfTwoNoneSquare()&&this.useMipmap&&(r.generateMipmap(Du.TEXTURE_2D),this.mIsGenerateMipmap=!0),this._hasSetSampler=!1,this.map&&(this.map.needRepaint=!0);}serialize(){let e;return $(this.texUrl)&&(e={texUrl:this.texUrl}),e}isDestroyed(){return !1}static fromFramebuffer(e){const t=(e=Z(e,Z.EMPTY_OBJECT)).context,i=t.gl,n=Z(e.pixelFormat,ih.RGBA),r=Z(e.framebufferXOffset,0),o=Z(e.framebufferYOffset,0),a=Z(e.width,i.drawingBufferWidth),s=Z(e.height,i.drawingBufferHeight),l=e.framebuffer;return new Ih({context:t,width:a,height:s,pixelFormat:n,framebuffer:$(l)?l:null,xOffset:r,yOffset:o})}static createImageFromTexture(e,t,i,n){const r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0);const o=new Uint8Array(i*n*4);e.readPixels(0,0,i,n,e.RGBA,e.UNSIGNED_BYTE,o),e.deleteFramebuffer(r);const a=J.document.createElement("canvas");a.width=i,a.height=n;const s=a.getContext("2d"),l=s.createImageData(i,n);l.data.set(o),s.putImageData(l,0,0);const u=new J.Image;return u.src=a.toDataURL("image/png"),u}static createDescendantImageFromTexture(e,t,i,n,r,o){const a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0);const s=new Uint8Array(o*o);e.readPixels(i,n,r,r,e.RGBA,e.UNSIGNED_BYTE,s),e.deleteFramebuffer(a);const l=J.document.createElement("canvas");l.width=o/2,l.height=o/2;const u=l.getContext("2d"),c=u.createImageData(o/2,o/2);c.data.set(s),u.putImageData(c,0,0);const h=J.document.createElement("canvas");h.width=o,h.height=o,h.getContext("2d").drawImage(l,0,0,o,o);const d=new J.Image;return d.src=h.toDataURL("image/png"),d.width=o,d.height=o,d}}class Lh{constructor(e,t,i){if(!$(e))throw new Error("context is required");if(!$(t))throw new Error("attributes is required");if(!$(i))throw new Error("numberOfInstances is required");if(this._attributes=t,this._numberOfInstances=i,0===t.length)return;const n=function(e){let t=!1;const i=e.length;for(let n=0;n<i;++n)if(e[n].type!==Du.UNSIGNED_BYTE){t=!0;break}return t?Du.FLOAT:Du.UNSIGNED_BYTE}(t),r=n===Du.FLOAT&&!e.floatingPointTexture,o=function(e,t){const i=new Array(e.length);let n=0;const r=e.length;for(let o=0;o<r;++o){const r=e[o].type;i[o]=n,r!==Du.UNSIGNED_BYTE&&t?n+=4:++n;}return i}(t,r),a=function(e,t,i){const n=e.length,r=e[n-1];return t[n-1].type!==Du.UNSIGNED_BYTE&&i?r+4:r+1}(o,t,r),s=Math.floor(Yc.maximumTextureSize/a),l=Math.min(i,s),u=a*l,c=Math.ceil(i/l),h=1/u,d=.5*h,p=1/c,f=.5*p;this._textureDimensions=new Ot(u,c),this._textureStep=new St(h,d,p,f),this._pixelDatatype=r?Du.UNSIGNED_BYTE:n,this._packFloats=r,this._offsets=o,this._stride=a,this._texture=void 0;const m=4*u*c;this._batchValues=n!==Du.FLOAT||r?new Uint8Array(m):new Float32Array(m),this._batchValuesDirty=!1;}get attributes(){return this._attributes}get numberOfInstances(){return this._numberOfInstances}getBatchedAttribute(e,t,i){if(e<0||e>=this._numberOfInstances)throw new Error("instanceIndex is out of range.");if(t<0||t>=this._attributes.length)throw new Error("attributeIndex is out of range");const n=this._attributes,r=4*this._stride*e+4*this._offsets[t];let o;o=this._packFloats&&n[t].componentDatatype!==Du.UNSIGNED_BYTE?function(e,t,i){let n=St.unpack(e,t,Rh);const r=St.unpackFloat(n);n=St.unpack(e,t+4,Rh);const o=St.unpackFloat(n);n=St.unpack(e,t+8,Rh);const a=St.unpackFloat(n);n=St.unpack(e,t+12,Rh);const s=St.unpackFloat(n);return St.fromElements(r,o,a,s,i)}(this._batchValues,r,Nh):St.unpack(this._batchValues,r,Nh);const a=Oh(n,t);return $(a.fromCartesian4)?a.fromCartesian4(o,i):$(a.clone)?a.clone(o,i):o.x}setBatchedAttribute(e,t,i){const n=[void 0,void 0,new Ot,new _t,new St],r=new St;if(e<0||e>=this._numberOfInstances)throw new Error("instanceIndex is out of range.");if(t<0||t>=this._attributes.length)throw new Error("attributeIndex is out of range");if(!$(i))throw new Error("value is required.");const o=this._attributes,a=this.getBatchedAttribute(e,t,n[o[t].components]),s=Oh(this._attributes,t);if($(s.equals)?s.equals(a,i):a===i)return;const l=r;l.x=$(i.x)?i.x:i,l.y=$(i.y)?i.y:0,l.z=$(i.z)?i.z:0,l.w=$(i.w)?i.w:0;const u=4*this._stride*e+4*this._offsets[t];this._packFloats&&o[t].type!==Du.UNSIGNED_BYTE?function(e,t,i){let n=St.packFloat(e.x,Rh);St.pack(n,t,i),n=St.packFloat(e.y,n),St.pack(n,t,i+4),n=St.packFloat(e.z,n),St.pack(n,t,i+8),n=St.packFloat(e.w,n),St.pack(n,t,i+12);}(l,this._batchValues,u):St.pack(l,this._batchValues,u),this._batchValuesDirty=!0;}createTexture(e){const t=this._textureDimensions;this._texture=new Ih({context:e,pixelFormat:Du.RGBA,pixelDatatype:this._pixelDatatype,width:t.x,height:t.y,sampler:Kc.NEAREST,flipY:!1});}updateTexture(){const e=this._textureDimensions;this._texture.copyFrom({source:{width:e.x,height:e.y,arrayBufferView:this._batchValues}});}update(e){$(this._texture)&&!this._batchValuesDirty||0===this._attributes.length||(this._batchValuesDirty=!1,$(this._texture)||this.createTexture(e),this.updateTexture());}getUniformMapCallback(){const e=new Map,t=this;return 0===t._attributes.length||(e.set("batchTableTexture",(()=>t._texture)),e.set("batchTextureDimensions",(()=>t._textureDimensions)),e.set("batchTextureStep",(()=>t._textureStep)),e.set("numberOfAttributes",(()=>t._attributes.length))),e}destroy(){return this._texture=this._texture&&this._texture.destroy(),Ou(this)}}const Nh=new St,Rh=new St;function Oh(e,t){const i=e[t].components;return 2===i?Ot:3===i?_t:4===i?St:Number}const Dh=5120,Fh=5121,zh=5122,Bh=5123,Vh=5124,kh=5125,Uh=5126,Gh={[Dh]:1,[Fh]:1,[zh]:2,[Bh]:2,[kh]:4,[Vh]:4,[Uh]:4},Hh={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Yh{constructor(e){const{attributes:t,dynamicDraw:i,context:n,buffers:r,attributesbuffviewObject:o,array:a}=e;this.length=a?a.length:0,this.attributes=t,this.dynamicDraw=i,this.context=n,this._isVectorBuffer=!e.hasOwnProperty("attributesbuffviewObject"),this.buffers={},r?this.buffers=r:this._isVectorBuffer?(this.itemSize=a.bytesPerElement,this._parseAttributesOfVector(a)):this._parseAttributesbuffviewObject(o);}getBuffers(){return this.buffers}bind(e){e&&this.context.bindVertexBuffer.set(this.buffers[e]);}updateData(e){if(!this._isVectorBuffer)return;const t=this.context.gl;this.bind("default"),t.bufferData(t.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?t.DYNAMIC_DRAW:t.STATIC_DRAW);}updateDataTest(e,t){const i=this.context.gl;this.bind(this._isVectorBuffer?"default":t),i.bufferData(i.ARRAY_BUFFER,e.arrayBuffer?e.arrayBuffer:e.buffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW);}enableAttributes(e,t){for(let i=0;i<this.attributes.length;i++){const n=t.attributes[this.attributes[i].name];void 0!==n&&e.enableVertexAttribArray(n);}}setVertexAttribPointers(e,t,i){this._isVectorBuffer?this._setVertexAttribPointersOfVector(e,t,i):this._setVertexAttribPointersOfModel(e,t);}_setVertexAttribPointersOfVector(e,t,i){for(let n=0;n<this.attributes.length;n++){const r=this.attributes[n],o=t.attributes[r.name];this.bind("default"),void 0!==o&&e.vertexAttribPointer(o,r.components,Du[Hh[r.type]],!1,this.itemSize,r.offset+this.itemSize*(i||0));}}_setVertexAttribPointersOfModel(e,t){for(let i=0;i<this.attributes.length;i++){const n=this.attributes[i];let r=!1;-1!==n.name.indexOf("a_COLOR")&&(r=!0),this.bind(n.name);const o=t.attributes[n.name];void 0!==o&&(n.instance?(e.enableVertexAttribArray(n.attribIndex+o),e.vertexAttribPointer(n.attribIndex+o,n.components,Du.FLOAT,r,n.byteStride,n.offset),this.context.drawInstance.vertexAttribDivisorANGLE(n.attribIndex+o,1)):(e.enableVertexAttribArray(o),e.vertexAttribPointer(o,n.components,n.type,r,n.byteStride,n.offset))),this.context.bindVertexBuffer.set(null);}}_parseAttributesOfVector(e){const t=this.context,i=t.gl;this.buffers.default=i.createBuffer(),t.bindVertexBuffer.set(this.buffers.default),i.bufferData(Du.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?Du.DYNAMIC_DRAW:Du.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer;}_parseAttributesbuffviewObject(e){const t=this.context.gl,i=Object.keys(e);i.forEach(((n,r)=>{const o=e[n];let a,s;a=qh(n,"_")?`a${n}`:`a_${n}`;let l,u=r-1,c=!1;for(;u>=0;){if(c=this._findSameBuffer(i[u],n,e),c){l=i[u];break}u--;}if(c)this.buffers[a]=qh(l,"_")?this.buffers[`a${l}`]:this.buffers[`a_${l}`];else {s=t.createBuffer(),this.context.bindVertexBuffer.set(s);const e=null!=o.bufferView?o.bufferView.data:o.value;t.bufferData(Du.ARRAY_BUFFER,e,this.dynamicDraw?Du.DYNAMIC_DRAW:Du.STATIC_DRAW),s.length=e?.length,this.buffers[a]=s;}}));}_findSameBuffer(e,t,i){return null!=i[e].bufferView&&null!=i[t].bufferView?i[e].bufferView.data===i[t].bufferView.data:i[e].value===i[t].value}destroy(){if(!this.context||!this.context.gl)return;const e=this.context.gl;for(const t in this.buffers)e.deleteBuffer(this.buffers[t]),delete this.buffers[t];this.context=null;}}function qh(e,t){return e.charAt(0)==t}class Xh{constructor(){this._animationPropertyMap=new Map,this._animationPropertyOrders=[];}add(e){if(this.has(e.id))throw new Error(`There is already a animationProperty with this ID: ${e.id}`);this._animationPropertyOrders.push(e.id),this._animationPropertyMap.set(e.id,e);}get(e){return this._animationPropertyMap.get(e)}getAll(){const e=[];for(let t=0;t<this._animationPropertyOrders.length;t++){const i=this.get(this._animationPropertyOrders[t]);e.push(i);}return e}has(e){return this._animationPropertyMap.has(e)}sort(e){this._animationPropertyOrders.sort(e);}remove(e,t){if(this.has(e)){if(t){const t=this.get(e);t.destroy&&t.destroy();}this._animationPropertyMap.delete(e);const i=this._animationPropertyOrders.indexOf(e);this._animationPropertyOrders.splice(i,1);}}removeAll(e){for(;this._animationPropertyOrders.length>0;)this.remove(this._animationPropertyOrders[0],e);}get keys(){return this._animationPropertyOrders}get size(){return this._animationPropertyMap.size}}var Wh=8192;J.performance&&J.performance.now?J.performance.now.bind(J.performance):Date.now.bind(Date);const jh=J.requestAnimationFrame||J.mozRequestAnimationFrame||J.webkitRequestAnimationFrame||J.msRequestAnimationFrame,$h=J.cancelAnimationFrame||J.mozCancelAnimationFrame||J.webkitCancelAnimationFrame||J.msCancelAnimationFrame;let Zh;const Kh={now:()=>void 0!==Zh?Zh:J.performance.now(),setNow(e){Zh=e;},restoreNow(){Zh=void 0;},frame(e){const t=jh(e);return {cancel:()=>$h(t)}},getImageData(e){const t=J.document.createElement("canvas"),i=t.getContext("2d");if(!i)throw new Error("failed to create canvas 2d context");return t.width=e.width,t.height=e.height,i.drawImage(e,0,0,e.width,e.height),i.getImageData(0,0,e.width,e.height)},resolveURL(e){const t=J.document.createElement("a");return t.href=e,t.href},hardwareConcurrency:J.navigator.hardwareConcurrency||4,get devicePixelRatio(){return J.devicePixelRatio},supportsWebp:!1};if(J.document){const e=J.document.createElement("img");e.onload=function(){Kh.supportsWebp=!0;},e.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=";}function Qh(e,t,i){const n=Jh(256*e,256*(t=Math.pow(2,i)-t-1),i),r=Jh(256*(e+1),256*(t+1),i);return `${n[0]},${n[1]},${r[0]},${r[1]}`}function Jh(e,t,i){const n=2*Math.PI*6378137/256/Math.pow(2,i);return [e*n-2*Math.PI*6378137/2,t*n-2*Math.PI*6378137/2]}const ed=2*Math.PI*pi;function td(e){return ed*Math.cos(e*Math.PI/180)}function id(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}class nd{constructor(e,t,i=0){this.x=+e,this.y=+t,this.z=+i;}static fromLngLat(e,t=0){const i=fi.convert(e);return new nd((180+i.lng)/360,(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i.lat*Math.PI/360)))/360,function(e,t){return e/td(t)}(t,i.lat))}toLngLat(){return new fi(360*this.x-180,id(this.y))}toAltitude(){return this.z*td(id(this.y))}meterInMercatorCoordinateUnits(){return 1/ed*(e=id(this.y),1/Math.cos(e*Math.PI/180));var e;}}class rd{constructor(e,t,i,n){this.z=e,this.x=t,this.y=i,this.key=ld(0,e,t,i);}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}containsOrContained(e){const t=this.z-e.z;if(0==t){if(this.z===e.z&&this.x===e.x&&this.y===e.y)return !0}else if(t>0){if(this.x>>t===e.x&&this.y>>t===e.y)return !0}else if(this.x===e.x>>t&&this.y===e.y>>t)return !0;return !1}url(e,t){let i,n;e[0].includes("{bbox}")&&(t===mi.LATLON?i=function(e,t,i){if(0===i)return "-180,-90,180,90";{const n=Math.pow(2,i-1);return `${e/(2*n)*360-180},${90-(t+1)/n*180},${(e+1)/(2*n)*360-180},${90-t/n*180}`}}(this.x,this.y,this.z):t===mi.MERCATOR&&(i=Qh(this.x,this.y,this.z))),e[0].includes("{crs}")&&(t===mi.LATLON?n="EPSG:4326":t===mi.MERCATOR&&(n="EPSG:3857"));const r=ud(this.z,this.x,this.y),o=this.x,a=this.y;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/\{z\}/g,String(this.z)).replace(/\{x\}/g,String(o)).replace(/\{y\}/g,String(a)).replace(/\{m\}/g,String(Math.floor(this.x/16))).replace(/\{n\}/g,String(Math.floor(a/16))).replace("{quadkey}",r).replace("{bbox}",i).replace("{crs}",n).replace(/\{c\}/g,this._getC()).replace(/\{r\}/g,this._getR())}wmtsUrl(e,t){let i=e[(this.x+this.y)%e.length].replace(/\{TileMatrixSet\}/g,t.matrixSet).replace(/\{TileMatrix\}/g,String(this.z)).replace(/\{TileCol\}/g,String(this.x)).replace(/\{TileRow\}/g,String(this.y));return t.dimensions&&t.dimensions.forEach(((e,t)=>{i=i.replace(new RegExp(`{${t}}`),String(e));})),i}tmsUrl(e){const t=Qh(this.x,this.y,this.z),i=ud(this.z,this.x,this.y),n=this.x,r=Math.pow(2,this.z)-this.y-1;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/\{z\}/g,String(this.z)).replace(/\{x\}/g,String(n)).replace(/\{y\}/g,String(r)).replace(/\{m\}/g,String(Math.floor(this.x/16))).replace(/\{n\}/g,String(Math.floor(r/16))).replace("{quadkey}",i).replace("{bbox-epsg-3857}",t).replace(/\{c\}/g,this._getC()).replace(/\{r\}/g,this._getR())}baiduUrl(e){const t=this.x-Math.pow(2,this.z)/2,i=Math.pow(2,this.z)/2-this.y-1;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/\{z\}/g,String(this.z)).replace(/\{x\}/g,String(t)).replace(/\{y\}/g,String(i))}_getC(){return this.z>6?`C${Math.floor(Math.floor(this.x/(1<<this.z-5)))}`:"C0"}_getR(){return this.z>6?`R${Math.floor(Math.floor(this.y/(1<<this.z-5)))}`:"R0"}toRealCoord(e){const t="tms"===e?Math.pow(2,this.z)-this.y-1:this.y;return {x:this.x,y:t,z:this.z}}getTilePoint(e){return new te((e.x-this.x)*Wh,(e.y-this.y)*Wh)}}class od{constructor(e,t){this.wrap=e,this.canonical=t,this.key=ld(0,t.z,t.x,t.y);}}const ad=Number.MAX_VALUE;class sd{constructor(e,t,i,n,r,o){this.projection=o,this.overscaledZ=e,this.wrap=t,this.canonical=new rd(i,+n,+r,this.projection),this.key=ld(0,e,n,r),this._distance=ad;}set distance(e){this._distance=e;}get distance(){return this._distance}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}static getParentTileId(e){return new sd(e.overscaledZ-1,0,e.canonical.z-1,Math.floor(e.canonical.x/2),Math.floor(e.canonical.y/2),e.projection)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new sd(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y,this.projection):new sd(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t,this.projection)}isChildOf(e){const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return [new sd(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y,this.projection)];const t=this.canonical.z+1,i=2*this.canonical.x,n=2*this.canonical.y;return [new sd(t,this.wrap,t,i,n,this.projection),new sd(t,this.wrap,t,i+1,n,this.projection),new sd(t,this.wrap,t,i,n+1,this.projection),new sd(t,this.wrap,t,i+1,n+1,this.projection)]}isLessThan(e){return "string"!=typeof e&&(this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y)))}wrapped(){return new sd(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y,this.projection)}unwrapTo(e){return new sd(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y,this.projection)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new od(this.wrap,this.canonical)}toString(){return `${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}toCoordinate(){return new ee(this.canonical.x+Math.pow(2,this.wrap),this.canonical.y,this.canonical.z)}getTilePoint(e){return this.canonical.getTilePoint(new nd(e.x-this.wrap,e.y))}}function ld(e,t,i,n){return `${t}_${i}_${n}`}function ud(e,t,i){let n,r="";for(let o=e;o>0;o--)n=1<<o-1,r+=(t&n?1:0)+(i&n?2:0);return r}$o("CanonicalTileID",rd),$o("OverscaledTileID",sd,{omit:["posMatrix"]});const cd=Object.freeze([1,0,0,1]),hd=Object.freeze([0,0,0,0]),dd={};Object.freeze({COL0ROW0:0,COL0ROW1:1,COL1ROW0:2,COL1ROW1:3});class pd extends At{static get IDENTITY(){return dd.IDENTITY=dd.IDENTITY||Object.freeze(new pd(cd)),dd.IDENTITY}static get ZERO(){return dd.ZERO=dd.ZERO||Object.freeze(new pd(hd)),dd.ZERO}constructor(e){o(e)?super(e[0],e[1],e[2],e[3]):super(...cd);}get ELEMENTS(){return 4}get RANK(){return 2}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,i,n){return this[0]=e,this[1]=t,this[2]=i,this[3]=n,this.check()}setRowMajor(e,t,i,n){return this[0]=e,this[1]=i,this[2]=t,this[3]=n,this.check()}determinant(){return (e=this)[0]*e[3]-e[2]*e[1];var e;}identity(){return this.copy(pd.IDENTITY)}transpose(e=this){return function(e,t){if(e===t){var i=t[1];e[1]=t[2],e[2]=i;}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];}(e,this),e.check()}invert(e){return function(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],a=i*o-r*n;a&&(e[0]=o*(a=1/a),e[1]=-n*a,e[2]=-r*a,e[3]=i*a);}(e,this),e.check()}multiplyLeft(e,t=this){return g(t,e,this),t.check()}multiplyRight(e,t=this){return g(t,this,e),t.check()}rotate(e,t=this){return function(e,t,i){var n=t[0],r=t[1],o=t[2],a=t[3],s=Math.sin(i),l=Math.cos(i);e[0]=n*l+o*s,e[1]=r*l+a*s,e[2]=n*-s+o*l,e[3]=r*-s+a*l;}(t,this,e),t.check()}scale(e,t=this){return o(e)?y(t,this,e):y(t,this,[e,e]),t.check()}transform(e,t=new Ot){return p(t=X(t,e,this),e.length),t}transformVector(e,t){return f("Matrix2.transformVector"),this.transform(e,t)}transformVector2(e,t){return f("Matrix2.transformVector2"),this.transform(e,t)}static equalsArray(e,t,i=0){return e[0]===t[0+i]&&e[1]===t[1+i]&&e[2]===t[2+i]&&e[3]===t[3+i]}static pack(e,t,i=0){return i=i||0,t[i++]=e[0],t[i++]=e[1],t[i++]=e[2],t[i++]=e[3],t}}function fd(e){var t={exports:{}};return e(t,t.exports),t.exports}class md{constructor(e,t,i,n,r,o){this.a=e,this.b=t,this.c=i,this.normal=n||new _t,this.vertexNormals=Array.isArray(n)?n:[],this.color=r||new Ui,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=$(o)?o:0;}clone(){return new md(this.a,this.b,this.c,this.normal,this.color,this.materialIndex)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=new _t(e.vertexNormals[t]);for(let t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=Ui.parse(e.vertexColors[t]);return this}}var _d=Object.freeze({UNPROCESSING:0,PROCESSING:1,PROCESSINGSUCESS:2,PROCESSINGFAIL:3,PROCESSINGFISH:4});class gd{constructor(){this.high=_t.clone(_t.ZERO),this.low=_t.clone(_t.ZERO);}static encode(e,t){let i;return $(t)||(t={high:0,low:0}),e>=0?(i=65536*Math.floor(e/65536),t.high=i,t.low=e-i):(i=65536*Math.floor(-e/65536),t.high=-i,t.low=e+i),t}static fromVector3(e,t){const i={high:0,low:0};$(t)||(t=new gd);const n=t.high,r=t.low;return gd.encode(e.x,i),n.x=i.high,r.x=i.low,gd.encode(e.y,i),n.y=i.high,r.y=i.low,gd.encode(e.z,i),n.z=i.high,r.z=i.low,t}}const yd=new Bt,xd=new vl,vd=new _t;class wd{constructor(e={}){if(this.dynamicDraw=Z(e.dynamicDraw,!0),this._attributes=e.attributes||void 0,this._indexArray=e.indices||void 0,this._vertexBuffer=e.vertexBuffer||void 0,this._indexBuffer=e.indexBuffer||void 0,this.wireframeIndexBuffer=e.wireframeIndexBuffer||void 0,this.primitiveType=$(e.primitiveType)?e.primitiveType:Du.TRIANGLES,this._segmentVector=e.segmentVector||void 0,this.dynamicLayoutBuffer1=e.dynamicLayoutBuffer1||void 0,this.dynamicLayoutBuffer2=e.dynamicLayoutBuffer2||void 0,this.dynamicLayoutBuffer3=e.dynamicLayoutBuffer3||void 0,this.vertices=e.vertices||[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],e.tileBoundingRegion)this.boundingSphere=e.tileBoundingRegion._boundingSphere,this.boundingBox=e.tileBoundingRegion._orientedBoundingBox,this.isTileGeometryType=!0;else if(this.vertices.length>0){const e=this.vertices.length,t=[];for(let i=0;i<e;i+=3)t.push(new _t(this.vertices[i],this.vertices[i+1],this.vertices[i+2]));this.computeBoundingSphere(t),this.computeBoundingBox(t),this.isTileGeometryType=!1;}else this.boundingSphere=null,this.boundingBox=null,this.isTileGeometryType=!1;this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.state=_d.PROCESSINGFISH;}parse(){}update(){}emplaceVertexBufferOfLines(){if(this._vertexArray.clear(),this._usedDoublePrecision){let e,t,i;for(let n=0;n<this.vertices.length;n+=3)e=gd.encode(this.vertices[n]),t=gd.encode(this.vertices[n+1]),i=gd.encode(this.vertices[n+2]),this._vertexArray.emplaceBack(e.high,t.high,i.high,e.low,t.low,i.low);}else for(let e=0;e<this.vertices.length;e+=3)this._vertexArray.emplaceBack(this.vertices[e],this.vertices[e+1],this.vertices[e+2]);}emplaceVertexBufferTriangle(){if(this._vertexArray.clear(),this._usedDoublePrecision){let e,t,i;for(let n=0;n<this.vertices.length;n+=3)e=gd.encode(this.vertices[n]),t=gd.encode(this.vertices[n+1]),i=gd.encode(this.vertices[n+2]),this._vertexArray.emplaceBack(e.high,t.high,i.high,e.low,t.low,i.low,this.uvs[n/3*2],this.uvs[n/3*2+1],this.normals[n],this.normals[n+1],this.normals[n+2]);}else for(let e=0;e<this.vertices.length;e+=3)this._vertexArray.emplaceBack(this.vertices[e],this.vertices[e+1],this.vertices[e+2],this.uvs[e/3*2],this.uvs[e/3*2+1],this.normals[e],this.normals[e+1],this.normals[e+2]);}applyMatrix(e){const t=(new Nt).getNormalMatrix(e);for(let t=0,i=this.vertices.length;t<i;t++)this.vertices[t].transform(e);for(let e=0,i=this.faces.length;e<i;e++){const i=this.faces[e];i.normal.transformByMatrix3(t).normalize();for(let e=0,n=i.vertexNormals.length;e<n;e++)i.vertexNormals[e].transformByMatrix3(t).normalize();}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return yd.makeRotationX(e),this.applyMatrix(yd),this}rotateY(e){return yd.makeRotationY(e),this.applyMatrix(yd),this}rotateZ(e){return yd.makeRotationZ(e),this.applyMatrix(yd),this}translate(e,t,i){return yd.makeTranslation(e,t,i),this.applyMatrix(yd),this}scale(e,t,i){return yd.makeScale(e,t,i),this.applyMatrix(yd),this}lookAt(e){return xd.lookAt(e),xd.updateMatrix(),this.applyMatrix(xd.matrix),this}fromBufferGeometry(e){const t=this,i=null!==e.index?e.index.array:void 0,n=e.attributes,r=n.position.array,o=void 0!==n.normal?n.normal.array:void 0,a=void 0!==n.color?n.color.array:void 0,s=void 0!==n.uv?n.uv.array:void 0,l=void 0!==n.uv2?n.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(let e=0;e<r.length;e+=3)t.vertices.push((new _t).fromArray(r,e)),void 0!==a&&t.colors.push(Ui.parse(a[e]));function u(e,i,n,r){const u=void 0===a?[]:[Ui.parse(t.colors[e]),Ui.parse(t.colors[i]),Ui.parse(t.colors[n])],c=void 0===o?[]:[(new _t).fromArray(o,3*e),(new _t).fromArray(o,3*i),(new _t).fromArray(o,3*n)],h=new md(e,i,n,c,u,r);t.faces.push(h),void 0!==s&&t.faceVertexUvs[0].push([(new Ot).fromArray(s,2*e),(new Ot).fromArray(s,2*i),(new Ot).fromArray(s,2*n)]),void 0!==l&&t.faceVertexUvs[1].push([(new Ot).fromArray(l,2*e),(new Ot).fromArray(l,2*i),(new Ot).fromArray(l,2*n)]);}const c=e.groups;if(c.length>0)for(let e=0;e<c.length;e++){const t=c[e],n=t.start;for(let e=n,r=n+t.count;e<r;e+=3)void 0!==i?u(i[e],i[e+1],i[e+2],t.materialIndex):u(e,e+1,e+2,t.materialIndex);}else if(void 0!==i)for(let e=0;e<i.length;e+=3)u(i[e],i[e+1],i[e+2]);else for(let e=0;e<r.length/3;e+=3)u(e,e+1,e+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(vd).negate(),this.translate(vd.x,vd.y,vd.z),this}normalize(){this.computeBoundingSphere();const e=this.boundingSphere.center,t=this.boundingSphere.radius,i=0===t?1:1/t,n=new Bt;return n.setRowMajor(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix(n),this}computeFaceNormals(){const e=new _t,t=new _t;for(let i=0,n=this.faces.length;i<n;i++){const n=this.faces[i],r=this.vertices[n.a],o=this.vertices[n.b];e.subVectors(this.vertices[n.c],o),t.subVectors(r,o),e.cross(t),e.normalize(),n.normal.copy(e);}}computeVertexNormals(e){let t,i,n,r,o;void 0===e&&(e=!0);const a=new Array(this.vertices.length);for(t=0,i=this.vertices.length;t<i;t++)a[t]=new _t;if(e){let e,t,i;const s=new _t,l=new _t;for(n=0,r=this.faces.length;n<r;n++)o=this.faces[n],e=this.vertices[o.a],t=this.vertices[o.b],i=this.vertices[o.c],s.subVectors(i,t),l.subVectors(e,t),s.cross(l),a[o.a].add(s),a[o.b].add(s),a[o.c].add(s);}else for(this.computeFaceNormals(),n=0,r=this.faces.length;n<r;n++)o=this.faces[n],a[o.a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(t=0,i=this.vertices.length;t<i;t++)a[t].normalize();for(n=0,r=this.faces.length;n<r;n++){o=this.faces[n];const e=o.vertexNormals;3===e.length?(e[0].copy(a[o.a]),e[1].copy(a[o.b]),e[2].copy(a[o.c])):(e[0]=new _t(a[o.a]),e[1]=new _t(a[o.b]),e[2]=new _t(a[o.c]));}this.faces.length>0&&(this.normalsNeedUpdate=!0);}computeFlatVertexNormals(){let e,t,i;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){i=this.faces[e];const t=i.vertexNormals;3===t.length?(t[0].copy(i.normal),t[1].copy(i.normal),t[2].copy(i.normal)):(t[0]=new _t(i.normal),t[1]=new _t(i.normal),t[2]=new _t(i.normal));}this.faces.length>0&&(this.normalsNeedUpdate=!0);}computeMorphNormals(){let e,t,i,n,r;for(i=0,n=this.faces.length;i<n;i++)for(r=this.faces[i],r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=new _t(r.normal),r.__originalVertexNormals||(r.__originalVertexNormals=[]),e=0,t=r.vertexNormals.length;e<t;e++)r.__originalVertexNormals[e]?r.__originalVertexNormals[e].copy(r.vertexNormals[e]):r.__originalVertexNormals[e]=new _t(r.vertexNormals[e]);const o=new wd;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];const t=this.morphNormals[e].faceNormals,r=this.morphNormals[e].vertexNormals;let o,a;for(i=0,n=this.faces.length;i<n;i++)o=new _t,a={a:new _t,b:new _t,c:new _t},t.push(o),r.push(a);}const t=this.morphNormals[e];let a,s;for(o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),i=0,n=this.faces.length;i<n;i++)r=this.faces[i],a=t.faceNormals[i],s=t.vertexNormals[i],a.copy(r.normal),s.a.copy(r.vertexNormals[0]),s.b.copy(r.vertexNormals[1]),s.c.copy(r.vertexNormals[2]);}for(i=0,n=this.faces.length;i<n;i++)r=this.faces[i],r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals;}computeBoundingBox(e){let t;if($(e)||(e=this.vertices),o(e[0])&&e[0]instanceof _t)t=e;else {t=[];for(let i=0;i<e.length;i+=3)t.push(new _t(e[i],e[i+1],e[i+2]));}const i=[];for(let e=0;e<t.length;e++)isNaN(t[e][0])||isNaN(t[e][1])||isNaN(t[e][2])||i.push(t[e]);t=i,this.boundingBox=Uc.fromPoints(t);}computeBoundingSphere(e){let t;if($(e)||(e=this.vertices),o(e[0])&&e[0]instanceof _t)t=e;else {t=[];for(let i=0;i<e.length;i+=3)t.push(new _t(e[i],e[i+1],e[i+2]));}const i=[];for(let e=0;e<t.length;e++)isNaN(t[e][0])||isNaN(t[e][1])||isNaN(t[e][2])||i.push(t[e]);t=i,this.boundingSphere=vc.fromPoints(t);}merge(e,t,i){let n;const r=this.vertices.length,o=this.vertices,a=e.vertices,s=this.faces,l=e.faces,u=this.colors,c=e.colors;void 0===i&&(i=0),void 0!==t&&(n=(new Nt).getNormalMatrix(t));for(let e=0,i=a.length;e<i;e++){const i=new _t(a[e]);void 0!==t&&i.transform(t),o.push(i);}for(let e=0,t=c.length;e<t;e++)u.push(Ui.parse(c[e]));for(let e=0,t=l.length;e<t;e++){let t,o;const a=l[e],u=a.vertexNormals,c=a.vertexColors,h=new md(a.a+r,a.b+r,a.c+r);h.normal.copy(a.normal),void 0!==n&&h.normal.transformByMatrix3(n).normalize();for(let e=0,i=u.length;e<i;e++)t=u[e].clone(),void 0!==n&&t.transformByMatrix3(n).normalize(),h.vertexNormals.push(t);h.color.copy(a.color);for(let e=0,t=c.length;e<t;e++)o=c[e],h.vertexColors.push(Ui.parse(o));h.materialIndex=a.materialIndex+i,s.push(h);}for(let t=0,i=e.faceVertexUvs.length;t<i;t++){const i=e.faceVertexUvs[t];void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]);for(let e=0,n=i.length;e<n;e++){const n=i[e],r=[];for(let e=0,t=n.length;e<t;e++)r.push(new Ot(n[e]));this.faceVertexUvs[t].push(r);}}}mergeMesh(e){e?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);}mergeVertices(){const e={},t=[],i=[];let n,r;const o=Math.pow(10,4);let a,s,l,u,c,h;for(a=0,s=this.vertices.length;a<s;a++)n=this.vertices[a],r=`${Math.round(n.x*o)}_${Math.round(n.y*o)}_${Math.round(n.z*o)}`,void 0===e[r]?(e[r]=a,t.push(this.vertices[a]),i[a]=t.length-1):i[a]=i[e[r]];const d=[];for(a=0,s=this.faces.length;a<s;a++){l=this.faces[a],l.a=i[l.a],l.b=i[l.b],l.c=i[l.c],u=[l.a,l.b,l.c];for(let e=0;e<3;e++)if(u[e]===u[(e+1)%3]){d.push(a);break}}for(a=d.length-1;a>=0;a--){const e=d[a];for(this.faces.splice(e,1),c=0,h=this.faceVertexUvs.length;c<h;c++)this.faceVertexUvs[c].splice(e,1);}const p=this.vertices.length-t.length;return this.vertices=t,p}setFromPoints(e){this.vertices=[];for(let t=0,i=e.length;t<i;t++){const i=e[t];this.vertices.push(new _t(i.x,i.y,i.z||0));}return this}sortFacesByMaterialIndex(){const e=this.faces,t=e.length;for(let i=0;i<t;i++)e[i]._id=i;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));const i=this.faceVertexUvs[0],n=this.faceVertexUvs[1];let r,o;i&&i.length===t&&(r=[]),n&&n.length===t&&(o=[]);for(let a=0;a<t;a++){const t=e[a]._id;r&&r.push(i[t]),o&&o.push(n[t]);}r&&(this.faceVertexUvs[0]=r),o&&(this.faceVertexUvs[1]=o);}static fromBucket(e,t,i){if(!i)throw new Error("检查当前的瓦片没有 tileBoundingRegion！无法创建geometry对象！");const n=new wd({tileBoundingRegion:i});return n._vertexBuffer=e.layoutVertexBuffer,n._indexBuffer=e.indexBuffer,n._segmentVector=e.segments,n.primitiveType=$(t)?t:Du.TRIANGLES,e._animationFlag&&(n.animationVertexBuffers=e.animationVertexBuffers),n}static fromPointCloudData(e,t){const i=new wd({});return i._vertexBuffer=e.layoutVertexBuffer,i._indexBuffer=e.indexBuffer,i._segmentVector=e.segmentVector,i.primitiveType=$(t)?t:Du.POINTS,i}setData(){}destroy(){this._attributes=void 0,this._indexArray=void 0,this._indexBuffer?.destroy(),this._vertexBuffer?.destroy(),this._segmentVector?.destroy(),this.wireframeIndexBuffer?.destroy(),this.dynamicLayoutBuffer1?.destroy(),this.dynamicLayoutBuffer2?.destroy(),this.dynamicLayoutBuffer3?.destroy(),this._vertexBuffer=void 0,this._indexBuffer=void 0,this._segmentVector=void 0,this.wireframeIndexBuffer=void 0,this.dynamicLayoutBuffer1=void 0,this.dynamicLayoutBuffer2=void 0,this.dynamicLayoutBuffer3=void 0,this.primitiveType=void 0,this.boundingSphere=void 0,this.boundingBox=void 0;}}function Td(e,t,i,n,r,o){let a,s;if(void 0===o&&(o=function(e,t={}){const{start:i=0,end:n=e.length}=t,r=t.size||2;let o=0;for(let t=i,a=n-r;t<n;t+=r)o+=(e[t]-e[a])*(e[t+1]+e[a+1]),a=t;return o/2}(e,{start:t,end:i,size:n})),r===o<0)for(a=t;a<i;a+=n)s=Hd(a,e[a],e[a+1],s);else for(a=i-n;a>=t;a-=n)s=Hd(a,e[a],e[a+1],s);return s&&zd(s,s.next)&&(Yd(s),s=s.next),s}function bd(e,t){if(!e)return e;t||(t=e);let i,n=e;do{if(i=!1,n.steiner||!zd(n,n.next)&&0!==Fd(n.prev,n,n.next))n=n.next;else {if(Yd(n),n=t=n.prev,n===n.next)break;i=!0;}}while(i||n!==t);return t}function Pd(e,t,i,n,r,o,a){if(!e)return;!a&&o&&function(e,t,i,n){let r=e;do{null===r.z&&(r.z=Nd(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,i,n,r,o,a,s,l,u=1;do{for(r=e,e=null,l=null,n=0;r;){for(n++,a=r,o=0,i=0;i<u&&(o++,a=a.nextZ,a);i++);for(s=u;o>0||s>0&&a;)0!==o&&(0===s||!a||r.z<=a.z)?(t=r,r=r.nextZ,o--):(t=a,a=a.nextZ,s--),l?l.nextZ=t:e=t,t.prevZ=l,l=t;r=a;}l.nextZ=null,u*=2;}while(n>1)}(r);}(e,n,r,o);let s,l,u=e;for(;e.prev!==e.next;)if(s=e.prev,l=e.next,o?Ed(e,n,r,o):Sd(e))t.push(s.i/i),t.push(e.i/i),t.push(l.i/i),Yd(e),e=l.next,u=l.next;else if((e=l)===u){a?1===a?Pd(e=Ad(bd(e),t,i),t,i,n,r,o,2):2===a&&Cd(e,t,i,n,r,o):Pd(bd(e),t,i,n,r,o,1);break}}function Sd(e){const t=e.prev,i=e,n=e.next;if(Fd(t,i,n)>=0)return !1;let r=e.next.next;for(;r!==e.prev;){if(Od(t.x,t.y,i.x,i.y,n.x,n.y,r.x,r.y)&&Fd(r.prev,r,r.next)>=0)return !1;r=r.next;}return !0}function Ed(e,t,i,n){const r=e.prev,o=e,a=e.next;if(Fd(r,o,a)>=0)return !1;const s=r.x>o.x?r.x>a.x?r.x:a.x:o.x>a.x?o.x:a.x,l=r.y>o.y?r.y>a.y?r.y:a.y:o.y>a.y?o.y:a.y,u=Nd(r.x<o.x?r.x<a.x?r.x:a.x:o.x<a.x?o.x:a.x,r.y<o.y?r.y<a.y?r.y:a.y:o.y<a.y?o.y:a.y,t,i,n),c=Nd(s,l,t,i,n);let h=e.prevZ,d=e.nextZ;for(;h&&h.z>=u&&d&&d.z<=c;){if(h!==e.prev&&h!==e.next&&Od(r.x,r.y,o.x,o.y,a.x,a.y,h.x,h.y)&&Fd(h.prev,h,h.next)>=0)return !1;if(h=h.prevZ,d!==e.prev&&d!==e.next&&Od(r.x,r.y,o.x,o.y,a.x,a.y,d.x,d.y)&&Fd(d.prev,d,d.next)>=0)return !1;d=d.nextZ;}for(;h&&h.z>=u;){if(h!==e.prev&&h!==e.next&&Od(r.x,r.y,o.x,o.y,a.x,a.y,h.x,h.y)&&Fd(h.prev,h,h.next)>=0)return !1;h=h.prevZ;}for(;d&&d.z<=c;){if(d!==e.prev&&d!==e.next&&Od(r.x,r.y,o.x,o.y,a.x,a.y,d.x,d.y)&&Fd(d.prev,d,d.next)>=0)return !1;d=d.nextZ;}return !0}function Ad(e,t,i){let n=e;do{const r=n.prev,o=n.next.next;!zd(r,o)&&Bd(r,n,n.next,o)&&Ud(r,o)&&Ud(o,r)&&(t.push(r.i/i),t.push(n.i/i),t.push(o.i/i),Yd(n),Yd(n.next),n=e=o),n=n.next;}while(n!==e);return bd(n)}function Cd(e,t,i,n,r,o){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&Dd(a,e)){let s=Gd(a,e);return a=bd(a,a.next),s=bd(s,s.next),Pd(a,t,i,n,r,o),void Pd(s,t,i,n,r,o)}e=e.next;}a=a.next;}while(a!==e)}function Md(e,t){return e.x-t.x}function Id(e,t){if(t=function(e,t){let i=t;const n=e.x,r=e.y;let o,a=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const e=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=n&&e>a){if(a=e,e===n){if(r===i.y)return i;if(r===i.next.y)return i.next}o=i.x<i.next.x?i:i.next;}}i=i.next;}while(i!==t);if(!o)return null;if(n===a)return o;const s=o,l=o.x,u=o.y;let c,h=1/0;i=o;do{n>=i.x&&i.x>=l&&n!==i.x&&Od(r<u?n:a,r,l,u,r<u?a:n,r,i.x,i.y)&&(c=Math.abs(r-i.y)/(n-i.x),Ud(i,e)&&(c<h||c===h&&(i.x>o.x||i.x===o.x&&Ld(o,i)))&&(o=i,h=c)),i=i.next;}while(i!==s);return o}(e,t),t){const i=Gd(t,e);bd(t,t.next),bd(i,i.next);}}function Ld(e,t){return Fd(e.prev,e,t.prev)<0&&Fd(t.next,e,e.next)<0}function Nd(e,t,i,n,r){return (e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Rd(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;}while(t!==e);return i}function Od(e,t,i,n,r,o,a,s){return (r-a)*(t-s)-(e-a)*(o-s)>=0&&(e-a)*(n-s)-(i-a)*(t-s)>=0&&(i-a)*(o-s)-(r-a)*(n-s)>=0}function Dd(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&Bd(i,i.next,e,t))return !0;i=i.next;}while(i!==e);return !1}(e,t)&&(Ud(e,t)&&Ud(t,e)&&function(e,t){let i=e,n=!1;const r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;}while(i!==e);return n}(e,t)&&(Fd(e.prev,e,t.prev)||Fd(e,t.prev,t))||zd(e,t)&&Fd(e.prev,e,e.next)>0&&Fd(t.prev,t,t.next)>0)}function Fd(e,t,i){return (t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function zd(e,t){return e.x===t.x&&e.y===t.y}function Bd(e,t,i,n){const r=kd(Fd(e,t,i)),o=kd(Fd(e,t,n)),a=kd(Fd(i,n,e)),s=kd(Fd(i,n,t));return r!==o&&a!==s||!(0!==r||!Vd(e,i,t))||!(0!==o||!Vd(e,n,t))||!(0!==a||!Vd(i,e,n))||!(0!==s||!Vd(i,t,n))}function Vd(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function kd(e){return e>0?1:e<0?-1:0}function Ud(e,t){return Fd(e.prev,e,e.next)<0?Fd(e,t,e.next)>=0&&Fd(e,e.prev,t)>=0:Fd(e,t,e.prev)<0||Fd(e,e.next,t)<0}function Gd(e,t){const i=new qd(e.i,e.x,e.y),n=new qd(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function Hd(e,t,i,n){const r=new qd(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function Yd(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ);}function qd(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1;}const Xd=ot.CesiumMath,Wd={computeArea2D:function(e){if(e.length<3)throw new Error("positions.length must greater than 3.");const t=e.length;let i=0;for(let n=t-1,r=0;r<t;n=r++){const t=e[n],o=e[r];i+=t.x*o.y-o.x*t.y;}return .5*i},computeWindingOrder2D:function(e){return Wd.computeArea2D(e)>0?Qd.COUNTER_CLOCKWISE:Qd.CLOCKWISE},triangulate:function(e,t){if(!$($))throw new Error("positions could not be undefined!");return function(e,t,i,n){i=i||2;const r=t&&t.length,o=r?t[0]*i:e.length;let a=Td(e,0,o,i,!0,n);const s=[];if(!a||a.next===a.prev)return s;let l,u,c,h,d,p,f;if(r&&(a=function(e,t,i,n,r){const o=[];let a,s,l,u,c;for(a=0,s=t.length;a<s;a++)l=t[a]*n,u=a<s-1?t[a+1]*n:e.length,c=Td(e,l,u,n,!1,r),c===c.next&&(c.steiner=!0),o.push(Rd(c));for(o.sort(Md),a=0;a<o.length;a++)Id(o[a],i),i=bd(i,i.next);return i}(e,t,a,i,n)),e.length>80*i){h=u=e[0],d=c=e[1];for(let t=i;t<o;t+=i)p=e[t],f=e[t+1],p<h&&(h=p),f<d&&(d=f),p>u&&(u=p),f>c&&(c=f);l=Math.max(u-h,c-d),l=0!==l?1/l:0;}return Pd(a,s,i,h,d,l),s}(Ot.packArray(e),t,2)},computeSubdivision:function(e,t,i,n){const r=new _t,o=new _t,a=new _t,s=new _t,l=new _t,u=new _t,c=new _t;if(n=Z(n,Xd.RADIANS_PER_DEGREE),"object"!=typeof e)throw new Error("ellipsoid could not be undefined!");if(!$(t))throw new Error("positions could not be undefined!");if(!$(i))throw new Error("indices could not be undefined!");if(i.length<3)throw new Error("indices.length could not less than 3!");if(i.length%3!=0)throw new Error("indices.length % 3 must equal 0!");if(n<=0)throw new Error("granularity must greater than 0!");const h=i.slice(0);let d;const p=t.length,f=new Array(3*p);let m=0;for(d=0;d<p;d++){const e=t[d];f[m++]=e.x,f[m++]=e.y,f[m++]=e.z;}const _=[],g={},y=e.maximumRadius,x=Xd.chordLength(n,y),v=x*x;for(;h.length>0;){const e=h.pop(),t=h.pop(),i=h.pop(),n=_t.fromArray(f,3*i,r),p=_t.fromArray(f,3*t,o),m=_t.fromArray(f,3*e,a),x=_t.multiplyByScalar(_t.normalize(n,s),y,s),w=_t.multiplyByScalar(_t.normalize(p,l),y,l),T=_t.multiplyByScalar(_t.normalize(m,u),y,u),b=_t.magnitudeSquared(_t.subtract(x,w,c)),P=_t.magnitudeSquared(_t.subtract(w,T,c)),S=_t.magnitudeSquared(_t.subtract(T,x,c)),E=Math.max(b,P,S);let A,C;E>v?b===E?(A=`${Math.min(i,t)} ${Math.max(i,t)}`,d=g[A],$(d)||(C=_t.add(n,p,c),_t.multiplyByScalar(C,.5,C),f.push(C.x,C.y,C.z),d=f.length/3-1,g[A]=d),h.push(i,d,e),h.push(d,t,e)):P===E?(A=`${Math.min(t,e)} ${Math.max(t,e)}`,d=g[A],$(d)||(C=_t.add(p,m,c),_t.multiplyByScalar(C,.5,C),f.push(C.x,C.y,C.z),d=f.length/3-1,g[A]=d),h.push(t,d,i),h.push(d,e,i)):S===E&&(A=`${Math.min(e,i)} ${Math.max(e,i)}`,d=g[A],$(d)||(C=_t.add(m,n,c),_t.multiplyByScalar(C,.5,C),f.push(C.x,C.y,C.z),d=f.length/3-1,g[A]=d),h.push(e,d,t),h.push(d,i,t)):(_.push(i),_.push(t),_.push(e));}return {positions:f,indices:_}}},jd=new Ps,$d=new Ps,Zd=new Ps,Kd=new Ps;Wd.computeRhumbLineSubdivision=function(e,t,i,n){const r=new _t,o=new _t,a=new _t,s=new _t;if(n=Z(n,Xd.RADIANS_PER_DEGREE),"object"!=typeof e)throw new Error("ellipsoid could not be undefined!");if(!$(t))throw new Error("positions could not be undefined!");if(!$(i))throw new Error("indices could not be undefined!");if(i.length<3)throw new Error("indices.length could not less than 3!");if(i.length%3!=0)throw new Error("indices.length % 3 must equal 0!");if(n<=0)throw new Error("granularity must greater than 0!");const l=i.slice(0);let u;const c=t.length,h=new Array(3*c);let d=0;for(u=0;u<c;u++){const e=t[u];h[d++]=e.x,h[d++]=e.y,h[d++]=e.z;}const p=[],f={},m=Xd.chordLength(n,e.maximumRadius),_=new xu(void 0,void 0,e),g=new xu(void 0,void 0,e),y=new xu(void 0,void 0,e);for(;l.length>0;){const t=l.pop(),i=l.pop(),n=l.pop(),c=_t.fromArray(h,3*n,r),d=_t.fromArray(h,3*i,o),x=_t.fromArray(h,3*t,a),v=e.cartesianToCartographic(c,jd),w=e.cartesianToCartographic(d,$d),T=e.cartesianToCartographic(x,Zd);_.setEndPoints(v,w);const b=_.surfaceDistance;g.setEndPoints(w,T);const P=g.surfaceDistance;y.setEndPoints(T,v);const S=y.surfaceDistance,E=Math.max(b,P,S);let A,C,M,I;E>m?b===E?(A=`${Math.min(n,i)} ${Math.max(n,i)}`,u=f[A],$(u)||(C=_.interpolateUsingFraction(.5,Kd),M=.5*(v.height+w.height),I=_t.fromRadians(C.longitude,C.latitude,M,e,s),h.push(I.x,I.y,I.z),u=h.length/3-1,f[A]=u),l.push(n,u,t),l.push(u,i,t)):P===E?(A=`${Math.min(i,t)} ${Math.max(i,t)}`,u=f[A],$(u)||(C=g.interpolateUsingFraction(.5,Kd),M=.5*(w.height+T.height),I=_t.fromRadians(C.longitude,C.latitude,M,e,s),h.push(I.x,I.y,I.z),u=h.length/3-1,f[A]=u),l.push(i,u,n),l.push(u,t,n)):S===E&&(A=`${Math.min(t,n)} ${Math.max(t,n)}`,u=f[A],$(u)||(C=y.interpolateUsingFraction(.5,Kd),M=.5*(T.height+v.height),I=_t.fromRadians(C.longitude,C.latitude,M,e,s),h.push(I.x,I.y,I.z),u=h.length/3-1,f[A]=u),l.push(t,u,i),l.push(u,n,i)):(p.push(n),p.push(i),p.push(t));}return {positions:h,indices:p}},Wd.scaleToGeodeticHeight=function(e,t,i,n){i=Z(i,hi.WGS84);let r=new _t,o=new _t;if(t=Z(t,0),n=Z(n,!0),$(e)){const a=e.length;for(let s=0;s<a;s+=3)_t.fromArray(e,s,o),n&&(o=i.scaleToGeodeticSurface(o,o)),0!==t&&(r=i.geodeticSurfaceNormal(o,r),_t.multiplyByScalar(r,t,r),_t.add(o,r,o)),e[s]=o.x,e[s+1]=o.y,e[s+2]=o.z;}return e},Wd.hierarchyPack=function(e,t){if($(e.holes)){t.holes=[];for(let i=0;i<e.holes.length;i++)t.holes[i]=Wd.hierarchyPack(e.holes[i],{});}if($(e.positions)){const i=[];for(let t=0;t<e.positions.length;t++)i.push(_t.pack(e.positions[t],new Array(3)));t.positions=i;}return t},Wd.hierarchyUnpack=function(e,t){if($(e.holes)){t.holes=[];for(const i in e.holes)t.holes[i]=Wd.hierarchyUnpack(e.holes[i],{});}if($(e.positions)){const i=[];for(let t=0;t<e.positions.length;t++)i.push(_t.unpack(e.positions[t]));t.positions=i;}return t};const Qd={CLOCKWISE:Du.CW,COUNTER_CLOCKWISE:Du.CCW};function Jd(){this._array=[],this._offset=0,this._length=0;}Qd.validate=function(e){return e===Qd.CLOCKWISE||e===Qd.COUNTER_CLOCKWISE},Object.defineProperties(Jd.prototype,{length:{get(){return this._length}}}),Jd.prototype.enqueue=function(e){this._array.push(e),this._length++;},Jd.prototype.dequeue=function(){if(0===this._length)return;const e=this._array;let t=this._offset;const i=e[t];return e[t]=void 0,t++,t>10&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,i},Jd.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]},Jd.prototype.contains=function(e){return -1!==this._array.indexOf(e)},Jd.prototype.clear=function(){this._array.length=this._offset=this._length=0;},Jd.prototype.sort=function(e){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e);};class ep{constructor(e){this.segments=e||[];}pushSegment(e){this.segments.push(e);}prepareSegment(e,t,i){let n=this.segments[this.segments.length-1];return (!n||n.vertexLength+e>ep.MAX_VERTEX_ARRAY_LENGTH)&&(n={vertexOffset:t.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0},this.segments.push(n)),n}static simpleSegment(e,t,i,n){return new ep([{vertexOffset:e,primitiveOffset:t,vertexLength:i,primitiveLength:n,vaos:{},sortKey:0}])}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy();}}ep.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,$o("SegmentVector",ep);const tp=bi([{name:"a_PositionHigh",type:"Float32",components:3},{name:"a_PositionLow",type:"Float32",components:3},{name:"a_TEXCOORD_0",type:"Float32",components:2},{name:"a_NORMAL",type:"Float32",components:3}]),ip=bi([{name:"a_POSITION",type:"Float32",components:3},{name:"a_TEXCOORD_0",type:"Float32",components:2},{name:"a_NORMAL",type:"Float32",components:3}],4),np=ot.TRANSFORM.EPSILON10;function rp(e,t,i,n){if(!$(e))return;i=Z(i,!1);const r=$(n),o=e.length;if(o<2)return e;let a,s,l,u=e[0],c=0,h=-1;for(a=1;a<o;++a)s=e[a],t(u,s,np)?($(l)||(l=e.slice(0,a),c=a-1,h=0),r&&n.push(a)):($(l)&&(l.push(s),c=a,r&&(h=n.length)),u=s);return i&&t(e[0],e[o-1],np)&&(r&&($(l)?n.splice(h,0,c):n.push(o-1)),$(l)?l.length-=1:l=e.slice(0,-1)),$(l)?l:e}function op(e,t,i,n){this.x=Z(e,0),this.y=Z(t,0),this.width=Z(i,0),this.height=Z(n,0);}op.packedLength=4,op.pack=function(e,t,i){return i=Z(i,0),t[i++]=e.x,t[i++]=e.y,t[i++]=e.width,t[i]=e.height,t},op.unpack=function(e,t,i){return t=Z(t,0),$(i)||(i=new op),i.x=e[t++],i.y=e[t++],i.width=e[t++],i.height=e[t],i},op.fromPoints=function(e,t){if($(t)||(t=new op),!$(e)||0===e.length)return t.x=0,t.y=0,t.width=0,t.height=0,t;const i=e.length;let n=e[0].x,r=e[0].y,o=e[0].x,a=e[0].y;for(let t=1;t<i;t++){const i=e[t],s=i.x,l=i.y;n=Math.min(s,n),o=Math.max(s,o),r=Math.min(l,r),a=Math.max(l,a);}return t.x=n,t.y=r,t.width=o-n,t.height=a-r,t},op.clone=function(e,t){if($(e))return $(t)?(t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,t):new op(e.x,e.y,e.width,e.height)},op.union=function(e,t,i){$(i)||(i=new op);const n=Math.min(e.x,t.x),r=Math.min(e.y,t.y),o=Math.max(e.x+e.width,t.x+t.width),a=Math.max(e.y+e.height,t.y+t.height);return i.x=n,i.y=r,i.width=o-n,i.height=a-r,i},op.expand=function(e,t,i){i=op.clone(e,i);const n=t.x-i.x,r=t.y-i.y;return n>i.width?i.width=n:n<0&&(i.width-=n,i.x=t.x),r>i.height?i.height=r:r<0&&(i.height-=r,i.y=t.y),i},op.equals=function(e,t){return e===t||$(e)&&$(t)&&e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height},op.prototype.clone=function(e){return op.clone(this,e)},op.prototype.equals=function(e){return op.equals(this,e)};const ap={NONE:0,GEODESIC:1,RHUMB:2},sp=ap;class lp{constructor(){}static adjustPosHeightsForNormal(e,t,i,n){const r=new Ps,o=new Ps,a=n.cartesianToCartographic(e,r);Qt(a,a);const s=a.height,l=n.cartesianToCartographic(t,o);Qt(l,l),l.height=s,n.cartographicToCartesian(l,t);const u=n.cartesianToCartographic(i,o);Qt(u,u),u.height=s-100,n.cartographicToCartesian(u,i);}static combineGeometries(e){const t=e.length;let i,n,r,o;const a=$(e[0].indices);for(n=1;n<t;++n)if($(e[n].indices)!==a)throw new Error("All geometries must have an indices or not have one.");const s=this.findAttributesInAllGeometries(e);let l,u,c,h;for(i in s)if(s.hasOwnProperty(i))for(l=s[i],o=0,n=0;n<t;++n)for(u=e[n][i],c=u.length,r=0;r<c;++r)l[o++]=u[r];if(a){let i=0;for(n=0;n<t;++n)i+=e[n].indices.length;const r=new Uint16Array(i);let a=0,s=0;for(n=0;n<t;++n){const t=e[n].indices,i=t.length;for(o=0;o<i;++o)r[a++]=s+t[o];s+=e[n].positions.length/3;}h=r;}return {positions:s.positions,normals:s.normals,uvs:s.uvs,indices:h}}static computeAttributes(e){const t=new _t,i=new _t,n=new _t,r=new _t,o=new _t,a=new _t,s=new _t,l=new Nt,u=e.geometry,c=u.positions;let h=c.length;const d=e.wall,p=e.top||d,f=e.bottom||d,m=e.boundingRectangle,_=e.tangentPlane,g=e.ellipsoid,y=e.perPositionHeight,x=o;x.x=m.x,x.y=m.y;const v=new Float32Array(h/3*2);let w;w=y&&p&&!d?u.normals:new Float32Array(h);let T=0,b=0,P=i,S=!0,E=l;E=Nt.clone(Nt.IDENTITY,E);let A=0,C=0;p&&f&&(A=h/2,C=h/3,h/=2);for(let i=0;i<h;i+=3){const o=_t.fromArray(c,i,s);let l=Nt.multiplyByVector(E,o,t);l=g.scaleToGeodeticSurface(l,l);const u=_.projectPointOntoPlane(l,a);Ot.subtract(u,x,u);const M=ze(u.x/m.width,0,1),I=ze(u.y/m.height,0,1);f&&(v[T+C]=M,v[T+1+C]=I),p&&(v[T]=M,v[T+1]=I),T+=2;const L=b+1,N=b+2;if(d){if(i+3<h){const e=_t.fromArray(c,i+3,n);if(S){const t=_t.fromArray(c,i+h,r);y&&this.adjustPosHeightsForNormal(o,e,t,g),_t.subtract(e,o,e),_t.subtract(t,o,t),P=_t.normalize(_t.cross(t,e,P),P),S=!1;}_t.equalsEpsilon(e,o,ot.CesiumMath.EPSILON10)&&(S=!0);}}else P=g.geodeticSurfaceNormal(o,P);e.wall?(w[b+A]=P.x,w[L+A]=P.y,w[N+A]=P.z):f&&(w[b+A]=-P.x,w[L+A]=-P.y,w[N+A]=-P.z),(p&&!y||d)&&(w[b]=P.x,w[L]=P.y,w[N]=P.z),b+=3;}return u.uvs=v,u.normals=w,u}static computeBoundingBox(e){const t=[];for(let i=0;i<e.length;i+=3)t.push(new _t(e[i],e[i+1],e[i+2]));return (new Uc).setFromPoints(t)}static computeBoundingSphere(e){const t=[];for(let i=0;i<e.length;i+=3)t.push(new _t(e[i],e[i+1],e[i+2]));return vc.fromPoints(t)}static computeBoundingRectangle(e,t,i,n=0,r){const o=(new Et).fromAxisRotation(new _t(e.x,e.y,e.z),n),a=(new Nt).fromQuaternion(o);let s=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,u=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY;const h=i.length;for(let e=0;e<h;++e){const n=_t.clone(i[e]);Nt.multiplyByVector(a,n,n);const r=t(n);s=Math.min(s,r.x),l=Math.max(l,r.x),u=Math.min(u,r.y),c=Math.max(c,r.y);}return $(r)||(r=new op),r.x=s,r.y=u,r.width=l-s,r.height=c-u,r}static computeNormal(e,t){const i=new _t,n=new _t,r=new _t,o=new _t,a=e.length/3,s=t.length,l=new Array(a),u=new Array(s/3),c=new Array(s);let h;for(h=0;h<a;h++)l[h]={indexOffset:0,count:0,currentCount:0};let d=0;for(h=0;h<s;h+=3){const i=t[h],a=t[h+1],s=t[h+2],c=3*i,p=3*a,f=3*s;n.x=e[c],n.y=e[c+1],n.z=e[c+2],r.x=e[p],r.y=e[p+1],r.z=e[p+2],o.x=e[f],o.y=e[f+1],o.z=e[f+2],l[i].count++,l[a].count++,l[s].count++,_t.subtract(r,n,r),_t.subtract(o,n,o),u[d]=_t.cross(r,o,new _t),d++;}let p,f=0;for(h=0;h<a;h++)l[h].indexOffset+=f,f+=l[h].count;for(d=0,h=0;h<s;h+=3){p=l[t[h]];let e=p.indexOffset+p.currentCount;c[e]=d,p.currentCount++,p=l[t[h+1]],e=p.indexOffset+p.currentCount,c[e]=d,p.currentCount++,p=l[t[h+2]],e=p.indexOffset+p.currentCount,c[e]=d,p.currentCount++,d++;}const m=[];for(h=0;h<a;h++){const e=3*h;if(p=l[h],_t.clone(_t.ZERO,i),p.count>0){for(d=0;d<p.count;d++)_t.add(i,u[c[p.indexOffset+d]],i);_t.equalsEpsilon(_t.ZERO,i,ot.CesiumMath.EPSILON10)&&_t.clone(u[c[p.indexOffset]],i);}_t.equalsEpsilon(_t.ZERO,i,ot.CesiumMath.EPSILON10)&&(i.z=1),_t.normalize(i,i),m[e]=i.x,m[e+1]=i.y,m[e+2]=i.z;}return m}static createGeometryFromPositions(e,t,i,n,r){let o=Wd.triangulate(t.positions2D,t.holes);o.length<3&&(o=[0,1,2]);const a=t.positions;if(n){const e=a.length,t=new Array(3*e);let i=0;for(let n=0;n<e;n++){const e=a[n];t[i++]=e.x,t[i++]=e.y,t[i++]=e.z;}return {positions:t,indices:o,normals:this.computeNormal(t,o)}}return r===sp.GEODESIC?Wd.computeSubdivision(e,a,o,i):r===sp.RHUMB?Wd.computeRhumbLineSubdivision(e,a,o,i):void 0}static createOutlineGeometryFromPositions(e,t,i,n,r){const o=[],a=Ic.fromPoints(t,e).projectPointsOntoPlane(t,[]);let s,l;Wd.computeWindingOrder2D(a)===Qd.CLOCKWISE&&(a.reverse(),t=t.slice().reverse());let u=t.length,c=0;if(n)for(s=new Float64Array(2*u*3),l=0;l<u;l++){const e=t[l],i=t[(l+1)%u];s[c++]=e.x,s[c++]=e.y,s[c++]=e.z,s[c++]=i.x,s[c++]=i.y,s[c++]=i.z;}else {let n=0;if(r===sp.GEODESIC)for(l=0;l<u;l++)n+=lp.subdivideLineCount(t[l],t[(l+1)%u],i);else if(r===sp.RHUMB)for(l=0;l<u;l++)n+=lp.subdivideRhumbLineCount(e,t[l],t[(l+1)%u],i);for(s=new Float64Array(3*n),l=0;l<u;l++){let n;r===sp.GEODESIC?n=lp.subdivideLine(t[l],t[(l+1)%u],i,o):r===sp.RHUMB&&(n=lp.subdivideRhumbLine(e,t[l],t[(l+1)%u],i,o));const a=n.length;for(let e=0;e<a;++e)s[c++]=n[e];}}u=s.length/3;const h=new Uint16Array(2*u);for(c=0,l=0;l<u-1;l++)h[c++]=l,h[c++]=l+1;return h[c++]=u-1,h[c++]=0,{positions:s,indices:h}}static createGeometryFromPositionsExtruded(e,t,i,n,r,o,a,s){const l=[],u={walls:[]};let c;if(o||a){const n=this.createGeometryFromPositions(e,t,i,r,s),l=n.positions,h=n.indices;let d,p;if(o&&a){const e=l.concat(l);d=e.length/3,p=new Uint16Array(2*h.length),p.set(h);const t=h.length,i=d/2;for(c=0;c<t;c+=3){const e=p[c]+i,n=p[c+1]+i;p[c+t]=p[c+2]+i,p[c+1+t]=n,p[c+2+t]=e;}if(n.positions=e,r){const t=n.normals;n.normals=new Float32Array(e.length),n.normals.set(t);}n.indices=p;}else if(a){for(d=l.length/3,p=new Float32Array(h.length),c=0;c<h.length;c+=3)p[c]=h[c+2],p[c+1]=h[c+1],p[c+2]=h[c];n.indices=p;}u.topAndBottom=n;}let h=n.outerRing,d=Ic.fromPoints(h,e),p=d.projectPointsOntoPlane(h,l),f=Wd.computeWindingOrder2D(p);f===Qd.CLOCKWISE&&(h=h.slice().reverse());let m=this.computeWallGeometry(h,e,i,r,s);u.walls.push(m);const _=n.holes;for(c=0;c<_.length;c++){let t=_[c];d=Ic.fromPoints(t,e),p=d.projectPointsOntoPlane(t,l),f=Wd.computeWindingOrder2D(p),f===Qd.COUNTER_CLOCKWISE&&(t=t.slice().reverse()),m=this.computeWallGeometry(t,e,i,r,s),u.walls.push(m);}return u}static createOutlineGeometryFromPositionsExtruded(e,t,i,n,r){const o=[],a=Ic.fromPoints(t,e).projectPointsOntoPlane(t,[]);let s,l;Wd.computeWindingOrder2D(a)===Qd.CLOCKWISE&&(a.reverse(),t=t.slice().reverse());let u=t.length;const c=new Array(u);let h=0;if(n)for(s=new Float64Array(2*u*3*2),l=0;l<u;++l){c[l]=h/3;const e=t[l],i=t[(l+1)%u];s[h++]=e.x,s[h++]=e.y,s[h++]=e.z,s[h++]=i.x,s[h++]=i.y,s[h++]=i.z;}else {let n=0;if(r===sp.GEODESIC)for(l=0;l<u;l++)n+=lp.subdivideLineCount(t[l],t[(l+1)%u],i);else if(r===sp.RHUMB)for(l=0;l<u;l++)n+=lp.subdivideRhumbLineCount(e,t[l],t[(l+1)%u],i);for(s=new Float64Array(3*n*2),l=0;l<u;++l){let n;c[l]=h/3,r===sp.GEODESIC?n=lp.subdivideLine(t[l],t[(l+1)%u],i,o):r===sp.RHUMB&&(n=lp.subdivideRhumbLine(e,t[l],t[(l+1)%u],i,o));const a=n.length;for(let e=0;e<a;++e)s[h++]=n[e];}}u=s.length/6;const d=c.length,p=new Uint16Array(2*(2*u+d));for(h=0,l=0;l<u;++l)p[h++]=l,p[h++]=(l+1)%u,p[h++]=l+u,p[h++]=(l+1)%u+u;for(l=0;l<d;l++){const e=c[l];p[h++]=e,p[h++]=e+u;}return {positions:s,indices:p}}static computeWallGeometry(e,t,i,n,r){const o=[],a=new _t,s=new _t;let l,u,c,h,d,p=e.length,f=0;if(n)for(u=3*p*2,l=new Array(2*u),c=0;c<p;c++)h=e[c],d=e[(c+1)%p],l[f]=l[f+u]=h.x,++f,l[f]=l[f+u]=h.y,++f,l[f]=l[f+u]=h.z,++f,l[f]=l[f+u]=d.x,++f,l[f]=l[f+u]=d.y,++f,l[f]=l[f+u]=d.z,++f;else {const n=ot.CesiumMath.chordLength(i,t.maximumRadius);let a=0;if(r===sp.GEODESIC)for(c=0;c<p;c++)a+=this.subdivideLineCount(e[c],e[(c+1)%p],n);else if(r===sp.RHUMB)for(c=0;c<p;c++)a+=this.subdivideRhumbLineCount(t,e[c],e[(c+1)%p],n);for(u=3*(a+p),l=new Array(2*u),c=0;c<p;c++){let i;h=e[c],d=e[(c+1)%p],r===sp.GEODESIC?i=this.subdivideLine(h,d,n,o):r===sp.RHUMB&&(i=this.subdivideRhumbLine(t,h,d,n,o));const a=i.length;for(let e=0;e<a;++e,++f)l[f]=i[e],l[f+u]=i[e];l[f]=d.x,l[f+u]=d.x,++f,l[f]=d.y,l[f+u]=d.y,++f,l[f]=d.z,l[f+u]=d.z,++f;}}p=l.length;const m=new Uint16Array(p-6*e.length);let _=0;for(p/=6,c=0;c<p;c++){const e=c,t=e+1,i=e+p,n=i+1;h=_t.fromArray(l,3*e,a),d=_t.fromArray(l,3*t,s),_t.equalsEpsilon(h,d,ot.CesiumMath.EPSILON10,ot.CesiumMath.EPSILON10)||(m[_++]=e,m[_++]=i,m[_++]=t,m[_++]=t,m[_++]=i,m[_++]=n);}return {positions:l,indices:m}}static findAttributesInAllGeometries(e){const t=e.length,i={};let n;for(n in e[0]){const r=e[0][n];let o=r.length,a=!0;for(let i=1;i<t;++i){const t=e[i][n];if(!$(t)||r.componentDatatype!==t.componentDatatype||r.componentsPerAttribute!==t.componentsPerAttribute||r.normalize!==t.normalize){a=!1;break}o+=t.length;}a&&("positions"===n?i[n]=new Float64Array(o):"normals"!==n&&"uvs"!==n||(i[n]=new Float32Array(o)));}return i}static getPointAtDistance(e,t,i,n){const r=new _t;return _t.subtract(t,e,r),_t.multiplyByScalar(r,i/n,r),_t.add(e,r,r),[r.x,r.y,r.z]}static scaleToGeodeticHeightExtruded(e,t,i,n,r){const o=new _t,a=new _t,s=new _t,l=new _t;n=Z(n,hi.WGS84);const u=o;let c=a;const h=s;let d=l;if($(e)&&$(e.positions)){const o=e.positions,a=o.length/2;for(let e=0;e<a;e+=3)_t.fromArray(o,e,h),n.geodeticSurfaceNormal(h,u),d=n.scaleToGeodeticSurface(h,d),c=_t.multiplyByScalar(u,i,c),c=_t.add(d,c,c),o[e+a]=c.x,o[e+1+a]=c.y,o[e+2+a]=c.z,r&&(d=_t.clone(h,d)),c=_t.multiplyByScalar(u,t,c),c=_t.add(d,c,c),o[e]=c.x,o[e+1]=c.y,o[e+2]=c.z;}return e}static subdivideLine(e,t,i,n){const r=this.subdivideLineCount(e,t,i),o=_t.distance(e,t),a=o/r;$(n)||(n=[]);const s=n;s.length=3*r;let l=0;for(let i=0;i<r;i++){const n=this.getPointAtDistance(e,t,i*a,o);s[l++]=n[0],s[l++]=n[1],s[l++]=n[2];}return s}static subdivideLineCount(e,t,i){const n=_t.distance(e,t),r=Math.max(0,Math.ceil(ot.CesiumMath.log2(n/i)));return Math.pow(2,r)}static subdivideRhumbLine(e,t,i,n,r){const o=new Ps,a=new Ps,s=new Ps,l=new _t,u=new xu(e.cartesianToCartographic(t,o),e.cartesianToCartographic(i,a),e),c=Math.max(0,Math.ceil(ot.CesiumMath.log2(u.surfaceDistance/n))),h=Math.pow(2,c),d=u.surfaceDistance/h;$(r)||(r=[]);const p=r;p.length=3*h;let f=0;for(let t=0;t<h;t++){const i=u.interpolateUsingSurfaceDistance(t*d,s),n=e.cartographicToCartesian(i,l);p[f++]=n.x,p[f++]=n.y,p[f++]=n.z;}return p}static subdivideRhumbLineCount(e,t,i,n){const r=new Ps,o=new Ps,a=new xu(e.cartesianToCartographic(t,r),e.cartesianToCartographic(i,o),e),s=Math.max(0,Math.ceil(ot.CesiumMath.log2(a.surfaceDistance/n)));return Math.pow(2,s)}static polygonsFromHierarchy(e,t,i,n){const r=[],o=[],a=new Jd;for(a.enqueue(e);0!==a.length;){const e=a.dequeue();let s=e.positions;const l=e.holes;let u,c;if(i)for(c=s.length,u=0;u<c;u++)n.scaleToGeodeticSurface(s[u],s[u]);if(s=rp(s,_t.equalsEpsilon,!0),s.length<3)continue;let h=t(s);if(!$(h))continue;const d=[];let p=Wd.computeWindingOrder2D(h);p===Qd.CLOCKWISE&&(h.reverse(),s=s.slice().reverse());let f=s.slice();const m=$(l)?l.length:0,_=[];let g;for(u=0;u<m;u++){const e=l[u];let r=e.positions;if(i)for(c=r.length,g=0;g<c;++g)n.scaleToGeodeticSurface(r[g],r[g]);if(r=rp(r,_t.equalsEpsilon,!0),r.length<3)continue;const o=t(r);if(!$(o))continue;p=Wd.computeWindingOrder2D(o),p===Qd.CLOCKWISE&&(o.reverse(),r=r.slice().reverse()),_.push(r),d.push(f.length),f=f.concat(r),h=h.concat(o);let s=0;for($(e.holes)&&(s=e.holes.length),g=0;g<s;g++)a.enqueue(e.holes[g]);}r.push({outerRing:s,holes:_}),o.push({positions:f,positions2D:h,holes:d});}return {hierarchy:r,polygons:o}}static polygonOutlinesFromHierarchy(e,t,i){const n=[],r=new Jd;let o,a,s;for(r.enqueue(e);0!==r.length;){const e=r.dequeue();let l=e.positions;if(t)for(s=l.length,o=0;o<s;o++)i.scaleToGeodeticSurface(l[o],l[o]);if(l=rp(l,_t.equalsEpsilon,!0),l.length<3)continue;const u=e.holes?e.holes.length:0;for(o=0;o<u;o++){const l=e.holes[o];let u=l.positions;if(t)for(s=u.length,a=0;a<s;++a)i.scaleToGeodeticSurface(u[a],u[a]);if(u=rp(u,_t.equalsEpsilon,!0),u.length<3)continue;n.push(u);let c=0;for($(l.holes)&&(c=l.holes.length),a=0;a<c;a++)r.enqueue(l.holes[a]);}n.push(l);}return n}}function up(e){for(var t,i,n=_e(e),r=0,o=1;o<n.length;)t=i||n[0],r+=((i=n[o])[0]-t[0])*(i[1]+t[1]),o++;return r>0}const cp={TERRAIN:0,MINEMAP_3D_TILE:1,BOTH:2,SINGULARIZATION:3,NONE:4,ALL:5,IGNORECLASSIFICATION:6,VECTOR_WITH_HEIGHT:7,FORCE_VECTOR_OVER_MODEL:8};var hp=Object.freeze(cp);function dp(e){return !!$(e)&&(e===cp.ALL||e===cp.BOTH||e===cp.TERRAIN||e===cp.MINEMAP_3D_TILE||e===cp.SINGULARIZATION)}const pp=-1e3,fp=8848,mp=ot.CesiumMath;class _p extends wd{constructor(e){super(e),$(e.adaptTerrain)&&(this.adaptTerrain=e.adaptTerrain),this.setData(e);}updateProperty(e){this.setData(e);}setData(e){super.setData(),this._setProperty(e),e.adaptTerrain?this._parseExtrude():this._parse();}_setProperty(e){if($(e.perPositionHeight)&&e.perPositionHeight&&$(e.height))throw new Error("Cannot use both options.perPositionHeight and options.height");if($(e.arcType)&&e.arcType!==sp.GEODESIC&&e.arcType!==sp.RHUMB)throw new Error("Invalid arcType. Valid options are minemap.ARCTYPE.GEODESIC and minemap.ARCTYPE.RHUMB.");if(!$(e.polygonHierarchy)||!$(e.polygonHierarchy.positions))throw new Error("positions must be defined!");let t;if(e.polygonHierarchy.positions instanceof Function&&(t=e.polygonHierarchy.positions),this._positionsCallBack=t,this.minimumHeight=Z(e.minimumHeight,Z(this.minimumHeight,pp)),this.maximumHeight=Z(e.maximumHeight,Z(this.maximumHeight,fp)),this._polygonHierarchy=e.polygonHierarchy,this._granularity=Z(e.granularity,ot.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=Z(e.ellipsoid,hi.WGS84),this._perPositionHeight=Z(e.perPositionHeight,!1),this._perPositionHeightExtrude=this._perPositionHeight&&$(e.extrudedHeight),this._height=Z(e.height,0),this._extrudedHeight=Z(e.extrudedHeight,this._height),!this._perPositionHeightExtrude){const e=Math.max(this._height,this._extrudedHeight);this._extrudedHeight=Math.min(this._height,this._extrudedHeight),this._height=e;}this._closeTop=Z(e.closeTop,!0),this._closeBottom=Z(e.closeBottom,!0),this._arcType=Z(e.arcType,sp.GEODESIC),this.type="PolygonGeometry",this.vertices=void 0,this.normals=void 0,this.indices=void 0,this.uvs=void 0,this._referenceCenter=Z(e.referenceCenter,new _t),this._usedDoublePrecision=!$(e.referenceCenter),this._vertexArray=this._usedDoublePrecision?new ua:new ra,this._checkSelfIntersection=Z(e.checkSelfIntersection,!1),this._indexArray=new Ba,this._needUpdate=!0,this._initialized=!1,this.primitiveType=Du.TRIANGLES;}static isSelfIntersection(e,t=!1){const i=[];for(const n of e)i.push(t?Nu.cartesian3ToCartographic(n).slice(0,2):n);const n=parseFloat(i[0][0]).toFixed(5),r=parseFloat(i[0][1]).toFixed(5),o=parseFloat(i[i.length-1][0]).toFixed(5),a=parseFloat(i[i.length-1][1]).toFixed(5);return n===o&&r===a||i.push(i[0]),up(Ie(i))&&i.reverse(),function(e){var t,i,n={type:"FeatureCollection",features:[]};if("LineString"===(i="Feature"===e.type?e.geometry:e).type)t=[i.coordinates];else if("MultiLineString"===i.type)t=i.coordinates;else if("MultiPolygon"===i.type)t=[].concat.apply([],i.coordinates);else {if("Polygon"!==i.type)throw new Error("Input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry");t=i.coordinates;}return t.forEach((function(e){t.forEach((function(t){for(var i=0;i<e.length-1;i++)for(var r=i;r<t.length-1;r++){if(e===t){if(1===Math.abs(i-r))continue;if(0===i&&r===e.length-2&&e[i][0]===e[e.length-1][0]&&e[i][1]===e[e.length-1][1])continue}var o=(void 0,m=void 0,_=void 0,g=void 0,y=void 0,y={x:null,y:null,onLine1:!1,onLine2:!1},0==(f=((p=t[r+1][1])-(h=t[r][1]))*((l=e[i+1][0])-(a=e[i][0]))-((d=t[r+1][0])-(c=t[r][0]))*((u=e[i+1][1])-(s=e[i][1])))?null!==y.x&&null!==y.y&&y:(g=(d-c)*(m=s-h)-(p-h)*(_=a-c),_=((l-a)*m-(u-s)*_)/f,y.x=a+(m=g/f)*(l-a),y.y=s+m*(u-s),m>=0&&m<=1&&(y.onLine1=!0),_>=0&&_<=1&&(y.onLine2=!0),!(!y.onLine1||!y.onLine2)&&[y.x,y.y]));o&&n.features.push(ae([o[0],o[1]]));}var a,s,l,u,c,h,d,p,f,m,_,g,y;}));})),n}(Le([i])).features.length>0}_parse(){let e;if(e=this._positionsCallBack?this._positionsCallBack():this._polygonHierarchy.positions,e.length<3)return;if(this._checkSelfIntersection&&_p.isSelfIntersection(e,!0))return void console.error("不支持自相交多边形！");this._needUpdate=!0;const t=Ic.fromPoints(e,this._ellipsoid),i=lp.polygonsFromHierarchy($(this._positionsCallBack)?{positions:e}:this._polygonHierarchy,t.projectPointsOntoPlane.bind(t),!this._perPositionHeight,this._ellipsoid),n=i.hierarchy,r=i.polygons;if(0===n.length)return;e=n[0].outerRing;const o=lp.computeBoundingRectangle(t.plane.normal,t.projectPointOntoPlane.bind(t),e),a=[],s=this._height,l=this._extrudedHeight,u=this._perPositionHeightExtrude||!ot.CesiumMath.equalsEpsilon(s,l,0,ot.CesiumMath.EPSILON2),c={perPositionHeight:this._perPositionHeight,tangentPlane:t,boundingRectangle:o,ellipsoid:this._ellipsoid,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:this._arcType};let h;if(u)for(c.extrude=!0,c.top=this._closeTop,c.bottom=this._closeBottom,h=0;h<r.length;h++){const e=lp.createGeometryFromPositionsExtruded(this._ellipsoid,r[h],this._granularity,n[h],this._perPositionHeight,this._closeTop,this._closeBottom,this._arcType),t=e.topAndBottom;this._closeTop&&this._closeBottom?c.geometry=lp.scaleToGeodeticHeightExtruded(t,s,l,this._ellipsoid,this._perPositionHeight):this._closeTop?(t.positions=Wd.scaleToGeodeticHeight(t.positions,s,this._ellipsoid,!this._perPositionHeight),c.geometry=t):this._closeBottom&&(t.position=Wd.scaleToGeodeticHeight(t.positions,l,this._ellipsoid,!0),c.geometry=t),(this._closeTop||this._closeBottom)&&(c.wall=!1,t.geometry=lp.computeAttributes(c),a.push(t));const i=e.walls;c.wall=!0;for(let e=0;e<i.length;e++)c.geometry=lp.scaleToGeodeticHeightExtruded(i[e],s,l,this._ellipsoid,this._perPositionHeight),c.geometry=lp.computeAttributes(c),a.push(c.geometry);}else for(h=0;h<r.length;h++)c.geometry=lp.createGeometryFromPositions(this._ellipsoid,r[h],this._granularity,this._perPositionHeight,this._arcType),c.geometry=lp.computeAttributes(c),a.push(c.geometry);const d=lp.combineGeometries(a);this.normals=d.normals,this.indices=d.indices,this.uvs=d.uvs,this._indexArray.clear();for(let e=0;e<this.indices.length;e+=3)this._indexArray.emplaceBack(this.indices[e],this.indices[e+1],this.indices[e+2]);this.vertices=Wd.scaleToGeodeticHeight(d.positions,s,this._ellipsoid,!this._perPositionHeight);const p=new _t;for(let e=0;e<this.vertices.length;e+=3)_t.fromArray(this.vertices,e,p),_t.subtract(p,this._referenceCenter,p),this.vertices[e]=p.x,this.vertices[e+1]=p.y,this.vertices[e+2]=p.z;this.emplaceVertexBufferTriangle(),this._initialized=!0,this.computeBoundingSphere(),this.computeBoundingBox();}_parseExtrude(){let e;if(e=this._positionsCallBack?this._positionsCallBack():this._polygonHierarchy.positions,e.length<3)return;if(this._checkSelfIntersection&&_p.isSelfIntersection(e,!0))return void console.error("不支持自相交多边形！");this._needUpdate=!0;const t=Ic.fromPoints(e,this._ellipsoid),i=je(this._polygonHierarchy),n=je(e),r=lp.polygonsFromHierarchy($(this._positionsCallBack)?{positions:n}:i,t.projectPointsOntoPlane.bind(t),!0,this._ellipsoid),o=r.hierarchy,a=r.polygons;if(0===o.length)return;e=o[0].outerRing;const s=lp.computeBoundingRectangle(t.plane.normal,t.projectPointOntoPlane.bind(t),e),l=[],u=this.minimumHeight,c=this.maximumHeight-this.minimumHeight,h={perPositionHeight:!0,tangentPlane:t,boundingRectangle:s,ellipsoid:this._ellipsoid,bottom:!0,top:!0,wall:!1,extrude:!0,arcType:this._arcType};for(let e=0;e<a.length;e++){const t=lp.createGeometryFromPositionsExtruded(h.ellipsoid,a[e],this._granularity,o[e],h.perPositionHeight,h.top,h.bottom,h.arcType),i=t.topAndBottom;h.geometry=lp.scaleToGeodeticHeightExtruded(i,u,c,h.ellipsoid,h.perPositionHeight),h.wall=!1,i.geometry=lp.computeAttributes(h),l.push(i);const n=t.walls;h.wall=!0;for(let e=0;e<n.length;e++)h.geometry=lp.scaleToGeodeticHeightExtruded(n[e],u,c,h.ellipsoid,h.perPositionHeight),h.geometry=lp.computeAttributes(h),l.push(h.geometry);}const d=lp.combineGeometries(l);this.normals=d.normals,this.indices=d.indices,this.uvs=d.uvs,this._indexArray.clear();for(let e=0;e<this.indices.length;e+=3)this._indexArray.emplaceBack(this.indices[e],this.indices[e+1],this.indices[e+2]);this.vertices=Wd.scaleToGeodeticHeight(d.positions,u,h.ellipsoid,!h.perPositionHeight);const p=new _t;for(let e=0;e<this.vertices.length;e+=3)_t.fromArray(this.vertices,e,p),this.vertices[e]=p.x,this.vertices[e+1]=p.y,this.vertices[e+2]=p.z;this.emplaceVertexBufferTriangle(),this._initialized=!0,this.computeBoundingSphere(),this.computeBoundingBox();}update(e){if($(this._positionsCallBack)&&(e.adaptTerrain?this._parseExtrude():this._parse()),this._initialized&&this._needUpdate&&e.painter){const t=e.painter.context;this._segmentVector&&this._segmentVector.destroy(),this._vertexBuffer&&this._indexBuffer?(this._vertexBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indexArray)):(this._vertexBuffer=t.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?tp.members:ip.members,this.dynamicDraw),this._indexBuffer=t.createIndexBuffer(this._indexArray,this.dynamicDraw)),this._segmentVector=ep.simpleSegment(0,0,this.vertices.length/3,this.indices.length/3),this._needUpdate=!1;}}serialize(){const e={type:this.type,polygonHierarchy:Wd.hierarchyPack(this._polygonHierarchy,{}),perPositionHeight:this._perPositionHeight,arcType:this._arcType};return (this._perPositionHeightExtrude||!ot.CesiumMath.equalsEpsilon(this._height,this._extrudedHeight,0,ot.CesiumMath.EPSILON2))&&(e.extrudedHeight=this._extrudedHeight),this._perPositionHeight||(e.height=this._height),e}setAdaptTerrain(e){this._vertexArray=this._usedDoublePrecision?new ua:new ra,this._indexArray=new Ba,e?this._parseExtrude():this._parse();}computeRectangle(e,t,i,n,r){if(r=Z(r,new Ss),!$(e)||e.length<3)return r.west=0,r.north=0,r.south=0,r.east=0,r;if(i===sp.RHUMB)return Ss.fromVector3Array(e,t,r);let o=new cl;o.ellipsoid.equals(t)||(o=new cl(void 0,void 0,t));const a={westOverIDL:0,eastOverIDL:0},s=new Ps,l=new Ps;r.west=Number.POSITIVE_INFINITY,r.east=Number.NEGATIVE_INFINITY,r.south=Number.POSITIVE_INFINITY,r.north=Number.NEGATIVE_INFINITY,a.westOverIDL=Number.POSITIVE_INFINITY,a.eastOverIDL=Number.NEGATIVE_INFINITY;const u=1/mp.chordLength(n,t.maximumRadius),c=e.length;let h=t.cartesianToCartographic(e[0],l);Qt(h,h);let d,p=s;for(let i=1;i<c;i++)d=p,p=h,h=t.cartesianToCartographic(e[i],d),Qt(h,h),o.setEndPoints(p,h),this.interpolateAndGrowRectangle(o,u,r,a);return d=p,p=h,h=t.cartesianToCartographic(e[0],d),Qt(h,h),o.setEndPoints(p,h),this.interpolateAndGrowRectangle(o,u,r,a),r.east-r.west>a.eastOverIDL-a.westOverIDL&&(r.west=a.westOverIDL,r.east=a.eastOverIDL,r.east>mp.PI&&(r.east=r.east-mp.TWO_PI),r.west>mp.PI&&(r.west=r.west-mp.TWO_PI)),r}interpolateAndGrowRectangle(e,t,i,n){const r=new Ps,o=e.surfaceDistance,a=Math.ceil(o*t),s=a>0?o/(a-1):Number.POSITIVE_INFINITY;let l=0;for(let t=0;t<a;t++){const t=e.interpolateUsingSurfaceDistance(l,r);l+=s;const o=t.longitude,a=t.latitude;i.west=Math.min(i.west,o),i.east=Math.max(i.east,o),i.south=Math.min(i.south,a),i.north=Math.max(i.north,a);const u=o>=0?o:o+mp.TWO_PI;n.westOverIDL=Math.min(n.westOverIDL,u),n.eastOverIDL=Math.max(n.eastOverIDL,u);}}textureCoordinateRotationPoints(){return [0,0,0,1,1,0]}getSphericalExtentGeometryInstanceAttributes(e,t,i){const n=this.latLongToSpherical(e.south,e.west,i);let r=n.x,o=n.y;const a=this.latLongToSpherical(e.north,e.east,i);let s=a.x,l=a.y,u=0;o>l&&(u=mp.PI-o,o=-mp.PI,l+=u),r-=mp.EPSILON5,o-=mp.EPSILON5,s+=mp.EPSILON5,l+=mp.EPSILON5,this.sphericalExtents=new St(r,o,1/(s-r),1/(l-o)),this.attributes.push({name:"sphericalExtents",type:Du.FLOAT,components:4,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1,batchTableAttributeIndex:this.attributes.length}),this.attributes.push({name:"longitudeRotation",type:Du.FLOAT,components:1,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1,batchTableAttributeIndex:this.attributes.length}),this.longitudeRotation=0;const c=new Fu(i);this.addTextureCoordinateRotationAttributes(t),this.add2DTextureCoordinateAttributes(e,c);}latLongToSpherical(e,t){const i=new Ps;i.latitude=e,i.longitude=t,i.height=0;const n=Ps.toVector3(i),r=Math.sqrt(n.x*n.x+n.y*n.y),o=mp.fastApproximateAtan2(r,n.z),a=mp.fastApproximateAtan2(n.x,n.y),s=new Ot;return s.x=o,s.y=a,s}addTextureCoordinateRotationAttributes(e){const t=[new Ot,new Ot,new Ot,new Ot],i=Ot.unpack(e,0,t[0]),n=Ot.unpack(e,2,t[1]),r=Ot.unpack(e,4,t[2]);this.attributes.push({name:"uMaxVmax",type:Du.FLOAT,components:4,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1,batchTableAttributeIndex:this.attributes.length}),this.uMaxVmax=new St(n.x,n.y,r.x,r.y);const o=1/this.pointLineDistance(i,n,r),a=1/this.pointLineDistance(i,r,n);this.attributes.push({name:"uvMinAndExtents",type:Du.FLOAT,components:4,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1,batchTableAttributeIndex:this.attributes.length}),this.uvMinAndExtents=new St(i.x,i.y,o,a);}add2DTextureCoordinateAttributes(e,t){const i=new Ps,n={high:0,low:0};i.height=0,i.longitude=e.west,i.latitude=e.south;const r=t.project(i);i.latitude=e.north;const o=t.project(i);i.longitude=e.east,i.latitude=e.south;const a=t.project(i),s=[0,0,0,0],l=[0,0,0,0];let u=gd.encode(r.x,n);s[0]=u.high,l[0]=u.low,u=gd.encode(r.y,n),s[1]=u.high,l[1]=u.low,u=gd.encode(o.y,n),s[2]=u.high,l[2]=u.low,u=gd.encode(a.x,n),s[3]=u.high,l[3]=u.low,this.attributes.push({name:"planes2DHIGH",type:Du.FLOAT,components:4,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1,batchTableAttributeIndex:this.attributes.length}),this.planes2DHIGH=new St(s[0],s[1],s[2],s[3]),this.attributes.push({name:"planes2DLOW",type:Du.FLOAT,components:4,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1,batchTableAttributeIndex:this.attributes.length}),this.planes2DLOW=new St(l[0],l[1],l[2],l[3]);}pointLineDistance(e,t,i){return Math.abs((t.y-e.y)*i.x-(t.x-e.x)*i.y+t.x*e.y-t.y*e.x)/Ot.distance(t,e)}getDataComputeUV(){this._rectangle=this.computeRectangle(this._polygonHierarchy.positions,this._ellipsoid,this._arcType,this._granularity),this.attributes=[];const e=this.textureCoordinateRotationPoints();this.getSphericalExtentGeometryInstanceAttributes(this._rectangle,e,this._ellipsoid);}destroy(){super.destroy(),this._polygonHierarchy=void 0,this._granularity=void 0,this._ellipsoid=void 0,this._perPositionHeight=void 0,this._perPositionHeightExtrude=void 0,this._height=void 0,this._extrudedHeight=void 0,this._closeTop=void 0,this._closeBottom=void 0,this._arcType=void 0,this.type=void 0,this._vertexArray=void 0,this._indexArray=void 0,this._initialized=void 0,this._needUpdate=void 0,this.primitiveType=void 0,this.vertices=void 0,this.normals=void 0,this.indices=void 0,this.uvs=void 0,this.boundingBox=void 0,this.boundingSphere=void 0,this._vertexBuffer=void 0,this._indexBuffer=void 0,this._segmentVector=void 0;}}const gp=function(e,t){return 256*(e=ze(Math.floor(e),0,255))+ze(Math.floor(t),0,255)};class yp{constructor(){this.first=!0;}update(e,t){const i=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=i,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=i,!0):(this.lastFloorZoom>i?(this.lastIntegerZoom=i+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<i&&(this.lastIntegerZoom=i,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=i,!0))}}const xp="deferred",vp="loading",wp="loaded";let Tp=null,bp="unavailable",Pp=null;const Sp=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(bp="error"),Tp&&Tp(e);};function Ep(){Ap.fire(new fl("pluginStateChange",{pluginStatus:bp,pluginURL:Pp}));}const Ap=new _l,Cp=function(){return bp},Mp=function(){if(bp!==xp||!Pp)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");bp=vp,Ep(),Pp&&yh({url:Pp},(e=>{e?Sp(e):(bp=wp,Ep());}));},Ip={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>bp===wp||null!=Ip.applyArabicShaping,isLoading:()=>bp===vp,setState(e){bp=e.pluginStatus,Pp=e.pluginURL;},isParsed:()=>null!=Ip.applyArabicShaping&&null!=Ip.processBidirectionalText&&null!=Ip.processStyledBidirectionalText,getPluginURL:()=>Pp};class Lp{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new yp,this.transition={});}isSupportedScript(e){return function(e,t){for(const i of e)if(!yn(i.charCodeAt(0),t))return !1;return !0}(e,Ip.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,t=e-Math.floor(e),i=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*i}:{fromScale:.5,toScale:1,t:1-(1-i)*t}}}class Np{constructor(e,t){this.property=e,this.value=t,this.expression=Yo(void 0===t?e.specification.default:t,e.specification);}isDataDriven(){return "source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,i){return this.property.possiblyEvaluate(this,e,t,i)}}class Rp{constructor(e){this.property=e,this.value=new Np(e,void 0);}transitioned(e,t){return new Dp(this.property,this.value,t,Ve({},e.transition,this.transition),e.now)}untransitioned(){return new Dp(this.property,this.value,null,{},0)}}class Op{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues);}getValue(e){return je(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Rp(this._values[e].property)),this._values[e].value=new Np(this._values[e].property,null===t?void 0:je(t));}getTransition(e){return je(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Rp(this._values[e].property)),this._values[e].transition=je(t)||void 0;}serialize(){const e={};for(const t of Object.keys(this._values)){const i=this.getValue(t);void 0!==i&&(e[t]=i);const n=this.getTransition(t);void 0!==n&&(e[`${t}-transition`]=n);}return e}transitioned(e,t){const i=new Fp(this._properties);for(const n of Object.keys(this._values))i._values[n]=this._values[n].transitioned(e,t._values[n]);return i}untransitioned(){const e=new Fp(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class Dp{constructor(e,t,i,n,r){this.property=e,this.value=t,this.begin=r+n.delay||0,this.end=this.begin+n.duration||0,e.specification.transition&&(n.delay||n.duration)&&(this.prior=i);}possiblyEvaluate(e,t,i){const n=e.now||0,r=this.value.possiblyEvaluate(e,t,i),o=this.prior;if(o){if(n>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(n<this.begin)return o.possiblyEvaluate(e,t,i);{const a=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(e,t,i),r,Oe(a))}}return r}}class Fp{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues);}possiblyEvaluate(e,t,i){const n=new Vp(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].possiblyEvaluate(e,t,i);return n}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return !0;return !1}}class zp{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues);}getValue(e){return je(this._values[e].value)}setValue(e,t){this._values[e]=new Np(this._values[e].property,null===t?void 0:je(t));}serialize(){const e={};for(const t of Object.keys(this._values)){const i=this.getValue(t);void 0!==i&&(e[t]=i);}return e}possiblyEvaluate(e,t,i){const n=new Vp(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].possiblyEvaluate(e,t,i);return n}}class Bp{constructor(e,t,i){this.property=e,this.value=t,this.parameters=i;}isConstant(){return "constant"===this.value.kind}constantOr(e){return "constant"===this.value.kind?this.value.value:e}evaluate(e,t,i,n){return this.property.evaluate(this.value,this.parameters,e,t,i,n)}}class Vp{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues);}get(e){return this._values[e]}}class kp{constructor(e){this.specification=e;}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,i){const n=vr[this.specification.type];return n?n(e,t,i):e}}class Up{constructor(e,t){this.specification=e,this.overrides=t;}possiblyEvaluate(e,t,i,n){return new Bp(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},i,n)}:e.expression,t)}interpolate(e,t,i){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new Bp(this,{kind:"constant",value:void 0},e.parameters);const n=vr[this.specification.type];return n?new Bp(this,{kind:"constant",value:n(e.value.value,t.value.value,i)},e.parameters):e}evaluate(e,t,i,n,r,o){return "constant"===e.kind?e.value:e.evaluate(t,i,n,r,o)}}class Gp extends Up{possiblyEvaluate(e,t,i,n){if(void 0===e.value)return new Bp(this,{kind:"constant",value:void 0},t);if("constant"===e.expression.kind){const r=e.expression.evaluate(t,null,{},i,n),o="resolvedImage"===e.property.specification.type&&"string"!=typeof r?r.name:r,a=this._calculate(o,o,o,t);return new Bp(this,{kind:"constant",value:a},t)}if("camera"===e.expression.kind){const i=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new Bp(this,{kind:"constant",value:i},t)}return new Bp(this,e.expression,t)}evaluate(e,t,i,n,r,o){if("source"===e.kind){const a=e.evaluate(t,i,n,r,o);return this._calculate(a,a,a,t)}return "composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},i,n),e.evaluate({zoom:Math.floor(t.zoom)},i,n),e.evaluate({zoom:Math.floor(t.zoom)+1},i,n),t):e.value}_calculate(e,t,i,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:i,to:t}}interpolate(e){return e}}class Hp{constructor(e){this.specification=e;}possiblyEvaluate(e,t,i,n){if(void 0!==e.value){if("constant"===e.expression.kind){const r=e.expression.evaluate(t,null,{},i,n);return this._calculate(r,r,r,t)}return this._calculate(e.expression.evaluate(new Lp(Math.floor(t.zoom-1),t)),e.expression.evaluate(new Lp(Math.floor(t.zoom),t)),e.expression.evaluate(new Lp(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,i,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:i,to:t}}interpolate(e){return e}}class Yp{constructor(e){this.specification=e;}possiblyEvaluate(e,t,i,n){return !!e.expression.evaluate(t,null,{},i,n)}interpolate(){return !1}}class qp{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const t in e){const i=e[t];i.specification.overridable&&this.overridableProperties.push(t);const n=this.defaultPropertyValues[t]=new Np(i,void 0),r=this.defaultTransitionablePropertyValues[t]=new Rp(i);this.defaultTransitioningPropertyValues[t]=r.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=n.possiblyEvaluate({});}}}$o("DataDrivenProperty",Up),$o("DataConstantProperty",kp),$o("CrossFadedDataDrivenProperty",Gp),$o("CrossFadedProperty",Hp),$o("ColorRampProperty",Yp);const Xp=bi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Wp=bi([{name:"a_top_pattern_from",components:4,type:"Uint16"},{name:"a_top_pattern_to",components:4,type:"Uint16"},{name:"a_top_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_top_pixel_ratio_to",components:1,type:"Uint16"}]);class jp{constructor(e,t){this.gl=e.gl,this.location=t;}}class $p extends jp{constructor(e,t){super(e,t),this.current=0;}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e));}}class Zp extends jp{constructor(e,t){super(e,t),this.current=[0,0];}set(e){e[0]===this.current[0]&&e[1]===this.current[1]||(this.current=e,this.gl.uniform2f(this.location,e[0],e[1]));}}class Kp extends jp{constructor(e,t){super(e,t),this.current=[0,0,0];}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]||(this.current=e,this.gl.uniform3f(this.location,e[0],e[1],e[2]));}}class Qp extends jp{constructor(e,t){super(e,t),this.current=[0,0,0,0];}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]));}}class Jp extends jp{constructor(e,t){super(e,t),this.current=Ui.transparent;}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a));}}var ef=fd((function(e){e.exports=function(e,t){var i,n,r,o,a,s,l,u;for(n=e.length-(i=3&e.length),r=t,a=3432918353,s=461845907,u=0;u<n;)l=255&e.charCodeAt(u)|(255&e.charCodeAt(++u))<<8|(255&e.charCodeAt(++u))<<16|(255&e.charCodeAt(++u))<<24,++u,r=27492+(65535&(o=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&e.charCodeAt(u+2))<<16;case 2:l^=(255&e.charCodeAt(u+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(u)))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295;}return r^=e.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0};})),tf=fd((function(e){e.exports=function(e,t){for(var i,n=e.length,r=t^n,o=0;n>=4;)i=1540483477*(65535&(i=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(i>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),n-=4,++o;switch(n){case 3:r^=(255&e.charCodeAt(o+2))<<16;case 2:r^=(255&e.charCodeAt(o+1))<<8;case 1:r=1540483477*(65535&(r^=255&e.charCodeAt(o)))+((1540483477*(r>>>16)&65535)<<16);}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0};})),nf=ef,rf=tf;nf.murmur3=ef,nf.murmur2=rf;class of{constructor(){this.ids=[],this.positions=[],this.indexed=!1;}add(e,t,i,n){this.ids.push(sf(e)),this.positions.push(t,i,n);}getPositions(e){const t=sf(e);let i=0,n=this.ids.length-1;for(;i<n;){const e=i+n>>1;this.ids[e]>=t?n=e:i=e+1;}const r=[];for(;this.ids[i]===t;)r.push({index:this.positions[3*i],start:this.positions[3*i+1],end:this.positions[3*i+2]}),i++;return r}static serialize(e,t){const i=new Float64Array(e.ids),n=new Uint32Array(e.positions);return lf(i,n,0,i.length-1),t&&t.push(i.buffer,n.buffer),{ids:i,positions:n}}static deserialize(e){const t=new of;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}const af=Math.pow(2,53)-1;function sf(e){const t=+e;return !isNaN(t)&&t<=af?t:nf(String(e))}function lf(e,t,i,n){for(;i<n;){const r=e[i+n>>1];let o=i-1,a=n+1;for(;;){do{o++;}while(e[o]<r);do{a--;}while(e[a]>r);if(o>=a)break;uf(e,o,a),uf(t,3*o,3*a),uf(t,3*o+1,3*a+1),uf(t,3*o+2,3*a+2);}a-i<n-a?(lf(e,t,i,a),i=a+1):(lf(e,t,a+1,n),n=a);}}function uf(e,t,i){const n=e[t];e[t]=e[i],e[i]=n;}function cf(e){return [gp(255*e.r,255*e.g),gp(255*e.b,255*e.a)]}$o("FeaturePositionMap",of);class hf{constructor(e,t,i){this.value=e,this.uniformNames=t.map((e=>`u_${e}`)),this.type=i;}setUniform(e,t,i,n){let r=i.constantOr(this.value);"u_translate_anchor"===n&&(r="map"===r?0:1),e.set(r);}getBinding(e,t,i){switch(this.type){case"color":return new Jp(e,t);case"array":switch(this.value.length){case 1:return new $p(e,t);case 2:return new Zp(e,t);case 3:return new Kp(e,t);default:return new Qp(e,t)}default:return new $p(e,t)}}}class df{constructor(e,t){this.uniformNames=t.map((e=>`u_${e}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1,this.topPatternFrom=null,this.topPatternTo=null,this.topPixelRatioFrom=1,this.topPixelRatioTo=1;}setConstantPatternPositions(e,t,i){i?(this.topPixelRatioFrom=t.pixelRatio,this.topPixelRatioTo=e.pixelRatio,this.topPatternFrom=t.tlbr,this.topPatternTo=e.tlbr):(this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr);}setUniform(e,t,i,n){const r="u_pattern_to"===n?this.patternTo:"u_pattern_from"===n?this.patternFrom:"u_pixel_ratio_to"===n?this.pixelRatioTo:"u_pixel_ratio_from"===n?this.pixelRatioFrom:"u_top_pattern_to"===n?this.topPatternTo:"u_top_pattern_from"===n?this.topPatternFrom:"u_top_pixel_ratio_to"===n?this.topPixelRatioTo:"u_top_pixel_ratio_from"===n?this.topPixelRatioFrom:null;r&&e.set(r);}getBinding(e,t,i){return "u_pattern"===i.substr(0,9)||"u_top_pattern"===i.substr(0,13)?new Qp(e,t):new $p(e,t)}}class pf{constructor(e,t,i,n){this.expression=e,this.type=i,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===i?2:1,offset:0}))),this.paintVertexArray=new n;}populatePaintArray(e,t,i,n,r){const o=this.paintVertexArray.length,a=this.expression.evaluate(new Lp(0),t,{},n,[],r);this.paintVertexArray.resize(e),this._setPaintValue(o,e,a);}updatePaintArray(e,t,i,n){const r=this.expression.evaluate({zoom:0},i,n);this._setPaintValue(e,t,r);}_setPaintValue(e,t,i){if("color"===this.type){const n=cf(i);for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n[0],n[1]);}else {for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i);this.maxValue=Math.max(this.maxValue,Math.abs(i));}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffers?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent));}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy();}}class ff{constructor(e,t,i,n,r,o){this.expression=e,this.uniformNames=t.map((e=>`u_${e}_t`)),this.type=i,this.useIntegerZoom=n,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===i?4:2,offset:0}))),this.paintVertexArray=new o;}populatePaintArray(e,t,i,n,r){const o=this.expression.evaluate(new Lp(this.zoom),t,{},n,[],r),a=this.expression.evaluate(new Lp(this.zoom+1),t,{},n,[],r),s=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(s,e,o,a);}updatePaintArray(e,t,i,n){const r=this.expression.evaluate({zoom:this.zoom},i,n),o=this.expression.evaluate({zoom:this.zoom+1},i,n);this._setPaintValue(e,t,r,o);}_setPaintValue(e,t,i,n){if("color"===this.type){const r=cf(i),o=cf(n);for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,r[0],r[1],o[0],o[1]);}else {for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,i,n);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(n));}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffers?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent));}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy();}setUniform(e,t){const i=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,n=ze(this.expression.interpolationFactor(i,this.zoom,this.zoom+1),0,1);e.set(n);}getBinding(e,t,i){return new $p(e,t)}}class mf{constructor(e,t,i,n,r,o){this.expression=e,this.type=t,this.useIntegerZoom=i,this.zoom=n,this.layerId=o,this.zoomInPaintVertexArray=new r,this.zoomOutPaintVertexArray=new r,this.zoomInPaintVertexArrayTopPattern=new r,this.zoomOutPaintVertexArrayTopPattern=new r;}populatePaintArray(e,t,i){const n=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this.zoomInPaintVertexArrayTopPattern.resize(e),this.zoomOutPaintVertexArrayTopPattern.resize(e),this._setPaintValues(n,e,t.patterns&&t.patterns[this.layerId],i);const r=`${this.layerId}topPattern`;t.patterns&&t.patterns[r]&&this._setTopPatternPaintValues(n,e,t.patterns&&t.patterns[r],i);}updatePaintArray(e,t,i,n,r){this._setPaintValues(e,t,i.patterns&&i.patterns[this.layerId],r);const o=`${this.layerId}topPattern`;i.patterns&&i.patterns[o]&&this._setTopPatternPaintValues(e,t,i.patterns&&i.patterns[o],r);}_setPaintValues(e,t,i,n){if(!n||!i)return;const{min:r,mid:o,max:a}=i,s=n[r],l=n[o],u=n[a];if(s&&l&&u)for(let i=e;i<t;i++)this.zoomInPaintVertexArray.emplace(i,l.tl[0],l.tl[1],l.br[0],l.br[1],s.tl[0],s.tl[1],s.br[0],s.br[1],l.pixelRatio,s.pixelRatio),this.zoomOutPaintVertexArray.emplace(i,l.tl[0],l.tl[1],l.br[0],l.br[1],u.tl[0],u.tl[1],u.br[0],u.br[1],l.pixelRatio,u.pixelRatio);}_setTopPatternPaintValues(e,t,i,n){if(!n||!i)return;const{min:r,mid:o,max:a}=i,s=n[r],l=n[o],u=n[a];if(s&&l&&u)for(let i=e;i<t;i++)this.zoomInPaintVertexArrayTopPattern.emplace(i,l.tl[0],l.tl[1],l.br[0],l.br[1],s.tl[0],s.tl[1],s.br[0],s.br[1],l.pixelRatio,s.pixelRatio),this.zoomOutPaintVertexArrayTopPattern.emplace(i,l.tl[0],l.tl[1],l.br[0],l.br[1],u.tl[0],u.tl[1],u.br[0],u.br[1],l.pixelRatio,u.pixelRatio);}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Xp.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Xp.members,this.expression.isStateDependent)),this.zoomInPaintVertexArrayTopPattern&&this.zoomInPaintVertexArrayTopPattern.arrayBuffer&&this.zoomOutPaintVertexArrayTopPattern&&this.zoomOutPaintVertexArrayTopPattern.arrayBuffer&&(this.zoomInPaintVertexBufferTopPattern=e.createVertexBuffer(this.zoomInPaintVertexArrayTopPattern,Wp.members,this.expression.isStateDependent),this.zoomOutPaintVertexBufferTopPattern=e.createVertexBuffer(this.zoomOutPaintVertexArrayTopPattern,Wp.members,this.expression.isStateDependent));}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy(),this.zoomOutPaintVertexBufferTopPattern&&this.zoomOutPaintVertexBufferTopPattern.destroy(),this.zoomInPaintVertexBufferTopPattern&&this.zoomInPaintVertexBufferTopPattern.destroy();}}class _f{constructor(e,t,i){this.binders={},this._buffers=[];const n=[];if(e)for(const r in e.paint._values){if(!i(r))continue;const o=e.paint.get(r);if(!(o instanceof Bp&&lo(o.property.specification)))continue;const a=yf(r,e.type),s=o.value,l=o.property.specification.type,u=o.property.useIntegerZoom,c=o.property.specification["property-type"],h="cross-faded"===c||"cross-faded-data-driven"===c;if("constant"===s.kind)this.binders[r]=h?new df(s.value,a):new hf(s.value,a,l),n.push(`/u_${r}`);else if("source"===s.kind||h){const i=xf(r,l,"source");this.binders[r]=h?new mf(s,l,u,t,i,e.id):new pf(s,a,l,i),n.push(`/a_${r}`);}else {const e=xf(r,l,"composite");this.binders[r]=new ff(s,a,l,u,t,e),n.push(`/z_${r}`);}}this.cacheKey=n.sort().join("");}getMaxValue(e){const t=this.binders[e];return t instanceof pf||t instanceof ff?t.maxValue:0}populatePaintArrays(e,t,i,n,r){for(const o in this.binders){const a=this.binders[o];(a instanceof pf||a instanceof ff||a instanceof mf)&&a.populatePaintArray(e,t,i,n,r);}}setConstantPatternPositions(e,t,i){for(const n in this.binders){const r=this.binders[n];r instanceof df&&r.setConstantPatternPositions(e,t,i);}}updatePaintArrays(e,t,i,n,r){let o=!1;for(const a in e){const s=t.getPositions(a);for(const t of s){const s=i.feature(t.index);for(const i in this.binders){const l=this.binders[i];if((l instanceof pf||l instanceof ff||l instanceof mf)&&!0===l.expression.isStateDependent){const u=n.paint.get(i);l.expression=u.value,l.updatePaintArray(t.start,t.end,s,e[a],r),o=!0;}}}}return o}defines(){const e=[];for(const t in this.binders){const i=this.binders[t];(i instanceof hf||i instanceof df)&&e.push(...i.uniformNames.map((e=>`#define HAS_UNIFORM_${e}`)));}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const i=this.binders[t];if(i instanceof pf||i instanceof ff)for(let t=0;t<i.paintVertexAttributes.length;t++)e.push(i.paintVertexAttributes[t].name);else if(i instanceof mf){for(let t=0;t<Xp.members.length;t++)e.push(Xp.members[t].name);for(let t=0;t<Wp.members.length;t++)e.push(Wp.members[t].name);}}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const i=this.binders[t];if(i instanceof hf||i instanceof df||i instanceof ff)for(const t of i.uniformNames)e.push(t);}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,t){const i=[];for(const n in this.binders){const r=this.binders[n];if(r instanceof hf||r instanceof df||r instanceof ff)for(const o of r.uniformNames)if(t[o]){const a=r.getBinding(e,t[o],o);i.push({name:o,property:n,binding:a});}}return i}setUniforms(e,t,i,n){for(const{name:e,property:r,binding:o}of t)this.binders[r].setUniform(o,n,i.get(r),e);}updatePaintBuffers(e,t){this._buffers=[];for(const i in this.binders){const n=this.binders[i];if(e&&n instanceof mf)if(t&&i.indexOf("top-pattern")>-1){const t=2===e.fromScale?n.zoomInPaintVertexBufferTopPattern:n.zoomOutPaintVertexBufferTopPattern;t&&this._buffers.push(t);}else {const t=2===e.fromScale?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;t&&this._buffers.push(t);}else (n instanceof pf||n instanceof ff)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer);}}upload(e){for(const t in this.binders){const i=this.binders[t];(i instanceof pf||i instanceof ff||i instanceof mf)&&i.upload(e);}this.updatePaintBuffers();}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof pf||t instanceof ff||t instanceof mf)&&t.destroy();}}}class gf{constructor(e,t,i,n=(()=>!0)){this.programConfigurations={};for(const r of t)this.programConfigurations[r.id]=new _f(r,i,n),this.programConfigurations[r.id].layoutAttributes=e;this.needsUpload=!1,this._featureMap=new of,this._bufferOffset=0;}populatePaintArrays(e,t,i,n,r,o){for(const i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(e,t,n,r,o);void 0!==t.id&&this._featureMap.add(t.id,i,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0;}updatePaintArrays(e,t,i,n){for(const r of i)this.needsUpload=this.programConfigurations[r.id].updatePaintArrays(e,this._featureMap,t,r,n)||this.needsUpload;}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1;}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy();}}function yf(e,t){return {"line-border-opacity":["borderopacity"],"line-border-width":["borderwidth"],"line-border-color":["bordercolor"],"line-offset":["offset"],"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"text-translate":["translate"],"icon-translate":["translate"],"line-translate":["translate"],"fill-translate":["translate"],"extrusion-translate":["translate"],"sprite-translate":["translate"],"icon-translate-anchor":["translate_anchor"],"text-translate-anchor":["translate_anchor"],"line-translate-anchor":["translate_anchor"],"fill-translate-anchor":["translate_anchor"],"extrusion-translate-anchor":["translate_anchor"],"sprite-translate-anchor":["translate_anchor"],"sprite-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"extrusion-top-pattern":["top_pattern_to","top_pattern_from","top_pixel_ratio_to","top_pixel_ratio_from"]}[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}function xf(e,t,i){const n={color:{source:Ea,composite:Ua},number:{source:Na,composite:Ea},boolean:{source:Na,composite:Ea}},r=function(e){return {"line-pattern":{source:xa,composite:xa},"sprite-pattern":{source:xa,composite:xa},"fill-pattern":{source:xa,composite:xa},"extrusion-pattern":{source:xa,composite:xa},"extrusion-top-pattern":{source:xa,composite:xa}}[e]}(e);return r&&r[i]||n[t][i]}$o("ConstantBinder",hf),$o("CrossFadedConstantBinder",df),$o("SourceExpressionBinder",pf),$o("CrossFadedCompositeBinder",mf),$o("CompositeExpressionBinder",ff),$o("ProgramConfiguration",_f,{omit:["_buffers"]}),$o("ProgramConfigurationSet",gf);var vf="object"==typeof global&&global&&global.Object===Object&&global,wf="object"==typeof self&&self&&self.Object===Object&&self,Tf=vf||wf||Function("return this")(),bf=Tf.Symbol,Pf=Object.prototype,Sf=Pf.hasOwnProperty,Ef=Pf.toString,Af=bf?bf.toStringTag:void 0,Cf=Object.prototype.toString,Mf="[object Null]",If="[object Undefined]",Lf=bf?bf.toStringTag:void 0;function Nf(e){return null==e?void 0===e?If:Mf:Lf&&Lf in Object(e)?function(e){var t=Sf.call(e,Af),i=e[Af];try{e[Af]=void 0;var n=!0;}catch(e){}var r=Ef.call(e);return n&&(t?e[Af]=i:delete e[Af]),r}(e):function(e){return Cf.call(e)}(e)}function Rf(e){return null!=e&&"object"==typeof e}var Of=Array.isArray;function Df(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Ff(e){return e}var zf="[object AsyncFunction]",Bf="[object Function]",Vf="[object GeneratorFunction]",kf="[object Proxy]";function Uf(e){if(!Df(e))return !1;var t=Nf(e);return t==Bf||t==Vf||t==zf||t==kf}var Gf,Hf=Tf["__core-js_shared__"],Yf=(Gf=/[^.]+$/.exec(Hf&&Hf.keys&&Hf.keys.IE_PROTO||""))?"Symbol(src)_1."+Gf:"",qf=Function.prototype.toString,Xf=/^\[object .+?Constructor\]$/,Wf=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function jf(e,t){var i=function(e,t){return null==e?void 0:e[t]}(e,t);return function(e){return !(!Df(e)||(t=e,Yf&&Yf in t))&&(Uf(e)?Wf:Xf).test(function(e){if(null!=e){try{return qf.call(e)}catch(e){}try{return e+""}catch(e){}}return ""}(e));var t;}(i)?i:void 0}var $f=Object.create,Zf=function(){function e(){}return function(t){if(!Df(t))return {};if($f)return $f(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}();function Kf(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}var Qf,Jf,em,tm=Date.now,im=function(){try{var e=jf(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),nm=im,rm=nm?function(e,t){return nm(e,"toString",{configurable:!0,enumerable:!1,value:(i=t,function(){return i}),writable:!0});var i;}:Ff,om=(Qf=rm,Jf=0,em=0,function(){var e=tm(),t=16-(e-em);if(em=e,t>0){if(++Jf>=800)return arguments[0]}else Jf=0;return Qf.apply(void 0,arguments)}),am=om,sm=9007199254740991,lm=/^(?:0|[1-9]\d*)$/;function um(e,t){var i=typeof e;return !!(t=null==t?sm:t)&&("number"==i||"symbol"!=i&&lm.test(e))&&e>-1&&e%1==0&&e<t}function cm(e,t,i){"__proto__"==t&&nm?nm(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i;}function hm(e,t){return e===t||e!=e&&t!=t}var dm=Object.prototype.hasOwnProperty;function pm(e,t,i){var n=e[t];dm.call(e,t)&&hm(n,i)&&(void 0!==i||t in e)||cm(e,t,i);}var fm=Math.max;function mm(e,t){return am(function(e,t,i){return t=fm(void 0===t?e.length-1:t,0),function(){for(var n=arguments,r=-1,o=fm(n.length-t,0),a=Array(o);++r<o;)a[r]=n[t+r];r=-1;for(var s=Array(t+1);++r<t;)s[r]=n[r];return s[t]=i(a),Kf(e,this,s)}}(e,t,Ff),e+"")}var _m=9007199254740991;function gm(e){return "number"==typeof e&&e>-1&&e%1==0&&e<=_m}function ym(e){return null!=e&&gm(e.length)&&!Uf(e)}var xm=Object.prototype;function vm(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||xm)}function wm(e){return Rf(e)&&"[object Arguments]"==Nf(e)}var Tm=Object.prototype,bm=Tm.hasOwnProperty,Pm=Tm.propertyIsEnumerable,Sm=wm(function(){return arguments}())?wm:function(e){return Rf(e)&&bm.call(e,"callee")&&!Pm.call(e,"callee")},Em=Sm,Am="object"==typeof e&&e&&!e.nodeType&&e,Cm=Am&&"object"==typeof module&&module&&!module.nodeType&&module,Mm=Cm&&Cm.exports===Am?Tf.Buffer:void 0,Im=(Mm?Mm.isBuffer:void 0)||function(){return !1},Lm={};Lm["[object Float32Array]"]=Lm["[object Float64Array]"]=Lm["[object Int8Array]"]=Lm["[object Int16Array]"]=Lm["[object Int32Array]"]=Lm["[object Uint8Array]"]=Lm["[object Uint8ClampedArray]"]=Lm["[object Uint16Array]"]=Lm["[object Uint32Array]"]=!0,Lm["[object Arguments]"]=Lm["[object Array]"]=Lm["[object ArrayBuffer]"]=Lm["[object Boolean]"]=Lm["[object DataView]"]=Lm["[object Date]"]=Lm["[object Error]"]=Lm["[object Function]"]=Lm["[object Map]"]=Lm["[object Number]"]=Lm["[object Object]"]=Lm["[object RegExp]"]=Lm["[object Set]"]=Lm["[object String]"]=Lm["[object WeakMap]"]=!1;var Nm="object"==typeof e&&e&&!e.nodeType&&e,Rm=Nm&&"object"==typeof module&&module&&!module.nodeType&&module,Om=Rm&&Rm.exports===Nm&&vf.process,Dm=function(){try{return Rm&&Rm.require&&Rm.require("util").types||Om&&Om.binding&&Om.binding("util")}catch(e){}}(),Fm=Dm&&Dm.isTypedArray,zm=Fm?function(e){return function(t){return e(t)}}(Fm):function(e){return Rf(e)&&gm(e.length)&&!!Lm[Nf(e)]},Bm=zm,Vm=Object.prototype.hasOwnProperty;function km(e){return ym(e)?function(e,t){var i=Of(e),n=!i&&Em(e),r=!i&&!n&&Im(e),o=!i&&!n&&!r&&Bm(e),a=i||n||r||o,s=a?function(e,t){for(var i=-1,n=Array(e);++i<e;)n[i]=t(i);return n}(e.length,String):[],l=s.length;for(var u in e)a&&("length"==u||r&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||um(u,l))||s.push(u);return s}(e):function(e){if(!Df(e))return function(e){var t=[];if(null!=e)for(var i in Object(e))t.push(i);return t}(e);var t=vm(e),i=[];for(var n in e)("constructor"!=n||!t&&Vm.call(e,n))&&i.push(n);return i}(e)}var Um=jf(Object,"create"),Gm=Object.prototype.hasOwnProperty,Hm=Object.prototype.hasOwnProperty;function Ym(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1]);}}function qm(e,t){for(var i=e.length;i--;)if(hm(e[i][0],t))return i;return -1}Ym.prototype.clear=function(){this.__data__=Um?Um(null):{},this.size=0;},Ym.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Ym.prototype.get=function(e){var t=this.__data__;if(Um){var i=t[e];return "__lodash_hash_undefined__"===i?void 0:i}return Gm.call(t,e)?t[e]:void 0},Ym.prototype.has=function(e){var t=this.__data__;return Um?void 0!==t[e]:Hm.call(t,e)},Ym.prototype.set=function(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=Um&&void 0===t?"__lodash_hash_undefined__":t,this};var Xm=Array.prototype.splice;function Wm(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1]);}}Wm.prototype.clear=function(){this.__data__=[],this.size=0;},Wm.prototype.delete=function(e){var t=this.__data__,i=qm(t,e);return !(i<0||(i==t.length-1?t.pop():Xm.call(t,i,1),--this.size,0))},Wm.prototype.get=function(e){var t=this.__data__,i=qm(t,e);return i<0?void 0:t[i][1]},Wm.prototype.has=function(e){return qm(this.__data__,e)>-1},Wm.prototype.set=function(e,t){var i=this.__data__,n=qm(i,e);return n<0?(++this.size,i.push([e,t])):i[n][1]=t,this};var jm=jf(Tf,"Map");function $m(e,t){var i,n,r=e.__data__;return ("string"==(n=typeof(i=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==i:null===i)?r["string"==typeof t?"string":"hash"]:r.map}function Zm(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1]);}}Zm.prototype.clear=function(){this.size=0,this.__data__={hash:new Ym,map:new(jm||Wm),string:new Ym};},Zm.prototype.delete=function(e){var t=$m(this,e).delete(e);return this.size-=t?1:0,t},Zm.prototype.get=function(e){return $m(this,e).get(e)},Zm.prototype.has=function(e){return $m(this,e).has(e)},Zm.prototype.set=function(e,t){var i=$m(this,e),n=i.size;return i.set(e,t),this.size+=i.size==n?0:1,this};var Km=function(e,t){return function(i){return e(t(i))}}(Object.getPrototypeOf,Object),Qm=Km,Jm="[object Object]",e_=Function.prototype.toString,t_=Object.prototype.hasOwnProperty,i_=e_.call(Object);function n_(e){var t=this.__data__=new Wm(e);this.size=t.size;}n_.prototype.clear=function(){this.__data__=new Wm,this.size=0;},n_.prototype.delete=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i},n_.prototype.get=function(e){return this.__data__.get(e)},n_.prototype.has=function(e){return this.__data__.has(e)},n_.prototype.set=function(e,t){var i=this.__data__;if(i instanceof Wm){var n=i.__data__;if(!jm||n.length<199)return n.push([e,t]),this.size=++i.size,this;i=this.__data__=new Zm(n);}return i.set(e,t),this.size=i.size,this};var r_=("object"==typeof e&&e&&!e.nodeType&&e&&"object"==typeof module&&module&&!module.nodeType&&module,Tf.Uint8Array),o_=function(e,t,i){for(var n=-1,r=Object(e),o=i(e),a=o.length;a--;){var s=o[++n];if(!1===t(r[s],s,r))break}return e};function a_(e,t,i){(void 0!==i&&!hm(e[t],i)||void 0===i&&!(t in e))&&cm(e,t,i);}function s_(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}function l_(e,t,i,n,r){e!==t&&o_(t,(function(o,a){if(r||(r=new n_),Df(o))!function(e,t,i,n,r,o,a){var s,l,u,c=s_(e,i),h=s_(t,i),d=a.get(h);if(d)a_(e,i,d);else {var p,f=o?o(c,h,i+"",e,t,a):void 0,m=void 0===f;if(m){var _=Of(h),g=!_&&Im(h),y=!_&&!g&&Bm(h);f=h,_||g||y?Of(c)?f=c:Rf(p=c)&&ym(p)?f=function(e,t){var i=-1,n=e.length;for(t||(t=Array(n));++i<n;)t[i]=e[i];return t}(c):g?(m=!1,f=h.slice()):y?(m=!1,u=new(l=(s=h).buffer).constructor(l.byteLength),new r_(u).set(new r_(l)),f=new s.constructor(u,s.byteOffset,s.length)):f=[]:function(e){if(!Rf(e)||Nf(e)!=Jm)return !1;var t=Qm(e);if(null===t)return !0;var i=t_.call(t,"constructor")&&t.constructor;return "function"==typeof i&&i instanceof i&&e_.call(i)==i_}(h)||Em(h)?(f=c,Em(c)?f=function(e){return function(e,t,i,n){var r=!i;i||(i={});for(var o=-1,a=t.length;++o<a;){var s=t[o],l=void 0;void 0===l&&(l=e[s]),r?cm(i,s,l):pm(i,s,l);}return i}(e,km(e))}(c):Df(c)&&!Uf(c)||(f=function(e){return "function"!=typeof e.constructor||vm(e)?{}:Zf(Qm(e))}(h))):m=!1;}m&&(a.set(h,f),r(f,h,n,o,a),a.delete(h)),a_(e,i,f);}}(e,t,a,i,l_,n,r);else {var s=n?n(s_(e,a),o,a+"",e,t,r):void 0;void 0===s&&(s=o),a_(e,a,s);}}),km);}function u_(e,t,i,n,r,o){return Df(e)&&Df(t)&&(o.set(t,e),l_(e,t,void 0,u_,o),o.delete(t)),e}var c_,h_=(c_=function(e,t,i,n){l_(e,t,i,n);},mm((function(e,t){var i=-1,n=t.length,r=n>1?t[n-1]:void 0,o=n>2?t[2]:void 0;for(r=c_.length>3&&"function"==typeof r?(n--,r):void 0,o&&function(e,t,i){if(!Df(i))return !1;var n=typeof t;return !!("number"==n?ym(i)&&um(t,i.length):"string"==n&&t in i)&&hm(i[t],e)}(t[0],t[1],o)&&(r=n<3?void 0:r,n=1),e=Object(e);++i<n;){var a=t[i];a&&c_(e,a,i,r);}return e}))),d_=mm((function(e){return e.push(void 0,u_),Kf(h_,void 0,e)}));function p_(e,t,i=!1){let n;return n=i?d_(e,t):{...t,...e},n}const f_={SUB_GLOBE_PASS:1,SUB_VECTOR_OPAQUE_PASS:2,SUB_VECTOR_TRANSLUCENT_PASS:3,SUB_MODEL_OPAQUE_PASS:4,SUB_MODEL_TRANSLUCENT_PASS:5,_USER_DEFINED_PRE_PASS:6,PICK_PASS:7,SHADOW_PASS:8,VIEWSHED_PASS:9,REAL_RENDER_PASS:10,FXAA_PASS:11,BLOOM_PASS:12,TOON_SHADING_PASS:13,HDR_PASS:12,USER_DEFINED_POST_PROCESS_PASS:14,PICK_COLOR_PASS:15,CUBE_MAP_RENDER_FOR_SKYBOX:16,CUBE_MAP_RENDER:16,EARTH_EFFECT_PASS:17,PROXY_PASS:18};class m_{constructor(e){const t=e||Z.EMPTY_OBJECT;this.frontFace=t.frontFace||Du.CCW;const i=t.cull||Z.EMPTY_OBJECT;this.cull={enabled:Z(i.enabled,!1),face:i.face||Du.BACK};const n=t.polygonOffset||Z.EMPTY_OBJECT;this.polygonOffset={enabled:Z(n.enabled,!1),factor:n.factor||0,units:n.units||0};const r=t.scissorTest||Z.EMPTY_OBJECT;this.scissorTest={enabled:Z(r.enabled,!1),rectangle:r.rectangle||Z.EMPTY_OBJECT};const o=t.depthRange||Z.EMPTY_OBJECT;this.depthRange={near:Z(o.near,0),far:Z(o.far,1)};const a=t.depthTest||Z.EMPTY_OBJECT;this.depthTest={enabled:Z(a.enabled,!1),func:a.func||Du.LESS},this.depthMask=Z(t.depthMask,!0);const s=t.colorMask||Z.EMPTY_OBJECT;this.colorMask={red:Z(s.red,!0),green:Z(s.green,!0),blue:Z(s.blue,!0),alpha:Z(s.alpha,!0)};const l=t.blending||Z.EMPTY_OBJECT,u=l.color||Z.EMPTY_OBJECT;this.blending={enabled:Z(l.enabled,!1),color:{red:u.red||0,green:u.green||0,blue:u.blue||0,alpha:u.alpha||0},equationRgb:l.equationRgb||Du.FUNC_ADD,equationAlpha:l.equationAlpha||Du.FUNC_ADD,functionSourceRgb:l.functionSourceRgb||Du.ONE,functionSourceAlpha:l.functionSourceAlpha||Du.ONE,functionDestinationRgb:l.functionDestinationRgb||Du.ZERO,functionDestinationAlpha:l.functionDestinationAlpha||Du.ZERO},this.stencilMask=Z(t.stencilMask,-1);const c=t.stencilTest||Z.EMPTY_OBJECT,h=c.frontOperation||Z.EMPTY_OBJECT,d=c.backOperation||Z.EMPTY_OBJECT;this.stencilTest={enabled:Z(c.enabled,!1),frontFunction:c.frontFunction||Du.ALWAYS,backFunction:c.backFunction||Du.ALWAYS,reference:c.reference||0,mask:Z(c.mask,-1),frontOperation:{fail:Z(h.fail,Du.KEEP),zFail:Z(h.zFail,Du.KEEP),zPass:Z(h.zPass,Du.KEEP)},backOperation:{fail:Z(d.fail,Du.KEEP),zFail:Z(d.zFail,Du.KEEP),zPass:Z(d.zPass,Du.KEEP)}};const p=t.sampleCoverage||Z.EMPTY_OBJECT;this.sampleCoverage={enabled:Z(p.enabled,!1),value:Z(p.value,1),invert:Z(p.invert,!1)},this.viewport=t.viewport,this.id=0;}static fromCache(e={}){return new m_(e)}static applyRenderState(e,t,i){!function(e,t){e._frontFace.set(t.frontFace);}(e,t),function(e,t){e._cullFace.set(t.cull);}(e,t),function(e,t){e._polygonOffset.set(t.polygonOffset);}(e,t),function(e,t){e._depthRange.set(t.depthRange);}(e,t),function(e,t){e._depthTest.set(t.depthTest);}(e,t),function(e,t){e._colorMask.set(t.colorMask);}(e,t),function(e,t){e._depthMask.set(t.depthMask);}(e,t),function(e,t){e._stencilMask.set(t.stencilMask);}(e,t),function(e,t){e._stencilTest.set(t.stencilTest);}(e,t),function(e,t){e._sampleCoverage.set(t.sampleCoverage);}(e,t),function(e,t){e._scissorTest.set(e._scissorTest?e._scissorTest.current:t.scissorTest.rectangle);}(e,t),function(e,t,i={}){e._blending.set(t.blending),(i?.frameState?.passType===f_.PICK_PASS||i?.frameState?.passType===f_.PICK_COLOR_PASS)&&e._blending.set(__.disableBlending);}(e,t,i),function(e,t){let i=Z(t.viewport,e._viewport&&e._viewport.current);i||(i={x:0,y:0,width:e.gl.drawingBufferWidth,height:e.gl.drawingBufferHeight}),e._viewport.set(i);}(e,t);}static generateSimpleRenderState(){}}const __=Object.freeze({enableBlending:Object.freeze({enabled:!0,color:{red:0,green:0,blue:0,alpha:0},equationRgb:Du.FUNC_ADD,equationAlpha:Du.FUNC_ADD,functionSourceRgb:Du.SRC_ALPHA,functionSourceAlpha:Du.ONE,functionDestinationRgb:Du.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:Du.ONE_MINUS_SRC_ALPHA}),disableBlending:Object.freeze({color:{red:0,green:0,blue:0,alpha:0},enabled:!1,equationRgb:Du.FUNC_ADD,equationAlpha:Du.FUNC_ADD,functionSourceRgb:Du.SRC_ALPHA,functionSourceAlpha:Du.ONE,functionDestinationRgb:Du.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:Du.ONE_MINUS_SRC_ALPHA}),enableDepthTest:Object.freeze({enabled:!0,func:Du.LESS}),enableDepthTestWithLEQUAL:Object.freeze({enabled:!0,func:Du.LEQUAL}),disableDepthTest:Object.freeze({enabled:!1,func:Du.LEQUAL}),enableDepthMask:!0,disableDepthMask:!1,enableStencilMask:255,disableStencilMask:0,enableCull:Object.freeze({enabled:!0,face:Du.BACK}),disableCull:Object.freeze({enabled:!1,face:Du.BACK}),depthRange:Object.freeze({near:0,far:1}),enableClassificationStencilTest:Object.freeze({enabled:!0,frontFunction:Du.ALWAYS,backFunction:Du.ALWAYS,reference:0,mask:255,frontOperation:{fail:Du.KEEP,zFail:Du.DECR_WRAP,zPass:Du.KEEP},backOperation:{fail:Du.KEEP,zFail:Du.INCR_WRAP,zPass:Du.KEEP}}),openClassificationStencilTest:Object.freeze({enabled:!0,frontFunction:Du.NOTEQUAL,backFunction:Du.NOTEQUAL,reference:0,mask:255,frontOperation:{fail:Du.KEEP,zFail:Du.KEEP,zPass:Du.ZERO},backOperation:{fail:Du.KEEP,zFail:Du.KEEP,zPass:Du.ZERO}}),disableStencilTest:Object.freeze({enabled:!1,frontFunction:Du.NOTEQUAL,backFunction:Du.NOTEQUAL,reference:0,mask:255,frontOperation:{fail:Du.ZERO,zFail:Du.ZERO,zPass:Du.ZERO},backOperation:{fail:Du.ZERO,zFail:Du.ZERO,zPass:Du.ZERO}}),disabledColorMask:Object.freeze({red:!1,green:!1,blue:!1,alpha:!1}),enableColorMask:Object.freeze({red:!0,green:!0,blue:!0,alpha:!0})}),g_=function e(t){if("object"!=typeof t||null===t)return t;let i;const n=Object.keys(t);for(let r=0;r<n.length;r++)i=n[r],t.hasOwnProperty(i)&&(t[i]=e(t[i]));return Object.freeze(t)}({depthTest:{enabled:!1},blending:{enabled:!1,equationRgb:Du.FUNC_ADD,equationAlpha:Du.FUNC_ADD,functionSourceRgb:Du.SRC_ALPHA,functionSourceAlpha:Du.ONE,functionDestinationRgb:Du.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:Du.ONE_MINUS_SRC_ALPHA},depthMask:!0,frontFace:Du.CCW,cull:{enabled:!1,face:Du.BACK}});var y_="#define GLSLIFY 1\nvec2 unpack_float(const float packedValue){int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity){int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor){return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0);}float unpack_mix_vec2(const vec2 packedValue,const float t){return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_vec4(const vec4 packedColors,const float t){vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}",x_="#define GLSLIFY 1\n#include <c_define>\n#include <c_symbolF>\n#include <pragma_symbol_define>\n#include <u_BaseColorSampler>\n#ifdef M_PICK_COLOR\nvarying vec4 v_pick_color;\n#endif\nvoid main(){\n#include <pragma_symbol_initialize>\n#ifdef M_SYM_TRACKING\nif(v_seq<0.0){discard;}\n#endif\n#ifdef M_PICK_COLOR\nif(v_fade_opacity==0.0){discard;}gl_FragColor=v_pick_color;\n#else\nlowp float alpha=opacity*v_fade_opacity;vec4 tempColor=texture2D(u_BaseColorSampler,v_tex);gl_FragColor=vec4(tempColor.rgb,tempColor.a*alpha);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#endif\n}",v_="#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelMatrix>\n#include <u_ViewProjectionMatrix>\n#include <c_define>\n#include <c_symbolV>\n#include <pragma_symbol_define>\n#include <fn_getVectorPointVisibilityValue>\n#include <fn_rotateXYZ>\n#ifdef M_PICK_COLOR\nattribute vec4 a_pick_color;varying vec4 v_pick_color;\n#endif\nbool is_Hidden_Fog=false;\n#ifdef M_HIDDEN_TERRAIN\n#include <fn_linearizeDepth>\n#include <fn_unpackDepth>\nuniform sampler2D u_depth_texture;bool isHiddenTerrain(){vec2 uv=0.5*gl_Position.xy+0.5;float depthValue=texture2D(u_depth_texture,uv).r;\n#ifdef M_HIDDEN_FOG\nis_Hidden_Fog=depthValue>0.999;\n#endif\nif(u_near_plane>0.11){return(gl_Position.z*0.5+0.5)-depthValue>0.0001;}else{return linearizeDepth(gl_Position.z*0.5+0.5)-linearizeDepth(depthValue)>1.0;}}\n#else\nbool isHiddenTerrain(){\n#ifdef M_HIDDEN_FOG\nuniform sampler2D u_depth_texture;vec2 uv=0.5*gl_Position.xy+0.5;float depthValue=texture2D(u_depth_texture,uv).r;is_Hidden_Fog=depthValue>0.999;\n#endif\nreturn false;}\n#endif\n#ifdef M_SYM_TRACKING\nbool findRangeMatch(){float num=u_seq*a_extra.y;if(u_seq<1.0){return num>=a_extra.x&&num<(a_extra.x+1.0);}else{return a_extra.x>=a_extra.y-1.0;}}bool findTimeRangeMatch(){float currentStamp=a_extra.x;float beforeStamp=a_extra.y;float endStamp=a_extra.z;float totalStartStamp=u_timestamp_se.x;float totalEndStamp=u_timestamp_se.y;float clockStamp=u_seq+totalStartStamp;if(clockStamp<=endStamp){if(clockStamp>beforeStamp&&clockStamp<=currentStamp){return true;}}else{if(currentStamp==endStamp){return true;}}return false;}\n#endif\nvoid main(){\n#include <pragma_symbol_initialize>\n#ifdef M_SYM_TRACKING\nif(u_display_mode==2.0){if(!findTimeRangeMatch()){v_seq=-100.0;}else{v_seq=100.0;}}else if(u_display_mode==1.0){if(!findRangeMatch()){v_seq=-100.0;}else{v_seq=100.0;}}else if(u_display_mode==0.0){float a_seq=a_extra.x;if(a_seq!=u_seq){v_seq=-100.0;}else{v_seq=100.0;}}\n#endif\nvec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if(!u_is_size_zoom_constant&&!u_is_size_feature_constant){size=mix(a_size[0],a_size[1],u_size_t)/10.0;}else if(u_is_size_zoom_constant&&!u_is_size_feature_constant){size=a_size[0]/10.0;}else if(!u_is_size_zoom_constant&&u_is_size_feature_constant){size=u_size;}else{size=u_size;}bool is_Hidden_Terrain=false;float fontScale=u_is_text ? size/24.0 : size;if(!u_rotate_with_map&&!u_pitch_with_map){highp float angle_sin=0.;highp float angle_cos=1.;gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION.xyz,1.0);gl_Position/=gl_Position.w;is_Hidden_Terrain=isHiddenTerrain();angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);gl_Position.xy+=rotation_matrix*a_offset/32.0*fontScale/u_GlUnitsToPixels;}else if(u_rotate_with_map&&u_pitch_with_map&&u_along_line){highp float angle_sin=0.;highp float angle_cos=1.;gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION.xyz,1.0);gl_Position/=gl_Position.w;is_Hidden_Terrain=isHiddenTerrain();angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);mat2 rotation_bearing_matrix=mat2(cos(u_Bearing),-sin(u_Bearing),sin(u_Bearing),cos(u_Bearing));gl_Position.xy+=rotation_bearing_matrix*rotation_matrix*vec2(a_offset.x,a_offset.y)/32.0*fontScale/vec2(u_GlUnitsToPixels.xy);}else if(u_rotate_with_map&&!u_pitch_with_map&&!u_along_line){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION.xyz,1.0);gl_Position/=gl_Position.w;is_Hidden_Terrain=isHiddenTerrain();mat3 rotation_matrix=rotateXYZ(0.,0.,u_Bearing);gl_Position.xyz+=rotation_matrix*vec3(a_offset.x,a_offset.y,0.)/32.0*fontScale/vec3(u_GlUnitsToPixels.xyx);}else if(u_rotate_with_map&&u_pitch_with_map&&!u_along_line){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION.xyz,1.0);gl_Position/=gl_Position.w;is_Hidden_Terrain=isHiddenTerrain();mat3 rotation_matrix=rotateXYZ(u_pitch,0.,u_Bearing);gl_Position.xyz+=rotation_matrix*vec3(a_offset.x,a_offset.y,0.)/32.0*fontScale/vec3(u_GlUnitsToPixels.xyx);}else if(!u_rotate_with_map&&u_pitch_with_map){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION.xyz,1.0);gl_Position/=gl_Position.w;is_Hidden_Terrain=isHiddenTerrain();mat3 rotation_matrix=rotateXYZ(u_pitch,0.,0.);gl_Position.xyz+=rotation_matrix*vec3(a_offset.x,a_offset.y,0.)/32.0*fontScale/vec3(u_GlUnitsToPixels.xyx);}else if(u_rotate_with_map&&!u_pitch_with_map&&u_along_line){gl_Position=u_ModelViewProjectionMatrix*vec4(a_CARTESIAN,1.0);}vec2 translate=u_translate;float translate_anchor=u_translate_anchor;if(translate_anchor==0.0){float sinA=sin(-u_Bearing);float cosA=cos(-u_Bearing);translate=vec2(translate[0]*cosA-translate[1]*sinA,translate[0]*sinA+translate[1]*cosA);}gl_Position.xy+=translate/u_GlUnitsToPixels;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1]>0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));float vVal=getVectorPointVisibilityValue(a_POSITION.xyz,u_ModelMatrix,u_CameraPosition,u_CameraDirection);if(vVal==-1.0||is_Hidden_Terrain||is_Hidden_Fog){interpolated_fade_opacity=0.0;}v_fade_opacity=interpolated_fade_opacity;\n#ifdef M_PICK_COLOR\nv_pick_color=a_pick_color;\n#endif\n}",w_="#define GLSLIFY 1\n#include <c_define>\n#include <c_symbolF>\n#include <pragma_symbol_define>\n#include <u_BaseColorSampler>\n#ifdef M_PICK_COLOR\nvarying vec4 v_pick_color;\n#endif\nvoid main(){\n#include <pragma_symbol_initialize>\n#ifdef M_SYM_TRACKING\nif(v_seq<0.0){discard;}\n#endif\nvec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];\n#ifdef M_PICK_COLOR\nif(fade_opacity==0.0){discard;}gl_FragColor=v_pick_color;\n#else\nfloat fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/fontScale;lowp float buff=(256.0-64.0)/256.0;if(u_is_halo){color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/fontScale;buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_BaseColorSampler,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=vec4(color.rgb,color.a*alpha*opacity*fade_opacity);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#endif\n}",T_="precision highp float;\n#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <u_ViewProjectionMatrix>\n#include <u_ModelMatrix>\n#include <c_define>\n#include <c_symbolV>\n#include <pragma_symbol_define>\n#include <fn_getVectorPointVisibilityValue>\n#include <fn_rotateXYZ>\n#ifdef M_PICK_COLOR\nattribute vec4 a_pick_color;varying vec4 v_pick_color;\n#endif\nbool is_Hidden_Fog=false;\n#ifdef M_HIDDEN_TERRAIN\n#include <fn_linearizeDepth>\n#include <fn_unpackDepth>\nuniform sampler2D u_depth_texture;bool isHiddenTerrain(){vec2 uv=0.5*gl_Position.xy+0.5;float depthValue=texture2D(u_depth_texture,uv).r;\n#ifdef M_HIDDEN_FOG\nis_Hidden_Fog=depthValue>0.999;\n#endif\nif(u_near_plane>0.11){return(gl_Position.z*0.5+0.5)-depthValue>0.0001;}else{return linearizeDepth(gl_Position.z*0.5+0.5)-linearizeDepth(depthValue)>1.0;}}\n#else\nbool isHiddenTerrain(){\n#ifdef M_HIDDEN_FOG\nuniform sampler2D u_depth_texture;vec2 uv=0.5*gl_Position.xy+0.5;float depthValue=texture2D(u_depth_texture,uv).r;is_Hidden_Fog=depthValue>0.999;\n#endif\nreturn false;}\n#endif\n#ifdef M_SYM_TRACKING\nbool findRangeMatch(){float num=u_seq*a_extra.y;if(u_seq<1.0){return num>=a_extra.x&&num<(a_extra.x+1.0);}else{return a_extra.x>=a_extra.y-1.0;}}bool findTimeRangeMatch(){float currentStamp=a_extra.x;float beforeStamp=a_extra.y;float endStamp=a_extra.z;float totalStartStamp=u_timestamp_se.x;float totalEndStamp=u_timestamp_se.y;float clockStamp=u_seq+totalStartStamp;if(clockStamp<=endStamp){if(clockStamp>beforeStamp&&clockStamp<=currentStamp){return true;}}else{if(currentStamp==endStamp){return true;}}return false;}\n#endif\nvoid main(){\n#include <pragma_symbol_initialize>\n#ifdef M_SYM_TRACKING\nif(u_display_mode==2.0){if(!findTimeRangeMatch()){v_seq=-100.0;}else{v_seq=100.0;}}else if(u_display_mode==1.0){if(!findRangeMatch()){v_seq=-100.0;}else{v_seq=100.0;}}else if(u_display_mode==0.0){float a_seq=a_extra.x;if(a_seq!=u_seq){v_seq=-100.0;}else{v_seq=100.0;}}\n#endif\nvec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if(!u_is_size_zoom_constant&&!u_is_size_feature_constant){size=mix(a_size[0],a_size[1],u_size_t)/10.0;}else if(u_is_size_zoom_constant&&!u_is_size_feature_constant){size=a_size[0]/10.0;}else if(!u_is_size_zoom_constant&&u_is_size_feature_constant){size=u_size;}else{size=u_size;}float fontScale=u_is_text ? size/24.0 : size;highp float angle_sin=0.;highp float angle_cos=0.;highp float angle_sin_mv=0.;highp float angle_cos_mv=0.;float lineRotAngle=0.;bool is_Hidden_Terrain=false;if(!u_rotate_with_map&&!u_pitch_with_map){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION.xyz,1.0);gl_Position/=gl_Position.w;is_Hidden_Terrain=isHiddenTerrain();gl_Position.xy+=a_offset/32.0*fontScale/u_GlUnitsToPixels;}else if(u_rotate_with_map&&u_pitch_with_map&&u_along_line){gl_Position=u_ModelViewProjectionMatrix*vec4(a_CARTESIAN,1.0);is_Hidden_Terrain=isHiddenTerrain();}else if(u_rotate_with_map&&!u_pitch_with_map&&!u_along_line){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION.xyz,1.0);gl_Position/=gl_Position.w;is_Hidden_Terrain=isHiddenTerrain();mat3 rotation_matrix=rotateXYZ(0.,0.,u_Bearing);gl_Position.xyz+=rotation_matrix*vec3(a_offset.x,a_offset.y,0.)/32.0*fontScale/vec3(u_GlUnitsToPixels.xyx);}else if(u_rotate_with_map&&u_pitch_with_map&&!u_along_line){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION.xyz,1.0);gl_Position/=gl_Position.w;is_Hidden_Terrain=isHiddenTerrain();mat3 rotation_matrix=rotateXYZ(u_pitch,0.,u_Bearing);gl_Position.xyz+=rotation_matrix*vec3(a_offset.x,a_offset.y,0.)/32.0*fontScale/vec3(u_GlUnitsToPixels.xyx);}else if(!u_rotate_with_map&&u_pitch_with_map){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION.xyz,1.0);gl_Position/=gl_Position.w;is_Hidden_Terrain=isHiddenTerrain();mat3 rotation_matrix=rotateXYZ(u_pitch,0.,0.);gl_Position.xyz+=rotation_matrix*vec3(a_offset.x,a_offset.y,0.)/32.0*fontScale/vec3(u_GlUnitsToPixels.xyx);}else if(u_rotate_with_map&&!u_pitch_with_map&&u_along_line){gl_Position=u_ModelViewProjectionMatrix*vec4(a_CARTESIAN,1.0);is_Hidden_Terrain=isHiddenTerrain();}vec2 translate=u_translate;float translate_anchor=u_translate_anchor;if(translate_anchor==0.0){float sinA=sin(-u_Bearing);float cosA=cos(-u_Bearing);translate=vec2(translate[0]*cosA-translate[1]*sinA,translate[0]*sinA+translate[1]*cosA);}gl_Position.xy+=translate/u_GlUnitsToPixels;vec2 tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1]>0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));float vVal=getVectorPointVisibilityValue(a_POSITION.xyz,u_ModelMatrix,u_CameraPosition,u_CameraDirection);if(vVal==-1.0||is_Hidden_Terrain||is_Hidden_Fog){interpolated_fade_opacity=0.0;}v_data0=vec2(tex.x,tex.y);v_data1=vec3(1.,size,interpolated_fade_opacity);\n#ifdef M_PICK_COLOR\nv_pick_color=a_pick_color;\n#endif\n}",b_="#define GLSLIFY 1\n#include <u_ModelMatrix>\n#include <u_NormalMatrix>\n#include <v_LocalPosition>\n#ifdef M_HAS_BASECOLORMAP\n#include <u_BaseColorSampler>\n#endif\nuniform vec4 u_BaseColorFactor;\n#include <c_define>\n#include <fn_writeLogDepth>\nuniform sampler2D u_MaskSample;\n#include <u_ClipMatrix>\nuniform vec2 u_TextureSize;uniform bool u_ClipVideo;\n#if (defined M_NUM_VIDEOS) && (M_NUM_VIDEOS>0)\nuniform highp mat4 u_VIDEOMATCH_MVPMATRIX[M_NUM_VIDEOS];uniform highp vec3 u_VIDEOMATCH_RTP[M_NUM_VIDEOS];uniform bool u_HAS_VIDEOMATCHMAP[M_NUM_VIDEOS];uniform float u_Alpha[M_NUM_VIDEOS];uniform highp sampler2D u_VideoSampler[M_NUM_VIDEOS];uniform bool u_ActiveClipVideoTexture[M_NUM_VIDEOS];uniform vec3 u_ClipColors[M_NUM_VIDEOS];\n#endif\n#include <fn_getNormal>\nvarying vec3 v_Position;varying vec3 v_ViewPosition;varying vec2 v_TexCoord;varying vec4 v_ModelInstanceColor;varying mat3 v_TBN;\n#include <v_Show>\n#include <v_Normal3>\nvarying vec4 v_COLOR_0;\n#include <u_Opacity>\nuniform highp sampler2D u_model_clippingPlanes;uniform vec4 u_model_clippingPlanesEdgeStyle;uniform mat4 u_model_clippingPlanesMatrix;\n#include <u_Viewport>\nuniform mat4 u_ViewportTransformation;uniform mat4 u_InverseProjection;\n#include <u_PixelRatio>\n#include <u_CurrentFrustum>\n#include <u_FrustumPlanes>\n#include <fn_primitiveClippingPlanes>\n#include <fn_getBatchTextureColor>\nuniform samplerCube u_DiffuseEnvSampler;uniform samplerCube u_SpecularEnvSampler;uniform sampler2D u_brdfLUT;\n#ifdef M_HAS_NORMALMAP\nuniform sampler2D u_NormalSampler;\n#endif\nuniform float u_NormalScale;\n#ifdef M_HAS_EMISSIVEMAP\nuniform sampler2D u_EmissiveSampler;\n#endif\nuniform vec3 u_EmissiveFactor;\n#ifdef M_HAS_METALROUGHNESSMAP\nuniform sampler2D u_MetallicRoughnessSampler;\n#endif\nuniform vec2 u_MetallicRoughnessValues;\n#ifdef M_HAS_OCCLUSIONMAP\nuniform sampler2D u_OcclusionSampler;\n#endif\nuniform float u_OcclusionStrength;\n#ifdef M_HAS_FLOW_TEXTURE\n#ifdef M_HAS_FLOW_ATTRIBUTE\nvarying float v_TexRepeat;\n#endif\nuniform sampler2D u_FlowSampler;uniform vec4 u_TexOffsetScale;uniform vec3 u_TexRotate;uniform float u_FrameTime;uniform float u_Speed;uniform vec2 u_UnitLength;\n#endif\nuniform vec3 u_cameraLocalPosition;uniform vec3 u_SunLightDirectionSpecial;\n#ifdef M_ShadowEnable\nuniform sampler2D u_ShadowDepthSampler;uniform float u_EPSILON;uniform float u_MapSizeScale;\n#include <fn_shadow>\nuniform vec2 u_Resolution;varying vec4 v_PositionFromLight;\n#endif\n#include <u_LIGHT>\n#include <fn_pixelInVideo>\nuniform vec4 u_diffSpec;uniform float u_reflect;float DistributionGGX(vec3 N,vec3 H,float roughness){float a=roughness*roughness;float a2=a*a;float NdotH=max(dot(N,H),0.0);float NdotH2=NdotH*NdotH;float nom=a2;float denom=(NdotH2*(a2-1.0)+1.0);denom=PI*denom*denom;if(denom==0.0){denom=0.0001;}return nom/denom;}float GeometrySchlickGGX(float NdotV,float roughness){float r=(roughness+1.0);float k=(r*r)/8.0;float nom=NdotV;float denom=NdotV*(1.0-k)+k;if(denom==0.0){denom=0.0001;}return nom/denom;}float GeometrySmith(vec3 N,vec3 V,vec3 L,float roughness){float NdotV=max(dot(N,V),0.0);float NdotL=max(dot(N,L),0.0);float ggx2=GeometrySchlickGGX(NdotV,roughness);float ggx1=GeometrySchlickGGX(NdotL,roughness);return ggx1*ggx2;}vec3 fresnelSchlick(float cosTheta,vec3 F0){return F0+(1.0-F0)*pow(clamp(1.0-cosTheta,0.0,1.0),5.0);}vec3 fresnelSchlickRoughness(float cosTheta,vec3 F0,float roughness){return F0+(max(vec3(1.0-roughness),F0)-F0)*pow(clamp(1.0-cosTheta,0.0,1.0),5.0);}mat3 getTangentFrame(vec3 eye_pos,vec3 surf_norm,vec2 uv){vec3 q0=dFdx(eye_pos.xyz);vec3 q1=dFdy(eye_pos.xyz);vec2 st0=dFdx(uv.st);vec2 st1=dFdy(uv.st);vec3 N=surf_norm;vec3 q1perp=cross(q1,N);vec3 q0perp=cross(N,q0);vec3 T=q1perp*st0.x+q0perp*st1.x;vec3 B=q1perp*st0.y+q0perp*st1.y;float det=max(dot(T,T),dot(B,B));float scale2=(det==0.0)? 0.0 : inversesqrt(det);return mat3(T*scale2,B*scale2,N);}vec3 pbr(vec4 baseColor){float metallic=u_MetallicRoughnessValues.x;float roughness=u_MetallicRoughnessValues.y;\n#ifdef M_HAS_METALROUGHNESSMAP\nvec4 mrSample=texture2D(u_MetallicRoughnessSampler,v_TexCoord);roughness=mrSample.g*roughness;metallic=mrSample.b*metallic;\n#endif\nmetallic=clamp(metallic,0.0,1.0);roughness=clamp(roughness,c_MinRoughness,1.0);vec3 N=normalize(v_Normal);vec3 V=normalize(u_CameraPosition-v_Position.xyz);\n#ifdef M_HAS_NORMALMAP\nmat3 TBN;\n#ifdef M_HAS_TANGENTS\nTBN=v_TBN;\n#else\nTBN=getTangentFrame(-v_ViewPosition,N,v_TexCoord);\n#endif\nvec3 normalMap=texture2D(u_NormalSampler,v_TexCoord).rgb;vec3 normalT=normalMap*2.0-1.0;N=normalize(v_TBN*normalT);\n#endif\nvec3 R=reflect(-V,N);vec3 F0=vec3(0.04);F0=mix(F0,baseColor.rgb,metallic);vec3 Lo=vec3(0.0);\n#ifdef M_SunLight\n{vec3 directLightColor=u_SunLightColor;vec3 L=normalize(u_SunLightDirectionGlobal);vec3 H=normalize(V+L);float attenuation=1.0;vec3 radiance=directLightColor*attenuation;float NDF=DistributionGGX(N,H,roughness);float G=GeometrySmith(N,V,L,roughness);vec3 F=fresnelSchlick(max(dot(H,V),0.0),F0);vec3 numerator=NDF*G*F;float denominator=4.0*max(dot(N,V),0.0)*max(dot(N,L),0.0)+0.0001;vec3 specular=numerator/denominator;vec3 kS=F;vec3 kD=vec3(1.0)-kS;kD*=1.0-metallic;float NdotL=max(dot(N,L),0.0);Lo+=(kD*baseColor.rgb/PI+specular)*radiance*NdotL;}\n#endif\n#ifdef M_DirectionalLight\nfor(int i=0;i<int(M_DirectionalLightCount);++i){vec3 directLightColor=vec3(u_DirectionalLightColor[i*3],u_DirectionalLightColor[i*3+1],u_DirectionalLightColor[i*3+2]);vec3 L=normalize(vec3(u_DirectionalLightDir[i*3],u_DirectionalLightDir[i*3+1],u_DirectionalLightDir[i*3+2]));vec3 H=normalize(V+L);float attenuation=1.0*u_DirectionalLightIntensity[i];vec3 radiance=directLightColor*attenuation;float NDF=DistributionGGX(N,H,roughness);float G=GeometrySmith(N,V,L,roughness);vec3 F=fresnelSchlick(max(dot(H,V),0.0),F0);vec3 numerator=NDF*G*F;float denominator=4.0*max(dot(N,V),0.0)*max(dot(N,L),0.0)+0.0001;vec3 specular=numerator/denominator;vec3 kS=F;vec3 kD=vec3(1.0)-kS;kD*=1.0-metallic;float NdotL=max(dot(N,L),0.0);Lo+=(kD*baseColor.rgb/PI+specular)*radiance*NdotL;}\n#endif\n#ifdef M_PointLight\nfor(int i=0;i<int(M_PointLightCount);i++){vec3 pointLightPosition=vec3(u_PointLightPosition[i*3],u_PointLightPosition[i*3+1],u_PointLightPosition[i*3+2]);vec3 pointLightColor=vec3(u_PointLightColor[i*3],u_PointLightColor[i*3+1],u_PointLightColor[i*3+2]);float pointLightIntensity=u_PointLightIntensity[i];vec3 LV=pointLightPosition-v_Position;vec3 L=normalize(LV);vec3 H=normalize(V+L);float distance=length(LV);if(distance==0.0){distance=0.0001;}float attenuation=pointLightIntensity*1000.0/(distance*distance);vec3 radiance=pointLightColor*attenuation;float NDF=DistributionGGX(N,H,roughness);float G=GeometrySmith(N,V,L,roughness);vec3 F=fresnelSchlick(max(dot(H,V),0.0),F0);vec3 numerator=NDF*G*F;float denominator=4.0*max(dot(N,V),0.0)*max(dot(N,L),0.0)+0.0001;vec3 specular=numerator/denominator;vec3 kS=F;vec3 kD=vec3(1.0)-kS;kD*=1.0-metallic;float NdotL=max(dot(N,L),0.0);Lo+=(kD*baseColor.rgb/PI+specular)*radiance*NdotL;}\n#endif\nvec3 F=fresnelSchlickRoughness(max(dot(N,V),0.0),F0,roughness);vec3 kS=F;vec3 kD=1.0-kS;kD*=1.0-metallic;vec3 irradiance=textureCube(u_DiffuseEnvSampler,N).rgb*0.28;\n#ifdef M_AmbientLight\nfor(int i=0;i<int(M_AmbientLightCount);++i){vec3 ambientColor=vec3(u_AmbientLightsColor[i*3],u_AmbientLightsColor[i*3+1],u_AmbientLightsColor[i*3+2]);irradiance+=ambientColor;}\n#endif\nvec3 diffuse=irradiance*baseColor.rgb;vec3 prefilteredColor=textureCube(u_SpecularEnvSampler,R).rgb;vec2 brdf=texture2D(u_brdfLUT,vec2(max(dot(N,V),0.0),1.0-roughness)).rg;vec3 specular=prefilteredColor*(F*brdf.x+brdf.y);vec3 color=(kD*diffuse+specular);\n#ifdef M_HAS_OCCLUSIONMAP\nfloat ao=texture2D(u_OcclusionSampler,v_TexCoord).r;color=mix(color,color*ao,u_OcclusionStrength);\n#endif\n#ifdef M_HAS_EMISSIVEMAP\nvec3 emissive=texture2D(u_EmissiveSampler,v_TexCoord).rgb*u_EmissiveFactor;color+=emissive;\n#endif\ncolor=color+Lo;return color;}void main(){\n#include <c_showF>\nvec4 baseColor=u_BaseColorFactor;\n#if defined M_HAS_BASECOLORMAP\nbaseColor=texture2D(u_BaseColorSampler,v_TexCoord);\n#if defined M_OPAQUE\nif(baseColor.a>0.0){baseColor.rgb*=u_BaseColorFactor.rgb;baseColor.a=1.0;}else{baseColor*=u_BaseColorFactor;}\n#else\nbaseColor*=u_BaseColorFactor;\n#endif\n#endif\n#if defined M_VERTEX_COLOR\nbaseColor*=v_COLOR_0;\n#endif\n#ifdef M_MODEL_INSTANCE_BATCH_TEXTURE\nbaseColor.rgb=mix(baseColor.rgb,v_ModelInstanceColor.rgb,v_ModelInstanceColor.a);\n#endif\n#ifdef M_HAS_FLOW_TEXTURE\nvec2 flowTexCoord=vec2(0.0);\n#ifdef M_HAS_FLOW_ATTRIBUTE\nflowTexCoord=vec2(v_TexRepeat,u_TexOffsetScale.w)*v_TexCoord;\n#else\nflowTexCoord=u_TexOffsetScale.zw*v_TexCoord;\n#endif\nflowTexCoord=flowTexCoord-u_TexRotate.xy;flowTexCoord=vec2(flowTexCoord.x*cos(u_TexRotate.z)-flowTexCoord.y*sin(u_TexRotate.z),flowTexCoord.x*sin(u_TexRotate.z)+flowTexCoord.y*cos(u_TexRotate.z));flowTexCoord=flowTexCoord+u_TexRotate.xy;flowTexCoord+=u_TexOffsetScale.xy;vec4 flowColor=texture2D(u_FlowSampler,flowTexCoord);baseColor.rgb=mix(baseColor.rgb,flowColor.rgb,flowColor.a);\n#endif\nif(baseColor.a==0.0){discard;}\n#ifdef M_HAS_CLIPPING_PLANES\nmodelClippingPlanesStage(baseColor);\n#endif\nvec3 color=vec3(1.0);\n#ifdef M_HAS_NORMALS\ncolor=pbr(baseColor);float m=max(0.0,max(color.r,max(color.g,color.b)));if(m>1.0){color/=m;}\n#else\ncolor=baseColor.rgb;\n#endif\ngl_FragColor=vec4(color,baseColor.a);float visibility=1.0;\n#ifdef M_ShadowEnable\n#ifdef M_ShadowMapping\nvisibility=0.6+0.4*ifShadow2(v_PositionFromLight,u_ShadowDepthSampler,u_EPSILON,1./u_Resolution.x,1./u_Resolution.y,u_MapSizeScale);\n#else\n#ifdef M_PCF\nvisibility=ShadowPCF(v_PositionFromLight,u_Resolution,u_ShadowDepthSampler);\n#endif\n#endif\n#endif\ngl_FragColor=vec4(gl_FragColor.rgb*visibility,gl_FragColor.a*u_Opacity);\n#if (defined M_NUM_VIDEOS) && (M_NUM_VIDEOS>0)\nfor(int i=0;i<M_NUM_VIDEOS;i++){if(u_HAS_VIDEOMATCHMAP[i]){if(u_ClipVideo){if(pixelInVideo(u_VIDEOMATCH_MVPMATRIX[i],u_VIDEOMATCH_RTP[i],u_ModelMatrix,v_LocalPosition,u_VideoSampler[i],u_Alpha[i],u_ClipMatrix,u_MaskSample,u_TextureSize,u_ActiveClipVideoTexture[i],u_ClipColors[i])){continue;}}else{if(pixelInVideo(u_VIDEOMATCH_MVPMATRIX[i],u_VIDEOMATCH_RTP[i],u_ModelMatrix,v_LocalPosition,u_VideoSampler[i],u_Alpha[i],u_ClipMatrix,u_MaskSample,u_TextureSize,false,u_ClipColors[i])){continue;}}}}\n#endif\n#if defined(M_ONE_DIMENSION_BATCH_TEXTURE)||defined(M_TWO_DIMENSION_BATCH_TEXTURE)\ngetBatchTextureColor(batch_featureColor);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}",P_="#define GLSLIFY 1\n#include <c_define>\n#ifdef M_DOUBLEPRECISION\n#include <a_DOUBLE_PRECISION_POSITION>\n#else\n#include <a_POSITION3>\n#endif\n#include <a_NORMAL3>\n#include <a_TANGENT>\n#include <a_TEXCOORD_0>\n#ifdef M_USE_MORPHTARGETS\n#include <a_POSITION3_1>\n#include <a_POSITION3_2>\nuniform vec2 u_morphTargetInfluences;\n#include <a_NORMAL3_1>\n#include <a_NORMAL3_2>\n#include <a_TANGENT_1>\n#include <a_TANGENT_2>\n#endif\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelMatrix>\n#include <u_ViewMatrix>\n#include <u_NormalMatrix>\n#include <v_LocalPosition>\n#include <v_Show>\n#include <a_COLOR4_0>\n#include <a_BATCHID>\n#ifdef M_JOINT_MATRIX_CNT\nattribute vec4 a_JOINTS_0;attribute vec4 a_WEIGHTS_0;\n#endif\n#ifdef M_INSTANCE_MATRIX\nattribute mat4 a_InstanceMatrix4;uniform mat4 vpmatrix;uniform mat4 u_ModelInstanceRTCTransformMatrix;\n#endif\nuniform bool u_useKhr;uniform vec4 u_khrValues;varying vec3 v_Position;varying vec3 v_ViewPosition;\n#ifdef M_ShadowEnable\nvarying vec4 v_PositionFromLight;uniform mat4 u_ShadowModelViewProjectionMatrix;\n#endif\nvarying vec2 v_TexCoord;varying mat3 v_TBN;\n#include <v_Normal3>\nvarying vec4 v_COLOR_0;\n#include <s_JointMatrix>\n#include <fn_vertexLogDepth>\n#include <u_HasSkinning>\n#ifdef M_JOINT_MATRIX_CNT\nuniform highp mat4 u_jointMatrix[M_JOINT_MATRIX_CNT];\n#else\nuniform highp mat4 u_jointMatrix[19];\n#endif\n#include <fn_getKHRCoord>\n#include <c_computeSTParsVert>\n#include <u_ModelViewProjectionRelativeToEye>\n#include <u_EncodedCameraPosition>\n#include <fn_translateRelativeToEye>\n#include <fn_getAnimatedGLPosition>\n#include <u_LIGHT>\n#include <v_LIGHT>\nuniform sampler2D u_NormalSampler;\n#if defined(M_HAS_FLOW_TEXTURE) && defined(M_HAS_FLOW_ATTRIBUTE)\nuniform float u_TexUnit;attribute float a_TEXREPEAT;varying float v_TexRepeat;\n#endif\nmat3 transpose(mat3 matrix){return mat3(vec3(matrix[0][0],matrix[1][0],matrix[2][0]),vec3(matrix[0][1],matrix[1][1],matrix[2][1]),vec3(matrix[0][2],matrix[1][2],matrix[2][2]));}void main(){mat4 modelMatrix=mat4(1.0);\n#ifdef M_INSTANCE_MATRIX\nmodelMatrix=u_ModelInstanceRTCTransformMatrix*a_InstanceMatrix4*u_ModelMatrix;\n#else\nmodelMatrix=u_ModelMatrix;\n#endif\n#ifdef M_DOUBLEPRECISION\nvec4 pos=modelMatrix*vec4(a_PositionHigh+a_PositionLow,1.0);v_Position=vec3(pos.xyz)/pos.w;v_ViewPosition=(u_ViewMatrix*pos).xyz;v_LocalPosition=vec4(a_PositionHigh+a_PositionLow,1.0);\n#ifdef M_ShadowEnable\nv_PositionFromLight=u_ShadowModelViewProjectionMatrix*vec4(a_PositionHigh+a_PositionLow,1.0);\n#endif\n#else\nvec4 pos=modelMatrix*vec4(a_POSITION,1.0);v_Position=vec3(pos.xyz)/pos.w;v_ViewPosition=(u_ViewMatrix*pos).xyz;v_LocalPosition=vec4(a_POSITION,1.0);\n#ifdef M_ShadowEnable\nv_PositionFromLight=u_ShadowModelViewProjectionMatrix*vec4(a_POSITION,1.0);\n#endif\n#endif\n#if defined(M_enableLight) && defined(M_PointLight) && defined(M_ShadowEnable)\nfor(int i=0;i<int(M_PointLightCount);i++){vec4 positionToLight=u_PointLightModelMatrixInverse[i]*vec4(v_Position,1.0);v_PointDirection[i]=positionToLight.xyz;}\n#endif\nif(u_useKhr){v_TexCoord=getKHRCoord(a_TEXCOORD_0,u_khrValues);}else{v_TexCoord=a_TEXCOORD_0;}\n#ifndef M_INSTANCE_MATRIX\n#ifdef M_HAS_NORMALS\nv_Normal=normalize(u_NormalMatrix*a_NORMAL);\n#ifdef M_HAS_NORMALMAP\n#ifdef M_HAS_TANGENTS\nvec3 N=v_Normal;vec3 T=normalize(u_NormalMatrix*a_TANGENT);vec3 B=normalize(cross(N,T));v_TBN=mat3(T,B,N);\n#endif\n#endif\n#endif\n#endif\nv_COLOR_0=a_COLOR_0;getAnimatedGLPosition();\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n#include <c_computeSTMainVert>\n#if defined(M_HAS_FLOW_TEXTURE) && defined(M_HAS_FLOW_ATTRIBUTE)\nif(u_TexUnit==0.0){v_TexRepeat=a_TEXREPEAT;}else{v_TexRepeat=a_TEXREPEAT/u_TexUnit;}\n#endif\n}",S_="#define GLSLIFY 1\n#include <a_POSITION2>\n#include <u_ModelViewProjectionMatrix>\n#include <u_World>\n#include <v_TexCoord2>\nvoid main(){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION*u_World,0,1);v_TexCoord.x=a_POSITION.x;v_TexCoord.y=1.0-a_POSITION.y;}",E_="#define GLSLIFY 1\n#include <a_POSITION2>\nvarying vec2 vUv;void main(){gl_Position=vec4(a_POSITION,0.0,1.0);vUv=a_POSITION;}";const A_={basicVertex:"#define GLSLIFY 1\n#ifdef M_DOUBLEPRECISION\n#include <a_DOUBLE_PRECISION_POSITION>\n#else\n#include <a_POSITION3>\n#endif\n#include <u_ModelMatrix>\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelViewProjectionRelativeToEye>\n#include <u_EncodedCameraPosition>\n#include <fn_translateRelativeToEye>\n",a_BATCHID:"#define GLSLIFY 1\nattribute float a_BATCHID;",a_COLOR3_0:"#define GLSLIFY 1\nattribute vec3 a_COLOR_0;",a_COLOR4_0:"#define GLSLIFY 1\nattribute vec4 a_COLOR_0;",a_POSITION2:"#define GLSLIFY 1\nattribute vec2 a_POSITION;",a_POSITION3:"#define GLSLIFY 1\nattribute vec3 a_POSITION;",a_POSITION3_1:"#define GLSLIFY 1\nattribute vec3 a_POSITION_1;",a_POSITION3_2:"#define GLSLIFY 1\nattribute vec3 a_POSITION_2;",a_POSITION4:"#define GLSLIFY 1\nattribute vec4 a_POSITION;",a_DOUBLE_PRECISION_POSITION:"#define GLSLIFY 1\n#ifdef M_DOUBLEPRECISION\nattribute vec3 a_PositionHigh;attribute vec3 a_PositionLow;\n#endif\n",a_NORMAL3:"#define GLSLIFY 1\nattribute vec3 a_NORMAL;",a_NORMAL3_1:"#define GLSLIFY 1\nattribute vec3 a_NORMAL_1;",a_NORMAL3_2:"#define GLSLIFY 1\nattribute vec3 a_NORMAL_2;",a_NORMAL2:"#define GLSLIFY 1\nattribute vec2 a_NORMAL;",a_TANGENT:"#define GLSLIFY 1\nattribute vec3 a_TANGENT;",a_TANGENT_1:"#define GLSLIFY 1\nattribute vec3 a_TANGENT_1;",a_TANGENT_2:"#define GLSLIFY 1\nattribute vec3 a_TANGENT_2;",a_TEXCOORD_0:"#define GLSLIFY 1\nattribute vec2 a_TEXCOORD_0;",u_ModelMatrix:"#define GLSLIFY 1\n#ifndef __MODEL_MATRIX__\n#define __MODEL_MATRIX__\nuniform mat4 u_ModelMatrix;\n#endif\n",u_ProjectionMatrix:"#define GLSLIFY 1\nuniform mat4 u_ProjectionMatrix;",u_ModelViewMatrix:"#define GLSLIFY 1\n#ifndef __MODEL_VIEW_MATRIX__\n#define __MODEL_VIEW_MATRIX__\nuniform mat4 u_ModelViewMatrix;",u_ViewProjectionMatrix:"#define GLSLIFY 1\nuniform mat4 u_ViewProjectionMatrix;",u_ModelViewProjectionMatrix:"#define GLSLIFY 1\n#ifndef __MODEL_VIEW_PROJECTION_MATRIX__\n#define __MODEL_VIEW_PROJECTION_MATRIX__\nuniform mat4 u_ModelViewProjectionMatrix;\n#endif\n",u_NormalMatrix:"#define GLSLIFY 1\nuniform mat3 u_NormalMatrix;",u_ClipMatrix:"#define GLSLIFY 1\nuniform mat4 u_ClipMatrix;",u_BaseColorSampler:"#define GLSLIFY 1\nuniform sampler2D u_BaseColorSampler;",u_Resolution:"#define GLSLIFY 1\nuniform highp vec2 u_Resolution;",u_PixelMatrix:"#define GLSLIFY 1\nuniform mat2 u_PixelMatrix;",u_PixelRatio:"#define GLSLIFY 1\nuniform float u_PixelRatio;",u_Opacity:"#define GLSLIFY 1\nuniform float u_Opacity;",u_LightMaterial:"#define GLSLIFY 1\nuniform LightMaterial u_LightMaterial;",u_Color4:"#define GLSLIFY 1\nuniform vec4 u_Color;",u_Color3:"#define GLSLIFY 1\nuniform vec3 u_Color;",u_World:"#define GLSLIFY 1\n#ifndef _U_WORLD_\n#define _U_WORLD_\nuniform vec2 u_World;\n#endif\n",u_Zoom:"#define GLSLIFY 1\nuniform float u_Zoom;",u_ViewMatrix:"#define GLSLIFY 1\nuniform mat4 u_ViewMatrix;",u_TileNumber:"#define GLSLIFY 1\nuniform vec4 u_TileNumber;",u_Viewport:"#define GLSLIFY 1\nuniform vec4 u_Viewport;",u_RotateMatrixInverse:"#define GLSLIFY 1\nuniform mat4 u_RotateMatrixInverse;",u_ShadowViewProjectionMatrix:"#define GLSLIFY 1\nuniform mat4 u_ShadowViewProjectionMatrix;",u_ModelViewProjectionRelativeToEye:"#define GLSLIFY 1\n#ifndef __MODEL_VIEW_PROJECTION_MATRIX_RTE__\n#define __MODEL_VIEW_PROJECTION_MATRIX_RTE__\nuniform mat4 u_ModelViewProjectionRelativeToEye;\n#endif\n",u_CurrentFrustum:"#define GLSLIFY 1\nuniform vec2 u_CurrentFrustum;",u_EncodedCameraPosition:"#define GLSLIFY 1\nuniform vec3 u_EncodedCameraPositionMCLow;uniform vec3 u_EncodedCameraPositionMCHigh;",u_FrameTime:"#define GLSLIFY 1\nuniform float u_FrameTime;",u_FrustumPlanes:"#define GLSLIFY 1\nuniform vec4 u_FrustumPlanes;",u_Gamma:"#define GLSLIFY 1\nuniform float u_Gamma;",u_HasSkinning:"#define GLSLIFY 1\nuniform bool u_HasSkinning;",u_LIGHT:"#define GLSLIFY 1\n#ifdef M_enableLight\n#ifdef M_AmbientLight\nuniform float u_AmbientLightsColor[M_AmbientLightCount*3];uniform float u_AmbientLightsIntensity[M_AmbientLightCount];\n#endif\n#ifdef M_DirectionalLight\nuniform float u_DirectionalLightColor[M_DirectionalLightCount*3];uniform float u_DirectionalLightIntensity[M_DirectionalLightCount];uniform float u_DirectionalLightDir[M_DirectionalLightCount*3];\n#endif\n#ifdef M_PointLight\nuniform float u_PointLightColor[M_PointLightCount*3];uniform float u_PointLightIntensity[M_PointLightCount];uniform float u_PointLightPosition[M_PointLightCount*3];\n#ifdef M_ShadowEnable\nuniform mat4 u_PointLightModelMatrixInverse[M_PointLightCount];uniform float u_PointLightFar[M_PointLightCount];uniform samplerCube u_PointLightDepthCubeTexture;uniform float u_PointLightEpsilon[M_PointLightCount];uniform float u_DiskRadius[M_PointLightCount];uniform samplerCube u_PointLightDepthCubeTexture0;uniform samplerCube u_PointLightDepthCubeTexture1;uniform samplerCube u_PointLightDepthCubeTexture2;uniform samplerCube u_PointLightDepthCubeTexture3;uniform samplerCube u_PointLightDepthCubeTexture4;uniform samplerCube u_PointLightDepthCubeTexture5;\n#endif\n#endif\n#endif\n",u_Bearing:"#define GLSLIFY 1\nuniform float u_Bearing;",v_TexCoord2:"#define GLSLIFY 1\nvarying vec2 v_TexCoord;",v_TexCoord3:"#define GLSLIFY 1\nvarying vec3 v_TexCoord;",v_Normal3:"#define GLSLIFY 1\nvarying vec3 v_Normal;",v_Normal2:"#define GLSLIFY 1\nvarying vec2 v_Normal;",v_LocalPosition:"#define GLSLIFY 1\nvarying vec4 v_LocalPosition;",v_LIGHT:"#define GLSLIFY 1\n#ifdef M_enableLight\n#ifdef M_PointLight\n#ifdef M_ShadowEnable\nvarying vec3 v_PointDirection[M_PointLightCount];\n#endif\n#endif\n#endif\n",v_Show:"#define GLSLIFY 1\n#if defined(M_ONE_DIMENSION_BATCH_TEXTURE)||defined(M_TWO_DIMENSION_BATCH_TEXTURE)||defined(M_MODEL_INSTANCE_BATCH_TEXTURE)\nvarying float v_Show;\n#endif\n",c_define:"#define GLSLIFY 1\n#define scale 0.015873016\n#define GAUSS_COEF 0.3989422804014327\n#define ANTIALIASING 1.0 / M_DEVICE_PIXEL_RATIO / 2.0\n#define LINE_DISTANCE_SCALE 2.0\n#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105/M_DEVICE_PIXEL_RATIO\n#ifdef M_LOG_DEPTH\nvarying float v_depthFromNearPlusOne;\n#include <u_CurrentFrustum>\n#endif\nconst highp float ZERO=1.0/255.0/16.0;const float c_MinRoughness=0.04;",c_extrusionF:"#define GLSLIFY 1\n#include <v_Normal3>\nvarying highp float v_Top;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;uniform bool u_RenderBodyTex;uniform vec2 u_top_pattern_tl_a;uniform vec2 u_top_pattern_br_a;uniform vec2 u_top_pattern_tl_b;uniform vec2 u_top_pattern_br_b;uniform bool u_RenderTopTex;uniform vec2 u_texsize;uniform vec2 u_top_pattern_size_a;uniform vec2 u_top_pattern_size_b;uniform float u_mix;varying float v_directional;varying float v_opacity;varying vec4 v_color;varying float v_height;uniform lowp float u_depth_render;uniform vec4 u_color_a;uniform vec4 u_color_b;uniform vec4 u_color_c;uniform vec4 u_color_d;uniform vec4 u_color_e;uniform float u_max_height;",c_extrusionV:"#define GLSLIFY 1\nuniform float u_is_max_length;attribute vec4 a_NORMAL_ED;attribute vec3 a_ST;\n#include <v_Normal3>\nvarying highp float v_Top;\n#include <fn_getPatternPos>\nuniform vec2 u_top_pattern_size_a;uniform vec2 u_top_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;uniform vec2 u_translate;uniform float u_translate_anchor;\n#include <u_World>\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;",c_fillF:"#define GLSLIFY 1\nuniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;",c_fillV:"#define GLSLIFY 1\n#include <fn_getVectorPointVisibilityValue>\nuniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_translate;uniform float u_translate_anchor;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#include <u_ModelMatrix>\n",c_lineF:"#define GLSLIFY 1\n#include <fn_writeLogDepth>\nuniform bool u_HasBorder;varying vec2 v_width2;\n#include <v_Normal2>\nvarying float v_gamma_scale;",c_lineV:"#define GLSLIFY 1\n#include <fn_vertexLogDepth>\n#include <fn_getVectorPointVisibilityValue>\nattribute float a_NORMAL;attribute vec4 a_data;attribute vec2 a_pos_normal;attribute float a_scale_terrain;\n#include <u_PixelMatrix>\nuniform mediump float u_Ratio;uniform vec2 u_GlUnitsToPixels;uniform bool u_HalfRender;uniform lowp float normaldirection;uniform bool u_HasBorder;uniform vec2 u_translate;uniform float u_translate_anchor;\n#include <u_ModelMatrix>\n#include <v_Normal2>\nvarying vec2 v_width2;varying float v_gamma_scale;",c_symbolF:"#define GLSLIFY 1\nuniform bool u_is_halo;uniform bool u_is_text;varying vec2 v_tex;varying float v_fade_opacity;varying vec2 v_data0;varying vec3 v_data1;varying float v_seq;",c_symbolV:"#define GLSLIFY 1\nattribute vec2 a_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute vec3 a_CARTESIAN;attribute float a_fade_opacity;attribute vec3 a_extra;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform vec2 u_GlUnitsToPixels;uniform highp float u_Bearing;uniform bool u_along_line;uniform bool u_pitch_with_map;uniform bool u_rotate_with_map;uniform bool u_rotate_symbol;uniform bool u_is_text;uniform highp float u_pitch;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform vec2 u_texsize;uniform float u_display_mode;uniform vec2 u_timestamp_se;uniform highp float u_seq;uniform vec2 u_translate;uniform float u_translate_anchor;varying vec2 v_data0;varying vec3 v_data1;varying vec2 v_tex;varying float v_fade_opacity;varying float v_seq;",c_computeSTParsVert:"#define GLSLIFY 1\n#if defined(M_ONE_DIMENSION_BATCH_TEXTURE)\nuniform sampler2D batchTexture;uniform vec4 batch_textureStep;varying vec4 batch_featureColor;varying vec2 batch_featureSt;vec2 computeSt(float batchId){float stepX=batch_textureStep.x;float centerX=batch_textureStep.y;return vec2(centerX+(batchId*stepX),0.5);}\n#endif\n#if defined(M_TWO_DIMENSION_BATCH_TEXTURE)\nuniform sampler2D batchTexture;uniform vec4 batch_textureStep;uniform vec2 batch_textureDimensions;varying vec2 batch_featureSt;varying vec4 batch_featureColor;vec2 computeSt(float batchId){float stepX=batch_textureStep.x;float centerX=batch_textureStep.y;float stepY=batch_textureStep.z;float centerY=batch_textureStep.w;float xId=mod(batchId,batch_textureDimensions.x);float yId=floor(batchId/batch_textureDimensions.x);return vec2(centerX+(xId*stepX),centerY+(yId*stepY));}\n#endif\n#if defined(M_MODEL_INSTANCE_BATCH_TEXTURE)\nuniform sampler2D batchTableTexture;uniform vec4 batchTextureStep;uniform float numberOfAttributes;varying vec4 v_ModelInstanceColor;varying vec4 v_PickColor;attribute vec4 a_PickColor;vec2 computeModelSt(float batchId){float stepX=batchTextureStep.x;float centerX=batchTextureStep.y;return vec2(centerX+(batchId*numberOfAttributes*stepX),0.5);}vec4 batchTable_color(float batchId){vec2 st=computeModelSt(batchId);st.x+=batchTextureStep.x*float(0);vec4 textureValue=texture2D(batchTableTexture,st);return textureValue;}float batchTable_show(float batchId){vec2 st=computeModelSt(batchId);st.x+=batchTextureStep.x*float(1);vec4 textureValue=texture2D(batchTableTexture,st);float value=textureValue.x;value*=255.0;return value;}vec4 batchTable_pickColor(float batchId){vec2 st=computeModelSt(batchId);st.x+=batchTextureStep.x*float(2);vec4 textureValue=texture2D(batchTableTexture,st);vec4 value=textureValue;return value;}\n#endif\n",c_computeSTMainVert:"#define GLSLIFY 1\n#if defined(M_ONE_DIMENSION_BATCH_TEXTURE)||defined(M_TWO_DIMENSION_BATCH_TEXTURE)\nbatch_featureSt=computeSt(a_BATCHID);batch_featureColor=texture2D(batchTexture,batch_featureSt);v_Show=ceil(batch_featureColor.a);\n#endif\n#ifdef M_MODEL_INSTANCE_BATCH_TEXTURE\nv_Show=batchTable_show(a_BATCHID);v_ModelInstanceColor=batchTable_color(a_BATCHID);v_PickColor=batchTable_pickColor(a_BATCHID);\n#endif\n",c_showF:"#define GLSLIFY 1\n#if defined(M_ONE_DIMENSION_BATCH_TEXTURE)||defined(M_TWO_DIMENSION_BATCH_TEXTURE)||defined(M_MODEL_INSTANCE_BATCH_TEXTURE)\nif(v_Show==0.0){discard;}\n#endif\n",pragma_base_define:"#define GLSLIFY 1\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n",pragma_base_initialize:"#define GLSLIFY 1\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n",pragma_border_define:"#define GLSLIFY 1\n#pragma minemap: define highp vec4 bordercolor\n#pragma minemap: define mediump float borderwidth\n#pragma minemap: define lowp float borderopacity\n",pragma_border_initialize:"#define GLSLIFY 1\n#pragma minemap: initialize highp vec4 bordercolor\n#pragma minemap: initialize mediump float borderwidth\n#pragma minemap: initialize lowp float borderopacity\n",pragma_circle_define:"#define GLSLIFY 1\n#include <pragma_base_define>\n#pragma minemap: define mediump float radius\n#pragma minemap: define highp vec4 stroke_color\n#pragma minemap: define mediump float stroke_width\n#pragma minemap: define lowp float stroke_opacity\n",pragma_circle_initialize:"#define GLSLIFY 1\n#include <pragma_base_initialize>\n#pragma minemap: initialize mediump float radius\n#pragma minemap: initialize highp vec4 stroke_color\n#pragma minemap: initialize mediump float stroke_width\n#pragma minemap: initialize lowp float stroke_opacity\n",pragma_extrusion_define:"#define GLSLIFY 1\n#include <pragma_base_define>\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n",pragma_extrusion_initialize:"#define GLSLIFY 1\n#include <pragma_base_initialize>\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n",pragma_heatmap_define:"#define GLSLIFY 1\n#pragma minemap: define highp float weight\n#pragma minemap: define mediump float radius\n",pragma_heatmap_initialize:"#define GLSLIFY 1\n#pragma minemap: initialize highp float weight\n#pragma minemap: initialize mediump float radius\n",pragma_line_define:"#define GLSLIFY 1\n#include <pragma_base_define>\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\n#pragma minemap: define lowp float floorwidth\n#pragma minemap: define lowp float normal_direction\n#pragma minemap: define lowp float speed_factor\n",pragma_line_initialize:"#define GLSLIFY 1\n#include <pragma_base_initialize>\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float width\n#pragma minemap: initialize lowp float floorwidth\n#pragma minemap: initialize lowp float normal_direction\n#pragma minemap: initialize lowp float speed_factor\n",pragma_fill_define:"#define GLSLIFY 1\n#pragma minemap: define highp vec4 outline_color\n",pragma_fill_initialize:"#define GLSLIFY 1\n#pragma minemap: initialize highp vec4 outline_color\n",pragma_symbol_define:"#define GLSLIFY 1\n#pragma minemap: define highp vec4 fill_color\n#pragma minemap: define highp vec4 halo_color\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float halo_width\n#pragma minemap: define lowp float halo_blur\n",pragma_symbol_initialize:"#define GLSLIFY 1\n#pragma minemap: initialize highp vec4 fill_color\n#pragma minemap: initialize highp vec4 halo_color\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize lowp float halo_width\n#pragma minemap: initialize lowp float halo_blur\n",pragma_water_define:"#define GLSLIFY 1\n#pragma minemap: define lowp float watercalm\n#pragma minemap: define lowp float waterspeed\n",pragma_water_initialize:"#define GLSLIFY 1\n#pragma minemap: initialize lowp float watercalm\n#pragma minemap: initialize lowp float waterspeed\n",fn_basic:"#define GLSLIFY 1\nvec4 getGLPosition(){\n#ifdef M_DOUBLEPRECISION\nvec4 position=u_ModelViewProjectionRelativeToEye*translateRelativeToEye(a_PositionHigh,a_PositionLow);\n#else\nvec4 position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);\n#endif\nreturn position;}vec4 getWorldPosition(){\n#ifdef M_DOUBLEPRECISION\nvec4 position=u_ModelMatrix*vec4(a_PositionHigh+a_PositionLow,1);\n#else\nvec4 position=u_ModelMatrix*vec4(a_POSITION,1.0);\n#endif\nreturn position;}",fn_translateRelativeToEye:"#define GLSLIFY 1\nvec4 translateRelativeToEye(vec3 high,vec3 low){vec3 highDifference=high-u_EncodedCameraPositionMCHigh;vec3 lowDifference=low-u_EncodedCameraPositionMCLow;return vec4(highDifference+lowDifference,1.0);}",fn_rotateXYZ:"#define GLSLIFY 1\n#ifndef _fn_rotateXYZ_\n#define _fn_rotateXYZ_\nmat3 rotateX(float radian){float c=cos(radian);float s=sin(radian);return mat3(1.0,0.0,0.0,0.0,c,-s,0.0,s,c);}mat3 rotateY(float radian){float c=cos(radian);float s=sin(radian);return mat3(c,0.0,s,0.0,1.0,0.0,-s,0.0,c);}mat3 rotateZ(float radian){float c=cos(radian);float s=sin(radian);return mat3(c,-s,0.0,s,c,0.0,0.0,0.0,1.0);}mat3 rotateXYZ(float x,float y,float z){return rotateX(x)*rotateY(y)*rotateZ(z);}\n#endif\n",fn_rotateTexCoord:"#define GLSLIFY 1\nvec2 rotateTexCoord(vec2 texCoord,float angle){mat2 rotationMatrix=mat2(cos(angle),-sin(angle),sin(angle),cos(angle));return rotationMatrix*(texCoord-0.5)+0.5;}",fn_shadow:"#define GLSLIFY 1\n#include <fn_decodeFloat>\nfloat getDepthUseWPAndVP(vec3 worldPosition,mat4 viewProjectionMatrix,sampler2D depthSampler){vec4 clipPos=viewProjectionMatrix*vec4(worldPosition,1.0);clipPos=clipPos/clipPos.w;vec2 texPos=vec2(clipPos.x,clipPos.y)*0.5+0.5;vec4 depthTexture=texture2D(depthSampler,texPos);return unpackDepth(depthTexture);}bool ifShadow(vec3 worldPosition,mat4 viewProjectionMatrix,sampler2D depthSampler){vec4 clipPos=viewProjectionMatrix*vec4(worldPosition,1.0);clipPos=clipPos/clipPos.w;vec2 texPos=vec2(clipPos.x,clipPos.y)*0.5+0.5;vec4 depthTexture=texture2D(depthSampler,texPos);float depthValue=unpackDepth(depthTexture);if(texPos.x<0.0||texPos.y<0.0||texPos.x>1.0||texPos.y>1.0||depthValue==0.0){return false;}else{return depthValue<((clipPos.z*0.5)+0.5)-0.01;}}bool ifShadow(vec4 clipPos,sampler2D depthSampler){vec3 shadowPos=clipPos.xyz/clipPos.w;vec2 texPos=vec2(shadowPos.x,shadowPos.y)*0.5+0.5;vec4 depthTexture=texture2D(depthSampler,texPos);float depthValue=unpackDepth(depthTexture);if(texPos.x<0.0||texPos.y<0.0||texPos.x>1.0||texPos.y>1.0||depthValue==0.0){return false;}else{return depthValue<((shadowPos.z*0.5)+0.5)-0.0015;}}float ShadowPCF(vec4 clipPos,vec2 resolution,sampler2D depthSampler){vec3 shadowPos=clipPos.xyz/clipPos.w;vec2 texPos=vec2(shadowPos.x,shadowPos.y)*0.5+0.5;const int size=2;const float num=25.0;int cout=0;for(int x=-size;x<=size;x++){for(int y=-size;y<=size;y++){vec2 coordinate=texPos+vec2(x,y)/resolution;if(coordinate.x<0.0||coordinate.y<0.0||coordinate.x>1.0||coordinate.y>1.0){continue;}else{vec4 depthTexture=texture2D(depthSampler,coordinate);float depthValue=unpackDepth(depthTexture);if(depthValue<((clipPos.z*0.5)+0.5)-0.025){cout=cout+1;}}}}return 1.0-0.3*(float(cout)/num);}vec4 getColor(vec3 worldPosition,mat4 viewProjectionMatrix,sampler2D depthSampler){vec4 clipPos=viewProjectionMatrix*vec4(worldPosition,1.0);clipPos=clipPos/clipPos.w;vec2 texPos=vec2(clipPos.x,clipPos.y)*0.5+0.5;if(texPos.x<0.0||texPos.y<0.0||texPos.x>1.0&&texPos.y>1.0){return vec4(0.0,0.0,1.0,1.0);}vec4 depthTexture=texture2D(depthSampler,texPos);if(unpackDepth(depthTexture)==0.0000){return vec4(1.0,0.0,0.0,1.0);}else if(unpackDepth(depthTexture)<((clipPos.z*0.5)+0.5)){return vec4(0.0,1.0,0.0,1.0);}else{return vec4(1.0,1.0,1.0,1.0);}}bool ifShadowMin(vec4 fragCoord,vec2 u_Resolution,mat4 u_InverseViewProjectionMatrix,mat4 viewProjectionMatrix2,sampler2D depthSampler,sampler2D shadowDepthSampler){int cout=0;for(float x=-1.0;x<=1.0;x++){for(float y=-1.0;y<=1.0;y++){float x_coord=fragCoord.x+x;float y_coord=fragCoord.y+y;if(x_coord<0.0||y_coord<0.0||x_coord>u_Resolution.x||y_coord>u_Resolution.y){continue;}else{x_coord=x_coord/u_Resolution.x;y_coord=y_coord/u_Resolution.y;float z_coord=unpackDepth(texture2D(depthSampler,vec2(x_coord,y_coord)));vec4 coordinate=vec4(x_coord*2.0-1.0,y_coord*2.0-1.0,z_coord*2.0-1.0,1.0);coordinate=u_InverseViewProjectionMatrix*coordinate;coordinate=coordinate/coordinate.w;if(ifShadow(coordinate.xyz,viewProjectionMatrix2,shadowDepthSampler)){cout=cout+1;}}}}return cout==9;}float ifShadow2(vec4 clipPos,sampler2D depthSampler,float EPSILON,float deltX,float deltY,float scaleShadow){float Factor=0.0;clipPos=clipPos/clipPos.w;float z=(clipPos.z*0.5)+0.5;vec2 texPos=vec2(clipPos.x,clipPos.y)*0.5+0.5;if(texPos.x<0.0||texPos.y<0.0||texPos.x>1.0||texPos.y>1.0){return 1.0;}else{float indexIJ[10];indexIJ[0]=-1.0;indexIJ[1]=0.0;indexIJ[2]=0.0;indexIJ[3]=0.0;indexIJ[4]=1.0;indexIJ[5]=0.0;indexIJ[6]=0.0;indexIJ[7]=-1.0;indexIJ[8]=0.0;indexIJ[9]=1.0;float xOffset=deltX*scaleShadow;float yOffset=deltY*scaleShadow;for(int i=0;i<5;i++){vec2 Offsets=vec2(indexIJ[2*i]*xOffset,indexIJ[2*i+1]*yOffset);vec2 UVC=vec2(texPos+Offsets);vec4 rgbaDepth=texture2D(depthSampler,UVC);float Depth=unpackDepth(rgbaDepth);if(Depth+EPSILON>z){Factor+=1.0;}}Factor=Factor*0.2;return Factor;}}",fn_isBackOfEarth:"#define GLSLIFY 1\nbool isBackOfEarth(vec3 spacePos,vec3 camPos,float tangentAngle){float val=dot(normalize(spacePos),normalize(camPos));float angle=acos(val);return angle>tangentAngle;}",fn_pixelInVideo:"#define GLSLIFY 1\nfloat EPSILON4=0.0001;bool pixelInVideo(mat4 videoMatrix,vec3 cameraPosition,mat4 modelMatrix,vec4 posOrigin,sampler2D videoSampler,float videoAlpha,mat4 clipMatrix,sampler2D maskSample,vec2 textureSize,bool activeClipVideoTexture,vec3 polygonColor){modelMatrix[3]=modelMatrix[3]-vec4(cameraPosition,0.);vec4 VideoProjectPostion=videoMatrix*modelMatrix*posOrigin;vec4 clipProjectPostion=clipMatrix*modelMatrix*posOrigin;VideoProjectPostion=VideoProjectPostion/VideoProjectPostion.w;clipProjectPostion=clipProjectPostion/clipProjectPostion.w;vec2 UV=VideoProjectPostion.xy*0.5+0.5;vec2 clipUV=clipProjectPostion.xy*0.5+0.5;UV.y=1.0-UV.y;bool isGap=false;if(UV.x>=0.0&&UV.x<=1.0&&UV.y>=0.0&&UV.y<=1.0){if(activeClipVideoTexture){vec2 offsetXY=vec2(1./textureSize.x,1./textureSize.y);vec4 c_Color=texture2D(maskSample,clipUV);vec4 c_Color1=texture2D(maskSample,clipUV+vec2(-offsetXY.x,0.0));vec4 c_Color2=texture2D(maskSample,clipUV+vec2(offsetXY.x,0.0));vec4 c_Color3=texture2D(maskSample,clipUV+vec2(0.0,-offsetXY.y));vec4 c_Color4=texture2D(maskSample,clipUV+vec2(0.0,offsetXY.y));vec4 avgZ=(c_Color+c_Color1+c_Color2+c_Color3+c_Color4)/5.0;bool isInPolygon=false;if(abs(avgZ.x-polygonColor.x)<EPSILON4&&abs(avgZ.y-polygonColor.y)<EPSILON4&&abs(avgZ.z-polygonColor.z)<EPSILON4){isInPolygon=true;}else if(abs(c_Color.x-polygonColor.x)<EPSILON4&&abs(c_Color.y-polygonColor.y)<EPSILON4&&abs(c_Color.z-polygonColor.z)<EPSILON4){isInPolygon=true;}if(isInPolygon){vec4 videoColor=texture2D(videoSampler,UV);gl_FragColor=mix(gl_FragColor.rgba,videoColor,videoAlpha);return true;}else{return false;}}else{vec4 videoColor=texture2D(videoSampler,UV);gl_FragColor=mix(gl_FragColor.rgba,videoColor,videoAlpha);return true;}}return false;}",fn_nvidia_fxaa:"#define GLSLIFY 1\n#if (M_FXAA_QUALITY_PRESET == 10)\n#define FXAA_QUALITY_PS 3\n#define FXAA_QUALITY_P0 1.5\n#define FXAA_QUALITY_P1 3.0\n#define FXAA_QUALITY_P2 12.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 11)\n#define FXAA_QUALITY_PS 4\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 3.0\n#define FXAA_QUALITY_P3 12.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 12)\n#define FXAA_QUALITY_PS 5\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 4.0\n#define FXAA_QUALITY_P4 12.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 13)\n#define FXAA_QUALITY_PS 6\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 4.0\n#define FXAA_QUALITY_P5 12.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 14)\n#define FXAA_QUALITY_PS 7\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 4.0\n#define FXAA_QUALITY_P6 12.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 15)\n#define FXAA_QUALITY_PS 8\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 4.0\n#define FXAA_QUALITY_P7 12.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 20)\n#define FXAA_QUALITY_PS 3\n#define FXAA_QUALITY_P0 1.5\n#define FXAA_QUALITY_P1 2.0\n#define FXAA_QUALITY_P2 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 21)\n#define FXAA_QUALITY_PS 4\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 22)\n#define FXAA_QUALITY_PS 5\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 23)\n#define FXAA_QUALITY_PS 6\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 24)\n#define FXAA_QUALITY_PS 7\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 3.0\n#define FXAA_QUALITY_P6 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 25)\n#define FXAA_QUALITY_PS 8\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 4.0\n#define FXAA_QUALITY_P7 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 26)\n#define FXAA_QUALITY_PS 9\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 4.0\n#define FXAA_QUALITY_P8 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 27)\n#define FXAA_QUALITY_PS 10\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 4.0\n#define FXAA_QUALITY_P9 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 28)\n#define FXAA_QUALITY_PS 11\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 4.0\n#define FXAA_QUALITY_P10 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 29)\n#define FXAA_QUALITY_PS 12\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 2.0\n#define FXAA_QUALITY_P10 4.0\n#define FXAA_QUALITY_P11 8.0\n#endif\n#if (M_FXAA_QUALITY_PRESET == 39)\n#define FXAA_QUALITY_PS 12\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.0\n#define FXAA_QUALITY_P2 1.0\n#define FXAA_QUALITY_P3 1.0\n#define FXAA_QUALITY_P4 1.0\n#define FXAA_QUALITY_P5 1.5\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 2.0\n#define FXAA_QUALITY_P10 4.0\n#define FXAA_QUALITY_P11 8.0\n#endif\n#define FxaaBool bool\n#define FxaaFloat float\n#define FxaaFloat2 vec2\n#define FxaaFloat3 vec3\n#define FxaaFloat4 vec4\n#define FxaaHalf float\n#define FxaaHalf2 vec2\n#define FxaaHalf3 vec3\n#define FxaaHalf4 vec4\n#define FxaaInt2 vec2\n#define FxaaTex sampler2D\n#define FxaaSat(x) clamp(x, 0.0, 1.0)\n#define FxaaTexTop(t, p) texture2D(t, p)\n#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r))\nFxaaFloat FxaaLuma(FxaaFloat4 rgba){return rgba.y;}FxaaFloat4 FxaaPixelShader(FxaaFloat2 pos,FxaaTex tex,FxaaFloat2 fxaaQualityRcpFrame,FxaaFloat fxaaQualitySubpix,FxaaFloat fxaaQualityEdgeThreshold,FxaaFloat fxaaQualityEdgeThresholdMin){FxaaFloat2 posM;posM.x=pos.x;posM.y=pos.y;FxaaFloat4 rgbyM=FxaaTexTop(tex,posM);\n#define lumaM rgbyM.y\nFxaaFloat lumaS=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(0,1),fxaaQualityRcpFrame.xy));FxaaFloat lumaE=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(1,0),fxaaQualityRcpFrame.xy));FxaaFloat lumaN=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(0,-1),fxaaQualityRcpFrame.xy));FxaaFloat lumaW=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(-1,0),fxaaQualityRcpFrame.xy));FxaaFloat maxSM=max(lumaS,lumaM);FxaaFloat minSM=min(lumaS,lumaM);FxaaFloat maxESM=max(lumaE,maxSM);FxaaFloat minESM=min(lumaE,minSM);FxaaFloat maxWN=max(lumaN,lumaW);FxaaFloat minWN=min(lumaN,lumaW);FxaaFloat rangeMax=max(maxWN,maxESM);FxaaFloat rangeMin=min(minWN,minESM);FxaaFloat rangeMaxScaled=rangeMax*fxaaQualityEdgeThreshold;FxaaFloat range=rangeMax-rangeMin;FxaaFloat rangeMaxClamped=max(fxaaQualityEdgeThresholdMin,rangeMaxScaled);FxaaBool earlyExit=range<rangeMaxClamped;if(earlyExit)return rgbyM;FxaaFloat lumaNW=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(-1,-1),fxaaQualityRcpFrame.xy));FxaaFloat lumaSE=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(1,1),fxaaQualityRcpFrame.xy));FxaaFloat lumaNE=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(1,-1),fxaaQualityRcpFrame.xy));FxaaFloat lumaSW=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(-1,1),fxaaQualityRcpFrame.xy));FxaaFloat lumaNS=lumaN+lumaS;FxaaFloat lumaWE=lumaW+lumaE;FxaaFloat subpixRcpRange=1.0/range;FxaaFloat subpixNSWE=lumaNS+lumaWE;FxaaFloat edgeHorz1=(-2.0*lumaM)+lumaNS;FxaaFloat edgeVert1=(-2.0*lumaM)+lumaWE;FxaaFloat lumaNESE=lumaNE+lumaSE;FxaaFloat lumaNWNE=lumaNW+lumaNE;FxaaFloat edgeHorz2=(-2.0*lumaE)+lumaNESE;FxaaFloat edgeVert2=(-2.0*lumaN)+lumaNWNE;FxaaFloat lumaNWSW=lumaNW+lumaSW;FxaaFloat lumaSWSE=lumaSW+lumaSE;FxaaFloat edgeHorz4=(abs(edgeHorz1)*2.0)+abs(edgeHorz2);FxaaFloat edgeVert4=(abs(edgeVert1)*2.0)+abs(edgeVert2);FxaaFloat edgeHorz3=(-2.0*lumaW)+lumaNWSW;FxaaFloat edgeVert3=(-2.0*lumaS)+lumaSWSE;FxaaFloat edgeHorz=abs(edgeHorz3)+edgeHorz4;FxaaFloat edgeVert=abs(edgeVert3)+edgeVert4;FxaaFloat subpixNWSWNESE=lumaNWSW+lumaNESE;FxaaFloat lengthSign=fxaaQualityRcpFrame.x;FxaaBool horzSpan=edgeHorz>=edgeVert;FxaaFloat subpixA=subpixNSWE*2.0+subpixNWSWNESE;if(!horzSpan)lumaN=lumaW;if(!horzSpan)lumaS=lumaE;if(horzSpan)lengthSign=fxaaQualityRcpFrame.y;FxaaFloat subpixB=(subpixA*(1.0/12.0))-lumaM;FxaaFloat gradientN=lumaN-lumaM;FxaaFloat gradientS=lumaS-lumaM;FxaaFloat lumaNN=lumaN+lumaM;FxaaFloat lumaSS=lumaS+lumaM;FxaaBool pairN=abs(gradientN)>=abs(gradientS);FxaaFloat gradient=max(abs(gradientN),abs(gradientS));if(pairN)lengthSign=-lengthSign;FxaaFloat subpixC=FxaaSat(abs(subpixB)*subpixRcpRange);FxaaFloat2 posB;posB.x=posM.x;posB.y=posM.y;FxaaFloat2 offNP;offNP.x=(!horzSpan)? 0.0 : fxaaQualityRcpFrame.x;offNP.y=(horzSpan)? 0.0 : fxaaQualityRcpFrame.y;if(!horzSpan)posB.x+=lengthSign*0.5;if(horzSpan)posB.y+=lengthSign*0.5;FxaaFloat2 posN;posN.x=posB.x-offNP.x*FXAA_QUALITY_P0;posN.y=posB.y-offNP.y*FXAA_QUALITY_P0;FxaaFloat2 posP;posP.x=posB.x+offNP.x*FXAA_QUALITY_P0;posP.y=posB.y+offNP.y*FXAA_QUALITY_P0;FxaaFloat subpixD=((-2.0)*subpixC)+3.0;FxaaFloat lumaEndN=FxaaLuma(FxaaTexTop(tex,posN));FxaaFloat subpixE=subpixC*subpixC;FxaaFloat lumaEndP=FxaaLuma(FxaaTexTop(tex,posP));if(!pairN)lumaNN=lumaSS;FxaaFloat gradientScaled=gradient*1.0/4.0;FxaaFloat lumaMM=lumaM-lumaNN*0.5;FxaaFloat subpixF=subpixD*subpixE;FxaaBool lumaMLTZero=lumaMM<0.0;lumaEndN-=lumaNN*0.5;lumaEndP-=lumaNN*0.5;FxaaBool doneN=abs(lumaEndN)>=gradientScaled;FxaaBool doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P1;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P1;FxaaBool doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P1;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P1;if(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P2;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P2;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P2;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P2;\n#if (FXAA_QUALITY_PS > 3)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P3;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P3;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P3;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P3;\n#if (FXAA_QUALITY_PS > 4)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P4;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P4;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P4;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P4;\n#if (FXAA_QUALITY_PS > 5)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P5;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P5;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P5;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P5;\n#if (FXAA_QUALITY_PS > 6)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P6;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P6;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P6;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P6;\n#if (FXAA_QUALITY_PS > 7)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P7;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P7;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P7;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P7;\n#if (FXAA_QUALITY_PS > 8)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P8;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P8;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P8;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P8;\n#if (FXAA_QUALITY_PS > 9)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P9;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P9;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P9;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P9;\n#if (FXAA_QUALITY_PS > 10)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P10;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P10;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P10;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P10;\n#if (FXAA_QUALITY_PS > 11)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P11;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P11;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P11;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P11;\n#if (FXAA_QUALITY_PS > 12)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P12;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P12;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P12;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P12;}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}FxaaFloat dstN=posM.x-posN.x;FxaaFloat dstP=posP.x-posM.x;if(!horzSpan)dstN=posM.y-posN.y;if(!horzSpan)dstP=posP.y-posM.y;FxaaBool goodSpanN=(lumaEndN<0.0)!=lumaMLTZero;FxaaFloat spanLength=(dstP+dstN);FxaaBool goodSpanP=(lumaEndP<0.0)!=lumaMLTZero;FxaaFloat spanLengthRcp=1.0/spanLength;FxaaBool directionN=dstN<dstP;FxaaFloat dst=min(dstN,dstP);FxaaBool goodSpan=directionN ? goodSpanN : goodSpanP;FxaaFloat subpixG=subpixF*subpixF;FxaaFloat pixelOffset=(dst*(-spanLengthRcp))+0.5;FxaaFloat subpixH=subpixG*fxaaQualitySubpix;FxaaFloat pixelOffsetGood=goodSpan ? pixelOffset : 0.0;FxaaFloat pixelOffsetSubpix=max(pixelOffsetGood,subpixH);if(!horzSpan)posM.x+=pixelOffsetSubpix*lengthSign;if(horzSpan)posM.y+=pixelOffsetSubpix*lengthSign;return FxaaFloat4(FxaaTexTop(tex,posM).xyz,lumaM);}",fn_getBlinnPhongColor:"#define GLSLIFY 1\nvec4 getBlinnPhongColor(vec3 normal,vec3 world_pos,vec3 lightPos,vec3 lightColor,vec3 camPos,vec3 Ka,vec3 Kd,vec3 Ks,vec4 texColor,float shininess){vec3 N=normalize(normal);vec3 L=normalize(lightPos);vec3 V=normalize(camPos-world_pos);vec3 H=normalize(L+V);vec3 ambient=Ka*lightColor;float dv=dot(N,L);float diffuseLight=max(dot(N,L),0.);vec3 diffuse=Kd*lightColor*diffuseLight;if(dv<0.){ambient*=(1.+dv*4.0);diffuse*=4.0;}float specularLight=pow(max(dot(H,N),0.),32.*shininess);if(diffuseLight<=0.)specularLight=0.;vec3 specular=Ks*lightColor*specularLight;vec4 color=vec4(1.0);color.xyz=texColor.xyz*(ambient+diffuse+specular);color.w=texColor.a;return color;}",fn_phong:"#define GLSLIFY 1\n#include <u_LIGHT>\n#include <v_LIGHT>\n#ifdef M_enableLight\n#ifdef M_PointLight\n#ifdef M_ShadowEnable\nfloat getDepthFromDiffPointInfo(int pointNum,vec3 direction){\n#if M_PointLightCount > 5\nif(pointNum==0){return textureCube(u_PointLightDepthCubeTexture0,direction).r;}else if(pointNum==1){return textureCube(u_PointLightDepthCubeTexture1,direction).r;}else if(pointNum==2){return textureCube(u_PointLightDepthCubeTexture2,direction).r;}else if(pointNum==3){return textureCube(u_PointLightDepthCubeTexture3,direction).r;}else if(pointNum==4){return textureCube(u_PointLightDepthCubeTexture4,direction).r;}else if(pointNum==5){return textureCube(u_PointLightDepthCubeTexture5,direction).r;}\n#endif\n#if M_PointLightCount > 4\nif(pointNum==0){return textureCube(u_PointLightDepthCubeTexture0,direction).r;}else if(pointNum==1){return textureCube(u_PointLightDepthCubeTexture1,direction).r;}else if(pointNum==2){return textureCube(u_PointLightDepthCubeTexture2,direction).r;}else if(pointNum==3){return textureCube(u_PointLightDepthCubeTexture3,direction).r;}else if(pointNum==4){return textureCube(u_PointLightDepthCubeTexture4,direction).r;}\n#endif\n#if M_PointLightCount > 3\nif(pointNum==0){return textureCube(u_PointLightDepthCubeTexture0,direction).r;}else if(pointNum==1){return textureCube(u_PointLightDepthCubeTexture1,direction).r;}else if(pointNum==2){return textureCube(u_PointLightDepthCubeTexture2,direction).r;}else if(pointNum==3){return textureCube(u_PointLightDepthCubeTexture3,direction).r;}\n#endif\n#if M_PointLightCount > 2\nif(pointNum==0){return textureCube(u_PointLightDepthCubeTexture0,direction).r;}else if(pointNum==1){return textureCube(u_PointLightDepthCubeTexture1,direction).r;}else if(pointNum==2){return textureCube(u_PointLightDepthCubeTexture2,direction).r;}\n#endif\n#if M_PointLightCount > 1\nif(pointNum==0){return textureCube(u_PointLightDepthCubeTexture0,direction).r;}else if(pointNum==1){return textureCube(u_PointLightDepthCubeTexture1,direction).r;}\n#endif\nreturn textureCube(u_PointLightDepthCubeTexture0,direction).r;}\n#endif\n#endif\n#endif\nvec3 phong(vec3 pos,vec3 tnormal,LightMaterial lightMaterial,vec3 lightDirection,vec3 cameraPosition){vec3 ambient=lightMaterial.Ambient;vec3 norm=normalize(tnormal);vec3 lightDir=normalize(lightDirection);float diff=max(dot(norm,lightDir),0.0);vec3 diffuse=lightMaterial.Diffuse*diff;vec3 viewDir=normalize(cameraPosition-pos);vec3 reflectDir=reflect(-lightDir,norm);float spec=pow(max(dot(viewDir,reflectDir),0.0),lightMaterial.Shininess);vec3 specular=lightMaterial.SpecularColor*spec;vec3 fColor=ambient+diffuse+specular;return fColor;}vec3 phong(float reflectivity,vec3 normal,vec3 sunLightGlobal,vec3 worldPosition,float shininess){vec3 ambient=vec3(0.0,0.0,0.0);vec3 diffuse=vec3(0.0,0.0,0.0);vec3 specular=vec3(0.0,0.0,.0);\n#ifdef M_enableLight\n#ifdef M_AmbientLight\nfor(int i=0;i<int(M_AmbientLightCount);++i){vec3 ambientColor=vec3(u_AmbientLightsColor[i*3],u_AmbientLightsColor[i*3+1],u_AmbientLightsColor[i*3+2]);float ambientIntensity=u_AmbientLightsIntensity[i];ambient=ambient+ambientIntensity*reflectivity*ambientColor;}\n#endif\n#ifdef M_SunLight\nif(u_SunLightDirectionLocal.z>0.0){diffuse=diffuse+reflectivity*max(dot(normal,sunLightGlobal),0.)*u_SunLightColor*u_SunLightIntensity;}\n#endif\n#ifdef M_SunLight\nvec3 H=normalize(sunLightGlobal+normalize(u_CameraPosition-worldPosition));specular=specular+reflectivity*pow(max(dot(H,normal),0.),shininess)*u_SunLightColor*u_SunLightIntensity;\n#endif\n#ifdef M_DirectionalLight\nfor(int i=0;i<int(M_DirectionalLightCount);++i){vec3 directLightColor=vec3(u_DirectionalLightColor[i*3],u_DirectionalLightColor[i*3+1],u_DirectionalLightColor[i*3+2]);float directLightIntensity=u_DirectionalLightIntensity[i];vec3 directLightDir=vec3(u_DirectionalLightDir[i*3],u_DirectionalLightDir[i*3+1],u_DirectionalLightDir[i*3+2]);diffuse=diffuse+reflectivity*max(dot(normal,directLightDir),0.)*directLightColor*directLightIntensity;vec3 H=normalize(directLightDir+normalize(u_CameraPosition-worldPosition));specular=specular+reflectivity*pow(max(dot(H,normal),0.),shininess)*directLightColor*directLightIntensity;}\n#endif\n#ifdef M_PointLight\nfor(int i=0;i<int(M_PointLightCount);i++){float pointShadow=1.0;vec3 pointLightPosition=vec3(u_PointLightPosition[i*3],u_PointLightPosition[i*3+1],u_PointLightPosition[i*3+2]);float dis=distance(pointLightPosition,worldPosition);float pointLightIntensity=u_PointLightIntensity[i];float pointFragIntensity=pointLightIntensity*1000.0/(dis*dis);if(pointFragIntensity<0.1){continue;}\n#ifdef M_ShadowEnable\nif(i>5){pointShadow=1.0;}else{\n#ifdef M_ShadowMapping\nfloat depth=getDepthFromDiffPointInfo(i,normalize(v_PointDirection[i]));vec3 light=vec3(u_PointLightPosition[i*3],u_PointLightPosition[i*3+1],u_PointLightPosition[i*3+2]);if((dis/u_PointLightFar[i])-u_PointLightEpsilon[i]>depth){pointShadow=0.3;}\n#else\n#ifdef M_PCF\nfloat shadow=0.0;float diskRadius=u_DiskRadius[i];vec3 sampleOffsetDirections[20];sampleOffsetDirections[0]=vec3(1,1,1);sampleOffsetDirections[1]=vec3(1,-1,1);sampleOffsetDirections[2]=vec3(-1,-1,1);sampleOffsetDirections[3]=vec3(-1,1,1);sampleOffsetDirections[4]=vec3(1,1,-1);sampleOffsetDirections[5]=vec3(1,-1,-1);sampleOffsetDirections[6]=vec3(-1,-1,-1);sampleOffsetDirections[7]=vec3(-1,1,-1);sampleOffsetDirections[8]=vec3(1,1,0);sampleOffsetDirections[9]=vec3(1,-1,0);sampleOffsetDirections[10]=vec3(-1,-1,0);sampleOffsetDirections[11]=vec3(-1,1,0);sampleOffsetDirections[12]=vec3(1,0,1);sampleOffsetDirections[13]=vec3(-1,0,1);sampleOffsetDirections[14]=vec3(1,0,-1);sampleOffsetDirections[15]=vec3(-1,0,-1);sampleOffsetDirections[16]=vec3(0,1,1);sampleOffsetDirections[17]=vec3(0,-1,1);sampleOffsetDirections[18]=vec3(0,-1,-1);sampleOffsetDirections[19]=vec3(0,1,-1);for(int j=0;j<20;j++){vec3 pointDirection=normalize(v_PointDirection[i])+sampleOffsetDirections[j]*diskRadius;float depth=getDepthFromDiffPointInfo(i,pointDirection);vec3 light=vec3(u_PointLightPosition[i*3],u_PointLightPosition[i*3+1],u_PointLightPosition[i*3+2]);if((dis/u_PointLightFar[i])-u_PointLightEpsilon[i]>depth){shadow=shadow+1.0;}}pointShadow=1.0-0.7*shadow/20.0;\n#endif\n#endif\n}\n#endif\nvec3 pointLightColor=vec3(u_PointLightColor[i*3],u_PointLightColor[i*3+1],u_PointLightColor[i*3+2]);vec3 pointLightDir=normalize(pointLightPosition-worldPosition);diffuse=diffuse+reflectivity*max(dot(normal,pointLightDir),0.)*pointLightColor*pointFragIntensity*pointShadow;vec3 H=normalize(pointLightDir+normalize(u_CameraPosition-worldPosition));specular=specular+reflectivity*pow(max(dot(H,normal),0.),shininess)*pointLightColor*pointFragIntensity*pointShadow;}\n#endif\n#endif\nreturn ambient+diffuse+specular;}vec3 phong(float reflectivity,vec3 normal,vec3 sunLightGlobal,vec3 worldPosition,float shininess,float roughness){vec3 ambient=vec3(0.0,0.0,0.0);vec3 diffuse=vec3(0.0,0.0,0.0);vec3 specular=vec3(0.0,0.0,.0);\n#ifdef M_enableLight\n#ifdef M_AmbientLight\nfor(int i=0;i<int(M_AmbientLightCount);++i){vec3 ambientColor=vec3(u_AmbientLightsColor[i*3],u_AmbientLightsColor[i*3+1],u_AmbientLightsColor[i*3+2]);float ambientIntensity=u_AmbientLightsIntensity[i];ambient=ambient+ambientIntensity*reflectivity*ambientColor;}\n#endif\n#ifdef M_SunLight\nif(u_SunLightDirectionLocal.z>0.0){diffuse=diffuse+reflectivity*max(dot(normal,sunLightGlobal),0.)*u_SunLightColor*u_SunLightIntensity;diffuse=(1.0-roughness)*diffuse;}\n#endif\n#ifdef M_SunLight\nvec3 H=normalize(sunLightGlobal+normalize(u_CameraPosition-worldPosition));specular=specular+reflectivity*pow(max(dot(H,normal),0.),shininess)*u_SunLightColor*u_SunLightIntensity;specular=0.16*reflectivity*reflectivity*roughness+specular*(1.0-roughness);\n#endif\n#ifdef M_DirectionalLight\nfor(int i=0;i<int(M_DirectionalLightCount);++i){vec3 directLightColor=vec3(u_DirectionalLightColor[i*3],u_DirectionalLightColor[i*3+1],u_DirectionalLightColor[i*3+2]);float directLightIntensity=u_DirectionalLightIntensity[i];vec3 directLightDir=vec3(u_DirectionalLightDir[i*3],u_DirectionalLightDir[i*3+1],u_DirectionalLightDir[i*3+2]);diffuse=diffuse+reflectivity*max(dot(normal,directLightDir),0.)*directLightColor*directLightIntensity;diffuse=(1.0-roughness)*diffuse;vec3 H=normalize(directLightDir+normalize(u_CameraPosition-worldPosition));specular=specular+reflectivity*pow(max(dot(H,normal),0.),shininess)*directLightColor*directLightIntensity;specular=0.16*reflectivity*reflectivity*roughness+specular*(1.0-roughness);}\n#endif\n#ifdef M_PointLight\nfor(int i=0;i<int(M_PointLightCount);i++){float pointShadow=1.0;vec3 pointLightPosition=vec3(u_PointLightPosition[i*3],u_PointLightPosition[i*3+1],u_PointLightPosition[i*3+2]);float dis=distance(pointLightPosition,worldPosition);float pointLightIntensity=u_PointLightIntensity[i];float pointFragIntensity=pointLightIntensity*1000.0/(dis*dis);if(pointFragIntensity<0.1){continue;}\n#ifdef M_ShadowEnable\nif(i>5){pointShadow=1.0;}else{\n#ifdef M_ShadowMapping\nfloat depth=getDepthFromDiffPointInfo(i,normalize(v_PointDirection[i]));vec3 light=vec3(u_PointLightPosition[i*3],u_PointLightPosition[i*3+1],u_PointLightPosition[i*3+2]);if((dis/u_PointLightFar[i])-u_PointLightEpsilon[i]>depth){pointShadow=0.3;}\n#else\n#ifdef M_PCF\nfloat shadow=0.0;float diskRadius=u_DiskRadius[i];vec3 sampleOffsetDirections[20];sampleOffsetDirections[0]=vec3(1,1,1);sampleOffsetDirections[1]=vec3(1,-1,1);sampleOffsetDirections[2]=vec3(-1,-1,1);sampleOffsetDirections[3]=vec3(-1,1,1);sampleOffsetDirections[4]=vec3(1,1,-1);sampleOffsetDirections[5]=vec3(1,-1,-1);sampleOffsetDirections[6]=vec3(-1,-1,-1);sampleOffsetDirections[7]=vec3(-1,1,-1);sampleOffsetDirections[8]=vec3(1,1,0);sampleOffsetDirections[9]=vec3(1,-1,0);sampleOffsetDirections[10]=vec3(-1,-1,0);sampleOffsetDirections[11]=vec3(-1,1,0);sampleOffsetDirections[12]=vec3(1,0,1);sampleOffsetDirections[13]=vec3(-1,0,1);sampleOffsetDirections[14]=vec3(1,0,-1);sampleOffsetDirections[15]=vec3(-1,0,-1);sampleOffsetDirections[16]=vec3(0,1,1);sampleOffsetDirections[17]=vec3(0,-1,1);sampleOffsetDirections[18]=vec3(0,-1,-1);sampleOffsetDirections[19]=vec3(0,1,-1);for(int j=0;j<20;j++){vec3 pointDirection=normalize(v_PointDirection[i])+sampleOffsetDirections[j]*diskRadius;float depth=getDepthFromDiffPointInfo(i,pointDirection);vec3 light=vec3(u_PointLightPosition[i*3],u_PointLightPosition[i*3+1],u_PointLightPosition[i*3+2]);if((dis/u_PointLightFar[i])-u_PointLightEpsilon[i]>depth){shadow=shadow+1.0;}}pointShadow=1.0-0.7*shadow/20.0;\n#endif\n#endif\n}\n#endif\nvec3 pointLightColor=vec3(u_PointLightColor[i*3],u_PointLightColor[i*3+1],u_PointLightColor[i*3+2]);vec3 pointLightDir=normalize(pointLightPosition-worldPosition);diffuse=diffuse+reflectivity*max(dot(normal,pointLightDir),0.)*pointLightColor*pointFragIntensity*pointShadow;diffuse=(1.0-roughness)*diffuse;vec3 H=normalize(pointLightDir+normalize(u_CameraPosition-worldPosition));specular=specular+reflectivity*pow(max(dot(H,normal),0.),shininess)*pointLightColor*pointFragIntensity*pointShadow;specular=0.16*reflectivity*reflectivity*roughness+specular*(1.0-roughness);}\n#endif\n#endif\nreturn ambient+diffuse+specular;}vec3 ambient(){vec3 ambient=vec3(0.0,0.0,0.0);\n#ifdef M_enableLight\n#ifdef M_AmbientLight\nfor(int i=0;i<int(M_AmbientLightCount);++i){vec3 ambientColor=vec3(u_AmbientLightsColor[i*3],u_AmbientLightsColor[i*3+1],u_AmbientLightsColor[i*3+2]);float ambientIntensity=u_AmbientLightsIntensity[i];ambient=ambient+ambientIntensity*1.0*ambientColor;}\n#endif\n#endif\nreturn ambient;}",fn_reverseLogDepth:"#define GLSLIFY 1\n#ifndef _REVERSE_LOG_DEPTH_\n#define _REVERSE_LOG_DEPTH_\nfloat reverseLogDepth(float logZ,vec2 currentFrustum){float near=currentFrustum.x;float far=currentFrustum.y;float farDepthFromNearPlusOne=currentFrustum.y-currentFrustum.x+1.0;float log2FarDepthFromNearPlusOne=log2(farDepthFromNearPlusOne);float log2Depth=logZ*log2FarDepthFromNearPlusOne;float depthFromNear=pow(2.0,log2Depth)-1.0;return far*(1.0-near/(depthFromNear+near))/(far-near);}float reverseLogDepth(float logZ){\n#ifdef M_LOG_DEPTH\nfloat near=czm_currentFrustum.x;float far=czm_currentFrustum.y;float log2Depth=logZ*czm_log2FarDepthFromNearPlusOne;float depthFromNear=pow(2.0,log2Depth)-1.0;return far*(1.0-near/(depthFromNear+near))/(far-near);\n#endif\nreturn logZ;}\n#endif\n",fn_RGBToHSB:"#define GLSLIFY 1\nconst vec4 K_RGB2HSB=vec4(0.0,-1.0/3.0,2.0/3.0,-1.0);vec3 RGBToHSB(vec3 rgb){vec4 p=mix(vec4(rgb.bg,K_RGB2HSB.wz),vec4(rgb.gb,K_RGB2HSB.xy),step(rgb.b,rgb.g));vec4 q=mix(vec4(p.xyw,rgb.r),vec4(rgb.r,p.yzx),step(p.x,rgb.r));float d=q.x-min(q.w,q.y);return vec3(abs(q.z+(q.w-q.y)/(6.0*d+czm_epsilon7)),d/(q.x+czm_epsilon7),q.x);}",fn_RGBToHSL:"#define GLSLIFY 1\nvec3 RGBtoHCV(vec3 rgb){vec4 p=(rgb.g<rgb.b)? vec4(rgb.bg,-1.0,2.0/3.0): vec4(rgb.gb,0.0,-1.0/3.0);vec4 q=(rgb.r<p.x)? vec4(p.xyw,rgb.r): vec4(rgb.r,p.yzx);float c=q.x-min(q.w,q.y);float h=abs((q.w-q.y)/(6.0*c+czm_epsilon7)+q.z);return vec3(h,c,q.x);}vec3 RGBToHSL(vec3 rgb){vec3 hcv=RGBtoHCV(rgb);float l=hcv.z-hcv.y*0.5;float s=hcv.y/(1.0-abs(l*2.0-1.0)+czm_epsilon7);return vec3(hcv.x,s,l);}",fn_RGBToXYZ:"#define GLSLIFY 1\nvec3 RGBToXYZ(vec3 rgb){const mat3 RGB2XYZ=mat3(0.4124,0.2126,0.0193,0.3576,0.7152,0.1192,0.1805,0.0722,0.9505);vec3 xyz=RGB2XYZ*rgb;vec3 Yxy;Yxy.r=xyz.g;float temp=dot(vec3(1.0),xyz);Yxy.gb=xyz.rg/temp;return Yxy;}",fn_vertexLogDepth:"#define GLSLIFY 1\nvec4 updatePositionDepth(vec4 coords){coords.z=clamp(coords.z/coords.w,-1.0,1.0)*coords.w;return coords;}float vertexLogDepth(vec2 currentFrustum){gl_Position=updatePositionDepth(gl_Position);float depthFromNearPlusOne=(gl_Position.w-currentFrustum.x)+1.0;return depthFromNearPlusOne;}",fn_webMercatorInTileCoordToLngLat:"#define GLSLIFY 1\n#ifndef _fn_webMercatorInTileCoordToLngLat_\n#define _fn_webMercatorInTileCoordToLngLat_\nvec2 webMercatorInTileCoordToLngLatDegree(vec2 inTileCoord,vec3 tileCoordXYZ){vec2 coord=vec2(inTileCoord.x+tileCoordXYZ.x,inTileCoord.y+tileCoordXYZ.y);float worldSize=pow(2.0,tileCoordXYZ.z);float lng=(coord.x*360.0)/worldSize-180.0;float y2=180.-(coord.y*360.)/worldSize;float lat=(360./PI)*atan(exp((y2*PI)/180.0))-90.0;return vec2(lng,lat);}vec2 webMercatorInTileCoordToLngLatRadian(vec2 inTileCoord,vec3 tileCoordXYZ){vec2 coord=vec2(inTileCoord.x+tileCoordXYZ.x,inTileCoord.y+tileCoordXYZ.y);float worldSize=pow(2.0,tileCoordXYZ.z);float lng=(coord.x*360.0)/worldSize-180.0;float y2=180.-(coord.y*360.)/worldSize;float lat=(360./PI)*atan(exp((y2*PI)/180.0))-90.0;return vec2(lng*PI/180.0,lat*PI/180.0);}\n#endif\n",fn_writeLogDepth:"#define GLSLIFY 1\nvoid writeLogDepth(float depth,vec2 currentFrustum){float farDepthFromNearPlusOne=currentFrustum.y-currentFrustum.x+1.0;float log2FarDepthFromNearPlusOne=log2(farDepthFromNearPlusOne);float oneOverLog2FarDepthFromNearPlusOne=1.0/log2FarDepthFromNearPlusOne;if(depth<=0.9999999||depth>farDepthFromNearPlusOne){discard;}\n#ifdef M_DEPTH_EXT\ngl_FragDepthEXT=log2(depth)*oneOverLog2FarDepthFromNearPlusOne;\n#endif\n}",fn_atan2:"#define GLSLIFY 1\n#ifndef _fn_atan2_\n#define _fn_atan2_\nfloat fn_atan2(float dx,float dy){float ax=abs(dx),ay=abs(dy);float a=min(ax,ay)/(max(ax,ay)+0.00000001);float s=a*a;float r=((-0.0464964749*s+0.15931422)*s-0.327622764)*s*a+a;if(ay>ax)r=1.57079637-r;if(dx<0.)r=3.14159274-r;if(dy<0.)r=-r;return r;}\n#endif\n",fn_decodeFloat:"#define GLSLIFY 1\n#ifndef _DECODE_FLOAT_\n#define _DECODE_FLOAT_\nfloat unpackDepth(const in vec4 rgbaDepth){const vec4 bitShift=vec4(1.0,1./255.0,1./65025.0,1./16581375.0);float depth=dot(rgbaDepth,bitShift);return depth;}\n#endif\n",fn_encodeFloat:"#define GLSLIFY 1\n#ifndef _ENCODE_FLOAT_\n#define _ENCODE_FLOAT_\nvec4 encodeFloat(float depth){vec4 enc=vec4(1.0,255.0,65025.0,16581375.0)*depth;enc=fract(enc);enc-=enc.yzww*vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);return enc;}\n#endif\n",fn_transformCartesianToGeographic:"#define GLSLIFY 1\n#ifndef _fn_transformCartesianToGeographic_\n#define _fn_transformCartesianToGeographic_\nconst float a=6378137.0;const float b=6356752.3142;const float f=(a-b)/a;const float e_sq=2.0*f-f*f;vec3 transformCartesianToGeographicDegree(vec3 cartesianCoords){float x=cartesianCoords.x;float y=cartesianCoords.y;float z=cartesianCoords.z;float lon=atan(y,x);float p=sqrt(x*x+y*y);float lat=atan(z/(p*(1.0-e_sq)));float sinLat=sin(lat);float N=a/sqrt(1.0-e_sq*sinLat*sinLat);float alt=(p/cos(lat))-N;return vec3(degrees(lon),degrees(lat),alt);}vec3 transformCartesianToGeographicRadian(vec3 cartesianCoords){float x=cartesianCoords.x;float y=cartesianCoords.y;float z=cartesianCoords.z;float lon=atan(y,x);float p=sqrt(x*x+y*y);float lat=atan(z/(p*(1.0-e_sq)));float sinLat=sin(lat);float N=a/sqrt(1.0-e_sq*sinLat*sinLat);float alt=(p/cos(lat))-N;return vec3(lon,lat,alt);}\n#endif\n",fn_transformGeographicToCartesian:"#define GLSLIFY 1\n#ifndef _fn_transformGeographicToCartesian_\n#define _fn_transformGeographicToCartesian_\nvec3 transformGeographicInDegreeToCartesian(vec3 cartographic){float longitude=cartographic.x;float latitude=cartographic.y;float height=cartographic.z;const float semiMajorAxis=6378137.0;const float flattening=1.0/298.257223563;float cosLatitude=cos(radians(latitude));float sinLatitude=sin(radians(latitude));float cosLongitude=cos(radians(longitude));float sinLongitude=sin(radians(longitude));float C=1.0/sqrt(cosLatitude*cosLatitude+(1.0-flattening)*(1.0-flattening)*sinLatitude*sinLatitude);float S=C*(1.0-flattening)*(1.0-flattening);float x=(semiMajorAxis*C+height)*cosLatitude*cosLongitude;float y=(semiMajorAxis*C+height)*cosLatitude*sinLongitude;float z=(semiMajorAxis*S+height)*sinLatitude;return vec3(x,y,z);}vec3 transformGeographicInRadianToCartesian(vec3 cartographic){float longitude=cartographic.x;float latitude=cartographic.y;float height=cartographic.z;const float semiMajorAxis=6378137.0;const float flattening=1.0/298.257223563;float cosLatitude=cos(latitude);float sinLatitude=sin(latitude);float cosLongitude=cos(longitude);float sinLongitude=sin(longitude);float C=1.0/sqrt(cosLatitude*cosLatitude+(1.0-flattening)*(1.0-flattening)*sinLatitude*sinLatitude);float S=C*(1.0-flattening)*(1.0-flattening);float x=(semiMajorAxis*C+height)*cosLatitude*cosLongitude;float y=(semiMajorAxis*C+height)*cosLatitude*sinLongitude;float z=(semiMajorAxis*S+height)*sinLatitude;return vec3(x,y,z);}\n#endif\n",fn_lngLatProjectionInTileCoordToLngLat:"#define GLSLIFY 1\n#ifndef _fn_lngLatProjectionInTileCoordToLngLat_\n#define _fn_lngLatProjectionInTileCoordToLngLat_\nvec2 lngLatProjectionInTileCoordToLngLatDegree(vec2 inTileCoord,vec3 tileCoordXYZ){vec2 coord=vec2(inTileCoord.x+tileCoordXYZ.x,inTileCoord.y+tileCoordXYZ.y);float worldSize=pow(2.0,tileCoordXYZ.z);float lng=(coord.x*360.0)/worldSize-180.0;float lat=90.0-(coord.y/(0.5*worldSize))*180.0;return vec2(lng,lat);}vec2 lngLatProjectionInTileCoordToLngLatRadian(vec2 inTileCoord,vec3 tileCoordXYZ){vec2 coord=vec2(inTileCoord.x+tileCoordXYZ.x,inTileCoord.y+tileCoordXYZ.y);float worldSize=pow(2.0,tileCoordXYZ.z);float lng=(coord.x*360.0)/worldSize-180.0;float lat=90.0-(coord.y/(0.5*worldSize))*180.0;return vec2(lng*PI/180.0,lat*PI/180.0);}\n#endif\n",fn_lngLatToWebMercatorInTileCoord:"#define GLSLIFY 1\n#ifndef _fn_lngLatToWebMercatorInTileCoord_\n#define _fn_lngLatToWebMercatorInTileCoord_\nvec2 lngLatDegreeToWebMercatorTileCoord(vec2 lngLat,vec3 tileCoordXYZ){float worldSize=pow(2.0,tileCoordXYZ[2]);float x=(180.0+lngLat.x)*worldSize/360.0;float y=180.0/PI*log(tan(PI/4.0+lngLat.y*PI/360.0));y=(180.-y)*worldSize/360.0;return vec2(x-tileCoordXYZ[0],y-tileCoordXYZ[1]);}vec2 lngLatRadianToWebMercatorTileCoord(vec2 lngLat,vec3 tileCoordXYZ){float worldSize=pow(2.0,tileCoordXYZ[2]);float x=(180.0+lngLat.x/PI*180.0)*worldSize/360.0;float y=180.0/PI*log(tan(PI/4.0+lngLat.y));y=(180.-y)*worldSize/360.0;return vec2(x-tileCoordXYZ[0],y-tileCoordXYZ[1]);}\n#endif\n",fn_lngLatToLngLatProjectionInTileCoord:"#define GLSLIFY 1\n#ifndef _fn_lngLatToLngLatProjectionInTileCoord_\n#define _fn_lngLatToLngLatProjectionInTileCoord_\nvec2 lngLatInDegreeToLngLatProjectionInTileCoord(vec2 lngLat,vec3 tileCoordXYZ){float worldSize=pow(2.0,tileCoordXYZ[2]);float x=(180.0+lngLat.x)*worldSize/360.0;float y=(90.0-lngLat.y)/180.0*worldSize*0.5;return vec2(x-tileCoordXYZ[0],y-tileCoordXYZ[1]);}vec2 lngLatInRadianToLngLatProjectionInTileCoord(vec2 lngLat,vec3 tileCoordXYZ){float worldSize=pow(2.0,tileCoordXYZ[2]);float x=(180.0+lngLat.x*180.0/PI)*worldSize/360.0;float y=(90.0-lngLat.y*180.0/PI)/180.0*worldSize*0.5;return vec2(x-tileCoordXYZ[0],y-tileCoordXYZ[1]);}\n#endif\n",fn_luminance:"#define GLSLIFY 1\nfloat luminance(vec3 rgb){const vec3 W=vec3(0.2125,0.7154,0.0721);return dot(rgb,W);}",fn_createRotateMat4:"#define GLSLIFY 1\nmat4 createRotateMat4(float rad,vec3 axis){float x=axis[0],y=axis[1],z=axis[2];float len=sqrt(x*x+y*y+z*z);float s,c,t;float a00,a01,a02,a03;float a10,a11,a12,a13;float a20,a21,a22,a23;float b00,b01,b02;float b10,b11,b12;float b20,b21,b22;if(len<0.00000001){return mat4(0.);};len=1./len;x*=len;y*=len;z*=len;s=sin(rad);c=cos(rad);t=1.-c;a00=1.;a01=0.;a02=0.;a03=0.;a10=0.;a11=1.;a12=0.;a13=0.;a20=0.;a21=0.;a22=1.;a23=0.;b00=x*x*t+c;b01=y*x*t+z*s;b02=z*x*t-y*s;b10=x*y*t-z*s;b11=y*y*t+c;b12=z*y*t+x*s;b20=x*z*t+y*s;b21=y*z*t-x*s;b22=z*z*t+c;mat4 outd=mat4(0.);outd[0][0]=a00*b00+a10*b01+a20*b02;outd[0][1]=a01*b00+a11*b01+a21*b02;outd[0][2]=a02*b00+a12*b01+a22*b02;outd[0][3]=a03*b00+a13*b01+a23*b02;outd[1][0]=a00*b10+a10*b11+a20*b12;outd[1][1]=a01*b10+a11*b11+a21*b12;outd[1][2]=a02*b10+a12*b11+a22*b12;outd[1][3]=a03*b10+a13*b11+a23*b12;outd[2][0]=a00*b20+a10*b21+a20*b22;outd[2][1]=a01*b20+a11*b21+a21*b22;outd[2][2]=a02*b20+a12*b21+a22*b22;outd[2][3]=a03*b20+a13*b21+a23*b22;outd[3][0]=0.;outd[3][1]=0.;outd[3][2]=0.;outd[3][3]=1.;return outd;}",fn_acesTonemapping:"#define GLSLIFY 1\n#ifndef _AES_TONE_MAPPTING_\n#define _AES_TONE_MAPPTING_\nvec3 acesTonemapping(vec3 color){float g=0.985;float a=0.065;float b=0.0001;float c=0.433;float d=0.238;color=(color*(color+a)-b)/(color*(g*color+c)+d);color=clamp(color,0.0,1.0);return color;}\n#endif\n",fn_getPatternPos:"#define GLSLIFY 1\nvec2 getPatternPos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos){vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return(tile_units_to_pixels*pos+offset)/pattern_size;}",fn_getVectorPointVisibilityValue:"#define GLSLIFY 1\n#ifndef __fn_getVectorPointVisibilityValue__\n#define __fn_getVectorPointVisibilityValue__\n#include <fn_rayEllipsoidIntersectionInterval>\nfloat getVectorPointVisibilityValue(vec3 position,mat4 modelMatrix,vec3 cameraPosition,vec3 cameraDirection){vec4 spacePos=modelMatrix*vec4(position,1.0);vec3 rayDir=spacePos.xyz-cameraPosition;vec3 normalizedRayDir=normalize(rayDir);vec2 interval=rayEllipsoidIntersectionInterval(cameraPosition,normalizedRayDir);if(interval.x!=-infinity){float distanceToSymbol=length(rayDir);if(abs(interval.x-distanceToSymbol)>abs(interval.y-distanceToSymbol)){return-1.0;}}if(dot(normalizedRayDir,cameraDirection)<0.0){return-1.0;}return 1.0;}\n#endif\n",fn_HSBToRGB:"#define GLSLIFY 1\nconst vec4 K_HSB2RGB=vec4(1.0,2.0/3.0,1.0/3.0,3.0);vec3 HSBToRGB(vec3 hsb){vec3 p=abs(fract(hsb.xxx+K_HSB2RGB.xyz)*6.0-K_HSB2RGB.www);return hsb.z*mix(K_HSB2RGB.xxx,clamp(p-K_HSB2RGB.xxx,0.0,1.0),hsb.y);}",fn_HSLToRGB:"#define GLSLIFY 1\nvec3 hueToRGB(float hue){float r=abs(hue*6.0-3.0)-1.0;float g=2.0-abs(hue*6.0-2.0);float b=2.0-abs(hue*6.0-4.0);return clamp(vec3(r,g,b),0.0,1.0);}vec3 HSLToRGB(vec3 hsl){vec3 rgb=hueToRGB(hsl.x);float c=(1.0-abs(2.0*hsl.z-1.0))*hsl.y;return(rgb-0.5)*c+hsl.z;}",fn_inverseGamma:"#define GLSLIFY 1\nvec3 inverseGamma(vec3 color,float gamma){return pow(color,vec3(1./gamma));}",fn_unpackDepth:"#define GLSLIFY 1\n#ifndef _UNPACK_DEPTH_\n#define _UNPACK_DEPTH_\nfloat unpackDepth(vec4 packedDepth){return dot(packedDepth,vec4(1.0,1.0/255.0,1.0/65025.0,1.0/16581375.0));}\n#endif\n",fn_geometricOcculusion:"#define GLSLIFY 1\nfloat geometricOcclusion(PBRInfo pbrInputs){float NdotL=pbrInputs.NdotL;float NdotV=pbrInputs.NdotV;float r=pbrInputs.alphaRoughness;float attenuationL=2.0*NdotL/(NdotL+sqrt(r*r+(1.0-r*r)*(NdotL*NdotL)));float attenuationV=2.0*NdotV/(NdotV+sqrt(r*r+(1.0-r*r)*(NdotV*NdotV)));return attenuationL*attenuationV;}",fn_getEllipsoidNormal:"#define GLSLIFY 1\nconst float xSquaredVal=1.0/6378137.0/6378137.0;const float zSquaredVal=1.0/6356752.3142451793/6356752.3142451793;const vec3 ellipsoid_oneOverRadiiSquared=vec3(xSquaredVal,xSquaredVal,zSquaredVal);\n#include <infinity>\nvec3 getEllipsoidNormal(vec3 position){vec3 result=normalize(position*ellipsoid_oneOverRadiiSquared);return result;}",fn_getIBLContribution:"#define GLSLIFY 1\nvec3 getIBLContribution(PBRInfo pbrInputs,vec3 n,vec3 reflection,vec2 modelUV,sampler2D brdfLUT,samplerCube diffuseEnvSampler,samplerCube specularEnvSampler){float mipCount=9.0;vec3 brdf=texture2D(brdfLUT,vec2(pbrInputs.NdotV,1.0-pbrInputs.perceptualRoughness)).rgb;vec3 specularLight=textureCube(specularEnvSampler,reflection).rgb;vec3 diffuseLight=textureCube(diffuseEnvSampler,n).rgb;vec3 diffuse=diffuseLight*pbrInputs.diffuseColor;vec3 specular=specularLight*(pbrInputs.specularColor*brdf.x+brdf.y);return diffuse+specular;}",fn_getKHRCoord:"#define GLSLIFY 1\nvec2 getKHRCoord(vec2 a_coord,vec4 khrValues){vec2 coord=vec2(0.);mat3 translation=mat3(1,0,0,0,1,0,khrValues.x,khrValues.y,1);mat3 scaleKHR=mat3(khrValues.z,0,0,0,khrValues.w,0,0,0,1);mat3 matrix=translation*scaleKHR;coord=(matrix*vec3(a_coord,1)).xy;return coord;}",fn_getNormal:"#define GLSLIFY 1\nvec3 getNormal(bool hasTangent,bool hasNormal,vec2 UV,vec3 pos,vec3 normal,mat3 TBN){mat3 tbn=mat3(0.0);if(!hasTangent){vec3 pos_dx=dFdx(pos);vec3 pos_dy=dFdy(pos);vec3 tex_dx=dFdx(vec3(UV,0.0));vec3 tex_dy=dFdy(vec3(UV,0.0));vec3 t=(tex_dy.t*pos_dx-tex_dx.t*pos_dy)/(tex_dx.s*tex_dy.t-tex_dy.s*tex_dx.t);vec3 ng=vec3(0.0);if(hasNormal){ng=normalize(normal);}else{ng=cross(pos_dx,pos_dy);}t=normalize(t-ng*dot(ng,t));vec3 b=normalize(cross(ng,t));tbn=mat3(t,b,ng);}else{tbn=TBN;}vec3 n=normalize(tbn[2].xyz);return n;}vec3 getNormalFromMap(bool hasTangent,bool hasNormal,vec2 UV,vec3 pos,vec3 normal,mat3 TBN,sampler2D normalSampler){mat3 tbn=mat3(0.0);if(!hasTangent){vec3 pos_dx=dFdx(pos);vec3 pos_dy=dFdy(pos);vec3 tex_dx=dFdx(vec3(UV,0.0));vec3 tex_dy=dFdy(vec3(UV,0.0));vec3 t=(tex_dy.t*pos_dx-tex_dx.t*pos_dy)/(tex_dx.s*tex_dy.t-tex_dy.s*tex_dx.t);vec3 ng=vec3(0.0);if(hasNormal){ng=normalize(normal);}else{ng=cross(pos_dx,pos_dy);}t=normalize(t-ng*dot(ng,t));vec3 b=normalize(cross(ng,t));tbn=mat3(t,b,ng);}else{tbn=TBN;}vec3 n=vec3(0.0);n=texture2D(normalSampler,UV).rgb;n=normalize(tbn*((2.0*n-1.0)));return n;}",fn_getMetallicAndRoughness:"#define GLSLIFY 1\nconst float c_MinRoughness=0.04;\n#ifdef M_HAS_METALROUGHNESSMAP\nvec3 getMetallicAndRoughness(vec2 UV,vec2 metallicRoughnessValue,sampler2D metallicRoughnessSampler){float perceptualRoughness=metallicRoughnessValue.y;float metallic=metallicRoughnessValue.x;vec4 mrSample=texture2D(metallicRoughnessSampler,v_TexCoord);perceptualRoughness=mrSample.g*perceptualRoughness;metallic=mrSample.b*metallic;perceptualRoughness=clamp(perceptualRoughness,c_MinRoughness,1.0);metallic=clamp(metallic,0.0,1.0);float alphaRoughness=perceptualRoughness*perceptualRoughness;return vec3(metallic,perceptualRoughness,alphaRoughness);}\n#else\nvec3 getMetallicAndRoughness(vec2 UV,vec2 metallicRoughnessValue){float perceptualRoughness=metallicRoughnessValue.y;float metallic=metallicRoughnessValue.x;perceptualRoughness=clamp(perceptualRoughness,c_MinRoughness,1.0);metallic=clamp(metallic,0.0,1.0);float alphaRoughness=perceptualRoughness*perceptualRoughness;return vec3(metallic,perceptualRoughness,alphaRoughness);}\n#endif\n",fn_getAnimatedGLPosition:"#define GLSLIFY 1\nmat4 calcSkinMatrix(){mat4 skinMatrix=mat4(1.0);if(u_HasSkinning){\n#ifdef M_JOINT_MATRIX_CNT\nskinMatrix=a_WEIGHTS_0.x*u_jointMatrix[int(a_JOINTS_0.x)]+a_WEIGHTS_0.y*u_jointMatrix[int(a_JOINTS_0.y)]+a_WEIGHTS_0.z*u_jointMatrix[int(a_JOINTS_0.z)]+a_WEIGHTS_0.w*u_jointMatrix[int(a_JOINTS_0.w)];\n#endif\n}return skinMatrix;}mat3 getNormalMatrix(mat4 modelMatrix){mat3 normalMat=mat3(modelMatrix[0][0],modelMatrix[0][1],modelMatrix[0][2],modelMatrix[1][0],modelMatrix[1][1],modelMatrix[1][2],modelMatrix[2][0],modelMatrix[2][1],modelMatrix[2][2]);return normalMat;}void getAnimatedGLPosition(vec4 position,mat4 viewportOrthographic){gl_Position=viewportOrthographic*position;}\n#ifdef M_DOUBLEPRECISION\nvoid getAnimatedGLPosition(){\n#ifdef M_INSTANCE_MATRIX\ngl_Position=u_ModelViewProjectionMatrix*a_InstanceMatrix4*u_ModelMatrix*vec4(a_PositionHigh+a_PositionLow,1.0);\n#else\ngl_Position=u_ModelViewProjectionRelativeToEye*translateRelativeToEye(a_PositionHigh,a_PositionLow);\n#endif\n}\n#else\nvec3 transformed=vec3(0.0);mat4 instanceMatrix4=mat4(1.0);void getAnimatedGLPosition(){transformed=vec3(0.0);instanceMatrix4=mat4(1.0);\n#ifdef M_USE_MORPHTARGETS\ntransformed=a_POSITION_1.xyz*u_morphTargetInfluences[0];transformed+=a_POSITION_2.xyz*u_morphTargetInfluences[1];\n#ifdef M_USE_MORPHNORMALS\nvec3 transformedNormal=a_NORMAL_1.xyz*u_morphTargetInfluences[0];transformedNormal+=a_NORMAL_2.xyz*u_morphTargetInfluences[1];v_Normal=v_Normal+transformedNormal;\n#endif\n#endif\n#ifdef M_INSTANCE_MATRIX\ninstanceMatrix4=a_InstanceMatrix4*u_ModelMatrix;\n#ifndef _SHADER_IN_VERTEX_DEPTH_\n#ifdef M_HAS_NORMALS\nmat3 normalMatrix=getNormalMatrix(instanceMatrix4);v_Normal=normalize(normalMatrix*a_NORMAL);\n#ifdef M_HAS_NORMALMAP\n#ifdef M_HAS_TANGENTS\nvec3 N=v_Normal;vec3 T=normalize(normalMatrix*a_TANGENT);vec3 B=normalize(cross(N,T));v_TBN=mat3(T,B,N);\n#endif\n#endif\n#endif\n#endif\n#endif\ngl_Position=u_ModelViewProjectionMatrix*instanceMatrix4*calcSkinMatrix()*vec4(a_POSITION.xyz+transformed,1.0);}\n#endif\n",fn_microfacetDistribution:"#define GLSLIFY 1\nfloat microfacetDistribution(PBRInfo pbrInputs){float roughnessSq=pbrInputs.alphaRoughness*pbrInputs.alphaRoughness;float f=(pbrInputs.NdotH*roughnessSq-pbrInputs.NdotH)*pbrInputs.NdotH+1.0;return roughnessSq/(PI*f*f);}",fn_nearFarScalar:"#define GLSLIFY 1\nfloat nearFarScalar(vec4 nearFarScalar,float cameraDistSq){float valueAtMin=nearFarScalar.y;float valueAtMax=nearFarScalar.w;float nearDistanceSq=nearFarScalar.x*nearFarScalar.x;float farDistanceSq=nearFarScalar.z*nearFarScalar.z;float t=(cameraDistSq-nearDistanceSq)/(farDistanceSq-nearDistanceSq);t=pow(clamp(t,0.0,1.0),0.2);return mix(valueAtMin,valueAtMax,t);}",fn_pbrDiffuse:"#define GLSLIFY 1\nvec3 pbrDiffuse(PBRInfo pbrInputs){return pbrInputs.diffuseColor/PI;}",fn_packDepth:"#define GLSLIFY 1\n#ifndef _PACK_DEPTH_\n#define _PACK_DEPTH_\nvec4 packDepth(float depth){vec4 enc=vec4(1.0,255.0,65025.0,16581375.0)*depth;enc=fract(enc);enc-=enc.yzww*vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);return enc;}\n#endif\n",fn_specularReflection:"#define GLSLIFY 1\nvec3 specularReflection(PBRInfo pbrInputs){return pbrInputs.reflectance0+(pbrInputs.reflectance90-pbrInputs.reflectance0)*pow(clamp(1.0-pbrInputs.VdotH,0.0,1.0),5.0);}",fn_sRGB2Linear:"#define GLSLIFY 1\nvec4 sRGB2Linear(vec4 srgbIn){vec3 linOut=pow(srgbIn.xyz,vec3(2.2));return vec4(linOut,srgbIn.w);}",fn_getBatchTextureColor:"#define GLSLIFY 1\n#if defined(M_ONE_DIMENSION_BATCH_TEXTURE)||defined(M_TWO_DIMENSION_BATCH_TEXTURE)\nvarying vec4 batch_featureColor;void getBatchTextureColor(vec4 tile_featureColor){float sumValue=(tile_featureColor.r+tile_featureColor.g+tile_featureColor.b+tile_featureColor.a)/4.0;if(sumValue>0.01&&sumValue<0.98&&tile_featureColor.a>0.0){if(tile_featureColor.a>0.99&&length(batch_featureColor.rgb)>0.01){gl_FragColor.rgb=batch_featureColor.rgb;}else{if(tile_featureColor.a>0.0){gl_FragColor.rgb=mix(tile_featureColor.rgb,gl_FragColor.rgb,tile_featureColor.a);}}}}\n#endif\n",fn_branchFreeTernary:"#define GLSLIFY 1\nfloat branchFreeTernary(bool comparison,float a,float b){float useA=float(comparison);return a*useA+b*(1.0-useA);}vec2 branchFreeTernary(bool comparison,vec2 a,vec2 b){float useA=float(comparison);return a*useA+b*(1.0-useA);}vec3 branchFreeTernary(bool comparison,vec3 a,vec3 b){float useA=float(comparison);return a*useA+b*(1.0-useA);}vec4 branchFreeTernary(bool comparison,vec4 a,vec4 b){float useA=float(comparison);return a*useA+b*(1.0-useA);}",fn_metersPerPixel:"#define GLSLIFY 1\nfloat metersPerPixel(vec4 positionEC,float pixelRatio){float width=u_Viewport.z;float height=u_Viewport.w;float top=u_FrustumPlanes.x;float bottom=u_FrustumPlanes.y;float left=u_FrustumPlanes.z;float right=u_FrustumPlanes.w;float distanceToPixel=-positionEC.z;float inverseNear=1.0/u_CurrentFrustum.x;float tanTheta=top*inverseNear;float pixelHeight=2.0*distanceToPixel*tanTheta/height;tanTheta=right*inverseNear;float pixelWidth=2.0*distanceToPixel*tanTheta/width;return max(pixelWidth,pixelHeight)*pixelRatio;}float metersPerPixel(vec4 positionEC){return metersPerPixel(positionEC,u_PixelRatio);}",fn_octDecode:"#define GLSLIFY 1\nfloat signNotZero(float value){return value>=0.0 ? 1.0 :-1.0;}vec2 signNotZero(vec2 value){return vec2(signNotZero(value.x),signNotZero(value.y));}vec3 octDecode(vec2 encoded,float range){if(encoded.x==0.0&&encoded.y==0.0){return vec3(0.0,0.0,0.0);}encoded=encoded/range*2.0-1.0;vec3 v=vec3(encoded.x,encoded.y,1.0-abs(encoded.x)-abs(encoded.y));if(v.z<0.0){v.xy=(1.0-abs(v.yx))*signNotZero(v.xy);}return normalize(v);}vec3 octDecode(vec2 encoded){return octDecode(encoded,255.0);}vec3 octDecode(float encoded){float temp=encoded/256.0;float x=floor(temp);float y=(temp-x)*256.0;return octDecode(vec2(x,y));}void octDecode(vec2 encoded,out vec3 vector1,out vec3 vector2,out vec3 vector3){float temp=encoded.x/65536.0;float x=floor(temp);float encodedFloat1=(temp-x)*65536.0;temp=encoded.y/65536.0;float y=floor(temp);float encodedFloat2=(temp-y)*65536.0;vector1=octDecode(encodedFloat1);vector2=octDecode(encodedFloat2);vector3=octDecode(vec2(x,y));}",fn_transformPlane:"#define GLSLIFY 1\nvec4 transformPlane(vec4 plane,mat4 transform){vec4 transformedPlane=transform*plane;float normalMagnitude=length(transformedPlane.xyz);return transformedPlane/normalMagnitude;}",fn_unpackFloatVec4:"#define GLSLIFY 1\nfloat unpackFloatVec4(vec4 packedFloat){packedFloat=floor(packedFloat*255.0+0.5);float sign=1.0-step(128.0,packedFloat[3])*2.0;float exponent=2.0*mod(packedFloat[3],128.0)+step(128.0,packedFloat[2])-127.0;if(exponent==-127.0){return 0.0;}float mantissa=mod(packedFloat[2],128.0)*65536.0+packedFloat[1]*256.0+packedFloat[0]+float(0x800000);float result=sign*exp2(exponent-23.0)*mantissa;return result;}",fn_windowToEyeCoordinates:"#define GLSLIFY 1\nvec4 windowToEyeCoordinates(vec4 fragmentCoordinate){float x=2.0*(fragmentCoordinate.x-u_Viewport.x)/u_Viewport.z-1.0;float y=2.0*(fragmentCoordinate.y-u_Viewport.y)/u_Viewport.w-1.0;float z=(fragmentCoordinate.z-u_ViewportTransformation[3][2])/u_ViewportTransformation[2][2];vec4 q=vec4(x,y,z,1.0);q/=fragmentCoordinate.w;if(!(u_InverseProjection==mat4(0.0))){q=u_InverseProjection*q;}else{float top=u_FrustumPlanes.x;float bottom=u_FrustumPlanes.y;float left=u_FrustumPlanes.z;float right=u_FrustumPlanes.w;float near=u_CurrentFrustum.x;float far=u_CurrentFrustum.y;q.x=(q.x*(right-left)+left+right)*0.5;q.y=(q.y*(top-bottom)+bottom+top)*0.5;q.z=(q.z*(near-far)-near-far)*0.5;q.w=1.0;}return q;}vec4 windowToEyeCoordinates(vec2 fragmentCoordinateXY,float depthOrLogDepth){\n#ifdef LOG_DEPTH\nfloat near=u_CurrentFrustum.x;float far=u_CurrentFrustum.y;float log2Depth=depthOrLogDepth*log2FarDepthFromNearPlusOne;float depthFromNear=pow(2.0,log2Depth)-1.0;float depthFromCamera=depthFromNear+near;vec4 windowCoord=vec4(fragmentCoordinateXY,far*(1.0-near/depthFromCamera)/(far-near),1.0);vec4 eyeCoordinate=windowToEyeCoordinates(windowCoord);eyeCoordinate.w=1.0/depthFromCamera;return eyeCoordinate;\n#else\nvec4 windowCoord=vec4(fragmentCoordinateXY,depthOrLogDepth,1.0);vec4 eyeCoordinate=windowToEyeCoordinates(windowCoord);\n#endif\nreturn eyeCoordinate;}",fn_primitiveClippingPlanes:"#define GLSLIFY 1\n#include <fn_branchFreeTernary>\n#include <fn_metersPerPixel>\n#include <fn_octDecode>\n#include <fn_transformPlane>\n#include <fn_unpackFloatVec4>\n#include <fn_windowToEyeCoordinates>\n#ifdef M_USE_CLIPPING_PLANES_FLOAT_TEXTURE\nvec4 getClippingPlane(highp sampler2D packedClippingPlanes,int clippingPlaneNumber,mat4 transform){int pixY=clippingPlaneNumber/M_CLIPPING_PLANES_TEXTURE_WIDTH;int pixX=clippingPlaneNumber-(pixY*M_CLIPPING_PLANES_TEXTURE_WIDTH);float pixelWidth=1.0/float(M_CLIPPING_PLANES_TEXTURE_WIDTH);float pixelHeight=1.0/float(M_CLIPPING_PLANES_TEXTURE_HEIGHT);float u=(float(pixX)+0.5)*pixelWidth;float v=(float(pixY)+0.5)*pixelHeight;vec4 plane=texture2D(packedClippingPlanes,vec2(u,v));return transformPlane(plane,transform);}\n#else\nvec4 getClippingPlane(highp sampler2D packedClippingPlanes,int clippingPlaneNumber,mat4 transform){int clippingPlaneStartIndex=clippingPlaneNumber*2;int pixY=clippingPlaneStartIndex/M_CLIPPING_PLANES_TEXTURE_WIDTH;int pixX=clippingPlaneStartIndex-(pixY*M_CLIPPING_PLANES_TEXTURE_WIDTH);float pixelWidth=1.0/float(M_CLIPPING_PLANES_TEXTURE_WIDTH);float pixelHeight=1.0/float(M_CLIPPING_PLANES_TEXTURE_HEIGHT);float u=(float(pixX)+0.5)*pixelWidth;float v=(float(pixY)+0.5)*pixelHeight;vec4 oct32=texture2D(packedClippingPlanes,vec2(u,v))*255.0;vec2 oct=vec2(oct32.x*256.0+oct32.y,oct32.z*256.0+oct32.w);vec4 plane;plane.xyz=octDecode(oct,65535.0);plane.w=unpackFloatVec4(texture2D(packedClippingPlanes,vec2(u+pixelWidth,v)));return transformPlane(plane,transform);}\n#endif\nfloat clip(vec4 fragCoord,highp sampler2D clippingPlanes,mat4 clippingPlanesMatrix){vec4 position=windowToEyeCoordinates(fragCoord);vec3 clipNormal=vec3(0.0);vec3 clipPosition=vec3(0.0);float pixelWidth=metersPerPixel(position);\n#ifdef M_UNION_CLIPPING_REGIONS\nfloat clipAmount;\n#else\nfloat clipAmount=0.0;bool clipped=true;\n#endif\nfor(int i=0;i<M_CLIPPING_PLANES_LENGTH;++i){vec4 clippingPlane=getClippingPlane(clippingPlanes,i,clippingPlanesMatrix);clipNormal=clippingPlane.xyz;clipPosition=-clippingPlane.w*clipNormal;float amount=dot(clipNormal,(position.xyz-clipPosition))/pixelWidth;\n#ifdef M_UNION_CLIPPING_REGIONS\nclipAmount=branchFreeTernary(i==0,amount,min(amount,clipAmount));if(amount<=0.0){discard;}\n#else\nclipAmount=max(amount,clipAmount);clipped=clipped&&(amount<=0.0);\n#endif\n}\n#ifndef M_UNION_CLIPPING_REGIONS\nif(clipped){discard;}\n#endif\nreturn clipAmount;}void modelClippingPlanesStage(inout vec4 color){float clipDistance=clip(gl_FragCoord,u_model_clippingPlanes,u_model_clippingPlanesMatrix);vec4 clippingPlanesEdgeColor=vec4(1.0);clippingPlanesEdgeColor.rgb=u_model_clippingPlanesEdgeStyle.rgb;float clippingPlanesEdgeWidth=u_model_clippingPlanesEdgeStyle.a;if(clipDistance>0.0&&clipDistance<clippingPlanesEdgeWidth){color=clippingPlanesEdgeColor;}}",fn_rayEllipsoidIntersectionInterval:"#define GLSLIFY 1\n#ifndef _RAY_ELLIPSOID_INTERSECTION_INTERVAL_\n#define _RAY_ELLIPSOID_INTERSECTION_INTERVAL_\nconst float xVal=1.0/6378137.0;const float zVal=1.0/6356752.3142451793;const vec3 ellipsoid_inverseRadii=vec3(xVal,xVal,zVal);\n#include <infinity>\nvec2 rayEllipsoidIntersectionInterval(vec3 rayOrigin,vec3 rayDir){vec3 q=ellipsoid_inverseRadii*rayOrigin;vec3 w=ellipsoid_inverseRadii*rayDir;q=q;float q2=dot(q,q);float qw=dot(q,w);if(q2>1.0){if(qw>=0.0){return vec2(-infinity);}else{float qw2=qw*qw;float difference=q2-1.0;float w2=dot(w,w);float product=w2*difference;if(qw2<product){return vec2(-infinity);}else if(qw2>product){float discriminant=qw*qw-product;float temp=-qw+sqrt(discriminant);float root0=temp/w2;float root1=difference/temp;if(root0<root1){vec2 i=vec2(root0,root1);return i;}else{vec2 i=vec2(root1,root0);return i;}}else{float root=sqrt(difference/w2);vec2 i=vec2(root,root);return i;}}}else if(q2<1.0){float difference=q2-1.0;float w2=dot(w,w);float product=w2*difference;float discriminant=qw*qw-product;float temp=-qw+sqrt(discriminant);vec2 i=vec2(0.0,temp/w2);return i;}else{if(qw<0.0){float w2=dot(w,w);vec2 i=vec2(0.0,-qw/w2);return i;}else{return vec2(-infinity);}}}\n#endif\n",fn_readDepth:"#define GLSLIFY 1\n#include <fn_reverseLogDepth>\n#include <fn_unpackDepth>\n#ifndef _READ_DEPTH_\n#define _READ_DEPTH_\nfloat readDepth(sampler2D depthTexture,vec2 texCoords,bool isColorTexture){if(isColorTexture){\n#ifdef M_UNSUPPORTED_COLOR_BUFFER_FLOAT\nreturn reverseLogDepth(unpackDepth(texture2D(depthTexture,texCoords)));\n#else\nreturn reverseLogDepth(texture2D(depthTexture,texCoords).r);\n#endif\n}else{return reverseLogDepth(texture2D(depthTexture,texCoords).r);}}\n#endif\n",fn_getExponentialInterpColor:"#define GLSLIFY 1\nvec4 getExponentialInterpColor(const float inputValue,const float base,const float lowerValue,const float upperValue,const vec4 lowerColor,const vec4 upperColor){float difference=upperValue-lowerValue;float progress=inputValue-lowerValue;float percent;if(difference==0.0){percent=0.0;}else if(base==1.0){percent=progress/difference;}else{percent=(pow(base,progress)-1.0)/(pow(base,difference)-1.0);}return mix(lowerColor,upperColor,percent);}",fn_writeDepth:"#define GLSLIFY 1\n#include <fn_reverseLogDepth>\n#include <fn_unpackDepth>\n#include <fn_encodeFloat>\n#ifndef _WRITE_DEPTH_\n#define _WRITE_DEPTH_\nvec4 writeDepth(float depth){\n#ifdef M_UNSUPPORTED_COLOR_BUFFER_FLOAT\nreturn encodeFloat(depth);\n#else\nreturn vec4(depth,depth,depth,1.0);\n#endif\n}\n#endif\n",fn_XYZToRGB:"#define GLSLIFY 1\nvec3 XYZToRGB(vec3 Yxy){const mat3 XYZ2RGB=mat3(3.2405,-0.9693,0.0556,-1.5371,1.8760,-0.2040,-0.4985,0.0416,1.0572);vec3 xyz;xyz.r=Yxy.r*Yxy.g/Yxy.b;xyz.g=Yxy.r;xyz.b=Yxy.r*(1.0-Yxy.g-Yxy.b)/Yxy.b;return XYZ2RGB*xyz;}",fn_polylineVertexPosition:"#define GLSLIFY 1\nconst float czm_epsilon6=0.000001;const float czm_epsilon1=0.1;const float czm_piOverFour=0.7853981633974483;bool equalsEpsilon(vec3 left,vec3 right,float epsilon){return all(lessThanEqual(abs(left-right),vec3(epsilon)));}vec4 eyeToWindowCoordinates(vec4 positionEC){vec4 q=u_ProjectionMatrix*positionEC;q.xyz/=q.w;q.xyz=(u_ViewportTransformation*vec4(q.xyz,1.0)).xyz;return q;}void clipLineSegmentToNearPlane(vec3 p0,vec3 p1,out vec4 positionWC,out bool clipped,out bool culledByNearPlane,out vec4 clippedPositionEC){culledByNearPlane=false;clipped=false;vec3 p0ToP1=p1-p0;float magnitude=length(p0ToP1);vec3 direction=normalize(p0ToP1);float endPoint0Distance=u_CurrentFrustum.x+p0.z;float denominator=-direction.z;if(endPoint0Distance>0.0&&abs(denominator)<czm_epsilon7){culledByNearPlane=true;}else if(endPoint0Distance>0.0){float t=endPoint0Distance/denominator;if(t<0.0||t>magnitude){culledByNearPlane=true;}else{p0=p0+t*direction;p0.z=min(p0.z,-u_CurrentFrustum.x);clipped=true;}}clippedPositionEC=vec4(p0,1.0);positionWC=eyeToWindowCoordinates(clippedPositionEC);}vec4 getPolylineWindowCoordinates(vec4 positionEC,vec4 prevEC,vec4 nextEC,float expandDirection,float width,bool usePrevious,out float angle){\n#ifdef M_POLYLINE_DASH\nvec4 positionWindow=eyeToWindowCoordinates(positionEC);vec4 previousWindow=eyeToWindowCoordinates(prevEC);vec4 nextWindow=eyeToWindowCoordinates(nextEC);vec2 lineDir;if(usePrevious){lineDir=normalize(positionWindow.xy-previousWindow.xy);}else{lineDir=normalize(nextWindow.xy-positionWindow.xy);}angle=atan(lineDir.x,lineDir.y)-1.570796327;angle=floor(angle/czm_piOverFour+0.5)*czm_piOverFour;\n#endif\nvec4 clippedPrevWC,clippedPrevEC;bool prevSegmentClipped,prevSegmentCulled;clipLineSegmentToNearPlane(prevEC.xyz,positionEC.xyz,clippedPrevWC,prevSegmentClipped,prevSegmentCulled,clippedPrevEC);vec4 clippedNextWC,clippedNextEC;bool nextSegmentClipped,nextSegmentCulled;clipLineSegmentToNearPlane(nextEC.xyz,positionEC.xyz,clippedNextWC,nextSegmentClipped,nextSegmentCulled,clippedNextEC);bool segmentClipped,segmentCulled;vec4 clippedPositionWC,clippedPositionEC;clipLineSegmentToNearPlane(positionEC.xyz,usePrevious ? prevEC.xyz : nextEC.xyz,clippedPositionWC,segmentClipped,segmentCulled,clippedPositionEC);if(segmentCulled){return vec4(0.0,0.0,0.0,1.0);}vec2 directionToPrevWC=normalize(clippedPrevWC.xy-clippedPositionWC.xy);vec2 directionToNextWC=normalize(clippedNextWC.xy-clippedPositionWC.xy);if(prevSegmentCulled){directionToPrevWC=-directionToNextWC;}else if(nextSegmentCulled){directionToNextWC=-directionToPrevWC;}vec2 thisSegmentForwardWC,otherSegmentForwardWC;if(usePrevious){thisSegmentForwardWC=-directionToPrevWC;otherSegmentForwardWC=directionToNextWC;}else{thisSegmentForwardWC=directionToNextWC;otherSegmentForwardWC=-directionToPrevWC;}vec2 thisSegmentLeftWC=vec2(-thisSegmentForwardWC.y,thisSegmentForwardWC.x);vec2 leftWC=thisSegmentLeftWC;float expandWidth=width*0.5;if(!equalsEpsilon(prevEC.xyz-positionEC.xyz,vec3(0.0),czm_epsilon1)&&!equalsEpsilon(nextEC.xyz-positionEC.xyz,vec3(0.0),czm_epsilon1)){vec2 otherSegmentLeftWC=vec2(-otherSegmentForwardWC.y,otherSegmentForwardWC.x);vec2 leftSumWC=thisSegmentLeftWC+otherSegmentLeftWC;float leftSumLength=length(leftSumWC);leftWC=leftSumLength<czm_epsilon6 ? thisSegmentLeftWC :(leftSumWC/leftSumLength);vec2 u=-thisSegmentForwardWC;vec2 v=leftWC;float sinAngle=abs(u.x*v.y-u.y*v.x);expandWidth=clamp(expandWidth/sinAngle,0.0,width*1.0);}vec2 offset=leftWC*expandDirection*expandWidth*u_PixelRatio;\n#if !defined(M_PIXEL_WIDTH)\noffset/=metersPerPixel(positionEC);\n#endif\nreturn vec4(clippedPositionWC.xy+offset,-clippedPositionWC.z,1.0)*(u_ProjectionMatrix*clippedPositionEC).w;}vec4 computePositionEC(in vec3 high,in vec3 low){vec4 p=u_modelViewRelativeToEye*translateRelativeToEye(high,low);return p;}vec4 polylineVertexPosition(out float angle){float expandDir=a_ExpandAndWidth.x;float width=abs(a_ExpandAndWidth.y)+0.5;bool usePrev=a_ExpandAndWidth.y<0.0;vec4 currentEC=computePositionEC(a_PositionHigh,a_PositionLow);vec4 prevEC=computePositionEC(a_PrevPositionHigh,a_PrevPositionLow);vec4 nextEC=computePositionEC(a_NextPositionHigh,a_NextPositionLow);return getPolylineWindowCoordinates(currentEC,prevEC,nextEC,expandDir,width,usePrev,angle);}vec4 polylineVertexPosition(){float angle;float expandDir=a_ExpandAndWidth.x;float width=abs(a_ExpandAndWidth.y)+0.5;bool usePrev=a_ExpandAndWidth.y<0.0;vec4 currentEC=computePositionEC(a_PositionHigh,a_PositionLow);vec4 prevEC=computePositionEC(a_PrevPositionHigh,a_PrevPositionLow);vec4 nextEC=computePositionEC(a_NextPositionHigh,a_NextPositionLow);return getPolylineWindowCoordinates(currentEC,prevEC,nextEC,expandDir,width,usePrev,angle);}",fn_polylineVolumePosition:"#define GLSLIFY 1\nconst float czm_piOverFour=0.7853981633974483;vec4 eyeToWindowCoordinates(vec4 positionEC){vec4 q=u_ProjectionMatrix*positionEC;q.xyz/=q.w;q.xyz=(u_ViewportTransformation*vec4(q.xyz,1.0)).xyz;return q;}vec4 polylineVolumePosition(out float angle){float width=a_Width;vec3 ecStart=(u_modelViewRelativeToEye*translateRelativeToEye(a_StartHigh,a_StartLow)).xyz;vec3 offset=u_Normal*a_ForwardOffset;vec3 ecEnd=ecStart+offset;vec3 forwardDirectionEC=normalize(offset);\n#ifdef M_POLYLINE_DASH\nvec4 forwardDirectionWC=eyeToWindowCoordinates(vec4(forwardDirectionEC,1.0));vec2 lineDir=forwardDirectionWC.xy;angle=atan(lineDir.x,lineDir.y)-1.570796327;angle=floor(angle/czm_piOverFour+0.5)*czm_piOverFour;\n#endif\nvec4 startPlaneEC;startPlaneEC.xyz=u_Normal*a_StartNormal;startPlaneEC.w=-dot(startPlaneEC.xyz,ecStart);vec4 endPlaneEC;endPlaneEC.xyz=u_Normal*a_EndNormal;endPlaneEC.w=-dot(endPlaneEC.xyz,ecEnd);v_rightPlaneEC.xyz=u_Normal*a_RightNormal.xyz;v_rightPlaneEC.w=-dot(v_rightPlaneEC.xyz,ecStart);v_texcoordNormalizationAndStartEcYZ.x=abs(a_TexCoord.x);v_texcoordNormalizationAndStartEcYZ.y=a_TexCoord.y;v_texcoordNormalizationAndStartEcYZ.zw=ecStart.yz;v_endEcAndStartEcX.xyz=ecEnd;v_endEcAndStartEcX.w=ecStart.x;vec3 positionRelativeToEye=translateRelativeToEye(a_PositionHigh,a_PositionLow).xyz;vec4 positionEC=u_modelViewRelativeToEye*vec4(positionRelativeToEye,1.0);float absStartPlaneDistance=abs(planeDistance(startPlaneEC,positionEC.xyz));float absEndPlaneDistance=abs(planeDistance(endPlaneEC,positionEC.xyz));vec3 planeDirection=branchFreeTernary(absStartPlaneDistance<absEndPlaneDistance,startPlaneEC.xyz,endPlaneEC.xyz);vec3 upOrDown=normalize(cross(v_rightPlaneEC.xyz,planeDirection));vec3 normalEC=normalize(cross(planeDirection,upOrDown));upOrDown=cross(forwardDirectionEC,normalEC);upOrDown=min(u_GlobeMinimumAltitude,u_GeometricToleranceOverMeter*length(positionRelativeToEye.xyz))*upOrDown;positionEC.xyz+=upOrDown;v_texcoordNormalizationAndStartEcYZ.y=branchFreeTernary(v_texcoordNormalizationAndStartEcYZ.y>1.0,0.0,abs(v_texcoordNormalizationAndStartEcYZ.y));v_startPlaneNormalEcAndHalfWidth.xyz=startPlaneEC.xyz;v_startPlaneNormalEcAndHalfWidth.w=width*0.5;v_endPlaneNormalEcAndBatchId.xyz=endPlaneEC.xyz;\n#ifdef M_PIXEL_WIDTH\nwidth=width*max(0.0,metersPerPixel(positionEC));\n#endif\nwidth=width/dot(normalEC,v_rightPlaneEC.xyz);normalEC*=sign(a_TexCoord.x);positionEC.xyz+=width*normalEC;return u_ProjectionMatrix*positionEC;}",fn_planeDistance:"#define GLSLIFY 1\nfloat planeDistance(vec4 plane,vec3 point){return(dot(plane.xyz,point)+plane.w);}float planeDistance(vec3 planeNormal,float planeDistance,vec3 point){return(dot(planeNormal,point)+planeDistance);}",fn_billboardVertexPosition:"#define GLSLIFY 1\nvec4 billboardVertexPosition(){mat4 newModelMatrix;vec4 mvPosition;\n#ifdef M_FIXED_PIXEL_SIZE\nvec2 offset=vec2(0.0);offset=(a_POSITION.xy-u_center)*u_PixelResolution;vec4 center=u_ProjectionMatrix*u_MvMatrix*vec4(0.0,0.0,0.0,1.0);center=center/center.w;vec2 screenLocation=(u_ViewportTransformation*center).xy+offset;vec4 ndc=vec4(0.0);ndc.x=((screenLocation.x-u_Viewport[0])/u_Viewport[2])*2.0-1.0;ndc.y=((screenLocation.y-u_Viewport[1])/u_Viewport[3])*2.0-1.0;ndc.z=center.z;ndc.w=1.0;return ndc;\n#else\n#ifdef M_INSTANCE_MATRIX\nnewModelMatrix=u_InvertViewMatrix*a_InstanceMatrix4*u_ScaleMatrix;mvPosition=a_InstanceMatrix4*u_ScaleMatrix*vec4(0.0,0.0,0.0,1.0);\n#ifdef M_PARTICLSYSTEM\nv_Color=a_COLOR_0;\n#endif\n#else\nnewModelMatrix=u_InvertViewMatrix*u_MvMatrix*u_ScaleMatrix;mvPosition=u_MvMatrix*vec4(0.0,0.0,0.0,1.0);\n#endif\nvec2 scale;scale.x=length(vec3(newModelMatrix[0].x,newModelMatrix[0].y,newModelMatrix[0].z));scale.y=length(vec3(newModelMatrix[1].x,newModelMatrix[1].y,newModelMatrix[1].z));\n#if defined(M_SIZEATTENUATION)\n#ifdef M_PARTICLSYSTEM\nscale*=-mvPosition.z*a_Scale;\n#else\nscale*=-mvPosition.z;\n#endif\n#endif\nvec2 alignedPosition=(a_POSITION.xy-(u_center-vec2(0.5)))*scale;vec2 rotatedPosition;rotatedPosition.x=cos(u_rotation)*alignedPosition.x-sin(u_rotation)*alignedPosition.y;rotatedPosition.y=sin(u_rotation)*alignedPosition.x+cos(u_rotation)*alignedPosition.y;mvPosition.xy+=rotatedPosition;return u_ProjectionMatrix*mvPosition;\n#endif\n}",fn_computePolygonAdaptUV:"#define GLSLIFY 1\n#ifdef M_SPHERICAL\nvarying vec4 v_sphericalExtents;\n#else\nvarying vec2 v_inversePlaneExtents;varying vec4 v_westPlane;varying vec4 v_southPlane;\n#endif\nvarying vec3 v_uMaxAndInverseDistance;varying vec3 v_vMaxAndInverseDistance;varying vec3 v_uvMinAndSphericalLongitudeRotation;float lineDistance(vec2 point1,vec2 point2,vec2 point){return abs((point2.y-point1.y)*point.x-(point2.x-point1.x)*point.y+point2.x*point1.y-point2.y*point1.x)/distance(point2,point1);}float fastApproximateAtan(float x){return x*(-0.1784*x-0.0663*x*x+1.0301);}float fastApproximateAtan(float x,float y){float t=abs(x);float opposite=abs(y);float adjacent=max(t,opposite);opposite=min(t,opposite);t=fastApproximateAtan(opposite/adjacent);t=branchFreeTernary(abs(y)>abs(x),1.5707963267948966-t,t);t=branchFreeTernary(x<0.0,3.141592653589793-t,t);t=branchFreeTernary(y<0.0,-t,t);return t;}vec2 approximateSphericalCoordinates(vec3 normal){float latitudeApproximation=fastApproximateAtan(sqrt(normal.x*normal.x+normal.y*normal.y),normal.z);float longitudeApproximation=fastApproximateAtan(normal.x,normal.y);return vec2(latitudeApproximation,longitudeApproximation);}float planeDistance(vec4 plane,vec3 point){return(dot(plane.xyz,point)+plane.w);}vec2 computePolygonAdaptUV(){float logDepthOrDepth=readDepth(u_DepthTexture,gl_FragCoord.xy/u_Viewport.zw,false);vec4 eyeCoordinate=windowToEyeCoordinates(gl_FragCoord.xy,logDepthOrDepth);eyeCoordinate/=eyeCoordinate.w;vec4 worldCoordinate4=u_InvertViewMatrix*eyeCoordinate;vec3 worldCoordinate=worldCoordinate4.xyz/worldCoordinate4.w;vec2 uv=vec2(0.0,0.0);\n#ifdef M_SPHERICAL\nvec2 sphericalLatLong=approximateSphericalCoordinates(worldCoordinate);sphericalLatLong.y+=v_uvMinAndSphericalLongitudeRotation.z;bool flag=sphericalLatLong.y<3.141592653589793;float range=sphericalLatLong.y-3.141592653589793*2.0;sphericalLatLong.y=branchFreeTernary(flag,sphericalLatLong.y,range);uv.x=(sphericalLatLong.y-v_sphericalExtents.y)*v_sphericalExtents.w;uv.y=(sphericalLatLong.x-v_sphericalExtents.x)*v_sphericalExtents.z;\n#else\nuv.x=planeDistance(v_westPlane,eyeCoordinate.xyz/eyeCoordinate.w)*v_inversePlaneExtents.x;uv.y=planeDistance(v_southPlane,eyeCoordinate.xyz/eyeCoordinate.w)*v_inversePlaneExtents.y;\n#endif\nif(uv.x<=0.0||1.0<=uv.x||uv.y<=0.0||1.0<=uv.y||logDepthOrDepth==0.0){discard;}return uv;}",fn_linearizeDepth:"#define GLSLIFY 1\nuniform float u_near_plane;uniform float u_far_plane;float linearizeDepth(float depth){float z=depth*2.0-1.0;return(2.0*u_near_plane*u_far_plane)/(u_far_plane+u_near_plane-z*(u_far_plane-u_near_plane));}",fn_computeShadowVolumeExtents:"#define GLSLIFY 1\n#ifdef M_HAS_SHADOWVOLUME\nuniform sampler2D batchTableTexture;uniform vec4 batchTextureStep;uniform float numberOfAttributes;vec2 computeSt(float batchId){float stepX=batchTextureStep.x;float centerX=batchTextureStep.y;return vec2(centerX+(batchId*numberOfAttributes*stepX),0.5);}\n#ifdef M_SPHERICAL\nvarying vec4 v_sphericalExtents;vec4 batchTable_sphericalExtents(float batchId){vec2 st=computeSt(batchId);st.x+=batchTextureStep.x*float(0);vec4 textureValue=texture2D(batchTableTexture,st);vec4 value=textureValue;return value;}float batchTable_longitudeRotation(float batchId){vec2 st=computeSt(batchId);st.x+=batchTextureStep.x*float(1);vec4 textureValue=texture2D(batchTableTexture,st);float value=textureValue.x;return value;}\n#else\nvarying vec2 v_inversePlaneExtents;varying vec4 v_westPlane;varying vec4 v_southPlane;uniform mat4 u_modelViewRelativeToEye;uniform mat3 u_viewNormal;vec3 batchTableSouthWestHIGH(float batchId){vec2 st=computeSt(batchId);st.x+=batchTextureStep.x*float(2);vec4 textureValue=texture2D(batchTableTexture,st);vec3 value=textureValue.xyz;return value;}vec3 batchTableSouthWestLOW(float batchId){vec2 st=computeSt(batchId);st.x+=batchTextureStep.x*float(3);vec4 textureValue=texture2D(batchTableTexture,st);vec3 value=textureValue.xyz;return value;}vec3 batchTableEastward(float batchId){vec2 st=computeSt(batchId);st.x+=batchTextureStep.x*float(4);vec4 textureValue=texture2D(batchTableTexture,st);vec3 value=textureValue.xyz;return value;}vec3 batchTableNorthward(float batchId){vec2 st=computeSt(batchId);st.x+=batchTextureStep.x*float(5);vec4 textureValue=texture2D(batchTableTexture,st);vec3 value=textureValue.xyz;return value;}\n#endif\nvarying vec3 v_vMaxAndInverseDistance;varying vec3 v_uvMinAndSphericalLongitudeRotation;vec4 batchTable_uMaxVmax(float batchId){vec2 st=computeSt(batchId);st.x+=batchTextureStep.x*float(2);vec4 textureValue=texture2D(batchTableTexture,st);vec4 value=textureValue;return value;}vec4 batchTable_uvMinAndExtents(float batchId){vec2 st=computeSt(batchId);st.x+=batchTextureStep.x*float(3);vec4 textureValue=texture2D(batchTableTexture,st);vec4 value=textureValue;return value;}\n#endif\nvoid computeShadowVolumeExtents(){\n#ifdef M_SPHERICAL\nv_sphericalExtents=batchTable_sphericalExtents(0.0);v_uvMinAndSphericalLongitudeRotation.z=batchTable_longitudeRotation(0.0);\n#else\nvec3 southWestCorner=(u_modelViewRelativeToEye*translateRelativeToEye(batchTableSouthWestHIGH(0.0),batchTableSouthWestLOW(0.0))).xyz;vec3 northWestCorner=u_viewNormal*batchTableNorthward(0.0)+southWestCorner;vec3 southEastCorner=u_viewNormal*batchTableEastward(0.0)+southWestCorner;vec3 eastWard=southEastCorner-southWestCorner;float eastExtent=length(eastWard);eastWard/=eastExtent;vec3 northWard=northWestCorner-southWestCorner;float northExtent=length(northWard);northWard/=northExtent;v_westPlane=vec4(eastWard,-dot(eastWard,southWestCorner));v_southPlane=vec4(northWard,-dot(northWard,southWestCorner));v_inversePlaneExtents=vec2(1.0/eastExtent,1.0/northExtent);\n#endif\nvec4 uvMinAndExtents=batchTable_uvMinAndExtents(0.0);vec4 uMaxVmax=batchTable_uMaxVmax(0.0);v_vMaxAndInverseDistance=vec3(uMaxVmax.zw,uvMinAndExtents.w);v_uvMinAndSphericalLongitudeRotation.xy=uvMinAndExtents.xy;}",s_HighlightColorInfo:"#define GLSLIFY 1\nstruct HighlightColorInfo{vec4 color;};",s_JointMatrix:"#define GLSLIFY 1\nstruct JointMatrix{mat4 m;};",s_LightMaterial:"#define GLSLIFY 1\nstruct LightMaterial{vec3 Ambient;vec3 Diffuse;float Shininess;vec3 SpecularColor;};",s_PBRInfo:"#define GLSLIFY 1\nstruct PBRInfo{float NdotL;float NdotV;float NdotH;float LdotH;float VdotH;float perceptualRoughness;float metalness;vec3 reflectance0;vec3 reflectance90;float alphaRoughness;vec3 diffuseColor;vec3 specularColor;};",infinity:"#define GLSLIFY 1\n#ifndef _MINEMAP_INFINITY_\n#define _MINEMAP_INFINITY_\nconst float infinity=5906376272000.0;\n#endif\n"};var C_="#define GLSLIFY 1\n#ifndef _SHADER_IN_VERTEX_DEPTH_\n#define _SHADER_IN_VERTEX_DEPTH_\n#endif\n#include <fn_vertexLogDepth>\n#include <a_DOUBLE_PRECISION_POSITION>\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelMatrix>\n#include <a_BATCHID>\n#include <c_computeSTParsVert>\n#include <u_ModelViewProjectionRelativeToEye>\n#include <u_EncodedCameraPosition>\n#include <fn_translateRelativeToEye>\n#if defined(M_POLYLINE) || defined(M_LOG_DEPTH)\n#include <u_CurrentFrustum>\n#endif\n#ifdef M_JOINT_MATRIX_CNT\nattribute vec4 a_JOINTS_0;attribute vec4 a_WEIGHTS_0;\n#endif\n#ifdef M_INSTANCE_MATRIX\nattribute mat4 a_InstanceMatrix4;uniform mat4 vpmatrix;\n#endif\n#include <u_HasSkinning>\n#include <s_JointMatrix>\n#ifdef M_JOINT_MATRIX_CNT\nuniform highp mat4 u_jointMatrix[M_JOINT_MATRIX_CNT];\n#endif\n#ifdef M_USE_MORPHTARGETS\n#include <a_POSITION3_1>\n#include <a_POSITION3_2>\nuniform vec2 u_morphTargetInfluences;\n#include <a_NORMAL3_1>\n#include <a_NORMAL3_2>\n#include <a_TANGENT_1>\n#include <a_TANGENT_2>\n#endif\n#include <fn_getAnimatedGLPosition>\n#ifdef M_POLYLINE\n#include <u_FrustumPlanes>\n#include <u_ProjectionMatrix>\n#include <u_PixelRatio>\n#include <u_Viewport>\n#include <fn_metersPerPixel>\nuniform mat4 u_ViewportTransformation;uniform mat4 u_ViewportOrthographic;uniform mat4 u_modelViewRelativeToEye;uniform mat3 u_Normal;uniform float u_GlobeMinimumAltitude;uniform float u_GeometricToleranceOverMeter;\n#ifdef M_SHADOW_VOLUME\nattribute vec3 a_StartHigh;attribute vec3 a_StartLow;attribute vec3 a_StartNormal;attribute vec3 a_EndNormal;attribute vec3 a_RightNormal;attribute vec3 a_ForwardOffset;attribute vec2 a_TexCoord;attribute float a_Width;varying vec4 v_startPlaneNormalEcAndHalfWidth;varying vec4 v_endPlaneNormalEcAndBatchId;varying vec4 v_rightPlaneEC;varying vec4 v_endEcAndStartEcX;varying vec4 v_texcoordNormalizationAndStartEcYZ;\n#include <fn_planeDistance>\n#include <fn_branchFreeTernary>\n#include <fn_polylineVolumePosition>\n#else\nattribute vec3 a_PrevPositionHigh;attribute vec3 a_PrevPositionLow;attribute vec3 a_NextPositionHigh;attribute vec3 a_NextPositionLow;attribute vec2 a_ExpandAndWidth;\n#include <fn_polylineVertexPosition>\n#endif\nvarying float v_polylineAngle;\n#endif\n#ifdef M_BILLBOARD\n#include <u_ProjectionMatrix>\nuniform float u_rotation;uniform vec2 u_center;uniform vec2 u_UVScale;uniform mat4 u_ScaleMatrix;uniform mat4 u_MvMatrix;uniform mat4 u_InvertViewMatrix;\n#ifdef M_FIXED_PIXEL_SIZE\nuniform vec2 u_PixelResolution;uniform mat4 u_ViewportTransformation;uniform vec4 u_Viewport;\n#endif\n#include <fn_billboardVertexPosition>\n#endif\nvarying float v_depthFromNearPlusOne;\n#include <v_Show>\n#ifdef M_DEPTH_DISTANCE\nvarying vec4 v_Position;\n#endif\nvoid main(){\n#ifdef M_POLYLINE\n#ifdef M_SHADOW_VOLUME\nfloat angle;gl_Position=polylineVolumePosition(angle);v_polylineAngle=angle;gl_Position.z=min(gl_Position.z,gl_Position.w);\n#else\nfloat angle;vec4 positionWC=polylineVertexPosition(angle);v_polylineAngle=angle;getAnimatedGLPosition(positionWC,u_ViewportOrthographic);\n#endif\n#else\n#ifdef M_BILLBOARD\ngl_Position=billboardVertexPosition();\n#else\ngetAnimatedGLPosition();\n#endif\n#endif\n#include <c_computeSTMainVert>\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n#ifdef M_DEPTH_DISTANCE\n#ifdef M_DOUBLEPRECISION\nv_Position=u_ModelMatrix*vec4(a_PositionHigh+a_PositionLow,1);\n#else\nv_Position=u_ModelMatrix*vec4(a_POSITION,1.0);\n#endif\n#endif\n}";function M_(e){return R_(e)}const I_=/^[ \t]*#include +<([\w\d./]+)>/gm,L_={prelude:{fragmentSource:M_("\n#ifdef M_TEXTURE_LOD_SUPPORTED\n#extension GL_EXT_shader_texture_lod:enable\n#endif\n#ifdef M_STANDARD_DERIVATIVES_SUPPORTED\n#extension GL_OES_standard_derivatives:enable\n#endif\n#ifdef M_DEPTH_EXT\n#extension GL_EXT_frag_depth:enable\n#endif\n#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\n#if !defined(M_HIGHLIGHT_COLOR_MAX)\n#define M_HIGHLIGHT_COLOR_MAX 4\n#endif\n#define PI 3.141592653589793\nconst float czm_epsilon7=0.0000001;const float czm_twoPi=6.283185307179586;const float czm_pixelRatio=1.0;uniform vec3 u_SunLightDirectionLocal;uniform vec3 u_SunLightDirectionGlobal;uniform vec3 u_SunLightColor;uniform float u_SunLightIntensity;uniform vec3 u_CameraPosition;uniform vec3 u_CameraDirection;"),vertexSource:M_("#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\n#if !defined(M_HIGHLIGHT_COLOR_MAX)\n#define M_HIGHLIGHT_COLOR_MAX 4\n#endif\n#define PI 3.141592653589793\nconst float czm_epsilon7=0.0000001;const float czm_twoPi=6.283185307179586;const float czm_pixelRatio=1.0;uniform vec3 u_SunLightDirectionLocal;uniform vec3 u_SunLightDirectionGlobal;uniform vec3 u_SunLightColor;uniform float u_SunLightIntensity;uniform vec3 u_CameraPosition;uniform vec3 u_CameraDirection;")},unpackAll:{fragmentSource:M_(y_),vertexSource:M_(y_)},sphereClipping:{fragmentSource:M_("#define GLSLIFY 1\nvoid main(){gl_FragColor=vec4(1.0);}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\nvoid main(){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1);}")},sphereBackground:{fragmentSource:M_("#define GLSLIFY 1\n#include <u_Color4>\n#include <u_Opacity>\n#include <c_define>\nvoid showLogDepth(float depth,vec2 currentFrustum){float farDepthFromNearPlusOne=currentFrustum.y-currentFrustum.x+1.0;float log2FarDepthFromNearPlusOne=log2(farDepthFromNearPlusOne);float oneOverLog2FarDepthFromNearPlusOne=1.0/log2FarDepthFromNearPlusOne;if(depth<=0.9999999||depth>farDepthFromNearPlusOne){discard;}float logDepth=log2(depth)*oneOverLog2FarDepthFromNearPlusOne;gl_FragColor=vec4(logDepth,logDepth,logDepth,1.0);}void main(){gl_FragColor=vec4(u_Color.rgb,u_Color.a*u_Opacity);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <fn_vertexLogDepth>\n#include <c_define>\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\nvoid main(){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.);}")},sphereBackgroundPattern:{fragmentSource:M_("#define GLSLIFY 1\n#include <u_BaseColorSampler>\nuniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;\n#include <u_Opacity>\nvarying vec2 v_pos_a;varying vec2 v_pos_b;void main(){vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_BaseColorSampler,pos);gl_FragColor=vec4(color1.rgb,color1.a*u_Opacity);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <u_Zoom>\nvarying vec2 v_pos_a;varying vec2 v_pos_b;attribute vec2 a_TEXCOORD_0;void main(){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);v_pos_a=a_TEXCOORD_0*70.0*u_Zoom;v_pos_b=a_TEXCOORD_0*70.0*u_Zoom;}")},collisionBox:{fragmentSource:M_("#define GLSLIFY 1\nvarying float v_placed;varying float v_notUsed;void main(){float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,alpha);if(v_placed>0.5){gl_FragColor=vec4(0.0,0.0,1.0,0.5*alpha);}if(v_notUsed>0.5){gl_FragColor.a*=.1;}}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION2>\nattribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;\n#include <u_ModelViewProjectionMatrix>\nuniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main(){vec4 projectedPoint=u_ModelViewProjectionMatrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,0.0,1.0);gl_Position.xy+=a_extrude*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}")},collisionCircle:{fragmentSource:M_("#define GLSLIFY 1\nuniform float u_overscale_factor;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;varying float v_placed;varying float v_notUsed;void main(){float alpha=0.5;vec4 color=vec4(1.0,0.0,0.0,1.0)*alpha;if(v_placed>0.5){color=vec4(0.0,0.0,1.0,0.5)*alpha;}if(v_notUsed>0.5){color*=.2;}float extrude_scale_length=length(v_extrude_scale);float extrude_length=length(v_extrude)*extrude_scale_length;float stroke_width=15.0*extrude_scale_length/u_overscale_factor;float radius=v_radius*extrude_scale_length;float distance_to_edge=abs(extrude_length-radius);float opacity_t=smoothstep(-stroke_width,0.0,-distance_to_edge);gl_FragColor=vec4(color.rgb,color.a*opacity_t);}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION2>\nattribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;\n#include <u_ModelViewProjectionMatrix>\nuniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;void main(){vec4 projectedPoint=u_ModelViewProjectionMatrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,0.0,1.0);highp float padding_factor=1.2;gl_Position.xy+=a_extrude*u_extrude_scale*padding_factor*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;v_radius=abs(a_extrude.y);v_extrude=a_extrude*padding_factor;v_extrude_scale=u_extrude_scale*u_camera_to_center_distance*collision_perspective_ratio;}")},debug:{fragmentSource:M_("#define GLSLIFY 1\n#include <u_Color4>\nvoid main(){gl_FragColor=u_Color;}"),vertexSource:M_("#define GLSLIFY 1\n#include <u_ModelViewProjectionMatrix>\n#include <a_POSITION3>\nvoid main(){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1);}")},sun:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D u_SunTexture;varying vec2 v_TexCoord;void main(){vec4 color=texture2D(u_SunTexture,v_TexCoord);if(color.a<0.1){discard;}gl_FragColor=color;}"),vertexSource:M_("#define GLSLIFY 1\nattribute vec3 a_POSITION;attribute vec2 a_TEXCOORD_0;attribute vec2 a_UVOffset;uniform mat4 u_MVMatrix;uniform mat4 u_ProjectionMatrix;uniform vec2 u_PixelResolution;uniform mat4 u_ViewportTransformation;uniform vec4 u_Viewport;varying vec2 v_TexCoord;void main(){v_TexCoord.x=a_TEXCOORD_0.x;v_TexCoord.y=1.0-a_TEXCOORD_0.y;vec2 offset=vec2(0.0);offset=(a_POSITION.xy-vec2(0.5,0.5))*u_PixelResolution;vec4 viewPos=u_MVMatrix*vec4(0.0,0.0,0.0,1.0);vec4 center=u_ProjectionMatrix*viewPos;center=center/center.w;vec2 screenLocation=(u_ViewportTransformation*center).xy+offset;gl_Position.x=((screenLocation.x-u_Viewport[0])/u_Viewport[2])*2.0-1.0;gl_Position.y=((screenLocation.y-u_Viewport[1])/u_Viewport[3])*2.0-1.0;if(viewPos.z<0.0){gl_Position.z=min(center.z,0.999999);}else{gl_Position.z=center.z;}gl_Position.w=1.0;}")},sphere:{fragmentSource:M_("#define GLSLIFY 1\n#include <c_define>\n#include <fn_writeLogDepth>\n#include <fn_getBlinnPhongColor>\nuniform sampler2D u_earthMap;uniform sampler2D u_earthCloudMap;uniform sampler2D u_earthNightMap;\n#include <v_TexCoord2>\n#include <v_Normal3>\nvarying vec3 v_world_pos;uniform float u_earthTime;uniform bool u_NightVisible;uniform highp float u_DayTexPercent;uniform vec4 u_GlobalInnerColor;uniform vec4 u_LightPer;uniform vec2 u_NightGlobalPer;void main(){vec4 globalColor=vec4(0.0);\n#ifdef M_HAS_BASE_MAP\nglobalColor+=texture2D(u_earthMap,v_TexCoord);\n#endif\nglobalColor.xyz=u_LightPer.w*pow(globalColor.xyz,vec3(2.2));vec4 cloudColor=vec4(0.0);\n#ifdef M_HAS_CLOUD_MAP\ncloudColor=texture2D(u_earthCloudMap,vec2(v_TexCoord.x+u_earthTime*u_LightPer.y,v_TexCoord.y));cloudColor.rgb=pow(cloudColor.rgb,vec3(2.2));\n#endif\nvec4 nightLightColor=vec4(0.0);\n#ifdef M_HAS_NIGHT_MAP\nnightLightColor=u_LightPer.z*texture2D(u_earthNightMap,v_TexCoord);\n#endif\nvec3 N=normalize(v_Normal);vec3 LightDir=u_SunLightDirectionGlobal;vec3 V=normalize(u_CameraPosition-v_world_pos);vec3 H=normalize(LightDir+V);float specularPer=pow(max(dot(H,N),0.0),32.0);vec3 specularLight=specularPer*0.0*vec3(1.0,1.0,1.0);float rimPower=u_GlobalInnerColor.w;float ndv=dot(N,V);if(ndv<0.0){discard;}vec3 innerRing=(u_GlobalInnerColor.xyz*pow(1.0-ndv,rimPower));float NL=dot(LightDir,N);vec3 FinalColor=globalColor.xyz;\n#ifdef M_HAS_NIGHT_MAP\nconst float threshold=0.2;float y=0.5*NL/threshold+0.5;if(NL>threshold){FinalColor=globalColor.xyz*NL+u_NightGlobalPer.x*globalColor.xyz+specularLight+innerRing+cloudColor.xyz;}else if(NL>-threshold){float z=(1.0-y);FinalColor=y*NL*globalColor.xyz+z*nightLightColor.xyz+u_NightGlobalPer.x*globalColor.xyz+innerRing+max(u_NightGlobalPer.y,y)*cloudColor.xyz;}else{FinalColor=nightLightColor.xyz+u_NightGlobalPer.x*globalColor.xyz+innerRing+max(u_NightGlobalPer.y,y)*cloudColor.xyz;}\n#else\nFinalColor=globalColor.xyz+innerRing+cloudColor.xyz;\n#endif\nif(u_NightVisible==false)FinalColor=globalColor.xyz+innerRing+cloudColor.xyz;FinalColor=mix(FinalColor,globalColor.xyz,u_DayTexPercent);gl_FragColor=vec4(pow(FinalColor,vec3(1.0/2.2)),1.0);\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <c_define>\n#ifdef M_DOUBLEPRECISION\n#include <a_DOUBLE_PRECISION_POSITION>\n#else\n#include <a_POSITION3>\n#endif\n#include <a_TEXCOORD_0>\n#include <u_ModelViewProjectionMatrix>\n#include <v_Normal3>\n#include <v_TexCoord2>\nvarying vec3 v_world_pos;\n#include <fn_vertexLogDepth>\n#include <u_ModelViewProjectionRelativeToEye>\n#include <u_EncodedCameraPosition>\n#include <fn_translateRelativeToEye>\nvoid main(){\n#ifdef M_DOUBLEPRECISION\ngl_Position=u_ModelViewProjectionRelativeToEye*translateRelativeToEye(a_PositionHigh,a_PositionLow);v_world_pos=a_PositionHigh+a_PositionLow;\n#else\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1);v_world_pos=a_POSITION;\n#endif\nv_TexCoord=a_TEXCOORD_0;v_Normal=v_world_pos;\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n}")},sphereAtmosphere:{fragmentSource:M_("#define GLSLIFY 1\n#include <fn_writeLogDepth>\n#include <c_define>\nuniform vec4 u_GlobalOuterColor;uniform vec4 u_GlobalOuterPara;\n#include <v_Normal3>\nvarying vec3 v_world_pos;varying vec3 v_worldAtmos_pos;uniform highp float u_DayTexPercent;void main(){float _OutLightPow=u_GlobalOuterPara.y;float _OutLightStrength=u_GlobalOuterPara.z;vec3 N=normalize(v_Normal);vec3 V=normalize(u_CameraPosition-v_world_pos);float ndv=dot(N,V);float Alpha=pow(clamp(ndv,0.0,1.0),_OutLightPow);Alpha*=_OutLightStrength*ndv;gl_FragColor=vec4(u_GlobalOuterColor.xyz,Alpha*(1.0-u_DayTexPercent));\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <fn_vertexLogDepth>\n#include <c_define>\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\nvarying vec3 v_Normal;varying vec3 v_world_pos;varying vec3 v_worldAtmos_pos;uniform vec4 u_GlobalOuterPara;void main(){v_Normal=a_POSITION;v_world_pos=a_POSITION;v_Normal=normalize(v_Normal);float _Size=u_GlobalOuterPara.x;gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION+v_Normal*_Size,1.0);v_worldAtmos_pos=a_POSITION+v_Normal*_Size;\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n}")},sphereRaster:{fragmentSource:M_("#define GLSLIFY 1\nuniform float u_fade_t;uniform vec4 u_BackgroundColor;\n#include <u_Opacity>\n#if M_TEXTURE_UNITS > 0\nuniform sampler2D u_Texture[M_TEXTURE_UNITS];uniform vec4 u_TextureTexCoordsRectangle[M_TEXTURE_UNITS];uniform vec4 u_TextureTranslationAndScale[M_TEXTURE_UNITS];uniform float u_TextureAlpha[M_TEXTURE_UNITS];uniform float u_TextureBrightnessMin[M_TEXTURE_UNITS];uniform float u_TextureBrightnessMax[M_TEXTURE_UNITS];uniform float u_TextureSaturationFactor[M_TEXTURE_UNITS];uniform float u_TextureContrastFactor[M_TEXTURE_UNITS];uniform vec3 u_TextureSpinWeight[M_TEXTURE_UNITS];uniform bool u_TextureAlphaPremultiplied[M_TEXTURE_UNITS];\n#endif\nuniform float u_DiscardOffset;varying vec2 v_pos0;varying vec2 v_pos1;varying vec3 v_world_pos;varying vec4 v_Color;vec3 Ka=vec3(0.25);vec3 Kd=vec3(0.4);vec3 Ks=vec3(0.774597);vec3 Ke=vec3(0.1,0.1,0.1);float shininess=0.4;\n#include <u_ModelMatrix>\n#include <fn_pixelInVideo>\n#include <fn_writeLogDepth>\n#include <fn_encodeFloat>\n#include <fn_decodeFloat>\n#include <fn_getBlinnPhongColor>\n#include <v_LocalPosition>\n#include <v_Normal3>\n#include <s_LightMaterial>\n#include <fn_phong>\n#include <c_define>\nuniform sampler2D u_MaskSample;\n#include <u_ClipMatrix>\nuniform vec2 u_TextureSize;uniform bool u_ClipVideo;\n#if (defined M_NUM_VIDEOS) && (M_NUM_VIDEOS>0)\nuniform highp mat4 u_VIDEOMATCH_MVPMATRIX[M_NUM_VIDEOS];uniform highp vec3 u_VIDEOMATCH_RTP[M_NUM_VIDEOS];uniform bool u_HAS_VIDEOMATCHMAP[M_NUM_VIDEOS];uniform float u_Alpha[M_NUM_VIDEOS];uniform highp sampler2D u_VideoSampler[M_NUM_VIDEOS];uniform bool u_ActiveClipVideoTexture[M_NUM_VIDEOS];uniform vec3 u_ClipColors[M_NUM_VIDEOS];\n#endif\nvec4 blendColor(in vec4 prevColor,in vec4 currentColor){vec4 colorB=prevColor;vec4 colorT=currentColor;float alphaB=prevColor.a;float alphaT=currentColor.a;float alphaF=alphaT+alphaB*(1.0-alphaT);vec4 colorF=(colorT*alphaT+colorB*alphaB*(1.0-alphaT))/alphaF;vec4 blendT=alphaB*colorF+(1.0-alphaB)*colorT;vec4 outColor=(blendT*alphaT+colorB*alphaB*(1.0-alphaT))/alphaF;return outColor;}vec4 computeProperty(vec4 previousColor,vec3 textureSpinWeight,float textureSaturationFactor,float textureContrastFactor,float textureBrightnessMin,float textureBrightnessMax){vec3 inColor=previousColor.rgb;float inAlpha=previousColor.a;vec3 rgb=vec3(dot(inColor,textureSpinWeight.xyz),dot(inColor,textureSpinWeight.zxy),dot(inColor,textureSpinWeight.yzx));float average=(inColor.r+inColor.g+inColor.b)/3.0;rgb+=(average-rgb)*textureSaturationFactor;rgb=(rgb-0.5)*textureContrastFactor+0.5;vec3 u_high_vec=vec3(textureBrightnessMin,textureBrightnessMin,textureBrightnessMin);vec3 u_low_vec=vec3(textureBrightnessMax,textureBrightnessMax,textureBrightnessMax);return vec4(mix(u_high_vec,u_low_vec,rgb),inAlpha);}vec4 sampleAndComputePropertyColor(vec4 previousColor,sampler2D textureToSample,vec2 tileTextureCoordinates,vec4 textureCoordinateRectangle,vec4 textureCoordinateTranslationAndScale,float textureAlpha,vec3 textureSpinWeight,float saturationFactor,float contrastFactor,float brightnessMin,float brightnessMax,bool textureAlphaPremultiplied){vec2 alphaMultiplier=step(textureCoordinateRectangle.st,tileTextureCoordinates);textureAlpha=textureAlpha*alphaMultiplier.x*alphaMultiplier.y;alphaMultiplier=step(vec2(0.0),textureCoordinateRectangle.pq-tileTextureCoordinates);textureAlpha=textureAlpha*alphaMultiplier.x*alphaMultiplier.y;vec2 translation=textureCoordinateTranslationAndScale.xy;vec2 scaleValue=textureCoordinateTranslationAndScale.zw;vec2 textureCoordinates=tileTextureCoordinates*scaleValue+translation;vec4 value=texture2D(textureToSample,textureCoordinates);if(value.a>0.01){value=computeProperty(value,textureSpinWeight,saturationFactor,contrastFactor,brightnessMin,brightnessMax);}float sourceAlpha=value.a*textureAlpha;float outAlpha=mix(previousColor.a,1.0,sourceAlpha);outAlpha+=sign(outAlpha)-1.0;vec3 outColor;if(textureAlphaPremultiplied){outColor=(previousColor.rgb*previousColor.a*(1.0-sourceAlpha)+value.rgb)/outAlpha;}else{outColor=mix(previousColor.rgb*previousColor.a,value.rgb,sourceAlpha)/outAlpha;}return vec4(outColor,max(outAlpha,0.0));}\n#if M_TEXTURE_UNITS > 0\nvec4 computeDayColor(vec4 initialColor,vec2 textureCoordinates){vec4 color=initialColor;for(int i=0;i<M_TEXTURE_UNITS;i++){color=sampleAndComputePropertyColor(color,u_Texture[i],textureCoordinates,u_TextureTexCoordsRectangle[i],u_TextureTranslationAndScale[i],u_TextureAlpha[i],u_TextureSpinWeight[i],u_TextureSaturationFactor[i],u_TextureContrastFactor[i],u_TextureBrightnessMin[i],u_TextureBrightnessMax[i],u_TextureAlphaPremultiplied[i]);}return color;}\n#endif\nvoid checkDiscard(){\n#ifdef M_NW_DISCARD\nif(v_pos0.s<0.5-u_DiscardOffset&&v_pos0.t<0.5-u_DiscardOffset){discard;}\n#endif\n#ifdef M_NE_DISCARD\nif(v_pos0.s>0.5+u_DiscardOffset&&v_pos0.t<0.5-u_DiscardOffset){discard;}\n#endif\n#ifdef M_SW_DISCARD\nif(v_pos0.s<0.5-u_DiscardOffset&&v_pos0.t>0.5+u_DiscardOffset){discard;}\n#endif\n#ifdef M_SE_DISCARD\nif(v_pos0.s>0.5+u_DiscardOffset&&v_pos0.t>0.5+u_DiscardOffset){discard;}\n#endif\n}void main(){checkDiscard();vec4 blankColor;\n#ifdef M_HAS_BACKGROUNDLAYER\nblankColor=u_BackgroundColor;\n#else\nblankColor=vec4(0.0,0.0,0.0,0.0);\n#endif\nvec4 color=blankColor;\n#if M_TEXTURE_UNITS > 0\ncolor=computeDayColor(color,clamp(v_pos0,0.0,1.0));\n#endif\n#ifdef M_PHONG_LIGHT\ngl_FragColor=vec4(ambient(),1.0)*color;\n#else\ngl_FragColor=color;\n#endif\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#if (defined M_NUM_VIDEOS) && (M_NUM_VIDEOS>0)\nfor(int i=0;i<M_NUM_VIDEOS;i++){if(u_HAS_VIDEOMATCHMAP[i]){if(u_ClipVideo){if(pixelInVideo(u_VIDEOMATCH_MVPMATRIX[i],u_VIDEOMATCH_RTP[i],u_ModelMatrix,v_LocalPosition,u_VideoSampler[i],u_Alpha[i],u_ClipMatrix,u_MaskSample,u_TextureSize,u_ActiveClipVideoTexture[i],u_ClipColors[i])){continue;}}else{if(pixelInVideo(u_VIDEOMATCH_MVPMATRIX[i],u_VIDEOMATCH_RTP[i],u_ModelMatrix,v_LocalPosition,u_VideoSampler[i],u_Alpha[i],u_ClipMatrix,u_MaskSample,u_TextureSize,false,u_ClipColors[i])){continue;}}}}\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION3>\nattribute vec2 a_texture_pos;\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelMatrix>\nuniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;\n#include <c_define>\n#include <v_LocalPosition>\n#include <v_Normal3>\nvarying vec2 v_pos0;varying vec2 v_pos1;varying vec3 v_world_pos;varying vec4 v_Color;\n#include <fn_vertexLogDepth>\n#include <v_LIGHT>\nvoid main(){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1);v_LocalPosition=vec4(a_POSITION,1);vec4 geographic=u_ModelMatrix*vec4(a_POSITION,1.);v_world_pos=geographic.xyz;vec4 color=vec4(1.0,1.0,1.0,1.0);v_Color=color;v_pos0=a_texture_pos/32767.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;vec4 sunlight_position=u_ModelMatrix*vec4(a_POSITION,1.);v_Normal=sunlight_position.xyz;\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n}")},sphereImage:{fragmentSource:M_("#define GLSLIFY 1\n#include <u_Opacity>\nuniform sampler2D u_BaseColorSampler;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;varying vec2 v_pos0;\n#include <u_ModelMatrix>\n#include <fn_pixelInVideo>\n#include <fn_writeLogDepth>\n#include <fn_encodeFloat>\n#include <fn_decodeFloat>\n#include <fn_getBlinnPhongColor>\n#include <v_LocalPosition>\n#include <v_Normal3>\n#include <c_define>\n#include <u_ClipMatrix>\nvoid main(){vec4 color=texture2D(u_BaseColorSampler,v_pos0);if(color.a>0.0){color.rgb=color.rgb/color.a;}else{discard;}color.a*=u_Opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec4 out_color=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);gl_FragColor=vec4(out_color.xyz,out_color.w*u_Opacity);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION3>\nattribute vec2 a_texture_pos;\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelMatrix>\nuniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;\n#include <c_define>\n#include <v_LocalPosition>\n#include <v_Normal3>\nvarying vec2 v_pos0;varying vec2 v_pos1;varying vec3 v_world_pos;varying vec4 v_Color;\n#include <fn_vertexLogDepth>\nvoid main(){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1);v_LocalPosition=vec4(a_POSITION,1);vec4 geographic=u_ModelMatrix*vec4(a_POSITION,1.);v_world_pos=geographic.xyz;vec4 color=vec4(1.0,1.0,1.0,1.0);v_Color=color;v_pos0=a_texture_pos/32767.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;vec4 sunlight_position=u_ModelMatrix*vec4(a_POSITION,1.);v_Normal=sunlight_position.xyz;\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n}")},sphereSymbolIcon:{fragmentSource:M_(x_),vertexSource:M_(v_)},sphereSymbolSDF:{fragmentSource:M_(w_),vertexSource:M_(T_)},sphereFill:{fragmentSource:M_("#define GLSLIFY 1\n#include <pragma_base_define>\n#include <pragma_fill_define>\n#include <c_define>\n#include <c_fillF>\n#include <fn_writeLogDepth>\n#include <fn_encodeFloat>\nvoid main(){\n#include <pragma_base_initialize>\n#include <pragma_fill_initialize>\nfloat finalOpacity=color.a*opacity;if(finalOpacity==0.0){discard;}gl_FragColor=vec4(color.rgb,finalOpacity);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION3>\nattribute vec2 a_ST;\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelMatrix>\n#include <u_Resolution>\n#include <u_Bearing>\nuniform mat4 u_Matrix;\n#include <pragma_base_define>\n#include <pragma_fill_define>\n#include <c_fillV>\n#include <c_define>\n#include <fn_vertexLogDepth>\nvoid main(){\n#include <pragma_base_initialize>\n#include <pragma_fill_initialize>\n#ifdef M_CANVAS_2D\ngl_Position=u_Matrix*vec4(a_ST*1024.0,0,1);\n#else\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1);vec2 translate=u_translate;float translate_anchor=u_translate_anchor;if(translate_anchor==0.0){float sinA=sin(-u_Bearing);float cosA=cos(-u_Bearing);translate=vec2(translate[0]*cosA-translate[1]*sinA,translate[0]*sinA+translate[1]*cosA);}gl_Position.xy+=translate/vec2(u_Resolution.x/2.0,-u_Resolution.y/2.0)*gl_Position.w;\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n#endif\n}")},sphereFillPattern:{fragmentSource:M_("#define GLSLIFY 1\n#include <u_BaseColorSampler>\n#include <pragma_base_define>\n#include <pragma_fill_define>\n#include <c_fillF>\n#include <fn_rotateTexCoord>\nuniform vec2 u_offset;uniform float u_rotation;uniform float u_scale;uniform bool u_HasTexture;\n#pragma minemap: define lowp vec4 pattern_from\n#pragma minemap: define lowp vec4 pattern_to\nvoid main(){\n#pragma minemap: initialize mediump vec4 pattern_from\n#pragma minemap: initialize mediump vec4 pattern_to\n#include <pragma_base_initialize>\n#include <pragma_fill_initialize>\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;if(u_HasTexture){vec2 imageCoord=mod(abs(v_pos_a),1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imageCoord);vec4 color1=texture2D(u_BaseColorSampler,pos);vec2 imageCoord_b=mod(abs(v_pos_b+u_offset)/u_scale,1.0);vec2 finalImageCoord=rotateTexCoord(imageCoord_b,u_rotation);if(finalImageCoord.x<0.0||finalImageCoord.x>1.0||finalImageCoord.y>1.0||finalImageCoord.y<0.0){discard;}vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,finalImageCoord);vec4 color2=texture2D(u_BaseColorSampler,pos2);vec4 mixedColor=mix(color1,color2,u_mix);float finalOpacity=mixedColor.a*opacity;if(finalOpacity==0.0){discard;}gl_FragColor=vec4(mixedColor.rgb,finalOpacity);}else{float finalOpacity=color.a*opacity;if(finalOpacity==0.0){discard;}gl_FragColor=vec4(color.rgb,finalOpacity);}\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION3>\nattribute vec2 a_ST;\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelMatrix>\n#include <u_Resolution>\n#include <u_Bearing>\nuniform mat4 u_Matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;uniform float u_scale_a;uniform float u_scale_b;\n#include <pragma_base_define>\n#include <pragma_fill_define>\n#include <c_fillV>\nuniform float u_TileZoomFactor;\n#pragma minemap: define lowp vec4 pattern_from\n#pragma minemap: define lowp vec4 pattern_to\n#pragma minemap: define lowp float pixel_ratio_from\n#pragma minemap: define lowp float pixel_ratio_to\nvoid main(){\n#pragma minemap: initialize mediump vec4 pattern_from\n#pragma minemap: initialize mediump vec4 pattern_to\n#pragma minemap: initialize lowp float pixel_ratio_from\n#pragma minemap: initialize lowp float pixel_ratio_to\n#include <pragma_base_initialize>\n#include <pragma_fill_initialize>\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef M_CANVAS_2D\ngl_Position=u_Matrix*vec4(a_ST*1024.0,0,1);\n#else\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1);vec2 translate=u_translate;float translate_anchor=u_translate_anchor;if(translate_anchor==0.0){float sinA=sin(-u_Bearing);float cosA=cos(-u_Bearing);translate=vec2(translate[0]*cosA-translate[1]*sinA,translate[0]*sinA+translate[1]*cosA);}gl_Position.xy+=translate/vec2(u_Resolution.x/2.0,-u_Resolution.y/2.0)*gl_Position.w;\n#endif\nv_pos_a=a_ST*u_TileZoomFactor;v_pos_b=a_ST*u_TileZoomFactor;}")},sphereFillOutline:{fragmentSource:M_("#define GLSLIFY 1\nuniform float u_Opacity;\n#include <c_fillF>\nvarying vec4 v_COLOR;varying float v_DiscardPixel;void main(){\n#ifndef M_CANVAS_2D\nif(v_DiscardPixel<0.){discard;}\n#endif\nfloat finalOpacity=v_COLOR.a/255.0*u_Opacity;if(finalOpacity==0.0){discard;}float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=vec4(v_COLOR.rgb/255.0,finalOpacity);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\nattribute vec4 a_OUTLINE_COLOR;\n#include <a_POSITION3>\nattribute vec2 a_ST;\n#include <u_ModelViewProjectionMatrix>\n#include <u_Resolution>\n#include <u_Bearing>\n#include <u_World>\nuniform mat4 u_Matrix;\n#include <c_fillV>\nvarying vec4 v_COLOR;varying float v_DiscardPixel;void main(){\n#ifdef M_CANVAS_2D\ngl_Position=u_Matrix*vec4(a_ST*1024.0,0,1);\n#else\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1);vec2 translate=u_translate;float translate_anchor=u_translate_anchor;if(translate_anchor==0.0){float sinA=sin(-u_Bearing);float cosA=cos(-u_Bearing);translate=vec2(translate[0]*cosA-translate[1]*sinA,translate[0]*sinA+translate[1]*cosA);}gl_Position.xy+=translate/vec2(u_Resolution.x/2.0,-u_Resolution.y/2.0)*gl_Position.w;v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_World;v_DiscardPixel=getVectorPointVisibilityValue(a_POSITION,u_ModelMatrix,u_CameraPosition,u_CameraDirection);\n#endif\nv_COLOR=a_OUTLINE_COLOR;}")},sphereFillOutlinePattern:{fragmentSource:M_("#define GLSLIFY 1\n#include <u_BaseColorSampler>\n#include <pragma_base_define>\n#include <pragma_fill_define>\n#include <c_fillF>\nvoid main(){\n#include <pragma_base_initialize>\n#include <pragma_fill_initialize>\nvec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_BaseColorSampler,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_BaseColorSampler,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 mixedColor=mix(color1,color2,u_mix);gl_FragColor=vec4(mixedColor.rgb,mixedColor.a*opacity);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <u_Resolution>\n#include <u_Bearing>\n#include <u_World>\n#include <pragma_base_define>\n#include <pragma_fill_define>\n#include <c_fillV>\nvoid main(){\n#include <pragma_base_initialize>\n#include <pragma_fill_initialize>\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);vec2 translate=u_translate;float translate_anchor=u_translate_anchor;if(translate_anchor==0.0){float sinA=sin(-u_Bearing);float cosA=cos(-u_Bearing);translate=vec2(translate[0]*cosA-translate[1]*sinA,translate[0]*sinA+translate[1]*cosA);}gl_Position.xy+=translate/vec2(u_Resolution.x/2.0,-u_Resolution.y/2.0)*gl_Position.w;v_pos_a=a_ST;v_pos_b=a_ST;v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_World;}")},sphereLine:{fragmentSource:M_("#define GLSLIFY 1\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <c_define>\n#include <c_lineF>\nvarying float v_DiscardPixel;void main(){\n#ifndef M_CANVAS_2D\nif(v_DiscardPixel<0.){discard;}\n#endif\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nfloat dist=length(v_Normal)*v_width2.s;float blur2=(blur+1.0/M_DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifndef M_CANVAS_2D\nif(v_Normal.x>0.0&&alpha<0.5){discard;}\n#endif\ngl_FragColor=u_HasBorder ? vec4(bordercolor.rgb,bordercolor.a*(alpha*borderopacity)): vec4(color.rgb,color.a*(alpha*opacity));\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <u_Bearing>\nuniform mat4 u_Matrix;uniform mat2 u_PixelsToTileUnits;\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <c_define>\n#include <c_lineV>\nvarying float v_DiscardPixel;attribute vec2 a_extra_extrude;void main(){\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;mediump vec2 normal;\n#ifdef M_CANVAS_2D\nvec2 pos=floor(a_pos_normal*0.5);normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;\n#else\nnormal=vec2(a_NORMAL/2.0>=1.0 ? 1.0 : 0.0,mod(a_NORMAL,2.0)==1.0 ? 1.0 :-1.0);\n#endif\nv_Normal=normal;float constant=width==0.0 ? 0.0 : ANTIALIASING;float inset=0.0;float outset=0.0;float halfwidth=0.0;if(u_HasBorder){gapwidth=width/2.0;halfwidth=borderwidth;inset=gapwidth+constant;outset=gapwidth+halfwidth+constant;}else{halfwidth=width/2.0;gapwidth=gapwidth/2.0;inset=gapwidth+(gapwidth>0.0 ? constant : 0.0);outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+constant;}offset=-1.0*offset;if(u_HalfRender){if(normal_direction==1.){outset=2.0*(gapwidth+(normal.y>0. ? halfwidth : 0.))*(gapwidth>0.0 ? 2.0 : 1.0)+constant;}else{outset=2.0*(gapwidth+(normal.y<0. ? halfwidth : 0.))*(gapwidth>0.0 ? 2.0 : 1.0)+constant;}}mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist;\n#ifdef M_CANVAS_2D\ndist=outset*a_extrude*scale;\n#else\ndist=u_PixelMatrix*outset*a_extrude*scale;\n#endif\nvec2 extra_extrude=a_extra_extrude.xy-128.0;mediump vec2 extra_dist;\n#ifdef M_CANVAS_2D\nextra_dist=outset*extra_extrude*scale;\n#else\nextra_dist=u_PixelMatrix*outset*extra_extrude*scale;\n#endif\nmediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);\n#ifdef M_CANVAS_2D\nmat2 pixelsToTileUnits=u_PixelsToTileUnits*a_scale_terrain;vec4 projected_extrude;if(u_HasBorder){projected_extrude=u_Matrix*vec4(dist*pixelsToTileUnits,0.0,0.0);}else{projected_extrude=u_Matrix*vec4((dist+extra_dist)*pixelsToTileUnits,0.0,0.0);}gl_Position=u_Matrix*vec4(pos+offset2*pixelsToTileUnits,0.0,1.0)+projected_extrude;v_gamma_scale=1.0;\n#else\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION.xyz,1.0);if(u_HasBorder){gl_Position.xy+=dist/u_GlUnitsToPixels*gl_Position.w;}else{gl_Position.xy+=(dist+extra_dist)/u_GlUnitsToPixels*gl_Position.w;}v_DiscardPixel=getVectorPointVisibilityValue(a_POSITION,u_ModelMatrix,u_CameraPosition,u_CameraDirection);vec2 translate=u_translate;float translate_anchor=u_translate_anchor;if(translate_anchor==0.0){float sinA=sin(-u_Bearing);float cosA=cos(-u_Bearing);translate=vec2(translate[0]*cosA-translate[1]*sinA,translate[0]*sinA+translate[1]*cosA);}gl_Position.xy+=(offset2+translate)/u_GlUnitsToPixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n}")},sphereLineSDF:{fragmentSource:M_("#define GLSLIFY 1\n#include <u_BaseColorSampler>\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <c_define>\n#include <c_lineF>\nuniform float u_sdfgamma;uniform float u_mix;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_DiscardPixel;void main(){\n#if !defined M_CANVAS_2D\nif(v_DiscardPixel<0.){discard;}\n#endif\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nfloat dist=length(v_Normal)*v_width2.s;float blur2=(blur+1.0/M_DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_BaseColorSampler,v_tex_a).a;float sdfdist_b=texture2D(u_BaseColorSampler,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);\n#ifdef M_SHADOW_VOLUME\ngl_FragColor=vec4(color.rgb,color.a*alpha*opacity);\n#else\ngl_FragColor=u_HasBorder ? vec4(bordercolor.rgb,bordercolor.a*(alpha*borderopacity)): vec4(color.rgb,color.a*(alpha*opacity));\n#endif\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <u_Bearing>\nuniform mat4 u_Matrix;uniform mat2 u_PixelsToTileUnits;\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <c_define>\n#include <c_lineV>\nuniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_DiscardPixel;void main(){\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\n#ifdef M_CANVAS_2D\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_Normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_Matrix*vec4(dist*u_PixelsToTileUnits,0.0,0.0);gl_Position=u_Matrix*vec4(pos+offset2*u_PixelsToTileUnits,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_GlUnitsToPixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);\n#else\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;mediump vec2 normal=vec2(a_NORMAL/2.0>=1.0 ? 1.0 : 0.0,mod(a_NORMAL,2.0)==1.0 ? 1.0 :-1.0);v_Normal=normal;if(u_HasBorder){gapwidth=width/2.0;width=borderwidth/2.0;}else{gapwidth=gapwidth/2.0;}float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_PixelMatrix*outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);gl_Position.xy+=dist/u_GlUnitsToPixels*gl_Position.w;v_DiscardPixel=getVectorPointVisibilityValue(a_POSITION,u_ModelMatrix,u_CameraPosition,u_CameraDirection);vec2 translate=u_translate;float translate_anchor=u_translate_anchor;if(translate_anchor==0.0){float sinA=sin(-u_Bearing);float cosA=cos(-u_Bearing);translate=vec2(translate[0]*cosA-translate[1]*sinA,translate[0]*sinA+translate[1]*cosA);}gl_Position.xy+=(offset2+translate)/u_GlUnitsToPixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n#endif\n}")},sphereLinePattern:{fragmentSource:M_("#define GLSLIFY 1\n#include <u_BaseColorSampler>\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <c_define>\n#include <c_lineF>\nuniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;varying float v_width;varying float v_linesofar;varying float v_DiscardPixel;\n#pragma minemap: define lowp vec4 pattern_from\n#pragma minemap: define lowp vec4 pattern_to\n#pragma minemap: define lowp float pixel_ratio_from\n#pragma minemap: define lowp float pixel_ratio_to\nvoid main(){\n#pragma minemap: initialize mediump vec4 pattern_from\n#pragma minemap: initialize mediump vec4 pattern_to\n#pragma minemap: initialize lowp float pixel_ratio_from\n#pragma minemap: initialize lowp float pixel_ratio_to\n#ifndef M_CANVAS_2D\nif(v_DiscardPixel<0.){discard;}\n#endif\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float dist=length(v_Normal)*v_width2.s;float blur2=(blur+1.0/M_DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x,1.0);float x_b=mod(v_linesofar/pattern_size_b.x,1.0);float y=0.5*v_Normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));color=mix(texture2D(u_BaseColorSampler,pos_a),texture2D(u_BaseColorSampler,pos_b),u_fade);\n#ifdef M_SHADOW_VOLUME\ngl_FragColor=vec4(color.rgb,color.a*alpha*opacity);\n#else\ngl_FragColor=u_HasBorder ? vec4(bordercolor.rgb,bordercolor.a*(alpha*borderopacity)): vec4(color.rgb,color.a*(alpha*opacity));\n#endif\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <u_Bearing>\nuniform mat4 u_Matrix;uniform mat2 u_PixelsToTileUnits;\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <c_define>\n#include <c_lineV>\nvarying float v_linesofar;varying float v_DiscardPixel;varying float v_width;\n#pragma minemap: define lowp vec4 pattern_from\n#pragma minemap: define lowp vec4 pattern_to\n#pragma minemap: define lowp float pixel_ratio_from\n#pragma minemap: define lowp float pixel_ratio_to\nvoid main(){\n#pragma minemap: initialize mediump vec4 pattern_from\n#pragma minemap: initialize mediump vec4 pattern_to\n#pragma minemap: initialize lowp float pixel_ratio_from\n#pragma minemap: initialize lowp float pixel_ratio_to\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;mediump vec2 normal;\n#ifdef M_CANVAS_2D\nvec2 pos=floor(a_pos_normal*0.5);normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;\n#else\nnormal=vec2(a_NORMAL/2.0>=1.0 ? 1.0 : 0.0,mod(a_NORMAL,2.0)==1.0 ? 1.0 :-1.0);\n#endif\nv_Normal=normal;if(u_HasBorder){gapwidth=width/2.0;width=borderwidth/2.0;}else{gapwidth=gapwidth/2.0;}float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist;\n#ifdef M_CANVAS_2D\ndist=outset*a_extrude*scale;\n#else\ndist=u_PixelMatrix*outset*a_extrude*scale;\n#endif\nmediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);\n#ifdef M_CANVAS_2D\nmat2 pixelsToTileUnits=u_PixelsToTileUnits*a_scale_terrain;vec4 projected_extrude=u_Matrix*vec4(dist*pixelsToTileUnits,0.0,0.0);gl_Position=u_Matrix*vec4(pos+offset2*pixelsToTileUnits,0.0,1.0)+projected_extrude;v_gamma_scale=1.0;\n#else\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);gl_Position.xy+=dist/u_GlUnitsToPixels*gl_Position.w;v_DiscardPixel=getVectorPointVisibilityValue(a_POSITION,u_ModelMatrix,u_CameraPosition,u_CameraDirection);vec2 translate=u_translate;float translate_anchor=u_translate_anchor;if(translate_anchor==0.0){float sinA=sin(-u_Bearing);float cosA=cos(-u_Bearing);translate=vec2(translate[0]*cosA-translate[1]*sinA,translate[0]*sinA+translate[1]*cosA);}gl_Position.xy+=(offset2+translate)/u_GlUnitsToPixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n}")},sphereLineGradient:{fragmentSource:M_("#define GLSLIFY 1\n#include <u_BaseColorSampler>\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <c_define>\n#include <c_lineF>\n#include <v_TexCoord2>\nvarying float v_DiscardPixel;void main(){\n#ifndef M_CANVAS_2D\nif(v_DiscardPixel<0.){discard;}\n#endif\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nfloat dist=length(v_Normal)*v_width2.s;float blur2=(blur+1.0/M_DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);color=texture2D(u_BaseColorSampler,v_TexCoord);\n#ifdef M_SHADOW_VOLUME\ngl_FragColor=vec4(color.rgb,color.a*alpha*opacity);\n#else\ngl_FragColor=u_HasBorder ? vec4(bordercolor.rgb,bordercolor.a*(alpha*borderopacity)): vec4(color.rgb,color.a*(alpha*opacity));\n#endif\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <u_Bearing>\nuniform mat4 u_Matrix;uniform mat2 u_PixelsToTileUnits;\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <c_define>\n#include <c_lineV>\nattribute float a_uv_x;attribute float a_split_index;uniform float u_image_height;\n#include <v_TexCoord2>\nvarying float v_DiscardPixel;void main(){\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_TexCoord=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);mediump vec2 normal;\n#ifdef M_CANVAS_2D\nvec2 pos=floor(a_pos_normal*0.5);normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;\n#else\nnormal=vec2(a_NORMAL/2.0>=1.0 ? 1.0 : 0.0,mod(a_NORMAL,2.0)==1.0 ? 1.0 :-1.0);\n#endif\nv_Normal=normal;if(u_HasBorder){gapwidth=width/2.0;width=borderwidth/2.0;}else{gapwidth=gapwidth/2.0;}float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist;\n#ifdef M_CANVAS_2D\ndist=outset*a_extrude*scale;\n#else\ndist=u_PixelMatrix*outset*a_extrude*scale;\n#endif\nmediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);\n#ifdef M_CANVAS_2D\nmat2 pixelsToTileUnits=u_PixelsToTileUnits*a_scale_terrain;vec4 projected_extrude=u_Matrix*vec4(dist*pixelsToTileUnits,0.0,0.0);gl_Position=u_Matrix*vec4(pos+offset2*pixelsToTileUnits,0.0,1.0)+projected_extrude;v_gamma_scale=1.0;\n#else\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);gl_Position.xy+=dist/u_GlUnitsToPixels*gl_Position.w;v_DiscardPixel=getVectorPointVisibilityValue(a_POSITION,u_ModelMatrix,u_CameraPosition,u_CameraDirection);vec2 translate=u_translate;float translate_anchor=u_translate_anchor;if(translate_anchor==0.0){float sinA=sin(-u_Bearing);float cosA=cos(-u_Bearing);translate=vec2(translate[0]*cosA-translate[1]*sinA,translate[0]*sinA+translate[1]*cosA);}gl_Position.xy+=(offset2+translate)/u_GlUnitsToPixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n}")},sphereHeatmap:{fragmentSource:M_("#define GLSLIFY 1\n#include <pragma_heatmap_define>\n#include <c_define>\nuniform highp float u_Intensity;uniform sampler2D u_color_ramp;\n#include <u_Opacity>\nvarying vec2 v_extrude;void main(){\n#include <pragma_heatmap_initialize>\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_Intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,0.0,1.0);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <pragma_heatmap_define>\n#include <c_define>\nattribute vec2 a_pos;attribute vec3 a_pos_vec3;attribute vec2 a_extrude;\n#include <u_ModelViewProjectionMatrix>\nuniform float u_extrude_scale;\n#include <u_Opacity>\nuniform float u_Intensity;\n#include <u_Resolution>\n#include <u_PixelMatrix>\nuniform mat4 u_Matrix;varying float v_value;varying vec2 v_extrude;void main(void){\n#include <pragma_heatmap_initialize>\nfloat S=sqrt(-2.0*log(ZERO/weight/u_Intensity/GAUSS_COEF))/3.0;v_extrude=S*a_extrude;\n#ifdef M_CANVAS_2D\nvec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);gl_Position=u_Matrix*vec4(tilePos+extrude,0.0,1.0);\n#else\nvec2 scaled_extrude=u_PixelMatrix*S*a_extrude;vec4 temppos=vec4(a_pos_vec3,1);vec4 trans_pos=u_ModelViewProjectionMatrix*temppos;vec2 screen_pos=vec2(trans_pos.x/trans_pos.w*u_Resolution.y/2.0+scaled_extrude.x*radius*u_Resolution.y/u_Resolution.x,trans_pos.y/trans_pos.w*u_Resolution.y/2.0+scaled_extrude.y*radius);gl_Position=vec4(screen_pos*trans_pos.w*2.0/u_Resolution.y,trans_pos.z,trans_pos.w);\n#endif\n}")},heatmapTexture:{fragmentSource:M_("#define GLSLIFY 1\n#include <u_BaseColorSampler>\n#include <v_TexCoord2>\n#include <c_define>\nuniform highp float u_Intensity;uniform sampler2D u_color_ramp;\n#include <u_Opacity>\nvarying vec2 v_extrude;void main(){float t=texture2D(u_BaseColorSampler,v_TexCoord).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=vec4(color.rgb,color.a*u_Opacity);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION2>\n#include <u_ModelViewProjectionMatrix>\n#include <v_TexCoord2>\n#include <c_define>\nuniform float u_extrude_scale;\n#include <u_Opacity>\nuniform float u_Intensity;\n#include <u_World>\nvarying vec2 v_extrude;void main(){\n#ifdef M_CANVAS_2D\ngl_Position=vec4((a_POSITION-0.5)*2.0,0,1);v_TexCoord=a_POSITION;\n#else\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION*u_World,0,1);v_TexCoord.x=a_POSITION.x;v_TexCoord.y=1.0-a_POSITION.y;\n#endif\n}")},heatmap3DTexture:{fragmentSource:M_("#define GLSLIFY 1\n#include <u_BaseColorSampler>\n#include <u_Opacity>\nuniform sampler2D u_color_ramp;\n#include <v_TexCoord2>\nvarying float v_Alpha;void main(){if(v_Alpha==-1.0){discard;}vec4 color=texture2D(u_color_ramp,vec2(v_Alpha,0.5));gl_FragColor=vec4(color.rgb,color.a*u_Opacity);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}"),vertexSource:M_("precision highp float;\n#define GLSLIFY 1\n#include <u_ModelViewProjectionMatrix>\n#include <u_BaseColorSampler>\nuniform float u_HeightFactor;uniform vec4 u_Bezier;uniform mat4 u_ViewMatrix;uniform mat4 u_ProjectionMatrix;uniform mat4 u_InverseProjection;uniform mat4 u_InvertViewMatrix;\n#include <a_POSITION3>\n#include <a_TEXCOORD_0>\nattribute vec3 a_NORMAL;\n#include <v_TexCoord2>\nvarying float v_Alpha;varying vec3 v_Normal;\n#include <fn_rayEllipsoidIntersectionInterval>\n#include <fn_getEllipsoidNormal>\nvec2 toBezierInner(float t,vec2 P0,vec2 P1,vec2 P2,vec2 P3){float t2=t*t;float one_minus_t=1.0-t;float one_minus_t2=one_minus_t*one_minus_t;return(P0*one_minus_t2*one_minus_t+P1*3.0*t*one_minus_t2+P2*3.0*t2*one_minus_t+P3*t2*t);}vec2 toBezier(float t,vec4 p){return toBezierInner(t,vec2(0.0,0.0),vec2(p.x,p.y),vec2(p.z,p.w),vec2(1.0,1.0));}float interpolate(float a,float b,float t){return(a*(1.0-t))+(b*t);}void main(){v_TexCoord=a_TEXCOORD_0;v_Alpha=texture2D(u_BaseColorSampler,v_TexCoord).r;vec4 spacePos=u_InverseProjection*vec4(a_POSITION,1.0);spacePos=spacePos/spacePos.w;spacePos.w=0.0;vec3 rayDir=(u_InvertViewMatrix*spacePos).xyz;vec3 normalizedRayDir=normalize(rayDir);vec2 interval=rayEllipsoidIntersectionInterval(u_CameraPosition,normalizedRayDir);if(interval.x==-infinity){v_Alpha=-1.0;gl_Position=vec4(a_POSITION,1);return;}float height1=toBezier(v_Alpha,u_Bezier).y;float height0=toBezier(0.0,u_Bezier).y;float height=(height1-height0);if(height<0.0){height=0.0;}height*=u_HeightFactor;vec3 cartesian=u_CameraPosition+normalizedRayDir*interval.x;vec3 normal=getEllipsoidNormal(cartesian);vec3 position=normal*height+cartesian-u_CameraPosition;vec4 viewPosition=u_ViewMatrix*vec4(position,1.0);gl_Position=u_ProjectionMatrix*viewPosition;}")},sphereCircle:{fragmentSource:M_("#define GLSLIFY 1\n#include <pragma_circle_define>\nvarying vec3 v_data;void main(){\n#include <pragma_circle_initialize>\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width<0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));vec4 tempColor=mix(vec4(color.rgb,color.a*opacity),vec4(stroke_color.rgb,stroke_color.a*stroke_opacity),color_t);tempColor.a*=opacity_t;gl_FragColor=tempColor;\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION3>\nattribute vec2 a_extra;\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelMatrix>\n#include <u_PixelMatrix>\nuniform vec2 u_GlUnitsToPixels;varying vec3 v_data;\n#include <pragma_circle_define>\n#include <c_define>\nvoid main(void){\n#include <pragma_circle_initialize>\nvec2 extrude=a_extra;mediump vec2 dist=u_PixelMatrix*(radius+stroke_width)*extrude;gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION.xyz,1.0);gl_Position.xy+=dist/u_GlUnitsToPixels*gl_Position.w;lowp float antialiasblur=1.0/M_DEVICE_PIXEL_RATIO/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}")},sphereExtrusion:{fragmentSource:M_("#define GLSLIFY 1\n#include <c_extrusionF>\n#include <c_define>\n#include <pragma_extrusion_define>\n#include <s_LightMaterial>\n#include <fn_phong>\nuniform highp sampler2D u_model_clippingPlanes;uniform vec4 u_model_clippingPlanesEdgeStyle;uniform mat4 u_model_clippingPlanesMatrix;\n#include <u_Viewport>\nuniform mat4 u_ViewportTransformation;uniform mat4 u_InverseProjection;\n#include <u_PixelRatio>\n#include <u_CurrentFrustum>\n#include <u_FrustumPlanes>\n#include <fn_primitiveClippingPlanes>\nuniform bool u_SelfBloom;uniform float u_Time;uniform float u_BloomHeight;uniform float u_PureColorHeight;uniform float u_BloomSpeed;uniform float u_GlowWidth;varying vec4 v_ModelPos;varying vec4 v_RelativePos;\n#include <u_LightMaterial>\nuniform float u_Shininess;uniform float u_Reflectivity;uniform vec3 u_sunLightGlobal;uniform float u_Roughness;varying vec3 v_LocalPosition;bool oppositeSigns(float x,float y){return(x<=0.&&y>=0.)||(x>=0.&&y<=0.);}\n#include <fn_writeLogDepth>\nvoid main(){\n#include <pragma_extrusion_initialize>\nif(color.a==0.||opacity==0.){discard;}vec4 finalColor=v_color;\n#ifdef M_OVERDRAW_INSPECTOR\nfinalColor=vec4(1.0);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n#ifdef M_HAS_CLIPPING_PLANES\nmodelClippingPlanesStage(finalColor);\n#endif\n#ifdef M_PHONG_LIGHT\nfinalColor=finalColor*vec4(phong(u_Reflectivity,v_Normal,u_sunLightGlobal,v_LocalPosition,u_Shininess,u_Roughness),1.0);\n#endif\nif(u_SelfBloom){float earthR=sqrt(v_RelativePos.x*v_RelativePos.x+v_RelativePos.y*v_RelativePos.y+v_RelativePos.z*v_RelativePos.z);float v_R_h=sqrt(v_ModelPos.x*v_ModelPos.x+v_ModelPos.y*v_ModelPos.y+v_ModelPos.z*v_ModelPos.z);float real_h=v_R_h-earthR;float dt_a12=clamp((real_h/u_PureColorHeight),0.0,1.0);finalColor*=vec4(dt_a12,dt_a12,dt_a12,1.0);float dt_a13=fract(u_Time/u_BloomSpeed);float dt_h=clamp((real_h/u_BloomHeight),0.0,1.0);dt_a13=abs(dt_a13-0.5)*2.0;float dt_diff=step(u_GlowWidth,abs(dt_h-dt_a13));finalColor.rgb+=finalColor.rgb*(1.0-dt_diff);}gl_FragColor=finalColor;}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <u_ViewProjectionMatrix>\n#include <u_ModelMatrix>\n#include <u_NormalMatrix>\n#include <u_Resolution>\n#include <u_Bearing>\n#include <c_define>\n#include <c_extrusionV>\n#include <pragma_extrusion_define>\n#ifdef M_ANS_ENABLED\nattribute vec3 a_ANS_NORMAL_WITH_LENGTH;attribute vec3 a_ANS_BASE_POSITION;attribute float a_ANS_POS_TIME_0;attribute float a_ANS_POS_TIME_1;uniform float u_ANS_CurrentTime;\n#endif\nvarying vec4 v_ModelPos;varying vec4 v_RelativePos;varying vec3 v_LocalPosition;\n#include <fn_vertexLogDepth>\nuniform vec3 u_lightPos;varying vec4 v_color;void main(){\n#include <pragma_extrusion_initialize>\nvec4 pos=u_ModelMatrix*vec4(a_POSITION,1.0);v_LocalPosition=vec3(pos.xyz)/pos.w;v_Normal=normalize(u_NormalMatrix*a_NORMAL_ED.xyz);\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n#ifdef M_ANS_ENABLED\nfloat weight0=(u_ANS_CurrentTime-a_ANS_POS_TIME_0)/(a_ANS_POS_TIME_1-a_ANS_POS_TIME_0);weight0=weight0>1.0 ? 1.0 : weight0;vec3 animatedPos=a_ANS_BASE_POSITION+a_ANS_NORMAL_WITH_LENGTH*weight0;gl_Position=u_ModelViewProjectionMatrix*vec4(animatedPos,1);\n#else\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1);\n#endif\nvec2 translate=u_translate;float translate_anchor=u_translate_anchor;if(translate_anchor==0.0){float sinA=sin(-u_Bearing);float cosA=cos(-u_Bearing);translate=vec2(translate[0]*cosA-translate[1]*sinA,translate[0]*sinA+translate[1]*cosA);}gl_Position.xy+=translate/vec2(u_Resolution.x/2.0,-u_Resolution.y/2.0)*gl_Position.w;vec3 normal=a_NORMAL_ED.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float u_lightintensity=0.5;float u_vertical_gradient=1.0;vec3 u_lightcolor=vec3(1.0);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);vec4 ambientColor=color+ambientlight;float directional=clamp(dot(normal/16384.0,u_lightPos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if(normal.y!=0.0){directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(ambientColor.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(ambientColor.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(ambientColor.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color.a=opacity;v_ModelPos=u_ModelMatrix*vec4(a_POSITION,1.0);v_RelativePos=u_ModelMatrix*vec4(0.0,0.0,0.0,1.0);v_RelativePos=v_RelativePos/v_RelativePos.w;v_ModelPos=v_ModelPos/v_ModelPos.w;}")},sphereExtrusionPattern:{fragmentSource:M_("#define GLSLIFY 1\n#include <u_BaseColorSampler>\nuniform sampler2D u_TopTexture;uniform vec2 u_offset;uniform float u_rotation;uniform float u_scale;\n#include <v_TexCoord2>\n#include <c_extrusionF>\n#include <pragma_extrusion_define>\n#include <s_LightMaterial>\n#include <fn_phong>\n#include <fn_rotateTexCoord>\n#include <u_LightMaterial>\nvarying vec4 modelPos;bool oppositeSigns(float x,float y){return(x<=0.&&y>=0.)||(x>=0.&&y<=0.);}\n#pragma minemap: define lowp vec4 pattern_from\n#pragma minemap: define lowp vec4 pattern_to\n#pragma minemap: define lowp float pixel_ratio_from\n#pragma minemap: define lowp float pixel_ratio_to\n#pragma minemap: define lowp vec4 top_pattern_from\n#pragma minemap: define lowp vec4 top_pattern_to\n#pragma minemap: define lowp float top_pixel_ratio_from\n#pragma minemap: define lowp float top_pixel_ratio_to\nvoid main(){\n#include <pragma_extrusion_initialize>\n#pragma minemap: initialize mediump vec4 pattern_from\n#pragma minemap: initialize mediump vec4 pattern_to\n#pragma minemap: initialize lowp float pixel_ratio_from\n#pragma minemap: initialize lowp float pixel_ratio_to\n#pragma minemap: initialize mediump vec4 top_pattern_from\n#pragma minemap: initialize mediump vec4 top_pattern_to\n#pragma minemap: initialize lowp float top_pixel_ratio_from\n#pragma minemap: initialize lowp float top_pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 top_pattern_tl_a=top_pattern_from.xy;vec2 top_pattern_br_a=top_pattern_from.zw;vec2 top_pattern_tl_b=top_pattern_to.xy;vec2 top_pattern_br_b=top_pattern_to.zw;vec4 finalFragColor=vec4(1.0);if(v_Top!=0.){if(u_RenderTopTex){vec2 imageCoord=mod(vec2(v_TexCoord.x,1.0-v_TexCoord.y),1.0);vec2 pos=mix(top_pattern_tl_a/u_top_pattern_size_a,top_pattern_br_a/u_top_pattern_size_a,imageCoord);vec4 color1=texture2D(u_TopTexture,pos);vec2 imageCoord_b=mod(vec2(v_TexCoord.x,1.0-v_TexCoord.y),1.0);vec2 pos2=mix(top_pattern_tl_b/u_top_pattern_size_b,top_pattern_br_b/u_top_pattern_size_b,imageCoord_b);vec4 color2=texture2D(u_TopTexture,pos2);vec4 mixedColor=mix(color1,color2,u_mix);finalFragColor=mixedColor;}else{finalFragColor=vec4(color.rgb,color.a*opacity);}}else{if(u_RenderBodyTex){vec2 imageCoord=mod(vec2(v_TexCoord.x,1.0-v_TexCoord.y),1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imageCoord);vec4 color1=texture2D(u_BaseColorSampler,pos);vec2 imageCoord_b=mod((vec2(v_TexCoord.x,1.0-v_TexCoord.y)+u_offset)/u_scale,1.0);vec2 finalImageCoord=rotateTexCoord(imageCoord_b,u_rotation);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,finalImageCoord);vec4 color2=texture2D(u_BaseColorSampler,pos2);vec4 mixedColor=mix(color1,color2,u_mix);finalFragColor=mixedColor;}else{finalFragColor=vec4(color.rgb,color.a*opacity);}}\n#ifdef M_PHONG_LIGHT\nvec3 normal=normalize(v_Normal);vec4 phongColor=vec4(phong(modelPos.xyz,normal,u_LightMaterial,u_SunLightDirectionLocal,u_CameraPosition),1.0);vec4 baseColor=vec4(finalFragColor.rgb,opacity*finalFragColor.a);finalFragColor=baseColor*phongColor;\n#else\nfinalFragColor=vec4(finalFragColor.rgb,opacity*finalFragColor.a);\n#endif\ngl_FragColor=finalFragColor;\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelMatrix>\n#include <u_NormalMatrix>\n#include <u_Resolution>\n#include <u_Bearing>\n#include <pragma_extrusion_define>\n#include <v_TexCoord2>\n#include <c_extrusionV>\n#pragma minemap: define lowp vec4 pattern_from\n#pragma minemap: define lowp vec4 pattern_to\n#pragma minemap: define lowp float pixel_ratio_from\n#pragma minemap: define lowp float pixel_ratio_to\n#pragma minemap: define lowp vec4 top_pattern_from\n#pragma minemap: define lowp vec4 top_pattern_to\n#pragma minemap: define lowp float top_pixel_ratio_from\n#pragma minemap: define lowp float top_pixel_ratio_to\nvoid main(){\n#include <pragma_extrusion_initialize>\n#pragma minemap: initialize mediump vec4 pattern_from\n#pragma minemap: initialize mediump vec4 pattern_to\n#pragma minemap: initialize lowp float pixel_ratio_from\n#pragma minemap: initialize lowp float pixel_ratio_to\n#pragma minemap: initialize mediump vec4 top_pattern_from\n#pragma minemap: initialize mediump vec4 top_pattern_to\n#pragma minemap: initialize lowp float top_pixel_ratio_from\n#pragma minemap: initialize lowp float top_pixel_ratio_to\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1);vec2 translate=u_translate;float translate_anchor=u_translate_anchor;if(translate_anchor==0.0){float sinA=sin(-u_Bearing);float cosA=cos(-u_Bearing);translate=vec2(translate[0]*cosA-translate[1]*sinA,translate[0]*sinA+translate[1]*cosA);}gl_Position.xy+=translate/vec2(u_Resolution.x/2.0,-u_Resolution.y/2.0)*gl_Position.w;v_Normal=u_NormalMatrix*a_NORMAL_ED.xyz;v_TexCoord=a_ST.xy;v_Top=a_ST.z;}")},sphereTracking:{fragmentSource:M_("#define GLSLIFY 1\n#include <pragma_line_define>\n#include <c_define>\n#include <c_lineF>\nuniform float u_start;uniform float u_end;uniform float u_segments;uniform bool u_reverse;uniform bool u_reserve;varying float v_seq;\n#ifdef M_ANS_ENABLED\nuniform float u_ANS_CurrentTime;varying float v_ANS_tripLength;varying float v_ANS_time;varying float v_ANS_trip_total_time;\n#endif\nvoid main(){\n#include <pragma_line_initialize>\nmediump float drive_opacity=1.0;float dist=length(v_Normal)*v_width2.s;float blur2=(blur+1.0/M_DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 tmpColor=vec4(color.xyz,1.0);\n#ifdef M_ANS_ENABLED\nfloat loopDelta=floor(u_ANS_CurrentTime/v_ANS_trip_total_time);float independentCurrentTime=u_ANS_CurrentTime-v_ANS_trip_total_time*loopDelta;if(v_ANS_time>independentCurrentTime||(v_ANS_time<independentCurrentTime-v_ANS_tripLength)){discard;}float ansOpacity=1.0-(independentCurrentTime-v_ANS_time)/v_ANS_tripLength;gl_FragColor=vec4(tmpColor.rgb,tmpColor.a*(alpha*opacity)*ansOpacity);\n#else\nif(u_reserve){if(v_seq>u_end){discard;}}else{if(v_seq<u_start||v_seq>u_end){discard;}drive_opacity=(v_seq-u_start)/u_segments;if(u_reverse){drive_opacity=1.0-drive_opacity;}}gl_FragColor=vec4(tmpColor.rgb,tmpColor.a*(alpha*opacity)*drive_opacity);\n#endif\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <pragma_line_define>\n#include <c_define>\n#include <c_lineV>\nattribute vec2 a_normal_vec2;attribute float a_seq;varying float v_seq;\n#ifdef M_ANS_ENABLED\nattribute float a_ANS_POS_TIME;attribute float a_ANS_TRIP_TOTAL_TIME;attribute float a_ANS_TRIP_LENGTH;varying float v_ANS_tripLength;varying float v_ANS_time;varying float v_ANS_trip_total_time;\n#endif\nvoid main(){\n#include <pragma_line_initialize>\n#ifdef M_ANS_ENABLED\nv_ANS_tripLength=a_ANS_TRIP_LENGTH;v_ANS_time=a_ANS_POS_TIME;v_ANS_trip_total_time=a_ANS_TRIP_TOTAL_TIME;\n#endif\nv_seq=a_seq;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;mediump vec2 normal=a_normal_vec2;v_Normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_PixelMatrix*outset*a_extrude*scale;gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);gl_Position.xy+=dist/u_GlUnitsToPixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}")},sphereSprite:{fragmentSource:M_("#define GLSLIFY 1\n#include <pragma_base_define>\n#include <c_define>\n#include <c_lineF>\nvarying float v_opacity;varying float v_discard;void main(){\n#include <pragma_base_initialize>\nif(v_discard<0.0){discard;}float opacity_m=v_opacity;float dist=length(v_Normal)*v_width2.s;float blur2=(blur+1.0/M_DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=vec4(color.rgb,color.a*(alpha*opacity)*opacity_m);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\nuniform mat4 u_Matrix;uniform mat2 u_PixelsToTileUnits;\n#include <pragma_line_define>\n#include <c_define>\n#include <c_lineV>\nattribute vec2 a_normal_vec2;attribute vec3 a_extra_m;uniform float u_count;varying float v_opacity;varying float v_discard;void main(){\n#include <pragma_line_initialize>\nvec3 f_extra_m=vec3(a_extra_m[0]*3.0/255.0,a_extra_m[1],a_extra_m[2]);float status=f_extra_m[2];float link_seq=f_extra_m[1];v_opacity=f_extra_m[0];int speed1;int speed2;int speed3;int speed4;if(speed_factor==1.0){speed1=int(u_count)-(int(u_count)/20)*20;}else if(speed_factor==2.0){speed2=int(u_count)-(int(u_count)/80)*80;}else if(speed_factor==3.0){speed3=int(u_count)-(int(u_count)/150)*150;}else{speed4=int(u_count)-(int(u_count)/240)*240;}speed1=speed1/2;speed2=speed2/8;speed3=speed3/15;speed4=speed4/24;if(status==1.0){if(link_seq!=float(speed1)){v_discard=-100.0;}else{v_discard=100.0;}}else if(status==2.0){if(link_seq!=float(speed2)){v_discard=-100.0;}else{v_discard=100.0;}}else if(status==3.0){if(link_seq!=float(speed3)){v_discard=-100.0;}else{v_discard=100.0;}}else if(status==4.0){if(link_seq!=float(speed4)){v_discard=-100.0;}else{v_discard=100.0;}}vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;mediump vec2 normal;\n#ifdef M_CANVAS_2D\nvec2 pos=floor(a_pos_normal*0.5);normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;\n#else\nnormal=a_normal_vec2;\n#endif\nv_Normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist;\n#ifdef M_CANVAS_2D\ndist=outset*a_extrude*scale;\n#else\ndist=u_PixelMatrix*outset*a_extrude*scale;\n#endif\n#ifdef M_CANVAS_2D\nvec4 projected_extrude=u_Matrix*vec4(dist*u_PixelsToTileUnits,0.0,0.0);gl_Position=u_Matrix*vec4(pos,0.0,1.0)+projected_extrude;v_gamma_scale=1.0;\n#else\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);gl_Position.xy+=dist/u_GlUnitsToPixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}")},sphereSpritePattern:{fragmentSource:M_("#define GLSLIFY 1\n#include <u_BaseColorSampler>\n#include <u_PixelRatio>\n#pragma minemap: define lowp vec4 pattern_from\n#pragma minemap: define lowp vec4 pattern_to\n#pragma minemap: define lowp float pixel_ratio_from\n#pragma minemap: define lowp float pixel_ratio_to\n#pragma minemap: define lowp float speed\n#pragma minemap: define lowp float move_direction\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <c_define>\n#include <c_lineF>\nuniform vec2 u_texsize;uniform float u_count;uniform mediump vec3 u_scale;uniform float u_Ratio;varying float v_linesofar;varying float v_width;void main(){\n#pragma minemap: initialize mediump vec4 pattern_from\n#pragma minemap: initialize mediump vec4 pattern_to\n#pragma minemap: initialize lowp float pixel_ratio_from\n#pragma minemap: initialize lowp float pixel_ratio_to\n#pragma minemap: initialize lowp float speed\n#pragma minemap: initialize lowp float move_direction\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 pattern_size_a=vec2(display_size_a.x/u_Ratio,display_size_a.y);float aspect_a=display_size_a.y/v_width;float dist=length(v_Normal)*v_width2.s;float blur2=(blur+1.0/u_PixelRatio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float y=0.5*v_Normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,0.5));float dir=move_direction-2.0<0.01 ?-1.0 : move_direction-3.0<0.01 ? 1.0 :-1.0;float count=u_count*speed*dir;color=texture2D(u_BaseColorSampler,vec2(mod(pos_a.x+count,1.0),pos_a.y));\n#ifdef M_SHADOW_VOLUME\ngl_FragColor=color;\n#else\ngl_FragColor=color;\n#endif\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\nuniform mat4 u_Matrix;uniform mat2 u_PixelsToTileUnits;\n#pragma minemap: define lowp vec4 pattern_from\n#pragma minemap: define lowp vec4 pattern_to\n#pragma minemap: define lowp float pixel_ratio_from\n#pragma minemap: define lowp float pixel_ratio_to\n#pragma minemap: define lowp float speed\n#pragma minemap: define lowp float move_direction\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <c_define>\n#include <c_lineV>\nvarying float v_linesofar;varying float v_width;void main(){\n#pragma minemap: initialize mediump vec4 pattern_from\n#pragma minemap: initialize mediump vec4 pattern_to\n#pragma minemap: initialize lowp float pixel_ratio_from\n#pragma minemap: initialize lowp float pixel_ratio_to\n#pragma minemap: initialize lowp float speed\n#pragma minemap: initialize lowp float move_direction\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;mediump vec2 normal;\n#ifdef M_CANVAS_2D\nvec2 pos=floor(a_pos_normal*0.5);normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;\n#else\nnormal=vec2(a_NORMAL/2.0>=1.0 ? 1.0 : 0.0,mod(a_NORMAL,2.0)==1.0 ? 1.0 :-1.0);\n#endif\nif(u_HasBorder){gapwidth=width/2.0;width=borderwidth/2.0;}else{gapwidth=gapwidth/2.0;}float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist;\n#ifdef M_CANVAS_2D\ndist=outset*a_extrude*scale;\n#else\ndist=u_PixelMatrix*outset*a_extrude*scale;\n#endif\n#ifdef M_CANVAS_2D\nvec4 projected_extrude=u_Matrix*vec4(dist*u_PixelsToTileUnits,0.0,0.0);gl_Position=u_Matrix*vec4(pos,0.0,1.0)+projected_extrude;v_gamma_scale=1.0;\n#else\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);gl_Position.xy+=dist/u_GlUnitsToPixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n}")},gltfPBR:{fragmentSource:M_(b_),vertexSource:M_(P_)},gltfPBRI3DM:{fragmentSource:M_(b_),vertexSource:M_(P_)},StandardMaterial:{fragmentSource:M_("#define GLSLIFY 1\n#include <c_define>\n#include <fn_getBlinnPhongColor>\n#include <fn_writeLogDepth>\n#include <s_LightMaterial>\n#include <fn_phong>\n#include <u_LightMaterial>\n#include <fn_encodeFloat>\n#include <u_ModelMatrix>\n#include <v_LocalPosition>\n#include <fn_pixelInVideo>\n#include <u_Color4>\n#include <u_Opacity>\n#include <v_TexCoord2>\n#include <v_Normal3>\nvarying vec4 v_ModelPos;\n#ifdef M_HAS_BASECOLORMAP\n#include <u_BaseColorSampler>\n#endif\nuniform sampler2D u_MaskSample;\n#include <u_ClipMatrix>\nuniform vec2 u_TextureSize;uniform bool u_ClipVideo;\n#if (defined M_NUM_VIDEOS) && (M_NUM_VIDEOS>0)\nuniform highp mat4 u_VIDEOMATCH_MVPMATRIX[M_NUM_VIDEOS];uniform highp vec3 u_VIDEOMATCH_RTP[M_NUM_VIDEOS];uniform bool u_HAS_VIDEOMATCHMAP[M_NUM_VIDEOS];uniform float u_Alpha[M_NUM_VIDEOS];uniform highp sampler2D u_VideoSampler[M_NUM_VIDEOS];uniform bool u_ActiveClipVideoTexture[M_NUM_VIDEOS];uniform vec3 u_ClipColors[M_NUM_VIDEOS];\n#endif\n#ifdef M_VERTEX_COLOR\nvarying vec4 v_Color;\n#endif\nuniform mat4 u_ViewportTransformation;uniform mat4 u_InverseProjection;uniform float u_PixelRatio;uniform sampler2D u_DepthTexture;\n#include <u_FrustumPlanes>\n#include <u_CurrentFrustum>\n#include <fn_readDepth>\n#include <u_Viewport>\n#ifdef M_HAS_CLIPPING_PLANES\nuniform highp sampler2D u_model_clippingPlanes;uniform vec4 u_model_clippingPlanesEdgeStyle;uniform mat4 u_model_clippingPlanesMatrix;\n#include <fn_primitiveClippingPlanes>\n#else\n#include <fn_windowToEyeCoordinates>\n#include <fn_branchFreeTernary>\n#endif\n#define PI 3.141592653589793\nuniform mat4 u_InvertViewMatrix;\n#ifdef M_HAS_SHADOWVOLUME\n#include <fn_computePolygonAdaptUV>\n#endif\nuniform vec4 u_TexOffsetScale;uniform vec3 u_TexRotate;uniform float u_FrameTime;uniform float u_Speed;mat2 rotate(float angle){return mat2(cos(angle),-sin(angle),sin(angle),cos(angle));}float rayLine(vec2 st,float angle,float r,float w){st*=rotate(-angle);return length(st)<r&&st.x>0.0 ? smoothstep(w,0.0,abs(st.y)): 0.0;}float sector(vec2 st,float r,float endAng,float offset){float d=length(st);float cosVal=st.y/d;float ang=acos(cosVal);if(st.x<0.0)ang=2.0*PI-ang;ang-=offset;ang=mod(ang,2.*PI);if(ang<0.0)ang+=2.*PI;float percent=ang/endAng;return d<r&&ang<endAng ? percent : 0.0;}void main(){vec4 color=vec4(0.0);\n#ifdef M_SHADOW_VOLUME\n#ifdef M_SHADOWVOLUME_DISCARD\nfloat flag=texture2D(u_DepthTexture,gl_FragCoord.xy/u_Viewport.zw).g;if(flag>0.1){discard;}\n#endif\n#endif\n#ifdef M_HAS_BASECOLORMAP\nvec2 finalTexCoord=u_TexOffsetScale.zw*v_TexCoord;finalTexCoord=finalTexCoord-u_TexRotate.xy;finalTexCoord=vec2(finalTexCoord.x*cos(u_TexRotate.z)-finalTexCoord.y*sin(u_TexRotate.z),finalTexCoord.x*sin(u_TexRotate.z)+finalTexCoord.y*cos(u_TexRotate.z));finalTexCoord=finalTexCoord+u_TexRotate.xy;finalTexCoord+=u_TexOffsetScale.xy;\n#ifdef M_HAS_SHADOWVOLUME\nvec2 uv=computePolygonAdaptUV();color=texture2D(u_BaseColorSampler,uv);\n#else\ncolor=texture2D(u_BaseColorSampler,finalTexCoord);\n#endif\n#else\nvec2 st;\n#ifdef M_HAS_RADARSCAN\n#ifdef M_HAS_SHADOWVOLUME\nvec2 realUv=computePolygonAdaptUV();st=realUv-vec2(0.5);\n#else\nst=v_TexCoord-vec2(0.5);\n#endif\nfloat angle=u_FrameTime*u_Speed;color=mix(color,u_Color,rayLine(st,-angle,0.5,0.005));float endAng=PI/2.5;float offset=angle+PI/2.0-PI/2.5;color=mix(color,u_Color,sector(st,0.5,endAng,offset));\n#else\n#ifdef M_HAS_DIFFUSINGRING\n#ifdef M_HAS_SHADOWVOLUME\nvec2 realUv=computePolygonAdaptUV();st=realUv-vec2(0.5);\n#else\nst=v_TexCoord-vec2(0.5);\n#endif\nfloat dis=length(st);float distance=u_FrameTime*u_Speed;if(dis>fract(distance)*0.5){discard;}else{float opacity=u_Color.a*dis/fract(distance)*2.0;color=vec4(u_Color.r,u_Color.g,u_Color.b,opacity);}\n#else\ncolor=u_Color;\n#endif\n#endif\n#endif\nvec4 finalFragColor=vec4(color.rgb,u_Opacity*color.a);gl_FragColor=finalFragColor;\n#if (defined M_NUM_VIDEOS) && (M_NUM_VIDEOS>0)\nfor(int i=0;i<M_NUM_VIDEOS;i++){if(u_HAS_VIDEOMATCHMAP[i]){if(u_ClipVideo){if(pixelInVideo(u_VIDEOMATCH_MVPMATRIX[i],u_VIDEOMATCH_RTP[i],u_ModelMatrix,v_LocalPosition,u_VideoSampler[i],u_Alpha[i],u_ClipMatrix,u_MaskSample,u_TextureSize,u_ActiveClipVideoTexture[i],u_ClipColors[i])){continue;}}else{if(pixelInVideo(u_VIDEOMATCH_MVPMATRIX[i],u_VIDEOMATCH_RTP[i],u_ModelMatrix,v_LocalPosition,u_VideoSampler[i],u_Alpha[i],u_ClipMatrix,u_MaskSample,u_TextureSize,false,u_ClipColors[i])){continue;}}}}\n#endif\n#ifdef M_VERTEX_COLOR\ngl_FragColor=vec4(v_Color);\n#endif\n#ifdef M_HAS_CLIPPING_PLANES\nmodelClippingPlanesStage(gl_FragColor);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}"),vertexSource:M_("precision highp float;\n#define GLSLIFY 1\n#include <c_define>\n#include <fn_vertexLogDepth>\n#include <a_POSITION3>\n#include <a_DOUBLE_PRECISION_POSITION>\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelMatrix>\n#include <u_NormalMatrix>\n#include <v_LocalPosition>\nattribute vec2 a_TEXCOORD_0;\n#include <a_NORMAL3>\n#include <v_TexCoord2>\n#include <v_Normal3>\nvarying vec4 v_ModelPos;\n#include <u_ModelViewProjectionRelativeToEye>\n#include <u_EncodedCameraPosition>\n#include <fn_translateRelativeToEye>\n#include <v_LIGHT>\n#ifdef M_INSTANCE_MATRIX\nattribute mat4 a_InstanceMatrix4;\n#endif\n#ifdef M_VERTEX_COLOR\nattribute vec4 a_COLOR_0;varying vec4 v_Color;\n#endif\n#ifdef M_HAS_SHADOWVOLUME\n#include <fn_computeShadowVolumeExtents>\n#endif\nvoid main(){\n#ifdef M_DOUBLEPRECISION\n#ifdef M_INSTANCE_MATRIX\ngl_Position=u_ModelViewProjectionMatrix*a_InstanceMatrix4*u_ModelMatrix*vec4(a_PositionHigh+a_PositionLow,1.0);\n#else\ngl_Position=u_ModelViewProjectionRelativeToEye*translateRelativeToEye(a_PositionHigh,a_PositionLow);\n#endif\nv_LocalPosition=vec4(a_PositionHigh+a_PositionLow,1);v_ModelPos=u_ModelMatrix*v_LocalPosition;\n#else\nmat4 instanceMatrix4=mat4(1.0);\n#ifdef M_INSTANCE_MATRIX\ninstanceMatrix4=a_InstanceMatrix4*u_ModelMatrix;\n#endif\ngl_Position=u_ModelViewProjectionMatrix*instanceMatrix4*vec4(a_POSITION,1.0);v_LocalPosition=vec4(a_POSITION,1);v_ModelPos=u_ModelMatrix*vec4(a_POSITION,1.0);\n#endif\n#ifdef M_HAS_SHADOWVOLUME\ncomputeShadowVolumeExtents();\n#endif\nv_TexCoord=a_TEXCOORD_0;\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\nv_ModelPos=v_ModelPos/v_ModelPos.w;v_Normal=normalize(u_NormalMatrix*a_NORMAL);\n#ifdef M_VERTEX_COLOR\nv_Color=a_COLOR_0;\n#endif\n}")},WaterMaterial:{fragmentSource:M_("#define GLSLIFY 1\n#ifdef M_EnableSSR\nuniform sampler2D u_ColorSampler;uniform sampler2D u_NormalSampler;uniform sampler2D u_DepthSampler;varying vec2 uv;\n#include <u_ProjectionMatrix>\n#include <u_ModelViewProjectionMatrix>\nuniform float u_Width;uniform float u_Height;\n#endif\n#include <fn_readDepth>\n#include <u_CurrentFrustum>\n#include <u_Opacity>\nuniform float u_Time;uniform float u_DistortionScale;uniform sampler2D u_BaseColorSampler;\n#include <u_Color3>\nuniform vec3 u_SunDirection;uniform vec3 u_SunColor;uniform vec3 u_SkyColor;uniform float u_WaveSize;varying vec4 v_MirrorCoord;varying vec4 v_WorldPosition;varying vec4 v_reallyPosition;varying vec4 v_camera;varying mat3 v_RotateMatrixInverse;vec4 getNoise(vec2 uv){vec2 uv0=(uv/103.0)+vec2(u_Time/17.0,u_Time/29.0);vec2 uv1=uv/107.0-vec2(u_Time/-19.0,u_Time/31.0);vec2 uv2=uv/vec2(8907.0,9803.0)+vec2(u_Time/101.0,u_Time/97.0);vec2 uv3=uv/vec2(1091.0,1027.0)-vec2(u_Time/109.0,u_Time/-113.0);vec4 noise=texture2D(u_BaseColorSampler,uv0)+texture2D(u_BaseColorSampler,uv1)+texture2D(u_BaseColorSampler,uv2)+texture2D(u_BaseColorSampler,uv3);return noise*0.5-1.0;}float getShadowMask(){float shadow=1.0;\n#ifdef USE_SHADOWMAP\n#if NUM_DIR_LIGHT_SHADOWS > 0\nDirectionalLightShadow directionalLight;\n#pragma unroll_loop_start\nfor(int i=0;i<NUM_DIR_LIGHT_SHADOWS;i++){directionalLight=directionalLightShadows[i];shadow*=receiveShadow ? getShadow(directionalShadowMap[i],directionalLight.shadowMapSize,directionalLight.shadowBias,directionalLight.shadowRadius,vDirectionalShadowCoord[i]): 1.0;}\n#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHT_SHADOWS > 0\nSpotLightShadow spotLight;\n#pragma unroll_loop_start\nfor(int i=0;i<NUM_SPOT_LIGHT_SHADOWS;i++){spotLight=spotLightShadows[i];shadow*=receiveShadow ? getShadow(spotShadowMap[i],spotLight.shadowMapSize,spotLight.shadowBias,spotLight.shadowRadius,vSpotShadowCoord[i]): 1.0;}\n#pragma unroll_loop_end\n#endif\n#if NUM_POINT_LIGHT_SHADOWS > 0\nPointLightShadow pointLight;\n#pragma unroll_loop_start\nfor(int i=0;i<NUM_POINT_LIGHT_SHADOWS;i++){pointLight=pointLightShadows[i];shadow*=receiveShadow ? getPointShadow(pointShadowMap[i],pointLight.shadowMapSize,pointLight.shadowBias,pointLight.shadowRadius,vPointShadowCoord[i],pointLight.shadowCameraNear,pointLight.shadowCameraFar): 1.0;}\n#pragma unroll_loop_end\n#endif\n#endif\nreturn shadow;}void sunLight(const vec3 sunDirection,const vec3 surfaceNormal,const vec3 eyeDirection,float shiny,float spec,float diffuse,inout vec3 diffuseColor,inout vec3 specularColor){vec3 reflection=normalize(reflect(-sunDirection,surfaceNormal));float direction=max(0.0,dot(eyeDirection,reflection));specularColor+=pow(direction,shiny)*u_SunColor*spec;diffuseColor+=max(dot(sunDirection,surfaceNormal),0.0)*u_SunColor*diffuse;}float getDepth(float z){float near=u_CurrentFrustum.x;float far=u_CurrentFrustum.y;float a=far/(far-near);float b=near/(near-far);return(a*z+b)/z;}bool checkDepthCollision(vec3 viewPos,mat4 mvp,sampler2D texture,out vec2 texPos){vec4 clipPos=mvp*vec4(viewPos,1.0);clipPos=clipPos/clipPos.w;texPos=vec2(clipPos.x,clipPos.y)*0.5+0.5;float depth=readDepth(texture,texPos,true);return texPos.x>0.0&&texPos.y>0.0&&texPos.x<1.0&&texPos.y<1.0&&depth<(clipPos.z*0.5)+0.5;}bool viewSpaceRayMarching(vec3 rayOrigin,vec3 rayDir,mat4 mvp,sampler2D texture,out vec2 hitScreenPos){const int maxStep=500;for(int i=10;i<maxStep;i++){vec3 currentPos=rayOrigin+rayDir*2.0*float(i);if(checkDepthCollision(currentPos,mvp,texture,hitScreenPos)){return true;}}return false;}void main(){vec3 sunDirection;if(u_SunDirection==vec3(0,0,0)){sunDirection=vec3(-u_SunLightDirectionLocal.x,u_SunLightDirectionLocal.y,-u_SunLightDirectionLocal.z);}else{sunDirection=u_SunDirection;}vec4 noise=getNoise(v_WorldPosition.xz*u_WaveSize);vec3 surfaceNormal=normalize(noise.xzy*vec3(1.5,1.0,1.5));vec3 diffuseLight=vec3(0.0);vec3 specularLight=vec3(0.0);vec3 worldToEye=v_RotateMatrixInverse*(u_CameraPosition-v_reallyPosition.xyz);worldToEye=vec3(-worldToEye.x,worldToEye.z,worldToEye.y);vec3 eyeDirection=normalize(worldToEye);sunLight(sunDirection,surfaceNormal,eyeDirection,100.0,2.0,0.5,diffuseLight,specularLight);float distance=length(worldToEye);vec2 distortion=surfaceNormal.xz*(0.001+1.0/distance)*u_DistortionScale;vec3 reflectionSample=u_SkyColor;float theta=max(dot(eyeDirection,surfaceNormal),0.0);float rf0=0.3;float reflectance=rf0+(1.0-rf0)*pow((1.0-theta),5.0);vec3 scatter=max(0.0,dot(surfaceNormal,eyeDirection))*u_Color;vec3 albedo=mix((u_SunColor*diffuseLight*0.3+scatter)*getShadowMask(),(vec3(0.1)+reflectionSample*0.9+reflectionSample*specularLight),reflectance);vec3 outgoingLight=albedo;\n#ifdef M_EnableSSR\nvec3 localNormalDirection=vec3(texture2D(u_NormalSampler,vec2(gl_FragCoord.x/u_Width,gl_FragCoord.y/u_Height)))*2.0-1.0;vec3 lightDirection=normalize(u_CameraPosition-v_reallyPosition.xyz);vec3 reflection=normalize(reflect(-lightDirection,localNormalDirection));vec2 hitScreenPos=vec2(0.0,0.0);if(viewSpaceRayMarching(v_reallyPosition.xyz,reflection,u_ModelViewProjectionMatrix,u_DepthSampler,hitScreenPos)){vec3 reflectTexture=vec3(texture2D(u_ColorSampler,hitScreenPos));gl_FragColor=vec4(albedo*u_Opacity*0.5+reflectTexture*0.5,u_Opacity);}else{gl_FragColor=vec4(albedo,u_Opacity);}\n#else\ngl_FragColor=vec4(albedo,u_Opacity);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#ifdef M_DOUBLEPRECISION\n#include <a_DOUBLE_PRECISION_POSITION>\n#else\n#include <a_POSITION3>\n#endif\n#include <u_ModelMatrix>\n#include <u_ModelViewProjectionMatrix>\n#include <u_ProjectionMatrix>\n#include <u_RotateMatrixInverse>\nvarying mat3 v_RotateMatrixInverse;varying vec4 v_MirrorCoord;varying vec4 v_WorldPosition;varying vec4 v_reallyPosition;\n#include <u_ModelViewProjectionRelativeToEye>\n#include <u_EncodedCameraPosition>\n#include <fn_translateRelativeToEye>\nvoid main(){\n#ifdef M_DOUBLEPRECISION\ngl_Position=u_ModelViewProjectionRelativeToEye*translateRelativeToEye(a_PositionHigh,a_PositionLow);v_reallyPosition=u_ModelMatrix*vec4(a_PositionHigh+a_PositionLow,1);\n#else\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);v_reallyPosition=u_ModelMatrix*vec4(a_POSITION,1.0);\n#endif\nv_MirrorCoord=u_RotateMatrixInverse*v_reallyPosition;v_RotateMatrixInverse=mat3(u_RotateMatrixInverse);v_MirrorCoord=v_MirrorCoord.xzyw;v_WorldPosition=v_MirrorCoord.xyzw;}")},mirrorMaterial:{fragmentSource:M_("#define GLSLIFY 1\nuniform lowp samplerCube u_EnvMap;varying vec3 v_Normal;uniform mat4 u_ModelMatrixInverse;varying vec3 v_Position;void main(){vec3 cameraPosition=(u_ModelMatrixInverse*vec4(u_CameraPosition,1.0)).xyz;vec3 eyeToSurfaceDir=normalize(v_Position-cameraPosition);vec3 direction=reflect(eyeToSurfaceDir,v_Normal);gl_FragColor=vec4(textureCube(u_EnvMap,direction).rgb,1.0);}"),vertexSource:M_("#define GLSLIFY 1\n#ifdef M_DOUBLEPRECISION\n#include <a_DOUBLE_PRECISION_POSITION>\n#else\n#include <a_POSITION3>\n#endif\n#include <u_ModelMatrix>\n#include <u_ModelViewProjectionMatrix>\n#include <u_ProjectionMatrix>\n#include <u_RotateMatrixInverse>\nvarying vec3 v_Position;\n#include <u_ModelViewProjectionRelativeToEye>\n#include <u_EncodedCameraPosition>\n#include <fn_translateRelativeToEye>\nattribute vec3 a_NORMAL;varying vec3 v_Normal;void main(){\n#ifdef M_DOUBLEPRECISION\ngl_Position=u_ModelViewProjectionRelativeToEye*translateRelativeToEye(a_PositionHigh,a_PositionLow);v_Position=vec3(a_PositionHigh+a_PositionLow);\n#else\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);v_Position=vec3(a_POSITION);\n#endif\nv_Normal=normalize(a_NORMAL);}")},PhongMaterial:{fragmentSource:M_("#define GLSLIFY 1\n#include <u_Viewport>\n#include <u_FrustumPlanes>\n#include <u_PixelRatio>\n#include <u_CurrentFrustum>\nuniform mat4 u_ViewportTransformation;uniform mat4 u_InverseProjection;\n#ifdef M_HAS_BASECOLORMAP\n#include <u_BaseColorSampler>\n#endif\n#ifdef M_HAS_NORMALMAP\nuniform sampler2D u_NormalSampler;\n#endif\n#ifdef M_HAS_CLIPPING_PLANES\nuniform highp sampler2D u_model_clippingPlanes;uniform vec4 u_model_clippingPlanesEdgeStyle;uniform mat4 u_model_clippingPlanesMatrix;\n#include <fn_primitiveClippingPlanes>\n#endif\n#ifdef M_ShadowEnable\nuniform sampler2D u_ShadowDepthSampler;uniform float u_EPSILON;uniform float u_MapSizeScale;uniform vec2 u_Resolution;varying vec4 v_PositionFromLight;\n#include <fn_shadow>\n#endif\nuniform vec4 u_BaseColorFactor;uniform float u_Shininess;uniform float u_Reflectivity;uniform float u_Opacity;varying vec3 v_Normal;varying vec4 v_LocalPosition;varying vec3 v_ViewPosition;varying vec3 v_WorldPosition;varying vec2 v_TexCoord;varying vec4 v_COLOR;varying mat3 v_TBN;varying vec4 v_ModelInstanceColor;\n#include <v_Show>\n#include <s_LightMaterial>\n#include <fn_phong>\n#include <fn_getBatchTextureColor>\nmat3 getTangentFrame(vec3 eye_pos,vec3 surf_norm,vec2 uv){vec3 q0=dFdx(eye_pos.xyz);vec3 q1=dFdy(eye_pos.xyz);vec2 st0=dFdx(uv.st);vec2 st1=dFdy(uv.st);vec3 N=surf_norm;vec3 q1perp=cross(q1,N);vec3 q0perp=cross(N,q0);vec3 T=q1perp*st0.x+q0perp*st1.x;vec3 B=q1perp*st0.y+q0perp*st1.y;float det=max(dot(T,T),dot(B,B));float scale2=(det==0.0)? 0.0 : inversesqrt(det);return mat3(T*scale2,B*scale2,N);}vec4 getBaseColor(){vec4 baseColor=u_BaseColorFactor;\n#ifdef M_HAS_BASECOLORMAP\nbaseColor=texture2D(u_BaseColorSampler,v_TexCoord);baseColor*=u_BaseColorFactor;\n#endif\n#ifdef M_OPAQUE\nbaseColor.a=1.0;\n#endif\n#ifdef M_VERTEX_COLOR\nbaseColor*=v_COLOR_0;\n#endif\nreturn baseColor;}vec3 getNormal(){vec3 N=normalize(v_Normal);\n#ifdef M_HAS_NORMALMAP\nmat3 TBN;\n#ifdef M_HAS_TANGENTS\nTBN=v_TBN;\n#else\nTBN=getTangentFrame(-v_ViewPosition,N,v_TexCoord);\n#endif\nvec3 normalMap=texture2D(u_NormalSampler,v_TexCoord).rgb;vec3 normalT=normalMap*2.0-1.0;N=normalize(v_TBN*normalT);\n#endif\nreturn N;}void main(){\n#include <c_showF>\nvec4 baseColor=getBaseColor();if(baseColor.a==0.0){discard;}\n#ifdef M_HAS_CLIPPING_PLANES\nmodelClippingPlanesStage(baseColor);\n#endif\n#if defined(M_HAS_NORMALS) && defined(M_enableLight)\nvec3 normal=getNormal();gl_FragColor=vec4(baseColor.rgb*phong(u_Reflectivity,normal,u_SunLightDirectionGlobal,v_WorldPosition,u_Shininess),baseColor.a*u_Opacity);\n#else\ngl_FragColor=vec4(baseColor.rgb,baseColor.a*u_Opacity);\n#endif\n#ifdef M_HAS_NORMALS\nbaseColor.rgb/=(baseColor.rgb+vec3(1.0));\n#endif\nbaseColor.rgb=pow(baseColor.rgb,vec3(1.0/2.2));float visibility=1.0;\n#ifdef M_ShadowEnable\n#ifdef M_ShadowMapping\nvisibility=0.6+0.4*ifShadow2(v_PositionFromLight,u_ShadowDepthSampler,u_EPSILON,1./u_Resolution.x,1./u_Resolution.y,u_MapSizeScale);\n#else\n#ifdef M_PCF\nvisibility=ShadowPCF(v_PositionFromLight,u_Resolution,u_ShadowDepthSampler);\n#endif\n#endif\n#endif\ngl_FragColor=vec4(gl_FragColor.rgb*visibility,gl_FragColor.a);\n#if defined(M_ONE_DIMENSION_BATCH_TEXTURE)||defined(M_TWO_DIMENSION_BATCH_TEXTURE)\ngetBatchTextureColor(batch_featureColor);\n#endif\n#ifdef M_MODEL_INSTANCE_BATCH_TEXTURE\ngl_FragColor.rgb=mix(gl_FragColor.rgb,v_ModelInstanceColor.rgb,v_ModelInstanceColor.a);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#ifdef M_DOUBLEPRECISION\n#include <a_DOUBLE_PRECISION_POSITION>\n#else\n#include <a_POSITION3>\n#endif\n#ifdef M_USE_MORPHTARGETS\n#include <a_POSITION3_1>\n#include <a_POSITION3_2>\n#include <a_NORMAL3_1>\n#include <a_NORMAL3_2>\n#include <a_TANGENT_1>\n#include <a_TANGENT_2>\nuniform vec2 u_morphTargetInfluences;\n#endif\n#ifdef M_INSTANCE_MATRIX\nattribute mat4 a_InstanceMatrix4;uniform mat4 u_ModelInstanceRTCTransformMatrix;\n#endif\n#ifdef M_ShadowEnable\nvarying vec4 v_PositionFromLight;uniform mat4 u_ShadowModelViewProjectionMatrix;\n#endif\n#ifdef M_JOINT_MATRIX_CNT\nattribute vec4 a_JOINTS_0;attribute vec4 a_WEIGHTS_0;uniform highp mat4 u_jointMatrix[M_JOINT_MATRIX_CNT];\n#endif\n#include <a_NORMAL3>\n#include <a_TANGENT>\n#include <a_TEXCOORD_0>\n#include <a_COLOR4_0>\n#include <a_BATCHID>\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelMatrix>\n#include <u_ViewMatrix>\n#include <u_NormalMatrix>\n#include <u_HasSkinning>\n#include <u_LIGHT>\nvarying vec3 v_Normal;varying vec4 v_LocalPosition;varying vec3 v_ViewPosition;varying vec3 v_WorldPosition;varying vec2 v_TexCoord;varying vec4 v_COLOR;varying mat3 v_TBN;\n#include <v_Show>\n#include <v_LIGHT>\n#include <c_computeSTParsVert>\n#include <fn_getAnimatedGLPosition>\nvoid main(){mat4 modelMatrix;\n#ifdef M_INSTANCE_MATRIX\nmodelMatrix=u_ModelInstanceRTCTransformMatrix*a_InstanceMatrix4*u_ModelMatrix;\n#else\nmodelMatrix=u_ModelMatrix;\n#endif\n#ifdef M_DOUBLEPRECISION\nvec4 pos=modelMatrix*vec4(a_PositionHigh+a_PositionLow,1.0);v_WorldPosition=vec3(pos.xyz)/pos.w;v_ViewPosition=(u_ViewMatrix*pos).xyz;v_LocalPosition=vec4(a_PositionHigh+a_PositionLow,1.0);\n#ifdef M_ShadowEnable\nv_PositionFromLight=u_ShadowModelViewProjectionMatrix*vec4(a_PositionHigh+a_PositionLow,1.0);\n#endif\n#else\nvec4 pos=modelMatrix*vec4(a_POSITION,1.0);v_WorldPosition=vec3(pos.xyz)/pos.w;v_ViewPosition=(u_ViewMatrix*pos).xyz;v_LocalPosition=vec4(a_POSITION,1.0);\n#ifdef M_ShadowEnable\nv_PositionFromLight=u_ShadowModelViewProjectionMatrix*vec4(a_POSITION,1.0);\n#endif\n#endif\n#if defined(M_enableLight) && defined(M_PointLight) && defined(M_ShadowEnable)\nfor(int i=0;i<int(M_PointLightCount);i++){vec4 positionToLight=u_PointLightModelMatrixInverse[i]*vec4(v_WorldPosition,1.0);v_PointDirection[i]=positionToLight.xyz;}\n#endif\n#ifdef M_HAS_NORMALS\nv_Normal=normalize(u_NormalMatrix*a_NORMAL);\n#if defined(M_HAS_NORMALMAP) && defined(M_HAS_TANGENTS)\nvec3 N=v_Normal;vec3 T=normalize(u_NormalMatrix*a_TANGENT);vec3 B=normalize(cross(N,T));v_TBN=mat3(T,B,N);\n#endif\n#endif\nv_TexCoord=a_TEXCOORD_0;v_COLOR=a_COLOR_0;getAnimatedGLPosition();\n#include <c_computeSTMainVert>\n}")},LambertMaterial:{fragmentSource:M_("precision highp float;\n#define GLSLIFY 1\n#ifdef M_enableLight\n#ifdef M_AmbientLight\nuniform float u_AmbientLightsColor[M_AmbientLightCount*3];uniform float u_AmbientLightsIntensity[M_AmbientLightCount];\n#endif\n#ifdef M_DirectionalLight\nuniform float u_DirectionalLightColor[M_DirectionalLightCount*3];uniform float u_DirectionalLightIntensity[M_DirectionalLightCount];uniform float u_DirectionalLightDir[M_DirectionalLightCount*3];\n#endif\n#endif\nuniform vec3 u_Color;uniform vec3 u_Emissive;uniform float u_Reflectivity;uniform float u_Opacity;varying vec3 v_Normal;varying vec3 v_worldPosition;void main(){\n#ifdef M_enableLight\nvec3 ambient=vec3(0.0,0.0,0.0);\n#ifdef M_AmbientLight\nfor(int i=0;i<int(M_AmbientLightCount);++i){vec3 ambientColor=vec3(u_AmbientLightsColor[i*3],u_AmbientLightsColor[i*3+1],u_AmbientLightsColor[i*3+2]);float ambientIntensity=u_AmbientLightsIntensity[i];ambient=ambient+ambientIntensity*u_Reflectivity*ambientColor;}\n#endif\nvec3 diffuse=vec3(0.0,0.0,0.0);\n#ifdef M_SunLight\nif(u_SunLightDirectionLocal.z>0.0){diffuse=diffuse+u_Reflectivity*max(dot(v_Normal,u_SunLightDirectionGlobal),0.)*u_SunLightColor*u_SunLightIntensity;}\n#endif\n#ifdef M_DirectionalLight\nfor(int i=0;i<int(M_DirectionalLightCount);++i){vec3 directLightColor=vec3(u_DirectionalLightColor[i*3],u_DirectionalLightColor[i*3+1],u_DirectionalLightColor[i*3+2]);float directLightIntensity=u_DirectionalLightIntensity[i];vec3 directLightDir=vec3(u_DirectionalLightDir[i*3],u_DirectionalLightDir[i*3+1],u_DirectionalLightDir[i*3+2]);diffuse=diffuse+u_Reflectivity*max(dot(v_Normal,directLightDir),0.)*directLightColor*directLightIntensity;}\n#endif\ngl_FragColor=vec4(u_Color*(ambient+diffuse),u_Opacity);\n#else\ngl_FragColor=vec4(u_Color,u_Opacity);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <basicVertex>\n#include <fn_basic>\nattribute vec3 a_NORMAL;varying vec3 v_Normal;varying vec3 v_worldPosition;void main(){gl_Position=getGLPosition();v_worldPosition=getWorldPosition().xyz;vec4 delt=u_ModelMatrix*vec4(a_NORMAL,1.0)-u_ModelMatrix*vec4(0.0,0.0,0.0,1.0);v_Normal=normalize(delt.xyz);}")},SimplePolyline:{fragmentSource:M_("#define GLSLIFY 1\n#include <u_Color4>\nvoid main(){gl_FragColor=u_Color;}"),vertexSource:M_("#define GLSLIFY 1\n#ifdef M_DOUBLEPRECISION\n#include <a_DOUBLE_PRECISION_POSITION>\n#else\n#include <a_POSITION3>\n#endif\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelViewProjectionRelativeToEye>\n#include <u_EncodedCameraPosition>\n#include <fn_translateRelativeToEye>\nvoid main(){\n#ifdef M_DOUBLEPRECISION\ngl_Position=u_ModelViewProjectionRelativeToEye*translateRelativeToEye(a_PositionHigh,a_PositionLow);\n#else\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);\n#endif\n}")},screen:{fragmentSource:M_("precision highp float;\n#define GLSLIFY 1\n#include <u_BaseColorSampler>\nvarying highp vec2 v_TexCoord;uniform vec2 u_Resolution;void main(){if(M_SSAASamples==1){gl_FragColor=texture2D(u_BaseColorSampler,v_TexCoord);}else{float widthResolution=1.0/(u_Resolution.x*float(M_SSAASamples));float heightResolution=1.0/(u_Resolution.y*float(M_SSAASamples));vec4 color;float number;vec2 startCoord=v_TexCoord-vec2(widthResolution*((float(M_SSAASamples))/2.0-1.0)+0.5*widthResolution,heightResolution*((float(M_SSAASamples))/2.0-1.0)-0.5*widthResolution);for(int i=0;i<M_SSAASamples;i++){for(int j=0;j<M_SSAASamples;j++){color=color+texture2D(u_BaseColorSampler,startCoord+vec2(widthResolution*float(i),heightResolution*float(j)));number=number+1.0;}}gl_FragColor=color/number;}}"),vertexSource:M_(S_)},panorama:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D u_std_resolution_img;uniform sampler2D u_low_resolution;\n#include <v_TexCoord2>\nvoid main(){vec4 calColor=texture2D(u_std_resolution_img,v_TexCoord);gl_FragColor=calColor;\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION3>\nattribute vec2 a_texture_pos;\n#include <u_ModelViewProjectionMatrix>\n#include <v_TexCoord2>\nvoid main(){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1);v_TexCoord=a_texture_pos;}")},sphereHistogram:{fragmentSource:M_("#define GLSLIFY 1\n#include <c_define>\n#include <fn_writeLogDepth>\n#include <c_extrusionF>\n#include <pragma_extrusion_define>\n#include <s_LightMaterial>\n#include <fn_phong>\n#include <u_LightMaterial>\nvarying vec4 modelPos;\n#include <u_Opacity>\nvoid main(){\n#include <pragma_extrusion_initialize>\nvec3 normal=normalize(v_Normal);\n#ifdef M_PHONG_LIGHT\nvec3 phongColor=phong(modelPos.xyz,normal,u_LightMaterial,u_SunLightDirectionLocal,u_CameraPosition);gl_FragColor=vec4(phongColor*color.rgb,color.a*u_Opacity);\n#else\ngl_FragColor=vec4(color.rgb,color.a*u_Opacity);\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <fn_vertexLogDepth>\n#include <c_define>\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <u_ModelMatrix>\n#include <u_NormalMatrix>\n#include <pragma_extrusion_define>\n#include <v_TexCoord2>\n#include <c_extrusionV>\nvarying vec4 modelPos;void main(){\n#include <pragma_extrusion_initialize>\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1);v_Normal=normalize(u_NormalMatrix*a_NORMAL_ED.xyz);v_Normal=a_NORMAL_ED.xyz;v_TexCoord=a_ST.xy;float t=mod(a_NORMAL_ED.y,2.0);modelPos=u_ModelMatrix*vec4(a_POSITION,1.0);modelPos=modelPos/modelPos.w;\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n}")},sphereHistogramColor:{fragmentSource:M_("#define GLSLIFY 1\n#include <pragma_extrusion_define>\n#include <c_extrusionF>\n#include <u_Opacity>\nvoid main(){vec3 normal=normalize(v_Normal);vec3 lightDirection=normalize(u_SunLightDirectionLocal);float nDotL=max(dot(lightDirection,normal),0.0);vec3 diffuse_a=u_SunLightColor*u_color_a.rgb*nDotL;vec3 ambient_a=vec3(0.6,0.6,0.6)*u_color_a.rgb;vec3 diffuse_b=u_SunLightColor*u_color_b.rgb*nDotL;vec3 ambient_b=vec3(0.6,0.6,0.6)*u_color_b.rgb;vec3 diffuse_c=u_SunLightColor*u_color_c.rgb*nDotL;vec3 ambient_c=vec3(0.6,0.6,0.6)*u_color_c.rgb;vec3 diffuse_d=u_SunLightColor*u_color_d.rgb*nDotL;vec3 ambient_d=vec3(0.6,0.6,0.6)*u_color_d.rgb;vec3 diffuse_e=u_SunLightColor*u_color_e.rgb*nDotL;vec3 ambient_e=vec3(0.6,0.6,0.6)*u_color_e.rgb;vec3 tmp=vec3(0.0);vec3 real=vec3(0.0);if(v_height<0.25*u_max_height){tmp=(diffuse_b+ambient_b)-(diffuse_a+ambient_a);real=tmp*((v_height)/0.25/u_max_height)+(diffuse_a+ambient_a);}else if(v_height<0.5*u_max_height){tmp=(diffuse_c+ambient_c)-(diffuse_b+ambient_b);real=tmp*((v_height-0.25*u_max_height)/0.25/u_max_height)+(diffuse_b+ambient_b);}else if(v_height<0.75*u_max_height){tmp=(diffuse_d+ambient_d)-(diffuse_c+ambient_c);real=tmp*((v_height-0.5*u_max_height)/0.25/u_max_height)+(diffuse_c+ambient_c);}else if(v_height<0.8*u_max_height){tmp=(diffuse_e+ambient_e)-(diffuse_d+ambient_d);real=tmp*((v_height-0.75*u_max_height)/0.25/u_max_height)+(diffuse_d+ambient_d);}else{real=(diffuse_e+ambient_e);}if(u_depth_render==1.0){gl_FragColor=vec4(real.rgb,real.a*u_Opacity);}else{gl_FragColor=vec4(real.rgb,real.a*v_opacity*u_Opacity);}\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);;\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <u_NormalMatrix>\n#include <c_extrusionV>\nvarying float v_height;varying float v_opacity;\n#pragma minemap: define highp float base\n#pragma minemap: define highp float height\n#pragma minemap: define highp vec4 color\nvoid main(){\n#pragma minemap: initialize highp float base\n#pragma minemap: initialize highp float height\n#pragma minemap: initialize highp vec4 color\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1);v_Normal=normalize(u_NormalMatrix*a_normal_ed.xyz);vec3 normal=a_normal_ed.xyz;float t=mod(normal.x,2.0);if(t>0.0){v_opacity=1.2;v_height=height*3.0;}else{v_opacity=0.1;v_height=0.0;}}")},sphereHistogramDynamic:{fragmentSource:M_("#define GLSLIFY 1\n#include <pragma_extrusion_define>\n#include <c_extrusionF>\nvoid main(){\n#include <pragma_extrusion_initialize>\nif(v_height<0.2*u_max_height){vec4 tmp=u_color_b-u_color_a;vec4 real=tmp*((v_height)/0.2/u_max_height)+u_color_a;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else if(v_height<0.4*u_max_height){vec4 tmp=u_color_c-u_color_b;vec4 real=tmp*((v_height-0.2*u_max_height)/0.2/u_max_height)+u_color_b;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else if(v_height<0.6*u_max_height){vec4 tmp=u_color_d-u_color_c;vec4 real=tmp*((v_height-0.4*u_max_height)/0.2/u_max_height)+u_color_c;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else if(v_height<0.8*u_max_height){vec4 tmp=u_color_e-u_color_d;vec4 real=tmp*((v_height-0.6*u_max_height)/0.2/u_max_height)+u_color_d;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else{gl_FragColor=vec4(u_color_e.rgb*v_directional,1.0);}\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION2>\n#include <u_ModelViewProjectionMatrix>\n#include <pragma_extrusion_define>\n#include <c_extrusionV>\nuniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform lowp float u_dyn_count;uniform float u_fluorescent;varying vec4 v_color;varying float v_opacity;varying float v_height;varying float v_directional;\n#pragma minemap: define lowp vec4 heightArr1\n#pragma minemap: define lowp vec4 heightArr2\n#pragma minemap: define lowp vec4 heightArr3\nvoid main(){\n#include <pragma_extrusion_initialize>\n#pragma minemap: initialize lowp vec4 heightArr1\n#pragma minemap: initialize lowp vec4 heightArr2\n#pragma minemap: initialize lowp vec4 heightArr3\nfloat _height=0.0;float _num=0.0;float _height1=0.0;float _height2=0.0;_num=abs(u_dyn_count)/500.0;if(_num<1.0){_height1=abs(height);_height2=abs(heightArr1[0]/255.0);}else if(_num<2.0){_height1=abs(heightArr1[0]/255.0);_height2=abs(heightArr1[1]/255.0);}else if(_num<3.0){_height1=abs(heightArr1[1]/255.0);_height2=abs(heightArr1[2]/255.0);}else if(_num<4.0){_height1=abs(heightArr1[2]/255.0);_height2=abs(heightArr1[3]/255.0);}else if(_num<5.0){_height1=abs(heightArr1[3]/255.0);_height2=abs(heightArr2[0]/255.0);}else if(_num<6.0){_height1=abs(heightArr2[0]/255.0);_height2=abs(heightArr2[1]/255.0);}else if(_num<7.0){_height1=abs(heightArr2[1]/255.0);_height2=abs(heightArr2[2]/255.0);}else if(_num<8.0){_height1=abs(heightArr2[2]/255.0);_height2=abs(heightArr2[3]/255.0);}else if(_num<9.0){_height1=abs(heightArr2[3]/255.0);_height2=abs(heightArr3[0]/255.0);}else if(_num<10.0){_height1=abs(heightArr3[0]/255.0);_height2=abs(heightArr3[1]/255.0);}else if(_num<11.0){_height1=abs(heightArr3[1]/255.0);_height2=abs(heightArr3[2]/255.0);}else if(_num<12.0){_height1=abs(heightArr3[2]/255.0);_height2=abs(heightArr3[3]/255.0);}_height=20.0+(_height1+(_height2-_height1)/500.0*mod(abs(u_dyn_count),500.0))*1.0;vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION.xy,t>0.0 ? _height : base,1);if(t>0.0){v_opacity=1.2;v_height=_height*3.0;}else{v_opacity=0.1;v_height=0.0;}float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if(normal.y!=0.0){directional*=clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0);}v_color.r+=clamp(color.r*directional*u_SunLightColor.r,mix(0.0,0.3,1.0-u_SunLightColor.r),1.0);v_color.g+=clamp(color.g*directional*u_SunLightColor.g,mix(0.0,0.3,1.0-u_SunLightColor.g),1.0);v_color.b+=clamp(color.b*directional*u_SunLightColor.b,mix(0.0,0.3,1.0-u_SunLightColor.b),1.0);v_directional=directional;}")},sphereSymtrackingIcon:{fragmentSource:M_(x_),vertexSource:M_(v_)},sphereSymtrackingSDF:{fragmentSource:M_(w_),vertexSource:M_(T_)},sphereDynamicLine:{fragmentSource:M_("#define GLSLIFY 1\n#include <pragma_line_define>\n#include <c_define>\n#include <c_lineF>\nuniform float u_count;uniform float u_segments;varying float v_seq;varying vec2 v_info;void main(){\n#include <pragma_line_initialize>\nfloat total_count=v_info[0];float offset_count=v_info[1];float actualSeq=v_seq-2.0;float actualCount=u_count+offset_count;float quotient=floor(actualCount/(total_count+u_segments));float mod1=mod(quotient,2.0);float count=mod(actualCount,total_count+u_segments);if(mod1!=0.0){count=total_count+u_segments-count;}float start=count-u_segments;float end=count;if(actualSeq<start||actualSeq>end){discard;}mediump float drive_opacity=(actualSeq-start)/u_segments;if(mod1!=0.0){drive_opacity=1.0-drive_opacity;}float dist=length(v_Normal)*v_width2.s;float blur2=(blur+1.0/M_DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=vec4(color.rgb,color.a*(alpha*opacity)*drive_opacity);\n#ifdef M_OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <pragma_line_define>\n#include <pragma_border_define>\n#include <c_define>\n#include <c_lineV>\nattribute float a_seq;attribute vec2 a_info;varying float v_seq;varying vec2 v_info;void main(){\n#include <pragma_line_initialize>\n#include <pragma_border_initialize>\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_seq=a_seq;v_info=a_info;mediump vec2 normal=vec2(a_NORMAL/2.0>=1.0 ? 1.0 : 0.0,mod(a_NORMAL,2.0)==1.0 ? 1.0 :-1.0);v_Normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_HasBorder)?(borderwidth*2.0+width)/2.0 : width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;if(u_HalfRender){if(normaldirection==1.){outset=gapwidth+(normal.y>0. ? halfwidth : 0.)*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;}else{outset=gapwidth+(normal.y<0. ? halfwidth : 0.)*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;}}mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_PixelMatrix*outset*a_extrude*scale;gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION.xyz,1.0);gl_Position.xy+=dist/u_GlUnitsToPixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}")},debugViewPort:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D colorTexture;varying vec2 vUv;void main(){vec4 color=texture2D(colorTexture,vUv);gl_FragColor=vec4(color.r,color.g,color.r,1.0);}"),vertexSource:M_(E_)},debugDepthTexture:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D colorTexture;varying vec2 vUv;\n#include <fn_unpackDepth>\nvoid main(){float z_window=unpackDepth(texture2D(colorTexture,vUv));float n_range=u_CurrentFrustum.x;float f_range=u_CurrentFrustum.y;float z_ndc=(2.0*z_window-n_range-f_range)/(f_range-n_range);float scale=pow(z_ndc*0.5+0.5,1.0);gl_FragColor=vec4(mix(vec3(0.0),vec3(1.0),scale),1.0);}"),vertexSource:M_(E_)},skyboxCapture:{fragmentSource:M_("varying highp vec3 v_position;uniform highp float u_luminance;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\n#define BETA_R vec3(5.5e-6, 13.0e-6, 22.4e-6)\n#define BETA_M vec3(21e-6, 21e-6, 21e-6)\n#define MIE_G 0.76\n#define DENSITY_HEIGHT_SCALE_R 8000.0\n#define DENSITY_HEIGHT_SCALE_M 1200.0\n#define PLANET_RADIUS 6360e3\n#define ATMOSPHERE_RADIUS 6420e3\n#define SAMPLE_STEPS 10\n#define DENSITY_STEPS 4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius){float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return(-b+d)/(2.0*a);}vec3 extinction(vec2 density){return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point){float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle){return(3.0/(16.0*radians(180.0)))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle){return(3.0/(8.0*radians(180.0)))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir){float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for(int i=0;i<DENSITY_STEPS;++i){vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity){vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for(int i=0;i<SAMPLE_STEPS;++i){vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return(scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x){return((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main(){vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_SunLightDirectionLocal,u_SunLightIntensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION3>\nuniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end){return((value-start)*(new_end-new_start))/(end-start)+new_start;}void main(){vec4 pos=vec4(u_matrix_3f*a_POSITION,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_POSITION.xy,0.0,1.0);}")},skybox:{fragmentSource:M_("#define GLSLIFY 1\n#include <v_TexCoord3>\nuniform lowp samplerCube u_cubemap;\n#ifdef M_HAS_STARRY_SKY_MAP\nuniform lowp samplerCube u_starrySkyTextureMap;\n#endif\n#ifdef M_HAS_DAY_MAP\nuniform lowp samplerCube u_dayTextureMap;\n#endif\n#include <u_Opacity>\nfloat sun_disk(highp vec3 ray_direction,highp vec3 sun_direction){highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end){return((value-start)*(new_end-new_start))/(end-start)+new_start;}highp vec3 hash(highp vec2 p){highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed){vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}void main(){vec3 uv=v_TexCoord;\n#ifdef M_HAS_DAY_MAP\nvec3 sky_color=textureCube(u_dayTextureMap,uv).rgb;\n#else\nvec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#endif\n#ifdef M_HAS_STARRY_SKY_MAP\nsky_color=sky_color*u_Opacity+textureCube(u_starrySkyTextureMap,uv).rgb*(1.0-u_Opacity);\n#else\nsky_color=sky_color*u_Opacity+vec3(0.)*(1.0-u_Opacity);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+0.44999999);sky_color+=0.1*sun_disk(v_TexCoord,u_SunLightDirectionLocal)*u_Opacity;gl_FragColor=vec4(sky_color,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION3>\nuniform lowp mat4 u_matrixSkyBox;\n#include <v_TexCoord3>\nvoid main(){const mat3 half_neg_pi_around_x=mat3(1.0,0.0,0.0,0.0,0.0,-1.0,0.0,1.0,0.0);v_TexCoord=half_neg_pi_around_x*a_POSITION;vec4 pos=u_matrixSkyBox*vec4(a_POSITION,1.0);gl_Position=pos.xyww;}")},distanceMaterial:{fragmentSource:M_("#define GLSLIFY 1\nvarying vec4 v_Position;\n#include <v_Show>\n#include <fn_encodeFloat>\nvoid main(){\n#include <c_showF>\nfloat distance=max(dot((u_CameraPosition-v_Position.xyz),u_CameraDirection),0.0);if(distance>65535.0){gl_FragColor=vec4(0.);}else{gl_FragColor=encodeFloat(distance/65535.0);}}"),vertexSource:M_("#define GLSLIFY 1\n#include <fn_vertexLogDepth>\n#include <a_DOUBLE_PRECISION_POSITION>\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <a_BATCHID>\n#include <c_computeSTParsVert>\n#include <u_ModelViewProjectionRelativeToEye>\n#include <u_EncodedCameraPosition>\n#include <fn_translateRelativeToEye>\n#ifdef M_JOINT_MATRIX_CNT\nattribute vec4 a_JOINTS_0;attribute vec4 a_WEIGHTS_0;\n#endif\n#ifdef M_INSTANCE_MATRIX\nattribute mat4 a_InstanceMatrix4;uniform mat4 vpmatrix;\n#endif\n#include <u_HasSkinning>\n#ifdef M_JOINT_MATRIX_CNT\nuniform highp mat4 u_jointMatrix[M_JOINT_MATRIX_CNT];\n#endif\n#ifdef M_USE_MORPHTARGETS\n#include <a_POSITION3_1>\n#include <a_POSITION3_2>\nuniform vec2 u_morphTargetInfluences;\n#include <a_NORMAL3_1>\n#include <a_NORMAL3_2>\n#include <a_TANGENT_1>\n#include <a_TANGENT_2>\n#endif\n#include <u_ModelMatrix>\nvarying vec4 v_Position;\n#include <v_Show>\n#include <fn_getAnimatedGLPosition>\nvoid main(){\n#ifdef M_DOUBLEPRECISION\nv_Position=u_ModelMatrix*vec4(a_PositionHigh+a_PositionLow,1);\n#else\nv_Position=u_ModelMatrix*vec4(a_POSITION,1.0);\n#endif\ngetAnimatedGLPosition();\n#include <c_computeSTMainVert>\n}")},depthMaterial:{fragmentSource:M_("#define GLSLIFY 1\n#ifdef M_LOG_DEPTH\n#include <fn_writeLogDepth>\nvarying float v_depthFromNearPlusOne;\n#include <u_CurrentFrustum>\n#endif\n#ifdef M_DEPTH_DISTANCE\nvarying vec4 v_Position;\n#include <u_CurrentFrustum>\n#endif\n#include <v_Show>\n#include <fn_encodeFloat>\nvoid main(){\n#include <c_showF>\ngl_FragColor=vec4(encodeFloat(gl_FragCoord.z));\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n#ifdef M_DEPTH_DISTANCE\nfloat distance=length(u_CameraPosition-v_Position.xyz);float depth=distance/u_CurrentFrustum.y;gl_FragColor=vec4(depth,depth,depth,1.0);\n#endif\n}"),vertexSource:M_(C_)},normalMaterial:{fragmentSource:M_("#define GLSLIFY 1\nvarying vec3 v_Normal;void main(){gl_FragColor=vec4((v_Normal+1.0)/2.0,1.0);}"),vertexSource:M_("#define GLSLIFY 1\nattribute vec3 a_NORMAL;varying vec3 v_Normal;varying vec4 v_reallyPosition;\n#include <a_POSITION3>\n#include <u_ModelMatrix>\n#include <u_ModelViewProjectionMatrix>\n#include <a_DOUBLE_PRECISION_POSITION>\n#include <u_ModelViewProjectionRelativeToEye>\n#include <u_EncodedCameraPosition>\n#include <fn_translateRelativeToEye>\nvec3 cross2(vec3 a,vec3 b){float ax=a[0];float ay=a[1];float az=a[2];float bx=b[0];float by=b[1];float bz=b[2];vec3 result;result[0]=ay*bz-az*by;result[1]=az*bx-ax*bz;result[2]=ax*by-ay*bx;return-result;}mat4 localFrameToFixedFrame(vec3 cartesianOrigin){vec3 origin=cartesianOrigin;vec3 oneOverRadiiSquared=vec3(2.458172257647332e-14,2.458172257647332e-14,2.4747391015697002e-14);vec3 east=normalize(vec3(-origin.y,origin.x,0.0));vec3 up=normalize(vec3(origin.x*oneOverRadiiSquared.x,origin.y*oneOverRadiiSquared.y,origin.z*oneOverRadiiSquared.z));vec3 north=cross2(up,east);vec3 firstAxisVector=east;vec3 secondAxisVector=north;vec3 thirdAxisVector=up;mat4 result=mat4(firstAxisVector.x,firstAxisVector.y,firstAxisVector.z,0.0,secondAxisVector.x,secondAxisVector.y,secondAxisVector.z,0.0,thirdAxisVector.x,thirdAxisVector.y,thirdAxisVector.z,0.0,origin.x,origin.y,origin.z,1.0);return result;}void main(){\n#ifdef M_DOUBLEPRECISION\ngl_Position=u_ModelViewProjectionRelativeToEye*translateRelativeToEye(a_PositionHigh,a_PositionLow);v_reallyPosition=u_ModelMatrix*vec4(a_PositionHigh+a_PositionLow,1);\n#else\ngl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);v_reallyPosition=u_ModelMatrix*vec4(a_POSITION,1.0);\n#endif\nvec4 delt=u_ModelMatrix*vec4(a_NORMAL,1.0)-u_ModelMatrix*vec4(0.0,0.0,0.0,1.0);v_Normal=normalize(delt.xyz);}")},pickColorMaterial:{fragmentSource:M_("#define GLSLIFY 1\n#if defined(M_USE_PICKINGTEXTURES)\nuniform sampler2D pickColorTexture;varying vec2 batch_featureSt;\n#else\nuniform vec4 u_pickIdColor;\n#endif\n#ifdef M_MODEL_INSTANCE_BATCH_TEXTURE\nvarying vec4 v_PickColor;\n#endif\n#if defined(M_POLYLINE) && defined(M_SHADOW_VOLUME)\n#include <u_PixelRatio>\n#include <u_Viewport>\n#include <u_CurrentFrustum>\n#include <u_FrustumPlanes>\nuniform mat4 u_ViewportTransformation;uniform mat4 u_InverseProjection;uniform sampler2D u_DepthTexture;\n#include <fn_readDepth>\n#include <fn_windowToEyeCoordinates>\n#include <fn_metersPerPixel>\n#include <fn_planeDistance>\nvarying vec4 v_startPlaneNormalEcAndHalfWidth;varying vec4 v_endPlaneNormalEcAndBatchId;varying vec4 v_rightPlaneEC;varying vec4 v_endEcAndStartEcX;varying vec4 v_texcoordNormalizationAndStartEcYZ;\n#endif\n#ifdef M_USE_PICKINGTEXTURES\nvoid main(){gl_FragColor=texture2D(pickColorTexture,batch_featureSt);}\n#else\nvoid main(){\n#if defined(M_POLYLINE) && defined(M_SHADOW_VOLUME)\nfloat logDepthOrDepth=readDepth(u_DepthTexture,gl_FragCoord.xy/u_Viewport.zw,false);if(logDepthOrDepth==0.0){discard;}vec3 ecStart=vec3(v_endEcAndStartEcX.w,v_texcoordNormalizationAndStartEcYZ.zw);vec4 eyeCoordinate=windowToEyeCoordinates(gl_FragCoord.xy,logDepthOrDepth);eyeCoordinate/=eyeCoordinate.w;float halfMaxWidth=v_startPlaneNormalEcAndHalfWidth.w;\n#ifdef M_PIXEL_WIDTH\nhalfMaxWidth*=metersPerPixel(eyeCoordinate);\n#endif\nfloat widthwiseDistance=planeDistance(v_rightPlaneEC,eyeCoordinate.xyz);float distanceFromStart=planeDistance(v_startPlaneNormalEcAndHalfWidth.xyz,-dot(ecStart,v_startPlaneNormalEcAndHalfWidth.xyz),eyeCoordinate.xyz);float distanceFromEnd=planeDistance(v_endPlaneNormalEcAndBatchId.xyz,-dot(v_endEcAndStartEcX.xyz,v_endPlaneNormalEcAndBatchId.xyz),eyeCoordinate.xyz);if(abs(widthwiseDistance)>halfMaxWidth||distanceFromStart<0.0||distanceFromEnd<0.0){discard;}\n#endif\ngl_FragColor=u_pickIdColor;\n#ifdef M_MODEL_INSTANCE_BATCH_TEXTURE\ngl_FragColor=v_PickColor;\n#endif\n}\n#endif\n"),vertexSource:M_(C_)},BillboardMaterial:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D u_BaseColorSampler;\n#include <u_Color4>\n#include <u_Opacity>\nvarying vec2 v_TexCoord;\n#ifdef M_PARTICLSYSTEM\nvarying vec4 v_Color;\n#endif\nvoid main(){\n#if defined(M_USE_BILLBOARDTEXTURE)\n#if defined(M_INSTANCE_MATRIX) && defined(M_PARTICLSYSTEM)\nvec4 texture=texture2D(u_BaseColorSampler,vec2(v_TexCoord.x,v_TexCoord.y));gl_FragColor=vec4(texture.rgb,texture.a*v_Color.a)*u_Opacity;\n#else\ngl_FragColor=texture2D(u_BaseColorSampler,vec2(v_TexCoord.x,v_TexCoord.y))*u_Opacity;\n#endif\n#else\ngl_FragColor=u_Color*u_Opacity;\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\nattribute vec3 a_POSITION;attribute vec2 a_TEXCOORD_0;attribute vec2 a_UVOffset;uniform float u_rotation;uniform vec2 u_center;uniform vec2 u_UVScale;uniform mat4 u_ScaleMatrix;uniform mat4 u_MvMatrix;uniform mat4 u_InvertViewMatrix;uniform mat4 u_ProjectionMatrix;varying vec2 v_TexCoord;\n#ifdef M_INSTANCE_MATRIX\nattribute mat4 a_InstanceMatrix4;\n#endif\n#ifdef M_PARTICLSYSTEM\nattribute vec4 a_COLOR_0;attribute float a_Scale;varying vec4 v_Color;\n#endif\n#ifdef M_FIXED_PIXEL_SIZE\nuniform vec2 u_PixelResolution;uniform mat4 u_ViewportTransformation;uniform vec4 u_Viewport;\n#endif\n#include <fn_billboardVertexPosition>\nvoid main(){v_TexCoord.x=a_TEXCOORD_0.x;v_TexCoord.y=1.0-a_TEXCOORD_0.y;gl_Position=billboardVertexPosition();}")},interferenceAnalysis:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D u_DepthMap0;uniform sampler2D u_DepthMap1;uniform sampler2D u_DepthMap2;uniform sampler2D u_DepthMap3;uniform sampler2D u_DepthMap4;uniform sampler2D u_DepthMap5;uniform int u_SphereType;uniform vec4 u_SphereVisibleAreaColor;uniform vec4 u_SphereHiddenAreaColor;varying vec4 v_renderTextureCoord0;varying vec4 v_renderTextureCoord1;varying vec4 v_renderTextureCoord2;varying vec4 v_renderTextureCoord3;varying vec4 v_renderTextureCoord4;varying vec4 v_renderTextureCoord5;\n#include <fn_unpackDepth>\nbool IsValidUV(vec4 texCoord){if((texCoord.x<=1.0)&&(texCoord.x>=-1.0)&&(texCoord.y<=1.0)&&(texCoord.y>=-1.0)&&(texCoord.z<=1.0)&&(texCoord.z>=-1.0)){return true;}else{return false;}}bool IsVisible(sampler2D shadowMap,vec4 uv){bool isVisible=true;float depth=unpackDepth(texture2D(shadowMap,uv.xy));if(depth<0.00001){return isVisible;}if(uv.z>(depth+0.00001)){isVisible=false;}return isVisible;}bool GetVisibleFlag(){bool isVisible=false;if(IsValidUV(v_renderTextureCoord0)){isVisible=IsVisible(u_DepthMap0,v_renderTextureCoord0);}else if(IsValidUV(v_renderTextureCoord1)){isVisible=IsVisible(u_DepthMap1,v_renderTextureCoord1);}else if(IsValidUV(v_renderTextureCoord2)){isVisible=IsVisible(u_DepthMap2,v_renderTextureCoord2);}else if(IsValidUV(v_renderTextureCoord3)){isVisible=IsVisible(u_DepthMap3,v_renderTextureCoord3);}else if(IsValidUV(v_renderTextureCoord4)){isVisible=IsVisible(u_DepthMap4,v_renderTextureCoord4);}else if(IsValidUV(v_renderTextureCoord5)){isVisible=IsVisible(u_DepthMap5,v_renderTextureCoord5);}return isVisible;}void main(){bool isVisible=GetVisibleFlag();if(u_SphereType==0){if(!isVisible){discard;}else{gl_FragColor=u_SphereVisibleAreaColor;}}else if(u_SphereType==1){if(!isVisible){gl_FragColor=u_SphereHiddenAreaColor;}else{discard;}}else if(u_SphereType==2){if(!isVisible){gl_FragColor=u_SphereHiddenAreaColor;}else{gl_FragColor=u_SphereVisibleAreaColor;}}else{discard;}}"),vertexSource:M_("#define GLSLIFY 1\nuniform mat4 u_TexWorldViewProjMatrix0;uniform mat4 u_TexWorldViewProjMatrix1;uniform mat4 u_TexWorldViewProjMatrix2;uniform mat4 u_TexWorldViewProjMatrix3;uniform mat4 u_TexWorldViewProjMatrix4;uniform mat4 u_TexWorldViewProjMatrix5;varying vec4 v_renderTextureCoord0;varying vec4 v_renderTextureCoord1;varying vec4 v_renderTextureCoord2;varying vec4 v_renderTextureCoord3;varying vec4 v_renderTextureCoord4;varying vec4 v_renderTextureCoord5;vec4 vexPos;uniform float u_Radius;\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\nvec4 GetUV(const mat4 renderTextureMatrix){vec4 texCoord=renderTextureMatrix*vec4(vexPos.xyz,1.0);texCoord=texCoord/texCoord.w;texCoord.xyz=texCoord.xyz*0.5+0.5;return texCoord;}void main(){vexPos=vec4(a_POSITION*u_Radius,1.0);v_renderTextureCoord0=GetUV(u_TexWorldViewProjMatrix0);v_renderTextureCoord1=GetUV(u_TexWorldViewProjMatrix1);v_renderTextureCoord2=GetUV(u_TexWorldViewProjMatrix2);v_renderTextureCoord3=GetUV(u_TexWorldViewProjMatrix3);v_renderTextureCoord4=GetUV(u_TexWorldViewProjMatrix4);v_renderTextureCoord5=GetUV(u_TexWorldViewProjMatrix5);gl_Position=u_ModelViewProjectionMatrix*vexPos;}")},viewDomeAnalysis:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D u_DepthMap0;uniform sampler2D u_DepthMap1;uniform sampler2D u_DepthMap2;uniform sampler2D u_DepthMap3;uniform sampler2D u_DepthMap4;uniform int u_DomeType;uniform vec4 u_VisibleAreaColor;uniform vec4 u_HiddenAreaColor;varying vec4 v_renderTextureCoord0;varying vec4 v_renderTextureCoord1;varying vec4 v_renderTextureCoord2;varying vec4 v_renderTextureCoord3;varying vec4 v_renderTextureCoord4;\n#include <fn_unpackDepth>\nbool IsValidUV(vec4 texCoord){if((texCoord.x<=1.0)&&(texCoord.x>=-1.0)&&(texCoord.y<=1.0)&&(texCoord.y>=-1.0)&&(texCoord.z<=1.0)&&(texCoord.z>=-1.0)){return true;}else{return false;}}bool IsVisible(sampler2D shadowMap,vec4 uv){bool isVisible=true;float depth=unpackDepth(texture2D(shadowMap,uv.xy));if(depth<0.00001){return isVisible;}if(uv.z>(depth+0.00001)){isVisible=false;}return isVisible;}bool GetVisibleFlag(){bool isVisible=true;if(IsValidUV(v_renderTextureCoord0)){isVisible=IsVisible(u_DepthMap0,v_renderTextureCoord0);}else if(IsValidUV(v_renderTextureCoord1)){isVisible=IsVisible(u_DepthMap1,v_renderTextureCoord1);}else if(IsValidUV(v_renderTextureCoord2)){isVisible=IsVisible(u_DepthMap2,v_renderTextureCoord2);}else if(IsValidUV(v_renderTextureCoord3)){isVisible=IsVisible(u_DepthMap3,v_renderTextureCoord3);}else if(IsValidUV(v_renderTextureCoord4)){isVisible=IsVisible(u_DepthMap4,v_renderTextureCoord4);}return isVisible;}void main(){bool isVisible=GetVisibleFlag();if(u_DomeType==0){if(!isVisible){discard;}else{gl_FragColor=u_VisibleAreaColor;}}else if(u_DomeType==1){if(!isVisible){gl_FragColor=u_HiddenAreaColor;}else{discard;}}else{if(!isVisible){gl_FragColor=u_HiddenAreaColor;}else{gl_FragColor=u_VisibleAreaColor;}}}"),vertexSource:M_("#define GLSLIFY 1\nuniform mat4 u_TexWorldViewProjMatrix0;uniform mat4 u_TexWorldViewProjMatrix1;uniform mat4 u_TexWorldViewProjMatrix2;uniform mat4 u_TexWorldViewProjMatrix3;uniform mat4 u_TexWorldViewProjMatrix4;varying vec4 v_renderTextureCoord0;varying vec4 v_renderTextureCoord1;varying vec4 v_renderTextureCoord2;varying vec4 v_renderTextureCoord3;varying vec4 v_renderTextureCoord4;vec4 vexPos;uniform float u_Radius;\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\nvec4 GetUV(const mat4 renderTextureMatrix){vec4 texCoord=renderTextureMatrix*vec4(vexPos.xyz,1.0);texCoord=texCoord/texCoord.w;texCoord.xyz=texCoord.xyz*0.5+0.5;return texCoord;}void main(){vexPos=vec4(a_POSITION*u_Radius,1.0);v_renderTextureCoord0=GetUV(u_TexWorldViewProjMatrix0);v_renderTextureCoord1=GetUV(u_TexWorldViewProjMatrix1);v_renderTextureCoord2=GetUV(u_TexWorldViewProjMatrix2);v_renderTextureCoord3=GetUV(u_TexWorldViewProjMatrix3);v_renderTextureCoord4=GetUV(u_TexWorldViewProjMatrix4);gl_Position=u_ModelViewProjectionMatrix*vexPos;}")},viewDomeCalculateAnalysis:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D u_DepthMap;varying vec4 v_renderTextureCoord;\n#include <fn_unpackDepth>\nbool IsValidUV(vec4 texCoord){if((texCoord.x<=1.0)&&(texCoord.x>=-1.0)&&(texCoord.y<=1.0)&&(texCoord.y>=-1.0)&&(texCoord.z<=1.0)&&(texCoord.z>=-1.0)){return true;}else{return false;}}void main(){bool isVisible=false;if(IsValidUV(v_renderTextureCoord)){float depth=unpackDepth(texture2D(u_DepthMap,v_renderTextureCoord.xy));if(depth>1.0-0.00001){isVisible=true;}}if(!isVisible){gl_FragColor=vec4(1.0,0.0,0.0,1.0);}else{gl_FragColor=vec4(0.0,1.0,0.0,1.0);}}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\nvarying vec4 v_renderTextureCoord;vec4 GetUV(vec4 vexPos){vec4 texCoord=vec4(vexPos.xyz,1.0);texCoord.xyz=texCoord.xyz*0.5+0.5;return texCoord;}void main(){vec4 vexPos=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);v_renderTextureCoord=GetUV(vexPos);gl_Position=vexPos;}")},viewshedAnalysis:{fragmentSource:M_("precision highp float;\n#define GLSLIFY 1\nuniform sampler2D u_DepthTexture;uniform sampler2D u_ViewshedDepthTexture;uniform mat4 u_textureViewMatrix;uniform mat4 u_textureProjMatrix;uniform float u_farDist;varying vec2 v_TexCoord;\n#include <fn_readDepth>\nvoid main(){vec4 result=vec4(0.,0.,0.,1.);if(result.x!=1.0){float sceneDepth=readDepth(u_DepthTexture,v_TexCoord,true);vec4 projPos=vec4(v_TexCoord*2.0-1.0,sceneDepth*2.0-1.0,1.0);vec4 texViewPos=u_textureViewMatrix*projPos;vec4 texProjPos=u_textureProjMatrix*texViewPos;texProjPos/=texProjPos.w;texProjPos.xyz=texProjPos.xyz*0.5+0.5;texViewPos/=texViewPos.w;texViewPos.xyz*=u_farDist/length(texViewPos.xyz);vec4 farPos=u_textureProjMatrix*texViewPos;float farDepth=farPos.z/farPos.w;farDepth=farDepth*0.5+0.5;farDepth=min(farDepth,1.0);if(texProjPos.x>0.0&&texProjPos.x<1.0&&texProjPos.y>0.0&&texProjPos.y<1.0&&texProjPos.z>0.5&&texProjPos.z<farDepth){float texelSize=1.0/2048.0;float depth0=readDepth(u_ViewshedDepthTexture,texProjPos.xy,false);float depth1=readDepth(u_ViewshedDepthTexture,texProjPos.xy+vec2(-texelSize,0.0),false);float depth2=readDepth(u_ViewshedDepthTexture,texProjPos.xy+vec2(texelSize,0.0),false);float depth3=readDepth(u_ViewshedDepthTexture,texProjPos.xy+vec2(0.0,-texelSize),false);float depth4=readDepth(u_ViewshedDepthTexture,texProjPos.xy+vec2(0.0,texelSize),false);float depth=max(max(max(max(depth0,depth1),depth2),depth3),depth4);if(depth<1.0&&depth-texProjPos.z<-1.0e-5){result.x=0.5;}else{result.x=1.0;}}}gl_FragColor=result;}"),vertexSource:M_(S_)},viewshedMix:{fragmentSource:M_("precision highp float;\n#define GLSLIFY 1\nuniform sampler2D u_resultTexture;uniform vec4 u_visibleAreaColor;uniform vec4 u_hiddenAreaColor;varying vec2 v_TexCoord;void main(){vec4 color=vec4(0.0);vec4 result=texture2D(u_resultTexture,v_TexCoord);if(result.x>0.9){color=u_visibleAreaColor;}else if(result.x>0.4){color=u_hiddenAreaColor;}gl_FragColor=color;}"),vertexSource:M_(S_)},sightlineAnalysis:{fragmentSource:M_("#define GLSLIFY 1\nuniform vec4 u_VisibleColor;uniform vec4 u_HiddenColor;uniform sampler2D u_DepthTexture;uniform sampler2D u_ViewshedDepthTexture;uniform bool u_MainCameraDetection;\n#include <fn_readDepth>\nvarying vec4 v_ViewshedTexCoord;varying vec4 v_TexCoord;void main(){vec4 resultColor=u_VisibleColor;vec4 texCoord=v_ViewshedTexCoord/v_ViewshedTexCoord.w;float depth=texCoord.z*0.5+0.5;texCoord.xy=texCoord.xy*0.5+0.5;float viewshedDepth=readDepth(u_ViewshedDepthTexture,texCoord.xy,false);if(viewshedDepth<depth&&viewshedDepth>0.0&&viewshedDepth<1.0){resultColor=u_HiddenColor;}if(u_MainCameraDetection){vec4 sceneTexCoord=v_TexCoord/v_TexCoord.w;float linePixelDepth=sceneTexCoord.z*0.5+0.5;sceneTexCoord.xy=sceneTexCoord.xy*0.5+0.5;float sceneDepth=readDepth(u_DepthTexture,sceneTexCoord.xy,true);if(sceneDepth<linePixelDepth){resultColor=vec4(0.4,0.4,0.4,1.0);}}gl_FragColor=resultColor;}"),vertexSource:M_("precision highp float;\n#define GLSLIFY 1\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\nuniform mat4 u_ModelViewProjectionMatrixOnViewshed;varying vec4 v_ViewshedTexCoord;varying vec4 v_TexCoord;void main(){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION,1.0);v_ViewshedTexCoord=u_ModelViewProjectionMatrixOnViewshed*vec4(a_POSITION,1.0);v_TexCoord=gl_Position;}")},sightlineMix:{fragmentSource:M_("precision highp float;\n#define GLSLIFY 1\nuniform sampler2D u_resultTexture;uniform vec4 u_VisibleColor;uniform vec4 u_HiddenColor;varying vec2 v_TexCoord;uniform vec2 u_World;float visibleCount=0.0;float hiddenCount=0.0;float otherCount=0.0;vec4 grayColor=vec4(0.4,0.4,0.4,1.0);float epsilon=0.002;void checkPixel(vec4 pixel){if(length(pixel-u_HiddenColor)<epsilon){hiddenCount++;}else if(length(pixel-u_VisibleColor)<epsilon){visibleCount++;}else if(length(pixel-grayColor)<epsilon){otherCount++;}}void main(){vec4 result=texture2D(u_resultTexture,v_TexCoord);checkPixel(result);for(float i=1.0;i<float(M_LINE_WIDTH);i++){checkPixel(texture2D(u_resultTexture,v_TexCoord+vec2(0.0,i/u_World.y)));checkPixel(texture2D(u_resultTexture,v_TexCoord-vec2(0.0,i/u_World.y)));checkPixel(texture2D(u_resultTexture,v_TexCoord+vec2(i/u_World.x,0.0)));checkPixel(texture2D(u_resultTexture,v_TexCoord-vec2(i/u_World.x,0.0)));}if(hiddenCount>0.0||visibleCount>0.0||otherCount>0.0){if(visibleCount>hiddenCount){if(visibleCount>otherCount){gl_FragColor=u_VisibleColor;}else{gl_FragColor=grayColor;}}else{if(hiddenCount>otherCount){gl_FragColor=u_HiddenColor;}else{gl_FragColor=grayColor;}}}else{gl_FragColor=result;}}"),vertexSource:M_(S_)},PolylineMaterial:{fragmentSource:M_("#include <u_Opacity>\n#ifndef M_POLYLINE_DASH\n#include <u_PixelRatio>\n#endif\n#extension GL_EXT_frag_depth : enable\n#define GLSLIFY 1\nuniform float u_OneOverLog2FarDepthFromNearPlusOne;uniform float u_FarDepthFromNearPlusOne;\n#ifdef M_SHADOW_VOLUME\n#include <u_Viewport>\n#include <u_CurrentFrustum>\n#include <u_FrustumPlanes>\nuniform mat4 u_ViewportTransformation;uniform mat4 u_InverseProjection;uniform sampler2D u_DepthTexture;\n#include <fn_readDepth>\n#include <fn_windowToEyeCoordinates>\n#include <fn_metersPerPixel>\n#include <fn_planeDistance>\nvarying vec4 v_startPlaneNormalEcAndHalfWidth;varying vec4 v_endPlaneNormalEcAndBatchId;varying vec4 v_rightPlaneEC;varying vec4 v_endEcAndStartEcX;varying vec4 v_texcoordNormalizationAndStartEcYZ;\n#else\n#include <v_TexCoord2>\n#endif\n#ifdef M_LOG_DEPTH\nvarying float v_depthFromNearPlusOne;\n#endif\n#ifdef M_VERTEX_COLOR\nvarying vec3 v_Color;\n#endif\nvoid czm_writeLogDepth(float depth){\n#if defined(GL_EXT_frag_depth) && defined(M_LOG_DEPTH)\nif(depth<=0.9999999||depth>u_FarDepthFromNearPlusOne){discard;}gl_FragDepthEXT=log2(depth)*u_OneOverLog2FarDepthFromNearPlusOne;\n#endif\n}void czm_writeLogDepth(){\n#ifdef M_LOG_DEPTH\nczm_writeLogDepth(v_depthFromNearPlusOne);\n#endif\n}void main(){vec2 texCoord=vec2(0.0);\n#ifdef M_SHADOW_VOLUME\n#ifdef M_SHADOWVOLUME_DISCARD\nfloat flag=texture2D(u_DepthTexture,gl_FragCoord.xy/u_Viewport.zw).g;if(flag>0.1){discard;}\n#endif\nfloat logDepthOrDepth=readDepth(u_DepthTexture,gl_FragCoord.xy/u_Viewport.zw,false);if(logDepthOrDepth==0.0){discard;}vec3 ecStart=vec3(v_endEcAndStartEcX.w,v_texcoordNormalizationAndStartEcYZ.zw);vec4 eyeCoordinate=windowToEyeCoordinates(gl_FragCoord.xy,logDepthOrDepth);eyeCoordinate/=eyeCoordinate.w;float halfMaxWidth=v_startPlaneNormalEcAndHalfWidth.w;\n#ifdef M_PIXEL_WIDTH\nhalfMaxWidth*=metersPerPixel(eyeCoordinate);\n#endif\nfloat widthwiseDistance=planeDistance(v_rightPlaneEC,eyeCoordinate.xyz);float distanceFromStart=planeDistance(v_startPlaneNormalEcAndHalfWidth.xyz,-dot(ecStart,v_startPlaneNormalEcAndHalfWidth.xyz),eyeCoordinate.xyz);float distanceFromEnd=planeDistance(v_endPlaneNormalEcAndBatchId.xyz,-dot(v_endEcAndStartEcX.xyz,v_endPlaneNormalEcAndBatchId.xyz),eyeCoordinate.xyz);if(abs(widthwiseDistance)>halfMaxWidth||distanceFromStart<0.0||distanceFromEnd<0.0){discard;}vec3 alignedPlaneNormal;alignedPlaneNormal=cross(v_rightPlaneEC.xyz,v_startPlaneNormalEcAndHalfWidth.xyz);alignedPlaneNormal=normalize(cross(alignedPlaneNormal,v_rightPlaneEC.xyz));distanceFromStart=planeDistance(alignedPlaneNormal,-dot(alignedPlaneNormal,ecStart),eyeCoordinate.xyz);alignedPlaneNormal=cross(v_rightPlaneEC.xyz,v_endPlaneNormalEcAndBatchId.xyz);alignedPlaneNormal=normalize(cross(alignedPlaneNormal,v_rightPlaneEC.xyz));distanceFromEnd=planeDistance(alignedPlaneNormal,-dot(alignedPlaneNormal,v_endEcAndStartEcX.xyz),eyeCoordinate.xyz);float s=clamp(distanceFromStart/(distanceFromStart+distanceFromEnd),0.0,1.0);s=(s*v_texcoordNormalizationAndStartEcYZ.x)+v_texcoordNormalizationAndStartEcYZ.y;float t=(widthwiseDistance+halfMaxWidth)/(2.0*halfMaxWidth);texCoord=vec2(s,t);\n#else\ntexCoord=v_TexCoord;\n#endif\nvec4 color;\n#ifdef M_VERTEX_COLOR\ncolor=vec4(v_Color,1.0);\n#else\ncolor=getMaterial(texCoord);\n#endif\ngl_FragColor=vec4(color.rgb,color.a*u_Opacity);czm_writeLogDepth();}"),vertexSource:M_("#define GLSLIFY 1\n#include <u_CurrentFrustum>\n#include <u_FrustumPlanes>\n#include <u_EncodedCameraPosition>\n#include <u_ProjectionMatrix>\n#include <u_PixelRatio>\n#include <u_Viewport>\n#include <fn_metersPerPixel>\nuniform mat4 u_ViewportTransformation;uniform mat4 u_ViewportOrthographic;uniform mat4 u_modelViewRelativeToEye;uniform mat3 u_Normal;uniform float u_GlobeMinimumAltitude;uniform float u_GeometricToleranceOverMeter;\n#include <fn_translateRelativeToEye>\n#ifdef M_SHADOW_VOLUME\nattribute vec3 a_PositionHigh;attribute vec3 a_PositionLow;attribute vec3 a_StartHigh;attribute vec3 a_StartLow;attribute vec3 a_StartNormal;attribute vec3 a_EndNormal;attribute vec3 a_RightNormal;attribute vec3 a_ForwardOffset;attribute vec2 a_TexCoord;attribute float a_Width;varying vec4 v_startPlaneNormalEcAndHalfWidth;varying vec4 v_endPlaneNormalEcAndBatchId;varying vec4 v_rightPlaneEC;varying vec4 v_endEcAndStartEcX;varying vec4 v_texcoordNormalizationAndStartEcYZ;\n#include <fn_planeDistance>\n#include <fn_branchFreeTernary>\n#include <fn_polylineVolumePosition>\n#else\nattribute vec3 a_PositionHigh;attribute vec3 a_PositionLow;attribute vec3 a_PrevPositionHigh;attribute vec3 a_PrevPositionLow;attribute vec3 a_NextPositionHigh;attribute vec3 a_NextPositionLow;attribute vec2 a_ExpandAndWidth;attribute vec2 a_TEXCOORD_0;\n#include <fn_polylineVertexPosition>\n#include <v_TexCoord2>\n#endif\nvarying float v_polylineAngle;\n#ifdef M_LOG_DEPTH\nvarying float v_depthFromNearPlusOne;\n#include <fn_vertexLogDepth>\n#endif\n#ifdef M_VERTEX_COLOR\nattribute vec3 a_Color;varying vec3 v_Color;\n#endif\nvoid main(){\n#ifdef M_SHADOW_VOLUME\nfloat angle;gl_Position=polylineVolumePosition(angle);v_polylineAngle=angle;gl_Position.z=min(gl_Position.z,gl_Position.w);\n#else\nfloat angle;vec4 positionWC=polylineVertexPosition(angle);v_polylineAngle=angle;gl_Position=u_ViewportOrthographic*positionWC;v_TexCoord=a_TEXCOORD_0;\n#endif\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\n#ifdef M_VERTEX_COLOR\nv_Color=a_Color;\n#endif\n}")},point:{fragmentSource:M_("#define GLSLIFY 1\nvarying vec4 v_color;varying vec4 v_outlineColor;varying float v_innerPercent;varying float v_pixelDistance;\n#ifdef M_PICK_COLOR\nvarying vec4 v_PickColor;\n#endif\n#include <u_CurrentFrustum>\n#include <fn_writeLogDepth>\n#ifdef M_LOG_DEPTH\nvarying float v_depthFromNearPlusOne;\n#endif\nvoid main(){float distanceToCenter=length(gl_PointCoord-vec2(0.5));float maxDistance=max(0.0,0.5-v_pixelDistance);float wholeAlpha=1.0-smoothstep(maxDistance,0.5,distanceToCenter);float innerAlpha=1.0-smoothstep(maxDistance*v_innerPercent,0.5*v_innerPercent,distanceToCenter);vec4 color=mix(v_outlineColor,v_color,innerAlpha);color.a*=wholeAlpha;\n#if !defined(M_OPAQUE) && !defined(M_TRANSLUCENT)\nif(color.a<0.005){discard;}\n#else\n#ifdef M_OPAQUE\nif(color.a<0.995){discard;}\n#else\nif(color.a>=0.995){discard;}\n#endif\n#endif\n#ifdef M_PICK_COLOR\ngl_FragColor=v_PickColor;\n#else\ngl_FragColor=color;\n#endif\n#ifdef M_LOG_DEPTH\nwriteLogDepth(v_depthFromNearPlusOne,u_CurrentFrustum);\n#endif\n}"),vertexSource:M_("#define GLSLIFY 1\nuniform float u_maxTotalPointSize;\n#include <u_PixelRatio>\nuniform mat4 u_modelViewRelativeToEye;\n#include <u_ProjectionMatrix>\nuniform vec2 u_CurrentFrustum;attribute vec4 a_PositionHighAndSize;attribute vec4 a_PositionLowAndOutline;attribute vec3 a_CompressedAttribute0;attribute vec4 a_CompressedAttribute1;attribute vec4 a_ScaleByDistance;attribute vec2 a_DistanceDisplayCondition;varying vec4 v_color;varying vec4 v_outlineColor;varying float v_innerPercent;varying float v_pixelDistance;const float SHIFT_LEFT8=256.0;const float SHIFT_RIGHT8=1.0/256.0;\n#include <u_EncodedCameraPosition>\n#include <fn_translateRelativeToEye>\n#include <fn_nearFarScalar>\n#include <fn_vertexLogDepth>\n#ifdef M_PICK_COLOR\nattribute vec4 a_PickColor;varying vec4 v_PickColor;\n#endif\nvoid main(){vec3 positionHigh=a_PositionHighAndSize.xyz;vec3 positionLow=a_PositionLowAndOutline.xyz;float outlineWidthBothSides=2.0*a_PositionLowAndOutline.w;float totalSize=a_PositionHighAndSize.w+outlineWidthBothSides;float outlinePercent=outlineWidthBothSides/totalSize;totalSize*=u_PixelRatio;totalSize+=3.0;float temp=a_CompressedAttribute1.x*SHIFT_RIGHT8;float show=floor(temp);\n#ifdef M_EYE_DISTANCE_TRANSLUCENCY\nvec4 translucencyByDistance;translucencyByDistance.x=a_CompressedAttribute1.z;translucencyByDistance.z=a_CompressedAttribute1.w;translucencyByDistance.y=((temp-floor(temp))*SHIFT_LEFT8)/255.0;temp=a_CompressedAttribute1.y*SHIFT_RIGHT8;translucencyByDistance.w=((temp-floor(temp))*SHIFT_LEFT8)/255.0;\n#endif\nvec4 color;vec4 outlineColor;temp=a_CompressedAttribute0.x*SHIFT_RIGHT8;color.b=(temp-floor(temp))*SHIFT_LEFT8;temp=floor(temp)*SHIFT_RIGHT8;color.g=(temp-floor(temp))*SHIFT_LEFT8;color.r=floor(temp);temp=a_CompressedAttribute0.y*SHIFT_RIGHT8;outlineColor.b=(temp-floor(temp))*SHIFT_LEFT8;temp=floor(temp)*SHIFT_RIGHT8;outlineColor.g=(temp-floor(temp))*SHIFT_LEFT8;outlineColor.r=floor(temp);temp=a_CompressedAttribute0.z*SHIFT_RIGHT8;temp=floor(temp)*SHIFT_RIGHT8;outlineColor.a=(temp-floor(temp))*SHIFT_LEFT8;outlineColor/=255.0;color.a=floor(temp);color/=255.0;vec4 p=translateRelativeToEye(positionHigh,positionLow);vec4 positionEC=u_modelViewRelativeToEye*p;float lengthSq;\n#if defined(M_EYE_DISTANCE_SCALING) || defined(M_EYE_DISTANCE_TRANSLUCENCY) || defined(M_DISTANCE_DISPLAY_CONDITION)\nlengthSq=dot(positionEC.xyz,positionEC.xyz);\n#endif\n#ifdef M_EYE_DISTANCE_SCALING\ntotalSize*=nearFarScalar(a_ScaleByDistance,lengthSq);\n#endif\ntotalSize=min(totalSize,u_maxTotalPointSize);if(totalSize<1.0){positionEC.xyz=vec3(0.0);totalSize=1.0;}float translucency=1.0;\n#ifdef M_EYE_DISTANCE_TRANSLUCENCY\ntranslucency=nearFarScalar(translucencyByDistance,lengthSq);if(translucency<0.004){positionEC.xyz=vec3(0.0);}\n#endif\n#ifdef M_DISTANCE_DISPLAY_CONDITION\nfloat nearSq=a_DistanceDisplayCondition.x;float farSq=a_DistanceDisplayCondition.y;if(lengthSq<nearSq||lengthSq>farSq){positionEC.xyz=vec3(0.0,0.0,1.0);}\n#endif\ngl_Position=u_ProjectionMatrix*positionEC;\n#ifdef M_LOG_DEPTH\nv_depthFromNearPlusOne=vertexLogDepth(u_CurrentFrustum);\n#endif\nv_color=color;v_color.a*=translucency*show;v_outlineColor=outlineColor;v_outlineColor.a*=translucency*show;v_innerPercent=1.0-outlinePercent;v_pixelDistance=2.0/totalSize;gl_PointSize=totalSize*show;gl_Position*=show;\n#ifdef M_PICK_COLOR\nv_PickColor=a_PickColor;\n#endif\n}")},AcesTonemappingStage:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D colorTexture;\n#include <u_Gamma>\n#include <fn_acesTonemapping>\n#include <fn_inverseGamma>\nvarying vec2 v_TexCoord;\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\nvoid main(){vec4 fragmentColor=texture2D(colorTexture,v_TexCoord);vec3 color=fragmentColor.rgb;\n#ifdef AUTO_EXPOSURE\ncolor/=texture2D(autoExposure,vec2(0.5)).r;\n#endif\ncolor=acesTonemapping(color);color=inverseGamma(color,u_Gamma);gl_FragColor=vec4(color,fragmentColor.a);}")},AdditiveBlend:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D colorTexture;uniform sampler2D colorTexture2;uniform vec2 center;uniform float radius;varying vec2 v_TexCoord;void main(){vec4 color0=texture2D(colorTexture,v_TexCoord);vec4 color1=texture2D(colorTexture2,v_TexCoord);float x=length(gl_FragCoord.xy-center)/radius;float t=smoothstep(0.5,0.8,x);gl_FragColor=mix(color0+color1,color1,t);}")},AmbientOcclusionGenerate:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D randomTexture;uniform sampler2D u_depthTexture;uniform float intensity;uniform float bias;uniform float lengthCap;uniform float stepSize;uniform float frustumLength;\n#include <u_Viewport>\n#include <u_PixelRatio>\n#include <fn_readDepth>\nvarying vec2 v_TexCoord;vec4 clipToEye(vec2 uv,float depth){vec2 xy=vec2((uv.x*2.0-1.0),((1.0-uv.y)*2.0-1.0));vec4 posEC=czm_inverseProjection*vec4(xy,depth,1.0);posEC=posEC/posEC.w;return posEC;}vec3 getNormalXEdge(vec3 posInCamera,float depthU,float depthD,float depthL,float depthR,vec2 pixelSize){vec4 posInCameraUp=clipToEye(v_TexCoord-vec2(0.0,pixelSize.y),depthU);vec4 posInCameraDown=clipToEye(v_TexCoord+vec2(0.0,pixelSize.y),depthD);vec4 posInCameraLeft=clipToEye(v_TexCoord-vec2(pixelSize.x,0.0),depthL);vec4 posInCameraRight=clipToEye(v_TexCoord+vec2(pixelSize.x,0.0),depthR);vec3 up=posInCamera.xyz-posInCameraUp.xyz;vec3 down=posInCameraDown.xyz-posInCamera.xyz;vec3 left=posInCamera.xyz-posInCameraLeft.xyz;vec3 right=posInCameraRight.xyz-posInCamera.xyz;vec3 DX=length(left)<length(right)? left : right;vec3 DY=length(up)<length(down)? up : down;return normalize(cross(DY,DX));}void main(void){float depth=readDepth(u_depthTexture,v_TexCoord,true);vec4 posInCamera=clipToEye(v_TexCoord,depth);if(posInCamera.z>frustumLength){gl_FragColor=vec4(1.0);return;}vec2 pixelSize=u_PixelRatio/u_Viewport.zw;float depthU=readDepth(u_depthTexture,v_TexCoord-vec2(0.0,pixelSize.y),true);float depthD=readDepth(u_depthTexture,v_TexCoord+vec2(0.0,pixelSize.y),true);float depthL=readDepth(u_depthTexture,v_TexCoord-vec2(pixelSize.x,0.0),true);float depthR=readDepth(u_depthTexture,v_TexCoord+vec2(pixelSize.x,0.0),true);vec3 normalInCamera=getNormalXEdge(posInCamera.xyz,depthU,depthD,depthL,depthR,pixelSize);float ao=0.0;vec2 sampleDirection=vec2(1.0,0.0);float gapAngle=90.0*czm_radiansPerDegree;float randomVal=texture2D(randomTexture,v_TexCoord).x;for(int i=0;i<4;i++){float newGapAngle=gapAngle*(float(i)+randomVal);float cosVal=cos(newGapAngle);float sinVal=sin(newGapAngle);vec2 rotatedSampleDirection=vec2(cosVal*sampleDirection.x-sinVal*sampleDirection.y,sinVal*sampleDirection.x+cosVal*sampleDirection.y);float localAO=0.0;float localStepSize=stepSize;for(int j=0;j<6;j++){vec2 newCoords=v_TexCoord+rotatedSampleDirection*localStepSize*pixelSize;if(newCoords.x>1.0||newCoords.y>1.0||newCoords.x<0.0||newCoords.y<0.0){break;}float stepDepthInfo=readDepth(u_depthTexture,newCoords,true);vec4 stepPosInCamera=clipToEye(newCoords,stepDepthInfo);vec3 diffVec=stepPosInCamera.xyz-posInCamera.xyz;float len=length(diffVec);if(len>lengthCap){break;}float dotVal=clamp(dot(normalInCamera,normalize(diffVec)),0.0,1.0);float weight=len/lengthCap;weight=1.0-weight*weight;if(dotVal<bias){dotVal=0.0;}localAO=max(localAO,dotVal*weight);localStepSize+=stepSize;}ao+=localAO;}ao/=4.0;ao=1.0-clamp(ao,0.0,1.0);ao=pow(ao,intensity);gl_FragColor=vec4(vec3(ao),1.0);}")},AmbientOcclusionModulate:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D colorTexture;uniform sampler2D ambientOcclusionTexture;uniform bool ambientOcclusionOnly;varying vec2 v_TexCoord;void main(void){vec3 color=texture2D(colorTexture,v_TexCoord).rgb;vec3 ao=texture2D(ambientOcclusionTexture,v_TexCoord).rgb;gl_FragColor.rgb=ambientOcclusionOnly ? ao : ao*color;}")},BlackAndWhite:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D colorTexture;uniform float gradations;\n#include <fn_luminance>\nvarying vec2 v_TexCoord;void main(void){vec3 rgb=texture2D(colorTexture,v_TexCoord).rgb;\n#ifdef CZM_SELECTED_FEATURE\nif(czm_selected()){gl_FragColor=vec4(rgb,1.0);return;}\n#endif\nfloat luminance=luminance(rgb);float darkness=luminance*gradations;darkness=(darkness-fract(darkness))/gradations;gl_FragColor=vec4(vec3(darkness),1.0);}")},BloomComposite:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D colorTexture;uniform sampler2D bloomTexture;uniform bool glowOnly;varying vec2 v_TexCoord;void main(void){vec4 color=texture2D(colorTexture,v_TexCoord);\n#ifdef CZM_SELECTED_FEATURE\nif(czm_selected()){gl_FragColor=color;return;}\n#endif\nvec4 bloom=texture2D(bloomTexture,v_TexCoord);gl_FragColor=glowOnly ? bloom : bloom+color;}")},Brightness:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D colorTexture;uniform float brightness;varying vec2 v_TexCoord;void main(void){vec3 rgb=texture2D(colorTexture,v_TexCoord).rgb;vec3 target=vec3(0.0);gl_FragColor=vec4(mix(target,rgb,brightness),1.0);}")},BrightPass:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D colorTexture;uniform float avgLuminance;uniform float threshold;uniform float offset;\n#include <fn_RGBToXYZ>\n#include <fn_XYZToRGB>\nvarying vec2 v_TexCoord;float key(float avg){float guess=1.5-(1.5/(avg*0.1+1.0));return max(0.0,guess)+0.1;}void main(){vec4 color=texture2D(colorTexture,v_TexCoord);vec3 xyz=RGBToXYZ(color.rgb);float luminance=xyz.r;float scaledLum=key(avgLuminance)*luminance/avgLuminance;float brightLum=max(scaledLum-threshold,0.0);float brightness=brightLum/(offset+brightLum);xyz.r=brightness;gl_FragColor=vec4(XYZToRGB(xyz),1.0);}")},CompositeTranslucentClassification:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D colorTexture;\n#ifdef DEBUG_SHOW_DEPTH\nuniform sampler2D u_packedTranslucentDepth;\n#endif\n#include <fn_unpackDepth>\nvarying vec2 v_TexCoord;void main(){\n#ifdef DEBUG_SHOW_DEPTH\nif(v_TexCoord.x<0.5){gl_FragColor.rgb=vec3(unpackDepth(texture2D(u_packedTranslucentDepth,v_TexCoord)));gl_FragColor.a=1.0;}\n#else\nvec4 color=texture2D(colorTexture,v_TexCoord);\n#ifdef PICK\nif(color==vec4(0.0)){discard;}\n#else\ncolor.rgb/=color.a;\n#endif\ngl_FragColor=color;\n#endif\n}")},ContrastBias:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D colorTexture;uniform float contrast;uniform float brightness;\n#include <fn_HSBToRGB>\n#include <fn_RGBToHSB>\nvarying vec2 v_TexCoord;void main(void){vec3 sceneColor=texture2D(colorTexture,v_TexCoord).xyz;sceneColor=RGBToHSB(sceneColor);sceneColor.z+=brightness;sceneColor=HSBToRGB(sceneColor);float factor=(259.0*(contrast+255.0))/(255.0*(259.0-contrast));sceneColor=factor*(sceneColor-vec3(0.5))+vec3(0.5);gl_FragColor=vec4(sceneColor,1.0);}")},DepthOfField:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D colorTexture;uniform sampler2D blurTexture;uniform sampler2D u_depthTexture;uniform float focalDistance;\n#include <fn_readDepth>\nvarying vec2 v_TexCoord;vec4 toEye(vec2 uv,float depth){vec2 xy=vec2((uv.x*2.0-1.0),((1.0-uv.y)*2.0-1.0));vec4 posInCamera=czm_inverseProjection*vec4(xy,depth,1.0);posInCamera=posInCamera/posInCamera.w;return posInCamera;}float computeDepthBlur(float depth){float f;if(depth<focalDistance){f=(focalDistance-depth)/(focalDistance-czm_currentFrustum.x);}else{f=(depth-focalDistance)/(czm_currentFrustum.y-focalDistance);f=pow(f,0.1);}f*=f;f=clamp(f,0.0,1.0);return pow(f,0.5);}void main(void){float depth=readDepth(u_depthTexture,v_TexCoord,true);vec4 posInCamera=toEye(v_TexCoord,depth);float d=computeDepthBlur(-posInCamera.z);gl_FragColor=mix(texture2D(colorTexture,v_TexCoord),texture2D(blurTexture,v_TexCoord),d);}")},DepthView:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D u_depthTexture;\n#include <fn_readDepth>\nvarying vec2 v_TexCoord;void main(void){float depth=readDepth(u_depthTexture,v_TexCoord,true);gl_FragColor=vec4(vec3(depth),1.0);}")},DepthViewPacked:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D u_depthTexture;\n#include <fn_unpackDepth>\n#include <fn_reverseLogDepth>\nvarying vec2 v_TexCoord;void main(){float z_window=unpackDepth(texture2D(u_depthTexture,v_TexCoord));z_window=reverseLogDepth(z_window);float n_range=czm_depthRange.near;float f_range=czm_depthRange.far;float z_ndc=(2.0*z_window-n_range-f_range)/(f_range-n_range);float scale=pow(z_ndc*0.5+0.5,8.0);gl_FragColor=vec4(mix(vec3(0.0),vec3(1.0),scale),1.0);}")},EdgeDetection:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D depthTexture;uniform float length;uniform vec4 color;\n#include <u_PixelRatio>\n#include <u_Viewport>\n#include <fn_readDepth>\nvarying vec2 v_TexCoord;void main(void){float directions[3];directions[0]=-1.0;directions[1]=0.0;directions[2]=1.0;float scalars[3];scalars[0]=3.0;scalars[1]=10.0;scalars[2]=3.0;float padx=u_PixelRatio/u_Viewport.z;float pady=u_PixelRatio/u_Viewport.w;\n#ifdef CZM_SELECTED_FEATURE\nbool selected=false;for(int i=0;i<3;++i){float dir=directions[i];selected=selected||czm_selected(vec2(-padx,dir*pady));selected=selected||czm_selected(vec2(padx,dir*pady));selected=selected||czm_selected(vec2(dir*padx,-pady));selected=selected||czm_selected(vec2(dir*padx,pady));if(selected){break;}}if(!selected){gl_FragColor=vec4(color.rgb,0.0);return;}\n#endif\nfloat horizEdge=0.0;float vertEdge=0.0;for(int i=0;i<3;++i){float dir=directions[i];float scale=scalars[i];horizEdge-=readDepth(depthTexture,v_TexCoord+vec2(-padx,dir*pady),true)*scale;horizEdge+=readDepth(depthTexture,v_TexCoord+vec2(padx,dir*pady),true)*scale;vertEdge-=readDepth(depthTexture,v_TexCoord+vec2(dir*padx,-pady),true)*scale;vertEdge+=readDepth(depthTexture,v_TexCoord+vec2(dir*padx,pady),true)*scale;}float len=sqrt(horizEdge*horizEdge+vertEdge*vertEdge);gl_FragColor=vec4(color.rgb,len>length ? color.a : 0.0);}")},FilmicTonemapping:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D colorTexture;\n#include <u_Gamma>\n#include <fn_inverseGamma>\nvarying vec2 v_TexCoord;\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\nvoid main(){vec4 fragmentColor=texture2D(colorTexture,v_TexCoord);vec3 color=fragmentColor.rgb;\n#ifdef AUTO_EXPOSURE\nfloat exposure=texture2D(autoExposure,vec2(0.5)).r;color/=exposure;\n#endif\nconst float A=0.22;const float B=0.30;const float C=0.10;const float D=0.20;const float E=0.01;const float F=0.30;const float white=11.2;vec3 c=((color*(A*color+C*B)+D*E)/(color*(A*color+B)+D*F))-E/F;float w=((white*(A*white+C*B)+D*E)/(white*(A*white+B)+D*F))-E/F;c=inverseGamma(c/w,u_Gamma);gl_FragColor=vec4(c,fragmentColor.a);}")},FXAA:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D colorTexture;\n#include <u_Resolution>\nconst float fxaaQualitySubpix=0.5;const float fxaaQualityEdgeThreshold=0.125;const float fxaaQualityEdgeThresholdMin=0.0833;varying vec2 v_TexCoord;\n#include <fn_nvidia_fxaa>\nvoid main(){vec2 fxaaQualityRcpFrame=vec2(1.0)/u_Resolution;vec4 color=FxaaPixelShader(v_TexCoord,colorTexture,fxaaQualityRcpFrame,fxaaQualitySubpix,fxaaQualityEdgeThreshold,fxaaQualityEdgeThresholdMin);float alpha=texture2D(colorTexture,v_TexCoord).a;gl_FragColor=vec4(color.rgb,alpha);}")},GaussianBlur1D:{fragmentSource:M_("#define GLSLIFY 1\n#define SAMPLES 8\nuniform float delta;uniform float sigma;uniform float direction;\n#include <u_Viewport>\n#include <u_PixelRatio>\nuniform sampler2D colorTexture;\n#ifdef USE_STEP_SIZE\nuniform float stepSize;\n#else\nuniform vec2 step;\n#endif\nvarying vec2 v_TexCoord;void main(){vec2 st=v_TexCoord;vec2 dir=vec2(1.0-direction,direction);\n#ifdef USE_STEP_SIZE\nvec2 step=vec2(stepSize*(u_PixelRatio/u_Viewport.zw));\n#else\nvec2 step=step;\n#endif\nvec3 g;g.x=1.0/(sqrt(czm_twoPi)*sigma);g.y=exp((-0.5*delta*delta)/(sigma*sigma));g.z=g.y*g.y;vec4 result=texture2D(colorTexture,st)*g.x;for(int i=1;i<SAMPLES;++i){g.xy*=g.yz;vec2 offset=float(i)*dir*step;result+=texture2D(colorTexture,st-offset)*g.x;result+=texture2D(colorTexture,st+offset)*g.x;}gl_FragColor=result;}")},LensFlare:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D colorTexture;uniform sampler2D dirtTexture;uniform sampler2D starTexture;uniform vec2 dirtTextureDimensions;uniform float distortion;uniform float ghostDispersal;uniform float haloWidth;uniform float dirtAmount;uniform float earthRadius;uniform float intensity;\n#include <u_Viewport>\n#include <u_PixelRatio>\nvarying vec2 v_TexCoord;\n#define DISTANCE_TO_SPACE 6500000.0\nvec4 getNDCFromWC(vec3 WC,float earthRadius){vec4 positionEC=czm_view*vec4(WC,1.0);positionEC=vec4(positionEC.x+earthRadius,positionEC.y,positionEC.z,1.0);vec4 positionWC=czm_eyeToWindowCoordinates(positionEC);return czm_viewportOrthographic*vec4(positionWC.xy,-positionWC.z,1.0);}float isInEarth(vec2 texcoord,vec2 sceneSize){vec2 NDC=texcoord*2.0-1.0;vec4 earthPosSC=getNDCFromWC(vec3(0.0),0.0);vec4 earthPosSCEdge=getNDCFromWC(vec3(0.0),earthRadius*1.5);NDC.xy-=earthPosSC.xy;float X=abs(NDC.x)*sceneSize.x;float Y=abs(NDC.y)*sceneSize.y;return clamp(0.0,1.0,max(sqrt(X*X+Y*Y)/max(abs(earthPosSCEdge.x*sceneSize.x),1.0)-0.8,0.0));}vec4 textureDistorted(sampler2D tex,vec2 texcoord,vec2 direction,vec3 distortion,bool isSpace){vec2 sceneSize=u_Viewport.zw;vec3 color;if(isSpace){color.r=isInEarth(texcoord+direction*distortion.r,sceneSize)*texture2D(tex,texcoord+direction*distortion.r).r;color.g=isInEarth(texcoord+direction*distortion.g,sceneSize)*texture2D(tex,texcoord+direction*distortion.g).g;color.b=isInEarth(texcoord+direction*distortion.b,sceneSize)*texture2D(tex,texcoord+direction*distortion.b).b;}else{color.r=texture2D(tex,texcoord+direction*distortion.r).r;color.g=texture2D(tex,texcoord+direction*distortion.g).g;color.b=texture2D(tex,texcoord+direction*distortion.b).b;}return vec4(clamp(color,0.0,1.0),0.0);}void main(void){vec4 originalColor=texture2D(colorTexture,v_TexCoord);vec3 rgb=originalColor.rgb;bool isSpace=length(czm_viewerPositionWC.xyz)>DISTANCE_TO_SPACE;vec4 sunPos=czm_morphTime==1.0 ? vec4(czm_sunPositionWC,1.0): vec4(czm_sunPositionColumbusView.zxy,1.0);vec4 sunPositionEC=czm_view*sunPos;vec4 sunPositionWC=czm_eyeToWindowCoordinates(sunPositionEC);sunPos=czm_viewportOrthographic*vec4(sunPositionWC.xy,-sunPositionWC.z,1.0);if(!isSpace||!((sunPos.x>=-1.1&&sunPos.x<=1.1)&&(sunPos.y>=-1.1&&sunPos.y<=1.1))){gl_FragColor=originalColor;return;}vec2 texcoord=vec2(1.0)-v_TexCoord;vec2 pixelSize=u_PixelRatio/u_Viewport.zw;vec2 invPixelSize=1.0/pixelSize;vec3 distortionVec=pixelSize.x*vec3(-distortion,0.0,distortion);vec2 ghostVec=(vec2(0.5)-texcoord)*ghostDispersal;vec3 direction=normalize(vec3(ghostVec,0.0));vec4 result=vec4(0.0);vec4 ghost=vec4(0.0);for(int i=0;i<4;++i){vec2 offset=fract(texcoord+ghostVec*float(i));ghost+=textureDistorted(colorTexture,offset,direction.xy,distortionVec,isSpace);}result+=ghost;vec2 haloVec=normalize(ghostVec)*haloWidth;float weightForHalo=length(vec2(0.5)-fract(texcoord+haloVec))/length(vec2(0.5));weightForHalo=pow(1.0-weightForHalo,5.0);result+=textureDistorted(colorTexture,texcoord+haloVec,direction.xy,distortionVec,isSpace)*weightForHalo*1.5;vec2 dirtTexCoords=(v_TexCoord*invPixelSize)/dirtTextureDimensions;if(dirtTexCoords.x>1.0){dirtTexCoords.x=mod(floor(dirtTexCoords.x),2.0)==1.0 ? 1.0-fract(dirtTexCoords.x): fract(dirtTexCoords.x);}if(dirtTexCoords.y>1.0){dirtTexCoords.y=mod(floor(dirtTexCoords.y),2.0)==1.0 ? 1.0-fract(dirtTexCoords.y): fract(dirtTexCoords.y);}result+=dirtAmount*texture2D(dirtTexture,dirtTexCoords);float camrot=czm_view[0].z+czm_view[1].y;float cosValue=cos(camrot);float sinValue=sin(camrot);mat3 rotation=mat3(cosValue,-sinValue,0.0,sinValue,cosValue,0.0,0.0,0.0,1.0);vec3 st1=vec3(v_TexCoord*2.0-vec2(1.0),1.0);vec3 st2=vec3((rotation*st1).xy,1.0);vec3 st3=st2*0.5+vec3(0.5);vec2 lensStarTexcoord=st3.xy;float weightForLensFlare=length(vec3(sunPos.xy,0.0));float oneMinusWeightForLensFlare=max(1.0-weightForLensFlare,0.0);if(!isSpace){result*=oneMinusWeightForLensFlare*intensity*0.2;}else{result*=oneMinusWeightForLensFlare*intensity;result*=texture2D(starTexture,lensStarTexcoord)*pow(weightForLensFlare,1.0)*max((1.0-length(vec3(st1.xy,0.0))),0.0)*2.0;}result+=texture2D(colorTexture,v_TexCoord);gl_FragColor=result;}")},ModifiedReinhardTonemapping:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D colorTexture;uniform vec3 white;\n#include <u_Gamma>\n#include <fn_inverseGamma>\nvarying vec2 v_TexCoord;\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\nvoid main(){vec4 fragmentColor=texture2D(colorTexture,v_TexCoord);vec3 color=fragmentColor.rgb;\n#ifdef AUTO_EXPOSURE\nfloat exposure=texture2D(autoExposure,vec2(0.5)).r;color/=exposure;\n#endif\ncolor=(color*(1.0+color/white))/(1.0+color);color=inverseGamma(color,u_Gamma);gl_FragColor=vec4(color,fragmentColor.a);}")},NightVision:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D colorTexture;\n#include <u_FrameTime>\nvarying vec2 v_TexCoord;float rand(vec2 co){return fract(sin(dot(co.xy,vec2(12.9898,78.233)))*43758.5453);}void main(void){float noiseValue=rand(v_TexCoord+sin(u_FrameTime))*0.1;vec3 rgb=texture2D(colorTexture,v_TexCoord).rgb;vec3 green=vec3(0.0,1.0,0.0);gl_FragColor=vec4((noiseValue+rgb)*green,1.0);}")},PassThrough:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D colorTexture;varying vec2 v_TexCoord;void main(){gl_FragColor=texture2D(colorTexture,v_TexCoord);}")},PassThroughDepth:{fragmentSource:M_("#define GLSLIFY 1\nuniform highp sampler2D u_depthTexture;\n#include <fn_writeDepth>\n#include <fn_readDepth>\nvarying vec2 v_TexCoord;void main(){gl_FragColor=writeDepth(readDepth(u_depthTexture,v_TexCoord,true));}")},PointCloudEyeDomeLighting:{fragmentSource:M_("#extension GL_EXT_frag_depth : enable\n#define GLSLIFY 1\nuniform sampler2D u_pointCloud_colorGBuffer;uniform sampler2D u_pointCloud_depthGBuffer;uniform vec2 u_distanceAndEdlStrength;\n#include <u_Viewport>\n#include <fn_windowToEyeCoordinates>\n#include <fn_unpackDepth>\nvarying vec2 v_TexCoord;vec2 neighborContribution(float log2Depth,vec2 offset){float dist=u_distanceAndEdlStrength.x;vec2 texCoordOrig=v_TexCoord+offset*dist;vec2 texCoord0=v_TexCoord+offset*floor(dist);vec2 texCoord1=v_TexCoord+offset*ceil(dist);float depthOrLogDepth0=unpackDepth(texture2D(u_pointCloud_depthGBuffer,texCoord0));float depthOrLogDepth1=unpackDepth(texture2D(u_pointCloud_depthGBuffer,texCoord1));if(depthOrLogDepth0==0.0||depthOrLogDepth1==0.0){return vec2(0.0);}float depthMix=mix(depthOrLogDepth0,depthOrLogDepth1,fract(dist));vec4 eyeCoordinate=fn_windowToEyeCoordinates(texCoordOrig,depthMix);return vec2(max(0.0,log2Depth-log2(-eyeCoordinate.z/eyeCoordinate.w)),1.0);}void main(){float depthOrLogDepth=unpackDepth(texture2D(u_pointCloud_depthGBuffer,v_TexCoord));vec4 eyeCoordinate=fn_windowToEyeCoordinates(gl_FragCoord.xy,depthOrLogDepth);eyeCoordinate/=eyeCoordinate.w;float log2Depth=log2(-eyeCoordinate.z);if(depthOrLogDepth==0.0){discard;}vec4 color=texture2D(u_pointCloud_colorGBuffer,v_TexCoord);vec2 texelSize=1.0/u_Viewport.zw;vec2 responseAndCount=vec2(0.0);responseAndCount+=neighborContribution(log2Depth,vec2(-texelSize.x,0.0));responseAndCount+=neighborContribution(log2Depth,vec2(+texelSize.x,0.0));responseAndCount+=neighborContribution(log2Depth,vec2(0.0,-texelSize.y));responseAndCount+=neighborContribution(log2Depth,vec2(0.0,+texelSize.y));float response=responseAndCount.x/responseAndCount.y;float strength=u_distanceAndEdlStrength.y;float shade=exp(-response*300.0*strength);color.rgb*=shade;gl_FragColor=vec4(color);gl_FragDepthEXT=depthOrLogDepth;}")},ReinhardTonemapping:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D colorTexture;\n#include <u_Gamma>\n#include <fn_inverseGamma>\nvarying vec2 v_TexCoord;\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\nvoid main(){vec4 fragmentColor=texture2D(colorTexture,v_TexCoord);vec3 color=fragmentColor.rgb;\n#ifdef AUTO_EXPOSURE\nfloat exposure=texture2D(autoExposure,vec2(0.5)).r;color/=exposure;\n#endif\ncolor=color/(1.0+color);color=inverseGamma(color,u_Gamma);gl_FragColor=vec4(color,fragmentColor.a);}")},Silhouette:{fragmentSource:M_("#define GLSLIFY 1\nuniform sampler2D colorTexture;uniform sampler2D silhouetteTexture;varying vec2 v_TexCoord;void main(void){vec4 silhouetteColor=texture2D(silhouetteTexture,v_TexCoord);vec4 color=texture2D(colorTexture,v_TexCoord);gl_FragColor=mix(color,silhouetteColor,silhouetteColor.a);}")},showDepth:{fragmentSource:M_("precision highp float;\n#define GLSLIFY 1\n#include <u_BaseColorSampler>\nuniform sampler2D u_BackgroundSampler;\n#include <fn_readDepth>\n#include <fn_writeDepth>\nvarying vec2 v_TexCoord;void main(){float r=readDepth(u_BaseColorSampler,v_TexCoord,false);float r1=readDepth(u_BackgroundSampler,v_TexCoord,false);float flag=0.0;if(r<r1){r1=r;flag=1.0;}gl_FragColor=vec4(r1,flag,0.0,1.0);}"),vertexSource:M_("#define GLSLIFY 1\n#include <a_POSITION2>\n#include <u_ModelViewProjectionMatrix>\n#include <u_World>\n#include <v_TexCoord2>\nvoid main(){gl_Position=u_ModelViewProjectionMatrix*vec4(a_POSITION*u_World,0,1);v_TexCoord.x=a_POSITION.x;v_TexCoord.y=1.0-a_POSITION.y;}")}},N_=/#pragma minemap: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g;for(const e in L_){const t=L_[e],i={};t.fragmentSource=t.fragmentSource?.replace(N_,((e,t,n,r,o)=>(i[o]=!0,"define"===t?`\n#ifndef HAS_UNIFORM_u_${o}\nvarying ${n} ${r} ${o};\n#else\nuniform ${n} ${r} u_${o};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${o}\n    ${n} ${r} ${o} = u_${o};\n#endif\n`))),t.vertexSource=t.vertexSource?.replace(N_,((e,t,n,r,o)=>{const a="float"===r?"vec2":"vec4",s=-1!=o.indexOf("pattern_from")||-1!=o.indexOf("pattern_to")||-1!=o.indexOf("top_pattern_from")||-1!=o.indexOf("top_pattern_to");return i[o]?"define"===t?`\n#ifndef HAS_UNIFORM_u_${o}\nuniform lowp float a_${o}_t;\nattribute ${n} ${a} a_${o};\nvarying ${n} ${r} ${o};\n#else\nuniform ${n} ${r} u_${o};\n#endif\n`:s?`\n#ifndef HAS_UNIFORM_u_${o}\n    ${o} = a_${o};\n#else\n    ${n} ${r} ${o} = u_${o};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${o}\n    ${o} = unpack_mix_${a}(a_${o}, a_${o}_t);\n#else\n    ${n} ${r} ${o} = u_${o};\n#endif\n`:"define"===t?`\n#ifndef HAS_UNIFORM_u_${o}\nuniform lowp float a_${o}_t;\nattribute ${n} ${a} a_${o};\n#else\nuniform ${n} ${r} u_${o};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${o}\n    ${n} ${r} ${o} = unpack_mix_${a}(a_${o}, a_${o}_t);\n#else\n    ${n} ${r} ${o} = u_${o};\n#endif\n`}));}function R_(e){return e.replace(I_,O_)}function O_(e,t){const i=A_[t];if(void 0===i)throw new Error(`Can not resolve #include <${t}>`);return R_(i)}class D_{constructor(e){this._type=e.type,this._defines=$(e.defines)?e.defines:{},e.noCache?(this.fragmentSource=e.fragmentSource,this.vertexSource=e.vertexSource):(e.type&&!L_[e.type]&&e.fragmentSource&&e.vertexSource&&(L_[e.type]={fragmentSource:e.fragmentSource,vertexSource:e.vertexSource}),this.fragmentSource=e.type?L_[e.type].fragmentSource:e.fragmentSource,this.vertexSource=e.type?L_[e.type].vertexSource:e.vertexSource);}set defines(e){this._defines=p_(e,this._defines);}get defines(){return this._defines}get type(){return this._type}set type(e){e&&(L_[e]&&(this.fragmentSource=L_[e].fragmentSource,this.vertexSource=L_[e].vertexSource),this._type=e);}destroy(){this._type="",this._defines={},this.fragmentSource=void 0,this.vertexSource=void 0;}static replaceMain(e,t){return e.replace(/void\s+main\s*\(\s*(?:void)?\s*\)/g,t=`void ${t}()`)}}class F_{constructor(e){const{json:t,joints:i}=e;this.options=e;const n=[];for(let e=0;e<i.length;e++)n.push(t.nodes[i[e]]);this._jointNode=n,this._jointMatrix=[];}get jointMatrix(){return this._jointMatrix}findRootMatrix(e){let t=e;for(;t.parent;)t=t.parent;return t.matrix.clone()}findJointTransform(e){let t=e;const i=t.matrix.clone();for(;t.parent&&(t=t.parent,t.isJoint);)i.multiplyLeft(t.matrix);return i}findGltfRootMatrix(e){let t=e;for(;t.parent&&"gltfNode"===t.parent.type;)t=t.parent;return t.matrix.clone()}update(){this._jointMatrix.length=0;for(let e=0;e<this._jointNode.length;e++){const t=this._jointNode[e],i=this.findJointTransform(t).multiplyRight(t.inverseBindMatrix);this._jointMatrix.push(i);}}}class z_ extends vl{constructor(e,t=!0){if(super(),this._id=e.id,this.isGLTFTreeNode=!0,this.originMatrix=void 0,this._skinsIndex=void 0,this._skeleton=void 0,this.type="gltfNode",e.matrix&&t)this.applyMatrix(new Bt(e.matrix));else {let t,i,n;e.translation&&(t=new St(e.translation)),e.scale&&(n=new _t(e.scale)),e.rotation&&(3===e.rotation.length?i=(new Et).fromHeadingPitchRoll(new st(e.rotation[0],e.rotation[1],e.rotation[2])):4===e.rotation.length&&(i=new Et(e.rotation))),this.applyMatrix(Bt.fromTranslationQuaternionRotationScale(t,i,n));}this.mesh=e.mesh,this.properties={name:e.name,id:e.mesh},this.meshes=e.meshes,$(e.skin)&&(this.skin=e.skin,this._skinsIndex=je(e.skin)),e.isJoint?(this._isJoint=e.isJoint,this._inverseBindMatrix=e.inverseBindMatrix):this._isJoint=!1,e.children&&(this.childIdxes=e.children),this._play=!0;}get id(){return this._id}set id(e){this._id=e;}get inverseBindMatrix(){return this._inverseBindMatrix}set inverseBindMatrix(e){this._inverseBindMatrix=e;}get isJoint(){return this._isJoint}set isJoint(e){this._isJoint=e;}get skeleton(){return this._skeleton}get play(){return this._play}set play(e){tt(e)&&(this._play=e);}createSkeleton(e){$(this.skin)&&(this._skeleton=new F_({json:e,id:this.skin.id,inverseBindMatrices:this.skin.inverseBindMatrices,joints:this.skin.joints,name:this.skin.name,skeleton:this.skin.skeleton,parent:this}));}update(){$(this._skeleton)&&this._skeleton.update();}}function B_(e){let t=[];return $(e.scene)?e.scene.nodes.forEach((e=>{t=t.concat(V_(e));})):$(e.scenes)&&e.scenes.forEach((e=>{e.nodes.forEach((e=>{t=t.concat(V_(e));}));})),t}function V_(e){let t=[];return $(e.children)&&e.children.forEach((e=>{t=t.concat(V_(e));})),$(e.mesh)&&(t=t.concat(e.mesh.primitives)),t}class k_{constructor(e){const{tileID:t,modelFolder:i,modelType:n,noHighlighting:r,boundingVolume:o,minemap3DType:a,instances:s,normalRight:l,normalUp:u,relativeCenter:c,opacity:h}=e;this.tileID=t,this.uid=Ue(),this.expirationTime=null,this.queryPadding=0,this.boundingVolume=o,this.state="loading",this.primitives=[],this.modelFolder=i,this.modelType=n||ot.MODEL_TYPE.OSGB,this.noHighlighting=r||!1,this.cartographicOrigin=[],this.childTiles=[],this.minemap3DType=a,this.instances=s,this.normalRight=l,this.normalUp=u,this.relativeCenter=c,this.opacity=h;}unloadVectorData(){this.uploaded=!1,this.primitives.forEach((e=>{e.destroy();})),this.primitives=[],this.content=void 0,this.extra=void 0,this.state="unloaded",this.boundingVolume=null;}upload(e,t,i){let n;this.source=i,this.rootNode=new z_({id:this.id}),n="3d-model"===i.type?function(e,t,i){let n=t.translation||[0,0,0];n=[n[0],n[1],n[2]];let r=[];if(t.location)r=t.location;else if(t._eventedParent){const e=t._eventedParent.tileset3d.root.transform.slice(12,15);r=Nu.DefaultEllipsoid.cartesianToCartographic(e),t.location=r;}else r=t.location;if(!r)return i;const o=Nu.cartographicToFixedFrame(new _t(r[0],r[1],r[2]||0));return o.multiplyRight((new Bt).rotateX(Math.PI/2)),function(e,t,i,n){let r=!1;if(!e||0===e[0]&&0===e[1]&&0===e[2]||(n.translate(e),r=!0),t)if(4===t.length)n.multiplyRight((new Bt).fromQuaternion(t)),r=!0;else if(t[0]||t[1]||t[1]){const e=new Ut(t[0]*ot.TRANSFORM.DEG_TO_RAD,t[1]*ot.TRANSFORM.DEG_TO_RAD,t[2]*ot.TRANSFORM.DEG_TO_RAD,Ut.XYZ).getQuaternion();n.multiplyRight((new Bt).fromQuaternion(e)),r=!0;}!i||1===i[0]&&1===i[1]&&1===i[2]||(n.scale(i),r=!0);}(n,t.rotation,t.scale,i),i.multiplyLeft(o)}(0,i,new Bt):e.childModelMatrix?e.childModelMatrix:e.cartesianModelMatrix,this.rootNode.applyMatrix(n),this.rootNode.addObject3DsWithoutParent(...e.gltf.nodes),this.rootNode.updateMatrixWorld(!0),this.animations=e.gltf.animations,this.primitives=[],this.extra=e.extra,B_(e.gltf).forEach((e=>{e.owner=this,this.primitives.push(e);})),this.state="loaded";}fire(e){this.source.fire(e);}destroy(){this.unloadVectorData();}}function U_(e=new Map,t=new Map){if(!e||!t)return e||t;try{return new Map([...t,...e])}catch(e){console.error("请检查object1 或 object2 是否未object对象而不是 Map对象");}}var G_=Object.freeze({ShadowMapping:0,SHADOW_MAPPING:0,PCF:1,NONE:-1});const H_=new Ot,Y_=new St,q_=new Bt,X_=new Bt;class W_{constructor(e){this.isTranslucent="OPAQUE"!=e.alphaMode,this._lights=e.lights,this._type=e.type,this._renderState=Z(e.renderState,W_.getDefaultRenderState()),this._depthTest=void 0,$(e.depthTest)&&(this._renderState.depthTest=je(e.depthTest?__.enableDepthTest:__.disableDepthTest)),this._translucent=void 0,this._uniforms=new Map,this.minimumUniformMap=new Map,this._programConfiguration=void 0,this._shaderSource=e.shaderSource||new D_({type:e.type,defines:e.defines,fragmentSource:e.fragmentSource,vertexSource:e.vertexSource,noCache:e.noCache}),this.layer=e.layer,this._picking=!1,this._pickColor=void 0,this._usePickColorTexture=void 0,this._isOneDimensionBatchTexture=void 0,this._isModelInstanceTexture=!1,this._pickTextureUniformsCallBack=void 0,this.state=_d.PROCESSINGFISH,this._defines=e.defines||{},this._baseColorTexture=Z(e.baseColorTexture,void 0),this._color=Z(e.color,void 0),this._doubleSided=Z(e.doubleSided,!1),this._opacity=Z(e.opacity,1),this._lightingModel=Z(e.lightingModel,void 0),this.totalTime=0,this._flowOptions=void 0,this.frame=void 0;}get type(){return this._type}set type(e){this._shaderSource.type=e,this._type=e;}set defines(e){this._shaderSource.defines=e;}get defines(){return this._shaderSource.defines}set uniforms(e){this._uniforms=U_(e,this._uniforms);}get picking(){return this._picking}set picking(e){e!=this._picking&&(this._shaderSource.defines.USE_PICKING=!!e,this._picking=e);}get pickColor(){return this._pickColor}set pickColor(e){this._pickColor=new St(e.r,e.g,e.b,e.a);}get depthTest(){return this._depthTest}set depthTest(e){this._depthTest=e,null!=e&&(!1===Object.getOwnPropertyDescriptor(this._renderState.depthTest,"enabled").writable&&(this._renderState=je(this._renderState)),this._renderState.depthTest.enabled=this._depthTest);}get renderState(){return this.overrideRenderState||this._renderState}set renderState(e){this._renderState=p_(e,this._renderState),$(this._depthTest)&&(!1===Object.getOwnPropertyDescriptor(this._renderState.depthTest,"enabled").writable&&(this._renderState=je(this._renderState)),this._renderState.depthTest.enabled=this._depthTest);}get translucent(){return this._translucent}set translucent(e){this._translucent=e,this.renderState={blending:{enabled:this.translucent,color:{red:0,green:0,blue:0,alpha:0},equationRgb:Du.FUNC_ADD,equationAlpha:Du.FUNC_ADD,functionSourceRgb:Du.SRC_ALPHA,functionSourceAlpha:Du.ONE,functionDestinationRgb:Du.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:Du.ONE_MINUS_SRC_ALPHA}};}update(e,t,i={}){this.totalTime=e._map.timer.totalTime,this._flowOptions&&this.animateTexture(),this._updateLightsUniforms(e,t,e.transform.activeCamera.cartographicPosition[0],e.transform.activeCamera.cartographicPosition[1]);const n=this.getCamera(t);this._updateCameraUniforms(n),this._updateCommonUniform(e,t,i),this._updateShadowUniforms(e,t,i),this._updateOnceUniform(e,t,i),$(i.primitive)&&i.primitive.allowPick&&this._updatePickStatus(i.primitive);}animateTexture(){const e=this.totalTime*this._flowOptions.speed/5,t=new St(0,0,1,1);switch(t.x>1&&(t.x=t.x-1),t.y>1&&(t.y=t.y-1),this._flowOptions.direction){case"right":t.x=t.x-e+1;break;case"left":default:t.x+=e;break;case"up":t.y=t.y-e+1;break;case"down":t.y+=e;}this._updateTexOffsetScale({texCoordCenter:[.5,.5],texCoordRotation:this._flowOptions.rotation,texCoordOffset:[t.x+this._flowOptions.texOffset[0],t.y+this._flowOptions.texOffset[1]],texCoordRepeat:this._flowOptions.texRepeat});}_updateTexOffsetScale(e){this._uniforms.set("u_TexOffsetScale",(()=>{const t=new St(0,0,1,1);return e&&e.texCoordOffset&&e.texCoordOffset[0]&&(t.x=e.texCoordOffset[0]),e&&e.texCoordOffset&&e.texCoordOffset[1]&&(t.y=e.texCoordOffset[1]),e&&e.texCoordRepeat&&e.texCoordRepeat[0]&&(t.z=e.texCoordRepeat[0]),e&&e.texCoordRepeat&&e.texCoordRepeat[1]&&(t.w=e.texCoordRepeat[1]),t})),this._uniforms.set("u_TexRotate",(()=>{const t=new _t(.5,.5,0);return e&&e.texCoordCenter&&e.texCoordCenter[0]&&(t.x=e.texCoordCenter[0]),e&&e.texCoordCenter&&e.texCoordCenter[1]&&(t.y=e.texCoordCenter[1]),e&&e.texCoordRotation&&(t.z=e.texCoordRotation*ot.TRANSFORM.DEG_TO_RAD),t}));}updateProperty(){}beforeCompile(){}_updateCameraUniforms(e){this._cameraPosition=e.positionWC,this._cameraDir=e.directionWC,this._uniforms.has("u_CameraPosition")||this._uniforms.set("u_CameraPosition",(()=>this._cameraPosition)),this.pushMinimumUniform("u_CameraPosition"),this._uniforms.has("u_CameraDirection")||this._uniforms.set("u_CameraDirection",(()=>this._cameraDir)),this.pushMinimumUniform("u_CameraDirection");}_updateLightsUniforms(e,t,i,n){if(t._enableLight){if(this.defines.enableLight=!0,t.sunLight){this.defines.SunLight=!0;try{this._uniforms.set("u_SunLightDirectionLocal",(()=>{if(t.sunLight)return t.sunLight.getSunDirectionWithCache(n,i)}));}catch(e){throw new Error(e)}this._uniforms.set("u_SunLightColor",(()=>{if(t.sunLight)return t.sunLight.color})),this._uniforms.set("u_SunLightIntensity",(()=>{if(t.sunLight)return t.sunLight.intensity})),this._uniforms.set("u_SunLightDirectionGlobal",(()=>{if(t.sunLight)return t.sunLight.getSunDirectionGlobalWithCache()}));}else this.defines.SunLight=!1;if(this.defines.AmbientLight=!1,this.defines.DirectionalLight=!1,this.defines.PointLight=!1,t._lights.length>0){const i=[],n=[],r=[],o=[],a=[],s=[],l=[],u=[],c=[],h=[],d=[],p=[],f=[];let m=null,_=null,g=null,y=null,x=null,v=null,w=0;t._lights.forEach((T=>{if("AmbientLight"==T.type&&(this.defines.AmbientLight=!0,i.push(T.color[0],T.color[1],T.color[1]),n.push(T.intensity)),"DirectionalLight"==T.type&&(this.defines.DirectionalLight=!0,r.push(T.color[0],T.color[1],T.color[2]),o.push(T.intensity),a.push(T.lightDirection[0],T.lightDirection[1],T.lightDirection[2])),"PointLight"==T.type&&(this.defines.PointLight=!0,s.push(T.color[0],T.color[1],T.color[2]),l.push(T.position[0],T.position[1],T.position[2]),u.push(T.intensity),t._shadows)){const t=Bt.inverse(Nu.localFrameToFixedFrame(new _t(T.position[0],T.position[1],T.position[2])),new Bt);c.push(t),null!=e.cubeMapCollection[T.id]&&h.push(e.cubeMapCollection[T.id].cubeMap),0==w?null!=e.cubeMapCollection[T.id]&&(m=e.cubeMapCollection[T.id].cubeMap):1==w?null!=e.cubeMapCollection[T.id]&&(_=e.cubeMapCollection[T.id].cubeMap):2==w?null!=e.cubeMapCollection[T.id]&&(g=e.cubeMapCollection[T.id].cubeMap):3==w?null!=e.cubeMapCollection[T.id]&&(y=e.cubeMapCollection[T.id].cubeMap):4==w?null!=e.cubeMapCollection[T.id]&&(x=e.cubeMapCollection[T.id].cubeMap):5==w&&null!=e.cubeMapCollection[T.id]&&(v=e.cubeMapCollection[T.id].cubeMap),w+=1,d.push(T.shadowFar),p.push(T.epsilon),f.push(T.mapSizeScale/T.textureSize);}})),n.length>0&&(this.defines.AmbientLightCount=n.length),this._uniforms.set("u_AmbientLightsColor",(()=>i)),this._uniforms.set("u_AmbientLightsIntensity",(()=>n)),o.length>0&&(this.defines.DirectionalLightCount=o.length),this._uniforms.set("u_DirectionalLightColor",(()=>r)),this._uniforms.set("u_DirectionalLightIntensity",(()=>o)),this._uniforms.set("u_DirectionalLightDir",(()=>a)),u.length>0&&(this.defines.PointLightCount=u.length),this._uniforms.set("u_PointLightColor",(()=>s)),this._uniforms.set("u_PointLightIntensity",(()=>u)),this._uniforms.set("u_PointLightPosition",(()=>l)),this._uniforms.set("u_PointLightModelMatrixInverse",(()=>c)),this._uniforms.set("u_PointLightDepthCubeTexture",(()=>{if(u.length>0&&t._shadows&&h.length==u.length)return h[0]})),this._uniforms.set("u_PointLightDepthCubeTexture0",(()=>{if(u.length>0&&t._shadows)return m})),this._uniforms.set("u_PointLightDepthCubeTexture1",(()=>{if(u.length>1&&t._shadows)return _})),this._uniforms.set("u_PointLightDepthCubeTexture2",(()=>{if(u.length>2&&t._shadows)return g})),this._uniforms.set("u_PointLightDepthCubeTexture3",(()=>{if(u.length>3&&t._shadows)return y})),this._uniforms.set("u_PointLightDepthCubeTexture4",(()=>{if(u.length>4&&t._shadows)return x})),this._uniforms.set("u_PointLightDepthCubeTexture5",(()=>{if(u.length>5&&t._shadows)return v})),this._uniforms.set("u_PointLightFar",(()=>{if(u.length>0&&t._shadows)return d})),this._uniforms.set("u_PointLightEpsilon",(()=>{if(u.length>0&&t._shadows)return p})),this._uniforms.set("u_DiskRadius",(()=>{if(u.length>0&&t._shadows)return f}));}}else this.defines.enableLight=!1;}_updateCommonUniform(e,t,i={}){const{primitive:n}=i,r=this.getCamera(t);this._uniforms.set("u_ModelMatrix",(()=>$(n)?$(n.modelInstanceType)&&"3d-model-instance"!==n.modelInstanceType||n.animationModelInstanceCollection?Bt.IDENTITY:n.matrixWorld:Bt.IDENTITY)),this.pushMinimumUniform("u_ModelMatrix"),this._uniforms.set("u_ModelMatrixInverse",(()=>{const e=$(n)&&$(n.modelInstanceType)&&"3d-model-instance"!==n.modelInstanceType,t=new Bt($(n)?e?Bt.IDENTITY:n.matrixWorld:Bt.IDENTITY);return Bt.inverse(t,X_)})),this.pushMinimumUniform("u_ModelMatrixInverse"),this.updateMVPMatrix(e,t,n),this._uniforms.set("u_RotateMatrixInverse",(()=>Bt.inverse(Nu.localFrameToFixedFrame(Nu.cartographicToCartesian3([116.39178335666656,39.93314961417835,20])),q_))),this._uniforms.set("u_ViewMatrix",(()=>r.viewMatrix)),this._uniforms.set("u_ModelViewMatrix",(()=>r.viewMatrix.clone().multiplyRight(n.matrixWorld))),this.pushMinimumUniform("u_ModelViewMatrix"),this._uniforms.set("u_ProjectionMatrix",(()=>r.projectionMatrix)),this.pushMinimumUniform("u_ProjectionMatrix"),this._uniforms.set("u_ViewProjectionMatrix",(()=>r.getVPMatrix())),this.pushMinimumUniform("u_ViewProjectionMatrix"),this._uniforms.set("u_InverseViewProjectionMatrix",(()=>r.getVPMatrix().invert())),this.pushMinimumUniform("u_InverseViewProjectionMatrix"),this._uniforms.set("u_Resolution",(()=>(H_.set(e.width,e.height),H_))),this.pushMinimumUniform("u_Resolution"),this._uniforms.set("u_NormalMatrix",(()=>Fl($(n)?n.matrixWorld:Bt.IDENTITY))),this.pushMinimumUniform("u_NormalMatrix"),this._uniforms.set("u_InverseProjection",(()=>r.projectionMatrixInverse)),this.pushMinimumUniform("u_InverseProjection"),this._uniforms.set("u_EncodedCameraPositionMCLow",(()=>gd.fromVector3(r.positionWC).low)),this._uniforms.set("u_EncodedCameraPositionMCHigh",(()=>gd.fromVector3(r.positionWC).high)),this._uniforms.set("u_modelViewRelativeToEye",(()=>{const e=r.viewMatrix;return e[12]=0,e[13]=0,e[14]=0,e})),this._uniforms.set("u_ModelViewProjectionRelativeToEye",(()=>{const e=r.viewMatrix;e[12]=0,e[13]=0,e[14]=0;const t=new Bt;return Bt.multiply(t,r.projectionMatrix,e),t})),this._uniforms.set("u_FrustumPlanes",(()=>(Y_.set(r.frustumCrate.frustum._offCenterFrustum.top,r.frustumCrate.frustum._offCenterFrustum.bottom,r.frustumCrate.frustum._offCenterFrustum.left,r.frustumCrate.frustum._offCenterFrustum.right),Y_))),this._uniforms.set("u_Bearing",(()=>e.style.symbolMatrixHelper.getMapViewParams().bearing*ot.TRANSFORM.DEG_TO_RAD)),this.pushMinimumUniform("u_Bearing"),this._uniforms.set("u_FrameTime",(()=>e._map.timer.totalTime)),this.pushMinimumUniform("u_FrameTime");}getCamera(e){return this._extraCamera?this._extraCamera:e.camera}updateMVPMatrix(e,t,i){const n=this.getCamera(t);this._uniforms.set("u_ModelViewProjectionMatrix",(()=>{let e;return e=$(i.modelInstanceCollection)?n.getVPMatrix().multiplyRight(i.modelInstanceCollection._rtcTransform):$(i.animationModelInstanceCollection)?n.getVPMatrix().multiplyRight(i.animationModelInstanceCollection._rtcTransform):n.getVPMatrix().multiplyRight($(i)?i.matrixWorld:Bt.IDENTITY),e})),this.pushMinimumUniform("u_ModelViewProjectionMatrix"),this._uniforms.set("u_ModelInstanceRTCTransformMatrix",(()=>$(i.modelInstanceCollection)?i.modelInstanceCollection._rtcTransform:$(i.animationModelInstanceCollection)?i.animationModelInstanceCollection._rtcTransform:new Bt)),this.pushMinimumUniform("u_ModelInstanceRTCTransformMatrix");}pushMinimumUniform(e){this.isVectorMaterial&&this.minimumUniformMap.set(e,this._uniforms.get(e));}getMinimumUniforms(e){return this.isVectorMaterial?e.sameLayerFrame?this.minimumUniformMap:(e.sameLayerFrame=!0,this._uniforms):this._uniforms}_updateShadowUniforms(e,t,i={}){const{primitive:n}=i;t._shadowModel==G_.NONE?this.defines={ShadowEnable:!1}:t._shadowModel==G_.ShadowMapping?this.defines={ShadowEnable:!0,ShadowMapping:!0,PCF:!1}:t._shadowModel==G_.PCF&&(this.defines={ShadowEnable:!0,ShadowMapping:!1,PCF:!0}),e._shadows&&(this._uniforms.set("u_ShadowModelViewProjectionMatrix",(()=>{const t=e.transform.shadowCamera.vpMatrix.clone();return $(n)?t.multiplyRight(n.matrixWorld):t})),this._uniforms.set("u_ShadowDepthSampler",(()=>{const t=e.shadowPass.framebuffer.depthStencilTexture;return t.sampler={minificationFilter:Du.LINEAR_MIPMAP_LINEAR,magnificationFilter:Du.LINEAR,wrapS:Du.REPEAT,wrapT:Du.REPEAT},t})),this._uniforms.set("u_EPSILON",(()=>{if(e.frameState._sunLight)return e.frameState._sunLight.epsilon})),this._uniforms.set("u_MapSizeScale",(()=>{if(e.frameState._sunLight)return e.frameState._sunLight.mapSizeScale})));}_updateOnceUniform(e){if(this._updatedUniformFlag)return;this._uniforms.set("u_PixelRatio",(()=>J.devicePixelRatio));const t=new Ot;this._uniforms.set("u_CurrentFrustum",(()=>(t.x=e.frameState._camera.near,t.y=e.frameState._camera.far,t))),this._uniforms.set("u_Viewport",(()=>new St(e.context.viewport.current.x,e.context.viewport.current.y,e.context.viewport.current.width,e.context.viewport.current.height))),this._uniforms.set("u_ViewportTransformation",(()=>{let t={x:e.context.viewport.current.x,y:e.context.viewport.current.y,width:e.context.viewport.current.width,height:e.context.viewport.current.height},i=new Bt;return Bt.computeViewportTransformation(t,0,1,i),t.x==e.context.viewport.current.x&&t.y==e.context.viewport.current.y&&t.width==e.context.viewport.current.width&&t.height==e.context.viewport.current.height||(t={x:e.context.viewport.current.x,y:e.context.viewport.current.y,width:e.context.viewport.current.width,height:e.context.viewport.current.height},i=new Bt,Bt.computeViewportTransformation(t,0,1,i)),i})),this._updatedUniformFlag=!0;}_updatePickStatus(e){const t=e.owner;if(e.allowPick&&$(t)&&e.pickId)if(this.pickColor=e.pickId.color,this._isModelInstanceTexture=!1,t instanceof k_&&void 0===this._usePickColorTexture){const e=t?.extra?.batchTable;e&&e.featureCount>0&&(this._usePickColorTexture=!0,this._isOneDimensionBatchTexture=!(e._batchTexture._textureDimensions.y>1),this._pickTextureUniformsCallBack=e._batchTexture.getUniformMapCallback(),this._uniforms=this._pickTextureUniformsCallBack(this._uniforms));}else $(e.modelInstanceCollection)&&$(e.modelInstanceCollection._batchTable)&&(this._isModelInstanceTexture=!0,this.uniforms=e.modelInstanceCollection._batchTable.getUniformMapCallback());}openPickColor(e){this.defines={PICK_COLOR:!0},this.renderState={depthTest:{enabled:!e,func:Du.LESS},blending:{color:{red:0,green:0,blue:0,alpha:0},enabled:!1,equationRgb:Du.FUNC_ADD,equationAlpha:Du.FUNC_ADD,functionSourceRgb:Du.SRC_ALPHA,functionSourceAlpha:Du.ONE,functionDestinationRgb:Du.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:Du.ONE_MINUS_SRC_ALPHA},stencilTest:{enabled:!1,frontFunction:Du.ALWAYS,backFunction:Du.ALWAYS,reference:0,mask:0,frontOperation:{fail:Du.KEEP,zFail:Du.KEEP,zPass:Du.REPLACE},backOperation:{fail:Du.KEEP,zFail:Du.KEEP,zPass:Du.REPLACE}}};}closePickColor(){this.defines={PICK_COLOR:!1},this.renderState=W_.getDefaultRenderState();}static getDefaultRenderState(){const e={};return e.blending=__.enableBlending,e.depthRange=__.depthRange,e.depthTest=__.enableDepthTest,e.depthMask=__.enableDepthMask,e.cull=je(__.enableCull),e.frontFace=Du.CCW,e.stencilTest=__.disableStencilTest,e.stencilMask=__.disableStencilMask,e}setValues(e){if(null!=e)for(const t in e){const i=e[t];null!=i?void 0!==this[t]?this[t]="string"==typeof i&&i.startsWith("#")?Ui.parse(i).toVector3():i:console.warn(`MineMap.Material: '${t}' is not a property of MineMap.${this.type}.`):console.warn(`MineMap.Material: parameter '${t}' has value of undefined.`);}}flowTexture(e){e.speed||(e.speed=1),e.rotation||(e.rotation=0),e.direction||(e.direction="right"),e.texRepeat||(e.texRepeat=[0,0]),e.texOffset||(e.texOffset=[0,0]),e.speed>10&&(e.speed=10),e.speed<1&&(e.speed=1),this._flowOptions=e;}static bindTextureSampler(e){return e.sampler={minificationFilter:e.minFilter||Du.LINEAR_MIPMAP_NEAREST,magnificationFilter:e.magFilter||Du.LINEAR,wrapS:e.wrapS||Du.REPEAT,wrapT:e.wrapT||Du.REPEAT},e}destroy(){this._renderState=void 0,this._uniforms=void 0,this._programConfiguration=void 0,this._shaderSource?.destroy(),this._shaderSource=void 0,this.layer=void 0,this._pickColor=void 0,this._usePickColorTexture=void 0,this._isOneDimensionBatchTexture=void 0,this._pickTextureUniformsCallBack=void 0,this.isTranslucent=void 0,this.state=void 0,this._cameraPosition=void 0,this._type=void 0;}}const j_={PolylineColor:"#define GLSLIFY 1\nuniform vec4 u_Color;vec4 getMaterial(vec2 st){vec4 resultColor=u_Color;return resultColor;}",PolylineTexture:"#define GLSLIFY 1\nuniform vec2 u_TexOffset;uniform vec2 u_TexRepeat;uniform vec3 u_TexRotate;uniform sampler2D u_BaseColorSampler;vec4 getMaterial(vec2 st){vec2 finalTexCoord=u_TexRepeat*st;finalTexCoord=finalTexCoord-u_TexRotate.xy;finalTexCoord=vec2(finalTexCoord.x*cos(u_TexRotate.z)-finalTexCoord.y*sin(u_TexRotate.z),finalTexCoord.x*sin(u_TexRotate.z)+finalTexCoord.y*cos(u_TexRotate.z));finalTexCoord=finalTexCoord+u_TexRotate.xy;finalTexCoord+=u_TexOffset;vec4 resultColor=texture2D(u_BaseColorSampler,finalTexCoord);return resultColor;}",PolylineDash:"#define GLSLIFY 1\nuniform float u_DashLength;uniform float u_DashPattern;uniform vec4 u_GapColor;uniform float u_PixelRatio;varying float v_polylineAngle;uniform vec4 u_Color;mat2 rotate(float rad){float c=cos(rad);float s=sin(rad);return mat2(c,s,-s,c);}vec4 getMaterial(vec2 st){vec2 pos=rotate(v_polylineAngle)*gl_FragCoord.xy;float dashPosition=fract(pos.x/(u_DashLength*u_PixelRatio));float maskIndex=floor(dashPosition*16.0);float maskTest=floor(u_DashPattern/pow(2.0,maskIndex));vec4 resultColor=(mod(maskTest,2.0)<1.0)? u_GapColor : u_Color;if(resultColor.a<0.005){discard;}return resultColor;}",PolylineTrail:"#define GLSLIFY 1\nuniform float u_FrameTime;uniform float u_Speed;uniform vec4 u_Color;vec4 getMaterial(vec2 st){float time=fract(u_FrameTime*u_Speed);float resultOpactiy=u_Speed>0.0 ? fract(st.s-time): 1.0-fract(st.s-time);vec4 resultColor=vec4(u_Color.rgb,resultOpactiy);return resultColor;}",PolylineOD:"#define GLSLIFY 1\nuniform float u_FrameTime;uniform float u_Speed;uniform vec4 u_TopColor;uniform vec4 u_Color;vec4 getMaterial(vec2 st){float time=fract(u_FrameTime*u_Speed);float opactiy=1.0-fract(st.s-time);vec4 resultColor;if(opactiy>0.95){resultColor=vec4(u_TopColor.rgb,u_Color.a);}else{resultColor=vec4(u_Color.rgb,u_Color.a);}return resultColor;}",PolylineFlicker:"#define GLSLIFY 1\nuniform float u_FrameTime;uniform float u_Speed;uniform vec4 u_Color;vec4 getMaterial(vec2 st){float time=fract(u_FrameTime*u_Speed);float scalar=smoothstep(0.0,1.0,time);vec4 resultColor=u_Color*scalar;return resultColor;}",PolylineGlow:"#define GLSLIFY 1\nuniform float u_FrameTime;uniform float u_Speed;uniform float u_GlowPower;uniform float u_TaperPower;uniform vec4 u_Color;vec4 getMaterial(vec2 st){float glow=u_GlowPower/abs(st.t-0.5)-(u_GlowPower/0.5);if(u_TaperPower<=0.99999){glow*=min(1.0,u_TaperPower/(0.5-st.s*0.5)-(u_TaperPower/0.5));}vec4 resultColor;resultColor.rgb=max(vec3(glow-1.0+u_Color.rgb),u_Color.rgb);resultColor.a=clamp(0.0,1.0,glow)*u_Color.a;return resultColor;}",PolylineTextureFlow:"#define GLSLIFY 1\nuniform float u_FrameTime;uniform float u_Speed;uniform sampler2D u_BaseColorSampler;uniform vec2 u_TexRepeat;vec4 getMaterial(vec2 st){float time=fract(u_FrameTime*u_Speed);vec2 finalTexCoord=u_TexRepeat*st;vec4 resultColor=texture2D(u_BaseColorSampler,vec2(finalTexCoord.s-time,finalTexCoord.t));return resultColor;}"};class $_ extends W_{constructor(e){super(e),this._renderState={cull:{enabled:!1},blending:{enabled:!0,color:{red:0,green:0,blue:0,alpha:0},equationRgb:Du.FUNC_ADD,equationAlpha:Du.FUNC_ADD,functionSourceRgb:Du.SRC_ALPHA,functionSourceAlpha:Du.ONE,functionDestinationRgb:Du.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:Du.ONE_MINUS_SRC_ALPHA},polygonOffset:{enabled:!0,factor:1,units:1},depthTest:{enabled:!0,func:Du.LESS}},$(e.depthTest)&&(this._renderState.depthTest=e.depthTest?__.enableDepthTest:__.disableDepthTest),this.uniformMap={},this.type="PolylineMaterial",e.shaderId||(e.dashed?(e.shaderId="PolylineDash",e.uniforms={color:Z(e.color,"red"),gapColor:Z(e.gapColor,new Ui(0,0,0,0)),opacity:Z(e.opacity,1),dashLength:Z(e.dashLength,16),dashPattern:Z(e.dashPattern,255)}):e.baseColorTexture?(e.shaderId="PolylineTexture",e.uniforms={baseColorTexture:e.baseColorTexture,opacity:Z(e.opacity,1),rotation:Z(e.rotation,0),rotationCenter:Z(e.rotationCenter,[.5,.5]),repeat:Z(e.repeat,[1,1]),offset:Z(e.offset,[0,0])}):(e.shaderId="PolylineColor",e.uniforms={color:Z(e.color,"red"),opacity:Z(e.opacity,1)}));const t=[];t.push(j_[e.shaderId]),t.push(this._shaderSource.fragmentSource),this._shaderSource.fragmentSource=t.join("\n"),this.type=e.shaderId,this.uniformMap=e.uniforms,this._viewportOrthographicMatrix=new Bt,this._currentFrustum=new Ot,this._cameraViewMatrix=void 0,this._pixelWidth=!0,this.defines={POLYLINE:!0,POLYLINE_DASH:"PolylineDash"===this.type,PIXEL_WIDTH:this._pixelWidth},this._flowOptions=void 0,this._pickColorDepthTest=Z(e.pickColorDepthTest,void 0);}get pixelWidth(){return this._pixelWidth}set pixelWidth(e){this._pixelWidth=e;}get pickColorDepthTest(){return this._pickColorDepthTest}set pickColorDepthTest(e){this._pickColorDepthTest=e;}update(e,t,i={}){super.update(e,t,i),this.updateUniforms(e,t,i);}updateTexture(e){console.warn("该方法将被下个大版本废弃，请使用新的材质更新方式！！！"),$(e.color)&&(this.uniformMap.color=e.color),$(e.opacity)&&(this.uniformMap.opacity=e.opacity),$(e.dashLength)&&(this.uniformMap.dashLength=e.dashLength),$(e.baseColorTexture)&&(this.uniformMap.baseColorTexture=e.baseColorTexture),$(e.pixelWidth)&&(this._pixelWidth=e.pixelWidth);}updateUniforms(e,t,i={}){const{primitive:n}=i;this.defines={POLYLINE_DASH:"PolylineDash"===this.type,PIXEL_WIDTH:this._pixelWidth},this._uniforms.set("u_BaseColorSampler",(()=>W_.bindTextureSampler(this.uniformMap.baseColorTexture))),this._uniforms.set("u_Color",(()=>St.fromColor(Ui.parse(this.uniformMap.color),!1))),this._uniforms.set("u_FarDepthFromNearPlusOne",(()=>(this._farDepthFromNearPlusOne=t.camera.far-t.camera.near+1,this._farDepthFromNearPlusOne))),this._uniforms.set("u_OneOverLog2FarDepthFromNearPlusOne",(()=>(this._oneOverLog2FarDepthFromNearPlusOne=1/ot.CesiumMath.log2(this._farDepthFromNearPlusOne),this._oneOverLog2FarDepthFromNearPlusOne))),this._uniforms.set("u_ViewportOrthographic",(()=>{const t=e.context.viewport.current;return Bt.computeOrthographicOffCenter(t.x,t.x+t.width,t.y,t.y+t.height,0,1,this._viewportOrthographicMatrix),this._viewportOrthographicMatrix})),this._uniforms.set("u_Opacity",(()=>this.uniformMap.opacity)),this._uniforms.set("u_GeometricToleranceOverMeter",(()=>{let i;const n=t.camera.frustumCrate.fov,r=e.context.viewport.current;return i=$(n)?r.height>r.width?2*Math.tan(.5*n)/r.height:2*Math.tan(.5*n)/r.width:1/Math.max(r.width,r.height),this._geometricToleranceOverMeter=2*i,this._geometricToleranceOverMeter})),this._uniforms.set("u_Normal",(()=>{const e=n?n.matrixWorld:new Bt,i=t.camera.getViewMatrix();i.multiplyRight(e),i.invert();const r=new Nt;return i.getRotationMatrix3(r),Nt.transpose(r,r),this._normal=r,this._normal})),this._uniforms.set("u_GlobeMinimumAltitude",(()=>(this._globeMinimumAltitude=hi.WGS84.minimumRadius.toFixed(1),this._globeMinimumAltitude))),this._uniforms.set("u_DashLength",(()=>this.uniformMap.dashLength)),this._uniforms.set("u_DashPattern",(()=>this.uniformMap.dashPattern)),this._uniforms.set("u_GapColor",(()=>St.fromColor(Ui.parse(this.uniformMap.gapColor),!1))),this._uniforms.set("u_FrameTime",(()=>e._map.timer.totalTime)),this._uniforms.set("u_Speed",(()=>this.uniformMap.speed)),this._uniforms.set("u_TopColor",(()=>St.fromColor(Ui.parse(this.uniformMap.topColor),!1))),this._uniforms.set("u_GlowPower",(()=>this.uniformMap.glowPower)),this._uniforms.set("u_TaperPower",(()=>this.uniformMap.taperPower)),this._uniforms.set("u_TexOffset",(()=>Ot.unpack(this.uniformMap.offset))),this._uniforms.set("u_TexRepeat",(()=>Ot.unpack(this.uniformMap.repeat))),this._uniforms.set("u_TexRotate",(()=>{const e=new _t;return e.x=this.uniformMap.rotationCenter[0],e.y=this.uniformMap.rotationCenter[1],e.z=this.uniformMap.rotation*ot.TRANSFORM.DEG_TO_RAD,e})),this.defines.SHADOW_VOLUME&&(this.defines=t.preMainDepthStencilTexture?{SHADOWVOLUME_DISCARD:!0}:{SHADOWVOLUME_DISCARD:!1},e.commonDepthPass.render({painter:e}),this._uniforms.set("u_DepthTexture",(()=>e.commonDepthPass.framebuffer.getColorTexture(0).bind(Du.LINEAR,Du.CLAMP_TO_EDGE))));}static fromType(e,t){let i;switch(e){case"Color":i=new $_({uniforms:{color:Z(t.color,"red"),opacity:Z(t.opacity,1)},shaderId:`Polyline${e}`});break;case"Texture":i=new $_({uniforms:{baseColorTexture:t.baseColorTexture,opacity:Z(t.opacity,1),rotation:Z(t.rotation,0),rotationCenter:Z(t.rotationCenter,[.5,.5]),repeat:Z(t.repeat,[1,1]),offset:Z(t.offset,[0,0])},shaderId:`Polyline${e}`});break;case"Dash":i=new $_({uniforms:{color:Z(t.color,"red"),gapColor:Z(t.gapColor,new Ui(0,0,0,0)),opacity:Z(t.opacity,1),dashLength:Z(t.dashLength,16),dashPattern:Z(t.dashPattern,255)},shaderId:`Polyline${e}`});break;case"TextureFlow":i=new $_({uniforms:{baseColorTexture:t.baseColorTexture,opacity:Z(t.opacity,1),repeat:Z(t.repeat,[1,1]),speed:Z(t.speed,1)},shaderId:`Polyline${e}`});break;case"Trail":case"Flicker":i=new $_({uniforms:{color:Z(t.color,"red"),speed:Z(t.speed,1),opacity:Z(t.opacity,1)},shaderId:`Polyline${e}`});break;case"OD":i=new $_({uniforms:{color:Z(t.color,"red"),speed:Z(t.speed,1),topColor:Z(t.topColor,"green"),opacity:Z(t.opacity,1)},shaderId:`Polyline${e}`});break;case"Glow":i=new $_({uniforms:{color:Z(t.color,"red"),glowPower:Z(t.glowPower,.25),taperPower:Z(t.taperPower,1),opacity:Z(t.opacity,1)},shaderId:`Polyline${e}`});break;default:throw new Error(`material with type '${e}' does not exist.`)}return i}serialize(){return {type:this.type,uniforms:this.uniformMap}}destroy(){return this._renderState=void 0,this._color=void 0,this._uColor=void 0,this.type=void 0,this._viewportOrthographicMatrix=void 0,this._currentFrustum=void 0,this._cameraPositionEncode=void 0,this._cameraViewMatrix=void 0,this._pixelWidth=void 0,Ou(this)}}class Z_ extends W_{constructor(e){super(e),this.type="pickColorMaterial",this.renderState=this._createRenderState(),this.dirty=!1,this.bUniformCreated=!1,this._usePickColorTexture=void 0,this._isOneDimensionBatchTexture=void 0,this._pickTextureUniformsCallBack=void 0;}update(e,t,i={}){this._resetStatus(),super.update(e,t,i),this._updateUniform(i,t,e),this._updateDefines(i.primitive);}_updateUniform(e={},t,i){const{primitive:n}=e;if(n.allowPick){if(n.allowPick&&(this._renderState.cull=__.disableCull),$(n.material.pickColorDepthTest)&&(this._renderState.depthTest=n.material.pickColorDepthTest?__.enableDepthTestWithLEQUAL:__.disableDepthTest),null!=this._usePickColorTexture){const e=n?.owner?.extra?.batchTable?._batchTexture.getUniformMapCallback();e&&(this._uniforms=e(this._uniforms));}else this._uniforms.set("u_pickIdColor",(()=>n._material.pickColor));n._material instanceof $_&&(this._uniforms.set("u_ViewportOrthographic",(()=>n._material._viewportOrthographicMatrix)),this._uniforms.set("u_GeometricToleranceOverMeter",(()=>n._material._geometricToleranceOverMeter)),this._uniforms.set("u_Normal",(()=>n._material._normal)),this._uniforms.set("u_GlobeMinimumAltitude",(()=>n._material._globeMinimumAltitude)),n._material.defines.SHADOW_VOLUME&&this._uniforms.set("u_DepthTexture",(()=>i.depthPass.framebuffer.getColorTexture(0).bind(Du.LINEAR,Du.CLAMP_TO_EDGE)))),"BillboardMaterial"===n._material.type&&(n._material._pixelResolution&&(this.defines={FIXED_PIXEL_SIZE:!0},this._uniforms.set("u_PixelResolution",(()=>new Ot(n._material._pixelResolution)))),this._uniforms.set("u_MvMatrix",(()=>n._material._modelMatrix?t.camera.getViewMatrix().multiplyRight(n._material._modelMatrix):void 0)),this._uniforms.set("u_center",(()=>n._material._center)),this._uniforms.set("u_rotation",(()=>n._material.u_rotation)),this._uniforms.set("u_ProjectionMatrix",(()=>t.camera.getProjectionMatrix())),this._uniforms.set("u_InvertViewMatrix",(()=>t.camera.getViewMatrix().invert())),this._uniforms.set("u_ScaleMatrix",(()=>n._material._scaleMatrix)));}}_updateDefines(e){this.defines={JOINT_MATRIX_CNT:Z(e?._material?.defines?.JOINT_MATRIX_CNT,!1),INSTANCE_MATRIX:Z(e?._material?.isInstance,!1),USE_MORPHTARGETS:Z(e?._material?.defines?.USE_MORPHTARGETS,!1),LOG_DEPTH:!1,USE_PICKINGTEXTURES:Z(this._usePickColorTexture,!1),ONE_DIMENSION_BATCH_TEXTURE:Z(this._isOneDimensionBatchTexture,!1),TWO_DIMENSION_BATCH_TEXTURE:!1,MODEL_INSTANCE_BATCH_TEXTURE:this._isModelInstanceTexture,POLYLINE:Z(e?._material?.defines?.POLYLINE,!1),PIXEL_WIDTH:Z(e?._material?.defines?.PIXEL_WIDTH,!1),BILLBOARD:Z(e?._material?.defines?.BILLBOARD,!1),SHADOW_VOLUME:Z(e.adaptTerrain,!1)};}_resetStatus(){this._usePickColorTexture=void 0,this._isOneDimensionBatchTexture=void 0;}_createRenderState(){return {depthTest:{enabled:!0,func:Du.LEQUAL},blending:{color:{red:0,green:0,blue:0,alpha:0},enabled:!1,equationRgb:Du.FUNC_ADD,equationAlpha:Du.FUNC_ADD,functionSourceRgb:Du.SRC_ALPHA,functionSourceAlpha:Du.ONE,functionDestinationRgb:Du.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:Du.ONE_MINUS_SRC_ALPHA},stencilTest:{enabled:!1,frontFunction:Du.ALWAYS,backFunction:Du.ALWAYS,reference:0,mask:0,frontOperation:{fail:Du.KEEP,zFail:Du.KEEP,zPass:Du.REPLACE},backOperation:{fail:Du.KEEP,zFail:Du.KEEP,zPass:Du.REPLACE}}}}}class K_ extends W_{constructor(e){super(e),this.type="depthMaterial",this.renderState=this._createRenderState(),this.dirty=!1,this.bUniformCreated=!1;}update(e,t,i={}){super.update(e,t,i),this._updateDefines(i.primitive,e),this.bUniformCreated||this._createUniform();}_updateDefines(e,t){this.defines={JOINT_MATRIX_CNT:Z(e?._material?.defines?.JOINT_MATRIX_CNT,!1),INSTANCE_MATRIX:Z(e?._material?.defines?.INSTANCE_MATRIX,!1),USE_MORPHTARGETS:Z(e?._material?.defines?.USE_MORPHTARGETS,!1),LOG_DEPTH:Z(t._logDepth,!1)};}_createRenderState(){return {cull:{enabled:!1},depthTest:{enabled:!0,func:Du.LESS},blending:{color:{red:0,green:0,blue:0,alpha:0},enabled:!1,equationRgb:Du.FUNC_ADD,equationAlpha:Du.FUNC_ADD,functionSourceRgb:Du.SRC_ALPHA,functionSourceAlpha:Du.ONE,functionDestinationRgb:Du.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:Du.ONE_MINUS_SRC_ALPHA},stencilTest:{enabled:!1,frontFunction:Du.ALWAYS,backFunction:Du.ALWAYS,reference:0,mask:0,frontOperation:{fail:Du.KEEP,zFail:Du.KEEP,zPass:Du.REPLACE},backOperation:{fail:Du.KEEP,zFail:Du.KEEP,zPass:Du.REPLACE}}}}_createUniform(){this.bUniformCreated=!0;}destroy(){return this.type=void 0,this._renderState=void 0,this.dirty=void 0,this.bUniformCreated=void 0,this._uniforms=void 0,this._programConfiguration=void 0,this._shaderSource.destroy(),this._shaderSource=void 0,this.layer=void 0,this._pickColor=void 0,this._usePickColorTexture=void 0,this._isOneDimensionBatchTexture=void 0,this._pickTextureUniformsCallBack=void 0,Ou(this)}}class Q_ extends W_{constructor(e){super(e),this.type="normalMaterial",this.renderState=this._createRenderState(),this.dirty=!1,this.bUniformCreated=!1;}update(e,t,i={}){super.update(e,t,i),this.bUniformCreated||(this.bUniformCreated=!0);}_createRenderState(){return {depthTest:{enabled:!0,func:Du.LESS},blending:{color:{red:0,green:0,blue:0,alpha:0},enabled:!1,equationRgb:Du.FUNC_ADD,equationAlpha:Du.FUNC_ADD,functionSourceRgb:Du.SRC_ALPHA,functionSourceAlpha:Du.ONE,functionDestinationRgb:Du.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:Du.ONE_MINUS_SRC_ALPHA},stencilTest:{enabled:!1,frontFunction:Du.ALWAYS,backFunction:Du.ALWAYS,reference:0,mask:0,frontOperation:{fail:Du.KEEP,zFail:Du.KEEP,zPass:Du.REPLACE},backOperation:{fail:Du.KEEP,zFail:Du.KEEP,zPass:Du.REPLACE}}}}destroy(){return this.type=void 0,this._renderState=void 0,this.dirty=void 0,this.bUniformCreated=void 0,this._uniforms=void 0,this._programConfiguration=void 0,this._shaderSource.destroy(),this._shaderSource=void 0,this.layer=void 0,this._pickColor=void 0,this._usePickColorTexture=void 0,this._isOneDimensionBatchTexture=void 0,this._pickTextureUniformsCallBack=void 0,Ou(this)}}class J_{constructor(){this._instanceBuffer=void 0,this._attributes=[],this._attributesbuffviewObject={},this._createAttributes(),this._parseBufferViewAttributes(),this._particleNum=0,this.dirty=!1,this.colorArr=null,this.modelPositonArr=null,this.scaleArr=null;}get instanceBuffer(){return this._instanceBuffer}createBuffer(e){this._instanceBuffer=new Yh({context:e,attributesbuffviewObject:this._attributesbuffviewObject,attributes:this._attributes,dynamicDraw:!1,buffers:void 0});}_createAttributes(){for(let e=0;e<4;++e)this._attributes.push({name:"a_InstanceMatrix4",type:5126,components:4,instance:!0,byteStride:64,offset:16*e,attribIndex:e,divisor:1});this._attributes.push({name:"a_COLOR_0",type:5126,components:4,instance:!0,byteStride:0,offset:0,attribIndex:0,divisor:1}),this._attributes.push({name:"a_Scale",type:5126,components:1,instance:!0,byteStride:0,offset:0,attribIndex:0,divisor:1});}_parseBufferViewAttributes(){this._parseInstances();}_parseInstances(){this._attributesbuffviewObject.InstanceMatrix4={value:new Float32Array(128e4)},this._attributesbuffviewObject.COLOR_0={value:new Float32Array(32e4)},this._attributesbuffviewObject.Scale={value:new Float32Array(8e4)};}update(e){e&&e.context&&!this._instanceBuffer&&this.createBuffer(e.context),this.dirty&&(this._instanceBuffer.updateDataTest(new Float32Array(this.modelPositonArr),"a_InstanceMatrix4"),this._instanceBuffer.updateDataTest(new Float32Array(this.colorArr),"a_COLOR_0"),this._instanceBuffer.updateDataTest(new Float32Array(this.scaleArr),"a_Scale"));}updateData(e){if(e.positions.length){const t=e.positions,i=e.frameState.camera.getViewMatrix().clone(),n=[];for(let e=0;e<t.length;e++){const r=Nu.eastNorthUpToFixedFrame(t[e]),o=i.multiplyRight(r,new Bt);n.push(o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7],o[8],o[9],o[10],o[11],o[12],o[13],o[14],o[15]);}this._particleNum=t.length,this.colorArr=e.colorArr,this.scaleArr=e.scaleArr,this.modelPositonArr=n,this.dirty=!0;}}static generateInstanceModelMatrix(e){const t=[];return e.forEach(((e,i)=>{const n=Nu.cartographicToFixedFrame(e);t.push({modelMatrix:n,batchId:i});})),t}destroy(){this._instanceBuffer&&this._instanceBuffer.destroy(),this._attributes=[],this._attributesbuffviewObject=null,this._particleNum=0,this.dirty=!1,this.colorArr=null,this.modelPositonArr=null,this.scaleArr=null;}}const eg=bi([{name:"a_PositionHigh",type:"Float32",components:3},{name:"a_PositionLow",type:"Float32",components:3},{name:"a_PrevPositionHigh",type:"Float32",components:3},{name:"a_PrevPositionLow",type:"Float32",components:3},{name:"a_NextPositionHigh",type:"Float32",components:3},{name:"a_NextPositionLow",type:"Float32",components:3},{name:"a_ExpandAndWidth",type:"Float32",components:2},{name:"a_TEXCOORD_0",type:"Float32",components:2}]),tg=bi([{name:"a_PositionHigh",type:"Float32",components:3},{name:"a_PositionLow",type:"Float32",components:3},{name:"a_StartHigh",type:"Float32",components:3},{name:"a_StartLow",type:"Float32",components:3},{name:"a_StartNormal",type:"Float32",components:3},{name:"a_EndNormal",type:"Float32",components:3},{name:"a_RightNormal",type:"Float32",components:3},{name:"a_ForwardOffset",type:"Float32",components:3},{name:"a_TexCoord",type:"Float32",components:2},{name:"a_Width",type:"Float32",components:1}]),ig=[0,2,1,0,3,2,0,7,3,0,4,7,0,5,4,0,1,5,5,7,4,5,6,7,5,2,6,5,1,2,3,6,2,3,7,6],ng=ig.length;class rg{constructor(){}static createVolumeGeometry(e,t,i,n){if(e.length<2)return;let r=e.map((e=>{const i=_t.fromArray(t.cartesianToCartographic(e));return i.z=0,i}));r=rp(r,_t.equalsEpsilon,!1);const o=r.length,a=i,s=n-i;let l,u;const c=[],h=[],d=[];let p=new _t,f=new _t,m=new _t,_=new _t,g=new _t;const y=r[0],x=r[1];for(p=this.getPosition(t,r[o-1],a,p),_=this.getPosition(t,x,a,_),f=this.getPosition(t,y,a,f),m=this.getPosition(t,y,s,m),g=this.computeRightNormal(y,x,s,t,g),_t.pack(g,c,0),_t.pack(f,h,0),_t.pack(m,d,0),u=1;u<o-1;++u)p=_t.clone(f,p),f=_t.clone(_,f),this.getPosition(t,r[u],s,m),this.getPosition(t,r[u+1],a,_),this.computeVertexMiterNormal(p,f,m,_,g),l=c.length,_t.pack(g,c,l),_t.pack(f,h,l),_t.pack(m,d,l);const v=r[o-1],w=r[o-2];return f=this.getPosition(t,v,a,f),m=this.getPosition(t,v,s,m),g=this.computeRightNormal(w,v,s,t,g),l=c.length,_t.pack(g,c,l),_t.pack(f,h,l),_t.pack(m,d,l),this.createGeometryArray(h,d,c)}static createGeometryArray(e,t,i){let n,r;const o=e.length/3-1,a=8*o,s=4*a,l=36*o,u=a>65535?new Uint32Array(l):new Uint16Array(l),c=new Float64Array(3*a),h=new Float32Array(s),d=new Float32Array(s),p=new Float32Array(s),f=new Float32Array(s),m=new Float32Array(s);let _=new _t,g=new _t;const y=t.length/3;g=_t.unpack(t,0,g);let x,v=0;for(r=3,n=1;n<y;n++)_=_t.clone(g,_),g=_t.unpack(t,r,g),v+=_t.distance(_,g),r+=3;r=3;let w=0,T=0,b=!1,P=_t.unpack(e,0),S=_t.unpack(t,0),E=_t.unpack(i,0),A=0;for(n=0;n<o;n++){const n=_t.clone(P),o=_t.clone(S);let a=_t.clone(E);b&&(a=_t.negate(a,a)),P=_t.unpack(e,r),S=_t.unpack(t,r),E=_t.unpack(i,r),b=this.breakMiter(E,n,P,S);const s=_t.distance(o,S),l=gd.fromVector3(n),u=_t.subtract(P,n),_=_t.normalize(u,new _t);let g=_t.subtract(o,n);g=_t.normalize(g,g);let y=_t.cross(_,g);y=_t.normalize(y,y);let C=_t.cross(g,a);C=_t.normalize(C,C);let M=_t.subtract(S,P);M=_t.normalize(M,M);let I=_t.cross(E,M);I=_t.normalize(I,I);const L=s/v,N=A/v;for(x=0;x<8;x++){const e=T+4*x,t=e+3,i=x<4?1:-1,n=2===x||3===x||6===x||7===x?1:-1;_t.pack(l.high,h,e),h[t]=u.x,_t.pack(l.low,d,e),d[t]=u.y,_t.pack(C,p,e),p[t]=u.z,_t.pack(I,f,e),f[t]=L*i,_t.pack(y,m,e);let r=N*n;0===r&&n<0&&(r=9),m[t]=r;}const R=_t.clone(n),O=_t.clone(P),D=_t.clone(o),F=_t.clone(S);let z=_t.multiplyByScalar(y,ot.CesiumMath.EPSILON5);_t.add(R,z,R),_t.add(O,z,O),_t.add(D,z,D),_t.add(F,z,F),this.nudgeXZ(R,O),this.nudgeXZ(D,F),_t.pack(R,c,w),_t.pack(O,c,w+3),_t.pack(F,c,w+6),_t.pack(D,c,w+9),z=_t.multiplyByScalar(y,-2*ot.CesiumMath.EPSILON5,z),_t.add(R,z,R),_t.add(O,z,O),_t.add(D,z,D),_t.add(F,z,F),this.nudgeXZ(R,O),this.nudgeXZ(D,F),_t.pack(R,c,w+12),_t.pack(O,c,w+15),_t.pack(F,c,w+18),_t.pack(D,c,w+21),r+=3,w+=24,T+=32,A+=s;}r=0;let C=0;for(n=0;n<o;n++){for(x=0;x<ng;x++)u[r+x]=ig[x]+C;C+=8,r+=ng;}return {attributes:{position:c,startHiAndForwardOffsetX:h,startLoAndForwardOffsetY:d,startNormalAndForwardOffsetZ:p,endNormalAndTextureCoordinateNormalizationX:f,rightNormalAndTextureCoordinateNormalizationY:m},indices:u}}static getPosition(e,t,i,n){const r=new _t;return _t.clone(t,r),r.z=i,e.cartographicToCartesian(r,n)}static computeRightNormal(e,t,i,n,r){const o=new _t,a=new _t,s=new _t,l=this.getPosition(n,e,0,o),u=this.getPosition(n,e,i,a),c=this.getPosition(n,t,0,s),h=this.direction(u,l,a),d=this.direction(c,l,s);return _t.cross(d,h,r),_t.normalize(r,r)}static computeVertexMiterNormal(e,t,i,n,r){const o=new _t,a=new _t,s=new _t,l=new _t,u=this.direction(i,t,o),c=this.tangentDirection(e,t,u,a),h=this.tangentDirection(n,t,u,s);if(ot.CesiumMath.equalsEpsilon(_t.dot(c,h),-1,ot.CesiumMath.EPSILON5))return r=_t.cross(u,c,r),_t.normalize(r,r);r=_t.add(h,c,r),r=_t.normalize(r,r);const d=_t.cross(u,r,l);return _t.dot(h,d)<0&&(r=_t.negate(r,r)),r}static direction(e,t,i){return _t.subtract(e,t,i),_t.normalize(i,i),i}static tangentDirection(e,t,i,n){return n=this.direction(e,t,n),n=_t.cross(n,i,n),n=_t.normalize(n,n),_t.cross(i,n,n)}static breakMiter(e,t,i,n){const r=Math.cos(ot.CesiumMath.toRadians(30)),o=Math.cos(ot.CesiumMath.toRadians(150)),a=new _t,s=new _t,l=new Nt,u=new Et,c=this.direction(i,t,s),h=_t.dot(c,e);if(h>r||h<o){const t=this.direction(n,i,a),r=Et.fromAxisAngle(t,h<o?ot.CesiumMath.PI_OVER_TWO:-ot.CesiumMath.PI_OVER_TWO,u),s=Nt.fromQuaternion(r,l);return Nt.multiplyByVector(s,e,e),!0}return !1}static nudgeXZ(e,t){const i=ts.fromPointNormal(_t.ZERO,_t.UNIT_Y),n=ts.getPointDistance(i,e),r=ts.getPointDistance(i,t);let o=new _t;ot.CesiumMath.equalsEpsilon(n,0,ot.CesiumMath.EPSILON2)?(o=this.direction(t,e,o),_t.multiplyByScalar(o,ot.CesiumMath.EPSILON2,o),_t.add(e,o,e)):ot.CesiumMath.equalsEpsilon(r,0,ot.CesiumMath.EPSILON2)&&(o=this.direction(e,t,o),_t.multiplyByScalar(o,ot.CesiumMath.EPSILON2,o),_t.add(t,o,t));}}const og=bi([{name:"a_PositionHigh",type:"Float32",components:3},{name:"a_PositionLow",type:"Float32",components:3},{name:"a_PrevPositionHigh",type:"Float32",components:3},{name:"a_PrevPositionLow",type:"Float32",components:3},{name:"a_NextPositionHigh",type:"Float32",components:3},{name:"a_NextPositionLow",type:"Float32",components:3},{name:"a_ExpandAndWidth",type:"Float32",components:2},{name:"a_TEXCOORD_0",type:"Float32",components:2},{name:"a_Color",type:"Float32",components:3}]),ag=new _t,sg=new _t,lg=new _t,ug=new _t;class cg extends wd{constructor(e){super(e),this.type="PolylineGeometry",this.setData(e);}_parse(e,t=[],i=[]){let n,r,o,a;this._positionsCallBack?(n=this._positionsCallBack(),this._vertexArray.clear(),this._indexArray.clear()):0!=t.length?(n=t,r=i[0][0],o=i[0][1],a=i[0][2]):n=this._positions,e&&this.incrementalData&&(n=this._positions.slice(this.incrementalData.originPositionCount),n=this.incrementalData.lastTwoPosition.concat(n));const s=this._width,l=this._arcType,u=this._granularity,c=this._ellipsoid;let h,d,p;n=rp(n,_t.equalsEpsilon,!1,[]);let f=n.length;if(f<2||s<=0)return;if(l===sp.GEODESIC||l===sp.RHUMB){let e;e=l===sp.GEODESIC?ot.CesiumMath.chordLength(u,c.maximumRadius):u;const t=vu.extractHeights(n,c);n=l===sp.GEODESIC?vu.generateCartesianArc({positions:n,minDistance:e,ellipsoid:c,height:t}):vu.generateCartesianRhumbArc({positions:n,granularity:e,ellipsoid:c,height:t});}f=n.length;const m=4*f-4,_=new Float64Array(3*m),g=new Float64Array(3*m),y=new Float64Array(3*m),x=new Float32Array(2*m),v=new Float32Array(2*m);let w,T,b,P,S,E,A,C,M,I,L=0,N=0,R=0;for(d=0;d<f;++d){0===d?(w=ag,_t.subtract(n[0],n[1],w),_t.add(n[0],w,w)):w=n[d-1],_t.clone(w,lg),_t.clone(n[d],sg),d===f-1?(w=ag,_t.subtract(n[f-1],n[f-2],w),_t.add(n[f-1],w,w)):w=n[d+1],_t.clone(w,ug);const e=d===f-1?2:4;for(p=0===d?2:0;p<e;++p){_t.pack(sg,_,L),_t.pack(lg,g,L),_t.pack(ug,y,L),L+=3;const e=p-2<0?-1:1;x[N++]=p%2*2-1,x[N++]=e*s,v[R++]=d/(f-1),v[R++]=Math.max(x[N-2],0);}}this.finalPositions=_;for(let e=0;e<this._evennessUV.length;e++)v[e]=this._evennessUV[e];for(h=0;h<_.length;h+=3)T=gd.encode(_[h]),b=gd.encode(_[h+1]),P=gd.encode(_[h+2]),S=gd.encode(g[h]),E=gd.encode(g[h+1]),A=gd.encode(g[h+2]),C=gd.encode(y[h]),M=gd.encode(y[h+1]),I=gd.encode(y[h+2]),i.length>1?this._vertexArray.emplaceBack(T.high,b.high,P.high,T.low,b.low,P.low,S.high,E.high,A.high,S.low,E.low,A.low,C.high,M.high,I.high,C.low,M.low,I.low,x[h/3*2],x[h/3*2+1],v[h/3*2],v[h/3*2+1],r,o,a):this._vertexArray.emplaceBack(T.high,b.high,P.high,T.low,b.low,P.low,S.high,E.high,A.high,S.low,E.low,A.low,C.high,M.high,I.high,C.low,M.low,I.low,x[h/3*2],x[h/3*2+1],v[h/3*2],v[h/3*2+1]);const O=f-1;if(t.length>0)for(d=0;d<O;++d)this._indexArray.emplaceBack(this.index,this.index+2,this.index+1),this._indexArray.emplaceBack(this.index+1,this.index+2,this.index+3),this.index+=4;else {let t=e?this.incrementalData.lastIndex:0;for(d=0;d<O;++d)this._indexArray.emplaceBack(t,t+2,t+1),this._indexArray.emplaceBack(t+1,t+2,t+3),t+=4;this.incrementalData={originPositionCount:this._positionsCallBack?this._positionsCallBack().length:this._positions.length,lastIndex:t,lastTwoPosition:n.slice(n.length-2)};}if(!this.dynamicAirLine){const e=this._positionsCallBack?this._positionsCallBack():this._positions;if(2===e.length){_t.lerp(e[0],e[1],.5,sg),sg[0]+=1;const t=[e[0],sg,e[1]];this.computeBoundingSphere(t),this.computeBoundingBox(t);}else this.computeBoundingSphere(this.finalPositions),this.computeBoundingBox(this.finalPositions);}this._ready=!0,this._needUpdate=!0;}_parseExtrude(){let e;if(this._positionsCallBack?(e=this._positionsCallBack(),this._vertexArray.clear(),this._indexArray.clear()):e=this._positions,e=rp(e,_t.equalsEpsilon,!1),e.length<2)return;const t=this._ellipsoid,{attributes:i,indices:n}=rg.createVolumeGeometry(e,t,this.minimumHeight,this.maximumHeight),{position:r,startHiAndForwardOffsetX:o,startLoAndForwardOffsetY:a,startNormalAndForwardOffsetZ:s,endNormalAndTextureCoordinateNormalizationX:l,rightNormalAndTextureCoordinateNormalizationY:u}=i;this.finalPositions=r;for(let e=0,t=n.length;e<t;e+=3)this._indexArray.emplaceBack(n[e],n[e+1],n[e+2]);let c,h,d,p=0;for(let e=0,t=o.length;e<t;e+=4)c=gd.encode(r[p]),h=gd.encode(r[p+1]),d=gd.encode(r[p+2]),this._vertexArray.emplaceBack(c.high,h.high,d.high,c.low,h.low,d.low,o[e],o[e+1],o[e+2],a[e],a[e+1],a[e+2],s[e],s[e+1],s[e+2],l[e],l[e+1],l[e+2],u[e],u[e+1],u[e+2],o[e+3],a[e+3],s[e+3],l[e+3],u[e+3],this._width),p+=3;this.computeBoundingSphere(this.finalPositions),this.computeBoundingBox(this.finalPositions),this._ready=!0,this._needUpdate=!0;}updateProperty(e){this.setData(e);}setData(e){if(super.setData(),this._width=Z(Z(e.width,this._width),1),this.colorArray=Z(e.colorArray,void 0),this.lineSegmentation=Z(e.lineSegmentation,void 0),this.speed=Z(e.speed,60),this.segGroup=Z(e.segGroup,5),this.dynamicAirLine=Z(e.dynamicAirLine,!1),this._evennessUV=[],this.minimumHeight=Z(e.minimumHeight,Z(this.minimumHeight,pp)),this.maximumHeight=Z(e.maximumHeight,Z(this.maximumHeight,fp)),e.positions&&"function"==typeof e.positions)this._positionsCallBack=e.positions;else {if(!e.positions||e.positions.length<2)return void console.error("至少添加两个点位！");this._positions=e.positions;}if(e.useEvennessUV){this._evennessUV.push(0,0,0,1);const e=[0];for(let t=1;t<this._positions.length;t++){const i=e[t-1]+_t.distance(this._positions[t-1],this._positions[t]);e.push(i);}for(let t=1;t<e.length-1;t++){const i=e[t]/e[e.length-1];this._evennessUV.push(i,0,i,1,i,0,i,1);}this._evennessUV.push(1,0,1,1);}if(this._vertexArray||this._indexArray?e.incrementalUpdate||(this._vertexArray.clear(),this._indexArray.clear()):(this._arcType=Z(e.arcType,sp.GEODESIC),this._granularity=Z(e.granularity,ot.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=hi.clone(Z(e.ellipsoid,hi.WGS84)),this._vertexArray=null==this.colorArray?new aa:new la,this._indexArray=new Ba,this.primitiveType=Du.TRIANGLES,this._usedDoublePrecision=!0,this._ready=!1),this.adaptTerrain)this._vertexArray=new sa,this._parseExtrude();else if(this.index=0,void 0!==this.lineSegmentation){for(let t=0;t<this.lineSegmentation.length;t++)this._parse(e.incrementalUpdate,this._positions.slice(this.lineSegmentation[t][2],this.lineSegmentation[t][3]),this.colorArray.slice(this.lineSegmentation[t][2],this.lineSegmentation[t][3]));this.computeBoundingSphere(this._positions),this.computeBoundingBox(this._positions);}else this._parse(e.incrementalUpdate);}setAdaptTerrain(e){this.adaptTerrain=e,this._indexArray=new Ba,this.adaptTerrain?(this._vertexArray=new sa,this._parseExtrude()):(this._vertexArray=new aa,this._parse());}update(e){if(this._positionsCallBack&&(this.adaptTerrain?this._parseExtrude():this._parse()),this.dynamicAirLine&&(null!=this.lineSegmentation&&this.updateLineSegmentation(e),this.setData({positions:this._positions,width:this.width,arcType:sp.GEODESIC,lineSegmentation:this.lineSegmentation,colorArray:this.colorArray,speed:this.speed,segGroup:this.segGroup,dynamicAirLine:this.dynamicAirLine}),this._needUpdate=!0),this._needUpdate&&e.painter){const t=e.painter.context;this._vertexBuffer&&this._vertexBuffer.destroy(),this._indexBuffer&&this._indexBuffer.destroy(),this._segmentVector&&this._segmentVector.destroy(),this._vertexBuffer=t.createVertexBuffer(this._vertexArray,this._vertexArray instanceof aa?eg.members:this._vertexArray instanceof la?og.members:tg.members,this.dynamicDraw),this._indexBuffer=t.createIndexBuffer(this._indexArray,this.dynamicDraw),this._segmentVector=ep.simpleSegment(0,0,this._vertexArray.length,this._indexArray.length),this._ready=!0,this._needUpdate=!1;}}updateLineSegmentation(e){for(let t=0;t<this.lineSegmentation.length;t++){const i=this.lineSegmentation[t][0],n=this.lineSegmentation[t][1],r=n-i;let o=e.painter._map.timer.counter*this.speed,a=o-this.segGroup;o%r>a%r?(o=Math.floor(o%r)+i,a=o-this.segGroup):(o=n,a=Math.floor(a%r)+i),this.lineSegmentation[t][2]=a,this.lineSegmentation[t][3]=o;}}serialize(){const e=[];for(let t=0;t<this._positions.length;t++)e.push(_t.pack(this._positions[t],new Array(3)));return {type:this.type,positions:e,width:this._width,arcType:this._arcType}}destroy(){super.destroy(),this._positions=void 0,this._width=void 0,this._arcType=void 0,this._granularity=void 0,this._ellipsoid=void 0,this.type=void 0,this._vertexArray=void 0,this._indexArray=void 0,this.primitiveType=void 0,this._ready=void 0,this._segmentVector=void 0,this._polylineUpdated=void 0;}}function hg(e,t,i){return t*(Wh/(e.tileSize*Math.pow(2,i-e.tileID.overscaledZ)))}function dg(e,t){const{expression:i}=t;if("constant"===i.kind)return {functionType:"constant",layoutSize:i.evaluate(new Lp(e+1))};if("source"===i.kind)return {functionType:"source"};{const n=i.zoomStops;let r=0;for(;r<n.length&&n[r]<=e;)r++;r=Math.max(0,r-1);let o=r;for(;o<n.length&&n[o]<e+1;)o++;o=Math.min(n.length-1,o);const a={min:n[r],max:n[o]};return "composite"===i.kind?{functionType:"composite",zoomRange:a,propertyValue:t.value}:{functionType:"camera",layoutSize:i.evaluate(new Lp(e+1)),zoomRange:a,sizeRange:{min:i.evaluate(new Lp(a.min)),max:i.evaluate(new Lp(a.max))},propertyValue:t.value}}}function pg(e,t,i){const n=t;return "source"===e.functionType?i.lowerSize/10:"composite"===e.functionType?xr(i.lowerSize/10,i.upperSize/10,n.uSizeT):n.uSize}function fg(e,t,i){if("constant"===e.functionType)return {uSizeT:0,uSize:e.layoutSize};if("source"===e.functionType)return {uSizeT:0,uSize:0};if("camera"===e.functionType){const{propertyValue:n,zoomRange:r,sizeRange:o}=e,a=ze(Yo(n,i.specification).interpolationFactor(t,r.min,r.max),0,1);return {uSizeT:0,uSize:o.min+a*(o.max-o.min)}}{const{propertyValue:n,zoomRange:r}=e;return {uSizeT:ze(Yo(n,i.specification).interpolationFactor(t,r.min,r.max),0,1),uSize:0}}}const mg=bi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_offset",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint16"}]),_g=bi([{name:"a_CARTESIAN",components:3,type:"Float32"},{name:"a_projected_pos",components:3,type:"Float32"}],4);bi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const gg=bi([{name:"a_pick_color",components:4,type:"Float32"}]),yg=bi([{name:"a_placed",components:2,type:"Uint8"}],4);bi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]);const xg=bi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),vg=bi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);function wg(e,t,i){const n=t.layout.get("text-transform").evaluate(i,{});return "uppercase"===n?e=e.toLocaleUpperCase():"lowercase"===n&&(e=e.toLocaleLowerCase()),Ip.applyArabicShaping&&(e=Ip.applyArabicShaping(e)),e}function Tg(e,t,i){return e instanceof wn?(e.sections.forEach((e=>{e.text=wg(e.text,t,i);})),e):wg(e,t,i)}function bg(e){const t={},i={},n=[];let r=0;function o(t){n.push(e[t]),r++;}function a(e,t,r){const o=i[e];return delete i[e],i[t]=o,n[o].geometry[0].pop(),n[o].geometry[0]=n[o].geometry[0].concat(r[0]),o}function s(e,i,r){const o=t[i];return delete t[i],t[e]=o,n[o].geometry[0].shift(),n[o].geometry[0]=r[0].concat(n[o].geometry[0]),o}function l(e,t,i){const n=i?t[0][t[0].length-1]:t[0][0];return `${e}:${n.x}:${n.y}`}for(let u=0;u<e.length;u++){const c=e[u],h=c.geometry,d=c.text instanceof wn?c.text.toString():c.text;if(!d){o(u);continue}const p=l(d,h),f=l(d,h,!0);if(p in i&&f in t&&i[p]!==t[f]){const e=s(p,f,h),r=a(p,f,n[e].geometry);delete t[p],delete i[f],i[l(d,n[r].geometry,!0)]=r,n[e].geometry=null;}else p in i?a(p,f,h):f in t?s(p,f,h):(o(u),t[p]=r-1,i[f]=r-1);}return n.filter((e=>e.geometry))}bi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"hidden"}]),bi([{type:"Float32",name:"offsetX"}]),bi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Pg={min:-1*Math.pow(2,15),max:Math.pow(2,15)-1};function Sg(e){const t=Wh/e.extent,i=e.loadGeometry();for(let e=0;e<i.length;e++){const n=i[e];for(let e=0;e<n.length;e++){const i=n[e];i.x=Math.round(i.x*t),i.y=Math.round(i.y*t),(i.x<Pg.min||i.x>Pg.max||i.y<Pg.min||i.y>Pg.max)&&Ze("Geometry exceeds allowed extent, reduce your vector tile buffer size");}}return i}function Eg(e,t,i,n,r){this.properties={},this.extent=i,this.type=0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=r,this._version=arguments[5],this._projection=e.projection||"MERCATOR",this.projObj=yi(this._projection),e.readFields(Ag,this,t);}function Ag(e,t,i){1==e?t.id=i.readVarint():2==e?function(e,t){const i=e.readVarint()+e.pos;for(;e.pos<i;){const i=t._keys[e.readVarint()],n=t._values[e.readVarint()];t.properties[i]=n;}}(i,t):3==e?t.type=i.readVarint():4==e&&(t._geometry=i.pos);}function Cg(e){let t=0;for(var i,n,r=0,o=e.length,a=o-1;r<o;a=r++)t+=((n=e[a]).x-(i=e[r]).x)*(i.y+n.y);return t}function Mg(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Ig,this,t),this.length=this._features.length;}function Ig(e,t,i){15===e?t.version=i.readVarint():1===e?t.name=i.readString():5===e?t.extent=i.readVarint():2===e?t._features.push(i.pos):3===e?t._keys.push(i.readString()):4===e&&t._values.push(function(e){let t=null,i=e.readVarint()+e.pos;for(;e.pos<i;){const i=e.readVarint()>>3;t=1===i?e.readString():2===i?e.readFloat():3===i?e.readDouble():4===i?e.readVarint64():5===i?e.readVarint():6===i?e.readSVarint():7===i?e.readBoolean():null;}return t}(i));}function Lg(e,t,i){if(3===e){const e=new Mg(i,i.readVarint()+i.pos);e.length&&(t[e.name]=e);}}Eg.types=["Unknown","Point","LineString","Polygon"],Eg.prototype.loadGeometry=function(){const e=this._pbf;e.pos=this._geometry;let t,i=e.readVarint()+e.pos,n=1,r=0,o=0,a=0,s=0,l=[];for(;e.pos<i;){if(r<=0){const t=e.readVarint();n=7&t,r=t>>3;}if(r--,1===n||2===n)o+=e.readSVarint(),a+=e.readSVarint(),this._version>100&&(s+=e.readSVarint()),1===n&&(t&&l.push(t),t=[]),t.push(new te(o,a,s));else {if(7!==n)throw new Error(`unknown command ${n}`);t&&t.push(t[0].clone());}}return t&&l.push(t),l},Eg.prototype.bbox=function(){const e=this._pbf;e.pos=this._geometry;let t=e.readVarint()+e.pos,i=1,n=0,r=0,o=0,a=1/0,s=-1/0,l=1/0,u=-1/0;for(;e.pos<t;){if(n<=0){const t=e.readVarint();i=7&t,n=t>>3;}if(n--,1===i||2===i)r+=e.readSVarint(),o+=e.readSVarint(),r<a&&(a=r),r>s&&(s=r),o<l&&(l=o),o>u&&(u=o);else if(7!==i)throw new Error(`unknown command ${i}`)}return [a,l,s,u]},Eg.prototype.toGeoJSON=function(e,t,i){let n,r,o=this.extent*Math.pow(2,i),a=this.extent*e,s=this.extent*t,l=this.loadGeometry(),u=Eg.types[this.type];const c=this;function h(e){for(let t=0;t<e.length;t++){const i=e[t];e[t]=[c.projObj.xLng(i.x+a,o),c.projObj.yLat(i.y+s,o)];}}switch(this.type){case 1:var d=[];for(n=0;n<l.length;n++)d[n]=l[n][0];l=d,h(l);break;case 2:for(n=0;n<l.length;n++)h(l[n]);break;case 3:for(l=function(e){const t=e.length;if(t<=1)return [e];let i,n,r=[];for(let o=0;o<t;o++){const t=Cg(e[o]);0!==t&&(void 0===n&&(n=t<0),n===t<0?(i&&r.push(i),i=[e[o]]):i.push(e[o]));}return i&&r.push(i),r}(l),n=0;n<l.length;n++)for(r=0;r<l[n].length;r++)h(l[n][r]);}1===l.length?l=l[0]:u=`Multi${u}`;const p={type:"Feature",geometry:{type:u,coordinates:l},properties:this.properties};return "id"in this&&(p.id=this.id),p},Mg.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const t=this._pbf.readVarint()+this._pbf.pos;return new Eg(this._pbf,t,this.extent,this._keys,this._values,this.version)};var Ng={VectorTile:function(e,t,i){e.projection=i,this.layers=e.readFields(Lg,{},t);},VectorTileFeature:Eg,VectorTileLayer:Mg};const Rg={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};class Og extends te{constructor(e,t,i,n){super(e,t),this.angle=i,void 0!==n&&(this.segment=n);}clone(){return new Og(this.x,this.y,this.angle,this.segment)}}$o("Anchor",Og);const Dg={AIRLINE:"airline",CIRCLE:"circle",DYNAMIC_LINE:"dynamic-line",EXTRUSION:"extrusion",FILL:"fill",HEATMAP:"heatmap",HISTOGRAM:"histogram",LINE:"line",SPRITE:"sprite",SYMBOL:"symbol",SYMTRACKING:"symtracking",TRACKING:"tracking",RASTER:"raster",IMAGE:"image",BACKGROUND:"background",MODEL:"3d-model",TILES:"3d-tiles",DEBUG_TILE:"debug-tile",PROXY:"proxy"},Fg=Ng.VectorTileFeature.types,zg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Bg(e,t,i,n,r,o,a){e.emplaceBack(t.x,t.y,t.z,Math.round(32*i),Math.round(32*n),r,o,a?a[0]:0,a?a[1]:0);}function Vg(e,t,i,n,r,o,a,s,l,u,c,h){const d=new pd,p=o[2]-l,f=Math.pow(2,p);let m=1;l-u-p<-.5&&(m=Math.pow(2,(l-u-p+.5)/3));const _=new Ot(t.x-n.x,t.y-n.y);_.multiplyScalar(16*r*m),d.rotate(i);for(let l=0;l<4;l++){const u=new Ot(a[l][0]*m,a[l][1]*m);u.multiplyScalar(r/4).transformByMatrix2(d);const p=_.clone().add(u).add([16*n.x,16*n.y]).multiplyScalar(f/8192),g=Nl(o[0]+p[0],o[1]+p[1],o[2],s,h);e.emplaceBack(g[0]-c[0],g[1]-c[1],g[2]-c[2],t.x-n.x,t.y-n.y,i);}}class kg{constructor(e){this.layoutVertexArray=new Oa,this.indexArray=new Ba,this.programConfigurations=e,this.segments=new ep,this.dynamicLayoutVertexArray=new ca,this.opacityVertexArray=new Ca,this.placedSymbolArray=new qa;}upload(e,t,i,n){i&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,_g.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,zg,!0),this.opacityVertexBuffer.itemSize=1),(i||n)&&this.programConfigurations.upload(e);}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy());}}$o("SphereSymbolBuffers",kg);class Ug{constructor(e,t,i){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new i,this.segments=new ep,this.collisionVertexArray=new Ia;}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,yg.members,!0);}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy());}}$o("SphereCollisionBuffers",Ug);class Gg{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasRTLText=!1,this.glyphQuadsArray=[],this.symbolHeightsArray=[],this.type=Dg.SYMBOL;const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=dg(this.zoom,t["text-size"]),this.iconSizeData=dg(this.zoom,t["icon-size"]);const i=this.layers[0].layout,n=i.get("symbol-sort-key"),r=i.get("symbol-z-order");this.sortFeaturesByKey="viewport-y"!==r&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===r||"auto"===r&&!this.sortFeaturesByKey)&&(i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement")),this.sourceID=e.sourceID,this.projection=e.projection||mi.MERCATOR,this.pickColor=!0;}createArrays(){this.text=new kg(new gf(mg.members,this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new kg(new gf(mg.members,this.layers,this.zoom,(e=>/^icon/.test(e)))),this.collisionBox=new Ug(Da,xg.members,ka),this.collisionCircle=new Ug(Da,vg.members,Ba),this.glyphOffsetArray=new Wa,this.lineVertexArray=new $a;}calculateGlyphDependencies(e,t,i,n){for(let r=0;r<e.length;r++)if(t[e.charCodeAt(r)]=!0,i&&n){const i=Rg[e.charAt(r)];i&&(t[i.charCodeAt(0)]=!0);}}populate(e,t,i){this.baseP||(this.x=t.x,this.y=t.y,this.z=t.z,this.zPow=Math.pow(2,this.z),this.baseP=Nl(this.x,this.y,this.z,this.projection),this.matrix=Rl(this.baseP));const n=this.layers[0],r=n.layout,o=r.get("text-font"),a=r.get("text-field"),s=r.get("icon-image"),l=("constant"!==a.value.kind||a.value.value.toString().length>0)&&("constant"!==o.value.kind||o.value.value.length>0),u="constant"!==s.value.kind||s.value.value&&s.value.value.length>0,c=r.get("symbol-sort-key");if(this.features=[],!l&&!u)return;const h=t.iconDependencies,d=t.glyphDependencies,p=t.availableImages,f=new Lp(this.zoom);for(const{feature:t,index:a,sourceLayerIndex:s}of e){if(!n._featureFilter(f,t,i))continue;let e,m;if(l){const r=n.getValueAndResolveTokens("text-field",t,i,p),o=wn.factory(r);o.containsRTLText()&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Cp()||this.hasRTLText&&Ip.isParsed())&&(e=Tg(o,n,t));}if(u){this.iconHaloWidth=n.paint.get("icon-halo-width").evaluate(t,{});const e=n.getValueAndResolveTokens("icon-image",t,i,p);m=e instanceof Tn?e:Tn.fromString(e);}if(!e&&!m)continue;const _=this.sortFeaturesByKey?c.evaluate(t,{},i):void 0,g={text:e,icon:m,index:a,sourceLayerIndex:s,geometry:Sg(t),properties:t.properties,type:Fg[t.type],sortKey:_};if(void 0!==t.id&&(g.id=t.id),this.features.push(g),m&&m instanceof Tn&&(h[m.name]=!0),e){const i=o.evaluate(t,{}).join(",");this.textHaloWidth=n.paint.get("text-halo-width").evaluate(t,{});const a=d[i]=d[i]||{},s="map"===r.get("text-rotation-alignment")&&"point"!==r.get("symbol-placement");if(e instanceof wn)for(const t of e.sections){const n=pn(e.toString()),r=t.fontStack||i,o=d[r]=d[r]||{};this.calculateGlyphDependencies(t.text,o,s,n);}else {const t=pn(e);this.calculateGlyphDependencies(e,a,s,t);}}}"line"===r.get("symbol-placement")&&(this.features=bg(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey));}update(e,t){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers));}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return !this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){this.uploaded||(this.collisionBox.upload(e),this.collisionCircle.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0;}destroy(){this.text.destroy(),this.icon.destroy(),this.collisionBox.destroy(),this.collisionCircle.destroy();}addToLineVertexArray(e,t){const i=this.lineVertexArray.length;if(void 0!==e.segment){let i=e.dist(t[e.segment+1]),n=e.dist(t[e.segment]);const r={};for(let n=e.segment+1;n<t.length;n++)r[n]={x:t[n].x,y:t[n].y,tileUnitDistanceFromAnchor:i},n<t.length-1&&(i+=t[n+1].dist(t[n]));for(let i=e.segment||0;i>=0;i--)r[i]={x:t[i].x,y:t[i].y,tileUnitDistanceFromAnchor:n},i>0&&(n+=t[i-1].dist(t[i]));for(let e=0;e<t.length;e++){const t=r[e];this.lineVertexArray.emplaceBack(t.x,t.y,t.tileUnitDistanceFromAnchor);}}return {lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(e,t,i,n,r,o,a,s,l,u,c){const h=e.indexArray,d=e.layoutVertexArray,p=e.dynamicLayoutVertexArray,f=e.segments.prepareSegment(4*t.length,e.layoutVertexArray,e.indexArray),m=this.glyphOffsetArray.length,_=f.vertexLength;for(const e of t){const t=e.tl,n=e.tr,r=e.bl,a=e.br,l=e.tex,u=f.vertexLength,c=e.glyphOffset[1];let m=0;const _=this.layers[0].layout.get("symbol-height-offset")?.value?.value||0,g=this.layers[0].layout.get("symbol-height-key")||"symbolHeight";o.properties&&o.properties[g]?m=parseFloat(o.properties[g]):o.properties&&o.properties.height&&o.properties[g]&&(m=parseFloat(o.properties.height)),m+=parseFloat(_);const y=this.calcTDSpacePoint(s.x,s.y,m);Bg(d,y,t.x,c+t.y,l.x,l.y,i),Bg(d,y,n.x,c+n.y,l.x+l.w,l.y,i),Bg(d,y,r.x,c+r.y,l.x,l.y+l.h,i),Bg(d,y,a.x,c+a.y,l.x+l.w,l.y+l.h,i);const x=[[32*t.x,32*(c+t.y)],[32*n.x,32*(c+n.y)],[32*r.x,32*(c+r.y)],[32*a.x,32*(c+a.y)]];Vg(p,s,0,s,1,[this.x,this.y,this.z],x,this.projection,this.z,this.z,this.baseP,m),h.emplaceBack(u,u+1,u+2),h.emplaceBack(u+1,u+2,u+3),f.vertexLength+=4,f.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(e.glyphOffset[0]),this.glyphQuadsArray.push(x),this.symbolHeightsArray.push(m);}e.placedSymbolArray.emplaceBack(s.x,s.y,m,this.glyphOffsetArray.length-m,_,l,u,s.segment,i?i[0]:0,i?i[1]:0,n[0],n[1],a,!1),e.programConfigurations.populatePaintArrays(e.layoutVertexArray.length,o,o.index,{},c);}_addCollisionDebugVertex(e,t,i,n,r){return t.emplaceBack(0,0),e.emplaceBack(i.x,i.y,i.z,n.x,n.y,Math.round(r.x),Math.round(r.y))}addCollisionDebugVertices(e,t,i,n,r,o,a,s){const l=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),u=l.vertexLength,c=r.layoutVertexArray,h=r.collisionVertexArray,d=this.calcTDSpacePoint(o.x,o.y);if(this._addCollisionDebugVertex(c,h,d,a.anchor,new te(e,t)),this._addCollisionDebugVertex(c,h,d,a.anchor,new te(i,t)),this._addCollisionDebugVertex(c,h,d,a.anchor,new te(i,n)),this._addCollisionDebugVertex(c,h,d,a.anchor,new te(e,n)),l.vertexLength+=4,s){const e=r.indexArray;e.emplaceBack(u,u+1,u+2),e.emplaceBack(u,u+2,u+3),l.primitiveLength+=2;}else {const e=r.indexArray;e.emplaceBack(u,u+1),e.emplaceBack(u+1,u+2),e.emplaceBack(u+2,u+3),e.emplaceBack(u+3,u),l.primitiveLength+=4;}}generateCollisionDebugBuffers(){for(const e of this.symbolInstances){e.textCollisionFeature={boxStartIndex:e.textBoxStartIndex,boxEndIndex:e.textBoxEndIndex},e.iconCollisionFeature={boxStartIndex:e.iconBoxStartIndex,boxEndIndex:e.iconBoxEndIndex};for(let t=0;t<2;t++){const i=e[0===t?"textCollisionFeature":"iconCollisionFeature"];if(i)for(let t=i.boxStartIndex;t<i.boxEndIndex;t++){const i=this.collisionBoxArray.get(t),n=i.radius>0;this.addCollisionDebugVertices(i.x1,i.y1,i.x2,i.y2,n?this.collisionCircle:this.collisionBox,i.anchorPoint,e,n);}}}}deserializeCollisionBoxes(e,t,i,n,r){const o={};for(let n=t;n<i;n++){const t=e.get(n);if(0===t.radius){o.textBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,anchorPointX:t.anchorPointX,anchorPointY:t.anchorPointY},o.textFeatureIndex=t.featureIndex;break}o.textCircles||(o.textCircles=[],o.textFeatureIndex=t.featureIndex),o.textCircles.push(t.anchorPointX,t.anchorPointY,t.radius,t.signedDistanceFromAnchor,1);}for(let t=n;t<r;t++){const i=e.get(t);if(0===i.radius){o.iconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},o.iconFeatureIndex=i.featureIndex;break}}return o}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasCollisionBoxData(){return this.collisionBox.segments.get().length>0}hasCollisionCircleData(){return this.collisionCircle.segments.get().length>0}sortFeatures(e){if(!this.sortFeaturesByY)return;if(this.sortedAngle===e)return;if(this.sortedAngle=e,this.text.segments.get().length>1||this.icon.segments.get().length>1)return;const t=[];for(let e=0;e<this.symbolInstances.length;e++)t.push(e);const i=Math.sin(e),n=Math.cos(e);t.sort(((e,t)=>{const r=this.symbolInstances[e],o=this.symbolInstances[t];return (0|Math.round(i*r.anchor.x+n*r.anchor.y))-(0|Math.round(i*o.anchor.x+n*o.anchor.y))||o.featureIndex-r.featureIndex})),this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of t){const t=this.symbolInstances[e];this.featureSortOrder.push(t.featureIndex);for(const e of t.placedTextSymbolIndices){const t=this.text.placedSymbolArray.get(e),i=t.vertexStartIndex+4*t.numGlyphs;for(let e=t.vertexStartIndex;e<i;e+=4)this.text.indexArray.emplaceBack(e,e+1,e+2),this.text.indexArray.emplaceBack(e+1,e+2,e+3);}const i=this.icon.placedSymbolArray.get(e);if(i.numGlyphs){const e=i.vertexStartIndex;this.icon.indexArray.emplaceBack(e,e+1,e+2),this.icon.indexArray.emplaceBack(e+1,e+2,e+3);}}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray);}calcTDSpacePoint(e,t,i){const n=Ll(this.x+e/8192,this.y+t/8192,this.zPow,this.projection),r=Nu.cartographicToCartesian3([n[0],n[1],i]);return new te(r[0]-this.baseP[0],r[1]-this.baseP[1],r[2]-this.baseP[2])}}$o("SymbolBucket",Gg,{omit:["layers","collisionBoxArray","compareText"],shallow:["symbolInstances","features","matrix"]}),Gg.addDynamicAttributes=Vg;var Hg={$version:8,$root:{version:{required:!0,type:"enum",values:[8],"doc-en":"Style specification version number. Must be 8."},name:{type:"string","doc-en":"A human-readable name for the style."},metadata:{type:"*","doc-en":"Metadata configuration related to map rendering. It only contains two options, 'enableNormal' and 'resolvePass', now. If you want to check out model's normal info, set 'enableNormal' to true and 'resolvePass' to 'normal'."},camera:{type:"*","doc-en":"Camera position and pose, including longitude, latitude, height, pitch, bearing and roll."},lights:{type:"any","doc-en":"The global light source, containing 'AmbientLight', 'DirectionalLight', 'PointLight' and 'SunLight'. Please refer to API documentation."},sources:{required:!0,type:"sources","doc-en":"Data source specifications."},sprite:{type:"any","doc-en":"A base URL for retrieving the sprite image and metadata. The extensions `.png`, `.json` and scale factor `@2x.png` will be automatically appended. This property is required if any layer uses the `background-pattern`, `fill-pattern`, `line-pattern`, `extrusion-pattern`, or `icon-image` properties. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax)."},IBL:{type:"string","doc-en":"The base request path of the picture used to request the PBR effect"},glyphs:{type:"string","doc-en":"A URL template for loading signed-distance-field glyph sets in PBF format. The URL must include `{fontstack}` and `{range}` tokens. This property is required if any layer uses the `text-field` layout property. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax)."},transition:{type:"transition","doc-en":"A global transition definition to use as a default across properties, to be used for timing transitions between one value and the next when no property-specific transition is set. Collision-based symbol fading is controlled independently of the style's `transition` property."},layers:{required:!0,type:"array",value:"layer","doc-en":"Layers will be drawn in the order of this array."},projection:{type:"string",default:"MERCATOR","doc-en":"Map projection, 'MERCATOR' is the default and 'LATLON' can be chosen."},sceneComponent:{type:"*","doc-en":"Scene component specifications. Please refer to API documentation."},analysis:{type:"*","doc-en":"Spatial analysis specifications. Please refer to API documentation."},postProcess:{type:"*","doc-en":"Post Process specifications. Please refer to API documentation."},videoProjection:{type:"any","doc-en":"Video projection specifications. Please refer to API documentation."},terrain:{type:"*","doc-en":"Terrain specifications. Please refer to API documentation."}},sources:{"*":{type:"source","doc-en":"Specification of a data source. For vector, raster, image and video sources, a URL must be provided. For GeoJSON sources, a URL or inline GeoJSON must be provided."}},source:["source_vector","source_raster","source_geojson","source_image","source_3d-model","source_3d-tiles"],source_vector:{type:{required:!0,type:"enum",values:{vector:{"doc-en":"A vector tile source."}},"doc-en":"The type of the source."},url:{type:"string","doc-en":"A URL to a vector resource. Supported protocols are `http:`, `https:`, and `minemap://<Tileset ID>`."},tiles:{type:"array",value:"string","doc-en":"An array of one or more tile source URLs."},bounds:{type:"array",value:"number",length:4,default:[-180,-90,180,90],"doc-en":"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by minemap GL."},scheme:{type:"enum",values:{xyz:{"doc-en":"Slippy map tilenames scheme."},tms:{"doc-en":"OSGeo spec scheme."}},default:"xyz","doc-en":"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},projection:{type:"string",default:"MERCATOR","doc-en":"Map projection, 'MERCATOR' is the default and 'LATLON' can be chosen."},minzoom:{type:"number",default:0,"doc-en":"Minimum zoom level for which tiles are available."},maxzoom:{type:"number",default:22,"doc-en":"Maximum zoom level for which tiles are available. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},attribution:{type:"string","doc-en":"Contains an attribution to be displayed when the map is shown to a user."},promoteId:{type:"promoteId","doc-en":"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`. If specified as a string for a vector tile source, the same property is used across all its source layers."},adaptTerrain:{type:"boolean",default:!1,"doc-en":"Vector adapted to terrain."},"*":{type:"*","doc-en":"Other keys to configure the data source."}},source_raster:{type:{required:!0,type:"enum",values:{raster:{"doc-en":"A raster tile source."}},"doc-en":"The type of the source."},url:{type:"string","doc-en":"A URL to a raster resource. Supported protocols are `http:`, `https:`, and `minemap://<Tileset ID>`."},tiles:{type:"array",value:"string","doc-en":"An array of one or more tile source URLs."},bounds:{type:"array",value:"number",length:4,default:[-180,-90,180,90],"doc-en":"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by minemap GL."},minzoom:{type:"number",default:0,"doc-en":"Minimum zoom level for which tiles are available."},maxzoom:{type:"number",default:22,"doc-en":"Maximum zoom level for which tiles are available. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels","doc-en":"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},scheme:{type:"enum",values:{xyz:{"doc-en":"Slippy map tilenames scheme."},tms:{"doc-en":"OSGeo spec scheme."},baidu:{"doc-en":"Baidu map scheme."},wmts:{"doc-en":"WMTS spec scheme."}},default:"xyz","doc-en":"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},projection:{type:"string",default:"MERCATOR","doc-en":"Map projection, 'MERCATOR' is the default and 'LATLON' can be chosen."},capabilities:{type:"*","doc-en":"WMTS service description info, can be used only if 'scheme' option set to 'wmts'."},attribution:{type:"string","doc-en":"Contains an attribution to be displayed when the map is shown to a user."},"*":{type:"*","doc-en":"Other keys to configure the data source.",expose:!1}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{"doc-en":"A GeoJSON data source."}},"doc-en":"The data type of the GeoJSON source."},data:{type:"*","doc-en":"A URL to a GeoJSON file, or inline GeoJSON."},minzoom:{type:"number",default:0,"doc-en":"Creates the minimum zoom level for the vector tile (a lower scale level represents a smaller scale level)."},maxzoom:{type:"number",default:24,"doc-en":"Maximum zoom level at which to create vector tiles (higher means greater detail at high zoom levels)."},attribution:{type:"string","doc-en":"Contains an attribution to be displayed when the map is shown to a user."},buffer:{type:"number",default:128,maximum:512,minimum:0,"doc-en":"Size of the tile buffer on each side. A value of 0 produces no buffer. A value of 512 produces a buffer as wide as the tile itself. Larger values produce fewer rendering artifacts near tile edges and slower performance."},tolerance:{type:"number",default:.375,"doc-en":"Douglas-Peucker simplification tolerance (higher means simpler geometries and faster performance)."},cluster:{type:"boolean",default:!1,"doc-en":"If the data is a collection of point features, setting this to true clusters the points by radius into groups. Cluster groups become new `Point` features in the source with additional properties:\n * `cluster` Is `true` if the point is a cluster \n * `cluster_id` A unqiue id for the cluster to be used in conjunction with the [cluster inspection methods](https://www.minemap.com/minemap-gl-js/api/#geojsonsource#getclusterexpansionzoom)\n * `point_count` Number of original points grouped into this cluster\n * `point_count_abbreviated` An abbreviated point count"},clusterRadius:{type:"number",default:50,minimum:0,"doc-en":"Radius of each cluster if clustering is enabled. A value of 512 indicates a radius equal to the width of a tile."},clusterMaxZoom:{type:"number","doc-en":"Max zoom on which to cluster points if clustering is enabled. Defaults to one zoom less than maxzoom (so that last zoom features are not clustered)."},clusterMinPoints:{type:"number",default:2,"doc-en":"Minimum number of points necessary to form a cluster if clustering is enabled. Defaults to `2`."},clusterProperties:{type:"*","doc-en":'An object defining custom properties on the generated clusters if clustering is enabled, aggregating values from clustered points. Has the form `{"property_name": [operator, map_expression]}`. `operator` is any expression function that accepts at least 2 operands (e.g. `"+"` or `"max"`) — it accumulates the property value from clusters/points the cluster contains; `map_expression` produces the value of a single point.'},lineMetrics:{type:"boolean",default:!1,"doc-en":"Whether to calculate line distance metrics. This is required for line layers that specify `line-gradient` values."},promoteId:{type:"promoteId","doc-en":"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`. If specified as a string for a vector tile source, the same property is used across all its source layers."},adaptTerrain:{type:"boolean",default:!1,"doc-en":"GeoJSON adapted to terrain."}},"source_3d-model":{type:{required:!0,type:"enum",values:{"3d-model":{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},bounds:{type:"array",length:4,value:{type:"array",length:2,value:"number"}},location:{required:!0,type:"array",value:{type:"number"}},scale:{required:!0,type:"array",value:{type:"number"}},pickable:{type:"boolean"},filter:{type:"array",value:"*"},aabbFilter:{type:"array",value:"*"},rotation:{required:!0,type:"array",value:{type:"number"}},"up-axis":{type:"enum",values:{"Y-UP":{},"Z-UP":{}}},translation:{required:!0,type:"array",value:{type:"number"}},modelFolder:{required:!0,type:"string"},debug:{type:"boolean"},configuration:{type:"object"},log:{type:"boolean",default:!1},useMipmap:{type:"boolean",default:!0}},source_image:{type:{required:!0,type:"enum",values:{image:{"doc-en":"An image data source."}},"doc-en":"The data type of the image source."},url:{required:!0,type:"string","doc-en":"URL that points to an image."},coordinates:{required:!0,"doc-en":"Corners of image specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number","doc-en":"单个经度，纬度组。."}},grid:{type:"number",default:1},wms:{type:"boolean",default:!1,"doc-en":"Whether use WMS service."}},"source_3d-tiles":{type:{required:!0,type:"enum",values:{"3d-tiles":{}}},url:{type:"string",value:{type:"any"}},urls:{type:"array",value:{type:"object"}},maxzoom:{type:"number",default:22},minzoom:{type:"number",default:14},maximumMemoryUsage:{type:"number"},maximumScreenSpaceError:{type:"number"},throttleRequests:{type:"boolean"},attribution:{type:"string"},bounds:{type:"array",length:4,value:{type:"array",length:2,value:"number"}},collectResourceTiming:{required:!0,type:"boolean"},"up-axis":{type:"enum",values:{"Y-UP":{},"Z-UP":{}}},pickable:{type:"boolean"},debug:{type:"boolean"},forceLocation:{type:"array",value:{type:"number"}},translation:{type:"array",value:{type:"number"}},log:{type:"boolean",default:!1},useMipmap:{type:"boolean",default:!1},viewFrustum:{type:"object","doc-en":"Used to set the distance between the far and near clipping planes of the visual cone of 3dtiles",default:null}},layer:{id:{type:"string","doc-en":"Unique layer name.",required:!0},type:{type:"enum",values:{raster:{},fill:{},line:{},symbol:{},circle:{},heatmap:{},extrusion:{},histogram:{},dynamicLine:{},tracking:{},sprite:{},"3d-model":{},"3d-tiles":{},symtracking:{},background:{}},"doc-en":"Rendering type of this layer.",required:!0},metadata:{type:"*","doc-en":"Arbitrary properties useful to track with the layer, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'minemap:'."},source:{type:"string","doc-en":"Name of a source description to be used for this layer. Required for all layer types except `background`."},"source-layer":{type:"string","doc-en":"Layer to use from a vector tile source. Required for vector tile sources; prohibited for all other source types, including GeoJSON sources."},minzoom:{type:"number",minimum:0,maximum:24,"doc-en":"The minimum zoom level for the layer. At zoom levels less than the minzoom, the layer will be hidden."},maxzoom:{type:"number",minimum:0,maximum:24,"doc-en":"The maximum zoom level for the layer. At zoom levels equal to or greater than the maxzoom, the layer will be hidden."},filter:{type:"filter","doc-en":"A expression specifying conditions on source features. Only features that match the filter are displayed. Zoom expressions in filters are only evaluated at integer zoom levels. The `feature-state` expression is not supported in filter expressions."},layout:{type:"layout","doc-en":"Layout properties for the layer."},paint:{type:"paint","doc-en":"Default paint properties for this layer."},"depth-test":{type:"boolean",from:["raster"]},"hidden-terrain":{type:"boolean",from:["symbol"]},"hidden-fog":{type:"boolean",from:["symbol"]},independent:{type:"boolean",from:["raster"]},location:{type:"array",value:{type:"number"},from:["3d-model"]},rotation:{type:"array",value:{type:"number"},from:["3d-model"]},translation:{type:"array",value:{type:"number"},from:["3d-model"]},scale:{type:"array",value:{type:"number"},from:["3d-model"]},isSpecialLight:{type:"boolean",from:["3d-model"]},highLightColorsIndex:{type:"number",from:["3d-model"]},highLightColors:{type:"array",value:{type:"string"},from:["3d-model"]},"shadow-center":{type:"array",value:{type:"number"},from:["3d-model"]},specialLights:{type:"array",value:{type:"*"},from:["3d-model"]},classificationType:{type:"number",from:["line","fill","3d-model","raster","3d-tiles"]},lightingModel:{type:"number",from:["NONE","PHONG","PBR"]},phongLightConfig:{type:"phongLightConfig",from:["3d-model","3d-tiles","extrusion"]},lightExposure:{type:"number",from:["3d-model"]}},phongLightConfig:{Ambient:{type:"number",default:.6,minimum:0,maximum:1},Diffuse:{type:"number",minimum:0,maximum:1,default:.5},SpecularColor:{type:"number",minimum:0,maximum:1,default:.3},Shininess:{type:"number",default:2,minimum:0,maximum:1e3}},layout:["layout_background","layout_fill","layout_line","layout_symbol","layout_circle","layout_heatmap","layout_raster","layout_extrusion","layout_histogram","layout_dynamicLine","layout_tracking","layout_sprite","layout_3d-model","layout_3d-tiles","layout_symtracking"],layout_background:{visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"}},layout_sprite:{"sprite-cap":{type:"enum",values:{butt:{"doc-en":"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{"doc-en":"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},square:{"doc-en":"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},default:"butt","doc-en":"The display of line endings.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sprite-join":{type:"enum",values:{bevel:{"doc-en":"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},round:{"doc-en":"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},miter:{"doc-en":"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter","doc-en":"The display of lines when joining.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"sprite-miter-limit":{type:"number",default:2,"doc-en":"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"sprite-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sprite-round-limit":{type:"number",default:1.05,"doc-en":"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"sprite-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sprite-sort-key":{type:"number","doc-en":"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number","doc-en":"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"},dynamic:{type:"enum",values:{water:{},none:{}},default:"none",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{"doc-en":"A cap with a squared-off end which is drawn to the exact endpoint of the line."},"round-butt":{"doc-en":"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{"doc-en":"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},square:{"doc-en":"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},default:"butt","doc-en":"The display of line endings.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{"doc-en":"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},round:{"doc-en":"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},miter:{"doc-en":"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter","doc-en":"The display of lines when joining.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,"doc-en":"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,"doc-en":"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number","doc-en":"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-height-offset":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"},"border-visibility":{type:"enum",default:"none",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},"doc-en":"Whether draw border.","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{"doc-en":"The label is placed at the point where the geometry is located."},line:{"doc-en":"The label is placed along the line of the geometry. Can only be used on `LineString` and `Polygon` geometries."},"line-center":{"doc-en":"The label is placed at the center of the line of the geometry. Can only be used on `LineString` and `Polygon` geometries. Note that a single feature in a vector tile may contain multiple line geometries."}},default:"point","doc-en":"Label placement relative to its geometry.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels","doc-en":"Distance between two symbol anchors.",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,"doc-en":"If true, the symbols will not cross tile edges to avoid mutual collisions. Recommended in layers that don't have enough padding in the vector tile to prevent collisions, or if it is a point symbol layer placed after a line symbol layer.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number","doc-en":"Sorts features in ascending order based on this value. Features with lower sort keys are drawn and placed first.  When `icon-allow-overlap` or `text-allow-overlap` is `false`, features with a lower sort key will have priority during placement. When `icon-allow-overlap` or `text-allow-overlap` is set to `true`, features with a higher sort key will overlap over features with a lower sort key.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{"doc-en":"Sorts symbols by `symbol-sort-key` if set. Otherwise, sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},"viewport-y":{"doc-en":"Sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},source:{"doc-en":"Sorts symbols by `symbol-sort-key` if set. Otherwise, no sorting is applied; symbols are rendered in the same order as the source data."}},default:"auto","doc-en":"Determines whether overlapping symbols in the same layer are rendered in the order that they appear in the data source or by their y-position relative to the viewport. To control the order and prioritization of symbols otherwise, use `symbol-sort-key`.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-height-key":{type:"string",default:"symbolHeight","property-type":"constant"},"symbol-height-offset":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-pick-color":{type:"boolean",default:!1,"doc-en":"If you want to query a symbol with height properties, set it true, otherwise the result won't be accurate. Set it to false when all symbols are rendered by zero height.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,"doc-en":"If true, the icon will be visible even if it collides with other previously drawn symbols.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,"doc-en":"If true, other symbols can be visible even if they collide with the icon.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,"doc-en":"If true, text will display without their corresponding icons when the icon collides with other symbols and the text does not.",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{"doc-en":"When `symbol-placement` is set to `point`, aligns icons east-west. When `symbol-placement` is set to `line` or `line-center`, aligns icon x-axes with the line."},viewport:{"doc-en":"Produces icons whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{"doc-en":"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto","doc-en":"In combination with `symbol-placement`, determines the rotation behavior of icons.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size","doc-en":"Scales the original size of the icon by the provided factor. The new pixel size of the image will be the original pixel size multiplied by `icon-size`. 1 is the original size; 3 triples the size of the image.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{"doc-en":"The icon is displayed at its intrinsic aspect ratio."},width:{"doc-en":"The icon is scaled in the x-dimension to fit the width of the text."},height:{"doc-en":"The icon is scaled in the y-dimension to fit the height of the text."},both:{"doc-en":"The icon is scaled in both x- and y-dimensions."}},default:"none","doc-en":"Scales the icon to fit around the associated text.",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels","doc-en":"Size of the additional area added to dimensions determined by `icon-text-fit`, in clockwise order: top, right, bottom, left.",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage","doc-en":"Name of image in sprite to use for drawing an image background.",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees","doc-en":"Rotates the icon clockwise.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels","doc-en":"Size of the additional area around the icon bounding box used for detecting symbol collisions.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,"doc-en":"If true, the icon may be flipped to prevent it from being rendered upside-down.",requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],"doc-en":"Offset distance of icon from its anchor. Positive values indicate right and down, while negative values indicate left and up. Each component is multiplied by the value of `icon-size` to obtain the final offset in pixels. When combined with `icon-rotate` the offset will be as if the rotated direction was up.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{"doc-en":"The center of the icon is placed closest to the anchor."},left:{"doc-en":"The left side of the icon is placed closest to the anchor."},right:{"doc-en":"The right side of the icon is placed closest to the anchor."},top:{"doc-en":"The top of the icon is placed closest to the anchor."},bottom:{"doc-en":"The bottom of the icon is placed closest to the anchor."},"top-left":{"doc-en":"The top left corner of the icon is placed closest to the anchor."},"top-right":{"doc-en":"The top right corner of the icon is placed closest to the anchor."},"bottom-left":{"doc-en":"The bottom left corner of the icon is placed closest to the anchor."},"bottom-right":{"doc-en":"The bottom right corner of the icon is placed closest to the anchor."}},default:"center","doc-en":"Part of the icon placed closest to the anchor.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{"doc-en":"The icon is aligned to the plane of the map."},viewport:{"doc-en":"The icon is aligned to the plane of the viewport."},auto:{"doc-en":"Automatically matches the value of `icon-rotation-alignment`."}},default:"auto","doc-en":"Orientation of icon when map is pitched.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{"doc-en":"The text is aligned to the plane of the map."},viewport:{"doc-en":"The text is aligned to the plane of the viewport."},auto:{"doc-en":"Automatically matches the value of `text-rotation-alignment`."}},default:"auto","doc-en":"Orientation of text when map is pitched.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{"doc-en":"When `symbol-placement` is set to `point`, aligns text east-west. When `symbol-placement` is set to `line` or `line-center`, aligns text x-axes with the line."},viewport:{"doc-en":"Produces glyphs whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{"doc-en":"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto","doc-en":"In combination with `symbol-placement`, determines the rotation behavior of the individual glyphs forming the text.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,"doc-en":"Value to use for a text label. If a plain `string` is provided, it will be treated as a `formatted` with default/inherited formatting options.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],"doc-en":"Font stack to use for displaying text.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems","doc-en":"The maximum line width for text wrapping.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems","doc-en":"Text leading value for multi-line text.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!0},"text-letter-spacing":{type:"number",default:0,units:"ems","doc-en":"Text tracking amount.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{left:{"doc-en":"The text is aligned to the left."},center:{"doc-en":"The text is centered."},right:{"doc-en":"The text is aligned to the right."}},default:"center","doc-en":"Text justification options.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-anchor":{type:"enum",values:{center:{"doc-en":"The center of the text is placed closest to the anchor."},left:{"doc-en":"The left side of the text is placed closest to the anchor."},right:{"doc-en":"The right side of the text is placed closest to the anchor."},top:{"doc-en":"The top of the text is placed closest to the anchor."},bottom:{"doc-en":"The bottom of the text is placed closest to the anchor."},"top-left":{"doc-en":"The top left corner of the text is placed closest to the anchor."},"top-right":{"doc-en":"The top right corner of the text is placed closest to the anchor."},"bottom-left":{"doc-en":"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{"doc-en":"The bottom right corner of the text is placed closest to the anchor."}},default:"center","doc-en":"Part of the text placed closest to the anchor.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees","doc-en":"Maximum angle change between adjacent characters.",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees","doc-en":"Rotates the text clockwise.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels","doc-en":"Size of the additional area around the text bounding box used for detecting symbol collisions.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,"doc-en":"If true, the text may be flipped vertically to prevent it from being rendered upside-down.",requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{"doc-en":"The text is not altered."},uppercase:{"doc-en":"Forces all letters to be displayed in uppercase."},lowercase:{"doc-en":"Forces all letters to be displayed in lowercase."}},default:"none","doc-en":"Specifies how to capitalize text, similar to the CSS `text-transform` property.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array","doc-en":"Offset distance of text from its anchor. Positive values indicate right and down, while negative values indicate left and up. If used with text-variable-anchor, input values will be taken as absolute values. Offsets along the x- and y-axis will be applied automatically based on the anchor position.",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,"doc-en":"If true, the text will be visible even if it collides with other previously drawn symbols.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,"doc-en":"If true, other symbols can be visible even if they collide with the text.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,"doc-en":"If true, icons will display without their corresponding text when the text collides with other symbols and the icon does not.",requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number","doc-en":"基于此值按升序对要素排序。具有较高排序键的功能将显示在具有较低排序键的功能上方。",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"circle-height-key":{type:"string",default:"circleHeight","property-type":"constant"},visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"},"display-mode":{type:"enum",values:{"2d":{"doc-en":"The layer is 2d."},"3d":{"doc-en":"The layer is 3d."}},default:"2d","doc-en":"Whether this layer is 2d or 3d.","property-type":"constant"}},layout_extrusion:{visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"}},layout_histogram:{visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"},"histogram-max-height-render":{type:"boolean",default:!1,"doc-en":"If true, histogram's height * 100",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"histogram-color-render":{type:"boolean",default:!1,"doc-en":"If true, histogram's color becomes a single histogram longitudinal difference value rendering, use the 'histogram-colors' attribute in paint to render",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},layout_dynamicLine:{"dynamicLine-cap":{type:"enum",values:{butt:{"doc-en":"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{"doc-en":"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},square:{"doc-en":"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},default:"butt","doc-en":"The display of dynamicLine endings.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"dynamicLine-join":{type:"enum",values:{bevel:{"doc-en":"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},round:{"doc-en":"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},miter:{"doc-en":"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter","doc-en":"The display of dynamicLine when joining.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"dynamicLine-miter-limit":{type:"number",default:2,"doc-en":"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"dynamicLine-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"dynamicLine-round-limit":{type:"number",default:1.05,"doc-en":"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"dynamicLine-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"dynamicLine-sort-key":{type:"number","doc-en":"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"}},layout_tracking:{"tracking-cap":{type:"enum",values:{butt:{"doc-en":"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{"doc-en":"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},square:{"doc-en":"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},default:"butt","doc-en":"The display of line endings.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"tracking-join":{type:"enum",values:{bevel:{"doc-en":"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},round:{"doc-en":"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},miter:{"doc-en":"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter","doc-en":"The display of lines when joining.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"tracking-miter-limit":{type:"number",default:2,"doc-en":"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"tracking-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"tracking-round-limit":{type:"number",default:1.05,"doc-en":"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"tracking-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"tracking-sort-key":{type:"number","doc-en":"暂不生效。基于此值按升序对要素排序。具有较高排序键的功能将显示在具有较低排序键的功能上方。",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"},"tracking-display-mode":{type:"enum",function:"piecewise-constant",values:{loop:{},reverse:{},"loop-reserve":{},"reverse-reserve":{}},default:"loop","property-type":"data-constant"}},"layout_3d-model":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_3d-tiles":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symtracking:{"symtracking-display-mode":{type:"enum",function:"piecewise-constant",values:{default:{},"time-sequence":{},timestamp:{}},default:"default","property-type":"data-constant"},"symtracking-time-segment":{type:"number",default:20,minimum:1,units:"second","property-type":"constant"},"symtracking-fps":{type:"number",default:1,minimum:1,"property-type":"constant"},"symtracking-sort-key":{type:"number","doc-en":"Sorts features in ascending order based on this value. Features with lower sort keys are drawn and placed first.  When `icon-allow-overlap` or `text-allow-overlap` is `false`, features with a lower sort key will have priority during placement. When `icon-allow-overlap` or `text-allow-overlap` is set to `true`, features with a higher sort key will overlap over features with a lower sort key.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symtracking-z-order":{type:"enum",values:{auto:{"doc-en":"Sorts symbols by `symbol-sort-key` if set. Otherwise, sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},"viewport-y":{"doc-en":"Sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},source:{"doc-en":"Sorts symbols by `symbol-sort-key` if set. Otherwise, no sorting is applied; symbols are rendered in the same order as the source data."}},default:"auto","doc-en":"Determines whether overlapping symbols in the same layer are rendered in the order that they appear in the data source or by their y-position relative to the viewport. To control the order and prioritization of symbols otherwise, use `symbol-sort-key`.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"compatible-mode":{type:"boolean",default:!0,"property-type":"constant"},"symbol-placement":{type:"enum",values:{point:{"doc-en":"The label is placed at the point where the geometry is located."},line:{"doc-en":"The label is placed along the line of the geometry. Can only be used on `LineString` and `Polygon` geometries."},"line-center":{"doc-en":"The label is placed at the center of the line of the geometry. Can only be used on `LineString` and `Polygon` geometries. Note that a single feature in a vector tile may contain multiple line geometries."}},default:"point","doc-en":"Label placement relative to its geometry.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels","doc-en":"Distance between two symbol anchors.",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,"doc-en":"If true, the symbols will not cross tile edges to avoid mutual collisions. Recommended in layers that don't have enough padding in the vector tile to prevent collisions, or if it is a point symbol layer placed after a line symbol layer. When using a client that supports global collision detection, like minemap GL JS version 0.42.0 or greater, enabling this property is not needed to prevent clipped labels at tile boundaries.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-allow-overlap":{type:"boolean",default:!1,"doc-en":"If true, the icon will be visible even if it collides with other previously drawn symbols.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-ignore-placement":{type:"boolean",default:!1,"doc-en":"If true, other symbols can be visible even if they collide with the icon.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-optional":{type:"boolean",default:!1,"doc-en":"If true, text will display without their corresponding icons when the icon collides with other symbols and the text does not.",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-rotation-alignment":{type:"enum",values:{map:{"doc-en":"When `symbol-placement` is set to `point`, aligns icons east-west. When `symbol-placement` is set to `line` or `line-center`, aligns icon x-axes with the line."},viewport:{"doc-en":"Produces icons whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{"doc-en":"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"map","doc-en":"In combination with `symbol-placement`, determines the rotation behavior of icons.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-size":{type:"number",default:1,minimum:0,units:"图标原始大小的倍数因子","units-en":"factor of the original icon size","doc-en":"Scales the original size of the icon by the provided factor. The new pixel size of the image will be the original pixel size multiplied by `icon-size`. 1 is the original size; 3 triples the size of the image.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{"doc-en":"The icon is displayed at its intrinsic aspect ratio."},width:{"doc-en":"The icon is scaled in the x-dimension to fit the width of the text."},height:{"doc-en":"The icon is scaled in the y-dimension to fit the height of the text."},both:{"doc-en":"The icon is scaled in both x- and y-dimensions."}},default:"none","doc-en":"Scales the icon to fit around the associated text.",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels","doc-en":"Size of the additional area added to dimensions determined by `icon-text-fit`, in clockwise order: top, right, bottom, left.",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-image":{type:"resolvedImage","doc-en":"Name of image in sprite to use for drawing an image background.",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees","doc-en":"Rotates the icon clockwise.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels","doc-en":"Size of the additional area around the icon bounding box used for detecting symbol collisions.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-keep-upright":{type:"boolean",default:!1,"doc-en":"If true, the icon may be flipped to prevent it from being rendered upside-down.",requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],"doc-en":"Offset distance of icon from its anchor. Positive values indicate right and down, while negative values indicate left and up. Each component is multiplied by the value of `icon-size` to obtain the final offset in pixels. When combined with `icon-rotate` the offset will be as if the rotated direction was up.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{"doc-en":"The center of the icon is placed closest to the anchor."},left:{"doc-en":"The left side of the icon is placed closest to the anchor."},right:{"doc-en":"The right side of the icon is placed closest to the anchor."},top:{"doc-en":"The top of the icon is placed closest to the anchor."},bottom:{"doc-en":"The bottom of the icon is placed closest to the anchor."},"top-left":{"doc-en":"The top left corner of the icon is placed closest to the anchor."},"top-right":{"doc-en":"The top right corner of the icon is placed closest to the anchor."},"bottom-left":{"doc-en":"The bottom left corner of the icon is placed closest to the anchor."},"bottom-right":{"doc-en":"The bottom right corner of the icon is placed closest to the anchor."}},default:"center","doc-en":"Part of the icon placed closest to the anchor.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"icon-pitch-alignment":{type:"enum",values:{map:{"doc-en":"The icon is aligned to the plane of the map."},viewport:{"doc-en":"The icon is aligned to the plane of the viewport."},auto:{"doc-en":"Automatically matches the value of `icon-rotation-alignment`."}},default:"auto","doc-en":"Orientation of icon when map is pitched.",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-pitch-alignment":{type:"enum",values:{map:{"doc-en":"The text is aligned to the plane of the map."},viewport:{"doc-en":"The text is aligned to the plane of the viewport."},auto:{"doc-en":"Automatically matches the value of `text-rotation-alignment`."}},default:"auto","doc-en":"Orientation of text when map is pitched.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-rotation-alignment":{type:"enum",values:{map:{"doc-en":"When `symbol-placement` is set to `point`, aligns text east-west. When `symbol-placement` is set to `line` or `line-center`, aligns text x-axes with the line."},viewport:{"doc-en":"Produces glyphs whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{"doc-en":"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto","doc-en":"In combination with `symbol-placement`, determines the rotation behavior of the individual glyphs forming the text.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-field":{type:"string",default:"",tokens:!0,"doc-en":"Value to use for a text label.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],"doc-en":"Font stack to use for displaying text.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-size":{type:"number",default:16,minimum:0,units:"pixels","doc-en":"Font size.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-max-width":{type:"number",default:10,minimum:0,units:"ems","doc-en":"The maximum line width for text wrapping.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-line-height":{type:"number",default:1.2,units:"ems","doc-en":"Text leading value for multi-line text.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-letter-spacing":{type:"number",default:0,units:"ems","doc-en":"Text tracking amount.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-justify":{type:"enum",values:{left:{},center:{},right:{}},default:"center","doc-en":"Text justification options.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center","doc-en":"Part of the text placed closest to the anchor.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-max-angle":{type:"number",default:45,units:"degrees","doc-en":"Maximum angle change between adjacent characters.",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-rotate":{type:"number",default:0,period:360,units:"degrees","doc-en":"Rotates the text clockwise.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-padding":{type:"number",default:2,minimum:0,units:"pixels","doc-en":"Size of the additional area around the text bounding box used for detecting symbol collisions.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-keep-upright":{type:"boolean",default:!0,"doc-en":"If true, the text may be flipped vertically to prevent it from being rendered upside-down.",requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none","doc-en":"Specifies how to capitalize text, similar to the CSS `text-transform` property.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-offset":{type:"array","doc-en":"Offset distance of text from its anchor. Positive values indicate right and down, while negative values indicate left and up.",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven",expose:!1},"text-allow-overlap":{type:"boolean",default:!1,"doc-en":"If true, the text will be visible even if it collides with other previously drawn symbols.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-ignore-placement":{type:"boolean",default:!1,"doc-en":"If true, other symbols can be visible even if they collide with the text.",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-optional":{type:"boolean",default:!1,"doc-en":"If true, icons will display without their corresponding text when the text collides with other symbols and the icon does not.",requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{"doc-en":"The layer is shown."},none:{"doc-en":"The layer is not shown."}},default:"visible","doc-en":"Whether this layer is displayed.","property-type":"constant"}},filter:{type:"array",value:"*","doc-en":"A filter selects specific features from a layer."},filter_operator:{type:"enum",values:{"==":{},like:{},"!like":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},arrin:{},"!arrin":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{"doc-en":"Filter to point geometries."},LineString:{"doc-en":"Filter to line geometries."},Polygon:{"doc-en":"Filter to polygon geometries."}},"doc-en":"The geometry type for the filter to select."},function:{expression:{type:"expression","doc-en":"An expression."},stops:{type:"array","doc-en":"An array of stops.",value:"function_stop"},base:{type:"number",default:1,minimum:0,"doc-en":"The exponential base of the interpolation curve. It controls the rate at which the result increases. Higher values make the result increase more towards the high end of the range. With `1` the stops are interpolated linearly."},property:{type:"string","doc-en":"The name of a feature property to use as the function input.",default:"$zoom"},type:{type:"enum",values:{identity:{"doc-en":"Return the input value as the output value."},exponential:{"doc-en":"Generate an output by interpolating between stops just less than and just greater than the function input."},interval:{"doc-en":"Return the output value of the stop just less than the function input."},categorical:{"doc-en":"Return the output value of the stop equal to the function input."}},"doc-en":"The interpolation strategy to use in function evaluation.",default:"exponential"},colorSpace:{type:"enum",values:{rgb:{"doc-en":"Use the RGB color space to interpolate color values"},lab:{"doc-en":"Use the LAB color space to interpolate color values."},hcl:{"doc-en":"Use the HCL color space to interpolate color values, interpolating the Hue, Chroma, and Luminance channels individually."}},"doc-en":"The color space in which colors interpolated. Interpolating colors in perceptual color spaces like LAB and HCL tend to produce color ramps that look more consistent and produce colors that can be differentiated more easily than those interpolated in RGB space.",default:"rgb"},default:{type:"*",required:!1,"doc-en":"A value to serve as a fallback function result when a value isn't otherwise available. It is used in the following circumstances:\n* In categorical functions, when the feature value does not match any of the stop domain values.\n* In property and zoom-and-property functions, when a feature does not contain a value for the specified property.\n* In identity functions, when the feature value is not valid for the style property (for example, if the function is being used for a `circle-color` property but the feature property value is not a string or not a valid color).\n* In interval or exponential property and zoom-and-property functions, when the feature value is not numeric.\nIf no default is provided, the style property's default is used in these circumstances."}},function_stop:{type:"array",minimum:0,maximum:22,value:["number","color"],length:2,"doc-en":"Zoom level and value pair."},expression:{type:"array",value:"*",minimum:1,"doc-en":"An expression defines a function that can be used for data-driven style properties or feature filters."},paint:["paint_background","paint_fill","paint_line","paint_symbol","paint_circle","paint_heatmap","paint_raster","paint_extrusion","paint_histogram","paint_dynamicLine","paint_tracking","paint_sprite","paint_3d-model","paint_3d-tiles","paint_symtracking"],paint_background:{"background-color":{type:"color",default:"#000000","doc-en":"The color with which the background will be drawn.",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"string",transition:!0,"doc-en":"Name of image in sprite to use for drawing an image background. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-pattern-fixed":{type:"boolean",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,"doc-en":"The opacity at which the background will be drawn.",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-terrain-analysis":{type:"color","doc-en":"The color with which the slope or aspect of terrain will be drawn.",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_raster:{"raster-opacity":{type:"number","doc-en":"The opacity at which the image will be drawn.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees","doc-en":"Rotates hues around the color wheel.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number","doc-en":"Increase or reduce the brightness of the image. The value is the minimum brightness.",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number","doc-en":"Increase or reduce the brightness of the image. The value is the maximum brightness.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number","doc-en":"Increase or reduce the saturation of the image.",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number","doc-en":"Increase or reduce the contrast of the image.",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum","doc-en":"The resampling/interpolation method to use for overscaling, also known as texture magnification filter",values:{linear:{"doc-en":"(Bi)linear filtering interpolates pixel values using the weighted average of the four closest original source pixels creating a smooth but blurry look when overscaled"},nearest:{"doc-en":"Nearest neighbor filtering interpolates pixel values using the nearest original source pixel creating a sharp but pixelated look when overscaled"}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds","doc-en":"Fade duration when a new tile is added.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_fill:{"fill-antialias":{type:"boolean",default:!0,"doc-en":"Whether or not the fill should be antialiased.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,"doc-en":"The opacity of the entire fill layer. In contrast to the `fill-color`, this value will also affect the 1px stroke around the fill, if the stroke is used.",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-water-texture":{type:"string",default:"","doc-en":"Texture object url link","property-type":"data-constant",requires:[{"fill-water":"water"}]},"fill-water-speed":{type:"number",default:1,"doc-en":"The speed of water","property-type":"data-constant",requires:[{"fill-water":"water"}]},"fill-water-wave-size":{type:"number",default:1,"doc-en":"Describe the speed of water ripples","property-type":"data-constant",requires:[{"fill-water":"water"}]},"sunlight-color":{type:"color",default:"#76ca17","property-type":"data-constant",requires:[{"fill-water":"water"}]},"sunlight-direction":{type:"array",value:"number",length:3,default:[1,1.0349,-.0994],"property-type":"data-constant",requires:[{"fill-water":"water"}]},"sky-color":{type:"color",default:"#ffffff","property-type":"data-constant",requires:[{"fill-water":"water"}]},"fill-color":{type:"color",default:"#000000","doc-en":"The color of the filled part of this layer. This color can be specified as `rgba` with an alpha component and the color's opacity will not affect the opacity of the 1px stroke, if it is used.",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven",expose:!1},"fill-outline-color":{type:"color","doc-en":"The outline color of the fill. Matches the value of `fill-color` if unspecified.",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-driven",expose:!1},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},"doc-en":"Controls the frame of reference for `fill-translate`.",default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-driven"},"fill-pattern":{type:"resolvedImage",transition:!0,"doc-en":"Name of image in sprite to use for drawing image fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-water":{type:"string",default:"none","doc-en":"Whether it is water ripple","property-type":"data-constant"},"fill-dynamic-speed":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven",requires:[{"fill-water":"water"}]},"fill-dynamic-image-url":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded",requires:[{"fill-water":"water"}]},"fill-offset":{type:"array",value:"number",length:2,default:[0,0],units:"pixels","doc-en":"The offset of the fill pattern. Values are [x, y]","property-type":"data-driven",requires:["fill-pattern"]},"fill-rotation":{type:"number",default:0,units:"degrees","doc-en":"The rotation of the fill pattern in degrees counter-clockwise","property-type":"data-driven",requires:["fill-pattern"]},"fill-scale":{type:"number",default:1,"doc-en":"The scale of the fill pattern","property-type":"data-driven",requires:["fill-pattern"]}},paint_line:{"line-opacity":{type:"number","doc-en":"The opacity at which the line will be drawn.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color","doc-en":"The color with which the line will be drawn.",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-driven"},"line-translate-anchor":{type:"enum",values:{map:{"doc-en":"The line is translated relative to the map."},viewport:{"doc-en":"The line is translated relative to the viewport."}},"doc-en":"Controls the frame of reference for `line-translate`.",default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-driven"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels","doc-en":"Stroke thickness.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-width":{type:"number",default:0,minimum:0,function:"interpolated",transition:!0,units:"pixels","doc-en":"Border stroke thickness.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},requires:[{"!":"line-pattern"}],"property-type":"data-driven"},"line-border-opacity":{type:"number","doc-en":"The opacity at which the line border will be drawn.",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},default:1,minimum:0,maximum:1,transition:!0,requires:[{"!":"line-pattern"}],"property-type":"data-driven"},"line-border-color":{type:"color","doc-en":"The color with which the line border will be drawn.",default:"#000000",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},transition:!0,requires:[{"!":"line-pattern"}],"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,"doc-en":"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,"doc-en":"The line's offset. For linear features, a positive value offsets the line to the right, relative to the direction of the line, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.",transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Blur applied to the line, in pixels.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number","doc-en":"Specifies the lengths of the alternating dashes and gaps that form the dash pattern. The lengths are later scaled by the line width. To convert a dash length to pixels, multiply the length by the current line width. Note that GeoJSON sources with `lineMetrics: true` specified won't render dashed lines to the expected scale. Also note that zoom-dependent expressions will be evaluated only at integer zoom levels.",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,"doc-en":"Name of image in sprite to use for drawing image lines. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color","doc-en":'Defines a gradient with which to color a line feature. Can only be used with GeoJSON sources that specify `"lineMetrics": true`.',transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"},"half-render":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-normal-direction":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"}},paint_symbol:{"icon-opacity":{"doc-en":"The opacity at which the icon will be drawn.",type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,"doc-en":"The color of the icon. This can only be used with sdf icons.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,"doc-en":"The color of the icon's halo. Icon halos can only be used with SDF icons.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Distance of halo to the icon outline.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Fade out the halo towards the outside.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"Distance that the icon's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-driven"},"icon-translate-anchor":{type:"enum",values:{map:{"doc-en":"Icons are translated relative to the map."},viewport:{"doc-en":"Icons are translated relative to the viewport."}},"doc-en":"Controls the frame of reference for `icon-translate`.",default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number","doc-en":"The opacity at which the text will be drawn.",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color","doc-en":"The color with which the text will be drawn.",default:"#000000",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,"doc-en":"The color of the text's halo, which helps it stand out from backgrounds.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"The halo's fadeout distance towards the outside.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"Distance that the text's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-driven"},"text-translate-anchor":{type:"enum",values:{map:{"doc-en":"The text is translated relative to the map."},viewport:{"doc-en":"The text is translated relative to the viewport."}},"doc-en":"Controls the frame of reference for `text-translate`.",default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels","doc-en":"Circle radius.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000","doc-en":"The fill color of the circle.",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,"doc-en":"Amount to blur the circle. 1 blurs the circle such that only the centerpoint is full opacity.",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number","doc-en":"The opacity at which the circle will be drawn.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{"doc-en":"The circle is translated relative to the map."},viewport:{"doc-en":"The circle is translated relative to the viewport."}},"doc-en":"Controls the frame of reference for `circle-translate`.",default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{"doc-en":"Circles are scaled according to their apparent distance to the camera."},viewport:{"doc-en":"Circles are not scaled."}},default:"map","doc-en":"Controls the scaling behavior of the circle when the map is pitched.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{"doc-en":"The circle is aligned to the plane of the map."},viewport:{"doc-en":"The circle is aligned to the plane of the viewport."}},default:"viewport","doc-en":"Orientation of circle when map is pitched.",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"The width of the circle's stroke. Strokes are placed outside of the `circle-radius`.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000","doc-en":"The stroke color of the circle.",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number","doc-en":"The opacity of the circle's stroke.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-height":{type:"number",default:0,minimum:0,expression:{interpolated:!1,parameters:["zoom","feature","feature-state"]},"property-type":"constant"},"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels","doc-en":"Radius of influence of one heatmap point in pixels. Increasing the value makes the heatmap smoother, but less detailed.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,"doc-en":"A measure of how much an individual point contributes to the heatmap. A value of 10 would be equivalent to having 10 points of weight 1 in the same spot. Especially useful when combined with clustering.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,"doc-en":"Similar to `heatmap-weight` but controls the intensity of the heatmap globally. Primarily used for adjusting the heatmap based on zoom level.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],"doc-en":'Defines the color of each pixel based on its density value in a heatmap.  Should be an expression that uses `["heatmap-density"]` as input.',transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number","doc-en":"The global opacity at which the heatmap layer will be drawn.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-height-factor":{type:"number",default:100,minimum:0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-driven"}},paint_extrusion:{"extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,"doc-en":"The opacity of the entire fill extrusion layer. This is rendered on a per-layer, not per-feature, basis, and data-driven styling is not available.",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-driven"},"extrusion-color":{type:"color",default:"#000000","doc-en":"The base color of the extruded fill. The extrusion's surfaces will be shaded differently based on this color in combination with the root `light` settings.",transition:!0,requires:[{"!":"extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-driven"},"extrusion-translate-anchor":{type:"enum",values:{map:{"doc-en":"The fill-extrusion is translated relative to the map."},viewport:{"doc-en":"The fill-extrusion is translated relative to the viewport."}},"doc-en":"Controls the frame of reference for `extrusion-translate`.",default:"map",requires:["extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-driven"},"extrusion-pattern":{type:"resolvedImage",transition:!0,"doc-en":"Name of image in sprite to use for drawing images on extruded fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"extrusion-top-pattern":{type:"resolvedImage",transition:!1,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"extrusion-height":{type:"number",default:0,minimum:0,units:"meters","doc-en":"The height with which to extrude this layer.",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"extrusion-base":{type:"number",default:0,minimum:0,units:"meters","doc-en":"The height with which to extrude the base of this layer. Must be less than or equal to `extrusion-height`.",transition:!0,requires:["extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"extrusion-pattern-factor":{type:"array",value:"number",length:2,"property-type":"constant"},"extrusion-self-bloom":{type:"boolean",default:!1,"doc-en":"The  extrude  layer generate bloom by oneself.","property-type":"data-constant"},"extrusion-bloom-height":{type:"number",default:!1,"doc-en":"Maximum height of self illumination of building white mode","property-type":"data-constant"},"extrusion-glow-pure-color-height":{type:"number",default:.4,"doc-en":"building white mold height to control the building white mold gradient range.","property-type":"data-constant"},"extrusion-glow-width":{type:"number",default:.005,"doc-en":"width of building white mold refresh strip.","property-type":"data-constant"},"extrusion-glow-speed":{type:"number",default:12,"doc-en":"speed of building white strip refresh.","property-type":"data-constant"},"extrusion-roughness":{type:"number",default:0,minimum:0,maximum:1,"doc-en":"The roughness of the building white mold","property-type":"data-constant"},"extrusion-offset":{type:"array",value:"number",length:2,default:[0,0],units:"pixels","doc-en":"The offset of the extrusion pattern. Values are [x, y]","property-type":"data-driven"},"extrusion-rotation":{type:"number",default:0,units:"degrees","doc-en":"The rotation of the extrusion pattern","property-type":"data-driven"},"extrusion-scale":{type:"number",default:1,"doc-en":"The scale of the extrusion pattern","property-type":"data-driven"}},paint_histogram:{"histogram-opacity":{type:"number",default:1,minimum:0,maximum:1,"doc-en":"The opacity of the entire fill histogram layer. This is rendered on a per-layer, not per-feature, basis, and data-driven styling is not available.",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"histogram-color":{type:"color",default:"#000000","doc-en":"The base color of the extruded fill. The histogram's surfaces will be shaded differently based on this color in combination with the root `light` settings. If this color is specified as `rgba` with an alpha component, the alpha component will be ignored; use `extrusion-opacity` to set layer opacity.",transition:!0,requires:[{"!":"extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"histogram-colors":{type:"array",value:"string",length:5,default:["#ffc1e0","#bbffff","#00e3e3","#005757","#ea0000"],requires:[{"!":"histogram-color-render"}],"doc-en":"Histogram segmented color, this parameter has effect only when histogram-color-render is enabled.","property-type":"data-constant"},"histogram-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"The geometry's offset. Values are [x, y] where negatives indicate left and up (on the flat plane), respectively.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"histogram-translate-anchor":{type:"enum",values:{map:{},viewport:{}},"doc-en":"Controls the frame of reference for `extrusion-translate`.",default:"map",requires:["extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"histogram-height":{type:"number",default:0,minimum:0,units:"meters","doc-en":"The height with which to extrude this layer.",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"histogram-base":{type:"number",default:0,minimum:0,units:"meters","doc-en":"The height with which to extrude the base of this layer. Must be less than or equal to `extrusion-height`.",transition:!0,requires:["extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"histogram-vertical-gradient":{type:"boolean",default:!0,"doc-en":"Whether to apply a vertical gradient to the sides of a histogram layer. If true, sides will be shaded slightly darker farther down.",transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"histogram-dynamic":{type:"boolean",default:!1,"doc-en":"Whether to perform dynamic up and down rendering",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},expose:!1,"property-type":"data-constant"},"histogram-heightArr1":{type:"color",default:[0,0,0,0],"doc-en":"The first trajectory of dynamic histogram",transition:!0,units:"x-color",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},expose:!1,"property-type":"data-driven"},"histogram-heightArr2":{type:"color",default:[0,0,0,0],"doc-en":"The second trajectory of dynamic histogram",transition:!0,units:"x-color",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},expose:!1,"property-type":"data-driven"},"histogram-heightArr3":{type:"color",default:[0,0,0,0],"doc-en":"The third trajectory of dynamic histogram",transition:!0,units:"x-color",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},expose:!1,"property-type":"data-driven"},"histogram-speed":{type:"number","doc-en":"The speed of dynamic up and down rendering",default:1,minimum:1,maximum:1e3,transition:!0,"property-type":"data-constant"},"histogram-count":{type:"number",default:12,"doc-en":"The count of dynamic up and down rendering",minimum:1,maximum:12,units:"millisecond",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"histogram-max-height":{type:"number",default:200,minimum:0,units:"meters","doc-en":"The maximum height of the histogram, 'only effective when' histogram-color-render 'is turned on, When this value is identical with 'histostore-height', the column will be equally divided into 4 sections of colors from bottom to top according to the colors specified by 'histostore-colors'","property-type":"data-constant"},"depth-change":{type:"boolean",default:!1,transition:!0,"doc-en":"Turn on or off the transparency gradient from top to bottom",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-constant"}},paint_dynamicLine:{"dynamicLine-opacity":{type:"number","doc-en":"The opacity at which the dynamicLine will be drawn.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"dynamicLine-color":{type:"color","doc-en":"The color with which the dynamicLine will be drawn.",default:"#000000",transition:!0,requires:[{"!":"dynamicLine-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"dynamicLine-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels","doc-en":"Stroke thickness.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"dynamicLine-gap-width":{type:"number",default:0,minimum:0,"doc-en":"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven",expose:!1},"dynamicLine-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Blur applied to the line, in pixels.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"dynamicLine-seg-group":{type:"number","doc-en":"The number of displayed segments of the dynamicLine. When the value is 1, the dynamicLine displays only one segment. The larger the value, the more segments the dynamicLine displays",default:20,minimum:1,maximum:600,"property-type":"constant"},"dynamicLine-speed":{type:"number","doc-en":"The moving speed of dynamicLines, the higher the value, the faster the speed",default:1,minimum:1,maximum:500,"property-type":"constant"}},paint_tracking:{"tracking-opacity":{type:"number","doc-en":"The opacity at which the line will be drawn.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-color":{type:"color","doc-en":"The color with which the line will be drawn.",default:"#000000",transition:!0,requires:[{"!":"tracking-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"tracking-translate-anchor":{type:"enum",values:{map:{"doc-en":"The line is translated relative to the map."},viewport:{"doc-en":"The line is translated relative to the viewport."}},"doc-en":"Controls the frame of reference for `tracking-translate`.",default:"map",requires:["tracking-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"tracking-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels","doc-en":"Stroke thickness.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-gap-width":{type:"number",default:0,minimum:0,"doc-en":"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-offset":{type:"number",default:0,"doc-en":"The line's offset. For linear features, a positive value offsets the line to the right, relative to the direction of the line, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.",transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Blur applied to the line, in pixels.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-type":{type:"enum",function:"piecewise-constant",values:["real-time","history","trips"],default:"real-time","property-type":"constant"},"tracking-run-time":{type:"number",default:0,minimum:0,"property-type":"constant"},"tracking-seg-count":{type:"number",function:"interpolated",default:700,minimum:0,maximum:1e4,transition:!0,"property-type":"constant"},"tracking-seg-group":{type:"number",function:"interpolated",default:20,minimum:1,maximum:600,transition:!0,"property-type":"constant"},"tracking-speed":{type:"number",function:"interpolated",default:1,minimum:1,maximum:500,transition:!0,"property-type":"constant"},"tracking-delay":{type:"number",default:20,minimum:0,maximum:120,transition:!0,"property-type":"constant"},"tracking-speed-factor":{type:"number",default:1,minimum:0,function:"interpolated",transition:!0,units:"pixels","property-type":"constant"}},paint_sprite:{"sprite-opacity":{type:"number","doc-en":"The opacity at which the line will be drawn.",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-color":{type:"color","doc-en":"The color with which the line will be drawn.",default:"#000000",transition:!0,requires:[{"!":"sprite-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-driven"},"sprite-translate-anchor":{type:"enum",values:{map:{"doc-en":"The line is translated relative to the map."},viewport:{"doc-en":"The line is translated relative to the viewport."}},"doc-en":"Controls the frame of reference for `sprite-translate`.",default:"map",requires:["sprite-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-driven"},"sprite-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels","doc-en":"Stroke thickness.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-gap-width":{type:"number",default:0,minimum:0,"doc-en":"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-offset":{type:"number",default:0,"doc-en":"The line's offset. For linear features, a positive value offsets the line to the right, relative to the direction of the line, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.",transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Blur applied to the line, in pixels.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-speed-factor":{type:"number",default:1,minimum:1,maximum:4,transition:!0,"doc-en":"Play speed factor of sprite.",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-speed":{type:"number","doc-en":"Play speed of sprite.",default:60,minimum:1e-6,maximum:2e3,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-pattern":{type:"resolvedImage",transition:!0,"doc-en":"Name of image in sprite to use for drawing image lines. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"sprite-move-direction":{type:"number","doc-en":"The direction of Sprite when playing, the number 2 represents the starting point to the end point of road data, and the number 3 represents the starting point to the end point of road data",default:2,minimum:0,maximum:10,transition:!0,requires:["sprite-pattern"],expression:{interpolated:!1,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-interpolate":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"},"sprite-status":{type:"number",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},default:1,minimum:1,maximum:5,transition:!0,"property-type":"data-driven"},"sprite-instatus":{type:"number",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},default:1,minimum:1,maximum:5,transition:!0,"property-type":"data-driven"}},"paint_3d-model":{"3d-model-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},"paint_3d-tiles":{"point-cloud-color":{type:"color","doc-en":"The color with which the point cloud will be drawn.",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_symtracking:{"icon-opacity":{"doc-en":"The opacity at which the icon will be drawn.",type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,"doc-en":"The color of the icon. This can only be used with sdf icons.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,"doc-en":"The color of the icon's halo. Icon halos can only be used with SDF icons.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Distance of halo to the icon outline.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Fade out the halo towards the outside.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"Distance that the icon's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"icon-translate-anchor":{type:"enum",values:{map:{"doc-en":"Icons are translated relative to the map."},viewport:{"doc-en":"Icons are translated relative to the viewport."}},"doc-en":"Controls the frame of reference for `icon-translate`.",default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-opacity":{type:"number","doc-en":"The opacity at which the text will be drawn.",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven",expose:!1},"text-color":{type:"color","doc-en":"The color with which the text will be drawn.",default:"#000000",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven",expose:!1},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,"doc-en":"The color of the text's halo, which helps it stand out from backgrounds.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven",expose:!1},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven",expose:!1},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels","doc-en":"The halo's fadeout distance towards the outside.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven",expose:!1},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels","doc-en":"Distance that the text's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"text-translate-anchor":{type:"enum",values:{map:{"doc-en":"The text is translated relative to the map."},viewport:{"doc-en":"The text is translated relative to the viewport."}},"doc-en":"Controls the frame of reference for `text-translate`.",default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant",expose:!1},"symtracking-delay":{type:"number",default:10,minimum:0,maximum:120,"doc-en":"Motion icon update delay, which is the cycle interval time. If the value is 0, there is no interval for the animation cycle. If it is 5, the interval between animation cycles will be 5 seconds.","property-type":"constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds","doc-en":"Time allotted for transitions to complete."},delay:{type:"number",default:0,minimum:0,units:"milliseconds","doc-en":"Length of time before a transition begins."}},"property-type":{"data-driven":{type:"property-type","doc-en":"Property is interpolable and can be represented using a property expression."},"cross-faded":{type:"property-type","doc-en":"Property is non-interpolable; rather, its values will be cross-faded to smoothly transition between integer zooms."},"cross-faded-data-driven":{type:"property-type","doc-en":"Property is non-interpolable; rather, its values will be cross-faded to smoothly transition between integer zooms. It can be represented using a property expression."},"color-ramp":{type:"property-type","doc-en":"Property should be specified using a color ramp from which the output color can be sampled based on a property calculation."},"data-constant":{type:"property-type","doc-en":"Property is interpolable but cannot be represented using a property expression."},constant:{type:"property-type","doc-en":"Property is constant across all zoom levels and property values."}},promoteId:{"*":{type:"string"}}};const Yg=new qp({"symbol-placement":new kp(Hg.layout_symbol["symbol-placement"]),"symbol-spacing":new kp(Hg.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new kp(Hg.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Up(Hg.layout_symbol["symbol-sort-key"]),"symbol-z-order":new kp(Hg.layout_symbol["symbol-z-order"]),"symbol-height-key":new kp(Hg.layout_symbol["symbol-height-key"]),"symbol-height-offset":new Up(Hg.layout_symbol["symbol-height-offset"]),"symbol-pick-color":new kp(Hg.layout_symbol["symbol-pick-color"]),"icon-allow-overlap":new kp(Hg.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new kp(Hg.layout_symbol["icon-ignore-placement"]),"icon-optional":new kp(Hg.layout_symbol["icon-optional"]),"icon-rotation-alignment":new kp(Hg.layout_symbol["icon-rotation-alignment"]),"icon-size":new Up(Hg.layout_symbol["icon-size"]),"icon-text-fit":new kp(Hg.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new kp(Hg.layout_symbol["icon-text-fit-padding"]),"icon-image":new Up(Hg.layout_symbol["icon-image"]),"icon-rotate":new Up(Hg.layout_symbol["icon-rotate"]),"icon-padding":new kp(Hg.layout_symbol["icon-padding"]),"icon-keep-upright":new kp(Hg.layout_symbol["icon-keep-upright"]),"icon-offset":new Up(Hg.layout_symbol["icon-offset"]),"icon-anchor":new Up(Hg.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new kp(Hg.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new kp(Hg.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new kp(Hg.layout_symbol["text-rotation-alignment"]),"text-field":new Up(Hg.layout_symbol["text-field"]),"text-font":new Up(Hg.layout_symbol["text-font"]),"text-size":new Up(Hg.layout_symbol["text-size"]),"text-max-width":new Up(Hg.layout_symbol["text-max-width"]),"text-line-height":new kp(Hg.layout_symbol["text-line-height"]),"text-letter-spacing":new Up(Hg.layout_symbol["text-letter-spacing"]),"text-justify":new Up(Hg.layout_symbol["text-justify"]),"text-anchor":new Up(Hg.layout_symbol["text-anchor"]),"text-max-angle":new kp(Hg.layout_symbol["text-max-angle"]),"text-rotate":new Up(Hg.layout_symbol["text-rotate"]),"text-padding":new kp(Hg.layout_symbol["text-padding"]),"text-keep-upright":new kp(Hg.layout_symbol["text-keep-upright"]),"text-transform":new Up(Hg.layout_symbol["text-transform"]),"text-offset":new Up(Hg.layout_symbol["text-offset"]),"text-allow-overlap":new kp(Hg.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new kp(Hg.layout_symbol["text-ignore-placement"]),"text-optional":new kp(Hg.layout_symbol["text-optional"])});var qg={paint:new qp({"icon-opacity":new Up(Hg.paint_symbol["icon-opacity"]),"icon-color":new Up(Hg.paint_symbol["icon-color"]),"icon-halo-color":new Up(Hg.paint_symbol["icon-halo-color"]),"icon-halo-width":new Up(Hg.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Up(Hg.paint_symbol["icon-halo-blur"]),"icon-translate":new Up(Hg.paint_symbol["icon-translate"]),"icon-translate-anchor":new kp(Hg.paint_symbol["icon-translate-anchor"]),"text-opacity":new Up(Hg.paint_symbol["text-opacity"]),"text-color":new Up(Hg.paint_symbol["text-color"]),"text-halo-color":new Up(Hg.paint_symbol["text-halo-color"]),"text-halo-width":new Up(Hg.paint_symbol["text-halo-width"]),"text-halo-blur":new Up(Hg.paint_symbol["text-halo-blur"]),"text-translate":new Up(Hg.paint_symbol["text-translate"]),"text-translate-anchor":new kp(Hg.paint_symbol["text-translate-anchor"])}),layout:Yg};const Xg=bi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_offset",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_extra",components:3,type:"Uint16"}]),Wg=bi([{name:"a_CARTESIAN",components:3,type:"Float32"},{name:"a_projected_pos",components:3,type:"Float32"}],4);bi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const jg=bi([{name:"a_placed",components:2,type:"Uint8"}],4);bi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]);const $g=bi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Zg=bi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);bi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"hidden"}]),bi([{type:"Float32",name:"offsetX"}]),bi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Kg=Ng.VectorTileFeature.types,Qg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Jg(e,t,i,n,r,o,a,s,l,u){e.emplaceBack(t.x,t.y,t.z,Math.round(32*i),Math.round(32*n),r,o,a?a[0]:0,a?a[1]:0,s,l,u||0);}class ey{constructor(e){this.layoutVertexArray=new Fa,this.indexArray=new Ba,this.programConfigurations=e,this.segments=new ep,this.dynamicLayoutVertexArray=new ca,this.opacityVertexArray=new Ca,this.placedSymbolArray=new qa;}upload(e,t,i,n){i&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Wg.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Qg,!0),this.opacityVertexBuffer.itemSize=1),(i||n)&&this.programConfigurations.upload(e);}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy());}}$o("SphereSymtrackingBuffers",ey);class ty{constructor(e,t,i){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new i,this.segments=new ep,this.collisionVertexArray=new Ia;}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,jg.members,!0);}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy());}}$o("SphereSymtrackingCollisionBuffers",ty);class iy{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasRTLText=!1,this.glyphQuadsArray=[],this.symbolHeightsArray=[],this.type=Dg.SYMTRACKING;const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=dg(this.zoom,t["text-size"]),this.iconSizeData=dg(this.zoom,t["icon-size"]);const i=this.layers[0].layout;this.sortFeaturesByY=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sourceID=e.sourceID,this.projection=e.projection||mi.MERCATOR;}createArrays(){this.text=new ey(new gf(Xg.members,this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new ey(new gf(Xg.members,this.layers,this.zoom,(e=>/^icon/.test(e)))),this.collisionBox=new ty(Da,$g.members,ka),this.collisionCircle=new ty(Da,Zg.members,Ba),this.glyphOffsetArray=new Wa,this.lineVertexArray=new $a;}calculateGlyphDependencies(e,t,i,n){for(let r=0;r<e.length;r++)if(t[e.charCodeAt(r)]=!0,i&&n){const i=Rg[e.charAt(r)];i&&(t[i.charCodeAt(0)]=!0);}}populate(e,t,i){this.baseP||(this.x=t.x,this.y=t.y,this.z=t.z,this.zPow=Math.pow(2,this.z),this.baseP=Nl(this.x,this.y,this.z,this.projection),this.matrix=Rl(this.baseP));const n=this.layers[0],r=n.layout,o=r.get("text-font"),a=r.get("text-field"),s=r.get("icon-image"),l=("constant"!==a.value.kind||a.value.value.toString().length>0)&&("constant"!==o.value.kind||o.value.value.length>0),u="constant"!==s.value.kind||s.value.value&&s.value.value.length>0;if(this.features=[],!l&&!u)return;const c=t.iconDependencies,h=t.glyphDependencies,d=t.availableImages,p=new Lp(this.zoom);for(const{feature:t,index:a,sourceLayerIndex:s}of e){if(!n._featureFilter(p,t))continue;let e,f;if(l){const r=n.getValueAndResolveTokens("text-field",t,i,d),o=wn.factory(r);o.containsRTLText()&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Cp()||this.hasRTLText&&Ip.isParsed())&&(e=Tg(o,n,t));}if(u){const e=n.getValueAndResolveTokens("icon-image",t,i,d);f=e instanceof Tn?e:Tn.fromString(e);}if(!e&&!f)continue;const m={text:e,icon:f,index:a,sourceLayerIndex:s,geometry:Sg(t),properties:t.properties,type:Kg[t.type]};if(void 0!==t.id&&(m.id=t.id),this.features.push(m),f&&f instanceof Tn&&(c[f.name]=!0),e){const i=o.evaluate(t,{}).join(","),n=h[i]=h[i]||{},a="map"===r.get("text-rotation-alignment")&&"point"!==r.get("symbol-placement");if(e instanceof wn)for(const t of e.sections){const n=pn(e.toString()),r=t.fontStack||i,o=h[r]=h[r]||{};this.calculateGlyphDependencies(t.text,o,a,n);}else {const t=pn(e);this.calculateGlyphDependencies(e,n,a,t);}}}"line"===r.get("symbol-placement")&&(this.features=bg(this.features));}update(e,t){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers));}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return !this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){this.uploaded||(this.collisionBox.upload(e),this.collisionCircle.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0;}destroy(){this.text.destroy(),this.icon.destroy(),this.collisionBox.destroy(),this.collisionCircle.destroy();}addToLineVertexArray(e,t){const i=this.lineVertexArray.length;if(void 0!==e.segment){let i=e.dist(t[e.segment+1]),n=e.dist(t[e.segment]);const r={};for(let n=e.segment+1;n<t.length;n++)r[n]={x:t[n].x,y:t[n].y,tileUnitDistanceFromAnchor:i},n<t.length-1&&(i+=t[n+1].dist(t[n]));for(let i=e.segment||0;i>=0;i--)r[i]={x:t[i].x,y:t[i].y,tileUnitDistanceFromAnchor:n},i>0&&(n+=t[i-1].dist(t[i]));for(let e=0;e<t.length;e++){const t=r[e];this.lineVertexArray.emplaceBack(t.x,t.y,t.tileUnitDistanceFromAnchor);}}return {lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(e,t,i,n,r,o,a,s,l,u,c){const h=e.indexArray,d=e.layoutVertexArray,p=e.dynamicLayoutVertexArray,f=e.segments.prepareSegment(4*t.length,e.layoutVertexArray,e.indexArray),m=this.glyphOffsetArray.length,_=f.vertexLength;for(const e of t){const t=e.tl,n=e.tr,r=e.bl,a=e.br,l=e.tex,u=f.vertexLength,c=e.glyphOffset[1],m=this.calcTDSpacePoint(s.x,s.y),_=o.properties;let g,y,x;_.hasOwnProperty("link_seq")?(g=_.link_seq,y=_.link_total||0,x=0):_.hasOwnProperty("link_time")&&(g=_.link_time%1e4,y=_.link_time_before%1e4,x=_.link_time_end%1e4,this.timestampExtraData||(this.timestampExtraData={total_time_end:_.total_time_end%1e4,total_time_start:_.total_time_start%1e4})),Jg(d,m,t.x,c+t.y,l.x,l.y,i,g,y,x),Jg(d,m,n.x,c+n.y,l.x+l.w,l.y,i,g,y,x),Jg(d,m,r.x,c+r.y,l.x,l.y+l.h,i,g,y,x),Jg(d,m,a.x,c+a.y,l.x+l.w,l.y+l.h,i,g,y,x);const v=[[32*t.x,32*(c+t.y)],[32*n.x,32*(c+n.y)],[32*r.x,32*(c+r.y)],[32*a.x,32*(c+a.y)]];Vg(p,s,0,s,1,[this.x,this.y,this.z],v,this.projection,this.z,this.baseP,0),h.emplaceBack(u,u+1,u+2),h.emplaceBack(u+1,u+2,u+3),f.vertexLength+=4,f.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(e.glyphOffset[0]),this.glyphQuadsArray.push(v),this.symbolHeightsArray.push(0);}e.placedSymbolArray.emplaceBack(s.x,s.y,m,this.glyphOffsetArray.length-m,_,l,u,s.segment,i?i[0]:0,i?i[1]:0,n[0],n[1],a,!1),e.programConfigurations.populatePaintArrays(e.layoutVertexArray.length,o,o.index,{},c);}_addCollisionDebugVertex(e,t,i,n,r){return t.emplaceBack(0,0),e.emplaceBack(i.x,i.y,i.z,n.x,n.y,Math.round(r.x),Math.round(r.y))}addCollisionDebugVertices(e,t,i,n,r,o,a,s){const l=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),u=l.vertexLength,c=r.layoutVertexArray,h=r.collisionVertexArray,d=this.calcTDSpacePoint(o.x,o.y);if(this._addCollisionDebugVertex(c,h,d,a.anchor,new te(e,t)),this._addCollisionDebugVertex(c,h,d,a.anchor,new te(i,t)),this._addCollisionDebugVertex(c,h,d,a.anchor,new te(i,n)),this._addCollisionDebugVertex(c,h,d,a.anchor,new te(e,n)),l.vertexLength+=4,s){const e=r.indexArray;e.emplaceBack(u,u+1,u+2),e.emplaceBack(u,u+2,u+3),l.primitiveLength+=2;}else {const e=r.indexArray;e.emplaceBack(u,u+1),e.emplaceBack(u+1,u+2),e.emplaceBack(u+2,u+3),e.emplaceBack(u+3,u),l.primitiveLength+=4;}}generateCollisionDebugBuffers(){for(const e of this.symbolInstances){e.textCollisionFeature={boxStartIndex:e.textBoxStartIndex,boxEndIndex:e.textBoxEndIndex},e.iconCollisionFeature={boxStartIndex:e.iconBoxStartIndex,boxEndIndex:e.iconBoxEndIndex};for(let t=0;t<2;t++){const i=e[0===t?"textCollisionFeature":"iconCollisionFeature"];if(i)for(let t=i.boxStartIndex;t<i.boxEndIndex;t++){const i=this.collisionBoxArray.get(t),n=i.radius>0;this.addCollisionDebugVertices(i.x1,i.y1,i.x2,i.y2,n?this.collisionCircle:this.collisionBox,i.anchorPoint,e,n);}}}}deserializeCollisionBoxes(e,t,i,n,r){const o={};for(let n=t;n<i;n++){const t=e.get(n);if(0===t.radius){o.textBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,anchorPointX:t.anchorPointX,anchorPointY:t.anchorPointY},o.textFeatureIndex=t.featureIndex;break}o.textCircles||(o.textCircles=[],o.textFeatureIndex=t.featureIndex),o.textCircles.push(t.anchorPointX,t.anchorPointY,t.radius,t.signedDistanceFromAnchor,1);}for(let t=n;t<r;t++){const i=e.get(t);if(0===i.radius){o.iconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},o.iconFeatureIndex=i.featureIndex;break}}return o}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasCollisionBoxData(){return this.collisionBox.segments.get().length>0}hasCollisionCircleData(){return this.collisionCircle.segments.get().length>0}sortFeatures(e){if(!this.sortFeaturesByY)return;if(this.sortedAngle===e)return;if(this.sortedAngle=e,this.text.segments.get().length>1||this.icon.segments.get().length>1)return;const t=[];for(let e=0;e<this.symbolInstances.length;e++)t.push(e);const i=Math.sin(e),n=Math.cos(e);t.sort(((e,t)=>{const r=this.symbolInstances[e],o=this.symbolInstances[t];return (0|Math.round(i*r.anchor.x+n*r.anchor.y))-(0|Math.round(i*o.anchor.x+n*o.anchor.y))||o.featureIndex-r.featureIndex})),this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of t){const t=this.symbolInstances[e];this.featureSortOrder.push(t.featureIndex);for(const e of t.placedTextSymbolIndices){const t=this.text.placedSymbolArray.get(e),i=t.vertexStartIndex+4*t.numGlyphs;for(let e=t.vertexStartIndex;e<i;e+=4)this.text.indexArray.emplaceBack(e,e+1,e+2),this.text.indexArray.emplaceBack(e+1,e+2,e+3);}const i=this.icon.placedSymbolArray.get(e);if(i.numGlyphs){const e=i.vertexStartIndex;this.icon.indexArray.emplaceBack(e,e+1,e+2),this.icon.indexArray.emplaceBack(e+1,e+2,e+3);}}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray);}calcTDSpacePoint(e,t){const i=Ll(this.x+e/8192,this.y+t/8192,this.zPow,this.projection),n=Nu.cartographicToCartesian3([i[0],i[1],0]);return new te(n[0]-this.baseP[0],n[1]-this.baseP[1],n[2]-this.baseP[2])}}$o("SymtrackingBucket",iy,{omit:["layers","collisionBoxArray","features","compareText"],shallow:["symbolInstances","matrix"]}),iy.addDynamicAttributes=Vg;const ny={horizontal:1,vertical:2,horizontalOnly:3};class ry{constructor(){this.text="",this.sectionIndex=[],this.sections=[];}static fromFeature(e,t){const i=new ry;if(e instanceof wn)for(let n=0;n<e.sections.length;n++){const r=e.sections[n];i.sections.push({scale:r.scale||1,fontStack:r.fontStack||t}),i.text+=r.text;for(let e=0;e<r.text.length;e++)i.sectionIndex.push(n);}else {i.text=e,i.sections.push({scale:1,fontStack:t});for(let t=0;t<e.length;t++)i.sectionIndex.push(0);}return i}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let t="";for(let i=0;i<e.length;i++){const n=e.charCodeAt(i+1)||null,r=e.charCodeAt(i-1)||null;t+=n&&_n(n)&&!Rg[e[i+1]]||r&&_n(r)&&!Rg[e[i-1]]||!Rg[e[i]]?e[i]:Rg[e[i]];}return t}(this.text);}trim(){let e=0;for(let t=0;t<this.text.length&&ay[this.text.charCodeAt(t)];t++)e++;let t=this.text.length;for(let i=this.text.length-1;i>=0&&i>=e&&ay[this.text.charCodeAt(i)];i--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t);}substring(e,t){const i=new ry;return i.text=this.text.substring(e,t),i.sectionIndex=this.sectionIndex.slice(e,t),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}}function oy(e,t){const i=[],n=e.text;let r=0;for(const n of t)i.push(e.substring(r,n)),r=n;return r<n.length&&i.push(e.substring(r,n.length)),i}const ay={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},sy={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function ly(e,t,i,n){const r=Math.pow(e-t,2);return n?e<t?r/2:2*r:r+Math.abs(i)*i}function uy(e,t){let i=0;return 10===e&&(i-=1e4),40!==e&&65288!==e||(i+=50),41!==t&&65289!==t||(i+=50),i}function cy(e,t,i,n,r,o){let a=null,s=ly(t,i,r,o);for(const e of n){const n=ly(t-e.x,i,r,o)+e.badness;n<=s&&(a=e,s=n);}return {index:e,x:t,priorBreak:a,badness:s}}function hy(e){return e?hy(e.priorBreak).concat(e.index):[]}function dy(e,t,i,n){if(!i)return [];if(!e)return [];const r=[],o=function(e,t,i,n){let r=0;for(let i=0;i<e.length();i++){const o=e.getSection(i),a=n[o.fontStack],s=a&&a[e.getCharCode(i)];s&&(r+=s.metrics.advance*o.scale+t);}return r/Math.max(1,Math.ceil(r/i))}(e,t,i,n);let a=0;for(let i=0;i<e.length();i++){const l=e.getSection(i),u=e.getCharCode(i),c=n[l.fontStack],h=c&&c[u];h&&!ay[u]&&(a+=h.metrics.advance*l.scale+t),i<e.length()-1&&(sy[u]||!((s=u)<11904)&&(dn["Bopomofo Extended"](s)||dn.Bopomofo(s)||dn["CJK Compatibility Forms"](s)||dn["CJK Compatibility Ideographs"](s)||dn["CJK Compatibility"](s)||dn["CJK Radicals Supplement"](s)||dn["CJK Strokes"](s)||dn["CJK Symbols and Punctuation"](s)||dn["CJK Unified Ideographs Extension A"](s)||dn["CJK Unified Ideographs"](s)||dn["Enclosed CJK Letters and Months"](s)||dn["Halfwidth and Fullwidth Forms"](s)||dn.Hiragana(s)||dn["Ideographic Description Characters"](s)||dn["Kangxi Radicals"](s)||dn["Katakana Phonetic Extensions"](s)||dn.Katakana(s)||dn["Vertical Forms"](s)||dn["Yi Radicals"](s)||dn["Yi Syllables"](s)))&&r.push(cy(i+1,a,o,r,uy(u,e.getCharCode(i+1)),!1));}var s;return hy(cy(e.length(),a,o,r,0,!0))}function py(e){let t=.5,i=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0;}switch(e){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0;}return {horizontalAlign:t,verticalAlign:i}}function fy(e,t,i,n,r){if(!r)return;const o=e[n],a=t[o.fontStack],s=a&&a[o.glyph];if(s){const t=(e[n].x+s.metrics.advance*o.scale)*r;for(let r=i;r<=n;r++)e[r].x-=t;}}const my=qg.layout;function _y(e,t,i,n,r){const o=new Bt;return t?(o.scale([1/r,1/r,1]),i||o.rotateZ(-n.getMapViewParams().bearing*ot.TRANSFORM.DEG_TO_RAD)):(o.scale([n.width/2,-n.height/2,1]),o.translate([1,-1,0]),o.multiplyRight(e)),o}function gy(e,t){const i=[e.x,e.y,0,1];Ey(i,i,t);const n=i[3];return {point:new te(i[0]/n,i[1]/n),signedDistanceFromCamera:n}}function yy(e,t){const i=e[0]/e[3],n=e[1]/e[3];return i>=-t[0]&&i<=t[0]&&n>=-t[1]&&n<=t[1]}function xy(e,t,i,n,r,o,a,s,l,u,c,h){const d=s.glyphStartIndex+s.numGlyphs,p=s.lineStartIndex,f=s.lineStartIndex+s.lineLength,m=t.getoffsetX(s.glyphStartIndex),_=t.getoffsetX(d-1),g=by(e*m,i,n,r,o,a,s.segment,p,f,l,u,c,h);if(!g)return null;const y=by(e*_,i,n,r,o,a,s.segment,p,f,l,u,c,h);return y?{first:g,last:y}:null}function vy(e,t,i,n){return e===ny.horizontal&&Math.abs(i.y-t.y)>Math.abs(i.x-t.x)*n?{useVertical:!0}:(e===ny.vertical?t.y<i.y:t.x>i.x)?{needsFlipping:!0}:null}function wy(e,t,i,n,r,o,a,s,l,u,c,h,d,p,f,m,_,g,y){const x=t/24,v=e.lineOffsetX*t,w=e.lineOffsetY*t,T=[],b=[];let P;if(e.numGlyphs>1){const t=e.glyphStartIndex+e.numGlyphs,r=e.lineStartIndex,u=e.lineStartIndex+e.lineLength,f=xy(x,s,v,w,i,c,h,e,l,o,d,!1);if(!f)return {notEnoughRoom:!0};const m=gy(f.first.point,a).point,g=gy(f.last.point,a).point;if(n&&!i){const t=vy(e.writingMode,m,g,p);if(t)return t}P=[f.first],T.push(_[e.glyphStartIndex]),b.push(y[e.glyphStartIndex]);for(let n=e.glyphStartIndex+1;n<t-1;n++)P.push(by(x*s.getoffsetX(n),v,w,i,c,h,e.segment,r,u,l,o,d,!1)),T.push(_[n]),b.push(y[n]);P.push(f.last),T.push(_[t-1]),b.push(y[t-1]);}else {if(n&&!i){const t=gy(h,r).point,i=e.lineStartIndex+e.segment+1,n=new te(l.getx(i),l.gety(i)),o=gy(n,r),a=o.signedDistanceFromCamera>0?o.point:Ty(h,n,t,1,r),s=vy(e.writingMode,t,a,p);if(s)return s}const t=by(x*s.getoffsetX(e.glyphStartIndex),v,w,i,c,h,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,l,o,d,!1);if(!t)return {notEnoughRoom:!0};P=[t],T.push(_[e.glyphStartIndex]),b.push(y[e.glyphStartIndex]);}for(let e=0;e<P.length;e++){const i=P[e];Vg(u,i.point,i.angle,i.anchorPoint,t/15/f.height*822,m,T[e],f.projection,f.zoom,f.cameraHeightConvertedZoom,g,b[e]);}return {}}function Ty(e,t,i,n,r){const o=gy(e.add(e.sub(t)._unit()),r).point,a=i.sub(o);return i.add(a._mult(n/a.mag()))}function by(e,t,i,n,r,o,a,s,l,u,c,h,d){const p=n?e-t:e+t;let f=p>0?1:-1,m=0;n&&(f*=-1,m=Math.PI),f<0&&(m+=Math.PI);let _=f>0?s+a:s+a+1;const g=_;let y=r,x=r,v=0,w=0;const T=Math.abs(p);for(;v+w<=T;){if(_+=f,_<s||_>=l)return null;if(x=y,y=h[_],void 0===y){const e=new te(u.getx(_),u.gety(_)),t=gy(e,c);if(t.signedDistanceFromCamera>0)y=h[_]=t.point;else {const t=_-f;y=Ty(0===v?o:new te(u.getx(t),u.gety(t)),e,x,T-v+1,c);}}v+=w,w=x.dist(y);}const b=(T-v)/w,P=y.sub(x),S=P.mult(b)._add(x);return S._add(P._unit()._perp()._mult(i*f)),{point:S,angle:m+Math.atan2(y.y-x.y,y.x-x.x),anchorPoint:r,tileDistance:d?{prevTileDistance:_-f===g?0:u.gettileUnitDistanceFromAnchor(_-f),lastSegmentViewportDistance:T-v}:null}}const Py=new Float64Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Sy(e,t){for(let i=0;i<e;i++){const e=t.length;t.resize(e+4),t.float32.set(Py,6*e);}}function Ey(e,t,i){const n=t[0],r=t[1];return e[0]=i[0]*n+i[4]*r+i[12],e[1]=i[1]*n+i[5]*r+i[13],e[3]=i[3]*n+i[7]*r+i[15],e}const Ay=qg.layout,Cy=new Ot,My=new Ot,Iy=new Ot;class Ly extends W_{tile=void 0;constructor(e){super(e),this.layer=e.layer,this.tile=e.tile,this.coord=e.tile.tileID,this._programConfiguration=e.programConfiguration,this._renderState=e.renderState,this.type=e.type,this.isText=e.isText,this.isSDF=e.isSDF,this.modeNum=e.modeNum,this.sizeData=e.sizeData,this.bucket=e.bucket,this.ishalo=!1,this.hasHalo=e.hasHalo,this.size=void 0,this.defines={SYM_TRACKING:"symtracking"===this.layer.type},this._createUniforms(e.painter);}updateDepthTest(){this.renderState.depthTest={enabled:this.layer.depthTest,func:Du.LESS};}update(e,t,i={}){super.update(e,t,i),this._updateDynamicUniform(e),this.updateDepthTest();}_createUniforms(e){this._uniforms.set("u_GlUnitsToPixels",(()=>(Cy.set(e.style.symbolMatrixHelper.width/2,-e.style.symbolMatrixHelper.height/2),Cy))),this.pushMinimumUniform("u_GlUnitsToPixels"),this._uniforms.set("u_pitch_with_map",(()=>this.isText?"map"==this.layer.layout.get("text-pitch-alignment"):"map"==this.layer.layout.get("icon-pitch-alignment"))),this.pushMinimumUniform("u_pitch_with_map"),this._uniforms.set("u_is_text",(()=>this.isText)),this.pushMinimumUniform("u_is_text"),this._uniforms.set("u_pitch",(()=>e.style.symbolMatrixHelper.getMapViewParams().pitch*ot.TRANSFORM.DEG_TO_RAD)),this.pushMinimumUniform("u_pitch"),this._uniforms.set("u_is_size_zoom_constant",(()=>"constant"===this.sizeData.functionType||"source"===this.sizeData.functionType)),this.pushMinimumUniform("u_is_size_zoom_constant"),this._uniforms.set("u_is_size_feature_constant",(()=>"constant"===this.sizeData.functionType||"camera"===this.sizeData.functionType)),this.pushMinimumUniform("u_is_size_feature_constant"),this._uniforms.set("u_camera_to_center_distance",(()=>e.style.symbolMatrixHelper.cameraToCenterDistance)),this._uniforms.set("u_aspect_ratio",(()=>e.style.symbolMatrixHelper.width/e.style.symbolMatrixHelper.height)),this._uniforms.set("u_rotate_symbol",(()=>{const e="map"===this.layer.layout.get("icon-rotation-alignment"),t="map"===this.layer.layout.get("icon-pitch-alignment"),i=e&&"point"!==this.layer.layout.get("symbol-placement");return e&&!t&&!i})),this.pushMinimumUniform("u_rotate_symbol"),this._uniforms.set("u_rotate_with_map",(()=>this.isText?"map"==this.layer.layout.get("text-rotation-alignment"):"map"==this.layer.layout.get("icon-rotation-alignment"))),this.pushMinimumUniform("u_rotate_with_map"),this.defines.HIDDEN_TERRAIN=this.layer.hiddenTerrain,this.layer.hiddenTerrain&&(this._uniforms.set("u_depth_texture",(()=>e.backgroundPass.framebuffer.depthStencilTexture)),this._uniforms.set("u_near_plane",(()=>e.transform.near)),this._uniforms.set("u_far_plane",(()=>e.transform.far))),this.defines.HIDDEN_FOG=this.layer.hiddenFog&&e._map.atmosphere,this.isText?(this._uniforms.set("u_BaseColorSampler",(()=>(this.tile.glyphAtlasTexture?.bind(Du.LINEAR,Du.CLAMP_TO_EDGE),this.tile.glyphAtlasTexture))),this._uniforms.set("u_texsize",(()=>{const e=this.tile.glyphAtlasTexture.size;return My.set(e[0],e[1]),My}))):(this._uniforms.set("u_BaseColorSampler",(()=>{const t=e.style.symbolMatrixHelper.getMapViewParams().pitch*ot.TRANSFORM.DEG_TO_RAD,i=1!==this.layer.layout.get("icon-size").constantOr(0)||this.bucket.iconsNeedLinear,n="map"===this.layer.layout.get("icon-pitch-alignment")||0!==t;return this.tile.imageAtlasTexture.bind(this.isSDF||e.options.rotating||e.options.zooming||i||n?Du.LINEAR:Du.NEAREST,Du.CLAMP_TO_EDGE),this.tile.imageAtlasTexture})),this._uniforms.set("u_texsize",(()=>{const e=this.tile.imageAtlasTexture.size;return My.set(e[0],e[1]),My}))),this.pushMinimumUniform("u_BaseColorSampler"),this.pushMinimumUniform("u_texsize"),this._uniforms.set("u_fade_change",(()=>e.options.fadeDuration?e.symbolFadeChange:1)),this.pushMinimumUniform("u_fade_change"),this._uniforms.set("u_is_halo",(()=>this.ishalo)),this.pushMinimumUniform("u_is_halo"),"symtracking"===this.layer.type&&(2==this.modeNum&&(this._uniforms.set("u_timestamp_se",(()=>{const e=this.bucket.timestampExtraData;return Iy.set(e.total_time_start,e.total_time_end),Iy})),this.pushMinimumUniform("u_timestamp_se")),this._uniforms.set("u_seq",(()=>this.layer._count?this.layer._count:0)),this.pushMinimumUniform("u_seq"),this._uniforms.set("u_display_mode",(()=>this.modeNum)),this.pushMinimumUniform("u_display_mode"));}_updateLineLabels(e){const t=this.isText?"map"==this.layer.layout.get("text-rotation-alignment"):"map"==this.layer.layout.get("icon-rotation-alignment"),i=hg(this.tile,1,e.style.symbolMatrixHelper.zoom),n=e.style.symbolMatrixHelper.calculatePosMatrix(this.tile.tileID.toUnwrapped()),r=_y(n,!0,t,e.style.symbolMatrixHelper,i),o=function(e,t,i,n,r){const o=new Bt;return o.multiplyRight(e),o.scale([r,r,1]),i||o.rotateZ(n.getMapViewParams().bearing*ot.TRANSFORM.DEG_TO_RAD),o}(n,0,t,e.style.symbolMatrixHelper,i);!function(e,t,i,n,r,o,a,s){const l=n?e.textSizeData:e.iconSizeData,u=fg(l,i.style.getNearestTileZoom(),my&&my.properties&&my.properties[n?"text-size":"icon-size"]),c=[256/i.width*2+1,256/i.height*2+1],h=n?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;h.clear();const d=e.lineVertexArray,p=n?e.text.placedSymbolArray:e.icon.placedSymbolArray,f=e.glyphQuadsArray,m=e.symbolHeightsArray,_=i.style.symbolMatrixHelper.width/i.style.symbolMatrixHelper.height;let g=!1;for(let n=0;n<p.length;n++){const a=p.get(n);if(a.hidden||a.writingMode===ny.vertical&&!g){Sy(a.numGlyphs,h);continue}g=!1;const y=new St([a.anchorX,a.anchorY,0,1]);if(y.transform(t),!yy(y,c)){Sy(a.numGlyphs,h);continue}const x=pg(l,u,a),v=new te(a.anchorX,a.anchorY),w=gy(v,r).point,T={},b=wy(a,x,!1,s,t,r,o,e.glyphOffsetArray,d,h,w,v,T,_,i.style.symbolMatrixHelper,[e.x,e.y,e.z],f,e.baseP,m);g=b.useVertical,(b.notEnoughRoom||g||b.needsFlipping&&wy(a,x,!0,s,t,r,o,e.glyphOffsetArray,d,h,w,v,T,_,i.style.symbolMatrixHelper,[e.x,e.y,e.z],f,e.baseP,m).notEnoughRoom)&&Sy(a.numGlyphs,h);}n?e.text.dynamicLayoutVertexBuffer.updateData(h):e.icon.dynamicLayoutVertexBuffer.updateData(h);}(this.bucket,n,e,this.isText,r,o,0,this.layer.layout.get(this.isText?"text-keep-upright":"icon-keep-upright"));}_updateDynamicUniform(e){const t="map"===this.layer.layout.get("text-rotation-alignment")&&"point"!==this.layer.layout.get("symbol-placement"),i="map"===this.layer.layout.get("icon-rotation-alignment")&&"point"!==this.layer.layout.get("symbol-placement");this.isText?t&&this._updateLineLabels(e):i&&this._updateLineLabels(e),this._uniforms.set("u_along_line",(()=>this.isText?t:i)),this.pushMinimumUniform("u_along_line"),this.size=fg(this.sizeData,e.style.symbolMatrixHelper.zoom,Ay.properties[this.isText?"text-size":"icon-size"]),void 0!==this.size.uSizeT&&(this._uniforms.set("u_size_t",(()=>this.size.uSizeT)),this.pushMinimumUniform("u_size_t")),void 0!==this.size.uSize&&(this._uniforms.set("u_size",(()=>this.size.uSize)),this.pushMinimumUniform("u_size")),this.defines.HIDDEN_TERRAIN=this.layer.hiddenTerrain,this.layer.hiddenTerrain&&(this._uniforms.set("u_depth_texture",(()=>e.backgroundPass.framebuffer.depthStencilTexture)),this._uniforms.set("u_near_plane",(()=>e.transform.near)),this._uniforms.set("u_far_plane",(()=>e.transform.far))),this.defines.HIDDEN_FOG=this.layer.hiddenFog&&e._map.atmosphere;}destroy(){super.destroy(),this.tile=void 0,this.coord=void 0,this._programConfiguration=void 0,this.isText=void 0,this.isSDF=void 0,this.modeNum=void 0,this.sizeData=void 0,this.bucket=void 0;}static updateSymtrackingLayerProperty(e,t,i){const n=e.layout.get("symtracking-display-mode");if(n===at.SYMTRACKING_DISPLAY_MODE.DEFAULT){e._count=e._count?e._count:0,void 0===e.first&&(e.first=!0),e.startOffset=e.startOffset?e.startOffset:0,e.preFps=e.preFps?e.preFps:0,e.fpsDifference=e.fpsDifference?e.fpsDifference:0,e.fpsOffset=e.fpsOffset?e.fpsOffset:0,e.totalFpsOffset=e.totalFpsOffset?e.totalFpsOffset:0;const i=e.layout.get("symtracking-fps"),n=e.layout.get("symtracking-time-segment");e.offset=e.paint.get("symtracking-delay");const r=i*(n+e.offset);e.first&&(e.startOffset=t._map.timer.totalTime*i,e.first=!1,e.fpsFirst=i);const o=t._map.timer.totalTime;e.preFps&&e.preFps!==e.layout.get("symtracking-fps")&&(e.fpsDifference=e.layout.get("symtracking-fps")-e.preFps,e.fpsOffset=o*e.fpsDifference,e.totalFpsOffset+=e.fpsOffset),e.preFps=i,e._count=Math.round(o*i-e.startOffset-e.totalFpsOffset),e._count%=r;}let r=0;return n===at.SYMTRACKING_DISPLAY_MODE.DEFAULT?r=0:n===at.SYMTRACKING_DISPLAY_MODE.SEQUENCE?(r=1,e._count=Ly.calcSymTrackingInterval(i.getSource()._timestamp)):(r=2,e._count=Ly.calcSymTrackingTimeStamp(i.getSource()._timestamp)),r}static calcSymTrackingInterval(e){let t=(Date.now()-e)/1e3;return t>1?t=1:t<0&&(t=0),t}static calcSymTrackingTimeStamp(e){return Date.now()-e}}class Ny extends vl{constructor(e){super(),e.modelMatrix=Z(e.modelMatrix,new Bt),$(e.id)&&(this.customId=e.id),this.id=Z(e.id,Ge()),this.name=Z(e.name,void 0),this.skinsIndex=Z(e.skinsIndex,void 0),this.keepGeometryWhenFree=e.keepGeometryWhenFree,this._geometry=Z(e.geometry,void 0),this._material=Z(e.material,void 0),this.framebuffer=Z(e.framebuffer,void 0),this.properties=Z(e.properties,void 0),this.castShadow=Z(e.castShadow,void 0),this.receiveShadow=Z(e.receiveShadow,void 0),this.clearStates=Z(e.clearStates,void 0),this.nextShadowVolumePrimitiveIDs=[],this.usedVideoProjection=Z(e.usedVideoProjection,!1),this._adaptTerrain=Z(e.adaptTerrain,!1),this._classificationType=Z(e.classificationType,hp.NONE),this.classificationType=this._adaptTerrain||this._geometry.adaptTerrain?hp.ALL:e.classificationType||hp.NONE,this._rootId=null,this.pickId=void 0,this._owner=Z(e.owner,void 0),this.allowPick=Z(e.allowPick,void 0),this._show=Z(e.show,!0),this._visible=Z(e.visible,!0),this.state=_d.UNPROCESSING,this._filterPassIds=[],this._oldMatrixWorld=this.matrixWorld.clone(),this.ready=!1,this.animationPropertyCollection=new Xh,this._isPrimitive=!0,e.allowPick&&(this._owner=this._geometry),this._modelInstanceCollection=void 0,this._animationModelInstanceCollection=void 0,this.applyMatrix(e.modelMatrix),this.updateMatrixWorld(!0),this._modelMatrix=e.modelMatrix,this.particleSystemInstanceCollection=void 0,Z(e.particleSystem,void 0)&&(this.particleSystemInstanceCollection=new J_),e.adaptTerrain&&(this._geometry instanceof _p||this._geometry instanceof cg)&&(this._geometry.setAdaptTerrain(e.adaptTerrain),this._material.defines={SHADOW_VOLUME:e.adaptTerrain});const t=this.matrix.clone(),i=this.position.clone(),n=Nu.eastNorthUpToFixedFrame(i.clone()).invert();this.originalRotationScaleMatrix=t.multiplyLeft(n);}updateMatrixWorld(e){super.updateMatrixWorld(e),this.computeBounding();}setMatrix(e){e instanceof Bt&&(this.matrixAutoUpdate&&this.updateMatrix(),this.matrix=e,this.matrix.decompose(this.position,this.quaternion,this.scale),this.updateMatrixWorld(!0),this._modelMatrix=e);}computeBounding(){if(this._geometry&&this._geometry.boundingSphere){if(this._geometry.isTileGeometryType){this.boundingSphere=vc.clone(this._geometry.boundingSphere),this.boundingBox=Uc.clone(this._geometry.boundingBox);const e=Nt.getColumn(this.boundingBox.halfAxes,0),t=Nt.getColumn(this.boundingBox.halfAxes,1);let i=Nt.getColumn(this.boundingBox.halfAxes,2);i.len()<.1&&(i=_t.cross(e,t).setLength(1),this.boundingBox.halfAxes.setColumn(2,i));}else {if("airLine"===this._geometry.type)return;this.boundingSphere=this._geometry.boundingSphere.clone().transform(this.matrixWorld),this.boundingBox=this._geometry.boundingBox.clone().transform(this.matrixWorld),Number.isNaN(this.matrixWorld[0])&&(this.boundingSphere=this._geometry.boundingSphere.clone(),this.boundingBox=this._geometry.boundingBox.clone(),console.error("请检查当前的模型数据的骨骼动画相关matrix，它的matrix更新存在问题!"));}this.boundingVolume=Uc.clone(this.boundingBox);}}get filterPassIds(){return this._filterPassIds}set filterPassIds(e){for(let t=0;t<e.length;t++){for(let i=0;i<this._filterPassIds.length&&e[t]!==this._filterPassIds[i];i++);this._filterPassIds.push(e);}}get modelInstanceCollection(){return this._modelInstanceCollection}set modelInstanceCollection(e){this._modelInstanceCollection=e;}get animationModelInstanceCollection(){return this._animationModelInstanceCollection}set animationModelInstanceCollection(e){this._animationModelInstanceCollection=e;}get adaptTerrain(){return this._adaptTerrain}set adaptTerrain(e){e!==this._adaptTerrain&&(this._adaptTerrain=e,(this._geometry instanceof _p||this._geometry instanceof cg)&&(this._geometry.setAdaptTerrain(e),this._material.defines={SHADOW_VOLUME:e})),this._adaptTerrain?this.classificationType=hp.ALL:this.classificationType===hp.ALL&&(this.classificationType=hp.NONE);}set classificationType(e){this._classificationType!==e&&(this._classificationType=e,(this._geometry instanceof _p||this._geometry instanceof cg)&&(this.adaptTerrain=e===hp.ALL));}get classificationType(){return this._classificationType}get color(){return this._material?.baseColor}set color(e){if(e&&"string"!=typeof e)this._material.baseColor.set(e[0],e[1],e[2],e[3]);else {const t=Ui.parse(e);this._material.baseColor.set(t.r,t.g,t.b,t.a);}}get show(){return this._show}set show(e){this._show=e,this._visible=e;}get visible(){return this._visible}set visible(e){this._visible=e,this._show=e;}set rootId(e){this._rootId=e;}get rootId(){return this._rootId}get owner(){return this._owner}set owner(e){this._owner=e;}get geometry(){return this._geometry}get material(){return this._material}set material(e){this._material=e;}update(e,t,i={}){if(!this.show)return;this.pickId||!this.allowPick||this._material instanceof Ly||(this.pickId=e.context.createPickId(this)),i.primitive=this;const n={};this.owner?.extra?.batchTable?.update(e,t,this.pickId?.color);const r=t.overrideMaterial||this._material;if(void 0!==t.overrideMaterial)r.update(e,t,i);else {if(this._geometry._usedDoublePrecision&&(n.DOUBLEPRECISION=!0),this._adaptTerrain&&("PolygonGeometry"===this._geometry.type||"RectangleGeometry"===this._geometry.type)&&(this._geometry._needUpdate||!r._batchTable)){"PolygonGeometry"===this._geometry.type&&(n.SPHERICAL=!0),this._geometry.getDataComputeUV();const t=this._geometry.attributes,i=new Lh(e.context,t,1);let o,a;for(let e=0;e<t.length-1;++e)o=t[e].name,a=t[e].batchTableAttributeIndex,i.setBatchedAttribute(0,a,this._geometry[o]);i.update(e.context),r._batchTable=i;}r.update(e,t,i);}const o=$(this._geometry)&&!!this._geometry._needUpdate;if(this._geometry.update({painter:e,adaptTerrain:this._adaptTerrain}),o&&this.computeBounding(),this.animationModelInstanceCollection)this.animationModelInstanceCollection.update({context:e.context}),this.setInstanceProperties();else if(this.particleSystemInstanceCollection&&this.particleSystemInstanceCollection._particleNum){n.INSTANCE_MATRIX=!0,n.PARTICLSYSTEM=!0,this.particleSystemInstanceCollection.update({context:e.context}),this._geometry._segmentVector.destroy();const t=new ep;t.pushSegment({isInstance:!0,indicesCount:this._geometry.indices.length,instanceCount:this.particleSystemInstanceCollection._particleNum}),this._geometry._segmentVector=t,this._geometry.instanceVerterBuffers=this.particleSystemInstanceCollection._instanceBuffer;}if(this._geometry.state===_d.PROCESSINGFISH&&r.state===_d.PROCESSINGFISH&&(this.ready=!0),"PolylineGeometry"===this._geometry.type&&this._geometry._ready){const e=t.camera.directionWC.clone();this._geometry.boundingSphere.computePlaneDistances(t.camera.position,e,r._interval);}r.defines=n;}render(e,t,i){if(!this.show||!this.ready)return;if(!this.allowPick&&i.overrideMaterial instanceof Z_)return;let n=!!i.overrideMaterial;if(i.overrideMaterial instanceof Z_&&this._material instanceof Ly){n=!1;const e=t.classificationType===hp.FORCE_VECTOR_OVER_MODEL,i=!!$(t["depth-test"])&&t["depth-test"];this._material.openPickColor(!!e||!i);}else i.overrideMaterial instanceof Z_&&"pointCollection"===this._geometry.type?(n=!1,this._material.openPickColor(!0)):this._geometry._usedDoublePrecision&&(i.overrideMaterial instanceof K_||i.overrideMaterial instanceof Q_||i.overrideMaterial instanceof Z_)?i.overrideMaterial.defines={DOUBLEPRECISION:!0}:!this._geometry._usedDoublePrecision&&(i.overrideMaterial instanceof K_||i.overrideMaterial instanceof Q_||i.overrideMaterial instanceof Z_)&&(i.overrideMaterial.defines={DOUBLEPRECISION:!1});e.SSRState&&this._material._enableSSR&&this.setEnableSSRParameter(e),e.context.draw({painter:e,layer:t,frameState:i,framebuffer:this.framebuffer?this.framebuffer:i.framebuffer?.framebuffer,clearStates:this.clearStates,clearColorDepth:this.clearColorDepth,geometry:this._geometry,material:n?i.overrideMaterial:this._material}),i.overrideMaterial instanceof Z_&&(this._material instanceof Ly||"pointCollection"===this._geometry.type)&&this._material.closePickColor(),e.SSRState&&this._material._enableSSR&&this.setDisableSSRParameter();}setEnableSSRParameter(e){this._material._colorTexture=e.colorTexture,this._material._normalTexture=e.normalTexture,this._material._depthTexture=e.depthTexture,this._material.SSRState=!0,this._material.defines={EnableSSR:!0};}setDisableSSRParameter(){this._material.SSRState=!1,this._material.defines={EnableSSR:!1};}afterRender(e){Re(e)&&e();}updateAnimation(){if(this.animationPropertyCollection&&this.animationPropertyCollection.size>0){const e=this.animationPropertyCollection.getAll();1===e.length?e[0].updateAnimation(this):console.warn(`id为"${this.id}"的primitive轨迹动画只能有1个`);}}setInstanceProperties(){this._material.defines={INSTANCE_MATRIX:!0};const e=this.animationModelInstanceCollection._instances.size;this._geometry._segmentVector&&this._geometry._segmentVector.destroy();const t=new ep;t.pushSegment({isInstance:!0,indicesCount:this._geometry.indices.length,instanceCount:e}),this._geometry._segmentVector=t,this._geometry.dynamicLayoutBuffer1=this.animationModelInstanceCollection.instanceBuffer;}serialize(){if($(this.name)&&(-1!==this.name.indexOf("debugVideo_")||-1!==this.name.indexOf("excavationBody")||-1!==this.name.indexOf("excavationBottom")))return;const e={geometry:this._geometry.serialize(),material:this._material.serialize()};return Bt.equals(this._modelMatrix,Bt.IDENTITY)||(e.modelMatrix=this._modelMatrix),$(this.customId)&&(e.id=this.customId),$(e.geometry)?e:void 0}destroy(){return this.keepGeometryWhenFree||this?._geometry?.destroy(),this?._material?.destroy(),this._material=null,this._geometry=null,this.framebuffer=void 0,this.nextShadowVolumePrimitiveIDs=[],this.clearStates=void 0,this.receiveShadow=!1,this.castShadow=!1,this._owner=null,this.pickId&&this.pickId.destroy(),this.modelInstanceCollection&&this.modelInstanceCollection.destroy(),this.animationModelInstanceCollection&&this.animationModelInstanceCollection.destroy(),this.particleSystemInstanceCollection&&this.particleSystemInstanceCollection.destroy(),this.animationPropertyCollection=void 0,this._isPrimitive=void 0,this.pickId=null,Ou(this)}}class Ry{constructor(e){if(!$(e.position))throw new Error("options.position is required.");if(!$(e.normal))throw new Error("options.normal is required.");this._origin=e.position,this._originModelMatrix=Nu.eastNorthUpToFixedFrame(this._origin),this._relativeDistance=Z(e.distance,0),this._relativeNormal=_t.normalize(new _t(e.normal),new _t),this.setReferenceCenter(this._originModelMatrix),this.onChangeCallback=void 0,this.index=-1;}get position(){return this._origin}set position(e){e instanceof _t&&($(this.onChangeCallback)&&!_t.equals(this._origin,e)&&this.onChangeCallback(this.index),this._origin=e,this._originModelMatrix=Nu.eastNorthUpToFixedFrame(this._origin),this._update());}get distance(){return this._distance}set distance(e){et(e)&&($(this.onChangeCallback)&&e!==this._distance&&this.onChangeCallback(this.index),this._relativeDistance=e,this._distance=this._absoluteDistance+this._relativeDistance);}get normal(){return this._normal}set normal(e){if(e instanceof _t){const t=_t.normalize(new _t(e),new _t);$(this.onChangeCallback)&&!_t.equals(this._normal,t)&&this.onChangeCallback(this.index),this._relativeNormal=t,this._update();}}static fromPlane(e,t){if(!(e instanceof ts))throw new Error("plane type must be Plane!");return $(t)?(t.normal=e.normal,t.distance=e.distance):t=new Ry(e.normal,e.distance),t}static clone(e,t){return $(t)?(t.normal=e.normal,t.distance=e.distance,t.position=e.position,t):new Ry({normal:e.normal,distance:e.distance,position:e.position})}setReferenceCenter(e){this._modelMatrix=e.clone(),this._update();}_update(){let e=new St(this._relativeNormal[0],this._relativeNormal[1],this._relativeNormal[2],1);const t=new Bt;Bt.inverse(this._modelMatrix,t);const i=new Bt;t.multiplyRight(this._originModelMatrix,i),Bt.multiplyByVector(i,e,e),e=new _t(e[0],e[1],e[2]),_t.subtract(e,new _t(i.getTranslation()),e),this._normal=_t.normalize(e,new _t);const n=new St(0,0,0,1);Bt.multiplyByVector(i,n,n),this._absoluteDistance=_t.dot(new _t(-n[0],-n[1],-n[2]),this._normal),this._distance=this._absoluteDistance+this._relativeDistance;}serialize(){return {position:_t.pack(this.position,new Array(3)),normal:_t.pack(this._relativeNormal,new Array(3)),distance:this._relativeDistance}}}function Oy(e,t){if(!e)throw new Error(`math.gl assertion failed. ${t}`)}const Dy=1/256;new Ot;const Fy=new _t;new Ot;const zy=new Ot,By=new Uint8Array(1);function Vy(e){return By[0]=e,By[0]}function ky(e,t=255){return l(e,0,t)/t*2-1}function Uy(e,t=255){return Math.round((.5*l(e,-1,1)+.5)*t)}function Gy(e){return e<0?-1:1}function Hy(e,t,i){const n=e._uint8View,r=e._planes;let o=0;for(let e=t;e<i;++e){const t=r[e],i=(a=t.normal,s=new St,function(e,t,i){Oy(e),Oy(i);const n=Fy.from(e);if(Oy(Math.abs(n.magnitudeSquared()-1)<=ot.TRANSFORM.EPSILON6),i.x=e.x/(Math.abs(e.x)+Math.abs(e.y)+Math.abs(e.z)),i.y=e.y/(Math.abs(e.x)+Math.abs(e.y)+Math.abs(e.z)),e.z<0){const e=i.x,t=i.y;i.x=(1-Math.abs(t))*Gy(e),i.y=(1-Math.abs(e))*Gy(t);}i.x=Uy(i.x,65535),i.y=Uy(i.y,65535);}(a,0,zy),s.x=Vy(zy.x*Dy),s.y=Vy(zy.x),s.z=Vy(zy.y*Dy),s.w=Vy(zy.y),s);n[o]=i.x,n[o+1]=i.y,n[o+2]=i.z,n[o+3]=i.w;const l=St.packFloat(t.distance,new St);n[o+4]=l.x,n[o+5]=l.y,n[o+6]=l.z,n[o+7]=l.w,o+=8;}var a,s;}function Yy(e,t,i){const n=e._float32View,r=e._planes;let o=0;for(let e=t;e<i;++e){const t=r[e],i=t.normal;n[o]=i.x,n[o+1]=i.y,n[o+2]=i.z,n[o+3]=t.distance,o+=4;}}function qy(e,t){return t.x=Math.min(e,Yc.maximumTextureSize),t.y=Math.ceil(e/t.x),t}function Xy(e,t){e._multipleDirtyPlanes=e._multipleDirtyPlanes||-1!==e._dirtyIndex&&e._dirtyIndex!==t,e._dirtyIndex=t;}function Wy(e,t){const i=e.length;for(let n=0;n<i;++n)if(ts.equals(e[n],t))return n;return -1}function jy(e){return e===Qa.OUTSIDE}function $y(e){return e===Qa.INSIDE}class Zy{constructor(e){e=Z(e,Z.EMPTY_OBJECT),this._planes=[],this._dirtyIndex=-1,this._multipleDirtyPlanes=!1,this._enabled=Z(e.enabled,!0),this.modelMatrix=Bt.clone(Z(e.modelMatrix,Bt.IDENTITY),new Bt),this.edgeColor=Ui.clone(Z(e.edgeColor,Ui.white)),this.edgeWidth=Z(e.edgeWidth,0),this.planeAdded=new _l,this.planeRemoved=new _l,this._owner=void 0;const t=Z(e.unionClippingRegions,!0);this._unionClippingRegions=t,this._testIntersection=t?jy:$y,this._uint8View=void 0,this._float32View=void 0,this._clippingPlanesTexture=void 0,this._useFloatTexture=void 0;const i=e.planes;if($(i)){const e=i.length;for(let t=0;t<e;++t)this.add(i[t]);}}get length(){return this._planes.length}get unionClippingRegions(){return this._unionClippingRegions}set unionClippingRegions(e){this._unionClippingRegions!==e&&(this._unionClippingRegions=e,this._testIntersection=e?jy:$y);}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(this._enabled=e);}get texture(){return this._clippingPlanesTexture}get owner(){return this._owner}get clippingPlanesState(){return this._unionClippingRegions?this._planes.length:-this._planes.length}add(e){const t=this._planes.length;e.onChangeCallback=e=>{Xy(this,e);},e.index=t,Xy(this,t),e.setReferenceCenter(this.modelMatrix),this._planes.push(e),this.planeAdded.fire(e,t);}get(e){if(et(e))return this._planes[e]}contains(e){return -1!==Wy(this._planes,e)}remove(e){const t=this._planes,i=Wy(t,e);if(-1===i)return !1;e instanceof Ry&&(e.onChangeCallback=void 0,e.index=-1);const n=t.length-1;for(let e=i;e<n;++e){const i=t[e+1];t[e]=i,i instanceof Ry&&(i.index=e);}return this._multipleDirtyPlanes=!0,t.length=n,this.planeRemoved.fire(e,i),!0}removeAll(){const e=this._planes,t=e.length;for(let i=0;i<t;++i){const t=e[i];t instanceof Ry&&(t.onChangeCallback=void 0,t.index=-1),this.planeRemoved.fire(t,i);}this._multipleDirtyPlanes=!0,this._planes=[];}update(e){let t=this._clippingPlanesTexture;const i=e.context;this.useFloatTexture(i);const n=this._useFloatTexture?this.length:2*this.length;if($(t)){const e=t.width*t.height;(e<n||n<.25*e)&&(t.destroy(),t=void 0,this._clippingPlanesTexture=void 0);}if(0===this.length)return;if(!$(t)){const e=qy(n,new Ot);e.y*=2,this._useFloatTexture?(t=new Ih({context:i,width:e.x,height:e.y,pixelFormat:ih.RGBA,pixelDatatype:eh.FLOAT,sampler:Kc.NEAREST,flipY:!1}),this._float32View=new Float32Array(e.x*e.y*4)):(t=new Ih({context:i,width:e.x,height:e.y,pixelFormat:ih.RGBA,pixelDatatype:eh.UNSIGNED_BYTE,sampler:Kc.NEAREST,flipY:!1}),this._uint8View=new Uint8Array(e.x*e.y*4)),this._clippingPlanesTexture=t,this._multipleDirtyPlanes=!0;}const r=this._dirtyIndex;if(this._multipleDirtyPlanes||-1!==r){if(this._multipleDirtyPlanes)this._useFloatTexture?(Yy(this,0,this._planes.length),t.copyFrom({source:{width:t.width,height:t.height,arrayBufferView:this._float32View}})):(Hy(this,0,this._planes.length),t.copyFrom({source:{width:t.width,height:t.height,arrayBufferView:this._uint8View}}));else {let e=0,i=0;this._useFloatTexture?(i=Math.floor(r/t.width),e=Math.floor(r-i*t.width),Yy(this,r,r+1),t.copyFrom({source:{width:1,height:1,arrayBufferView:this._float32View},xOffset:e,yOffset:i})):(i=Math.floor(2*r/t.width),e=Math.floor(2*r-i*t.width),Hy(this,r,r+1),t.copyFrom({source:{width:2,height:1,arrayBufferView:this._uint8View},xOffset:e,yOffset:i}));}this._multipleDirtyPlanes=!1,this._dirtyIndex=-1;}}computeIntersectionWithBoundingVolume(e,t){const i=this._planes,n=i.length;let r=this.modelMatrix;$(t)&&(r=Bt.multiply(t,r,new Bt));let o=Qa.INSIDE;!this.unionClippingRegions&&n>0&&(o=Qa.OUTSIDE);const a=new ts(_t.UNIT_X,0);for(let t=0;t<n;++t){ts.transform(i[t],r,a);const n=e.intersectPlane(a);if(n===Qa.INTERSECTING)o=n;else if(this._testIntersection(n))return n}return o}static setOwner(e,t,i){if(e!==t[i]&&(t[i]=t[i]&&t[i].destroy(),$(e))){if($(e._owner))throw new Error("ClippingPlaneCollection should only be assigned to one object");e._owner=t,t[i]=e;}}useFloatTexture(e){this._useFloatTexture=e.floatingPointTexture;}static getTextureResolution(e){const t=new Ot,i=e.texture;if($(i))return t.x=i.width,t.y=i.height,t;const n=qy(2*e.length,t);return n.y*=2,n}serialize(){const e=[];for(let t=0;t<this.length;t++)e.push(this.get(t).serialize());return {modelMatrix:Bt.pack(this.modelMatrix,new Array(16)),edgeColor:Ui.pack(this.edgeColor,new Array(4)),edgeWidth:this.edgeWidth,enabled:this.enabled,unionClippingRegions:this.unionClippingRegions,planes:e}}destroy(){return this._clippingPlanesTexture=this._clippingPlanesTexture&&this._clippingPlanesTexture.destroy(),Ou(this)}}var Ky=Object.freeze({NONE:0,PHONG:1,PBR:2});class Qy{constructor(e,t,i,n){this.message=(e?`${e}: `:"")+i,n&&(this.identifier=n),null!=t&&t.__line__&&(this.line=t.__line__);}}function Jy(e){const t=e.value;return t?[new Qy(e.key,t,"constants have been deprecated as of v8")]:[]}function ex(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function tx(e){if(Array.isArray(e))return e.map(tx);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const i in e)t[i]=tx(e[i]);return t}return ex(e)}function ix(e){const t=e.key,i=e.value,n=e.valueSpec||{},r=e.objectElementValidators||{},o=e.style,a=e.styleSpec;let s=[];const l=Fn(i);if("object"!==l)return [new Qy(t,i,`object expected, ${l} found`)];for(const e in i){const l=e.split(".")[0],u=n[l]||n["*"];let c;if(r[l])c=r[l];else if(n[l])c=Ix;else if(r["*"])c=r["*"];else {if(!n["*"]){s.push(new Qy(t,i[e],`unknown property "${e}"`));continue}c=Ix;}s=s.concat(c({key:(t?`${t}.`:t)+e,value:i[e],valueSpec:u,style:o,styleSpec:a,object:i,objectKey:e},i));}for(const e in n)r[e]||n[e].required&&void 0===n[e].default&&void 0===i[e]&&s.push(new Qy(t,i,`missing required property "${e}"`));return s}function nx(e){const t=e.value,i=e.valueSpec,n=e.style,r=e.styleSpec,o=e.key,a=e.arrayElementValidator||Ix;if("array"!==Fn(t))return [new Qy(o,t,`array expected, ${Fn(t)} found`)];if(i.length&&t.length!==i.length)return [new Qy(o,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return [new Qy(o,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let s={type:i.value};r.$version<7&&(s.function=i.function),"object"===Fn(i.value)&&(s=i.value);let l=[];for(let e=0;e<t.length;e++)l=l.concat(a({array:t,arrayIndex:e,value:t[e],valueSpec:s,style:n,styleSpec:r,key:`${o}[${e}]`}));return l}function rx(e){const t=e.key,i=e.value,n=e.valueSpec,r=Fn(i);return "number"!==r?[new Qy(t,i,`number expected, ${r} found`)]:"minimum"in n&&i<n.minimum?[new Qy(t,i,`${i} is less than the minimum value ${n.minimum}`)]:"maximum"in n&&i>n.maximum?[new Qy(t,i,`${i} is greater than the maximum value ${n.maximum}`)]:[]}function ox(e){const t=e.valueSpec,i=ex(e.value.type);let n,r,o,a={};const s="categorical"!==i&&void 0===e.value.property,l=!s,u="array"===Fn(e.value.stops)&&"array"===Fn(e.value.stops[0])&&"object"===Fn(e.value.stops[0][0]),c=ix({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===i)return [new Qy(e.key,e.value,'identity function may not have a "stops" property')];let t=[];const n=e.value;return t=t.concat(nx({key:e.key,value:n,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===Fn(n)&&0===n.length&&t.push(new Qy(e.key,n,"array must have at least one stop")),t},default:function(e){return Ix({key:e.key,value:e.value,valueSpec:t,style:e.style,styleSpec:e.styleSpec})}}});return "identity"===i&&s&&c.push(new Qy(e.key,e.value,'missing required property "property"')),"identity"===i||e.value.stops||c.push(new Qy(e.key,e.value,'missing required property "stops"')),"exponential"===i&&e.valueSpec.expression&&!co(e.valueSpec)&&c.push(new Qy(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!lo(e.valueSpec)?c.push(new Qy(e.key,e.value,"property functions not supported")):s&&!uo(e.valueSpec)&&c.push(new Qy(e.key,e.value,"zoom functions not supported"))),"categorical"!==i&&!u||void 0!==e.value.property||c.push(new Qy(e.key,e.value,'"property" property is required')),c;function h(e){let i=[];const n=e.value,s=e.key;if("array"!==Fn(n))return [new Qy(s,n,`array expected, ${Fn(n)} found`)];if(2!==n.length)return [new Qy(s,n,`array length 2 expected, length ${n.length} found`)];if(u){if("object"!==Fn(n[0]))return [new Qy(s,n,`object expected, ${Fn(n[0])} found`)];if(void 0===n[0].zoom)return [new Qy(s,n,"object stop key must have zoom")];if(void 0===n[0].value)return [new Qy(s,n,"object stop key must have value")];if(o&&o>ex(n[0].zoom))return [new Qy(s,n[0].zoom,"stop zoom values must appear in ascending order")];ex(n[0].zoom)!==o&&(o=ex(n[0].zoom),r=void 0,a={}),i=i.concat(ix({key:`${s}[0]`,value:n[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:rx,value:d}}));}else i=i.concat(d({key:`${s}[0]`,value:n[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},n));return i.concat(Ix({key:`${s}[1]`,value:n[1],valueSpec:t,style:e.style,styleSpec:e.styleSpec}))}function d(e,o){const s=Fn(e.value),l=ex(e.value),u=null!==e.value?e.value:o;if(n){if(s!==n)return [new Qy(e.key,u,`${s} stop domain type must match previous stop domain type ${n}`)]}else n=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return [new Qy(e.key,u,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==i){let n=`number expected, ${s} found`;return lo(t)&&void 0===i&&(n+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Qy(e.key,u,n)]}return "categorical"!==i||"number"!==s||isFinite(l)&&Math.floor(l)===l?"categorical"!==i&&"number"===s&&void 0!==r&&l<r?[new Qy(e.key,u,"stop domain values must appear in ascending order")]:(r=l,"categorical"===i&&l in a?[new Qy(e.key,u,"stop domain values must be unique")]:(a[l]=!0,[])):[new Qy(e.key,u,`integer expected, found ${l}`)]}}function ax(e){const t=("property"===e.expressionContext?Go:Vo)(tx(e.value),e.valueSpec);if("error"===t.result)return t.value.map((t=>new Qy(`${e.key}${t.key}`,e.value,t.message)));const i=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&-1!==t.value._styleExpression.expression.possibleOutputs().indexOf(void 0))return [new Qy(e.key,e.value,'Invalid data expression for "text-font". Output values must be contained as literals within the expression.')];if("property"===e.expressionContext&&"layout"===e.propertyType&&!ur(t.value._styleExpression.expression))return [new Qy(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext&&!ur(i))return [new Qy(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!cr(i,["zoom","feature-state"]))return [new Qy(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!lr(i))return [new Qy(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return []}function sx(e){const t=e.key,i=e.value,n=e.valueSpec,r=[];return Array.isArray(n.values)?-1===n.values.indexOf(ex(i))&&r.push(new Qy(t,i,`expected one of [${n.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(n.values).indexOf(ex(i))&&r.push(new Qy(t,i,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(i)} found`)),r}function lx(e){if(!0===e||!1===e)return !0;if(!Array.isArray(e)||0===e.length)return !1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":case"!arrin":case"arrin":case"like":case"!like":return !1;case"==":case"!=":case">":case">=":case"<":case"<=":case"start":case"end":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!lx(t)&&"boolean"!=typeof t)return !1;return !0;default:return !0}}const ux={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function cx(e){if(!e)return ()=>!0;lx(e)||(e=dx(e));const t=Vo(e,ux);if("error"===t.result)throw new Error(t.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return (e,i,n)=>t.value.evaluate(e,i,{},n)}function hx(e,t){return e<t?-1:e>t?1:0}function dx(e){if(!e)return !0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?px(e[1],e[2],"=="):"!="===t?yx(px(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?px(e[1],e[2],t):"any"===t?(i=e.slice(1),["any"].concat(i.map(dx))):"all"===t?["all"].concat(e.slice(1).map(dx)):"none"===t?["all"].concat(e.slice(1).map(dx).map(yx)):"in"===t?fx(e[1],e.slice(2)):"!in"===t?yx(fx(e[1],e.slice(2))):"has"===t?gx(e[1]):"!has"===t?yx(gx(e[1])):"arrin"===t?mx(e[1],e.slice(2)):"!arrin"===t?yx(mx(e[1],e.slice(2))):"like"===t?_x(e[1],e.slice(2)):"!like"===t?yx(_x(e[1],e.slice(2))):"within"!==t||e;var i;}function px(e,t,i){switch(e){case"$type":return [`filter-type-${i}`,t];case"$id":return [`filter-id-${i}`,t];default:return [`filter-${i}`,e,t]}}function fx(e,t){if(0===t.length)return !1;switch(e){case"$type":return ["filter-type-in",["literal",t]];case"$id":return ["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(hx)]]:["filter-in-small",e,["literal",t]]}}function mx(e,t){return 0!==t.length&&("$type"===e?["filter-type-arrin",["literal",t]]:["filter-arrin",e,["literal",t]])}function _x(e,t){return 0!==t.length&&("$type"===e?["filter-type-like",["literal",t]]:["filter-like",e,["literal",t]])}function gx(e){switch(e){case"$type":return !0;case"$id":return ["filter-has-id"];default:return ["filter-has",e]}}function yx(e){return ["!",e]}function xx(e){return lx(tx(e.value))?ax(Gi({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):vx(e)}function vx(e){const t=e.value,i=e.key;if("array"!==Fn(t))return [new Qy(i,t,`array expected, ${Fn(t)} found`)];const n=e.styleSpec;let r,o=[];if(t.length<1)return [new Qy(i,t,"filter array must have at least 1 element")];switch(o=o.concat(sx({key:`${i}[0]`,value:t[0],valueSpec:n.filter_operator,style:e.style,styleSpec:e.styleSpec})),ex(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===ex(t[1])&&o.push(new Qy(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&o.push(new Qy(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(r=Fn(t[1]),"string"!==r&&o.push(new Qy(`${i}[1]`,t[1],`string expected, ${r} found`)));for(let a=2;a<t.length;a++)r=Fn(t[a]),"$type"===ex(t[1])?o=o.concat(sx({key:`${i}[${a}]`,value:t[a],valueSpec:n.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&o.push(new Qy(`${i}[${a}]`,t[a],`string, number, or boolean expected, ${r} found`));break;case"like":case"!like":t.length>=2&&(r=Fn(t[1]),"string"!==r&&o.push(new Qy(`${i}[1]`,t[1],`string expected, ${r} found`)));for(let a=2;a<t.length;a++)r=Fn(t[a]),"$type"===ex(t[1])?o=o.concat(sx({key:`${i}[${a}]`,value:t[a],valueSpec:n.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&o.push(new Qy(`${i}[${a}]`,t[a],`string, number, or boolean expected, ${r} found`));break;case"any":case"all":case"none":for(let n=1;n<t.length;n++)o=o.concat(vx({key:`${i}[${n}]`,value:t[n],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":r=Fn(t[1]),2!==t.length?o.push(new Qy(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==r&&o.push(new Qy(`${i}[1]`,t[1],`string expected, ${r} found`));break;case"within":r=Fn(t[1]),2!==t.length?o.push(new Qy(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):"object"!==r&&o.push(new Qy(`${i}[1]`,t[1],`object expected, ${r} found`));}return o}function wx(e,t){const i=e.key,n=e.style,r=e.styleSpec,o=e.value,a=e.objectKey,s=r[`${t}_${e.layerType}`];if(!s)return [];const l=a.match(/^(.*)-transition$/);if("paint"===t&&l&&s[l[1]]&&s[l[1]].transition)return Ix({key:i,value:o,valueSpec:r.transition,style:n,styleSpec:r});const u=e.valueSpec||s[a];if(!u)return [new Qy(i,o,`unknown property "${a}"`)];let c;if("string"===Fn(o)&&lo(u)&&!u.tokens&&(c=/^{([^}]+)}$/.exec(o)))return [new Qy(i,o,`"${a}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(c[1])} }\`.`)];const h=[];return "symbol"===e.layerType&&("text-field"===a&&n&&!n.glyphs&&h.push(new Qy(i,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&Co(tx(o))&&"identity"===ex(o.type)&&h.push(new Qy(i,o,'"text-font" does not support identity functions'))),h.concat(Ix({key:e.key,value:o,valueSpec:u,style:n,styleSpec:r,expressionContext:"property",propertyType:t,propertyKey:a}))}function Tx(e){return wx(e,"paint")}function bx(e){return wx(e,"layout")}function Px(e){let t=[];const i=e.value,n=e.key,r=e.style,o=e.styleSpec;i.type||i.ref||t.push(new Qy(n,i,'either "type" or "ref" is required'));let a=ex(i.type);const s=ex(i.ref);if(i.id){const o=ex(i.id);for(let a=0;a<e.arrayIndex;a++){const e=r.layers[a];ex(e.id)===o&&t.push(new Qy(n,i.id,`duplicate layer id "${i.id}", previously used at line ${e.id.__line__}`));}}if("ref"in i){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in i&&t.push(new Qy(n,i[e],`"${e}" is prohibited for ref layers`));})),r.layers.forEach((t=>{ex(t.id)===s&&(e=t);})),e?e.ref?t.push(new Qy(n,i.ref,"ref cannot reference another ref layer")):a=ex(e.type):t.push(new Qy(n,i.ref,`ref layer "${s}" not found`));}else if("background"!==a&&"raster"!==a)if(i.source){const e=r.sources&&r.sources[i.source],o=e&&ex(e.type);e?"vector"===o&&"raster"===a?t.push(new Qy(n,i.source,`layer "${i.id}" requires a raster source`)):"raster"===o&&"raster"!==a?t.push(new Qy(n,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==o||i["source-layer"]?"line"!==a||!i.paint||!i.paint["line-gradient"]||"geojson"===o&&e.lineMetrics||t.push(new Qy(n,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Qy(n,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new Qy(n,i.source,`source "${i.source}" not found`));}else t.push(new Qy(n,i,'missing required property "source"'));return t=t.concat(ix({key:n,value:i,valueSpec:o.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ix({key:`${n}.type`,value:i.type,valueSpec:o.layer.type,style:e.style,styleSpec:e.styleSpec,object:i,objectKey:"type"}),filter:xx,layout:e=>ix({layer:i,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>bx(Gi({layerType:a},e))}}),paint:e=>ix({layer:i,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>Tx(Gi({layerType:a},e))}})}})),t}function Sx(e){const t=e.value,i=e.key,n=Fn(t);return "string"!==n?[new Qy(i,t,`string expected, ${n} found`)]:[]}const Ex={promoteId:function({key:e,value:t}){if("string"===Fn(t))return Sx({key:e,value:t});{const i=[];for(const n in t)i.push(...Sx({key:`${e}.${n}`,value:t[n]}));return i}}};function Ax(e){const t=e.value,i=e.key,n=e.styleSpec,r=e.style;if(!t.type)return [new Qy(i,t,'"type" is required')];const o=ex(t.type);let a=[];switch(o){case"vector":case"raster":case"raster-dem":if(a=a.concat(ix({key:i,value:t,valueSpec:n[`source_${o.replace("-","_")}`],style:e.style,styleSpec:n,objectElementValidators:Ex})),"url"in t)for(const e in t)["type","url","tileSize"].indexOf(e)<0&&a.push(new Qy(`${i}.${e}`,t[e],`a source with a "url" property may not include a "${e}" property`));return a;case"geojson":return ix({key:i,value:t,valueSpec:n.source_geojson,style:r,styleSpec:n,objectElementValidators:Ex});case"video":return ix({key:i,value:t,valueSpec:n.source_video,style:r,styleSpec:n});case"image":return ix({key:i,value:t,valueSpec:n.source_image,style:r,styleSpec:n});case"canvas":return a.push(new Qy(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")),a;case"sphere-image":case"3d-model":case"3d-tiles":return [];default:return sx({key:`${i}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:r,styleSpec:n})}}function Cx(e){const t=e.value,i=e.styleSpec,n=i.light,r=e.style;let o=[];const a=Fn(t);if(void 0===t)return o;if("object"!==a)return o=o.concat([new Qy("light",t,`object expected, ${a} found`)]),o;for(const e in t){const a=e.match(/^(.*)-transition$/);o=o.concat(a&&n[a[1]]&&n[a[1]].transition?Ix({key:e,value:t[e],valueSpec:i.transition,style:r,styleSpec:i}):n[e]?Ix({key:e,value:t[e],valueSpec:n[e],style:r,styleSpec:i}):[new Qy(e,t[e],`unknown property "${e}"`)]);}return o}const Mx={"*":()=>[],any:()=>[],array:nx,boolean:function(e){const t=e.value,i=e.key,n=Fn(t);return "boolean"!==n?[new Qy(i,t,`boolean expected, ${n} found`)]:[]},number:rx,color:function(e){const t=e.key,i=e.value,n=Fn(i);return "string"!==n?[new Qy(t,i,`color expected, ${n} found`)]:null===Fi(i)?[new Qy(t,i,`color expected, "${i}" found`)]:[]},constants:Jy,enum:sx,filter:xx,function:ox,layer:Px,object:ix,source:Ax,light:Cx,string:Sx,formatted:function(e){return 0===Sx(e).length?[]:ax(e)},resolvedImage:function(e){return 0===Sx(e).length?[]:ax(e)}};function Ix(e){const t=e.value,i=e.valueSpec,n=e.styleSpec;if(i.expression&&Co(ex(t)))return ox(e);if(i.expression&&Bo(tx(t)))return ax(e);if(i.type&&Mx[i.type])return Mx[i.type](e);{const t=ix(Gi({},e,{valueSpec:i.type?n[i.type]:i}));return t||Ze("not valid"),t}}function Lx(e){const t=e.value,i=e.key,n=Sx(e);return n.length||(-1===t.indexOf("{fontstack}")&&n.push(new Qy(i,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&n.push(new Qy(i,t,'"glyphs" url must include a "{range}" token'))),n}function Nx(e,t){let i=[];return i=i.concat(Ix({key:"",value:e,valueSpec:(t=t||Hg).$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Lx,"*":()=>[]}})),e.constants&&(i=i.concat(Jy({key:"constants",value:e.constants,style:e,styleSpec:t}))),Rx(i)}function Rx(e){return [].concat(e).sort(((e,t)=>e.line-t.line))}function Ox(e){return function(){return Rx(e.apply(this,arguments))}}Nx.source=Ox(Ax),Nx.light=Ox(Cx),Nx.layer=Ox(Px),Nx.filter=Ox(xx),Nx.paintProperty=Ox(Tx),Nx.layoutProperty=Ox(bx);const Dx=Nx,Fx=Nx.paintProperty,zx=Nx.layoutProperty;function Bx(e,t){let i=!1;if(t&&t.length)for(const n of t)e.fire(new ml(new Error(n.message))),i=!0;return i}const Vx="-transition";class kx extends _l{constructor(e,t){if(super(),this.id=e.id,this._featureFilter=()=>!0,"custom"!==e.type){if(this.metadata=e.metadata,this.type=e.type,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this.visibility="visible",this.depthTest=e["depth-test"]||!1,this.independent=e.independent||e.type===Dg.BACKGROUND,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t&&t.layout&&(this._unevaluatedLayout=new zp(t.layout)),t&&t.paint){this._transitionablePaint=new Op(t.paint);for(const t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(const t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned();}"3d-model"!==e.type&&"3d-tiles"!==e.type&&"extrusion"!==e.type||(this.lightingModel=Z(e.lightingModel,Ky.NONE),this.phongLightConfig=e.phongLightConfig,this.clippingPlanes=e.clippingPlanes),("circle"===e.type||"line"===e.type||"fill"===e.type||"extrusion"===e.type||"heatmap"===e.type||"sprite"===e.type||"symbol"===e.type&&e.classificationType===hp.FORCE_VECTOR_OVER_MODEL)&&(this.classificationType=e.classificationType);}}getLayoutProperty(e){return "visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,i){null!=t&&this._validate(zx,`layers.${this.id}.layout.${e}`,e,t,i)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility="none"===t?t:"visible");}getPaintProperty(e){return qe(e,Vx)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,i){if(null!=t&&this._validate(Fx,`layers.${this.id}.paint.${e}`,e,t,i))return !1;if(qe(e,Vx))return this._transitionablePaint.setTransition(e.slice(0,-11),t||void 0),!1;{const i=this._transitionablePaint._values[e],n=i.value.isDataDriven(),r=i.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const o=this._transitionablePaint._values[e].value,a=o.isDataDriven(),s=qe(e,"pattern")||"line-dasharray"===e;return a||n||s||this._handleOverridablePaintPropertyUpdate(e,r,o)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,t,i){return t.value!==i.value}isHidden(e,t){return this.minzoom>t||this.maxzoom<=e||"none"===this.visibility}isHiddenByMapZoom(e){return Ux(this,e)}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint);}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t);}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,_original_style:this._original_style,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize(),enableQuery:this.enableQuery,classificationType:this.classificationType};return "none"===this.visibility&&(e.layout=e.layout||{},e.layout.visibility="none"),We(e,((e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)))}_validate(e,t,i,n,r){return (!r||!1!==r.validate)&&Bx(this,e.call(Dx,{key:t,layerType:this.type,objectKey:i,value:n,styleSpec:Hg,style:{glyphs:!0,sprite:!0}}))}hasOffscreenPass(){return !1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof Bp&&lo(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return !0}return !1}}function Ux(e,t,i){i=i||ot.TRANSFORM.EPSILON11;let n=!1;return $(e.minzoom)&&e.minzoom-t>i&&(n=!0),$(e.maxzoom)&&t-e.maxzoom>i&&(n=!0),n||"none"===e.visibility}var Gx={paint:new qp({"background-color":new kp(Hg.paint_background["background-color"]),"background-pattern":new Hp(Hg.paint_background["background-pattern"]),"background-pattern-fixed":new kp(Hg.paint_background["background-pattern-fixed"]),"background-opacity":new kp(Hg.paint_background["background-opacity"]),"background-terrain-analysis":new Up(Hg.paint_background["background-terrain-analysis"])})},Hx={paint:new qp({"raster-opacity":new kp(Hg.paint_raster["raster-opacity"]),"raster-hue-rotate":new kp(Hg.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new kp(Hg.paint_raster["raster-brightness-min"]),"raster-brightness-max":new kp(Hg.paint_raster["raster-brightness-max"]),"raster-saturation":new kp(Hg.paint_raster["raster-saturation"]),"raster-contrast":new kp(Hg.paint_raster["raster-contrast"]),"raster-resampling":new kp(Hg.paint_raster["raster-resampling"]),"raster-fade-duration":new kp(Hg.paint_raster["raster-fade-duration"])})};class Yx{constructor(){}static setPhongLightUniform(e){const{material:t,phongLightConfig:i}=e,n=Object.assign({Ambient:Hg.phongLightConfig.Ambient.default,Diffuse:Hg.phongLightConfig.Diffuse.default,SpecularColor:Hg.phongLightConfig.SpecularColor.default,Shininess:Hg.phongLightConfig.Shininess.default},i),{Ambient:r,Diffuse:o,SpecularColor:a,Shininess:s}=n;t._uniforms.set("u_LightMaterial",{Ambient:()=>new _t(r,r,r),Diffuse:()=>new _t(o,o,o),SpecularColor:()=>new _t(a,a,a),Shininess:()=>s});}}const qx={COLOR:"Color",TEXTURE:"Texture",DIFFUSING_RING:"DiffusingRing",RADAR_SCAN:"RadarScan"};Object.freeze(qx);const Xx=new Bt,Wx=new St;class jx extends W_{constructor(e){super(e),this._texType=Z(e.texType,void 0),this._count=0,this._pickColorDepthTest=Z(e.pickColorDepthTest,void 0),this._clippingPlanes=Z(e.clippingPlanes,void 0),this._vertexColor=e.vertexColor,this._vertexColor&&(this.defines={VERTEX_COLOR:!0});}get pickColorDepthTest(){return this._pickColorDepthTest}set pickColorDepthTest(e){this._pickColorDepthTest=e;}update(e,t,i={}){if(super.update(e,t,i),this._batchTable&&(this.uniforms=this._batchTable.getUniformMapCallback(),e.commonDepthPass.render({painter:e}),this._uniforms.set("u_DepthTexture",(()=>e.commonDepthPass.framebuffer.getColorTexture(0).bind(Du.LINEAR,Du.CLAMP_TO_EDGE))),this._uniforms.set("u_InvertViewMatrix",(()=>t.camera.getViewMatrix().invert())),this.defines=i.primitive._adaptTerrain?t.preMainDepthStencilTexture?{HAS_SHADOWVOLUME:!0,SHADOWVOLUME_DISCARD:!0}:{HAS_SHADOWVOLUME:!0,SHADOWVOLUME_DISCARD:!1}:{HAS_SHADOWVOLUME:!1,SHADOWVOLUME_DISCARD:!1}),this._clippingPlanes&&this._clippingPlanes.enabled&&0!==this._clippingPlanes.length){this._clippingPlanes.update(e,t),this._uniforms.set("u_model_clippingPlanesEdgeStyle",(()=>(Wx.set(this._clippingPlanes.edgeColor.r,this._clippingPlanes.edgeColor.g,this._clippingPlanes.edgeColor.b,this._clippingPlanes.edgeWidth),Wx))),this._uniforms.set("u_model_clippingPlanes",(()=>this._clippingPlanes.texture)),this._uniforms.set("u_model_clippingPlanesMatrix",(()=>{const e=Bt.multiply(Xx,t.camera.matrixWorldInverse,this._clippingPlanes.modelMatrix);return Bt.inverseTranspose(e,e),e})),this.defines.HAS_CLIPPING_PLANES=!0,this.defines.USE_CLIPPING_PLANES_FLOAT_TEXTURE=!!this._clippingPlanes._useFloatTexture;const i=Zy.getTextureResolution(this._clippingPlanes);this.defines.CLIPPING_PLANES_LENGTH=this._clippingPlanes.length,this.defines.CLIPPING_PLANES_TEXTURE_WIDTH=i.x,this.defines.CLIPPING_PLANES_TEXTURE_HEIGHT=i.y,this.defines.UNION_CLIPPING_REGIONS=!!this._clippingPlanes._unionClippingRegions;}else this.defines.HAS_CLIPPING_PLANES=!1,this.defines.USE_CLIPPING_PLANES_FLOAT_TEXTURE=!1,this.defines.CLIPPING_PLANES_LENGTH=0,this.defines.CLIPPING_PLANES_TEXTURE_WIDTH=1,this.defines.CLIPPING_PLANES_TEXTURE_HEIGHT=1;}updateTexture(e,t){let i;return e==qx.COLOR?i=jx.fromType(qx.COLOR,{color:t.baseColor,opacity:t.opacity,lightingModel:t.lightingModel,doubleSided:t.doubleSided}):e==qx.TEXTURE?i=jx.fromType(qx.TEXTURE,{baseColorTexture:t.baseColorTexture,opacity:t.opacity,lightingModel:t.lightingModel,doubleSided:t.doubleSided}):e==qx.RADAR_SCAN?i=jx.fromType(qx.RADAR_SCAN,{color:t.baseColor,opacity:t.opacity,lightingModel:t.lightingModel,doubleSided:t.doubleSided}):e==qx.DIFFUSING_RING&&(i=jx.fromType(qx.DIFFUSING_RING,{color:t.baseColor,opacity:t.opacity,lightingModel:t.lightingModel,doubleSided:t.doubleSided})),i}updateProperty(e){if(e.color){const t=Ui.parse(e.color);this._uniforms.set("u_Color",(()=>St.fromColor(t,!1)));}e.baseColorTexture&&(this._uniforms.set("u_BaseColorSampler",(()=>W_.bindTextureSampler(e.baseColorTexture))),jx.buildDefines(this,e)),$(e.opacity)&&this._uniforms.set("u_Opacity",(()=>e.opacity)),this._updateTexOffsetScale(e);}static buildDefines(e,t={}){const i={};if(i.PHONG_LIGHT=t.phongLight,i.HAS_BASECOLORMAP=t.hasBaseColorMap,i.HAS_RADARSCAN=t.radarScan,i.HAS_DIFFUSINGRING=t.diffusingRing,i.HAS_CLIPPING_PLANES=t.clippingPlanes,i.HAS_CLIPPING_PLANES){i.HAS_CLIPPING_PLANES=!0,i.USE_CLIPPING_PLANES_FLOAT_TEXTURE=!!e._clippingPlanes._useFloatTexture;const t=Zy.getTextureResolution(e._clippingPlanes);i.CLIPPING_PLANES_LENGTH=e._clippingPlanes.length,i.CLIPPING_PLANES_TEXTURE_WIDTH=t.x,i.CLIPPING_PLANES_TEXTURE_HEIGHT=t.y,i.UNION_CLIPPING_REGIONS=!!e._clippingPlanes._unionClippingRegions;}else i.HAS_CLIPPING_PLANES=!1,i.USE_CLIPPING_PLANES_FLOAT_TEXTURE=!1,i.CLIPPING_PLANES_LENGTH=0,i.CLIPPING_PLANES_TEXTURE_WIDTH=1,i.CLIPPING_PLANES_TEXTURE_HEIGHT=1;e.defines=i;}get texType(){return this._texType}set texType(e){this._texType=e;}get clippingPlanes(){return this._clippingPlanes}set clippingPlanes(e){this._clippingPlanes=e instanceof Zy?e:void 0;}static fromType(e,t){const i=jx.getPresetMaterial(e,t),n=new jx({renderState:t.renderState?t.renderState:i.renderState,defines:t.defines,type:"StandardMaterial",texType:e,baseColorTexture:i.baseColorTexture,color:i.color,doubleSided:i.doubleSided,opacity:i.opacity,lightingModel:i.lightingModel,depthTest:t.depthTest,clippingPlanes:t.clippingPlanes,vertexColor:t.vertexColor});jx.buildDefines(n,i.microDefineOptions),Yx.setPhongLightUniform({material:n});for(const e in i.uniforms)n._uniforms.set(`u_${e}`,i.uniforms[e]);return n._updateTexOffsetScale({texCoordRepeat:Z(t.texRepeat,[0,0])}),n}static getPresetMaterial(e,t){const i=Z(t?.lightingModel,Ky.PHONG),n={renderState:W_.getDefaultRenderState(),videoOptions:{},uniforms:{},baseColorTexture:void 0,doubleSided:void 0,lightingModel:void 0,defines:void 0,microDefineOptions:{phongLight:i===Ky.PHONG,hasBaseColorMap:Z(!!t.baseColorTexture,!1),radarScan:Z(e===qx.RADAR_SCAN,!1),diffusingRing:Z(e===qx.DIFFUSING_RING,!1),clippingPlanes:Z(!!t.clippingPlanes,!1)},color:void 0,opacity:void 0};n.renderState.polygonOffset={enabled:!0,factor:1,units:1},n.renderState.cull.enabled=Z(!t.doubleSided,!0);const r=Z(t?.opacity,1),o=Ui.parse(Z(t?.color,new Ui(1,0,0,1)));n.color=o,n.doubleSided=Z(t.doubleSided,!1),n.opacity=r,n.lightingModel=i,n.baseColorTexture=t.baseColorTexture;const a=Z(t?.speed,1);if(e==qx.COLOR)n.uniforms={Color:()=>St.fromColor(o,!1),Opacity:()=>r};else if(e==qx.TEXTURE)n.uniforms={BaseColorSampler:()=>W_.bindTextureSampler(t.baseColorTexture),Color:()=>new St(o.r,o.g,o.b,o.a),Opacity:()=>r};else if(e==qx.RADAR_SCAN)n.uniforms={Color:()=>St.fromColor(o,!1),Opacity:()=>r,Speed:()=>a};else {if(e!=qx.DIFFUSING_RING)throw new Error(`material with type '${e}' does not exist.`);n.uniforms={Color:()=>St.fromColor(o,!1),Opacity:()=>r,Speed:()=>a};}return n}serialize(){const e={type:"StandardMaterial",texTYpe:this._texType,opacity:this._opacity,doubleSided:this._doubleSided,lightingModel:this._lightingModel};return this._texType===qx.COLOR?e.color=Ui.pack(this._color,new Array(4)):this._texType===qx.TEXTURE&&(e.texUrl=this._baseColorTexture.texUrl),$(this._flowOptions)&&(e.flowOptions=this._flowOptions),$(this.clippingPlanes)&&(e.clippingPlanes=this.clippingPlanes.serialize()),e}destroy(){return super.destroy(),Ou(this)}}const $x=bi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_ST",components:2,type:"Float32"}],4),{members:Zx}=$x,Kx=bi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_ST",components:2,type:"Float32"},{name:"a_OUTLINE_COLOR",components:4,type:"Uint8"}],4),{members:Qx}=Kx;function Jx(e,t,i){const n=i.patternDependencies;let r=!1;for(const i of t){const t=i.paint.get(`${e}-pattern`),o=i.paint.get(`${e}-top-pattern`);if(!t)continue;t.isConstant()||(r=!0);const a=t.constantOr(null);if(a&&(r=!0,n[a.to]=!0,n[a.from]=!0),!o)continue;o.isConstant()||(r=!0);const s=o.constantOr(null);s&&(r=!0,n[s.to]=!0,n[s.from]=!0);}return r}function ev(e,t,i,n,r){const o=r.patternDependencies;for(const a of t){const t=a.paint.get(`${e}-pattern`),s=a.paint.get(`${e}-top-pattern`);if(!t)continue;const l=t.value;if("constant"!==l.kind){let e=l.evaluate({zoom:n-1},i,{},r.availableImages),t=l.evaluate({zoom:n},i,{},r.availableImages),s=l.evaluate({zoom:n+1},i,{},r.availableImages);e=e&&e.name?e.name:e,t=t&&t.name?t.name:t,s=s&&s.name?s.name:s,o[e]=!0,o[t]=!0,o[s]=!0,i.patterns[a.id]={min:e,mid:t,max:s};}if(!s)continue;const u=s.value;if("constant"!==u.kind){let e=u.evaluate({zoom:n-1},i,{},r.availableImages),t=u.evaluate({zoom:n},i,{},r.availableImages),s=u.evaluate({zoom:n+1},i,{},r.availableImages);e=e&&e.name?e.name:e,t=t&&t.name?t.name:t,s=s&&s.name?s.name:s,o[e]=!0,o[t]=!0,o[s]=!0,i.patterns[`${a.id}topPattern`]={min:e,mid:t,max:s};}}return i}var tv=nv,iv=nv;function nv(e,t,i){i=i||2;var n,r,o,a,s,l,u,c=t&&t.length,h=c?t[0]*i:e.length,d=rv(e,0,h,i,!0),p=[];if(!d||d.next===d.prev)return p;if(c&&(d=function(e,t,i,n){var r,o,a,s=[];for(r=0,o=t.length;r<o;r++)(a=rv(e,t[r]*n,r<o-1?t[r+1]*n:e.length,n,!1))===a.next&&(a.steiner=!0),s.push(mv(a));for(s.sort(hv),r=0;r<s.length;r++)i=dv(s[r],i);return i}(e,t,d,i)),e.length>80*i){n=o=e[0],r=a=e[1];for(var f=i;f<h;f+=i)(s=e[f])<n&&(n=s),(l=e[f+1])<r&&(r=l),s>o&&(o=s),l>a&&(a=l);u=0!==(u=Math.max(o-n,a-r))?32767/u:0;}return av(d,p,i,n,r,u,0),p}function rv(e,t,i,n,r){var o,a;if(r===Cv(e,t,i,n)>0)for(o=t;o<i;o+=n)a=Sv(o,e[o],e[o+1],a);else for(o=i-n;o>=t;o-=n)a=Sv(o,e[o],e[o+1],a);return a&&xv(a,a.next)&&(Ev(a),a=a.next),a}function ov(e,t){if(!e)return e;t||(t=e);var i,n=e;do{if(i=!1,n.steiner||!xv(n,n.next)&&0!==yv(n.prev,n,n.next))n=n.next;else {if(Ev(n),(n=t=n.prev)===n.next)break;i=!0;}}while(i||n!==t);return t}function av(e,t,i,n,r,o,a){if(e){!a&&o&&function(e,t,i,n){var r=e;do{0===r.z&&(r.z=fv(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,i,n,r,o,a,s,l,u=1;do{for(i=e,e=null,o=null,a=0;i;){for(a++,n=i,s=0,t=0;t<u&&(s++,n=n.nextZ);t++);for(l=u;s>0||l>0&&n;)0!==s&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,s--):(r=n,n=n.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;i=n;}o.nextZ=null,u*=2;}while(a>1)}(r);}(e,n,r,o);for(var s,l,u=e;e.prev!==e.next;)if(s=e.prev,l=e.next,o?lv(e,n,r,o):sv(e))t.push(s.i/i|0),t.push(e.i/i|0),t.push(l.i/i|0),Ev(e),e=l.next,u=l.next;else if((e=l)===u){a?1===a?av(e=uv(ov(e),t,i),t,i,n,r,o,2):2===a&&cv(e,t,i,n,r,o):av(ov(e),t,i,n,r,o,1);break}}}function sv(e){var t=e.prev,i=e,n=e.next;if(yv(t,i,n)>=0)return !1;for(var r=t.x,o=i.x,a=n.x,s=t.y,l=i.y,u=n.y,c=r<o?r<a?r:a:o<a?o:a,h=s<l?s<u?s:u:l<u?l:u,d=r>o?r>a?r:a:o>a?o:a,p=s>l?s>u?s:u:l>u?l:u,f=n.next;f!==t;){if(f.x>=c&&f.x<=d&&f.y>=h&&f.y<=p&&_v(r,s,o,l,a,u,f.x,f.y)&&yv(f.prev,f,f.next)>=0)return !1;f=f.next;}return !0}function lv(e,t,i,n){var r=e.prev,o=e,a=e.next;if(yv(r,o,a)>=0)return !1;for(var s=r.x,l=o.x,u=a.x,c=r.y,h=o.y,d=a.y,p=s<l?s<u?s:u:l<u?l:u,f=c<h?c<d?c:d:h<d?h:d,m=s>l?s>u?s:u:l>u?l:u,_=c>h?c>d?c:d:h>d?h:d,g=fv(p,f,t,i,n),y=fv(m,_,t,i,n),x=e.prevZ,v=e.nextZ;x&&x.z>=g&&v&&v.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=_&&x!==r&&x!==a&&_v(s,c,l,h,u,d,x.x,x.y)&&yv(x.prev,x,x.next)>=0)return !1;if(x=x.prevZ,v.x>=p&&v.x<=m&&v.y>=f&&v.y<=_&&v!==r&&v!==a&&_v(s,c,l,h,u,d,v.x,v.y)&&yv(v.prev,v,v.next)>=0)return !1;v=v.nextZ;}for(;x&&x.z>=g;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=_&&x!==r&&x!==a&&_v(s,c,l,h,u,d,x.x,x.y)&&yv(x.prev,x,x.next)>=0)return !1;x=x.prevZ;}for(;v&&v.z<=y;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=_&&v!==r&&v!==a&&_v(s,c,l,h,u,d,v.x,v.y)&&yv(v.prev,v,v.next)>=0)return !1;v=v.nextZ;}return !0}function uv(e,t,i){var n=e;do{var r=n.prev,o=n.next.next;!xv(r,o)&&vv(r,n,n.next,o)&&bv(r,o)&&bv(o,r)&&(t.push(r.i/i|0),t.push(n.i/i|0),t.push(o.i/i|0),Ev(n),Ev(n.next),n=e=o),n=n.next;}while(n!==e);return ov(n)}function cv(e,t,i,n,r,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&gv(a,s)){var l=Pv(a,s);return a=ov(a,a.next),l=ov(l,l.next),av(a,t,i,n,r,o,0),void av(l,t,i,n,r,o,0)}s=s.next;}a=a.next;}while(a!==e)}function hv(e,t){return e.x-t.x}function dv(e,t){var i=function(e,t){var i,n=t,r=e.x,o=e.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=r&&s>a&&(a=s,i=n.x<n.next.x?n:n.next,s===r))return i}n=n.next;}while(n!==t);if(!i)return null;var l,u=i,c=i.x,h=i.y,d=1/0;n=i;do{r>=n.x&&n.x>=c&&r!==n.x&&_v(o<h?r:a,o,c,h,o<h?a:r,o,n.x,n.y)&&(l=Math.abs(o-n.y)/(r-n.x),bv(n,e)&&(l<d||l===d&&(n.x>i.x||n.x===i.x&&pv(i,n)))&&(i=n,d=l)),n=n.next;}while(n!==u);return i}(e,t);if(!i)return t;var n=Pv(i,e);return ov(n,n.next),ov(i,i.next)}function pv(e,t){return yv(e.prev,e,t.prev)<0&&yv(t.next,e,e.next)<0}function fv(e,t,i,n,r){return (e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function mv(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;}while(t!==e);return i}function _v(e,t,i,n,r,o,a,s){return (r-a)*(t-s)>=(e-a)*(o-s)&&(e-a)*(n-s)>=(i-a)*(t-s)&&(i-a)*(o-s)>=(r-a)*(n-s)}function gv(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&vv(i,i.next,e,t))return !0;i=i.next;}while(i!==e);return !1}(e,t)&&(bv(e,t)&&bv(t,e)&&function(e,t){var i=e,n=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;}while(i!==e);return n}(e,t)&&(yv(e.prev,e,t.prev)||yv(e,t.prev,t))||xv(e,t)&&yv(e.prev,e,e.next)>0&&yv(t.prev,t,t.next)>0)}function yv(e,t,i){return (t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function xv(e,t){return e.x===t.x&&e.y===t.y}function vv(e,t,i,n){var r=Tv(yv(e,t,i)),o=Tv(yv(e,t,n)),a=Tv(yv(i,n,e)),s=Tv(yv(i,n,t));return r!==o&&a!==s||!(0!==r||!wv(e,i,t))||!(0!==o||!wv(e,n,t))||!(0!==a||!wv(i,e,n))||!(0!==s||!wv(i,t,n))}function wv(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function Tv(e){return e>0?1:e<0?-1:0}function bv(e,t){return yv(e.prev,e,e.next)<0?yv(e,t,e.next)>=0&&yv(e,e.prev,t)>=0:yv(e,t,e.prev)<0||yv(e,e.next,t)<0}function Pv(e,t){var i=new Av(e.i,e.x,e.y),n=new Av(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function Sv(e,t,i,n){var r=new Av(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function Ev(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ);}function Av(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1;}function Cv(e,t,i,n){for(var r=0,o=t,a=i-n;o<i;o+=n)r+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return r}function Mv(e,t,i,n,r){Iv(e,t,i||0,n||e.length-1,r||Nv);}function Iv(e,t,i,n,r){for(;n>i;){if(n-i>600){var o=n-i+1,a=t-i+1,s=Math.log(o),l=.5*Math.exp(2*s/3),u=.5*Math.sqrt(s*l*(o-l)/o)*(a-o/2<0?-1:1);Iv(e,t,Math.max(i,Math.floor(t-a*l/o+u)),Math.min(n,Math.floor(t+(o-a)*l/o+u)),r);}var c=e[t],h=i,d=n;for(Lv(e,i,t),r(e[n],c)>0&&Lv(e,i,n);h<d;){for(Lv(e,h,d),h++,d--;r(e[h],c)<0;)h++;for(;r(e[d],c)>0;)d--;}0===r(e[i],c)?Lv(e,i,d):Lv(e,++d,n),d<=t&&(i=d+1),t<=d&&(n=d-1);}}function Lv(e,t,i){var n=e[t];e[t]=e[i],e[i]=n;}function Nv(e,t){return e<t?-1:e>t?1:0}function Rv(e,t){const i=e.length;if(i<=1)return [e];const n=[];let r,o;for(let t=0;t<i;t++){const i=Qe(e[t]);0!==i&&(e[t].area=Math.abs(i),void 0===o&&(o=i<0),o===i<0?(r&&n.push(r),r=[e[t]]):r.push(e[t]));}if(r&&n.push(r),t>1)for(let e=0;e<n.length;e++)n[e].length<=t||(Mv(n[e],t,1,n[e].length-1,Ov),n[e]=n[e].slice(0,t));return n}function Ov(e,t){return t.area-e.area}function Dv(e,t,i,n,r,o){if(r>=t&&o<=i)return e;if(r>i||o<t)return null;const a=[];for(let r=0;r<e.length;r++){const o=e[r],s=o.geometry,l=o.type,u=o.min[n],c=o.max[n];if(u>=t&&c<=i){a.push(o);continue}if(u>i||c<t)continue;const h="Point"===l?Fv(s,t,i,n):zv(s,t,i,n,0===n?Uv:Gv,"Polygon"===l);h.length&&a.push(Vv(o.tags,l,h,o.id));}return a.length?a:null}function Fv(e,t,i,n){const r=[];for(let o=0;o<e.length;o++){const a=e[o],s=a[n];s>=t&&s<=i&&r.push(a);}return r}function zv(e,t,i,n,r,o){const a=[];for(let s=0;s<e.length;s++){let l,u,c=0,h=0,d=null,p=[];const f=e[s],m=f.area,_=f.dist,g=f.outer,y=f.length;for(u=0;u<y-1;u++)l=d||f[u],d=f[u+1],c=h||l[n],h=d[n],c<t?h>i?(p.push(r(l,d,t),r(l,d,i)),o||(p=Bv(a,p,m,_,g))):h>=t&&p.push(r(l,d,t)):c>i?h<t?(p.push(r(l,d,i),r(l,d,t)),o||(p=Bv(a,p,m,_,g))):h<=i&&p.push(r(l,d,i)):(p.push(l),h<t?(p.push(r(l,d,t)),o||(p=Bv(a,p,m,_,g))):h>i&&(p.push(r(l,d,i)),o||(p=Bv(a,p,m,_,g))));l=f[y-1],c=l[n],c>=t&&c<=i&&p.push(l);const x=p[p.length-1];o&&x&&(p[0][0]!==x[0]||p[0][1]!==x[1])&&p.push(p[0]),Bv(a,p,m,_,g);}return a}function Bv(e,t,i,n,r){return t.length&&(t.area=i,t.dist=n,void 0!==r&&(t.outer=r),e.push(t)),[]}function Vv(e,t,i,n){const r={id:n||null,type:t,geometry:i,tags:e||null,min:[1/0,1/0],max:[-1/0,-1/0]};return function(e){const t=e.geometry,i=e.min,n=e.max;if(1===e.type)kv(i,n,t);else for(let e=0;e<t.length;e++)kv(i,n,t[e]);}(r),r}function kv(e,t,i){for(let n,r=0;r<i.length;r++)n=i[r],e[0]=Math.min(n[0],e[0]),t[0]=Math.max(n[0],t[0]),e[1]=Math.min(n[1],e[1]),t[1]=Math.max(n[1],t[1]);}function Uv(e,t,i){return [i,(i-e[0])*(t[1]-e[1])/(t[0]-e[0])+e[1]]}function Gv(e,t,i){return [(i-e[1])*(t[0]-e[0])/(t[1]-e[1])+e[0],i]}function Hv(e,t,i,n,r,o,a){if(!(e>1))return a.push(...o);{const s=Dv(o,t,t+(i-t)/2,0,0,8192),l=Dv(o,t+(i-t)/2,i,0,0,8192);if(s){const o=Dv(s,n,n+(r-n)/2,1,0,8192),l=Dv(s,n+(r-n)/2,r,1,0,8192);o&&Hv(e-1,t,t+(i-t)/2,n,n+(r-n)/2,o,a),l&&Hv(e-1,t,t+(i-t)/2,n+(r-n)/2,r,l,a);}if(l){const o=Dv(l,n,n+(r-n)/2,1,0,8192),s=Dv(l,n+(r-n)/2,r,1,0,8192);o&&Hv(e-1,t+(i-t)/2,i,n,n+(r-n)/2,o,a),s&&Hv(e-1,t+(i-t)/2,i,n+(r-n)/2,r,s,a);}}}function Yv(e){let t=8-e;return t<0&&(t=0),t}nv.deviation=function(e,t,i,n){var r=t&&t.length,o=Math.abs(Cv(e,0,r?t[0]*i:e.length,i));if(r)for(var a=0,s=t.length;a<s;a++)o-=Math.abs(Cv(e,t[a]*i,a<s-1?t[a+1]*i:e.length,i));var l=0;for(a=0;a<n.length;a+=3){var u=n[a]*i,c=n[a+1]*i,h=n[a+2]*i;l+=Math.abs((e[u]-e[h])*(e[c+1]-e[u+1])-(e[u]-e[c])*(e[h+1]-e[u+1]));}return 0===o&&0===l?0:Math.abs((l-o)/o)},nv.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},n=0,r=0;r<e.length;r++){for(var o=0;o<e[r].length;o++)for(var a=0;a<t;a++)i.vertices.push(e[r][o][a]);r>0&&i.holes.push(n+=e[r-1].length);}return i},tv.default=iv;const qv=Math.pow(2,7);function Xv(e,t,i,n,r,o,a){const s=Il(t,i,0,r,o,n,a);e[0]=s[0],e[1]=s[1],e[2]=s[2];}function Wv(e){if(!e)throw new Error("geojson is required");var t=[];return Te(e,(function(e){!function(e,t){var i=[],n=e.geometry;if(null!==n){switch(n.type){case"Polygon":i=_e(n);break;case"LineString":i=[_e(n)];}i.forEach((function(i){var n=function(e,t){var i=[];return e.reduce((function(e,n){var r,o,a,s,l,u,c=le([e,n],t);return c.bbox=[(a=(r=e)[0])<(l=(o=n)[0])?a:l,(s=r[1])<(u=o[1])?s:u,a>l?a:l,s>u?s:u],i.push(c),n})),i}(i,e.properties);n.forEach((function(e){e.id=t.length,t.push(e);}));}));}}(e,t);})),ue(t)}var jv=fd((function(e,t){e.exports=function(){function e(e,n,r,o,a){!function e(i,n,r,o,a){for(;o>r;){if(o-r>600){var s=o-r+1,l=n-r+1,u=Math.log(s),c=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*c*(s-c)/s)*(l-s/2<0?-1:1);e(i,n,Math.max(r,Math.floor(n-l*c/s+h)),Math.min(o,Math.floor(n+(s-l)*c/s+h)),a);}var d=i[n],p=r,f=o;for(t(i,r,n),a(i[o],d)>0&&t(i,r,o);p<f;){for(t(i,p,f),p++,f--;a(i[p],d)<0;)p++;for(;a(i[f],d)>0;)f--;}0===a(i[r],d)?t(i,r,f):t(i,++f,o),f<=n&&(r=f+1),n<=f&&(o=f-1);}}(e,n,r||0,o||e.length-1,a||i);}function t(e,t,i){var n=e[t];e[t]=e[i],e[i]=n;}function i(e,t){return e<t?-1:e>t?1:0}var n=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear();};function r(e,t,i){if(!i)return t.indexOf(e);for(var n=0;n<t.length;n++)if(i(e,t[n]))return n;return -1}function o(e,t){a(e,0,e.children.length,t,e);}function a(e,t,i,n,r){r||(r=f(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var o=t;o<i;o++){var a=e.children[o];s(r,e.leaf?n(a):a);}return r}function s(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function u(e,t){return e.minY-t.minY}function c(e){return (e.maxX-e.minX)*(e.maxY-e.minY)}function h(e){return e.maxX-e.minX+(e.maxY-e.minY)}function d(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function p(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function f(e){return {children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(t,i,n,r,o){for(var a=[i,n];a.length;)if(!((n=a.pop())-(i=a.pop())<=r)){var s=i+Math.ceil((n-i)/r/2)*r;e(t,s,i,n,o),a.push(i,s,s,n);}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(e){var t=this.data,i=[];if(!p(e,t))return i;for(var n=this.toBBox,r=[];t;){for(var o=0;o<t.children.length;o++){var a=t.children[o],s=t.leaf?n(a):a;p(e,s)&&(t.leaf?i.push(a):d(e,s)?this._all(a,i):r.push(a));}t=r.pop();}return i},n.prototype.collides=function(e){var t=this.data;if(!p(e,t))return !1;for(var i=[];t;){for(var n=0;n<t.children.length;n++){var r=t.children[n],o=t.leaf?this.toBBox(r):r;if(p(e,o)){if(t.leaf||d(e,o))return !0;i.push(r);}}t=i.pop();}return !1},n.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var i=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else {if(this.data.height<i.height){var n=this.data;this.data=i,i=n;}this._insert(i,this.data.height-i.height-1,!0);}else this.data=i;return this},n.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},n.prototype.clear=function(){return this.data=f([]),this},n.prototype.remove=function(e,t){if(!e)return this;for(var i,n,o,a=this.data,s=this.toBBox(e),l=[],u=[];a||l.length;){if(a||(a=l.pop(),n=l[l.length-1],i=u.pop(),o=!0),a.leaf){var c=r(e,a.children,t);if(-1!==c)return a.children.splice(c,1),l.push(a),this._condense(l),this}o||a.leaf||!d(a,s)?n?(i++,a=n.children[i],o=!1):a=null:(l.push(a),u.push(i),i=0,n=a,a=a.children[0]);}return this},n.prototype.toBBox=function(e){return e},n.prototype.compareMinX=function(e,t){return e.minX-t.minX},n.prototype.compareMinY=function(e,t){return e.minY-t.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(e){return this.data=e,this},n.prototype._all=function(e,t){for(var i=[];e;)e.leaf?t.push.apply(t,e.children):i.push.apply(i,e.children),e=i.pop();return t},n.prototype._build=function(e,t,i,n){var r,a=i-t+1,s=this._maxEntries;if(a<=s)return o(r=f(e.slice(t,i+1)),this.toBBox),r;n||(n=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,n-1))),(r=f([])).leaf=!1,r.height=n;var l=Math.ceil(a/s),u=l*Math.ceil(Math.sqrt(s));m(e,t,i,u,this.compareMinX);for(var c=t;c<=i;c+=u){var h=Math.min(c+u-1,i);m(e,c,h,l,this.compareMinY);for(var d=c;d<=h;d+=l){var p=Math.min(d+l-1,h);r.children.push(this._build(e,d,p,n-1));}}return o(r,this.toBBox),r},n.prototype._chooseSubtree=function(e,t,i,n){for(;n.push(t),!t.leaf&&n.length-1!==i;){for(var r=1/0,o=1/0,a=void 0,s=0;s<t.children.length;s++){var l=t.children[s],u=c(l),h=(d=e,p=l,(Math.max(p.maxX,d.maxX)-Math.min(p.minX,d.minX))*(Math.max(p.maxY,d.maxY)-Math.min(p.minY,d.minY))-u);h<o?(o=h,r=u<r?u:r,a=l):h===o&&u<r&&(r=u,a=l);}t=a||t.children[0];}var d,p;return t},n.prototype._insert=function(e,t,i){var n=i?e:this.toBBox(e),r=[],o=this._chooseSubtree(n,this.data,t,r);for(o.children.push(e),s(o,n);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(n,r,t);},n.prototype._split=function(e,t){var i=e[t],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);var a=this._chooseSplitIndex(i,r,n),s=f(i.children.splice(a,i.children.length-a));s.height=i.height,s.leaf=i.leaf,o(i,this.toBBox),o(s,this.toBBox),t?e[t-1].children.push(s):this._splitRoot(i,s);},n.prototype._splitRoot=function(e,t){this.data=f([e,t]),this.data.height=e.height+1,this.data.leaf=!1,o(this.data,this.toBBox);},n.prototype._chooseSplitIndex=function(e,t,i){for(var n,r,o,s,l,u,h,d=1/0,p=1/0,f=t;f<=i-t;f++){var m=a(e,0,f,this.toBBox),_=a(e,f,i,this.toBBox),g=(r=m,o=_,s=Math.max(r.minX,o.minX),l=Math.max(r.minY,o.minY),u=Math.min(r.maxX,o.maxX),h=Math.min(r.maxY,o.maxY),Math.max(0,u-s)*Math.max(0,h-l)),y=c(m)+c(_);g<d?(d=g,n=f,p=y<p?y:p):g===d&&y<p&&(p=y,n=f);}return n||i-t},n.prototype._chooseSplitAxis=function(e,t,i){var n=e.leaf?this.compareMinX:l,r=e.leaf?this.compareMinY:u;this._allDistMargin(e,t,i,n)<this._allDistMargin(e,t,i,r)&&e.children.sort(n);},n.prototype._allDistMargin=function(e,t,i,n){e.children.sort(n);for(var r=this.toBBox,o=a(e,0,t,r),l=a(e,i-t,i,r),u=h(o)+h(l),c=t;c<i-t;c++){var d=e.children[c];s(o,e.leaf?r(d):d),u+=h(o);}for(var p=i-t-1;p>=t;p--){var f=e.children[p];s(l,e.leaf?r(f):f),u+=h(l);}return u},n.prototype._adjustParentBBoxes=function(e,t,i){for(var n=i;n>=0;n--)s(t[n],e);},n.prototype._condense=function(e){for(var t=e.length-1,i=void 0;t>=0;t--)0===e[t].children.length?t>0?(i=e[t-1].children).splice(i.indexOf(e[t]),1):this.clear():o(e[t],this.toBBox);},n}();})),$v=fd((function(e,t){function i(e,t,i){void 0===i&&(i={});var n={type:"Feature"};return (0===i.id||i.id)&&(n.id=i.id),i.bbox&&(n.bbox=i.bbox),n.properties=t||{},n.geometry=e,n}function n(e,t,n){if(void 0===n&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!p(e[0])||!p(e[1]))throw new Error("coordinates must contain numbers");return i({type:"Point",coordinates:e},t,n)}function r(e,t,n){void 0===n&&(n={});for(var r=0,o=e;r<o.length;r++){var a=o[r];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<a[a.length-1].length;s++)if(a[a.length-1][s]!==a[0][s])throw new Error("First and last Position are not equivalent.")}return i({type:"Polygon",coordinates:e},t,n)}function o(e,t,n){if(void 0===n&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return i({type:"LineString",coordinates:e},t,n)}function a(e,t){void 0===t&&(t={});var i={type:"FeatureCollection"};return t.id&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.features=e,i}function s(e,t,n){return void 0===n&&(n={}),i({type:"MultiLineString",coordinates:e},t,n)}function l(e,t,n){return void 0===n&&(n={}),i({type:"MultiPoint",coordinates:e},t,n)}function u(e,t,n){return void 0===n&&(n={}),i({type:"MultiPolygon",coordinates:e},t,n)}function c(e,i){void 0===i&&(i="kilometers");var n=t.factors[i];if(!n)throw new Error(i+" units is invalid");return e*n}function h(e,i){void 0===i&&(i="kilometers");var n=t.factors[i];if(!n)throw new Error(i+" units is invalid");return e/n}function d(e){return e%(2*Math.PI)*180/Math.PI}function p(e){return !isNaN(e)&&null!==e&&!Array.isArray(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.earthRadius=6371008.8,t.factors={centimeters:100*t.earthRadius,centimetres:100*t.earthRadius,degrees:t.earthRadius/111325,feet:3.28084*t.earthRadius,inches:39.37*t.earthRadius,kilometers:t.earthRadius/1e3,kilometres:t.earthRadius/1e3,meters:t.earthRadius,metres:t.earthRadius,miles:t.earthRadius/1609.344,millimeters:1e3*t.earthRadius,millimetres:1e3*t.earthRadius,nauticalmiles:t.earthRadius/1852,radians:1,yards:1.0936*t.earthRadius},t.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/t.earthRadius,yards:1.0936133},t.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},t.feature=i,t.geometry=function(e,t,i){switch(e){case"Point":return n(t).geometry;case"LineString":return o(t).geometry;case"Polygon":return r(t).geometry;case"MultiPoint":return l(t).geometry;case"MultiLineString":return s(t).geometry;case"MultiPolygon":return u(t).geometry;default:throw new Error(e+" is invalid")}},t.point=n,t.points=function(e,t,i){return void 0===i&&(i={}),a(e.map((function(e){return n(e,t)})),i)},t.polygon=r,t.polygons=function(e,t,i){return void 0===i&&(i={}),a(e.map((function(e){return r(e,t)})),i)},t.lineString=o,t.lineStrings=function(e,t,i){return void 0===i&&(i={}),a(e.map((function(e){return o(e,t)})),i)},t.featureCollection=a,t.multiLineString=s,t.multiPoint=l,t.multiPolygon=u,t.geometryCollection=function(e,t,n){return void 0===n&&(n={}),i({type:"GeometryCollection",geometries:e},t,n)},t.round=function(e,t){if(void 0===t&&(t=0),t&&!(t>=0))throw new Error("precision must be a positive number");var i=Math.pow(10,t||0);return Math.round(e*i)/i},t.radiansToLength=c,t.lengthToRadians=h,t.lengthToDegrees=function(e,t){return d(h(e,t))},t.bearingToAzimuth=function(e){var t=e%360;return t<0&&(t+=360),t},t.radiansToDegrees=d,t.degreesToRadians=function(e){return e%360*Math.PI/180},t.convertLength=function(e,t,i){if(void 0===t&&(t="kilometers"),void 0===i&&(i="kilometers"),!(e>=0))throw new Error("length must be a positive number");return c(h(e,t),i)},t.convertArea=function(e,i,n){if(void 0===i&&(i="meters"),void 0===n&&(n="kilometers"),!(e>=0))throw new Error("area must be a positive number");var r=t.areaFactors[i];if(!r)throw new Error("invalid original units");var o=t.areaFactors[n];if(!o)throw new Error("invalid final units");return e/r*o},t.isNumber=p,t.isObject=function(e){return !!e&&e.constructor===Object},t.validateBBox=function(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(4!==e.length&&6!==e.length)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach((function(e){if(!p(e))throw new Error("bbox must only contain numbers")}));},t.validateId=function(e){if(!e)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof e))throw new Error("id must be a number or a string")};})),Zv=$v;function Kv(e,t,i){if(null!==e)for(var n,r,o,a,s,l,u,c,h=0,d=0,p=e.type,f="FeatureCollection"===p,m="Feature"===p,_=f?e.features.length:1,g=0;g<_;g++){s=(c=!!(u=f?e.features[g].geometry:m?e.geometry:e)&&"GeometryCollection"===u.type)?u.geometries.length:1;for(var y=0;y<s;y++){var x=0,v=0;if(null!==(a=c?u.geometries[y]:u)){l=a.coordinates;var w=a.type;switch(h=!i||"Polygon"!==w&&"MultiPolygon"!==w?0:1,w){case null:break;case"Point":if(!1===t(l,d,g,x,v))return !1;d++,x++;break;case"LineString":case"MultiPoint":for(n=0;n<l.length;n++){if(!1===t(l[n],d,g,x,v))return !1;d++,"MultiPoint"===w&&x++;}"LineString"===w&&x++;break;case"Polygon":case"MultiLineString":for(n=0;n<l.length;n++){for(r=0;r<l[n].length-h;r++){if(!1===t(l[n][r],d,g,x,v))return !1;d++;}"MultiLineString"===w&&x++,"Polygon"===w&&v++;}"Polygon"===w&&x++;break;case"MultiPolygon":for(n=0;n<l.length;n++){for(v=0,r=0;r<l[n].length;r++){for(o=0;o<l[n][r].length-h;o++){if(!1===t(l[n][r][o],d,g,x,v))return !1;d++;}v++;}x++;}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)if(!1===Kv(a.geometries[n],t,i))return !1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Qv(e,t){var i;switch(e.type){case"FeatureCollection":for(i=0;i<e.features.length&&!1!==t(e.features[i].properties,i);i++);break;case"Feature":t(e.properties,0);}}function Jv(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var i=0;i<e.features.length&&!1!==t(e.features[i],i);i++);}function ew(e,t){var i,n,r,o,a,s,l,u,c,h,d=0,p="FeatureCollection"===e.type,f="Feature"===e.type,m=p?e.features.length:1;for(i=0;i<m;i++){for(u=p?e.features[i].properties:f?e.properties:{},c=p?e.features[i].bbox:f?e.bbox:void 0,h=p?e.features[i].id:f?e.id:void 0,a=(l=!!(s=p?e.features[i].geometry:f?e.geometry:e)&&"GeometryCollection"===s.type)?s.geometries.length:1,r=0;r<a;r++)if(null!==(o=l?s.geometries[r]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,d,u,c,h))return !1;break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(!1===t(o.geometries[n],d,u,c,h))return !1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,d,u,c,h))return !1;d++;}}function tw(e,t){ew(e,(function(e,i,n,r,o){var a,s=null===e?null:e.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return !1!==t(Zv.feature(e,n,{bbox:r,id:o}),i,0)&&void 0}switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";}for(var l=0;l<e.coordinates.length;l++)if(!1===t(Zv.feature({type:a,coordinates:e.coordinates[l]},n),i,l))return !1}));}function iw(e,t){tw(e,(function(e,i,n){var r=0;if(e.geometry){var o=e.geometry.type;if("Point"!==o&&"MultiPoint"!==o){var a,s=0,l=0,u=0;return !1!==Kv(e,(function(o,c,h,d,p){if(void 0===a||i>s||d>l||p>u)return a=o,s=i,l=d,u=p,void(r=0);var f=Zv.lineString([a,o],e.properties);if(!1===t(f,i,n,p,r))return !1;r++,a=o;}))&&void 0}}}));}function nw(e,t){if(!e)throw new Error("geojson is required");tw(e,(function(e,i,n){if(null!==e.geometry){var r=e.geometry.coordinates;switch(e.geometry.type){case"LineString":if(!1===t(e,i,n,0,0))return !1;break;case"Polygon":for(var o=0;o<r.length;o++)if(!1===t(Zv.lineString(r[o],e.properties),i,n,o))return !1}}}));}var rw=Object.defineProperty({coordAll:function(e){var t=[];return Kv(e,(function(e){t.push(e);})),t},coordEach:Kv,coordReduce:function(e,t,i,n){var r=i;return Kv(e,(function(e,n,o,a,s){r=0===n&&void 0===i?e:t(r,e,n,o,a,s);}),n),r},featureEach:Jv,featureReduce:function(e,t,i){var n=i;return Jv(e,(function(e,r){n=0===r&&void 0===i?e:t(n,e,r);})),n},findPoint:function(e,t){if(!Zv.isObject(t=t||{}))throw new Error("options is invalid");var i,n=t.featureIndex||0,r=t.multiFeatureIndex||0,o=t.geometryIndex||0,a=t.coordIndex||0,s=t.properties;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),s=s||e.features[n].properties,i=e.features[n].geometry;break;case"Feature":s=s||e.properties,i=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":i=e;break;default:throw new Error("geojson is invalid")}if(null===i)return null;var l=i.coordinates;switch(i.type){case"Point":return Zv.point(l,s,t);case"MultiPoint":return r<0&&(r=l.length+r),Zv.point(l[r],s,t);case"LineString":return a<0&&(a=l.length+a),Zv.point(l[a],s,t);case"Polygon":return o<0&&(o=l.length+o),a<0&&(a=l[o].length+a),Zv.point(l[o][a],s,t);case"MultiLineString":return r<0&&(r=l.length+r),a<0&&(a=l[r].length+a),Zv.point(l[r][a],s,t);case"MultiPolygon":return r<0&&(r=l.length+r),o<0&&(o=l[r].length+o),a<0&&(a=l[r][o].length-a),Zv.point(l[r][o][a],s,t)}throw new Error("geojson is invalid")},findSegment:function(e,t){if(!Zv.isObject(t=t||{}))throw new Error("options is invalid");var i,n=t.featureIndex||0,r=t.multiFeatureIndex||0,o=t.geometryIndex||0,a=t.segmentIndex||0,s=t.properties;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),s=s||e.features[n].properties,i=e.features[n].geometry;break;case"Feature":s=s||e.properties,i=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":i=e;break;default:throw new Error("geojson is invalid")}if(null===i)return null;var l=i.coordinates;switch(i.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=l.length+a-1),Zv.lineString([l[a],l[a+1]],s,t);case"Polygon":return o<0&&(o=l.length+o),a<0&&(a=l[o].length+a-1),Zv.lineString([l[o][a],l[o][a+1]],s,t);case"MultiLineString":return r<0&&(r=l.length+r),a<0&&(a=l[r].length+a-1),Zv.lineString([l[r][a],l[r][a+1]],s,t);case"MultiPolygon":return r<0&&(r=l.length+r),o<0&&(o=l[r].length+o),a<0&&(a=l[r][o].length-a-1),Zv.lineString([l[r][o][a],l[r][o][a+1]],s,t)}throw new Error("geojson is invalid")},flattenEach:tw,flattenReduce:function(e,t,i){var n=i;return tw(e,(function(e,r,o){n=0===r&&0===o&&void 0===i?e:t(n,e,r,o);})),n},geomEach:ew,geomReduce:function(e,t,i){var n=i;return ew(e,(function(e,r,o,a,s){n=0===r&&void 0===i?e:t(n,e,r,o,a,s);})),n},lineEach:nw,lineReduce:function(e,t,i){var n=i;return nw(e,(function(e,r,o,a){n=0===r&&void 0===i?e:t(n,e,r,o,a);})),n},propEach:Qv,propReduce:function(e,t,i){var n=i;return Qv(e,(function(e,r){n=0===r&&void 0===i?e:t(n,e,r);})),n},segmentEach:iw,segmentReduce:function(e,t,i){var n=i,r=!1;return iw(e,(function(e,o,a,s,l){n=!1===r&&void 0===i?e:t(n,e,o,a,s,l),r=!0;})),n}},"__esModule",{value:!0});function ow(e){var t=[1/0,1/0,-1/0,-1/0];return rw.coordEach(e,(function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1]);})),t}ow.default=ow;var aw=Object.defineProperty({default:ow},"__esModule",{value:!0}).default,sw=rw.featureEach,lw=Zv.featureCollection;function uw(e){var t=new jv(e);return t.insert=function(e){if("Feature"!==e.type)throw new Error("invalid feature");return e.bbox=e.bbox?e.bbox:aw(e),jv.prototype.insert.call(this,e)},t.load=function(e){var t=[];return Array.isArray(e)?e.forEach((function(e){if("Feature"!==e.type)throw new Error("invalid features");e.bbox=e.bbox?e.bbox:aw(e),t.push(e);})):sw(e,(function(e){if("Feature"!==e.type)throw new Error("invalid features");e.bbox=e.bbox?e.bbox:aw(e),t.push(e);})),jv.prototype.load.call(this,t)},t.remove=function(e,t){if("Feature"!==e.type)throw new Error("invalid feature");return e.bbox=e.bbox?e.bbox:aw(e),jv.prototype.remove.call(this,e,t)},t.clear=function(){return jv.prototype.clear.call(this)},t.search=function(e){var t=jv.prototype.search.call(this,this.toBBox(e));return lw(t)},t.collides=function(e){return jv.prototype.collides.call(this,this.toBBox(e))},t.all=function(){var e=jv.prototype.all.call(this);return lw(e)},t.toJSON=function(){return jv.prototype.toJSON.call(this)},t.fromJSON=function(e){return jv.prototype.fromJSON.call(this,e)},t.toBBox=function(e){var t;if(e.bbox)t=e.bbox;else if(Array.isArray(e)&&4===e.length)t=e;else if(Array.isArray(e)&&6===e.length)t=[e[0],e[1],e[3],e[4]];else if("Feature"===e.type)t=aw(e);else {if("FeatureCollection"!==e.type)throw new Error("invalid geojson");t=aw(e);}return {minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}},t}var cw=uw;function hw(e,t){var i={},n=[];if("LineString"===e.type&&(e=oe(e)),"LineString"===t.type&&(t=oe(t)),"Feature"===e.type&&"Feature"===t.type&&null!==e.geometry&&null!==t.geometry&&"LineString"===e.geometry.type&&"LineString"===t.geometry.type&&2===e.geometry.coordinates.length&&2===t.geometry.coordinates.length){var r=dw(e,t);return r&&n.push(r),ue(n)}var o=cw();return o.load(Wv(t)),we(Wv(e),(function(e){we(o.search(e),(function(t){var r=dw(e,t);if(r){var o=_e(r).join(",");i[o]||(i[o]=!0,n.push(r));}}));})),ue(n)}function dw(e,t){var i=_e(e),n=_e(t);if(2!==i.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==n.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var r=i[0][0],o=i[0][1],a=i[1][0],s=i[1][1],l=n[0][0],u=n[0][1],c=n[1][0],h=n[1][1],d=(h-u)*(a-r)-(c-l)*(s-o);if(0===d)return null;var p=((c-l)*(o-u)-(h-u)*(r-l))/d,f=((a-r)*(o-u)-(s-o)*(r-l))/d;return p>=0&&p<=1&&f>=0&&f<=1?ae([r+p*(a-r),o+p*(s-o)]):null}cw.default=uw;var pw=fd((function(e,t){e.exports=function(){var e=function(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null;};function t(e,t){return e>t?1:e<t?-1:0}function i(t,i,n){for(var r=new e(null,null),o=r,a=r;;){var s=n(t,i.key);if(s<0){if(null===i.left)break;if(n(t,i.left.key)<0&&(i.left=(l=i.left).right,l.right=i,null===(i=l).left))break;a.left=i,a=i,i=i.left;}else {if(!(s>0))break;if(null===i.right)break;var l;if(n(t,i.right.key)>0&&(i.right=(l=i.right).left,l.left=i,null===(i=l).right))break;o.right=i,o=i,i=i.right;}}return o.right=i.left,a.left=i.right,i.left=r.right,i.right=r.left,i}function n(t,n,r,o){var a=new e(t,n);if(null===r)return a.left=a.right=null,a;var s=o(t,(r=i(t,r,o)).key);return s<0?(a.left=r.left,a.right=r,r.left=null):s>=0&&(a.right=r.right,a.left=r,r.right=null),a}function r(e,t,n){var r=null,o=null;if(t){var a=n((t=i(e,t,n)).key,e);0===a?(r=t.left,o=t.right):a<0?(o=t.right,t.right=null,r=t):(r=t.left,t.left=null,o=t);}return {left:r,right:o}}function o(e,t,i,n,r){if(e){n(t+(i?"└── ":"├── ")+r(e)+"\n");var a=t+(i?"    ":"│   ");e.left&&o(e.left,a,!1,n,r),e.right&&o(e.right,a,!0,n,r);}}var a=function(){function a(e){void 0===e&&(e=t),this._root=null,this._size=0,this._comparator=e;}return a.prototype.insert=function(e,t){return this._size++,this._root=n(e,t,this._root,this._comparator)},a.prototype.add=function(t,n){var r=new e(t,n);null===this._root&&(r.left=r.right=null,this._size++,this._root=r);var o=this._comparator,a=i(t,this._root,o),s=o(t,a.key);return 0===s?this._root=a:(s<0?(r.left=a.left,r.right=a,a.left=null):s>0&&(r.right=a.right,r.left=a,a.right=null),this._size++,this._root=r),this._root},a.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator);},a.prototype._remove=function(e,t,n){var r;return null===t?null:0===n(e,(t=i(e,t,n)).key)?(null===t.left?r=t.right:(r=i(e,t.left,n)).right=t.right,this._size--,r):t},a.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=i(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},a.prototype.findStatic=function(e){for(var t=this._root,i=this._comparator;t;){var n=i(e,t.key);if(0===n)return t;t=n<0?t.left:t.right;}return null},a.prototype.find=function(e){return this._root&&(this._root=i(e,this._root,this._comparator),0!==this._comparator(e,this._root.key))?null:this._root},a.prototype.contains=function(e){for(var t=this._root,i=this._comparator;t;){var n=i(e,t.key);if(0===n)return !0;t=n<0?t.left:t.right;}return !1},a.prototype.forEach=function(e,t){for(var i=this._root,n=[],r=!1;!r;)null!==i?(n.push(i),i=i.left):0!==n.length?(i=n.pop(),e.call(t,i),i=i.right):r=!0;return this},a.prototype.range=function(e,t,i,n){for(var r=[],o=this._comparator,a=this._root;0!==r.length||a;)if(a)r.push(a),a=a.left;else {if(o((a=r.pop()).key,t)>0)break;if(o(a.key,e)>=0&&i.call(n,a))return this;a=a.right;}return this},a.prototype.keys=function(){var e=[];return this.forEach((function(t){return e.push(t.key)})),e},a.prototype.values=function(){var e=[];return this.forEach((function(t){return e.push(t.data)})),e},a.prototype.min=function(){return this._root?this.minNode(this._root).key:null},a.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},a.prototype.minNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.left;)e=e.left;return e},a.prototype.maxNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.right;)e=e.right;return e},a.prototype.at=function(e){for(var t=this._root,i=!1,n=0,r=[];!i;)if(t)r.push(t),t=t.left;else if(r.length>0){if(t=r.pop(),n===e)return t;n++,t=t.right;}else i=!0;return null},a.prototype.next=function(e){var t=this._root,i=null;if(e.right){for(i=e.right;i.left;)i=i.left;return i}for(var n=this._comparator;t;){var r=n(e.key,t.key);if(0===r)break;r<0?(i=t,t=t.left):t=t.right;}return i},a.prototype.prev=function(e){var t=this._root,i=null;if(null!==e.left){for(i=e.left;i.right;)i=i.right;return i}for(var n=this._comparator;t;){var r=n(e.key,t.key);if(0===r)break;r<0?t=t.left:(i=t,t=t.right);}return i},a.prototype.clear=function(){return this._root=null,this._size=0,this},a.prototype.toList=function(){return function(t){for(var i=t,n=[],r=!1,o=new e(null,null),a=o;!r;)i?(n.push(i),i=i.left):n.length>0?i=(i=a=a.next=n.pop()).right:r=!0;return a.next=null,o.next}(this._root)},a.prototype.load=function(t,i,n){void 0===i&&(i=[]),void 0===n&&(n=!1);var r=t.length,o=this._comparator;if(n&&u(t,i,0,r-1,o),null===this._root)this._root=s(t,i,0,r),this._size=r;else {var a=function(t,i,n){for(var r=new e(null,null),o=r,a=t,s=i;null!==a&&null!==s;)n(a.key,s.key)<0?(o.next=a,a=a.next):(o.next=s,s=s.next),o=o.next;return null!==a?o.next=a:null!==s&&(o.next=s),r.next}(this.toList(),function(t,i){for(var n=new e(null,null),r=n,o=0;o<t.length;o++)r=r.next=new e(t[o],i[o]);return r.next=null,n.next}(t,i),o);this._root=l({head:a},0,r=this._size+r);}return this},a.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(a.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),a.prototype.toString=function(e){void 0===e&&(e=function(e){return String(e.key)});var t=[];return o(this._root,"",!0,(function(e){return t.push(e)}),e),t.join("")},a.prototype.update=function(e,t,o){var a=this._comparator,s=r(e,this._root,a),l=s.left,u=s.right;a(e,t)<0?u=n(t,o,u,a):l=n(t,o,l,a),this._root=function(e,t,n){return null===t?e:(null===e||((t=i(e.key,t,n)).left=e),t)}(l,u,a);},a.prototype.split=function(e){return r(e,this._root,this._comparator)},a.prototype[Symbol.iterator]=function(){var e,t,i;
/**
     * splaytree v3.1.2
     * Fast Splay tree for Node and browser
     *
     * @author Alexander Milevski <info@w8r.name>
     * @license MIT
     * @preserve
     */
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
return function(e,t){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a);}catch(e){o=[6,e],n=0;}finally{i=r=0;}if(5&o[0])throw o[1];return {value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,(function(n){switch(n.label){case 0:e=this._root,t=[],i=!1,n.label=1;case 1:return i?[3,6]:null===e?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return 0===t.length?[3,4]:[4,e=t.pop()];case 3:return n.sent(),e=e.right,[3,5];case 4:i=!0,n.label=5;case 5:return [3,1];case 6:return [2]}}))},a}();function s(t,i,n,r){var o=r-n;if(o>0){var a=n+Math.floor(o/2),l=new e(t[a],i[a]);return l.left=s(t,i,n,a),l.right=s(t,i,a+1,r),l}return null}function l(e,t,i){var n=i-t;if(n>0){var r=t+Math.floor(n/2),o=l(e,t,r),a=e.head;return a.left=o,e.head=e.head.next,a.right=l(e,r+1,i),a}return null}function u(e,t,i,n,r){if(!(i>=n)){for(var o=e[i+n>>1],a=i-1,s=n+1;;){do{a++;}while(r(e[a],o)<0);do{s--;}while(r(e[s],o)>0);if(a>=s)break;var l=e[a];e[a]=e[s],e[s]=l,l=t[a],t[a]=t[s],t[s]=l;}u(e,t,i,s,r),u(e,t,s+1,n,r);}}const c=(e,t)=>e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y,h=(e,t)=>t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y?null:{ll:{x:e.ll.x<t.ll.x?t.ll.x:e.ll.x,y:e.ll.y<t.ll.y?t.ll.y:e.ll.y},ur:{x:e.ur.x<t.ur.x?e.ur.x:t.ur.x,y:e.ur.y<t.ur.y?e.ur.y:t.ur.y}};let d=Number.EPSILON;void 0===d&&(d=Math.pow(2,-52));const p=d*d,f=(e,t)=>{if(-d<e&&e<d&&-d<t&&t<d)return 0;const i=e-t;return i*i<p*e*t?0:e<t?-1:1};class m{constructor(){this.tree=new a,this.round(0);}round(e){const t=this.tree.add(e),i=this.tree.prev(t);if(null!==i&&0===f(t.key,i.key))return this.tree.remove(e),i.key;const n=this.tree.next(t);return null!==n&&0===f(t.key,n.key)?(this.tree.remove(e),n.key):e}}const _=new class{constructor(){this.reset();}reset(){this.xRounder=new m,this.yRounder=new m;}round(e,t){return {x:this.xRounder.round(e),y:this.yRounder.round(t)}}},g=11102230246251565e-32,y=134217729,x=(3+8*g)*g;function v(e,t,i,n,r){let o,a,s,l,u=t[0],c=n[0],h=0,d=0;c>u==c>-u?(o=u,u=t[++h]):(o=c,c=n[++d]);let p=0;if(h<e&&d<i)for(c>u==c>-u?(a=u+o,s=o-(a-u),u=t[++h]):(a=c+o,s=o-(a-c),c=n[++d]),o=a,0!==s&&(r[p++]=s);h<e&&d<i;)c>u==c>-u?(a=o+u,l=a-o,s=o-(a-l)+(u-l),u=t[++h]):(a=o+c,l=a-o,s=o-(a-l)+(c-l),c=n[++d]),o=a,0!==s&&(r[p++]=s);for(;h<e;)a=o+u,l=a-o,s=o-(a-l)+(u-l),u=t[++h],o=a,0!==s&&(r[p++]=s);for(;d<i;)a=o+c,l=a-o,s=o-(a-l)+(c-l),c=n[++d],o=a,0!==s&&(r[p++]=s);return 0===o&&0!==p||(r[p++]=o),p}function w(e){return new Float64Array(e)}const T=w(4),b=w(8),P=w(12),S=w(16),E=w(4);const A=(e,t)=>e.x*t.y-e.y*t.x,C=(e,t)=>e.x*t.x+e.y*t.y,M=(e,t,i)=>{const n=function(e,t,i,n,r,o){const a=(t-o)*(i-r),s=(e-r)*(n-o),l=a-s,u=Math.abs(a+s);return Math.abs(l)>=33306690738754716e-32*u?l:-function(e,t,i,n,r,o,a){let s,l,u,c,h,d,p,f,m,_,g,w,A,C,M,I,L,N;const R=e-r,O=i-r,D=t-o,F=n-o;C=R*F,d=y*R,p=d-(d-R),f=R-p,d=y*F,m=d-(d-F),_=F-m,M=f*_-(C-p*m-f*m-p*_),I=D*O,d=y*D,p=d-(d-D),f=D-p,d=y*O,m=d-(d-O),_=O-m,L=f*_-(I-p*m-f*m-p*_),g=M-L,h=M-g,T[0]=M-(g+h)+(h-L),w=C+g,h=w-C,A=C-(w-h)+(g-h),g=A-I,h=A-g,T[1]=A-(g+h)+(h-I),N=w+g,h=N-w,T[2]=w-(N-h)+(g-h),T[3]=N;let z=function(e,t){let i=t[0];for(let e=1;e<4;e++)i+=t[e];return i}(0,T),B=22204460492503146e-32*a;if(z>=B||-z>=B)return z;if(h=e-R,s=e-(R+h)+(h-r),h=i-O,u=i-(O+h)+(h-r),h=t-D,l=t-(D+h)+(h-o),h=n-F,c=n-(F+h)+(h-o),0===s&&0===l&&0===u&&0===c)return z;if(B=11093356479670487e-47*a+x*Math.abs(z),z+=R*c+F*s-(D*u+O*l),z>=B||-z>=B)return z;C=s*F,d=y*s,p=d-(d-s),f=s-p,d=y*F,m=d-(d-F),_=F-m,M=f*_-(C-p*m-f*m-p*_),I=l*O,d=y*l,p=d-(d-l),f=l-p,d=y*O,m=d-(d-O),_=O-m,L=f*_-(I-p*m-f*m-p*_),g=M-L,h=M-g,E[0]=M-(g+h)+(h-L),w=C+g,h=w-C,A=C-(w-h)+(g-h),g=A-I,h=A-g,E[1]=A-(g+h)+(h-I),N=w+g,h=N-w,E[2]=w-(N-h)+(g-h),E[3]=N;const V=v(4,T,4,E,b);C=R*c,d=y*R,p=d-(d-R),f=R-p,d=y*c,m=d-(d-c),_=c-m,M=f*_-(C-p*m-f*m-p*_),I=D*u,d=y*D,p=d-(d-D),f=D-p,d=y*u,m=d-(d-u),_=u-m,L=f*_-(I-p*m-f*m-p*_),g=M-L,h=M-g,E[0]=M-(g+h)+(h-L),w=C+g,h=w-C,A=C-(w-h)+(g-h),g=A-I,h=A-g,E[1]=A-(g+h)+(h-I),N=w+g,h=N-w,E[2]=w-(N-h)+(g-h),E[3]=N;const k=v(V,b,4,E,P);C=s*c,d=y*s,p=d-(d-s),f=s-p,d=y*c,m=d-(d-c),_=c-m,M=f*_-(C-p*m-f*m-p*_),I=l*u,d=y*l,p=d-(d-l),f=l-p,d=y*u,m=d-(d-u),_=u-m,L=f*_-(I-p*m-f*m-p*_),g=M-L,h=M-g,E[0]=M-(g+h)+(h-L),w=C+g,h=w-C,A=C-(w-h)+(g-h),g=A-I,h=A-g,E[1]=A-(g+h)+(h-I),N=w+g,h=N-w,E[2]=w-(N-h)+(g-h),E[3]=N;const U=v(k,P,4,E,S);return S[U-1]}(e,t,i,n,r,o,u)}(e.x,e.y,t.x,t.y,i.x,i.y);return n>0?-1:n<0?1:0},I=e=>Math.sqrt(C(e,e)),L=(e,t,i)=>{const n={x:t.x-e.x,y:t.y-e.y},r={x:i.x-e.x,y:i.y-e.y};return A(r,n)/I(r)/I(n)},N=(e,t,i)=>{const n={x:t.x-e.x,y:t.y-e.y},r={x:i.x-e.x,y:i.y-e.y};return C(r,n)/I(r)/I(n)},R=(e,t,i)=>0===t.y?null:{x:e.x+t.x/t.y*(i-e.y),y:i},O=(e,t,i)=>0===t.x?null:{x:i,y:e.y+t.y/t.x*(i-e.x)};class D{static compare(e,t){const i=D.comparePoints(e.point,t.point);return 0!==i?i:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:z.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){void 0===e.events?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t;}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let e=0,i=t.length;e<i;e++){const i=t[e];this.point.events.push(i),i.point=this.point;}this.checkForConsuming();}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const i=this.point.events[t];if(void 0===i.segment.consumedBy)for(let n=t+1;n<e;n++){const e=this.point.events[n];void 0===e.consumedBy&&i.otherSE.point.events===e.otherSE.point.events&&i.segment.consume(e.segment);}}}getAvailableLinkedEvents(){const e=[];for(let t=0,i=this.point.events.length;t<i;t++){const i=this.point.events[t];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&e.push(i);}return e}getLeftmostComparator(e){const t=new Map,i=i=>{const n=i.otherSE;t.set(i,{sine:L(this.point,e.point,n.point),cosine:N(this.point,e.point,n.point)});};return (e,n)=>{t.has(e)||i(e),t.has(n)||i(n);const{sine:r,cosine:o}=t.get(e),{sine:a,cosine:s}=t.get(n);return r>=0&&a>=0?o<s?1:o>s?-1:0:r<0&&a<0?o<s?-1:o>s?1:0:a<r?-1:a>r?1:0}}}let F=0;class z{static compare(e,t){const i=e.leftSE.point.x,n=t.leftSE.point.x,r=e.rightSE.point.x,o=t.rightSE.point.x;if(o<i)return 1;if(r<n)return -1;const a=e.leftSE.point.y,s=t.leftSE.point.y,l=e.rightSE.point.y,u=t.rightSE.point.y;if(i<n){if(s<a&&s<l)return 1;if(s>a&&s>l)return -1;const i=e.comparePoint(t.leftSE.point);if(i<0)return 1;if(i>0)return -1;const n=t.comparePoint(e.rightSE.point);return 0!==n?n:-1}if(i>n){if(a<s&&a<u)return -1;if(a>s&&a>u)return 1;const i=t.comparePoint(e.leftSE.point);if(0!==i)return i;const n=e.comparePoint(t.rightSE.point);return n<0?1:n>0?-1:1}if(a<s)return -1;if(a>s)return 1;if(r<o){const i=t.comparePoint(e.rightSE.point);if(0!==i)return i}if(r>o){const i=e.comparePoint(t.rightSE.point);if(i<0)return 1;if(i>0)return -1}if(r!==o){const e=l-a,t=r-i,c=u-s,h=o-n;if(e>t&&c<h)return 1;if(e<t&&c>h)return -1}return r>o?1:r<o||l<u?-1:l>u?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,i,n){this.id=++F,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=i,this.windings=n;}static fromRing(e,t,i){let n,r,o;const a=D.comparePoints(e,t);if(a<0)n=e,r=t,o=1;else {if(!(a>0))throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);n=t,r=e,o=-1;}const s=new D(n,!0),l=new D(r,!1);return new z(s,l,[i],[o])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE;}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return {ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return {x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,i=this.rightSE.point,n=this.vector();if(t.x===i.x)return e.x===t.x?0:e.x<t.x?1:-1;if(e.x===t.x+(e.y-t.y)/n.y*n.x)return 0;const r=t.y+(e.x-t.x)/n.x*n.y;return e.y===r?0:e.y<r?-1:1}getIntersection(e){const t=this.bbox(),i=e.bbox(),n=h(t,i);if(null===n)return null;const r=this.leftSE.point,o=this.rightSE.point,a=e.leftSE.point,s=e.rightSE.point,l=c(t,a)&&0===this.comparePoint(a),u=c(i,r)&&0===e.comparePoint(r),d=c(t,s)&&0===this.comparePoint(s),p=c(i,o)&&0===e.comparePoint(o);if(u&&l)return p&&!d?o:!p&&d?s:null;if(u)return d&&r.x===s.x&&r.y===s.y?null:r;if(l)return p&&o.x===a.x&&o.y===a.y?null:a;if(p&&d)return null;if(p)return o;if(d)return s;const f=((e,t,i,n)=>{if(0===t.x)return O(i,n,e.x);if(0===n.x)return O(e,t,i.x);if(0===t.y)return R(i,n,e.y);if(0===n.y)return R(e,t,i.y);const r=A(t,n);if(0==r)return null;const o={x:i.x-e.x,y:i.y-e.y},a=A(o,t)/r,s=A(o,n)/r;return {x:(e.x+s*t.x+(i.x+a*n.x))/2,y:(e.y+s*t.y+(i.y+a*n.y))/2}})(r,this.vector(),a,e.vector());return null===f?null:c(n,f)?_.round(f.x,f.y):null}split(e){const t=[],i=void 0!==e.events,n=new D(e,!0),r=new D(e,!1),o=this.rightSE;this.replaceRightSE(r),t.push(r),t.push(n);const a=new z(n,o,this.rings.slice(),this.windings.slice());return D.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),D.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(n.checkForConsuming(),r.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let e=0,t=this.windings.length;e<t;e++)this.windings[e]*=-1;}consume(e){let t=this,i=e;for(;t.consumedBy;)t=t.consumedBy;for(;i.consumedBy;)i=i.consumedBy;const n=z.compare(t,i);if(0!==n){if(n>0){const e=t;t=i,i=e;}if(t.prev===i){const e=t;t=i,i=e;}for(let e=0,n=i.rings.length;e<n;e++){const n=i.rings[e],r=i.windings[e],o=t.rings.indexOf(n);-1===o?(t.rings.push(n),t.windings.push(r)):t.windings[o]+=r;}i.rings=null,i.windings=null,i.consumedBy=t,i.leftSE.consumedBy=t.leftSE,i.rightSE.consumedBy=t.rightSE;}}prevInResult(){return void 0!==this._prevInResult||(this._prevInResult=this.prev?this.prev.isInResult()?this.prev:this.prev.prevInResult():null),this._prevInResult}beforeState(){return void 0!==this._beforeState||(this._beforeState=this.prev?(this.prev.consumedBy||this.prev).afterState():{rings:[],windings:[],multiPolys:[]}),this._beforeState}afterState(){if(void 0!==this._afterState)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,i=this._afterState.windings,n=this._afterState.multiPolys;for(let e=0,n=this.rings.length;e<n;e++){const n=this.rings[e],r=this.windings[e],o=t.indexOf(n);-1===o?(t.push(n),i.push(r)):i[o]+=r;}const r=[],o=[];for(let e=0,n=t.length;e<n;e++){if(0===i[e])continue;const n=t[e],a=n.poly;if(-1===o.indexOf(a))if(n.isExterior)r.push(a);else {-1===o.indexOf(a)&&o.push(a);const e=r.indexOf(n.poly);-1!==e&&r.splice(e,1);}}for(let e=0,t=r.length;e<t;e++){const t=r[e].multiPoly;-1===n.indexOf(t)&&n.push(t);}return this._afterState}isInResult(){if(this.consumedBy)return !1;if(void 0!==this._isInResult)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(W.type){case"union":this._isInResult=0===e.length!=(0===t.length);break;case"intersection":{let i,n;e.length<t.length?(i=e.length,n=t.length):(i=t.length,n=e.length),this._isInResult=n===W.numMultiPolys&&i<n;break}case"xor":{const i=Math.abs(e.length-t.length);this._isInResult=i%2==1;break}case"difference":{const i=e=>1===e.length&&e[0].isSubject;this._isInResult=i(e)!==i(t);break}default:throw new Error(`Unrecognized operation type found ${W.type}`)}return this._isInResult}}class B{constructor(e,t,i){if(!Array.isArray(e)||0===e.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=i,this.segments=[],"number"!=typeof e[0][0]||"number"!=typeof e[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const n=_.round(e[0][0],e[0][1]);this.bbox={ll:{x:n.x,y:n.y},ur:{x:n.x,y:n.y}};let r=n;for(let t=1,i=e.length;t<i;t++){if("number"!=typeof e[t][0]||"number"!=typeof e[t][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let i=_.round(e[t][0],e[t][1]);i.x===r.x&&i.y===r.y||(this.segments.push(z.fromRing(r,i,this)),i.x<this.bbox.ll.x&&(this.bbox.ll.x=i.x),i.y<this.bbox.ll.y&&(this.bbox.ll.y=i.y),i.x>this.bbox.ur.x&&(this.bbox.ur.x=i.x),i.y>this.bbox.ur.y&&(this.bbox.ur.y=i.y),r=i);}n.x===r.x&&n.y===r.y||this.segments.push(z.fromRing(r,n,this));}getSweepEvents(){const e=[];for(let t=0,i=this.segments.length;t<i;t++){const i=this.segments[t];e.push(i.leftSE),e.push(i.rightSE);}return e}}class V{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new B(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let t=1,i=e.length;t<i;t++){const i=new B(e[t],this,!1);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.interiorRings.push(i);}this.multiPoly=t;}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,i=this.interiorRings.length;t<i;t++){const i=this.interiorRings[t].getSweepEvents();for(let t=0,n=i.length;t<n;t++)e.push(i[t]);}return e}}class k{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof e[0][0][0]&&(e=[e]);}catch(e){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let t=0,i=e.length;t<i;t++){const i=new V(e[t],this);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.polys.push(i);}this.isSubject=t;}getSweepEvents(){const e=[];for(let t=0,i=this.polys.length;t<i;t++){const i=this.polys[t].getSweepEvents();for(let t=0,n=i.length;t<n;t++)e.push(i[t]);}return e}}class U{static factory(e){const t=[];for(let i=0,n=e.length;i<n;i++){const n=e[i];if(!n.isInResult()||n.ringOut)continue;let r=null,o=n.leftSE,a=n.rightSE;const s=[o],l=o.point,u=[];for(;r=o,o=a,s.push(o),o.point!==l;)for(;;){const e=o.getAvailableLinkedEvents();if(0===e.length){const e=s[0].point,t=s[s.length-1].point;throw new Error(`Unable to complete output ring starting at [${e.x}, ${e.y}]. Last matching segment found ends at [${t.x}, ${t.y}].`)}if(1===e.length){a=e[0].otherSE;break}let i=null;for(let e=0,t=u.length;e<t;e++)if(u[e].point===o.point){i=e;break}if(null!==i){const e=u.splice(i)[0],n=s.splice(e.index);n.unshift(n[0].otherSE),t.push(new U(n.reverse()));continue}u.push({index:s.length,point:o.point});const n=o.getLeftmostComparator(r);a=e.sort(n)[0].otherSE;break}t.push(new U(s));}return t}constructor(e){this.events=e;for(let t=0,i=e.length;t<i;t++)e[t].segment.ringOut=this;this.poly=null;}getGeom(){let e=this.events[0].point;const t=[e];for(let i=1,n=this.events.length-1;i<n;i++){const n=this.events[i].point;0!==M(n,e,this.events[i+1].point)&&(t.push(n),e=n);}if(1===t.length)return null;0===M(t[0],e,t[1])&&t.shift(),t.push(t[0]);const i=this.isExteriorRing()?1:-1,n=this.isExteriorRing()?0:t.length-1,r=this.isExteriorRing()?t.length:-1,o=[];for(let e=n;e!=r;e+=i)o.push([t[e].x,t[e].y]);return o}isExteriorRing(){if(void 0===this._isExteriorRing){const e=this.enclosingRing();this._isExteriorRing=!e||!e.isExteriorRing();}return this._isExteriorRing}enclosingRing(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let t=1,i=this.events.length;t<i;t++){const i=this.events[t];D.compare(e,i)>0&&(e=i);}let t=e.segment.prevInResult(),i=t?t.prevInResult():null;for(;;){if(!t)return null;if(!i)return t.ringOut;if(i.ringOut!==t.ringOut)return i.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=i.prevInResult(),i=t?t.prevInResult():null;}}}class G{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[];}addInterior(e){this.interiorRings.push(e),e.poly=this;}getGeom(){const e=[this.exteriorRing.getGeom()];if(null===e[0])return null;for(let t=0,i=this.interiorRings.length;t<i;t++){const i=this.interiorRings[t].getGeom();null!==i&&e.push(i);}return e}}class H{constructor(e){this.rings=e,this.polys=this._composePolys(e);}getGeom(){const e=[];for(let t=0,i=this.polys.length;t<i;t++){const i=this.polys[t].getGeom();null!==i&&e.push(i);}return e}_composePolys(e){const t=[];for(let i=0,n=e.length;i<n;i++){const n=e[i];if(!n.poly)if(n.isExteriorRing())t.push(new G(n));else {const e=n.enclosingRing();e.poly||t.push(new G(e)),e.poly.addInterior(n);}}return t}}class Y{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z.compare;this.queue=e,this.tree=new a(t),this.segments=[];}process(e){const t=e.segment,i=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),i;const n=e.isLeft?this.tree.add(t):this.tree.find(t);if(!n)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let r,o,a=n,s=n;for(;void 0===r;)a=this.tree.prev(a),null===a?r=null:void 0===a.key.consumedBy&&(r=a.key);for(;void 0===o;)s=this.tree.next(s),null===s?o=null:void 0===s.key.consumedBy&&(o=s.key);if(e.isLeft){let n=null;if(r){const e=r.getIntersection(t);if(null!==e&&(t.isAnEndpoint(e)||(n=e),!r.isAnEndpoint(e))){const t=this._splitSafely(r,e);for(let e=0,n=t.length;e<n;e++)i.push(t[e]);}}let a=null;if(o){const e=o.getIntersection(t);if(null!==e&&(t.isAnEndpoint(e)||(a=e),!o.isAnEndpoint(e))){const t=this._splitSafely(o,e);for(let e=0,n=t.length;e<n;e++)i.push(t[e]);}}if(null!==n||null!==a){let e=null;e=null===n?a:null===a||D.comparePoints(n,a)<=0?n:a,this.queue.remove(t.rightSE),i.push(t.rightSE);const r=t.split(e);for(let e=0,t=r.length;e<t;e++)i.push(r[e]);}i.length>0?(this.tree.remove(t),i.push(e)):(this.segments.push(t),t.prev=r);}else {if(r&&o){const e=r.getIntersection(o);if(null!==e){if(!r.isAnEndpoint(e)){const t=this._splitSafely(r,e);for(let e=0,n=t.length;e<n;e++)i.push(t[e]);}if(!o.isAnEndpoint(e)){const t=this._splitSafely(o,e);for(let e=0,n=t.length;e<n;e++)i.push(t[e]);}}}this.tree.remove(t);}return i}_splitSafely(e,t){this.tree.remove(e);const i=e.rightSE;this.queue.remove(i);const n=e.split(t);return n.push(i),void 0===e.consumedBy&&this.tree.add(e),n}}const q="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,X="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,W=new class{run(e,t,i){W.type=e,_.reset();const n=[new k(t,!0)];for(let e=0,t=i.length;e<t;e++)n.push(new k(i[e],!1));if(W.numMultiPolys=n.length,"difference"===W.type){const e=n[0];let t=1;for(;t<n.length;)null!==h(n[t].bbox,e.bbox)?t++:n.splice(t,1);}if("intersection"===W.type)for(let e=0,t=n.length;e<t;e++){const t=n[e];for(let i=e+1,r=n.length;i<r;i++)if(null===h(t.bbox,n[i].bbox))return []}const r=new a(D.compare);for(let e=0,t=n.length;e<t;e++){const t=n[e].getSweepEvents();for(let e=0,i=t.length;e<i;e++)if(r.insert(t[e]),r.size>q)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const o=new Y(r);let s=r.size,l=r.pop();for(;l;){const e=l.key;if(r.size===s){const t=e.segment;throw new Error(`Unable to pop() ${e.isLeft?"left":"right"} SweepEvent [${e.point.x}, ${e.point.y}] from segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] from queue.`)}if(r.size>q)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(o.segments.length>X)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const t=o.process(e);for(let e=0,i=t.length;e<i;e++){const i=t[e];void 0===i.consumedBy&&r.insert(i);}s=r.size,l=r.pop();}_.reset();const u=U.factory(o.segments);return new H(u).getGeom()}};var j={union:function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return W.run("union",e,i)},intersection:function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return W.run("intersection",e,i)},xor:function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return W.run("xor",e,i)},difference:function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return W.run("difference",e,i)}};return j}();})),fw=pw;function mw(e,t){var i=ye(e),n=ye(t),r=e.properties||{},o=fw.difference(i.coordinates,n.coordinates);return 0===o.length?null:1===o.length?se(o[0],r):ce(o,r)}function _w(e,t,i){void 0===i&&(i={});var n=ye(e),r=ye(t),o=fw.intersection(n.coordinates,r.coordinates);return 0===o.length?null:1===o.length?se(o[0],i.properties):ce(o,i.properties)}function gw(e,t,i){if(void 0===i&&(i={}),!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var n=me(e),r=ye(t),o=r.type,a=t.bbox,s=r.coordinates;if(a&&!1===function(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}(n,a))return !1;"Polygon"===o&&(s=[s]);for(var l=!1,u=0;u<s.length&&!l;u++)if(yw(n,s[u][0],i.ignoreBoundary)){for(var c=!1,h=1;h<s[u].length&&!c;)yw(n,s[u][h],!i.ignoreBoundary)&&(c=!0),h++;c||(l=!0);}return l}function yw(e,t,i){var n=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var r=0,o=t.length-1;r<t.length;o=r++){var a=t[r][0],s=t[r][1],l=t[o][0],u=t[o][1];if(e[1]*(a-l)+s*(l-e[0])+u*(e[0]-a)==0&&(a-e[0])*(l-e[0])<=0&&(s-e[1])*(u-e[1])<=0)return !i;s>e[1]!=u>e[1]&&e[0]<(l-a)*(e[1]-s)/(u-s)+a&&(n=!n);}return n}function xw(e){let t=0,i=0;for(const n of e)t+=n.w*n.h,i=Math.max(i,n.w);e.sort(((e,t)=>t.h-e.h));const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let r=0,o=0;for(const t of e)for(let e=n.length-1;e>=0;e--){const i=n[e];if(!(t.w>i.w||t.h>i.h)){if(t.x=i.x,t.y=i.y,o=Math.max(o,t.y+t.h),r=Math.max(r,t.x+t.w),t.w===i.w&&t.h===i.h){const t=n.pop();e<n.length&&(n[e]=t);}else t.h===i.h?(i.x+=t.w,i.w-=t.w):t.w===i.w?(i.y+=t.h,i.h-=t.h):(n.push({x:i.x+t.w,y:i.y,w:i.w-t.w,h:t.h}),i.y+=t.h,i.h-=t.h);break}}return {w:r,h:o,fill:t/(r*o)||0}}function vw(e,{width:t,height:i},n,r){if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==t*i*n)throw new RangeError("mismatched image size")}else r=new Uint8Array(t*i*n);return e.width=t,e.height=i,e.data=r,e}function ww(e,{width:t,height:i},n){if(t===e.width&&i===e.height)return;const r=vw({},{width:t,height:i},n);Tw(e,r,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,t),height:Math.min(e.height,i)},n),e.width=t,e.height=i,e.data=r.data;}function Tw(e,t,i,n,r,o){if(0===r.width||0===r.height)return t;if(r.width>e.width||r.height>e.height||i.x>e.width-r.width||i.y>e.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>t.width||r.height>t.height||n.x>t.width-r.width||n.y>t.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const a=e.data,s=t.data;for(let l=0;l<r.height;l++){const u=((i.y+l)*e.width+i.x)*o,c=((n.y+l)*t.width+n.x)*o;for(let e=0;e<r.width*o;e++)s[c+e]=a[u+e];}return t}class bw{constructor(e,t){vw(this,e,1,t);}resize(e){ww(this,e,1);}clone(){return new bw({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,n,r){Tw(e,t,i,n,r,1);}}class Pw{constructor(e,t){vw(this,e,4,t);}resize(e){ww(this,e,4);}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e;}clone(){return new Pw({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,n,r){Tw(e,t,i,n,r,4);}}$o("AlphaImage",bw),$o("RGBAImage",Pw);class Sw{constructor(e,{pixelRatio:t,version:i,stretchX:n,stretchY:r,content:o}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=n,this.stretchY=r,this.content=o,this.version=i;}get tl(){return [this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return [this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return [(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Ew{constructor(e,t){const i={},n={};this.haveRenderCallbacks=[];const r=[];this.addImages(e,i,r),this.addImages(t,n,r);const{w:o,h:a}=xw(r),s=new Pw({width:o||1,height:a||1});for(const t in e){const n=e[t],r=i[t].paddedRect;Pw.copy(n.data,s,{x:0,y:0},{x:r.x+1,y:r.y+1},n.data);}for(const e in t){const i=t[e],r=n[e].paddedRect,o=r.x+1,a=r.y+1,l=i.data.width,u=i.data.height;Pw.copy(i.data,s,{x:0,y:0},{x:o,y:a},i.data),Pw.copy(i.data,s,{x:0,y:u-1},{x:o,y:a+u},{width:l,height:1}),Pw.copy(i.data,s,{x:0,y:0},{x:o,y:a-1},{width:l,height:1}),Pw.copy(i.data,s,{x:l-1,y:0},{x:o+l,y:a},{width:1,height:u}),Pw.copy(i.data,s,{x:0,y:0},{x:o-1,y:a},{width:1,height:u});}this.image=s,this.iconPositions=i,this.patternPositions=n;}addImages(e,t,i){for(const n in e){const r=e[n],o={x:0,y:0,w:r.data.width+2,h:r.data.height+2};i.push(o),t[n]=new Sw(o,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(n);}}patchUpdatedImages(e,t){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const i in e.updatedImages)this.patchUpdatedImage(this.iconPositions[i],e.getImage(i),t),this.patchUpdatedImage(this.patternPositions[i],e.getImage(i),t);}patchUpdatedImage(e,t,i){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[n,r]=e.tl;i.update(t.data,void 0,{x:n,y:r});}}$o("ImagePosition",Sw),$o("ImageAtlas",Ew);const Aw=bi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_scale_terrain",components:1,type:"Float32"},{name:"a_NORMAL",components:1,type:"Uint8"},{name:"a_data",components:4,type:"Uint8"},{name:"a_extra_extrude",components:2,type:"Uint8"},{name:"a_pos_normal",components:2,type:"Int16"}],4),{members:Cw}=Aw,Mw=bi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Iw}=Mw,Lw=Ng.VectorTileFeature.types,Nw=Math.cos(Math.PI/180*37.5),Rw=Math.pow(2,14)/.5;class Ow{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.vectorRenderInSpace=!1,this.layers.forEach((e=>{this.gradients[e.id]={},this.classificationType=e.classificationType,dp(e.classificationType)&&(this.vectorRenderInSpace=!0);})),this.type=Dg.LINE,this.layoutVertexArray=new ya,this.layoutVertexArray2=new Ea,this.indexArray=new Ba,this.programConfigurations=new gf(Cw,e.layers,e.zoom),this.segments=new ep,this.maxLineLength=0,this.projection=e.projection||mi.MERCATOR,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id));}_convertGeometryPointToLine(e){const t=[];for(let i=0;i<e.length;i++){const n=[];let r=1/0,o=1/0,a=-1/0,s=-1/0;for(let t=0;t<e[i].length;t++){const l=e[i][t].x,u=e[i][t].y;n.push([l,u]),r>l&&(r=l),a<l&&(a=l),o>u&&(o=u),s<u&&(s=u);}t.push({type:"LineString",geometry:[n],min:[r,o],max:[a,s]});}return t}_convertLineToGeometry(e){const t=[];for(let i=0;i<e.length;i++){const n=e[i].geometry.map((e=>e.map((e=>new te(e[0],e[1])))));t.push(...n);}return t}populate(e,t,i){this.baseP||(this.x=t.x,this.y=t.y,this.z=t.z,this.zPow=Math.pow(2,this.z),this.baseP=Nl(this.x,this.y,this.z,this.projection),this.matrix=Rl(this.baseP)),this.hasPattern=Jx("line",this.layers,t);const n=this.layers[0].layout.get("line-sort-key"),r=[];for(const{feature:t,id:o,index:a,sourceLayerIndex:s}of e){const e=this.layers[0]._featureFilter.needGeometry,l={type:t.type,id:o,properties:t.properties,geometry:e?Sg(t):[]};if(!this.layers[0]._featureFilter(new Lp(this.zoom),l,i))continue;e||(l.geometry=Sg(t));const u=n?n.evaluate(l,{},i):void 0;r.push({feature:t,sourceLayerIndex:s,index:a,sortKey:u});}n&&r.sort(((e,t)=>e.sortKey-t.sortKey));for(const e of r){const{feature:i,index:n,sourceLayerIndex:r}=e,o=Sg(i);let a=this.vectorRenderInSpace?0:Yv(this.z);this.layers[0].paint._values["line-gradient"]&&(a=1);const s=this._convertGeometryPointToLine(o),l=[];3===i.type&&(a=2,i.polygon2Line=!0),Hv(a,0,8192,0,8192,s,l);const u=this._convertLineToGeometry(l);if(this.classificationType===hp.VECTOR_WITH_HEIGHT){const e=i?.properties?.height?.split(",");for(let t=0;t<u[0].length&&e&&0!==e.length;t++)u[0][t].z=+e[t];}if(this.hasPattern&&e.feature._feature){const i=[];for(let t=0;t<e.feature._feature.geometry.length;t++){const n=[];for(let i=0;i<e.feature._feature.geometry[t].length;i++){const r=e.feature._feature.geometry[t][i],o=new te(r[0],r[1]);n.push(o);}i.push(n);}const n=ev("line",this.layers,{id:e.feature.id,index:e.index,geometry:i,patterns:{},properties:e.feature.properties,sortKey:e.sortKey,sourceLayerIndex:e.sourceLayerIndex,type:e.feature.type},this.zoom,t);this.patternFeatures.push(n);}else this.addFeature(i,u,n,new rd(this.z,this.x,this.y),{});t.featureIndex.insert(i,o,n,r,this.index);}0==this.layoutVertexArray2.length&&delete this.layoutVertexArray2;}update(e,t){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers);}addFeatures(e,t,i){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,i);}isEmpty(){return 0===this.layoutVertexArray.length&&(!this.adaptTerrainGeometries||0===this.adaptTerrainGeometries.length)}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2&&0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Iw)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Cw),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.layoutVertexBuffer2&&this.layoutVertexBuffer2.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("minemap_clip_start")&&e.properties.hasOwnProperty("minemap_clip_end"))return {start:+e.properties.minemap_clip_start,end:+e.properties.minemap_clip_end}}addFeature(e,t,i,n,r){const o=this.layers[0].layout,a=o.get("line-join").evaluate(e,{}),s=o.get("line-cap"),l=o.get("line-miter-limit"),u=o.get("line-round-limit");let c,h,d,p;this.lineClips=this.lineFeatureClips(e),this.vectorRenderInSpace&&(c=this.layers[0].paint,h=c.get("line-width").evaluate(e,{zoom:this.zoom}),d=c.get("line-color").evaluate(e,{zoom:this.zoom}),p=c.get("line-opacity").evaluate(e,{zoom:this.zoom}));for(const i of t)if(this.vectorRenderInSpace){const e=[];for(let t=0;t<i.length;t++)e.push(Dw(i[t],this));const t={width:h,positions:e,color:d,opacity:p};this.adaptTerrainGeometries||(this.adaptTerrainGeometries=[]),this.adaptTerrainGeometries.push(t);}else this.addLine(i,e,a,s,l,u);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,r,n);}addLine(e,t,i,n,r,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance);}let a="Polygon"===Lw[t.type];t.polygon2Line&&(a=!1);let s=e.length;for(;s>=2&&e[s-1].equals(e[s-2]);)s--;let l=0;for(;l<s-1&&e[l].equals(e[l+1]);)l++;if(s<(a?3:2))return;"bevel"===i&&(r=1.05);const u=this.overscaling<=16?15*Wh/(512*this.overscaling):0,c=this.segments.prepareSegment(10*s,this.layoutVertexArray,this.indexArray);let h,d,p,f,m;this.e1=this.e2=-1,a&&(h=e[s-2],m=e[l].sub(h)._unit()._perp());for(let t=l;t<s;t++){if(p=t===s-1?a?e[l+1]:void 0:e[t+1],p&&e[t].equals(p))continue;m&&(f=m),h&&(d=h),h=e[t],m=p?p.sub(h)._unit()._perp():f,f=f||m;let _=f.add(m);0===_.x&&0===_.y||_._unit();const g=f.x*m.x+f.y*m.y,y=_.x*m.x+_.y*m.y,x=0!==y?1/y:1/0,v=2*Math.sqrt(2-2*y),w=y<Nw&&d&&p,T=f.x*m.y-f.y*m.x>0;if(w&&t>l){const e=h.dist(d);if(e>2*u){const t=h.sub(h.sub(d)._mult(u/e)._round());this.updateDistance(d,t),this.addCurrentVertex(t,f,0,0,c),d=t;}}const b=d&&p;let P=b?i:a?"butt":n;if(b&&"round"===P&&(x<o?P="miter":x<=2&&(P="fakeround")),"miter"===P&&x>r&&(P="bevel"),"bevel"===P&&(x>2&&(P="flipbevel"),x<r&&(P="miter")),d&&this.updateDistance(d,h),"miter"===P)_._mult(x),this.addCurrentVertex(h,_,0,0,c);else if("flipbevel"===P){if(x>100)_=m.mult(-1);else {const e=x*f.add(m).mag()/f.sub(m).mag();_._perp()._mult(e*(T?-1:1));}this.addCurrentVertex(h,_,0,0,c),this.addCurrentVertex(h,_.mult(-1),0,0,c);}else if("bevel"===P||"fakeround"===P){const e=-Math.sqrt(x*x-1),t=T?e:0,i=T?0:e;if(d&&this.addCurrentVertex(h,f,t,i,c),"fakeround"===P){const e=Math.round(180*v/Math.PI/20);for(let t=1;t<e;t++){let i=t/e;if(.5!==i){const e=i-.5;i+=i*e*(i-1)*((1.0904+g*(g*(3.55645-1.43519*g)-3.2452))*e*e+(.848013+g*(.215638*g-1.06021)));}const n=m.sub(f)._mult(i)._add(f)._unit()._mult(T?-1:1);this.addHalfVertex(h,n.x,n.y,!1,T,0,c,{x:0,y:0});}}p&&this.addCurrentVertex(h,m,-t,-i,c);}else if("butt"===P)this.addCurrentVertex(h,_,0,0,c);else if("square"===P){const e=d?1:-1;this.addCurrentVertex(h,_,e,e,c);}else "round"===P?(d&&(this.addCurrentVertex(h,f,0,0,c),this.addCurrentVertex(h,f,1,1,c,!0)),p&&(this.addCurrentVertex(h,m,-1,-1,c,!0),this.addCurrentVertex(h,m,0,0,c))):"round-butt"===P&&(d&&(this.addCurrentVertex(h,f,0,0,c),this.addCurrentVertex(h,f,.5,.5,c,!0,.42,.42)),p&&(this.addCurrentVertex(h,m,-.5,-.5,c,!0,-.42,-.42),this.addCurrentVertex(h,m,0,0,c)));if(w&&t<s-1){const e=h.dist(p);if(e>2*u){const t=h.add(p.sub(h)._mult(u/e)._round());this.updateDistance(h,t),this.addCurrentVertex(t,m,0,0,c),h=t;}}}return c}calcTDSpacePoint(e,t){if(isNaN(e.x)||isNaN(e.y)||isNaN(e.z))return;const i=Ll(this.x+e.x/Wh,this.y+e.y/Wh,this.zPow,this.projection),n=Nu.cartographicToCartesian3([i[0],i[1],t]);return new te(n[0]-this.baseP[0],n[1]-this.baseP[1],n[2]-this.baseP[2])}addCurrentVertex(e,t,i,n,r,o=!1,a=0,s=0){const l=t.x+t.y*i,u=t.y-t.x*i,c=t.y*n-t.x,h=-t.y-t.x*n;let d=t.mult(0);d=t.perp().mult(-a);let p=t.mult(0);p=t.perp().mult(-s),null!=this.calcTDSpacePoint(e,this.minimumHeight)&&(this.addHalfVertex(e,l,u,o,!1,i,r,d),this.addHalfVertex(e,c,h,o,!0,-n,r,p),this.distance>Rw/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(e,t,i,n,r,o)));}addHalfVertex(e,t,i,n,r,o,a,s){const l=this.layers[0].layout.get("line-height-offset")?.value?.value||0,u=this.lineClips?this.scaledDistance*(Rw-1):this.scaledDistance,c=this.calcTDSpacePoint(e,e.z+l);if(null==c)return;const h=Math.pow(2,this.z)/2,d=Ol(.5,2,Math.abs(e.y/Wh+this.y-h)/h),p=.5*u;this.layoutVertexArray.emplaceBack(c.x,c.y,c.z,d,(n?2:0)+(r?1:0),Math.round(63*t)+128,Math.round(63*i)+128,1+(0===o?0:o<0?-1:1)|(63&p)<<2,p>>6,Math.round(63*s.x)+128,Math.round(63*s.y)+128,(e.x<<1)+(n?1:0),(e.y<<1)+(r?1:0)),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const f=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,f,this.e2),a.primitiveLength++),r?this.e2=f:this.e1=f;}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance;}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance();}}function Dw(e,t){if(isNaN(e.x)||isNaN(e.y)||isNaN(e.z))return;const i=Ll(t.x+e.x/Wh,t.y+e.y/Wh,t.zPow,t.projection);return Nu.cartographicToCartesian3([i[0],i[1],0])}$o("LineBucket",Ow,{omit:["layers","patternFeatures"],shallow:["matrix"]});const Fw=1024,zw=Le([[[0,0],[8192,0],[8192,8192],[0,8192],[0,0]]]);class Bw{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.type=Dg.FILL,this.layoutVertexArray=new wa,this.layoutVertexArray2=new Aa,this.indexArray=new Ba,this.indexArray2=new ka,this.programConfigurations=new gf(Zx,e.layers,e.zoom),this.segments=new ep,this.segments2=new ep,this.projection=e.projection||mi.MERCATOR,this.vectorRenderInSpace=!1,this.classificationType=hp.NONE,this.layers.forEach((e=>{dp(e.classificationType)&&(this.vectorRenderInSpace=!0,this.classificationType=e.classificationType);}));}_convertGeometryPointToPolygon(e){const t=[];for(let i=0;i<e.length;i++){const n=[];let r=1/0,o=1/0,a=-1/0,s=-1/0;for(let t=0;t<e[i].length;t++){const l=e[i][t].x,u=e[i][t].y;n.push([l,u]),r>l&&(r=l),a<l&&(a=l),o>u&&(o=u),s<u&&(s=u);}t.push({type:"Polygon",geometry:[n],min:[r,o],max:[a,s]});}return t}_convertPolygonToGeometry(e){const t=[];for(let i=0;i<e.length;i++){const n=e[i].geometry.map((e=>e.map((e=>new te(e[0],e[1])))));t.push(...n);}return t}_convertArrayGeometryPointToPolygon(e){const t=[];for(let i=0;i<e.length;i++){const n=[];let r=1/0,o=1/0,a=-1/0,s=-1/0;for(let t=0;t<e[i].length;t++){const l=e[i][t][0],u=e[i][t][1];n.push([l,u]),r>l&&(r=l),a<l&&(a=l),o>u&&(o=u),s<u&&(s=u);}t.push({type:"Polygon",geometry:[n],min:[r,o],max:[a,s]});}return t}populate(e,t,i){this.baseP||(this.x=t.x,this.y=t.y,this.z=t.z,this.zPow=Math.pow(2,this.z),this.baseP=Nl(this.x,this.y,this.z,this.projection),this.matrix=new Bt,this.matrix[12]=this.baseP[0],this.matrix[13]=this.baseP[1],this.matrix[14]=this.baseP[2]),this.hasPattern=Jx("fill",this.layers,t);const n=this.layers[0].layout.get("fill-sort-key"),r=[];for(const{feature:o,id:a,index:s,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,u={type:o.type,id:a,properties:o.properties,geometry:e?Sg(o):[]};if(!this.layers[0]._featureFilter(new Lp(this.zoom),u,i))continue;e||(u.geometry=Sg(o));const c=n?n.evaluate(u,{},i,t.availableImages):void 0;r.push({feature:o,sourceLayerIndex:l,index:s,geometry:u.geometry,sortKey:c});}n&&r.sort(((e,t)=>e.sortKey-t.sortKey));for(const e of r){const{feature:n,index:r,sourceLayerIndex:o,geometry:a}=e;if(this.vectorRenderInSpace){this.adaptTerrainGeometries||(this.adaptTerrainGeometries=[]);const e=this._convertGeometryPointToPolygon(a);let t=[];for(let i=0;i<e.length;i++)if(e[i].geometry[0].length>3){const n=_w(zw,Le(e[i].geometry));if(n&&"MultiPolygon"===n.geometry.type)for(let e=0;e<n.geometry.coordinates.length;e++)t=t.concat(n.geometry.coordinates[e]);else n&&(up(Ie(e[i].geometry[0]))!==up(n.geometry.coordinates[0])&&n.geometry.coordinates[0].reverse(),t=t.concat(n.geometry.coordinates));}let i=[];for(let e=0;e<t.length;e++){const n=this._convertArrayGeometryPointToPolygon([t[e]]);i=i.concat(n);}if(0===i.length)continue;const r=this._convertPolygonToGeometry(i),o=this.layers[0].paint,s=o.get("fill-color").evaluate(n,{zoom:this.zoom}),l=o.get("fill-opacity").evaluate(n,{zoom:this.zoom}),u=[];for(const e of Rv(r,500)){const t=Vw(e,this);if(this.adaptTerrainGeometries.push({positions:t,color:s,opacity:l}),t.length>1)for(let t=0;t<e.length;t++){const i=[],n=e[t];for(let e=0;e<n.length;e++)i.push([n[e].x,n[e].y]);u.push([i]);}if(u.length>0)if(_w(Le(u[0]),Le(u[1]))){const e=mw(Le(u[0]),Le(u[1])),t=[];let i;if(e)if(e.geometry.coordinates.length>1){let n=!0;const r=Le([e.geometry.coordinates[0]]),o=e.geometry.coordinates[1];for(let e=0;e<o.length;e++)gw(Me(o[e]),r)||(n=!1);for(let i=0;i<e.geometry.coordinates.length;i++){const n=e.geometry.coordinates[i],r=[];for(let e=0;e<n.length;e++)r.push(new te(n[e][0],n[e][1]));t.push(r);}if(i=Vw(t,this),n)this.adaptTerrainGeometries[this.adaptTerrainGeometries.length-1].positions=[i];else {this.adaptTerrainGeometries.pop();for(let e=0;e<i.length;e++)this.adaptTerrainGeometries.push({positions:[i[e]],color:s,opacity:l});}}else {const n=e.geometry.coordinates[0];for(let e=0;e<n.length;e++)t.push(new te(n[e][0],n[e][1]));i=Vw(t,this),this.adaptTerrainGeometries[this.adaptTerrainGeometries.length-1].positions=[i];}else this.adaptTerrainGeometries.pop();}else {const e=this.adaptTerrainGeometries[this.adaptTerrainGeometries.length-1].positions;this.adaptTerrainGeometries.pop();for(let t=0;t<e.length;t++)this.adaptTerrainGeometries.push({positions:[e[t]],color:s,opacity:l});}}}else {const o=[];Hv(Yv(this.z),0,8192,0,8192,this._convertGeometryPointToPolygon(a),o);const s=this._convertPolygonToGeometry(o);if(this.hasPattern&&e.feature._feature){const i=[];for(let t=0;t<e.feature._feature.geometry.length;t++){const n=[];for(let i=0;i<e.feature._feature.geometry[t].length;i++){const r=e.feature._feature.geometry[t][i],o=new te(r[0],r[1]);n.push(o);}i.push(n);}if(this.hasPattern){const n=ev("fill",this.layers,{id:e.feature.id,index:e.index,geometry:i,patterns:{},properties:e.feature.properties,sortKey:e.sortKey,sourceLayerIndex:e.sourceLayerIndex,type:e.feature.type,geo:s},this.zoom,t);this.patternFeatures.push(n);}}else this.addGridedFeature(n,a,s,r,i,this.z,{});}t.featureIndex.insert(n,a,r,o,this.index);}0==this.layoutVertexArray2.length&&delete this.layoutVertexArray2;}update(e,t,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i);}addFeatures(e,t,i){if(this.patternFeatures.length>0)for(const e of this.patternFeatures)this.addGridedFeature(e,e.geometry,e.geo,e.index,t,this.z,i);}isEmpty(){return 0===this.layoutVertexArray.length&&(!this.adaptTerrainGeometries||0===this.adaptTerrainGeometries.length)}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Zx),this.layoutVertexArray2&&this.layoutVertexArray2.length>0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Qx)),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy());}calcTDSpacePoint(e){if(Object.is(e.x,NaN)||Object.is(e.y,NaN)||Object.is(e.z,NaN))return;const t=Ll(this.x+e.x/8192,this.y+e.y/8192,this.zPow,this.projection),i=Nu.cartographicToCartesian3([t[0],t[1],0]);return [i[0]-this.baseP[0],i[1]-this.baseP[1],i[2]-this.baseP[2]]}addGridedFeature(e,t,i,n,r,o,a){const s=this.layers[0].paint.get("fill-outline-color").evaluate(e,{},r);let l,u,c=[65025*s.r,65025*s.g,65025*s.b,255*s.a];(65025*s.r>255||65025*s.g>255||65025*s.b>255)&&(c=[255*s.r,255*s.g,255*s.b,255*s.a]);for(const e of Rv(i,500)){let t=0;for(const i of e)t+=i.length;l=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray);const i=l.vertexLength,n=[],r=[];for(const t of e){if(0===t.length)continue;t!==e[0]&&r.push(n.length/2);const i=this.calcTDSpacePoint(t[0]);if(null!=i){this.layoutVertexArray.emplaceBack(...i,t[0].x/Fw,t[0].y/Fw),n.push(t[0].x),n.push(t[0].y);for(let e=1;e<t.length;e++){const i=this.calcTDSpacePoint(t[e]);null!=i&&(this.layoutVertexArray.emplaceBack(...i,t[e].x/Fw,t[e].y/Fw),n.push(t[e].x),n.push(t[e].y));}}}const o=tv(n,r);for(let e=0;e<o.length;e+=3)this.indexArray.emplaceBack(i+o[e],i+o[e+1],i+o[e+2]);l.vertexLength+=t,l.primitiveLength+=o.length/3;}for(const e of Rv(t,500))for(const t of e){if(0===t.length)continue;this.layoutVertexArray2||(this.layoutVertexArray2=new Aa),u=this.segments2.prepareSegment(t.length,this.layoutVertexArray2,this.indexArray2);const e=u.vertexLength;let i,n=0;for(let r=0;r<t.length;r++){if(r>=t.length-1)continue;const o=r<t.length-1?r+1:0;let a=Uw(t[r],t[o]);if(a||(a=[]),kw(t[r])||a.unshift(t[r]),kw(t[o])||a.push(t[o]),a.length>=2)for(let t=0;t<a.length;t++){const r=a[t],o=this.calcTDSpacePoint(r);i?(this.layoutVertexArray2.emplaceBack(...i.spacePos,i.st[0],i.st[1],...c),i={spacePos:[...o],st:[r.x/Fw,r.y/Fw]},this.layoutVertexArray2.emplaceBack(...i.spacePos,i.st[0],i.st[1],...c),this.indexArray2.emplaceBack(e+n-1,e+n),n+=2):i={spacePos:[...o],st:[r.x/Fw,r.y/Fw]};}i=null;}u.vertexLength+=n,u.primitiveLength+=n;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,a,r);}}function Vw(e,t){if(Array.isArray(e)){const i=[];for(let n=0;n<e.length;n++)i.push(Vw(e[n],t));return i}return Dw(e,t)}function kw(e){return e.x<0||e.x>Wh||e.y<0||e.y>Wh}function Uw(e,t){const i=hw(Ie([[0,0],[Wh,0],[Wh,Wh],[0,Wh],[0,0]]),Ie([[e.x,e.y],[t.x,t.y]]));if(i&&i.features&&i.features.length>0){const e=[];for(let t=0;t<i.features.length;t++){const n=i.features[t].geometry.coordinates;e.push(new te(n[0],n[1]));}return e}return null}function Gw(e,t,i){return !!Zw(e,t)||!!Ww(t,e,i)}function Hw(e,t,i){for(let n=0;n<t.length;n++){const r=t[n];if(e.length>=3)for(let t=0;t<r.length;t++)if(Zw(e,r[t]))return !0;if(Yw(e,r,i))return !0}return !1}function Yw(e,t,i){if(e.length>1){if(qw(e,t))return !0;for(let n=0;n<t.length;n++)if(Ww(t[n],e,i))return !0}for(let n=0;n<e.length;n++)if(Ww(e[n],t,i))return !0;return !1}function qw(e,t){if(0===e.length||0===t.length)return !1;for(let i=0;i<e.length-1;i++){const n=e[i],r=e[i+1];for(let e=0;e<t.length-1;e++)if(Xw(n,r,t[e],t[e+1]))return !0}return !1}function Xw(e,t,i,n){return Ke(e,i,n)!==Ke(t,i,n)&&Ke(e,t,i)!==Ke(e,t,n)}function Ww(e,t,i){const n=i*i;if(1===t.length)return e.distSqr(t[0])<n;for(let i=1;i<t.length;i++)if(jw(e,t[i-1],t[i])<n)return !0;return !1}function jw(e,t,i){const n=t.distSqr(i);if(0===n)return e.distSqr(t);const r=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/n;return e.distSqr(r<0?t:r>1?i:i.sub(t)._mult(r)._add(t))}function $w(e,t){let i,n,r,o=!1;for(let a=0;a<e.length;a++){i=e[a];for(let e=0,a=i.length-1;e<i.length;a=e++)n=i[e],r=i[a],n.y>t.y!=r.y>t.y&&t.x<(r.x-n.x)*(t.y-n.y)/(r.y-n.y)+n.x&&(o=!o);}return o}function Zw(e,t){let i=!1;for(let n=0,r=e.length-1;n<e.length;r=n++){const o=e[n],a=e[r];o.y>t.y!=a.y>t.y&&t.x<(a.x-o.x)*(t.y-o.y)/(a.y-o.y)+o.x&&(i=!i);}return i}function Kw(e,t,i){const n=i[0],r=i[2];if(e.x<n.x&&t.x<n.x||e.x>r.x&&t.x>r.x||e.y<n.y&&t.y<n.y||e.y>r.y&&t.y>r.y)return !1;const o=Ke(e,t,i[0]);return o!==Ke(e,t,i[1])||o!==Ke(e,t,i[2])||o!==Ke(e,t,i[3])}function Qw(e,t,i){const n=t.paint.get(e).value;return "constant"===n.kind?n.value:i.programConfigurations.get(t.id).getMaxValue(e)}function Jw(e,t,i,n,r){if(!t[0]&&!t[1])return e;const o=te.convert(t);"viewport"===i&&o._rotate(-n);const a=[];for(let t=0;t<e.length;t++)a.push(e[t].sub(o.clone()._mult(r)));return a}$o("FillBucket",Bw,{omit:["layers","patternFeatures"],shallow:["matrix"]});const eT=new qp({"fill-sort-key":new Up(Hg.layout_fill["fill-sort-key"]),dynamic:new kp(Hg.layout_fill.dynamic)});var tT={paint:new qp({"fill-antialias":new kp(Hg.paint_fill["fill-antialias"]),"fill-opacity":new Up(Hg.paint_fill["fill-opacity"]),"fill-water-texture":new kp(Hg.paint_fill["fill-water-texture"]),"fill-water-speed":new kp(Hg.paint_fill["fill-water-speed"]),"fill-water-wave-size":new kp(Hg.paint_fill["fill-water-wave-size"]),"sunlight-color":new kp(Hg.paint_fill["sunlight-color"]),"sunlight-direction":new kp(Hg.paint_fill["sunlight-direction"]),"sky-color":new kp(Hg.paint_fill["sky-color"]),"fill-color":new Up(Hg.paint_fill["fill-color"]),"fill-outline-color":new Up(Hg.paint_fill["fill-outline-color"]),"fill-translate":new Up(Hg.paint_fill["fill-translate"]),"fill-translate-anchor":new Up(Hg.paint_fill["fill-translate-anchor"]),"fill-pattern":new Gp(Hg.paint_fill["fill-pattern"]),"fill-water":new kp(Hg.paint_fill["fill-water"]),"fill-dynamic-speed":new Up(Hg.paint_fill["fill-dynamic-speed"]),"fill-dynamic-image-url":new Hp(Hg.paint_fill["fill-dynamic-image-url"]),"fill-offset":new Up(Hg.paint_fill["fill-offset"]),"fill-rotation":new Up(Hg.paint_fill["fill-rotation"]),"fill-scale":new Up(Hg.paint_fill["fill-scale"])}),layout:eT};const iT=new qp({"line-cap":new kp(Hg.layout_line["line-cap"]),"line-join":new Up(Hg.layout_line["line-join"]),"line-miter-limit":new kp(Hg.layout_line["line-miter-limit"]),"line-round-limit":new kp(Hg.layout_line["line-round-limit"]),"line-sort-key":new Up(Hg.layout_line["line-sort-key"]),"line-height-offset":new Up(Hg.layout_line["line-height-offset"]),"border-visibility":new kp(Hg.layout_line["border-visibility"])});var nT={paint:new qp({"line-opacity":new Up(Hg.paint_line["line-opacity"]),"line-color":new Up(Hg.paint_line["line-color"]),"line-translate":new Up(Hg.paint_line["line-translate"]),"line-translate-anchor":new Up(Hg.paint_line["line-translate-anchor"]),"line-width":new Up(Hg.paint_line["line-width"]),"line-border-width":new Up(Hg.paint_line["line-border-width"]),"line-border-opacity":new Up(Hg.paint_line["line-border-opacity"]),"line-border-color":new Up(Hg.paint_line["line-border-color"]),"line-gap-width":new Up(Hg.paint_line["line-gap-width"]),"line-offset":new Up(Hg.paint_line["line-offset"]),"line-blur":new Up(Hg.paint_line["line-blur"]),"line-dasharray":new Hp(Hg.paint_line["line-dasharray"]),"line-pattern":new Gp(Hg.paint_line["line-pattern"]),"line-gradient":new Yp(Hg.paint_line["line-gradient"]),"half-render":new kp(Hg.paint_line["half-render"]),"line-normal-direction":new Up(Hg.paint_line["line-normal-direction"])}),layout:iT};const rT=new class extends Up{possiblyEvaluate(e,t){return t=new Lp(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,n){return t=Ve({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,n)}}(nT.paint.properties["line-width"].specification);rT.useIntegerZoom=!0;class oT extends kx{constructor(e){e&&e.layout&&"visible"===e.layout["border-visibility"]&&e.paint&&e.paint["line-gap-width"]&&(Ze("'line-gap-width' cannot be set when 'border-visibility' is 'visible'"),e.paint["line-gap-width"]=0),super(e,nT),this.stencilTest=e["stencil-test"],this.gradientVersion=0;}_handleSpecialPaintPropertyUpdate(e){"line-gradient"===e&&(this.stepInterpolate=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof yr,this.gradientVersion=(this.gradientVersion+1)%Ne);}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}getCrossfadeParameters(){return this._crossfadeParameters}recalculate(e,t){super.recalculate(e,t),e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this.paint._values["line-floorwidth"]=rT.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e);}createBucket(e){return new Ow(e)}queryRadius(e){const t=e,i=aT(Qw("line-width",this,t),Qw("line-gap-width",this,t)),n=Qw("line-offset",this,t);return i/2+Math.abs(n)+0}queryIntersectsFeature(e,t,i,n,r,o,a,s){const l=Jw(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.getMapViewParams().bearing*ot.TRANSFORM.DEG_TO_RAD,a);let u=a/2*aT(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i));null!=s&&null!=s.line&&(u=Math.max(u,s.line));const c=this.paint.get("line-offset").evaluate(t,i);return c&&(n=function(e,t){const i=[],n=new te(0,0);for(let r=0;r<e.length;r++){const o=e[r],a=[];for(let e=0;e<o.length;e++){const i=o[e],r=o[e+1],s=0===e?n:i.sub(o[e-1])._unit()._perp(),l=e===o.length-1?n:r.sub(i)._unit()._perp(),u=s._add(l)._unit();u._mult(1/(u.x*l.x+u.y*l.y)),a.push(u._mult(t)._add(i));}i.push(a);}return i}(n,c*a)),Hw(l,n,u)}hasOffscreenPass(){return 0!==this.paint.get("line-opacity")&&"none"!==this.visibility}}function aT(e,t){return t>0?t+2*e:e}const sT=bi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_extra",components:2,type:"Int16"}],4),{members:lT}=sT;function uT(e,t,i,n,r,o){e.emplaceBack(t,i,n,r,o);}class cT{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.type=Dg.CIRCLE,this.layoutVertexArray=new Pa,this.indexArray=new Ba,this.segments=new ep,this.programConfigurations=new gf(lT,e.layers,e.zoom),this.projection=e.projection||mi.MERCATOR;}populate(e,t,i){const n=this.layers[0],r=[];let o=null;"circle"===n.type&&(o=n.layout.get("circle-sort-key")),this.baseP||(this.x=t.x,this.y=t.y,this.z=t.z,this.zPow=Math.pow(2,this.z),this.baseP=Nl(this.x,this.y,this.z,this.projection),this.matrix=Rl(this.baseP));for(const{feature:t,index:n,sourceLayerIndex:a}of e){const e=t.id,s=this.layers[0]._featureFilter.needGeometry,l={type:t.type,id:e,properties:t.properties,geometry:s?Sg(t):[]};if(!this.layers[0]._featureFilter(new Lp(this.zoom),t,i))continue;s||(l.geometry=Sg(t));const u=o?o.evaluate(l,{},i):void 0;r.push({id:e,properties:t.properties,type:t.type,sourceLayerIndex:a,index:n,geometry:l.geometry,patterns:{},sortKey:u});}o&&r.sort(((e,t)=>e.sortKey-t.sortKey));for(const n of r){const{geometry:r,index:o,sourceLayerIndex:a}=n,s=e[o].feature;this.addFeature(n,r,o,i),t.featureIndex.insert(s,r,o,a,this.index);}this.x=t.x,this.y=t.y,this.z=t.z;}update(e,t){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,lT),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());}calcTDSpacePoint(e,t,i){const n=Ll(this.x+e/8192,this.y+t/8192,this.zPow,this.projection),r=Nu.cartographicToCartesian3([n[0],n[1],i]);return [r[0]-this.baseP[0],r[1]-this.baseP[1],r[2]-this.baseP[2]]}addFeature(e,t,i,n){for(const i of t)for(const t of i){const i=t.x,n=t.y;if(i<0||i>=Wh||n<0||n>=Wh)continue;const r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),o=r.vertexLength;let a=0;const s=this.layers[0].layout.get("circle-height-key")||"circleHeight";e.properties&&e.properties[s]?a=parseFloat(e.properties[s]):e.properties&&e.properties.height&&e.properties[s]&&(a=parseFloat(e.properties.height));const l=this.calcTDSpacePoint(i,n,a);uT(this.layoutVertexArray,...l,-1,-1),uT(this.layoutVertexArray,...l,1,-1),uT(this.layoutVertexArray,...l,1,1),uT(this.layoutVertexArray,...l,-1,1),this.indexArray.emplaceBack(o,o+1,o+2),this.indexArray.emplaceBack(o,o+3,o+2),r.vertexLength+=4,r.primitiveLength+=2;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},n);}}$o("CircleBucket",cT,{omit:["layers"],shallow:["matrix"]});const hT=new qp({"circle-sort-key":new Up(Hg.layout_circle["circle-sort-key"]),"circle-height-key":new kp(Hg.layout_circle["circle-height-key"])});var dT={paint:new qp({"circle-radius":new Up(Hg.paint_circle["circle-radius"]),"circle-color":new Up(Hg.paint_circle["circle-color"]),"circle-blur":new Up(Hg.paint_circle["circle-blur"]),"circle-opacity":new Up(Hg.paint_circle["circle-opacity"]),"circle-translate":new kp(Hg.paint_circle["circle-translate"]),"circle-translate-anchor":new kp(Hg.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new kp(Hg.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new kp(Hg.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Up(Hg.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Up(Hg.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Up(Hg.paint_circle["circle-stroke-opacity"])}),layout:hT};function pT(e,t){const i=new St([e.x,e.y,0,1]).transform(t);return new te(i[0]/i[3],i[1]/i[3])}const fT=bi([{name:"a_pos_vec3",components:3,type:"Float32"},{name:"a_extrude",components:2,type:"Int8"}],4),{members:mT}=fT,_T=bi([{name:"a_pos",components:2,type:"Int16"}]),{members:gT}=_T;function yT(e,t,i,n,r){e.emplaceBack(2*t+(n+1)/2,2*i+(r+1)/2);}function xT(e,t,i,n,r,o){e.emplaceBack(t,i,n,r,o);}class vT{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.type=Dg.HEATMAP,this.layoutVertexArray=new pa,this.layoutVertexArray2=new ea,this.indexArray=new Ba,this.segments=new ep,this.programConfigurations=new gf(mT,e.layers,e.zoom),this.projection=e.projection||mi.MERCATOR;}populate(e,t,i){const n=[];this.baseP||(this.x=t.x,this.y=t.y,this.z=t.z,this.zPow=Math.pow(2,this.z),this.baseP=Nl(this.x,this.y,this.z,this.projection),this.matrix=Rl(this.baseP));for(const{feature:t,id:r,index:o,sourceLayerIndex:a}of e){const e=this.layers[0]._featureFilter.needGeometry,s={type:t.type,id:r,properties:t.properties,geometry:e?Sg(t):[]};this.layers[0]._featureFilter(new Lp(this.zoom),t,i)&&(e||(s.geometry=Sg(t)),n.push({id:r,properties:t.properties,type:t.type,sourceLayerIndex:a,index:o,geometry:s.geometry,patterns:{}}));}for(const r of n){const{geometry:n,index:o,sourceLayerIndex:a}=r,s=e[o].feature;this.addFeature(r,n,o,i,t.keepBuffer),t.featureIndex.insert(s,n,o,a,this.index);}this.x=t.x,this.y=t.y,this.z=t.z,0==this.layoutVertexArray2.length&&delete this.layoutVertexArray2;}update(e,t){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2&&0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,gT)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mT),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.layoutVertexBuffer2&&this.layoutVertexBuffer2.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());}calcTDSpacePoint(e,t){const i=Ll(this.x+e/8192,this.y+t/8192,this.zPow,this.projection),n=Nu.cartographicToCartesian3([i[0],i[1],0]);return [n[0]-this.baseP[0],n[1]-this.baseP[1],n[2]-this.baseP[2]]}addFeature(e,t,i,n,r){for(const e of t)for(const t of e){const e=t.x,i=t.y;if(!r&&(e<0||e>=Wh||i<0||i>=Wh))continue;const n=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),o=n.vertexLength,a=this.calcTDSpacePoint(e,i);xT(this.layoutVertexArray,a[0],a[1],a[2],-1,-1),xT(this.layoutVertexArray,a[0],a[1],a[2],1,-1),xT(this.layoutVertexArray,a[0],a[1],a[2],1,1),xT(this.layoutVertexArray,a[0],a[1],a[2],-1,1),yT(this.layoutVertexArray2,e,i,-1,-1),yT(this.layoutVertexArray2,e,i,1,-1),yT(this.layoutVertexArray2,e,i,1,1),yT(this.layoutVertexArray2,e,i,-1,1),this.indexArray.emplaceBack(o,o+1,o+2),this.indexArray.emplaceBack(o,o+3,o+2),n.vertexLength+=4,n.primitiveLength+=2;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},n);}}$o("HeatmapBucket",vT,{omit:["layers"],shallow:["matrix"]});const wT=new qp({"display-mode":new kp(Hg.layout_heatmap["display-mode"])});var TT={paint:new qp({"heatmap-height":new kp(Hg.paint_heatmap["heatmap-height"]),"heatmap-radius":new Up(Hg.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Up(Hg.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new kp(Hg.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Yp(Hg.paint_heatmap["heatmap-color"]),"heatmap-opacity":new kp(Hg.paint_heatmap["heatmap-opacity"]),"heatmap-height-factor":new Up(Hg.paint_heatmap["heatmap-height-factor"])}),layout:wT};function bT(e){const t={},i=e.resolution||256,n=e.clips?e.clips.length:1,r=e.image||new Pw({width:i,height:n}),o=(i,n,o)=>{t[e.evaluationKey]=o;const a=e.expression.evaluate(t);r.data[i+n+0]=Math.floor(255*a.r),r.data[i+n+1]=Math.floor(255*a.g),r.data[i+n+2]=Math.floor(255*a.b),r.data[i+n+3]=Math.floor(255*a.a);};if(e.clips)for(let t=0,r=0;t<n;++t,r+=4*i)for(let n=0,a=0;n<i;n++,a+=4){const s=n/(i-1),{start:l,end:u}=e.clips[t];o(r,a,l*(1-s)+u*s);}else for(let e=0,t=0;e<i;e++,t+=4)o(0,t,e/(i-1));return r}function PT(e,t){return t.replace(/{([^{}]+)}/g,((t,i)=>i in e?String(e[i]):""))}const ST=bi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_NORMAL_ED",components:3,type:"Float32"},{name:"a_ST",components:3,type:"Float32"}],4),ET=bi([{name:"a_ANS_POS_TIME_0",components:1,type:"Float32"},{name:"a_ANS_POS_TIME_1",components:1,type:"Float32"},{name:"a_ANS_NORMAL_WITH_LENGTH",components:3,type:"Float32"},{name:"a_ANS_BASE_POSITION",components:3,type:"Float32"}],4),AT=bi([{name:"a_ANS_COLOR_TIME_0",components:1,type:"Float32"},{name:"a_ANS_COLOR_TIME_1",components:1,type:"Float32"},{name:"a_ANS_VERTEXCOLOR_0",components:4,type:"Uint8"},{name:"a_ANS_VERTEXCOLOR_1",components:4,type:"Uint8"}],1),{members:CT}=ST,MT=Math.pow(2,13),IT=[1,0,16384];function LT(e,t,i,n,r,o,a,s,l,u){e.emplaceBack(t,i,n,r,o,a,s,l,u);}function NT(e,t,i,n){e.emplaceBack(t.t0,t.t1,i.x,i.y,i.z,n.x,n.y,n.z);}class RT{constructor(e,t){this.featureTriangles=[],this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.type=Dg.EXTRUSION,this.layoutVertexArray=new fa,this.positionAnimationVertexArray=new ma,this.colorAnimationVertexArray=new _a,this.indexArray=new Ba,this.programConfigurations=new gf(CT,e.layers,e.zoom),this.segments=new ep,this.projection=e.projection||mi.MERCATOR,this.enableQuery=t,this._animationFlag=!1;}populate(e,t,i){this.x=t.x,this.y=t.y,this.z=t.z,this.patternFeatures=[],this.hasPattern=Jx("extrusion",this.layers,t);for(const{feature:n,id:r,index:o,sourceLayerIndex:a}of e)if(this.layers[0]._featureFilter(new Lp(this.zoom),n,i)){const e=Sg(n);if(FT(e))continue;const s={id:r,sourceLayerIndex:a,index:o,geometry:e,properties:n.properties,type:n.type,patterns:{}};void 0!==n.id&&(s.id=n.id);const l=[];this.hasPattern?(this.patternFeatures.push(ev("extrusion",this.layers,s,this.zoom,t)),this.addFeature(n,e,o,i,{},l)):this.addFeature(n,e,o,i,{},l),this.enableQuery&&this.featureTriangles.push({feature:n.toGeoJSON(this.x,this.y,this.z),triangles:l});}this.baseP&&(this.matrix=Rl(this.baseP));}addFeatures(e,t,i){for(const e of this.patternFeatures){const n=[],{geometry:r}=e;this.addFeature(e,r,e.index,t,i,n);}}update(e,t,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,CT),this.indexBuffer=e.createIndexBuffer(this.indexArray),this._animationFlag&&this.uploadAnimationBuffers(e)),this.programConfigurations.upload(e),this.uploaded=!0;}uploadAnimationBuffers(e){this.animationVertexBuffers={},this.positionAnimationVertexArray.length>0&&(this.animationVertexBuffers.positionAnimationVertexBuffer=e.createVertexBuffer(this.positionAnimationVertexArray,ET.members)),this.colorAnimationVertexArray.length>0&&(this.animationVertexBuffers.colorAnimationVertexBuffer=e.createVertexBuffer(this.colorAnimationVertexArray,AT.members));}destroyAnimationBuffers(){if(Object.keys(this?.animationVertexBuffers).length>0)for(const e in this.animationVertexBuffers)Object.hasOwnProperty.call(this.animationVertexBuffers,e)&&this.animationVertexBuffers[e].destroy();}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this._animationFlag&&this.destroyAnimationBuffers());}addAnimationEdgeFeature(e,t,i){e:{const n=e?.targetValues,r=e?.times;if(!n||n.length<2||!r||r.length<2)break e;this._animationFlag=!0;const o=n[0],a=n[1],s=r[0],l=r[1],u=Il(t.x,t.y,o,this.x,this.y,this.z,this.projection),c=Il(i.x,i.y,o,this.x,this.y,this.z,this.projection),h=Nu.DefaultEllipsoid.geodeticSurfaceNormal(u),d=Nu.DefaultEllipsoid.geodeticSurfaceNormal(c),p=o-o,f=a-o;NT(this.positionAnimationVertexArray,{t0:0,t1:0},{x:h[0]*p,y:h[1]*p,z:h[2]*p},{x:u[0]-this.baseP[0],y:u[1]-this.baseP[1],z:u[2]-this.baseP[2]}),NT(this.positionAnimationVertexArray,{t0:s,t1:l},{x:h[0]*f,y:h[1]*f,z:h[2]*f},{x:u[0]-this.baseP[0],y:u[1]-this.baseP[1],z:u[2]-this.baseP[2]}),NT(this.positionAnimationVertexArray,{t0:0,t1:0},{x:d[0]*p,y:d[1]*p,z:d[2]*p},{x:c[0]-this.baseP[0],y:c[1]-this.baseP[1],z:c[2]-this.baseP[2]}),NT(this.positionAnimationVertexArray,{t0:s,t1:l},{x:d[0]*f,y:d[1]*f,z:d[2]*f},{x:c[0]-this.baseP[0],y:c[1]-this.baseP[1],z:c[2]-this.baseP[2]});}}addAnimationTopFeature(e,t){const i=e?.targetValues,n=e?.times,r=i[0],o=n[0],a=n[1],s=i[1]-r,l=Il(t.x,t.y,r,this.x,this.y,this.z,this.projection),u=Nu.DefaultEllipsoid.geodeticSurfaceNormal(l);NT(this.positionAnimationVertexArray,{t0:o,t1:a},{x:u[0]*s,y:u[1]*s,z:u[2]*s},{x:l[0]-this.baseP[0],y:l[1]-this.baseP[1],z:l[2]-this.baseP[2]});}addFeature(e,t,i,n,r,o){let a=0;const s=this.layers[0].paint.get("extrusion-height"),l=this.layers[0].paint.get("extrusion-base"),u=this.layers[0].paint.get("extrusion-pattern-factor"),c=u&&0===u[0]&&0===u[1],h=l.evaluate(e,{},n)||0;a=s.evaluate(e,{},n)||0;const d=e?.properties?.animations?.positionKeyframeTrack;if(d){const e=d?.targetValues,t=d?.times;(!e||e.length<2||!t||t.length<2)&&console.warn(`${this.layers[0].id}图层的形变动画缺少形变的关键帧数据，至少要有2个形变数据`);}for(const i of Rv(t,500)){let t=0,n=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const e of i)if(0!==e.length){t+=e.length;for(let t=0;t<e.length;t++)if(t>=1){const i=e[t],r=e[t-1];if(DT(i,r))continue;if(!OT(i,r)){n.vertexLength+4>ep.MAX_VERTEX_ARRAY_LENGTH&&(n=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const e=Il(i.x,i.y,h,this.x,this.y,this.z,this.projection);this.baseP||(this.baseP=e);const t=Il(i.x,i.y,a,this.x,this.y,this.z,this.projection),s=Il(r.x,r.y,h,this.x,this.y,this.z,this.projection),l=Il(r.x,r.y,a,this.x,this.y,this.z,this.projection),f=this.baseP,m=i.sub(r)._perp()._unit();if(u){let i,n;c?(n=a,i=_t.distance(new _t(e),new _t(s))):(i=u[0],n=u[1]),LT(this.layoutVertexArray,e[0]-f[0],e[1]-f[1],e[2]-f[2],m[0],m[1],m[2],0,0,0),LT(this.layoutVertexArray,t[0]-f[0],t[1]-f[1],t[2]-f[2],m[0],m[1],m[2],0,n,0),LT(this.layoutVertexArray,s[0]-f[0],s[1]-f[1],s[2]-f[2],m[0],m[1],m[2],i,0,0),LT(this.layoutVertexArray,l[0]-f[0],l[1]-f[1],l[2]-f[2],m[0],m[1],m[2],i,n,0);}else {const i=(p=m.y,new _t(2*Math.floor(m.x*MT)+0,p*MT*2,0*MT*2));LT(this.layoutVertexArray,e[0]-f[0],e[1]-f[1],e[2]-f[2],i.x,i.y,i.z,0,0,0),LT(this.layoutVertexArray,t[0]-f[0],t[1]-f[1],t[2]-f[2],i.x,i.y,i.z,0,1,0),LT(this.layoutVertexArray,s[0]-f[0],s[1]-f[1],s[2]-f[2],i.x,i.y,i.z,1,0,0),LT(this.layoutVertexArray,l[0]-f[0],l[1]-f[1],l[2]-f[2],i.x,i.y,i.z,1,1,0);}const _=n.vertexLength;this.indexArray.emplaceBack(_,_+2,_+1),this.indexArray.emplaceBack(_+1,_+2,_+3),o.push([e,t,s],[t,s,l]),n.vertexLength+=4,n.primitiveLength+=2,d&&this.addAnimationEdgeFeature(d,i,r);}}}if(n.vertexLength+t>ep.MAX_VERTEX_ARRAY_LENGTH&&(n=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray)),"Polygon"!==Ng.VectorTileFeature.types[e.type])continue;const r=[],s=[],l=n.vertexLength,f=[],m=Math.pow(2,9-this.z);for(const e of i)if(0!==e.length){e!==i[0]&&s.push(r.length/2);for(let t=0;t<e.length;t++){const i=e[t],n=[i.x*m,i.y*m],o=Il(i.x,i.y,a,this.x,this.y,this.z,this.projection);f.push(o),this.baseP||(this.baseP=o),LT(this.layoutVertexArray,o[0]-this.baseP[0],o[1]-this.baseP[1],o[2]-this.baseP[2],IT[0],IT[1],IT[2],n[0],n[1],1),r.push(i.x),r.push(i.y),d&&this.addAnimationTopFeature(d,i);}}const _=tv(r,s);for(let e=0;e<_.length;e+=3)this.indexArray.emplaceBack(l+_[e],l+_[e+2],l+_[e+1]),o.push([f[_[e]],f[_[e+1]],f[_[e+2]]]);n.primitiveLength+=_.length/3,n.vertexLength+=t;}var p;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,r,n);}}function OT(e,t){return e.x===t.x&&(e.x<0||e.x>Wh)||e.y===t.y&&(e.y<0||e.y>Wh)}function DT(e,t){return e.x===t.x&&(0===e.x||8192===e.x)||e.y===t.y&&(0===e.y||8192===e.y)}function FT(e){for(let t=0;t<e.length;t++){const i=e[t];return i.every((e=>e.x<0))||i.every((e=>e.x>Wh))||i.every((e=>e.y<0))||i.every((e=>e.y>Wh))}}$o("SphereExtrusionBucket",RT,{omit:["layers"],shallow:["matrix"]});var zT={paint:new qp({"extrusion-opacity":new Up(Hg.paint_extrusion["extrusion-opacity"]),"extrusion-color":new Up(Hg.paint_extrusion["extrusion-color"]),"extrusion-translate":new Up(Hg.paint_extrusion["extrusion-translate"]),"extrusion-translate-anchor":new Up(Hg.paint_extrusion["extrusion-translate-anchor"]),"extrusion-pattern":new Gp(Hg.paint_extrusion["extrusion-pattern"]),"extrusion-top-pattern":new Gp(Hg.paint_extrusion["extrusion-top-pattern"]),"extrusion-height":new Up(Hg.paint_extrusion["extrusion-height"]),"extrusion-base":new Up(Hg.paint_extrusion["extrusion-base"]),"extrusion-pattern-factor":new kp(Hg.paint_extrusion["extrusion-pattern-factor"]),"extrusion-self-bloom":new kp(Hg.paint_extrusion["extrusion-self-bloom"]),"extrusion-bloom-height":new kp(Hg.paint_extrusion["extrusion-bloom-height"]),"extrusion-glow-pure-color-height":new kp(Hg.paint_extrusion["extrusion-glow-pure-color-height"]),"extrusion-glow-width":new kp(Hg.paint_extrusion["extrusion-glow-width"]),"extrusion-glow-speed":new kp(Hg.paint_extrusion["extrusion-glow-speed"]),"extrusion-roughness":new kp(Hg.paint_extrusion["extrusion-roughness"]),"extrusion-offset":new Up(Hg.paint_extrusion["extrusion-offset"]),"extrusion-rotation":new Up(Hg.paint_extrusion["extrusion-rotation"]),"extrusion-scale":new Up(Hg.paint_extrusion["extrusion-scale"])})};const BT=bi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_normal_vec2",components:2,type:"Int8"},{name:"a_data",components:4,type:"Uint8"},{name:"a_seq",components:1,type:"Uint16"}],4),VT=bi([{name:"a_ANS_POS_TIME",components:1,type:"Float32"},{name:"a_ANS_TRIP_TOTAL_TIME",components:1,type:"Float32"},{name:"a_ANS_TRIP_LENGTH",components:1,type:"Float32"}],4),{members:kT}=BT,UT=Ng.VectorTileFeature.types,GT=Math.cos(Math.PI/180*37.5),HT=Math.pow(2,14)/.5;function YT(e,t,i,n,r,o,a,s){e.emplaceBack(t.x,t.y,t.z,n?1:0,r?1:-1,Math.round(63*i.x)+128,Math.round(63*i.y)+128,1+(0===o?0:o<0?-1:1)|(.5*a&63)<<2,.5*a>>6,s);}function qT(e,t,i,n){e.emplaceBack(t,i,n);}class XT{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.type=Dg.TRACKING,this.layoutVertexArray=new Ta,this.tripsAnimationVertexArray=new ba,this.indexArray=new Ba,this.programConfigurations=new gf(kT,e.layers,e.zoom),this.segments=new ep,this.projection=e.projection||mi.MERCATOR,this._animationFlag=!1;}populate(e,t,i){this.baseP||(this.x=t.x,this.y=t.y,this.z=t.z,this.zPow=Math.pow(2,this.z),this.baseP=Nl(this.x,this.y,this.z,this.projection),this.matrix=Rl(this.baseP));for(const{feature:n,index:r,sourceLayerIndex:o}of e)if(this.layers[0]._featureFilter(new Lp(this.zoom),n,i)){const e=Sg(n);this.addFeature(n,e,r,i),t.featureIndex.insert(n,e,r,o,this.index);}}update(e,t){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,kT),this.indexBuffer=e.createIndexBuffer(this.indexArray),this._animationFlag&&this.uploadAnimationBuffers(e)),this.programConfigurations.upload(e),this.uploaded=!0;}uploadAnimationBuffers(e){this.animationVertexBuffers={},this.tripsAnimationVertexArray.length>0&&(this.animationVertexBuffers.tripsAnimationVertexBuffer=e.createVertexBuffer(this.tripsAnimationVertexArray,VT.members));}destroyAnimationBuffers(){if(Object.keys(this?.animationVertexBuffers).length>0)for(const e in this.animationVertexBuffers)Object.hasOwnProperty.call(this.animationVertexBuffers,e)&&this.animationVertexBuffers[e].destroy();}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this._animationFlag&&this.destroyAnimationBuffers());}addFeature(e,t,i,n){const r=this.layers[0].layout,o=r.get("tracking-join").evaluate(e,{}),a=r.get("tracking-cap"),s=r.get("tracking-miter-limit"),l=r.get("tracking-round-limit"),u=Number(e.properties.link_seq);for(const r of t)this.addLine(r,e,o,a,s,l,i,u,n);}addLine(e,t,i,n,r,o,a,s,l){const u=t?.properties?.animations?.tripsKeyframeTrack;if(u){const t=u?.times;t&&t.length===e.length?(u.available=!0,this._animationFlag=!0):u.available=!0;}const c="Polygon"===UT[t.type];let h=e.length;for(;h>=2&&e[h-1].equals(e[h-2]);)h--;let d=0;for(;d<h-1&&e[d].equals(e[d+1]);)d++;if(h<(c?3:2))return;"bevel"===i&&(r=1.05);const p=Wh/(512*this.overscaling)*15,f=e[d],m=this.segments.prepareSegment(10*h,this.layoutVertexArray,this.indexArray);this.distance=0;const _=n,g=c?"butt":n;let y,x,v,w,T,b,P,S=!0;this.e1=this.e2=this.e3=-1,c&&(y=e[h-2],T=f.sub(y)._unit()._perp());for(let t=d;t<h;t++){if(s+=1,v=c&&t===h-1?e[d+1]:e[t+1],v&&e[t].equals(v))continue;T&&(w=T),y&&(x=y),y=e[t],T=v?v.sub(y)._unit()._perp():w,w=w||T;let n=w.add(T);0===n.x&&0===n.y||n._unit();const a=n.x*T.x+n.y*T.y,l=0!==a?1/a:1/0,f=a<GT&&x&&v;if(f&&t>d){const e=y.dist(x);if(e>2*p){const i=y.sub(y.sub(x)._mult(p/e)._round());this.distance+=i.dist(x),this.addCurrentVertex(i,this.distance,w.mult(1),0,0,!1,m,s,{tripsKeyframeTrack:u,timeIndex:t}),x=i;}}const E=x&&v;let A=E?i:v?_:g;if(E&&"round"===A&&(l<o?A="miter":l<=2&&(A="fakeround")),"miter"===A&&l>r&&(A="bevel"),"bevel"===A&&(l>2&&(A="flipbevel"),l<r&&(A="miter")),x&&(this.distance+=y.dist(x)),"miter"===A)n._mult(l),this.addCurrentVertex(y,this.distance,n,0,0,!1,m,s,{tripsKeyframeTrack:u,timeIndex:t});else if("flipbevel"===A){if(l>100)n=T.clone().mult(-1);else {const e=w.x*T.y-w.y*T.x>0?-1:1,t=l*w.add(T).mag()/w.sub(T).mag();n._perp()._mult(t*e);}this.addCurrentVertex(y,this.distance,n,0,0,!1,m,s,{tripsKeyframeTrack:u,timeIndex:t}),this.addCurrentVertex(y,this.distance,n.mult(-1),0,0,!1,m,s,{tripsKeyframeTrack:u,timeIndex:t});}else if("bevel"===A||"fakeround"===A){const e=w.x*T.y-w.y*T.x>0,i=-Math.sqrt(l*l-1);if(e?(P=0,b=i):(b=0,P=i),S||this.addCurrentVertex(y,this.distance,w,b,P,!1,m,s,{tripsKeyframeTrack:u,timeIndex:t}),"fakeround"===A){const i=Math.floor(8*(.5-(a-.5)));let r;for(let n=0;n<i;n++)r=T.mult((n+1)/(i+1))._add(w)._unit(),this.addPieSliceVertex(y,this.distance,r,e,m,s,{tripsKeyframeTrack:u,timeIndex:t});this.addPieSliceVertex(y,this.distance,n,e,m,s,{tripsKeyframeTrack:u,timeIndex:t});for(let n=i-1;n>=0;n--)r=w.mult((n+1)/(i+1))._add(T)._unit(),this.addPieSliceVertex(y,this.distance,r,e,m,s,{tripsKeyframeTrack:u,timeIndex:t});}v&&this.addCurrentVertex(y,this.distance,T,-b,-P,!1,m,s,{tripsKeyframeTrack:u,timeIndex:t});}else "butt"===A?(S||this.addCurrentVertex(y,this.distance,w,0,0,!1,m,s,{tripsKeyframeTrack:u,timeIndex:t}),v&&this.addCurrentVertex(y,this.distance,T,0,0,!1,m,s,{tripsKeyframeTrack:u,timeIndex:t})):"square"===A?(S||(this.addCurrentVertex(y,this.distance,w,1,1,!1,m,s,{tripsKeyframeTrack:u,timeIndex:t}),this.e1=this.e2=-1),v&&this.addCurrentVertex(y,this.distance,T,-1,-1,!1,m,s,{tripsKeyframeTrack:u,timeIndex:t})):"round"===A&&(S||(this.addCurrentVertex(y,this.distance,w,0,0,!1,m,s,{tripsKeyframeTrack:u,timeIndex:t}),this.addCurrentVertex(y,this.distance,w,1,1,!0,m,s,{tripsKeyframeTrack:u,timeIndex:t}),this.e1=this.e2=-1),v&&(this.addCurrentVertex(y,this.distance,T,-1,-1,!0,m,s,{tripsKeyframeTrack:u,timeIndex:t}),this.addCurrentVertex(y,this.distance,T,0,0,!1,m,s,{tripsKeyframeTrack:u,timeIndex:t})));if(f&&t<h-1){const e=y.dist(v);if(e>2*p){const i=y.add(v.sub(y)._mult(p/e)._round());this.distance+=i.dist(y),this.addCurrentVertex(i,this.distance,T.mult(1),0,0,!1,m,s,{tripsKeyframeTrack:u,timeIndex:t}),y=i;}}S=!1;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},l);}calcTDSpacePoint(e){const t=Ll(this.x+e.x/8192,this.y+e.y/8192,this.zPow,this.projection),i=Nu.cartographicToCartesian3([t[0],t[1],0]);return new te(i[0]-this.baseP[0],i[1]-this.baseP[1],i[2]-this.baseP[2])}addCurrentVertex(e,t,i,n,r,o,a,s,l){const{tripsKeyframeTrack:u,timeIndex:c}=l;let h;const d=this.layoutVertexArray,p=this.indexArray;h=i.clone(),n&&h._sub(i.perp()._mult(n));const f=this.calcTDSpacePoint(e);if(YT(d,f,h,o,!1,n,t,s),u&&u.available){const{times:e,totalTime:t,tripLength:i}=u;qT(this.tripsAnimationVertexArray,e[c],t,i);}if(this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),this.e1=this.e2,this.e2=this.e3,h=i.mult(-1),r&&h._sub(i.perp()._mult(r)),YT(d,f,h,o,!0,-r,t,s),u&&u.available){const{times:e,totalTime:t,tripLength:i}=u;qT(this.tripsAnimationVertexArray,e[c],t,i);}this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),this.e1=this.e2,this.e2=this.e3,t>HT/2&&(this.distance=0,this.addCurrentVertex(e,this.distance,i,n,r,o,a,s,{tripsKeyframeTrack:u,timeIndex:c}));}addPieSliceVertex(e,t,i,n,r,o,a){const{tripsKeyframeTrack:s,timeIndex:l}=a;i=i.mult(n?-1:1);const u=this.indexArray;if(YT(this.layoutVertexArray,this.calcTDSpacePoint(e),i,!1,n,0,t,o),s&&s.available){const{times:e,totalTime:t,tripLength:i}=s;qT(this.tripsAnimationVertexArray,e[l],t,i);}this.e3=r.vertexLength++,this.e1>=0&&this.e2>=0&&(u.emplaceBack(this.e1,this.e2,this.e3),r.primitiveLength++),n?this.e2=this.e3:this.e1=this.e3;}}$o("TrackingBucket",XT,{omit:["layers"],shallow:["matrix"]});const WT=new qp({"tracking-cap":new kp(Hg.layout_tracking["tracking-cap"]),"tracking-join":new Up(Hg.layout_tracking["tracking-join"]),"tracking-miter-limit":new kp(Hg.layout_tracking["tracking-miter-limit"]),"tracking-round-limit":new kp(Hg.layout_tracking["tracking-round-limit"]),"tracking-sort-key":new Up(Hg.layout_tracking["tracking-sort-key"]),"tracking-display-mode":new kp(Hg.layout_tracking["tracking-display-mode"])});var jT={paint:new qp({"tracking-opacity":new Up(Hg.paint_tracking["tracking-opacity"]),"tracking-color":new Up(Hg.paint_tracking["tracking-color"]),"tracking-translate":new kp(Hg.paint_tracking["tracking-translate"]),"tracking-translate-anchor":new kp(Hg.paint_tracking["tracking-translate-anchor"]),"tracking-width":new Up(Hg.paint_tracking["tracking-width"]),"tracking-gap-width":new Up(Hg.paint_tracking["tracking-gap-width"]),"tracking-offset":new Up(Hg.paint_tracking["tracking-offset"]),"tracking-blur":new Up(Hg.paint_tracking["tracking-blur"]),"tracking-type":new kp(Hg.paint_tracking["tracking-type"]),"tracking-run-time":new kp(Hg.paint_tracking["tracking-run-time"]),"tracking-seg-count":new kp(Hg.paint_tracking["tracking-seg-count"]),"tracking-seg-group":new kp(Hg.paint_tracking["tracking-seg-group"]),"tracking-speed":new kp(Hg.paint_tracking["tracking-speed"]),"tracking-delay":new kp(Hg.paint_tracking["tracking-delay"]),"tracking-speed-factor":new kp(Hg.paint_tracking["tracking-speed-factor"])}),layout:WT};const $T=new class extends Up{possiblyEvaluate(e,t){return t=new Lp(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,n){return t=Ve({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,n)}}(jT.paint.properties["tracking-width"].specification);function ZT(e,t){return t>0?t+2*e:e}$T.useIntegerZoom=!0;var KT={paint:new qp({"3d-model-opacity":new kp(Hg["paint_3d-model"]["3d-model-opacity"])})},QT={paint:new qp({"point-cloud-color":new Up(Hg["paint_3d-tiles"]["point-cloud-color"])})};const JT=bi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_normal_vec2",components:2,type:"Int8"},{name:"a_data",components:4,type:"Uint8"},{name:"a_extra_m",components:3,type:"Uint8"},{name:"a_pos_normal",components:2,type:"Int16"}],4),{members:eb}=JT,tb=Ng.VectorTileFeature.types,ib=Math.cos(Math.PI/180*37.5),nb=Math.pow(2,14)/.5;let rb=0,ob=0,ab=1;function sb(e,t,i,n,r,o,a,s){e.emplaceBack(i.x,i.y,i.z,r?1:0,o?1:-1,Math.round(63*n.x)+128,Math.round(63*n.y)+128,1+(0===a?0:a<0?-1:1)|(.5*s&63)<<2,.5*s>>6,255&rb,parseInt(ob),parseInt(ab),(t.x<<1)+(r?1:0),(t.y<<1)+(o?1:0));}class lb{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.patternFeatures=[],this.type=Dg.SPRITE,this.layoutVertexArray=new ga,this.indexArray=new Ba,this.programConfigurations=new gf(eb,e.layers,e.zoom),this.segments=new ep,this.projection=e.projection||mi.MERCATOR,this.curOpacity=0,this.curNum=0,this.curStatus=1,this._percent=0;}populate(e,t,i){this.baseP||(this.x=t.x,this.y=t.y,this.z=t.z,this.zPow=Math.pow(2,this.z),this.baseP=Nl(this.x,this.y,this.z,this.projection),this.matrix=Rl(this.baseP)),this.hasPattern=Jx("sprite",this.layers,t);const n=[];for(const{feature:t,id:r,index:o,sourceLayerIndex:a}of e){const e=this.layers[0]._featureFilter.needGeometry,s={type:t.type,id:r,properties:t.properties,geometry:e?Sg(t):[]};this.layers[0]._featureFilter(new Lp(this.zoom),s,i)&&(e||(s.geometry=Sg(t)),n.push({id:r,properties:t.properties,type:t.type,sourceLayerIndex:a,index:o,geometry:s.geometry,patterns:{}}));}for(const r of n){const{geometry:n,index:o,sourceLayerIndex:a}=r;if(this.hasPattern){this.imageNeedResize=!0;const e=ev("sprite",this.layers,r,this.zoom,t);this.patternFeatures.push(e);}else this.addFeature(r,n,o,i,{});t.featureIndex.insert(e[o].feature,n,o,a,this.index);}}update(e,t){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers);}addFeatures(e,t,i){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,i);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,eb),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());}addFeature(e,t,i,n,r){const o=this.layers[0].layout,a=o.get("sprite-join").evaluate(e,{}),s=o.get("sprite-cap"),l=o.get("sprite-miter-limit"),u=o.get("sprite-round-limit");ob=e.properties.link_seq?Number(e.properties.link_seq):ob,ob%=10,ab=Number(e.properties.status)||1;for(const r of t)this.addLine(r,e,a,s,l,u,i,n);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,r,n);}addLine(e,t,i,n,r,o){const a="Polygon"===tb[t.type];let s=e.length;for(;s>=2&&e[s-1].equals(e[s-2]);)s--;let l=0;for(;l<s-1&&e[l].equals(e[l+1]);)l++;if(s<(a?3:2))return;"bevel"===i&&(r=1.05);const u=Wh/(512*this.overscaling)*15,c=e[l],h=this.segments.prepareSegment(10*s,this.layoutVertexArray,this.indexArray);this.distance=0;const d=n,p=a?"butt":n;let f,m,_,g,y,x,v,w=!0;this.e1=this.e2=this.e3=-1,a&&(f=e[s-2],y=c.sub(f)._unit()._perp());for(let t=l;t<s;t++){if(rb=Math.round(255/s*t),_=a&&t===s-1?e[l+1]:e[t+1],_&&e[t].equals(_))continue;y&&(g=y),f&&(m=f),f=e[t],y=_?_.sub(f)._unit()._perp():g,g=g||y;let n=g.add(y);0===n.x&&0===n.y||n._unit();const c=n.x*y.x+n.y*y.y,T=0!==c?1/c:1/0,b=c<ib&&m&&_;if(b&&t>l){const e=f.dist(m);if(e>2*u){const t=f.sub(f.sub(m)._mult(u/e)._round());this.distance+=t.dist(m),this.addCurrentVertex(t,this.distance,g.mult(1),0,0,!1,h),m=t;}}const P=m&&_;let S=P?i:_?d:p;if(P&&"round"===S&&(T<o?S="miter":T<=2&&(S="fakeround")),"miter"===S&&T>r&&(S="bevel"),"bevel"===S&&(T>2&&(S="flipbevel"),T<r&&(S="miter")),m&&(this.distance+=f.dist(m)),"miter"===S)n._mult(T),this.addCurrentVertex(f,this.distance,n,0,0,!1,h);else if("flipbevel"===S){if(T>100)n=y.clone().mult(-1);else {const e=g.x*y.y-g.y*y.x>0?-1:1,t=T*g.add(y).mag()/g.sub(y).mag();n._perp()._mult(t*e);}this.addCurrentVertex(f,this.distance,n,0,0,!1,h),this.addCurrentVertex(f,this.distance,n.mult(-1),0,0,!1,h);}else if("bevel"===S||"fakeround"===S){const e=g.x*y.y-g.y*y.x>0,t=-Math.sqrt(T*T-1);if(e?(v=0,x=t):(x=0,v=t),w||this.addCurrentVertex(f,this.distance,g,x,v,!1,h),"fakeround"===S){const t=Math.floor(8*(.5-(c-.5)));let i;for(let n=0;n<t;n++)i=y.mult((n+1)/(t+1))._add(g)._unit(),this.addPieSliceVertex(f,this.distance,i,e,h);this.addPieSliceVertex(f,this.distance,n,e,h);for(let n=t-1;n>=0;n--)i=g.mult((n+1)/(t+1))._add(y)._unit(),this.addPieSliceVertex(f,this.distance,i,e,h);}_&&this.addCurrentVertex(f,this.distance,y,-x,-v,!1,h);}else "butt"===S?(w||this.addCurrentVertex(f,this.distance,g,0,0,!1,h),_&&this.addCurrentVertex(f,this.distance,y,0,0,!1,h)):"square"===S?(w||(this.addCurrentVertex(f,this.distance,g,1,1,!1,h),this.e1=this.e2=-1),_&&this.addCurrentVertex(f,this.distance,y,-1,-1,!1,h)):"round"===S&&(w||(this.addCurrentVertex(f,this.distance,g,0,0,!1,h),this.addCurrentVertex(f,this.distance,g,1,1,!0,h),this.e1=this.e2=-1),_&&(this.addCurrentVertex(f,this.distance,y,-1,-1,!0,h),this.addCurrentVertex(f,this.distance,y,0,0,!1,h)));if(b&&t<s-1){const e=f.dist(_);if(e>2*u){const t=f.add(_.sub(f)._mult(u/e)._round());this.distance+=t.dist(f),this.addCurrentVertex(t,this.distance,y.mult(1),0,0,!1,h),f=t;}}w=!1;}}calcTDSpacePoint(e){const t=Ll(this.x+e.x/8192,this.y+e.y/8192,this.zPow,this.projection),i=Nu.cartographicToCartesian3([t[0],t[1],0]);return new te(i[0]-this.baseP[0],i[1]-this.baseP[1],i[2]-this.baseP[2])}addCurrentVertex(e,t,i,n,r,o,a){let s;const l=this.layoutVertexArray,u=this.indexArray;s=i.clone(),n&&s._sub(i.perp()._mult(n));const c=this.calcTDSpacePoint(e);sb(l,e,c,s,o,!1,n,t),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(u.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),this.e1=this.e2,this.e2=this.e3,s=i.mult(-1),r&&s._sub(i.perp()._mult(r)),sb(l,e,c,s,o,!0,-r,t),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(u.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),this.e1=this.e2,this.e2=this.e3,t>nb/2&&(this.distance=0,this.addCurrentVertex(e,this.distance,i,n,r,o,a));}addPieSliceVertex(e,t,i,n,r){i=i.mult(n?-1:1);const o=this.indexArray;sb(this.layoutVertexArray,e,this.calcTDSpacePoint(e),i,!1,n,0,t),this.e3=r.vertexLength++,this.e1>=0&&this.e2>=0&&(o.emplaceBack(this.e1,this.e2,this.e3),r.primitiveLength++),n?this.e2=this.e3:this.e1=this.e3;}}$o("SpriteBucket",lb,{omit:["layers"],shallow:["matrix"]});const ub=new qp({"sprite-cap":new kp(Hg.layout_sprite["sprite-cap"]),"sprite-join":new Up(Hg.layout_sprite["sprite-join"]),"sprite-miter-limit":new kp(Hg.layout_sprite["sprite-miter-limit"]),"sprite-round-limit":new kp(Hg.layout_sprite["sprite-round-limit"]),"sprite-sort-key":new Up(Hg.layout_sprite["sprite-sort-key"])});var cb={paint:new qp({"sprite-opacity":new Up(Hg.paint_sprite["sprite-opacity"]),"sprite-color":new Up(Hg.paint_sprite["sprite-color"]),"sprite-translate":new Up(Hg.paint_sprite["sprite-translate"]),"sprite-translate-anchor":new Up(Hg.paint_sprite["sprite-translate-anchor"]),"sprite-width":new Up(Hg.paint_sprite["sprite-width"]),"sprite-gap-width":new Up(Hg.paint_sprite["sprite-gap-width"]),"sprite-offset":new Up(Hg.paint_sprite["sprite-offset"]),"sprite-blur":new Up(Hg.paint_sprite["sprite-blur"]),"sprite-speed-factor":new Up(Hg.paint_sprite["sprite-speed-factor"]),"sprite-speed":new Up(Hg.paint_sprite["sprite-speed"]),"sprite-pattern":new Gp(Hg.paint_sprite["sprite-pattern"]),"sprite-move-direction":new Up(Hg.paint_sprite["sprite-move-direction"]),"sprite-interpolate":new kp(Hg.paint_sprite["sprite-interpolate"]),"sprite-status":new Up(Hg.paint_sprite["sprite-status"]),"sprite-instatus":new Up(Hg.paint_sprite["sprite-instatus"])}),layout:ub};const hb=new class extends Up{possiblyEvaluate(e,t){return t=new Lp(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,n){return t=Ve({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,n)}}(cb.paint.properties["sprite-width"].specification);function db(e,t){return t>0?t+2*e:e}hb.useIntegerZoom=!0;class pb extends kx{constructor(e){super(e,{}),this.id=e.id,this.type=e.type,this.implementation=e;}serialize(){}resize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl);}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e);}}const fb=bi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_NORMAL_ED",components:3,type:"Float32"},{name:"a_ST",components:3,type:"Float32"}],4),{members:mb}=fb;function _b(e,t,i){if(e&&e.length<=0)return [];const n=[];n.push(new vb(new te(0,0),new te(8192,0))),n.push(new vb(new te(8192,0),new te(8192,8192))),n.push(new vb(new te(8192,8192),new te(0,8192))),n.push(new vb(new te(0,8192),new te(0,0))),t=t||n;let r,o=[],a=[],s=e[e.length-1];for(let t=0;t<e.length;t++)o.push(e[t]);for(const e in t){s=o[o.length-1],r=!gb(s,t[e]);for(let i=0;i<o.length;i++)gb(o[i],t[e])?(r&&(r=!1,a.push(xb(s,o[i],t[e].start,t[e].end))),a.push(o[i])):r||(r=!0,a.push(xb(s,o[i],t[e].start,t[e].end))),s=o[i];o=[];for(let e=0;e<a.length;e++)o.push(a[e]);a=[];}return o.push(i?o[0]:o[o.length-1]),o}function gb(e,t){return !!e&&yb(e,t.start,t.end)>=0}function yb(e,t,i){return (i.x-t.x)*(e.y-t.y)-(i.y-t.y)*(e.x-t.x)}function xb(e,t,i,n){const r=(yb(e,n,i)*t.x-yb(t,n,i)*e.x)/(yb(e,n,i)-yb(t,n,i)),o=(yb(e,n,i)*t.y-yb(t,n,i)*e.y)/(yb(e,n,i)-yb(t,n,i));return new te(r,o)}function vb(e,t){this.start=e,this.end=t;}function wb(e,t,i,n,r,o,a,s,l,u){e.emplaceBack(t,i,n,r,o,a,s,l,u);}class Tb{constructor(e){this.featureTrangles=[],this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.type=Dg.HISTOGRAM,this.layoutVertexArray=new fa,this.indexArray=new Ba,this.programConfigurations=new gf(mb,e.layers,e.zoom),this.segments=new ep,this.projection=e.projection||mi.MERCATOR;}populate(e,t,i){this.x=t.x,this.y=t.y,this.z=t.z;for(const{feature:t,index:n}of e)if(this.layers[0]._featureFilter(new Lp(this.zoom),t,i)){const e=Sg(t);this.addFeature(t,e,n,[],i);}this.baseP&&(this.matrix=Rl(this.baseP));}update(e,t){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mb),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());}addFeature(e,t,i,n,r){let o=0,a=0;const s=this.layers[0].paint.get("histogram-height"),l=this.layers[0].paint.get("histogram-base");o=s.evaluate(e,{},r)||0,a=l.evaluate(e,{},r)||0,this.layers[0].layout.get("histogram-max-height-render")&&(o*=100,a*=100);for(const e of Rv(t,500)){let t=0;for(const i of e)t+=i.length;let i=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let t of e)if(0!==t.length&&!Pb(t)){Sb(t)&&(t=_b(t));for(let e=0;e<t.length;e++){const r=t[e];if(e>=1){const s=t[e-1];if(Eb(r,s))continue;if(!bb(r,s)){i.vertexLength+4>ep.MAX_VERTEX_ARRAY_LENGTH&&(i=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const e=Il(r.x,r.y,a,this.x,this.y,this.z,this.projection);this.baseP||(this.baseP=e);const t=Il(r.x,r.y,o,this.x,this.y,this.z,this.projection),l=Il(s.x,s.y,a,this.x,this.y,this.z,this.projection),u=Il(s.x,s.y,o,this.x,this.y,this.z,this.projection),c=this.baseP,h=new _t;h.subVectors(e,t);const d=new _t;d.subVectors(e,l);const p=h.cross(d);wb(this.layoutVertexArray,e[0]-c[0],e[1]-c[1],e[2]-c[2],p[0],p[1],p[2],0,a/5,0),wb(this.layoutVertexArray,t[0]-c[0],t[1]-c[1],t[2]-c[2],p[0],p[1],p[2],0,o/5,1);const f=20*new _t(l).distance(e);wb(this.layoutVertexArray,l[0]-c[0],l[1]-c[1],l[2]-c[2],p[0],p[1],p[2],f,a/5,0),wb(this.layoutVertexArray,u[0]-c[0],u[1]-c[1],u[2]-c[2],p[0],p[1],p[2],f,o/5,1);const m=i.vertexLength;this.indexArray.emplaceBack(m,m+1,m+2),this.indexArray.emplaceBack(m+1,m+2,m+3),n.push([e,t,l],[t,l,u]),i.vertexLength+=4,i.primitiveLength+=2;}}}}i.vertexLength+t>ep.MAX_VERTEX_ARRAY_LENGTH&&(i=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray));const r=[],s=[],l=i.vertexLength,u=[];for(const t of e){if(0===t.length)continue;t!==e[0]&&s.push(r.length/2);const i=Ab(e);for(let e=0;e<t.length;e++){const n=t[e],a=[(n.x-i.minX)/i.maxLength,(n.y-i.minY)/i.maxLength],s=Il(n.x,n.y,o+(this.x%2+this.y%2)/256,this.x,this.y,this.z,this.projection);u.push(s),this.baseP||(this.baseP=s),wb(this.layoutVertexArray,s[0]-this.baseP[0],s[1]-this.baseP[1],s[2]-this.baseP[2],0,8,0,a[0],a[1],1),r.push(n.x),r.push(n.y);}}const c=tv(r,s);for(let e=0;e<c.length;e+=3)this.indexArray.emplaceBack(l+c[e],l+c[e+1],l+c[e+2]),n.push([u[c[e]],u[c[e+1]],u[c[e+2]]]);i.primitiveLength+=c.length/3,i.vertexLength+=t;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},r);}}function bb(e,t){return e.x===t.x&&(e.x<0||e.x>Wh)||e.y===t.y&&(e.y<0||e.y>Wh)}function Pb(e){return e.every((e=>e.x<0))||e.every((e=>e.x>Wh))||e.every((e=>e.y<0))||e.every((e=>e.y>Wh))}function Sb(e){return !(e.every((e=>e.x>=0))&&e.every((e=>e.x<=Wh))&&e.every((e=>e.y>=0))&&e.every((e=>e.y<=Wh)))}function Eb(e,t){return e.x===t.x&&(0===e.x||8192===e.x)||e.y===t.y&&(0===e.y||8192===e.y)}function Ab(e){let t=1/0,i=-1/0,n=1/0,r=-1/0;for(const o of e)for(const e of o)t>e.x&&(t=e.x),i<e.x&&(i=e.x),n>e.y&&(n=e.y),r<e.y&&(r=e.y);let o=i-t<512?512:i-t;return o<r-n&&(o=r-n),{minX:t,maxX:i,minY:n,maxY:r,maxLength:o}}$o("SphereHistogramBucket",Tb,{omit:["layers"],shallow:["matrix"]});const Cb=new qp({"histogram-max-height-render":new kp(Hg.layout_histogram["histogram-max-height-render"]),"histogram-color-render":new kp(Hg.layout_histogram["histogram-color-render"])});var Mb={paint:new qp({"histogram-opacity":new kp(Hg.paint_histogram["histogram-opacity"]),"histogram-color":new Up(Hg.paint_histogram["histogram-color"]),"histogram-colors":new kp(Hg.paint_histogram["histogram-colors"]),"histogram-translate":new kp(Hg.paint_histogram["histogram-translate"]),"histogram-translate-anchor":new kp(Hg.paint_histogram["histogram-translate-anchor"]),"histogram-height":new Up(Hg.paint_histogram["histogram-height"]),"histogram-base":new Up(Hg.paint_histogram["histogram-base"]),"histogram-vertical-gradient":new kp(Hg.paint_histogram["histogram-vertical-gradient"]),"histogram-dynamic":new kp(Hg.paint_histogram["histogram-dynamic"]),"histogram-heightArr1":new Up(Hg.paint_histogram["histogram-heightArr1"]),"histogram-heightArr2":new Up(Hg.paint_histogram["histogram-heightArr2"]),"histogram-heightArr3":new Up(Hg.paint_histogram["histogram-heightArr3"]),"histogram-speed":new kp(Hg.paint_histogram["histogram-speed"]),"histogram-count":new kp(Hg.paint_histogram["histogram-count"]),"histogram-max-height":new kp(Hg.paint_histogram["histogram-max-height"]),"depth-change":new kp(Hg.paint_histogram["depth-change"])}),layout:Cb};const Ib=new qp({"symtracking-display-mode":new kp(Hg.layout_symtracking["symtracking-display-mode"]),"symtracking-time-segment":new kp(Hg.layout_symtracking["symtracking-time-segment"]),"symtracking-fps":new kp(Hg.layout_symtracking["symtracking-fps"]),"symtracking-sort-key":new Up(Hg.layout_symtracking["symtracking-sort-key"]),"symtracking-z-order":new kp(Hg.layout_symtracking["symtracking-z-order"]),"compatible-mode":new kp(Hg.layout_symtracking["compatible-mode"]),"symbol-placement":new kp(Hg.layout_symtracking["symbol-placement"]),"symbol-spacing":new kp(Hg.layout_symtracking["symbol-spacing"]),"symbol-avoid-edges":new kp(Hg.layout_symtracking["symbol-avoid-edges"]),"icon-allow-overlap":new kp(Hg.layout_symtracking["icon-allow-overlap"]),"icon-ignore-placement":new kp(Hg.layout_symtracking["icon-ignore-placement"]),"icon-optional":new kp(Hg.layout_symtracking["icon-optional"]),"icon-rotation-alignment":new kp(Hg.layout_symtracking["icon-rotation-alignment"]),"icon-size":new Up(Hg.layout_symtracking["icon-size"]),"icon-text-fit":new kp(Hg.layout_symtracking["icon-text-fit"]),"icon-text-fit-padding":new kp(Hg.layout_symtracking["icon-text-fit-padding"]),"icon-image":new Up(Hg.layout_symtracking["icon-image"]),"icon-rotate":new Up(Hg.layout_symtracking["icon-rotate"]),"icon-padding":new kp(Hg.layout_symtracking["icon-padding"]),"icon-keep-upright":new kp(Hg.layout_symtracking["icon-keep-upright"]),"icon-offset":new Up(Hg.layout_symtracking["icon-offset"]),"icon-anchor":new Up(Hg.layout_symtracking["icon-anchor"]),"icon-pitch-alignment":new kp(Hg.layout_symtracking["icon-pitch-alignment"]),"text-pitch-alignment":new kp(Hg.layout_symtracking["text-pitch-alignment"]),"text-rotation-alignment":new kp(Hg.layout_symtracking["text-rotation-alignment"]),"text-field":new Up(Hg.layout_symtracking["text-field"]),"text-font":new Up(Hg.layout_symtracking["text-font"]),"text-size":new Up(Hg.layout_symtracking["text-size"]),"text-max-width":new Up(Hg.layout_symtracking["text-max-width"]),"text-line-height":new kp(Hg.layout_symtracking["text-line-height"]),"text-letter-spacing":new Up(Hg.layout_symtracking["text-letter-spacing"]),"text-justify":new Up(Hg.layout_symtracking["text-justify"]),"text-anchor":new Up(Hg.layout_symtracking["text-anchor"]),"text-max-angle":new kp(Hg.layout_symtracking["text-max-angle"]),"text-rotate":new Up(Hg.layout_symtracking["text-rotate"]),"text-padding":new kp(Hg.layout_symtracking["text-padding"]),"text-keep-upright":new kp(Hg.layout_symtracking["text-keep-upright"]),"text-transform":new Up(Hg.layout_symtracking["text-transform"]),"text-offset":new Up(Hg.layout_symtracking["text-offset"]),"text-allow-overlap":new kp(Hg.layout_symtracking["text-allow-overlap"]),"text-ignore-placement":new kp(Hg.layout_symtracking["text-ignore-placement"]),"text-optional":new kp(Hg.layout_symtracking["text-optional"])});var Lb={paint:new qp({"icon-opacity":new Up(Hg.paint_symtracking["icon-opacity"]),"icon-color":new Up(Hg.paint_symtracking["icon-color"]),"icon-halo-color":new Up(Hg.paint_symtracking["icon-halo-color"]),"icon-halo-width":new Up(Hg.paint_symtracking["icon-halo-width"]),"icon-halo-blur":new Up(Hg.paint_symtracking["icon-halo-blur"]),"icon-translate":new kp(Hg.paint_symtracking["icon-translate"]),"icon-translate-anchor":new kp(Hg.paint_symtracking["icon-translate-anchor"]),"text-opacity":new Up(Hg.paint_symtracking["text-opacity"]),"text-color":new Up(Hg.paint_symtracking["text-color"]),"text-halo-color":new Up(Hg.paint_symtracking["text-halo-color"]),"text-halo-width":new Up(Hg.paint_symtracking["text-halo-width"]),"text-halo-blur":new Up(Hg.paint_symtracking["text-halo-blur"]),"text-translate":new kp(Hg.paint_symtracking["text-translate"]),"text-translate-anchor":new kp(Hg.paint_symtracking["text-translate-anchor"]),"symtracking-delay":new kp(Hg.paint_symtracking["symtracking-delay"])}),layout:Ib};const Nb=bi([{name:"a_POSITION",components:3,type:"Float32"},{name:"a_NORMAL",components:1,type:"Uint8"},{name:"a_data",components:4,type:"Uint8"},{name:"a_seq",components:1,type:"Uint16"},{name:"a_info",components:2,type:"Uint16"}],4),{members:Rb}=Nb,Ob=Ng.VectorTileFeature.types,Db=Math.cos(Math.PI/180*37.5),Fb=Math.pow(2,14)/.5;class zb{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={};})),this.type=Dg.DYNAMIC_LINE,this.layoutVertexArray=new va,this.indexArray=new Ba,this.programConfigurations=new gf(Rb,e.layers,e.zoom),this.segments=new ep,this.maxLineLength=0,this.projection=e.projection||mi.MERCATOR,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.seq=0,this.total=0,this.offset=0;}_convertGeometryPointToLine(e){const t=[];for(let i=0;i<e.length;i++){const n=[];let r=1/0,o=1/0,a=-1/0,s=-1/0;for(let t=0;t<e[i].length;t++){const l=e[i][t].x,u=e[i][t].y;n.push([l,u]),r>l&&(r=l),a<l&&(a=l),o>u&&(o=u),s<u&&(s=u);}t.push({type:"LineString",geometry:[n],min:[r,o],max:[a,s]});}return t}_convertLineToGeometry(e){const t=[];for(let i=0;i<e.length;i++){const n=e[i].geometry.map((e=>e.map((e=>new te(e[0],e[1])))));t.push(...n);}return t}populate(e,t,i){this.baseP||(this.x=t.x,this.y=t.y,this.z=t.z,this.zPow=Math.pow(2,this.z),this.baseP=Nl(this.x,this.y,this.z,this.projection),this.matrix=Rl(this.baseP));for(const{feature:n,index:r,sourceLayerIndex:o}of e)if(this.layers[0]._featureFilter(new Lp(this.zoom),n,i)){const e=Sg(n),a=[];Hv(Yv(this.z),0,8192,0,8192,this._convertGeometryPointToLine(e),a);const s=this._convertLineToGeometry(a);this.addFeature(n,s,r,i,{}),t.featureIndex.insert(n,e,r,o,this.index);}}update(e,t,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i);}addFeatures(e,t,i){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,i);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Rb),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());}addFeature(e,t,i,n,r){const o=this.layers[0].layout,a=o.get("dynamicLine-join").evaluate(e,{}),s=o.get("dynamicLine-cap"),l=o.get("dynamicLine-miter-limit"),u=o.get("dynamicLine-round-limit");this.seq=e.properties.link_seq,this.total=e.properties.total_link_count,this.offset=e.properties.offset_link_count;for(const i of t)this.addLine(i,e,a,s,l,u);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,r,n);}addLine(e,t,i,n,r,o){this.distance=0,this.scaledDistance=0,this.totalDistance=0;const a="Polygon"===Ob[t.type];let s=e.length;for(;s>=2&&e[s-1].equals(e[s-2]);)s--;let l=0;for(;l<s-1&&e[l].equals(e[l+1]);)l++;if(s<(a?3:2))return;"bevel"===i&&(r=1.05);const u=this.overscaling<=16?15*Wh/(512*this.overscaling):0,c=this.segments.prepareSegment(10*s,this.layoutVertexArray,this.indexArray);let h,d,p,f,m;this.e1=this.e2=-1,a&&(h=e[s-2],m=e[l].sub(h)._unit()._perp());for(let t=l;t<s;t++){if(this.seq++,p=t===s-1?a?e[l+1]:void 0:e[t+1],p&&e[t].equals(p))continue;m&&(f=m),h&&(d=h),h=e[t],m=p?p.sub(h)._unit()._perp():f,f=f||m;let _=f.add(m);0===_.x&&0===_.y||_._unit();const g=f.x*m.x+f.y*m.y,y=_.x*m.x+_.y*m.y,x=0!==y?1/y:1/0,v=2*Math.sqrt(2-2*y),w=y<Db&&d&&p,T=f.x*m.y-f.y*m.x>0;if(w&&t>l){const e=h.dist(d);if(e>2*u){const t=h.sub(h.sub(d)._mult(u/e)._round());this.updateDistance(d,t),this.addCurrentVertex(t,f,0,0,c),d=t;}}const b=d&&p;let P=b?i:a?"butt":n;if(b&&"round"===P&&(x<o?P="miter":x<=2&&(P="fakeround")),"miter"===P&&x>r&&(P="bevel"),"bevel"===P&&(x>2&&(P="flipbevel"),x<r&&(P="miter")),d&&this.updateDistance(d,h),"miter"===P)_._mult(x),this.addCurrentVertex(h,_,0,0,c);else if("flipbevel"===P){if(x>100)_=m.mult(-1);else {const e=x*f.add(m).mag()/f.sub(m).mag();_._perp()._mult(e*(T?-1:1));}this.addCurrentVertex(h,_,0,0,c),this.addCurrentVertex(h,_.mult(-1),0,0,c);}else if("bevel"===P||"fakeround"===P){const e=-Math.sqrt(x*x-1),t=T?e:0,i=T?0:e;if(d&&this.addCurrentVertex(h,f,t,i,c),"fakeround"===P){const e=Math.round(180*v/Math.PI/20);for(let t=1;t<e;t++){let i=t/e;if(.5!==i){const e=i-.5;i+=i*e*(i-1)*((1.0904+g*(g*(3.55645-1.43519*g)-3.2452))*e*e+(.848013+g*(.215638*g-1.06021)));}const n=m.sub(f)._mult(i)._add(f)._unit()._mult(T?-1:1);this.addHalfVertex(h,n.x,n.y,!1,T,0,c);}}p&&this.addCurrentVertex(h,m,-t,-i,c);}else if("butt"===P)this.addCurrentVertex(h,_,0,0,c);else if("square"===P){const e=d?1:-1;this.addCurrentVertex(h,_,e,e,c);}else "round"===P&&(d&&(this.addCurrentVertex(h,f,0,0,c),this.addCurrentVertex(h,f,1,1,c,!0)),p&&(this.addCurrentVertex(h,m,-1,-1,c,!0),this.addCurrentVertex(h,m,0,0,c)));if(w&&t<s-1){const e=h.dist(p);if(e>2*u){const t=h.add(p.sub(h)._mult(u/e)._round());this.updateDistance(h,t),this.addCurrentVertex(t,m,0,0,c),h=t;}}}}calcTDSpacePoint(e){const t=Ll(this.x+e.x/8192,this.y+e.y/8192,this.zPow,this.projection),i=Nu.cartographicToCartesian3([t[0],t[1],0]);return new te(i[0]-this.baseP[0],i[1]-this.baseP[1],i[2]-this.baseP[2])}addCurrentVertex(e,t,i,n,r,o=!1){const a=t.y*n-t.x,s=-t.y-t.x*n;this.addHalfVertex(e,t.x+t.y*i,t.y-t.x*i,o,!1,i,r),this.addHalfVertex(e,a,s,o,!0,-n,r),this.distance>Fb/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(e,t,i,n,r,o));}addHalfVertex(e,t,i,n,r,o,a){const s=this.scaledDistance,l=this.calcTDSpacePoint(e),u=.5*s;this.layoutVertexArray.emplaceBack(l.x,l.y,l.z,(n?2:0)+(r?1:0),Math.round(63*t)+128,Math.round(63*i)+128,1+(0===o?0:o<0?-1:1)|(63&u)<<2,u>>6,this.seq,this.total,this.offset);const c=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,c),a.primitiveLength++),r?this.e2=c:this.e1=c;}updateScaledDistance(){this.scaledDistance=this.distance;}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance();}}$o("DynamicLineBucket",zb,{omit:["layers","patternFeatures"],shallow:["matrix"]});const Bb=new qp({"dynamicLine-cap":new kp(Hg.layout_dynamicLine["dynamicLine-cap"]),"dynamicLine-join":new Up(Hg.layout_dynamicLine["dynamicLine-join"]),"dynamicLine-miter-limit":new kp(Hg.layout_dynamicLine["dynamicLine-miter-limit"]),"dynamicLine-round-limit":new kp(Hg.layout_dynamicLine["dynamicLine-round-limit"]),"dynamicLine-sort-key":new Up(Hg.layout_dynamicLine["dynamicLine-sort-key"])});var Vb={paint:new qp({"dynamicLine-opacity":new Up(Hg.paint_dynamicLine["dynamicLine-opacity"]),"dynamicLine-color":new Up(Hg.paint_dynamicLine["dynamicLine-color"]),"dynamicLine-width":new Up(Hg.paint_dynamicLine["dynamicLine-width"]),"dynamicLine-gap-width":new Up(Hg.paint_dynamicLine["dynamicLine-gap-width"]),"dynamicLine-blur":new Up(Hg.paint_dynamicLine["dynamicLine-blur"]),"dynamicLine-seg-group":new kp(Hg.paint_dynamicLine["dynamicLine-seg-group"]),"dynamicLine-speed":new kp(Hg.paint_dynamicLine["dynamicLine-speed"])}),layout:Bb};const kb=new class extends Up{possiblyEvaluate(e,t){return t=new Lp(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,n){return t=Ve({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,n)}}(Vb.paint.properties["dynamicLine-width"].specification);function Ub(e,t){return t>0?t+2*e:e}kb.useIntegerZoom=!0;const Gb={raster:class extends kx{constructor(e){super(e,Hx),this.maskingEnabled=e.maskingEnabled,this.maskingPolygonHierarchy=e.maskingPolygonHierarchy,this.depthTest=!!$(e["depth-test"])&&e["depth-test"],e["draw-mode"]&&(this.drawMode=e["draw-mode"]);}set maskingEnabled(e){this._maskingEnabled=e;}get maskingEnabled(){return this._maskingEnabled}set maskingPolygonHierarchy(e){this._maskingPolygonHierarchy=e,this._maskingPolygonPrimitive&&(this._maskingPolygonPrimitive.destroy(),this._maskingPolygonPrimitive=null);}get maskingPolygonHierarchy(){return this._maskingPolygonHierarchy}get maskingPolygonPrimitive(){return this._maskingPolygonPrimitive||this.maskingEnabled&&this.maskingPolygonHierarchy&&(this.maskingId=222,this._maskingPolygonPrimitive=function(e){const t=new _p({polygonHierarchy:e.polygonHierarchy,extrudedHeight:e.extrudedHeight,perPositionHeight:e.perPositionHeight,height:e.height,arcType:e.arcType}),i=jx.fromType("Color",{color:"rgba(255,0,0,1.0)",opacity:1,doubleSided:!0,renderState:{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},depthTest:{enabled:!1,func:Du.LESS},stencilTest:{enabled:!0,frontFunction:Du.ALWAYS,frontOperation:{fail:Du.KEEP,zFail:Du.KEEP,zPass:Du.REPLACE},backFunction:Du.ALWAYS,backOperation:{fail:Du.KEEP,zFail:Du.KEEP,zPass:Du.REPLACE},reference:e.maskingId,mask:255},stencilMask:255}});return new Ny({geometry:t,material:i})}({polygonHierarchy:this.maskingPolygonHierarchy,extrudedHeight:0,perPositionHeight:!0,color:"red",maskingId:this.maskingId})),this._maskingPolygonPrimitive}},fill:class extends kx{constructor(e){super(e,tT);}getCrossfadeParameters(){return this._crossfadeParameters}recalculate(e,t){super.recalculate(e,t),this.paint=this._transitioningPaint.possiblyEvaluate(e),e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters());const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"],this.outlineFromFillColor=!0);}createBucket(e){return new Bw(e)}queryRadius(){return 0}queryIntersectsFeature(e,t,i,n,r,o,a){return function(e,t){if(1===e.length)return $w(t,e[0]);for(let i=0;i<t.length;i++){const n=t[i];for(let t=0;t<n.length;t++)if(Zw(e,n[t]))return !0}for(let i=0;i<e.length;i++)if($w(t,e[i]))return !0;for(let i=0;i<t.length;i++)if(qw(e,t[i]))return !0;return !1}(Jw(e,this.paint.get("fill-translate").value?.value,this.paint.get("fill-translate-anchor").value?.value,o.getMapViewParams().bearing*ot.TRANSFORM.DEG_TO_RAD,a),n)}hasOffscreenPass(){return 0!==this.paint.get("fill-opacity")&&"none"!==this.visibility}},line:oT,circle:class extends kx{constructor(e){super(e,dT);}createBucket(e){return new cT(e)}queryRadius(e){const t=e;return Qw("circle-radius",this,t)+Qw("circle-stroke-width",this,t)+0}queryIntersectsFeature(e,t,i,n,r,o,a,s){const l=Jw(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.getMapViewParams().bearing*ot.TRANSFORM.DEG_TO_RAD,a),u=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i),c="map"===this.paint.get("circle-pitch-alignment"),h=c?l:function(e,t){return e.map((e=>pT(e,t)))}(l,s),d=c?u*a:u;for(const e of n)for(const t of e){const e=c?t:pT(t,s);let i=d;const n=new St([t.x,t.y,0,1]).transform(s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?i*=n[3]/o.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(i*=o.cameraToCenterDistance/n[3]),Gw(h,e,i))return !0}return !1}},heatmap:class extends kx{createBucket(e){return new vT(e)}constructor(e){super(e,TT),this._updateColorRamp();}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp();}_updateColorRamp(){this.colorRamp=bT({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampChanged=!0,this.colorRampTexture=null;}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null);}queryRadius(e){return Qw("heatmap-radius",this,e)}queryIntersectsFeature(){return !1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return ["heatmap","heatmapTexture"]}},symbol:class extends kx{constructor(e){super(e,qg),this.hiddenTerrain=!!$(e["hidden-terrain"])&&e["hidden-terrain"],this.hiddenFog=!!$(e["hidden-fog"])&&e["hidden-fog"];}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));}getValueAndResolveTokens(e,t,i,n){const r=this.layout.get(e).evaluate(t,{},i,n),o=this._unevaluatedLayout._values[e];return o.isDataDriven()||Bo(o.value)?r:PT(t.properties,r)}createBucket(e){return new Gg(e)}queryRadius(){return 0}queryIntersectsFeature(){return !1}hasOffscreenPass(){return 0!==this.paint.get("icon-opacity")&&0!==this.paint.get("text-opacity")&&"none"!==this.visibility}},extrusion:class extends kx{constructor(e){super(e,zT),this.enableQuery=e.enableQuery||!1,e.hasOwnProperty("patternZoomOffset")&&(this.patternZoomOffset=e.patternZoomOffset);}createBucket(e){return new RT(e,this.enableQuery)}queryRadius(){return 0}queryIntersectsFeature(){return !1}hasOffscreenPass(){return 0!==this.paint.get("extrusion-opacity")&&"none"!==this.visibility}resize(){this.viewportFrame&&(this.viewportFrame.destroy(),this.viewportFrame=null);}},histogram:class extends kx{constructor(e){super(e,Mb);}createBucket(e){return new Tb(e)}queryRadius(){return 0}queryIntersectsFeature(e,t,i,n,r,o,a){return Jw(e,this.paint.get("histogram-translate"),this.paint.get("histogram-translate-anchor"),o.getMapViewParams().bearing*ot.TRANSFORM.DEG_TO_RAD,a),!1}hasOffscreenPass(){return 0!==this.paint.get("histogram-opacity")&&"none"!==this.visibility}resize(){this.viewportFrame&&(this.viewportFrame.destroy(),this.viewportFrame=null);}},sprite:class extends kx{constructor(e){e&&e.layout&&"visible"===e.layout["border-visibility"]&&e.paint&&e.paint["sprite-gap-width"]&&(Ze("'sprite-gap-width' cannot be set when 'border-visibility' is 'visible'"),e.paint["sprite-gap-width"]=0),super(e,cb),this.gradientVersion=0;}_handleSpecialPaintPropertyUpdate(e){"sprite-gradient"===e&&(this.stepInterpolate=this._transitionablePaint._values["sprite-gradient"].value.expression._styleExpression.expression instanceof yr,this.gradientVersion=(this.gradientVersion+1)%Ne);}gradientExpression(){return this._transitionablePaint._values["sprite-gradient"].value.expression}getCrossfadeParameters(){return this._crossfadeParameters}recalculate(e,t){super.recalculate(e,t),e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this.paint._values["sprite-floorwidth"]=hb.possiblyEvaluate(this._transitioningPaint._values["sprite-width"].value,e);}createBucket(e){return new lb(e)}queryRadius(e){const t=e,i=db(Qw("sprite-width",this,t),Qw("sprite-gap-width",this,t)),n=Qw("sprite-offset",this,t);return i/2+Math.abs(n)+0}queryIntersectsFeature(e,t,i,n,r,o,a){const s=Jw(e,this.paint.get("sprite-translate"),this.paint.get("sprite-translate-anchor"),o.getMapViewParams().bearing*ot.TRANSFORM.DEG_TO_RAD,a),l=a/2*db(this.paint.get("sprite-width").evaluate(t,i),this.paint.get("sprite-gap-width").evaluate(t,i)),u=Math.max(l,500),c=this.paint.get("sprite-offset").evaluate(t,i);return c&&(n=function(e,t){const i=[],n=new te(0,0);for(let r=0;r<e.length;r++){const o=e[r],a=[];for(let e=0;e<o.length;e++){const i=o[e],r=o[e+1],s=0===e?n:i.sub(o[e-1])._unit()._perp(),l=e===o.length-1?n:r.sub(i)._unit()._perp(),u=s._add(l)._unit();u._mult(1/(u.x*l.x+u.y*l.y)),a.push(u._mult(t)._add(i));}i.push(a);}return i}(n,c*a)),Hw(s,n,u)}hasOffscreenPass(){return 0!==this.paint.get("sprite-opacity")&&"none"!==this.visibility}},background:class extends kx{constructor(e){super(e,Gx);}},tracking:class extends kx{constructor(e){super(e,jT);}recalculate(e,t){super.recalculate(e,t),e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this.paint._values["tracking-floorwidth"]=$T.possiblyEvaluate(this._transitioningPaint._values["tracking-width"].value,e);}getCrossfadeParameters(){return this._crossfadeParameters}createBucket(e){return new XT(e)}queryRadius(e){const t=e,i=ZT(Qw("tracking-width",this,t),Qw("tracking-gap-width",this,t)),n=Qw("tracking-offset",this,t);return i/2+Math.abs(n)+0}queryIntersectsFeature(e,t,i,n,r,o,a){const s=Jw(e,this.paint.get("tracking-translate"),this.paint.get("tracking-translate-anchor"),o.getMapViewParams().bearing*ot.TRANSFORM.DEG_TO_RAD,a),l=a/2*ZT(this.paint.get("tracking-width").evaluate(t,i),this.paint.get("tracking-gap-width").evaluate(t,i)),u=this.paint.get("tracking-offset").evaluate(t,i);return u&&(n=function(e,t){const i=[],n=new te(0,0);for(let r=0;r<e.length;r++){const o=e[r],a=[];for(let e=0;e<o.length;e++){const i=o[e],r=o[e+1],s=0===e?n:i.sub(o[e-1])._unit()._perp(),l=e===o.length-1?n:r.sub(i)._unit()._perp(),u=s._add(l)._unit();u._mult(1/(u.x*l.x+u.y*l.y)),a.push(u._mult(t)._add(i));}i.push(a);}return i}(n,u*a)),Hw(s,n,l)}},"3d-model":class extends kx{constructor(e){super(e,KT),this.baseMatrixCalculated=!1,this.respectiveTransformation=!1,this.identityMatrix=!0,this.matrix=[],this.nodes=[],this.meshes=[],this.primitives=[];}},"3d-tiles":class extends kx{constructor(e){super(e,QT);}},symtracking:class extends kx{constructor(e){super(e,Lb);}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));}getValueAndResolveTokens(e,t){const i=this.layout.get(e).evaluate(t,{}),n=this._unevaluatedLayout._values[e];return n.isDataDriven()||Bo(n.value)?i:PT(t.properties,i)}createBucket(e){return new iy(e)}queryRadius(){return 0}queryIntersectsFeature(){return !1}hasOffscreenPass(){return 0!==this.paint.get("icon-opacity")&&0!==this.paint.get("text-opacity")&&"none"!==this.visibility}},dynamicLine:class extends kx{constructor(e){super(e,Vb);}recalculate(e,t){super.recalculate(e,t),this.paint._values["dynamicLine-floorwidth"]=kb.possiblyEvaluate(this._transitioningPaint._values["dynamicLine-width"].value,e);}createBucket(e){return new zb(e)}queryRadius(e){const t=e;return Ub(Qw("dynamicLine-width",this,t),Qw("dynamicLine-gap-width",this,t))/2}queryIntersectsFeature(e,t,i,n,r,o,a){return Hw([],n,a/2*Ub(this.paint.get("dynamicLine-width").evaluate(t,i),this.paint.get("dynamicLine-gap-width").evaluate(t,i)))}isTileClipped(){return !0}}};
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
var Hb=function(e,t,i,n,r){var o,a,s=8*r-n-1,l=(1<<s)-1,u=l>>1,c=-7,h=i?r-1:0,d=i?-1:1,p=e[t+h];for(h+=d,o=p&(1<<-c)-1,p>>=-c,c+=s;c>0;o=256*o+e[t+h],h+=d,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=n;c>0;a=256*a+e[t+h],h+=d,c-=8);if(0===o)o=1-u;else {if(o===l)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,n),o-=u;}return (p?-1:1)*a*Math.pow(2,o-n)},Yb=function(e,t,i,n,r,o){var a,s,l,u=8*o-r-1,c=(1<<u)-1,h=c>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,f=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),(t+=a+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(a++,l/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(t*l-1)*Math.pow(2,r),a+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,r),a=0));r>=8;e[i+p]=255&s,p+=f,s/=256,r-=8);for(a=a<<r|s,u+=r;u>0;e[i+p]=255&a,p+=f,a/=256,u-=8);e[i+p-f]|=128*m;},qb=Xb;function Xb(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length;}Xb.Varint=0,Xb.Fixed64=1,Xb.Bytes=2,Xb.Fixed32=5;var Wb=4294967296,jb=1/Wb,$b="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Zb(e){return e.type===Xb.Bytes?e.readVarint()+e.pos:e.pos+1}function Kb(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Qb(e,t,i){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(n);for(var r=i.pos-1;r>=e;r--)i.buf[r+n]=i.buf[r];}function Jb(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i]);}function eP(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i]);}function tP(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i]);}function iP(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i]);}function nP(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i]);}function rP(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i]);}function oP(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i]);}function aP(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i]);}function sP(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i]);}function lP(e,t){return (e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function uP(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24;}function cP(e,t){return (e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}Xb.prototype={destroy:function(){this.buf=null;},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,o=this.pos;this.type=7&n,e(r,t,this),this.pos===o&&this.skip(n);}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=lP(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=cP(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=lP(this.buf,this.pos)+lP(this.buf,this.pos+4)*Wb;return this.pos+=8,e},readSFixed64:function(){var e=lP(this.buf,this.pos)+cP(this.buf,this.pos+4)*Wb;return this.pos+=8,e},readFloat:function(){var e=Hb(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Hb(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,n=this.buf;return t=127&(i=n[this.pos++]),i<128?t:(t|=(127&(i=n[this.pos++]))<<7,i<128?t:(t|=(127&(i=n[this.pos++]))<<14,i<128?t:(t|=(127&(i=n[this.pos++]))<<21,i<128?t:function(e,t,i){var n,r,o=i.buf;if(n=(112&(r=o[i.pos++]))>>4,r<128)return Kb(e,n,t);if(n|=(127&(r=o[i.pos++]))<<3,r<128)return Kb(e,n,t);if(n|=(127&(r=o[i.pos++]))<<10,r<128)return Kb(e,n,t);if(n|=(127&(r=o[i.pos++]))<<17,r<128)return Kb(e,n,t);if(n|=(127&(r=o[i.pos++]))<<24,r<128)return Kb(e,n,t);if(n|=(1&(r=o[i.pos++]))<<31,r<128)return Kb(e,n,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=n[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&$b?function(e,t,i){return $b.decode(e.subarray(t,i))}(this.buf,t,e):function(e,t,i){for(var n="",r=t;r<i;){var o,a,s,l=e[r],u=null,c=l>239?4:l>223?3:l>191?2:1;if(r+c>i)break;1===c?l<128&&(u=l):2===c?128==(192&(o=e[r+1]))&&(u=(31&l)<<6|63&o)<=127&&(u=null):3===c?(a=e[r+2],128==(192&(o=e[r+1]))&&128==(192&a)&&((u=(15&l)<<12|(63&o)<<6|63&a)<=2047||u>=55296&&u<=57343)&&(u=null)):4===c&&(a=e[r+2],s=e[r+3],128==(192&(o=e[r+1]))&&128==(192&a)&&128==(192&s)&&((u=(15&l)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,c=1):u>65535&&(u-=65536,n+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),n+=String.fromCharCode(u),r+=c;}return n}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Xb.Bytes)return e.push(this.readVarint(t));var i=Zb(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Xb.Bytes)return e.push(this.readSVarint());var t=Zb(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Xb.Bytes)return e.push(this.readBoolean());var t=Zb(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Xb.Bytes)return e.push(this.readFloat());var t=Zb(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Xb.Bytes)return e.push(this.readDouble());var t=Zb(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Xb.Bytes)return e.push(this.readFixed32());var t=Zb(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Xb.Bytes)return e.push(this.readSFixed32());var t=Zb(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Xb.Bytes)return e.push(this.readFixed64());var t=Zb(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Xb.Bytes)return e.push(this.readSFixed64());var t=Zb(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Xb.Varint)for(;this.buf[this.pos++]>127;);else if(t===Xb.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Xb.Fixed32)this.pos+=4;else {if(t!==Xb.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8;}},writeTag:function(e,t){this.writeVarint(e<<3|t);},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t;}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),uP(this.buf,e,this.pos),this.pos+=4;},writeSFixed32:function(e){this.realloc(4),uP(this.buf,e,this.pos),this.pos+=4;},writeFixed64:function(e){this.realloc(8),uP(this.buf,-1&e,this.pos),uP(this.buf,Math.floor(e*jb),this.pos+4),this.pos+=8;},writeSFixed64:function(e){this.realloc(8),uP(this.buf,-1&e,this.pos),uP(this.buf,Math.floor(e*jb),this.pos+4),this.pos+=8;},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var i,n;if(e>=0?(i=e%4294967296|0,n=e/4294967296|0):(n=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,n=n+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,i){i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,i.buf[i.pos]=127&(e>>>=7);}(i,0,t),function(e,t){var i=(7&e)<<4;t.buf[t.pos++]|=i|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))));}(n,t);}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))));},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e);},writeBoolean:function(e){this.writeVarint(Boolean(e));},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,i){for(var n,r,o=0;o<t.length;o++){if((n=t.charCodeAt(o))>55295&&n<57344){if(!r){n>56319||o+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):r=n;continue}if(n<56320){e[i++]=239,e[i++]=191,e[i++]=189,r=n;continue}n=r-55296<<10|n-56320|65536,r=null;}else r&&(e[i++]=239,e[i++]=191,e[i++]=189,r=null);n<128?e[i++]=n:(n<2048?e[i++]=n>>6|192:(n<65536?e[i++]=n>>12|224:(e[i++]=n>>18|240,e[i++]=n>>12&63|128),e[i++]=n>>6&63|128),e[i++]=63&n|128);}return i}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&Qb(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i;},writeFloat:function(e){this.realloc(4),Yb(this.buf,e,this.pos,!0,23,4),this.pos+=4;},writeDouble:function(e){this.realloc(8),Yb(this.buf,e,this.pos,!0,52,8),this.pos+=8;},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i];},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var n=this.pos-i;n>=128&&Qb(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n;},writeMessage:function(e,t,i){this.writeTag(e,Xb.Bytes),this.writeRawMessage(t,i);},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Jb,t);},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,eP,t);},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,nP,t);},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,tP,t);},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,iP,t);},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,rP,t);},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,oP,t);},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,aP,t);},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,sP,t);},writeBytesField:function(e,t){this.writeTag(e,Xb.Bytes),this.writeBytes(t);},writeFixed32Field:function(e,t){this.writeTag(e,Xb.Fixed32),this.writeFixed32(t);},writeSFixed32Field:function(e,t){this.writeTag(e,Xb.Fixed32),this.writeSFixed32(t);},writeFixed64Field:function(e,t){this.writeTag(e,Xb.Fixed64),this.writeFixed64(t);},writeSFixed64Field:function(e,t){this.writeTag(e,Xb.Fixed64),this.writeSFixed64(t);},writeVarintField:function(e,t){this.writeTag(e,Xb.Varint),this.writeVarint(t);},writeSVarintField:function(e,t){this.writeTag(e,Xb.Varint),this.writeSVarint(t);},writeStringField:function(e,t){this.writeTag(e,Xb.Bytes),this.writeString(t);},writeFloatField:function(e,t){this.writeTag(e,Xb.Fixed32),this.writeFloat(t);},writeDoubleField:function(e,t){this.writeTag(e,Xb.Fixed64),this.writeDouble(t);},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t));}};const hP=3;function dP(e,t,i){1===e&&i.readMessage(pP,t);}function pP(e,t,i){if(3===e){const{id:e,bitmap:n,width:r,height:o,left:a,top:s,advance:l}=i.readMessage(fP,{});t.push({id:e,bitmap:new bw({width:r+2*hP,height:o+2*hP},n),metrics:{width:r,height:o,left:a,top:s,advance:l}});}}function fP(e,t,i){1===e?t.id=i.readVarint():2===e?t.bitmap=i.readBytes():3===e?t.width=i.readVarint():4===e?t.height=i.readVarint():5===e?t.left=i.readSVarint():6===e?t.top=i.readSVarint():7===e&&(t.advance=i.readVarint());}const mP=hP;class _P{constructor(){}clone(e){return e.uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e}initializeIndexed(e,t,i,n,r){this.uBuffer=e,this.vBuffer=t,this.heightBuffer=i,this.normalBuffer=n,this.index=r,this.first=void 0,this.second=void 0,this.ratio=void 0;}initializeFromClipResult(e,t,i){let n=t+1;return -1!==e[t]?i[e[t]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=i[e[n]],++n,this.second=i[e[n]],++n,this.ratio=e[n],++n),n}getKey(){return this.isIndexed()?`${this.index||0}`:JSON.stringify({first:this.first?this.first.getKey():"",second:this.second?this.second.getKey():"",ratio:this.ratio||0})}isIndexed(){return null!=this.index}getH(){return null!=this.index?this.heightBuffer[this.index]:this.first&&this.second?Ol(this.first.getH(),this.second.getH(),this.ratio||0):0}getU(){return null!=this.index?this.uBuffer[this.index]:this.first&&this.second?Ol(this.first.getU(),this.second.getU(),this.ratio||0):0}getV(){return null!=this.index?this.vBuffer[this.index]:this.first&&this.second?Ol(this.first.getV(),this.second.getV(),this.ratio||0):0}}const gP={};function yP(e,t){let i;i=t?`a_${e.property}`:`v_${e.property}`;let n="    vec4 color;\n";if("interval"===e.type){let t=new Ui(0,0,0,1);if(e.default&&(t=Ui.parse(e.default)),e.stops){const r=e.stops.length;for(let o=0;o<r;o+=1){const r=e.stops[o];0===o?(n+=`    if (${i} <= float(${r[0]})) \n`,n+=`        { color = vec4(${t.r}, ${t.g}, ${t.b}, ${t.a}); }\n`,t=Ui.parse(r[1])):(r[0]<=e.stops[o-1][0]&&console.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.'),n+=`    else if (${i} <= float(${r[0]})) \n`,n+=`        { color = vec4(${t.r}, ${t.g}, ${t.b}, ${t.a}); }\n`,t=Ui.parse(r[1]));}n+=`    else { color = vec4(${t.r}, ${t.g}, ${t.b}, ${t.a}); }\n`;}else n+=`    color = vec4(${t.r}, ${t.g}, ${t.b}, ${t.a});\n`;}else if("categorical"===e.type){let t=new Ui(0,0,0,1);if(e.default&&(t=Ui.parse(e.default)),e.stops){let r;const o=e.stops.length;for(let t=0;t<o;t+=1){const o=e.stops[t];0===t?(r=Ui.parse(o[1]),n+=`    if (${i} == float(${o[0]})) \n`,n+=`        { color = vec4(${r.r}, ${r.g}, ${r.b}, ${r.a}); }\n`):(o[0]<=e.stops[t-1][0]&&console.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.'),r=Ui.parse(o[1]),n+=`    else if (${i} == float(${o[0]})) \n`,n+=`        { color = vec4(${r.r}, ${r.g}, ${r.b}, ${r.a}); }\n`);}n+=`    else { color = vec4(${t.r}, ${t.g}, ${t.b}, ${t.a}); }\n`;}else n+=`    color = vec4(${t.r}, ${t.g}, ${t.b}, ${t.a});\n`;}else if("exponential"===e.type){let t=new Ui(0,0,0,1),r=1;if(e.default&&(t=Ui.parse(e.default)),e.base&&(r=e.base),e.stops){const o=e.stops.length;for(let a=0;a<o;a+=1){const o=e.stops[a];if(0===a)n+=`    if (${i} <= float(${o[0]})) \n`,n+=`        { color = vec4(${t.r}, ${t.g}, ${t.b}, ${t.a}); }\n`;else {const s=e.stops[a-1];o[0]<=s[0]&&console.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.');const l=Ui.parse(s[1]),u=Ui.parse(o[1]);n+=`    else if (${i} <= float(${o[0]})) \n`,n+="        { color = getExponentialInterpColor( \n",n+=`            ${i}, \n`,n+=`            float(${r}), \n`,n+=`            float(${s[0]}), \n`,n+=`            float(${o[0]}), \n`,n+=`            vec4(${l.r}, ${l.g}, ${l.b}, ${l.a}), \n`,n+=`            vec4(${u.r}, ${u.g}, ${u.b}, ${u.a})); \n`,n+="        }\n",t=u;}}n+=`    else { color = vec4(${t.r}, ${t.g}, ${t.b}, ${t.a}); }\n`;}else n+=`    color = vec4(${t.r}, ${t.g}, ${t.b}, ${t.a});\n`;}else console.error(`Unknown interpolation type ${e.type}`);return n}gP.clipTriangleAtAxisAlignedThreshold=function(e,t,i,n,r,o){let a,s,l;o.length=0,t?(a=i<e,s=n<e,l=r<e):(a=i>e,s=n>e,l=r>e);const u=a+s+l;let c,h,d,p,f,m;return 1===u?a?(c=(e-i)/(n-i),h=(e-i)/(r-i),o.push(1),o.push(2),1!==h&&(o.push(-1),o.push(0),o.push(2),o.push(h)),1!==c&&(o.push(-1),o.push(0),o.push(1),o.push(c))):s?(d=(e-n)/(r-n),p=(e-n)/(i-n),o.push(2),o.push(0),1!==p&&(o.push(-1),o.push(1),o.push(0),o.push(p)),1!==d&&(o.push(-1),o.push(1),o.push(2),o.push(d))):l&&(f=(e-r)/(i-r),m=(e-r)/(n-r),o.push(0),o.push(1),1!==m&&(o.push(-1),o.push(2),o.push(1),o.push(m)),1!==f&&(o.push(-1),o.push(2),o.push(0),o.push(f))):2===u?a||i===e?s||n===e?l||r===e||(h=(e-i)/(r-i),d=(e-n)/(r-n),o.push(2),o.push(-1),o.push(0),o.push(2),o.push(h),o.push(-1),o.push(1),o.push(2),o.push(d)):(m=(e-r)/(n-r),c=(e-i)/(n-i),o.push(1),o.push(-1),o.push(2),o.push(1),o.push(m),o.push(-1),o.push(0),o.push(1),o.push(c)):(p=(e-n)/(i-n),f=(e-r)/(i-r),o.push(0),o.push(-1),o.push(1),o.push(0),o.push(p),o.push(-1),o.push(2),o.push(0),o.push(f)):3!==u&&(o.push(0),o.push(1),o.push(2)),o},gP.computeBarycentricCoordinates=function(e,t,i,n,r,o,a,s,l){const u=i-a,c=a-r,h=o-s,d=n-s,p=1/(h*u+c*d),f=t-s,m=e-a,_=(h*m+c*f)*p,g=(-d*m+u*f)*p,y=1-_-g;return l?(l.x=_,l.y=g,l.z=y,l):{x:_,y:g,z:y}},gP.computeLineSegmentLineSegmentIntersection=function(e,t,i,n,r,o,a,s,l){const u=(s-o)*(i-e)-(a-r)*(n-t);if(0===u)return;const c=((a-r)*(t-o)-(s-o)*(e-r))/u,h=((i-e)*(t-o)-(n-t)*(e-r))/u;return c>=0&&c<=1&&h>=0&&h<=1?(l.x=e+c*(i-e),l.y=t+c*(n-t),l):void 0},gP.featureInsect=function(e,t){let i=!1;const n=t.filter((t=>t.index!=e.index));return !!(e.feature&&e.feature._feature&&e.feature._feature.geometry)&&(e.feature._feature.geometry.forEach((e=>{for(let t=0;t<e.length-1;t++)if(gP.geometryInsect(e[t],e[t+1],n))return void(i=!0)})),i)},gP.geometryInsect=function(e,t,i){let n=!1;return i.forEach((i=>{i.feature._feature.geometry.forEach((i=>{for(let r=0;r<i.length-1;r++){const o=i[r],a=i[r+1];if(gP.computeLineSegmentLineSegmentIntersection(e[0],e[1],t[0],t[1],o[0],o[1],a[0],a[1],new Ot))return void(n=!0)}}));})),n};class xP{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const i=e[t];this._stringToNumber[i]=t,this._numberToString[t]=i;}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class vP{constructor(e,t,i,n){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=i,e._y=n,this.properties=e.properties,null!=e.id&&(this.id=e.id);}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e;}toJSON(){const e={geometry:this.geometry};for(const t in this)"_geometry"!==t&&"_vectorTileFeature"!==t&&(e[t]=this[t]);return e}}class wP{constructor(e,t,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Si(Wh,16,0),this.grid3D=new Si(Wh,16,0),this.featureIndexArray=new Ka,this.promoteId=t,this.projection=i;}insert(e,t,i,n,r,o){const a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,n,r);const s=o?this.grid3D:this.grid;for(let e=0;e<t.length;e++){const i=t[e],n=[1/0,1/0,-1/0,-1/0];for(let e=0;e<i.length;e++){const t=i[e];n[0]=Math.min(n[0],t.x),n[1]=Math.min(n[1],t.y),n[2]=Math.max(n[2],t.x),n[3]=Math.max(n[3],t.y);}n[0]<Wh&&n[1]<Wh&&n[2]>=0&&n[3]>=0&&s.insert(a,n[0],n[1],n[2],n[3]);}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ng.VectorTile(new qb(this.rawTileData),null,this.projection).layers,this.sourceLayerCoder=new xP(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,t,i,n){this.loadVTLayers();const r=e.params||{},o=Wh/e.tileSize/e.scale,a=cx(r.filter),s=e.queryGeometry,l=e.queryPadding*o,u=bP(s),c=this.grid.query(u.minX-l,u.minY-l,u.maxX+l,u.maxY+l),h=bP(e.cameraQueryGeometry),d=this.grid3D.query(h.minX-l,h.minY-l,h.maxX+l,h.maxY+l,((t,i,n,r)=>function(e,t,i,n,r){for(const o of e)if(t<=o.x&&i<=o.y&&n>=o.x&&r>=o.y)return !0;const o=[new te(t,i),new te(t,r),new te(n,r),new te(n,i)];if(e.length>2)for(const t of o)if(Zw(e,t))return !0;for(let t=0;t<e.length-1;t++)if(Kw(e[t],e[t+1],o))return !0;return !1}(e.cameraQueryGeometry,t-l,i-l,n+l,r+l)));for(const e of d)c.push(e);c.sort(TP);const p={};let f;for(let l=0;l<c.length;l++){const u=c[l];if(u===f)continue;f=u;const h=this.featureIndexArray.get(u);let d=null;this.loadMatchingFeature(p,h.bucketIndex,h.sourceLayerIndex,h.featureIndex,a,r.layers,t,i,((t,i,r)=>(d||(d=Sg(t)),i.queryIntersectsFeature(s,t,r,d,this.z,e.symbolMatrixHelper,o,i instanceof oT?n:e.posMatrix))));}return p}loadMatchingFeature(e,t,i,n,r,o,a,s,l){const u=this.bucketLayerIDs[t];if(o&&!function(e,t){for(let i=0;i<e.length;i++)if(t.indexOf(e[i])>=0)return !0;return !1}(o,u))return;const c=this.sourceLayerCoder.decode(i),h=this.vtLayers[c].feature(n);if(!r(new Lp(this.tileID.overscaledZ),h))return;const d=this.getId(h,c);for(let t=0;t<u.length;t++){const i=u[t];if(o&&o.indexOf(i)<0)continue;const r=a[i];if(!r)continue;let c={};void 0!==d&&s&&(c=s.getState(r.sourceLayer||"_geojsonTileLayer",d));const p=!l||l(h,r,c);if(!p)continue;const f=new vP(h,this.z,this.x,this.y);f.layer=r.serialize(),f.id=d;let m=e[i];void 0===m&&(m=e[i]=[]),m.push({featureIndex:n,feature:f,intersectionZ:p});}}lookupSymbolFeatures(e,t,i,n,r,o){const a={};this.loadVTLayers();const s=cx(n);for(const n of e)this.loadMatchingFeature(a,t,i,n,s,r,o);return a}hasLayer(e){for(const t of this.bucketLayerIDs)for(const i of t)if(e===i)return !0;return !1}getId(e,t){let i=e.id;return this.promoteId&&(i=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[t]],"boolean"==typeof i&&(i=Number(i))),i}}function TP(e,t){return t-e}function bP(e){let t=1/0,i=1/0,n=-1/0,r=-1/0;for(const o of e)t=Math.min(t,o.x),i=Math.min(i,o.y),n=Math.max(n,o.x),r=Math.max(r,o.y);return {minX:t,minY:i,maxX:n,maxY:r}}$o("FeatureIndex",wP,{omit:["rawTileData","sourceLayerCoder"]});const PP=function(e,t){if(!e)return !1;const i=t.imageManager.getPattern(e.from),n=t.imageManager.getPattern(e.to);return !i||!n},SP=new _t(1,0,0),EP=new pd,AP=new Ot,CP=new Bt,MP=new St,IP=new Nt,LP=new _t(.2875,-.4979646071760521,.9959292143521045),NP=new _t,RP=new pd,OP=new _t(.0625,.5,1),DP=new pd,FP=new Ot,zP=new Ot;class BP extends W_{constructor(e){super(e),this.isVectorMaterial=!0,this.type=e.type,this.layer=e.layer,this.tile=e.tile,this._renderState=e.renderState,this._defines=e.defines,this._programConfiguration=e.programConfiguration,this.hasPattern=e.hasPattern,this.crossfade=void 0,this._createUniforms(e.painter);}update(e,t,i={}){const n=this.layer.paint.get("sprite-pattern");let r=!1;n.isConstant()||(r=!0),n.constantOr(null)&&(r=!0),BP.updateLayerProperty(this.layer,r),this.crossfade=this.layer.getCrossfadeParameters(),this.tile.imageAtlasUpload(e.context),this._programConfiguration.updatePaintBuffers(this.crossfade),this.tileRatio=1/hg(this.tile,1,e.style.symbolMatrixHelper.zoom),super.update(e,t,i);}_createUniforms(e){this._uniforms.set("u_PixelMatrix",(()=>(DP.identity(),DP.scale([1,Math.cos(e.transform.hpr.pitch)]),DP.rotate(-e.transform.hpr.heading),DP))),this._uniforms.set("u_Ratio",(()=>1/hg(this.tile,1,e.style.getNearestTileZoom()))),this.pushMinimumUniform("u_Ratio"),this._uniforms.set("u_GlUnitsToPixels",(()=>(FP.set(e.style.symbolMatrixHelper.width/2,-e.style.symbolMatrixHelper.height/2),FP))),this._uniforms.set("u_count",(()=>this.layer.count)),this.pushMinimumUniform("u_count"),this._uniforms.set("u_BaseColorSampler",(()=>(this.tile.imageAtlasTexture.bind(Du.LINEAR,Du.CLAMP_TO_EDGE),this.tile.imageAtlasTexture))),this.pushMinimumUniform("u_BaseColorSampler"),this._uniforms.set("u_texsize",(()=>(zP.set(this.tile.imageAtlasTexture.size[0],this.tile.imageAtlasTexture.size[1]),zP))),this.pushMinimumUniform("u_texsize"),this._uniforms.set("u_scale",(()=>OP));}destroy(){super.destroy(),this.layer=void 0,this.tile=void 0,this._programConfiguration=void 0,this.crossfade=void 0;}static updateLayerProperty(e,t){e.hasOwnProperty("count")||(e.count=0),e.timestamp||(e.timestamp=Date.now());const i=Date.now(),n=i-e.timestamp;let r=0;r=t?n/1e3:n/1e3*60,e.timestamp=i,e.count+=r;}}const VP=new Ot,kP=new pd,UP=new Ot,GP=new Ot;class HP{constructor(e){this.uid=(1e3*Math.random()).toFixed(0),this.options=e||{},this.maxParallelRequests=e.maxParallelRequests||6,this.status="preparing",this.requestingCount=0,this.ids=[],this.requests={};}setMaxParallelRequests(e){this.maxParallelRequests=e;}run(){this.status="running";let e=this.maxParallelRequests-this.requestingCount;e<=0&&(e=1);for(let t=0;t<e;t++)this.releaseRequest();}pauseRequest(){this.status="pausing";}restart(){this.run();}checkStatus(){0===this.ids.length&&(this.status="stopped");}_nextRequest(e){this.removeRequestById(e),this.requestingCount--,"pausing"!==this.status&&(this.checkStatus(),this.releaseRequest());}pushRequest(e){return !this.hasRequest(e.id)&&(this.ids.push(e.id),this.requests[e.id]={req:null,send:!1,param:e.param,cb:(t,i,n,r,o)=>{this.requests[e.id]&&(e.cb(t,i,n,r,o),this._nextRequest(e.id));}},!0)}pushRequests(e){for(let t=0;t<e.length;t++)this.pushRequest(e[t]);}releaseRequest(){for(let e=0;e<this.ids.length;e++)if(!this.requests[this.ids[e]].send&&!this.requests[this.ids[e]].req){this.releaseRequestById(this.ids[e]),this.requestingCount++;break}}releaseRequestById(e){const t=this.requests[e];this.requests[e].send||this.requests[e].req||(t.req=yh(t.param,t.cb),t.send=!0);}releaseRequestByIds(e){for(let t=0;t<e.length;t++)this.releaseRequestById(e[t]);}hasRequest(e){return -1!==this.ids.indexOf(e)}removeRequestById(e){if(this.hasRequest(e)){const t=this.ids.indexOf(e);this.ids.splice(t,1),this.cancelRequestById(e),delete this.requests[e];}}removeRequests(e){for(let t=0;t<e.length;t++)this.removeRequestById(e[t]);}removeAllRequest(){for(;this.ids.length>0;)this.removeRequestById(this.ids[0]);}cancelRequestById(e){const t=this.requests[e];t.send&&t.req&&t.req.cancel(),t.req=null,t.send=!1;}cancelRequests(e){for(let t=0;t<e.length;t++)this.cancelRequestById(e[t]);}cancelAllRequest(){for(let e=0;e<this.ids.length;e++)this.cancelRequestById(this.ids[e]);}destroy(){this.removeAllRequest(),this.ids=[],this.requests={};}}class YP extends HP{constructor(e){super(e);}pushRequest(e){return !this.hasRequest(e.id)&&(this.ids.push(e.id),this.requests[e.id]={req:null,send:!1,param:e.param,out:{},cb:(t,i,n,r)=>{this.done("image",{err:t,data:i,cacheControl:n,expires:r},e);}},!0)}done(e,{err:t,data:i},n){const r=this.requests[n.id];r&&(t&&(r.out.err=t),r.out.img=i&&!this._checkBase64(i)?new J.Blob([new Uint8Array(i)],{type:"image/png"}):null,n.cb(r.out.err,r.out),this._nextRequest(n.id));}releaseRequestById(e){const t=this.requests[e];this.requests[e].send||this.requests[e].req||(t.req=yh(t.param,t.cb),t.requestTerrainFlag&&(t.terrainRequest=yh(t.terrainParam,t.cb1)),t.send=!0);}cancelRequestById(e){const t=this.requests[e];t.send&&t.req&&t.req.cancel&&(t.req.cancel(),t.requestTerrainFlag&&t.terrainRequest&&t.terrainRequest.cancel()),t.req=null,t.terrainRequest=null,t.send=!1;}_checkBase64(e){if(e.byteLength>200)return !1;const t=new Uint8Array(e);let i="";for(let e=0;e<t.length;e++)i+=String.fromCharCode(t[e]);return -1!==i.indexOf("data:image")||-1!==i.indexOf("base64")}}class qP extends HP{constructor(e){super(e);}pushRequest(e){return !this.hasRequest(e.id)&&(this.ids.push(e.id),this.requests[e.id]={req:null,send:!1,param:e.param,data:null,cb:(t,i,n,r)=>{this.done("terrain",{err:t,data:i,cacheControl:n,expires:r},e);}},!0)}done(e,{err:t,data:i,cacheControl:n,expires:r},o){const a=this.requests[o.id];a&&(t&&(a.err=t),a.data={data:i,cacheControl:n,expires:r},o.cb(a.err,a.data),this._nextRequest(o.id));}releaseRequestById(e){const t=this.requests[e];this.requests[e].send||this.requests[e].req||(t.req=yh(t.param,t.cb),t.send=!0);}cancelRequestById(e){const t=this.requests[e];t.send&&t.req&&t.req.cancel&&t.req.cancel(),t.req=null,t.send=!1;}}e.ARCTYPE=sp,e.Actor=class{constructor(e,t,i){this.target=e,this.parent=t,this.mapId=i,this.callbacks={},this.callbackID=0,Ye(["receive"],this),this.target.addEventListener("message",this.receive,!1);}send(e,t,i,n){const r=i?`${this.mapId}:${this.callbackID++}`:null;i&&(this.callbacks[r]=i);const o=[];if(this.target.postMessage({targetMapId:n,sourceMapId:this.mapId,type:e,id:String(r),data:Qo(t,o)},o),i)return {cancel:()=>this.target.postMessage({targetMapId:n,sourceMapId:this.mapId,type:"<cancel>",id:String(r)})}}receive(e){const t=e.data,i=t.id;let n;if(t.targetMapId&&this.mapId!==t.targetMapId)return;const r=(e,t)=>{delete this.callbacks[i];const n=[];this.target.postMessage(t&&t.img&&t.img.data&&0===t.img.data.byteLength?{sourceMapId:this.mapId,type:"<response>",id:String(i),error:Qo({message:"图片为空"}),data:null}:{sourceMapId:this.mapId,type:"<response>",id:String(i),error:e?Qo(e):null,data:Qo(t,n)},n);};if("<response>"===t.type||"<cancel>"===t.type)n=this.callbacks[t.id],delete this.callbacks[t.id],n&&t.error?n(Jo(t.error)):n&&n(null,Jo(t.data));else if(void 0!==t.id&&this.parent[t.type]){this.callbacks[t.id]=null;const e=Jo(t.data);e.uid&&(e.uid=`${t.sourceMapId}:${e.uid}`),"reloadTile"===t.type&&(e.projection=this.parent.projection);const i=this.parent[t.type](t.sourceMapId,e,r);i&&null===this.callbacks[t.id]&&(this.callbacks[t.id]=i);}else if(void 0!==t.id&&this.parent.getWorkerSource){const e=t.type.split("."),i=Jo(t.data);i.uid&&(i.uid=`${t.sourceMapId}:${i.uid}`),this.parent.getWorkerSource(t.sourceMapId,e[0],i.source)[e[1]](i,r);}else this.parent[t.type](Jo(t.data));}remove(){this.target.removeEventListener("message",this.receive,!1);}},e.AlphaImage=bw,e.Anchor=Og,e.AnimationPropertyCollection=Xh,e.ArcType=ap,e.AxisAlignedBoundingBox=Pc,e.BatchTable=Lh,e.BoundingRectangle=op,e.BoundingSphere=vc,e.CONSTS=ot,e.Camera=class extends vl{constructor(){super(),this.type="Camera",this.isCamera=!0,this.matrixWorldInverse=new Bt,this.matrixWorld=new Bt,this.projectionMatrix=new Bt,this.projectionMatrixInverse=new Bt,this.positionNew=new _t,this._positionNew=new _t,this._positionWC=new _t,this._positionCartographic=new Ps,this.directionNew=new _t,this._directionNew=new _t,this._directionWC=new _t,this.upNew=new _t,this._upNew=new _t,this._upWC=new _t,this.rightNew=new _t,this._rightNew=new _t,this._rightWC=new _t,this._transform=new Bt,this._invTransform=new Bt,this._actualTransform=new Bt,this._actualInvTransform=Bt.clone(Bt.IDENTITY),this._transformChanged=!1,this.percentageChanged=.5,this._viewMatrix=new Bt,this._invViewMatrix=new Bt,this.defaultRotateAmount=Math.PI/3600,this.constrainedAxis=_t.UNIT_Z,this.defaultMoveAmount=1e5,this._updateViewMatrix(this),this.frustumCrate=null;}get positionWC(){return this._updateMembers(),this._positionWC}get cartographicPosition(){return this._positionCartographic}get directionWC(){return this._updateMembers(),this._directionWC}get upWC(){return this._updateMembers(),this._upWC}get rightWC(){return this._updateMembers(),this._rightWC}get heading(){return this._heading}get pitch(){return this._pitch}get roll(){return this._roll}get transform(){return this._transform}set transform(e){e instanceof Bt&&(this._transform=e);}get direction(){return _t.negate(_t.normalize(new _t(this.matrix[8],this.matrix[9],this.matrix[10]),new _t))}set direction(e){if(this.unmodified=!1,!(e instanceof _t))throw new Error("direction must be type of Vector3!");this.matrix=Bt.fromCamera({position:this.position,direction:e,up:this.up}),this.updateMatrixWorld(!0);}get up(){return _t.normalize(new _t(this.matrix[4],this.matrix[5],this.matrix[6]),new _t)}set up(e){if(this.unmodified=!1,!(e instanceof _t))throw new Error("up must be type of Vector3!");this.matrix=Bt.fromCamera({position:this.position,direction:this.direction,up:e}),this.updateMatrixWorld(!0);}get viewMatrix(){return this._updateMembers(),this._viewMatrix}getWorldDirection(e){void 0===e&&(console.warn("MineMap需要有目标target"),e=new _t),this.updateMatrixWorld(!0);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse=this.matrixWorld.clone().invert();}getVPMatrix(){return this.unmodified&&this._vpMatrix||this.updateMatrixWorld(!0),this._tmpProjectionMatrix&&this._tmpMatrixWorldInverse&&Bt.equalsArray(this.projectionMatrix,this._tmpProjectionMatrix)&&Bt.equalsArray(this.matrixWorldInverse,this._tmpMatrixWorldInverse)||(this._vpMatrix=this.projectionMatrix.clone().multiplyRight(this.matrixWorldInverse),this._tmpProjectionMatrix=this.projectionMatrix.clone(),this._tmpMatrixWorldInverse=this.matrixWorldInverse.clone()),this._vpMatrix.clone()}getViewMatrix(){return this.updateMatrixWorld(!0),this.matrixWorldInverse.clone()}getProjectionMatrix(){return this.projectionMatrix.clone()}_updateMembers(){let e=this._positionNew;const t=!_t.equals(e,this.positionNew);t&&(e=_t.clone(this.positionNew,this._positionNew));let i=this._directionNew;const n=!_t.equals(i,this.directionNew);n&&(_t.normalize(this.directionNew,this.directionNew),i=_t.clone(this.directionNew,this._directionNew));let r=this._upNew;const o=!_t.equals(r,this.upNew);o&&(_t.normalize(this.upNew,this.upNew),r=_t.clone(this.upNew,this._upNew));let a=this._rightNew;const s=!_t.equals(a,this.rightNew);s&&(_t.normalize(this.rightNew,this.rightNew),a=_t.clone(this.rightNew,this._rightNew));const l=this._transformChanged;this._transformChanged=!1,l&&(Bt.inverseTransformation(this._transform,this._invTransform),Bt.clone(this._transform,this._actualTransform),Bt.inverseTransformation(this._actualTransform,this._actualInvTransform));const u=this._actualTransform;if((t||l)&&(this._positionWC=Bt.multiplyByPoint(u,e,this._positionWC),this._positionCartographic=hi.WGS84.cartesianToCartographic(this._positionWC,this._positionCartographic)),n||o||s){const e=_t.dot(i,_t.cross(r,a,new _t));if(Math.abs(1-e)>ot.CesiumMath.EPSILON2){const e=1/_t.magnitudeSquared(r),t=_t.dot(r,i)*e,n=_t.multiplyByScalar(i,t,new _t);r=_t.normalize(_t.subtract(r,n,this._upNew),this._upNew),_t.clone(r,this.upNew),a=_t.cross(i,r,this._rightNew),_t.clone(a,this.rightNew);}}(n||l)&&(this._directionWC=Bt.multiplyByPointAsVector(u,i,this._directionWC),_t.normalize(this._directionWC,this._directionWC)),(o||l)&&(this._upWC=Bt.multiplyByPointAsVector(u,r,this._upWC),_t.normalize(this._upWC,this._upWC)),(s||l)&&(this._rightWC=Bt.multiplyByPointAsVector(u,a,this._rightWC),_t.normalize(this._rightWC,this._rightWC)),(t||n||o||s||l)&&this._updateViewMatrix();}_updateViewMatrix(){Bt.computeView(this._positionNew,this._directionNew,this._upNew,this._rightNew,this._viewMatrix),Bt.multiply(this._viewMatrix,this._actualInvTransform,this._viewMatrix),Bt.inverseTransformation(this._viewMatrix,this._invViewMatrix);}setMatrix(e){super.setMatrix(e),this.updateMatrixWorld(!0),this.updateCullingVolume(),this.unmodified=!1;}updateCullingVolume(){if(!this.frustumCrate)throw new Error({info:"当前没有正确初始化视锥体盒子对象！"});this.frustumCrate.updateCullingVolume(this.position,this.direction.clone(),this.up.clone());}getPickRay(e,t,i){if(!$(e))throw new hl("windowPosition is required.");$(i)||(i=new Ds);const n=this.frustumCrate.frustum;return $(n.aspectRatio)&&$(n.fov)&&$(n.near)?this._getPickRayPerspective(this,t,e,i):this._getPickRayOrthographic(this,t,e,i)}_getPickRayPerspective(e,t,i,n){const r=t.clientWidth,o=t.clientHeight,a=Math.tan(.5*e.frustumCrate.frustum.fovy),s=e.frustumCrate.frustum.aspectRatio*a,l=e.frustumCrate.frustum.near,u=2/r*i.x-1,c=2/o*(o-i.y)-1,h=e.position.clone();n.origin=h;const d=_t.multiplyByScalar(e.direction,l,new _t);_t.add(h,d,d);const p=_t.multiplyByScalar(e.right,u*l*s,new _t),f=_t.multiplyByScalar(e.up,c*l*a,new _t),m=_t.add(d,p,n.direction);return _t.add(m,f,m),_t.subtract(m,h,m),_t.normalize(m,m),n}_getPickRayOrthographic(e,t,i){return i}_pickEllipsoid3D(e,t,i,n){i=Z(i,hi.WGS84);const r=this.getPickRay(e,t,new Ds),o=Fs.rayEllipsoid(r,i);if(o)return Ds.getPoint(r,o.start>0?o.start:o.stop,n)}pickEllipsoid(e,t,i,n){if(!$(e))throw new Error("windowPosition is required.");if(0!==t.clientWidth&&0!==t.clientHeight)return $(n)||(n=new _t),i=Z(i,hi.WGS84),this._pickEllipsoid3D(e,t,i,n)}worldToCameraCoordinates(e,t){if(!$(e))throw new Error("vector3 is required.");return $(t)||(t=new St),this._updateMembers(),Bt.multiplyByVector(this._actualInvTransform,e,t)}worldToCameraCoordinatesPoint(e,t){if(!$(e))throw new Error("cartesian is required.");return $(t)||(t=new _t),this._updateMembers(),Bt.multiplyByPoint(this._actualInvTransform,e,t)}rotate(e,t){if(!$(e))throw new Error("axis is required.");const i=Z(t,this.defaultRotateAmount),n=Et.fromAxisAngle(e,-i,new Et),r=Nt.fromQuaternion(n,new Nt);this.position=Nt.multiplyByVector(r,this.positionNew,this.positionNew),Nt.multiplyByVector(r,this.directionNew,this.directionNew),Nt.multiplyByVector(r,this.upNew,this.upNew),_t.cross(this.directionNew,this.upNew,this.rightNew),_t.cross(this.rightNew,this.directionNew,this.upNew);}zoomIn(e){this._zoom3D(e);}_zoom3D(e){this.move(this.directionNew,e);}move(e,t){if(!$(e))throw new Error("direction is required.");const i=new _t;_t.multiplyByScalar(e,t,i),this.position=_t.add(this.positionNew,i,this.positionNew);}_setTransform(e){const t=_t.clone(this.positionWC,new _t),i=_t.clone(this.upWC,new _t),n=_t.clone(this.directionWC,new _t);Bt.clone(e,this._transform),this._transformChanged=!0,this._updateMembers();const r=this._actualInvTransform;Bt.multiplyByPoint(r,t,this.positionNew),Bt.multiplyByPointAsVector(r,n,this.directionNew),Bt.multiplyByPointAsVector(r,i,this.upNew),_t.cross(this.directionNew,this.upNew,this.rightNew),this._updateMembers();}rotateUp(e){e=Z(e,this.defaultRotateAmount),this._rotateVertical(-e);}_rotateVertical(e){const t=this.positionNew;if($(this.constrainedAxis)&&!_t.equalsEpsilon(this.positionNew,_t.ZERO,ot.CesiumMath.EPSILON2)){const i=_t.normalize(t,new _t),n=_t.equalsEpsilon(i,this.constrainedAxis,ot.CesiumMath.EPSILON2),r=_t.equalsEpsilon(i,_t.negate(this.constrainedAxis,new _t),ot.CesiumMath.EPSILON2);if(n||r)(n&&e<0||r&&e>0)&&this.rotate(this.rightNew,e);else {const t=_t.normalize(this.constrainedAxis,new _t);let n=_t.dot(i,t),r=ot.CesiumMath.acosClamped(n);e>0&&e>r&&(e=r-ot.CesiumMath.EPSILON4),n=_t.dot(i,_t.negate(t,new _t)),r=ot.CesiumMath.acosClamped(n),e<0&&-e>r&&(e=-r+ot.CesiumMath.EPSILON4);const o=_t.cross(t,i,new _t);this.rotate(o,e);}}else this.rotate(this.rightNew,e);}rotateRight(e){e=Z(e,this.defaultRotateAmount),this._rotateHorizontal(-e);}_rotateHorizontal(e){$(this.constrainedAxis)?this.rotate(this.constrainedAxis,e):this.rotate(this.upNew,e);}moveForward(e){e=Z(e,this.defaultMoveAmount),this.move(this.directionNew.clone(),e);}moveBackward(e){e=Z(e,this.defaultMoveAmount),this.move(this.directionNew.clone(),-e);}moveLeft(e){e=Z(e,this.defaultMoveAmount),this.move(this.rightNew.clone(),-e);}moveRight(e){e=Z(e,this.defaultMoveAmount),this.move(this.rightNew,e);}look(e,t){if(!$(e))throw new Error("axis is required.");const i=Z(t,Math.PI/60),n=Et.fromAxisAngle(e,-i,new Et),r=Nt.fromQuaternion(n,new Nt),o=this.directionNew,a=this.upNew,s=this.rightNew;Nt.multiplyByVector(r,o,o),Nt.multiplyByVector(r,a,a),Nt.multiplyByVector(r,s,s);}getRectangleCameraCoordinates(e,t){if(!$(e))throw new hl("rectangle is required");return $(t)||(t=new _t),this.rectangleCameraPosition3D(e,t)}rectangleCameraPosition3D(e,t,i){const n=hi.WGS84,r=i?this:{direction:new _t,right:new _t,up:new _t},o=e.north,a=e.south;let s=e.east;const l=e.west;l>s&&(s+=ot.CesiumMath.TWO_PI);const u=.5*(l+s);let c;if(a<-ot.CesiumMath.PI_OVER_TWO+ot.CesiumMath.RADIANS_PER_DEGREE&&o>ot.CesiumMath.PI_OVER_TWO-ot.CesiumMath.RADIANS_PER_DEGREE)c=0;else {const e=new Ps(u,o,0),t=new Ps(u,a,0),i=new cl(void 0,void 0,n);i.setEndPoints(e,t),c=i.interpolateUsingFraction(.5,new Ps).latitude;}const h=new Ps(u,c,0),d=n.cartographicToCartesian(h,new _t),p=new Ps;p.longitude=s,p.latitude=o;const f=n.cartographicToCartesian(p,new _t);p.longitude=l;const m=n.cartographicToCartesian(p,new _t);p.longitude=u;const _=n.cartographicToCartesian(p,new _t);p.latitude=a;const g=n.cartographicToCartesian(p,new _t);p.longitude=s;const y=n.cartographicToCartesian(p,new _t);p.longitude=l;const x=n.cartographicToCartesian(p,new _t);_t.subtract(m,d,m),_t.subtract(y,d,y),_t.subtract(f,d,f),_t.subtract(x,d,x),_t.subtract(_,d,_),_t.subtract(g,d,g);const v=n.geodeticSurfaceNormal(d,r.directionNew);_t.negate(v,v);const w=_t.cross(v,_t.UNIT_Z,r.rightNew);_t.normalize(w,w);const T=_t.cross(w,v,r.upNew);let b;const P=Math.tan(.5*this.frustumCrate.frustum.fovy),S=this.frustumCrate.frustum.aspectRatio*P;if(b=Math.max(this._computeD(v,T,m,P),this._computeD(v,T,y,P),this._computeD(v,T,f,P),this._computeD(v,T,x,P),this._computeD(v,T,_,P),this._computeD(v,T,g,P),this._computeD(v,w,m,S),this._computeD(v,w,y,S),this._computeD(v,w,f,S),this._computeD(v,w,x,S),this._computeD(v,w,_,S),this._computeD(v,w,g,S)),a<0&&o>0){const e=new Ps(l,0,0);let t=n.cartographicToCartesian(e,new _t);_t.subtract(t,d,t),b=Math.max(b,this._computeD(v,T,t,P),this._computeD(v,w,t,S)),e.longitude=s,t=n.cartographicToCartesian(e,new _t),_t.subtract(t,d,t),b=Math.max(b,this._computeD(v,T,t,P),this._computeD(v,w,t,S));}return _t.add(d,_t.multiplyByScalar(v,-b,new _t),t)}_computeD(e,t,i,n){return Math.abs(_t.dot(t,i))/n-_t.dot(e,i)}_directionUpToHeadingPitchRoll(e,t,i,n){const r=_t.clone(i.direction,new _t),o=_t.clone(i.up,new _t),a=Nu.eastNorthUpToFixedFrame(t),s=Bt.inverseTransformation(a,new Bt);Bt.multiplyByPointAsVector(s,r,r),Bt.multiplyByPointAsVector(s,o,o);const l=_t.cross(r,o,new _t);return n.heading=this._getHeading(r,o),n.pitch=this._getPitch(r),n.roll=this._getRoll(r,o,l),n}setView(e){e=Z(e,Z.EMPTY_OBJECT);let t=Z(e.orientation,Z.EMPTY_OBJECT);$(e.endTransform)&&this._setTransform(e.endTransform);let i=Z(e.destination,_t.clone(this.positionNew,new _t));$(i)&&$(i.west)&&(i=this.getRectangleCameraCoordinates(i,new _t)),$(t.direction)&&(t=this._directionUpToHeadingPitchRoll(this,i,t,{direction:void 0,up:void 0,heading:void 0,pitch:void 0,roll:void 0}));const n=new st;n.heading=Z(t.heading,0),n.pitch=Z(t.pitch,-ot.CesiumMath.PI_OVER_TWO),n.roll=Z(t.roll,0),this._setView3D(i,n),this._updateCameraChanged(),this.setMatrix(this._invViewMatrix.clone());}_setView3D(e,t){const i=Bt.clone(this.transform,new Bt),n=Nu.eastNorthUpToFixedFrame(e);this._setTransform(n),_t.clone(_t.ZERO,this.positionNew),t.heading=t.heading-ot.CesiumMath.PI_OVER_TWO;const r=(new Et).fromHeadingPitchRoll(t),o=Nt.fromQuaternion(r,new Nt);Nt.getColumn(o,0,this.directionNew),Nt.getColumn(o,2,this.upNew),_t.cross(this.directionNew,this.upNew,this.rightNew),this._setTransform(i);}_initializedHeadingPitchRoll(){this._heading=this._calculateHeading(),this._pitch=this._calculatePitch(),this._roll=this._calculateRoll();}_getHeading(e,t){let i;return i=ot.CesiumMath.equalsEpsilon(Math.abs(e.z),1,ot.CesiumMath.EPSILON3)?Math.atan2(t.y,t.x)-ot.CesiumMath.PI_OVER_TWO:Math.atan2(e.y,e.x)-ot.CesiumMath.PI_OVER_TWO,ot.CesiumMath.TWO_PI-ot.CesiumMath.zeroToTwoPi(i)}_getPitch(e){return ot.CesiumMath.PI_OVER_TWO-ot.CesiumMath.acosClamped(e.z)}_getRoll(e,t,i){let n=0;return ot.CesiumMath.equalsEpsilon(Math.abs(e.z),1,ot.CesiumMath.EPSILON3)||(n=Math.atan2(-i.z,t.z),n=ot.CesiumMath.zeroToTwoPi(n+ot.CesiumMath.TWO_PI)),n}_calculateHeading(){const e=Bt.clone(this._transform,new Bt),t=Nu.eastNorthUpToFixedFrame(this.positionWC,hi.WGS84);this._setTransform(t);const i=this._getHeading(this.directionNew,this.upNew);return this._setTransform(e),i}_calculatePitch(){const e=Bt.clone(this._transform,new Bt),t=Nu.eastNorthUpToFixedFrame(this.positionWC,hi.WGS84);this._setTransform(t);const i=this._getPitch(this.directionNew);return this._setTransform(e),i}_calculateRoll(){const e=Bt.clone(this._transform,new Bt),t=Nu.eastNorthUpToFixedFrame(this.positionWC,hi.WGS84);this._setTransform(t);const i=this._getRoll(this.directionNew,this.upNew,this.rightNew);return this._setTransform(e),i}_updateCameraChanged(){const e=this,t=e.percentageChanged,i=this._calculateHeading();this._heading=i,this._pitch=this._calculatePitch(),this._roll=this._calculateRoll(),$(e._changedHeading)||(e._changedHeading=i);let n=Math.abs(e._changedHeading-i)%ot.CesiumMath.TWO_PI;if(n=n>ot.CesiumMath.PI?ot.CesiumMath.TWO_PI-n:n,n/Math.PI>t&&(e._changedHeading=i),!$(e._changedDirection))return e._changedPosition=_t.clone(e.positionWC,e._changedPosition),void(e._changedDirection=_t.clone(e.directionWC,e._changedDirection));const r=ot.CesiumMath.acosClamped(_t.dot(e.directionWC,e._changedDirection));let o;o=$(e.frustumCrate.frustum.fovy)?r/(.5*e.frustumCrate.frustum.fovy):r;const a=_t.distance(e.positionWC,e._changedPosition);(o>t||a/e.cartographicPosition[2]>t)&&(e._changedPosition=_t.clone(e.positionWC,e._changedPosition),e._changedDirection=_t.clone(e.directionWC,e._changedDirection)),this.updateCullingVolume();}distanceToBoundingSphere(e){if(!$(e))throw new hl("boundingSphere is required.");const t=_t.subtract(this.positionWC,e.center,bl),i=_t.multiplyByScalar(this.directionWC,_t.dot(t,this.directionWC),Pl);return Math.max(0,_t.magnitude(i)-e.radius)}getPixelSize(e,t,i){const n=this.distanceToBoundingSphere(e),r=this.frustumCrate.frustum.getPixelDimensions(t,i,n,J.devicePixelRatio,new Ot);return Math.max(r.x,r.y)}},e.Cartographic=Ps,e.ClassificationType=hp,e.ClippingPlane=Ry,e.ClippingPlaneCollection=Zy,e.CollisionBoxArray=Ha,e.Color=Ui,e.CompressedTextureUtil=Qc,e.ContextLimits=Yc,e.Coordinate=ee,e.CullingVolume=os,e.DefaultUp=Tl,e.DepthMaterial=K_,e.DeveloperError=hl,e.DictionaryCoder=xP,e.EXTENT=Wh,e.Ellipsoid=hi,e.EncodedVector3=gd,e.ErrorEvent=ml,e.Euler=Ut,e.EvaluationParameters=Lp,e.Event=fl,e.Evented=_l,e.Feature=vP,e.FeatureIndex=wP,e.Formatted=wn,e.GLYPH_PBF_BORDER=mP,e.GeographicProjection=Fu,e.Geometry=wd,e.GltfTile=k_,e.HeadingPitchRoll=st,e.INTERSECTION=Qa,e.ImageAtlas=Ew,e.ImagePosition=Sw,e.Interpolate=br,e.IntersectionTests=Fs,e.Intersections2D=gP,e.JulianDate=pu,e.LAYER_LAYOUT_CONSTS=at,e.LightingModelType=Ky,e.LngLat=fi,e.LngLatBounds=di,e.MAXIMUM_HEIGHT=fp,e.MINIMUM_HEIGHT=pp,e.Material=W_,e.MathArray=c,e.Matrix=At,e.Matrix2=pd,e.Matrix3=Nt,e.Matrix4=Bt,e.Node=z_,e.NormalMaterial=Q_,e.Object3D=vl,e.OrientedBoundingBox=Uc,e.OrthographicFrustum=xs,e.OrthographicOffCenterFrustum=gs,e.OverscaledTileID=sd,e.PerspectiveOffCenterFrustum=hs,e.PhongLightSetter=Yx,e.PickColorMaterial=Z_,e.PixelDatatype=eh,e.PixelFormat=ih,e.Plane=ts,e.PolygonGeometry=_p,e.PolygonGeometryLibrary=lp,e.PolygonPipeline=Wd,e.PolylineGeometry=cg,e.PolylineMaterial=$_,e.PolylinePipeline=vu,e.Primitive=Ny,e.ProgramConfiguration=_f,e.ProjectionProxy=xi,e.ProjectionType=mi,e.Quaternion=Et,e.REGULAR_RADIUS_Z=qt,e.RGBAImage=Pw,e.RasterMaterial=class extends W_{constructor(e){super(e),this.layer=e.layer,this.tile=e.tile,this._parentTile=e.parentTile,this._renderState=e.renderState,this.textureFilter=Du.LINEAR,this._lightColor=new _t(1,1,1),this._lightDirection=new _t,this._spinWeights=new _t,this.parentTL=new Ot,this.updateDynamicProperty(),this.createUniforms(),this.emptyTexture=new Ih({context:e.painter.context,image:{width:1,height:1,data:null},pixelFormat:Du.RGBA,useMipmap:!1});}setLayer(e){this.layer=e;}set parentTile(e){e?.tileID.key!=this._parentTile?.tileID.key&&(this._parentTile=e,this.updateDynamicProperty());}update(e,t,i={}){super.update(e,t,i),this.defines={ENCODE_DEPTH_TO_FRAGCOLOR:t.passType===f_.PICK_PASS,TEXTURE_UNITS:"loaded"!==this.tile.state?0:this.tile.orderedImages.length};}updateDynamicProperty(){this._parentTile?(this.parentScaleBy=Math.pow(2,this._parentTile.tileID.overscaledZ-this.tile.tileID.overscaledZ),this.parentTL.set(this.tile.tileID.canonical.x*this.parentScaleBy%1,this.tile.tileID.canonical.y*this.parentScaleBy%1)):(this.parentScaleBy=1,this.parentTL.set(0,0));}createUniforms(){this._uniforms.set("u_BackgroundColor",(()=>this.tile.backgroundColor)),this._uniforms.set("u_TextureBrightnessMin",(()=>{const e=[];for(let t=0;t<this.tile.orderedImages.length;t++)e.push(this.tile.orderedImages[t].brightnessMin);return e.length>0?e:[0]})),this._uniforms.set("u_TextureBrightnessMax",(()=>{const e=[];for(let t=0;t<this.tile.orderedImages.length;t++)e.push(this.tile.orderedImages[t].brightnessMax);return e.length>0?e:[1]})),this._uniforms.set("u_TextureSaturationFactor",(()=>{const e=[];for(let t=0;t<this.tile.orderedImages.length;t++)e.push(this.tile.orderedImages[t].saturation);return e.length>0?e:[0]})),this._uniforms.set("u_TextureContrastFactor",(()=>{const e=[];for(let t=0;t<this.tile.orderedImages.length;t++)e.push(this.tile.orderedImages[t].contrast);return e.length>0?e:[1]})),this._uniforms.set("u_TextureSpinWeight",(()=>{const e=[];for(let t=0;t<this.tile.orderedImages.length;t++)e.push(this.tile.orderedImages[t].spinWeight);return e.length>0?e:[SP]})),this._uniforms.set("u_TextureAlpha",(()=>{const e=[];for(let t=0;t<this.tile.orderedImages.length;t++)e.push(this.tile.orderedImages[t].opacity);return e.length>0?e:[0]})),this._uniforms.set("u_Texture",(()=>{const e=[];for(let t=0;t<this.tile.orderedImages.length;t++){const i=this.tile.orderedImages[t];e.push(i.imagery?i.imagery.texture:this.emptyTexture);}return e})),this._uniforms.set("u_TextureTexCoordsRectangle",(()=>{const e=[];for(let t=0;t<this.tile.orderedImages.length;t++)e.push(this.tile.orderedImages[t].textureCoordinateRectangle);return e})),this._uniforms.set("u_TextureTranslationAndScale",(()=>{const e=[];for(let t=0;t<this.tile.orderedImages.length;t++)e.push(this.tile.orderedImages[t].textureTranslationAndScale);return e})),this._uniforms.set("u_TextureAlphaPremultiplied",(()=>{const e=[];for(let t=0;t<this.tile.orderedImages.length;t++)e.push(!this.tile.orderedImages[t].layerId);return e})),this._uniforms.set("u_DiscardOffset",(()=>this.tile.isOpacity?.01/Math.pow(this.tile.sse,2):0));}checkLayer(){if(!this.layer)throw new Error("请在rater plotter中针对image source或者video source进行layer的注册，即调用material.setLayer(layer)")}destroy(){this.layer=void 0,this.tile.texture&&(this.tile.texture.destroy(),this.tile.texture=null),this.__texture=null,this.tile=void 0,this.programId=void 0,this.type=void 0,this._uniforms=void 0,this._textures=void 0,this._program=void 0,this._programConfiguration=void 0,this._renderState=void 0,this._parentTile=void 0,this.textureFilter=void 0,this.parentTL=void 0,this.parentScaleBy=void 0;}},e.Ray=Ds,e.Rectangle=Ss,e.RenderPassConsts=f_,e.RenderState=m_,e.RequestPerformanceManger=class{constructor(e){this.options=e||{},this.imageCacheRequests={},this.vectorCacheRequests={},this.terrainCacheRequests={};}getTerrainRequesterById(e){return this.terrainCacheRequests[e]||(this.terrainCacheRequests[e]=new qP({id:e,maxParallelRequests:1})),this.terrainCacheRequests[e]}getImageRequesterById(e){return this.imageCacheRequests[e]||(this.imageCacheRequests[e]=new YP({id:e,maxParallelRequests:1})),this.imageCacheRequests[e]}getVectorRequesterById(e){return this.vectorCacheRequests[e]||(this.vectorCacheRequests[e]=new HP({id:e,maxParallelRequests:1})),this.vectorCacheRequests[e]}pauseVectorRequest(){for(const e in this.vectorCacheRequests)this.vectorCacheRequests[e].pauseRequest();}restartVectorRequest(){for(const e in this.vectorCacheRequests)this.vectorCacheRequests[e].restart();}removeTerrainRequesterById(e){this.terrainCacheRequests[e]&&(this.terrainCacheRequests[e].destroy(),delete this.terrainCacheRequests[e]);}removeImageRequesterById(e){this.imageCacheRequests[e]&&(this.imageCacheRequests[e].destroy(),delete this.imageCacheRequests[e]);}removeVectorRequesterById(e){this.vectorCacheRequests[e]&&(this.vectorCacheRequests[e].destroy(),delete this.vectorCacheRequests[e]);}removeAll(){for(const e in this.terrainCacheRequests)this.removeTerrainRequesterById(e);for(const e in this.imageCacheRequests)this.removeImageRequesterById(e);for(const e in this.vectorCacheRequests)this.removeVectorRequesterById(e);}destroy(){this.removeAll(),this.imageCacheRequests=null,this.vectorCacheRequests=null,this.terrainCacheRequests=null;}},e.ResourceType=fh,e.SHADER_CIRCLE="sphereCircle",e.SHADER_FILL_COLOR="sphereFill",e.SHADER_FILL_OUTLINE_COLOR="sphereFillOutline",e.SHADER_HEATMAP_COLOR="sphereHeatmap",e.SHADER_HISTOGRAM_COLOR="sphereHistogram",e.SHADER_LINE_COLOR="sphereLine",e.SHADER_LINE_GRADIENT="sphereLineGradient",e.SHADER_LINE_PATTERN="sphereLinePattern",e.SHADER_LINE_SDF="sphereLineSDF",e.SHADER_LINE_SPRITE_COLOR="sphereSprite",e.SHADER_LINE_SPRITE_PATTERN="sphereSpritePattern",e.SHADER_LINE_TRACKING_COLOR="sphereTracking",e.SHADER_RASTER="sphereRaster",e.SHADER_SYMBOL_ICON="sphereSymbolIcon",e.SHADER_SYMBOL_SDF="sphereSymbolSDF",e.SHADER_SYMTRACKING_ICON="sphereSymtrackingIcon",e.SHADER_SYMTRACKING_SDF="sphereSymtrackingSDF",e.Sampler=Kc,e.SegmentVector=ep,e.ShaderSource=D_,e.ShadowsType=G_,e.SpriteMaterial=BP,e.StandardMaterial=jx,e.StandardMaterialType=qx,e.State=_d,e.StructArrayLayout10f40=da,e.StructArrayLayout11f44=ua,e.StructArrayLayout21f84=oa,e.StructArrayLayout2i4=ea,e.StructArrayLayout2ui4=ka,e.StructArrayLayout3f12=Sa,e.StructArrayLayout3f2f3f32=ra,e.StructArrayLayout3f3f24=ca,e.StructArrayLayout3f4f28=ha,e.StructArrayLayout3ui6=Ba,e.StructArrayLayout3ul12=Va,e.StructArrayLayout4f16=Ua,e.StructArrayLayout5f20=ia,e.SymbolMaterial=Ly,e.TerrainTileParser=class{constructor(){this.maxShort=32767,this.halfMaxShort=this.maxShort/2|0;}getCenterLngLat(e,t,i,n){const r=yi(n),o=Math.pow(2,i+1);return r.tileNumberToLngLat([2*e+1,2*t+1],1,o)}createTerrain(e,t,i,n,r,o){if(!e||0===e.byteLength)return;e.buffer&&(e=e.buffer);const a=yi(r),s=Math.pow(2,n),l=a.tileNumberToLngLat([t,i],1,s),u=a.tileNumberToLngLat([t+1,i+1],1,s),c=Math.abs(u.lng-l.lng),h=this.getCenterLngLat(t,i,n,r);let d=new ia;const p=new Ba,f=new ka;let m=0;const _=3*Float64Array.BYTES_PER_ELEMENT,g=4*Float64Array.BYTES_PER_ELEMENT,y=3*Uint16Array.BYTES_PER_ELEMENT;let x=Uint16Array.BYTES_PER_ELEMENT,v=3*x;const w=new DataView(e);m+=_;const T=w.getFloat32(m,!0);m+=Float32Array.BYTES_PER_ELEMENT;const b=w.getFloat32(m,!0);m+=Float32Array.BYTES_PER_ELEMENT;const P=Nu.cartographicToCartesian3([h.lng,h.lat,T]),S={vertex:[Nu.cartographicToCartesian3([l.lng,l.lat,T]),Nu.cartographicToCartesian3([u.lng,l.lat,T]),Nu.cartographicToCartesian3([u.lng,u.lat,T]),Nu.cartographicToCartesian3([l.lng,u.lat,T]),Nu.cartographicToCartesian3([l.lng,l.lat,b]),Nu.cartographicToCartesian3([u.lng,l.lat,b]),Nu.cartographicToCartesian3([u.lng,u.lat,b]),Nu.cartographicToCartesian3([l.lng,u.lat,b])],indices:[0,3,2,0,2,1,4,7,6,4,6,5,0,4,7,0,7,3,1,5,6,1,6,2,0,5,4,0,1,5,3,6,2,3,7,6]},E=[];for(let e=0;e<S.indices.length;)E.push([S.vertex[S.indices[e]],S.vertex[S.indices[e+1]],S.vertex[S.indices[e+2]]]),e+=3;let A;m+=g,m+=_;try{A=w.getUint32(m,!0);}catch(e){return}m+=Uint32Array.BYTES_PER_ELEMENT;const C=new Uint16Array(e,m,3*A);m+=A*y,A>65536&&(x=Uint32Array.BYTES_PER_ELEMENT,v=3*x);const M=C.subarray(0,A),I=C.subarray(A,2*A),L=C.subarray(2*A,3*A),N=[],R=[],O=[];this.zigZagDeltaDecode({uBuffer:M,vBuffer:I,heightBuffer:L,maximumHeight:b,minimumHeight:T,position:N,uv:R,hei:O,sphereMaskedBoundsArray:d,centerLngLat:h,deltaLng:c,projectionType:r,rP:P,worldSize:s,x:t,y:i,z:n}),m%x!=0&&(m+=x-m%x);const D=w.getUint32(m,!0);m+=Uint32Array.BYTES_PER_ELEMENT;const F=new Uint16Array(e,m,3*D);m+=D*v;let z=0;const B=F.length;for(let e=0;e<B;++e){const t=F[e];F[e]=z-t,0===t&&++z;}const V=w.getUint32(m,!0);m+=Uint32Array.BYTES_PER_ELEMENT;let k=new Uint16Array(e,m,V);m+=V*x;const U=w.getUint32(m,!0);m+=Uint32Array.BYTES_PER_ELEMENT;let G=new Uint16Array(e,m,U);m+=U*x;const H=w.getUint32(m,!0);m+=Uint32Array.BYTES_PER_ELEMENT;let Y=new Uint16Array(e,m,H);m+=H*x;const q=w.getUint32(m,!0);m+=Uint32Array.BYTES_PER_ELEMENT;let X=new Uint16Array(e,m,q);m+=q*x;const W=[];d=this.computeNormal(d,F,P,A,B,W);const j=[],$=this.genTerrainAnalysisArray(d,P,A,j,O),Z=Math.max(0,2*(k.length+G.length+Y.length+X.length-4)),K=new Uint16Array(B+3*Z);function Q(e,t){return I[e]-I[t]}function J(e,t){return M[e]-M[t]}K.set(F,0),k=this.sortIndicesIfNecessary(k,Q),G=this.sortIndicesIfNecessary(G,J),Y=this.sortIndicesIfNecessary(Y,Q),X=this.sortIndicesIfNecessary(X,J);let ee=B,te=C.length;ee=this.addSkirt(te,K,ee,k,!0,3,N,R,O,W,j,d,$,n,P,o),te+=3*k.length,ee=this.addSkirt(te,K,ee,G,!1,3,N,R,O,W,j,d,$,n,P,o),te+=3*G.length,ee=this.addSkirt(te,K,ee,Y,!1,3,N,R,O,W,j,d,$,n,P,o),te+=3*Y.length,this.addSkirt(te,K,ee,X,!0,3,N,R,O,W,j,d,$,n,P,o);for(let e=0;e<K.length;e+=3)p.emplaceBack(K[e],K[e+1],K[e+2]),f.emplaceBack(K[e],K[e+1]),f.emplaceBack(K[e+1],K[e+2]),f.emplaceBack(K[e+2],K[e]);return {sphereMaskedBoundsArray:d,sphereIndexArray:p,wireframeIndexArray:f,rP:P,count:N.length,minimumHeight:T,maximumHeight:b,tileBounds:E,tileBoundsVertex:S.vertex,indices:F,skirtIndex:F.length,vertexCountWithoutSkirts:A,x:t,y:i,z:n,uBuffer:M.slice(0),vBuffer:I.slice(0),hBuffer:L.slice(0),westIndices:k.slice(0),southIndices:G.slice(0),eastIndices:Y.slice(0),northIndices:X.slice(0),terrainAnalysisArray:$}}createChildTerrain(e){const t=this.upsampleQuantizedTerrainMesh(e);return t.skirtHeight=e.skirtHeight,this.createUpSampleTerrain(t)}createUpSampleTerrain(e){const t=yi(e.projectionType),i=e.x,n=e.y,r=e.z,o=Math.pow(2,r),a=t.tileNumberToLngLat([i,n],1,o),s=t.tileNumberToLngLat([i+1,n+1],1,o),l=Math.abs(s.lng-a.lng),u=this.getCenterLngLat(i,n,r,e.projectionType);let c=new ia;const h=new Ba,d=new ka,p=new Uint16Array(e.uBuffer),f=new Uint16Array(e.vBuffer),m=new Uint16Array(e.heightBuffer),_=[],g=[],y=[],x=e.maximumHeight,v=e.minimumHeight,w=Nu.cartographicToCartesian3([u.lng,u.lat,v]);this.zigZagUpsampleDeltaDecode({uBuffer:p,vBuffer:f,heightBuffer:m,maximumHeight:x,minimumHeight:v,position:_,uv:g,hei:y,sphereMaskedBoundsArray:c,centerLngLat:u,deltaLng:l,projectionType:e.projectionType,rP:w,x:i,y:n,z:r,worldSize:o});const T=e.indices,b=T.length;let P=e.westIndices,S=e.eastIndices,E=e.northIndices,A=e.southIndices;const C=e.vertexCount,M=[];c=this.computeNormal(c,T,w,C,b,M);const I=[],L=this.genTerrainAnalysisArray(c,w,C,I,y),N=Math.max(0,2*(P.length+A.length+S.length+E.length-4)),R=new Uint16Array(b+3*N);function O(e,t){return f[e]-f[t]}function D(e,t){return p[e]-p[t]}R.set(T,0),P=this.sortIndicesIfNecessary(P,O),A=this.sortIndicesIfNecessary(A,D),S=this.sortIndicesIfNecessary(S,O),E=this.sortIndicesIfNecessary(E,D);let F=b,z=3*C;F=this.addSkirt(z,R,F,P,!0,3,_,g,y,M,I,c,L,r,w,e.skirtHeight),z+=3*P.length,F=this.addSkirt(z,R,F,A,!1,3,_,g,y,M,I,c,L,r,w,e.skirtHeight),z+=3*A.length,F=this.addSkirt(z,R,F,S,!1,3,_,g,y,M,I,c,L,r,w,e.skirtHeight),z+=3*S.length,this.addSkirt(z,R,F,E,!0,3,_,g,y,M,I,c,L,r,w,e.skirtHeight);for(let e=0;e<R.length;e+=3)h.emplaceBack(R[e],R[e+1],R[e+2]),d.emplaceBack(R[e],R[e+1]),d.emplaceBack(R[e+1],R[e+2]),d.emplaceBack(R[e+2],R[e]);return {sphereMaskedBoundsArray:c,sphereIndexArray:h,wireframeIndexArray:d,count:_.length,minimumHeight:v,maximumHeight:x,x:e.x,y:e.y,z:e.z,uBuffer:p.slice(0),vBuffer:f.slice(0),hBuffer:m,indices:T,westIndices:P.slice(0),southIndices:A.slice(0),northIndices:E.slice(0),eastIndices:S.slice(0),rP:w,skirtIndex:T.length,vertexCountWithoutSkirts:C,terrainAnalysisArray:L}}zigZagDecode(e){return e>>1^-(1&e)}zigZagDeltaDecode(e){const t=yi(e.projectionType),i=e.uBuffer.length;let n=0,r=0,o=0;const a=(e.maximumHeight-e.minimumHeight)/this.maxShort,s=e.deltaLng/this.maxShort;for(let l=0;l<i;++l){n+=this.zigZagDecode(e.uBuffer[l]),r+=this.zigZagDecode(e.vBuffer[l]),o+=this.zigZagDecode(e.heightBuffer[l]),e.heightBuffer[l]=o,e.uBuffer[l]=n,e.vBuffer[l]=r,e.position[l]=[e.centerLngLat.lng+(n-this.halfMaxShort)*s,t.yLat(e.y-r/this.maxShort+1,e.worldSize)],e.uv[l]=[n,this.maxShort-r],e.hei[l]=e.minimumHeight+o*a;const i=Nu.cartographicToCartesian3([e.position[l][0],e.position[l][1],e.hei[l]]);e.sphereMaskedBoundsArray.emplaceBack(i[0]-e.rP[0],i[1]-e.rP[1],i[2]-e.rP[2],e.uv[l][0],e.uv[l][1]);}}addSkirt(e,t,i,n,r,o,a,s,l,u,c,h,d,p,f,m){let _,g,y;r?(_=n.length-1,g=-1,y=-1):(_=0,g=n.length,y=1);let x=-1,v=e/o;for(let e=_;e!==g;e+=y){const r=n[e];a[v]=a[r],s[v]=s[r],l[v]=l[r]-m,u[v]=u[r],c[v]=c[r];const o=Nu.cartographicToCartesian3([a[v][0],a[v][1],l[v]]);h.emplaceBack(o[0]-f[0],o[1]-f[1],o[2]-f[2],s[v][0],s[v][1],u[v][0],u[v][1],u[v][2]),d.emplaceBack(c[v][0],c[v][1],c[v][2],l[v]),-1!==x&&(t[i++]=x,t[i++]=v-1,t[i++]=r,t[i++]=v-1,t[i++]=v,t[i++]=r),x=r,++v;}return i}sortIndicesIfNecessary(e,t){const i=[];i.length=e.length;let n=!1;for(let r=0,o=e.length;r<o;++r)i[r]=e[r],n=n||r>0&&t(e[r-1],e[r])>0;return n?(i.sort(t),new Uint16Array(i)):e}upsampleQuantizedTerrainMesh(e){const t=e.isEastChild,i=e.isNorthChild,n=t?this.halfMaxShort:0,r=t?this.maxShort:this.halfMaxShort,o=i?this.halfMaxShort:0,a=i?this.maxShort:this.halfMaxShort,s=[],l=[],u=[],c=[],h={},d=e.indices;let p=0;const f=e.vertexCountWithoutSkirts,m=e.minimumHeight,_=e.maximumHeight,g=new Array(f),y=new Array(f),x=new Array(f),v=e.uBuffer,w=e.vBuffer,T=e.hBuffer;let b,P,S,E,A;const C=[],M=[];for(b=0,P=0;b<f;++b,P+=2)S=v[b],E=w[b],S<20&&(S=0),E<20&&(E=0),this.maxShort-S<20&&(S=this.maxShort),this.maxShort-E<20&&(E=this.maxShort),g[b]=S,y[b]=E,x[b]=T[b],(t&&S>=this.halfMaxShort||!t&&S<=this.halfMaxShort)&&(i&&E>=this.halfMaxShort||!i&&E<=this.halfMaxShort)&&(h[b]=p,s.push(S),l.push(E),u.push(x[b]),++p);const I=[];I.push(new _P),I.push(new _P),I.push(new _P);const L=[];L.push(new _P),L.push(new _P),L.push(new _P);const N=[];let R,O;for(N.push(new _P),N.push(new _P),N.push(new _P),N.push(new _P),b=0;b<d.length;b+=3){const e=d[b],n=d[b+1],r=d[b+2],o=g[e],a=g[n],p=g[r];I[0].initializeIndexed(g,y,x,null,e),I[1].initializeIndexed(g,y,x,null,n),I[2].initializeIndexed(g,y,x,null,r);const f=gP.clipTriangleAtAxisAlignedThreshold(this.halfMaxShort,t,o,a,p,M);R=0,R>=f.length||(R=L[0].initializeFromClipResult(f,R,I),R>=f.length||(R=L[1].initializeFromClipResult(f,R,I),R>=f.length||(R=L[2].initializeFromClipResult(f,R,I),O=gP.clipTriangleAtAxisAlignedThreshold(this.halfMaxShort,i,L[0].getV(),L[1].getV(),L[2].getV(),C),this.addClippedPolygon(s,l,u,c,h,O,L,N),R<f.length&&(L[2].clone(L[1]),L[2].initializeFromClipResult(f,R,I),O=gP.clipTriangleAtAxisAlignedThreshold(this.halfMaxShort,i,L[0].getV(),L[1].getV(),L[2].getV(),C),this.addClippedPolygon(s,l,u,c,h,O,L,N)))));}const D=t?-this.maxShort:0,F=i?-this.maxShort:0,z=[],B=[],V=[],k=[];let U=Number.MAX_VALUE,G=-U;for(b=0;b<s.length;++b)S=Math.round(s[b]),S<=n?(z.push(b),S=0):S>=r?(V.push(b),S=this.maxShort):S=2*S+D,s[b]=S,E=Math.round(l[b]),E<=o?(B.push(b),E=0):E>=a?(k.push(b),E=this.maxShort):E=2*E+F,l[b]=E,A=Ol(m,_,u[b]/this.maxShort),A<U&&(U=A),A>G&&(G=A),u[b]=A;const H=G-U;for(b=0;b<u.length;++b)u[b]=this.maxShort*(u[b]-U)/H;return {minimumHeight:U,maximumHeight:G,westIndices:z,southIndices:B,eastIndices:V,northIndices:k,indices:c,uBuffer:s,vBuffer:l,heightBuffer:u,vertexCount:s.length,x:e.x,y:e.y,z:e.z,rP:e.rP,projectionType:e.projectionType}}zigZagUpsampleDeltaDecode(e){const t=yi(e.projectionType),i=e.uBuffer.length;let n=0,r=0,o=0;const a=(e.maximumHeight-e.minimumHeight)/this.maxShort,s=e.deltaLng/this.maxShort;for(let l=0;l<i;++l){n=e.uBuffer[l],r=e.vBuffer[l],o=e.heightBuffer[l],e.position[l]=[e.centerLngLat.lng+(n-this.halfMaxShort)*s,t.yLat(e.y-r/this.maxShort+1,e.worldSize)],e.uv[l]=[n,this.maxShort-r],e.hei[l]=e.minimumHeight+o*a;const i=Nu.cartographicToCartesian3([e.position[l][0],e.position[l][1],e.hei[l]]);e.sphereMaskedBoundsArray.emplaceBack(i[0]-e.rP[0],i[1]-e.rP[1],i[2]-e.rP[2],e.uv[l][0],e.uv[l][1]);}}addClippedPolygon(e,t,i,n,r,o,a,s){if(0===o.length)return;let l=0,u=0;for(;u<o.length;)u=s[l++].initializeFromClipResult(o,u,a);for(let n=0;n<l;++n){const o=s[n];if(o.isIndexed())o.newIndex=r[o.index],o.uBuffer=e,o.vBuffer=t,o.heightBuffer=i;else {const n=o.getKey();if(null!=r[n])o.newIndex=r[n];else {const a=e.length;e.push(o.getU()),t.push(o.getV()),i.push(o.getH()),o.newIndex=a,r[n]=a;}}}3===l?(n.push(s[0].newIndex),n.push(s[1].newIndex),n.push(s[2].newIndex)):4===l&&(n.push(s[0].newIndex),n.push(s[1].newIndex),n.push(s[2].newIndex),n.push(s[0].newIndex),n.push(s[2].newIndex),n.push(s[3].newIndex));}computeNormal(e,t,i,n,r,o){const a=e.float32,s=new _t,l=new _t,u=new _t,c=new _t,h=new Array(n),d=new Array(r/3),p=new Array(r);let f;for(f=0;f<n;f++)h[f]={indexOffset:0,count:0,currentCount:0};let m=0;for(f=0;f<r;f+=3){const e=t[f],i=t[f+1],n=t[f+2],r=5*e,o=5*i,s=5*n;l.x=a[r],l.y=a[r+1],l.z=a[r+2],u.x=a[o],u.y=a[o+1],u.z=a[o+2],c.x=a[s],c.y=a[s+1],c.z=a[s+2],h[e].count++,h[i].count++,h[n].count++,_t.subtract(u,l,u),_t.subtract(c,l,c);const p=_t.cross(u,c,new _t),_=p.len()/2;d[m]=p.multiplyScalar(_),m++;}let _,g=0;for(f=0;f<n;f++)h[f].indexOffset+=g,g+=h[f].count;for(m=0,f=0;f<r;f+=3){_=h[t[f]];let e=_.indexOffset+_.currentCount;p[e]=m,_.currentCount++,_=h[t[f+1]],e=_.indexOffset+_.currentCount,p[e]=m,_.currentCount++,_=h[t[f+2]],e=_.indexOffset+_.currentCount,p[e]=m,_.currentCount++,m++;}const y=new ra;for(f=0;f<n;f++){const e=5*f;if(_=h[f],_t.clone(_t.ZERO,s),_.count>0){for(m=0;m<_.count;m++)_t.add(s,d[p[_.indexOffset+m]],s);_t.equalsEpsilon(_t.ZERO,s,ot.CesiumMath.EPSILON10)&&_t.clone(d[p[_.indexOffset]],s);}_t.equalsEpsilon(_t.ZERO,s,ot.CesiumMath.EPSILON10)&&(s.z=1),_t.normalize(s,s),y.emplaceBack(a[e],a[e+1],a[e+2],a[e+3],a[e+4],s.x,s.y,s.z),o[f]=[s.x,s.y,s.z];}return y}genTerrainAnalysisArray(e,t,i,n,r){const o=e.float32,a=new Ua;let s;for(s=0;s<i;s++){const e=8*s,i=new _t(o[e]+t[0],o[e+1]+t[1],o[e+2]+t[2]),l=Nu.DefaultEllipsoid.geodeticSurfaceNormal(i,new _t);a.emplaceBack(l.x,l.y,l.z,r[s]),n[s]=[l.x,l.y,l.z];}return a}static genShaderScript(e){let t,i;return "slope"===e.property?(t="\nattribute vec3 a_NORMAL;\nattribute vec3 a_GEODETIC_NORMAL;\nvarying float v_slope;\n\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n\nvoid main(void) {\n\n\t// 计算gl_Position\n\tgl_Position = u_ModelViewProjectionMatrix * vec4(a_POSITION, 1.0);\n\t// 获取坡度\n\tv_slope = degrees(acos(dot(a_NORMAL, a_GEODETIC_NORMAL)));\n}\n\t\t\t",i="\nvarying float v_slope;\n\n#include <fn_getExponentialInterpColor>\n\nvoid main(void) {\n\t\t\t",i+=yP(e,!1),i+="\n\tgl_FragColor = color;\n}\n\t\t\t"):"aspect"===e.property?(t="\nattribute vec3 a_NORMAL;\nattribute vec3 a_GEODETIC_NORMAL;\nvarying float v_dot_product;\nvarying float v_determ;\n\n#include <c_define>\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n\nvoid main(void) {\n\n\t// 计算gl_Position\n\tgl_Position = u_ModelViewProjectionMatrix * vec4(a_POSITION, 1.0);\n\t// 计算法线在椭球切面的投影\n\tvec3 projection = normalize(a_NORMAL - dot(a_NORMAL, a_GEODETIC_NORMAL) * a_GEODETIC_NORMAL);\n\t// 计算enu坐标系的东方向\n\tvec3 east = normalize(cross(vec3(0.0, 0.0, 1.0), a_GEODETIC_NORMAL));\n\tv_dot_product = dot(projection, east);\n\t// 判断东方向和法线在椭球切面的投影构成的切面是向球心还是远离球心的\n    v_determ = dot(cross(projection, east), a_GEODETIC_NORMAL);\n}\n\t\t\t",i="\nvarying float v_dot_product;\nvarying float v_determ;\n\n#include <fn_getExponentialInterpColor>\n#include <fn_branchFreeTernary>\n\nvoid main(void) {\n\t// 计算夹角\n    float v_aspect = degrees(acos(v_dot_product));\n    v_aspect = branchFreeTernary(v_determ < 0.0, 360.0 - v_aspect, v_aspect);\n    // 将以东方向基准改为以北方向为基准\n    v_aspect += 90.0;\n    v_aspect = branchFreeTernary(v_aspect < 360.0, v_aspect, v_aspect - 360.0);\n\t\t\t",i+=yP(e,!1),i+="\n\tgl_FragColor = color;\n}\n\t\t\t"):"elevation_band"===e.property?(t="\nattribute float a_ELEVATION;\nvarying float v_elevation_band;\n\n#include <c_define>\n#include <a_POSITION3>\n#include <u_ModelViewProjectionMatrix>\n#include <fn_branchFreeTernary>\n\nvoid main(void) {\n\n\t// 计算gl_Position\n\tgl_Position = u_ModelViewProjectionMatrix * vec4(a_POSITION, 1.0);\n\n    v_elevation_band = a_ELEVATION;\n}\n\t\t\t",i="\nvarying float v_elevation_band;\n\n#include <fn_getExponentialInterpColor>\n\nvoid main(void) {\n\t\t\t",i+=yP(e,!1),i+="\n\tgl_FragColor = color;\n}\n\t\t\t"):console.error(`Unknown terrain analysis type ${e.property}`),{vs:t,fs:i}}},e.Texture=Ih,e.TextureMagnificationFilter=Xc,e.TextureMinificationFilter=jc,e.TextureWrap=Zc,e.TileDebugJSONRenderState=g_,e.Transforms=Nu,e.V34Pos2V4PosUtil=zl,e.ValidationError=Qy,e.Vector=lt,e.Vector2=Ot,e.Vector3=_t,e.Vector4=St,e.VectorCircleMaterial=class extends W_{constructor(e){super(e),this.isVectorMaterial=!0,this.layer=e.layer,this.tile=e.tile,this.plotter=e.plotter,this._programConfiguration=e.programConfiguration,this._renderState=e.renderState,this._createUniforms(e.painter);}update(e,t,i={}){super.update(e,t,i);}_createUniforms(e){this._uniforms.set("u_GlUnitsToPixels",(()=>(AP.set(e.style.symbolMatrixHelper.width/2,e.style.symbolMatrixHelper.height/2),AP))),this._uniforms.set("u_PixelMatrix",(()=>(EP.identity(),EP.scale([1,Math.cos(e.transform.hpr.pitch)]),EP.rotate(-e.transform.hpr.heading),EP)));}destroy(){this.layer=void 0,this.tile=void 0,this.pattern=void 0,this.plotter=void 0,this.type=void 0,this._uniforms=void 0,this._textures=void 0,this._program=void 0,this._programConfiguration=void 0,this._renderState=void 0,this._pixelMatrix=void 0;}},e.VectorExtrusionMaterial=class extends W_{constructor(e){super(e),this.isVectorMaterial=!1,this.layer=e.layer,this.tile=e.tile,this._programConfiguration=e.programConfiguration,this._renderState=e.renderState,this._pattern=this.layer.paint.get("extrusion-pattern"),this._topPattern=this.layer.paint.get("extrusion-top-pattern"),this.type=this.getProgramType(e.painter.style),this._error=null,this.animationsInfo=e.animationsInfo||{},this.bloomingParams=this.layer.paint.get("extrusion-self-bloom")?{selfBloom:this.layer.paint.get("extrusion-self-bloom"),bloomHeight:this.layer.paint.get("extrusion-bloom-height"),bloomSpeed:this.layer.paint.get("extrusion-glow-speed"),glowPureColorHeight:this.layer.paint.get("extrusion-glow-pure-color-height"),glowWidth:this.layer.paint.get("extrusion-glow-width")}:null,this._offset=$(this.layer.paint.get("extrusion-offset"))?this.layer.paint.get("extrusion-offset").value.value:[0,0],this._rotation=$(this.layer.paint.get("extrusion-rotation"))?this.layer.paint.get("extrusion-rotation").value.value:0,this._scale=$(this.layer.paint.get("extrusion-scale"))?this.layer.paint.get("extrusion-scale").value.value:1,this._createUniforms(e.painter);}update(e,t,i){super.update(e,t,i),this._updateDefines(),this.updateRenderState(i),this.updatePattern(e),this.updateBlooming(e),this._updateAnimationUniforms(e,t,i);}getProgramType(e){return this._hasPattern(e)||this.hasTopPattern(e)?"sphereExtrusionPattern":"sphereExtrusion"}updatePattern(e){const t=this.layer.paint.get("extrusion-pattern"),i=this.layer.paint.get("extrusion-top-pattern");let n=!1,r=!1;const o=this._pattern.constantOr(null),a=t.constantOr(null),s=this._topPattern.constantOr(null),l=i.constantOr(null);n=t?!o||a.from!==o.from||a.to!==o.to:!!this._pattern,r=i?!s||l.from!==s.from||l.to!==s.to:!!this._topPattern,(n||r)&&(this._pattern=t,this._topPattern=i,this.createPatternUniforms(e),this.type=this.getProgramType(e.style));}updateBlooming(e){let t=!1,i=null;this.layer.paint.get("extrusion-self-bloom")&&(i={selfBloom:this.layer.paint.get("extrusion-self-bloom"),bloomHeight:this.layer.paint.get("extrusion-bloom-height"),bloomSpeed:this.layer.paint.get("extrusion-glow-speed"),glowPureColorHeight:this.layer.paint.get("extrusion-glow-pure-color-height"),glowWidth:this.layer.paint.get("extrusion-glow-width")},this.bloomingParams.bloomHeight===i.bloomHeight&&this.bloomingParams.bloomSpeed===i.bloomSpeed&&this.bloomingParams.glowPureColorHeight===i.glowPureColorHeight&&this.bloomingParams.glowWidth===i.glowWidth||(t=!0)),t&&(this.bloomingParams=i,this.createBloomingUniforms(e));}static logDifferenceUniform(){}static tryDiffkeys(e,t){const i=t;for(let t=0;t<i.length;t++)e.pushMinimumUniform(i[t]);}_createUniforms(e){this.createCommonUniforms(e),this.createPatternUniforms(e),this.createBloomingUniforms(e);}createPatternUniforms(e){this._topPattern&&PP(this._topPattern,e);const t=new Lp(e.style.getNearestTileZoom()).getCrossfadeParameters(),i=Math.pow(2,this.tile.tileID.overscaledZ),n=this.tile.tileSize*Math.pow(2,e.transform.tileZoom)/i,r=n*(this.tile.tileID.canonical.x+this.tile.tileID.wrap*i),o=n*this.tile.tileID.canonical.y;if(this._hasPattern(e.style)){const i=this._pattern.constantOr(1),n=this._pattern.constantOr(null);if(n&&this.tile.imageAtlas){const e=this.tile.imageAtlas,t=e.patternPositions[n.to.toString()],i=e.patternPositions[n.from.toString()];t&&i&&this._programConfiguration.setConstantPatternPositions(t,i);}if(i){const i=e.context.gl;e.context.activeTexture.set(i.TEXTURE0),this.tile.imageAtlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this._programConfiguration.updatePaintBuffers(t);}this._uniforms.set("u_offset",(()=>new Ot(this._offset[0],this._offset[1]))),this._uniforms.set("u_rotation",(()=>this._rotation*Math.PI/180)),this._uniforms.set("u_scale",(()=>this._scale)),this._uniforms.set("u_BaseColorSampler",(()=>this.tile.imageAtlasTexture)),this._uniforms.set("u_RenderBodyTex",(()=>{const t=this._pattern.constantOr(null);return !(t&&PP(t,e)||!this._pattern)}));}if(this.hasTopPattern(e.style)){this._uniforms.set("u_top_pattern_size_a",(()=>new Ot(this.tile.imageAtlasTexture.size[0],this.tile.imageAtlasTexture.size[1]))),this._uniforms.set("u_top_pattern_size_b",(()=>new Ot(this.tile.imageAtlasTexture.size[0],this.tile.imageAtlasTexture.size[1])));const i=this._topPattern.constantOr(1),n=this._topPattern.constantOr(null);if(n&&this.tile.imageAtlas){const e=this.tile.imageAtlas,t=e.patternPositions[n.to.toString()],i=e.patternPositions[n.from.toString()];t&&i&&this._programConfiguration.setConstantPatternPositions(t,i,!0);}if(i){const i=e.context.gl;e.context.activeTexture.set(i.TEXTURE1),this.tile.imageAtlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this._programConfiguration.updatePaintBuffers(t,!0);}this._uniforms.set("u_TopTexture",(()=>this.tile.imageAtlasTexture)),this._uniforms.set("u_RenderTopTex",(()=>{const t=this._topPattern.constantOr(null);return !(t&&PP(t,e)||!this._topPattern)}));}else this._uniforms.set("u_RenderTopTex",(()=>!1));this._uniforms.set("u_Opacity",(()=>1)),this._uniforms.set("u_texsize",(()=>new Ot(this.tile.imageAtlasTexture.size[0],this.tile.imageAtlasTexture.size[1]))),this._uniforms.set("u_mix",(()=>t.t)),this._uniforms.set("u_scale_a",(()=>t.fromScale)),this._uniforms.set("u_scale_b",(()=>t.toScale)),this._uniforms.set("u_Zoom",(()=>e.style.getNearestTileZoom())),this._uniforms.set("u_tile_units_to_pixels",(()=>1/hg(this.tile,1,e.style.getNearestTileZoom()))),this._uniforms.set("u_pixel_coord_upper",(()=>new Ot(r>>16,o>>16))),this._uniforms.set("u_pixel_coord_lower",(()=>new Ot(65535&r,65535&o)));}createCommonUniforms(e){Yx.setPhongLightUniform({material:this,phongLightConfig:this.layer.phongLightConfig}),this._uniforms.set("u_lightPos",(()=>(_t.clone(LP,NP),IP.identity(),IP.rotate(e.transform.hpr.heading,IP),NP.transformByMatrix3(IP)))),this._uniforms.set("u_Reflectivity",(()=>1)),this._uniforms.set("u_Shininess",(()=>30)),this._uniforms.set("u_Roughness",(()=>this.layer.paint.get("extrusion-roughness")));}createBloomingUniforms(e){if(this.bloomingParams&&this.bloomingParams.selfBloom){if(this.bloomingParams.height<=0)throw new Error("extrusion-bloom-height cannot be less than zero");if(this.bloomingParams.speed<=0)throw new Error("extrusion-glow-fps cannot be less than zero");this._uniforms.set("u_Time",(()=>e._map.timer.counter)),this._uniforms.set("u_BloomHeight",(()=>this.bloomingParams.bloomHeight)),this._uniforms.set("u_BloomSpeed",(()=>1/this.bloomingParams.bloomSpeed*this.bloomingParams.bloomHeight)),this._uniforms.set("u_SelfBloom",(()=>this.bloomingParams.selfBloom)),this._uniforms.set("u_PureColorHeight",(()=>this.bloomingParams.glowPureColorHeight)),this._uniforms.set("u_GlowWidth",(()=>this.bloomingParams.glowWidth));}}_updateAnimationUniforms(e,t,i){const{animationsInfo:n={}}=i;this._uniforms.set("u_ANS_CurrentTime",(()=>n.currentClipTime)),this.pushMinimumUniform("u_ANS_CurrentTime"),this.layer.clippingPlanes&&this.layer.clippingPlanes.enabled&&0!==this.layer.clippingPlanes.length&&(this.layer.clippingPlanes.update(e,t),this._uniforms.set("u_model_clippingPlanesEdgeStyle",(()=>(MP.set(this.layer.clippingPlanes.edgeColor.r,this.layer.clippingPlanes.edgeColor.g,this.layer.clippingPlanes.edgeColor.b,this.layer.clippingPlanes.edgeWidth),MP))),this.pushMinimumUniform("u_model_clippingPlanesEdgeStyle"),this._uniforms.set("u_model_clippingPlanes",(()=>this.layer.clippingPlanes.texture)),this.pushMinimumUniform("u_model_clippingPlanes"),this._uniforms.set("u_model_clippingPlanesMatrix",(()=>{const e=Bt.multiply(CP,t.camera.matrixWorldInverse,this.layer.clippingPlanes.modelMatrix);return Bt.inverseTranspose(e,e),e})),this.pushMinimumUniform("u_model_clippingPlanesMatrix"));}updateRenderState(e){const{renderStateTag:t,stencilTest:i,enableColorMask:n}=e;"first"===t?this.renderState={depthMask:__.enableDepthMask,depthTest:__.enableDepthTestWithLEQUAL,stencilMask:__.disableStencilMask,stencilTest:__.disableStencilTest,colorMask:n?__.enableColorMask:__.disabledColorMask}:"second"===t&&(this.renderState={depthMask:__.enableDepthMask,depthTest:__.enableDepthTestWithLEQUAL,stencilMask:__.enableStencilMask,stencilTest:i,colorMask:__.enableColorMask,blending:__.enableBlending});}_updateDefines(){const e={};if(this.layer.clippingPlanes&&this.layer.clippingPlanes.enabled&&0!==this.layer.clippingPlanes.length){e.HAS_CLIPPING_PLANES=!0,e.USE_CLIPPING_PLANES_FLOAT_TEXTURE=!!this.layer.clippingPlanes._useFloatTexture;const t=Zy.getTextureResolution(this.layer.clippingPlanes);e.CLIPPING_PLANES_LENGTH=this.layer.clippingPlanes.length,e.CLIPPING_PLANES_TEXTURE_WIDTH=t.x,e.CLIPPING_PLANES_TEXTURE_HEIGHT=t.y,e.UNION_CLIPPING_REGIONS=!!this.layer.clippingPlanes._unionClippingRegions;}else e.HAS_CLIPPING_PLANES=!1,e.CLIPPING_PLANES_LENGTH=0,e.CLIPPING_PLANES_TEXTURE_WIDTH=1,e.CLIPPING_PLANES_TEXTURE_HEIGHT=1;this.defines=e;}_hasPattern(e){if(this.layer.paint.get("extrusion-pattern")){const t=this.layer.paint.get("extrusion-pattern").constantOr(null);if(t)return !!e.getImage(t.from);if(!this.layer.paint.get("extrusion-pattern").isConstant())return !0}return !1}hasTopPattern(e){if(this.layer.paint.get("extrusion-top-pattern")){const t=this.layer.paint.get("extrusion-top-pattern").constantOr(null);if(t)return !!e.getImage(t.from);if(!this.layer.paint.get("extrusion-top-pattern").isConstant())return !0}return !1}destroy(){this.layer=void 0,this.tile=void 0,this.plotter=void 0,this.type=void 0,this._uniforms=void 0,this._textures=void 0,this._program=void 0,this.defines=void 0,this._programConfiguration=void 0,this._renderState=void 0,this._pattern=void 0,this._topPattern=void 0,this.bloomingParams=void 0;}},e.VectorFillMaterial=class extends W_{constructor(e){super(e),this.layer=e.layer,this.tile=e.tile,this.coord=e.tile.tileID,this.pattern=this.layer.paint.get("fill-pattern"),this.programId=e.programId,this._programConfiguration=e.programConfiguration,this._renderState=e.renderState,this._isShadowVolumeMaterial=e.shadowVolumeMaterial||!1;const t=e.painter,i=this.layer.paint.get("fill-water");this._isWater="water"===i;const n=this.layer.paint.get("fill-water-texture");this._texture=0!==n.length?this.getTextureUseUrl(t.textureResourceManager,{map:t._map,texUrl:n}):null,this._isWater=this._isWater&&this._texture;const r=this.layer.paint.get("sunlight-color");this._sunlightColor=new _t(r.r,r.g,r.b),this._sunlightDirection=new _t(this.layer.paint.get("sunlight-direction")),this._waveSize=1/this.layer.paint.get("fill-water-wave-size"),this._waveSpeed=this.layer.paint.get("fill-water-speed");const o=this.layer.paint.get("fill-color").value.value,a=this.layer.paint.get("sky-color");this._skyColor=new _t(a.r,a.g,a.b),this._waterColor=$(o)&&$(o.r)?new _t(o.r,o.g,o.b):new _t(0,0,.5),this._alpha=this.layer.paint.get("fill-opacity").value.value,this._offset=$(this.layer.paint.get("fill-translate"))?this.layer.paint.get("fill-translate").value.value:[0,0],this._rotation=$(this.layer.paint.get("fill-rotation"))?this.layer.paint.get("fill-rotation").value.value:0,this._scale=$(this.layer.paint.get("fill-scale"))?this.layer.paint.get("fill-scale").value.value:1,this.type=this.getProgramTypeAndCreateUniforms(t),this._isWater&&this.createUniforms(t);}getTextureUseUrl(e,t){const i=e.getTextureByName(t.texUrl);if(i)return i;const n=new Ih(t);return t.texUrl&&n.load(t.texUrl),e.addTexture(t.texUrl,n),n}createUniforms(e){this._uniforms.set("u_Color",(()=>this._waterColor)),this._uniforms.set("u_SkyColor",(()=>this._skyColor)),this._uniforms.set("u_Opacity",(()=>this._alpha)),this._uniforms.set("u_Time",(()=>(this._time=e._map.time*this._waveSpeed,this._time))),this._uniforms.set("u_BaseColorSampler",(()=>(this._texture.sampler={minificationFilter:Du.LINEAR_MIPMAP_LINEAR,magnificationFilter:Du.LINEAR,wrapS:Du.REPEAT,wrapT:Du.REPEAT},this._texture))),this.pushMinimumUniform("u_BaseColorSampler"),this._uniforms.set("u_DistortionScale",(()=>3.7)),this._uniforms.set("u_SunColor",(()=>this._sunlightColor)),this._uniforms.set("u_SunDirection",(()=>this._sunlightDirection)),this._uniforms.set("u_IsWater",(()=>this._isWater)),this._uniforms.set("u_WaveSize",(()=>this._waveSize));}update(e,t,i={}){super.update(e,t,i);const n=this.layer.paint.get("fill-pattern");let r=!1;const o=this.pattern.constantOr(null),a=n.constantOr(null);r=n?!o||a.from!==o.from||a.to!==o.to:!!this.pattern,r&&(this.pattern=n,this.type=this.getProgramTypeAndCreateUniforms(e)),!this._isShadowVolumeMaterial&&e.tileClippingMask.status&&(this._renderState.stencilTest={enabled:!0,frontFunction:Du.NOTEQUAL,backFunction:Du.NOTEQUAL,reference:e.tileClippingMask.vectorLayerStencilID,mask:255,frontOperation:{fail:Du.KEEP,zFail:Du.KEEP,zPass:Du.REPLACE},backOperation:{fail:Du.KEEP,zFail:Du.KEEP,zPass:Du.REPLACE}},this._renderState.stencilMask=255);}destroy(){this.layer=void 0,this.tile=void 0,this.coord=void 0,this.pattern=void 0,this.programId=void 0,this.type=void 0,this._uniforms=void 0,this._textures=void 0,this._program=void 0,this._programConfiguration=void 0,this._renderState=void 0;}hasPattern(){const e=this.pattern;let t=!1;return e.isConstant()||(t=!0),e.constantOr(null)&&(t=!0),t}getProgramTypeAndCreateUniforms(e){if(this._isWater)return "WaterMaterial";let t="sphereFill";if(this.hasPattern()){t="sphereFillPattern";const i=new Lp(e.style.getNearestTileZoom()).getCrossfadeParameters(),n=this.pattern.constantOr(1),r=this.pattern.constantOr(null);if(r&&this.tile.imageAtlas){const e=this.tile.imageAtlas,t=e.patternPositions[r.to.toString()],i=e.patternPositions[r.from.toString()];t&&i&&this._programConfiguration.setConstantPatternPositions(t,i);}if(n){const t=e.context,n=t.gl;e.context.activeTexture.set(n.TEXTURE0),this.tile.imageAtlasUpload(t),this.tile.imageAtlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this._programConfiguration.updatePaintBuffers(i);}const o=Math.pow(2,this.tile.tileID.overscaledZ),a=this.tile.tileSize*Math.pow(2,e.style.symbolMatrixHelper.cameraHeightConvertedZoom)/o,s=a*(this.tile.tileID.canonical.x+this.tile.tileID.wrap*o),l=a*this.tile.tileID.canonical.y;this._uniforms.set("u_BaseColorSampler",(()=>this.tile.imageAtlasTexture)),this._uniforms.set("u_Opacity",(()=>this._alpha)),this._uniforms.set("u_texsize",(()=>new Ot(this.tile.imageAtlasTexture.size[0],this.tile.imageAtlasTexture.size[1]))),this._uniforms.set("u_mix",(()=>i.t)),this._uniforms.set("u_scale_a",(()=>i.fromScale)),this._uniforms.set("u_scale_b",(()=>i.toScale)),this._uniforms.set("u_Zoom",(()=>e.style.getNearestTileZoom())),this._uniforms.set("u_TileZoomFactor",(()=>Math.pow(2,Math.round(e.style.getNearestTileZoom()-this.coord.canonical.z)))),this._uniforms.set("u_tile_units_to_pixels",(()=>1/hg(this.tile,1,e.style.getNearestTileZoom()))),this._uniforms.set("u_pixel_coord_upper",(()=>new Ot(s>>16,l>>16))),this._uniforms.set("u_pixel_coord_lower",(()=>new Ot(65535&s,65535&l))),this._uniforms.set("u_offset",(()=>new Ot(this._offset[0],this._offset[1]))),this._uniforms.set("u_rotation",(()=>this._rotation*Math.PI/180)),this._uniforms.set("u_scale",(()=>this._scale)),this._uniforms.set("u_HasTexture",(()=>{const t=this.pattern.constantOr(null);return !(t&&PP(t,e)||!this.pattern)}));}return this._uniforms.set("u_PixelMatrix",(()=>(RP.identity(),RP.scale([1,Math.cos(e.transform.hpr.pitch)]),RP.rotate(-e.transform.hpr.heading),RP))),t}},e.VectorLayerType=Dg,e.VectorLineMaterial=class extends W_{constructor(e){super(e),this.layer=e.layer,this.tile=e.tile,this.coord=e.tile.tileID,this.isBorder=e.isBorder,this.sourceMaxZoom=e.sourceMaxZoom,this.bucket=e.bucket,this.lineGradient=e.lineGradient||void 0,this._programConfiguration=e.programConfiguration,this._renderState=e.renderState,this._isShadowVolumeMaterial=e.shadowVolumeMaterial||!1,this.dasharray=this.layer.paint.get("line-dasharray"),this.tileRatio=void 0,this.posA=void 0,this.posB=void 0,this.widthA=void 0,this.widthB=void 0,this.crossfade=void 0,this.imagePosA=void 0,this.imagePosB=void 0,this.image=void 0,this.gradientTexture=void 0,this._createUniforms(e.painter);}update(e,t,i={}){super.update(e,t,i);const n=this.layer.paint.get("line-dasharray")?"sphereLineSDF":this._hasPattern(e.style)?"sphereLinePattern":this.layer.paint.get("line-gradient")?"sphereLineGradient":"sphereLine";this.type=n,this.updateDynamicProperty(e),this._updateOrCreateDynamicUniforms(e),this._createDashOrImageUniforms(e),!this._isShadowVolumeMaterial&&e.tileClippingMask.status&&(this._renderState.stencilTest={enabled:!0,frontFunction:Du.NOTEQUAL,backFunction:Du.NOTEQUAL,reference:this.isBorder?e.tileClippingMask.requestedVectorLayerIDs[0]:e.tileClippingMask.requestedVectorLayerIDs[1],mask:255,frontOperation:{fail:Du.KEEP,zFail:Du.KEEP,zPass:Du.REPLACE},backOperation:{fail:Du.KEEP,zFail:Du.KEEP,zPass:Du.REPLACE}},this._renderState.stencilMask=255);}_hasPattern(e){if(this.layer.paint.get("line-pattern")){const t=this.layer.paint.get("line-pattern").constantOr(null);if(t)return !!e.getImage(t.from);if(!this.layer.paint.get("line-pattern").isConstant())return !0}return !1}destroy(){this.layer=void 0,this.tile=void 0,this.coord=void 0,this.drawLine=void 0,this.type=void 0,this._uniforms=void 0,this._textures=void 0,this._program=void 0,this.isBorder=void 0,this.sourceMaxZoom=void 0,this.bucket=void 0,this.lineGradient=void 0,this._programConfiguration=void 0,this.dasharray=void 0,this.tileRatio=void 0,this.posA=void 0,this.posB=void 0,this.widthA=void 0,this.widthB=void 0,this.crossfade=void 0,this.imagePosA=void 0,this.imagePosB=void 0,this.image=void 0,this.gradientTexture=void 0;}_createUniforms(e){this.updateDynamicProperty(e),this._uniforms.set("u_GlUnitsToPixels",(()=>(VP.set(e.style.symbolMatrixHelper.width/2,-e.style.symbolMatrixHelper.height/2),VP))),this._uniforms.set("u_Ratio",(()=>1/hg(this.tile,1,e.style.getNearestTileZoom()))),this.pushMinimumUniform("u_Ratio"),this._uniforms.set("u_HalfRender",(()=>this.layer.paint.get("half-render"))),this._uniforms.set("u_HasBorder",(()=>this.isBorder)),this.pushMinimumUniform("u_HasBorder"),this._uniforms.set("u_PixelMatrix",(()=>(kP.identity(),kP.scale([1,Math.cos(e.transform.hpr.pitch)]),kP.rotate(-e.transform.hpr.heading),kP))),this._updateOrCreateDynamicUniforms(e),this._createDashOrImageUniforms(e);}_updateOrCreateDynamicUniforms(e){this.lineGradient&&(this.gradientTexture=this._parseLineGradient(e),this._uniforms.set("u_BaseColorSampler",(()=>(this.gradientTexture.bind(this.layer.stepInterpolate?Du.NEAREST:Du.LINEAR,Du.CLAMP_TO_EDGE),this.gradientTexture))),this.pushMinimumUniform("u_BaseColorSampler"),this._uniforms.set("u_image_height",(()=>this.bucket.lineClipsArray.length)),this.pushMinimumUniform("u_image_height"));}_parseLineGradient(e){const t=this.bucket.gradients[this.layer.id];let i=t.texture;if(this.layer.gradientVersion!==t.version){let n=256;if(this.layer.stepInterpolate){const t=this.coord.canonical.z===this.sourceMaxZoom?Math.ceil(1<<e.transform.maxZoom-this.coord.canonical.z):1;n=ze(He(this.bucket.maxLineLength/Wh*1024*t),256,e.context.maxTextureSize);}t.gradient=bT({expression:this.layer.gradientExpression(),evaluationKey:"lineProgress",resolution:n,image:t.gradient||void 0,clips:this.bucket.lineClipsArray}),t.texture?t.texture.update(t.gradient):t.texture=new Ih({context:e.context,image:t.gradient,pixelFormat:ih.RGBA}),t.version=this.layer.gradientVersion,i=t.texture;}return i}_createDashOrImageUniforms(e){this.dasharray?(this._uniforms.set("u_patternscale_a",(()=>(UP.set(this.tileRatio/this.widthA,-this.posA.height/2),UP))),this.pushMinimumUniform("u_patternscale_a"),this._uniforms.set("u_patternscale_b",(()=>(GP.set(this.tileRatio/this.widthB,-this.posB.height/2),GP))),this.pushMinimumUniform("u_patternscale_b"),this._uniforms.set("u_sdfgamma",(()=>e.lineAtlas.width/(256*Math.min(this.widthA,this.widthB)*Kh.devicePixelRatio)/2)),this.pushMinimumUniform("u_sdfgamma"),this._uniforms.set("u_BaseColorSampler",(()=>(e.lineAtlas.bind(e.context),e.lineAtlas))),this.pushMinimumUniform("u_BaseColorSampler"),this._uniforms.set("u_tex_y_a",(()=>this.posA.y)),this.pushMinimumUniform("u_tex_y_a"),this._uniforms.set("u_tex_y_b",(()=>this.posB.y)),this.pushMinimumUniform("u_tex_y_b"),this._uniforms.set("u_mix",(()=>this.crossfade.t)),this.pushMinimumUniform("u_mix")):this._hasPattern(e.style)&&(this._uniforms.set("u_texsize",(()=>new Ot(this.tile.imageAtlasTexture.size[0],this.tile.imageAtlasTexture.size[1]))),this.pushMinimumUniform("u_texsize"),this._uniforms.set("u_BaseColorSampler",(()=>this.tile.imageAtlasTexture)),this.pushMinimumUniform("u_BaseColorSampler"),this._uniforms.set("u_fade",(()=>this.crossfade.t)),this.pushMinimumUniform("u_fade"),this._uniforms.set("u_scale",(()=>new _t(this.tileRatio,this.crossfade.fromScale,this.crossfade.toScale))),this.pushMinimumUniform("u_scale"));}updateDynamicProperty(e){const t=this.layer.paint.get("line-pattern"),i=t.constantOr(null);if(this.image=t,i&&this.tile.imageAtlas){const e=this.tile.imageAtlas,t=e.patternPositions[i.to.toString()],n=e.patternPositions[i.from.toString()];t&&n&&this._programConfiguration.setConstantPatternPositions(t,n);}if(this.crossfade=this.layer.getCrossfadeParameters(),this.dasharray)this.posA=e.lineAtlas.getDash(this.dasharray.from,"round"===this.layer.layout.get("line-cap")),this.posB=e.lineAtlas.getDash(this.dasharray.to,"round"===this.layer.layout.get("line-cap")),this.widthA=this.posA.width*this.crossfade.fromScale,this.widthB=this.posB.width*this.crossfade.toScale;else if(this.image){const t=e.context,i=t.gl;t.activeTexture.set(i.TEXTURE0),this.tile.imageAtlasUpload(t),this.tile.imageAtlasTexture?.bind(i.LINEAR,i.CLAMP_TO_EDGE),this._programConfiguration.updatePaintBuffers(this.crossfade);}this.tileRatio=1/hg(this.tile,1,e.style.symbolMatrixHelper.cameraHeightConvertedZoom);}},e.VertexBuffer=Yh,e.WGS84_RADIUS_X=Gt,e.WGS84_RADIUS_Y=Ht,e.WGS84_RADIUS_Z=Yt,e.WebGLComponentCounts={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},e.WebGLComponentToShaderVariableType={SCALAR:"float",VEC2:"vec2",VEC3:"vec3",VEC4:"vec4",MAT2:"mat2",MAT3:"mat3",MAT4:"mat4"},e.WebGLConstants=Du,e.WebGLSizes=Gh,e.WritingMode=ny,e.ZoomHistory=yp,e.addColorDefines=function(e){const t={};if(t.PROPERTY=e.property,t.INTERPOLATION_TYPE=e.type,e.default&&(t.DEFAULT_COLOR=Ui.parse(e.default)),e.stops)for(let i=0;i<e.stops.length;i+=1){const n=e.stops[i];t[`STOP_${i}`]=n[0],t[`STOP_COLOR_${i}`]=Ui.parse(n[1]);}return e.base&&(t.BASE=e.base),t},e.allowsLetterSpacing=function(e){for(const t of e)if(!fn(t.charCodeAt(0)))return !1;return !0},e.allowsVerticalWritingMode=pn,e.arrayRemoveDuplicates=rp,e.asyncAll=function(e,t,i){if(!e.length)return i(null,[]);let n=e.length;const r=new Array(e.length);let o=null;for(let a=0;a<e.length;a++)t(e[a],((e,t)=>{e&&(o=e),r[a]=t,0==--n&&i(o,r);}));},e.baseGetTag=Nf,e.binaryFindRayIntersectionBottom=Vl,e.binaryFindRayIntersectionTop=Bl,e.binarySearch=Hl,e.bindAll=Ye,e.checkIsDepthSupportDataType=function(e){if(void 0===e||e===cp.NONE)return !0},e.checkIsIgnoreClassificationDataType=function(e){if(e===cp.IGNORECLASSIFICATION)return !0},e.checkIsVectorShadowVolumeDataType=dp,e.clamp=ze,e.classifyRings=Rv,e.clone=je,e.combine=p_,e.combineInternalMap=U_,e.createCommonjsModule=fd,e.createExpression=Vo,e.createFilter=cx,e.createLayout=bi,e.createLayoutGltf=function(e,t=1){const i=[],n=e.map((e=>{const t=e.components||1;return i.push(e.name),{name:e.name,type:e.type,components:t,offset:e.offset||0,byteStride:e.byteStride||4}}));return i.sort(),{members:n,size:Pi(0,Math.max(0,t)),alignment:t,key:i.join(";")}},e.createLayoutPnts=function(e,t=1){return {members:e.map((e=>({name:e.name,type:e.type,components:e.components||1,offset:e.offset||0,byteStride:e.byteStride||4,bufferName:e.bufferName}))),size:Pi(0,Math.max(0,t)),alignment:t}},e.createStyleLayer=function(e){return "custom"===e.type?new pb(e):new Gb[e.type](e)},e.decodeModel=function(e){const t=dh(e,e?e.byteLength:0);return t.buffer?t.buffer:t},e.deepCopyObj=function e(t){if(!t)return;const i=Array.isArray(t)?[]:{};if("object"!=typeof t)return t;for(const n in t)i[n]="object"==typeof t[n]?e(t[n]):t[n];return i},e.defaultValue=Z,e.defined=$,e.destroyObject=Ou,e.distToSegmentSquared=jw,e.dot=I,e.ease=Fe,e.easeCubicInOut=Oe,e.emitValidationErrors=Bx,e.evaluateSizeForFeature=pg,e.evaluateSizeForZoom=fg,e.evented=Ap,e.exported=Kh,e.extend=Ve,e.filterObject=We,e.findStopLessThanOrEqualTo=_r,e.fromCartographicToRadians=Qt,e.genColorBarScript=yP,e.getArrayBuffer=yh,e.getDefaultExportFromCjs=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e},e.getDistanceFromZoom=Cl,e.getImage=Ph,e.getJSON=function(e,t){return gh(Ve(e="string"==typeof e?{url:e}:e,{type:"json"}),t)},e.getLabelPlaneMatrix=_y,e.getNormalMatrix=Fl,e.getPickPositionOfSurface=Sl,e.getPickPositionOfSurfaceByOriginAndDir=function(e,t){const i=new Ds(e,t),n=Fs.rayEllipsoid(i,Nu.DefaultEllipsoid);return n?i.origin.clone().add(i.direction.clone().multiplyScalar(n.start)):null},e.getPrimitives=B_,e.getProjection=yi,e.getRTLTextPluginStatus=Cp,e.getRay=function(e){const t=e.transform.getCameraPos();return new Ds(t,Al(e.canvasX,e.canvasY,.999999,e.transform))},e.getReferrer=_h,e.getSpherePos=Il,e.getString=function(e,t){return gh(Ve(e="string"==typeof e?{url:e}:e,{type:"string"}),t)},e.getVideo=function(e,t){const i=J.document.createElement("video");i.muted=!0,i.onloadstart=function(){t(null,i);};for(let t=0;t<e.length;t++){const n=J.document.createElement("source");xh(e[t])||(i.crossOrigin="Anonymous"),n.src=e[t],i.appendChild(n);}return {cancel:()=>{}}},e.getZoomFromDistance=Ml,e.intersectionMapKeys=function(e,t){let i,n;const r=[];if(!e||!t)return r;for(e.size<t.size?(i=e.keys(),n=t):(i=t.keys(),n=e);;){const e=i.next();if(e.done)break;const t=e.value;n.has(t)&&r.push(t);}return r},e.isBoolean=tt,e.isChar=dn,e.isFunction=Re,e.isHiddenByMapZoom=Ux,e.isNumber=et,e.isObject=Df,e.isObjectLike=Rf,e.isPowerOfTwo=function(e){return Math.log(e)/Math.LN2%1==0},e.isUrl=function(e){const t=e.substring(0,2),i=e.substring(0,1);return !!/^http[s]?:\/\/([\w\-\.]+)+[\w-]*([\w\-\.\/\?%&=]+)?$/gi.test(e)||"./"==t||"/"==i},e.isWorker=Je,e.keysDifference=function(e,t){const i=[];for(const n in e)n in t||i.push(n);return i},e.keysDifferenceWithMap=function(e,t){const i=[];for(const n in e)t.has(n)||i.push(n);return i},e.layout=tp,e.layout$1=ip,e.lazyLoadRTLTextPlugin=function(){Ip.isLoading()||Ip.isLoaded()||"deferred"!==Cp()||Mp();},e.length=b,e.lerp=Ol,e.limitLnglatScope=function(e){const t=e[0],i=e[1];let n=t,r=i;return t>180?n-=360:t<-180&&(n+=360),i>90?r=90:i<-90&&(r=-90),[n,r]},e.localFrameToFixedFrame=ui,e.makeRequest=gh,e.mapObject=Xe,e.mvt=Ng,e.nextPowerOfTwo=He,e.number=xr,e.octDecode=function(e,t,i){return function(e,t,i,n){if(Oy(n),e<0||e>i||t<0||t>i)throw new Error("x and y must be unsigned normalized integers between 0 and 255");if(n.x=ky(e,i),n.y=ky(t,i),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){const e=n.x;n.x=(1-Math.abs(n.y))*Gy(e),n.y=(1-Math.abs(e))*Gy(n.y);}return n.normalize()}(e,t,255,i)},e.parseCacheControl=function(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,i,n,r)=>{const o=n||r;return t[i]=!o||o.toLowerCase(),""})),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e;}return t},e.parseGlyphPBF=function(e){return new qb(e).readFields(dP,[])},e.pbf=qb,e.pick=function(e,t){const i={};for(let n=0;n<t.length;n++){const r=t[n];r in e&&(i[r]=e[r]);}return i},e.pickColorAttributes=gg,e.pixelsToTileUnits=hg,e.placeFirstAndLastGlyph=xy,e.plugin=Ip,e.pointGeometry3d=te,e.polygonIntersectsPolygon=function(e,t){for(let i=0;i<e.length;i++)if(Zw(t,e[i]))return !0;for(let i=0;i<t.length;i++)if(Zw(e,t[i]))return !0;return !!qw(e,t)},e.potpack=xw,e.project=gy,e.properties=qg,e.randomBetween=function(e,t){const i=new Uint32Array(1);return J.crypto.getRandomValues(i),i[0]/4294967295*(t-e)+e},e.reduceComma=M_,e.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.register=$o,e.registerForPluginStateChange=function(e){return e({pluginStatus:bp,pluginURL:Pp}),Ap.on("pluginStateChange",e),e},e.renderStateEnum=__,e.rgba2Hex=function(e){const t=e.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),i=parseFloat(t[3]||1),n=Math.floor(i*parseInt(t[0])+255*(1-i)),r=Math.floor(i*parseInt(t[1])+255*(1-i)),o=Math.floor(i*parseInt(t[2])+255*(1-i));return `#${`0${n.toString(16)}`.slice(-2)}${`0${r.toString(16)}`.slice(-2)}${`0${o.toString(16)}`.slice(-2)}`},e.root=Tf,e.scaleToGeodeticSurface=ei,e.setRTLTextPlugin=function(e,t,i=!1){if(bp===xp||bp===vp||bp===wp)throw new Error("setRTLTextPlugin cannot be called multiple times.");Pp=Kh.resolveURL(e),bp=xp,Tp=t,Ep(),i||Mp();},e.shaders=L_,e.shapeIcon=function(e,t,i){const{horizontalAlign:n,verticalAlign:r}=py(i),o=t[0]-e.displaySize[0]*n,a=t[1]-e.displaySize[1]*r;return {image:e,top:a,bottom:a+e.displaySize[1],left:o,right:o+e.displaySize[0]}},e.shapeText=function(e,t,i,n,r,o,a,s,l,u,c,h){const d=ry.fromFeature(e,i);c===ny.vertical&&d.verticalizePunctuation();const p=[],f={positionedGlyphs:p,text:d,top:l[1],bottom:l[1],left:l[0],right:l[0],writingMode:c};let m;if(h&&h.properties&&h.properties.hasOwnProperty("_wrap")){const e=h.properties._wrap.split(",");e.length>0&&""!==e[0]?(e.forEach(((e,t,i)=>{i[t]=parseInt(e);})),m=oy(d,e)):m=oy(d,[]);}else {const{processBidirectionalText:e,processStyledBidirectionalText:i}=Ip;if(e&&1===d.sections.length){m=[];const i=e(d.toString(),dy(d,s,n,t));for(const e of i){const t=new ry;t.text=e,t.sections=d.sections;for(let i=0;i<e.length;i++)t.sectionIndex.push(0);m.push(t);}}else if(i){m=[];const e=i(d.text,d.sectionIndex,dy(d,s,n,t));for(const t of e){const e=new ry;e.text=t[0],e.sectionIndex=t[1],e.sections=d.sections,m.push(e);}}else m=oy(d,dy(d,s,n,t));}return function(e,t,i,n,r,o,a,s,l){let u=0,c=-17,h=0;const d=e.positionedGlyphs,p="right"===o?1:"left"===o?0:.5;for(const e of i){e.trim();const i=e.getMaxScale();if(!e.length()){c+=n;continue}const r=d.length;for(let n=0;n<e.length();n++){const r=e.getSection(n),o=e.getCharCode(n),h=24*(i-r.scale),p=t[r.fontStack],f=p&&p[o];f&&(mn(o)&&a!==ny.horizontal?(d.push({glyph:o,x:u,y:h,vertical:!0,scale:r.scale,fontStack:r.fontStack}),u+=l*r.scale+s):(d.push({glyph:o,x:u,y:c+h,vertical:!1,scale:r.scale,fontStack:r.fontStack}),u+=f.metrics.advance*r.scale+s));}d.length!==r&&(h=Math.max(u-s,h),fy(d,t,r,d.length-1,p)),u=0,c+=n*i;}const{horizontalAlign:f,verticalAlign:m}=py(r);!function(e,t,i,n,r,o,a){const s=(t-i)*r,l=(-n*a+.5)*o;for(let t=0;t<e.length;t++)e[t].x+=s,e[t].y+=l;}(d,p,f,m,h,n,i.length);const _=c- -17;e.top+=-m*_,e.bottom=e.top+_,e.left+=-f*h,e.right=e.left+h;}(f,t,m,r,o,a,c,s,u),!!p.length&&(f.text=f.text.toString(),f)},e.smoothstep=function(e,t,i){return (i=ze((i-e)/(t-e),0,1))*i*(3-2*i)},e.sortFeaturesDependsAnchor=function(e,t){if(null==t)return [];const i=Me([t.lng,t.lat]);return e.forEach((e=>{null==e.geometry&&null!=e.feature.geometry&&(e=e.feature),e.distanceToClick=1/0;const t=e.geometry.type;if("Point"==t){const t=Me(e.geometry.coordinates);e.distanceToClick=xe(i,t,{units:"miles"});}else if("MultiLineString"==t)e.geometry.coordinates.forEach((t=>{const n=Ie(t),r=Pe(i,n,{units:"miles"});r<e.distanceToClick&&(e.distanceToClick=r);}));else if("LineString"==t){const t=Ie(e.geometry.coordinates),n=Pe(i,t,{units:"miles"});n<e.distanceToClick&&(e.distanceToClick=n);}else if("Polygon"==t||"MultiPolygon"==t){let t;t=1==e.geometry.coordinates.length?Le(e.geometry.coordinates):function(e,t){if(!e)throw new Error("No coordinates passed");return {type:"Feature",geometry:{type:"MultiPolygon",coordinates:e},properties:{}}}(e.geometry.coordinates);const n=it(i,t);n<e.distanceToClick&&(e.distanceToClick=n);}})),e.sort(((e,t)=>e.distanceToClick-t.distanceToClick))},e.spec=Hg,e.stencilModeforExtrusion=function(e){e.tileClippingMask.nextStencilID+1>256&&(e.tileClippingMask.nextStencilID=1,e.clearStencil());const t=e.tileClippingMask.nextStencilID++;return {enabled:!0,frontFunction:Du.NOTEQUAL,backFunction:Du.NOTEQUAL,reference:t,mask:255,frontOperation:{fail:Du.KEEP,zFail:Du.KEEP,zPass:Du.REPLACE},backOperation:{fail:Du.KEEP,zFail:Du.KEEP,zPass:Du.REPLACE}}},e.tileSamplesGrid=function(e,t){const i=new ep,n=new ia,r=new Ba,o=new ka;i.prepareSegment(0,n,r);const a=ot.TILE.EXTENT,s=e.canonical.x,l=e.canonical.y;let u=2*qv;u/=Math.pow(2,e.overscaledZ),u<ot.TILE_GRIDSAMPLES_SPLIT.THE_MIN_SAMPLES&&(u=ot.TILE_GRIDSAMPLES_SPLIT.THE_MIN_SAMPLES);const c=[],h=a/u,d=e.overscaledZ;let p=[];const f=i.prepareSegment(4*(u+1),n,r);for(let e=0;e<u;e++){Xv(c,0,e*h,d,s,l,t),0===p.length&&(p=c.slice(0)),n.emplaceBack(c[0]-p[0],c[1]-p[1],c[2]-p[2],0,e*h*4),Xv(c,0,(e+1)*h,d,s,l,t),n.emplaceBack(c[0]-p[0],c[1]-p[1],c[2]-p[2],0,(e+1)*h*4),f.vertexLength+=2;for(let i=1;i<=u;i++){Xv(c,i*h,e*h,d,s,l,t),n.emplaceBack(c[0]-p[0],c[1]-p[1],c[2]-p[2],i*h*4,e*h*4),Xv(c,i*h,(e+1)*h,d,s,l,t),n.emplaceBack(c[0]-p[0],c[1]-p[1],c[2]-p[2],i*h*4,(e+1)*h*4);const a=f.vertexLength;r.emplaceBack(a-2,a-1,a),r.emplaceBack(a,a-1,a+1),o.emplaceBack(a-2,a-1),o.emplaceBack(a-1,a),o.emplaceBack(a,a-2),o.emplaceBack(a,a-1),o.emplaceBack(a-1,a+1),o.emplaceBack(a+1,a),f.vertexLength+=2,f.primitiveLength+=2;}}return {sphereSegments:i,sphereIndexArray:r,sphereMaskedBoundsArray:n,wireframeIndexArray:o,rtc:p}},e.toCartographicFromRadians=Jt,e.toDegrees=s,e.toRadians=a,e.transformMat4=F,e.triggerPluginCompletionEvent=Sp,e.turfPolygon=Le,e.uniqueId=Ue,e.uuid=Ge,e.validateStyle=Dx,e.values=function(e){const t=[];for(const i in e)t.push(e[i]);return t},e.warnOnce=Ze,e.window=J,e.wrap=Be,e.xyTransformMat4=Ey;}));

define(["./shared"],(function(t){"use strict";function e(t){const o=typeof t;if("number"===o||"boolean"===o||"string"===o||null==t)return JSON.stringify(t);if(Array.isArray(t)){let o="[";for(const i of t)o+=`${e(i)},`;return `${o}]`}const i=Object.keys(t).sort();let n="{";for(let o=0;o<i.length;o++)n+=`${JSON.stringify(i[o])}:${e(t[i[o]])},`;return `${n}}`}function o(o){let i="";for(const n of t.refProperties)i+=`/${e(o[n])}`;return i}class i{constructor(t){t&&this.replace(t);}replace(t){this._layerConfigs={},this._layers={},this.update(t,[]);}update(e,i){for(const o of e){this._layerConfigs[o.id]=o;const e=this._layers[o.id]=t.createStyleLayer(o);e._featureFilter=t.createFilter(e.filter);}for(const t of i)delete this._layerConfigs[t],delete this._layers[t];this.familiesBySource={};const n=function(t){const e={};for(let i=0;i<t.length;i++){const n=o(t[i]);let r=e[n];r||(r=e[n]=[]),r.push(t[i]);}const i=[];for(const t in e)i.push(e[t]);return i}(t.values(this._layerConfigs));for(const t of n){const e=t.map((t=>this._layers[t.id])),o=e[0];if("none"===o.visibility)continue;const i=o.source||"";let n=this.familiesBySource[i];n||(n=this.familiesBySource[i]={});const r=o.sourceLayer||"_geojsonTileLayer";let s=n[r];s||(s=n[r]=[]),s.push(e);}}}function n(t,e,o,i,n){if(void 0===e.segment)return !0;let r=e,s=e.segment+1,a=0;for(;a>-o/2;){if(s--,s<0)return !1;a-=t[s].dist(r),r=t[s];}a+=t[s].dist(t[s+1]),s++;const l=[];let c=0;for(;a<o/2;){const e=t[s],o=t[s+1];if(!o)return !1;let r=t[s-1].angleTo(e)-e.angleTo(o);for(r=Math.abs((r+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:r}),c+=r;a-l[0].distance>i;)c-=l.shift().angleDelta;if(c>n)return !1;s++,a+=e.dist(o);}return !0}function r(t){let e=0;for(let o=0;o<t.length-1;o++)e+=t[o].dist(t[o+1]);return e}function s(t,e,o){return t?.6*e*o:0}function a(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function l(e,o,i,l,c,h){const u=s(i,c,h),p=a(i,l);let f=0;const d=r(e)/2;for(let i=0;i<e.length-1;i++){const r=e[i],s=e[i+1],a=r.dist(s);if(f+a>d){const l=(d-f)/a,c=t.number(r.x,s.x,l),h=t.number(r.y,s.y,l),g=new t.Anchor(c,h,s.angleTo(r),i);if(g._round(),u&&!n(e,g,p,u,o))return;return g}f+=a;}}function c(t,e,o,i,n,r,l,c,u){const p=s(i,r,l),f=a(i,n),d=0===t[0].x||t[0].x===u||0===t[0].y||t[0].y===u;return e-f*l<e/4&&(e=f*l+e/4),h(t,d?e/2*c%e:(f/2+2*r)*l*c%e,e,p,o,f*l,d,!1,u)}function h(e,o,i,s,a,l,c,u,p){const f=l/2,d=r(e);let g=0,y=o-i,m=[];for(let o=0;o<e.length-1;o++){const r=e[o],c=e[o+1],h=r.dist(c),u=c.angleTo(r);for(;y+i<g+h;){y+=i;const x=(y-g)/h,w=t.number(r.x,c.x,x),v=t.number(r.y,c.y,x);if(w>=0&&w<p&&v>=0&&v<p&&y-f>=0&&y+f<=d){const i=new t.Anchor(w,v,u,o);i._round(),s&&!n(e,i,l,s,a)||m.push(i);}}g+=h;}return u||m.length||c||(m=h(e,g/2,i,s,a,l,c,!0,p)),m}class u{constructor(){this.opacity=0,this.targetOpacity=0,this.time=0;}clone(){const t=new u;return t.opacity=this.opacity,t.targetOpacity=this.targetOpacity,t.time=this.time,t}}t.register("OpacityState",u);class p{constructor(e,o,i,n,r,s,a,l,c,h,u,p){let f=a.top*l-c,d=a.bottom*l+c,g=a.left*l-c,y=a.right*l+c;if(this.boxStartIndex=e.length,h){let t=d-f;const a=y-g;t>0&&(t=Math.max(10*l,t),this._addLineCollisionCircles(e,o,i,i.segment,a,t,n,r,s,u));}else {if(p){const e=new t.pointGeometry3d(g,f),o=new t.pointGeometry3d(y,f),i=new t.pointGeometry3d(g,d),n=new t.pointGeometry3d(y,d),r=p*Math.PI/180;e._rotate(r),o._rotate(r),i._rotate(r),n._rotate(r),g=Math.min(e.x,o.x,i.x,n.x),y=Math.max(e.x,o.x,i.x,n.x),f=Math.min(e.y,o.y,i.y,n.y),d=Math.max(e.y,o.y,i.y,n.y);}e.emplaceBack(i.x,i.y,g,f,y,d,n,r,s,0,0);}this.boxEndIndex=e.length;}_addLineCollisionCircles(t,e,o,i,n,r,s,a,l,c){const h=r/2,u=Math.floor(n/h)||1,p=1+.4*Math.log(c)/Math.LN2,f=Math.floor(u*p/2),d=-r/2;let g=o,y=i+1,m=d;const x=-n/2,w=x-n/4;do{if(y--,y<0){if(m>x)return;y=0;break}m-=e[y].dist(g),g=e[y];}while(m>w);let v=e[y].dist(e[y+1]);for(let o=-f;o<u+f;o++){const i=o*h;let c=x+i;if(i<0&&(c+=i),i>n&&(c+=i-n),c<m)continue;for(;m+v<c;){if(m+=v,y++,y+1>=e.length)return;v=e[y].dist(e[y+1]);}const u=c-m,p=e[y],f=e[y+1].sub(p)._unit()._mult(u)._add(p)._round(),g=Math.abs(c-d)<h?0:.8*(c-d);t.emplaceBack(f.x,f.y,-r/2,-r/2,r/2,r/2,s,a,l,r/2,g);}}}class f{constructor(t=[],e=d){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t);}push(t){this.data.push(t),this.length++,this._up(this.length-1);}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:o}=this,i=e[t];for(;t>0;){const n=t-1>>1,r=e[n];if(o(i,r)>=0)break;e[t]=r,t=n;}e[t]=i;}_down(t){const{data:e,compare:o}=this,i=this.length>>1,n=e[t];for(;t<i;){let i=1+(t<<1),r=e[i];const s=i+1;if(s<this.length&&o(e[s],r)<0&&(i=s,r=e[s]),o(r,n)>=0)break;e[t]=r,t=i;}e[t]=n;}}function d(t,e){return t<e?-1:t>e?1:0}function g(e,o=1,i=!1){let n=1/0,r=1/0,s=-1/0,a=-1/0;const l=e[0];for(let t=0;t<l.length;t++){const e=l[t];(!t||e.x<n)&&(n=e.x),(!t||e.y<r)&&(r=e.y),(!t||e.x>s)&&(s=e.x),(!t||e.y>a)&&(a=e.y);}const c=Math.min(s-n,a-r);let h=c/2;const u=new f([],y);if(0===c)return new t.pointGeometry3d(n,r);for(let t=n;t<s;t+=c)for(let o=r;o<a;o+=c)u.push(new m(t+h,o+h,h,e));let p=function(t){let e=0,o=0,i=0;const n=t[0];for(let t=0,r=n.length,s=r-1;t<r;s=t++){const r=n[t],a=n[s],l=r.x*a.y-a.x*r.y;o+=(r.x+a.x)*l,i+=(r.y+a.y)*l,e+=3*l;}return new m(o/e,i/e,0,t)}(e),d=u.length;for(;u.length;){const t=u.pop();(t.d>p.d||!p.d)&&(p=t,i&&console.warn("found best %d after %d probes",Math.round(1e4*t.d)/1e4,d)),t.max-p.d<=o||(h=t.h/2,u.push(new m(t.p.x-h,t.p.y-h,h,e)),u.push(new m(t.p.x+h,t.p.y-h,h,e)),u.push(new m(t.p.x-h,t.p.y+h,h,e)),u.push(new m(t.p.x+h,t.p.y+h,h,e)),d+=4);}return i&&(console.warn(`num probes: ${d}`),console.warn(`best distance: ${p.d}`)),p.p}function y(t,e){return e.max-t.max}function m(e,o,i,n){this.p=new t.pointGeometry3d(e,o),this.h=i,this.d=function(e,o){let i=!1,n=1/0;for(let r=0;r<o.length;r++){const s=o[r];for(let o=0,r=s.length,a=r-1;o<r;a=o++){const r=s[o],l=s[a];r.y>e.y!=l.y>e.y&&e.x<(l.x-r.x)*(e.y-r.y)/(l.y-r.y)+r.x&&(i=!i),n=Math.min(n,t.distToSegmentSquared(e,r,l));}}return (i?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2;}function x(e,o,i,n,r,s,a){e.createArrays(),e.symbolInstances=[],e.tilePixelRatio=t.EXTENT/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const l=e.layers[0].layout,c=e.layers[0]._unevaluatedLayout._values,h={};if("composite"===e.textSizeData.functionType){const{min:o,max:i}=e.textSizeData.zoomRange;h.compositeTextSizes=[c["text-size"].possiblyEvaluate(new t.EvaluationParameters(o),a),c["text-size"].possiblyEvaluate(new t.EvaluationParameters(i),a)];}if("composite"===e.iconSizeData.functionType){const{min:o,max:i}=e.iconSizeData.zoomRange;h.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new t.EvaluationParameters(o),a),c["icon-size"].possiblyEvaluate(new t.EvaluationParameters(i),a)];}h.layoutTextSize=c["text-size"].possiblyEvaluate(new t.EvaluationParameters(e.zoom+1),a),h.layoutIconSize=c["icon-size"].possiblyEvaluate(new t.EvaluationParameters(e.zoom+1),a),h.textMaxSize=c["text-size"].possiblyEvaluate(new t.EvaluationParameters(18));const u=24,p=l.get("text-line-height")*u,f="map"===l.get("text-rotation-alignment")&&"point"!==l.get("symbol-placement"),d=l.get("text-keep-upright");for(const s of e.features){const c=l.get("text-font").evaluate(s,{},a).join(","),g=i,y={},m=s.text;let x,v=[0,0];if(m){const e=m instanceof t.Formatted?m.toString():m;v=l.get("text-offset").evaluate(s,{},a).map((t=>t*u));const i=l.get("text-letter-spacing").evaluate(s,{},a)*u,n=t.allowsLetterSpacing(e)?i:0,r=l.get("text-anchor").evaluate(s,{},a),h=l.get("text-justify").evaluate(s,{},a),g="point"===l.get("symbol-placement")?l.get("text-max-width").evaluate(s,{},a)*u:0;y.horizontal=t.shapeText(m,o,c,g,p,r,h,n,v,u,t.WritingMode.horizontal,s),t.allowsVerticalWritingMode(e)&&f&&d&&(y.vertical=t.shapeText(m,o,c,g,p,r,h,n,v,u,t.WritingMode.vertical,s));}let b=!1;if(s.icon){const o=n[s.icon];o&&(x=t.shapeIcon(r[s.icon],l.get("icon-offset").evaluate(s,{},a),l.get("icon-anchor").evaluate(s,{},a)),b=o.sdf,void 0===e.sdfIcons?e.sdfIcons=o.sdf:e.sdfIcons!==o.sdf&&t.warnOnce("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(o.pixelRatio!==e.pixelRatio||0!==l.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0));}(y.horizontal||x)&&w(e,s,y,x,g,h,0,a);}s&&e.generateCollisionDebugBuffers();}function w(e,o,i,n,r,s,a,h){const f=s.layoutTextSize.evaluate(o,{},h),d=s.layoutIconSize.evaluate(o,{},h);let y=s.textMaxSize.evaluate(o,{},h);void 0===y&&(y=f);const m=e.layers[0].layout,x=m.get("text-offset").evaluate(o,{},h),w=m.get("icon-offset").evaluate(o,{},h),S=e.tilePixelRatio*(f/24),M=e.tilePixelRatio*y/24,_=e.tilePixelRatio*d,I=e.tilePixelRatio*m.get("symbol-spacing"),T=m.get("text-padding")*e.tilePixelRatio,P=m.get("icon-padding")*e.tilePixelRatio,L=m.get("text-max-angle")/180*Math.PI,k="map"===m.get("text-rotation-alignment")&&"point"!==m.get("symbol-placement"),z="map"===m.get("icon-rotation-alignment")&&"point"!==m.get("symbol-placement"),O=m.get("symbol-placement"),E=I/2,C=(a,l)=>{l.x<0||l.x>=t.EXTENT||l.y<0||l.y>=t.EXTENT||e.symbolInstances.push(function(e,o,i,n,r,s,a,l,c,h,f,d,g,y,m,x,w,b,S,M,_,I,T){const P=e.addToLineVertexArray(o,i);let L,k,z=0,O=0,E=0;const C=n.horizontal?n.horizontal.text:"",D=[];if(n.horizontal){const r=s.layout.get("text-rotate").evaluate(S,{},T);L=new p(a,i,o,l,c,h,n.horizontal,f,d,g,e.overscaling,r),O+=v(e,o,n.horizontal,s,g,S,y,P,n.vertical?t.WritingMode.horizontal:t.WritingMode.horizontalOnly,D,M,_,T),n.vertical&&(E+=v(e,o,n.vertical,s,g,S,y,P,t.WritingMode.vertical,D,M,_,T));}const R=L?L.boxStartIndex:e.collisionBoxArray.length,j=L?L.boxEndIndex:e.collisionBoxArray.length;if(r){const u=function(e,o,i,n,r,s){const a=o.image,l=i.layout,c=o.top-1/a.pixelRatio,h=o.left-1/a.pixelRatio,u=o.bottom+1/a.pixelRatio,p=o.right+1/a.pixelRatio;let f,d,g,y,m;if("none"!==l.get("icon-text-fit")&&r){const e=p-h,o=u-c,i=l.get("text-size").evaluate(s,{})/24,n=r.left*i,a=r.top*i,m=r.right*i-n,x=r.bottom*i-a,w=l.get("icon-text-fit-padding")[0],v=l.get("icon-text-fit-padding")[1],b=l.get("icon-text-fit-padding")[2],S=l.get("icon-text-fit-padding")[3],M="width"===l.get("icon-text-fit")?.5*(x-o):0,_="height"===l.get("icon-text-fit")?.5*(m-e):0,I="width"===l.get("icon-text-fit")||"both"===l.get("icon-text-fit")?m:e,T="height"===l.get("icon-text-fit")||"both"===l.get("icon-text-fit")?x:o;f=new t.pointGeometry3d(n+_-S,a+M-w),d=new t.pointGeometry3d(n+_+v+I,a+M-w),g=new t.pointGeometry3d(n+_+v+I,a+M+b+T),y=new t.pointGeometry3d(n+_-S,a+M+b+T);}else f=new t.pointGeometry3d(h,c),d=new t.pointGeometry3d(p,c),g=new t.pointGeometry3d(p,u),y=new t.pointGeometry3d(h,u);if(m="symtracking"!==i.type||i.layout.get("symtracking-display-mode")!==t.LAYER_LAYOUT_CONSTS.SYMTRACKING_DISPLAY_MODE.SEQUENCE&&i.layout.get("symtracking-display-mode")!==t.LAYER_LAYOUT_CONSTS.SYMTRACKING_DISPLAY_MODE.TIMESTAMP?"symtracking"!==i.type||i.layout.get("compatible-mode")?"symtracking"===i.type?function(t,e){const o=t.geometry[0];return o.length>2&&(!t.properties.hasOwnProperty("name")||-1===t.properties.name.indexOf("箭头"))||1===o.length?0:o[1].angleTo(o[0])+0}(s):i.layout.get("icon-rotate").evaluate(s,{})*Math.PI/180:s.properties.car_rotate*Math.PI/180:i.layout.get("icon-rotate").evaluate(s,{})*Math.PI/180,m){const t=Math.sin(m),e=Math.cos(m),o=[e,-t,t,e];f._matMult(o),d._matMult(o),y._matMult(o),g._matMult(o);}return [{tl:f,tr:d,bl:y,br:g,tex:a.paddedRect,writingMode:void 0,glyphOffset:[0,0]}]}(0,r,s,0,n.horizontal,S),f=s.layout.get("icon-rotate").evaluate(S,{},T);k=new p(a,i,o,l,c,h,r,m,x,!1,e.overscaling,f),z=4*u.length;const d=e.iconSizeData;let g=null;"source"===d.functionType?g=[10*s.layout.get("icon-size").evaluate(S,{},T)]:"composite"===d.functionType&&(g=[10*_.compositeIconSizes[0].evaluate(S,{},T),10*_.compositeIconSizes[1].evaluate(S,{},T)]),e.type!=t.VectorLayerType.SYMBOL&&e.type!=t.VectorLayerType.SYMTRACKING||e.addSymbols(e.icon,u,g,b,w,S,!1,o,P.lineStartIndex,P.lineLength,T);}return {key:C,textBoxStartIndex:R,textBoxEndIndex:j,iconBoxStartIndex:k?k.boxStartIndex:e.collisionBoxArray.length,iconBoxEndIndex:k?k.boxEndIndex:e.collisionBoxArray.length,textOffset:y,iconOffset:b,anchor:o,line:i,featureIndex:l,feature:S,numGlyphVertices:O,numVerticalGlyphVertices:E,numIconVertices:z,textOpacityState:new u,iconOpacityState:new u,isDuplicate:!1,placedTextSymbolIndices:D,crossTileID:0}}(e,l,a,i,n,e.layers[0],e.collisionBoxArray,o.index,o.sourceLayerIndex,e.index,S,T,k,x,_,P,z,w,o,r,s,0,h));};if("line"===O)for(const r of function(e,o,i,n,r){const s=[];for(let o=0;o<e.length;o++){const i=e[o];let a;for(let e=0;e<i.length-1;e++){let o=i[e],l=i[e+1];o.x<0&&l.x<0||(o.x<0?o=new t.pointGeometry3d(0,o.y+(0-o.x)/(l.x-o.x)*(l.y-o.y))._round():l.x<0&&(l=new t.pointGeometry3d(0,o.y+(0-o.x)/(l.x-o.x)*(l.y-o.y))._round()),o.y<0&&l.y<0||(o.y<0?o=new t.pointGeometry3d(o.x+(0-o.y)/(l.y-o.y)*(l.x-o.x),0)._round():l.y<0&&(l=new t.pointGeometry3d(o.x+(0-o.y)/(l.y-o.y)*(l.x-o.x),0)._round()),o.x>=n&&l.x>=n||(o.x>=n?o=new t.pointGeometry3d(n,o.y+(n-o.x)/(l.x-o.x)*(l.y-o.y))._round():l.x>=n&&(l=new t.pointGeometry3d(n,o.y+(n-o.x)/(l.x-o.x)*(l.y-o.y))._round()),o.y>=r&&l.y>=r||(o.y>=r?o=new t.pointGeometry3d(o.x+(r-o.y)/(l.y-o.y)*(l.x-o.x),r)._round():l.y>=r&&(l=new t.pointGeometry3d(o.x+(r-o.y)/(l.y-o.y)*(l.x-o.x),r)._round()),a&&o.equals(a[a.length-1])||(a=[o],s.push(a)),a.push(l)))));}}return s}(o.geometry,0,0,t.EXTENT,t.EXTENT)){const o=c(r,I,L,i.vertical||i.horizontal,n,24,M,e.overscaling,t.EXTENT);for(const t of o){const o=i.horizontal;o&&b(e,o.text,E,t)||C(r,t);}}else if("line-center"===O){for(const t of o.geometry)if(t.length>1){const e=l(t,L,i.vertical||i.horizontal,n,24,M);e&&C(t,e);}}else if("Polygon"===o.type)for(const e of t.classifyRings(o.geometry,0)){const o=g(e,16);C(e[0],new t.Anchor(o.x,o.y,0));}else if("LineString"===o.type)for(const e of o.geometry)C(e,new t.Anchor(e[0].x,e[0].y,0));else if("Point"===o.type)for(const e of o.geometry)for(const o of e)C([o],new t.Anchor(o.x,o.y,0));}function v(e,o,i,n,r,s,a,l,c,h,u,p,f){const d=function(e,o,i,n,r,s){const a=i.layout.get("text-rotate").evaluate(r,{})*Math.PI/180,l=i.layout.get("text-offset").evaluate(r,{}).map((t=>24*t)),c=o.positionedGlyphs,h=[];for(let e=0;e<c.length;e++){const i=c[e],r=s[i.fontStack],u=r&&r[i.glyph];if(!u)continue;const p=u.rect;if(!p)continue;const f=t.GLYPH_PBF_BORDER+1,d=u.metrics.advance*i.scale/2,g=n?[i.x+d,i.y]:[0,0],y=n?[0,0]:[i.x+d+l[0],i.y+l[1]],m=(u.metrics.left-f)*i.scale-d+y[0],x=(-u.metrics.top-f)*i.scale+y[1],w=m+p.w*i.scale,v=x+p.h*i.scale,b=new t.pointGeometry3d(m,x),S=new t.pointGeometry3d(w,x),M=new t.pointGeometry3d(m,v),_=new t.pointGeometry3d(w,v);if(n&&i.vertical){const e=new t.pointGeometry3d(-d,d),o=-Math.PI/2,i=new t.pointGeometry3d(5,0);b._rotateAround(o,e)._add(i),S._rotateAround(o,e)._add(i),M._rotateAround(o,e)._add(i),_._rotateAround(o,e)._add(i);}if(a){const t=Math.sin(a),e=Math.cos(a),o=[e,-t,t,e];b._matMult(o),S._matMult(o),M._matMult(o),_._matMult(o);}h.push({tl:b,tr:S,bl:M,br:_,tex:p,writingMode:o.writingMode,glyphOffset:g});}return h}(0,i,n,r,s,u),g=e.textSizeData;let y=null;return "source"===g.functionType?y=[10*n.layout.get("text-size").evaluate(s,{},f)]:"composite"===g.functionType&&(y=[10*p.compositeTextSizes[0].evaluate(s,{},f),10*p.compositeTextSizes[1].evaluate(s,{},f)]),e.type!=t.VectorLayerType.SYMBOL&&e.type!=t.VectorLayerType.SYMTRACKING||e.addSymbols(e.text,d,y,a,r,s,c,o,l.lineStartIndex,l.lineLength,f),h.push(e.text.placedSymbolArray.length-1),4*d.length}function b(t,e,o,i){const n=t.compareText;if(e in n){const t=n[e];for(let e=t.length-1;e>=0;e--)if(i.dist(t[e])<o)return !0}else n[e]=[];return n[e].push(i),!1}function S(t,e,o){o=o||{},this.w=t||64,this.h=e||64,this.autoResize=!!o.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0;}function M(t,e,o){this.x=0,this.y=t,this.w=this.free=e,this.h=o;}function _(t,e,o,i,n,r,s){this.id=t,this.x=e,this.y=o,this.w=i,this.h=n,this.maxw=r||i,this.maxh=s||n,this.refcount=0;}S.prototype.pack=function(t,e){t=[].concat(t),e=e||{};for(var o,i,n,r=[],s=0;s<t.length;s++)if(i=t[s].h||t[s].height,(o=t[s].w||t[s].width)&&i){if(!(n=this.packOne(o,i,t[s].id)))continue;e.inPlace&&(t[s].x=n.x,t[s].y=n.y,t[s].id=n.id),r.push(n);}return this.shrink(),r},S.prototype.packOne=function(t,e,o){var i,n,r,s,a,l,c,h,u={freebin:-1,shelf:-1,waste:1/0},p=0;if("string"==typeof o||"number"==typeof o){if(i=this.getBin(o))return this.ref(i),i;"number"==typeof o&&(this.maxId=Math.max(o,this.maxId));}else o=++this.maxId;for(s=0;s<this.freebins.length;s++){if(e===(i=this.freebins[s]).maxh&&t===i.maxw)return this.allocFreebin(s,t,e,o);e>i.maxh||t>i.maxw||e<=i.maxh&&t<=i.maxw&&(r=i.maxw*i.maxh-t*e)<u.waste&&(u.waste=r,u.freebin=s);}for(s=0;s<this.shelves.length;s++)if(p+=(n=this.shelves[s]).h,!(t>n.free)){if(e===n.h)return this.allocShelf(s,t,e,o);e>n.h||e<n.h&&(r=(n.h-e)*t)<u.waste&&(u.freebin=-1,u.waste=r,u.shelf=s);}return -1!==u.freebin?this.allocFreebin(u.freebin,t,e,o):-1!==u.shelf?this.allocShelf(u.shelf,t,e,o):e<=this.h-p&&t<=this.w?(n=new M(p,this.w,e),this.allocShelf(this.shelves.push(n)-1,t,e,o)):this.autoResize?(a=l=this.h,((c=h=this.w)<=a||t>c)&&(h=2*Math.max(t,c)),(a<c||e>a)&&(l=2*Math.max(e,a)),this.resize(h,l),this.packOne(t,e,o)):null},S.prototype.allocFreebin=function(t,e,o,i){var n=this.freebins.splice(t,1)[0];return n.id=i,n.w=e,n.h=o,n.refcount=0,this.bins[i]=n,this.ref(n),n},S.prototype.allocShelf=function(t,e,o,i){var n=this.shelves[t].alloc(e,o,i);return this.bins[i]=n,this.ref(n),n},S.prototype.shrink=function(){if(this.shelves.length>0){for(var t=0,e=0,o=0;o<this.shelves.length;o++){var i=this.shelves[o];e+=i.h,t=Math.max(i.w-i.free,t);}this.resize(t,e);}},S.prototype.getBin=function(t){return this.bins[t]},S.prototype.ref=function(t){if(1==++t.refcount){var e=t.h;this.stats[e]=1+(0|this.stats[e]);}return t.refcount},S.prototype.unref=function(t){return 0===t.refcount?0:(0==--t.refcount&&(this.stats[t.h]--,delete this.bins[t.id],this.freebins.push(t)),t.refcount)},S.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0;},S.prototype.resize=function(t,e){this.w=t,this.h=e;for(var o=0;o<this.shelves.length;o++)this.shelves[o].resize(t);return !0},M.prototype.alloc=function(t,e,o){if(t>this.free||e>this.h)return null;var i=this.x;return this.x+=t,this.free-=t,new _(o,i,this.y,t,e,t,this.h)},M.prototype.resize=function(t){return this.free+=t-this.w,this.w=t,!0};class I{constructor(e){const o=new t.AlphaImage({width:0,height:0}),i={},n=new S(0,0,{autoResize:!0});for(const r in e){const s=e[r],a=i[r]={};for(const e in s){const i=s[+e];if(i&&0!==i.bitmap.width&&0!==i.bitmap.height){const r=n.packOne(i.bitmap.width+2,i.bitmap.height+2);o.resize({width:n.w,height:n.h}),t.AlphaImage.copy(i.bitmap,o,{x:0,y:0},{x:r.x+1,y:r.y+1},i.bitmap),a[e]={rect:r,metrics:i.metrics};}}}n.shrink(),o.resize({width:n.w,height:n.h}),this.image=o,this.positions=i;}}t.register("GlyphAtlas",I);class T{constructor(e){this.tileID=new t.OverscaledTileID(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y,this.projection),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.projection=e.projection||t.ProjectionType.MERCATOR,this.promoteId=e.promoteId,this.maxZoom=e.maxZoom,this.keepBuffer=e.keepBuffer;}parse(e,o,i,n,r){this.status="parsing",this.data=e,this.collisionBoxArray=new t.CollisionBoxArray;const s=new t.DictionaryCoder(Object.keys(e.layers).sort()),a=new t.FeatureIndex(this.tileID,this.promoteId,this.projection);a.bucketLayerIDs=[];const l={},c={featureIndex:a,iconDependencies:{},glyphDependencies:{},patternDependencies:{},x:this.tileID.canonical.x,y:this.tileID.canonical.y,z:this.tileID.canonical.z,availableImages:i,keepBuffer:this.keepBuffer},h=o.familiesBySource[this.source];for(const o in h){const n=e.layers[o];if(!n)continue;1===n.version&&t.warnOnce(`Vector tile source "${this.source}" layer "${o}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const r=s.encode(o),u=[];for(let t=0;t<n.length;t++){const e=n.feature(t),i=a.getId(e,o);e.id=i,u.push({feature:e,index:t,sourceLayerIndex:r});}for(const t of h[o]){const e=t[0];this.zoom<this.maxZoom&&e.minzoom&&this.zoom<Math.floor(e.minzoom)||e.maxzoom&&this.zoom>=e.maxzoom||"none"!==e.visibility&&(P(t,this.zoom,i),(l[e.id]=e.createBucket({index:a.bucketLayerIDs.length,layers:t,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:r,sourceID:this.source,projection:this.projection})).populate(u,c,this.tileID.canonical),a.bucketLayerIDs.push(t.map((t=>t.id))));}}let u,p,f,d;const g=t.mapObject(c.glyphDependencies,(t=>Object.keys(t).map(Number)));Object.keys(g).length?n.send("getGlyphs",{uid:this.uid,stacks:g},((t,e)=>{u||(u=t,p=e,w.call(this));})):p={};const y=Object.keys(c.iconDependencies);y.length?n.send("getImages",{icons:y,source:this.source,tileID:this.tileID,type:"icons"},((t,e)=>{u||(u=t,f=e,w.call(this));})):f={};const m=Object.keys(c.patternDependencies);function w(){if(u)return r(u);if(p&&f&&d){const e=new I(p),o=new t.ImageAtlas(f,d);for(const n in l){const r=l[n];r.type==t.VectorLayerType.SYMBOL||r.type==t.VectorLayerType.SYMTRACKING?(P(r.layers,this.zoom,i),x(r,p,e.positions,f,o.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):!r.hasPattern||r.type!=t.VectorLayerType.LINE&&r.type!=t.VectorLayerType.SPRITE&&r.type!=t.VectorLayerType.FILL&&r.type!=t.VectorLayerType.EXTRUSION||(P(r.layers,this.zoom,i),r.addFeatures(c,this.tileID.canonical,o.patternPositions));}this.status="done",r(null,{buckets:t.values(l).filter((t=>!t.isEmpty())),featureIndex:a,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,imageAtlas:o});}}m.length?n.send("getImages",{icons:m,source:this.source,tileID:this.tileID,type:"patterns"},((t,e)=>{u||(u=t,d=e,w.call(this));})):d={},w.call(this);}}function P(e,o,i){const n=new t.EvaluationParameters(o);for(const t of e)t.recalculate(n,i);}const L=t.window.performance;function k(t){const e=t?t.url.toString():void 0;return L.getEntriesByName(e)}class z{constructor(t,e,o,i){this.actor=t,this.layerIndex=e,this.loadVectorData=this.loadVectorTile,this.loading={},this.loaded={},this.availableImages=o,this.projection=i;}registRequestController(t){this.vrc=t;}loadVectorTile(e,o){return this.vrc.pushRequest({id:e.uid,param:e.request,cb:(i,n,r,s)=>{if(i)o(i);else if(n){const i=new t.mvt.VectorTile(new t.pbf(n),null,e&&e.projection);o(null,{vectorTile:i,rawData:n,cacheControl:r,expires:s});}}})}setDataLoaderFunction(t){t&&(this.loadVectorData=t);}loadTile(e,o){const i=e.uid,n=e&&e.request,r=n&&n.collectResourceTiming;this.loading||(this.loading={});const s=this.loading[i]=new T(e);s.hasRequest=this.loadVectorData(e,((e,a)=>{if(delete this.loading[i],e||!a)return o(e);const l=a.rawData,c={};a.expires&&(c.expires=a.expires),a.cacheControl&&(c.cacheControl=a.cacheControl);const h={};if(r){const t=k(n);t.length>0&&(h.resourceTiming=JSON.parse(JSON.stringify(t)));}s.vectorTile=a.vectorTile,s.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,((e,i)=>{if(e||!i)return o(e);o(null,t.extend({rawTileData:l.slice(0),bbx:a.bbx},i,c,h));})),this.loaded=this.loaded||{},this.loaded[i]=s;}),this.projection),this.vrc&&this.vrc.run();}reloadTile(t,e){const o=this.loaded,i=t.uid,n=this;if(o&&o[i]){const r=o[i];r.showCollisionBoxes=t.showCollisionBoxes;const s=(t,o)=>{const i=r.reloadCallback;i&&(delete r.reloadCallback,r.parse(r.vectorTile,n.layerIndex,this.availableImages,n.actor,i)),e(t,o);};"parsing"===r.status?r.reloadCallback=s:"done"===r.status&&r.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor,s);}}abortTile(t,e){const o=this.loading,i=t.uid;o&&o[i]&&o[i].hasRequest&&(this.vrc.removeRequestById(i),delete o[i]),e();}removeTile(t,e){const o=this.loaded,i=t.uid;o&&o[i]&&delete o[i],e();}}var O=function t(e,o){var i,n=e&&e.type;if("FeatureCollection"===n)for(i=0;i<e.features.length;i++)t(e.features[i],o);else if("GeometryCollection"===n)for(i=0;i<e.geometries.length;i++)t(e.geometries[i],o);else if("Feature"===n)t(e.geometry,o);else if("Polygon"===n)E(e.coordinates,o);else if("MultiPolygon"===n)for(i=0;i<e.coordinates.length;i++)E(e.coordinates[i],o);return e};function E(t,e){if(0!==t.length){C(t[0],e);for(var o=1;o<t.length;o++)C(t[o],!e);}}function C(t,e){for(var o=0,i=0,n=0,r=t.length,s=r-1;n<r;s=n++){var a=(t[n][0]-t[s][0])*(t[s][1]+t[n][1]),l=o+a;i+=Math.abs(o)>=Math.abs(a)?o-l+a:a-l+o,o=l;}o+i>=0!=!!e&&t.reverse();}const D=t.mvt.VectorTileFeature.prototype.toGeoJSON;class R{constructor(e,o){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,this.projObj=t.getProjection(o),"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10));}loadGeometry(){if(1===this._feature.type){const e=[];for(const o of this._feature.geometry)e.push([new t.pointGeometry3d(...o)]);return e}{const e=[];for(const o of this._feature.geometry){const i=[];for(const e of o)i.push(new t.pointGeometry3d(...e));e.push(i);}return e}}toGeoJSON(t,e,o){return D.call(this,t,e,o)}}class j{constructor(e,o){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e,this.projection=o;}feature(t){return new R(this._features[t],this.projection)}}var V=A;function A(t,e){this.x=t,this.y=e;}A.prototype={clone:function(){return new A(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,o=t.y-this.y;return e*e+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),o=Math.sin(t),i=o*this.x+e*this.y;return this.x=e*this.x-o*this.y,this.y=i,this},_rotateAround:function(t,e){var o=Math.cos(t),i=Math.sin(t),n=e.y+i*(this.x-e.x)+o*(this.y-e.y);return this.x=e.x+o*(this.x-e.x)-i*(this.y-e.y),this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},A.convert=function(t){return t instanceof A?t:Array.isArray(t)?new A(t[0],t[1]):t};var G=B;function B(t,e,o,i,n){this.properties={},this.extent=o,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=n,t.readFields(N,this,e);}function N(t,e,o){1==t?e.id=o.readVarint():2==t?function(t,e){for(var o=t.readVarint()+t.pos;t.pos<o;){var i=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[i]=n;}}(o,e):3==t?e.type=o.readVarint():4==t&&(e._geometry=o.pos);}function F(t){for(var e,o,i=0,n=0,r=t.length,s=r-1;n<r;s=n++)i+=((o=t[s]).x-(e=t[n]).x)*(e.y+o.y);return i}B.types=["Unknown","Point","LineString","Polygon"],B.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,o=t.readVarint()+t.pos,i=1,n=0,r=0,s=0,a=[];t.pos<o;){if(n<=0){var l=t.readVarint();i=7&l,n=l>>3;}if(n--,1===i||2===i)r+=t.readSVarint(),s+=t.readSVarint(),1===i&&(e&&a.push(e),e=[]),e.push(new V(r,s));else {if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone());}}return e&&a.push(e),a},B.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,o=1,i=0,n=0,r=0,s=1/0,a=-1/0,l=1/0,c=-1/0;t.pos<e;){if(i<=0){var h=t.readVarint();o=7&h,i=h>>3;}if(i--,1===o||2===o)(n+=t.readSVarint())<s&&(s=n),n>a&&(a=n),(r+=t.readSVarint())<l&&(l=r),r>c&&(c=r);else if(7!==o)throw new Error("unknown command "+o)}return [s,l,a,c]},B.prototype.toGeoJSON=function(t,e,o){var i,n,r=this.extent*Math.pow(2,o),s=this.extent*t,a=this.extent*e,l=this.loadGeometry(),c=B.types[this.type];function h(t){for(var e=0;e<t.length;e++){var o=t[e];t[e]=[360*(o.x+s)/r-180,360/Math.PI*Math.atan(Math.exp((180-360*(o.y+a)/r)*Math.PI/180))-90];}}switch(this.type){case 1:var u=[];for(i=0;i<l.length;i++)u[i]=l[i][0];h(l=u);break;case 2:for(i=0;i<l.length;i++)h(l[i]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return [t];for(var o,i,n=[],r=0;r<e;r++){var s=F(t[r]);0!==s&&(void 0===i&&(i=s<0),i===s<0?(o&&n.push(o),o=[t[r]]):o.push(t[r]));}return o&&n.push(o),n}(l),i=0;i<l.length;i++)for(n=0;n<l[i].length;n++)h(l[i][n]);}1===l.length?l=l[0]:c="Multi"+c;var p={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return "id"in this&&(p.id=this.id),p};var q=Y;function Y(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Z,this,e),this.length=this._features.length;}function Z(t,e,o){15===t?e.version=o.readVarint():1===t?e.name=o.readString():5===t?e.extent=o.readVarint():2===t?e._features.push(o.pos):3===t?e._keys.push(o.readString()):4===t&&e._values.push(function(t){for(var e=null,o=t.readVarint()+t.pos;t.pos<o;){var i=t.readVarint()>>3;e=1===i?t.readString():2===i?t.readFloat():3===i?t.readDouble():4===i?t.readVarint64():5===i?t.readVarint():6===i?t.readSVarint():7===i?t.readBoolean():null;}return e}(o));}function J(t,e,o){if(3===t){var i=new q(o,o.readVarint()+o.pos);i.length&&(e[i.name]=i);}}Y.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new G(this._pbf,e,this.extent,this._keys,this._values)};var X={VectorTile:function(t,e){this.layers=t.readFields(J,{},e);},VectorTileFeature:G,VectorTileLayer:q}.VectorTileFeature,W=$;function $(t,e){this.options=e||{},this.features=t,this.length=t.length;}function U(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096;}$.prototype.feature=function(t){return new U(this.features[t],this.options.extent)},U.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var o=t[e],i=[],n=0;n<o.length;n++)i.push(new V(o[n][0],o[n][1]));this.geometry.push(i);}return this.geometry},U.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,o=-1/0,i=1/0,n=-1/0,r=0;r<t.length;r++)for(var s=t[r],a=0;a<s.length;a++){var l=s[a];e=Math.min(e,l.x),o=Math.max(o,l.x),i=Math.min(i,l.y),n=Math.max(n,l.y);}return [e,i,o,n]},U.prototype.toGeoJSON=X.prototype.toGeoJSON;var K=Q,H=W;function Q(e){var o=new t.pbf;return function(t,e){for(var o in t.layers)e.writeMessage(3,tt,t.layers[o]);}(e,o),o.finish()}function tt(t,e){var o;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var i={keys:[],values:[],keycache:{},valuecache:{}};for(o=0;o<t.length;o++)i.feature=t.feature(o),e.writeMessage(2,et,i);var n=i.keys;for(o=0;o<n.length;o++)e.writeStringField(3,n[o]);var r=i.values;for(o=0;o<r.length;o++)e.writeMessage(4,st,r[o]);}function et(t,e){var o=t.feature;void 0!==o.id&&e.writeVarintField(1,o.id),e.writeMessage(2,ot,t),e.writeVarintField(3,o.type),e.writeMessage(4,rt,o);}function ot(t,e){var o=t.feature,i=t.keys,n=t.values,r=t.keycache,s=t.valuecache;for(var a in o.properties){var l=o.properties[a],c=r[a];if(null!==l){void 0===c&&(i.push(a),r[a]=c=i.length-1),e.writeVarint(c);var h=typeof l;"string"!==h&&"boolean"!==h&&"number"!==h&&(l=JSON.stringify(l));var u=h+":"+l,p=s[u];void 0===p&&(n.push(l),s[u]=p=n.length-1),e.writeVarint(p);}}}function it(t,e){return (e<<3)+(7&t)}function nt(t){return t<<1^t>>31}function rt(t,e){for(var o=t.loadGeometry(),i=t.type,n=0,r=0,s=o.length,a=0;a<s;a++){var l=o[a],c=1;1===i&&(c=l.length),e.writeVarint(it(1,c));for(var h=3===i?l.length-1:l.length,u=0;u<h;u++){1===u&&1!==i&&e.writeVarint(it(2,h-1));var p=l[u].x-n,f=l[u].y-r;e.writeVarint(nt(p)),e.writeVarint(nt(f)),n+=p,r+=f;}3===i&&e.writeVarint(it(7,1));}}function st(t,e){var o=typeof t;"string"===o?e.writeStringField(1,t):"boolean"===o?e.writeBooleanField(7,t):"number"===o&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t));}function at(t,e,o,i,n,r){if(n-i<=o)return;const s=i+n>>1;lt(t,e,s,i,n,r%2),at(t,e,o,i,s-1,r+1),at(t,e,o,s+1,n,r+1);}function lt(t,e,o,i,n,r){for(;n>i;){if(n-i>600){const s=n-i+1,a=o-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);lt(t,e,o,Math.max(i,Math.floor(o-a*c/s+h)),Math.min(n,Math.floor(o+(s-a)*c/s+h)),r);}const s=e[2*o+r];let a=i,l=n;for(ct(t,e,i,o),e[2*n+r]>s&&ct(t,e,i,n);a<l;){for(ct(t,e,a,l),a++,l--;e[2*a+r]<s;)a++;for(;e[2*l+r]>s;)l--;}e[2*i+r]===s?ct(t,e,i,l):(l++,ct(t,e,l,n)),l<=o&&(i=l+1),o<=l&&(n=l-1);}}function ct(t,e,o,i){ht(t,o,i),ht(e,2*o,2*i),ht(e,2*o+1,2*i+1);}function ht(t,e,o){const i=t[e];t[e]=t[o],t[o]=i;}function ut(t,e,o,i){const n=t-o,r=e-i;return n*n+r*r}K.fromVectorTileJs=Q,K.fromGeojsonVt=function(t,e){e=e||{};var o={};for(var i in t)o[i]=new W(t[i].features,e),o[i].name=i,o[i].version=e.version,o[i].extent=e.extent;return Q({layers:o})},K.GeoJSONWrapper=H;const pt=t=>t[0],ft=t=>t[1];class dt{constructor(t,e=pt,o=ft,i=64,n=Float64Array){this.nodeSize=i,this.points=t;const r=t.length<65536?Uint16Array:Uint32Array,s=this.ids=new r(t.length),a=this.coords=new n(2*t.length);for(let i=0;i<t.length;i++)s[i]=i,a[2*i]=e(t[i]),a[2*i+1]=o(t[i]);at(s,a,i,0,s.length-1,0);}range(t,e,o,i){return function(t,e,o,i,n,r,s){const a=[0,t.length-1,0],l=[];let c,h;for(;a.length;){const u=a.pop(),p=a.pop(),f=a.pop();if(p-f<=s){for(let s=f;s<=p;s++)c=e[2*s],h=e[2*s+1],c>=o&&c<=n&&h>=i&&h<=r&&l.push(t[s]);continue}const d=Math.floor((f+p)/2);c=e[2*d],h=e[2*d+1],c>=o&&c<=n&&h>=i&&h<=r&&l.push(t[d]);const g=(u+1)%2;(0===u?o<=c:i<=h)&&(a.push(f),a.push(d-1),a.push(g)),(0===u?n>=c:r>=h)&&(a.push(d+1),a.push(p),a.push(g));}return l}(this.ids,this.coords,t,e,o,i,this.nodeSize)}within(t,e,o){return function(t,e,o,i,n,r){const s=[0,t.length-1,0],a=[],l=n*n;for(;s.length;){const c=s.pop(),h=s.pop(),u=s.pop();if(h-u<=r){for(let n=u;n<=h;n++)ut(e[2*n],e[2*n+1],o,i)<=l&&a.push(t[n]);continue}const p=Math.floor((u+h)/2),f=e[2*p],d=e[2*p+1];ut(f,d,o,i)<=l&&a.push(t[p]);const g=(c+1)%2;(0===c?o-n<=f:i-n<=d)&&(s.push(u),s.push(p-1),s.push(g)),(0===c?o+n>=f:i+n>=d)&&(s.push(p+1),s.push(h),s.push(g));}return a}(this.ids,this.coords,t,e,o,this.nodeSize)}}const gt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},yt=Math.fround||(mt=new Float32Array(1),t=>(mt[0]=+t,mt[0]));var mt;class xt{constructor(e){this.options=Pt(Object.create(gt),e),this.trees=new Array(this.options.maxZoom+1),this.projection=e&&e.projection?e.projection:"MERCATOR",this.projObj=t.getProjection(this.projection);}createPointCluster(t,e,o){const[i,n]=t.geometry.coordinates;return {x:yt(St(i)),y:yt((o?_t:Mt)(n)),zoom:1/0,index:e,parentId:-1}}load(t){const{log:e,minZoom:o,maxZoom:i,nodeSize:n}=this.options;e&&console.time("total time");const r=`prepare ${t.length} points`;e&&console.time(r),this.points=t;let s=[];for(let e=0;e<t.length;e++)t[e].geometry&&s.push(this.createPointCluster(t[e],e,this.options.isLatLon));this.trees[i+1]=new dt(s,Lt,kt,n,Float32Array),e&&console.timeEnd(r);for(let t=i;t>=o;t--){const o=+Date.now();s=this._cluster(s,t),this.trees[t]=new dt(s,Lt,kt,n,Float32Array),e&&console.warn("z%d: %d clusters in %dms",t,s.length,+Date.now()-o);}return e&&console.timeEnd("total time"),this}getClusters(t,e){let o=((t[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,t[1]));let n=180===t[2]?180:((t[2]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)o=-180,n=180;else if(o>n){const t=this.getClusters([o,i,180,r],e),s=this.getClusters([-180,i,n,r],e);return t.concat(s)}const s=this.trees[this._limitZoom(e)],a=s.range(St(o),(this.options.isLatLon?_t:Mt)(r),St(n),(this.options.isLatLon?_t:Mt)(i)),l=[];for(const t of a){const e=s.points[t];l.push(e.numPoints?vt(e,this.options.isLatLon):this.points[e.index]);}return l}getChildren(t){const e=this._getOriginId(t),o=this._getOriginZoom(t),i="No cluster with the specified id.",n=this.trees[o];if(!n)throw new Error(i);const r=n.points[e];if(!r)throw new Error(i);const s=this.options.radius/(this.options.extent*Math.pow(2,o-1)),a=n.within(r.x,r.y,s),l=[];for(const e of a){const o=n.points[e];o.parentId===t&&l.push(o.numPoints?vt(o,this.options.isLatLon):this.points[o.index]);}if(0===l.length)throw new Error(i);return l}getLeaves(t,e,o){const i=[];return this._appendLeaves(i,t,e=e||10,o=o||0,0),i}getTile(t,e,o){const i=this.trees[this._limitZoom(t)],n=Math.pow(2,t),{extent:r,radius:s}=this.options,a=s/r,l=(o-a)/n,c=(o+1+a)/n,h={features:[]};return this._addTileFeatures(i.range((e-a)/n,l,(e+1+a)/n,c),i.points,e,o,n,h),0===e&&this._addTileFeatures(i.range(1-a/n,l,1,c),i.points,n,o,n,h),e===n-1&&this._addTileFeatures(i.range(0,l,a/n,c),i.points,-1,o,n,h),h.features.length?h:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const o=this.getChildren(t);if(e++,1!==o.length)break;t=o[0].properties.cluster_id;}return e}_appendLeaves(t,e,o,i,n){const r=this.getChildren(e);for(const e of r){const r=e.properties;if(r&&r.cluster?n+r.point_count<=i?n+=r.point_count:n=this._appendLeaves(t,r.cluster_id,o,i,n):n<i?n++:t.push(e),t.length===o)break}return n}_addTileFeatures(t,e,o,i,n,r){for(const s of t){const t=e[s],a=t.numPoints;let l,c,h;if(a)l=bt(t),c=t.x,h=t.y;else {const e=this.points[t.index];l=e.properties,c=St(e.geometry.coordinates[0]),h=(this.options.isLatLon?_t:Mt)(e.geometry.coordinates[1]);}const u={type:1,geometry:[[Math.round(this.options.extent*(c*n-o)),Math.round(this.options.extent*(h*n-i))]],tags:l};let p;a?p=t.id:this.options.generateId?p=t.index:this.points[t.index].id&&(p=this.points[t.index].id),void 0!==p&&(u.id=p),r.features.push(u);}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))}_cluster(t,e){const o=[],{radius:i,extent:n,reduce:r,minPoints:s}=this.options,a=i/(n*Math.pow(2,e));for(let i=0;i<t.length;i++){const n=t[i];if(n.zoom<=e)continue;n.zoom=e;const l=this.trees[e+1],c=l.within(n.x,n.y,a),h=n.numPoints||1;let u=h;for(const t of c){const o=l.points[t];o.zoom>e&&(u+=o.numPoints||1);}if(u>=s){let t=n.x*h,s=n.y*h,a=r&&h>1?this._map(n,!0):null;const p=(i<<5)+(e+1)+this.points.length;for(const o of c){const i=l.points[o];if(i.zoom<=e)continue;i.zoom=e;const c=i.numPoints||1;t+=i.x*c,s+=i.y*c,i.parentId=p,r&&(a||(a=this._map(n,!0)),r(a,this._map(i)));}n.parentId=p,o.push(wt(t/u,s/u,p,u,a));}else if(o.push(n),u>1)for(const t of c){const i=l.points[t];i.zoom<=e||(i.zoom=e,o.push(i));}}return o}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return (t-this.points.length)%32}_map(t,e){if(t.numPoints)return e?Pt({},t.properties):t.properties;const o=this.points[t.index].properties,i=this.options.map(o);return e&&i===o?Pt({},i):i}}function wt(t,e,o,i,n){return {x:yt(t),y:yt(e),zoom:1/0,id:o,parentId:-1,numPoints:i,properties:n}}function vt(t,e){return {type:"Feature",id:t.id,properties:bt(t),geometry:{type:"Point",coordinates:[(o=t.x,360*(o-.5)),(e?Tt:It)(t.y)]}};var o;}function bt(t){const e=t.numPoints,o=e>=1e4?`${Math.round(e/1e3)}k`:e>=1e3?Math.round(e/100)/10+"k":e;return Pt(Pt({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:o})}function St(t){return t/360+.5}function Mt(t){const e=Math.sin(t*Math.PI/180),o=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return o<0?0:o>1?1:o}function _t(t){const e=(90-t)/360;return e<0?0:e>1?1:e}function It(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function Tt(t){return 90-360*t}function Pt(t,e){for(const o in e)t[o]=e[o];return t}function Lt(t){return t.x}function kt(t){return t.y}function zt(t,e,o,i){let n=i;const r=o-e>>1;let s,a=o-e;const l=t[e],c=t[e+1],h=t[o],u=t[o+1];for(let i=e+3;i<o;i+=3){const e=Ot(t[i],t[i+1],l,c,h,u);if(e>n)s=i,n=e;else if(e===n){const t=Math.abs(i-r);t<a&&(s=i,a=t);}}n>i&&(s-e>3&&zt(t,e,s,i),t[s+2]=n,o-s>3&&zt(t,s,o,i));}function Ot(t,e,o,i,n,r){let s=n-o,a=r-i;if(0!==s||0!==a){const l=((t-o)*s+(e-i)*a)/(s*s+a*a);l>1?(o=n,i=r):l>0&&(o+=s*l,i+=a*l);}return s=t-o,a=e-i,s*s+a*a}function Et(t,e,o,i){const n={id:null==t?null:t,type:e,geometry:o,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===e||"MultiPoint"===e||"LineString"===e)Ct(n,o);else if("Polygon"===e)Ct(n,o[0]);else if("MultiLineString"===e)for(const t of o)Ct(n,t);else if("MultiPolygon"===e)for(const t of o)Ct(n,t[0]);return n}function Ct(t,e){for(let o=0;o<e.length;o+=3)t.minX=Math.min(t.minX,e[o]),t.minY=Math.min(t.minY,e[o+1]),t.maxX=Math.max(t.maxX,e[o]),t.maxY=Math.max(t.maxY,e[o+1]);}function Dt(t,e,o,i){if(!e.geometry)return;const n=e.geometry.coordinates,r=e.geometry.type,s=Math.pow(o.tolerance/((1<<o.maxZoom)*o.extent),2);let a=[],l=e.id;if(o.promoteId?l=e.properties[o.promoteId]:o.generateId&&(l=i||0),"Point"===r)Rt(n,a,o.projection);else if("MultiPoint"===r)for(const t of n)Rt(t,a,o.projection);else if("LineString"===r)jt(n,a,s,!1,o.projection);else if("MultiLineString"===r){if(o.lineMetrics){for(const i of n)a=[],jt(i,a,s,!1,o.projection),t.push(Et(l,"LineString",a,e.properties));return}Vt(n,a,s,!1,o.projection);}else if("Polygon"===r)Vt(n,a,s,!0,o.projection);else {if("MultiPolygon"!==r){if("GeometryCollection"===r){for(const n of e.geometry.geometries)Dt(t,{id:l,geometry:n,properties:e.properties},o,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const t of n){const e=[];Vt(t,e,s,!0,o.projection),a.push(e);}}t.push(Et(l,r,a,e.properties));}function Rt(t,e,o){e.push(...At(t,o),0);}function jt(t,e,o,i,n){let r,s,a=0;for(let o=0;o<t.length;o++){const l=At(t[o],n),c=l[0],h=l[1];e.push(c,h,0),o>0&&(a+=i?(r*h-c*s)/2:Math.sqrt(Math.pow(c-r,2)+Math.pow(h-s,2))),r=c,s=h;}const l=e.length-3;e[2]=1,zt(e,0,l,o),e[l+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size;}function Vt(t,e,o,i,n){for(let r=0;r<t.length;r++){const s=[];jt(t[r],s,o,i,n),e.push(s);}}function At(e,o){const i=t.getProjection(o),n=i.lngX(e[0],1);let r=i.latY(e[1],1);return r=r<0?0:r>1?1:r,[n,r]}function Gt(t,e,o,i,n,r,s,a){if(i/=e,r>=(o/=e)&&s<i)return t;if(s<o||r>=i)return null;const l=[];for(const e of t){const t=e.geometry;let r=e.type;const s=0===n?e.minX:e.minY,c=0===n?e.maxX:e.maxY;if(s>=o&&c<i){l.push(e);continue}if(c<o||s>=i)continue;let h=[];if("Point"===r||"MultiPoint"===r)Bt(t,h,o,i,n);else if("LineString"===r)Nt(t,h,o,i,n,!1,a.lineMetrics);else if("MultiLineString"===r)qt(t,h,o,i,n,!1);else if("Polygon"===r)qt(t,h,o,i,n,!0);else if("MultiPolygon"===r)for(const e of t){const t=[];qt(e,t,o,i,n,!0),t.length&&h.push(t);}if(h.length){if(a.lineMetrics&&"LineString"===r){for(const t of h)l.push(Et(e.id,r,t,e.tags));continue}"LineString"!==r&&"MultiLineString"!==r||(1===h.length?(r="LineString",h=h[0]):r="MultiLineString"),"Point"!==r&&"MultiPoint"!==r||(r=3===h.length?"Point":"MultiPoint"),l.push(Et(e.id,r,h,e.tags));}}return l.length?l:null}function Bt(t,e,o,i,n){for(let r=0;r<t.length;r+=3){const s=t[r+n];s>=o&&s<=i&&Yt(e,t[r],t[r+1],t[r+2]);}}function Nt(t,e,o,i,n,r,s){let a=Ft(t);const l=0===n?Zt:Jt;let c,h,u=t.start;for(let p=0;p<t.length-3;p+=3){const f=t[p],d=t[p+1],g=t[p+2],y=t[p+3],m=t[p+4],x=0===n?f:d,w=0===n?y:m;let v=!1;s&&(c=Math.sqrt(Math.pow(f-y,2)+Math.pow(d-m,2))),x<o?w>=o&&(h=l(a,f,d,y,m,o),s&&(a.start=u+c*h)):x>i?w<=i&&(h=l(a,f,d,y,m,i),s&&(a.start=u+c*h)):Yt(a,f,d,g),w<o&&x>=o&&(h=l(a,f,d,y,m,o),v=!0),w>i&&x<=i&&(h=l(a,f,d,y,m,i),v=!0),!r&&v&&(s&&(a.end=u+c*h),e.push(a),a=Ft(t)),s&&(u+=c);}let p=t.length-3;const f=t[p],d=t[p+1],g=0===n?f:d;g>=o&&g<=i&&Yt(a,f,d,t[p+2]),p=a.length-3,r&&p>=3&&(a[p]!==a[0]||a[p+1]!==a[1])&&Yt(a,a[0],a[1],a[2]),a.length&&e.push(a);}function Ft(t){const e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function qt(t,e,o,i,n,r){for(const s of t)Nt(s,e,o,i,n,r,!1);}function Yt(t,e,o,i){t.push(e,o,i);}function Zt(t,e,o,i,n,r){const s=(r-e)/(i-e);return Yt(t,r,o+(n-o)*s,1),s}function Jt(t,e,o,i,n,r){const s=(r-o)/(n-o);return Yt(t,e+(i-e)*s,r,1),s}function Xt(t,e){const o=[];for(let i=0;i<t.length;i++){const n=t[i],r=n.type;let s;if("Point"===r||"MultiPoint"===r||"LineString"===r)s=Wt(n.geometry,e);else if("MultiLineString"===r||"Polygon"===r){s=[];for(const t of n.geometry)s.push(Wt(t,e));}else if("MultiPolygon"===r){s=[];for(const t of n.geometry){const o=[];for(const i of t)o.push(Wt(i,e));s.push(o);}}o.push(Et(n.id,r,s,n.tags));}return o}function Wt(t,e){const o=[];o.size=t.size,void 0!==t.start&&(o.start=t.start,o.end=t.end);for(let i=0;i<t.length;i+=3)o.push(t[i]+e,t[i+1],t[i+2]);return o}function $t(t,e){if(t.transformed)return t;const o=1<<t.z,i=t.x,n=t.y;for(const r of t.features){const t=r.geometry,s=r.type;if(r.geometry=[],1===s)for(let s=0;s<t.length;s+=2)r.geometry.push(Ut(t[s],t[s+1],e,o,i,n));else for(let s=0;s<t.length;s++){const a=[];for(let r=0;r<t[s].length;r+=2)a.push(Ut(t[s][r],t[s][r+1],e,o,i,n));r.geometry.push(a);}}return t.transformed=!0,t}function Ut(t,e,o,i,n,r){return [Math.round(o*(t*i-n)),Math.round(o*(e*i-r))]}function Kt(t,e,o,i,n){const r=e===n.maxZoom?0:n.tolerance/((1<<e)*n.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:t.length,source:null,x:o,y:i,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const e of t)Ht(s,e,r,n);return s}function Ht(t,e,o,i){const n=e.geometry,r=e.type,s=[];if(t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),"Point"===r||"MultiPoint"===r)for(let e=0;e<n.length;e+=3)s.push(n[e],n[e+1]),t.numPoints++,t.numSimplified++;else if("LineString"===r)Qt(s,n,t,o,!1,!1);else if("MultiLineString"===r||"Polygon"===r)for(let e=0;e<n.length;e++)Qt(s,n[e],t,o,"Polygon"===r,0===e);else if("MultiPolygon"===r)for(let e=0;e<n.length;e++){const i=n[e];for(let e=0;e<i.length;e++)Qt(s,i[e],t,o,!0,0===e);}if(s.length){let o=e.tags||null;if("LineString"===r&&i.lineMetrics){o={};for(const t in e.tags)o[t]=e.tags[t];o.minemap_clip_start=n.start/n.size,o.minemap_clip_end=n.end/n.size;}const a={geometry:s,type:"Polygon"===r||"MultiPolygon"===r?3:"LineString"===r||"MultiLineString"===r?2:1,tags:o};null!==e.id&&(a.id=e.id),t.features.push(a);}}function Qt(t,e,o,i,n,r){const s=i*i;if(i>0&&e.size<(n?s:i))return void(o.numPoints+=e.length/3);const a=[];for(let t=0;t<e.length;t+=3)(0===i||e[t+2]>s)&&(o.numSimplified++,a.push(e[t],e[t+1])),o.numPoints++;n&&function(t,e){let o=0;for(let e=0,i=t.length,n=i-2;e<i;n=e,e+=2)o+=(t[e]-t[n])*(t[e+1]+t[n+1]);if(o>0===e)for(let e=0,o=t.length;e<o/2;e+=2){const i=t[e],n=t[e+1];t[e]=t[o-2-e],t[e+1]=t[o-1-e],t[o-2-e]=i,t[o-1-e]=n;}}(a,r),t.push(a);}const te={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0,projection:t.ProjectionType.MERCATOR};class ee{constructor(t,e){const o=(e=this.options=function(t,e){for(const o in e)t[o]=e[o];return t}(Object.create(te),e)).debug;if(o&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");let i=function(t,e){const o=[];if("FeatureCollection"===t.type)for(let i=0;i<t.features.length;i++)Dt(o,t.features[i],e,i);else Dt(o,"Feature"===t.type?t:{geometry:t},e);return o}(t,e);this.tiles={},this.tileCoords=[],o&&(console.timeEnd("preprocess data"),console.info("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),i=function(t,e){const o=e.buffer/e.extent;let i=t;const n=Gt(t,1,-1-o,o,0,-1,2,e),r=Gt(t,1,1-o,2+o,0,-1,2,e);return (n||r)&&(i=Gt(t,1,-o,1+o,0,-1,2,e)||[],n&&(i=Xt(n,1).concat(i)),r&&(i=i.concat(Xt(r,-1)))),i}(i,e),i.length&&this.splitTile(i,0,0,0),o&&(i.length&&console.info("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.info("tiles generated:",this.total,JSON.stringify(this.stats)));}splitTile(t,e,o,i,n,r,s){const a=[t,e,o,i],l=this.options,c=l.debug;for(;a.length;){i=a.pop(),o=a.pop(),e=a.pop(),t=a.pop();const h=1<<e,u=oe(e,o,i);let p=this.tiles[u];if(!p&&(c>1&&console.time("creation"),p=this.tiles[u]=Kt(t,e,o,i,l),this.tileCoords.push({z:e,x:o,y:i}),c)){c>1&&(console.info("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,o,i,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));const t=`z${e}`;this.stats[t]=(this.stats[t]||0)+1,this.total++;}if(p.source=t,null==n){if(e===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue}else {if(e===l.maxZoom||e===n)continue;if(null!=n){const t=n-e;if(o!==r>>t||i!==s>>t)continue}}if(p.source=null,0===t.length)continue;c>1&&console.time("clipping");const f=.5*l.buffer/l.extent,d=.5-f,g=.5+f,y=1+f;let m=null,x=null,w=null,v=null,b=Gt(t,h,o-f,o+g,0,p.minX,p.maxX,l),S=Gt(t,h,o+d,o+y,0,p.minX,p.maxX,l);t=null,b&&(m=Gt(b,h,i-f,i+g,1,p.minY,p.maxY,l),x=Gt(b,h,i+d,i+y,1,p.minY,p.maxY,l),b=null),S&&(w=Gt(S,h,i-f,i+g,1,p.minY,p.maxY,l),v=Gt(S,h,i+d,i+y,1,p.minY,p.maxY,l),S=null),c>1&&console.timeEnd("clipping"),a.push(m||[],e+1,2*o,2*i),a.push(x||[],e+1,2*o,2*i+1),a.push(w||[],e+1,2*o+1,2*i),a.push(v||[],e+1,2*o+1,2*i+1);}}getTile(t,e,o){t=+t,e=+e,o=+o;const i=this.options,{extent:n,debug:r}=i;if(t<0||t>24)return null;const s=1<<t,a=oe(t,e=e+s&s-1,o);if(this.tiles[a])return $t(this.tiles[a],n);r>1&&console.info("drilling down to z%d-%d-%d",t,e,o);let l,c=t,h=e,u=o;for(;!l&&c>0;)c--,h>>=1,u>>=1,l=this.tiles[oe(c,h,u)];return l&&l.source?(r>1&&(console.info("found parent tile z%d-%d-%d",c,h,u),console.time("drilling down")),this.splitTile(l.source,c,h,u,t,e,o),r>1&&console.timeEnd("drilling down"),this.tiles[a]?$t(this.tiles[a],n):null):null}}function oe(t,e,o){return 32*((1<<t)*o+e)+t}function ie(t,e,o){const i=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);const n=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!n)return e(null,null);const r=new j(n.features,o);let s=K(r);0===s.byteOffset&&s.byteLength===s.buffer.byteLength||(s=new Uint8Array(s)),e(null,{vectorTile:r,rawData:s.buffer});}class ne extends z{constructor(e,o,i,n){super(e,o,i,n),this.setDataLoaderFunction(ie),this.projection=n||t.ProjectionType.MERCATOR;}loadData(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData());}_loadData(){if(!this._pendingCallback||!this._pendingLoadDataParams)return;const e=this._pendingCallback,o=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;const i=o&&o.request,n=i&&i.collectResourceTiming;this.loadGeoJSON(o,((r,s)=>{if(r||!s)return e(r);if("object"!=typeof s)return e(new Error(`Input data given to '${o.source}' is not a valid GeoJSON object.`));{O(s,!0);try{if(o.filter){const e=t.createExpression(o.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===e.result)throw new Error(e.value.map((t=>`${t.key}: ${t.message}`)).join(", "));const i=s.features.filter((t=>e.value.evaluate({zoom:0},t)));s={type:"FeatureCollection",features:i};}o.geojsonVtOptions.projection=this.projection,this._geoJSONIndex=o.cluster?new xt(function({superclusterOptions:e,clusterProperties:o},i){if(e.isLatLon="LATLON"===i,!o||!e)return e.projection=i,e;const n={},r={},s={accumulated:null,zoom:0},a={properties:null},l=Object.keys(o);for(const e of l){const[i,s]=o[e],a=t.createExpression(s),l=t.createExpression("string"==typeof i?[i,["accumulated"],["get",e]]:i);n[e]=a.value,r[e]=l.value;}return e.map=t=>{a.properties=t;const e={};for(const t of l)e[t]=n[t].evaluate(s,a);return e},e.reduce=(t,e)=>{a.properties=e;for(const e of l)s.accumulated=t[e],t[e]=r[e].evaluate(s,a);},e.projection=i,e}(o,this.projection)).load(s.features):function(t,e){return new ee(t,e)}(s,o.geojsonVtOptions);}catch(r){return e(r)}this.loaded={};const a={};if(n){const t=k(i);t&&(a.resourceTiming={},a.resourceTiming[o.source]=JSON.parse(JSON.stringify(t)));}e(null,a);}}));}coalesce(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData());}reloadTile(t,e){const o=this.loaded;return o&&o[t.uid]?super.reloadTile(t,e):this.loadTile(t,e)}loadGeoJSON(e,o){if(e.request)t.getJSON(e.request,o);else {if("string"!=typeof e.data)return o(new Error("Input data is not a valid GeoJSON object."));try{return o(null,JSON.parse(e.data))}catch(t){return o(new Error("Input data is not a valid GeoJSON object."))}}}removeSource(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e();}getClusterExpansionZoom(t,e){e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId));}getClusterChildren(t,e){e(null,this._geoJSONIndex.getChildren(t.clusterId));}getClusterLeaves(t,e){e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset));}}class re{constructor(t,e,o,i){this.actor=t,this.loading={},this.loaded={},this.availableImages=o,this.projection=i;}registRequestController(t){this.irc=t;}loadTile(t,e){this._loadData(t,e);}_loadData(t,e){this.loading[t.uid]={imgRequest:null,binRequest:null};const o=t.uid;this.loading[o]=this.irc.pushRequest({id:o,param:t.request,cb:(t,i)=>{t&&e(t,null),delete this.loading[o],e(null,i);}}),this.irc.run();}reloadTile(t,e){this._loadData(t,e);const o=this.loaded,i=t.uid,n=this;if(o&&o[i]){const t=o[i],r=(o,i)=>{const r=t.reloadCallback;r&&(delete t.reloadCallback,t.parse(t.vectorTile,n.layerIndex,n.actor,r)),e(o,i);};"parsing"===t.status?t.reloadCallback=r:"done"===t.status&&t.parse(t.vectorTile,this.layerIndex,this.actor,r);}}abortTile(t,e){const o=this.loading,i=t.uid;o&&o[i]&&this.irc.removeRequestById(i),delete o[i],e();}removeTile(t,e){const o=this.loaded,i=t.uid;o&&o[i]&&delete o[i],e();}}class se{constructor(e,o,i,n){this.actor=e,this.loading={},this.loaded={},this.terrainTileParser=new t.TerrainTileParser,this.projection=n;}registRequestController(t){this.irc=t;}loadTile(t,e){this._loadData(t,e);}_loadData(t,e){const o=t.uid;this.loading[o]=this.irc.pushRequest({id:o,param:t.request,cb:(i,n)=>{i&&e(i,null);const r=this.terrainTileParser.createTerrain(n.data,t.tileID.canonical.x,t.tileID.canonical.y,t.tileID.canonical.z,this.projection,t.skirtHeight);delete this.loading[o],e(null,r);}}),this.irc.run();}reloadTile(t,e){this._loadData(t,e);const o=this.loaded,i=t.uid,n=this;if(o&&o[i]){const t=o[i],r=(o,i)=>{const r=t.reloadCallback;r&&(delete t.reloadCallback,t.parse(t.vectorTile,n.layerIndex,n.actor,r)),e(o,i);};"parsing"===t.status?t.reloadCallback=r:"done"===t.status&&t.parse(t.vectorTile,this.layerIndex,this.actor,r);}}abortTile(t,e){const o=this.loading,i=t.uid;o&&o[i]&&(this.irc.removeRequestById(i),delete o[i]),e();}removeTile(t,e){const o=this.loaded,i=t.uid;o&&o[i]&&delete o[i],e();}}class ae{constructor(e){this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.requestPerformanceManager=new t.RequestPerformanceManger,this.workerSourceTypes={vector:z,geojson:ne,raster:re,terrain:se},this.workerSources={},this.self.registerWorkerSource=(t,e)=>{if(this.workerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.workerSourceTypes[t]=e;},this.self.registerRTLTextPlugin=e=>{if(t.plugin.isParsed())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText;};}clearCaches(t,e,o){delete this.layerIndexes[t],delete this.availableImages[t],delete this.workerSources[t],o();}spriteLoaded(e,o){this.isSpriteLoaded[e]=o;for(const i in this.workerSources[e]){const n=this.workerSources[e][i];for(const e in n)n[e]instanceof z&&(n[e].isSpriteLoaded=o,n[e].fire&&n[e].fire(new t.Event("isSpriteLoaded")));}}setImages(t,e,o){this.availableImages[t]=e;for(const o in this.workerSources[t]){const i=this.workerSources[t][o];for(const t in i)i[t].availableImages=e;}o();}setProjection(t,e,o){this.projection=e.projection,o();}setReferrer(t,e){this.referrer=e;}setLayers(t,e,o){this.getLayerIndex(t).replace(e),o();}updateLayers(t,e,o){this.getLayerIndex(t).update(e.layers,e.removedIds),o();}loadTile(t,e,o){e.projection=this.projection,this.getWorkerSource(t,e.type,e.source).loadTile(e,o);}reloadTile(t,e,o){this.getWorkerSource(t,e.type,e.source).reloadTile(e,o);}abortTile(t,e,o){this.getWorkerSource(t,e.type,e.source).abortTile(e,o);}removeTile(t,e,o){this.getWorkerSource(t,e.type,e.source).removeTile(e,o);}removeSource(t,e,o){if(!this.workerSources[t]||!this.workerSources[t][e.type]||!this.workerSources[t][e.type][e.source])return;const i=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==i.removeSource?i.removeSource(e,o):o();}trianglesIntersact(t,e,o){"raster"===e.type&&this.getWorkerSource(t,e.type,e.source).trianglesIntersact(e,o);}loadWorkerSource(t,e,o){try{this.self.importScripts(e.url),o();}catch(t){o(t.toString());}}syncRTLPluginState(e,o,i){try{t.plugin.setState(o);const e=t.plugin.getPluginURL();if(t.plugin.isLoaded()&&!t.plugin.isParsed()&&null!=e){this.self.importScripts(e);const o=t.plugin.isParsed();i(o?void 0:new Error(`RTL Text Plugin failed to import scripts from ${e}`),o);}}catch(t){i(t.toString());}}getLayerIndex(t){let e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new i),e}getAvailableImages(t){let e=this.availableImages[t];return e||(e=[]),e}fetchLoadersTilesData(e,o,i){o.json?t.getJSON(o.requestOptions,((t,e)=>{i(t,e);})):t.getArrayBuffer(o.requestOptions,((e,o)=>{o&&(o=t.decodeModel(o)),i(e,o);}));}loadRegularTile(e,o,i){i(null,t.tileSamplesGrid(o.tileID,this.projection));}caculateViewdomeRatio(e,o,i){let n=0,r=0,s=0;for(let e=0;e<o.data.length;e++){const i=o.data[e];for(let e=0;e<i.length;e+=4){const o=t.Vector4.unpack(i,e,new t.Vector4);255===o.w&&(255===o.x?n++:255===o.y&&r++);}}s=0==r&&0===r?0:r/(n+r),i(null,s);}toggleRequestStatus(t,e){e?this.requestPerformanceManager.pauseVectorRequest():this.requestPerformanceManager.restartVectorRequest();}getWorkerSource(e,o,i){if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][o]||(this.workerSources[e][o]={}),!this.workerSources[e][o][i]){const n={send:(t,o,i)=>{this.actor.send(t,o,i,e);}},r=this.projection||t.ProjectionType.MERCATOR;this.workerSources[e][o][i]=new this.workerSourceTypes[o](n,this.getLayerIndex(e),this.getAvailableImages(e),r,this.isSpriteLoaded[e]),"raster"===o?this.workerSources[e][o][i].registRequestController(this.requestPerformanceManager.getImageRequesterById(i)):"vector"===o||"geojson"===o?this.workerSources[e][o][i].registRequestController(this.requestPerformanceManager.getVectorRequesterById(i)):"terrain"===o&&this.workerSources[e][o][i].registRequestController(this.requestPerformanceManager.getTerrainRequesterById(i));}return this.workerSources[e][o][i]}}return "undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new ae(self)),ae}));

define(["./shared"],(function(e){"use strict";"function"!=typeof Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");e=Object(e);for(let t=1;t<arguments.length;t++){const i=arguments[t];if(null!=i)for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t]);}return e});const t={VISIBLE:0,HIDDEN:1,ALL:2,NONE:3},i={AUTONOMOUS_COMPUTING:0,ACCEPT_COMPUTING:1};function s(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return !1;for(let i=0;i<e.length;i++)if(!s(e[i],t[i]))return !1;return !0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t)return !1;if(Object.keys(e).length!==Object.keys(t).length)return !1;for(const i in e)if(!s(e[i],t[i]))return !1;return !0}return e===t}const r=e=>null!=e;class n{constructor(t={}){t={near:1,far:5e8,xOffset:0,yOffset:0,...t},this._offCenterFrustum=new e.PerspectiveOffCenterFrustum,this.fov=t.fov,this._fov=t.fov,this._fovy=t.fovy||2*Math.atan(Math.tan(.5*this.fov)/t.aspectRatio),this._sseDenominator=void 0,this.aspectRatio=t.aspectRatio,this._aspectRatio=void 0,this.near=t.near,this._near=this.near,this.far=t.far,this._far=this.far,this.xOffset=t.xOffset,this._xOffset=this.xOffset,this.yOffset=t.yOffset,this._yOffset=this.yOffset;}clone(e){return r(e)||(e=new n({fov:this.fov,fovy:this.fovy,near:this.near,far:this.far,aspectRatio:this.aspectRatio})),e._aspectRatio=void 0,e._fov=void 0,e._near=void 0,e._far=void 0,this._offCenterFrustum.clone(e._offCenterFrustum),e}equals(e){return !!(r(e)&&e instanceof n)&&(o(this),o(e),this.fov===e.fov&&this.aspectRatio===e.aspectRatio&&this.near===e.near&&this.far===e.far&&this._offCenterFrustum.equals(e._offCenterFrustum))}equalsEpsilon(t,i,s){return !!(r(t)&&t instanceof n)&&(o(this),o(t),e.CONSTS.CesiumMath.equalsEpsilon(this.fov,t.fov,i,s)&&e.CONSTS.CesiumMath.equalsEpsilon(this.aspectRatio,t.aspectRatio,i,s)&&this._offCenterFrustum.equalsEpsilon(t._offCenterFrustum,i,s))}get projectionMatrix(){return o(this),this._offCenterFrustum.projectionMatrix}get infiniteProjectionMatrix(){return o(this),this._offCenterFrustum.infiniteProjectionMatrix}get fovy(){return o(this),this._fovy}get sseDenominator(){return o(this),this._sseDenominator}computeCullingVolume(e,t,i){return o(this),this._offCenterFrustum.computeCullingVolume(e,t,i)}setFromMatrix(e){return o(this),this._offCenterFrustum.setFromMatrix(e)}getPixelDimensions(e,t,i,s,r){return o(this),this._offCenterFrustum.getPixelDimensions(e,t,i,s,r)}}function o(e){const t=e._offCenterFrustum;e.fov===e._fov&&e.aspectRatio===e._aspectRatio&&e.near===e._near&&e.far===e._far&&e.xOffset===e._xOffset&&e.yOffset===e._yOffset||(e._aspectRatio=e.aspectRatio,e._fov=e.fov,e._near=e.near,e._far=e.far,e._sseDenominator=2*Math.tan(.5*e._fovy),e._xOffset=e.xOffset,e._yOffset=e.yOffset,t.top=e.near*Math.tan(.5*e._fovy),t.bottom=-t.top,t.right=e.aspectRatio*t.top,t.left=-t.right,t.near=e.near,t.far=e.far,t.right+=e.xOffset,t.left+=e.xOffset,t.top+=e.yOffset,t.bottom+=e.yOffset);}class a{constructor(e){this.camerapos=void 0,this.cullingVolume=void 0,this.dir=void 0,this.up=void 0,this.type=e.type,this.updateFrustum(e);}updateFrustum(t){const{width:i,near:s,far:r,fov:o,fovy:a,aspectRatio:l}=t;switch(this.type){case"perspective":this.fov=a,this.frustum=new n({fov:o,fovy:a,near:s,far:r,aspectRatio:l});break;case"orthographic":this.frustum=new e.OrthographicFrustum({width:i,far:r,near:s,aspectRatio:l});}}updateCullingVolume(e,t,i){this.camerapos=e,this.dir=t,this.up=i,this.cullingVolume=this.frustum.computeCullingVolume(e,this.dir,this.up);}}class l extends e.Camera{constructor(t,i,s,r){super(),this.type="PerspectiveCamera",this.isPerspectiveCamera=!0,this.fov=void 0!==t?t:60,this.zoom=1,this.mapZoom=0,this.near=void 0!==s?s:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==i?i:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix();const n=e.Cartographic.fromVector3(this.rectangleCameraPosition3D(e.Rectangle.fromDegrees(100,-20,120,90),this.positionWC,!0));this.position=e.Vector3.fromRadians(n.longitude,n.latitude,19134411),this._initializedHeadingPitchRoll();}updatePerspectiveOptions(e){e.hasOwnProperty("fov")&&(this.fov=e.fov),e.hasOwnProperty("aspect")&&(this.aspect=e.aspect),e.hasOwnProperty("near")&&(this.near=e.near),e.hasOwnProperty("far")&&(this.far=e.far),this.updateProjectionMatrix();}setFocalLength(t){const i=.5*this.getFilmHeight()/t;this.fov=2*e.CONSTS.TRANSFORM.RAD_TO_DEG*Math.atan(i),this.updateProjectionMatrix();}getFocalLength(){const t=Math.tan(.5*e.CONSTS.TRANSFORM.DEG_TO_RAD*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*e.CONSTS.TRANSFORM.RAD_TO_DEG*Math.atan(Math.tan(.5*e.CONSTS.TRANSFORM.DEG_TO_RAD*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,s,r,n){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=n,this.updateProjectionMatrix();}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix();}updateProjectionMatrix(){const t=this.near,i=e.CONSTS.TRANSFORM.DEG_TO_RAD*this.fov;this.frustumCrate?this.frustumCrate.updateFrustum({near:t,far:this.far,fovy:i,fov:2*Math.atan(this.aspect*Math.tan(i/2)),aspectRatio:this.aspect}):this.frustumCrate=new a({near:t,far:this.far,fovy:i,fov:2*Math.atan(this.aspect*Math.tan(i/2)),aspectRatio:this.aspect,type:"perspective"}),this.projectionMatrix=this.frustumCrate.frustum.projectionMatrix,this.projectionMatrixInverse=this.projectionMatrix.clone().invert();}static clone(t,i){return e.defined(i)||(i=new l(t.fov,t.aspect,t.near,t.far)),e.Vector3.clone(t.positionNew,i.positionNew),e.Vector3.clone(t.directionNew,i.directionNew),e.Vector3.clone(t.rightNew,i.rightNew),e.Vector3.clone(t.upNew,i.upNew),i._updateCameraChanged(),i.setMatrix(i._invViewMatrix.clone()),i.frustumCrate.frustum=t.frustumCrate.frustum.clone(),i._transformChanged=!0,i}serialize(){return {type:"PerspectiveCamera",fov:this.fov,aspect:this.aspect,near:this.near,far:this.far,matrix:this.matrixWorld}}}class h extends e.Camera{constructor(t,i,s,r){super(),this.type="OrthographicCamera",this.isOrthographicCamera=!0,this.zoom=1,this.view=null,this.aspectRatio=e.defined(i)?i:1,this.width=e.defined(t)?t:1,this.near=e.defined(s)?s:.1,this.far=e.defined(r)?r:2e3,this.projectMatrix=new e.Matrix4,this.vMatrix=new e.Matrix4,this.vpMatrix=new e.Matrix4,this._painter=null,this.updateProjectionMatrix();}updateOrthographicOptions(e){e.hasOwnProperty("width")&&(this.width=e.width),e.hasOwnProperty("aspectRatio")&&(this.aspectRatio=e.aspectRatio),e.hasOwnProperty("near")&&(this.near=e.near),e.hasOwnProperty("far")&&(this.far=e.far),this.updateProjectionMatrix();}setViewOffset(e,t,i,s,r,n){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=n,this.updateProjectionMatrix();}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix();}updateProjectionMatrix(){this.frustumCrate?this.frustumCrate.updateFrustum({width:this.width,near:this.near,far:this.far,aspectRatio:this.aspectRatio}):this.frustumCrate=new a({width:this.width,near:this.near,far:this.far,aspectRatio:this.aspectRatio,type:"orthographic"}),this.projectionMatrix=this.frustumCrate.frustum.projectionMatrix,this.projectionMatrixInverse=this.projectionMatrix.clone().invert();}update(){if(!this._painter.frameState.camera)return;const e=this._painter.frameState.sunLight;e&&(this.timestamp=e.timestamp,this.initViewMatrix(e),this.updateVPMatrix());}initViewMatrix(t){const i=this._painter.frameState.camera.frustumCrate.camerapos;return this.lightRight=new e.Vector3,this.lightUp=new e.Vector3(-.06079590320587158,.17691355105489492,.982346910983324),this.lightDir=e.Vector3.clone(t.getSunDirectionGlobalWithCache()),this.lightDir=e.Vector3.multiplyByScalar(this.lightDir,-1,this.lightDir),this.lightPosition=i,e.Vector3.cross(this.lightDir,this.lightUp,this.lightRight),this.lightUp=e.Vector3.cross(this.lightRight,this.lightDir,new e.Vector3),e.Vector3.normalize(this.lightUp,this.lightUp),e.Vector3.normalize(this.lightRight,this.lightRight),e.Matrix4.computeView(this.lightPosition,this.lightDir,this.lightUp,this.lightRight,this.vMatrix)}updateVPMatrix(){if(this._painter.renderGroup.modelTranslucentPrimitiveList.length>0||this._painter.renderGroup.modelTranslucentPrimitiveList.length>0){const t=this.getBoundingBox(this._painter),i=t.max,s=t.min;this.lightPosition=e.Matrix4.multiplyByVector(e.Matrix4.inverse(this.vMatrix,new e.Matrix4),e.Vector4.fromElements((s.x+i.x)/2,(s.y+i.y)/2,-s.z,1),new e.Vector4),e.Matrix4.computeView(this.lightPosition,this.lightDir,this.lightUp,this.lightRight,this.vMatrix),this.updateProjectMatrix(s,i),this.vpMatrix=new e.Matrix4,e.Matrix4.multiply(this.vpMatrix,this.projectMatrix,this.vMatrix);}}updateProjectMatrix(t,i){const s=.5*(i.x-t.x),r=.5*(i.y-t.y),n=-s,o=s,a=-r,l=r,h=-.1,_=-(i.z-t.z),c=new e.Matrix4;c[0]=2/(o-n),c[5]=2/(l-a),c[10]=2/(_-h),c[12]=-(o+n)/(o-n),c[13]=-(l+a)/(l-a),c[14]=-(_+h)/(_-h),c[15]=1,this.projectMatrix=c;}getBoundingBox(t){const i=this.getNearFar(t,this.lightPosition,this.lightDir),s=this.getNearFar(t,this.lightPosition,this.lightRight),r=this.getNearFar(t,this.lightPosition,this.lightUp);return {min:e.Vector3.fromElements(s[0],r[0],i[0]),max:e.Vector3.fromElements(s[1],r[1],i[1])}}getNearFar(e,t,i){let s=this.getMaxMin(e.renderGroup.modelTranslucentPrimitiveList,t,i,{near:+Number.MAX_VALUE,far:-Number.MAX_VALUE});return s=this.getMaxMin(e.renderGroup.modelOpaquePrimitiveList,t,i,s),[s.near,s.far]}getMaxMin(e,t,i,s={}){let r=s.near,n=s.far;for(let s=0;s<e.length;s++){const o=e[s];if(o.boundingVolume){const e=o.boundingVolume.computePlaneDistances(t,i),s=e.stop;r=Math.min(r,e.start),n=Math.max(n,s);}}return {near:r,far:n}}serialize(){return {type:"OrthographicCamera",width:this.width,aspect:this.aspectRatio,near:this.near,far:this.far,matrix:this.matrixWorld}}}var _=Object.freeze({LOOP_REPEAT:0,LOOP_ONCE:1,LOOP_NONE:2});const c={NONE:0,PRECISE:1,MEDIUM:2,STABLE:3};let d;d="undefined"!=typeof navigator?e.window.navigator:{};const u=e=>{const t=e.split(".");for(let e=0,i=t.length;e<i;++e)t[e]=parseInt(t[e],10);return t};let m,p;const f=()=>{if(!e.defined(m)&&(m=!1,!M())){const e=/ Chrome\/([\.0-9]+)/.exec(d.userAgent);null!==e&&(m=!0,p=u(e[1]));}return m};let g,y;const T=()=>{if(!e.defined(g)&&(g=!1,!f()&&!M()&&/ Safari\/[\.0-9]+/.test(d.userAgent))){const e=/ Version\/([\.0-9]+)/.exec(d.userAgent);null!==e&&(g=!0,y=u(e[1]));}return g};let C,x;const b=()=>{if(!e.defined(C)){C=!1;const e=/ AppleWebKit\/([\.0-9]+)(\+?)/.exec(d.userAgent);null!==e&&(C=!0,x=u(e[1]),x.isNightly=!!e[2]);}return C};let v,w;const S=()=>{if(!e.defined(v)){let e;v=!1,"Microsoft Internet Explorer"===d.appName?(e=/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(d.userAgent),null!==e&&(v=!0,w=u(e[1]))):"Netscape"===d.appName&&(e=/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(d.userAgent),null!==e&&(v=!0,w=u(e[1])));}return v};let A,E;const M=()=>{if(!e.defined(A)){A=!1;const e=/ Edg\/([\.0-9]+)/.exec(d.userAgent);null!==e&&(A=!0,E=u(e[1]));}return A};let P,R;const B=()=>{if(!e.defined(P)){P=!1;const e=/Firefox\/([\.0-9]+)/.exec(d.userAgent);null!==e&&(P=!0,R=u(e[1]));}return P};let I,D,O,L,V;const N=()=>{if(!e.defined(V)){const t=e.window.document.createElement("canvas");t.setAttribute("style","image-rendering: -moz-crisp-edges;image-rendering: pixelated;");const i=t.style.imageRendering;V=e.defined(i)&&""!==i,V&&(L=i);}return V},F=()=>{if(!F.initialized)throw new Error("You must call FeatureDetection.supportsWebP.initialize and wait for the promise to resolve before calling FeatureDetection.supportsWebP");return F._result};F._promise=void 0,F._result=void 0,F.initialize=()=>(e.defined(F._promise)||(F._promise=new Promise((t=>{const i=new e.window.Image;i.onload=()=>{F._result=i.width>0&&i.height>0,t(F._result);},i.onerror=()=>{F._result=!1,t(F._result);},i.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA";}))),F._promise),Object.defineProperties(F,{initialized:{get:()=>e.defined(F._result)}});const G=[];"undefined"!=typeof ArrayBuffer&&(G.push(Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array),"undefined"!=typeof Uint8ClampedArray&&G.push(Uint8ClampedArray),"undefined"!=typeof Uint8ClampedArray&&G.push(Uint8ClampedArray),"undefined"!=typeof BigInt64Array&&G.push(BigInt64Array),"undefined"!=typeof BigUint64Array&&G.push(BigUint64Array));const k={isChrome:f,chromeVersion:()=>f()&&p,isSafari:T,safariVersion:()=>T()&&y,isWebkit:b,webkitVersion:()=>b()&&x,isInternetExplorer:S,internetExplorerVersion:()=>S()&&w,isEdge:M,edgeVersion:()=>M()&&E,isFirefox:B,firefoxVersion:()=>B()&&R,isWindows:()=>(e.defined(I)||(I=/Windows/i.test(d.appVersion)),I),isIPadOrIOS:()=>(e.defined(D)||(D="iPhone"===e.window.navigator.platform||"iPod"===e.window.navigator.platform||"iPad"===e.window.navigator.platform),D),hardwareConcurrency:e.defaultValue(d.hardwareConcurrency,3),supportsPointerEvents:()=>(e.defined(O)||(O=!B()&&"undefined"!=typeof PointerEvent&&(!e.defined(d.pointerEnabled)||d.pointerEnabled)),O),supportsImageRenderingPixelated:N,supportsWebP:F,imageRenderingValue:()=>N()?L:void 0,typedArrayTypes:G,supportsBasis:e=>k.supportsWebAssembly()&&e.context.supportsBasis,supportsTypedArrays:()=>"undefined"!=typeof ArrayBuffer,supportsBigInt64Array:()=>"undefined"!=typeof BigInt64Array,supportsBigUint64Array:()=>"undefined"!=typeof BigUint64Array,supportsBigInt:()=>"undefined"!=typeof BigInt,supportsWebWorkers:()=>"undefined"!=typeof Worker,supportsWebAssembly:()=>"undefined"!=typeof WebAssembly,supportsWebgl2:e=>e.context.webgl2,supportsEsmWebWorkers:()=>!B()||parseInt(R)>=114};class U{get length(){return this._values.length}get values(){return this._values}constructor(){this._values=[],this._hash={};}contains(t){if("string"!=typeof t&&"number"!=typeof t)throw new Error("key is required to be a string or number.");return e.defined(this._hash[t])}set(e,t){if("string"!=typeof e&&"number"!=typeof e)throw new Error("key is required to be a string or number.");return t!==this._hash[e]&&(this.remove(e),this._hash[e]=t,this._values.push(t)),t}get(e){if("string"!=typeof e&&"number"!=typeof e)throw new Error("key is required to be a string or number.");return this._hash[e]}remove(t){if(e.defined(t)&&"string"!=typeof t&&"number"!=typeof t)throw new Error("key is required to be a string or number.");const i=this._hash[t];if(e.defined(i)){const e=this._values;e.splice(e.indexOf(i),1),delete this._hash[t];}return i}removeAll(){const e=this._values;e.length>0&&(this._hash={},e.length=0);}getAll(){return this._hash}}let H;H="undefined"!=typeof performance&&"function"==typeof performance.now&&isFinite(performance.now())?function(){return performance.now()}:function(){return Date.now()};var z=H;const W={create:function(t,i,s){const r=e.window.document.createElement(t);return void 0!==i&&(r.className=i),s&&s.appendChild(r),r},createNS:function(t,i){return e.window.document.createElementNS(t,i)}},j=e.window.document&&e.window.document.documentElement.style,X=j&&void 0!==j.userSelect?"userSelect":"WebkitUserSelect";let q;W.disableDrag=function(){j&&X&&(q=j[X],j[X]="none");},W.enableDrag=function(){j&&X&&(j[X]=q);},W.setTransform=function(e,t){e.style.transform=t;};const K=function(e){if(!j)return null;for(let t=0;t<e.length;t++)if(e[t]in j)return e[t];return e[0]}(["transformOrigin","WebkitTransformOrigin"]);W.setTransformOrigin=function(e,t){e.style[K]=t;},W.getAllStyle=function(t){return e.window.getComputedStyle(t)};let J=!1;try{const t=Object.defineProperty({},"passive",{get(){J=!0;}});e.window.addEventListener("test",t,t),e.window.removeEventListener("test",t,t);}catch(e){J=!1;}W.addEventListener=function(e,t,i,s={}){e.addEventListener(t,i,"passive"in s&&J?s:s.capture);},W.removeEventListener=function(e,t,i,s={}){e.removeEventListener(t,i,"passive"in s&&J?s:s.capture);};const Z=function(t){t.preventDefault(),t.stopPropagation(),e.window.removeEventListener("click",Z,!0);};function Y(t,i,s){const r=t.offsetWidth===i.width?1:t.offsetWidth/i.width;return new e.pointGeometry3d((s.clientX-i.left)*r,(s.clientY-i.top)*r)}W.suppressClick=function(){e.window.addEventListener("click",Z,!0),e.window.setTimeout((()=>{e.window.removeEventListener("click",Z,!0);}),0);},W.mousePos=function(e,t){const i=e.getBoundingClientRect();return Y(e,i,t=t.touches?t.touches[0]:t)},W.touchPos=function(e,t){const i=e.getBoundingClientRect(),s=[];for(let r=0;r<t.length;r++)s.push(Y(e,i,t[r]));return s},W.mouseButton=function(t){return void 0!==e.window.InstallTrigger&&2===t.button&&t.ctrlKey&&e.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button},W.remove=function(e){e.parentNode&&e.parentNode.removeChild(e);};class Q extends e.Event{preventDefault(){this._defaultPrevented=!0;}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,s,r={}){const n=W.mousePos(i.getCanvasContainer(),s),o=i.unproject(n);super(t,e.extend({point:n,lngLat:o,originalEvent:s},r)),this._defaultPrevented=!1,this.target=i;}}class $ extends e.Event{preventDefault(){this._defaultPrevented=!0;}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,s){const r="touchend"===t?s.changedTouches:s.touches,n=W.touchPos(i.getCanvasContainer(),r),o=n.map((e=>i.unproject(e))),a=n.reduce(((e,t,i,s)=>e.add(t.div(s.length))),new e.pointGeometry3d(0,0));super(t,{points:n,point:a,lngLats:o,lngLat:i.unproject(a),originalEvent:s}),this._defaultPrevented=!1;}}var ee=Object.freeze({SHIFT:0,CTRL:1,ALT:2}),te=Object.freeze({LEFT_DOWN:0,LEFT_UP:1,LEFT_CLICK:2,LEFT_DOUBLE_CLICK:3,RIGHT_DOWN:5,RIGHT_UP:6,RIGHT_CLICK:7,MIDDLE_DOWN:10,MIDDLE_UP:11,MIDDLE_CLICK:12,MOUSE_MOVE:15,WHEEL_START:16,WHEEL:17,WHEEL_ZOOM:31,WHEEL_END:18,PINCH_START:19,PINCH_END:20,PINCH_MOVE:21,ROTATE_START:22,ROTATE:23,ROTATE_END:24,PITCH_START:25,PITCH:26,PITCH_END:27,MOVE_START:28,MOVE:29,MOVE_END:30});const ie=e.window.document,se=e=>{let t;switch(e){case 0:case 5:case 10:t="mousedown";break;case 1:case 6:case 11:t="mouseup";break;case 2:case 12:t="click";break;case 7:t="contextmenu";break;case 3:t="dblclick";break;case 15:t="mousemove";break;case 17:t="wheel";break;case 19:t="touchstart";break;case 20:t="touchend";break;case 21:t="touchmove";}return t},re=e=>{const t=[];switch(e){case"mousedown":t.push(te.LEFT_DOWN),t.push(te.RIGHT_DOWN),t.push(te.MIDDLE_DOWN);break;case"mouseup":t.push(te.LEFT_UP),t.push(te.MIDDLE_UP),t.push(te.RIGHT_UP);break;case"mousemove":t.push(te.MOUSE_MOVE);break;case"movestart":t.push(te.MOVE_START);break;case"move":t.push(te.MOVE);break;case"moveend":t.push(te.MOVE_END);break;case"click":t.push(te.LEFT_CLICK),t.push(te.MIDDLE_CLICK);break;case"dblclick":t.push(te.LEFT_DOUBLE_CLICK);break;case"contextmenu":t.push(te.RIGHT_CLICK);break;case"wheel":t.push(te.WHEEL);break;case"zoomstart":t.push(te.WHEEL_START);break;case"zoom":t.push(te.WHEEL_ZOOM);break;case"zoomend":t.push(te.WHEEL_END);break;case"rotatestart":t.push(te.ROTATE_START);break;case"rotate":t.push(te.ROTATE);break;case"rotateend":t.push(te.ROTATE_END);break;case"pitchstart":t.push(te.PITCH_START);break;case"pitch":t.push(te.PITCH);break;case"pitchend":t.push(te.PITCH_END);break;case"touchstart":t.push(te.PINCH_START);break;case"touchmove":t.push(te.PINCH_MOVE);break;case"touchend":t.push(te.PINCH_END);}return t},ne=(e,t,i)=>{const s=e._element;if(s===ie)return i.x=t.clientX,i.y=t.clientY,i;const r=s.getBoundingClientRect();return i.x=t.clientX-r.left,i.y=t.clientY-r.top,i},oe=(t,i)=>{let s=t;return e.defined(i)&&(s+=`+${i}`),s};function ae(e){return e.shiftKey?ee.SHIFT:e.ctrlKey?ee.CTRL:e.altKey?ee.ALT:void 0}const le=(e,t,i,s)=>{function r(t){e._elementEvent=t,s(e,t);}k.isInternetExplorer()?i.addEventListener(t,r,!1):i.addEventListener(t,r,{passive:!1}),e._removalFunctions.push((()=>{i.removeEventListener(t,r,!1);}));},he={position:new e.Vector2},_e=e=>{e._lastSeenTouchEvent=z();},ce=e=>z()-e._lastSeenTouchEvent>Ge.mouseEmulationIgnoreMilliseconds;function de(e,t,i){const s=e.x-t.x,r=e.y-t.y;return Math.sqrt(s*s+r*r)<i}const ue=(t,i)=>{if(!ce(t))return;const s=i.button;let r;if(t._buttonDown[s]=!0,0===s)r=te.LEFT_DOWN;else if(1===s)r=te.MIDDLE_DOWN;else {if(2!==s)return;r=te.RIGHT_DOWN;}const n=ne(t,i,t._primaryPosition);e.Vector2.clone(n,t._primaryStartPosition),e.Vector2.clone(n,t._primaryPreviousPosition);const o=ae(i);t._outputMouseEvents||t._map.boxZoom.mousedown(i,new e.pointGeometry3d(n.x,n.y));const a=t.getInputAction(r,o),l=t.getOnceInputAction(r,o);if(e.defined(a)){if(e.Vector2.clone(n,he.position),t._outputMouseEvents){const e=new Q(se(r),t._map,i);for(let t=0;t<a.length;t++)a[t](e);}else for(let e=0;e<a.length;e++)a[e](he);i.preventDefault();}e.defined(l)&&(fe(t,l,i,n.clone(),r),t.removeOnceInputAction(r));},me={position:new e.Vector2},pe={position:new e.Vector2},fe=(e,t,i,s,r)=>{if(e._outputMouseEvents){const s=new Q(se(r),e._map,i);for(let e=0;e<t.length;e++)t[e](s);}},ge=(t,i,s,r)=>{const n=ae(r),o=t.getInputAction(i,n);if(e.defined(o)){const s=ne(t,r,t._primaryPosition);if(e.defined(o))if(e.Vector2.clone(s,me.position),t._outputMouseEvents){const e=new Q(se(i),t._map,r);for(let t=0;t<o.length;t++)o[t](e);}else for(let e=0;e<o.length;e++)o[e](pe);}const a=t.getInputAction(s,n);if(e.defined(a)){const i=ne(t,r,t._primaryPosition);if(de(t._primaryStartPosition,i,t._clickPixelTolerance))if(e.Vector2.clone(i,pe.position),t._outputMouseEvents){const e=se(s);if("click"!==e){const i=new Q(e,t._map,r);for(let e=0;e<a.length;e++)a[e](i);}}else for(let e=0;e<a.length;e++)a[e](pe);}const l=t.getOnceInputAction(i,n);if(e.defined(l)){const e=ne(t,r,t._primaryPosition);fe(t,l,r,e.clone(),i),t.removeOnceInputAction(i);}const h=t.getOnceInputAction(s,n);if(e.defined(h)){const e=ne(t,r,t._primaryPosition);fe(t,h,r,e.clone(),s),t.removeOnceInputAction(s);}},ye=(e,t)=>{if(!ce(e))return;const i=t.button;0!==i&&1!==i&&2!==i||(e._outputMouseEvents||e._map.boxZoom.mouseupWindow(t),e._buttonDown[0]&&(ge(e,te.LEFT_UP,te.LEFT_CLICK,t),e._buttonDown[0]=!1),e._buttonDown[1]&&(ge(e,te.MIDDLE_UP,te.MIDDLE_CLICK,t),e._buttonDown[1]=!1),e._buttonDown[2]&&(ge(e,te.RIGHT_UP,te.RIGHT_CLICK,t),e._buttonDown[2]=!1));},Te={startPosition:new e.Vector2,endPosition:new e.Vector2},Ce=(t,i)=>{if(!ce(t))return;const s=ae(i),r=ne(t,i,t._primaryPosition),n=t._primaryPreviousPosition;t._outputMouseEvents||t._map.boxZoom.mousemoveWindow(i,new e.pointGeometry3d(r.x,r.y));const o=t.getInputAction(te.MOUSE_MOVE,s),a=t.getOnceInputAction(te.MOUSE_MOVE,s);if(e.defined(o)||e.defined(a)){if(e.Vector2.clone(n,Te.startPosition),e.Vector2.clone(r,Te.endPosition),t._outputMouseEvents){const e=new Q(se(te.MOUSE_MOVE),t._map,i);for(let t=0;t<o.length;t++)o[t](e);}else for(let e=0;e<o.length;e++)o[e](Te);e.defined(a)&&(fe(t,a,i,r.clone(),te.MOUSE_MOVE),t.removeOnceInputAction(te.MOUSE_MOVE));}e.Vector2.clone(r,n),(t._buttonDown[0]||t._buttonDown[1]||t._buttonDown[2])&&i.preventDefault();},xe=(t,i)=>{let s;if(0!==i.button)return;s=te.LEFT_CLICK;const r=ae(i),n=t.getInputAction(s,r),o=t.getOnceInputAction(s,r);if(e.defined(n)||o){const r=ne(t,i,t._primaryPosition);if(de(t._primaryStartPosition,r,t._clickPixelTolerance)){if(t._outputMouseEvents){const e=new Q(se(s),t._map,i);for(let t=0;t<n.length;t++)n[t](e);}e.defined(o)&&(fe(t,o,i,pe.position.clone(),s),t.removeOnceInputAction(s));}}},be={position:new e.Vector2},ve=(t,i)=>{let s;if(0!==i.button)return;s=te.LEFT_DOUBLE_CLICK;const r=ae(i),n=t.getInputAction(s,r),o=t.getOnceInputAction(s,r);if(e.defined(n)||o){if(ne(t,i,be.position),t._outputMouseEvents){const e=new Q(se(s),t._map,i);for(let t=0;t<n.length;t++)n[t](e);}else for(let e=0;e<n.length;e++)n[e](be);e.defined(o)&&(fe(t,o,i,be.position.clone(),s),t.removeOnceInputAction(s));}},we=(t,i)=>{let s;if(e.defined(i.deltaY)){const e=i.deltaMode;s=e===i.DOM_DELTA_PIXEL?-i.deltaY:e===i.DOM_DELTA_LINE?40*-i.deltaY:120*-i.deltaY;}else s=i.detail>0?-120*i.detail:i.wheelDelta;if(!e.defined(s))return;ne(t,i,t._primaryPosition),t._isRollerWheel=!0;const r=t.getInputAction(te.WHEEL,void 0);if(e.defined(r)){if(t._outputMouseEvents){const e=new Q(se(te.WHEEL),t._map,i);for(let t=0;t<r.length;t++)r[t](e);}else for(let e=0;e<r.length;e++)r[e](s);i.preventDefault();}},Se=(e,t)=>{e._map.keyboard.keydown(t);},Ae=(t,i)=>{_e(t);const s=i.changedTouches;let r;const n=s.length;let o,a;const l=t._positions;for(r=0;r<n;++r)o=s[r],a=o.identifier,l.set(a,ne(t,o,new e.Vector2));Oe(t,i);const h=t._previousPositions;for(r=0;r<n;++r)o=s[r],a=o.identifier,h.set(a,e.Vector2.clone(l.get(a)));},Ee=(e,t)=>{_e(e);const i=t.changedTouches;let s;const r=i.length;let n,o;const a=e._positions;for(s=0;s<r;++s)n=i[s],o=n.identifier,a.remove(o);Oe(e,t);const l=e._previousPositions;for(s=0;s<r;++s)n=i[s],o=n.identifier,l.remove(o);},Me={position:new e.Vector2},Pe={position1:new e.Vector2,position2:new e.Vector2},Re={position:new e.Vector2},Be={position:new e.Vector2},Ie={position:new e.Vector2};let De=0;const Oe=(t,i)=>{const s=ae(i),r=t._positions,n=r.length;let o,a,l,h;const _=t._isPinching;if(t._outputMouseEvents){const r=re(i.type);for(let n=0;n<r.length;n++){const o=t.getInputAction(r[n],s),a=t.getOnceInputAction(r[n],s);if(e.defined(o))for(let e=0;e<o.length;e++)o[e](new $(i.type,t._map,i));if(e.defined(a))for(let e=0;e<a.length;e++)a[e](new $(i.type,t._map,i));}}if(1!==n&&t._buttonDown[0]){if(t._buttonDown[0]=!1,e.defined(t._touchHoldTimer)&&(clearTimeout(t._touchHoldTimer),t._touchHoldTimer=void 0),o=t.getInputAction(te.LEFT_UP,s),a=t.getOnceInputAction(te.LEFT_UP,s),e.defined(o)&&(e.Vector2.clone(t._primaryPosition,Re.position),!t._outputMouseEvents))for(let e=0;e<o.length;e++)o[e](Re);if(e.defined(a)&&(t._outputMouseEvents||(fe(t,a,i,Re.position.clone(),te.LEFT_UP),t.removeOnceInputAction(te.LEFT_UP))),0===n&&!t._isTouchHolding){if(l=t.getInputAction(te.LEFT_CLICK,s),h=t.getOnceInputAction(te.LEFT_CLICK,s),e.defined(l)&&de(t._primaryStartPosition,t._previousPositions.values[0],t._clickPixelTolerance))if(e.Vector2.clone(t._primaryPosition,Be.position),t._outputMouseEvents){const e=new $(i.type,t._map,i);for(let t=0;t<l.length;t++)l[t](e);}else for(let e=0;e<l.length;e++)l[e](Be);if(e.defined(h))if(t._outputMouseEvents){const e=new $(i.type,t._map,i);for(let t=0;t<h.length;t++)h[t](e);t.removeOnceInputAction(te.LEFT_CLICK);}else fe(t,h,i,Re.position.clone(),te.LEFT_CLICK),t.removeOnceInputAction(te.LEFT_CLICK);}t._isTouchHolding=!1;}if(0===n&&_){if(t._isPinching=!1,o=t.getInputAction(te.PINCH_END,s),a=t.getOnceInputAction(te.PINCH_END,s),e.defined(o)&&!t._outputMouseEvents)for(let e=0;e<o.length;e++)o[e]();e.defined(a)&&!t._outputMouseEvents&&(fe(t,a,i,Re.position.clone(),te.PINCH_END),t.removeOnceInputAction(te.PINCH_END));}if(1===n&&!_){const n=r.values[0];let _;if(e.Vector2.clone(n,t._primaryPosition),e.Vector2.clone(n,t._primaryStartPosition),e.Vector2.clone(n,t._primaryPreviousPosition),t._buttonDown[0]=!0,_=i.timeStamp-De<300?te.LEFT_DOUBLE_CLICK:te.LEFT_DOWN,o=t.getInputAction(_,s),e.defined(o)&&(e.Vector2.clone(n,Me.position),!t._outputMouseEvents))for(let e=0;e<o.length;e++)o[e](Me);a=t.getOnceInputAction(_,s),e.defined(a)&&e.defined(a)&&!t._outputMouseEvents&&(fe(t,a,i,Re.position.clone(),_),t.removeOnceInputAction(_)),De=i.timeStamp,t._touchHoldTimer=setTimeout((()=>{if(!t.isDestroyed()){if(t._touchHoldTimer=void 0,t._isTouchHolding=!0,l=t.getInputAction(te.RIGHT_CLICK,s),h=t.getOnceInputAction(te.RIGHT_CLICK,s),e.defined(l)&&!t._outputMouseEvents&&de(t._primaryStartPosition,t._previousPositions.values[0],t._holdPixelTolerance)){e.Vector2.clone(t._primaryPosition,Ie.position);for(let e=0;e<l.length;e++)l[e](Ie);}e.defined(h)&&!t._outputMouseEvents&&e.defined(h)&&(fe(t,h,i,Re.position.clone(),te.RIGHT_CLICK),t.removeOnceInputAction(te.RIGHT_CLICK));}}),Ge.touchHoldDelayMilliseconds),i.preventDefault();}if(2===n&&!_){if(t._isPinching=!0,o=t.getInputAction(te.PINCH_START,s),a=t.getOnceInputAction(te.PINCH_START,s),e.defined(o)&&!t._outputMouseEvents){e.Vector2.clone(r.values[0],Pe.position1),e.Vector2.clone(r.values[1],Pe.position2);for(let e=0;e<o.length;e++)o[e](Pe);i.preventDefault();}e.defined(a)&&!t._outputMouseEvents&&e.defined(a)&&(fe(t,a,i,Re.position.clone(),te.PINCH_START),t.removeOnceInputAction(te.PINCH_START),i.preventDefault());}},Le=(t,i)=>{_e(t);const s=i.changedTouches;let r;const n=s.length;let o,a;const l=t._positions;for(r=0;r<n;++r){o=s[r],a=o.identifier;const i=l.get(a);e.defined(i)&&ne(t,o,i);}Fe(t,i);const h=t._previousPositions;for(r=0;r<n;++r)o=s[r],a=o.identifier,e.defined(l.get(a))&&e.Vector2.clone(l.get(a),h.get(a));},Ve={startPosition:new e.Vector2,endPosition:new e.Vector2},Ne={distance:{startPosition:new e.Vector2,endPosition:new e.Vector2},angleAndHeight:{startPosition:new e.Vector2,endPosition:new e.Vector2}},Fe=(t,i)=>{const s=ae(i),r=t._positions,n=t._previousPositions,o=r.length;let a,l;if(t._outputMouseEvents){const r=re(i.type);for(let n=0;n<r.length;n++){const o=t.getInputAction(r[n],s),a=t.getOnceInputAction(r[n],s);if(e.defined(o))for(let e=0;e<o.length;e++)o[e](new $(i.type,t._map,i));if(e.defined(a))for(let e=0;e<a.length;e++)a[e](new $(i.type,t._map,i));}}if(1===o&&t._buttonDown[0]){const n=r.values[0];e.Vector2.clone(n,t._primaryPosition);const o=t._primaryPreviousPosition;if(a=t.getInputAction(te.MOUSE_MOVE,s),l=t.getOnceInputAction(te.MOUSE_MOVE,s),e.defined(a)&&!t._outputMouseEvents){e.Vector2.clone(o,Ve.startPosition),e.Vector2.clone(n,Ve.endPosition);for(let e=0;e<a.length;e++)a[e](Ve);}e.defined(l)&&!t._outputMouseEvents&&e.defined(l)&&(fe(t,l,i,Re.startPosition.clone(),te.MOUSE_MOVE),t.removeOnceInputAction(te.MOUSE_MOVE)),e.Vector2.clone(n,o),i.preventDefault();}else if(2===o&&t._isPinching){if(a=t.getInputAction(te.PINCH_MOVE,s),l=t.getOnceInputAction(te.PINCH_MOVE,s),e.defined(a)&&!t._outputMouseEvents){const t=r.values[0],i=r.values[1],s=n.values[0],o=n.values[1],l=i.x-t.x,h=i.y-t.y,_=.25*Math.sqrt(l*l+h*h),c=o.x-s.x,d=o.y-s.y,u=.25*Math.sqrt(c*c+d*d),m=.125*(i.y+t.y),p=.125*(o.y+s.y),f=Math.atan2(h,l),g=Math.atan2(d,c);e.Vector2.fromElements(0,u,Ne.distance.startPosition),e.Vector2.fromElements(0,_,Ne.distance.endPosition),e.Vector2.fromElements(g,p,Ne.angleAndHeight.startPosition),e.Vector2.fromElements(f,m,Ne.angleAndHeight.endPosition);for(let e=0;e<a.length;e++)a[e](Ne);}e.defined(l)&&!t._outputMouseEvents&&e.defined(l)&&(fe(t,l,i,Re.startPosition.clone(),te.PINCH_MOVE),t.removeOnceInputAction(te.PINCH_MOVE));}};class Ge{constructor(t,i,s){this._inputEvents={},this._inputOnceEvents={},this._buttonDown={LEFT:!1,MIDDLE:!1,RIGHT:!1},this._isPinching=!1,this._isTouchHolding=!1,this._isRollerWheel=!1,this._lastSeenTouchEvent=-Ge.mouseEmulationIgnoreMilliseconds,this._primaryStartPosition=new e.Vector2,this._primaryPosition=new e.Vector2,this._primaryPreviousPosition=new e.Vector2,this._positions=new U,this._previousPositions=new U,this._removalFunctions=[],this._touchHoldTimer=void 0,this._clickPixelTolerance=5,this._holdPixelTolerance=25,this._element=e.defaultValue(t,ie),this._elementEvent=void 0,this._map=i,this._outputMouseEvents=e.defaultValue(s,!1),(t=>{const i=t._element,s=e.defined(i.disableRootEvents)?i:ie;let r;le(t,"mousedown",i,ue),le(t,"mouseup",s,ye),le(t,"mousemove",s,Ce),le(t,"touchstart",i,Ae),le(t,"touchend",s,Ee),le(t,"touchmove",s,Le),le(t,"touchcancel",s,Ee),le(t,"dblclick",i,ve),le(t,"click",i,xe),r="onwheel"in i?"wheel":void 0!==ie.onmousewheel?"mousewheel":"DOMMouseScroll",le(t,r,i,we),le(t,"keydown",ie,Se);})(this);}setInputAction(t,i,s){if(!e.defined(t))throw new Error("action is required.");if(!e.defined(i))throw new Error("type is required.");const r=oe(i,s);e.defined(this._inputEvents[r])||(this._inputEvents[r]=[]),this._inputEvents[r].push(t);}getInputAction(t,i){if(!e.defined(t))throw new Error("type is required.");const s=oe(t,i);return this._inputEvents[s]}removeInputAction(t,i,s){if(!e.defined(t))throw new Error("type is required.");const r=oe(t,i);if(!e.defined(this._inputEvents[r]))return;const n=this._inputEvents[r].indexOf(s);-1!==n&&this._inputEvents[r].splice(n,1),0===this._inputEvents[r].length&&delete this._inputEvents[r];}setOnceInputAction(t,i){if(!e.defined(i))throw new Error("action is required.");if(!e.defined(t))throw new Error("type is required.");const s=oe(t,void 0);e.defined(this._inputOnceEvents[s])||(this._inputOnceEvents[s]=[]),this._inputOnceEvents[s].push(i);}getOnceInputAction(t,i){if(!e.defined(t))throw new Error("type is required.");const s=oe(t,i);return this._inputOnceEvents[s]}removeOnceInputAction(t){if(!e.defined(t))throw new Error("type is required.");delete this._inputOnceEvents[t];}static addEventListeners(e,t,i,s){const r=re(e),n=[];if(t instanceof Function&&r.length>0)for(let e=0;e<r.length;e++)n.push(s?i._screenSpaceEventHandler.setOnceInputAction(r[e],t):i._screenSpaceEventHandler.setInputAction(t,r[e]));return n}static removeEventListeners(e,t,i){const s=re(e);let r=!1;if(t instanceof Function&&s.length>0)for(let e=0;e<s.length;e++)i._screenSpaceEventHandler.removeInputAction(s[e],void 0,t),i._screenSpaceEventHandler.removeOnceInputAction(s[e],void 0,t),r=!0;return r}static executeEvent(t,i){const s=t._screenSpaceEventHandler,r=re(i);let n=[],o=[];for(let t=0;t<r.length;t++){const i=s.getInputAction(r[t]),a=s.getOnceInputAction(r[t]);e.defined(i)&&(n=n.concat(i)),e.defined(a)&&(o=o.concat(a));}if(e.defined(n))for(let e=0;e<n.length;e++)n[e]({originalEvent:s._elementEvent,target:t,type:i});if(e.defined(o)){for(let e=0;e<o.length;e++)o[e]({originalEvent:s._elementEvent,target:t,type:i});for(let e=0;e<r.length;e++)s.removeOnceInputAction(r[e]);}}isDestroyed(){return !1}destroy(){return (e=>{const t=this._removalFunctions;for(let e=0;e<t.length;++e)t[e]();})(),this._inputOnceEvents={},e.destroyObject(this)}static mouseEmulationIgnoreMilliseconds=800;static touchHoldDelayMilliseconds=1500}class ke{constructor(t,i){this._blender=t,this._clip=i,this.id=e.uniqueId(),this.loop=e.defaultValue(this._clip._loop,_.LOOP_REPEAT),this._loopCount=0,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.paused=!1,this.enabled=!1,this.timeCounter=0,this.deltaTime=0,this.sumTime=0;}play(){return this.enabled=!0,this._blender._activateAction(this),this}stop(){return this.enabled=!1,this._blender._deactivateAction(this),this.reset()}reset(){this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null;}update(t,i){if(("3d-model"===this._blender._root.type||"3d-model-instance"===this._blender._root.type||"Object3D"===this._blender._root.type)&&this._blender.trackingOptions)switch(this._blender.trackingOptions.trackingEffect){case c.STABLE:this.stableUpdate(t,i);break;case c.MEDIUM:this.mediumUpdate(t,i);break;default:this.preciseUpdate(t,i);}this._updateTime(i,this._blender.speed),e.defined(this._blender)&&(this._blender._root.animationPropertyCollection.get(`${this._clip.id}-${this.id}`).currentClipTime=this.time);}stableUpdate(e,t){return this.timeCounter<5?(this.deltaTime=t,this.timeCounter+=1,this.sumTime+=t):(this.deltaTime=this.sumTime/5,t=this.deltaTime),t}mediumUpdate(e,t){return Ue(function(e,t,i){const s=[e-.0334,e-t,e,e+t,e+.0334],r=.5*Ue(s),n=[];for(const e in s){const t=s[e],i=Number(Ue([r,n[e-1]||s[s.length-1],t,t||s[0]]).toFixed(2));n.push(i);}return n}(t,.0167))}preciseUpdate(e,t){return t}_updateTime(t,i=1){const s=this._clip.duration;if(this.time=this.time+t*i,this.time>=s)switch(this.loop){case _.LOOP_REPEAT:{const e=Math.floor(this.time/s);this.time%=s,this._loopCount+=Math.abs(e);}break;case _.LOOP_ONCE:this._blender?.trackingOptions&&this._blender?._root?._map&&Ge.executeEvent(this._blender._root._map,"moveend"),this._blender.stop(this._blender.autoStop);break;case _.LOOP_NONE:this._blender.stop(this._blender.autoStop);break;default:throw new e.DeveloperError(`Invalid animation loop mode: ${this.loop}`)}return this.time}setLoop(e){return this.loop=e,this}destroy(){for(const e in this)Object.hasOwnProperty.call(this,e)&&(this[e]=null);}}function Ue(e){return e.reduce(((e,t)=>e+t),0)/e.length}class He{id=e.uniqueId();constructor(t=0,i,s,r,n){this.id=e.uniqueId(),this._duration=t,this._startTime=r,this._endTime=n,this._duration<0&&(this._duration=0),this.tracks=i,"geojson"===i?.type&&(this.tracks=i._data),this._loop=e.defaultValue(s,_.LOOP_REPEAT),this._dirty=!1;}get duration(){return this._duration}set duration(e){this._duration=e&&"number"==typeof e&&e>0?e:0;}get startTime(){return this._startTime}set startTime(e){this._startTime=e&&"number"==typeof e&&e>0?e:0;}get endTime(){return this._endTime}set endTime(e){this._endTime=e&&"number"==typeof e&&e>0?e:0;}get loop(){return this._loop}set loop(e){e&&(this._loop=e);}get dirty(){return this._dirty}set dirty(e){"boolean"==typeof e&&(this._dirty=e);}destroy(){e.defined(this.tracks)&&this.tracks.length>0&&this.tracks.forEach((e=>{e.destroy();}));}updateTracks(e){Array.isArray(e)&&e.length>0&&(this.tracks=e,this.dirty=!0);}}const ze={getLinearInterpolationPosition:(e,t,i)=>[(i[0]-t[0])*e+t[0],(i[1]-t[1])*e+t[1],(i[2]-t[2])*e+t[2]],leftBinarySearch(e,t,i,s){const r=Math.floor((i+s)/2),n=e[r];return i>s?r:n>t?ze.leftBinarySearch(e,t,i,r-1):n<t?ze.leftBinarySearch(e,t,r+1,s):r},getWeightAndPoints(e,t,i){const s=ze.leftBinarySearch(e,i,0,e.length-2),r=e[s];return {weight:Math.min((i-r)/(e[s+1]-r),1),pointCurrent:t[s],pointNext:t[s+1],currentIndex:s}},getRSModelMatrix(t,i,s){const r=new e.Vector3;e.Vector3.subtract(i,t,r),r.normalize();const n=e.Transforms.rotationMatrixFromPositionVelocity(t,r),o=(new e.Matrix4).setFromMatrix3(n),a=s.originalRotationScaleMatrix.clone();return o.multiplyRight(a),o},getRotation(t,i){const s=new e.Vector3;e.Vector3.subtract(i,t,s),s.normalize();const r=e.Transforms.rotationMatrixFromPositionVelocity(t,s),n=(new e.Matrix4).setFromMatrix3(r),o=e.Transforms.eastNorthUpToFixedFrame(t),a=e.Matrix4.inverse(o,new e.Matrix4),l=n.multiplyLeft(a),h=(new e.Quaternion).fromRotationMatrix4(l.getRotation());return e.HeadingPitchRoll.fromQuaternion(h)},getRotationMatrixFromEuler(t,i){const s=new e.Matrix4,r=i.split("-"),n={x:(e,t)=>{e.rotateX(t);},y:(e,t)=>{e.rotateY(t);},z:(e,t)=>{e.rotateZ(t);}};for(let e=0;e<r.length;e++)n[r[e]](s,t[e]);return s},getRotationFromEuler(t,i){const s=i.split("-");let r=0,n=0,o=0;const a={x:e=>{o=e;},y:e=>{n=-e;},z:e=>{r=-e;}};for(let e=0;e<s.length;e++)a[s[e]](t[e]);return new e.HeadingPitchRoll(r,n,o)},arraySubtract(e,t){if(!Array.isArray(e)||!Array.isArray(t))throw new Error("arr1 or arr2 type must be Array");if(e.length!==t.length)throw new Error(" the 'arr1' length must be the same as the 'arr2' length ");return e.map(((e,i)=>e-t[i]))}};class We{constructor(t){this.rectangle=e.Rectangle.clone(t.rectangle),this.minimumHeight=e.defaultValue(t.minimumHeight,0),this.maximumHeight=e.defaultValue(t.maximumHeight,0),this.isAmbiguousHeight=e.defaultValue(t.isAmbiguousHeight,!1),this.southwestCornerCartesian=new e.Vector3,this.northeastCornerCartesian=new e.Vector3,this.westNormal=new e.Vector3,this.southNormal=new e.Vector3,this.eastNormal=new e.Vector3,this.northNormal=new e.Vector3;const i=e.defaultValue(t.ellipsoid,e.Ellipsoid.WGS84);!function(t,i,s){s.cartographicToCartesianInRadians(e.Rectangle.southwest(i),t.southwestCornerCartesian),s.cartographicToCartesianInRadians(e.Rectangle.northeast(i),t.northeastCornerCartesian),Ye.longitude=i.west,Ye.latitude=.5*(i.south+i.north),Ye.height=0;const r=s.cartographicToCartesianInRadians(Ye,Je),n=e.Vector3.cross(r,e.Vector3.UNIT_Z,je);e.Vector3.normalize(n,t.westNormal),Ye.longitude=i.east;const o=s.cartographicToCartesianInRadians(Ye,Ze),a=e.Vector3.cross(e.Vector3.UNIT_Z,o,je);e.Vector3.normalize(a,t.eastNormal);const l=e.Vector3.subtract(r,o,je),h=e.Vector3.normalize(l,Ke),_=i.south;let c;if(_>0){Ye.longitude=.5*(i.west+i.east),Ye.latitude=_;const r=s.cartographicToCartesianInRadians(Ye,$e.origin);e.Vector3.clone(h,$e.direction);const n=e.Plane.fromPointNormal(t.southwestCornerCartesian,t.westNormal,Qe);e.IntersectionTests.rayPlane($e,n,t.southwestCornerCartesian),c=s.geodeticSurfaceNormal(r,Xe);}else c=s.geodeticSurfaceNormalCartographic(e.Rectangle.southeast(i),Xe,!0);const d=e.Vector3.cross(c,l,qe);e.Vector3.normalize(d,t.southNormal);const u=i.north;let m;if(u<0){Ye.longitude=.5*(i.west+i.east),Ye.latitude=u;const r=s.cartographicToCartesianInRadians(Ye,$e.origin);e.Vector3.negate(h,$e.direction);const n=e.Plane.fromPointNormal(t.northeastCornerCartesian,t.eastNormal,Qe);e.IntersectionTests.rayPlane($e,n,t.northeastCornerCartesian),m=s.geodeticSurfaceNormal(r,Xe);}else m=s.geodeticSurfaceNormalCartographic(e.Rectangle.northwest(i),Xe,!0);const p=e.Vector3.cross(l,m,qe);e.Vector3.normalize(p,t.northNormal);}(this,t.rectangle,i),this._orientedBoundingBox=void 0,this._boundingSphere=void 0,e.defaultValue(t.computeBoundingVolumes,!0)&&this.computeBoundingVolumes(i);}get boundingVolume(){return this._orientedBoundingBox}get boundingSphere(){return this._boundingSphere}computeBoundingVolumes(t){this._orientedBoundingBox=e.OrientedBoundingBox.fromRectangle(this.rectangle,this.minimumHeight,this.maximumHeight,t),this._boundingSphere=e.BoundingSphere.fromOrientedBoundingBox(this._orientedBoundingBox);}computePlaneDistances(e,t,i){return this._orientedBoundingBox.computePlaneDistances(e,t,i)}distanceToCamera(t){const i=function(t,i){const s=i.position,r=e.Cartographic.fromVector3(i.position);let n=0;if(!e.Rectangle.contains(t.rectangle,r)){const i=t.northeastCornerCartesian,r=t.westNormal,o=t.southNormal,a=t.eastNormal,l=t.northNormal,h=e.Vector3.subtract(s,t.southwestCornerCartesian,et),_=e.Vector3.dot(h,r),c=e.Vector3.dot(h,o),d=e.Vector3.subtract(s,i,et),u=e.Vector3.dot(d,a),m=e.Vector3.dot(d,l);_>0?n+=_*_:u>0&&(n+=u*u),c>0?n+=c*c:m>0&&(n+=m*m);}const o=r.height,a=t.minimumHeight,l=t.maximumHeight;if(o>l){const e=o-l;n+=e*e;}else if(o<a){const e=a-o;n+=e*e;}return Math.sqrt(n)}(this,t);if(e.defined(this._orientedBoundingBox)){const e=Math.sqrt(this._orientedBoundingBox.distanceSquaredTo(t.position));return Math.max(i,e)}return i}intersectPlane(e){return this._orientedBoundingBox.intersectPlane(e)}}const je=new e.Vector3,Xe=new e.Vector3,qe=new e.Vector3,Ke=new e.Vector3,Je=new e.Vector3,Ze=new e.Vector3,Ye=new e.Cartographic,Qe=new e.Plane(e.Vector3.UNIT_X,0),$e=new e.Ray,et=new e.Vector3;class tt{constructor(t){if(this.collection=t.collection,!e.defined(t.modelMatrix))throw new Error("modelMatrix must be defined!");if(!(t.modelMatrix instanceof e.Matrix4))throw new Error("modelMatrix must be type of Matrix4!");this._modelMatrix=t.modelMatrix,this._instanceId=e.defaultValue(t.instanceId,void 0),this._instanceName=e.defaultValue(t.instanceName,void 0),this._show=e.defaultValue(t.show,!0),this._color=e.defaultValue(e.Color.parse(t.color),new e.Color(0,0,0,0)),this._scale=new e.Vector3,this._boundingVolume=void 0,this.scale=e.defaultValue(t.scale,void 0),this.rotation=e.defaultValue(t.rotation,void 0),this.position=e.defaultValue(t.position,void 0),this.pickId=void 0,this._dirty=!0,this._originalMatrix=this._modelMatrix.clone();}get boundingVolume(){return this._boundingVolume}get color(){return this._color}set color(t){const i=e.Color.parse(t);i&&(this._color=i,this.dirty=!0);}get dirty(){return this._dirty}set dirty(t){e.isBoolean(t)&&(t&&(this.collection.dirty=!0),this._dirty=t);}get instanceId(){return this._instanceId}get instanceName(){return this._instanceName}get modelMatrix(){return this._modelMatrix.clone()}set modelMatrix(t){t instanceof e.Matrix4&&(this._modelMatrix=t.clone(),this.dirty=!0);}get position(){return this._modelMatrix.getTranslation(new e.Vector3)}set position(t){t instanceof e.Vector3&&(this._modelMatrix.setTranslation(t),this.dirty=!0);}get rotation(){const t=this._modelMatrix.clone(),i=e.Transforms.localFrameToFixedFrame(t.getTranslation(new e.Vector3)),s=e.Matrix4.inverse(i,new e.Matrix4),r=t.multiplyLeft(s),n=(new e.Quaternion).fromRotationMatrix4(r.getRotation());return e.HeadingPitchRoll.fromQuaternion(n)}set rotation(t){t instanceof e.HeadingPitchRoll&&(e.Transforms.localFrameToFixedFrame(this._modelMatrix.getTranslation(new e.Vector3)).multiplyRight(e.Matrix4.fromTranslationHeadingPitchRollRotationScale(new e.Vector3,t,new e.Vector3(this.scale.x,this.scale.y,this.scale.z)),this._modelMatrix),this.dirty=!0);}get scale(){return e.Matrix4.getScale(this._modelMatrix,this._scale)}set scale(t){t instanceof e.Vector3&&(this._modelMatrix.scale(new e.Vector3(1/this.scale.x,1/this.scale.y,1/this.scale.z)),this._modelMatrix.scale(t),this.dirty=!0);}get show(){return this._show}set show(t){e.isBoolean(t)&&(this._show=t,this.dirty=!0);}getBounds(){let t,i=this._boundingVolume;if(i instanceof We)i=i.boundingVolume;else if(i instanceof e.BoundingSphere){t=i.getBoundingMaximum();const s=e.Transforms.cartesian3ToCartographic(t.boundingMaxValue),r=e.Transforms.cartesian3ToCartographic(t.boundingMinValue);return new e.LngLatBounds([r[0],r[1]],[s[0],s[1]])}const s=e.Rectangle.fromVector3Array(i.computeCorners()),r=e.CONSTS.CesiumMath.toDegrees(s.west),n=e.CONSTS.CesiumMath.toDegrees(s.south),o=e.CONSTS.CesiumMath.toDegrees(s.east),a=e.CONSTS.CesiumMath.toDegrees(s.north);return new e.LngLatBounds([r,n],[o,a])}}class it{constructor(t){this._rootId=t.rootId,this._instances=this._createInstance(t.instances),this._primitivesInstance=[],this.type=e.defaultValue(t.type,"3d-model-instance"),this._batchTable=void 0,this._parentBoundingVolumeNeedUpdate=!1,this.boundingVolume=this._updateBoundingVolume(),this._center=this.boundingVolume.center,this._rtcTransform=new e.Matrix4,e.Matrix4.multiplyByTranslation(new e.Matrix4,this._center,this._rtcTransform),this._instanceBuffer=void 0,this._attributes=[],this._attributesbuffviewObject={},this.allowPick=e.defaultValue(t.allowPick,!0),this._createAttributes(),this._parseBufferViewAttributes(),this.dirty=!1,this.reCreateInstancesData=!1;}get dirty(){return this._dirty}set dirty(t){e.isBoolean(t)&&(this._dirty=t);}get length(){return this._instances.size}get instances(){return this._instances}get instanceBuffer(){return this._instanceBuffer}add(t){if("3d-model-instance"!==this.type)return;if(!e.defined(t.position)&&!e.defined(t.positions))throw new Error("instance's position or positions must be defined!");let i;if(e.defined(t.positions)){const e=it.generateInstances({positions:t.positions,scales:t.scales,rotations:t.rotations,shows:t.shows,colors:t.colors,instanceNames:t.instanceNames});let s=this._instances.size;for(let t=0;t<e.length;t++)e[t].batchId=s,s++;const r=this._createInstance(e);i=[...r.values()],this._instances=new Map([...this._instances,...r]);}else {const s=t.position,r=t.rotation,n=t.scale,o=t.color,a=t.show,l=t.instanceName;if(!(s instanceof e.Vector3))throw new Error("instance's position is unKnown type!");if(e.defined(r)&&!(r instanceof e.HeadingPitchRoll))throw new Error("instance's rotation is unKnown type!");if(e.defined(n)&&!(n instanceof e.Vector3))throw new Error("instance's scale is unKnown type!");if(e.defined(o)&&!(o instanceof e.Color))throw new Error("instance's color is unKnown type!");if(e.defined(a)&&!e.isBoolean(a))throw new Error("instance's show is unKnown type!");const h=e.Transforms.cartographicToFixedFrame(s);i=new tt({collection:this,modelMatrix:h,instanceId:this._instances.size,instanceName:l,show:a,color:o,scale:n,rotation:r,position:e.Vector3.fromElements(h[12],h[13],h[14])}),this._instances.set(i.instanceId,i);}return this.reCreateInstancesData=!0,this.dirty=!0,this._parseBufferViewAttributes(),this._updateBoundingVolume(),i}remove(t){let i=!1;if("3d-model-instance"!==this.type)return i;if(!e.defined(t))return i;if(t instanceof Array)for(let e=0;e<t.length;e++)this._instances.has(t[e].instanceId)&&(this._instances.delete(t[e].instanceId),i=!0);else this._instances.has(t.instanceId)&&(this._instances.delete(t.instanceId),i=!0);const s=[];this._instances.forEach((e=>{s.push(e);}));const r=new Map;for(let e=0;e<s.length;e++)s[e]._instanceId=e,s.dirty=!0,r.set(e,s[e]);return this._instances.clear(),this._instances=r,this.reCreateInstancesData=!0,this.dirty=!0,this._parseBufferViewAttributes(),i}removeByName(e){if("3d-model-instance"!==this.type)return !1;const t=[];if(e instanceof Array)for(let i=0;i<e.length;i++){const s=e[i];this._instances.forEach((e=>{e.instanceName===s&&t.push(e);}));}else this._instances.forEach((i=>{i.instanceName===e&&t.push(i);}));return this.remove(t)}getByName(e){if("3d-model-instance"!==this.type)return;const t=[];return this._instances.forEach((i=>{i.instanceName===e&&t.push(i);})),t[0]}getInstance(e){return this._instances.get(e)}removeAll(){this._instances.clear(),this.reCreateInstancesData=!0,this.dirty=!0,this._parseBufferViewAttributes();}_createInstance(t){const i=new Map;return t.forEach(((t,s)=>{const r=t.modelMatrix,n=e.defaultValue(t.batchId,s),o=new tt({collection:this,modelMatrix:r,instanceId:n,instanceName:t.instanceName,show:t.show,color:t.color,scale:t.scale,rotation:t.rotation,position:t.position});i.set(n,o);})),i}_createPickId(e){const t=this._instances;for(let i=0;i<t.size;++i)t.get(i).pickId=e.createPickId(this.getInstance(i));}_createBuffer(t){this._instanceBuffer=new e.VertexBuffer({context:t,attributesbuffviewObject:this._attributesbuffviewObject,attributes:this._attributes,dynamicDraw:!1,buffers:void 0});}_updateBoundingVolume(){const t=[];for(let i=0;i<this._instances.size;++i){const s=this._instances.get(i);if(e.defined(s)){const i=[];if(this._primitivesInstance.length>0)for(let e=0;e<this._primitivesInstance.length;e++){let r=this._primitivesInstance[e].boundingVolume.clone();r=r.transform(s.modelMatrix);const n=r.computeCorners();for(let e=0;e<n.length;e++)t.push(n[e]),i.push(n[e]);}else {const r=e.Matrix4.getTranslation(s.modelMatrix,new e.Vector3);t.push(r),i.push(r);}s._boundingVolume=e.OrientedBoundingBox.fromPoints(i),this._parentBoundingVolumeNeedUpdate=!0;}}return e.OrientedBoundingBox.fromPoints(t)}_createAttributes(){for(let t=0;t<4;++t)this._attributes.push({name:"a_InstanceMatrix4",type:e.WebGLConstants.FLOAT,components:4,instance:!0,byteStride:64,offset:16*t,attribIndex:t,divisor:1});this.allowPick&&(this._attributes.push({name:"a_BATCHID",type:e.WebGLConstants.FLOAT,components:1,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1}),this._attributes.push({name:"a_PickColor",type:e.WebGLConstants.FLOAT,components:4,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1})),this.sprites&&this._attributes.push({name:"a_UVOffset",type:e.WebGLConstants.FLOAT,components:2,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1}),this.modelInstanceAttributes=[{name:"color",type:e.WebGLConstants.UNSIGNED_BYTE,components:4,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1,batchTableAttributeIndex:0},{name:"show",type:e.WebGLConstants.UNSIGNED_BYTE,components:1,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1,batchTableAttributeIndex:1},{name:"pickColor",type:e.WebGLConstants.UNSIGNED_BYTE,components:4,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1,batchTableAttributeIndex:2}];}_parseBufferViewAttributes(){this._parseInstances("InstanceMatrix4"),this.allowPick&&this._parseInstances("batchid"),this.sprites&&this._parseInstances("UVOffset");}_parseInstances(e){if("InstanceMatrix4"===e){const t=this._parseInstancesData(e);this._attributesbuffviewObject.InstanceMatrix4={value:new Float32Array(t)};}else if("batchid"===e){const t=this._parseInstancesData(e);this._attributesbuffviewObject.BATCHID={value:new Float32Array(t)};}else if("UVOffset"===e){const t=this._parseInstanceAtlas(e);this._attributesbuffviewObject.UVOffset={value:new Float32Array(t)};}}_parseInstance(t,i,s){if("InstanceMatrix4"===t){const t=new e.Matrix4,r=e.Matrix4.clone(i.modelMatrix,t);"3d-model-instance"===this.type&&(r[12]-=this._center.x,r[13]-=this._center.y,r[14]-=this._center.z);for(let e=0;e<i.modelMatrix.length;e++)s.push(r[e]);}else "batchid"===t&&s.push(i.instanceId);return s}_parseInstancesData(t){let i=[];for(let s=0;s<this._instances.size;s++){const r=this._instances.get(s);e.defined(r)&&(i=this._parseInstance(t,r,i));}return i}_parseInstanceAtlas(e){const t=[];if("UVOffset"===e)for(let e=0;e<this._instances.size;e++){const i=e%this.sprites.spriteWidthCount/this.sprites.spriteWidthCount,s=Math.floor(e/this.sprites.spriteWidthCount)/this.sprites.spriteHeightCount;t.push(i),t.push(s);}return t}_createBatchTable(t){e.defined(this._batchTable)&&(this._batchTable.destroy(),this._batchTable=void 0),this._batchTable=new e.BatchTable(t,this.modelInstanceAttributes,this._instances.size);for(let i=0;i<this._instances.size;i++){const s=this._instances.get(i);e.defined(s)&&(this._setBatchTableAttribute(s,t),s.dirty=!1);}}_setBatchTableAttribute(t,i){let s,r,n;const o=t.instanceId;for(let i=0;i<this.modelInstanceAttributes.length-1;++i)s=this.modelInstanceAttributes[i].name,r=this.modelInstanceAttributes[i].batchTableAttributeIndex,t[s]instanceof e.Color?(n=e.Color.clone(t[s]),n.r=e.Color.floatToByte(n.r),n.g=e.Color.floatToByte(n.g),n.b=e.Color.floatToByte(n.b),n.a=e.Color.floatToByte(n.a),n=e.Vector4.fromColor(n)):e.isBoolean(t[s])&&(n=Number(t[s])),this._batchTable.setBatchedAttribute(o,r,n);e.defined(t.pickId)||(t.pickId=i.createPickId(t));const a=t.pickId.color,l=new e.Vector4;l.x=e.Color.floatToByte(a.r),l.y=e.Color.floatToByte(a.g),l.z=e.Color.floatToByte(a.b),l.w=e.Color.floatToByte(a.a),this._batchTable.setBatchedAttribute(o,this.modelInstanceAttributes.length-1,l);}_updateBatchTable(){let t;for(let i=0;i<this._instances.size;i++)t=this._instances.get(i),e.defined(t)&&t.dirty&&(this._setBatchTableAttribute(t),t.dirty=!1);}update(t){if(t&&t.context&&!this._instanceBuffer&&this._instances.size>0&&("3d-model-instance"===this.type&&(this._createPickId(t.context),this._createBatchTable(t.context)),this._createBuffer(t.context)),"3d-model-instance"===this.type&&this.reCreateInstancesData&&(this._createPickId(t.context),this._createBatchTable(t.context),this._createBuffer(t.context),this.reCreateInstancesData=!1),this.dirty){this.boundingVolume=this._updateBoundingVolume(),this._center=this.boundingVolume.center,this._rtcTransform=new e.Matrix4,e.Matrix4.multiplyByTranslation(new e.Matrix4,this._center,this._rtcTransform);const t=this._parseInstancesData("InstanceMatrix4");this._instanceBuffer.updateDataTest(new Float32Array(t),"a_InstanceMatrix4"),e.defined(this._batchTable)&&this._updateBatchTable(),this.dirty=!1;}e.defined(t.context)&&e.defined(this._batchTable)&&this._batchTable.update(t.context);}static generateInstances(t){const i=[],s=t.positions,r=t.instanceNames,n=t.scales,o=t.rotations,a=t.shows,l=t.colors;if(e.defined(r)&&r.length>0&&r.length!==s.length)throw new Error("instanceNames's length  must be equal than positions's length!");if(e.defined(n)&&n.length>0&&n.length!==s.length)throw new Error("scales's length  must be equal than positions's length!");if(e.defined(o)&&o.length&&o.length!==s.length)throw new Error("rotations's length  must be equal than positions's length!");if(e.defined(a)&&a.length>0&&a.length!==s.length)throw new Error("shows's length  must be equal than positions's length!");if(e.defined(l)&&l.length>0&&l.length!==s.length)throw new Error("colors's length  must be equal than positions's length!");let h,_,c,d,u,m;for(let p=0;p<s.length;p++){let f;h=s[p],e.defined(r)&&r.length>0&&(_=r[p]),e.defined(o)&&o.length>0&&(c=o[p]),e.defined(n)&&n.length>0&&(d=n[p]),e.defined(a)&&a.length>0&&(u=a[p]),e.defined(l)&&l.length>0&&(m=l[p]),t.cartesian?f=e.Transforms.cartesianToFixedFrame(h):(f=e.Transforms.cartographicToFixedFrame(h),h=e.Vector3.fromDegrees(h.x,h.y,h.z)),i.push({modelMatrix:f,batchId:p,instanceName:e.defaultValue(_,void 0),position:e.defaultValue(h,void 0),scale:e.defaultValue(d,void 0),rotation:e.defaultValue(c,void 0),show:e.defaultValue(u,!0),color:e.defaultValue(m,void 0)});}return i}updateInstanceMatrixByIndex(e,t){this.dirty=!0,this._instances.get(e).modelMatrix=t;}destroy(){this._instances&&this._instances.clear(),this._instanceBuffer&&this._instanceBuffer.destroy(),this._batchTable&&this._batchTable.destroy(),this._attributes=[],this._attributesbuffviewObject=null,this.dirty=!1;}}function st(e,t,i,s,{units:r="m",distancePrecision:n=0,formula:o="great-circle",bearingPrecision:a=0,directionPrecision:l=2}={}){if(isNaN(e)||isNaN(i)||isNaN(t)||isNaN(s)||isNaN(a)||isNaN(l))throw new Error("Latitude/Longitude parameter is not a number!");if(Math.abs(e)>90||Math.abs(i)>90||Math.abs(t)>180||Math.abs(s)>180)throw new Error("Latitude/Longitude parameter exceeding maximal value!");if(isNaN(n)||isNaN(a)||n>15||a>15)throw new Error("Precision parameter is not a number or exceeds it's maximum value of 15!");if(!["m","km","ft","yd","mi","nm"].includes(r))throw new Error("Units parameter type not supported!");if(!["great-circle","rhumb-line"].includes(o))throw new Error("Calculation formula type parameter not supported!");const h=6371009;function _(e){return e*(Math.PI/180)}Number.prototype.round=function(e=0){const t=Number(this.valueOf());return +`${Math.round(`${t}e+${e}`)}e-${e}`};const c={},d=function(e,t="m"){if("m"===t)return e;switch(t){case"km":return .001*e;case"ft":return 3.28084*e;case"yd":return 1.0936*e;case"mi":return 621371e-9*e;case"nm":return 539957e-9*e;default:return e}}("rhumb-line"===o?function(e,t,i,s){if(e===i&&t===s)return 0;const r=_(e),n=_(i),o=_(e-i);let a=_(t-s);const l=Math.log(Math.tan(Math.PI/4+n/2)/Math.tan(Math.PI/4+r/2)),c=Math.abs(l)>1e-11?o/l:Math.cos(r);return Math.abs(a)>Math.PI&&(a=a>0?-(2*Math.PI-a):2*Math.PI+a),Math.sqrt(o*o+c*c*a*a)*h}(e,t,i,s):function(e,t,i,s){if(e===i&&t===s)return 0;const r=_(e),n=_(i),o=_(e-i),a=_(t-s),l=Math.sin(o/2)*Math.sin(o/2)+Math.cos(r)*Math.cos(n)*Math.sin(a/2)*Math.sin(a/2),c=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l));return h*c}(e,t,i,s),r).round(n);c.distance=d,c.units=r;const u=function(e,t,i,s){const r=_(e),n=_(i),o=_(s-t),a=Math.sin(o)*Math.cos(n),l=Math.cos(r)*Math.sin(n)-Math.sin(r)*Math.cos(n)*Math.cos(o);return (Math.atan2(a,l)*(180/Math.PI)+360)%360}(e,t,i,s);return c.bearing=u,c.formula=o,0!==l&&(c.direction=0==d?"":function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Parameter is not a number!");if(e<0||e>360)throw new Error("Parameter outside of range!");if(t<1||t>3)throw new Error("Parameter outside of range!");const i=["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"];let s=4;2===t&&(s=8),3===t&&(s=16);const r=i.length/s;let n=Math.round(e/(360/s))*r;return (()=>i.length)&&(n=0),i[n]}(u,l)),c}const rt={NONE:0,FREE:1,FOLLOW:2,LOCK:3};function nt(e,t){return e.children&&e.children.length>0?e.children.forEach((e=>{if(e.children&&e.children.length>0)return nt(e,t);t.push(e);})):t.push(e),t}class ot{constructor(e){this.id=`${e._clip.id}-${e.id}`,this.animationClip=e._clip,this.animationAction=e,this._enabled=e.enabled,this._currentClipTime=0,this._lastInstancePosition=void 0,this._cameraLock=!1;}get enabled(){return this._enabled}set enabled(e){this._enabled=e;}get currentClipTime(){return this._currentClipTime}set currentClipTime(e){this._currentClipTime=e;}destroy(){this._enabled=null,this._currentClipTime=null,this.animationClip.destroy(),e.defined(this.animationAction._blender._root.animationsInfo)&&(this.animationAction._blender._root.animationsInfo.enabled=!1);}updateAnimation(e){this.animationAction.enabled&&("3d-model"!==e.type&&"3d-model-instance"!==e.type||this.updateModelAnimation(e),"geojson"===e.type&&this.updateGeojsonAnimation(e),e._isPrimitive&&this.updatePrimitiveAnimation(e));}updateModelAnimation(t){if(!this.enabled)return;const i=this.animationClip.tracks,s=this.animationClip.dirty,r=this.currentClipTime,n=this.animationAction._blender,o=n.trackingOptions,a=n.onPlaying||n.callback;for(const n of i){if("positionKeyframeTrack"===n.type){const i=n.values,s=n.times,{weight:l,pointCurrent:h,pointNext:_}=ze.getWeightAndPoints(s,i,r),c=[t.matrixWorld[12],t.matrixWorld[13],t.matrixWorld[14]],d=ze.getLinearInterpolationPosition(l,h,_);t.position=d,t.updateMatrixWorld(!0),o&&this.trackingAnimation(t,d,c),a&&a({time:r,modelId:t.id,currentPosition:e.Transforms.cartesian3ToCartographic(d),totalMileage:this.animationAction._blender.trackCalculation.trackLength});}if("multiPositionKeyframeTrack"===n.type){const i=n.values,l=n.times,h=n.eulers||[],_=n.translations||[],c=n.colors||[],d=n.primitiveNames||[],u=n.trackIds||void 0;if("ready"===t._setInstancePropertiesState&&(!t.modelInstanceCollection||s)){this.animationClip.dirty=!1;const e=i.map((e=>e[0])),s=h.map((e=>ze.getRotationFromEuler(e[0],n.rotateOrder)));t.type="3d-model-instance",t.modelInstanceCollection=new it({instances:it.generateInstances({positions:e,rotations:s,instanceNames:u,cartesian:!0}),type:t.type,rootId:t.id}),t.setInstanceProperties(),t.matrixAutoUpdate=!1,t.setMatrix(t.originalRotationScaleMatrix),t.updateMatrixWorld(!0);}if(!t.modelInstanceCollection)return;for(let s=0;s<l.length;s++){const u=l[s],m=i[s],p=h[s]||[],f=_[s]||[],g=c[s]||[],y=d[s]||[],T=t.modelInstanceCollection.instances.get(s);if(u[0]>r){T.show=!1;continue}if(u.length<2||m.length<2){T.show=!1;continue}T.show=!0;const{weight:C,pointCurrent:x,pointNext:b,currentIndex:v}=ze.getWeightAndPoints(u,m,r),w=[T._modelMatrix[12],T._modelMatrix[13],T._modelMatrix[14]];let S=ze.getLinearInterpolationPosition(C,x,b);const A=e.Transforms.eastNorthUpToFixedFrame(S);if(f.length>0){const t=ze.getLinearInterpolationPosition(C,f[v],f[v+1]);A.translate(e.Vector3.unpack(t)),S=[A[12],A[13],A[14]];}if(T.position=e.Vector3.unpack(S),p.length>0){const e=n.rotateOrder,t=ze.getLinearInterpolationPosition(C,p[v],p[v+1]),i=ze.getRotationFromEuler(t,e);T.rotation=i;}if(g.length>0&&y.length>0){const e=nt(t,[]);for(let t=0;t<e.length;t++)e[t].parent&&e[t].parent.mesh&&e[t].parent.mesh.name===y[v]&&(e[t].color=g[v]);}o&&(T._map=t._map,this.trackingAnimation(T,S,w)),a&&a({time:r,modelId:T.instanceName,currentPosition:e.Transforms.cartesian3ToCartographic(S),totalMileage:this.animationAction._blender.trackCalculation.trackLength});}}if("trackingKeyframeTrack"===n.type){const i=n.values,s=n.times,{weight:l,pointCurrent:h,pointNext:_}=ze.getWeightAndPoints(s,i,r);if(!e.Vector3.equals(h,_)){const e=ze.getRSModelMatrix(h,_,t);t.setMatrix(e);}const c=[t.matrixWorld[12],t.matrixWorld[13],t.matrixWorld[14]],d=ze.getLinearInterpolationPosition(l,h,_);t.position=e.Vector3.unpack(d),t.updateMatrixWorld(!0),o&&this.trackingAnimation(t,d,c),a&&a({time:r,modelId:t.id,currentPosition:e.Transforms.cartesian3ToCartographic(d),totalMileage:this.animationAction._blender.trackCalculation.trackLength});}if("multiTrackingKeyframeTrack"===n.type){const i=n.values,l=n.times,h=n.trackIds||void 0;if("ready"===t._setInstancePropertiesState&&(!t.modelInstanceCollection||s)){this.animationClip.dirty=!1;const e=i.map((e=>e[0]));t.type="3d-model-instance",t.modelInstanceCollection=new it({instances:it.generateInstances({positions:e,instanceNames:h,cartesian:!0}),type:t.type,rootId:t.id}),t.setInstanceProperties(),t.matrixAutoUpdate=!1,t.setMatrix(t.originalRotationScaleMatrix),t.updateMatrixWorld(!0);}if(!t.modelInstanceCollection)return;for(let s=0;s<l.length;s++){const n=l[s],h=i[s],_=t.modelInstanceCollection.instances.get(s);if(n[0]>r){_.show=!1;continue}if(n.length<2||h.length<2){_.show=!1;continue}_.show=!0;const{weight:c,pointCurrent:d,pointNext:u}=ze.getWeightAndPoints(n,h,r),m=[_._modelMatrix[12],_._modelMatrix[13],_._modelMatrix[14]],p=ze.getLinearInterpolationPosition(c,d,u);e.Vector3.equals(d,u)||(_.rotation=ze.getRotation(d,u,t)),_.position=e.Vector3.unpack(p),o&&(_._map=t._map,this.trackingAnimation(_,p,m)),a&&a({time:r,modelId:_.instanceName,currentPosition:e.Transforms.cartesian3ToCartographic(p),totalMileage:this.animationAction._blender.trackCalculation.trackLength});}}}}updateGeojsonAnimation(e){e.animationsInfo=e.animationsInfo||{},e.animationsInfo.currentClipTime=this.currentClipTime,e.animationsInfo.enabled=this.enabled||!1;}updatePrimitiveAnimation(t){if(!this.enabled)return;const i=this.animationClip.tracks,s=this.animationClip.dirty,r=this.currentClipTime;for(const n of i){if("positionKeyframeTrack"===n.type){const i=n.values,s=n.times,o=n.translations||[],{weight:a,pointCurrent:l,pointNext:h,currentIndex:_}=ze.getWeightAndPoints(s,i,r);if(s.length<2||i.length<2)continue;const c=e.Vector3.unpack(ze.getLinearInterpolationPosition(a,l,h)),d=e.Transforms.eastNorthUpToFixedFrame(c);if(o.length>0){const t=e.Vector3.unpack(ze.getLinearInterpolationPosition(a,o[_],o[_+1]));d.translate(t),e.Matrix4.multiplyByPoint(d,t,c);}if(t.position=c,"BillboardMaterial"===t._material.type){const i=n.textures[_];i?(t._material.defines={USE_BILLBOARDTEXTURE:!0},t._material._texture=i,t.show=!0):(t._material.defines={USE_BILLBOARDTEXTURE:!1},t.show=!1),t._material.position=e.Transforms.cartesian3ToCartographic(c);}t.updateMatrixWorld(!0);}if("trackingKeyframeTrack"===n.type){const i=n.values,s=n.times,{weight:o,pointCurrent:a,pointNext:l}=ze.getWeightAndPoints(s,i,r);if("BillboardMaterial"!==t._material.type&&!e.Vector3.equals(a,l)){const e=ze.getRSModelMatrix(a,l,t);t.setMatrix(e);}const h=ze.getLinearInterpolationPosition(o,a,l);t.position=h,t.updateMatrixWorld(!0);}if("multiPositionKeyframeTrack"===n.type){const i=n.values,o=n.times,a=n.eulers||[],l=n.translations||[],h=n.colors||[];if(!t.animationModelInstanceCollection||s){this.animationClip.dirty=!1;const s=i.map((e=>e[0]));t.animationModelInstanceCollection=new it({instances:lt(s)}),t.setInstanceProperties(),t.matrixAutoUpdate=!1,t.setMatrix(new e.Matrix4),t.updateMatrixWorld(!0);}if(!t.animationModelInstanceCollection)return;for(let s=0;s<o.length;s++){const _=o[s],c=i[s],d=a[s]||[],u=l[s]||[],m=h[s]||[],p=t.animationModelInstanceCollection.instances.get(s);if(_[0]>r){p.show=!1;continue}if(_.length<2||c.length<2){p.show=!1;continue}p.show=!0;const{weight:f,pointCurrent:g,pointNext:y,currentIndex:T}=ze.getWeightAndPoints(_,c,r),C=ze.getLinearInterpolationPosition(f,g,y),x=e.Transforms.eastNorthUpToFixedFrame(C);if(u.length>0){const t=ze.getLinearInterpolationPosition(f,u[T],u[T+1]);x.translate(e.Vector3.unpack(t));}if(d.length>0){const e=n.rotateOrder,t=ze.getLinearInterpolationPosition(f,d[T],d[T+1]),i=ze.getRotationMatrixFromEuler(t,e);x.multiplyRight(i);}x.multiplyRight(t.originalRotationScaleMatrix.clone()),t.animationModelInstanceCollection.updateInstanceMatrixByIndex(s,x),m.length>0&&(t.color=m[T]);}t.boundingVolume=t.animationModelInstanceCollection.boundingVolume;}if("multiTrackingKeyframeTrack"===n.type){const i=n.values,o=n.times;if(!t.animationModelInstanceCollection||s){this.animationClip.dirty=!1;const s=i.map((e=>e[0]));t.animationModelInstanceCollection=new it({instances:lt(s)}),t.setInstanceProperties(),t.matrixAutoUpdate=!1,t.setMatrix(new e.Matrix4),t.updateMatrixWorld(!0);}if(!t.animationModelInstanceCollection)return;for(let s=0;s<o.length;s++){const n=o[s],a=i[s],l=t.animationModelInstanceCollection.instances.get(s);if(n[0]>r){l.show=!1;continue}if(n.length<2||a.length<2){l.show=!1;continue}l.show=!0;let h=new e.Matrix4;const{weight:_,pointCurrent:c,pointNext:d}=ze.getWeightAndPoints(n,a,r),u=ze.getLinearInterpolationPosition(_,c,d);e.Vector3.equals(c,d)?(h=e.Transforms.eastNorthUpToFixedFrame(u),h.multiplyRight(t.originalRotationScaleMatrix.clone())):h=ze.getRSModelMatrix(c,d,t),h[12]=u[0],h[13]=u[1],h[14]=u[2],t.animationModelInstanceCollection.updateInstanceMatrixByIndex(s,h);}t.boundingVolume=t.animationModelInstanceCollection.boundingVolume;}}}trackingAnimation(t,i,s){const r=this.animationAction._blender.trackingOptions;if(e.defined(r)&&e.defined(r.trackingModel)&&(r.trackingModel===t.id||r.trackingModel===t._instanceName))switch(r.trackingMode){case rt.FOLLOW:if(r.onset){const s=r.onset.distance,n=r.onset.heading??r.onset.bearing??0,o=r.onset.pitch??0,a=s*Math.sin(o*Math.PI/180)*180/(6378137*Math.PI),l=s*Math.cos(o*Math.PI/180),h=e.Vector3.fromArray(i),_=e.Transforms.cartesian3ToCartographic(h),c=e.Vector3.fromDegrees(_[0],_[1]-a,_[2]+l);let d;const u=t._map.transform.activeCamera;this.needUpdateCamera?(d={heading:n*Math.PI/180,pitch:o*Math.PI/180-.5*Math.PI,roll:u.roll},this.needUpdateCamera=!1):d={heading:u.heading,pitch:u.pitch,roll:u.roll},u.setView({destination:c,orientation:d}),Ge.executeEvent(t._map,"move");}break;case rt.LOCK:{const n=e.Transforms.cartesian3ToCartographic(s),o=e.Transforms.cartesian3ToCartographic(i),a=st(n[1],n[0],o[1],o[0]).bearing;if(r.onset){const l=r.onset.distance,h=r.onset.pitch??0,_=l*Math.sin(at(h))*180/(6378137*Math.PI)*Math.cos(at(a)),c=l*Math.sin(at(h))*180/(6378137*Math.PI)*Math.sin(at(a)),d=l*Math.cos(h*Math.PI/180),u=e.Vector3.fromArray(i),m=e.Transforms.cartesian3ToCartographic(u),p=e.Vector3.fromDegrees(m[0]-c,m[1]-_*Math.sin(at(h)),m[2]+d),f=o[2]-n[2],g=0===f?0:Math.asin(f/e.Vector3.distance(e.Vector3.fromArray(s),e.Vector3.fromArray(i))),y=a*Math.PI/180,T=(h+180*g/Math.PI)*Math.PI/180-.5*Math.PI;t._map.transform.activeCamera.setView({destination:p,orientation:{heading:y,pitch:T}}),Ge.executeEvent(t._map,"move");}}}}}function at(e){return e*Math.PI/180}function lt(t){const i=[];return t.forEach(((t,s)=>{i.push({modelMatrix:(new e.Matrix4).translate(t),batchId:s});})),i}class ht{constructor(t,i){if(!e.defined(t))throw new e.DeveloperError("must have root");this._root=t,this.id=t.id,this.time=0,this._actions=[],this._uuid=e.uuid(),this._play=!1,this._setClipAction(e.defaultValue(i,[]));}get actions(){return this._actions}set actions(e){e instanceof ke&&this._actions.push(e);}addClipAction(e){return this._setClipAction([e])}_setClipAction(e){const t=[];for(let i=0;i<e.length;i++){const s=e[i];if(s instanceof He){const e=new ke(this,s);this._initRootAnimationProperty(e),this.actions=e,t.push(e);}}return t}_activateAction(e){const t=this._root.animationPropertyCollection.get(`${e._clip.id}-${e.id}`);t.enabled=e.enabled,this.trackingOptions?.onset&&(t.needUpdateCamera=!0);}_deactivateAction(e){this._root.animationPropertyCollection.get(`${e._clip.id}-${e.id}`).enabled=e.enabled;}play(){this._play=!0,this._actions[0].enabled=!0,this._activateAction(this._actions[0]),this?._root?._map&&this.trackingOptions&&Ge.executeEvent(this._root._map,"movestart"),this.onPlay&&this.onPlay({time:this._actions[0].time});}pause(){this._play=!1,this._actions[0].enabled=!1,this._deactivateAction(this._actions[0]),this.onPause&&this.onPause({time:this._actions[0].time});}stop(t=!0){if(this._play&&this.trackingOptions&&this?._root?._map&&Ge.executeEvent(this._root._map,"moveend"),this._actions[0].reset(),this.time=0,this._play=!1,this._actions[0].enabled=!1,this._deactivateAction(this._actions[0]),t)switch(this._root.type){case"3d-model-instance":this._root.modelInstanceCollection?._instances.forEach((e=>{e.modelMatrix=e._originalMatrix;}));break;case"geojson":this._root.animationsInfo.currentClipTime=0,this._root.animationsInfo.enabled=!1;break;default:this._root.position=new e.Vector3(e.Transforms.cartographicToCartesian3(this._root._options.position)),this._root.animationLock=!0,this._root.rotation=this._root._rotation,this._root.animationLock=!1,this._root.updateMatrixWorld(!0);}this.onStop&&this.onStop({time:this._actions[0].time});}reset(){this._actions[0].reset(),this.time=0,this.onReset&&this.onReset({time:this._actions[0].time}),this.play();}update(e){if(!this._play)return;const t=this.time+=e;this.actions[0].update(t,e);}_initRootAnimationProperty(t){this._root.animationPropertyCollection=this._root.animationPropertyCollection||new e.AnimationPropertyCollection;let i=this._root.animationPropertyCollection.get(`${t._clip.id}-${t.id}`);i||(i=new ot(t),this._root.animationPropertyCollection.add(i));}speed=1;autoStop=!1}class _t{constructor(e,t){if(void 0===e)throw new Error("minemap.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error(`minemap.KeyframeTrack: no keyframes in track named ${e}`);this.name=e;}destroy(){this.times=null,this.values=null;}}class ct extends _t{constructor(e,t,i,s,r,n,o,a){super(e,t),this.type="positionKeyframeTrack",this.times=t,this.values=ct.parsePoints(i,"pos"),s&&(this.eulers=ct.parsePoints(s,"deg")),r&&(this.translations=ct.parsePoints(r,"trans")),this.rotateOrder=n||"x-y-z",o&&a?(this.colors=o,this.primitiveNames=a):(this.colors=[],this.primitiveNames=[]);}static parsePoints(t,i){return "pos"===i?e.Vector3.fromDegreesArrayHeights(t):"deg"===i?ct.parsePointsDegree(t):"trans"===i?ct.parseTranslations(t):void 0}static parsePointsDegree(t){if(t.length%3==0){const i=[];for(let s=0;s<t.length;s+=3){const r=[];r[0]=t[s]*e.CONSTS.TRANSFORM.DEG_TO_RAD,r[1]=t[s+1]*e.CONSTS.TRANSFORM.DEG_TO_RAD,r[2]=t[s+2]*e.CONSTS.TRANSFORM.DEG_TO_RAD,i.push(r);}return i}}static parseTranslations(e){if(e.length%3==0){const t=[];for(let i=0;i<e.length;i+=3)t.push([e[i],e[i+1],e[i+2]]);return t}}parseImageInfo(t,i,s){this.textures=[];let r,n={};for(let o=0;o<this.times.length;o++){let a=!0;const l={};for(const[t,s]of Object.entries(i)){if(0===o&&this.times.length!==s.length)throw new e.DeveloperError(" the 'imageInfo' length must be the same as the 'values' length ");l[t]=s[o],n[t]!==l[t]&&(a=!1);}n=l,a||(r=t(l)?new e.Texture({context:s,image:t(l),pixelFormat:e.WebGLConstants.RGBA}):void 0),this.textures.push(r);}}}class dt extends _t{constructor(e,t,i){super(e,t),this.type="trackingKeyframeTrack",this.times=t,this.values=dt.parsePoints(i);}static parsePoints(t){if(Array.isArray(t))return e.Vector3.fromDegreesArrayHeights(t)}}class ut extends _t{constructor(t,i,s){if(super(t,i),this.type="multiTrackingKeyframeTrack",this.times=ut.validateTimesParameter(i),this.values=ut.parsePoints(s),this.times.length!==this.values.length)throw new e.DeveloperError(" the 'times' length must be the same as the 'values' length ");if(this.trackIds=arguments[8],this.trackIds&&this.trackIds.length!==i.length)throw new e.DeveloperError(" the 'trackIds' length must be the same as the 'times' length ")}static parsePoints(t){const i=[];if(!Array.isArray(t))throw new e.DeveloperError(" 'values' parameter type must be Array< Array<number> >");for(const s of t){if(!Array.isArray(s))throw new e.DeveloperError(" 'values' parameter type must be Array< Array<number> >");i.push(e.Vector3.fromDegreesArrayHeights(s));}return i}static validateTimesParameter(t){if(!Array.isArray(t))throw new e.DeveloperError(" 'times' parameter type must be Array< Array<number> >");for(const i of t)if(!Array.isArray(i))throw new e.DeveloperError(" 'times' parameter type must be Array< Array<number> >");return t}}class mt extends _t{constructor(t,i,s,r,n,o,a,l,h){if(super(t,i),this.type="multiPositionKeyframeTrack",this.times=mt.validateTimesParameter(i),this.values=mt.parsePoints(s,"pos"),r&&(this._angles=r,this.eulers=mt.parsePoints(r,"deg")),n&&(this.translations=mt.parsePoints(n,"trans")),this.rotateOrder=o||"x-y-z",a&&l?(this._colors=a,this.primitiveNames=l):(this._colors=[],this.primitiveNames=[]),h&&(this.trackIds=h),this.times.length!==this.values.length)throw new e.DeveloperError(" the 'times' length must be the same as the 'values' length ");if(r&&this.times.length!==this.eulers.length)throw new e.DeveloperError(" the 'times' length must be the same as the 'angles' length ");if(this.colors.length!==this.primitiveNames.length&&this.colors.length!==this.values.length)throw new e.DeveloperError(" the 'times' length must be the same as the 'colors' length and primitiveNames length");if(h&&this.trackIds.length!==i.length)throw new e.DeveloperError(" the 'trackIds' length must be the same as the 'times' length ")}get colors(){return this._colors}set colors(e){this._colors=e;}static parsePoints(t,i){const s=[];if(!Array.isArray(t))throw new e.DeveloperError(" 'values' parameter type must be Array< Array<number> >");for(const r of t){if(!Array.isArray(r))throw new e.DeveloperError(" 'values' parameter type must be Array< Array<number> >");"pos"===i?s.push(e.Vector3.fromDegreesArrayHeights(r)):"deg"===i?s.push(ct.parsePointsDegree(r)):"trans"===i&&s.push(ct.parseTranslations(r));}return s}static validateTimesParameter(t){if(!Array.isArray(t))throw new e.DeveloperError(" 'times' parameter type must be Array< Array<number> >");for(const i of t)if(!Array.isArray(i))throw new e.DeveloperError(" 'times' parameter type must be Array< Array<number> >");return t}}var pt="4.8.2";const ft=`v${pt.substring(0,1)}.0.0`,gt="minemapapi",yt={DOMAIN:"//minedata.cn",DATA_DOMAIN:"//datahive.minedata.cn",SERVER_DOMAIN:"//datahive.minedata.cn",API_BASE:"/data/",API_URL:"//datahive.minedata.cn/data/",DYN_BASE:"/dynamicdata/",DYN_URL:"//datahive.minedata.cn/dynamicdata/",MERGE_BASE:"/mergeddata/",MERGE_URL:"//datahive.minedata.cn/mergeddata/",OTHER_BASE:"/otherdata/",OTHER_URL:"//datahive.minedata.cn/otherdata/",SERVER_URL:"//datahive.minedata.cn/service/",SRC_BASE:`/${gt}/${ft}`,SRC_URL:`//minedata.cn/${gt}/${ft}`,SERVICE_BASE:"/service",SERVICE_URL:"//minedata.cn/service",REQUIRE_ACCESS_TOKEN:!0,APP_KEY:null,KEY:null,ACCESS_TOKEN:null,spriteUrl:null,MAX_PARALLEL_IMAGE_REQUESTS:16};function Tt(e,t){return Array.isArray(e)?t&&t.x&&t.y?e[(t.x+t.y)%e.length]:e[0]:e}function Ct(t,i,s,r,n,o){switch(t.protocol){case"minemap":{const e=Pt(yt.SRC_URL);t.protocol=e.protocol,t.authority=e.authority;break}case"minemapdata":{const e=Pt(Tt(yt.API_URL,o));t.path=e.path+t.authority+t.path,t.protocol=e.protocol,t.authority=e.authority;break}case"minemapdatad":{const e=Pt(Tt(yt.DYN_URL||"",o));t.path=e.path+t.authority+t.path,t.protocol=e.protocol,t.authority=e.authority;break}case"minemapdatam":{const e=Pt(Tt(yt.MERGE_URL||"",o));t.path=e.path+t.authority+t.path,t.protocol=e.protocol,t.authority=e.authority;break}case"minemapdatao":{const e=Pt(Tt(yt.OTHER_URL||"",o));t.path=e.path+t.authority+t.path,t.protocol=e.protocol,t.authority=e.authority;break}case"mineserver":{const e=Pt(Tt(yt.SERVER_URL||"",o));t.path=e.path+t.authority+t.path,t.protocol=e.protocol,t.authority=e.authority;break}case"cloudservice":{const e=Pt(Tt(yt.SERVER_URL||"",o));t.path=`/${t.authority}${t.path}`,t.protocol=e.protocol,t.authority=e.authority;break}case"mineservice":{const e=Pt(Tt(yt.SERVICE_URL||"",o));t.path=e.path+t.path,t.protocol=e.protocol,t.authority=e.authority;break}}return yt.REQUIRE_ACCESS_TOKEN?(s=s||yt.APP_KEY,r=r||yt.SOLU,n=n||yt.DATA_VERSION,(i=i||yt.KEY)?t.params.push(`key=${i}`):s?t.params.push(`appKey=${s}`):yt.ACCESS_TOKEN&&t.params.push(`token=${yt.ACCESS_TOKEN}`),e.defined(r)&&t.params.push(`solu=${r}`),n&&t.params.push(`version=${n}`),Rt(t)):Rt(t)}function xt(e){return 0===e.indexOf("minemap:")||0===e.indexOf("minemapdata:")||0===e.indexOf("minemapdatad:")||0===e.indexOf("minemapdatam:")||0===e.indexOf("minemapdatao:")||0===e.indexOf("mineserver:")||0===e.indexOf("cloudservice:")||0===e.indexOf("mineservice:")}const bt=function(e,t,i){if(!xt(e))return e;const s=Pt(e);return s.path=`/styles/v1${s.path}`,Ct(s,t,i)},vt=function(t,i){return e.defined(t)&&xt(t)?Ct(Pt(t),i):t},wt=e=>{if(!xt(e))return e;const t=Pt(e);return `${yt.SRC_URL}/${t.authority}${t.path}`},St=function(e,t,i){if(!xt(e))return e;const s=Pt(e);return s.path=`/v4/${s.authority}.json`,s.params.push("secure"),Ct(s,t,i)},At=function(e){const t=Pt(e.url);return t.path=e.url.startsWith("http")?`${e.url}${e.format}${e.extension}`:`${yt.SRC_URL}/sprite/sprite${e.format}${e.extension}`,Array.isArray(yt.spriteUrl)&&yt.spriteUrl[e.index]&&`${yt.spriteUrl[e.index]}${e.format}${e.extension}`||t.path},Et=function(t,i,s,r){if(!t||t.indexOf("auth=true")<0&&!xt(t))return 0===t.indexOf("//")?`${e.window.document.location.protocol}${t}`:t;const n=Pt(t);return function(e){for(let t=0;t<e.length;t++)0===e[t].indexOf("access_token=tk.")&&(e[t]=`access_token=${yt.ACCESS_TOKEN||""}`);}(n.params),Ct(n,void 0,void 0,void 0,void 0,r)},Mt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Pt(e){const t=e.match(Mt);if(!t){const t=e.match(/^\/\/([^/?]+)(\/[^?]+)?\??(.+)?/);if(!t)throw new Error("Unable to parse URL object");return {protocol:"",authority:t[1],path:t[2]||"/",params:t[3]?t[3].split("&"):[]}}return {protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Rt(t){const i=t.params.length?`?${t.params.join("&")}`:"";return t.protocol&&t.protocol.length>0?`${t.protocol}://${t.authority}${t.path}${i}`:`${e.window.document.location.protocol}//${t.authority}${t.path}${i}`}function Bt(t,i,s){const r=function(t,i){if(t)return s(t);if(i){const t=e.pick(i,["tiles","minzoom","maxzoom","attribution","minemap_logo","bounds"]);i.vector_layers&&(t.vectorLayers=i.vector_layers,t.vectorLayerIds=t.vectorLayers.map((e=>e.id))),s(null,t);}};return t.url?e.getJSON(i(St(t.url),e.ResourceType.Source),r):e.exported.frame((()=>r(null,t)))}class It{constructor(t){this._ellipsoid=e.defaultValue(t,e.Ellipsoid.WGS84),this._semimajorAxis=this._ellipsoid.maximumRadius,this._oneOverSemimajorAxis=1/this._semimajorAxis;}get ellipsoid(){return this._ellipsoid}static mercatorAngleToGeodeticLatitude(t){return e.CONSTS.CesiumMath.PI_OVER_TWO-2*Math.atan(Math.exp(-t))}static geodeticLatitudeToMercatorAngle(e){e>It.MaximumLatitude?e=It.MaximumLatitude:e<-It.MaximumLatitude&&(e=-It.MaximumLatitude);const t=Math.sin(e);return .5*Math.log((1+t)/(1-t))}project(t,i){const s=this._semimajorAxis,r=t.longitude*s,n=It.geodeticLatitudeToMercatorAngle(t.latitude)*s,o=t.height;return e.defined(i)?(i.x=r,i.y=n,i.z=o,i):new e.Vector3(r,n,o)}unproject(t,i){const s=this._oneOverSemimajorAxis,r=t.x*s,n=It.mercatorAngleToGeodeticLatitude(t.y*s),o=t.z;return e.defined(i)?(i.longitude=r,i.latitude=n,i.height=o,i):new e.Cartographic(r,n,o)}}It.MaximumLatitude=It.mercatorAngleToGeodeticLatitude(Math.PI);class Dt{crs="EPSG:3857";type=e.ProjectionType.MERCATOR;constructor(t){if(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this._ellipsoid=e.defaultValue(t.ellipsoid,e.Ellipsoid.WGS84),this._numberOfLevelZeroTilesX=e.defaultValue(t.numberOfLevelZeroTilesX,1),this._numberOfLevelZeroTilesY=e.defaultValue(t.numberOfLevelZeroTilesY,1),this._projection=new It(this._ellipsoid),e.defined(t.rectangleSouthwestInMeters)&&e.defined(t.rectangleNortheastInMeters))this._rectangleSouthwestInMeters=t.rectangleSouthwestInMeters,this._rectangleNortheastInMeters=t.rectangleNortheastInMeters;else {const t=this._ellipsoid.maximumRadius*Math.PI;this._rectangleSouthwestInMeters=new e.Vector2(-t,-t),this._rectangleNortheastInMeters=new e.Vector2(t,t);}const i=this._projection.unproject(this._rectangleSouthwestInMeters),s=this._projection.unproject(this._rectangleNortheastInMeters);this._rectangle=new e.Rectangle(i.longitude,i.latitude,s.longitude,s.latitude);}get ellipsoid(){return this._ellipsoid}get rectangle(){return this._rectangle}get projection(){return this._projection}getNumberOfXTilesAtLevel(e){return this._numberOfLevelZeroTilesX<<e}getNumberOfYTilesAtLevel(e){return this._numberOfLevelZeroTilesY<<e}rectangleToNativeRectangle(t,i){const s=this._projection,r=s.project(e.Rectangle.southwest(t)),n=s.project(e.Rectangle.northeast(t));return e.defined(i)?(i.west=r.x,i.south=r.y,i.east=n.x,i.north=n.y,i):new e.Rectangle(r.x,r.y,n.x,n.y)}tileXYToNativeRectangle(t,i,s,r){const n=this.getNumberOfXTilesAtLevel(s),o=this.getNumberOfYTilesAtLevel(s),a=(this._rectangleNortheastInMeters.x-this._rectangleSouthwestInMeters.x)/n,l=this._rectangleSouthwestInMeters.x+t*a,h=this._rectangleSouthwestInMeters.x+(t+1)*a,_=(this._rectangleNortheastInMeters.y-this._rectangleSouthwestInMeters.y)/o,c=this._rectangleNortheastInMeters.y-i*_,d=this._rectangleNortheastInMeters.y-(i+1)*_;return e.defined(r)?(r.west=l,r.south=d,r.east=h,r.north=c,r):new e.Rectangle(l,d,h,c)}tileXYToRectangle(t,i,s,r){const n=this.tileXYToNativeRectangle(t,i,s,r),o=this._projection,a=o.unproject(new e.Vector2(n.west,n.south)),l=o.unproject(new e.Vector2(n.east,n.north));return n.west=a.longitude,n.south=a.latitude,n.east=l.longitude,n.north=l.latitude,n}positionToTileXY(t,i,s){if(!e.Rectangle.contains(this._rectangle,t))return;const r=this.getNumberOfXTilesAtLevel(i),n=this.getNumberOfYTilesAtLevel(i),o=(this._rectangleNortheastInMeters.x-this._rectangleSouthwestInMeters.x)/r,a=(this._rectangleNortheastInMeters.y-this._rectangleSouthwestInMeters.y)/n,l=this._projection.project(t);let h=(l.x-this._rectangleSouthwestInMeters.x)/o|0;h>=r&&(h=r-1);let _=(this._rectangleNortheastInMeters.y-l.y)/a|0;return _>=n&&(_=n-1),e.defined(s)?(s.x=h,s.y=_,s):new e.Vector2(h,_)}}class Ot{crs="EPSG:4326";type=e.ProjectionType.LATLON;constructor(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this._ellipsoid=e.defaultValue(t.ellipsoid,e.Ellipsoid.WGS84),this._rectangle=e.defaultValue(t.rectangle,e.Rectangle.MAX_VALUE),this._projection=new e.GeographicProjection(this._ellipsoid),this._numberOfLevelZeroTilesX=e.defaultValue(t.numberOfLevelZeroTilesX,2),this._numberOfLevelZeroTilesY=e.defaultValue(t.numberOfLevelZeroTilesY,1);}get ellipsoid(){return this._ellipsoid}get rectangle(){return this._rectangle}get projection(){return this._projection}getNumberOfXTilesAtLevel(e){return this._numberOfLevelZeroTilesX<<e}getNumberOfYTilesAtLevel(e){return this._numberOfLevelZeroTilesY<<e}rectangleToNativeRectangle(t,i){const s=e.CONSTS.CesiumMath.toDegrees(t.west),r=e.CONSTS.CesiumMath.toDegrees(t.south),n=e.CONSTS.CesiumMath.toDegrees(t.east),o=e.CONSTS.CesiumMath.toDegrees(t.north);return e.defined(i)?(i.west=s,i.south=r,i.east=n,i.north=o,i):new e.Rectangle(s,r,n,o)}tileXYToNativeRectangle(t,i,s,r){const n=this.tileXYToRectangle(t,i,s,r);return n.west=e.CONSTS.CesiumMath.toDegrees(n.west),n.south=e.CONSTS.CesiumMath.toDegrees(n.south),n.east=e.CONSTS.CesiumMath.toDegrees(n.east),n.north=e.CONSTS.CesiumMath.toDegrees(n.north),n}tileXYToRectangle(t,i,s,r){const n=this._rectangle,o=this.getNumberOfXTilesAtLevel(s),a=this.getNumberOfYTilesAtLevel(s),l=n.width/o,h=t*l+n.west,_=(t+1)*l+n.west,c=n.height/a,d=n.north-i*c,u=n.north-(i+1)*c;return e.defined(r)||(r=new e.Rectangle(h,u,_,d)),r.west=h,r.south=u,r.east=_,r.north=d,r}positionToTileXY(t,i,s){const r=this._rectangle;if(!e.Rectangle.contains(r,t))return;const n=this.getNumberOfXTilesAtLevel(i),o=this.getNumberOfYTilesAtLevel(i);let a=t.longitude;r.east<r.west&&(a+=e.CONSTS.CesiumMath.TWO_PI);let l=(a-r.west)/(r.width/n)|0;l>=n&&(l=n-1);let h=(r.north-t.latitude)/(r.height/o)|0;return h>=o&&(h=o-1),e.defined(s)?(s.x=l,s.y=h,s):new e.Vector2(l,h)}}const Lt="unloaded",Vt="loaded";class Nt{constructor(e,t,i){this.loadingImagery=e,this.imagery=void 0,this.textureCoordinateRectangle=t,this.textureTranslationAndScale=i||[0,0,1,1];}freeResources(){e.defined(this.imagery)&&0===this.imagery.releaseReference()&&this.imagery.rasterTileSource.unloadTile(this.imagery),e.defined(this.loadingImagery)&&(1===this.loadingImagery.state&&this.loadingImagery.rasterTileSource.abortTile(this.loadingImagery),0===this.loadingImagery.releaseReference()&&this.loadingImagery.rasterTileSource.unloadTile(this.loadingImagery));}loadImage(e){this.loadingImagery.loadImage(e);}process(t,i,s){if(this.loadingImagery&&4===this.loadingImagery.state)return e.defined(this.imagery)&&0===this.imagery.releaseReference()&&this.imagery.rasterTileSource.unloadTile(this.imagery),this.imagery=this.loadingImagery,this.loadingImagery=void 0,this.textureTranslationAndScale=i.calculateTextureTranslationAndScale(t,this),void(t.sourceCache.map.needRepaint=!0);s||i.loadTile(this,(()=>{4===this.loadingImagery.state&&(e.defined(this.imagery)&&!this.imagery.isDestroyed&&0===this.imagery.releaseReference()&&this.imagery.rasterTileSource.unloadTile(this.imagery),this.imagery=this.loadingImagery,this.loadingImagery=void 0,this.textureTranslationAndScale=i.calculateTextureTranslationAndScale(t,this),t.sourceCache.map.needRepaint=!0);}));let r=this.loadingImagery.parent;const n=i.projection===e.ProjectionType.MERCATOR;for(;r&&(4!==r.state||!n&&!e.defined(r.texture));)r=r.parent;this.imagery!==r&&(e.defined(this.imagery)&&!this.imagery.isDestroyed&&0===this.imagery.releaseReference()&&this.imagery.rasterTileSource.unloadTile(this.imagery),this.imagery=r,e.defined(r)&&(r.addReference(),this.textureTranslationAndScale=i.calculateTextureTranslationAndScale(t,this)),t.sourceCache.map.needRepaint=!0);}}var Ft=Object.freeze({__proto__:null,MathArray:e.MathArray,Vector:e.Vector,Vector2:e.Vector2,Vector3:e.Vector3,Vector4:e.Vector4,Cartographic:e.Cartographic,Matrix:e.Matrix,Matrix2:e.Matrix2,Matrix3:e.Matrix3,Matrix4:e.Matrix4,Quaternion:e.Quaternion,HeadingPitchRoll:e.HeadingPitchRoll,Euler:e.Euler,toRadians:e.toRadians,toDegrees:e.toDegrees});const Gt=new e.Rectangle,kt=new e.Rectangle;class Ut extends e.Evented{constructor(){super();}createTileImagerySkeletons(t){const i=t.rectangle;this.projection||(this.projection=t.sourceCache.map.projection,this._tilingScheme=t.sourceCache.map._tilingScheme);const s=this._tilingScheme,r=e.Rectangle.intersection(s.rectangle,this.rectangle);if(!r)return [];const n=e.Rectangle.intersection(i,r);if(!n)return [];let o=t.tileID.canonical.z+Math.log2(512/this.tileSize);o=Math.min(o,this.maxzoom),o=s.type===e.ProjectionType.LATLON?Math.max(1,o)-1:Math.max(0,o);const a=s.positionToTileXY(e.Rectangle.northwest(n),o),l=s.positionToTileXY(e.Rectangle.southeast(n),o);let h=i.width/512,_=i.height/512;const c=s.tileXYToRectangle(a.x,a.y,o);Math.abs(c.south-i.north)<_&&a.y<l.y&&++a.y,Math.abs(c.east-i.west)<h&&a.x<l.x&&++a.x;const d=s.tileXYToRectangle(l.x,l.y,o);Math.abs(d.north-i.south)<_&&l.y>a.y&&--l.y,Math.abs(d.west-i.east)<h&&l.x>a.x&&--l.x;const u=e.Rectangle.clone(i);let m,p,f=s.tileXYToRectangle(a.x,a.y,o),g=e.Rectangle.intersection(f,r);this.projection===e.ProjectionType.MERCATOR?(s.rectangleToNativeRectangle(u,u),s.rectangleToNativeRectangle(f,f),s.rectangleToNativeRectangle(g,g),s.rectangleToNativeRectangle(r,r),m=s.tileXYToNativeRectangle.bind(s),h=u.width/512,_=u.height/512):m=s.tileXYToRectangle.bind(s);let y,T=0,C=1;Math.abs(g.west-u.west)>=h&&(T=Math.min(1,(g.west-u.west)/u.width)),Math.abs(g.north-u.north)>=_&&(C=Math.max(0,(g.north-u.south)/u.height));const x=C,b=[];for(let i=a.x;i<=l.x;i++){p=T,f=m(i,a.y,o),g=e.Rectangle.simpleIntersection(f,r),T=Math.min(1,(g.east-u.west)/u.width),i===l.x&&Math.abs(g.east-u.east)<h&&(T=1),C=x;for(let s=a.y;s<=l.y;s++){y=C,f=m(i,s,o),g=e.Rectangle.simpleIntersection(f,r),C=Math.max(0,(g.south-u.south)/u.height),s===l.y&&Math.abs(g.south-u.south)<_&&(C=0);const n=new e.Vector4(p,1-y,T,1-C),a=this.getImageryFromCache(i,s,t.sourceCache.map._tilingScheme.type===e.ProjectionType.LATLON?o+1:o);b.push(new Nt(a,n));}}return b}calculateTextureTranslationAndScale(t,i){let s=i.imagery.rectangle,r=t.rectangle;if(this.projection===e.ProjectionType.MERCATOR){const e=this._tilingScheme;s=e.rectangleToNativeRectangle(s,Gt),r=e.rectangleToNativeRectangle(r,kt);}const n=r.width,o=r.height,a=n/s.width,l=o/s.height;return new e.Vector4(a*(r.west-s.west)/n,l*(s.north-r.north)/o,a,l)}getImageryFromCache(e,t,i){const s=`${i}_${e}_${t}`;let r=this._imageryCache.get(s);return r||(r=new Ht(e,t,i,this),this._imageryCache.set(s,r)),r.addReference(),r}removeImageryFromCache(e){this._imageryCache.delete(`${e.level}_${e.x}_${e.y}`);}hasTransition(){return !1}}class Ht{constructor(t,i,s,r){this.rasterTileSource=r,this.x=t,this.y=i,this.level=s,this.tileID=new e.OverscaledTileID(s,0,s,t,i),0!==s&&(this.parent=r.getImageryFromCache(t/2|0,i/2|0,s-1)),this.state=0,this.texture=void 0,this.referenceCount=0,this.rectangle=r._tilingScheme.tileXYToRectangle(t,i,r._tilingScheme.type===e.ProjectionType.LATLON?s-1:s);}addReference(){++this.referenceCount;}releaseReference(){return --this.referenceCount,0===this.referenceCount?(this.rasterTileSource.removeImageryFromCache(this),e.defined(this.parent)&&0===this.parent.releaseReference()&&this.parent.rasterTileSource.unloadTile(this.parent),e.defined(this.texture)&&this.texture.destroy(),this.state=8,e.destroyObject(this),0):this.referenceCount}loadImage(t){const{painter:i,callback:s,url:r}=t;let n=t.data;const o=i.context;if(n.img)if(e.window.hasOwnProperty("createImageBitmap")){let i=e.window.createImageBitmap(n.img,{premultiplyAlpha:"none"});i.then((r=>{if(2!==this.state)return;const a=o.gl;this.texture=new e.Texture({context:o,image:r,pixelFormat:e.WebGLConstants.RGBA,useMipmap:!1}),this.texture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),o.extTextureFilterAnisotropic&&(a.bindTexture(this.texture._target,this.texture.texture),a.texParameterf(e.WebGLConstants.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.ContextLimits._maximumTextureFilterAnisotropy),a.bindTexture(this.texture._target,null)),n.img=null,n=null,r=null,this.state=4,t.url=null,t.painter=null,t=null,i=null,s&&s();})).catch((()=>{2===this.state&&(this.texture=new e.Texture({context:o,image:{width:1,height:1,data:null},pixelFormat:e.WebGLConstants.RGBA,useMipmap:!1}),this.texture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),this.state=6,s&&s());}));}else {if(2!==this.state)return;this.texture=new e.Texture({context:o,image:n.img,pixelFormat:e.WebGLConstants.RGBA,useMipmap:!1}),this.texture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),n.img=null,n=null,t.url=null,t.painter=null,t=null,this.state=4,s&&s();}else e.getImage({url:r},((t,i)=>{if(2===this.state){if(t)throw new Error(t);this.texture=new e.Texture({context:o,image:i,pixelFormat:e.WebGLConstants.RGBA,useMipmap:!1}),this.texture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),i=null,this.state=4,s&&s();}}));}}class zt extends e.Evented{constructor(t,i,s,r){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=24,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this.dispatcher=s,this.setEventedParent(r),this._data=i.data,this._options=e.extend({},i),this._collectResourceTiming=i.collectResourceTiming,this._resourceTiming=[],void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.noBox=i.noBox;const n=e.EXTENT/this.tileSize;this.promoteId=i.promoteId,this.workerOptions=e.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*n,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*n,extent:e.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:e.EXTENT,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*n,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions),this._timestamp=Date.now(),this._imageryCache=new Map;}load(){this.fire(new e.Event("dataloading",{dataType:"source"})),this._updateWorkerData((t=>{if(t)return void this.fire(new e.ErrorEvent(t));const i={dataType:"source",sourceDataType:"metadata"};this._collectResourceTiming&&this._resourceTiming&&this._resourceTiming.length>0&&(i.resourceTiming=this._resourceTiming,this._resourceTiming=[]),this.fire(new e.Event("data",i));}));}onAdd(e){this.map=e,this.load();}setData(t){return t||console.error("data不可为空，必须是GeoJSON数据对象或者一个url路径!"),this._data=t,this._timestamp=Date.now(),this.fire(new e.Event("dataloading",{dataType:"source"})),this._updateWorkerData((t=>{if(t)return void this.fire(new e.ErrorEvent(t));const i={dataType:"source",sourceDataType:"content"};this._collectResourceTiming&&this._resourceTiming&&this._resourceTiming.length>0&&(i.resourceTiming=this._resourceTiming,this._resourceTiming=[]),this.fire(new e.Event("data",i)),this._eventedParent&&this._eventedParent.reload&&(this._eventedParent.reload(!0),this.map.style.proxySourceCache.clearTiles());})),this}getClusterExpansionZoom(e,t){return this.dispatcher.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},t,this.workerID),this}getClusterChildren(e,t){return this.dispatcher.send("geojson.getClusterChildren",{clusterId:e,source:this.id},t,this.workerID),this}getClusterLeaves(e,t,i,s){return this.dispatcher.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:t,offset:i},s,this.workerID),this}_updateWorkerData(t){const i=e.extend({},this.workerOptions),s=this._data;"string"==typeof s?(i.request=this.map._transformRequest(e.exported.resolveURL(s),e.ResourceType.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(s),this.workerID=this.dispatcher.send(`${this.type}.loadData`,i,((e,s)=>{this._removed||s&&s.abandoned||(this._loaded=!0,s&&s.resourceTiming&&s.resourceTiming[this.id]&&(this._resourceTiming=s.resourceTiming[this.id].slice(0)),this.dispatcher.send(`${this.type}.coalesce`,{source:i.source},null,this.workerID),t(e));}),this.workerID);}loadTile(t,i){const s=void 0===t.workerID?"loadTile":"reloadTile";t.workerID=this.dispatcher.send(s,{type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:e.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,keepBuffer:t.keepBuffer},((e,r)=>(t.unloadVectorData(),t.aborted?i(null):e?i(e):(t.loadVectorData(r,this.map.painter,"reloadTile"===s),i(null)))),this.workerID);}abortTile(e){e.aborted=!0;}unloadTile(e){e.unloadVectorData(),this.dispatcher.send("removeTile",{uid:e.uid,type:this.type,source:this.id},null,e.workerID);}onRemove(){this._removed=!0,this.dispatcher.send("removeSource",{type:this.type,source:this.id},null,this.workerID);}serialize(){return e.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return !1}isEarthSource(){return !0}createTileImagerySkeletons(t,i){const s=t.sourceCache.map._tilingScheme.tileXYToRectangle(t.tileID.canonical.x,t.tileID.canonical.y,t.tileID.canonical.z);this.projection||(this.projection=t.sourceCache.map.projection,this._tilingScheme=t.sourceCache.map._tilingScheme);const r=this._tilingScheme,n=e.Rectangle.intersection(r.rectangle,e.Rectangle.MAX_VALUE);if(!n)return [];const o=e.Rectangle.intersection(s,n);if(!o)return [];const a=i?.canonical.z,l=r.positionToTileXY(e.Rectangle.northwest(o),a),h=r.positionToTileXY(e.Rectangle.southeast(o),a);let _=s.width/512,c=s.height/512;const d=r.tileXYToRectangle(l.x,l.y,a);Math.abs(d.south-s.north)<c&&l.y<h.y&&++l.y,Math.abs(d.east-s.west)<_&&l.x<h.x&&++l.x;const u=r.tileXYToRectangle(h.x,h.y,a);Math.abs(u.north-s.south)<c&&h.y>l.y&&--h.y,Math.abs(u.west-s.east)<_&&h.x>l.x&&--h.x;const m=e.Rectangle.clone(s);let p,f,g=r.tileXYToRectangle(l.x,l.y,a),y=e.Rectangle.intersection(g,n);this.projection===e.ProjectionType.MERCATOR?(r.rectangleToNativeRectangle(m,m),r.rectangleToNativeRectangle(g,g),r.rectangleToNativeRectangle(y,y),r.rectangleToNativeRectangle(n,n),p=r.tileXYToNativeRectangle.bind(r),_=m.width/512,c=m.height/512):p=r.tileXYToRectangle.bind(r);let T,C=0,x=1;Math.abs(y.west-m.west)>=_&&(C=Math.min(1,(y.west-m.west)/m.width)),Math.abs(y.north-m.north)>=c&&(x=Math.max(0,(y.north-m.south)/m.height));const b=x,v=[];for(let t=i.canonical.x;t<=i.canonical.x;t++){f=C,g=p(t,l.y,a),y=e.Rectangle.simpleIntersection(g,n),C=Math.min(1,(y.east-m.west)/m.width),t===h.x&&Math.abs(y.east-m.east)<_&&(C=1),x=b;for(let s=i.canonical.y;s<=i.canonical.y;s++){T=x,g=p(t,s,a),y=e.Rectangle.simpleIntersection(g,n),x=Math.max(0,(y.south-m.south)/m.height),s===h.y&&Math.abs(y.south-m.south)<c&&(x=0);const i=new e.Vector4(f,1-T,C,1-x),r=m.width,o=m.height,l=r/g.width,_=o/g.height,d=new e.Vector4(l*(m.west-g.west)/r,_*(g.north-m.north)/o,l,_),u=this.getImageryFromCache(t,s,a);v.push(new Nt(u,i,d));}}return v}getImageryFromCache(e,t,i,s){const r=`${i}_${e}_${t}`;let n=this._imageryCache.get(r);return n||(n=new Ht(e,t,i,this),this._imageryCache.set(r,n)),n.addReference(s),n}}class Wt extends e.Object3D{constructor(){super(),this._minzoom=0,this._maxzoom=24,this._visible=!0,this._loaded=!1,this._fileSize=1/0,this._classificationType="";}set minzoom(e){this._minzoom=e;}get minzoom(){return this._minzoom}set maxzoom(e){this._maxzoom=e;}get maxzoom(){return this._maxzoom}set visible(e){this._visible=e;}get visible(){return this._visible}get loaded(){return this._loaded}get culled(){return this._culled}get fileSize(){return this._fileSize}get classificationType(){return this._classificationType}set classificationType(e){this._classificationType=e;}get lightingModel(){return this._lightingModel}set lightingModel(e){this._lightingModel=e;}}function jt(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const Xt={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},qt=Xt.global||Xt.self||Xt.window,Kt="object"!=typeof process||"[object process]"!==String(process)||process.browser,Jt="undefined"!=typeof process&&process.version&&process.version.match(/v([0-9]*)/),Zt=Jt&&parseFloat(Jt[1])||0;function Yt(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const Qt={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},$t=Qt.global||Qt.self||Qt.window,ei="object"!=typeof process||"[object process]"!==String(process)||process.browser,ti="function"==typeof importScripts,ii="undefined"!=typeof window&&void 0!==window.orientation,si="undefined"!=typeof process&&process.version&&process.version.match(/v([0-9]*)/);si&&parseFloat(si[1]);const ri=new Map;function ni(e){Yt("string"==typeof e,"worker source");const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function oi(e,t=!0,i){const s=i||new Set;if(e)if(ai(e))s.add(e);else if(ai(e.buffer))s.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"==typeof e)for(const i in e)oi(e[i],t,s);return void 0===i?Array.from(s):[]}function ai(e){return !!e&&(e instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&e instanceof MessagePort||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)}const li=e=>{};class hi{static isSupported(){return "undefined"!=typeof Worker}constructor(e){const{name:t,source:i,url:s}=e;Yt(i||s),this.name=t,this.source=i,this.url=s,this.onMessage=li,this.onError=e=>{console.log(e);},this.terminated=!1,this.worker=this._createBrowserWorker();}destroy(){this.onMessage=li,this.onError=li,this.worker.terminate(),this.terminated=!0;}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||oi(e),this.worker.postMessage(e,t);}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=function({source:e,url:t}){Yt(e&&!t||!e&&t);let i=ri.get(e||t);return i||(t&&(i=function(e){return e.startsWith("http")?ni(`try {\n  importScripts('${e}');\n} catch (error) {\n  console.error(error);\n  throw error;\n}`):e}(t),ri.set(t,i)),e&&(i=ni(e),ri.set(e,i))),Yt(i),i}({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError("No data received");},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0;},e.onmessageerror=e=>{console.error(e);},e}}class _i{constructor(e,t){this.name=e,this.workerThread=t,this.isRunning=!0,this.result=new Promise(((e,t)=>{this._resolve=e,this._reject=t;}));}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t});}done(e){Yt(this.isRunning),this.isRunning=!1,this._resolve(e);}error(e){Yt(this.isRunning),this.isRunning=!1,this._reject(e);}}class ci{constructor({source:e,url:t,name:i="unnamed",maxConcurrency:s=1,onMessage:r,onDebug:n=(()=>{}),reuseWorkers:o=!0}){Yt(e||t),this.source=e,this.url=t,this.name=i,this.maxConcurrency=s,this.onMessage=r,this.onDebug=n,this.reuseWorkers=o,this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1;}destroy(){this.idleQueue.forEach((e=>e.destroy())),this.isDestroyed=!0;}async startJob(e,t=((e,t,i)=>e.done(i)),i=((e,t)=>e.error(t))){const s=new Promise((s=>{this.jobQueue.push({name:e,onMessage:t,onError:i,onStart:s});}));return this._startQueuedJob(),s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",jobName:t.name,workerThread:e,backlog:this.jobQueue.length});const i=new _i(t.name,e);e.onMessage=e=>t.onMessage(i,e.type,e.payload),e.onError=e=>t.onError(i,e),t.onStart(i);try{await i.result;}finally{this.returnWorkerToQueue(e);}}}returnWorkerToQueue(e){this.isDestroyed?e.destroy():(this.reuseWorkers?this.idleQueue.push(e):(e.destroy(),this.count--),this._startQueuedJob());}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.maxConcurrency){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new hi({name:e,source:this.source,url:this.url})}return null}}const di={maxConcurrency:3,maxMobileConcurrency:1,onDebug:()=>{},reuseWorkers:!0};let ui=null;class mi{static isSupported(){return hi.isSupported()}static getWorkerFarm(e={}){return ui=ui||new mi({}),ui.setProps(e),ui}constructor(e){this.props={...di},this.setProps(e),this.workerPools=new Map;}destroy(){this.workerPools.forEach((e=>e.destroy()));}setProps(e){this.props={...this.props,...e};}getWorkerPool({name:e,source:t,url:i}){let s=this.workerPools.get(e);return s||(s=new ci({name:e,source:t,url:i,maxConcurrency:ii?this.props.maxMobileConcurrency:this.props.maxConcurrency,onDebug:this.props.onDebug,reuseWorkers:this.props.reuseWorkers}),this.workerPools.set(e,s)),s}}const pi="undefined"!=typeof __VERSION__?__VERSION__:"beta";function fi(e){const t=e.split(".").map(Number);return {major:t[0],minor:t[1]}}const gi=new Map;class yi{static set onmessage(e){self.onmessage=t=>{if(!Ti(t))return;const{type:i,payload:s}=t.data;e(i,s);};}static addEventListener(e){let t=gi.get(e);t||(t=t=>{if(!Ti(t))return;const{type:i,payload:s}=t.data;e(i,s);}),self.addEventListener("message",t);}static removeEventListener(e){const t=gi.get(e);gi.delete(e),self.removeEventListener("message",t);}static postMessage(e,t){if(self){const i={source:"loaders.gl",type:e,payload:t},s=oi(t);self.postMessage(i,s);}}}function Ti(e){const{type:t,data:i}=e;return "message"===t&&i&&"string"==typeof i.source&&i.source.startsWith("loaders.gl")}"undefined"==typeof __VERSION__||__VERSION__;const Ci={};async function xi(e,t=null,i={}){return t&&(e=function(e,t,i){if(e.startsWith("http"))return e;const s=i.modules||{};return s[e]?s[e]:ei?i.CDN?`${i.CDN}/${t}/dist/libs/${e}`:ti?`../src/libs/${e}`:`modules/${t}/src/libs/${e}`:`modules/${t}/dist/libs/${e}`}(e,t,i)),Ci[e]=Ci[e]||async function(e){if(e.endsWith("wasm")){const t=await fetch(e);return await t.arrayBuffer()}if(ti)return importScripts(e);const t=await fetch(e);return function(e,t){if(ti)return eval.call($t,e),null;const i=document.createElement("script");i.id=t;try{i.appendChild(document.createTextNode(e));}catch(t){i.text=e;}return document.body.appendChild(i),null}(await t.text(),e)}(e),await Ci[e]}"undefined"==typeof __VERSION__||__VERSION__;let bi=0;function vi(e,t={}){return new Promise(((i,s)=>{const r=bi++,n=(e,t)=>{if(t.id===r)switch(e){case"done":yi.removeEventListener(n),i(t.result);break;case"error":yi.removeEventListener(n),s(t.error);}};yi.addEventListener(n),yi.postMessage("process",{id:r,input:e,options:t});}))}async function wi(e,t,i,s,r){const n=e.id,o=function(e,t){const i=t||{},s=`${e.id}-worker.js`;let r=(i[e.id]||{}).workerUrl;return "test"===i._workerType&&(r=`modules/${e.module}/dist/${s}`),r||(r=`${window.minemapCDN}/@mm-loaders.gl/${e.module}/dist/${s}`,r=r.replace(/\/\//g,"/"),0===window.minemapCDN?.indexOf("//")&&(r=`${window.document.location.protocol}/${r}`)),Yt(r),r}(e,i),a=mi.getWorkerFarm(i).getWorkerPool({name:n,url:o});i.fetch&&(i.fetch.dispatcher=null),i.dispatcher=null,i=JSON.parse(JSON.stringify(i));const l=await a.startJob("process-on-worker",Si.bind(null,r));l.postMessage("process",{input:t,options:i});const h=await l.result;return await h.result}async function Si(e,t,i,s){switch(i){case"done":t.done(s);break;case"error":t.error(s.error);break;case"process":const{id:r,input:n,options:o}=s;try{const i=await e(n,o);t.postMessage("done",{id:r,result:i});}catch(e){const i=e instanceof Error?e.message:"unknown error";t.postMessage("error",{id:r,error:i});}break;default:console.warn(`parse-with-worker unknown message ${i}`);}}function Ai(e,t,i){if(e.byteLength<=t+i)return "";const s=new DataView(e);let r="";for(let e=0;e<i;e++)r+=String.fromCharCode(s.getUint8(t+e));return r}var Ei={toArrayBuffer:e=>Buffer.isBuffer(e)?new Uint8Array(e).buffer:e,toBuffer(e){if(ArrayBuffer.isView(e)&&(e=e.buffer),"undefined"!=typeof Buffer&&e instanceof ArrayBuffer){const t=new Buffer(e.byteLength),i=new Uint8Array(e);for(let e=0;e<t.length;++e)t[e]=i[e];return t}return jt(!1)}};function Mi(e){if(Ei.toArrayBuffer&&(e=Ei.toArrayBuffer(e)),e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.buffer;if("string"==typeof e){const t=e;return (new TextEncoder).encode(t).buffer}return e&&"object"==typeof e&&e._toArrayBuffer?e._toArrayBuffer():jt(!1)}function Pi(e,t){return jt(e>=0),jt(t>0),e+(t-1)&~(t-1)}function Ri(e,t,i){let s;if(e instanceof ArrayBuffer)s=new Uint8Array(e);else {const t=e.byteOffset;s=new Uint8Array((e.buffer||e.arrayBuffer).slice(t,t+e.byteLength));}return t.set(s,i),i+Pi(s.byteLength,4)}function Bi(e){return Bi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bi(e)}function Ii(e,t,i){return s=function(e,t){if("object"!=Bi(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var s=i.call(e,"string");if("object"!=Bi(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t),(t="symbol"==Bi(s)?s:s+"")in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e;var s;}function Di(){let e;if("undefined"!=typeof window&&window.performance)e=window.performance.now();else if("undefined"!=typeof process&&process.hrtime){const t=process.hrtime();e=1e3*t[0]+t[1]/1e6;}else e=Date.now();return e}class Oi{constructor(e,t){Ii(this,"name",void 0),Ii(this,"type",void 0),Ii(this,"sampleSize",1),Ii(this,"time",void 0),Ii(this,"count",void 0),Ii(this,"samples",void 0),Ii(this,"lastTiming",void 0),Ii(this,"lastSampleTime",void 0),Ii(this,"lastSampleCount",void 0),Ii(this,"_count",0),Ii(this,"_time",0),Ii(this,"_samples",0),Ii(this,"_startTime",0),Ii(this,"_timerPending",!1),this.name=e,this.type=t,this.reset();}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Di(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Di()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0);}}class Li{constructor(e){Ii(this,"id",void 0),Ii(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this);}get(e){return this._getOrCreate({name:e,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count"})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const t in this.stats)e(this.stats[t]);}getTable(){const e={};return this.forEach((t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0};})),e}_initializeStats(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((e=>this._getOrCreate(e)));}_getOrCreate(e){if(!e||!e.name)return null;const{name:t,type:i}=e;return this.stats[t]||(this.stats[t]=e instanceof Oi?e:new Oi(t,i)),this.stats[t]}}const Vi={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class Ni{constructor(e={}){this.props={...Vi,...e},this.requestQueue=[],this.activeRequestCount=0,this.requestMap=new Map,this.stats=new Li({id:e.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever"),this._deferredUpdate=null;}scheduleRequest(e,t=(()=>0)){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const i={handle:e,getPriority:t},s=new Promise((e=>(i.resolve=e,i)));return this.requestQueue.push(i),this.requestMap.set(e,s),this._issueNewRequests(),s}_issueRequest(e){const{handle:t,resolve:i}=e;let s=!1;const r=()=>{s||(s=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests());};return this.activeRequestCount++,i?i({done:r}):Promise.resolve({done:r})}_issueNewRequests(){this._deferredUpdate||(this._deferredUpdate=setTimeout((()=>this._issueNewRequestsAsync()),0));}_issueNewRequestsAsync(){this._deferredUpdate=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==e){this._updateAllRequests();for(let t=0;t<e;++t)if(this.requestQueue.length>0){const e=this.requestQueue.shift();e&&this._issueRequest(e);}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const i=e[t];this._updateRequest(i)||(e.splice(t,1),this.requestMap.delete(i.handle),t--);}e.sort(((e,t)=>e.priority-t.priority));}_updateRequest(e){return e.priority=e.getPriority(e.handle),!(e.priority<0&&(e.resolve(null),1))}}let Fi="";const Gi={};function ki(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}function Ui(e){if(!e||!e.POSITION)return null;let t=1/0,i=1/0,s=1/0,r=-1/0,n=-1/0,o=-1/0;const a=e.POSITION.value,l=a&&a.length;if(!l)return null;for(let e=0;e<l;e+=3){const l=a[e],h=a[e+1],_=a[e+2];t=l<t?l:t,i=h<i?h:i,s=_<s?_:s,r=l>r?l:r,n=h>n?h:n,o=_>o?_:o;}return [[t,i,s],[r,n,o]]}"undefined"==typeof __VERSION__||__VERSION__,"undefined"==typeof __VERSION__||__VERSION__;const Hi="undefined"!=typeof __VERSION__?__VERSION__:"";qt.loaders=Object.assign(qt.loaders||{},{VERSION:Hi});const zi=e=>"function"==typeof e,Wi=e=>null!==e&&"object"==typeof e,ji=e=>Wi(e)&&e.constructor==={}.constructor,Xi=e=>e&&"function"==typeof e[Symbol.iterator],qi=e=>e&&"function"==typeof e[Symbol.asyncIterator],Ki=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,Ji=e=>"undefined"!=typeof Blob&&e instanceof Blob,Zi=e=>e&&"object"==typeof e&&e.isBuffer,Yi=e=>(e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||Wi(e)&&zi(e.tee)&&zi(e.cancel)&&zi(e.getReader))(e)||(e=>Wi(e)&&zi(e.read)&&zi(e.pipe)&&(e=>"boolean"==typeof e)(e.readable))(e),Qi=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,$i=/^([-\w.]+\/[-\w.+]+)/;function es(e){if("string"!=typeof e)return "";const t=e.match(Qi);return t?t[1]:""}const ts=/\?.*/;function is(e){if(Ki(e)){const t=function(e){if("string"!=typeof e)return "";const t=e.match($i);return t?t[1]:e}(e.headers.get("content-type")),i=es(e.url);return {url:ss(e.url||""),type:t||i||null}}return Ji(e)?{url:ss(e.name||""),type:e.type||""}:"string"==typeof e?{url:ss(e),type:es(e)}:{url:"",type:""}}function ss(e){return e.replace(ts,"")}async function rs(e){if(Ki(e))return e;const t={},i=function(e){return Ki(e)?e.headers["content-length"]||-1:Ji(e)?e.size:"string"==typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}(e);i>=0&&(t["content-length"]=String(i));const{url:s,type:r}=is(e);r&&(t["content-type"]=r);const n=await async function(e){if("string"==typeof e)return `data:,${e.slice(0,5)}`;if(e instanceof Blob){const t=e.slice(0,5);return await new Promise((e=>{const i=new FileReader;i.onload=t=>e(t.target&&t.target.result),i.readAsDataURL(t);}))}return e instanceof ArrayBuffer?`data:base64,${function(e){let t="";const i=new Uint8Array(e);for(let e=0;e<i.byteLength;e++)t+=String.fromCharCode(i[e]);return btoa(t)}(e.slice(0,5))}`:null}(e);n&&(t["x-first-bytes"]=n),"string"==typeof e&&(e=(new TextEncoder).encode(e));const o=new Response(e,{headers:t});return Object.defineProperty(o,"url",{value:s}),o}async function ns(e){let t=`Failed to fetch resource ${e.url} (${e.status}): `;try{e.headers.get("Content-Type").includes("application/json")?t+=await e.text():t+=e.statusText;}catch(e){return t}return t}const os=";base64,";async function as(t,i={}){if("string"!=typeof t)return await rs(t);const s=i.dispatcher;t=function(e){for(const t in Gi)e.startsWith(t)&&(e=e.replace(t,Gi[t]));return e.startsWith("http://")||e.startsWith("https://")||(e=`${Fi}${e}`),e}(t);let r={url:t=e.exported.resolveURL(t),binary:i.binary,mode:"no-cors"};const n=new e.window.AbortController;if(i.isDestroyed&&n.abort(),i.transformRequest){const o=-1==t.indexOf(os)?i.transformRequest(t,e.ResourceType.Source):{url:t},a=new e.window.Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:e.getReferrer(),signal:n.signal});if(i.json&&a.headers.set("Accept","application/json"),!i._abortListMap||i.isDestroyed||i.json||i._abortListMap.set(o.url.split("?")[0],n),e.isWorker()||!s){const e=await fetch(a);if(!e.ok&&i.throws)throw new Error(await ns(e));return e}r={method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,url:o.url,mode:"no-cors"};}else if(e.isWorker()||!s){const e=await fetch(t,i);if(!e.ok&&i.throws)throw new Error(await ns(e));return e}const o=new Promise(((e,t)=>{s.send("fetchLoadersTilesData",{requestOptions:r},((i,s)=>{i&&t(i),e(s);}));}));return await o}class ls{log(){return e=>{}}info(){return e=>{}}warn(){return e=>{}}error(){return e=>{}}}const hs={fetch:null,CDN:"",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,log:new class{constructor(){this.console=console;}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}},metadata:!1,transforms:[],attributeName:null,attributeType:null,reuseWorkers:!0,_workerType:void 0},_s={dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"},cs=()=>{qt.loaders=qt.loaders||{};const{loaders:e}=qt;return e._state=e._state||{},e._state},ds=()=>{const e=cs();return hs.CDN=`${qt.minemapCDN}/@mm-loaders.gl`,hs.CDN=hs.CDN.replace(/\/\//g,"/"),0===qt.minemapCDN?.indexOf("//")&&(hs.CDN=`${qt.document.location.protocol}/${hs.CDN}`),e.globalOptions=e.globalOptions||{...hs},e.globalOptions};function us(e,t){const i=ds(),s=e.fetch||i.fetch,r=e.dispatcher;return "function"==typeof s?s:Wi(s)?(e.transformRequest&&(s.transformRequest=e.transformRequest),s.json=e.json,s.dispatcher=r,e=>as(e,s)):t&&t.fetch?t.fetch:t=>as(t,e)}function ms(e,t,i,s,r,n){for(const i in e){const o=!t&&Wi(e[i]);i in s||"baseUri"===i&&!t||i in r||o||ps(i,n);}}function ps(e,t){const i=e.toLowerCase();let s="";for(const r of t)for(const t in r.options){if(e===t)return `Did you mean '${r.id}.${t}'?`;const n=t.toLowerCase();(i.startsWith(n)||n.startsWith(i))&&(s=s||`Did you mean '${r.id}.${t}'?`);}return s}function fs(e,t){for(const i in t)i in t&&(e[i]=ji(t[i])&&ji(e[i])?{...e[i],...t[i]}:t[i]);}function gs(e){return Array.isArray(e)&&(e=e[0]),!!e&&Array.isArray(e.extensions)}function ys(e){let t;return jt(e,"null loader"),jt(gs(e),"invalid loader"),Array.isArray(e)&&(t=e[1],e=e[0],e={...e,options:{...e.options,...t}}),(e.parseTextSync||e.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const Ts=()=>{const e=cs();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry},Cs=1048576;async function xs(e,t,i){return await new Promise(((s,r)=>{const n=e.slice(t,i),o=new FileReader;o.onload=e=>s(e.target&&e.target.result),o.onerror=e=>r(e),o.readAsArrayBuffer(n);}))}function bs(e){if(Kt||Zt>=10){if("function"==typeof e[Symbol.asyncIterator])return async function*(e){for await(const t of e)yield Mi(t);}(e);if("function"==typeof e.getIterator)return e.getIterator()}return Kt?async function*(e){const t=e.getReader();try{for(;;){const{done:e,value:i}=await t.read();if(e)return;yield Mi(i);}}catch(e){t.releaseLock();}}(e):async function*(e){for(e=await e;;){const t=e.read();if(null===t){if(e._readableState.ended)return;await vs(e);}else yield Mi(t);}}(e)}async function vs(e){return new Promise((t=>{e.once("readable",t);}))}const ws=/\.([^.]+)$/;function Ss(e,t=[],i={},s={}){if(t&&!Array.isArray(t))return ys(t);!function(e){for(const t of e)ys(t);}(t=[...t||[],...Ts()]);const{url:r,type:n}=is(e);let o=function(e,t){const i=t&&t.match(ws),s=i&&i[1];return s&&function(e,t){t=t.toLowerCase();for(const i of e)for(const e of i.extensions)if(e.toLowerCase()===t)return i;return null}(e,s)}(t,r||s.url);if(o=o||function(e,t){for(const i of e){if(i.mimeTypes&&i.mimeTypes.includes(t))return i;if(t===`application/x.${i.id}`)return i;if(i.mimeTypes&&i.mimeTypes.includes("image/crn"))return i;if(i.mimeTypes&&i.mimeTypes.includes("image/ktx"))return i;if(i.mimeTypes&&i.mimeTypes.includes("image/ktx2"))return i;if(i.mimeTypes&&i.mimeTypes.includes("image/basis"))return i}return null}(t,n),o=o||function(e,t){if(!t)return null;for(const i of e)if("string"==typeof t){if(Es(t,i))return i}else if(ArrayBuffer.isView(t)){if(Ms(t.buffer,t.byteOffset,i))return i}else if(t instanceof ArrayBuffer&&Ms(t,0,i))return i;return null}(t,e),!o&&!i.nothrow)throw new Error(As(e));return o}function As(e){const{url:t,type:i}=is(e);let s="No valid loader found";return e&&(s+=` data: "${function(e,t=5){return "string"==typeof e?e.slice(0,t):ArrayBuffer.isView(e)?Ps(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?Ps(e,0,t):""}(e)}", contentType: "${i}"`),t&&(s+=` url: ${t}`),s}function Es(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some((t=>e.startsWith(t)))}function Ms(e,t,i){return (Array.isArray(i.tests)?i.tests:[i.tests]).some((s=>function(e,t,i,s){if(s instanceof ArrayBuffer)return function(e,t,i){if(e.byteLength<(i=i||e.byteLength)||t.byteLength<i)return !1;const s=new Uint8Array(e),r=new Uint8Array(t);for(let e=0;e<s.length;++e)if(s[e]!==r[e])return !1;return !0}(s,e,s.byteLength);switch(typeof s){case"function":return s(e,i);case"string":return s===Ps(e,t,s.length);default:return !1}}(e,t,i,s)))}function Ps(e,t,i){if(e.byteLength<t+i)return "";const s=new DataView(e);let r="";for(let e=0;e<i;e++)r+=String.fromCharCode(s.getUint8(t+e));return r}async function Rs(e,t,i,s){Yt(!s||"string"!=typeof s,"parse no longer accepts final url"),!t||Array.isArray(t)||gs(t)||(s=void 0,i=t,t=void 0),e=await e,i=i||{};let{url:r}=is(e);r||(r=i.url);const n=function(e,t){if(e&&!Array.isArray(e))return e;let i;if(e&&(i=Array.isArray(e)?e:[e]),t&&t.loaders){const e=Array.isArray(t.loaders)?t.loaders:[t.loaders];i=i?[...i,...e]:e;}return i&&i.length?i:void 0}(t,s),o=await async function(e,t=[],i={},s={}){let r=Ss(e,t,{...i,nothrow:!0},s);if(r)return r;if(Ji(e)&&(r=Ss(e=await xs(e,0,10),t,i,s)),!r&&!i.nothrow)throw new Error(As(e));return r}(e,n,i);if(!o)return null;s=function(e,t,i=null){return i||(e={fetch:us(t||{},e),...e},Array.isArray(e.loaders)||(e.loaders=null),e)}({url:r,_parse:Rs,loaders:n},i=function(e,t,i,s){return i=i||[],function(e,t,i=console){hs.CDN=qt.minemapCDN,ms(e,null,0,hs,_s,t);for(const i of t)ms(e&&e[i.id]||{},i.id,0,i.options&&i.options[i.id]||{},i.defaultOptions&&i.defaultOptions[i.id]||{},t);}(e,i=Array.isArray(i)?i:[i]),function(e,t,i){const s={...e.options||{}};return function(e,t){t&&!("baseUri"in e)&&(e.baseUri=t);}(s,i),null===s.log&&(s.log=new ls),fs(s,ds()),fs(s,t),s}(t,e,s)}(i,o,n,r),s||null);const a=await async function(e,t,i,s){if(function(e,t=pi){Yt(e,"no worker provided");let i=e.version;t&&i&&(t=fi(t),i=fi(i));}(e),Ki(t)){const e=t,{ok:i,redirected:r,status:n,statusText:o,type:a,url:l}=e,h=Object.fromEntries(e.headers.entries());s.response={headers:h,ok:i,redirected:r,status:n,statusText:o,type:a,url:l};}if(t=await async function(e,t){const i=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||i)return function(e,t){if(t.text&&"string"==typeof e)return e;if(e instanceof ArrayBuffer){const i=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(e)||Zi(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let i=e.buffer;const s=e.byteLength||e.length;return 0===e.byteOffset&&s===i.byteLength||(i=i.slice(e.byteOffset,e.byteOffset+s)),i}return e}(e,t);if(Ji(e)&&(e=await rs(e)),Ki(e)){const i=e;return await async function(e){if(!e.ok){const t=await async function(e){let t=`Failed to fetch resource ${e.url} (${e.status}): `;try{const i=e.headers.get("Content-Type");let s=e.statusText;i.includes("application/json")&&(s+=` ${await e.text()}`),t+=s,t=t.length>60?`${t.slice(60)}...`:t;}catch(e){}return t}(e);throw new Error(t)}}(i),t.binary?await i.arrayBuffer():await i.text()}return Yi(e)&&(e=function(e,t={}){return "string"==typeof e?function*(e,t={}){const{chunkSize:i=262144}=t;let s=0;const r=new TextEncoder;for(;s<e.length;){const t=Math.min(e.length-s,i),n=e.slice(s,s+t);s+=t,yield r.encode(n);}}(e,t):e instanceof ArrayBuffer?function*(e,t={}){const{chunkSize:i=262144}=t;let s=0;for(;s<e.byteLength;){const t=Math.min(e.byteLength-s,i),r=new ArrayBuffer(t),n=new Uint8Array(e.slice(s,s+t));new Uint8Array(r).set(n),s+=t,yield r;}}(e,t):Ji(e)?async function*(e,t={}){const i=t.chunkSize||Cs;let s=0;for(;s<e.size;){const t=s+i,r=await xs(e,s,t);s=t,yield r;}}(e,t):Yi(e)?bs(e):Ki(e)?bs(e.body):jt(!1)}(e)),Xi(e)||qi(e)?async function(e){const t=[],i=[];for await(const s of e)"string"==typeof s?i.push(s):t.push(s);return i.length>0?(jt(0===t.length),i.join("")):function(...e){const t=e.map((e=>e instanceof ArrayBuffer?new Uint8Array(e):e)),i=t.reduce(((e,t)=>e+t.byteLength),0),s=new Uint8Array(i);let r=0;for(const e of t)s.set(e,r),r+=e.byteLength;return s.buffer}(...t)}(e):e}(t,e),e.parseTextSync&&"string"==typeof t)return e.parseTextSync(t,i,s);if(function(e,t,i,s){return !!mi.isSupported()&&!(!e.worker||!i.worker)&&(!e.useWorker||e.useWorker(i))}(e,0,i))return await wi(e,t,i,0,Rs);if(e.parseText&&"string"==typeof t)return await e.parseText(t,i,s);if(e.parse)return await e.parse(t,i,s);throw Yt(!e.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}(o,e,i,s);return a}async function Bs(e,t,i,s,r){let n,o;Array.isArray(t)||gs(t)?(n=t,o=i):(n=[],o=t);const a=us(o||{});let l=e;return "string"==typeof e?l=await a(e,i):Ji(e)?(l=await a(e),e=null):e=null,i&&(i.modelFolder=r),i.url=e,Array.isArray(n),await Rs(l,n,o)}const Is="undefined"!=typeof __VERSION__?__VERSION__:"latest";function Ds(e,t){if(!e)throw new Error(t)}const Os={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},Ls=Os.global||Os.self||Os.window,Vs="object"!=typeof process||"[object process]"!==String(process)||process.browser,Ns="undefined"!=typeof process&&process.version&&process.version.match(/v([0-9]*)/);Ns&&parseFloat(Ns[1]);const{_parseImageNode:Fs}=Ls,Gs="undefined"!=typeof Image,ks="undefined"!=typeof ImageBitmap,Us=Boolean(Fs),Hs=!!Vs||Us;function zs(e){switch(function(e){const t=function(e){return "undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&e instanceof Image?"image":e&&"object"==typeof e&&e.data&&e.width&&e.height?"data":null}(e);if(!t)throw new Error("Not an image");return t}(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),i=t.getContext("2d");if(i)return t.width=e.width,t.height=e.height,i.drawImage(e,0,0),i.getImageData(0,0,e.width,e.height);default:return Ds(!1)}}const Ws=/^data:image\/svg\+xml/,js=/\.svg((\?|#).*)?$/;function Xs(e){return e&&(Ws.test(e)||js.test(e))}function qs(e,t){if(Xs(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([e])}async function Ks(e,t,i){const s=function(e,t){if(Xs(t)){const t=(new TextDecoder).decode(e);return `data:image/svg+xml;base64,${btoa(t)}`}return qs(e,t)}(e,i),r=self.URL||self.webkitURL,n="string"!=typeof s&&r.createObjectURL(s);try{return await async function(e,t){const i=new Image;return i.src=e,t.image&&t.image.decode&&i.decode?(await i.decode(),i):await new Promise(((t,s)=>{try{i.onload=()=>t(i),i.onerror=t=>s(new Error(`Could not load image ${e}: ${t}`));}catch(e){s(e);}}))}(n||s,t)}finally{n&&r.revokeObjectURL(n);}}const Js={};let Zs=!0;const Ys=!1,Qs=!0;function $s(e){const t=er(e),i=function(e){const t=er(e);return t.byteLength>=24&&2303741511===t.getUint32(0,Ys)?{mimeType:"image/png",width:t.getUint32(16,Ys),height:t.getUint32(20,Ys)}:null}(t)||function(e){const t=er(e);if(!(t.byteLength>=3&&65496===t.getUint16(0,Ys)&&255===t.getUint8(2)))return null;const{tableMarkers:i,sofMarkers:s}=function(){const e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);return {tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}();let r=2;for(;r+9<t.byteLength;){const e=t.getUint16(r,Ys);if(s.has(e))return {mimeType:"image/jpeg",height:t.getUint16(r+5,Ys),width:t.getUint16(r+7,Ys)};if(!i.has(e))return null;r+=2,r+=t.getUint16(r,Ys);}return null}(t)||function(e){const t=er(e);return t.byteLength>=10&&1195984440===t.getUint32(0,Ys)?{mimeType:"image/gif",width:t.getUint16(6,Qs),height:t.getUint16(8,Qs)}:null}(t)||function(e){const t=er(e);return t.byteLength>=14&&16973===t.getUint16(0,Ys)&&t.getUint32(2,Qs)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,Qs),height:t.getUint32(22,Qs)}:null}(t);return i||{mimeType:"image/webp",width:256,height:256}}function er(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}const tr={name:"Images",id:"image",module:"images",version:Is,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml","image/ktx2"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","ktx2"],parse:async function(e,t,i){const s=((t=t||{}).image||{}).type||"auto",{url:r}=i||{};let n;switch(function(e){switch(e){case"auto":case"data":return function(){if(ks)return "imagebitmap";if(Gs)return "image";if(Hs)return "data";throw new Error("Install '@mm-loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return ks||Gs||Hs;case"imagebitmap":return ks;case"image":case"html":return Gs;case"data":case"ndarray":return Hs;default:throw new Error(`@mm-loaders.gl/images: image ${e} not supported in this environment`)}}(e),e}}(s)){case"imagebitmap":n=await async function(e,t,i){let s;s=Xs(i)?await Ks(e,t,i):qs(e,i);const r=t&&t.imagebitmap;return await async function(e,t=null){if(!function(e){for(const t in e||Js)return !1;return !0}(t)&&Zs||(t=null),t)try{return await createImageBitmap(e,t)}catch(e){Zs=!1;}return await createImageBitmap(e)}(s,r)}(e,t,r);break;case"image":n=await Ks(e,t,r);break;case"data":n=await function(e,t){const{mimeType:i}=$s(e)||{},{_parseImageNode:s}=Ls;return Ds(s),s(e,i,t)}(e,t);break;default:Ds(!1);}return "data"===s&&(n=zs(n)),n},tests:[e=>Boolean($s(new DataView(e)))],options:{image:{type:"auto",decode:!0}}},ir={};function sr(e,t){if(!e)throw new Error(t||"assert failed: gltf")}const rr="KHR_binary_glTF",nr="KHR_draco_mesh_compression",or="KHR_lights_punctual",ar="KHR_materials_unlit",lr="KHR_techniques_webgl",hr={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},_r={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},cr=["SCALAR","VEC2","VEC3","VEC4"],dr=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],ur=new Map(dr),mr={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},pr={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},fr={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function gr(e){return cr[e-1]||cr[0]}function yr(e){const t=ur.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function Tr(e,t){const i=mr[e.type];return {ArrayType:fr[e.componentType],length:e.count*i,byteLength:e.count*i*pr[e.componentType],componentByteSize:_r[e.componentType],numberOfComponentsInElement:hr[e.type]}}function Cr(e,t,i){const s=e.bufferViews[i];sr(s);const r=t[s.buffer];sr(r);const n=(s.byteOffset||0)+r.byteOffset;return r.arrayBuffer.slice(n,n+s.byteLength)}class xr{constructor(e){if(e instanceof xr)return e;e||(e={json:{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]},buffers:e?.buffers||[],images:e?.images||[]}),this.sourceBuffers=[],this.byteLength=0,e.buffers&&e.buffers[0]&&(this.byteLength=e.buffers[0].byteLength,this.sourceBuffers=[e.buffers[0]]),this.gltf=e,sr(this.gltf.json);}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return (this.json.extras||{})[e]}hasExtension(e){const t=this.getUsedExtensions().find((t=>t===e)),i=this.getRequiredExtensions().find((t=>t===e));return "string"==typeof t||"string"==typeof i}getExtension(e){const t=this.getUsedExtensions().find((t=>t===e));return t?(this.json.extensions||{})[e]||!0:null}getRequiredExtension(e){const t=this.getRequiredExtensions().find((t=>t===e));return t?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return (e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getCamera(e){return null}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if("object"==typeof t)return t;const i=this.json[e]&&this.json[e][t];if(!i)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return i}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=this.gltf.buffers[e.buffer];sr(t);const i=(e.byteOffset||0)+t.byteOffset;return new Uint8Array(t.arrayBuffer.slice(i,i+e.byteLength))}getTypedArrayDataForBufferViewInSimple(e){e=this.getBufferView(e);const t=this.gltf.buffers[e.buffer];sr(t);const i=(e.byteOffset||0)+t.byteOffset;return t.arrayBuffer.slice(i,i+e.byteLength)}getTypedArrayForAccessor(e){const t=this.getAccessor(e);return function(e,t,i){const s="number"==typeof i?e.accessors?.[i]:i;if(!s)throw new Error(`No gltf accessor ${JSON.stringify(i)}`);const r=e.bufferViews&&e.bufferViews[s.bufferView||0];if(!r)throw new Error(`No gltf buffer view for accessor ${r}`);const{arrayBuffer:n,byteOffset:o}=t[r.buffer],a=(o||0)+(s.byteOffset||0)+(r.byteOffset||0),{ArrayType:l,length:h,componentByteSize:_,numberOfComponentsInElement:c}=Tr(s),d=_*c,u=r.byteStride||d;if(void 0===r.byteStride||r.byteStride===d)return new l(n,a,h);const m=new l(h);for(let e=0;e<s.count;e++){const t=new l(n,a+e*u,c);m.set(t,e*c);}return m}(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer),s=t.byteOffset||0;return new Uint8Array(i.data.slice(s,s+t.byteLength))}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,i){return sr(i),e.extensions=e.extensions||{},e.extensions[t]=i,this.registerUsedExtension(t),this}setObjectExtension(e,t,i){(e.extensions||{})[t]=i;}removeObjectExtension(e,t){const i=e?.extensions||{};if(i[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const e=this.json.extensionsRemoved;e.includes(t)||e.push(t);}delete i[t];}addExtension(e,t={}){return sr(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return sr(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find((t=>t===e))||this.json.extensionsUsed.push(e);}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find((t=>t===e))||this.json.extensionsRequired.push(e);}removeExtension(e){if(this.json.extensions?.[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const t=this.json.extensionsRemoved;t.includes(e)||t.push(e);}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e);}setDefaultScene(e){this.json.scene=e;}addScene({nodeIndices:e}){return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:e}),this.json.scenes.length-1}addNode({meshIndex:e,matrix:t=null}){this.json.nodes=this.json.nodes||[];const i={mesh:e};return t&&(i.matrix=t),this.json.nodes.push(i),this.json.nodes.length-1}addMesh({attributes:e,indices:t,material:i,mode:s=4}){const r={primitives:[{attributes:this._addAttributes(e),mode:s}]};if(t){const e=this._addIndices(t);r.primitives[0].indices=e;}return Number.isFinite(i)&&(r.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(r),this.json.meshes.length-1}addPointCloud(e){const t={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(t),this.json.meshes.length-1}addImage(e,t){t=t||function(e){const t=$s(e);return t?t.mimeType:null}(e);const i={bufferView:this.addBufferView(e),mimeType:t};return this.json.images=this.json.images||[],this.json.images.push(i),this.json.images.length-1}addBufferView(e){const t=e.byteLength;sr(Number.isFinite(t)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const i={buffer:0,byteOffset:this.byteLength,byteLength:t};return this.byteLength+=Pi(t,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}addAccessor(e,t){const i={bufferView:e,type:gr(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){const i=this.addBufferView(e);let s={min:t.min,max:t.max};s.min&&s.max||(s=this._getAccessorMinMax(e,t.size));const r={size:t.size,componentType:yr(e),count:Math.round(e.length/t.size),min:s.min,max:s.max};return this.addAccessor(i,Object.assign(r,t))}addTexture({imageIndex:e}){const t={source:e};return this.json.textures=this.json.textures||[],this.json.textures.push(t),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){this.gltf.buffers=[];const e=this.byteLength,t=new ArrayBuffer(e),i=new Uint8Array(t),s=this.sourceBuffers||[];let r=0;for(let e=0;e<s.length;e++)r=Ri(s[e],i,r);this.json.buffers[0]=this.json.buffers[0]||{},this.json.buffers[0].byteLength=e,this.gltf.binary=t,this.sourceBuffers=[t];}_removeStringFromArray(e,t){let i=!0;for(;i;){const s=e.indexOf(t);s>-1?e.splice(s,1):i=!1;}}_addAttributes(e={}){const t={};for(const i in e){const s=e[i],r=this._getGltfAttributeName(i),n=this.addBinaryBuffer(s.value,s);t[r]=n;}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return "POSITION";case"normal":case"normals":return "NORMAL";case"color":case"colors":return "COLOR_0";case"texcoord":case"texcoords":return "TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const i={min:null,max:null};if(e.length<t)return i;i.min=[],i.max=[];const s=e.subarray(0,t);for(const e of s)i.min.push(e),i.max.push(e);for(let s=t;s<e.length;s+=t)for(let r=0;r<t;r++)i.min[0+r]=Math.min(i.min[0+r],e[s+r]),i.max[0+r]=Math.max(i.max[0+r],e[s+r]);return i}}function br(e){return (e%1+1)%1}const vr={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},wr={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},Sr={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function Ar(e,t){return Sr[t]*vr[e]}function Er(e,t,i,s){if("UINT8"!==i&&"UINT16"!==i&&"UINT32"!==i&&"UINT64"!==i)return null;const r=Mr(e.getTypedArrayForBufferView(t),"SCALAR",i,s+1);return r instanceof BigInt64Array||r instanceof BigUint64Array?null:r}function Mr(e,t,i,s=1){const r=wr[i],n=Sr[i],o=s*vr[t];let a=e.buffer,l=e.byteOffset;return l%n!=0&&(a=new Uint8Array(a.arrayBuffer,l,l+o*n),l=0),new r(a,l,o)}function Pr(e,t,i){const s=e.getTypedArrayForAccessor(i.attributes[`TEXCOORD_${t.texCoord||0}`]),r=e.gltf.json,n=t.index,o=r.textures?.[n]?.source;if(void 0!==o){const i=r.images?.[o]?.mimeType,n=e.gltf.images?.[o];if(n&&void 0!==n.width){const e=[];for(let r=0;r<s.length;r+=2){const o=Br(n,i,s,r,t.channels);e.push(o);}return e}}return []}function Rr(e,t,i,s,r){if(!i?.length)return;const n=[];for(const e of i){let t=s.findIndex((t=>t===e));-1===t&&(t=s.push(e)-1),n.push(t);}const o=new Uint32Array(n),a=e.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,l=e.addBufferView(o,a,0),h=e.addAccessor(l,{size:1,componentType:yr(o),count:o.length});r.attributes[t]=h;}function Br(e,t,i,s,r=[0]){const n={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=i[s],a=i[s+1];let l=1;!t||-1===t.indexOf("image/jpeg")&&-1===t.indexOf("image/png")||(l=4);const h=function(e,t,i,s=1){const r=i.width,n=br(e)*(r-1),o=Math.round(n),a=i.height,l=br(t)*(a-1);return (Math.round(l)*r+o)*(i.components?i.components:s)}(o,a,e,l);let _=0;for(const t of r){const i="number"==typeof t?Object.values(n)[t]:n[t],s=h+i.offset,r=zs(e);if(r.data.length<=s)throw new Error(`${r.data.length} <= ${s}`);_|=r.data[s]<<i.shift;}return _}const Ir="EXT_mesh_features";function Dr(e,t,i){if(!i?.gltf?.loadBuffers)return;const s=t.extensions?.[Ir],r=s?.featureIds;if(r)for(const s of r){let r;r=void 0!==s.attribute?e.getTypedArrayForAccessor(t.attributes[`_FEATURE_ID_${s.attribute}`]||t.attributes[s.attribute]):void 0!==s.texture&&i?.gltf?.loadImages?Pr(e,s.texture,t):[],s.data=r;}}var Or=Object.freeze({__proto__:null,name:Ir,decode:async function(e,t){!function(e,t){const i=e.gltf.json;if(i.meshes)for(const s of i.meshes)for(const i of s.primitives)Dr(e,i,t);}(new xr(e),t);}});const Lr="EXT_structural_metadata";function Vr(e,t){for(const i of e)if(i.class===t)return i;return null}function Nr(e,t,i,s){if(!t)return;const r=i.extensions?.[Lr],n=r?.propertyTextures;if(n)for(const r of n)Fr(e,t[r],i,s);}function Fr(e,t,i,s){if(!t.properties)return;s.dataAttributeNames||(s.dataAttributeNames=[]);const r=t.class;for(const n in t.properties){const o=`${r}_${n}`,a=t.properties?.[n];if(!a)continue;a.data||(a.data=[]);const l=a.data,h=Pr(e,a,i);null!==h&&(Rr(e,o,h,l,i),a.data=l,s.dataAttributeNames.push(o));}}function Gr(e,t,i){const s=t.classes?.[i.class];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${i.class}`);const r=i.count;for(const n in s.properties){const o=s.properties[n],a=i.properties?.[n];if(a){const i=kr(e,t,o,r,a);a.data=i;}}}function kr(e,t,i,s,r){let n=[];const o=e.getTypedArrayForBufferView(r.values),a=function(e,t,i,s){return t.array&&void 0===t.count&&void 0!==i.arrayOffsets?Er(e,i.arrayOffsets,i.arrayOffsetType||"UINT32",s):null}(e,i,r,s),l=function(e,t,i){return void 0!==t.stringOffsets?Er(e,t.stringOffsets,t.stringOffsetType||"UINT32",i):null}(e,r,s);switch(i.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":n=function(e,t,i,s){const r=e.array,n=e.count,o=Ar(e.type,e.componentType);let a;return a=e.componentType?Mr(i,e.type,e.componentType,i.byteLength/o):i,r?s?function(e,t,i,s,r){const n=[];for(let o=0;o<t;o++){const t=i[o],a=i[o+1]-i[o];if(a+t>s)break;const l=t/r;n.push(e.slice(l,l+a/r));}return n}(a,t,s,i.length,o):n?function(e,t,i){const s=[];for(let r=0;r<t;r++){const t=r*i;s.push(e.slice(t,t+i));}return s}(a,t,n):[]:a}(i,s,o,a);break;case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${i.type}`);case"STRING":n=function(e,t,i,s){if(i)throw new Error("Not implemented - arrayOffsets for strings is specified");if(s){const i=[],r=new TextDecoder("utf8");let n=0;for(let o=0;o<e;o++){const e=s[o+1]-s[o];if(e+n<=t.length){const s=t.subarray(n,e+n),o=r.decode(s);i.push(o),n+=e;}}return i}return []}(s,o,a,l);break;case"ENUM":n=function(e,t,i,s,r){const n=t.enumType;if(!n)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const o=e.enums?.[n];if(!o)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${n}`);const a=o.valueType||"UINT16",l=Ar(t.type,a);let h=Mr(s,t.type,a,s.byteLength/l);if(h||(h=s),t.array){if(r)return function(e){const{valuesData:t,numberOfElements:i,arrayOffsets:s,valuesDataBytesLength:r,elementSize:n,enumEntry:o}=e,a=[];for(let e=0;e<i;e++){const i=s[e],l=s[e+1]-s[e];if(l+i>r)break;const h=Ur(t,i/n,l/n,o);a.push(h);}return a}({valuesData:h,numberOfElements:i,arrayOffsets:r,valuesDataBytesLength:s.length,elementSize:l,enumEntry:o});const e=t.count;return e?function(e,t,i,s){const r=[];for(let n=0;n<t;n++){const t=Ur(e,i*n,i,s);r.push(t);}return r}(h,i,e,o):[]}return Ur(h,0,i,o)}(t,i,s,o,a);break;default:throw new Error(`Unknown classProperty type ${i.type}`)}return n}function Ur(e,t,i,s){const r=[];for(let n=0;n<i;n++)if(e instanceof BigInt64Array||e instanceof BigUint64Array)r.push("");else {const i=Hr(s,e[t+n]);r.push(i?i.name:"");}return r}function Hr(e,t){for(const i of e.values)if(i.value===t)return i;return null}var zr=Object.freeze({__proto__:null,name:Lr,decode:async function(e,t){!function(e,t){if(!t.gltf?.loadBuffers)return;const i=e.getExtension(Lr);i&&(t.gltf?.loadImages&&function(e,t){const i=t.propertyTextures,s=e.gltf.json;if(i&&s.meshes)for(const r of s.meshes)for(const s of r.primitives)Nr(e,i,s,t);}(e,i),function(e,t){const i=t.schema;if(!i)return;const s=i.classes,r=t.propertyTables;if(s&&r)for(const t in s){const s=Vr(r,t);s&&Gr(e,i,s);}}(e,i));}(new xr(e),t);}});const Wr="undefined"!=typeof __VERSION__?__VERSION__:"latest",jr="undefined"!=typeof __VERSION__?__VERSION__:"beta",Xr="undefined"!=typeof __VERSION__?__VERSION__:"beta";let qr,Kr,Jr="/basis_encoder.wasm",Zr="/basis_encoder.js";async function Yr(e){const t=e.modules||{};return t.basis?t.basis:(qr=qr||async function(e){let t=null,i=null;return [t,i]=await Promise.all([await xi("basis_transcoder.js","textures",e),await xi("basis_transcoder.wasm","textures",e)]),t=t||globalThis.BASIS,await function(e,t){const i={};return t&&(i.wasmBinary=t),new Promise((t=>{e(i).then((e=>{const{BasisFile:i,initializeBasis:s}=e;s(),t({BasisFile:i});}));}))}(t,i)}(e),await qr)}async function Qr(e){const t=e.modules||{};return t.basisEncoder?t.basisEncoder:(Kr=Kr||async function(e){let t=null,i=null;if(e.CDN)Zr=`${e.CDN}/textures/dist${Zr}`,Jr=`${e.CDN}/textures/dist${Jr}`;else {const e=`https://unpkg.com/@loaders.gl/textures@${Xr}/dist/libs`;Zr=`${e}${Zr}`,Jr=`${e}${Jr}`;}return [t,i]=await Promise.all([await xi(Zr,"textures",e),await xi(Jr,"textures",e)]),t=t||globalThis.BASIS,await function(e,t){const i={};return t&&(i.wasmBinary=t),new Promise((t=>{e(i).then((e=>{const{BasisFile:i,KTX2File:s,initializeBasis:r,BasisEncoder:n}=e;r(),t({BasisFile:i,KTX2File:s,BasisEncoder:n});}));}))}(t,i)}(e),await Kr)}const $r={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},en=["","WEBKIT_","MOZ_"],tn={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let sn=null;var rn=e.createCommonjsModule((function(e,t){var i,s,r,n,o,a,l,h;t.__esModule=!0,t.KTX2DataFormatChannelUASTC=t.KTX2DataFormatChannelETC1S=t.KTX2DataFormatFlags=t.KTX2DataFormatTransfer=t.KTX2DataFormatPrimaries=t.KTX2DataFormatModel=t.VK_FORMAT_UNDEFINED=t.KHR_DF_BLOCKSIZE=t.KHR_DF_VERSION=t.KHR_DF_VENDORID_KHRONOS=t.KTX2DataFormatType=t.KTX2SupercompressionScheme=t.HEADER_BYTE_LENGTH=t.KTX2_ID=t.NUL=t.KTX_WRITER=void 0,t.KTX_WRITER="KTX-Parse v0.0.4",t.NUL=new Uint8Array([0]),t.KTX2_ID=[171,75,84,88,32,50,48,187,13,10,26,10],t.HEADER_BYTE_LENGTH=68,(i=t.KTX2SupercompressionScheme||(t.KTX2SupercompressionScheme={}))[i.NONE=0]="NONE",i[i.BASISLZ=1]="BASISLZ",i[i.ZSTD=2]="ZSTD",i[i.ZLIB=3]="ZLIB",(s=t.KTX2DataFormatType||(t.KTX2DataFormatType={}))[s.BASICFORMAT=0]="BASICFORMAT",t.KHR_DF_VENDORID_KHRONOS=0,t.KHR_DF_VERSION=2,t.KHR_DF_BLOCKSIZE=40,t.VK_FORMAT_UNDEFINED=0,(r=t.KTX2DataFormatModel||(t.KTX2DataFormatModel={}))[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.ETC1S=163]="ETC1S",r[r.UASTC=166]="UASTC",(n=t.KTX2DataFormatPrimaries||(t.KTX2DataFormatPrimaries={}))[n.UNSPECIFIED=0]="UNSPECIFIED",n[n.SRGB=1]="SRGB",(o=t.KTX2DataFormatTransfer||(t.KTX2DataFormatTransfer={}))[o.UNSPECIFIED=0]="UNSPECIFIED",o[o.LINEAR=1]="LINEAR",o[o.SRGB=2]="SRGB",o[o.ITU=3]="ITU",o[o.NTSC=4]="NTSC",o[o.SLOG=5]="SLOG",o[o.SLOG2=6]="SLOG2",(a=t.KTX2DataFormatFlags||(t.KTX2DataFormatFlags={}))[a.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",a[a.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED",(l=t.KTX2DataFormatChannelETC1S||(t.KTX2DataFormatChannelETC1S={}))[l.RGB=0]="RGB",l[l.RRR=3]="RRR",l[l.GGG=4]="GGG",l[l.AAA=15]="AAA",(h=t.KTX2DataFormatChannelUASTC||(t.KTX2DataFormatChannelUASTC={}))[h.RGB=0]="RGB",h[h.RGBA=3]="RGBA",h[h.RRR=4]="RRR",h[h.RRRG=5]="RRRG";})),nn=e.createCommonjsModule((function(e,t){t.__esModule=!0,t.KTX2Container=void 0,t.KTX2Container=function(){this.vkFormat=rn.VK_FORMAT_UNDEFINED,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=rn.KTX2SupercompressionScheme.NONE,this.levels=[],this.dataFormatDescriptor=[{vendorId:rn.KHR_DF_VENDORID_KHRONOS,descriptorType:rn.KTX2DataFormatType.BASICFORMAT,versionNumber:rn.KHR_DF_VERSION,descriptorBlockSize:rn.KHR_DF_BLOCKSIZE,colorModel:rn.KTX2DataFormatModel.UNSPECIFIED,colorPrimaries:rn.KTX2DataFormatPrimaries.SRGB,transferFunction:rn.KTX2DataFormatPrimaries.SRGB,flags:rn.KTX2DataFormatFlags.ALPHA_STRAIGHT,texelBlockDimension:{x:4,y:4,z:1,w:1},bytesPlane:[],samples:[]}],this.keyValue={},this.globalData=null;};})),on=e.createCommonjsModule((function(e,t){t.__esModule=!0,t.BufferReader=void 0;var i=function(){function e(e,t,i,s){this._dataView=new DataView(e.buffer,e.byteOffset+t,i),this._littleEndian=s,this._offset=0;}return e.prototype._nextUint8=function(){var e=this._dataView.getUint8(this._offset);return this._offset+=1,e},e.prototype._nextUint16=function(){var e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e},e.prototype._nextUint32=function(){var e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e},e.prototype._nextUint64=function(){var e=this._dataView.getUint32(this._offset,this._littleEndian),t=this._dataView.getUint32(this._offset+4,this._littleEndian),i=e+Math.pow(2,32)*t;return this._offset+=8,i},e.prototype._skip=function(e){return this._offset+=e,this},e.prototype._scan=function(e,t){void 0===t&&(t=0);for(var i=this._offset,s=0;this._dataView.getUint8(this._offset)!==t&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,s)},e}();t.BufferReader=i;})),an=e.createCommonjsModule((function(e,t){t.__esModule=!0,t.concat=t.decodeText=t.encodeText=void 0,t.encodeText=function(e){return "undefined"!=typeof TextEncoder?(new TextEncoder).encode(e):Buffer.from(e)},t.decodeText=function(e){return "undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):Buffer.from(e).toString("utf8")},t.concat=function(e){for(var t=0,i=0,s=e;i<s.length;i++)t+=(l=s[i]).byteLength;for(var r=new Uint8Array(t),n=0,o=0,a=e;o<a.length;o++){var l=a[o];r.set(new Uint8Array(l),n),n+=l.byteLength;}return r};})),ln=e.createCommonjsModule((function(e,t){t.__esModule=!0,t.read=void 0,t.read=function(e){var t=new Uint8Array(e.buffer.slice(e.byteOffset,e.byteOffset+rn.KTX2_ID.length));if(t[0]!==rn.KTX2_ID[0]||t[1]!==rn.KTX2_ID[1]||t[2]!==rn.KTX2_ID[2]||t[3]!==rn.KTX2_ID[3]||t[4]!==rn.KTX2_ID[4]||t[5]!==rn.KTX2_ID[5]||t[6]!==rn.KTX2_ID[6]||t[7]!==rn.KTX2_ID[7]||t[8]!==rn.KTX2_ID[8]||t[9]!==rn.KTX2_ID[9]||t[10]!==rn.KTX2_ID[10]||t[11]!==rn.KTX2_ID[11])throw new Error("Missing KTX 2.0 identifier.");var i=new nn.KTX2Container,s=17*Uint32Array.BYTES_PER_ELEMENT,r=new on.BufferReader(e,rn.KTX2_ID.length,s,!0);i.vkFormat=r._nextUint32(),i.typeSize=r._nextUint32(),i.pixelWidth=r._nextUint32(),i.pixelHeight=r._nextUint32(),i.pixelDepth=r._nextUint32(),i.layerCount=r._nextUint32(),i.faceCount=r._nextUint32();var n=r._nextUint32();i.supercompressionScheme=r._nextUint32();for(var o=r._nextUint32(),a=r._nextUint32(),l=r._nextUint32(),h=r._nextUint32(),_=r._nextUint64(),c=r._nextUint64(),d=new on.BufferReader(e,rn.KTX2_ID.length+s,3*n*8,!0),u=0;u<n;u++)i.levels.push({levelData:new Uint8Array(e.buffer.slice(e.byteOffset+d._nextUint64(),e.byteOffset+d._nextUint64()+d._nextUint64())),uncompressedByteLength:d._nextUint64()});var m=new on.BufferReader(e,o,a,!0),p={vendorId:m._skip(4)._nextUint16(),descriptorType:m._nextUint16(),versionNumber:m._nextUint16(),descriptorBlockSize:m._nextUint16(),colorModel:m._nextUint8(),colorPrimaries:m._nextUint8(),transferFunction:m._nextUint8(),flags:m._nextUint8(),texelBlockDimension:{x:m._nextUint8()+1,y:m._nextUint8()+1,z:m._nextUint8()+1,w:m._nextUint8()+1},bytesPlane:[m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8()],samples:[]},f=(p.descriptorBlockSize/4-6)/4;for(u=0;u<f;u++)p.samples[u]={bitOffset:m._nextUint16(),bitLength:m._nextUint8(),channelID:m._nextUint8(),samplePosition:[m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8()],sampleLower:m._nextUint32(),sampleUpper:m._nextUint32()};i.dataFormatDescriptor.length=0,i.dataFormatDescriptor.push(p);for(var g=new on.BufferReader(e,l,h,!0);g._offset<h;){var y=g._nextUint32(),T=g._scan(y),C=an.decodeText(T),x=g._scan(y-T.byteLength);i.keyValue[C]=C.match(/^ktx/i)?an.decodeText(x):x,y%4&&g._skip(4-y%4);}if(c<=0)return i;var b=new on.BufferReader(e,_,c,!0),v=b._nextUint16(),w=b._nextUint16(),S=b._nextUint32(),A=b._nextUint32(),E=b._nextUint32(),M=b._nextUint32(),P=[];for(u=0;u<n;u++)P.push({imageFlags:b._nextUint32(),rgbSliceByteOffset:b._nextUint32(),rgbSliceByteLength:b._nextUint32(),alphaSliceByteOffset:b._nextUint32(),alphaSliceByteLength:b._nextUint32()});var R=_+b._offset,B=R+S,I=B+A,D=I+E,O=new Uint8Array(e.buffer.slice(e.byteOffset+R,e.byteOffset+R+S)),L=new Uint8Array(e.buffer.slice(e.byteOffset+B,e.byteOffset+B+A)),V=new Uint8Array(e.buffer.slice(e.byteOffset+I,e.byteOffset+I+E)),N=new Uint8Array(e.buffer.slice(e.byteOffset+D,e.byteOffset+D+M));return i.globalData={endpointCount:v,selectorCount:w,imageDescs:P,endpointsData:O,selectorsData:L,tablesData:V,extendedData:N},i};})),hn=e.createCommonjsModule((function(e,t){var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},i.apply(this,arguments)},s=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var s=Array(e),r=0;for(t=0;t<i;t++)for(var n=arguments[t],o=0,a=n.length;o<a;o++,r++)s[r]=n[o];return s};t.__esModule=!0,t.write=void 0;var r={keepWriter:!1};t.write=function(e,t){void 0===t&&(t={}),t=i(i({},r),t);var n=new ArrayBuffer(0);if(e.globalData){var o=new ArrayBuffer(20+5*e.globalData.imageDescs.length*4),a=new DataView(o);a.setUint16(0,e.globalData.endpointCount,!0),a.setUint16(2,e.globalData.selectorCount,!0),a.setUint32(4,e.globalData.endpointsData.byteLength,!0),a.setUint32(8,e.globalData.selectorsData.byteLength,!0),a.setUint32(12,e.globalData.tablesData.byteLength,!0),a.setUint32(16,e.globalData.extendedData.byteLength,!0);for(var l=0;l<e.globalData.imageDescs.length;l++){var h=e.globalData.imageDescs[l];a.setUint32(20+5*l*4+0,h.imageFlags,!0),a.setUint32(20+5*l*4+4,h.rgbSliceByteOffset,!0),a.setUint32(20+5*l*4+8,h.rgbSliceByteLength,!0),a.setUint32(20+5*l*4+12,h.alphaSliceByteOffset,!0),a.setUint32(20+5*l*4+16,h.alphaSliceByteLength,!0);}n=an.concat([o,e.globalData.endpointsData,e.globalData.selectorsData,e.globalData.tablesData,e.globalData.extendedData]);}var _=[],c=e.keyValue;for(var d in t.keepWriter||(c=i(i({},e.keyValue),{KTXwriter:rn.KTX_WRITER})),c){var u=c[d],m=an.encodeText(d),p="string"==typeof u?an.encodeText(u):u,f=m.byteLength+1+p.byteLength+1,g=f%4?4-f%4:0;_.push(an.concat([new Uint32Array([f]),m,rn.NUL,p,rn.NUL,new Uint8Array(g).fill(0)]));}var y=an.concat(_),T=new ArrayBuffer(44),C=new DataView(T);if(1!==e.dataFormatDescriptor.length||e.dataFormatDescriptor[0].descriptorType!==rn.KTX2DataFormatType.BASICFORMAT)throw new Error("Only BASICFORMAT Data Format Descriptor output supported.");var x=e.dataFormatDescriptor[0];for(C.setUint32(0,44,!0),C.setUint16(4,x.vendorId,!0),C.setUint16(6,x.descriptorType,!0),C.setUint16(8,x.versionNumber,!0),C.setUint16(10,x.descriptorBlockSize,!0),C.setUint8(12,x.colorModel),C.setUint8(13,x.colorPrimaries),C.setUint8(14,x.transferFunction),C.setUint8(15,x.flags),C.setUint8(16,x.texelBlockDimension.x-1),C.setUint8(17,x.texelBlockDimension.y-1),C.setUint8(18,x.texelBlockDimension.z-1),C.setUint8(19,x.texelBlockDimension.w-1),l=0;l<8;l++)C.setUint8(20+l,x.bytesPlane[l]);for(l=0;l<x.samples.length;l++){var b=x.samples[l],v=28+16*l;C.setUint16(v+0,b.bitOffset,!0),C.setUint8(v+2,b.bitLength),C.setUint8(v+3,b.channelID),C.setUint8(v+4,b.samplePosition[0]),C.setUint8(v+5,b.samplePosition[1]),C.setUint8(v+6,b.samplePosition[2]),C.setUint8(v+7,b.samplePosition[3]),C.setUint32(v+8,b.sampleLower,!0),C.setUint32(v+12,b.sampleUpper,!0);}var w=rn.KTX2_ID.length+rn.HEADER_BYTE_LENGTH+3*e.levels.length*8,S=w+T.byteLength,A=S+y.byteLength;A%8&&(A+=8-A%8);var E=[],M=new DataView(new ArrayBuffer(3*e.levels.length*8)),P=A+n.byteLength;for(l=0;l<e.levels.length;l++){var R=e.levels[l];E.push(R.levelData),M.setBigUint64(24*l+0,BigInt(P),!0),M.setBigUint64(24*l+8,BigInt(R.levelData.byteLength),!0),M.setBigUint64(24*l+16,BigInt(R.uncompressedByteLength),!0),P+=R.levelData.byteLength;}var B=new ArrayBuffer(rn.HEADER_BYTE_LENGTH),I=new DataView(B);return I.setUint32(0,e.vkFormat,!0),I.setUint32(4,e.typeSize,!0),I.setUint32(8,e.pixelWidth,!0),I.setUint32(12,e.pixelHeight,!0),I.setUint32(16,e.pixelDepth,!0),I.setUint32(20,e.layerCount,!0),I.setUint32(24,e.faceCount,!0),I.setUint32(28,e.levels.length,!0),I.setUint32(32,e.supercompressionScheme,!0),I.setUint32(36,w,!0),I.setUint32(40,T.byteLength,!0),I.setUint32(44,S,!0),I.setUint32(48,y.byteLength,!0),I.setBigUint64(52,BigInt(A),!0),I.setBigUint64(60,BigInt(n.byteLength),!0),new Uint8Array(an.concat(s([new Uint8Array(rn.KTX2_ID).buffer,B,M.buffer,T,y,new ArrayBuffer(A-(S+y.byteLength)),n],E)))};})),_n=e.createCommonjsModule((function(e,t){var i=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[i]}});}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i];}),s=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||t.hasOwnProperty(s)||i(t,e,s);};t.__esModule=!0,s(nn,t),s(ln,t),s(hn,t);})),cn=e.getDefaultExportFromCjs(_n);function dn(e,t){const i=new Array(t.mipMapLevels);let s=t.width,r=t.height,n=0;for(let o=0;o<t.mipMapLevels;++o){const a=mn(t,s,r,e,o),l=un(e,o,n,a);i[o]={compressed:!0,format:t.internalFormat,data:l,width:s,height:r,levelSize:a},s=Math.max(1,s>>1),r=Math.max(1,r>>1),n+=a;}return i}function un(e,t,i,s){return Array.isArray(e)?e[t].levelData:new Uint8Array(e.buffer.slice(e.byteOffset+i,e.byteOffset+i+s))}function mn(e,t,i,s,r){return Array.isArray(s)?e.sizeFunction(s[r]):e.sizeFunction(t,i)}const pn={131:$r.COMPRESSED_RGB_S3TC_DXT1_EXT,132:$r.COMPRESSED_SRGB_S3TC_DXT1_EXT,133:$r.COMPRESSED_RGBA_S3TC_DXT1_EXT,134:$r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,135:$r.COMPRESSED_RGBA_S3TC_DXT3_EXT,136:$r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,137:$r.COMPRESSED_RGBA_S3TC_DXT5_EXT,138:$r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,139:$r.COMPRESSED_RED_RGTC1_EXT,140:$r.COMPRESSED_SIGNED_RED_RGTC1_EXT,141:$r.COMPRESSED_RED_GREEN_RGTC2_EXT,142:$r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT,147:$r.COMPRESSED_RGB8_ETC2,148:$r.COMPRESSED_SRGB8_ETC2,149:$r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,150:$r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,151:$r.COMPRESSED_RGBA8_ETC2_EAC,152:$r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC,153:$r.COMPRESSED_R11_EAC,154:$r.COMPRESSED_SIGNED_R11_EAC,155:$r.COMPRESSED_RG11_EAC,156:$r.COMPRESSED_SIGNED_RG11_EAC,157:$r.COMPRESSED_RGBA_ASTC_4x4_KHR,158:$r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR,159:$r.COMPRESSED_RGBA_ASTC_5x4_KHR,160:$r.COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR,161:$r.COMPRESSED_RGBA_ASTC_5x5_KHR,162:$r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR,163:$r.COMPRESSED_RGBA_ASTC_6x5_KHR,164:$r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR,165:$r.COMPRESSED_RGBA_ASTC_6x6_KHR,166:$r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR,167:$r.COMPRESSED_RGBA_ASTC_8x5_KHR,168:$r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR,169:$r.COMPRESSED_RGBA_ASTC_8x6_KHR,170:$r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR,171:$r.COMPRESSED_RGBA_ASTC_8x8_KHR,172:$r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR,173:$r.COMPRESSED_RGBA_ASTC_10x5_KHR,174:$r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR,175:$r.COMPRESSED_RGBA_ASTC_10x6_KHR,176:$r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR,177:$r.COMPRESSED_RGBA_ASTC_10x8_KHR,178:$r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR,179:$r.COMPRESSED_RGBA_ASTC_10x10_KHR,180:$r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR,181:$r.COMPRESSED_RGBA_ASTC_12x10_KHR,182:$r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR,183:$r.COMPRESSED_RGBA_ASTC_12x12_KHR,184:$r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR,1000054e3:$r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,1000054001:$r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,1000066e3:$r.COMPRESSED_RGBA_ASTC_4x4_KHR,1000066001:$r.COMPRESSED_RGBA_ASTC_5x4_KHR,1000066002:$r.COMPRESSED_RGBA_ASTC_5x5_KHR,1000066003:$r.COMPRESSED_RGBA_ASTC_6x5_KHR,1000066004:$r.COMPRESSED_RGBA_ASTC_6x6_KHR,1000066005:$r.COMPRESSED_RGBA_ASTC_8x5_KHR,1000066006:$r.COMPRESSED_RGBA_ASTC_8x6_KHR,1000066007:$r.COMPRESSED_RGBA_ASTC_8x8_KHR,1000066008:$r.COMPRESSED_RGBA_ASTC_10x5_KHR,1000066009:$r.COMPRESSED_RGBA_ASTC_10x6_KHR,1000066010:$r.COMPRESSED_RGBA_ASTC_10x8_KHR,1000066011:$r.COMPRESSED_RGBA_ASTC_10x10_KHR,1000066012:$r.COMPRESSED_RGBA_ASTC_12x10_KHR,1000066013:$r.COMPRESSED_RGBA_ASTC_12x12_KHR},{read:fn}=cn,gn=[171,75,84,88,32,50,48,187,13,10,26,10];function yn(e){const t=new Uint8Array(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength));return !(t.byteLength<gn.length||t[0]!==gn[0]||t[1]!==gn[1]||t[2]!==gn[2]||t[3]!==gn[3]||t[4]!==gn[4]||t[5]!==gn[5]||t[6]!==gn[6]||t[7]!==gn[7]||t[8]!==gn[8]||t[9]!==gn[9]||t[10]!==gn[10]||t[11]!==gn[11])}const Tn={etc1:{basisFormat:0,compressed:!0,format:$r.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:$r.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:$r.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:$r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:$r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:$r.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};function Cn(e,t,i){const s=new e(new Uint8Array(t));try{if(!s.startTranscoding())throw new Error("Failed to start basis transcoding");const e=s.getNumImages(),t=[];for(let r=0;r<e;r++){const e=s.getNumLevels(r),n=[];for(let t=0;t<e;t++)n.push(xn(s,r,t,i));t.push(n);}return t}finally{s.close(),s.delete();}}function xn(e,t,i,s){const r=e.getImageWidth(t,i),n=e.getImageHeight(t,i),o=e.getHasAlpha(),{compressed:a,format:l,basisFormat:h}=wn(s,o),_=e.getImageTranscodedSizeInBytes(t,i,h),c=new Uint8Array(_);if(!e.transcodeImage(c,t,i,h,0,0))throw new Error("failed to start Basis transcoding");return {width:r,height:n,data:c,compressed:a,format:l,hasAlpha:o}}function bn(e,t,i){const s=new e(new Uint8Array(t));try{if(!s.startTranscoding())throw new Error("failed to start KTX2 transcoding");const e=s.getLevels(),t=[];for(let r=0;r<e;r++){t.push(vn(s,r,i));break}return [t]}finally{s.close(),s.delete();}}function vn(e,t,i){const{alphaFlag:s,height:r,width:n}=e.getImageLevelInfo(t,0,0),{compressed:o,format:a,basisFormat:l}=wn(i,s),h=e.getImageTranscodedSizeInBytes(t,0,0,l),_=new Uint8Array(h);if(!e.transcodeImage(_,t,0,0,l,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return {width:n,height:r,data:_,compressed:o,hasAlpha:s,format:a}}function wn(e,t){let i=e&&e.basis&&e.basis.format;return "auto"===i&&(i=An()),"object"==typeof i&&(i=t?i.alpha:i.noAlpha),i=i.toLowerCase(),Tn[i]}function Sn(e,t){let i=e&&e.basis&&e.basis.format;return "auto"===i&&(i=An()),"object"==typeof i&&(i=t?i.alpha:i.noAlpha),i=i.toLowerCase(),i}function An(){const e=function(e){if(!sn){e=e||function(){try{return document.createElement("canvas").getContext("webgl")}catch(e){return null}}(),sn=new Set;for(const t of en)for(const i in tn)e&&e.getExtension(`${t}${i}`)&&sn.add(tn[i]);}return sn}();return e.has("etc1")?"etc1":e.has("etc2")?"etc2":e.has("astc")?"astc-4x4":e.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:e.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:"rgb565"}const En={name:"Basis",id:"basis",module:"textures",version:jr,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}},parse:async function(e,t){if("auto"===t.basis.containerFormat){if(yn(e))return bn((await Qr(t)).KTX2File,e,t);const{BasisFile:i}=await Yr(t);return Cn(i,e,t)}if("encoder"===t.basis.module){const i=await Qr(t);return "ktx2"===t.basis.containerFormat?bn(i.KTX2File,e,t):Cn(i.BasisFile,e,t)}{const{BasisFile:i}=await Yr(t);return Cn(i,e,t)}}},Mn={MAGIC_NUMBER:542327876,HEADER_LENGTH:31,MAGIC_NUMBER_INDEX:0,HEADER_SIZE_INDEX:1,HEADER_FLAGS_INDEX:2,HEADER_HEIGHT_INDEX:3,HEADER_WIDTH_INDEX:4,MIPMAPCOUNT_INDEX:7,HEADER_PF_FLAGS_INDEX:20,HEADER_PF_FOURCC_INDEX:21,DDSD_MIPMAPCOUNT:131072,DDPF_FOURCC:4,PIXEL_FORMATS:{DXT1:$r.COMPRESSED_RGB_S3TC_DXT1_EXT,DXT3:$r.COMPRESSED_RGBA_S3TC_DXT3_EXT,DXT5:$r.COMPRESSED_RGBA_S3TC_DXT5_EXT,"ATC ":$r.COMPRESSED_RGB_ATC_WEBGL,ATCA:$r.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL,ATCI:$r.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL},SIZE_FUNCTIONS:{DXT1:Pn,DXT3:Rn,DXT5:Rn,"ATC ":Pn,ATCA:Rn,ATCI:Rn}};function Pn(e,t){return (e+3>>2)*(t+3>>2)*8}function Rn(e,t){return (e+3>>2)*(t+3>>2)*16}const Bn={0:[$r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG],1:[$r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG],2:[$r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG],3:[$r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG],6:[$r.COMPRESSED_RGB_ETC1_WEBGL],7:[$r.COMPRESSED_RGB_S3TC_DXT1_EXT],9:[$r.COMPRESSED_RGBA_S3TC_DXT3_EXT],11:[$r.COMPRESSED_RGBA_S3TC_DXT5_EXT],22:[$r.COMPRESSED_RGB8_ETC2],23:[$r.COMPRESSED_RGBA8_ETC2_EAC],24:[$r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2],25:[$r.COMPRESSED_R11_EAC],26:[$r.COMPRESSED_RG11_EAC],27:[$r.COMPRESSED_RGBA_ASTC_4X4_KHR,$r.COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR],28:[$r.COMPRESSED_RGBA_ASTC_5X4_KHR,$r.COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR],29:[$r.COMPRESSED_RGBA_ASTC_5X5_KHR,$r.COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR],30:[$r.COMPRESSED_RGBA_ASTC_6X5_KHR,$r.COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR],31:[$r.COMPRESSED_RGBA_ASTC_6X6_KHR,$r.COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR],32:[$r.COMPRESSED_RGBA_ASTC_8X5_KHR,$r.COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR],33:[$r.COMPRESSED_RGBA_ASTC_8X6_KHR,$r.COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR],34:[$r.COMPRESSED_RGBA_ASTC_8X8_KHR,$r.COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR],35:[$r.COMPRESSED_RGBA_ASTC_10X5_KHR,$r.COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR],36:[$r.COMPRESSED_RGBA_ASTC_10X6_KHR,$r.COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR],37:[$r.COMPRESSED_RGBA_ASTC_10X8_KHR,$r.COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR],38:[$r.COMPRESSED_RGBA_ASTC_10X10_KHR,$r.COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR],39:[$r.COMPRESSED_RGBA_ASTC_12X10_KHR,$r.COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR],40:[$r.COMPRESSED_RGBA_ASTC_12X12_KHR,$r.COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR]},In={0:Dn,1:Dn,2:On,3:On,6:Ln,7:Ln,9:Vn,11:Vn,22:Ln,23:Vn,24:Ln,25:Ln,26:Vn,27:Vn,28:function(e,t){return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16},29:function(e,t){return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16},30:function(e,t){return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16},31:function(e,t){return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16},32:function(e,t){return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16},33:function(e,t){return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16},34:function(e,t){return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16},35:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16},36:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16},37:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16},38:function(e,t){return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16},39:function(e,t){return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16},40:function(e,t){return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16}};function Dn(e,t){return (e=Math.max(e,16))*(t=Math.max(t,8))/4}function On(e,t){return (e=Math.max(e,8))*(t=Math.max(t,8))/2}function Ln(e,t){return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8}function Vn(e,t){return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16}const Nn={name:"Texture Containers",id:"compressed-texture",module:"textures",version:jr,worker:!0,extensions:["ktx","ktx2","dds","pvr"],mimeTypes:["application/octet-stream","image/vnd-ms.dds","image/ktx","image/ktx2"],binary:!0,options:{"compressed-texture":{libraryPath:"libs/"}},parse:async(e,t)=>function(e){if(yn(e))return function(e){const t=new Uint8Array(e),i=fn(t),s=Math.max(1,i.levels.length);return dn(i.levels,{mipMapLevels:s,width:i.pixelWidth,height:i.pixelHeight,sizeFunction:e=>e.uncompressedByteLength,internalFormat:pn[i.vkFormat]})}(e);if(function(e){return new Uint32Array(e,0,Mn.HEADER_LENGTH)[Mn.MAGIC_NUMBER_INDEX]===Mn.MAGIC_NUMBER}(e))return function(e){const t=new Int32Array(e,0,Mn.HEADER_LENGTH),i=t[Mn.HEADER_PF_FOURCC_INDEX];jt(Boolean(t[Mn.HEADER_PF_FLAGS_INDEX]&Mn.DDPF_FOURCC),"DDS: Unsupported format, must contain a FourCC code");const s=(r=i,String.fromCharCode(255&r,r>>8&255,r>>16&255,r>>24&255));var r;const n=Mn.PIXEL_FORMATS[s],o=Mn.SIZE_FUNCTIONS[s];jt(n&&o,`DDS: Unknown pixel format ${i}`);let a=1;t[Mn.HEADER_FLAGS_INDEX]&Mn.DDSD_MIPMAPCOUNT&&(a=Math.max(1,t[Mn.MIPMAPCOUNT_INDEX]));const l=t[Mn.HEADER_WIDTH_INDEX],h=t[Mn.HEADER_HEIGHT_INDEX];return dn(new Uint8Array(e.slice(t[Mn.HEADER_SIZE_INDEX]+4)),{mipMapLevels:a,width:l,height:h,sizeFunction:o,internalFormat:n})}(e);if(function(e){const t=new Uint32Array(e,0,13)[0];return 55727696===t||1347834371===t}(e))return function(e){const t=new Uint32Array(e,0,13),i=t[2],s=Bn[i]||[],r=s.length>1&&t[4]?s[1]:s[0],n=In[i],o=t[11],a=t[7],l=t[6];return dn(new Uint8Array(e.slice(52+t[12])),{mipMapLevels:o,width:a,height:l,sizeFunction:n,internalFormat:r})}(e);throw new Error("Texture container format not recognized")}(e)};!function(){const e=new Uint32Array([305419896]);new Uint8Array(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength));}(),new Uint8Array([147,78,85,77,80,89]);const Fn={id:"crunch",name:"Crunch",module:"textures",version:jr,worker:!0,extensions:["crn"],mimeTypes:["image/crn","image/x-crn","application/octet-stream"],binary:!0,options:{crunch:{libraryPath:"libs/"}}};let Gn;const kn={};kn[0]={pixelFormat:$r.COMPRESSED_RGB_S3TC_DXT1_EXT,sizeFunction:Pn},kn[1]={pixelFormat:$r.COMPRESSED_RGBA_S3TC_DXT3_EXT,sizeFunction:Rn},kn[2]={pixelFormat:$r.COMPRESSED_RGBA_S3TC_DXT5_EXT,sizeFunction:Rn};let Un=0,Hn=null;const zn={...Fn,parse:async function(e,t={}){const i=await async function(e){const t=e.modules||{};return t.crunch?t.crunch:async function(e){if(Gn)return Gn;let t=null;return [t]=await Promise.all([await xi("crunch.js","textures",e)]),t=t||globalThis.LoadCrunchDecoder,Gn=t(),Gn}(e)}(t),s=e.byteLength,r=new Uint8Array(e),n=i._malloc(s);!function(e,t,i,s){let r;const n=i/4,o=s%4,a=new Uint32Array(e.buffer.slice(0,(s-o)/4)),l=new Uint32Array(t.buffer);for(r=0;r<a.length;r++)l[n+r]=a[r];for(r=s-o;r<s;r++)t[i+r]=e[r];}(r,i.HEAPU8,n,s);const o=i._crn_get_dxt_format(n,s);jt(Boolean(kn[o]),"Unsupported format");const a=i._crn_get_levels(n,s),l=i._crn_get_width(n,s),h=i._crn_get_height(n,s),_=kn[o].sizeFunction;let c=0;for(let e=0;e<a;++e)c+=_(l>>e,h>>e);return Un<c&&(Hn&&i._free(Hn),Hn=i._malloc(c),Un=c),i._crn_decompress(n,s,Hn,c,0,a),i._free(n),dn(new Uint8Array(i.HEAPU8.buffer.slice(Hn,Hn+c)),{mipMapLevels:a,width:l,height:h,sizeFunction:_,internalFormat:kn[o].pixelFormat})}};var Wn;function jn(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;const i=t&&t.modelFolder?t.modelFolder:t.baseUri||t.uri;if(!i)throw new Error(`'baseUri' must be provided to resolve relative url ${e}`);return t&&t.modelFolder?"/"===t.modelFolder.slice(-1)?t.modelFolder+e:`${t.modelFolder}/${e}`:i.substr(0,i.lastIndexOf("/")+1)+e}Wn=zn,"undefined"!=typeof self&&(yi.onmessage=async(e,t)=>{if("process"===e)try{const{input:e,options:i={}}=t,s=await async function({loader:e,arrayBuffer:t,options:i,context:s}){let r,n;if(e.parseSync||e.parse)r=t,n=e.parseSync||e.parse;else {if(!e.parseTextSync)throw new Error(`Could not load data with ${e.name} loader`);r=(new TextDecoder).decode(t),n=e.parseTextSync;}return i={...i,modules:e&&e.options&&e.options.modules||{},worker:!1},await n(r,{...i},s,e)}({loader:Wn,arrayBuffer:e,byteOffset:0,byteLength:0,options:i,context:{parse:vi}});yi.postMessage("done",{result:s});}catch(e){yi.postMessage("error",{error:e.message});}});const Xn=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),qn=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Kn={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Jn={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};let Zn;const Yn="EXT_meshopt_compression";async function Qn(e,t){const i=e.getObjectExtension(t,Yn);if(i){const{byteOffset:s=0,byteLength:r=0,byteStride:n,count:o,mode:a,filter:l="NONE",buffer:h}=i,_=e.gltf.buffers[h],c=new Uint8Array(_.arrayBuffer,_.byteOffset+s,r),d=new Uint8Array(e.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);await async function(e,t,i,s,r,n="NONE"){const o=await async function(){return Zn||(Zn=async function(){let e="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB";WebAssembly.validate(Xn)&&(e="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(function(e){const t=new Uint8Array(e.length);for(let i=0;i<e.length;++i){const s=e.charCodeAt(i);t[i]=s>96?s-71:s>64?s-65:s>47?s+4:s>46?63:62;}let i=0;for(let s=0;s<e.length;++s)t[i++]=t[s]<60?qn[t[s]]:64*(t[s]-60)+t[++s];return t.buffer.slice(0,i)}(e),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}()),Zn}();!function(e,t,i,s,r,n,o){const a=e.exports.sbrk,l=s+3&-4,h=a(l*r),_=a(n.length),c=new Uint8Array(e.exports.memory.buffer);c.set(n,_);const d=t(h,s,r,_,n.length);if(0===d&&o&&o(h,l,r),i.set(c.subarray(h,h+s*r)),a(h-a(0)),0!==d)throw new Error(`Malformed buffer data: ${d}`)}(o,o.exports[Jn[r]],e,t,i,s,o.exports[Kn[n||"NONE"]]);}(d,o,n,c,a,l),e.removeObjectExtension(t,Yn);}}var $n=Object.freeze({__proto__:null,name:Yn,decode:async function(e,t){const i=new xr(e);if(!t?.gltf?.decompressMeshes||!t.gltf?.loadBuffers)return;const s=[];for(const t of e.json.bufferViews||[])s.push(Qn(i,t));await Promise.all(s),i.removeExtension(Yn);}});const eo="EXT_texture_webp";var to=Object.freeze({__proto__:null,name:eo,preprocess:function(e,t){const i=new xr(e);if(!function(e){if(void 0===ir[e]){const t=Vs?function(e){switch(e){case"image/avif":case"image/webp":return function(e){try{return 0===document.createElement("canvas").toDataURL(e).indexOf(`data:${e}`)}catch{return !1}}(e);default:return !0}}(e):function(e){const t=globalThis.loaders?.imageFormatsNode||["image/png","image/jpeg","image/gif"],i=globalThis.loaders?.parseImageNode;return Boolean(i)&&t.includes(e)}(e);ir[e]=t;}return ir[e]}("image/webp")){if(i.getRequiredExtensions().includes(eo))throw new Error(`gltf: Required extension ${eo} not supported by browser`);return}const{json:s}=i;for(const e of s.textures||[]){const t=i.getObjectExtension(e,eo);t&&(e.source=t.source),i.removeObjectExtension(e,eo);}i.removeExtension(eo);}});const io="KHR_texture_basisu";var so=Object.freeze({__proto__:null,name:io,preprocess:function(e,t){const i=new xr(e),{json:s}=i;for(const e of s.textures||[]){const t=i.getObjectExtension(e,io);t&&(e.source=t.source),i.removeObjectExtension(e,io);}i.removeExtension(io);}});const ro="undefined"!=typeof __VERSION__?__VERSION__:"latest",no="1.4.1",oo=`/draco/versioned/decoders/${no}/draco_decoder.js`,ao=`/draco/versioned/decoders/${no}/draco_wasm_wrapper.js`,lo=`/draco/versioned/decoders/${no}/draco_decoder.wasm`;let ho;const _o={POSITION:"POSITION",JOINTS_0:"JOINTS_0",WEIGHTS_0:"WEIGHTS_0",NORMAL:"NORMAL",COLOR:"COLOR",TEX_COORD:"TEXCOORD"},co={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array};class uo{constructor(e){this.draco=e,this.drawMode="TRIANGLE",this.metadataQuerier={};}destroy(){}parseSync(e,t={}){this.metadataQuerier=new this.draco.MetadataQuerier;const i=new this.draco.DecoderBuffer;i.Init(new Int8Array(e),e.byteLength);const s=new this.draco.Decoder,r={};let n,o,a;try{const e=s.GetEncodedGeometryType(i);switch(e){case this.draco.TRIANGULAR_MESH:o=new this.draco.Mesh,n=s.DecodeBufferToMesh(i,o),a={type:0,faceCount:o.num_faces(),attributeCount:o.num_attributes(),vertexCount:o.num_points()};break;case this.draco.POINT_CLOUD:o=new this.draco.PointCloud,n=s.DecodeBufferToPointCloud(i,o),a={type:1,attributeCount:o.num_attributes(),vertexCount:o.num_points()};break;default:throw new Error("Unknown DRACO geometry type.")}if(!n.ok()||!o.ptr){const e=`DRACO decompression failed: ${n.error_msg()}`;throw o&&this.draco.destroy(o),new Error(e)}r.loaderData={header:a},this._extractDRACOGeometry(s,o,e,r,t);const l=this._getGeometryMetadata(s,o);r.header={vertexCount:a.vertexCount,boundingBox:Ui(r.attributes),metadata:l};}finally{this.draco.destroy(s),this.draco.destroy(i),this.draco.destroy(o),this.draco.destroy(this.metadataQuerier);}return r}_extractDRACOGeometry(e,t,i,s,r){const n=this._getAttributes(e,t,r);if(!n.POSITION)throw new Error("DRACO decompressor: No position attribute found.");return i===this.draco.TRIANGULAR_MESH?(n.indices="TRIANGLE_STRIP"===this.drawMode?this._getMeshStripIndices(e,t):this._getMeshFaceIndices(e,t),s.mode="TRIANGLE_STRIP"===this.drawMode?5:4):s.mode=0,n.indices&&(s.indices={value:n.indices,size:1},delete n.indices),s.attributes=n,s}getPositionAttributeMetadata(e){this.metadata=this.metadata||{},this.metadata.attributes=this.metadata.attributes||{};const t=new this.draco.AttributeQuantizationTransform;if(t.InitFromAttribute(e)){this.metadata.attributes.position.isQuantized=!0,this.metadata.attributes.position.maxRange=t.range(),this.metadata.attributes.position.numQuantizationBits=t.quantization_bits(),this.metadata.attributes.position.minValues=new Float32Array(3);for(let e=0;e<3;++e)this.metadata.attributes.position.minValues[e]=t.min_value(e);}this.draco.destroy(t);}_getAttributes(e,t,i){const s={},r=t.num_points();let n=0,o=0;for(let a=0;a<t.num_attributes();a++){const l=e.GetAttribute(t,a),h=this._getAttributeMetadata(e,t,a),_={uniqueId:l.unique_id(),attributeType:l.attribute_type(),dataType:co[l.data_type()],size:l.size(),numComponents:l.num_components(),byteOffset:l.byte_offset(),byteStride:l.byte_stride(),normalized:l.normalized(),metadata:h};let c=this._deduceAttributeName(_,i);const{typedArray:d}=this._getAttributeTypedArray(e,t,l,c);"COLOR"===c?(c=`${c}_${n}`,n++):"TEXCOORD"===c&&(c=`${c}_${o}`,o++),s[c]={value:d,size:d.length/r,metadata:h};}return s}_getMeshFaceIndices(e,t){const i=3*t.num_faces(),s=4*i,r=this.draco._malloc(s);e.GetTrianglesUInt32Array(t,s,r);const n=new Uint32Array(this.draco.HEAPF32.buffer.slice(r,r+i));return this.draco._free(r),n}_getMeshStripIndices(e,t){const i=new this.draco.DracoInt32Array;e.GetTriangleStripsFromMesh(t,i);const s=new Uint32Array(i.size());for(let e=0;e<i.size();++e)s[e]=i.GetValue(e);return this.draco.destroy(i),s}_getAttributeTypedArray(e,t,i,s){if(0===i.ptr)throw new Error(`DRACO decode bad attribute ${s}`);const r=co[i.data_type()],n=i.num_components(),o=t.num_points()*n,a=o*r.BYTES_PER_ELEMENT,l=this._getDracoDataType(r),h=this.draco._malloc(a);e.GetAttributeDataArrayForAllPoints(t,i,l,a,h);const _=new r(this.draco.HEAPF32.buffer,h,o).slice();return this.draco._free(h),{typedArray:_,components:n}}_getDracoDataType(e){switch(e){case Float32Array:return this.draco.DT_FLOAT32;case Int8Array:return this.draco.DT_INT8;case Int16Array:return this.draco.DT_INT16;case Int32Array:return this.draco.DT_INT32;case Uint8Array:return this.draco.DT_UINT8;case Uint16Array:return this.draco.DT_UINT16;case Uint32Array:return this.draco.DT_UINT32;default:return this.draco.DT_INVALID}}_deduceAttributeName(e,t){const{extraAttributes:i={}}=t;if(i&&"object"==typeof i)for(const[t,s]of Object.entries(i))if(s===e.uniqueId)return t;for(const t in _o)if(e.attributeType===this.draco[t])return _o[t];if(e.metadata){const i=t.attributeNameEntry||"name";if(e.metadata[i])return e.metadata[i].string}return `CUSTOM_ATTRIBUTE_${e.uniqueId}`}_getGeometryMetadata(e,t){const i=e.GetMetadata(t);return this._queryDracoMetadata(i)}_getAttributeMetadata(e,t,i){const s=e.GetAttributeMetadata(t,i);return this._queryDracoMetadata(s)}_queryDracoMetadata(e){if(!e||!e.ptr)return {};const t={},i=this.metadataQuerier.NumEntries(e),s=new this.draco.DracoInt32Array;for(let r=0;r<i;r++){const i=this.metadataQuerier.GetEntryName(e,r);this.metadataQuerier.GetIntEntryArray(e,i,s);const n=s.size(),o=new Int32Array(n);for(let e=0;e<n;e++)o[e]=s.GetValue(e);t[i]={int:this.metadataQuerier.GetIntEntry(e,i),string:this.metadataQuerier.GetStringEntry(e,i),double:this.metadataQuerier.GetDoubleEntry(e,i),intArray:o};}return this.draco.destroy(s),t}decode(e,t){return this.parseSync(e,t)}}const mo={name:"Draco",id:"draco",module:"draco",version:ro,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:"object"==typeof WebAssembly?"wasm":"js",libraryPath:"libs/",extraAttributes:{}}},parse:async function(e,t,i,s){const{draco:r}=await async function(e){const t=e.modules||{};return ho=t.draco3d?ho||t.draco3d.createDecoderModule({}).then((e=>({draco:e}))):ho||async function(e){let t,i;"js"===(e.draco&&e.draco.decoderType)?t=await xi(`${oo}`,"draco",e):[t,i]=await Promise.all([await xi(`${ao}`,"draco",e),await xi(`${lo}`,"draco",e)]),t=t||globalThis.DracoDecoderModule;const s=await function(e,t){const i={};return t&&(i.wasmBinary=t),new Promise((t=>{e({...i,onModuleLoaded:e=>t({draco:e})});}))}(t,i);return s}(e),await ho}(t),n=new uo(r);try{return n.parseSync(e,{extraAttributes:t.draco&&t.draco.extraAttributes||null,...t.parseOptions||{}})}finally{n.destroy();}}};function po(e,t){const{buffer:i,size:s,count:r}=function(e,t){let i=e,s=1,r=0;return e&&e.value&&(i=e.value,s=e.size||1),i&&(ArrayBuffer.isView(i)||(i=function(e,t,i=!1){return e?Array.isArray(e)?new t(e):!i||e instanceof t?e:new t(e):null}(i,Float32Array)),r=i.length/s),{buffer:i,size:s,count:r}}(e);return {value:i,size:s,bufferView:null,byteOffset:0,count:r,type:gr(s),componentType:yr(i)}}async function fo(e,t,i,s){const r=t.getObjectExtension(e,nr);let n=t.getTypedArrayDataForBufferViewInSimple(r.bufferView);const{_parse:o}=s,a={...i};delete a["3d-tiles"];const l=await o(n,mo,a,s);n=null,e.attributes=function(e){const t={};for(const i in e)if("indices"!==i){const s=po(e[i]);t[i]=s;}return t}(l.attributes),e.boundingBox={min:l.header.boundingBox[0],max:l.header.boundingBox[1]},l.indices&&(e.indices=po(l.indices)),function(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("Empty glTF primitive detected: Draco decompression failure?")}(e);}function go(e,t,i=4,s,r){if(!s.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const n=s.DracoWriter.encodeSync({attributes:e}),{parseSync:o}=r,a=o({attributes:e}),l=s._addFauxAttributes(a.attributes),h=s.addBufferView(n);return {primitives:[{attributes:l,mode:i,extensions:{[nr]:{bufferView:h,attributes:l}}}]}}var yo=Object.freeze({__proto__:null,decode:async function(e,t,i){if(!t.gltf.decompressMeshes)return;const s=new xr(e),r=[];for(const e of function*(e){for(const t of e.json.meshes||[])for(const e of t.primitives)yield e;}(s))s.getObjectExtension(e,nr)&&r.push(fo(e,s,t,i));await Promise.all(r),s.removeExtension(nr);},encode:function(e,t={}){const i=new xr(e);for(const e of i.json.meshes||[])go(e),i.addRequiredExtension(nr);}});const To="KHR_texture_transform",Co=To,xo=new e.Vector3,bo=new e.Matrix3,vo=new e.Matrix3;function wo(e,t){const i=[],s=t.json.materials?.[e],r=s?.baseColorTexture;r&&So(t,e,r,i);const n=s?.emissiveTexture;n&&So(t,e,n,i);const o=s?.normalTexture;o&&So(t,e,o,i);const a=s?.occlusionTexture;a&&So(t,e,a,i);const l=s?.pbrMetallicRoughness?.metallicRoughnessTexture;l&&So(t,e,l,i);}function So(t,i,s,r){const n=function(t,i){const s=t.extensions?.[To];if(!s)return null;const{texCoord:r=0}=t,{texCoord:n=r}=s;if(-1===i.findIndex((([e,t])=>e===r&&t===n))){const o=function(t){const{offset:i=[0,0],rotation:s=0,scale:r=[1,1]}=t,n=(new e.Matrix3).set(1,0,0,0,1,0,i[0],i[1],1),o=bo.set(Math.cos(s),Math.sin(s),0,-Math.sin(s),Math.cos(s),0,0,0,1),a=vo.set(r[0],0,0,0,r[1],0,0,0,1);return n.multiplyRight(o).multiplyRight(a)}(s);return r!==n&&(t.texCoord=n),i.push([r,n]),{originalTexCoord:r,texCoord:n,matrix:o}}return null}(s,r);if(!n)return;const o=t.json.meshes||[];for(const e of o)for(const s of e.primitives){const e=s.material;Number.isFinite(e)&&i===e&&Ao(t,s,n);}}function Ao(e,t,i){const{originalTexCoord:s,texCoord:r,matrix:n}=i,o=t.attributes[`TEXCOORD_${s}`];if(Number.isFinite(o)){const i=e.json.accessors?.[o];if(i&&i.bufferView){const o=e.json.bufferViews?.[i.bufferView];if(o){const{arrayBuffer:a,byteOffset:l}=e.buffers[o.buffer],h=(l||0)+(i.byteOffset||0)+(o.byteOffset||0),{ArrayType:_,length:c}=Tr(i),d=hr[i.type],u=o.byteStride||_r[i.componentType]*d,m=new Float32Array(c);for(let e=0;e<i.count;e++){const t=new _(a,h+e*u,2);xo.set(t[0],t[1],1),xo.transformByMatrix3(n),m.set([xo[0],xo[1]],e*d);}s===r?function(e,t,i,s){e.componentType=5126,i.push({arrayBuffer:s.buffer,byteOffset:0}),t.buffer=i.length-1,t.byteOffset=0,delete t.byteStride;}(i,o,e.buffers,m):function(e,t,i,s,r){s.buffers.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength});const n=s.json.bufferViews;if(!n)return;n.push({buffer:s.buffers.length-1,byteLength:r.buffer.byteLength,byteOffset:0});const o=s.json.accessors;o&&(o.push({bufferView:n?.length-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),i.attributes[`TEXCOORD_${e}`]=o.length-1);}(r,i,t,e,m);}}}}var Eo=Object.freeze({__proto__:null,name:Co,decode:async function(e,t){if(!new xr(e).hasExtension(To)||!t.gltf?.loadBuffers)return;const i=e.json.materials||[];for(let t=0;t<i.length;t++)wo(t,e);}}),Mo=Object.freeze({__proto__:null,decode:function(e,t){const i=new xr(e),{json:s}=i,r=i.getExtension(or);r&&(i.json.lights=r.lights,i.removeExtension(or));for(const e of s.nodes||[]){const t=i.getObjectExtension(e,or);t&&(e.light=t.light),i.removeObjectExtension(e,or);}},encode:function(e,t){const i=new xr(e),{json:s}=i;if(s.lights){const e=i.addExtension(or);sr(!e.lights),e.lights=s.lights,delete s.lights;}if(i.json.lights){for(const e of i.json.lights)i.addObjectExtension(e.node,or,e);delete i.json.lights;}}});function Po(e,t){const i=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach((t=>{e.uniforms[t].value&&!(t in i)&&(i[t]=e.uniforms[t].value);})),Object.keys(i).forEach((e=>{"object"==typeof i[e]&&void 0!==i[e].index&&(i[e].texture=t.getTexture(i[e].index));})),i}const Ro=[zr,Or,$n,to,so,yo,Mo,Object.freeze({__proto__:null,decode:function(e,t){const i=new xr(e),{json:s}=i;i.removeExtension(ar);for(const e of s.materials||[])e.extensions&&e.extensions.KHR_materials_unlit&&(e.unlit=!0),i.removeObjectExtension(e,ar);},encode:function(e,t){const i=new xr(e),{json:s}=i;if(i.materials)for(const e of s.materials)e.unlit&&(delete e.unlit,i.addObjectExtension(e,ar,{}),i.addExtension(ar));}}),Object.freeze({__proto__:null,decode:function(e,t){const i=new xr(e),{json:s}=i,r=i.getExtension(lr);if(r){const e=function({programs:e=[],shaders:t=[],techniques:i=[]},s){const r=new TextDecoder;return t.forEach((e=>{if(!Number.isFinite(e.bufferView))throw new Error("KHR_techniques_webgl: no shader code");e.code=r.decode(s.getTypedArrayForBufferView(e.bufferView));})),e.forEach((e=>{e.fragmentShader=t[e.fragmentShader],e.vertexShader=t[e.vertexShader];})),i.forEach((t=>{t.program=e[t.program];})),i}(r,i);for(const t of s.materials||[]){const s=i.getObjectExtension(t,lr);s&&(t.technique=Object.assign({},s,e[s.technique]),t.technique.values=Po(t.technique,i)),i.removeObjectExtension(t,lr);}i.removeExtension(lr);}},encode:function(e,t){}}),Eo];function Bo(e,t){const i=t?.gltf?.excludeExtensions||{};return !(e in i&&!i[e])}const Io={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},Do={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class Oo{constructor(e){this.idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};}normalize(e,t){this.json=e.json;const i=e.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case 1:case"1.0":break;default:return}if(!t.normalize)throw new Error("glTF v1 is not supported.");this._addAsset(i),this._convertTopLevelObjectsToArrays(i),function(e){const t=new xr(e),{json:i}=t;for(const e of i.images||[]){const i=t.getObjectExtension(e,rr);i&&Object.assign(e,i);}i.buffers&&i.buffers[0]&&delete i.buffers[0].uri,t.removeExtension(rr);}(e),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i),e.buffers=i.buffers,e.images=i.images;}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl";}_convertTopLevelObjectsToArrays(e){for(const t in Io)this._convertTopLevelObjectToArray(e,t);}_convertTopLevelObjectToArray(e,t){const i=e[t];if(i&&!Array.isArray(i)){e[t]=[];for(const s in i){const r=i[s];r.id=r.id||s;const n=e[t].length;e[t].push(r),this.idToIndexMap[t][s]=n;}}}_convertObjectIdsToArrayIndices(e){for(const t in Io)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t);}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"));}_convertMeshIds(e){for(const t of e.primitives){const{attributes:e,indices:i,material:s}=t;for(const t in e)e[t]=this._convertIdToIndex(e[t],"accessor");i&&(t.indices=this._convertIdToIndex(i,"accessor")),s&&(t.material=this._convertIdToIndex(s,"material"));}}_convertNodeIds(e){e.children&&(e.children=e.children.map((e=>this._convertIdToIndex(e,"node")))),e.meshes&&(e.meshes=e.meshes.map((e=>this._convertIdToIndex(e,"mesh"))));}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map((e=>this._convertIdToIndex(e,"node"))));}_convertIdsToIndices(e,t){e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(const i of e[t])for(const e in i){const t=this._convertIdToIndex(i[e],e);i[e]=t;}}_convertIdToIndex(e,t){const i=Do[t];if(i in this.idToIndexMap){const s=this.idToIndexMap[i][e];if(!Number.isFinite(s))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return s}return e}_updateObjects(e){for(const e of this.json.buffers)delete e.type;}_updateMaterial(e){for(const t of e.materials){t.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const i=t.values?.tex||t.values?.texture2d_0||t.values?.diffuseTex,s=e.textures.findIndex((e=>e.id===i));-1!==s&&(t.pbrMetallicRoughness.baseColorTexture={index:s});}}}var Lo=/\s/,Vo=/^\s+/,No=/^[-+]0x[0-9a-f]+$/i,Fo=/^0b[01]+$/i,Go=/^0o[0-7]+$/i,ko=parseInt;function Uo(t){if("number"==typeof t)return t;if(function(t){return "symbol"==typeof t||e.isObjectLike(t)&&"[object Symbol]"==e.baseGetTag(t)}(t))return NaN;if(e.isObject(t)){var i="function"==typeof t.valueOf?t.valueOf():t;t=e.isObject(i)?i+"":i;}if("string"!=typeof t)return 0===t?t:+t;var s;t=(s=t)?s.slice(0,function(e){for(var t=e.length;t--&&Lo.test(e.charAt(t)););return t}(s)+1).replace(Vo,""):s;var r=Fo.test(t);return r||Go.test(t)?ko(t.slice(2),r?2:8):No.test(t)?NaN:+t}var Ho=function(){return e.root.Date.now()},zo=Math.max,Wo=Math.min;class jo extends e.Object3D{constructor(t,i){super(),this.shadowNear=10,this.shadowFar=1e3,this.textureSize=512,this.epsilon=.01,this.mapSizeScale=1,this.shadowRepaint=!0,this.id=e.uuid(),this.type="Light",this.color=e.Color.parse(t).toVector3(),this.intensity=i;}setOptions(t,i){"color"==t?this.color=e.Color.parse(i).toVector3():"intensity"==t?this.intensity=i:console.log(`光源不支持该属性的修改 ${t}`);}setShadowOptions(e){for(const t in e)switch(t){case"shadowFar":this.shadowFar=e[t];break;case"shadowNear":this.shadowNear=e[t];break;case"epsilon":this.epsilon=e[t];break;case"mapSizeScale":this.mapSizeScale=e[t];break;case"size":this.textureSize=e[t];}}}class Xo{constructor(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new e.Vector2(512,512),this.map=null,this.matrix=new e.Matrix4,this._projScreenMatrix=new e.Matrix4,this._frustum=new n,this._frameExtents=new e.Vector2(1,1),this._viewportCount=1,this._viewports=[new e.Vector4(0,0,1,1)],this._enabled=!0;}get enabled(){return this._enabled}set enabled(e){this._enabled=e;}getFrustum(){return this._frustum}getViewportCount(){return this._viewportCount}updateMatrices(e){let t=this._projScreenMatrix;const i=this.camera,s=this.matrix,r=this._lookTarget,n=this._lightPositionWorld;n.setFromMatrixPosition(e.matrixWorld),i.position.copy(n),r.setFromMatrixPosition(e.target.matrixWorld),i.lookAt(r),i.updateMatrixWorld(),t=i.projectionMatrix.clone().multiplyRight(i.matrixWorldInverse),this._frustum.setFromMatrix(t),s.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),s.multiplyRight(i.projectionMatrix),s.multiplyRight(i.matrixWorldInverse);}getViewport(e){return this._viewports[e]}}class qo extends Xo{constructor(){super(new h(10,1,.5,500)),this.isDirectionalLightShadow=!0;}updateMatrices(e){super.updateMatrices(e);}}class Ko extends jo{constructor(t,i){super(t,i),this.type="DirectionalLight",this.isDirectionalLight=!0,this.position.copy(e.DefaultUp),this.updateMatrix(),this.target=new e.Object3D,this.shadow=new qo,this._lightPosition=new e.Vector3(0,0,0),this._targetPosition=new e.Vector3(0,0,0),this.lightDirection=new e.Vector3(0,0,0);}setPosition(t,i=new e.Vector3(0,0,0)){this._lightPosition=t,this._targetPosition=i,t=e.Vector3.unpack(t),i=e.Vector3.unpack(i),this.lightDirection=e.Vector3.normalize(e.Vector3.subtract(t,i,new e.Vector3),new e.Vector3);}getLightDirection(){return this.lightDirection}serialize(){return {color:e.Vector3.pack(this.color,new Array(3)),intensity:this.intensity,lightPosition:this._lightPosition,targetPosition:this._targetPosition,type:this.type}}}const Jo=Math.PI/180,Zo=23.4397*Jo;function Yo(e,t,i){const s=Jo*-i,r=Jo*t,n=function(e){return function(e){return e/864e5-.5+2440588}(e)-2451545}(e),o=function(e){const t=function(e){const t=e;return t+Jo*(1.9148*Math.sin(t)+.02*Math.sin(2*t)+3e-4*Math.sin(3*t))+102.9372*Jo+Math.PI}(Jo*(357.5291+.98560028*e));return {declination:$o(t,0),rightAscension:Qo(t,0)}}(n),a=function(e,t){return Jo*(280.147+360.9856235*e)-t}(n,s)-o.rightAscension;return {azimuth:ea(a,r,o.declination),altitude:ta(a,r,o.declination)}}function Qo(e,t){const i=e;return Math.atan2(Math.sin(i)*Math.cos(Zo)-Math.tan(t)*Math.sin(Zo),Math.cos(i))}function $o(e,t){const i=e;return Math.asin(Math.sin(t)*Math.cos(Zo)+Math.cos(t)*Math.sin(Zo)*Math.sin(i))}function ea(e,t,i){const s=e,r=t,n=i;return Math.atan2(Math.sin(s),Math.cos(s)*Math.sin(r)-Math.tan(n)*Math.cos(r))}function ta(e,t,i){const s=e,r=t,n=i;return Math.asin(Math.sin(r)*Math.sin(n)+Math.cos(r)*Math.cos(n)*Math.cos(s))}function ia(e){if(1===e)return 0;if(2===e)return 31;if(3===e)return 59;if(4===e)return 90;if(5===e)return 120;if(6===e)return 151;if(7===e)return 181;if(8===e)return 212;if(9===e)return 243;if(10===e)return 273;if(11===e)return 304;if(12===e)return 334;throw new Error("Error transMonth2Day Not Int!")}function sa(t){const i=new Date(t),s=ia(i.getMonth()+1),r=[180-15*(i.getHours()+i.getMinutes()/60-8),23.45*Math.sin(360*(s+i.getDate()-80)/370*Math.PI/180)],n=e.Transforms.cartographicToCartesian3([r[0],r[1],0]);return new e.Vector3(n)}class ra extends Ko{constructor(e,t,i){super(e,t),this._cached={},this._timestamp=null==i?Date.now():i,this.type="SunLight";}set timestamp(e){this._timestamp=e;}get timestamp(){return this._timestamp}getSunPosition(e,t){return Yo(this._timestamp,e,t)}getSunPositionWithCache(e,t){if(this._cached.position){if(this._timestamp!==this._cached.position.timestamp||e!==this._cached.position.latitude||t!==this._cached.position.longitude){const i=this.getSunPosition(e,t);this._cached.position={timestamp:this._timestamp,latitude:e,longitude:t,azimuth:i.azimuth,altitude:i.altitude};}}else {const i=this.getSunPosition(e,t);this._cached.position={timestamp:this._timestamp,latitude:e,longitude:t,azimuth:i.azimuth,altitude:i.altitude};}return {azimuth:this._cached.position.azimuth,altitude:this._cached.position.altitude}}getSunDirection(t,i){return e.Vector3.normalize(new e.Vector3(function(e,t,i){const{azimuth:s,altitude:r}=Yo(e,t,i),n=s+Math.PI;return [-Math.sin(n),Math.cos(n),-Math.sin(r)]}(this.timestamp,t,i)),new e.Vector3).multiplyScalar(-1)}getSunDirectionWithCache(e,t){return this._cached.direction&&this._timestamp===this._cached.direction.timestamp&&e===this._cached.direction.latitude&&t===this._cached.direction.longitude||(this._cached.direction={timestamp:this._timestamp,latitude:e,longitude:t,direction:this.getSunDirection(e,t)}),this._cached.direction.direction}getSunDirectionGlobalWithCache(){return this._cached["g-direction"]?this._timestamp!==this._cached["g-direction"].timestamp&&(this._cached["g-direction"]={timestamp:this._timestamp,direction:sa(this._timestamp).normalize()}):this._cached["g-direction"]={timestamp:this._timestamp,direction:sa(this._timestamp).normalize()},this._cached["g-direction"].direction}serialize(){return {color:e.Vector3.pack(this.color,new Array(3)),intensity:this.intensity,timeStamp:this.timestamp,type:this.type}}}class na{constructor(e,t,i,s,r){this.context=e;const n=e.gl;this.dynamicDraw=Boolean(i),this.type=s,this.unbindVAO(),r?this.buffer=r:(this.buffer=n.createBuffer(),e.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,t.arrayBuffer?t.arrayBuffer:t,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW));}getBuffer(){return this.buffer}unbindVAO(){this.context.extVertexArrayObject&&this.context.bindVertexArrayOES.set(null);}bind(){this.context.bindElementBuffer.set(this.buffer);}updateData(e){const t=this.context.gl,i=e.arrayBuffer?e.arrayBuffer:e;this.unbindVAO(),this.bind(),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,this.dynamicDraw?t.DYNAMIC_DRAW:t.STATIC_DRAW);}destroy(){this.context&&this.context.gl&&this.buffer&&(this.context.gl.deleteBuffer(this.buffer),this.buffer=null,this.context=null,delete this.buffer);}}class oa{constructor(){}load(t){const{map:i,texUrl:s}=t,r=i.painter.textureResourceManager,n=r.getTextureByName(s);if(n)return n;const o=new e.Texture(t);return o.load(s,t.loaded),r.addTexture(s,o),o}}class aa extends e.Material{constructor(t={}){super(t);const{type:i,pbrMetallicRoughness:s,emissiveTexture:r,emissiveFactor:n,occlusionTexture:o,normalTexture:a,brdfTexture:l,specularGlossinessTexture:h,color:_,metalness:c,roughness:d,hasNormal:u,hasTangent:m,hasVertexColor:p,extensions:f,hasMorph:g,hasMorphNormal:y,hasMorphTangent:T,isInstance:C,useStencilTest:x,doubleSided:b,clippingPlanes:v,skins:w,useIBL:S,alphaMode:A,flowOptions:E}=t;if(this.doubleSided=b,this.type=i||"gltfPBR",this.useStencilTest=x||!1,this.isInstance=C,this._emissiveTexture=r,this._occlusionTexture=o,this._hasNormal=e.defaultValue(u,!0),this._hasTangent=m,this._hasVertexColor=p,this._normalTexture=a,a&&a instanceof e.Texture&&(this._normalTexture=this._getGltfTextureWrapObjectFromTexture(a)),this._baseColorTexture=s?.baseColorTexture,t.baseColorTexture&&t.baseColorTexture instanceof e.Texture&&(this._baseColorTexture=this._getGltfTextureWrapObjectFromTexture(t.baseColorTexture)),this._brdfTexture=l,this._specularGlossinessTexture=h,this._metallicRoughnessTexture=s?.metallicRoughnessTexture,t.metallicRoughnessTexture&&t.metallicRoughnessTexture instanceof e.Texture&&(this._metallicRoughnessTexture=this._getGltfTextureWrapObjectFromTexture(t.metallicRoughnessTexture)),this._baseColorFactor=s?.baseColorFactor?e.Color.parse(s?.baseColorFactor).toVector4():new e.Vector4([1,1,1,1]),this._metallicFactor=e.defaultValue(s?.metallicFactor,.1),this._roughnessFactor=e.defaultValue(s?.roughnessFactor,.5),_){this.isForGeometry=!0;const t=e.Color.parse(_);this._baseColorFactor.set(t.r,t.g,t.b,t.a);}this._isValid(c)&&(this._metallicFactor=c),this._isValid(d)&&(this._roughnessFactor=d),this._emissiveFactor=new e.Vector3(n||[1,1,1]),this._specialLight=new e.Vector4([1.01,1.9,1.01,0]),this._lightExposure=1,this.hasMorph=g,this._hasMorphNormal=y,this._hasMorphTangent=T,this._useSkins=e.defaultValue(w,!1),this._useIBL=e.defaultValue(S,!1),this._usePBR=!0,this._specialcolor=[new e.Vector4([1,0,0,1]),new e.Vector4([1,1,0,1]),new e.Vector4([1,0,1,1]),new e.Vector4([0,1,1,1])],this._khrValues=new e.Vector4([0,0,0,0]),this.selectionDepth=-1,this.clippingPlanes=v,this.backCulling=void 0,this.alphaMode=e.defaultValue(A,"BLEND"),this._flowOptions=e.defaultValue(E,void 0),this._buildPBRDefines(),this._processExtension(f);}_isValid(e){return null!=e&&null!=e&&(this.isForGeometry=!0,!0)}_getGltfTextureWrapObjectFromTexture(e){this.isForGeometry=!0;const t={texture:{_texture:e,sampler:{parameters:{}}}};return e.wrapS&&(t.texture.sampler.wrapS=e.wrapS),e.wrapT&&(t.texture.sampler.wrapT=e.wrapT),e.minFilter&&(t.texture.sampler.minFilter=e.minFilter),e.magFilter&&(t.texture.sampler.magFilter=e.magFilter),t}updateProperty(t){t.baseColorTexture&&t.baseColorTexture instanceof e.Texture&&(this._baseColorTexture=this._getGltfTextureWrapObjectFromTexture(t.baseColorTexture));}updateTexture(t){const i=t.texType,s=e.defined(t.opacity)?t.opacity:1;let r,n;switch(i){case"Color":r=e.Color.parse(t.colorTexture),this._baseColorFactor.set(r.r,r.g,r.b,r.a*s);break;case"Image":n=(new oa).load({map:t.map,texUrl:t.texUrl}),this._opacity=s,this._baseColorTexture=this._getGltfTextureWrapObjectFromTexture(n);}}_processUniforms(t){if(this._uniformCreated)return;this._uniformCreated=!0;for(let e=0;e<this._specialcolor.length;e++)this._uniforms.set(`u_specialcolor[${e}].color`,(()=>this._specialcolor[e]));this._uniforms.set("u_BaseColorFactor",(()=>this._baseColorFactor)),this._uniforms.set("u_HAS_BASECOLORMAP",(()=>!!this._baseColorTexture)),this._uniforms.set("u_Opacity",(()=>this._opacity)),this._uniforms.set("u_useKhr",(()=>!1)),this._uniforms.set("u_khrValues",(()=>this._khrValues));const i=e.spec.phongLightConfig.Ambient.default,s=e.spec.phongLightConfig.Diffuse.default,r=e.spec.phongLightConfig.SpecularColor.default,n=e.spec.phongLightConfig.Shininess.default;this._uniforms.set("u_LightMaterial",{Ambient:()=>new e.Vector3(i,i,i),Diffuse:()=>new e.Vector3(s,s,s),SpecularColor:()=>new e.Vector3(r,r,r),Shininess:()=>n}),this._baseColorTexture?this._uniforms.set("u_BaseColorSampler",(()=>this._getUniformBindTexture(this._baseColorTexture))):this._uniforms.set("u_reflect",(()=>0)),this._uniforms.set("u_MetallicRoughnessValues",(()=>new e.Vector2(this._metallicFactor,this._roughnessFactor))),this._uniforms.set("u_HAS_METALROUGHNESSMAP",(()=>!!this._metallicRoughnessTexture)),this._metallicRoughnessTexture&&this._uniforms.set("u_MetallicRoughnessSampler",(()=>this._getUniformBindTexture(this._metallicRoughnessTexture))),this._uniforms.set("u_NormalScale",(()=>1)),this._normalTexture&&this._uniforms.set("u_NormalSampler",(()=>this._getUniformBindTexture(this._normalTexture))),this._uniforms.set("u_HAS_OCCLUSIONMAP",(()=>!!this._occlusionTexture)),this._occlusionTexture&&(this._uniforms.set("u_OcclusionSampler",(()=>this._getUniformBindTexture(this._occlusionTexture))),this._uniforms.set("u_OcclusionStrength",(()=>.1))),this._uniforms.set("u_HAS_EMISSIVEMAP",(()=>!!this._emissiveTexture)),this._emissiveTexture&&this._uniforms.set("u_EmissiveSampler",(()=>this._getUniformBindTexture(this._emissiveTexture))),this._uniforms.set("u_EmissiveFactor",(()=>this._emissiveFactor)),this._uniforms.set("u_brdfLUT",(()=>{const i=t.iBLTextures.mBrdfTex;return i?(i.sampler={minificationFilter:e.WebGLConstants.LINEAR,magnificationFilter:e.WebGLConstants.LINEAR,wrapS:e.WebGLConstants.CLAMP_TO_EDGE,wrapT:e.WebGLConstants.CLAMP_TO_EDGE,continueBindTextureOnExit:!0},i):t.context.defaultTexture})),this._uniforms.set("u_DiffuseEnvSampler",(()=>{const e=t.iBLTextures.mDiffuseEnvTex;return e?(e.bind(),e):null})),this._uniforms.set("u_SpecularEnvSampler",(()=>{const e=t.iBLTextures.mSpecularEnvTex;return e?(e.bind(),e):null})),this._uniforms.set("u_HasSkinning",(()=>this._useSkins)),this._uniforms.set("u_Reflectivity",(()=>1)),this._uniforms.set("u_Shininess",(()=>30));}_processExtension(){}_getUniformBindTexture(t){const i=t.texture._texture,s=t.texture.sampler;return t.texture.source=void 0,i.sampler={minificationFilter:s.parameters&&s?.parameters[e.WebGLConstants.TEXTURE_MIN_FILTER]||s?.minFilter||e.WebGLConstants.LINEAR_MIPMAP_NEAREST,magnificationFilter:s.parameters&&s?.parameters[e.WebGLConstants.TEXTURE_MAG_FILTER]||s?.magFilter||e.WebGLConstants.LINEAR,wrapS:s.parameters&&s?.parameters[e.WebGLConstants.TEXTURE_WRAP_S]||s?.wrapS||e.WebGLConstants.REPEAT,wrapT:s.parameters&&s?.parameters[e.WebGLConstants.TEXTURE_WRAP_T]||s?.wrapT||e.WebGLConstants.REPEAT},i}enableIBL(){this._useIBL=!0;}disableIBL(){this._useIBL=!1;}set programId(e){this.type=e;}get programId(){return this.type}get specialLight(){return this._specialLight}set specialLight(e){this._specialLight=e;}get lightExposure(){return this._lightExposure}set lightExposure(e){this._lightExposure=e;}get baseColor(){return this._baseColorFactor}set baseColor(e){this._baseColorFactor=e;}get metallic(){return this._metallicFactor}set metallic(e){this._metallicFactor=e;}get roughness(){return this._roughnessFactor}set roughness(e){this._roughnessFactor=e;}get emissive(){return this._emissiveFactor}set emissive(e){this._emissiveFactor=e;}get brdfTexture(){return this._brdfTexture}set brdfTexture(e){this._brdfTexture=e;}get diffuseTexture(){return this._diffuseTexture}set diffuseTexture(e){this._diffuseTexture=e;}get specularTexture(){return this._specularTexture}set specularTexture(e){this._specularTexture=e;}update(t,i,s={}){if(this._processUniforms(t),!t)throw new Error("pbr material 更新失败，painter为空");super.update(t,i,s),this.defines=this._updateDefines(),this._updateRenderState(),this._createDynamicUniform(t,i,s);const{primitive:r}=s,n=new e.Matrix4(r.matrixWorld).invert(new e.Matrix4);this._uniforms.set("u_cameraLocalPosition",(()=>{const t=new e.Vector4(i.camera.position.x,i.camera.position.y,i.camera.position.z,1);return t.transform(n),new e.Vector3(t.x,t.y,t.z)}));}_buildPBRDefines(){const e={};this.isForGeometry&&this._useIBL&&(e.USE_IBL=!0),this._usePBR&&(e.USE_PBR=!0),this._hasVertexColor&&(e.VERTEX_COLOR=!0),this._baseColorTexture&&(e.HAS_BASECOLORMAP=!0),this._normalTexture&&(e.HAS_NORMALMAP=!0),this._emissiveTexture&&(e.HAS_EMISSIVEMAP=!0),this._metallicRoughnessTexture&&(e.HAS_METALROUGHNESSMAP=!0),this._occlusionTexture&&(e.HAS_OCCLUSIONMAP=!0),e.HAS_NORMALS=this._hasNormal,e.HAS_TANGENTS=this._hasTangent,this.hasMorph&&(e.USE_MORPHTARGETS=!0,this._hasMorphNormal&&(e.USE_MORPHNORMALS=!0),this._hasMorphTangent&&(e.USE_MORPHTANGENTS=!0)),this.isInstance&&(e.INSTANCE_MATRIX=!0),"OPAQUE"===this.alphaMode&&(e.OPAQUE=!0),this.defines=e;}_updateDefines(){const t={};if(e.defined(this._usePickColorTexture)&&(t.USE_PICKINGTEXTURES=this._usePickColorTexture),e.defined(this._isOneDimensionBatchTexture)&&(t.ONE_DIMENSION_BATCH_TEXTURE=this._isOneDimensionBatchTexture,t.TWO_DIMENSION_BATCH_TEXTURE=!this._isOneDimensionBatchTexture),t.MODEL_INSTANCE_BATCH_TEXTURE=this._isModelInstanceTexture,this.isForGeometry&&this._useIBL&&(t.USE_IBL=!0),!this.isInstance&&this._flowOptions?(t.HAS_FLOW_TEXTURE=!0,t.HAS_FLOW_ATTRIBUTE=!!this._flowOptions.useAttribute):t.HAS_FLOW_TEXTURE=!1,this.clippingPlanes&&this.clippingPlanes.enabled&&0!==this.clippingPlanes.length){t.HAS_CLIPPING_PLANES=!0,t.USE_CLIPPING_PLANES_FLOAT_TEXTURE=!!this.clippingPlanes._useFloatTexture;const i=e.ClippingPlaneCollection.getTextureResolution(this.clippingPlanes);t.CLIPPING_PLANES_LENGTH=this.clippingPlanes.length,t.CLIPPING_PLANES_TEXTURE_WIDTH=i.x,t.CLIPPING_PLANES_TEXTURE_HEIGHT=i.y,t.UNION_CLIPPING_REGIONS=!!this.clippingPlanes._unionClippingRegions;}else t.HAS_CLIPPING_PLANES=!1,t.CLIPPING_PLANES_LENGTH=0,t.CLIPPING_PLANES_TEXTURE_WIDTH=1,t.CLIPPING_PLANES_TEXTURE_HEIGHT=1;return t}_updateRenderState(){this.renderState={cull:this.doubleSided?e.renderStateEnum.disableCull:e.renderStateEnum.enableCull,depthTest:{enabled:!0,func:e.WebGLConstants.LEQUAL},polygonOffset:{enabled:!1,factor:25,units:1},stencilTest:{enabled:!1,mask:e.WebGLConstants.SKIP_LOD_MASK,reference:e.WebGLConstants.CESIUM_3D_TILE_MASK,frontFunction:e.WebGLConstants.ALWAYS,backFunction:e.WebGLConstants.ALWAYS,frontOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.REPLACE},backOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.REPLACE}}},e.defined(this.backCulling)&&(this.renderState.cull=this.backCulling?e.renderStateEnum.enableCull:e.renderStateEnum.disableCull);}_createDynamicUniform(t,i){if(this.clippingPlanes&&this.clippingPlanes.enabled){this.clippingPlanes.update(t,i),this._uniforms.set("u_model_clippingPlanesEdgeStyle",(()=>new e.Vector4(this.clippingPlanes.edgeColor.r,this.clippingPlanes.edgeColor.g,this.clippingPlanes.edgeColor.b,this.clippingPlanes.edgeWidth))),this._uniforms.set("u_model_clippingPlanes",(()=>this.clippingPlanes.texture));let s=e.Matrix4.multiply(new e.Matrix4,i.camera.matrixWorldInverse,this.clippingPlanes.modelMatrix);s=e.Matrix4.inverseTranspose(s,new e.Matrix4),this._uniforms.set("u_model_clippingPlanesMatrix",(()=>s));const r={x:t.context.viewport.current.x,y:t.context.viewport.current.y,width:t.context.viewport.current.width,height:t.context.viewport.current.height},n=new e.Matrix4;e.Matrix4.computeViewportTransformation(r,0,1,n),this._uniforms.set("u_ViewportTransformation",(()=>n)),this._uniforms.set("u_InverseProjection",(()=>i.camera.projectionMatrixInverse));}!this.isInstance&&this._flowOptions&&(this._uniforms.set("u_FlowSampler",(()=>e.Material.bindTextureSampler(this._flowOptions.flowTexture))),this._uniforms.set("u_TexUnit",(()=>this._flowOptions.texUnit)));}flowTexture(e){e.speed&&(e.speed>0?this._flowOptions.speed=e.speed:console.warn("流动纹理速度不能小于0")),e.rotation&&(e.rotation>=0&&e.rotation<360?this._flowOptions.rotation=e.rotation:console.warn("流动纹理旋转角度在0-360之间")),e.direction&&(this._flowOptions.direction=e.direction),e.texRepeat&&(this._flowOptions.texRepeat=e.texRepeat),e.texOffset&&(this._flowOptions.texOffset=e.texOffset),e.lengthAttribute&&console.warn("lengthAttribute不允许变动!"),e.texUnit&&(e.texUnit>0?this._flowOptions.texUnit=e.texUnit:console.warn("横向纹理单元长度必须大于0")),e.texUnit<=0&&(e.texUnit=1),e.flowTexture&&(this._flowOptions.flowTexture=e.flowTexture);}serialize(){const t={metalness:this._metallicFactor,roughness:this._roughnessFactor,hasNormal:this._hasNormal,type:this.type};return e.defined(this._baseColorTexture)&&(this._baseColorTexture instanceof e.Texture?t.baseColorTextureUrl=this._baseColorTexture.serialize():e.defined(this._baseColorTexture.texture)&&this._baseColorTexture.texture instanceof e.Texture&&(t.baseColorTextureUrl=this._baseColorTexture.texture.serialize())),e.defined(this._normalTexture)&&(this._normalTexture instanceof e.Texture?t.normalTextureUrl=this._normalTexture.serialize():e.defined(this._normalTexture.texture)&&this._normalTexture.texture instanceof e.Texture&&(t.normalTextureUrl=this._normalTexture.texture.serialize())),e.defined(this._metallicRoughnessTexture)&&(this._metallicRoughnessTexture instanceof e.Texture?t.metallicRoughnessTextureUrl=this._metallicRoughnessTexture.serialize():e.defined(this._metallicRoughnessTexture.texture)&&this._metallicRoughnessTexture.texture instanceof e.Texture&&(t.metallicRoughnessTextureUrl=this._metallicRoughnessTexture.texture.serialize())),e.defined(this._baseColorFactor)&&(t.color=e.Vector4.pack(this._baseColorFactor,new Array(4))),t}destroy(){const e=this._baseColorTexture?.texture?._texture?.context?.painter;this._uniforms=void 0,this.type=void 0,this.isInstance=void 0,this._emissiveTexture&&e?.textureResourceManager.removeTexture(this._emissiveTexture.texture._texture.name),this._emissiveTexture=void 0,this._occlusionTexture&&e?.textureResourceManager.removeTexture(this._occlusionTexture.texture._texture.name),this._occlusionTexture=void 0,this._hasNormal=void 0,this._hasTangent=void 0,this._hasVertexColor=void 0,this._normalTexture&&e?.textureResourceManager.removeTexture(this._normalTexture.texture._texture.name),this._normalTexture=void 0,this._baseColorTexture&&e?.textureResourceManager.removeTexture(this._baseColorTexture.texture._texture.name),this._baseColorTexture=void 0,this._brdfTexture=void 0,this._diffuseTexture=void 0,this._specularGlossinessTexture=void 0,this._metallicRoughnessTexture=void 0,this._baseColorFactor=void 0,this._metallicFactor=void 0,this._roughnessFactor=void 0,this._emissiveFactor=void 0,this._specialLight=void 0,this._lightExposure=void 0,this.hasMorph=void 0,this._hasMorphNormal=void 0,this._hasMorphTangent=void 0,this._specialcolor=void 0,this._khrValues=void 0;}}const la={nextPowerOfTwo(e){if("number"!=typeof e||e<0||e>2147483648)throw new Error("A number between 0 and 2^31 is required.");return --e,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},generateImage(t){const i=e.window.document.createElement("canvas");return i.width=la.nextPowerOfTwo(t.width),i.height=la.nextPowerOfTwo(t.height),i.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,i.width,i.height),i},resize(t,i,s){const r=e.window.document.createElement("canvas");return r.width=i,r.height=s,r.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,i,s),r},isPowerOfTwo(e){if("number"!=typeof e||e<0||e>4294967295)throw new Error("A number between 0 and (2^32)-1 is required.");return 0!==e&&!(e&e-1)}};class ha extends e.Material{color=new e.Vector4(1,1,1,1);shininess=30;reflectivity=.85;baseColorMap=null;normalMap=null;hasMorph=!1;hasMorphNormal=!1;hasMorphTangent=!1;isInstance=!1;hasNormal=!0;hasTangent=!1;hasVertexColor=!1;hasSkins=!1;clippingPlanes=null;needUpdate=!1;constructor(e){super(e),this.type="PhongMaterial",this.setOptions(e);}setOptions(t){if(t.color){const i=e.Color.parse(t.color);this.color.set(i.r,i.g,i.b,i.a);}if(t.reflectivity&&(this.reflectivity=t.reflectivity),t.shininess&&(this.shininess=t.shininess),t.baseColorMap&&(this.baseColorMap=t.baseColorMap),t.normalMap&&(this.normalMap=t.normalMap),t.hasMorph&&(this.hasMorph=t.hasMorph),t.hasMorphNormal&&(this.hasMorphNormal=t.hasMorphNormal),t.hasMorphTangent&&(this.hasMorphTangent=t.hasMorphTangent),t.isInstance&&(this.isInstance=t.isInstance),t.hasNormal&&(this.hasNormal=t.hasNormal),t.hasTangent&&(this.hasTangent=t.hasTangent),t.hasVertexColor&&(this.hasVertexColor=t.hasVertexColor),t.hasSkins&&(this.hasSkins=t.hasSkins),t.clippingPlanes&&(this.clippingPlanes=t.clippingPlanes),t.doubleSided&&(this.doubleSided=t.doubleSided),t.pbrMetallicRoughness){if(t.pbrMetallicRoughness.baseColorFactor){const i=e.Color.parse(t.pbrMetallicRoughness.baseColorFactor);this.color.set(i.r,i.g,i.b,i.a);}if(t.pbrMetallicRoughness.baseColorTexture){const i=t.pbrMetallicRoughness.baseColorTexture.texture;this.baseColorMap=i._texture,this.baseColorMap.minFilter=i.sampler.parameters[e.WebGLConstants.TEXTURE_MIN_FILTER],this.baseColorMap.magFilter=i.sampler.parameters[e.WebGLConstants.TEXTURE_MAG_FILTER],this.baseColorMap.wrapS=i.sampler.parameters[e.WebGLConstants.TEXTURE_WRAP_S],this.baseColorMap.wrapT=i.sampler.parameters[e.WebGLConstants.TEXTURE_WRAP_T];}}if(t.normalTexture){const i=t.normalTexture.texture;this.normalMap=i._texture,this.normalMap.minFilter=i.sampler.parameters[e.WebGLConstants.TEXTURE_MIN_FILTER],this.normalMap.magFilter=i.sampler.parameters[e.WebGLConstants.TEXTURE_MAG_FILTER],this.normalMap.wrapS=i.sampler.parameters[e.WebGLConstants.TEXTURE_WRAP_S],this.normalMap.wrapT=i.sampler.parameters[e.WebGLConstants.TEXTURE_WRAP_T];}this.needUpdate=!0;}update(e,t,i={}){super.update(e,t,i),this._updateDefinesNonStandard(),this.needUpdate&&(this._updateDefines(),this._updateUniforms(),this._updateRenderState(),this.needUpdate=!1);}get baseColor(){return this.color}set baseColor(e){this.color=e;}serialize(){return {type:this.type,color:e.Vector3.pack(this.color,new Array(4)),shininess:this.shininess,reflectivity:this.reflectivity,opacity:this._opacity}}destroy(){super.destroy(),this.normalMap&&this.normalMap.destroy();}_updateUniforms(){this.baseColorMap&&this._uniforms.set("u_BaseColorSampler",(()=>{const t=this.baseColorMap;return t.sampler={minificationFilter:t.minFilter||e.WebGLConstants.LINEAR_MIPMAP_NEAREST,magnificationFilter:t.magFilter||e.WebGLConstants.LINEAR,wrapS:t.wrapS||e.WebGLConstants.REPEAT,wrapT:t.wrapT||e.WebGLConstants.REPEAT},t})),this.normalMap&&this._uniforms.set("u_NormalSampler",(()=>{const t=this.normalMap;return t.sampler={minificationFilter:t.minFilter||e.WebGLConstants.LINEAR_MIPMAP_NEAREST,magnificationFilter:t.magFilter||e.WebGLConstants.LINEAR,wrapS:t.wrapS||e.WebGLConstants.REPEAT,wrapT:t.wrapT||e.WebGLConstants.REPEAT},t})),this._uniforms.set("u_BaseColorFactor",(()=>this.color)),this._uniforms.set("u_Shininess",(()=>this.shininess)),this._uniforms.set("u_Opacity",(()=>this._opacity)),this._uniforms.set("u_Reflectivity",(()=>this.reflectivity)),this._uniforms.set("u_HasSkinning",(()=>this.hasSkins));}_updateDefinesNonStandard(){const t={};e.defined(this._usePickColorTexture)&&(t.USE_PICKINGTEXTURES=this._usePickColorTexture),e.defined(this._isOneDimensionBatchTexture)&&(t.ONE_DIMENSION_BATCH_TEXTURE=this._isOneDimensionBatchTexture,t.TWO_DIMENSION_BATCH_TEXTURE=!this._isOneDimensionBatchTexture),t.MODEL_INSTANCE_BATCH_TEXTURE=this._isModelInstanceTexture,this.defines=t;}_updateDefines(){const t={VERTEX_COLOR:this.hasVertexColor,HAS_NORMALS:this.hasNormal,HAS_TANGENTS:this.hasTangent,HAS_NORMALMAP:!!this.normalMap,HAS_BASECOLORMAP:!!this.baseColorMap,USE_MORPHTARGETS:this.hasMorph,USE_MORPHNORMALS:this.hasMorphNormal,USE_MORPHTANGENTS:this.hasMorphTangent,INSTANCE_MATRIX:this.isInstance,OPAQUE:"OPAQUE"===this.alphaMode,HAS_CLIPPING_PLANES:this.clippingPlanes?.enabled&&0!==this.clippingPlanes.length};if(t.HAS_CLIPPING_PLANES){t.HAS_CLIPPING_PLANES=!0,t.USE_CLIPPING_PLANES_FLOAT_TEXTURE=!!this.clippingPlanes._useFloatTexture;const i=e.ClippingPlaneCollection.getTextureResolution(this.clippingPlanes);t.CLIPPING_PLANES_LENGTH=this.clippingPlanes.length,t.CLIPPING_PLANES_TEXTURE_WIDTH=i.x,t.CLIPPING_PLANES_TEXTURE_HEIGHT=i.y,t.UNION_CLIPPING_REGIONS=!!this.clippingPlanes._unionClippingRegions;}else t.HAS_CLIPPING_PLANES=!1,t.USE_CLIPPING_PLANES_FLOAT_TEXTURE=!1,t.CLIPPING_PLANES_LENGTH=0,t.CLIPPING_PLANES_TEXTURE_WIDTH=1,t.CLIPPING_PLANES_TEXTURE_HEIGHT=1;this.defines=t;}_updateRenderState(){this.renderState={cull:this.doubleSided?e.renderStateEnum.disableCull:e.renderStateEnum.enableCull,depthTest:{enabled:!0,func:e.WebGLConstants.LEQUAL},polygonOffset:{enabled:!1,factor:25,units:1},stencilTest:{enabled:!1,mask:e.WebGLConstants.SKIP_LOD_MASK,reference:e.WebGLConstants.CESIUM_3D_TILE_MASK,frontFunction:e.WebGLConstants.ALWAYS,backFunction:e.WebGLConstants.ALWAYS,frontOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.REPLACE},backOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.REPLACE}}},e.defined(this.backCulling)&&(this.renderState.cull=this.backCulling?e.renderStateEnum.enableCull:e.renderStateEnum.disableCull);}}function _a(e){const t={hasMorph:!1,hasMorphNormal:!1,hasMorphTangent:!1};if(e.targets){t.hasMorph=!0;const i=e.targets[0];i.NORMAL&&(t.hasMorphNormal=!0),i.TANGENT&&(t.hasMorphTangent=!0);}return t}class ca{constructor(e){this.options=Object.assign({},{closed:!1,state:1},e),this._value=null;}set state(e){this.options.state=e;}get state(){return this.options.state}get times(){return this.options.times}get controlPoint(){return this.options.controlPoint}get points(){return this.options.points}get weights(){return this.options.weights}get interpolation(){return this.options.interpolation}get node(){return this.options.node}get nodeId(){return this.options.node.id}get path(){return this.options.path}get closed(){return this.options.closed}start(){this._stime=Date.now();}close(){this.options.closed=!0;}open(){this.options.closed=!1;}get value(){return this._value}update(e){this._curtime=e;}getCurrentTick(t){t=t||Date.now(),this._stime||(this._stime=Date.now());const i=this.options.times;let s=0;const r=(t-this._stime)/1e3%i[i.length-1];for(let t=0;t<i.length-1;t++)if(r>=i[t]&&r<=i[t+1])return s=(r-i[t])/(i[t+1]-i[t]),"LINEAR"===this.interpolation?{ratio:s,index:t}:"STEP"===this.interpolation?{ratio:1,index:t}:"CUBICSPLINE"===this.interpolation?{ratio:e.easeCubicInOut(s),index:t}:{ratio:s,index:t};return {ratio:1,index:i.length-2}}evaluate(){return this.options.closed?(this._value=null,null):(this._value=[],[])}}class da extends ca{constructor(e){super(e);}evaluate(){return this.options.closed?null:this.controlPoint}}class ua extends ca{constructor(e){super(e),this.transformationIndex="translation"===e.path?0:2;}evaluate(t){if(this.options.closed)return null;const i=this.getCurrentTick(t),s=this.points,r=new e.Matrix4;if("scale"===this.path)if(-1===i.index)r.scale(new e.Vector3(s));else {const t=new e.Vector3(s.slice(3*i.index,3*i.index+3));t.lerp(s.slice(3*(i.index+1),3*(i.index+1)+3),i.ratio),r.scale(t);}else if("translation"===this.path)if(-1===i.index)r.translate(new e.Vector3(s));else {const t=new e.Vector3(s.slice(3*i.index,3*i.index+3));t.lerp(s.slice(3*(i.index+1),3*(i.index+1)+3),i.ratio),r.translate(t);}this.options.originNodeMatrix&&r.multiplyLeft(this.options.originNodeMatrix.getTranslationMatrix4()),this._value=r;}}class ma extends ca{constructor(e){super(e),this.transformationIndex=1;}evaluate(t){if(this.options.closed)return null;const i=this.getCurrentTick(t),s=this.points,r=new e.Matrix4,n=new e.Quaternion(s.slice(4*i.index,4*i.index+4));if(n.slerp(n,s.slice(4*i.index+4,4*i.index+8),i.ratio),r.fromQuaternion(n),this.options.originNodeMatrix){const e=this.options.originNodeMatrix.getRotation();r.multiplyLeft(e);}this._value=r;}}class pa extends ca{constructor(e){super(e);}evaluate(e){if(this.options.closed)return null;const t=this.getCurrentTick(e),i=this.weights,s=i.length/this.times.length,r=[];for(let e=0;e<s;e++)r.push(i[t.index*s+e]*(1-t.ratio)+i[t.index*s+e]*t.ratio);return this._value=r,0}}var fa=function(e){for(const t of Object.getOwnPropertyNames(e.constructor.prototype)){const i=e[t];"constructor"!==t&&"function"==typeof i&&(e[t]=i.bind(e));}return e};class ga extends e.Evented{constructor(t){super(),this.options=Object.assign({animations:[],loop:0,delay:0,multiplier:1,reverse:!1},t),delete this.options.animations,this.isRunning=e.defaultValue(t.isRunning,!0),this.id=t.id,this.name=t.name,this.gltf=t.gltf,this.groupsOfNode={},this._defaultAnimations={},this.parseAnimation(t.animations),fa(this);}parseAnimation(e){if(!this.parsed){for(let t=0;t<e.length;t++)this.addAnimation(e[t],t);this.nodeTransformationSort();}}nodeTransformationSort(){for(const e in this.groupsOfNode)this.groupsOfNode[e].sort(((e,t)=>e.transformationIndex-t.transformationIndex));}evaluateActiveAnimations(){const t=Date.now();this.update(t),this.applyAllAnimationsOfNodes(),e.window.requestAnimationFrame(this.evaluateActiveAnimations);}update(t){if(this.isRunning)for(const i in this.groupsOfNode){const s=this.gltf.nodes[parseFloat(i.slice(5))];if(!s.play)continue;s.translateMat||(s.translateMat=(new e.Matrix4).setTranslation(s._position),s.scaleMat=(new e.Matrix4).scale(s._scale),s.rotateMat=(new e.Matrix4).fromQuaternion(s._quaternion));const r={translation:s.translateMat,rotation:s.rotateMat,scale:s.scaleMat};for(let e=0;e<this.groupsOfNode[i].length;e++)this.groupsOfNode[i][e].evaluate(t),"translation"==this.groupsOfNode[i][e].path&&(r.translation=this.groupsOfNode[i][e]._value),"rotation"==this.groupsOfNode[i][e].path&&(r.rotation=this.groupsOfNode[i][e]._value),"scale"==this.groupsOfNode[i][e].path&&(r.scale=this.groupsOfNode[i][e]._value);s.setMatrix(r.translation.clone().multiplyRight(r.rotation.clone()).multiplyRight(r.scale.clone())),s.updateWorldMatrix(!0,!0);}}play(){this.isRunning=!0;}stop(){this.isRunning=!1;}addAnimation(e,t){const i=e.input,s=e.output,r=e.target.path,n=e.interpolation;let o;const a=e.target.node,l=`${a.id}`,h=`animation-${t}-${l}`,_="HAD"===e.type?e.target.node.matrix:null;return 1===i.length&&1===s.length?o=new da({id:h,controlPoint:s[0],node:a}):"LINEAR"!==n&&"STEP"!==n||("translation"===r||"scale"===r?o=new ua({id:h,times:i,points:Array.from(s),node:a,interpolation:n,path:r,originNodeMatrix:_}):"rotation"===r?o=new ma({id:h,times:i,points:Array.from(s),node:a,interpolation:n,path:r,originNodeMatrix:_}):"weights"===r&&(o=new pa({id:h,times:i,weights:Array.from(s),node:a,interpolation:n,path:r}))),this.groupsOfNode[l]||(this.groupsOfNode[l]=[]),this.groupsOfNode[l].push(o),h}removeAll(){for(const e in this.groupsOfNode){const t=this.groupsOfNode[e];for(let e=0;e<t.length;e++)t[e].stop();delete this.groupsOfNode[e];}}getMorphAnimation(){for(const e in this.groupsOfNode){const t=this.groupsOfNode[e];for(let e=0;e<t.length;e++)if("weights"===t[e].path)return t[e]}return null}applyAllAnimationsOfNodes(){for(const e in this.groupsOfNode)this.applyAnimationByNodeId(e);}applyAnimationByNode(e){return this.applyAnimationByNodeId(e.id)}applyAnimationByNodeId(t){const i=[],s=[];for(const e of this.groupsOfNode[t])e.closed||("weights"!==e.path?i.push(e):s.push(e));if(0===i.length&&0===s.length)return;const r={};if(i.length>0)if(1===i.length)r.anim=i[0].value;else {const t=new e.Matrix4;for(let e=0;e<i.length;e++)t.multiplyRight(i[e].value);r.anim=t;}return s.length>0&&(r.weights=s[0].value),i[0].node.weights=r.weights,r}}const ya={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ta={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Ca=10240,xa=10241,ba=10242,va=10243,wa={magFilter:10240,minFilter:10241,wrapS:10242,wrapT:10243},Sa={[Ca]:9729,[xa]:9986,[ba]:10497,[va]:10497};class Aa{postProcess(t,i={}){const{json:s,buffers:r=[],images:n=[],baseUri:o=""}=t;if(!s)return t;sr(s),this.vBuffer={},this.iBuffer={},this.useMipmap=i.useMipmap,this.clippingPlanes=i.clippingPlanes,this.allowPick=i.allowPick,this.flowOptions=i.flowOptions,this.context=i.context,this.lightingModel=i.lightingModel||e.LightingModelType.PBR,this.modelInstanceCollection=i.modelInstanceCollection,this.batchTable=i.batchTable,this.baseUri=o,this.json=s,this.buffers=r,this.images=n,this.json.textureByteSize=t.textureByteSize,function(e){const t=e.meshes;for(let e=0;e<t.length;e++){const i=t[e].primitives;for(let e=0;e<i.length;e++){const t=i[e];if(t.extensions&&t.extensions.KHR_draco_mesh_compression){const e=t.extensions.KHR_draco_mesh_compression.attributes;Object.keys(t.attributes).forEach(((i,s)=>{if(-1!==i.indexOf("CUSTOM_ATTRIBUTE")){const s=parseInt(i.split("_")[2]);for(const r in t.extensions.KHR_draco_mesh_compression.attributes)e[r]==s&&(t.attributes[r]=t.attributes[i],delete t.attributes[i]);}}));}}}}(this.json),this._resolveTree(this.json,i),this.context=null,this.vBuffer=null,this.iBuffer=null;const a=this.json;return this.json=null,this.buffers=null,this.images=null,a}_resolveTree(t,i={}){t.bufferViews&&(t.bufferViews=t.bufferViews.map(((e,t)=>this._resolveBufferView(e,t)))),t.images&&(t.images=t.images.map(((e,t)=>this._resolveImage(e,t)))),t.samplers&&(t.samplers=t.samplers.map(((e,t)=>this._resolveSampler(e,t)))),t.textures&&(t.textures=t.textures.map(((e,t)=>this._resolveTexture(e,t)))),t.accessors&&(t.accessors=t.accessors.map(((e,t)=>this._resolveAccessor(e,t)))),t.materials&&(t.materials=t.materials.map(((e,t)=>this._resolveMaterial(e,t)))),t.skins&&(t.skins=t.skins.map(((e,t)=>this._resolveSkin(e,t)))),t.nodes&&(t.nodes=t.nodes.map(i.instances?t=>new e.Node(t,!1):t=>new e.Node(t,!0)),t.nodes=t.nodes.map(((e,t)=>this._resolveNode(e,t)))),t.animations&&(t.animations=t.animations.map(((e,t)=>this._resolveAnimation(e,t)))),t.scenes&&(t.scenes=t.scenes.map(((e,t)=>this._resolveScene(e,t)))),t.scene=e.defined(t.scene)?t.scenes[this.json.scene]:t.scenes[0];}getScene(e){return this._get("scenes",e)}getNode(t){let i=this._get("nodes",t);return i instanceof e.Node||(i=new e.Node(i)),i}getSkin(e){return this._get("skins",e)}getMesh(e){return this._get("meshes",e)}getMaterial(e){return this._get("materials",e)}getAccessor(e){return this._get("accessors",e)}getCamera(e){return null}getTexture(e){return this._get("textures",e)}getSampler(e){return this._get("samplers",e)}getImage(e){return this._get("images",e)}getBufferView(e){return this._get("bufferViews",e)}getBuffer(e){return this._get("buffers",e)}_get(e,t){return "object"==typeof t?t:this.json[e]&&this.json[e][t]}_resolveAnimation(e,t){return e.id=e.id||t,e.name=e.name||"default-animation",e.isRunning=!1,0===t&&(e.isRunning=!0),function(e,t){const i=[],s=e;for(let e=0;e<s.channels.length;e++){const r=s.channels[e],n=s.samplers[r.sampler],o=t.accessors[n.input];let a=null;r.extras&&r.extras.type&&(a=r.extras.type);const l={count:o.count,input:o.value,output:t.accessors[n.output].value,target:r.target,interpolation:n.interpolation,type:a};l.target.node=t.nodes[l.target.node],i.push(l);}return new ga({id:e.id,name:e.name,animations:i,gltf:t,isRunning:e.isRunning})}(e,this.json)}createNodeMesh(e){if(void 0===e.mesh)return null;const t=Ea(this.json.meshes[e.mesh]);return t.primitives.forEach((t=>{t.skinsIndex=e._skinsIndex;})),this._resolveMesh(t,e)}_resolveScene(e,t){return e.id=e.id||`scene-${t}`,e.nodes=(e.nodes||[]).map((e=>this.getNode(e))),e}_resolveNode(e,t){if(e.id=e.id||`node-${t}`,e.childIdxes){const t=e.childIdxes.map((e=>this.getNode(e)));e.add(...t);}return void 0!==e.mesh?(e.mesh=this.createNodeMesh(e),e.add(...e.mesh.primitives)):void 0!==e.meshes&&e.meshes.length&&(e.mesh=e.meshes.reduce(((e,t)=>{const i=this.createNodeMesh(t);return e.id=i.id,e.primitives=e.primitives.concat(i.primitives),e}),{primitives:[]}),e.add(...e.mesh.primitives)),void 0!==e.camera&&(e.camera=this.getCamera(e.camera)),void 0!==e.skin&&(e.skin=this.getSkin(e.skin)),e.createSkeleton(this.json),e}_resolveSkin(t,i){t.id=t.id||`skin-${i}`;const s=this.getAccessor(t.inverseBindMatrices),r=[];for(let i=0;i<t.joints.length;i++){const n=this.json.nodes[t.joints[i]];n.inverseBindMatrix=new e.Matrix4(s.value.slice(16*i,16*(i+1))),r.push(n.inverseBindMatrix),n.isJoint=!0;}return t.inverseBindMatrices=r,t}_resolveMesh(t,i){const s=i.mesh;return t.id?i.properties.id=t.id:t.id=`mesh-${s}`,t.primitives&&(t.primitives=t.primitives.map(((t,i)=>{const r=(t={...t}).attributes;t.attributes={};for(const e in r)t.attributes[e]=this.getAccessor(r[e]);return void 0!==t.indices&&(t.indicesId=t.indices,t.indices=this.getAccessor(t.indices)),void 0!==t.material&&(t.materialId=t.material,t.material=this.getMaterial(t.material),t.material.alphaMode||(t.material.alphaMode="OPAQUE")),function({primitive:t,context:i,vbuffer:s,ibuffer:r,gltf:n,ppi:o,meshInd:a,modelInstanceCollection:l,clippingPlanes:h,allowPick:_,lightingModel:c,flowOptions:d,batchTable:u}){const m={},p=!!(t.targets&&t.targets.length>0),f=null!=l;if(!t.attributes.hasOwnProperty("NORMAL")&&i._enableNormal&&(t.attributes.NORMAL={value:new Float32Array(e.PolygonGeometryLibrary.computeNormal(t.attributes.POSITION.value,t.indices.value)),size:3,bufferView:t.attributes.POSITION.bufferView,byteOffset:t.attributes.POSITION.byteOffset,count:t.attributes.POSITION.count,type:"VEC3",components:3,componentType:t.attributes.POSITION.componentType}),!f&&d)if(d.lengthAttribute&&t.attributes.hasOwnProperty("_BATCHID")&&u&&e.defined(u._properties[d.lengthAttribute])){d.useAttribute=!0;const e=t.attributes._BATCHID,i=[],s=e.count;for(let t=0;t<s;t++){let s=parseFloat(u.getProperty(e.value[t],d.lengthAttribute));i.push(s);}t.attributes.TEXREPEAT={value:new Float32Array(i),size:3,bufferView:null,byteOffset:0,count:s,type:"FLOAT",components:1,componentType:5126};}else d.useAttribute=!1,d.texRepeat||(d.texRepeat=[1,1]);const g=function(e){const t={HAS_TANGENTS:!1,HAS_NORMALS:!1,HAS_VERTEX_COLOR:!1};for(const i in e.attributes){const e=i.toUpperCase();-1!==e.indexOf("NORMAL")&&(t.HAS_NORMALS=!0),-1!==e.indexOf("TANGENT")&&(t.HAS_TANGENTS=!0),-1!==e.indexOf("COLOR_0")&&(t.HAS_VERTEX_COLOR=!0);}return t}(t),y=function({primitive:t,bufferDataConfig:i,isMorphModel:s,gltf:r}){const n=t.attributes,o=t.extensions,a=o?o.KHR_draco_mesh_compression:void 0,l=[];for(const t in n){const s=n[t],o=s.bufferView||s.value,h=s.byteOffset?s.byteOffset:0,_=s.componentType,c=o.byteStride?o.byteStride:e.WebGLSizes[_]*(e.WebGLComponentCounts[s.type]||s.components);a&&(n[t].bufferViewId=r.bufferViews[a.bufferView].id),"POSITION"===t&&(i.VB={offset:h,byteStride:c,type:_}),"_"==t.charAt(0)?l.push({name:`a${t}`,type:_,components:e.WebGLComponentCounts[s.type],offset:h,byteStride:c}):l.push({name:`a_${t}`,type:_,components:e.WebGLComponentCounts[s.type],offset:h,byteStride:c});}if(s)for(let i=0;i<t.targets.length;i++){const s=t.targets[i];for(const t in s){const s=n[t],r=s.bufferView,o=s.componentType,a=s.components;l.push({name:`a_${t}_${i+1}`,type:o,components:e.WebGLComponentCounts[s.type],offset:s.byteOffset?s.byteOffset:0,byteStride:r.byteStride?r.byteStride:5121===o?a:5123===o?2*a:4*a});}}return e.createLayoutGltf(l)}({primitive:t,bufferDataConfig:m,isMorphModel:p,gltf:n});let T;const C=!!t.hasOwnProperty("indices");C&&(T=t.indices);const x=t.attributes,b=t.mode,v=t.attributes.POSITION||t.attributes.CENTEROFFSETS;v.min||(t.boundingBox?(v.min=t.boundingBox.min,v.max=t.boundingBox.max):(v.min=[0,0,0],v.max=[1e4,1e4,1e4]));const w=null!=v.bufferView?v.bufferView.id:v.bufferViewId;m.VB&&(m.VB.byteOffset=v&&v.byteOffset||0);const S=!s[w+y.key],A=t.targets;S&&A&&A.length>0&&A.forEach(((e,t)=>{const i=e;for(const e in i)x[`${e}_${t+1}`]=n.accessors[i[e]];}));const E=new e.VertexBuffer({context:i,attributesbuffviewObject:S?x:null,attributes:y.members,dynamicDraw:!1,buffers:s[w+y.key]});let M,P,R;if(l&&l.update({context:i}),S&&(s[w+y.key]=E.getBuffers()),C){const e=null!=T.bufferView?T.bufferView:{};e&&!e.hasOwnProperty("byteOffset")&&(e.byteOffset=0),e&&void 0===e.id&&(e.id=`bufferView-${a}_${o}`);const t=null!=T.bufferView?T.bufferView.data:T.value;P=T.byteOffset?T.byteOffset:0;const s=T.componentType;R=T.count,m.IB={byteStride:2,count:R,type:s,value:T.value},r[e.id]?M=new na(i,null,!1,s,r[e.id]):(M=new na(i,t,!1,s),r[e.id]=M.getBuffer());}else R=t.attributes.POSITION.count;const B=new e.SegmentVector;B.pushSegment({isModel:!0,isInstance:f,modelVertexOffset:P||0,modelVertexCount:R,instancesCount:l?._instances?.size||0});const I=new e.Geometry({indexBuffer:M,vertexBuffer:E,dynamicLayoutBuffer1:l?.instanceBuffer,primitiveType:void 0===b?e.WebGLConstants.TRIANGLES:b,segmentVector:B,vertices:(D=v.min,O=v.max,[D[0],D[1],D[2],O[0],D[1],D[2],D[0],O[1],D[2],D[0],D[1],O[2],O[0],O[1],D[2],O[0],D[1],O[2],D[0],O[1],O[2],O[0],O[1],O[2]])});var D,O;let L;const V=t.material||{};L=c===e.LightingModelType.PHONG?new ha({...V,..._a(t),isInstance:f,hasNormal:g.HAS_NORMALS,hasTangent:g.HAS_TANGENTS,hasVertexColor:g.HAS_VERTEX_COLOR,hasSkins:e.defined(n.skins)&&n.skins.length>0,clippingPlanes:h}):new aa({type:f?"gltfPBRI3DM":void 0,isInstance:f,...V,hasNormal:g.HAS_NORMALS,hasTangent:g.HAS_TANGENTS,hasVertexColor:g.HAS_VERTEX_COLOR,doubleSided:!!V.doubleSided,..._a(t),clippingPlanes:h,skins:e.defined(n.skins)&&n.skins.length>0,alphaMode:V.alphaMode,flowOptions:e.defined(d)?{...d}:void 0});const N=new e.Primitive({geometry:I,material:L,properties:{primitiveName:t.name,indicesId:t.indicesId,materialId:t.materialId},normalMatrix:new e.Matrix4,allowPick:_,skinsIndex:t.skinsIndex});return f&&(N.modelInstanceType="3d-tile"),N}({primitive:t,context:this.context,vbuffer:this.vBuffer,ibuffer:this.iBuffer,gltf:this.json,meshInd:s,ppi:i,modelInstanceCollection:this.modelInstanceCollection,clippingPlanes:this.clippingPlanes,allowPick:this.allowPick,lightingModel:this.lightingModel,flowOptions:this.flowOptions,batchTable:this.batchTable})}))),t}_resolveMaterial(e,t){if(e.id=e.id||`material-${t}`,e.normalTexture&&(e.normalTexture={...e.normalTexture},e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlusionTexture={...e.occlusionTexture},e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emissiveTexture={...e.emissiveTexture},e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emissiveTexture?[1,1,1]:[0,0,0]),e.extensions&&e.extensions&&e.extensions&&e.extensions.KHR_materials_pbrSpecularGlossiness){e.pbrMetallicRoughness={...e.extensions.KHR_materials_pbrSpecularGlossiness};const t=e.pbrMetallicRoughness;t.diffuseTexture&&(t.baseColorTexture={...t.diffuseTexture},t.baseColorTexture.texture=this.getTexture(t.diffuseTexture.index));}else {e.pbrMetallicRoughness={...e.pbrMetallicRoughness};const t=e.pbrMetallicRoughness;t.baseColorTexture&&(t.baseColorTexture={...t.baseColorTexture},t.baseColorTexture.texture=this.getTexture(t.baseColorTexture.index)),t.metallicRoughnessTexture&&(t.metallicRoughnessTexture={...t.metallicRoughnessTexture},t.metallicRoughnessTexture.texture=this.getTexture(t.metallicRoughnessTexture.index));}return e}_resolveAccessor(e,t){if(e.id=e.id||`accessor-${t}`,void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=Ta[e.componentType],e.components=ya[e.type],e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){const t=e.bufferView.buffer,{ArrayType:i,byteLength:s}=Tr(e),r=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+t.byteOffset,n=t.arrayBuffer.slice(r,r+s);e.bytesPerElement*e.count<=e.bufferView.data.length&&(e.value=new i(n));}return e}_resolveTexture(t,i){return t.id=t.id||`texture-${i}`,t.sampler="sampler"in t?this.getSampler(t.sampler):{id:"default-sampler",parameters:Sa},t.source=this.getImage(t.source),function(t,i,s){const r=t.source,n=function(t){return {wrapS:t.wrapS||e.WebGLConstants.REPEAT,wrapT:t.wrapT||e.WebGLConstants.REPEAT,magFilter:t.magFilter||e.WebGLConstants.LINEAR,minFilter:t.minFilter||e.WebGLConstants.LINEAR}}(t.sampler);let o=r.image,a="";const l=i.painter.textureResourceManager;if(r.uri&&e.isUrl(r.uri)&&(a=r.uri.substring(r.uri.lastIndexOf("/")+1)),e.CompressedTextureUtil.isCompressedFormat(o)){const{format:e}=o[0],s=l.getTexture({texUrl:r.uri,name:a,context:i,image:o,pixelFormat:e,compressed:!0,useMipmap:!1});s.bind(n.magFilter,n.wrapS),t._texture=s;}else {const h=!1;if(o&&o.width&&(s||n.wrapS===e.WebGLConstants.REPEAT)){const e=!la.isPowerOfTwo(o.width)||!la.isPowerOfTwo(o.height);o=e?la.generateImage(o):o,e&&h&&console.warn(`The model texture 【${r.name?r.name:r.id}】 does not exist to the nth power of 2!`);}const _=l.getTexture({texUrl:r.uri,name:a,context:i,image:o,pixelFormat:r.mimeType&&-1!==r.mimeType.indexOf("jpeg")?e.WebGLConstants.RGB:e.WebGLConstants.RGBA,useMipmap:s});_.bind(n.magFilter,n.wrapS),t._texture=_;}}(t,this.context,this.useMipmap),t}_resolveSampler(e,t){e.id=e.id||`sampler-${t}`,e.parameters={};for(const t in e){const i=this._enumSamplerParameter(t);void 0!==i&&(e.parameters[i]=e[t]);}return e}_enumSamplerParameter(e){return wa[e]}_resolveImage(e,t){e.id=e.id||`image-${t}`,void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView));const i=this.images[t];return i&&(e.image=i),e}_resolveBufferView(e,t){e.id=e.id||`bufferView-${t}`;const i=e.buffer;e.buffer=this.buffers[i];let s=this.buffers[i].byteOffset||0;return "byteOffset"in e&&(s+=e.byteOffset),e.data=new Uint8Array(this.buffers[i].arrayBuffer.slice(s,s+e.byteLength)),e}_resolveCamera(e,t){return e.id=e.id||`camera-${t}`,e}}function Ea(e){if(null===e||"object"!=typeof e)return e;if(e.buffer)return e.buffer.slice();const t=new e.constructor;for(const i in e)if(e.hasOwnProperty(i)){let s=e[i];s=Ea(s),t[i]=s;}return t}function Ma(e,t){return (new Aa).postProcess(e,t)}const Pa=1735152710,Ra=!0;function Ba(e,t,i,s){const r=new Uint8Array(t.buffer.slice(i,i+s)),n=new TextDecoder("utf8").decode(r);return e.json=JSON.parse(n),Pi(s,4)}function Ia(e,t,i,s){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:i,byteLength:s,arrayBuffer:t.buffer}),Pi(s,4)}const Da={UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126,HALF_FLOAT_OES:36193,UNSIGNED_INT_24_8:34042,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635},Oa={ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,RGB_DXT1:33776,RGBA_DXT1:33777,RGBA_DXT3:33778,RGBA_DXT5:33779,RGB_PVRTC_4BPPV1:35840,RGB_PVRTC_2BPPV1:35841,RGBA_PVRTC_4BPPV1:35842,RGBA_PVRTC_2BPPV1:35843,RGB_ETC1:36196,isCompressedFormat(e){let t;return t=Array.isArray(e)&&e.length>0?e[0].format:e.format||"",t===Oa.RGB_DXT1||t===Oa.RGBA_DXT1||t===Oa.RGBA_DXT3||t===Oa.RGBA_DXT5||t===Oa.RGB_PVRTC_4BPPV1||t===Oa.RGB_PVRTC_2BPPV1||t===Oa.RGBA_PVRTC_4BPPV1||t===Oa.RGBA_PVRTC_2BPPV1||t===Oa.RGB_ETC1},isDXTFormat:e=>e===Oa.RGB_DXT1||e===Oa.RGBA_DXT1||e===Oa.RGBA_DXT3||e===Oa.RGBA_DXT5,isPVRTCFormat:e=>e===Oa.RGB_PVRTC_4BPPV1||e===Oa.RGB_PVRTC_2BPPV1||e===Oa.RGBA_PVRTC_4BPPV1||e===Oa.RGBA_PVRTC_2BPPV1,isETC1Format:e=>e===Oa.RGB_ETC1,compressedTextureSizeInBytes(e,t,i){switch(e){case Oa.RGB_DXT1:case Oa.RGBA_DXT1:case Oa.RGB_ETC1:return Math.floor((t+3)/4)*Math.floor((i+3)/4)*8;case Oa.RGBA_DXT3:case Oa.RGBA_DXT5:return Math.floor((t+3)/4)*Math.floor((i+3)/4)*16;case Oa.RGB_PVRTC_4BPPV1:case Oa.RGBA_PVRTC_4BPPV1:return Math.floor((Math.max(t,8)*Math.max(i,8)*4+7)/8);case Oa.RGB_PVRTC_2BPPV1:case Oa.RGBA_PVRTC_2BPPV1:return Math.floor((Math.max(t,16)*Math.max(i,8)*2+7)/8);default:return 0}},componentsLength(e){switch(e){case Oa.RGB:return 3;case Oa.RGBA:return 4;case Oa.LUMINANCE_ALPHA:return 2;default:return 1}},textureSizeInBytes(e,t,i,s){let r=Oa.componentsLength(e);return Oa.isPacked(t)&&(r=1),r*Oa.sizeInBytes(t)*i*s},sizeInBytes(e){switch(e){case Da.UNSIGNED_BYTE:return 1;case Da.UNSIGNED_SHORT:case Da.UNSIGNED_SHORT_4_4_4_4:case Da.UNSIGNED_SHORT_5_5_5_1:case Da.UNSIGNED_SHORT_5_6_5:case Da.HALF_FLOAT:return 2;case Da.UNSIGNED_INT:case Da.FLOAT:case Da.UNSIGNED_INT_24_8:return 4}},isPacked:e=>e===Da.UNSIGNED_INT_24_8||e===Da.UNSIGNED_SHORT_4_4_4_4||e===Da.UNSIGNED_SHORT_5_5_5_1||e===Da.UNSIGNED_SHORT_5_6_5};function La(e){let t="",i=e.url;return e.baseUrl&&-1!==e.baseUrl.indexOf("?")&&(t=e.baseUrl.split("?")[1],t.length>0&&(t=-1===e.url.indexOf("?")?`?${t}`:`&${t}`),i=e.url+t),i}function Va(e){var t=new RegExp;return t.compile("^[A-Za-z]+://[A-Za-z0-9-_]+\\.[A-Za-z0-9-_%&?/.=]+$"),!!t.test(e)}const Na=new Map;async function Fa(e,t,i,s,r){const{fetch:n,_parse:o}=r;let a,l;if(t.uri&&function(e){const t=e.substring(0,2),i=e.substring(0,1);return !!/^http[s]?:\/\/([\w\-\.]+)+[\w-]*([\w\-\.\/\?%&=]+)?$/gi.test(e)||"./"===t||"/"===i}(t.uri)){let h=jn(t.uri,s);Va(h)&&(h=La({baseUrl:s.url,url:h}));const _=h.lastIndexOf("/")+1;l=h.substring(_);const c=await n(h,s);a=c instanceof ArrayBuffer?c:await c.arrayBuffer(),Number.isFinite(t.bufferView)&&(a=Cr(e.json,e.buffers,t.bufferView)),sr(a,"glTF image has no data");const d=t.uri.split("."),u=d[d.length-1];if("ktx2"==u||"ktx"==u||"crn"==u||"basis"==u){let t;switch("image/"+u){case"image/ktx":t=await o(a,Nn,{},r);const{ktxformat:i,ktxwidth:s,ktxheight:n}=t[0];e.textureByteSize+=Oa.compressedTextureSizeInBytes(i,s,n);break;case"image/crn":t=await o(a,zn,{worker:!0},r),e.textureByteSize+=t[0].data.byteLength;break;case"image/basis":case"image/ktx2":En.options.basis.format=Sn(En.options,!0),t=await o(a,En,r),e.textureByteSize+=t[0].data.byteLength;break;default:t=await o(a,tr,{},r);const{width:l,height:h}=t;e.textureByteSize+=Oa.textureSizeInBytes(6408,5121,l,h);}e.images[i]=t;}else {const t=await o(a,tr,{},r);if(Na.has(l)){const s=Na.get(l),r={name:"",imageParsed:null,gltf:null,index:-1};s[0].imageParsed?(r.name=l,r.gltf=e,r.index=i,r.imageParsed=s[0].imageParsed,r.gltf.images[r.index]=s[0].imageParsed,s.push(r)):(r.name=l,r.gltf=e,r.index=i,r.imageParsed=t,r.gltf.images[r.index]=t,s.push(r));}else {const s={name:"",imageParsed:null,gltf:null,index:-1};s.name=l,s.gltf=e,s.index=i;const r=[];r.push(s),Na.set(l,r),Na.get(l).forEach((e=>{e.imageParsed=t,e.gltf.images[e.index]=t;}));}}}else {if(t.uri){let e=jn(t.uri,s);Va(e)&&(e=La({baseUrl:s.url,url:e}));const i=await n(e,s);a=i instanceof ArrayBuffer?i:await i.arrayBuffer();}let l;switch(Number.isFinite(t.bufferView)&&(a=Cr(e.json,e.buffers,t.bufferView)),sr(a,"glTF image has no data"),t.mimeType){case"image/ktx":l=await o(a,Nn,{},r);const{ktxformat:t,ktxwidth:i,ktxheight:s}=l[0];e.textureByteSize+=Oa.compressedTextureSizeInBytes(t,i,s);break;case"image/crn":l=await o(a,zn,{worker:!0},r),e.textureByteSize+=l[0].data.byteLength;break;case"image/basis":case"image/ktx2":En.options.basis.format=Sn(En.options,!0),l=await o(a,En,r),e.textureByteSize+=l[0].data.byteLength;break;default:l=await o(a,tr,{},r);const{width:n,height:h}=l;e.textureByteSize+=Oa.textureSizeInBytes(6408,5121,n,h);}e.images[i]=l;}}const Ga={name:"glTF",id:"gltf",module:"gltf",version:Wr,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:async function(t,i={},s){(i={...Ga.options,...i}).gltf={...Ga.options.gltf,...i.gltf},function(e){"fetchImages"in e&&(e.gltf.loadImages=e.fetchImages),"createImages"in e&&(e.gltf.loadImages=e.createImages),"fetchLinkedResources"in e&&(e.gltf.fetchBuffers=e.fetchLinkedResources),"decompress"in e&&(e.gltf.decompressMeshes=e.decompress),"decompress"in e.gltf&&(e.gltf.decompressMeshes=e.gltf.decompress),"postProcess"in e&&(e.gltf.postProcess=e.postProcess);}(i);const{byteOffset:r=0}=i;let n=e.decodeModel(t),o={textureByteSize:0};const a=await async function(t,i,s=0,r,n){if(function(e,t,i,s){if(s.uri&&(e.baseUri=s.uri),t instanceof ArrayBuffer&&!function(e,t=0,i={}){const s=new DataView(e),{magic:r=Pa}=i,n=s.getUint32(t,!1);return n===r||n===Pa}(t,i,s)&&(t=(new TextDecoder).decode(t)),"string"==typeof t)e.json=function(e){try{return JSON.parse(e)}catch(t){throw new Error(`Failed to parse JSON from data starting with "${function(e,t=5){return "string"==typeof e?e.slice(0,t):ArrayBuffer.isView(e)?Ai(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?Ai(e,0,t):""}(e)}"`)}}(t);else if(t instanceof ArrayBuffer){const r={};i=function(e,t,i=0,s={}){const r=new DataView(t);e.type=function(e,t=0){return `${String.fromCharCode(e.getUint8(t+0))}${String.fromCharCode(e.getUint8(t+1))}${String.fromCharCode(e.getUint8(t+2))}${String.fromCharCode(e.getUint8(t+3))}`}(r,i+0),e.version=r.getUint32(i+4,Ra);const n=r.getUint32(i+8,Ra);switch(e.header={byteOffset:i,byteLength:n,hasBinChunk:!1},e.json={},e.binChunks=[],i+=12,e.version){case 1:return function(e,t,i){jt(e.header.byteLength>20);const s=t.getUint32(i+0,Ra),r=t.getUint32(i+4,Ra);return i+=8,jt(0===r),Ba(e,t,i,s),(i+=s)+Ia(e,t,i,e.header.byteLength)}(e,r,i);case 2:return function(e,t,i,s){return jt(e.header.byteLength>20),function(e,t,i,s){for(;i+8<=e.header.byteLength;){const r=t.getUint32(i+0,Ra),n=t.getUint32(i+4,Ra);switch(i+=8,n){case 1313821514:Ba(e,t,i,r);break;case 5130562:Ia(e,t,i,r);break;case 0:s.glb.strict||Ba(e,t,i,r);break;case 1:s.glb.strict||Ia(e,t,i,r);}i+=Pi(r,4);}}(e,t,i,{}),i+e.header.byteLength}(e,r,i);default:throw new Error(`Invalid GLB version ${e.version}. Only supports v1 and v2.`)}}(r,t,i,s),sr("glTF"===r.type,`Invalid GLB magic string ${r.type}`),e._glb=r,e.json=r.json;}else sr(!1,"GLTF: must be ArrayBuffer or string");if(e.buffers=new Array((e.json.buffers||[]).length).fill(null),e._glb&&e._glb.header.hasBinChunk){const{binChunks:t}=e._glb;e.buffers[0]={arrayBuffer:t[0].arrayBuffer,byteOffset:t[0].byteOffset,byteLength:t[0].byteLength};}e.images=new Array((e.json.images||[]).length).fill({});}(t,i,s,r),"1.0"===t.json?.asset?.version){const e=n.url;throw new Error(`The【${e.slice(e.lastIndexOf("/")+1)}】 version is ${t.json.asset.version}, minemap is not supported!`)}!function(e,t={}){(new Oo).normalize(e,t);}(t,{normalize:r.gltf.normalize}),function(e,t={},i){const s=Ro.filter((e=>Bo(e.name,t)));for(const r of s)r.preprocess?.(e,t,i);}(t,r,n);const o=[];if(r.gltf.loadBuffers&&t.json.buffers&&await async function(e,t,i){for(let s=0;s<e.json.buffers.length;++s){const r=e.json.buffers[s];if(r.uri){const{fetch:n}=i;sr(n);let o=jn(r.uri,t);Va(o)&&(o=La({baseUrl:t.url,url:o}));const a=await n(o,t);let l;l=a instanceof ArrayBuffer?a:await a.arrayBuffer(),e.buffers[s]={arrayBuffer:l,byteOffset:0,byteLength:l.byteLength},delete r.uri;}}}(t,r,n),r.gltf.loadImages){const e=async function(e,t,i){const s=e.json.images||[],r=[];for(let n=0;n<s.length;++n)r.push(Fa(e,s[n],n,t,i));const n=await Promise.all(r);for(let t=0;t<e.images.length;t++)if(!Array.isArray(e.images[t])&&void 0===e.images[t].width){const i=[...Na][t];i&&(e.images[t]=i[1][0].imageParsed);}return n}(t,r,n);o.push(e);}const a={...r};delete a.source,delete a.context,delete a.batchTable,delete a.flowOptions;const l=async function(e,t={},i){const s=Ro.filter((e=>Bo(e.name,t)));for(const r of s)await(r.decode?.(e,t,i));}(t,a,n);if(o.push(l),await Promise.all(o),r.instances){let i;if(t.json.nodes[0].matrix)i=new e.Matrix4(t.json.nodes[0].matrix);else {const s=new e.Quaternion,r=new e.Vector3(1,1,1),n=new e.Vector3;t.json.nodes[0].rotation&&(s.set(t.json.nodes[0].rotation[0],t.json.nodes[0].rotation[1],t.json.nodes[0].rotation[2],t.json.nodes[0].rotation[3]),delete t.json.nodes[0].rotation),t.json.nodes[0].scale&&(r.copy(t.json.nodes[0].scale),delete t.json.nodes[0].scale),t.json.nodes[0].translation&&(n.copy(t.json.nodes[0].translation),delete t.json.nodes[0].translation),i=function(t,i,s,r){r||(r=new e.Matrix4);const n=s.x,o=s.y,a=s.z,l=i.x*i.x,h=i.x*i.y,_=i.x*i.z,c=i.x*i.w,d=i.y*i.y,u=i.y*i.z,m=i.y*i.w,p=i.z*i.z,f=i.z*i.w,g=i.w*i.w,y=2*(h-f),T=2*(_+m),C=2*(h+f),x=-l+d-p+g,b=2*(u-c),v=2*(_-m),w=2*(u+c),S=-l-d+p+g;return r[0]=(l-d-p+g)*n,r[1]=C*n,r[2]=v*n,r[3]=0,r[4]=y*o,r[5]=x*o,r[6]=w*o,r[7]=0,r[8]=T*a,r[9]=b*a,r[10]=S*a,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,r}(n,s,r,new e.Matrix4),t.json.nodes[0].matrix=i;}for(const t of r.instances){const s=t.modelMatrix.clone(),r=(new e.Matrix4).rotateX(Math.PI/2),n=s.multiplyRight(r);t.modelMatrix=n.multiplyRight(i);}r.modelInstanceCollection=new it({instances:r.instances,type:"3d-tile"});}return r.gltf.postProcess?Ma(t,r):t}(o,n,r,i,s);n=null;for(let e=0;a.bufferViews&&e<a.bufferViews.length;e++)a.bufferViews[e].data=null,a.bufferViews[e].buffer=null;let l=0;for(let e=0;a.images&&e<a.images.length;e++)a.images[e].image&&(l+=(a.images[e].image.width||0)*(a.images[e].image.height||0)),a.images[e].bufferView=null,a.images[e].image=null;if(o._glb&&o._glb.binChunks&&o._glb.binChunks.length>0){for(let e=0;e<o._glb.binChunks.length;e++)o._glb.binChunks[e].arrayBuffer=null;o._glb.binChunks=null;}if(o.buffers&&o.buffers.length>0){for(let e=0;e<o.buffers.length;e++)o.buffers[e].arrayBuffer=null;o.buffers=null;}return a.imagesSize=l,o._glb=null,o=null,a},options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};class ka{constructor(){}static updateAnimation(t){const{nodes:i,animations:s,skins:r}=t.gltfJson,n={u_has_skinning:!1};if(e.defined(s))for(let t=0;t<s.length;t++){const i=s[t];if(i.isRunning){i.update(Date.now());const t=i.getMorphAnimation();t&&(n.u_morphTargetInfluences=e.Vector2.unpack(1===t.value.length?[t.value[0],0]:t.value.slice(0,2)));}}if(e.defined(r)&&r.length>0){const t=[];i.forEach((i=>{i.update(),e.defined(i.skeleton)&&t.push(i.skeleton.jointMatrix);})),n.u_has_skinning=!0,n.u_jointMatrixs=t;}return n}}class Ua extends Wt{constructor(t){super(),this.isSceneModel=!0;let{position:i,scale:s,rotation:r,quaternion:n,matrix:o}=t;if(this._options=t,this.opaqueList=[],this.translucentList=[],this.animationPropertyCollection=new e.AnimationPropertyCollection,this.id=e.defaultValue(t.id,void 0),this.modelFolder=e.defaultValue(t.modelFolder,void 0),this._data=e.defaultValue(t.data,void 0),this.lightingModel=e.defaultValue(t.lightingModel,e.LightingModelType.NONE),this.classificationType=e.defaultValue(t.classificationType,e.ClassificationType.NONE),this._minimumPixelSize=e.defaultValue(t.minimumPixelSize,0),this._computedScale=1,this.type="3d-model",e.defined(t.positions)&&t.positions.length>0&&(this.type="3d-model-instance",this.modelInstanceCollection=new it({instances:it.generateInstances({positions:t.positions,scales:t.scales,rotations:t.rotations,shows:t.shows,colors:t.colors,instanceNames:t.instanceNames}),type:this.type,rootId:this.id}),o=new e.Matrix4),this.properties=e.defaultValue(t.properties,void 0),this._map=e.defaultValue(t.map,void 0),this._visibility=e.defaultValue(t.visibility,"visible"),this.loadedCallback=e.defaultValue(t.loaded,void 0),this.useMipmap=e.defaultValue(t.useMipmap,!1),this.clippingPlanes=e.defaultValue(t.clippingPlanes,void 0),this._allowPick=e.defaultValue(t.allowPick,!0),this.backCulling=e.defaultValue(t.backCulling,void 0),this.minzoom=e.defaultValue(t.minzoom,0),this.maxzoom=t.maxzoom,this._activeAnimation=e.defaultValue(t.activeAnimation,!0),this._currentAnimations=[],this._gltfJson=void 0,this._boundingVolume=void 0,o)this.applyMatrix(o);else {if(!i)throw new e.DeveloperError("position must be provided or matrix be provided");{if(!(Array.isArray(i)||i instanceof e.Vector3))throw new e.DeveloperError("position must be an array or Vector3!");let t;i instanceof e.Vector3?t=e.Vector3.unpack(i):(t=new e.Vector3(...i),console.warn("请规范position的类型! 使用minemap.Math.Vector3替换!"));const o=e.Transforms.cartographicToFixedFrame(t);if(r){if(!Array.isArray(r))throw new e.DeveloperError("rotation must be an array");this._rotation=r;const t=new e.Matrix4;t.rotateX(r[0]*e.CONSTS.TRANSFORM.DEG_TO_RAD),t.rotateY(r[1]*e.CONSTS.TRANSFORM.DEG_TO_RAD),t.rotateZ(r[2]*e.CONSTS.TRANSFORM.DEG_TO_RAD),o.multiplyRight(t);}else if(n){if(!(n instanceof e.Quaternion))throw new e.DeveloperError("quaternion must be an Quaternion instance");const t=new e.Matrix4;t.fromQuaternion(n),o.multiplyRight(t);}if(s){if(!(Array.isArray(s)||s instanceof e.Vector3))throw new e.DeveloperError("scale must be an array or Vector3!");const t=new e.Matrix4;t.scale(s),o.multiplyRight(t);}this.applyMatrix(o);}}this._updateOriginalRotationScaleMatrix();}get activeAnimation(){return this._activeAnimation}set activeAnimation(t){e.isBoolean(t)&&(this._activeAnimation=t);}get allowPick(){return this._allowPick}set allowPick(e){this._allowPick=e;let t=[];t=t.concat(this.translucentList,this.opaqueList);for(let i=0;i<t.length;i++)t[i].allowPick=e,e&&!t[i]._owner&&(t[i]._owner=t[i]._geometry,t[i].update(this._map.painter,this._map.painter.frameState));}get animationsName(){let t;if(e.defined(this._gltfJson)&&this._gltfJson.animations){t=[];for(let e=0;e<this._gltfJson.animations.length;e++)t.push(this._gltfJson.animations[e].name);}return t}get boundingVolume(){return this._boundingVolume}get currentAnimations(){return this._currentAnimations}set currentAnimations(t){if(!(t instanceof Array))return;const i=this;i._currentAnimations.length=0;const s=this._gltfJson.animations;e.defined(s)&&s.length>0&&s.forEach((e=>{for(let s=0;s<t.length;s++){if(e.name===t[s]){e.play(),i._currentAnimations.push(t[s]);break}e.stop();}}));}get rotation(){return this._rotation}set rotation(t){const i=e.Transforms.cartesian3ToCartographic(new e.Vector3(...this.position)),s=e.Transforms.cartographicToFixedFrame(new e.Vector3(...i)),r=new e.Matrix4;r.rotateX(t[0]*e.CONSTS.TRANSFORM.DEG_TO_RAD),r.rotateY(t[1]*e.CONSTS.TRANSFORM.DEG_TO_RAD),r.rotateZ(t[2]*e.CONSTS.TRANSFORM.DEG_TO_RAD),s.multiplyRight(r),this.quaternion=(new e.Quaternion).fromRotationMatrix4(s),this._rotation=t,this.updateMatrixWorld(!0),this._updateOriginalRotationScaleMatrix();}get scale(){return this._scale}set scale(t){if(t instanceof Array&&3===t.length)t=new e.Vector3(...t);else {if(t instanceof Array&&3!==t.length)return void console.error("The current value's length is not 3! Please check it!");if(!(t instanceof Array||t instanceof e.Vector3))return void console.error("The current value is unKnown type! Please use minemap.Math.Vector3 instaded!")}this.unmodified=!1,this._scale=t,this._computedScale=1,this.updateMatrixWorld(!0),this._getBoundingVolume(),this._originRadius=this._boundingVolume.getBoundingSphere().radius,this._updateOriginalRotationScaleMatrix();}get visibility(){return this._visibility}set visibility(e){for(let t=0;t<this.opaqueList.length;t++)this.opaqueList[t].show="visible"===e;for(let t=0;t<this.translucentList.length;t++)this.translucentList[t].show="visible"===e;this._visibility=e;}getBounds(){let t,i=this._boundingVolume;if(!e.defined(i))return;if(i instanceof We)i=i.boundingVolume;else if(i instanceof e.BoundingSphere){t=i.getBoundingMaximum();const s=e.Transforms.cartesian3ToCartographic(t.boundingMaxValue),r=e.Transforms.cartesian3ToCartographic(t.boundingMinValue);return new e.LngLatBounds([r[0],r[1]],[s[0],s[1]])}const s=e.Rectangle.fromVector3Array(i.computeCorners()),r=e.CONSTS.CesiumMath.toDegrees(s.west),n=e.CONSTS.CesiumMath.toDegrees(s.south),o=e.CONSTS.CesiumMath.toDegrees(s.east),a=e.CONSTS.CesiumMath.toDegrees(s.north);return new e.LngLatBounds([r,n],[o,a])}addGlTF(t){this.add(...t.scene.nodes),this.updateMatrixWorld(!0),this._gltfJson=t,e.defined(this._gltfJson.animations)&&this._gltfJson.animations.length>0&&(this._currentAnimations.length=0,this._currentAnimations[0]=this._gltfJson.animations[0].name);const i=e.getPrimitives(this._gltfJson);e.defined(this.modelInstanceCollection)&&(this.modelInstanceCollection._primitivesInstance=i,this.modelInstanceCollection.dirty=!0),this.separatePrimitives(i);}async load(){const e=await this._loadModel();this.addGlTF(e),this._getBoundingVolume(),this._finishLoad();}_finishLoad(){this._setInstancePropertiesState="ready",this.state="loaded",this._map.needRepaint=!0,this.loadedCallback&&this.loadedCallback(this);}async _loadModel(){let e;return e="string"==typeof this._data?await this._processStringGltf():await this._processBinaryGltf(),e}separatePrimitives(t){const i=function(t){const i={};return e.checkIsVectorShadowVolumeDataType(t.classificationType)&&(i.SHADOW_VOLUME=!0),t.lightingModel===e.LightingModelType.PBR?(i.USE_PBR=!0,i.USE_IBL=!0):(i.USE_PBR=!1,i.USE_IBL=!1),i.PHONG_LIGHT=t?.lightingModel===e.LightingModelType.PHONG,i}(this);for(let s=0;s<t.length;s++){if(this.activeAnimation){if(delete i.USE_MORPHTARGETS,delete i.JOINT_MATRIX_CNT,t[s].rootId=this.id,t[s]._material.backCulling=this.backCulling,e.defined(t[s]._material)&&t[s]._material.hasMorph){i.USE_MORPHTARGETS=!0;const e=this;t[s]._material._uniforms.set("u_morphTargetInfluences",(()=>e.animationResult.u_morphTargetInfluences));}const r=t[s].skinsIndex;if(e.defined(r)&&(e.defined(this._gltfJson)&&e.defined(this._gltfJson.skins)&&this._gltfJson.skins.length>0&&(i.JOINT_MATRIX_CNT=this._gltfJson.skins[r].joints.length),e.defined(this._gltfJson)&&e.defined(this._gltfJson.skins)&&this._gltfJson.skins.length>0)){const e=this;t[s]._material._uniforms.set("u_jointMatrix",(()=>{const t=e.animationResult,i=[];for(let e=0;t?.u_jointMatrixs&&e<t.u_jointMatrixs[r].length;e++)i.push(t.u_jointMatrixs[r][e]);return i}));}t[s]._material.defines=i;}t[s].modelInstanceCollection=this.modelInstanceCollection,(this.modelInstanceCollection||this.animationPropertyCollection?.size>0)&&(t[s].modelInstanceType=this.type),t[s].show="visible"===this._visibility,t[s]._material.isTranslucent?this.translucentList.push(t[s]):this.opaqueList.push(t[s]);}}updateAnimation(){const e=this.animationPropertyCollection.getAll();1===e.length?e[0].updateAnimation(this):console.warn(`id为"${this.id}"的gltf轨迹动画只能有1个`);}update(t){if("loaded"===this.state){e.defined(this._boundingVolume)||this._getBoundingVolume(),e.defined(this.modelInstanceCollection)&&this.modelInstanceCollection._parentBoundingVolumeNeedUpdate&&(this._getBoundingVolume(),this.modelInstanceCollection._parentBoundingVolumeNeedUpdate=!1),this.zoomControl(),this.activeAnimation&&(this.animationResult=ka.updateAnimation({gltfJson:this._gltfJson}));for(let e=0;e<this.opaqueList.length;e++)this.activeAnimation&&(this._gltfJson?.animations?.length||this._gltfJson?.skins?.length)&&this.opaqueList[e].computeBounding(),this.opaqueList[e]._material.clippingPlanes=this.clippingPlanes;for(let e=0;e<this.translucentList.length;e++)this.activeAnimation&&(this._gltfJson?.animations?.length||this._gltfJson?.skins?.length)&&this.translucentList[e].computeBounding(),this.translucentList[e]._material.clippingPlanes=this.clippingPlanes;if(e.defined(this.modelInstanceCollection)){this.modelInstanceCollection.update({context:t.framebuffer.context});for(let e=0;e<this.opaqueList.length;e++){const t=this.opaqueList[e]._geometry;t._segmentVector.segments[0].instancesCount!==this.modelInstanceCollection._instances.size&&(t._segmentVector.segments[0].instancesCount=this.modelInstanceCollection._instances.size,t.dynamicLayoutBuffer1=this.modelInstanceCollection?.instanceBuffer);}for(let e=0;e<this.translucentList.length;e++){const t=this.translucentList[e]._geometry;t._segmentVector.segments[0].instancesCount!==this.modelInstanceCollection._instances.size&&(t._segmentVector.segments[0].instancesCount=this.modelInstanceCollection._instances.size,t.dynamicLayoutBuffer1=this.modelInstanceCollection?.instanceBuffer);}}this._minimumPixelSize>0&&(function(e,t){const i=e._originRadius;let s=1;if(0!==e._minimumPixelSize&&i>0){const r=e._map.painter.context,n=Math.max(r.drawingBufferWidth,r.drawingBufferHeight),o=function(e,t){Ha.center=e.position,Ha.radius=e._originRadius;const i=e._map.painter.context.gl;return t.camera.getPixelSize(Ha,i.drawingBufferWidth,i.drawingBufferHeight)}(e,t);Math.min(1/o*(2*i),n)<e._minimumPixelSize&&(s=e._minimumPixelSize*o/(2*i));}e._computedScale=s;}(this,t),this.updateMatrixWorld(!0),this._getBoundingVolume(),this._updateOriginalRotationScaleMatrix());}}setInstanceProperties(){this.modelInstanceCollection.update({context:this._map.painter.context}),Ua.updatePrimitiveProperties(this.translucentList,this),Ua.updatePrimitiveProperties(this.opaqueList,this);}zoomControl(){let t=[];t=t.concat(this.translucentList,this.opaqueList);const i=t.filter((e=>!0===e.show));if(0!==i.length&&i.length!==t.length)return;const s=e.isHiddenByMapZoom(this,this._map.getZoom());this.controlDisplay(t,!s);}controlDisplay(e,t){for(let i=0;i<e.length;i++)e[i].show=t;}loaded(){return "loaded"===this.state&&e.defined(this._boundingVolume)}_getBoundingVolume(){let t;if(e.defined(this.modelInstanceCollection))t=this.modelInstanceCollection.boundingVolume;else {let i=[];const s=[];i=i.concat(this.opaqueList,this.translucentList);for(let e=0;e<i.length;e++){const t=i[e].boundingVolume.computeCorners();for(let e=0;e<t.length;e++)s.push(t[e]);}t=e.OrientedBoundingBox.fromPoints(s);}1===this._computedScale&&(this._originRadius=t.getBoundingSphere().radius),this._boundingVolume=t;}async _processBinaryGltf(){if(this._data.byteLength)return await Rs(this._data,Ga,{gltf:{postProcess:!0,loadImages:!0},modelInstanceCollection:this.modelInstanceCollection,clippingPlanes:this.clippingPlanes,allowPick:this.allowPick},null);let e;if(e=this._data.buffers[0].data?function(e){return e.map((e=>({byteLength:e.byteLength,arrayBuffer:e.data[0].buffer,name:e.name,byteOffset:0})))}(this._data.buffers):function(e){return e.map((e=>{const t=new Uint8Array((i=e.uri,window.atob(i.substring(i.indexOf(",")+1)).split("").map((e=>e.charCodeAt(0)))));var i;return {byteLength:t.byteLength,arrayBuffer:t.buffer,name:e.name||"name-undefined",byteOffset:0}}))}(this._data.buffers),this._data.buffers=e,!(this._data.images&&this._data.images.length>0))return Ma({json:this._data,buffers:this._data.buffers,baseUri:this.modelFolder},{lightingModel:this.lightingModel});!function(e,t,i){const s=[];for(let i=0;i<e.length;i++){const r=jn(e[i].uri,t);s.push(Bs(r,tr,{},0,null));}Promise.all(s).then((e=>{i(e);}));}(this._data.images,{modelFolder:this.modelFolder},(e=>Ma({json:this._data,buffers:this._data.buffers,images:e,baseUri:this.modelFolder},{lightingModel:this.lightingModel})));}async _processStringGltf(){const{_transformRequest:t}=this._map,i=vt(this._data),s={request:t(e.exported.resolveURL(i),e.ResourceType.Source)},r=await Bs(s.request.url,Ga,{gltf:{postProcess:!0,loadImages:!0},context:this._map.painter.context,modelInstanceCollection:this.modelInstanceCollection,useMipmap:this.useMipmap,clippingPlanes:this.clippingPlanes,allowPick:this.allowPick,dispatcher:this._map.style.dispatcher,transformRequest:t,lightingModel:this.lightingModel},0,vt(this.modelFolder));if(r){if(this._removed||r&&r.abandoned)return;this._loaded=!0,this.state="parsing",this.result=r;for(let e=0;r.bufferViews&&e<r.bufferViews.length;e++)r.bufferViews[e].data=null,r.bufferViews[e].buffer=null;for(let e=0;r.images&&e<r.images.length;e++)r.images[e].bufferView=null,r.images[e].image=null;return r}return null}_updateOriginalRotationScaleMatrix(){if(this.animationLock)return;const t=this.matrix.clone(),i=new e.Vector3(this.position),s=e.Transforms.eastNorthUpToFixedFrame(i).invert();this.originalRotationScaleMatrix=t.multiplyLeft(s);}destroy(){if("loaded"!==this.state)return this._destroyCount=0,this._destroyTimeout&&clearTimeout(this._destroyTimeout),void(this._destroyTimeout=setTimeout((()=>{this._destroyCount++,this._destroyCount<10?this.destroy():(console.error("当前的scene model对象删除失败，已经重试了10次！原因是state一直未loaded，请检查数据。"),clearTimeout(this._destroyTimeout));}),1e4));if(this.animationPropertyCollection&&this.animationPropertyCollection.size>0)throw new Error(`sceneComponent "${this.id}" cannot be removed while animation is using it`);for(let e=0;e<this.opaqueList.length;e++)this.opaqueList[e].destroy();for(let e=0;e<this.translucentList.length;e++)this.translucentList[e].destroy();for(const e in this)Object.hasOwnProperty.call(this,e)&&(this[e]=null);}static updatePrimitiveProperties(e,t){if(0!==e.length)for(const i of e){const e=i._geometry,s=i._material,r=e._segmentVector.segments[0];r.isInstance=!0,r.instancesCount=t.modelInstanceCollection?._instances?.size||0,e.dynamicLayoutBuffer1=t.modelInstanceCollection?.instanceBuffer,s.isInstance=!0,s.defines.INSTANCE_MATRIX=!0,i.modelInstanceCollection=t.modelInstanceCollection,i.modelInstanceType=t.type;}}}const Ha=new e.BoundingSphere;class za extends e.Material{constructor(t){if(super(t),this.type="BillboardMaterial",this._image=t.image,this._flipY=e.defaultValue(t.flipY,!1),this._imageDirty=!!this._image,this._imageUrl=t.imageUrl,this._sizeattenuation=t.sizeattenuation,this._imageUrl&&this._getImage(this._imageUrl),this._texture=e.defaultValue(t.texture,null),this._position=t.position,this._scale=t.scale,this._center=e.defaultValue(t.center,new e.Vector2(0,0)),this._rotation=e.defaultValue(t.rotation,0),this._pixelResolution=e.defaultValue(t.pixelResolution,null),this._opacity=e.defaultValue(t.opacity,1),this._modelMatrix=void 0,this._scaleMatrix=void 0,this._pickColorDepthTest=e.defaultValue(t.pickColorDepthTest,void 0),t.color)if(t.color instanceof e.Vector4)this._color=e.defaultValue(t.color,new e.Vector4(1,.6,.3,1));else {const i=e.Color.parse(t.color);this._color=e.defaultValue(new e.Vector4(i.r,i.g,i.b,i.a),new e.Vector4(1,.6,.3,1));}this._uvScale=void 0,this._modelMatrixDirty=!0,this.defines={USE_BILLBOARDTEXTURE:null!=this._imageUrl||null!=this._image||null!=this._texture,SIZEATTENUATION:1==this._sizeattenuation,FIXED_PIXEL_SIZE:!!this._pixelResolution,BILLBOARD:!0},this.isTranslucent&&(this.renderState.depthMask=e.renderStateEnum.disableDepthMask);}set position(e){this._modelMatrixDirty=!0,this._position=e;}set scale(e){this._modelMatrixDirty=!0,this._scale=e;}set center(e){this._center=e;}set rotation(e){this._rotation=e;}set opacity(e){this._opacity=e;}get opacity(){return this._opacity}set image(e){this._imageDirty=!0,this._image=e;}set sizeattenuation(e){this._sizeattenuation=e,this.defines={SIZEATTENUATION:e};}set pixelResolution(e){if(e&&(!e.length||2!==e.length))throw new Error("公告板像素大小必须是长度为2的数组");this._pixelResolution=e,this.defines={FIXED_PIXEL_SIZE:!!this._pixelResolution},this._modelMatrixDirty=!0;}get pickColorDepthTest(){return this._pickColorDepthTest}set pickColorDepthTest(e){this._pickColorDepthTest=e;}update(e,t,i={}){super.update(e,t,i),this._modelMatrixDirty&&this._parse(),this._updateUniforms(t,e),this._imageDirty&&this._updateImageData(e.context);}_parse(){if(e.defined(this._position)){const t=e.Transforms.cartographicToFixedFrame(this._position);if(this._pixelResolution)this._modelMatrix=t;else {const i=(new e.Matrix4).makeScale(this._scale[0],this._scale[1],1);this._modelMatrix=t.multiplyRight(i),this._scaleMatrix=e.Matrix4.IDENTITY;}}else this._modelMatrix=void 0,this._scaleMatrix=(new e.Matrix4).makeScale(this._scale[0],this._scale[1],1);this._modelMatrixDirty=!1;}_updateUniforms(t,i){this.uniforms=new Map([["u_MvMatrix",()=>this._modelMatrix?t.camera.getViewMatrix().multiplyRight(this._modelMatrix):void 0],["u_center",()=>this._center],["u_rotation",()=>this._rotation],["u_BaseColorSampler",()=>{const t=e.defaultValue(this._texture,i.context.defaultTexture);return t.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),t}],["u_ProjectionMatrix",()=>t.camera.getProjectionMatrix()],["u_Color",()=>this._color],["u_InvertViewMatrix",()=>t.camera.getViewMatrix().invert()],["u_ScaleMatrix",()=>this._scaleMatrix],["u_UVScale",()=>this._uvScale],["u_Opacity",()=>this._opacity],["u_pixelResolution"]]),this._pixelResolution&&this._uniforms.set("u_PixelResolution",(()=>new e.Vector2(this._pixelResolution)));}async _getImage(t){const i=this;this._image=await new Promise(((s,r)=>{e.getImage({url:t,imageBitmapOptions:{premultiplyAlpha:"none"}},((e,t)=>{if(e)throw r(e),new Error(e);i._imageDirty=!0,s(t);}));}));}_updateImageData(t){this._imageDirty=!1,this._texture?(this._texture.upload(this._image),this._texture._hasSetSampler=!1):this._texture=new e.Texture({context:t,image:this._image,pixelFormat:e.WebGLConstants.RGBA,flipY:this._flipY});}serialize(){}destroy(){this.type=null,this.texture=null,this._scale=null,this._center=null,this._rotate=null,this._pixelResolution=null,this._modelMatrixDirty=!1,this._texture&&this._texture.destroy();}}const Wa=e.createLayout([{name:"a_POSITION",type:"Float32",components:3},{name:"a_TEXCOORD_0",type:"Float32",components:2}]);class ja extends e.Geometry{constructor(){super({}),this._vertexBuffer=void 0,this._indexBuffer=void 0,this._segmentVector=void 0,this.primitiveType=e.WebGLConstants.TRIANGLES,this._vertexArray=new e.StructArrayLayout5f20,this._indicesArray=new e.StructArrayLayout3ui6,this.vertices=[-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1],this.indices=[0,1,2,0,2,3],this._parse(),this.boundingSphere=null,this.boundingBox=null;}_parse(){for(let e=0;e<this.indices.length;e+=3)this._indicesArray.emplaceBack(this.indices[e],this.indices[e+1],this.indices[e+2]);for(let e=0;e<this.vertices.length;e+=5)this._vertexArray.emplaceBack(this.vertices[e],this.vertices[e+1],this.vertices[e+2],this.vertices[e+3],this.vertices[e+4]);}update(t){const i=t.painter.context;this._vertexBuffer&&this._indexBuffer&&this._segmentVector||(this._vertexBuffer=i.createVertexBuffer(this._vertexArray,Wa.members,!1),this._indexBuffer=i.createIndexBuffer(this._indicesArray,!1),this._segmentVector=e.SegmentVector.simpleSegment(0,0,4,2));}serialize(){}destroy(){super.destroy(),this._vertexBuffer=void 0,this._indexBuffer=void 0,this._segmentVector=void 0,this._vertexArray=void 0,this.indices=void 0;}}class Xa{constructor(e){this._map=e,this._animationCollection=new Map,this._billboardId=new Map;}get animations(){return this._animationCollection}getById(e){let t;return this.animations.has(e)&&(t=this.animations.get(e)),t}getByIndex(t){let i;const s=[...this.animations][t];return e.defined(s)&&(i=s[1]),i}load(t){let i;return i="string"==typeof t?new Promise((i=>{e.getJSON(St(t),((e,t)=>{i(t);}));})):t,i}add(t){const i=this.load(t),s=this;return Promise.resolve(i).then((t=>{if(e.defined(t))return s.process(t)})).catch((e=>{throw new Error(e)}))}contains(t){let i=!1;return e.defined(t)&&this.animations.has(t.id)&&(i=!0),i}remove(t){let i=!1;return e.defined(t)&&e.defined(t.id)&&this.animations.has(t.id)&&(i=this.removeById(t.id)),i}removeAll(){const e=this;this.animations.forEach(((t,i)=>{e.removeById(i);}));}removeById(t){let i=this.getById(t),s=!1;if(e.defined(i))this.animations.delete(t),i._root.animationPropertyCollection.removeAll(!0),"BillboardMaterial"===i._root._material?.type&&this._map.removePrimitive(i._root),e.defined(i._root.modelInstanceCollection)&&(i._root.modelInstanceCollection=void 0),e.defined(i._root.animationModelInstanceCollection)&&(i._root.animationModelInstanceCollection=void 0),i.actions.forEach((e=>{e.destroy();})),i._root.animationPropertyCollection=null,i._map=null,i._root=null,s=!0;else if(this._billboardId.has(t)){for(const s of this._billboardId.get(t))i=this.getById(s),e.defined(i)&&(this._map.removePrimitiveById(s),this.animations.delete(s),i._root.animationPropertyCollection.removeAll(!0),e.defined(i._root.animationModelInstanceCollection)&&(i._root.animationModelInstanceCollection=void 0),i.actions.forEach((e=>{e.destroy();})),i._root.animationPropertyCollection=null,i._map=null,i._root=null);s=!0;}return s}process(t){let i=[];if(e.defined(t.contents)&&t.contents.length>0)for(let e=0;e<t.contents.length;e++)i=i.concat(qa(this,t.contents[e]));else e.defined(t.id)&&e.defined(t.type)&&(i=i.concat(qa(this,t)));return i}serialize(){const t={document:"Animation",contents:[]},i=[];return this.animations.forEach(((t,s)=>{const r={};let n,o;r.id=s;const a=t.actions[0]._clip.tracks,l=e.defined(a)?t.actions[0]._clip.tracks[0].type:void 0;if(t._root instanceof e.Primitive)switch(l){case"trackingKeyframeTrack":case"positionKeyframeTrack":n="primitive";break;case"multiTrackingKeyframeTrack":case"multiPositionKeyframeTrack":n="primitiveInstance";}else if(t._root instanceof Ua)switch(l){case"trackingKeyframeTrack":case"positionKeyframeTrack":n="model";break;case"multiTrackingKeyframeTrack":case"multiPositionKeyframeTrack":n="modelInstance";}else t._root instanceof zt&&(n="extrusion");r.type=n;const h=[].concat(e.defined(l)?a[0].values:[]),c=[];if("modelInstance"===n||"primitiveInstance"===n)for(let t=0;t<h.length;t++){const i=[].concat(h[t]),s=[];for(let t=0;t<i.length;t++){let r=i[t].clone();r=e.Cartographic.fromVector3(r),r.x=e.toDegrees(r.x),r.y=e.toDegrees(r.y),s.push(r.x),s.push(r.y),s.push(r.z);}c.push(s);}else for(let t=0;t<h.length;t++){let i=h[t].clone();i=e.Cartographic.fromVector3(i),i.x=e.toDegrees(i.x),i.y=e.toDegrees(i.y),c.push(i.x),c.push(i.y),c.push(i.z);}c.length>0&&(r.positions=c);const d={},u=t.actions[0]._clip.startTime,m=t.actions[0]._clip.endTime,p=e.defined(a)?a[0].times:void 0;switch(d.start=u,d.end=m,e.defined(p)&&(d.steps=p),r.times=d,l){case"trackingKeyframeTrack":case"multiTrackingKeyframeTrack":o="ellipsoid";break;case"positionKeyframeTrack":case"multiPositionKeyframeTrack":o="none";break;default:o=void 0;}e.defined(o)&&(r.reference=o);let f=t.actions[0].loop;switch(f){case _.LOOP_REPEAT:f="repeat";break;case _.LOOP_ONCE:f="once";break;case _.LOOP_NONE:f="none";}if(r.loop=f,"multiPositionKeyframeTrack"===l){const e={};e.names=t.actions[0]._clip.tracks[0].primitiveNames;const i=[];for(let e=0;e<t.actions[0]._clip.tracks[0].colors.length;e++){const s=[];for(let i=0;i<t.actions[0]._clip.tracks[0].colors[e].length;i++){const r=t.actions[0]._clip.tracks[0].colors[e][i].toString().split(","),n=[];n.push(parseFloat(r[0])),n.push(parseFloat(r[1])),n.push(parseFloat(r[2])),n.push(parseFloat(r[3])),s.push(n);}i.push(s);}e.colors=i,r.material=e,r.rotations=t.actions[0]._clip.tracks[0]._angles;}i.push(r);})),t.contents=i,i.length>0?t:void 0}update(e){let t=!1;this.animations.forEach((i=>{i.update(e),(i?._play||i._actions.length>0&&i._actions[0].enabled)&&(t=!0);})),t&&this._updateAnimation();}_updateAnimation(){const t=this._map,i=t.trackingOptions;let s=!1,r=!1;const n=t.style.modelCollection;for(let o=0;o<n._orders.length;o++){const a=n.get(n._orders[o]);if("loaded"===a.state&&a.animationPropertyCollection&&a.animationPropertyCollection.size>0){if(a.updateAnimation(),e.defined(i)){if("3d-model-instance"===a.type){const e=a.modelInstanceCollection.length;for(let t=0;t<e;t++){const e=a.modelInstanceCollection.instances.get(t);i.trackingModel===e.instanceName&&(i.trackingMode==rt.LOCK?s=!0:i.trackingMode==rt.FOLLOW&&(r=!0));}}else "3d-model"===a.type&&i.trackingModel===a.id&&(i.trackingMode==rt.LOCK?s=!0:i.trackingMode==rt.FOLLOW&&(r=!0));s?(t.scrollZoom.disable(),t.dragRotate.disable(),t.dragPan.disable()):r?(t.scrollZoom.disable(),t.dragRotate.enable(),t.dragPan.disable()):(t.scrollZoom.enable(),t.dragRotate.enable(),t.dragPan.enable());}let n=!1;if(this.animations.size>0)for(const e of this.animations.values())e._actions.length>0&&e._actions[0].enabled&&(n=!0);n&&(t.scrollZoom.enable(),t.dragRotate.enable(),t.dragPan.enable());}}const o=t.style.primitiveCollection,a=t.painter.frameState;for(let t=0;t<o._orders.length;t++){const i=o.get(o._orders[t]);e.defined(i.updateAnimation)&&i.updateAnimation(a);}}}function qa(t,i){let s=[];for(let r=0;r<Xa.updaters.length;r++){const n=Xa.updaters[r](t,i);e.defined(n)&&(n.onPlay=i.onPlay,n.onPlaying=i.onPlaying,n.onPause=i.onPause,n.onStop=i.onStop,n.onReset=i.onReset,n.speed=i.speed||1,n.autoStop=i.autoStop||!1,n.callback=i.callback,s=s.concat(n));}return s}function Ka(e){let t;return t="modelInstance"===e.type||"primitiveInstance"===e.type?"ellipsoid"===e.reference?ut:mt:"ellipsoid"===e.reference?dt:ct,t}function Ja(t,i){if(!e.defined(i.id))throw new Error("id is not defined!");let s;switch(i.type){case"primitive":case"primitiveInstance":case"billboard":s=t._map.getPrimitiveById(i.id);break;case"model":case"modelInstance":s=t._map.getSceneComponent(i.id);break;case"extrusion":s=t._map.getSource(i.id);}if(!e.defined(s))throw new Error(`${i.id} is not found!`);return s}function Za(e){let t;switch(e.loop){case"repeat":default:t=_.LOOP_REPEAT;break;case"once":t=_.LOOP_ONCE;break;case"none":t=_.LOOP_NONE;}return t}function Ya(t){if(!e.defined(t.times))throw new Error(`${t.id}'s times is not defined!`);const i=t.times,s=e.JulianDate.fromIso8601(i.start),r=e.JulianDate.fromIso8601(i.end),n=e.JulianDate.secondsDifference(r,s);let o=i.steps;const a=t.positions;let l=0,h=[];if(!e.defined(a)&&"extrusion"!==t.type)throw new Error("positions is not defined!");if(!e.defined(o)){let i;if(o=[],"modelInstance"===t.type||"primitiveInstance"===t.type)a.forEach((t=>{if(!(t instanceof Array))throw new Error("Incorrect positions of instance!");if(t.length%3!=0)throw new Error("Incorrect number of instance's positions!");i=t.length/3;const s=[];let r=0;for(let s=0;s<i-1;s++){const i=e.Vector3.fromArray(e.Transforms.cartographicToCartesian3(t.slice(3*s,3*s+3))),r=e.Vector3.fromArray(e.Transforms.cartographicToCartesian3(t.slice(3*(s+1),3*(s+1)+3))),n=e.Vector3.distance(i,r);h.push(n),l+=n;}for(let e=0;e<i;e++)0===e?s.push(0):(r+=h[e-1],s.push(n*(r/l)));h=[],l=0,o.push(s);}));else if("extrusion"!==t.type){if(a.length%3!=0)throw new Error("Incorrect number of positions!");i=a.length/3;let t=0;for(let t=0;t<i-1;t++){const i=e.Vector3.fromArray(e.Transforms.cartographicToCartesian3(a.slice(3*t,3*t+3))),s=e.Vector3.fromArray(e.Transforms.cartographicToCartesian3(a.slice(3*(t+1),3*(t+1)+3))),r=e.Vector3.distance(i,s);h.push(r),l+=r;}for(let e=0;e<i;e++)0===e?o.push(0):(t+=h[e-1],o.push(n*(t/l)));}}return {start:i.start,end:i.end,duration:n,steps:o,trackCalculation:{trackLength:l,trackSegments:h}}}function Qa(t){const i=t.positions,s=t.rotations;if(!e.defined(s))return;if(i.length!==s.length)throw new Error("positions's length must be equal than rotations's length!");let r,n,o=[];const a=[],l=Array(3);for(let e=0;e<i.length;e++){if(r=i[e],n=s[e],n.length%3!=0||n.length<3)throw new Error("Incorrect number of instance's rotations!");if(r.length>n.length){const e=r.length-n.length;l[0]=n[n.length-3],l[1]=n[n.length-2],l[2]=n[n.length-1],o=o.concat(n);for(let t=0;t<e;t++)o=o.concat(l);a.push(o);}else if(r.length<n.length){const e=r.length-n.length;a.push(n.splice(n.length-1-e,e));}else a.push(n);}return a}function $a(e,t,i,s,r,n,o){const a=new ht(t,[new He(i,s,r,n,o)]);return e.animations.set(a.id,a),e._map.trackingOptions&&(a.trackingOptions=e._map.trackingOptions),a}Xa.updaters=[function(e,t){if("primitive"!==t.type&&"extrusion"!==t.type&&"model"!==t.type)return;const i=Ka(t),s=t.positions,{start:r,end:n,duration:o,steps:a,trackCalculation:l}=Ya(t),h=Ja(e,t);let _;"extrusion"!==t.type&&(_=[new i("position",a,s)]);const c=$a(e,h,o,_,Za(t),r,n);return t.autoPlay&&c.play(),c.trackCalculation=l,c},function(t,i){if("modelInstance"!==i.type&&"primitiveInstance"!==i.type)return;const s=i.positions,{start:r,end:n,duration:o,steps:a,trackCalculation:l}=Ya(i),h=Qa(i),_=i.translations,c=function(t){if(e.defined(t.material)&&e.defined(t.material.colors))return t.material.colors}(i),d=e.defined(i.material)?i.material.names:void 0,u=i.trackIds,m=Za(i),p=[new(Ka(i))("position",a,s,h,_,null,c,d,u)],f=$a(t,Ja(t,i),o,p,m,r,n);return i.autoPlay&&f.play(),f.trackCalculation=l,f},function(t,i){if("billboard"!==i.type||!e.defined(i.extra))return;if(!e.defined(i.positions))throw new Error("positions is not defined!");if(!e.defined(i.id))throw new Error("id is not defined!");const s=[],r=Qa(i),{start:n,end:o,duration:a,steps:l}=Ya(i),h=i.positions.length,_=t._billboardId.get(i.id)||[],c=[];for(let d=0;d<h;d++){const h=i.positions[d],u=i.translations?i.translations[d]:null,m=r?r[d]:null,p=l[d],f=`${i.id}_${d}`;let g;if(g=i.extra.scale?Array.isArray(i.extra.scale[d])?i.extra.scale[d]:i.extra.scale:[1,1,1],c.push(f),_){const e=_.indexOf(f);e>-1&&_.splice(e,1);}let y=t._map.getPrimitiveById(f);if(y){if("BillboardMaterial"!==y._material.type)throw new e.DeveloperError(` duplicated in ${f} with different primitive type `);y.animationPropertyCollection=new e.AnimationPropertyCollection,y._material.scale=g;}else {const i=new ja({}),s=new za({scale:g,center:new e.Vector2(.5,.25),rotation:0,color:[0,0,0,0]});y=new e.Primitive({geometry:i,material:s,id:f,show:!1}),t._map.addPrimitive(y);}const T=i.extra.image,C={};for(const[e,t]of Object.entries(i.extra.imageInfo))C[e]=t[d];const x=[new ct(f,p,h,m,u,null,null,null,T,C)];T&&C&&x[0].parseImageInfo(T,C,t._map.painter.context);const b=$a(t,y,a,x,Za(i),n,o);e.defined(b)&&s.push(b),i.autoPlay&&b.play();}for(const e of _)t._map.removePrimitiveById(e);return t._billboardId.set(i.id,c),s}];class el{constructor(t){this.tileSize=512,this.scale=this._zoomToScale(0),this._posMatrixCache={},this.screenSize=new e.Vector2(0,0),this.position=new e.Vector3(0,0,0),this.headingPitchRoll=new e.HeadingPitchRoll(0,0,0),this._transform=t;}update(t){let i=!1;e.defined(t.fov)&&this._fov!==t.fov&&(this._fov=t.fov,i=!0),e.defined(t.position)&&!e.Vector3.equals(this.position,t.position)&&(this.position=t.position,this.cameraHeightConvertedZoom=e.getZoomFromDistance(this._fov,this.position[2]+e.CONSTS.TRANSFORM.R,e.CONSTS.TRANSFORM.R),this.scale=this._zoomToScale(this.cameraHeightConvertedZoom),i=!0),e.defined(t.headingPitchRoll)&&!e.HeadingPitchRoll.equals(this.headingPitchRoll,t.headingPitchRoll)&&(this.headingPitchRoll=t.headingPitchRoll,i=!0),e.defined(t.screenSize)&&!e.Vector2.equals(this.screenSize,t.screenSize)&&(this.screenSize=t.screenSize,i=!0),e.defined(t.projection)&&this.projection!==t.projection&&(this.projection=t.projection,i=!0),i&&(this.convertedMapOptions=null,this.calcMatrices());}_zoomToScale(e){return Math.pow(2,e)}calculatePosMatrix(t){const i=t.key,s=this._posMatrixCache;if(s[i])return s[i];const r=t.canonical,n=this.worldSize/this._zoomToScale(r.z),o=new e.Matrix4;return o.translate([r.x*n,r.y*n,0]),o.scale([n/e.EXTENT,n/e.EXTENT,1]),o.multiplyLeft(this.projMatrix),s[i]=o.toArray(),s[i]}calcMatrices(){this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const t=this.getMapViewParams().pitch*e.CONSTS.TRANSFORM.DEG_TO_RAD,i=this.getMapViewParams().bearing*e.CONSTS.TRANSFORM.DEG_TO_RAD,s=Math.PI/2+t,r=.5*this.height/Math.sin(Math.PI-s-this._fov/2),n=this.cameraX,o=this.cameraY,a=1.01*(Math.cos(Math.PI/2-t)*r+this.cameraToCenterDistance),l=new e.Matrix4;l.perspective({fov:this._fov,aspect:this.width/this.height,near:1,far:a}),l.scale([1,-1,1]),l.rotateX(t),l.rotateZ(-i),l.translate([-n,-o,-this.cameraToCenterDistance]);const h=this.worldSize/(2*Math.PI*e.CONSTS.TRANSFORM.REAL_R*Math.abs(Math.cos(this.getMapViewParams().lat*e.CONSTS.TRANSFORM.DEG_TO_RAD)));l.scale([1,1,h,1]),this.projMatrix=l,this._posMatrixCache={};}get zoom(){return this.getMapViewParams().zoom}getMapViewParams(){if(this.convertedMapOptions)return this.convertedMapOptions;const t=[this.position[0],this.position[1],this.cameraHeightConvertedZoom,this.headingPitchRoll.heading*e.CONSTS.TRANSFORM.RAD_TO_DEG,this.headingPitchRoll.pitch*e.CONSTS.TRANSFORM.RAD_TO_DEG,this.headingPitchRoll.roll*e.CONSTS.TRANSFORM.RAD_TO_DEG],i=e.Transforms.convertV4Pos2V34Traversal(t,this._transform);return this.convertedMapOptions={lng:e.defined(i)?i[0]:t[0],lat:e.defined(i)?i[1]:t[1],zoom:e.defined(i)?i[2]:t[2],bearing:e.defined(i)?i[3]:t[3],pitch:e.defined(i)?i[4]:t[4],roll:e.defined(i)?i[5]:t[5]},this.convertedMapOptions}get height(){return this.screenSize[1]}get width(){return this.screenSize[0]}get worldSize(){return this.tileSize*this.scale}get cameraX(){return e.ProjectionProxy.lngX(this.position[0],this.worldSize,this.projection)}get cameraY(){return e.ProjectionProxy.latY(this.position[1],this.worldSize,this.projection)}get fov(){return this._fov}get centerPoint(){return this.screenSize.clone().multiplyScalar(.5)}getCameraPoint(){const t=Math.tan(this.headingPitchRoll.pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.Vector2(0,t))}getCameraQueryGeometry(t){const i=this.getCameraPoint();if(1===t.length)return [t[0],new e.pointGeometry3d(i.x,i.y)];{let s=i.x,r=i.y,n=i.x,o=i.y;for(const e of t)s=Math.min(s,e.x),r=Math.min(r,e.y),n=Math.max(n,e.x),o=Math.max(o,e.y);return [new e.pointGeometry3d(s,r),new e.pointGeometry3d(n,r),new e.pointGeometry3d(n,o),new e.pointGeometry3d(s,o),new e.pointGeometry3d(s,r)]}}maxPitchScaleFactor(){return 1}destroy(){this.transform=null;}}function tl(t,i,s){if(t.length<i)return;let r=!0;for(let e=0;e<t.length;e++){if(t[e].error)return s(t[e].error);t[e].image&&t[e].json||(r=!1);}if(!r)return;const n={};for(let i=0;i<t.length;i++){const s=t[i],r=e.exported.getImageData(s.image),o=s.json;for(const t in o){const{width:i,height:s,x:a,y:l,sdf:h,pixelRatio:_,stretchX:c,stretchY:d,content:u}=o[t],m=new e.RGBAImage({width:i,height:s});e.RGBAImage.copy(r,m,{x:a,y:l},{x:0,y:0},{width:i,height:s}),n[t]={data:m,pixelRatio:_,sdf:h,stretchX:c,stretchY:d,content:u};}}s(null,n);}function il(e){const{userImage:t}=e;return !!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class sl extends e.Evented{constructor(t={}){super(),this.anisotropy=t.anisotropy||0,this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new e.RGBAImage({width:1,height:1}),this.dirty=!0;}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:e,callback:t}of this.requestors)this._notify(e,t);this.requestors=[];}}getImage(e){return this.images[e]}addImage(e,t){this._validate(e,t)&&(this.images[e]=t);}_validate(t,i){let s=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),s=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),s=!1),this._validateContent(i.content,i)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),s=!1),s}_validateStretch(e,t){if(!e)return !0;let i=0;for(const s of e){if(s[0]<i||s[1]<s[0]||t<s[1])return !1;i=s[1];}return !0}_validateContent(e,t){return !(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,t){t.version=this.images[e].version+1,this.images[e]=t,this.updatedImages[e]=!0;}removeImage(e){const t=this.images[e];delete this.images[e],delete this.patterns[e],t.userImage&&t.userImage.onRemove&&t.userImage.onRemove();}listImages(){return Object.keys(this.images)}getImages(e,t){let i=!0;if(!this.isLoaded())for(const t of e)this.images[t]||(i=!1);this.isLoaded()||i?this._notify(e,t):this.requestors.push({ids:e,callback:t});}_notify(t,i){const s={};for(const i of t){this.images[i]||this.fire(new e.Event("styleimagemissing",{id:i}));const t=this.images[i];t?s[i]={data:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)}:e.warnOnce(`Image "${i}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);}i(null,s);}getPixelSize(){const{width:e,height:t}=this.atlasImage;return {width:e,height:t}}getPattern(t){const i=this.patterns[t],s=this.getImage(t);if(!s)return null;if(i&&i.position.version===s.version)return i.position;if(i)i.position.version=s.version;else {const i={w:s.data.width+2,h:s.data.height+2,x:0,y:0},r=new e.ImagePosition(i,s);this.patterns[t]={bin:i,position:r};}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new e.Texture({context:t,image:this.atlasImage,pixelFormat:e.WebGLConstants.RGBA,anisotropy:this.anisotropy}),this.atlasTexture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE);}_updatePatternAtlas(){const t=[];for(const e in this.patterns)t.push(this.patterns[e].bin);const{w:i,h:s}=e.potpack(t),r=this.atlasImage;r.resize({width:i||1,height:s||1});for(const t in this.patterns){const{bin:i}=this.patterns[t],s=i.x+1,n=i.y+1,o=this.images[t].data,a=o.width,l=o.height;e.RGBAImage.copy(o,r,{x:0,y:0},{x:s,y:n},{width:a,height:l}),e.RGBAImage.copy(o,r,{x:0,y:l-1},{x:s,y:n-1},{width:a,height:1}),e.RGBAImage.copy(o,r,{x:0,y:0},{x:s,y:n+l},{width:a,height:1}),e.RGBAImage.copy(o,r,{x:a-1,y:0},{x:s-1,y:n},{width:1,height:l}),e.RGBAImage.copy(o,r,{x:0,y:0},{x:s+a,y:n},{width:1,height:l});}this.dirty=!0;}beginFrame(){this.callbackDispatchedThisFrame={};}dispatchRenderCallbacks(e){for(const t of e){if(this.callbackDispatchedThisFrame[t])continue;this.callbackDispatchedThisFrame[t]=!0;const e=this.images[t];il(e)&&this.updateImage(t,e);}}serialize(){return Object.fromEntries(Object.entries(this.images).flatMap((([e,{url:t}])=>t?[[e,t]]:[])))}destroy(){let t=Object.keys(this.images);return t.forEach((e=>{this.removeImage(e);})),t=[],e.destroyObject(this)}}const rl=1e20;function nl(e,t,i,s,r,n,o,a,l){for(let h=t;h<t+s;h++)ol(e,i*n+h,n,r,o,a,l);for(let h=i;h<i+r;h++)ol(e,h*n+t,1,s,o,a,l);}function ol(e,t,i,s,r,n,o){n[0]=0,o[0]=-rl,o[1]=rl,r[0]=e[t];for(let a=1,l=0,h=0;a<s;a++){r[a]=e[t+a*i];const s=a*a;do{const e=n[l];h=(r[a]-r[e]+s-e*e)/(a-e)/2;}while(h<=o[l]&&--l>-1);l++,n[l]=a,o[l]=h,o[l+1]=rl;}for(let a=0,l=0;a<s;a++){for(;o[l+1]<a;)l++;const s=n[l],h=a-s;e[t+a*i]=r[s]+h*h;}}class al{constructor(e,t){this.localGlyphMode=1,this.requestTransform=e,this.localIdeographFontFamily=t,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}};}setURL(e){this.url=e;}getGlyphs(t,i){const s=[];for(const e in t)for(const i of t[e])s.push({stack:e,id:i});e.asyncAll(s,(({stack:e,id:t},i)=>{let s=this.entries[e];s||(s=this.entries[e]={glyphs:{},requests:{}});let r=s.glyphs[t];if(void 0!==r)return void i(null,{stack:e,id:t,glyph:r});if(r=this._tinySDF(s,e,t),r)return void i(null,{stack:e,id:t,glyph:r});const n=Math.floor(t/256);if(256*n>65535)return void i(new Error("glyphs > 65535 not supported"));let o=s.requests[n];o||(o=s.requests[n]=[],al.loadGlyphRange(e,n,this.url,this.requestTransform,((e,t)=>{if(t)for(const e in t)s.glyphs[+e]=t[+e];for(const i of o)i(e,t);delete s.requests[n];}))),o.push(((s,r)=>{s?i(s):r&&i(null,{stack:e,id:t,glyph:r[t]||null});}));}),((e,t)=>{if(e)i(e);else if(t){const e={};for(const{stack:i,id:s,glyph:r}of t)(e[i]||(e[i]={}))[s]=r&&{id:r.id,bitmap:r.bitmap.clone(),metrics:r.metrics};i(null,e);}}));}_doesCharSupportLocalGlyph(t){return 0!==this.localGlyphMode&&(2===this.localGlyphMode?!!this.localIdeographFontFamily:!!this.localIdeographFontFamily&&(e.isChar["CJK Unified Ideographs"](t)||e.isChar["Hangul Syllables"](t)||e.isChar.Hiragana(t)||e.isChar.Katakana(t)||e.isChar["CJK Symbols and Punctuation"](t)))}_tinySDF(t,i,s){const r=this.localIdeographFontFamily;if(!r||!this._doesCharSupportLocalGlyph(s))return;let n=t.tinySDF;if(!n){let e="500";/bold/i.test(i)?e="900":/medium/i.test(i)?e="500":/light/i.test(i)&&(e="200"),n=t.tinySDF=new al.TinySDF({fontFamily:r,fontWeight:e,fontSize:24,buffer:3,radius:8}),n.fontWeight=e;}if(this.localGlyphs[n.fontWeight][s])return this.localGlyphs[n.fontWeight][s];const o=String.fromCharCode(s),{data:a,width:l,height:h,glyphWidth:_,glyphHeight:c,glyphLeft:d,glyphTop:u,glyphAdvance:m}=n.draw(o);return this.localGlyphs[n.fontWeight][s]={id:s,bitmap:new e.AlphaImage({width:l,height:h},a),metrics:{width:_/1,height:c/1,left:d/1,top:u/1-27,advance:m/1,localGlyph:!0}}}}al.loadGlyphRange=function(t,i,s,r,n){const o=256*i,a=o+255,l=r(function(e){if(!xt(e)&&!yt.fontsUrl)return e;const t=Pt(e);return yt.fontsUrl&&`${yt.fontsUrl}/{fontstack}${t.path.substr(t.path.lastIndexOf("/"))}.pbf`||`${yt.SRC_URL}/fonts/{fontstack}${t.path.substr(t.path.lastIndexOf("/"))}.pbf`}(s).replace("{fontstack}",t).replace("{range}",`${o}-${a}`),e.ResourceType.Glyphs);e.getArrayBuffer(l,((t,i)=>{if(t)n(t);else if(i){const t={};for(const s of e.parseGlyphPBF(i))t[s.id]=s;n(null,t);}}));},al.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:s=.25,fontFamily:r="sans-serif",fontWeight:n="normal",fontStyle:o="normal"}={}){this.buffer=t,this.cutoff=s,this.radius=i;const a=this.size=e+4*t,l=this._createCanvas(a),h=this.ctx=l.getContext("2d",{willReadFrequently:!0});h.font=`${o} ${n} ${e}px ${r}`,h.textBaseline="alphabetic",h.textAlign="left",h.fillStyle="black",this.gridOuter=new Float32Array(a*a),this.gridInner=new Float32Array(a*a),this.f=new Float32Array(a),this.z=new Float32Array(a+1),this.v=new Uint16Array(a);}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:r,actualBoundingBoxRight:n}=this.ctx.measureText(e),o=Math.ceil(i),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(n-r))),l=Math.min(this.size-this.buffer,o+Math.ceil(s)),h=a+2*this.buffer,_=l+2*this.buffer,c=Math.max(h*_,0),d=new Uint8ClampedArray(c),u={data:d,width:h,height:_,glyphWidth:a,glyphHeight:l,glyphTop:o,glyphLeft:0,glyphAdvance:t};if(0===a||0===l)return u;const{ctx:m,buffer:p,gridInner:f,gridOuter:g}=this;m.clearRect(p,p,a,l),m.fillText(e,p,p+o);const y=m.getImageData(p,p,a,l);g.fill(rl,0,c),f.fill(0,0,c);for(let e=0;e<l;e++)for(let t=0;t<a;t++){const i=y.data[4*(e*a+t)+3]/255;if(0===i)continue;const s=(e+p)*h+t+p;if(1===i)g[s]=0,f[s]=rl;else {const e=.5-i;g[s]=e>0?e*e:0,f[s]=e<0?e*e:0;}}nl(g,0,0,h,_,h,this.f,this.v,this.z),nl(f,p,p,a,l,h,this.f,this.v,this.z);for(let e=0;e<c;e++){const t=Math.sqrt(g[e])-Math.sqrt(f[e]);d[e]=Math.round(255-255*(t/this.radius+this.cutoff));}return u}};class ll{constructor(t,i){this.width=t,this.height=i,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={},this._target=e.WebGLConstants.TEXTURE_2D;}getDash(e,t){const i=e.join(",")+String(t);return this.dashEntry[i]||(this.dashEntry[i]=this.addDash(e,t)),this.dashEntry[i]}getDashRanges(e,t,i){const s=[];let r=e.length%2==1?-e[e.length-1]*i:0,n=e[0]*i,o=!0;s.push({left:r,right:n,isDash:o,zeroLength:0===e[0]});let a=e[0];for(let t=1;t<e.length;t++){o=!o;const l=e[t];r=a*i,a+=l,n=a*i,s.push({left:r,right:n,isDash:o,zeroLength:0===l});}return s}addRoundDash(e,t,i){const s=t/2;for(let t=-i;t<=i;t++){const r=this.width*(this.nextRow+i+t);let n=0,o=e[n];for(let a=0;a<this.width;a++){a/o.right>1&&(o=e[++n]);const l=Math.abs(a-o.left),h=Math.abs(a-o.right),_=Math.min(l,h);let c;const d=t/i*(s+1);if(o.isDash){const e=s-Math.abs(d);c=Math.sqrt(_*_+e*e);}else c=s-Math.sqrt(_*_+d*d);this.data[r+a]=Math.max(0,Math.min(255,c+128));}}}addRegularDash(e){for(let t=e.length-1;t>=0;--t){const i=e[t],s=e[t+1];i.zeroLength?e.splice(t,1):s&&s.isDash===i.isDash&&(s.left=i.left,e.splice(t,1));}const t=e[0],i=e[e.length-1];t.isDash===i.isDash&&(t.left=i.left-this.width,i.right=t.right+this.width);const s=this.width*this.nextRow;let r=0,n=e[r];for(let t=0;t<this.width;t++){t/n.right>1&&(n=e[++r]);const i=Math.abs(t-n.left),o=Math.abs(t-n.right),a=Math.min(i,o);this.data[s+t]=Math.max(0,Math.min(255,(n.isDash?a:-a)+128));}}addDash(t,i){const s=i?7:0,r=2*s+1;if(this.nextRow+r>this.height)return e.warnOnce("LineAtlas out of space"),null;let n=0;for(let e=0;e<t.length;e++)n+=t[e];if(0!==n){const e=this.width/n,r=this.getDashRanges(t,this.width,e);i?this.addRoundDash(r,e,s):this.addRegularDash(r);}const o={y:(this.nextRow+s+.5)/this.height,height:2*s/this.height,width:n};return this.nextRow+=r,this.dirty=!0,o}bind(t){const i=t.gl;this.texture?(i.bindTexture(e.WebGLConstants.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,i.texSubImage2D(e.WebGLConstants.TEXTURE_2D,0,0,0,this.width,this.height,e.WebGLConstants.ALPHA,e.WebGLConstants.UNSIGNED_BYTE,this.data))):(this.texture=i.createTexture(),i.bindTexture(e.WebGLConstants.TEXTURE_2D,this.texture),i.texParameteri(e.WebGLConstants.TEXTURE_2D,e.WebGLConstants.TEXTURE_WRAP_S,e.WebGLConstants.REPEAT),i.texParameteri(e.WebGLConstants.TEXTURE_2D,e.WebGLConstants.TEXTURE_WRAP_T,e.WebGLConstants.REPEAT),i.texParameteri(e.WebGLConstants.TEXTURE_2D,e.WebGLConstants.TEXTURE_MIN_FILTER,e.WebGLConstants.LINEAR),i.texParameteri(e.WebGLConstants.TEXTURE_2D,e.WebGLConstants.TEXTURE_MAG_FILTER,e.WebGLConstants.LINEAR),i.texImage2D(e.WebGLConstants.TEXTURE_2D,0,e.WebGLConstants.ALPHA,this.width,this.height,0,e.WebGLConstants.ALPHA,e.WebGLConstants.UNSIGNED_BYTE,this.data));}destroy(){return this.data=null,e.destroyObject(this)}}class hl{constructor(t,i){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=e.uniqueId();const s=this.workerPool.acquire(this.id);for(let e=0;e<s.length;e++){const t=new hl.Actor(s[e],i,this.id);t.name=`Worker ${e}`,this.actors.push(t);}}broadcast(t,i,s){e.asyncAll(this.actors,((e,s)=>{e.send(t,i,s);}),s=s||function(){});}send(e,t,i,s){return (isNaN(s)||"number"!=typeof s)&&(s=this.currentActor=(this.currentActor+1)%this.actors.length),this.actors[s]&&this.actors[s].send(e,t,i),s}remove(){this.actors.forEach((e=>{e.remove();})),this.actors=[],this.workerPool.release(this.id);}}hl.Actor=e.Actor;class _l{constructor(t,i,s){this.bounds=e.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=i||0,this.maxzoom=s||24;}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const t=e.canonical,i=Math.floor(this.lngX(this.bounds.getWest(),t.z,e.projection)),s=Math.floor(this.latY(this.bounds.getNorth(),t.z,e.projection)),r=Math.ceil(this.lngX(this.bounds.getEast(),t.z,e.projection)),n=Math.ceil(this.latY(this.bounds.getSouth(),t.z,e.projection));return t.x>=i&&t.x<r&&t.y>=s&&t.y<n}lngX(e,t,i){return "LATLON"===i?0===t?0:(e+180)*(2*Math.pow(2,t-1))/360:(e+180)*(Math.pow(2,t)/360)}latY(t,i,s){if("LATLON"===s)return 0===i?0:(90-t)*Math.pow(2,i-1)/180;{const s=e.clamp(Math.sin(Math.PI/180*t),-.9999,.9999),r=Math.pow(2,i)/(2*Math.PI);return Math.pow(2,i-1)+.5*Math.log((1+s)/(1-s))*-r}}}var cl=e.createLayout([{name:"a_POSITION",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),dl=e.createLayout([{name:"a_POSITION",type:"Float32",components:3},{name:"a_texture_pos",type:"Float32",components:2}]);class ul extends e.Material{constructor(t){super(t),this.isVectorMaterial=!0,this.layer=t.layer,this.tile=t.tile,this._renderState=t.renderState,this.textureFilter=e.defined(this.layer)&&"nearest"===this.layer.paint.get("raster-resampling")?e.WebGLConstants.NEAREST:e.WebGLConstants.LINEAR,this._lightColor=new e.Vector3(1,1,1),this._lightDirection=new e.Vector3,this._spinWeights=new e.Vector3,this.createUniforms();}setLayer(e){this.layer=e;}update(t,i,s={}){super.update(t,i,s),this.defines={ENCODE_DEPTH_TO_FRAGCOLOR:i.passType===e.RenderPassConsts.PICK_PASS,STATIC_IMAGE:!0};}createUniforms(){this._uniforms.set("u_brightness_low",(()=>this.layer.paint.get("raster-brightness-min"))),this._uniforms.set("u_brightness_high",(()=>this.layer.paint.get("raster-brightness-max"))),this._uniforms.set("u_saturation_factor",(()=>{return (e=this.layer.paint.get("raster-saturation"))>0?1-1/(1.001-e):-e;var e;})),this._uniforms.set("u_contrast_factor",(()=>{return (e=this.layer.paint.get("raster-contrast"))>0?1/(1-e):1+e;var e;})),this._uniforms.set("u_spin_weights",(()=>{const e=function(e){e*=Math.PI/180;const t=Math.sin(e),i=Math.cos(e);return [(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}(this.layer.paint.get("raster-hue-rotate"));return this._spinWeights.set(e[0],e[1],e[2])})),this._uniforms.set("u_Opacity",(()=>this.layer.paint.get("raster-opacity"))),this._uniforms.set("u_BaseColorSampler",(()=>(this.tile.texture.bind(this.textureFilter,e.WebGLConstants.CLAMP_TO_EDGE),this.tile.texture)));}checkLayer(){if(!this.layer)throw new Error("请在image plotter中针对image source进行layer的注册，即调用material.setLayer(layer)")}destroy(){this.layer=void 0,this.tile.texture&&(this.tile.texture.destroy(),this.tile.texture=null),this.__texture=null,this.tile=void 0,this.programId=void 0,this.type=void 0,this._uniforms=void 0,this._textures=void 0,this._program=void 0,this._programConfiguration=void 0,this._renderState=void 0,this.textureFilter=void 0,this.parentScaleBy=void 0;}}class ml extends Ut{constructor(t,i,s,r){if(super(),this.id=t,this.dispatcher=s,this.coordinates=function(e){if(e[0]instanceof Array){let t=e[0][0],i=e[0][0],s=e[0][1],r=e[0][1];for(let n=1;n<e.length;n++)t=t>e[n][0]?e[n][0]:t,i=i<e[n][0]?e[n][0]:i,s=s>e[n][1]?e[n][1]:s,r=r<e[n][1]?e[n][1]:r;return [t,s,i,r]}return e}(i.coordinates),i.bounds){const t=i.bounds.map((t=>e.toRadians(t)));this.rectangle=new e.Rectangle(...t);}else this.rectangle=e.Rectangle.MAX_VALUE;this.grid=i.grid,this.wms=!!i.wms&&i.wms,this.url=i.url,this.minzoom=0,this.maxzoom=0,this.type="image",this.tileSize=512,this.tiles={},this.setEventedParent(r),this.options=i,this._imageryCache=new Map,fa(this);}setCoordinates(e){}load(t,i){this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this.url=this.options.url,e.getImage(this.map._transformRequest(this.url,e.ResourceType.Image),((s,r)=>{this._loaded=!0,s?this.fire(new e.ErrorEvent(s)):r&&(this.image=r,t.loadingImagery.state=2,t.loadingImagery.loadImage({data:{img:this.image},painter:this.map.painter,justReloaded:!1,callback:()=>{i();}}));}));}updateImage(e){return this.image&&e.url?(this.options.url=e.url,this.load(e.coordinates,(()=>{this.texture=null;})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})));}onAdd(t){this.map=t;const i=this.coordinates.map((t=>e.toRadians(t)));if(this.map.transform.projection===e.ProjectionType.LATLON)this._tilingScheme=new Ot({rectangle:new e.Rectangle(...i),numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1}),this.projection=e.ProjectionType.LATLON;else {const t=new It,s=t.project(new e.Cartographic(i[0],i[1],0)),r=t.project(new e.Cartographic(i[2],i[3],0));this._tilingScheme=new Dt({rectangleSouthwestInMeters:new e.Vector2(s.x,s.y),rectangleNortheastInMeters:new e.Vector2(r.x,r.y),numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1}),this.projection=e.ProjectionType.MERCATOR;}if(this.wms){this.wmsUrl||(this.wmsUrl=this.options.url);const e=Math.ceil(t.transform.width),i=Math.ceil(t.transform.height),s=Math.ceil(t.style.getNearestTileZoom()),r=`${t.getBounds()._sw.lng},${t.getBounds()._sw.lat},${t.getBounds()._ne.lng},${t.getBounds()._ne.lat}`;this.options.url=this.wmsUrl.replace("{bbox}",r).replace("{width}",e.toString()).replace("{height}",i.toString()).replace("{z}",s.toString()),this.coordinates=[t.getBounds().getNorthWest().toArray(),t.getBounds().getNorthEast().toArray(),t.getBounds().getSouthEast().toArray(),t.getBounds().getSouthWest().toArray()],this.setCoordinates(this.coordinates);}}onRemove(){}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const t=this.map.painter.context;if(this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,cl.members),this.indexBuffer=t.createIndexBuffer(this._indexArray)),this.sphereBoundsBuffer||(this.sphereBoundsBuffer=t.createVertexBuffer(this._sphereBoundsArray,dl.members),this.sphereIndexBuffer=t.createIndexBuffer(this._sphereIndexArray)),!this.texture){this.texture=new e.Texture({context:t,image:this.image,pixelFormat:e.WebGLConstants.RGBA}),this.texture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE);const i=new e.Geometry({primitiveType:e.WebGLConstants.TRIANGLES,vertexBuffer:this.sphereBoundsBuffer,indexBuffer:this.sphereIndexBuffer,segmentVector:this.sphereSegments}),s=new ul({painter:this.map.painter,tile:this,defines:{},type:"sphereImage",renderState:{}});this.primitive=new e.Primitive({modelMatrix:this.matrix,geometry:i,material:s});}for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture);}}loadTile(e,t){e.loadingImagery&&1!==e.loadingImagery.state&&(this.image?(e.loadingImagery.state=2,e.loadingImagery.loadImage({data:{img:this.image},painter:this.map.painter,justReloaded:!1,callback:()=>{t();}})):(e.loadingImagery.state=1,this.load(e,t)));}unloadTile(e){e.freeResources(e.imagery.tileID.key);}serialize(){return {type:"image",url:this.options.url,coordinates:this.coordinates}}isEarthSource(){return !0}}class pl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null;}bind(e,t,i,s,r,n,o,a,l,h,_){this.context=e;let c=this.boundPaintVertexBuffers.length!==s.length;for(let e=0;!c&&e<s.length;e++)this.boundPaintVertexBuffers[e]!==s[e]&&(c=!0);const d=this._requireFreshBind({program:t,layoutVertexBuffer:i,paintVertexBuffers:s,indexBuffer:r,vertexOffset:n,dynamicVertexBuffer:o,dynamicVertexBuffer2:a,dynamicVertexBuffer3:l,animationVertexBuffers:h,instanceVerterBuffers:_});if(!e.extVertexArrayObject||d)this.freshBind(t,i,s,r,n,o,a,l,h,_);else {e.bindVertexArrayOES.set(this.vao);const i=e.gl;o&&o.bind(),r&&r.dynamicDraw&&r.bind(),a&&a.bind(),l&&l.bind(),h&&this._setAnimationBoundBuffers(h,i,t,n);}}freshBind(e,t,i,s,r,n,o,a,l,h){let _;const c=e.numAttributes,d=this.context,u=d.gl;if(d.extVertexArrayObject)this.vao&&this.destroy(),this.vao=d.extVertexArrayObject.createVertexArrayOES(),d.bindVertexArrayOES.set(this.vao),_=0,this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=s,this.boundVertexOffset=r,this.boundDynamicVertexBuffer=n,this.boundDynamicVertexBuffer2=o,this.boundDynamicVertexBuffer3=a,this.instanceVerterBuffers=h,this._initAnimationBoundBuffer(l);else {_=d.currentNumAttributes||0;for(let e=c;e<_;e++)u.disableVertexAttribArray(e);}t.enableAttributes(u,e);for(const t of i)t.enableAttributes(u,e);t.setVertexAttribPointers(u,e,r);for(const t of i)t.bind("default"),t.setVertexAttribPointers(u,e,r);s&&s.bind(),n&&(n.enableAttributes(u,e),n.bind("default"),n.setVertexAttribPointers(u,e,r)),o&&(o.enableAttributes(u,e),o.bind("default"),o.setVertexAttribPointers(u,e,r)),a&&(a.enableAttributes(u,e),a.bind("default"),a.setVertexAttribPointers(u,e,r)),l&&this._setAnimationBoundBuffers(l,u,e,r),h&&h.setVertexAttribPointers(u,e),d.currentNumAttributes=c;}_requireFreshBind(e){const{program:t,layoutVertexBuffer:i,paintBuffersDiffer:s,indexBuffer:r,vertexOffset:n,dynamicVertexBuffer:o,dynamicVertexBuffer2:a,dynamicVertexBuffer3:l,animationVertexBuffers:h}=e;let _=!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==i||s||this.boundIndexBuffer!==r||this.boundVertexOffset!==n||this.boundDynamicVertexBuffer!==o||this.boundDynamicVertexBuffer2!==a||this.boundDynamicVertexBuffer3!==l;if(h)for(const e in h)Object.hasOwnProperty.call(h,e)&&(_=this[`bound${e}`]!==h[e]);return _}_initAnimationBoundBuffer(e){if(e)for(const t in e)Object.hasOwnProperty.call(e,t)&&(this[`bound${t}`]=e[t]);}_setAnimationBoundBuffers(e,t,i,s){for(const r in e)if(Object.hasOwnProperty.call(e,r)){const n=e[r];n.enableAttributes(t,i),n.bind("default"),n.setVertexAttribPointers(t,i,s);}}_destroyAnimationVertexBuffers(){}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null);}remove(){this.destroy(),this.context=null,this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=null,this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.boundDynamicVertexBuffer2=null,this.boundDynamicVertexBuffer3=null,this.instanceVerterBuffers=null,this._destroyAnimationVertexBuffers();}}class fl extends e.Evented{constructor(t,i,s,r){super(),this.id=t,this.type="3d-model",this.minzoom=15,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this.dispatcher=s,this.setEventedParent(r),this.textures=[],this.nodes=[],this.meshes=[],this.primitives=[],this.materials=[],this._loadedTextures={},this._data=i.data,this._options=e.extend({},i),this.location=i.location||[0,0],this.upAxis=i["up-axis"]||"Y-UP",this.modelFolder=i.modelFolder,this.scale=i.scale||[1,1,1],this.rotation=i.rotation||[0,0,0],this.translation=i.translation||[0,0,0],this._collectResourceTiming=i.collectResourceTiming,this._resourceTiming=[],void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.filter=i.filter,this._pickable=i.pickable||!1,this.log=i.log||!1,this.useMipmap=void 0===i.useMipmap||i.useMipmap,this._abortListMap=new Map,this.lightingModel=i.lightingModel||e.LightingModelType.NONE,this.filter&&this.setFilter(this.filter),i.aabbFilter&&this.setAABBFilter(i.aabbFilter);}setFilter(t){this._featureFilter=e.createFilter(t);}setAABBFilter(t){this._aabbFilter=e.createFilter(t);}highlightModel(){}load(t){this.fire(new e.Event("dataloading",{dataType:"source"})),this.state="dataloading";const i=e.extend({},this.workerOptions);i.location=this.location,i.source=this.id;const s=this._data;i.request="string"==typeof s?{url:e.exported.resolveURL(vt(s)),collectResourceTiming:this._collectResourceTiming}:{url:new e.window.Blob([JSON.stringify(s)]),collectResourceTiming:this._collectResourceTiming},Bs(i.request.url,Ga,{gltf:{postProcess:!0,loadImages:!0},context:this.map.painter.context,useMipmap:this.useMipmap,source:this,transformRequest:this.map._transformRequest,collectResourceTiming:this._collectResourceTiming,isDestroyed:this._removed,_abortListMap:this._abortListMap,dispatcher:this.map.style.dispatcher},0,vt(this.modelFolder)).then((e=>{if(e){if(this._removed||e&&e.abandoned)return;this._loaded=!0,this.state="parsing",this.result=e,t(null,e);}else t({msg:"loaders.gl load data fail"},null);}));}onAdd(e,t){this.map=e,this.load(t);}setLocation(){}prepare(){}loadTile(e,t){e.state="loaded";}abortTile(e){e.aborted=!0;}unloadTile(e){}onRemove(){this._removed=!0,this._abortListMap.forEach(((e,t)=>{e.abort(),this._abortListMap.delete(t);})),this.dispatcher.send("removeSource",{type:this.type,source:this.id},null,this.workerID);}serialize(){return e.extend({},this._options,{type:this.type,data:this._data,maxzoom:this.maxzoom,bounds:this.bounds,location:this.location,"up-axis":this.upAxis})}hasTransition(){return !1}isEarthSource(){return !0}}class gl extends e.Evented{constructor(t,i,s,r){super(),this.id=t,this.dispatcher=s,this.minzoom=15,this.maxzoom=22,this.reparseOverscaled=!0,this.isTileClipped=!0,this.vectorLayerIds=[],this.type="3d-tiles",this.layers=i.urls,this.log=i.log||!1,this.useMipmap=void 0!==i.useMipmap&&i.useMipmap,this.allowPick=void 0===i.allowPick||i.allowPick,e.extend(this,e.pick(i,["url","urls","scheme","modelFolder","location","filter","minzoom","maxzoom"])),this._options=e.extend({type:this.type},i),this.lightingModel=i.lightingModel||e.LightingModelType.NONE,this._collectResourceTiming=i.collectResourceTiming,this.filter&&this.setFilter(this.filter),this.setEventedParent(r);}load(){this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"}));}loadTile(e,t,i){}setFilter(t){this._featureFilter=e.createFilter(t);}prepare(){this.gltfModelVAO||(this.gltfModelVAO=new pl);}hasTile(e){return !0}onAdd(e){this.map=e,this.load();}onRemove(e){}serialize(){return e.extend({},this._options)}abortTile(e){this.dispatcher.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0,e.workerID);}unloadTile(e){e.unloadVectorData(),this.dispatcher.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0,e.workerID),this.dispatcher.send("removeTile",{uid:e.uid,type:this.type,source:this.id},void 0,e.workerID);}hasTransition(){return !1}isEarthSource(){return !0}setViewFrustum(e){this._eventedParent._setViewFrustum(e);}}var yl=e.createLayout([{name:"a_POSITION",type:"Float32",components:3},{name:"a_texture_pos",type:"Float32",components:2},{name:"a_NORMAL",type:"Float32",components:3}]),Tl=e.createLayout([{name:"a_GEODETIC_NORMAL",type:"Float32",components:3},{name:"a_ELEVATION",type:"Float32",components:1}]);class Cl{constructor(e){this.data=e.data,this.geometry=e.geometry,this.matrix=e.matrix;}destroy(){return this.geometry.destroy(),e.destroyObject(this)}}class xl{constructor(e){this.data=e.data,this.geometry=e.geometry,this.matrix=e.matrix;}destroy(){return this.geometry.destroy(),e.destroyObject(this)}}class bl{constructor(e){this._tilingScheme=e,this._rootNodes=[],this._json=void 0,this.state="unloaded";}addJSON(t){if(this._json=t,!this._json)throw this.state="error",new Error("地形索引文件内容为空，请检查");if(this._available=this._json.available,this._minimumLevel=this._json.minzoom,this._maximumLevel=this._json.maxzoom,!this._available)throw this.state="error",new Error("地形索引文件'available'字段不存在");if(!this._minimumLevel&&0!==this._minimumLevel)throw this.state="error",new Error("地形索引文件'minzoom'字段不存在");if(!this._maximumLevel)throw this.state="error",new Error("地形索引文件'maxzoom'字段不存在");if(this._available.length!==this._maximumLevel-this._minimumLevel+1)throw this.state="error",new Error("地形索引文件'available'数组长度与'maxzoom'和'minzoom'的差值不匹配");if(this._tilingScheme.type===e.ProjectionType.LATLON){if(0!==this._minimumLevel&&1!==this._minimumLevel)throw this.state="error",new Error("经纬度地形下，地形索引文件'minzoom'必须为0或1");this._minimumLevel=Math.max(1,this._minimumLevel);}else if(0!==this._minimumLevel)throw this.state="error",new Error("墨卡托地形下，地形索引文件'minzoom'必须为0");for(let e=this._minimumLevel;e<=this._maximumLevel;++e){const t=this._available[e];for(let i=0;i<t.length;++i){const s=t[i];this.addAvailableTileRange(e,s.startX,s.startY,s.endX,s.endY);}}}addAvailableTileRange(t,i,s,r,n){const o=this._tilingScheme,a=this._rootNodes;if(t===this._minimumLevel)for(let e=s;e<=n;++e)for(let s=i;s<=r;++s)vl(t,s,e,a)||a.push(new Pl(o,void 0,this._minimumLevel,s,e));let l=o.tileXYToRectangle(i,s,this._tilingScheme.type===e.ProjectionType.LATLON?t-1:t);const h=l.west,_=l.north;l=o.tileXYToRectangle(r,n,this._tilingScheme.type===e.ProjectionType.LATLON?t-1:t);const c={level:t,west:h,south:l.south,east:l.east,north:_};for(let e=0;e<a.length;++e){const t=a[e];wl(t.extent,c)&&Sl(this._maximumLevel,t,c);}}isTileAvailable(t){const i=this._tilingScheme.tileXYToRectangle(t.canonical.x,t.canonical.y,this._tilingScheme.type===e.ProjectionType.LATLON?t.canonical.z-1:t.canonical.z),s=e.Rectangle.center(i);return this.computeMaximumLevelAtPosition(s)>=t.canonical.z}computeMaximumLevelAtTile(t){const i=this._tilingScheme.tileXYToRectangle(t.canonical.x,t.canonical.y,this._tilingScheme.type===e.ProjectionType.LATLON?t.canonical.z-1:t.canonical.z),s=e.Rectangle.center(i);return this.computeMaximumLevelAtPosition(s)}computeMaximumLevelAtPosition(t){let i;for(let e=0;e<this._rootNodes.length;++e){const s=this._rootNodes[e];if(Ml(s.extent,t)){i=s;break}}return e.defined(i)?Al(void 0,i,t):-1}}function vl(e,t,i,s){const r=s.length;for(let n=0;n<r;++n){const r=s[n];if(r.x===t&&r.y===i&&r.level===e)return !0}return !1}function wl(e,t){const i=Math.max(e.west,t.west),s=Math.max(e.south,t.south),r=Math.min(e.east,t.east);return s<Math.min(e.north,t.north)&&i<r}function Sl(t,i,s){for(;i.level<t;)if(El(i.nw.extent,s))i=i.nw;else if(El(i.ne.extent,s))i=i.ne;else if(El(i.sw.extent,s))i=i.sw;else {if(!El(i.se.extent,s))break;i=i.se;}if(0===i.rectangles.length||i.rectangles[i.rectangles.length-1].level<=s.level)i.rectangles.push(s);else {let t=e.binarySearch(i.rectangles,s.level,((e,t)=>e.level-t));t<0&&(t=~t),i.rectangles.splice(t,0,s);}}function Al(e,t,i){let s=0,r=!1;for(;!r;){const e=t._nw&&Ml(t._nw.extent,i),n=t._ne&&Ml(t._ne.extent,i),o=t._sw&&Ml(t._sw.extent,i),a=t._se&&Ml(t._se.extent,i);if(e+n+o+a>1){e&&(s=Math.max(s,Al(t,t._nw,i))),n&&(s=Math.max(s,Al(t,t._ne,i))),o&&(s=Math.max(s,Al(t,t._sw,i))),a&&(s=Math.max(s,Al(t,t._se,i)));break}e?t=t._nw:n?t=t._ne:o?t=t._sw:a?t=t._se:r=!0;}for(;t!==e;){const e=t.rectangles;for(let t=e.length-1;t>=0&&e[t].level>s;--t){const r=e[t];Ml(r,i)&&(s=r.level);}t=t.parent;}return s}function El(e,t){return t.west>=e.west&&t.east<=e.east&&t.south>=e.south&&t.north<=e.north}function Ml(e,t){return t.longitude>=e.west&&t.longitude<=e.east&&t.latitude>=e.south&&t.latitude<=e.north}class Pl{constructor(t,i,s,r,n){this.tilingScheme=t,this.parent=i,this.level=s,this.x=r,this.y=n,this.extent=t.tileXYToRectangle(r,n,this.tilingScheme.type===e.ProjectionType.LATLON?s-1:s),this.rectangles=[],this._sw=void 0,this._se=void 0,this._nw=void 0,this._ne=void 0;}get sw(){return this._sw||(this._sw=new Pl(this.tilingScheme,this,this.level+1,2*this.x,2*this.y+1)),this._sw}get se(){return this._se||(this._se=new Pl(this.tilingScheme,this,this.level+1,2*this.x+1,2*this.y+1)),this._se}get nw(){return this._nw||(this._nw=new Pl(this.tilingScheme,this,this.level+1,2*this.x,2*this.y)),this._nw}get ne(){return this._ne||(this._ne=new Pl(this.tilingScheme,this,this.level+1,2*this.x+1,2*this.y)),this._ne}}const Rl=new e.TerrainTileParser;class Bl extends e.Evented{constructor(t,i,s,r){super(),this.id=t,this.dispatcher=s,this.maxzoom=i.maxzoom||14,this.tileSize=i.tileSize||512,this._tiles=i.tiles,this.type=i.type,this.format=i.format,this.map=i.map,this.setEventedParent(r),this._levelZeroMaximumGeometricError=77067.33978,delete i.map,this._options=e.extend({},i),e.extend(this,e.pick(i,["scheme","tileSize","capabilities","service"])),this.minzoom=0,this.roundZoom=!1,this.scheme="xyz",this._terrainTiles=new Map,this._tempTerrainTiles=new Map,this._tempRequestingSet=new Set,this.workerIDMap=new Map,this.availability=new bl(this.map._tilingScheme),i.availabilities&&i.availabilities.length>0&&this.loadAvailability(i.availabilities[0]),this.load();}load(){this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Bt(this._options,this.map._transformRequest,((t,i)=>{this._tileJSONRequest=null,t?this.fire(new e.ErrorEvent(t)):i&&(e.extend(this,i),i.bounds&&(this.tileBounds=new _l(i.bounds,this.minzoom,this.maxzoom)),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})));}));}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null);}serialize(){return e.extend({},this._options)}hasTile(e){return !this.tileBounds||this.tileBounds.contains(e)}getTile(e){return this._terrainTiles.get(e.key)||this._tempTerrainTiles.get(e.key)}loadTile(t,i){const s=t.data,r=s.tileID,n=this._tempTerrainTiles.get(r.key);if(n)return this._tempTerrainTiles.delete(r.key),s.terrainState=3,void i(null,n);if(r.canonical.z>this.maxzoom){const e=this.processUpsample(t);return s.terrainState=3,s.upsample=!0,i(null,e)}const o=r.canonical.toRealCoord(this.scheme),a=r.canonical.url(this._tiles,this.scheme),l=Et(a,0,0,o),h={request:this.map._transformRequest(l,e.ResourceType.Tile),uid:r.key,tileID:r,type:this.type,source:this.id,skirtHeight:this.map.terrainSkirtHeight<0?5*this.getLevelMaximumGeometricError(r.canonical.z):this.map.terrainSkirtHeight},_=this.dispatcher.send("loadTile",h,function(e,n){if(2===s.terrainState){if(e||!n){s.terrainState=0;const e=this.processUpsample(t);return s.terrainState=3,s.upsample=!0,i(null,e)}s.terrainState=3;const o=this.parseTerrainData(n,this.map.painter.context,this.map.style.rasterSourceCache.quadtree,r,t);this._terrainTiles.set(r.key,o),i(null,o);}}.bind(this));this.workerIDMap.set(r.key,_),s.terrainState=2;}abortTile(e,t){const i=this.workerIDMap.get(e.key);this.dispatcher.send("abortTile",{uid:e.key,type:this.type,source:this.id},void 0,i),this.workerIDMap.delete(e.key,i),t&&t();}unloadTile(e,t){const i=this.workerIDMap.get(e.key);this.dispatcher.send("removeTile",{uid:e.key,type:this.type,source:this.id},void 0,i),this.workerIDMap.delete(e.key,i);const s=this._terrainTiles.get(e.key);if(s&&(this._terrainTiles.delete(e.key),this._tempTerrainTiles.set(e.key,s)),this._tempTerrainTiles.size>100){let e=0;const t=parseInt(this._tempTerrainTiles.size/2);this._tempTerrainTiles.forEach(((i,s)=>{e<t&&(this._tempTerrainTiles.get(s).destroy(),this._tempTerrainTiles.delete(s)),e++;}));}t&&t();}hasTransition(){return !1}parseTerrainData(t,i,s,r,n){if("quantized"===this.format){const o=new e.SegmentVector,a=t.sphereMaskedBoundsArray,l=t.sphereIndexArray,h=t.terrainAnalysisArray,_=t.wireframeIndexArray,c=o.prepareSegment(0,[],[]);c.vertexLength+=t.sphereMaskedBoundsArray.length,c.primitiveLength+=t.sphereIndexArray.length,o.prepareSegment(0,a,l),n&&(n.terrainBounds.minimumHeight!=t.minimumHeight&&(n.terrainBounds.minimumHeight=t.minimumHeight),n.terrainBounds.maximumHeight!=t.maximumHeight&&(n.terrainBounds.maximumHeight=t.maximumHeight),n.tileBoundingRegion.isAmbiguousHeight=!1);const d=new e.Geometry({primitiveType:e.WebGLConstants.TRIANGLES,vertexBuffer:i.createVertexBuffer(a,yl.members),indexBuffer:i.createIndexBuffer(l),wireframeIndexBuffer:i.createIndexBuffer(_),dynamicLayoutBuffer1:i.createVertexBuffer(h,Tl.members),segmentVector:o,tileBoundingRegion:s.getBoundingRegionById(r.key),tileId:r}),u=new e.Matrix4;return u[12]=t.rP[0],u[13]=t.rP[1],u[14]=t.rP[2],new Cl({data:t,geometry:d,matrix:u})}if("heightmap"===this.format)return new xl}requestTempData(t,i){const s=t.canonical.url(this._tiles,this.scheme),r=Et(s),n={request:this.map._transformRequest(r,e.ResourceType.Tile),uid:t.key,tileID:t,type:this.type,source:this.id,skirtHeight:this.map.terrainSkirtHeight<0?5*this.getLevelMaximumGeometricError(t.canonical.z):this.map.terrainSkirtHeight},o=this.dispatcher.send("loadTile",n,function(e,s){if(this._tempRequestingSet.has(t.key)&&this._tempRequestingSet.delete(t.key),e||!s){const e=this.createReplacedMesh(this.map.projection,this.map.painter.context,this.map.style.rasterSourceCache.quadtree,t);return e.state="replaced",this._tempTerrainTiles.set(t.key,e),this._tempRequestingSet.has(t.key)&&this._tempRequestingSet.delete(t.key),i(null,e)}const r=this.parseTerrainData(s,this.map.painter.context,this.map.style.rasterSourceCache.quadtree,t);this._tempTerrainTiles.set(t.key,r),this._tempRequestingSet.has(t.key)&&this._tempRequestingSet.delete(t.key),i(null,r);}.bind(this));this.workerIDMap.set(t.key,o),this._tempRequestingSet.add(t.key);}createReplacedMesh(t,i,s,r){const n=e.tileSamplesGrid(r,t),o=new e.Geometry({primitiveType:e.WebGLConstants.TRIANGLES,vertexBuffer:i.createVertexBuffer(n.sphereMaskedBoundsArray,yl.members),indexBuffer:i.createIndexBuffer(n.sphereIndexArray),wireframeIndexBuffer:i.createIndexBuffer(n.wireframeIndexArray),segmentVector:n.sphereSegments,tileBoundingRegion:s.getBoundingRegionById(r.key),tileId:r}),a=new e.Matrix4;return a.translate(n.rtc),"quantized"===this.format?new Cl({data:n,geometry:o,matrix:a}):"heightmap"===this.format?new xl:void 0}processUpsample(e){const t=e.parent;if(!t)return void(e.data.state=3);const i=e.tileID,s=Object.assign({},t.data.terrain.data,{x:i.canonical.x,y:i.canonical.y,z:i.canonical.z,isEastChild:i.canonical.x%2>0,isNorthChild:i.canonical.y%2==0,projectionType:this.map.projection,skirtHeight:this.map.terrainSkirtHeight<0?5*this.getLevelMaximumGeometricError(i.canonical.z):this.map.terrainSkirtHeight}),r=Rl.createChildTerrain(s);return e.terrainBounds.minimumHeight!=r.minimumHeight&&(e.terrainBounds.minimumHeight=r.minimumHeight),e.terrainBounds.maximumHeight!=r.maximumHeight&&(e.terrainBounds.maximumHeight=r.maximumHeight),e.tileBoundingRegion.isAmbiguousHeight=!1,this.parseTerrainData(r,this.map.painter.context,this.map.style.rasterSourceCache.quadtree,i,e)}isLoaded(){return this._terrainTiles.size>0&&0===this._tempRequestingSet.size}isTerrain(){return !0}loadAvailability(t){this.availability.state="loading",e.getJSON({url:t},((t,i)=>{t?(this.availability.state="error",this.fire(new e.ErrorEvent(t))):i&&(this.availability.addJSON(i),this.availability.state="loaded",this.map.needRepaint=!0);}));}getTileDataAvailable(e){if("loaded"===this.availability.state)return !(e.overscaledZ>this.availability._maximumLevel||!this.availability.isTileAvailable(e))}getLevelMaximumGeometricError(e){return e>5?this._levelZeroMaximumGeometricError/(1<<e):0}destroy(){this._terrainTiles.forEach(((e,t)=>{this._terrainTiles.get(t).destroy(),this._terrainTiles.delete(t);})),this._tempTerrainTiles.forEach(((e,t)=>{this._tempTerrainTiles.get(t).destroy(),this._tempTerrainTiles.delete(t);}));}}function Il(t,i,s,r){let n=22;const o=Math.pow(2,n),a=Math.floor(e.ProjectionProxy.latY(t[1],o,r)),l=Math.floor(e.ProjectionProxy.lngX(t[0],o,r));if(l>o||l<0||a>o||a<0||isNaN(l)||isNaN(a))return {intersectionZ:1/0,intersectionPoint:void 0,isUnderground:!1};const h=new e.OverscaledTileID(n,0,n,l,a,r);let _=null;const c=e.Vector3.fromDegrees(t[0],t[1],0);for(c.subtract(i);n>0;){const t=h.scaledTo(n).key;let r=s._tempTerrainTiles.get(t);if(r||(r=s._terrainTiles.get(t)),r&&r.data){_=r;let t=Dl(_,new e.Ray(i,e.Vector3.normalize(c,new e.Vector3)));if(t.intersectionPoint)return t;if(t=Dl(_,new e.Ray(i,e.Vector3.normalize(c,new e.Vector3).multiplyScalar(-1))),t.intersectionPoint)return t}n--;}return {intersectionZ:1/0,intersectionPoint:null,isUnderground:!1}}function Dl(t,i){let s,r=1/0;const n=new e.Vector3;if(t&&t.data){const o=t.data,a=o.sphereMaskedBoundsArray.float32,l=o.sphereIndexArray.uint16,h=o.rP;for(let t=0;t<o.skirtIndex;t+=3){const o=8*l[t],_=8*l[t+1],c=8*l[t+2],d=i.intersectTriangle([a[o]+h[0],a[o+1]+h[1],a[o+2]+h[2]],[a[_]+h[0],a[_+1]+h[1],a[_+2]+h[2]],[a[c]+h[0],a[c+1]+h[1],a[c+2]+h[2]],!1,n);if(d){const t=new e.Vector3(i.origin).distance(d);if(t<r){s=new e.Vector3(d),r=t;const n=e.Transforms.cartesian3ToCartographic(i.origin)[2]<e.Transforms.cartesian3ToCartographic(d)[2];return n&&(r=e.Transforms.cartesian3ToCartographic(d)[2]),{intersectionZ:r,intersectionPoint:s,isUnderground:n}}}}}return {intersectionZ:r,intersectionPoint:s,isUnderground:!1}}function Ol(t,i,s){t=e.LngLat.convert(t);let r=22;const n=Math.pow(2,r),o=Math.floor(e.ProjectionProxy.latY(t.lat,n,s)),a=Math.floor(e.ProjectionProxy.lngX(t.lng,n,s));if(a>n||a<0||o>n||o<0||isNaN(a)||isNaN(o))return;const l=new e.OverscaledTileID(r,0,r,a,o,s);for(;r>0;){const e=l.scaledTo(r).key;let n=i._tempTerrainTiles.get(e);if(n||(n=i._terrainTiles.get(e)),n&&n.data)return Ll(n,t,s);r--;}}function Ll(t,i,s){if(!t||!t.data)return;const r=t.data,n=e.getProjection(s),o=r.x,a=r.y,l=Math.pow(2,r.z),h=n.tileNumberToLngLat([o,a],1,l),_=n.tileNumberToLngLat([o+1,a+1],1,l),c=32767;let d=((i=e.LngLat.convert(i)).lng-h.lng)/(_.lng-h.lng);d*=c;let u=(i.lat-_.lat)/(h.lat-_.lat);u*=c;const m=r.indices,p=r.uBuffer,f=r.vBuffer,g=r.hBuffer;for(let t=0;t<r.skirtIndex;t+=3){const i=m[t],s=m[t+1],n=m[t+2],o=p[i],a=p[s],l=p[n],h=f[i],_=f[s],y=f[n];if(Vl(d,u,o,h,a,_,l,y)){const t=e.Intersections2D.computeBarycentricCoordinates(d,u,o,h,a,_,l,y);if(t.x>=-1e-15&&t.y>=-1e-15&&t.z>=-1e-15)return e.lerp(r.minimumHeight,r.maximumHeight,(t.x*g[i]+t.y*g[s]+t.z*g[n])/c)}}}function Vl(e,t,i,s,r,n,o,a){const l=Math.min(i,r,o),h=Math.max(i,r,o),_=Math.min(s,n,a),c=Math.max(s,n,a);return e>=l&&e<=h&&t>=_&&t<=c}class Nl{constructor(e){this.data=e.data,this.geometry=e.geometry,this.matrix=e.matrix;}destroy(){return this.geometry.destroy(),e.destroyObject(this)}}const Fl={vector:class extends e.Evented{constructor(t,i,s,r){if(super(),this.id=t,this.dispatcher=s,this.type="vector",this.minzoom=i.minzoom||0,this.maxzoom=i.maxzoom||22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,e.extend(this,e.pick(i,["url","scheme","tileSize"])),this._options=e.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,this.promoteId=i.promoteId,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this._adcode=i.adcode,this.clippingPlanes=i.clippingPlanes,this._imageryCache=new Map,this.setEventedParent(r);}set adcode(e){this._adcode!==e&&(this._adcode=e,this._eventedParent&&this._eventedParent.reload&&this._eventedParent.reload(!0));}get adcode(){return this._adcode}load(){this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Bt(this._options,this.map._transformRequest,((t,i)=>{this._tileJSONRequest=null,t?this.fire(new e.ErrorEvent(t)):i&&(e.extend(this,i),i.bounds&&(this.tileBounds=new _l(i.bounds,this.minzoom,this.maxzoom)),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})));}));}hasTile(e){return !this.tileBounds||this.tileBounds.contains(e)}onAdd(e){this.map=e,this.load();}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null);}serialize(){return e.extend({},this._options)}loadTile(t,i){const s=t.tileID.canonical.toRealCoord(this.scheme);let r=Et(t.tileID.canonical.url(this.tiles,this.scheme),0,0,s);this._adcode&&(r=`${r}&admincode=${this._adcode}`);const n={request:this.map._transformRequest(r,e.ResourceType.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:e.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,maxZoom:this.maxzoom,keepBuffer:t.keepBuffer};function o(e,s){return t.aborted?i(null):e?i(e):(s&&s.resourceTiming&&(t.resourceTiming=s.resourceTiming),this.map._refreshExpiredTiles&&t.setExpiryData(s),t.loadVectorData(s,this.map.painter),i(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}n.request.collectResourceTiming=this._collectResourceTiming,void 0===t.workerID||"expired"===t.state?t.workerID=this.dispatcher.send("loadTile",n,o.bind(this)):"loading"===t.state?t.reloadCallback=i:this.dispatcher.send("reloadTile",n,o.bind(this),t.workerID);}abortTile(e){this.dispatcher.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0,e.workerID);}unloadTile(e){e.unloadVectorData(),this.dispatcher.send("removeTile",{uid:e.uid,type:this.type,source:this.id},void 0,e.workerID);}hasTransition(){return !1}isEarthSource(){return !0}getImageryFromCache(e,t,i,s){const r=`${i}_${e}_${t}`;let n=this._imageryCache.get(r);return n||(n=new Ht(e,t,i,this),this._imageryCache.set(r,n)),n.addReference(s),n}createTileImagerySkeletons(t,i){const s=t.sourceCache.map._tilingScheme.tileXYToRectangle(t.tileID.canonical.x,t.tileID.canonical.y,t.tileID.canonical.z);this.projection||(this.projection=t.sourceCache.map.projection,this._tilingScheme=t.sourceCache.map._tilingScheme);const r=this._tilingScheme,n=e.Rectangle.intersection(r.rectangle,e.Rectangle.MAX_VALUE);if(!n)return [];const o=e.Rectangle.intersection(s,n);if(!o)return [];const a=i?.canonical.z,l=r.positionToTileXY(e.Rectangle.northwest(o),a),h=r.positionToTileXY(e.Rectangle.southeast(o),a);let _=s.width/512,c=s.height/512;const d=r.tileXYToRectangle(l.x,l.y,a);Math.abs(d.south-s.north)<c&&l.y<h.y&&++l.y,Math.abs(d.east-s.west)<_&&l.x<h.x&&++l.x;const u=r.tileXYToRectangle(h.x,h.y,a);Math.abs(u.north-s.south)<c&&h.y>l.y&&--h.y,Math.abs(u.west-s.east)<_&&h.x>l.x&&--h.x;const m=e.Rectangle.clone(s);let p,f,g=r.tileXYToRectangle(l.x,l.y,a),y=e.Rectangle.intersection(g,n);this.projection===e.ProjectionType.MERCATOR?(r.rectangleToNativeRectangle(m,m),r.rectangleToNativeRectangle(g,g),r.rectangleToNativeRectangle(y,y),r.rectangleToNativeRectangle(n,n),p=r.tileXYToNativeRectangle.bind(r),_=m.width/512,c=m.height/512):p=r.tileXYToRectangle.bind(r);let T,C=0,x=1;Math.abs(y.west-m.west)>=_&&(C=Math.min(1,(y.west-m.west)/m.width)),Math.abs(y.north-m.north)>=c&&(x=Math.max(0,(y.north-m.south)/m.height));const b=x,v=[];for(let t=i.canonical.x;t<=i.canonical.x;t++){f=C,g=p(t,l.y,a),y=e.Rectangle.simpleIntersection(g,n),C=Math.min(1,(y.east-m.west)/m.width),t===h.x&&Math.abs(y.east-m.east)<_&&(C=1),x=b;for(let s=i.canonical.y;s<=i.canonical.y;s++){T=x,g=p(t,s,a),y=e.Rectangle.simpleIntersection(g,n),x=Math.max(0,(y.south-m.south)/m.height),s===h.y&&Math.abs(y.south-m.south)<c&&(x=0);const i=new e.Vector4(f,1-T,C,1-x),r=m.width,o=m.height,l=r/g.width,_=o/g.height,d=new e.Vector4(l*(m.west-g.west)/r,_*(g.north-m.north)/o,l,_),u=this.getImageryFromCache(t,s,a);v.push(new Nt(u,i,d));}}return v}},raster:class extends Ut{constructor(t,i,s,r){if(super(),this.id=t,this.dispatcher=s,this.setEventedParent(r),this.minzoom=i.minzoom||0,this.maxzoom=i.maxzoom||22,i.bounds){const t=i.bounds.map((t=>e.toRadians(t)));this.rectangle=new e.Rectangle(...t);}else this.rectangle=e.Rectangle.MAX_VALUE;if(this.type="raster",this.scheme="xyz",this.tileSize=i.tileSize||512,this._options=e.extend({},i),e.extend(this,e.pick(i,["url","scheme","tileSize","tiles","serviceIndexUrl","capabilities","service","projection"])),this.service&&(this.scheme=this.service.toLowerCase()),"baidu"===this.scheme){const t=new e.Vector2(-33554054,-33746824),i=new e.Vector2(33554054,33746824);this._tilingScheme=new Dt({rectangleSouthwestInMeters:t,rectangleNortheastInMeters:i}),this.projection=e.ProjectionType.MERCATOR;}else this.projection===e.ProjectionType.LATLON?this._tilingScheme=new Ot:this.projection===e.ProjectionType.MERCATOR&&(this._tilingScheme=new Dt);this._imageryCache=new Map,this.workerIDMap=new Map;}load(){this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Bt(this._options,this.map._transformRequest,((t,i)=>{this._tileJSONRequest=null,t?this.fire(new e.ErrorEvent(t)):i&&(e.extend(this,i),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})));}));}onAdd(e){this.map=e,this.load();}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null);}serialize(){return e.extend({},this._options)}loadTile(t,i){if(!t.loadingImagery)return;let s,r;s="wmts"===this.scheme?t.loadingImagery.tileID.canonical.wmtsUrl(this.tiles,this._options.capabilities):"tms"===this.scheme?t.loadingImagery.tileID.canonical.tmsUrl(this.tiles):"baidu"===this.scheme?t.loadingImagery.tileID.canonical.baiduUrl(this.tiles):t.loadingImagery.tileID.canonical.url(this.tiles,this.projection);const n=Et(s),o={request:this.map._transformRequest(n,e.ResourceType.Tile),uid:`${t.loadingImagery.tileID.key}`,type:this.type,source:this.id};o.request.headers?o.request.headers.Accept="image/webp,*/*":o.request.headers={Accept:"image/webp,*/*"},0!==t.loadingImagery.state&&5!==t.loadingImagery.state||(r=this.dispatcher.send("loadTile",o,function(e,s){if(1===this.loadingImagery.state)return !s||e?(this.loadingImagery.state=5,i()):(this.loadingImagery.state=2,this.loadImage({data:s,painter:a.map.painter,justReloaded:!1,callback:()=>{i();},url:n}),void(s=null));a.workerIDMap.delete(t.loadingImagery.tileID.key);}.bind(t)),this.workerIDMap.set(t.loadingImagery.tileID.key,r),t.loadingImagery.state=1);const a=this;}abortTile(e){const t=this.workerIDMap.get(e.tileID.key);this.dispatcher.send("abortTile",{uid:e.tileID.key,type:this.type,source:this.id},void 0,t),this.workerIDMap.delete(e.tileID.key,t);}unloadTile(e){const t=this.workerIDMap.get(e.tileID.key);this.dispatcher.send("removeTile",{uid:e.tileID.key,type:this.type,source:this.id},void 0,t),this.workerIDMap.delete(e.tileID.key,t);}},geojson:zt,video:class extends ml{constructor(e,t,i,s){super(e,t,i,s),this.roundZoom=!0,this.type="video",this.options=t;}load(){const t=this.options;this.urls=[];for(const i of t.urls)this.urls.push(this.map._transformRequest(i,e.ResourceType.Source).url);e.getVideo(this.urls,((t,i)=>{t?this.fire(new e.ErrorEvent(t)):i&&(this.video=i,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.needRepaint=!0;})),this.map&&this.video.play(),this._finishLoading());}));}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)));}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,i=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,cl.members),this.indexBuffer=t.createIndexBuffer(this._indexArray)),this.sphereBoundsBuffer||(this.sphereBoundsBuffer=t.createVertexBuffer(this._sphereBoundsArray,dl.members),this.sphereIndexBuffer=t.createIndexBuffer(this._sphereIndexArray)),this.texture?this.video.paused||(this.texture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),i.texSubImage2D(e.WebGLConstants.TEXTURE_2D,0,0,0,e.WebGLConstants.RGBA,e.WebGLConstants.UNSIGNED_BYTE,this.video)):(this.texture=new e.Texture({context:t,image:this.video,pixelFormat:e.WebGLConstants.RGBA}),this.texture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE));for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture);}}serialize(){return {type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ml,canvas:class extends ml{constructor(t,i,s,r){super(t,i,s,r),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof e.window.HTMLCanvasElement||this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate;}load(){this.canvas||(this.canvas=this.options.canvas instanceof e.window.HTMLCanvasElement?this.options.canvas:e.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.needRepaint=!0;},this.pause=function(){this._playing=!1;},this._finishLoading());}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play();}onRemove(){this.pause();}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context,s=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,cl.members)),this.boundsVAO||(this.boundsVAO=new pl),this.texture?t?this.texture.update(this.canvas):this._playing&&(this.texture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),s.texSubImage2D(e.WebGLConstants.TEXTURE_2D,0,0,0,e.WebGLConstants.RGBA,e.WebGLConstants.UNSIGNED_BYTE,this.canvas)):(this.texture=new e.Texture({context:i,image:this.canvas,pixelFormat:e.WebGLConstants.RGBA}),this.texture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE));for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture);}}serialize(){return {type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of [this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return !0;return !1}isEarthSource(){return !1}},"3d-model":fl,"3d-tiles":gl,terrain:Bl,ellipsoid:class extends e.Evented{constructor(t,i,s,r){super(),this.id=t,this.dispatcher=s,this.map=i.map,this.setEventedParent(r),this.type="terrain",this.minzoom=0,this.maxzoom=14,this.scheme="xyz",this.tileSize=512,this._levelZeroMaximumGeometricError=78271.516964,delete i.map,this._options=e.extend({},i),e.extend(this,e.pick(i,["tileSize","minzoom","maxzoom"])),this._terrainTiles=new Map,this.workerIDMap=new Map,this.load();}load(){this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Bt(this._options,this.map._transformRequest,((t,i)=>{this._tileJSONRequest=null,t?this.fire(new e.ErrorEvent(t)):i&&(e.extend(this,i),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})));}));}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null);}serialize(){}loadTile(e,t){const i=e.data,s=e.tileID;if(this._terrainTiles.has(s.key))return t(null,this._terrainTiles.get(s.key));const r=this.dispatcher.send("loadRegularTile",{uid:s.key,tileID:s,type:this.type,source:this.id},function(e,r){if(2===i.terrainState){if(e||!r)return i.terrainState=0,t(e);if(i.terrainState=3,!this.map.style.rasterSourceCache.quadtree)return t(new Error);const n=this.parseTerrainData(r,this.map.painter.context,this.map.style.rasterSourceCache.quadtree,s);this._terrainTiles.set(s.key,n),t(null,n);}}.bind(this));this.workerIDMap.set(s.key,r),i.terrainState=2;}getTile(e){return this._terrainTiles.get(e.key)}abortTile(e){const t=this.workerIDMap.get(e.key);this.dispatcher.send("abortTile",{uid:e.key,type:this.type,source:this.id},void 0,t),this.workerIDMap.delete(e.key,t);}unloadTile(e,t){const i=this.workerIDMap.get(e.key);this.dispatcher.send("removeTile",{uid:e.key,type:this.type,source:this.id},void 0,i),this.workerIDMap.delete(e.key,i),this._terrainTiles.delete(e.key),t&&t();}parseTerrainData(t,i,s,r){const n=new e.Geometry({primitiveType:e.WebGLConstants.TRIANGLES,vertexBuffer:i.createVertexBuffer(t.sphereMaskedBoundsArray,yl.members),indexBuffer:i.createIndexBuffer(t.sphereIndexArray),wireframeIndexBuffer:i.createIndexBuffer(t.wireframeIndexArray),segmentVector:t.sphereSegments,tileBoundingRegion:s.getBoundingRegionById(r.key),tileId:r}),o=new e.Matrix4;return o.translate(t.rtc),new Nl({data:t,geometry:n,matrix:o})}hasTransition(){return !1}isTerrain(){return !1}getLevelMaximumGeometricError(e){return this._levelZeroMaximumGeometricError/(1<<e)}getTileDataAvailable(){}destroy(){this._terrainTiles.forEach(((e,t)=>{this._terrainTiles.get(t).destroy(),this._terrainTiles.delete(t);}));}}},Gl=function(t,i,s,r){if(!Fl[i.type])return {minzoom:i.minzoom,maxzoom:i.maxzoom,unloadGPUData(){},fire(){},hasTransition(){},serialize(){}};const n=new Fl[i.type](t,i,s,r);if(n.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${n.id}`);return e.bindAll(["load","abort","unload","serialize","prepare"],n),n};function kl(t,i){const s=new e.Matrix4;return s.translate([1,1,0]),s.scale([.5*t.width,.5*t.height,1]),s.multiplyRight(t.calculatePosMatrix(i.toUnwrapped()))}function Ul(e,t,i,s,r,n){const o=function(e,t,i){if(e)for(const s of e){const e=t[s];if(e&&e.source===i&&("extrusion"===e.type||"histogram"===e.type))return !0}else for(const e in t){const s=t[e];if(s.source===i&&("extrusion"===s.type||"histogram"===s.type))return !0}return !1}(s&&s.layers,t,e.id),a=r.maxPitchScaleFactor(),l=e.tilesIn(i,a,o);l.sort(zl);const h=[];for(const i of l)h.push({wrappedTileID:i.tileID.wrapped().key,queryResults:i.tile.queryRenderedFeatures(t,e._state,i.queryGeometry,i.cameraQueryGeometry,i.scale,s,r,a,kl(r,i.tileID),n)});const _=function(e){const t={},i={};for(const s of e){const e=s.queryResults,r=s.wrappedTileID,n=i[r]=i[r]||{};for(const i in e){const s=e[i],r=n[i]=n[i]||{},o=t[i]=t[i]||[];for(const e of s)r[e.featureIndex]||(r[e.featureIndex]=!0,e.feature.intersectionZ=e.intersectionZ,o.push(e.feature));}}return t}(h);for(const t in _)_[t].forEach((t=>{const i=e.getFeatureState(t.layer["source-layer"],t.id);t.source=t.layer.source,t.layer["source-layer"]&&(t.sourceLayer=t.layer["source-layer"]),t.state=i;}));return _}function Hl(t,i,s,r,n){const o={};if(!r.layers)return {};for(let a=0;a<r.layers.length;a++){const l=r.layers[a];if("extrusion"===i[l].type){const r=t.tilesInOfSphereExtrusion(s,n,i[l]),a=[];let h,_=1/0;const c=e.getRay({canvasX:s[0].x,canvasY:s[0].y,transform:n});r.map((t=>((t?t.featureTriangles:[]).map((t=>{const i=t.triangles;for(let s=0;s<i.length;s++){const r=c.intersectTriangle(...i[s],!1,[]);if(r){const i=new e.Vector3(c.origin).distance(r);i<_&&(_=i,h=t.feature);}}return null})),null))),h&&a.push({feature:h,intersectionZ:_}),o[`${l}`]=a;}}return o}function zl(e,t){const i=e.tileID,s=t.tileID;return i.overscaledZ-s.overscaledZ||i.canonical.y-s.canonical.y||i.wrap-s.wrap||i.canonical.x-s.canonical.x}function Wl(){return new e.window.Worker(JC.workerUrl)}class jl{constructor(){this.active={};}acquire(e){if(!this.workers){const e=jl.workerCount;for(this.workers=[];this.workers.length<e;)this.workers.push(new Wl);}return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],0===Object.keys(this.active).length&&(this.workers.forEach((e=>{e.terminate();})),this.workers=null);}isPreloaded(){return !!this.active.minemap_preloaded_worker_pool_id}numActive(){return Object.keys(this.active).length}}const Xl=Math.floor(e.exported.hardwareConcurrency/2)-1;let ql;function Kl(t,i){const s={};for(const e in t)"ref"!==e&&(s[e]=t[e]);return e.refProperties.forEach((e=>{e in i&&(s[e]=i[e]);})),s}function Jl(e){e=e.slice();const t=Object.create(null);for(let i=0;i<e.length;i++)t[e[i].id]=e[i];for(let i=0;i<e.length;i++)"ref"in e[i]&&(e[i]=Kl(e[i],t[e[i].ref]));return e}jl.workerCount=Math.max(Math.min(Xl,6),1);const Zl={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Yl(e,t,i,s){i.push({command:Zl.addSource,args:[e,t[e],{isOriginal:s}]});}function Ql(e,t,i){t.push({command:Zl.removeSource,args:[e]}),i[e]=!0;}function $l(e,t,i,s,r){Ql(e,i,s),Yl(e,t,i,r);}function eh(e,t,i){let r;for(r in e[i])if(e[i].hasOwnProperty(r)&&"data"!==r&&!s(e[i][r],t[i][r]))return !1;for(r in t[i])if(t[i].hasOwnProperty(r)&&"data"!==r&&!s(e[i][r],t[i][r]))return !1;return !0}function th(e,t,i,r,n,o){let a;for(a in t=t||{},e=e||{})e.hasOwnProperty(a)&&(s(e[a],t[a])||i.push({command:o,args:[r,a,t[a],n]}));for(a in t)t.hasOwnProperty(a)&&!e.hasOwnProperty(a)&&(s(e[a],t[a])||i.push({command:o,args:[r,a,t[a],n]}));}function ih(e){return e.id}function sh(e,t){return e[t.id]=t,e}class rh{constructor(e,t,i){const s=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(e/i),this.yCellCount=Math.ceil(t/i);for(let e=0;e<this.xCellCount*this.yCellCount;e++)s.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0;}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,i,s,r){this._forEachCell(t,i,s,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(s),this.bboxes.push(r);}insertCircle(e,t,i,s){this._forEachCell(t-s,i-s,t+s,i+s,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(i),this.circles.push(s);}_insertBoxCell(e,t,i,s,r,n){this.boxCells[r].push(n);}_insertCircleCell(e,t,i,s,r,n){this.circleCells[r].push(n);}_query(e,t,i,s,r,n){if(i<0||e>this.width||s<0||t>this.height)return !r&&[];const o=[];if(e<=0&&t<=0&&this.width<=i&&this.height<=s){if(r)return !0;for(let e=0;e<this.boxKeys.length;e++)o.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],i=this.circles[3*e+1],s=this.circles[3*e+2];o.push({key:this.circleKeys[e],x1:t-s,y1:i-s,x2:t+s,y2:i+s});}return n?o.filter(n):o}return this._forEachCell(e,t,i,s,this._queryCell,o,{hitTest:r,seenUids:{box:{},circle:{}}},n),r?o.length>0:o}_queryCircle(e,t,i,s,r){const n=e-i,o=e+i,a=t-i,l=t+i;if(o<0||n>this.width||l<0||a>this.height)return !s&&[];const h=[];return this._forEachCell(n,a,o,l,this._queryCellCircle,h,{hitTest:s,circle:{x:e,y:t,radius:i},seenUids:{box:{},circle:{}}},r),s?h.length>0:h}query(e,t,i,s,r){return this._query(e,t,i,s,!1,r)}hitTest(e,t,i,s,r){return this._query(e,t,i,s,!0,r)}hitTestCircle(e,t,i,s){return this._queryCircle(e,t,i,!0,s)}_queryCell(e,t,i,s,r,n,o,a){const l=o.seenUids,h=this.boxCells[r];if(null!==h){const r=this.bboxes;for(const _ of h)if(!l.box[_]){l.box[_]=!0;const h=4*_;if(e<=r[h+2]&&t<=r[h+3]&&i>=r[h+0]&&s>=r[h+1]&&(!a||a(this.boxKeys[_]))){if(o.hitTest)return n.push(!0),!0;n.push({key:this.boxKeys[_],x1:r[h],y1:r[h+1],x2:r[h+2],y2:r[h+3]});}}}const _=this.circleCells[r];if(null!==_){const r=this.circles;for(const h of _)if(!l.circle[h]){l.circle[h]=!0;const _=3*h;if(this._circleAndRectCollide(r[_],r[_+1],r[_+2],e,t,i,s)&&(!a||a(this.circleKeys[h]))){if(o.hitTest)return n.push(!0),!0;{const e=r[_],t=r[_+1],i=r[_+2];n.push({key:this.circleKeys[h],x1:e-i,y1:t-i,x2:e+i,y2:t+i});}}}}}_queryCellCircle(e,t,i,s,r,n,o,a){const l=o.circle,h=o.seenUids,_=this.boxCells[r];if(null!==_){const e=this.bboxes;for(const t of _)if(!h.box[t]){h.box[t]=!0;const i=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[i+0],e[i+1],e[i+2],e[i+3])&&(!a||a(this.boxKeys[t])))return n.push(!0),!0}}const c=this.circleCells[r];if(null!==c){const e=this.circles;for(const t of c)if(!h.circle[t]){h.circle[t]=!0;const i=3*t;if(this._circlesCollide(e[i],e[i+1],e[i+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[t])))return n.push(!0),!0}}}_forEachCell(e,t,i,s,r,n,o,a){const l=this._convertToXCellCoord(e),h=this._convertToYCellCoord(t),_=this._convertToXCellCoord(i),c=this._convertToYCellCoord(s);for(let d=l;d<=_;d++)for(let l=h;l<=c;l++)if(r.call(this,e,t,i,s,this.xCellCount*l+d,n,o,a))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,i,s,r,n){const o=s-e,a=r-t,l=i+n;return l*l>o*o+a*a}_circleAndRectCollide(e,t,i,s,r,n,o){const a=(n-s)/2,l=Math.abs(e-(s+a));if(l>a+i)return !1;const h=(o-r)/2,_=Math.abs(t-(r+h));if(_>h+i)return !1;if(l<=a||_<=h)return !0;const c=l-a,d=_-h;return c*c+d*d<=i*i}}const nh=1e3;class oh{constructor(t,i,s){this.style=t;const r=this.style.symbolMatrixHelper;this.grid=i||new rh(r.width+2e3,r.height+2e3,25),this.ignoredGrid=s||new rh(r.width+2e3,r.height+2e3,25),this.pitchfactor=Math.cos(t.symbolMatrixHelper.getMapViewParams().pitch*e.CONSTS.TRANSFORM.DEG_TO_RAD)*t.symbolMatrixHelper.cameraToCenterDistance,this.screenRightBoundary=r.width+nh,this.screenBottomBoundary=r.height+nh,this.gridRightBoundary=r.width+2e3,this.gridBottomBoundary=r.height+2e3;}placeCollisionBox(e,t,i,s,r,n){const o=this.projectAndGetPerspectiveRatio(s,e.anchorPointX,e.anchorPointY,n),a=i*o.perspectiveRatio,l=e.x1*a+o.point.x,h=e.y1*a+o.point.y,_=e.x2*a+o.point.x,c=e.y2*a+o.point.y;return !this.isInsideGrid(l,h,_,c)||!t&&this.grid.hitTest(l,h,_,c,r)?{box:[],offscreen:!1}:{box:[l,h,_,c],offscreen:this.isOffscreen(l,h,_,c)}}approximateTileDistance(e,t,i,s,r){const n=e.lastSegmentViewportDistance*i;return e.prevTileDistance+n+((r?1:s/this.pitchfactor)-1)*n*Math.abs(Math.sin(t))}placeCollisionCircles(t,i,s,r,n,o,a,l,h,_,c,d,u,m){const p=[],f=this.projectAnchor(_,o.anchorX,o.anchorY),g=h/24,y=o.lineOffsetX*h,T=o.lineOffsetY*h,C=new e.pointGeometry3d(o.anchorX,o.anchorY),x=e.project(C,c).point,b=e.placeFirstAndLastGlyph(g,l,y,T,!1,x,C,o,a,c,{},!0);let v=!1,w=!1,S=!0;const A=f.perspectiveRatio*r,E=1/(r*s);let M=0,P=0;b&&(M=this.approximateTileDistance(b.first.tileDistance,b.first.angle,E,f.cameraDistance,u),P=this.approximateTileDistance(b.last.tileDistance,b.last.angle,E,f.cameraDistance,u));for(let e=0;e<t.length;e+=5){const s=t[e],r=t[e+1],n=t[e+2],o=t[e+3];if(!b||o<-M||o>P){ah(t,e,!1);continue}const a=this.projectPoint(_,s,r),l=n*A;if(p.length>0){const i=a.x-p[p.length-4],s=a.y-p[p.length-3];if(l*l*2>i*i+s*s&&e+8<t.length){const i=t[e+8];if(i>-M&&i<P){ah(t,e,!1);continue}}}p.push(a.x,a.y,l,e/5),ah(t,e,!0);const h=a.x-l,c=a.y-l,u=a.x+l,f=a.y+l;if(S=S&&this.isOffscreen(h,c,u,f),w=w||this.isInsideGrid(h,c,u,f),!i&&this.grid.hitTestCircle(a.x,a.y,l,m)){if(!d)return {circles:[],offscreen:!1};v=!0;}}return {circles:v||!w?[]:p,offscreen:S}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return {};const i=[];let s=1/0,r=1/0,n=-1/0,o=-1/0;for(const a of t){const t=new e.pointGeometry3d(a.x+nh,a.y+nh);s=Math.min(s,t.x),r=Math.min(r,t.y),n=Math.max(n,t.x),o=Math.max(o,t.y),i.push(t);}const a=this.grid.query(s,r,n,o).concat(this.ignoredGrid.query(s,r,n,o)),l={},h={};for(const t of a){const s=t.key;if(void 0===l[s.bucketInstanceId]&&(l[s.bucketInstanceId]={}),l[s.bucketInstanceId][s.featureIndex])continue;const r=[new e.pointGeometry3d(t.x1,t.y1),new e.pointGeometry3d(t.x2,t.y1),new e.pointGeometry3d(t.x2,t.y2),new e.pointGeometry3d(t.x1,t.y2)];e.polygonIntersectsPolygon(i,r)&&(l[s.bucketInstanceId][s.featureIndex]=!0,void 0===h[s.bucketInstanceId]&&(h[s.bucketInstanceId]=[]),h[s.bucketInstanceId].push(s.featureIndex));}return h}insertCollisionBox(e,t,i,s,r){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:s,collisionGroupID:r},e[0],e[1],e[2],e[3]);}insertCollisionCircles(e,t,i,s,r){const n=t?this.ignoredGrid:this.grid,o={bucketInstanceId:i,featureIndex:s,collisionGroupID:r};for(let t=0;t<e.length;t+=4)n.insertCircle(o,e[t],e[t+1],e[t+2]);}projectAnchor(t,i,s){const r=[i,s,0,1];return e.xyTransformMat4(r,r,t),{perspectiveRatio:.5+this.style.symbolMatrixHelper.cameraToCenterDistance/r[3]*.5,cameraDistance:r[3]}}projectPoint(t,i,s){const r=[i,s,0,1];return e.xyTransformMat4(r,r,t),new e.pointGeometry3d((r[0]/r[3]+1)/2*this.style.symbolMatrixHelper.width+nh,(-r[1]/r[3]+1)/2*this.style.symbolMatrixHelper.height+nh)}projectAndGetPerspectiveRatio(t,i,s,r){const n=[i,s,r,1];0!==r?e.transformMat4(n,n,t):e.xyTransformMat4(n,n,t);const o=new e.pointGeometry3d((n[0]/n[3]+1)/2*this.style.symbolMatrixHelper.width+nh,(-n[1]/n[3]+1)/2*this.style.symbolMatrixHelper.height+nh),a=2*Math.cos(this.style.symbolMatrixHelper.getMapViewParams().pitch*e.CONSTS.TRANSFORM.DEG_TO_RAD);return {point:o,perspectiveRatio:(.5+this.style.symbolMatrixHelper.cameraToCenterDistance/n[3]*.5)*(3-a)}}isOffscreen(e,t,i,s){return i<nh||e>=this.screenRightBoundary||s<nh||t>this.screenBottomBoundary}isInsideGrid(e,t,i,s){return !0}}function ah(e,t,i){e[t+4]=i?1:0;}const lh=e.properties.layout;class hh{constructor(e,t,i,s){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):s&&i?1:0,this.placed=i;}isHidden(){return 0===this.opacity&&!this.placed}}class _h{constructor(e,t,i,s,r){this.text=new hh(e?e.text:null,t,i,r),this.icon=new hh(e?e.icon:null,t,s,r);}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ch{constructor(e,t,i){this.text=e,this.icon=t,this.skipFade=i;}}class dh{constructor(e,t,i,s,r){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=i,this.bucketIndex=s,this.tileID=r;}}class uh{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={};}get(e){if(this.crossSourceCollisions)return {ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t};}return this.collisionGroups[e]}}class mh{constructor(e,t,i){this.style=e,this.collisionIndex=new oh(this.style),this.placements={},this.opacities={},this.stale=!1,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new uh(i);}placeLayerTile(t,i,s,r){const n=i.getBucket(t),o=i.latestFeatureIndex;if(!n||!o||t.id!==n.layerIds[0])return;const a=i.collisionBoxArray,l=n.layers[0].layout,h=Math.pow(2,this.style.symbolMatrixHelper.zoom-i.tileID.overscaledZ),_=i.tileSize/e.EXTENT,c=this.style.symbolMatrixHelper.calculatePosMatrix(i.tileID.toUnwrapped()),d=e.getLabelPlaneMatrix(c,"map"===l.get("text-pitch-alignment"),"map"===l.get("text-rotation-alignment"),this.style.symbolMatrixHelper,e.pixelsToTileUnits(i,1,this.style.getNearestTileZoom())),u=e.getLabelPlaneMatrix(c,"map"===l.get("icon-pitch-alignment"),"map"===l.get("icon-rotation-alignment"),this.style.symbolMatrixHelper,e.pixelsToTileUnits(i,1,this.style.getNearestTileZoom()));this.retainedQueryData[n.bucketInstanceId]=new dh(n.bucketInstanceId,o,n.sourceLayerIndex,n.index,i.tileID),this.placeLayerBucket(n,c,d,u,h,_,s,r,a);}placeLayerBucket(t,i,s,r,n,o,a,l,h){const _=t.layers[0].layout,c=e.evaluateSizeForZoom(t.textSizeData,this.style.getNearestTileZoom(),lh&&lh.properties&&lh.properties["text-size"]),d=_.get("text-optional"),u=_.get("icon-optional"),m=this.collisionGroups.get(t.sourceID);for(const r of t.symbolInstances)if(!l[r.crossTileID]){let p=!1,f=!1,g=!0,y=null,T=null,C=null,x=0,b=0;if(r.collisionArrays||(r.collisionArrays=t.deserializeCollisionBoxes(h,r.textBoxStartIndex,r.textBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex)),r.collisionArrays.textFeatureIndex&&(x=r.collisionArrays.textFeatureIndex),r.collisionArrays.textBox){const e=0;y=this.collisionIndex.placeCollisionBox(r.collisionArrays.textBox,_.get("text-allow-overlap"),o,i,m.predicate,e),p=y.box.length>0,g=g&&y.offscreen;}const v=r.collisionArrays.textCircles;if(v){const l=t.text.placedSymbolArray.get(r.placedTextSymbolIndices[0]),h=e.evaluateSizeForFeature(t.textSizeData,c,l);T=this.collisionIndex.placeCollisionCircles(v,_.get("text-allow-overlap"),n,o,r.key,l,t.lineVertexArray,t.glyphOffsetArray,h,i,s,a,"map"===_.get("text-pitch-alignment"),m.predicate),p=_.get("text-allow-overlap")||T.circles.length>0,g=g&&T.offscreen;}if(r.collisionArrays.iconFeatureIndex&&(b=r.collisionArrays.iconFeatureIndex),r.collisionArrays.iconBox){const e=0;C=this.collisionIndex.placeCollisionBox(r.collisionArrays.iconBox,_.get("icon-allow-overlap"),o,i,m.predicate,e),f=C.box.length>0,g=g&&C.offscreen;}const w=d||0===r.numGlyphVertices&&0===r.numVerticalGlyphVertices,S=u||0===r.numIconVertices;w||S?S?w||(f=f&&p):p=f&&p:f=p=f&&p,p&&y&&this.collisionIndex.insertCollisionBox(y.box,_.get("text-ignore-placement"),t.bucketInstanceId,x,m.ID),f&&C&&this.collisionIndex.insertCollisionBox(C.box,_.get("icon-ignore-placement"),t.bucketInstanceId,b,m.ID),p&&T&&this.collisionIndex.insertCollisionCircles(T.circles,_.get("text-ignore-placement"),t.bucketInstanceId,x,m.ID),this.placements[r.crossTileID]=new ch(p,f,g||t.justReloaded),l[r.crossTileID]=!0;}t.justReloaded=!1;}commit(e,t){this.commitTime=t;let i=!1;const s=e&&0!==this.fadeDuration?(this.commitTime-e.commitTime)/this.fadeDuration:1,r=e?e.opacities:{};for(const e in this.placements){const t=this.placements[e],n=r[e];n?(this.opacities[e]=new _h(n,s,t.text,t.icon),i=i||t.text!==n.text.placed||t.icon!==n.icon.placed):(this.opacities[e]=new _h(null,s,t.text,t.icon,t.skipFade),i=i||t.text||t.icon);}for(const e in r){const t=r[e];if(!this.opacities[e]){const r=new _h(t,s,!1,!1);r.isHidden()||(this.opacities[e]=r,i=i||t.text.placed||t.icon.placed);}}i?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t);}updateLayerOpacities(e,t){const i={};for(const s of t){const t=s.getBucket(e);t&&s.latestFeatureIndex&&e.id===t.layerIds[0]&&this.updateBucketOpacities(t,i,s.collisionBoxArray);}}updateBucketOpacities(t,i,s){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasCollisionBoxData()&&t.collisionBox.collisionVertexArray.clear(),t.hasCollisionCircleData()&&t.collisionCircle.collisionVertexArray.clear();const r=t.layers[0].layout,n=new _h(null,0,!1,!1,!0),o=new _h(null,0,r.get("text-allow-overlap"),r.get("icon-allow-overlap"),!0);for(let e=0;e<t.symbolInstances.length;e++){const r=t.symbolInstances[e],a=i[r.crossTileID];let l=this.opacities[r.crossTileID];a?l=n:l||(l=o,this.opacities[r.crossTileID]=l),i[r.crossTileID]=!0;const h=r.numIconVertices>0;if(r.numGlyphVertices>0||r.numVerticalGlyphVertices>0){const e=vh(l.text),i=(r.numGlyphVertices+r.numVerticalGlyphVertices)/4;for(let s=0;s<i;s++)t.text.opacityVertexArray.emplaceBack(e);for(const e of r.placedTextSymbolIndices)t.text.placedSymbolArray.get(e).hidden=l.text.isHidden();}if(h){const i=vh(l.icon);for(let e=0;e<r.numIconVertices/4;e++)t.icon.opacityVertexArray.emplaceBack(i);t.icon.placedSymbolArray.get(e).hidden=l.icon.isHidden();}r.collisionArrays||(r.collisionArrays=t.deserializeCollisionBoxes(s,r.textBoxStartIndex,r.textBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex));const _=r.collisionArrays;if(_){_.textBox&&t.hasCollisionBoxData()&&ph(t.collisionBox.collisionVertexArray,l.text.placed,!1),_.iconBox&&t.hasCollisionBoxData()&&ph(t.collisionBox.collisionVertexArray,l.icon.placed,!1);const e=_.textCircles;if(e&&t.hasCollisionCircleData())for(let i=0;i<e.length;i+=5)ph(t.collisionCircle.collisionVertexArray,l.text.placed,a||0===e[i+4]);}}t.sortFeatures(this.style.symbolMatrixHelper.getMapViewParams().bearing*e.CONSTS.TRANSFORM.DEG_TO_RAD),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasCollisionBoxData()&&t.collisionBox.collisionVertexBuffer&&t.collisionBox.collisionVertexBuffer.updateData(t.collisionBox.collisionVertexArray),t.hasCollisionCircleData()&&t.collisionCircle.collisionVertexBuffer&&t.collisionCircle.collisionVertexBuffer.updateData(t.collisionCircle.collisionVertexArray);}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e){return "undefined"!==this.commitTime&&this.commitTime+this.fadeDuration>e}setStale(){this.stale=!0;}}function ph(e,t,i){e.emplaceBack(t?1:0,i?1:0),e.emplaceBack(t?1:0,i?1:0),e.emplaceBack(t?1:0,i?1:0),e.emplaceBack(t?1:0,i?1:0);}const fh=Math.pow(2,25),gh=Math.pow(2,24),yh=Math.pow(2,17),Th=Math.pow(2,16),Ch=Math.pow(2,9),xh=Math.pow(2,8),bh=Math.pow(2,1);function vh(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,i=Math.floor(127*e.opacity);return i*fh+t*gh+i*yh+t*Th+i*Ch+t*xh+i*bh+t}class wh{constructor(){this._currentTileIndex=0,this._seenCrossTileIDs={};}continuePlacement(e,t,i,s,r){for(;this._currentTileIndex<e.length;)if(t.placeLayerTile(s,e[this._currentTileIndex],i,this._seenCrossTileIDs),this._currentTileIndex++,r())return !0}}class Sh{constructor(e,t,i,s,r,n,o){this.placement=new mh(e,n,o),this._currentPlacementIndex=i.length-1,this._forceFullPlacement=s,this._showCollisionBoxes=r,this._done=!1;}isDone(){return this._done}continuePlacement(t,i,s){const r=e.exported.now(),n=()=>{const t=e.exported.now()-r;return !this._forceFullPlacement&&t>2};for(;this._currentPlacementIndex>=0;){const e=i[t[this._currentPlacementIndex]];if("symbol"===e.type||"symtracking"===e.type){if(this._inProgressLayer||(this._inProgressLayer=new wh),this._inProgressLayer.continuePlacement(s[e.source],this.placement,this._showCollisionBoxes,e,n))return;delete this._inProgressLayer;}this._currentPlacementIndex--;}this._done=!0;}commit(e,t){return this.placement.commit(e,t),this.placement}}const Ah=512/e.EXTENT/2,Eh=new Map([[-10,Ah/.0009765625],[-9,Ah/.001953125],[-8,Ah/.00390625],[-7,Ah/.0078125],[-6,Ah/.015625],[-5,Ah/.03125],[-4,Ah/.0625],[-3,Ah/.125],[-2,Ah/.25],[-1,Ah/.5],[0,Ah/1],[1,Ah/2],[2,Ah/4],[3,Ah/8],[4,Ah/16],[5,Ah/32],[6,Ah/64],[7,Ah/128],[8,Ah/256],[9,Ah/512],[10,Ah/1024]]);class Mh{constructor(e,t,i){this.tileID=e,this.indexedSymbolInstances={},this.bucketInstanceId=i;for(const i of t){const t=i.key;this.indexedSymbolInstances[t]||(this.indexedSymbolInstances[t]=[]),this.indexedSymbolInstances[t].push({crossTileID:i.crossTileID,coord:this.getScaledCoordinates(i,e)});}}getScaledCoordinates(t,i){const s=Eh.get(i.canonical.z-this.tileID.canonical.z),r=t.anchor;return {x:Math.floor((i.canonical.x*e.EXTENT+r.x)*s),y:Math.floor((i.canonical.y*e.EXTENT+r.y)*s)}}findMatches(e,t,i){const s=this.tileID.canonical.z<t.canonical.z?1:Math.pow(2,this.tileID.canonical.z-t.canonical.z);for(let r=0;r<e.length;r++){const n=e[r];if(n.crossTileID)continue;const o=this.indexedSymbolInstances[n.key];if(!o)continue;const a=this.getScaledCoordinates(n,t);for(let e=0;e<o.length;e++){const t=o[e];if(Math.abs(t.coord.x-a.x)<=s&&Math.abs(t.coord.y-a.y)<=s&&!i[t.crossTileID]){i[t.crossTileID]=!0,n.crossTileID=t.crossTileID;break}}}}}class Ph{constructor(){this.maxCrossTileID=0;}generate(){return ++this.maxCrossTileID}}class Rh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0;}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const e in this.indexes){const i=this.indexes[e],s={};for(const e in i){const r=i[e];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),s[r.tileID.key]=r;}this.indexes[e]=s;}this.lng=e;}addBucket(e,t,i){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return !1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key]);}for(const e of t.symbolInstances)e.crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const s=this.usedCrossTileIDs[e.overscaledZ];for(const i in this.indexes){const r=this.indexes[i];if(Number(i)>e.overscaledZ)for(const i in r){const n=r[i];n.tileID.isChildOf(e)&&n.findMatches(t.symbolInstances,e,s);}else {const n=r[e.scaledTo(Number(i)).key];n&&n.findMatches(t.symbolInstances,e,s);}}for(const e of t.symbolInstances)e.crossTileID||(e.crossTileID=i.generate(),s[e.crossTileID]=!0);return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Mh(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const i in t.indexedSymbolInstances)for(const s of t.indexedSymbolInstances[i])delete this.usedCrossTileIDs[e][s.crossTileID];}removeStaleBuckets(e){let t=!1;for(const i in this.indexes){const s=this.indexes[i];for(const r in s)e[s[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,s[r]),delete s[r],t=!0);}return t}}class Bh{constructor(){this.layerIndexes={},this.crossTileIDs=new Ph,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={};}addLayer(e,t){let i=this.layerIndexes[e.id];void 0===i&&(i=this.layerIndexes[e.id]=new Rh);let s=!1;const r={};for(const n of t){const t=n.getBucket(e);t&&e.id===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(n.tileID,t,this.crossTileIDs)&&(s=!0),r[t.bucketInstanceId]=!0);}return i.removeStaleBuckets(r)&&(s=!0),s}pruneUnusedLayers(e){const t={};e.forEach((e=>{t[e]=!0;}));for(const e in this.layerIndexes)t[e]||delete this.layerIndexes[e];}}const Ih=e.createLayout([{name:"a_PositionHighAndSize",type:"Float32",components:4},{name:"a_PositionLowAndOutline",type:"Float32",components:4},{name:"a_CompressedAttribute0",type:"Float32",components:3},{name:"a_CompressedAttribute1",type:"Float32",components:4},{name:"a_ScaleByDistance",type:"Float32",components:4},{name:"a_DistanceDisplayCondition",type:"Float32",components:2}]);class Dh{constructor(t,i){t=e.defaultValue(t,0),this._near=t,i=e.defaultValue(i,Number.MAX_VALUE),this._far=i;}get near(){return this._near}set near(e){this._near=e;}get far(){return this._far}set far(e){this._far=e;}pack(t,i,s){if(!e.defined(t))throw new Error("value is required");if(!e.defined(i))throw new Error("array is required");return s=e.defaultValue(s,0),i[s++]=t.near,i[s]=t.far,i}unpack(t,i,s){if(!e.defined(t))throw new Error("array is required");return i=e.defaultValue(i,0),e.defined(s)||(s=new Dh),s.near=t[i++],s.far=t[i],s}static equals(t,i){return t===i||e.defined(t)&&e.defined(i)&&t.near===i.near&&t.far===i.far}equals(e){return Dh.equals(this,e)}static clone(t,i){if(e.defined(t))return e.defined(i)||(i=new Dh),i.near=t.near,i.far=t.far,i}clone(e){return Dh.clone(this,e)}}class Oh{constructor(t,i,s,r){this.near=e.defaultValue(t,0),this.nearValue=e.defaultValue(i,0),this.far=e.defaultValue(s,1),this.farValue=e.defaultValue(r,0);}static clone(t,i){if(e.defined(t))return e.defined(i)?(i.near=t.near,i.nearValue=t.nearValue,i.far=t.far,i.farValue=t.farValue,i):new Oh(t.near,t.nearValue,t.far,t.farValue)}clone(e){return Oh.clone(this,e)}pack(t,i,s){if(!e.defined(t))throw new Error("value is required");if(!e.defined(i))throw new Error("array is required");return s=e.defaultValue(s,0),i[s++]=t.near,i[s++]=t.nearValue,i[s++]=t.far,i[s]=t.farValue,i}unpack(t,i,s){if(!e.defined(t))throw new Error("array is required");return i=e.defaultValue(i,0),e.defined(s)||(s=new Oh),s.near=t[i++],s.nearValue=t[i++],s.far=t[i++],s.farValue=t[i],s}static equals(t,i){return t===i||e.defined(t)&&e.defined(i)&&t.near===i.near&&t.nearValue===i.nearValue&&t.far===i.far&&t.farValue===i.farValue}equals(e){Oh.equals(this,e);}}class Lh{constructor(t){let i=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).translucencyByDistance,s=t.scaleByDistance,r=t.distanceDisplayCondition;if(e.defined(i)){if(i.far<=i.near)throw new Error("translucencyByDistance.far must be greater than translucencyByDistance.near.");i=Oh.clone(i);}if(e.defined(s)){if(s.far<=s.near)throw new Error("scaleByDistance.far must be greater than scaleByDistance.near.");s=Oh.clone(s);}if(e.defined(r)){if(r.far<=r.near)throw new Error("distanceDisplayCondition.far must be greater than distanceDisplayCondition.near.");r=Dh.clone(r);}this._show=e.defaultValue(t.show,!0),this._position=e.Vector3.clone(e.defaultValue(t.position,e.Vector3.ZERO)),this._outlineColor=e.Color.clone(e.Color.parse(e.defaultValue(t.outlineColor,new e.Color(0,0,0,0)))),this._color=e.Color.clone(e.Color.parse(e.defaultValue(t?.color,new e.Color(1,1,1,1)))),this._outlineWidth=e.defaultValue(t.outlineWidth,0),this._pixelSize=e.defaultValue(t.pixelSize,10),this.properties=e.defaultValue(t.properties,void 0),this._scaleByDistance=s,this._translucencyByDistance=i,this._distanceDisplayCondition=r,this.id=t.id,this._index=-1;}get show(){return this._show}set show(t){if(!e.defined(t))throw new Error("value is required.");this._show!==t&&(this._show=t,this._pointPrimitiveCollection._dirty=!0);}get position(){return this._position}set position(t){if(!e.defined(t))throw new Error("value is required.");if(!(t instanceof e.Vector3))throw new Error("position is not the type of Vector3.");e.Vector3.equals(this._position,t)||(e.Vector3.clone(t,this._position),this._pointPrimitiveCollection._dirty=!0);}get scaleByDistance(){return this._scaleByDistance}set scaleByDistance(t){if(e.defined(t)&&t.far<=t.near)throw new Error("far distance must be greater than near distance.");const i=this._scaleByDistance;Oh.equals(i,t)||(this._scaleByDistance=Oh.clone(t,i),this._pointPrimitiveCollection._dirty=!0);}get translucencyByDistance(){return this._translucencyByDistance}set translucencyByDistance(t){if(e.defined(t)&&t.far<=t.near)throw new Error("far distance must be greater than near distance.");const i=this._translucencyByDistance;Oh.equals(i,t)||(this._translucencyByDistance=Oh.clone(t,i),this._pointPrimitiveCollection._dirty=!0);}get pixelSize(){return this._pixelSize}set pixelSize(t){if(!e.defined(t))throw new Error("value is required.");this._pixelSize!==t&&(this._pixelSize=t,this._pointPrimitiveCollection._dirty=!0);}get color(){return this._color}set color(t){if(!e.defined(t))throw new Error("value is required.");if(t instanceof e.Color||"string"==typeof t){const i=e.Color.parse(t);e.Color.equals(this._color,i)||(e.Color.clone(i,this._color),this._pointPrimitiveCollection._dirty=!0);}}get outlineColor(){return this._outlineColor}set outlineColor(t){if(!e.defined(t))throw new Error("value is required.");if(t instanceof e.Color||"string"==typeof t){const i=e.Color.parse(t);e.Color.equals(this._outlineColor,i)||(e.Color.clone(i,this._outlineColor),this._pointPrimitiveCollection._dirty=!0);}}get outlineWidth(){return this._outlineWidth}set outlineWidth(t){if(!e.defined(t))throw new Error("value is required.");this._outlineWidth!==t&&(this._outlineWidth=t,this._pointPrimitiveCollection._dirty=!0);}get distanceDisplayCondition(){return this._distanceDisplayCondition}set distanceDisplayCondition(t){if(e.defined(t)&&t.far<=t.near)throw new Error("far must be greater than near");Dh.equals(this._distanceDisplayCondition,t)||(this._distanceDisplayCondition=Dh.clone(t,this._distanceDisplayCondition),this._pointPrimitiveCollection._dirty=!0);}destroy(){return this._show=void 0,this._position=void 0,this._color=void 0,this._outlineColor=void 0,this._outlineWidth=void 0,this._pixelSize=void 0,this._scaleByDistance=void 0,this._translucencyByDistance=void 0,this._distanceDisplayCondition=void 0,this.id=void 0,this._pointPrimitiveCollection=void 0,this._index=void 0,e.destroyObject(this)}}const Vh=e.createLayout([{name:"a_PickColor",components:4,type:"Float32"}]),Nh=new e.EncodedVector3,Fh=65536,Gh=256;class kh{constructor(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this.id=e.defaultValue(t.id,e.uniqueId()),this._allowPick=e.defaultValue(t.allowPick,!0),this._depthTest=e.defaultValue(t.depthTest,!0),this._shaderSource=new e.ShaderSource({type:"point"}),this._createVertexArray=!1,this._pointPrimitives=[];const i=this;e.defaultValue(t.pointPrimitives,[]).forEach((e=>{if(!(e instanceof Lh))throw new Error("pointPrimitives contains the type is not PointPrimitive!");i.add(e);})),this._shaderScaleByDistance=!1,this._shaderTranslucencyByDistance=!1,this._shaderDistanceDisplayCondition=!1,this._maxPixelSize=1,this._boundingSphere=void 0,this._boundingBox=void 0,this.show=e.defaultValue(t.show,!0),this.modelMatrix=e.Matrix4.clone(e.defaultValue(t.modelMatrix,e.Matrix4.IDENTITY)),this._modelMatrix=e.Matrix4.clone(e.Matrix4.IDENTITY),this._maxTotalPointSize=1,this._opaquePrimitives=[],this._transLucentPrimitives=[],this._vertexArray=new e.StructArrayLayout21f84,this._pickColorVertexArray=new e.StructArrayLayout4f16,this._vertexBuffer=void 0,this._geometry=new e.Geometry({type:"pointCollection"}),this._materialOpaque=new e.Material({type:"point",renderState:{depthTest:this._depthTest?e.renderStateEnum.enableDepthTest:e.renderStateEnum.disableDepthTest,depthMask:e.renderStateEnum.enableDepthMask},defines:{OPAQUE:!0}}),this._materialOpaque._uniforms.set("u_maxTotalPointSize",(()=>i._maxTotalPointSize)),this._materialTranslucent=new e.Material({type:"point",renderState:{depthTest:this._depthTest?e.renderStateEnum.enableDepthTest:e.renderStateEnum.disableDepthTest,depthMask:e.renderStateEnum.disableDepthMask,blending:e.renderStateEnum.enableBlending}}),this._materialTranslucent._uniforms.set("u_maxTotalPointSize",(()=>i._maxTotalPointSize)),this._opaquePrimitive=void 0,this._translucentPrimitive=void 0,this._dirty=!1;}get length(){return this._pointPrimitives.length}add(e){if(!(e instanceof Lh))throw new Error("pointPrimitive is not type of PointPrimitive!");return e._pointPrimitiveCollection=this,e._index=this._pointPrimitives.length,this._pointPrimitives.push(e),this._createVertexArray=!0,e}remove(e,t){if(this.contains(e)){this._pointPrimitives.splice(e._index,1),this._createVertexArray=!0,t&&e.destroy();for(let e=0,t=0;e<this._pointPrimitives.length;++e){const i=this._pointPrimitives[e];i&&(i._index=t++);}return !0}return !1}removeAll(e){const t=this._pointPrimitives.length;for(let i=0;i<t;++i)this._pointPrimitives[i]&&e&&this._pointPrimitives[i].destroy();this._pointPrimitives=[],this._createVertexArray=!0;}contains(t){return e.defined(t)&&t._pointPrimitiveCollection===this}get(t){if(!e.defined(t))throw new Error("index is required.");return this._pointPrimitives[t]}_writePointPrimitive(t){e.EncodedVector3.fromVector3(t.position,Nh);const i=t.pixelSize,s=t.outlineWidth;this._maxPixelSize=Math.max(this._maxPixelSize,i+s);const r=Nh.high,n=Nh.low,o=t.color,a=t.outlineColor;let l=e.Color.floatToByte(o.r),h=e.Color.floatToByte(o.g),_=e.Color.floatToByte(o.b);const c=l*Fh+h*Gh+_;l=e.Color.floatToByte(a.r),h=e.Color.floatToByte(a.g),_=e.Color.floatToByte(a.b);const d=l*Fh+h*Gh+_,u=e.Color.floatToByte(o.a)*Fh+e.Color.floatToByte(a.a)*Gh;let m=0,p=1,f=1,g=1;const y=t.translucencyByDistance;e.defined(y)&&(m=y.near,p=y.nearValue,f=y.far,g=y.farValue,1===p&&1===g||(this._shaderTranslucencyByDistance=!0));let T=t.show;0===t.color.alpha&&0===t.outlineColor.alpha&&(T=!1),p=e.CONSTS.CesiumMath.clamp(p,0,1),p=1===p?255:255*p|0;const C=(T?1:0)*Gh+p;g=e.CONSTS.CesiumMath.clamp(g,0,1),g=1===g?255:255*g|0;const x=g;let b=0,v=1,w=1,S=1;const A=t.scaleByDistance;e.defined(A)&&(b=A.near,v=A.nearValue,w=A.far,S=A.farValue,1===v&&1===S||(this._shaderScaleByDistance=!0));let E=0,M=Number.MAX_VALUE;const P=t.distanceDisplayCondition;e.defined(P)&&(E=P.near,M=P.far,E*=E,M*=M,this._shaderDistanceDisplayCondition=!0),this._vertexArray.emplaceBack(r.x,r.y,r.z,i,n.x,n.y,n.z,s,c,d,u,C,x,m,f,b,v,w,S,E,M);}_writePickColor(e,t){if(this._allowPick){const i=t.createPickId(e);this._pickColorVertexArray.emplaceBack(i.color.r,i.color.g,i.color.b,i.color.a);}}update(t){const i=t.context;if(this._opaquePrimitives=[],this._transLucentPrimitives=[],!this.show)return;this._maxTotalPointSize=e.ContextLimits.maximumAliasedPointSize;const s=this._pointPrimitives.length;if((this._createVertexArray||this._dirty)&&(this._createVertexArray=!1,this._dirty=!1,e.defined(this._vertexBuffer)&&(this._vertexBuffer.destroy(),this._vertexBuffer=void 0,this._opaquePrimitive=void 0,this._translucentPrimitive=void 0,this._boundingSphere=void 0,this._boundingBox=void 0),s>0)){this._vertexArray=new e.StructArrayLayout21f84,this._pickColorVertexArray=new e.StructArrayLayout4f16;let t=[];for(let e=0;e<s;++e)this._writePointPrimitive(this._pointPrimitives[e]),this._writePickColor(this._pointPrimitives[e],i),t.push(this._pointPrimitives[e].position);this._boundingSphere=e.BoundingSphere.fromPoints(t),this._boundingBox=e.OrientedBoundingBox.fromPoints(t),t=[],this._shaderTranslucencyByDistance&&(this._materialOpaque.defines={EYE_DISTANCE_TRANSLUCENCY:!0},this._materialTranslucent.defines={EYE_DISTANCE_TRANSLUCENCY:!0}),this._shaderScaleByDistance&&(this._materialOpaque.defines={EYE_DISTANCE_SCALING:!0},this._materialTranslucent.defines={EYE_DISTANCE_SCALING:!0}),this._shaderDistanceDisplayCondition&&(this._materialOpaque.defines={DISTANCE_DISPLAY_CONDITION:!0},this._materialTranslucent.defines={DISTANCE_DISPLAY_CONDITION:!0}),this._vertexBuffer=i.createVertexBuffer(this._vertexArray,Ih.members,!1),this._geometry._vertexBuffer=this._vertexBuffer,this._allowPick&&(this._pickColorVertexBuffer=i.createVertexBuffer(this._pickColorVertexArray,Vh.members,!1),this._geometry.dynamicLayoutBuffer1=this._pickColorVertexBuffer),this._geometry.boundingSphere=this._boundingSphere,this._geometry.boundingBox=this._boundingBox,this._geometry._segmentVector=e.SegmentVector.simpleSegment(0,0,this._pointPrimitives.length,this._pointPrimitives.length),this._geometry.primitiveType=e.WebGLConstants.POINTS,this._opaquePrimitive=new e.Primitive({geometry:this._geometry,material:this._materialOpaque,modelMatrix:this.modelMatrix,name:"pointCollection",allowPick:this._allowPick}),this._translucentPrimitive=new e.Primitive({geometry:this._geometry,material:this._materialTranslucent,modelMatrix:this.modelMatrix,name:"pointCollection",allowPick:this._allowPick});}e.defined(this._vertexBuffer)&&(this._opaquePrimitives.push(this._opaquePrimitive),this._transLucentPrimitives.push(this._translucentPrimitive));}getTranslucentPrimitives(){return this._transLucentPrimitives}getOpaquePrimitives(){return this._opaquePrimitives}set depthTest(t){if(!e.isBoolean(t))throw new Error("'depthTest' option must be a boolean value!");this._depthTest=t,this._materialOpaque.depthTest=t,this._materialTranslucent.depthTest=t,this._dirty=!0;}get depthTest(){return this._depthTest}set allowPick(t){if(!e.isBoolean(t))throw new Error("'allowPick' option must be a boolean value!");this._allowPick=t,this._dirty=!0;}get allowPick(){return this._allowPick}destroy(){return this.removeAll(!0),this._boundingBox=void 0,this._boundingSphere=void 0,this.id=void 0,this._shaderSource.destroy(),this._shaderSource=void 0,this._createVertexArray=void 0,this._pointPrimitives=void 0,this._shaderScaleByDistance=void 0,this._shaderTranslucencyByDistance=void 0,this._shaderDistanceDisplayCondition=void 0,this._maxPixelSize=void 0,this.show=void 0,this.modelMatrix=void 0,this._modelMatrix=void 0,this._maxTotalPointSize=void 0,this._opaquePrimitives=void 0,this._transLucentPrimitives=void 0,this._vertexArray=void 0,this._vertexBuffer=void 0,this._opaquePrimitive?.destroy(),this._materialOpaque=void 0,this._translucentPrimitive?.destroy(),this._materialTranslucent=void 0,this._translucentPrimitive=void 0,this._geometry=void 0,this._dirty=void 0,e.destroyObject(this)}}class Uh{constructor(){this.state={},this.stateChanges={},this.deletedStates={};}updateState(t,i,s){const r=String(i);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][r]=this.stateChanges[t][r]||{},e.extend(this.stateChanges[t][r],s),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==r&&(this.deletedStates[t][e]=null);}else if(this.deletedStates[t]&&null===this.deletedStates[t][r]){this.deletedStates[t][r]={};for(const e in this.state[t][r])s[e]||(this.deletedStates[t][r][e]=null);}else for(const e in s)this.deletedStates[t]&&this.deletedStates[t][r]&&null===this.deletedStates[t][r][e]&&delete this.deletedStates[t][r][e];}removeFeatureState(e,t,i){if(null===this.deletedStates[e])return;const s=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},i&&void 0!==t)null!==this.deletedStates[e][s]&&(this.deletedStates[e][s]=this.deletedStates[e][s]||{},this.deletedStates[e][s][i]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][s])for(i in this.deletedStates[e][s]={},this.stateChanges[e][s])this.deletedStates[e][s][i]=null;else this.deletedStates[e][s]=null;else this.deletedStates[e]=null;}getState(t,i){const s=String(i),r=e.extend({},(this.state[t]||{})[s],(this.stateChanges[t]||{})[s]);if(null===this.deletedStates[t])return {};if(this.deletedStates[t]){const e=this.deletedStates[t][i];if(null===e)return {};for(const t in e)delete r[t];}return r}initializeTileState(e,t){e.setFeatureState(this.state,t);}coalesceChanges(t,i){const s={};for(const t in this.stateChanges){this.state[t]=this.state[t]||{};const i={};for(const s in this.stateChanges[t])this.state[t][s]||(this.state[t][s]={}),e.extend(this.state[t][s],this.stateChanges[t][s]),i[s]=this.state[t][s];s[t]=i;}for(const t in this.deletedStates){this.state[t]=this.state[t]||{};const i={};if(null===this.deletedStates[t])for(const e in this.state[t])i[e]={},this.state[t][e]={};else for(const e in this.deletedStates[t]){if(null===this.deletedStates[t][e])this.state[t][e]={};else for(const i of Object.keys(this.deletedStates[t][e]))delete this.state[t][e][i];i[e]=this.state[t][e];}s[t]=s[t]||{},e.extend(s[t],i);}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(s).length)for(const e in t)t[e].setFeatureState(s,i);}}class Hh extends e.Material{constructor(t){super(t),this.isVectorMaterial=!0,this.layer=t.layer,this.tile=t.tile,this.programId=e.SHADER_HISTOGRAM_COLOR,this._programConfiguration=t.programConfiguration,this._renderState=t.renderState,this.type=this.getProgramType(),this._error=null,this._createUniforms(this);}getProgramType(){return this.programId}update(e,t,i){super.update(e,t,i),this.updateRenderState(i),this._uniforms.set("u_Opacity",(()=>this.layer.paint.get("histogram-opacity")));}destroy(){this.layer=void 0,this.tile=void 0,this.programId=void 0,this.plotter=void 0,this.type=void 0,this._uniforms=void 0,this._textures=void 0,this._program=void 0,this.defines=void 0,this._programConfiguration=void 0,this._renderState=void 0,this._pattern=void 0;}_createUniforms(){e.PhongLightSetter.setPhongLightUniform({material:this,phongLightConfig:this.layer.phongLightConfig});}updateRenderState(t){const{renderStateTag:i,stencilTest:s}=t;"first"===i?this.renderState={depthMask:e.renderStateEnum.enableDepthMask,depthTest:e.renderStateEnum.enableDepthTestWithLEQUAL,stencilMask:e.renderStateEnum.disableStencilMask,stencilTest:e.renderStateEnum.disableStencilTest,colorMask:e.renderStateEnum.disabledColorMask}:"second"===i&&(this.renderState={depthMask:e.renderStateEnum.enableDepthMask,depthTest:e.renderStateEnum.enableDepthTestWithLEQUAL,stencilMask:e.renderStateEnum.enableStencilMask,stencilTest:s,colorMask:e.renderStateEnum.enableColorMask,cull:e.renderStateEnum.disableCull,blending:e.renderStateEnum.enableBlending});}}class zh extends e.Geometry{constructor(t){super(t),this.params=t,this._usedDoublePrecision=!1,this._vertexArray=this._usedDoublePrecision?new e.StructArrayLayout11f44:new e.StructArrayLayout3f2f3f32,this.parse(t),this.primitiveType=t.primitiveType||e.WebGLConstants.TRIANGLES,this.computeBoundingSphere(),this.computeBoundingBox(),this.type="SphereGeometry";}parse(t){this.needUpdate=!0,super.parse(t);const i=this.params.radius,s=this.params.widthSegments,r=this.params.heightSegments,n=this.params.phiStart,o=this.params.phiLength,a=this.params.thetaStart,l=this.params.thetaLength,h=this.params.ellipse||e.Transforms.DefaultEllipsoid;this._vertexArray=new e.StructArrayLayout3f2f3f32,this._indexArray=new e.StructArrayLayout3ui6,this.radius=i||1,this.widthSegments=Math.max(3,Math.floor(s)||8),this.heightSegments=Math.max(2,Math.floor(r)||6),this.phiStart=void 0!==n?n:0,this.phiStart*=e.CONSTS.TRANSFORM.RAD_TO_DEG,this.phiLength=void 0!==o?o:2*Math.PI,this.phiLength*=e.CONSTS.TRANSFORM.RAD_TO_DEG,this.thetaStart=void 0!==a?a:0,this.thetaStart*=e.CONSTS.TRANSFORM.RAD_TO_DEG,this.thetaLength=void 0!==l?l:Math.PI,this.thetaLength*=e.CONSTS.TRANSFORM.RAD_TO_DEG;const _=Math.min(this.thetaStart+this.thetaLength,Math.PI);let c,d,u=0;const m=[],p=new e.Vector3,f=new e.Vector3,g=[],y=[],T=[],C=[];for(d=0;d<=this.heightSegments;d++){const t=[],i=d/this.heightSegments;let s=0;for(0==d&&0==this.thetaStart?s=.5/this.widthSegments:d==this.heightSegments&&_==Math.PI&&(s=-.5/this.widthSegments),c=0;c<=this.widthSegments;c++){const r=c/this.widthSegments;if(this.radius===e.CONSTS.TRANSFORM.R){const t=h.cartographicToCartesian(new e.Vector3(this.phiStart+r*this.phiLength,90-(this.thetaStart+i*this.thetaLength),0));y.push(t[0],t[1],t[2]);}else {const t=h.cartographicToCartesian(new e.Vector3(this.phiStart+r*this.phiLength,90-(this.thetaStart+i*this.thetaLength),this.radius)),s=h.cartographicToCartesian(new e.Vector3(this.phiStart+r*this.phiLength,90-(this.thetaStart+i*this.thetaLength),0));y.push(t[0]-s[0],t[1]-s[1],t[2]-s[2]);}f.copy(p).normalize(),T.push(f.x,f.y,f.z),C.push(r+s+.5,i),t.push(u++);}m.push(t);}for(d=0;d<this.heightSegments;d++)for(c=0;c<this.widthSegments;c++){const e=m[d][c],t=m[d+1][c],i=m[d+1][c+1];(0!==d||this.thetaStart>0)&&g.push(m[d][c+1],e,i),(d!==this.heightSegments-1||_<Math.PI)&&g.push(e,t,i);}this.vertices=y,this.normals=T,this.uvs=C,this.indices=g,this.normals=e.PolygonGeometryLibrary.computeNormal(y,g),this.emplaceVertexBufferTriangle();for(let e=0;e<this.indices.length;e+=3)this._indexArray.emplaceBack(this.indices[e],this.indices[e+1],this.indices[e+2]);}update(t){if(this.needUpdate){this.needUpdate=!1;const i=t.painter.context;this._vertexBuffer=i.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?e.layout.members:e.layout$1.members,!1),this._indexBuffer=i.createIndexBuffer(this._indexArray,!1),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/3),this.vertices=[],this.normals=[],this.uvs=[],this.indices=[],this._indexArray=null,this._vertexArray=null;}}serialize(){return {type:this.type,radius:this.radius,widthSegments:this.widthSegments,heightSegments:this.heightSegments,phiStart:this.phiStart/e.CONSTS.TRANSFORM.RAD_TO_DEG,phiLength:this.phiLength/e.CONSTS.TRANSFORM.RAD_TO_DEG,thetaStart:this.thetaStart/e.CONSTS.TRANSFORM.RAD_TO_DEG,thetaLength:this.thetaLength/e.CONSTS.TRANSFORM.RAD_TO_DEG}}destroy(){super.destroy(),this.type=void 0;}}function Wh(t){const{bucket:i,tileBoundingRegion:s}=t;return [new e.Geometry({vertexBuffer:i.layoutVertexBuffer,indexBuffer:i.indexBuffer,segmentVector:i.segments,primitiveType:e.WebGLConstants.TRIANGLES,tileBoundingRegion:s}),new e.Geometry({primitiveType:e.WebGLConstants.LINES,vertexBuffer:i.layoutVertexBuffer2,segmentVector:i.segments2,tileBoundingRegion:s})]}function jh(t){const{bucket:i,tileBoundingRegion:s}=t,r=new e.Geometry({vertexBuffer:i.layoutVertexBuffer,indexBuffer:i.indexBuffer,segmentVector:i.segments,dynamicLayoutBuffer1:i.layoutVertexBuffer2||void 0,primitiveType:e.WebGLConstants.TRIANGLES,tileBoundingRegion:s});return i._animationFlag&&(r.animationVertexBuffers=i.animationVertexBuffers),r}function Xh(t){const{buffers:i,symbolType:s,tileBoundingRegion:r,pickColorVertexBuffer:n}=t;let o;return "icon"===s||"text"===s?o=new e.Geometry({vertexBuffer:i.layoutVertexBuffer,indexBuffer:i.indexBuffer,segmentVector:i.segments,dynamicLayoutBuffer1:i.dynamicLayoutVertexBuffer,dynamicLayoutBuffer2:i.opacityVertexBuffer,dynamicLayoutBuffer3:n,primitiveType:e.WebGLConstants.TRIANGLES,tileBoundingRegion:r}):"debug"==s&&(o=new e.Geometry({vertexBuffer:i.layoutVertexBuffer,indexBuffer:i.indexBuffer,segmentVector:i.segments,dynamicLayoutBuffer1:i.collisionVertexBuffer,primitiveType:e.WebGLConstants.TRIANGLES,tileBoundingRegion:r})),o}class qh extends e.Material{constructor(t){super(t),this.layer=t.layer,this.tile=t.tile,this.coord=t.tile.tileID,this.programId=t.programId,this.drawFill=t.drawFill,this._renderState=t.renderState,this._isShadowVolumeMaterial=t.shadowVolumeMaterial||!1,this.type=this.getProgramType(),this._uniforms.set("u_World",(()=>{const i=t.painter.context.gl;return new e.Vector2(i.drawingBufferWidth,i.drawingBufferHeight)})),this._uniforms.set("u_Opacity",(()=>{const e=this.layer.paint.get("fill-opacity").value.value;return void 0===e?1:e})),this._uniforms.set("u_translate",(()=>{const t=this.layer.paint.get("fill-translate");return t.value?.value?new e.Vector2(t.value.value):new e.Vector2(0,0)})),this._uniforms.set("u_translate_anchor",(()=>{const e=this.layer.paint.get("fill-translate-anchor");return "viewport"==e.value?.value?1:0}));}update(t,i,s={}){super.update(t,i,s),this._renderState.depthTest=e.renderStateEnum.disableDepthTest,this._renderState.cull=e.renderStateEnum.disableCull,this._renderState.stencilTest=e.renderStateEnum.disableStencilTest;}getProgramType(){if(this._isWater)return "WaterMaterial";let e=this.programId;return this.pattern&&(e=`${this.programId}Pattern`),e}destroy(){this.layer=void 0,this.tile=void 0,this.coord=void 0,this.programId=void 0,this.drawFill=void 0,this.type=void 0,this._uniforms=void 0,this._textures=void 0,this._program=void 0,this._programConfiguration=void 0,this._renderState=void 0;}}class Kh extends e.Material{constructor(e){super(e),this.isVectorMaterial=!0,this.type=e.type,this.layer=e.layer,this.tile=e.tile,this._renderState=e.renderState,this._defines=e.defines,this._programConfiguration=e.programConfiguration,this.animationsInfo=e.animationsInfo||{},this._createUniforms(e.painter);}update(e,t,i={}){super.update(e,t,i),this._updateAnimationUniforms(i);}_createUniforms(t){this.animationsInfo.enabled&&this._createAnimationUniforms(this),this._uniforms.set("u_PixelMatrix",(()=>{const i=new e.Matrix2;return i.scale([1,Math.cos(t.transform.hpr.pitch)]),i.rotate(-t.transform.hpr.heading),i})),this._uniforms.set("u_Ratio",(()=>1/e.pixelsToTileUnits(this.tile,1,t.style.getNearestTileZoom()))),this._uniforms.set("u_GlUnitsToPixels",(()=>new e.Vector2(t.style.symbolMatrixHelper.width/2,-t.style.symbolMatrixHelper.height/2))),this._uniforms.set("u_start",(()=>("history"===this.layer.paint.get("tracking-type")?this.layer.histCount:this.layer.count)-this.layer.paint.get("tracking-seg-group"))),this._uniforms.set("u_end",(()=>"history"===this.layer.paint.get("tracking-type")?this.layer.histCount:this.layer.count)),this._uniforms.set("u_segments",(()=>this.layer.paint.get("tracking-seg-group"))),this._uniforms.set("u_reverse",(()=>this.layer.isReverse)),this._uniforms.set("u_reserve",(()=>this.layer.isReserve));}destroy(){this.layer=void 0,this.tile=void 0,this._renderState=void 0,this._defines=void 0,this.type=void 0;}static updateLayerProperty(e,t){const i=e.paint.get("tracking-delay"),s=e.paint.get("tracking-speed")?e.paint.get("tracking-speed"):1;if("history"===e.paint.get("tracking-type")){e.first||(e.first=!0,e.histStart=0,e.histCount=0,e.isReverse=!1,e.isReserve=!1);const i=t._map.timer.totalTime*s;"loop"===e.layout.get("tracking-display-mode")?(e.histCount=i,e.histCount%=e.paint.get("tracking-seg-count"),e.histCount=0===e.histCount?1:e.histCount):"reverse"===e.layout.get("tracking-display-mode")?(e.histCount>=e.paint.get("tracking-seg-count")+e.paint.get("tracking-seg-group")?e.isReverse=!0:e.histCount<=1&&(e.isReverse=!1),e.histCount=e.isReverse?e.histCount-1:e.histCount+1):"loop-reserve"===e.layout.get("tracking-display-mode")?(e.isReserve=!0,e.histCount=i,e.histCount%=e.paint.get("tracking-seg-count"),e.histCount=0===e.histCount?1:e.histCount):"reverse-reserve"===e.layout.get("tracking-display-mode")&&(e.isReserve=!0,e.histCount>=e.paint.get("tracking-seg-count")+e.paint.get("tracking-seg-group")?e.isReverse=!0:e.histCount<=1&&(e.isReverse=!1),e.histCount=e.isReverse?e.histCount-1:e.histCount+1),yt.TRW&&yt.TRW.setProgress(e.histCount),e.histStart=e.histEnd;}else {e.count||(e.count=1);const r=t._map.timer.totalTime*s,n=yt.TRW,o=e.paint.get("tracking-run-time");e.count=r;const a=n&&n.hasOwnProperty("replaceOffset")?n.replaceOffset:o+i;e.count%=a;const l=n&&n.hasOwnProperty("requestOffset")?n.requestOffset:i;e.count===l&&n&&n.request(),0===e.count&&(n&&n.replace(),e.count=i),n&&(n.currentSeq=e.count);}Kh.checkFrwardAndBackward(e,yt);}static checkFrwardAndBackward(e,t){if(t&&t.TRW&&"null"!==t.TRW){t.TRW.layerForwards||(t.TRW.layerForwards=[]);for(let i=0;i<t.TRW.layerForwards.length;i++){const s=t.TRW.layerForwards[i];if(s.id===e.id){e.count&&(e.count+=s.count),t.TRW.layerForwards.splice(i,1);break}}}}_createAnimationUniforms(){this._uniforms.set("u_ANS_CurrentTime",(()=>this.animationsInfo.currentClipTime));}_updateAnimationUniforms(e){const{animationsInfo:t={}}=e;this._uniforms.set("u_ANS_CurrentTime",(()=>t.currentClipTime));}}class Jh extends e.Material{constructor(t){super(t),this.isVectorMaterial=!0,this.layer=t.layer,this.tile=t.tile,this._programConfiguration=t.programConfiguration,this._renderState=t.renderState,this._unitsToPixels=new e.Vector2,this._cameraPosition=new e.Vector3,this._pixelMatrix=new e.Matrix2,this._createUniforms(t.painter);}update(t,i,s={}){super.update(t,i,s),this.renderState.blending={enabled:!0,color:{red:0,green:0,blue:0,alpha:0},equationRgb:e.WebGLConstants.FUNC_ADD,equationAlpha:e.WebGLConstants.FUNC_ADD,functionSourceRgb:e.WebGLConstants.ONE,functionSourceAlpha:e.WebGLConstants.ONE,functionDestinationRgb:e.WebGLConstants.ONE,functionDestinationAlpha:e.WebGLConstants.ONE};}_createUniforms(e){this._uniforms.set("u_GlUnitsToPixels",(()=>this._unitsToPixels.set(e.style.symbolMatrixHelper.width/2,e.style.symbolMatrixHelper.height/2))),this._uniforms.set("u_PixelMatrix",(()=>(this._pixelMatrix.identity(),this._pixelMatrix.scale([1,Math.cos(Math.sqrt(e.transform.hpr.pitch))]),this._pixelMatrix.rotate(e.transform.hpr.heading),this._pixelMatrix))),this._uniforms.set("u_Intensity",(()=>this.layer.paint.get("heatmap-intensity")));}destroy(){this.layer=void 0,this.tile=void 0,this.pattern=void 0,this.type=void 0,this._uniforms=void 0,this._textures=void 0,this._program=void 0,this._programConfiguration=void 0,this._renderState=void 0,this._unitsToPixels=void 0,this._cameraPosition=void 0,this._pixelMatrix=void 0;}}function Zh(t){const{layer:i,painter:s,tile:r,programConfiguration:n}=t;return [new e.VectorFillMaterial({layer:i,painter:s,tile:r,programId:e.SHADER_FILL_COLOR,plotter:this,renderState:{},programConfiguration:n,defines:{}}),new qh({layer:i,painter:s,tile:r,programId:e.SHADER_FILL_OUTLINE_COLOR,renderState:{},programConfiguration:n,defines:{}})]}function Yh(t){const{layer:i,painter:s,tile:r,bucket:n,programConfiguration:o,sourceMaxZoom:a,animationsInfo:l}=t,h={},_={},c="visible"===i.layout.get("border-visibility"),d=i.paint.get("line-gradient");let u,m;return i.type==e.VectorLayerType.LINE?u=i.paint.get("line-dasharray")?e.SHADER_LINE_SDF:function(e){if(e.paint.get("line-pattern")){if(e.paint.get("line-pattern").constantOr(null))return !0;if(!e.paint.get("line-pattern").isConstant())return !0}return !1}(i)?e.SHADER_LINE_PATTERN:i.paint.get("line-gradient")?e.SHADER_LINE_GRADIENT:e.SHADER_LINE_COLOR:i.type==e.VectorLayerType.TRACKING?(Kh.updateLayerProperty(i,s),u=e.SHADER_LINE_TRACKING_COLOR):i.type==e.VectorLayerType.SPRITE&&(e.SpriteMaterial.updateLayerProperty(i,s),u=n.hasPattern?e.SHADER_LINE_SPRITE_PATTERN:e.SHADER_LINE_SPRITE_COLOR),m="tracking"===i.type?new Kh({type:u,layer:i,painter:s,tile:r,renderState:h,defines:_,programConfiguration:o,animationsInfo:l}):"sprite"===i.type?new e.SpriteMaterial({type:u,layer:i,painter:s,tile:r,renderState:h,defines:_,programConfiguration:o}):new e.VectorLineMaterial({layer:i,painter:s,tile:r,isBorder:c,sourceMaxZoom:a,bucket:n,lineGradient:d,type:u,programConfiguration:o,defines:_,renderState:h}),m}function Qh(t){const{layer:i,painter:s,tile:r,programConfiguration:n,isText:o,isSDF:a,sizeData:l,bucket:h}=t,_=o?h.textHaloWidth:h.iconHaloWidth;let c;return c=i.type===e.VectorLayerType.SYMTRACKING?a?e.SHADER_SYMTRACKING_SDF:e.SHADER_SYMTRACKING_ICON:a?e.SHADER_SYMBOL_SDF:e.SHADER_SYMBOL_ICON,r.tileID.posMatrix=s.style.symbolMatrixHelper.calculatePosMatrix(r.tileID.toUnwrapped()),new e.SymbolMaterial({layer:i,painter:s,tile:r,programConfiguration:n,renderState:{},isText:o,isSDF:a,sizeData:l,bucket:h,type:c,hasHalo:_,modeNum:0})}function $h(t){const{layer:i,painter:s,tile:r,bucket:n,tileBoundingRegion:o}=t;if(!e.checkIsVectorShadowVolumeDataType(i.classificationType)){const t=n.programConfigurations.get(i.id),a=Wh({bucket:n,tileBoundingRegion:o}),l=Zh({layer:i,painter:s,tile:r,programConfiguration:t}),h=n.matrix;return {fill:new e.Primitive({modelMatrix:h,geometry:a[0],material:l[0]}),outline:a[1]?new e.Primitive({modelMatrix:h,geometry:a[1],material:l[1]}):void 0}}{const t=n.adaptTerrainGeometries,i=[];for(let s=0;s<t.length;s++){const r=t[s];let n,o=[];if(r.positions[0][1].length>3)for(let e=0;e<r.positions[0].length;e++)o.push(o_([r.positions[0][e]]));else o=o_(r.positions);if(1==o.length)o=o[0],n={positions:o};else if(o.length>1){n={positions:o[0][0]};const e=[];for(let t=1;t<o.length;t++)e.push({positions:o[t][0]});n={positions:o[0][0],holes:e};}const a=new e.PolygonGeometry({polygonHierarchy:n,height:0}),l=e.StandardMaterial.fromType("Color",{color:new e.Color(r.color.r,r.color.g,r.color.b,r.color.a*r.opacity),doubleSided:!0}),h=new e.Primitive({geometry:a,material:l,adaptTerrain:!0});i.push(h);}return {fill:i}}}function e_(t){const{layer:i,painter:s,tile:r,bucket:n,tileBoundingRegion:o,sourceMaxZoom:a,animationsInfo:l}=t;if(!e.checkIsVectorShadowVolumeDataType(i.classificationType)){const t=n.programConfigurations.get(i.id),h=n.matrix,_=Yh({layer:i,painter:s,tile:r,bucket:n,programConfiguration:t,sourceMaxZoom:a,animationsInfo:l}),c=jh({bucket:n,tileBoundingRegion:o});return {line:new e.Primitive({modelMatrix:h,geometry:c,material:_})}}{const t=n.adaptTerrainGeometries,i=[];for(let s=0;s<t.length;s++){const r=t[s],n=new e.PolylineMaterial({color:new e.Color(r.color.r,r.color.g,r.color.b,r.color.a*r.opacity)}),o=[];for(let t=0;t<r.positions.length;t++)o.push(new e.Vector3(r.positions[t]));const a=new e.PolylineGeometry({positions:o,width:r.width,arcType:e.ARCTYPE.GEODESIC}),l=new e.Primitive({geometry:a,material:n,adaptTerrain:!0});i.push(l);}return {line:i}}}function t_(t){const{layer:i,painter:s,tile:r,type:n,defines:o,bucket:a,tileBoundingRegion:l}=t,h=a.programConfigurations.get(i.id),_=new e.VectorCircleMaterial({layer:i,painter:s,tile:r,type:n,programConfiguration:h,renderState:{},defines:o}),c=function(t){const{bucket:i,tileBoundingRegion:s}=t;return new e.Geometry({vertexBuffer:i.layoutVertexBuffer,indexBuffer:i.indexBuffer,segmentVector:i.segments,dynamicLayoutBuffer1:i.layoutVertexBuffer2||void 0,primitiveType:e.WebGLConstants.TRIANGLES,tileBoundingRegion:s})}({bucket:a,tileBoundingRegion:l});return new e.Primitive({modelMatrix:a.matrix,geometry:c,material:_})}function i_(t){const{layer:i,painter:s,tile:r,defines:n,bucket:o,tileBoundingRegion:a,animationsInfo:l}=t;let h=null;const _={},c=o.programConfigurations.get(i.id);switch(i.type){case"extrusion":h=new e.VectorExtrusionMaterial({layer:i,painter:s,tile:r,bucket:o,programConfiguration:c,defines:n,renderState:_,animationsInfo:l});break;case"histogram":h=new Hh({layer:i,painter:s,tile:r,bucket:o,programConfiguration:c,defines:n,renderState:_});}const d=function(t){const{bucket:i,tileBoundingRegion:s}=t;return e.Geometry.fromBucket(i,e.WebGLConstants.TRIANGLES,s)}({bucket:o,tileBoundingRegion:a});return new e.Primitive({modelMatrix:o.matrix,geometry:d,material:h})}function s_(t){const{layer:i,painter:s,tile:r,bucket:n,tileBoundingRegion:o}=t,a=n.matrix,l=function(t){const{layer:i,painter:s,tile:r,programConfiguration:n}=t;return new Jh({layer:i,painter:s,tile:r,type:e.SHADER_HEATMAP_COLOR,renderState:{},programConfiguration:n,defines:{}})}({layer:i,painter:s,tile:r,programConfiguration:n.programConfigurations.get(i.id)}),h=function(t){const{bucket:i,tileBoundingRegion:s}=t;return new e.Geometry({vertexBuffer:i.layoutVertexBuffer,indexBuffer:i.indexBuffer,segmentVector:i.segments,dynamicLayoutBuffer1:i.layoutVertexBuffer2||void 0,primitiveType:e.WebGLConstants.TRIANGLES,tileBoundingRegion:s})}({bucket:n,tileBoundingRegion:o});return new e.Primitive({modelMatrix:a,geometry:h,material:l})}function r_(t){const{layer:i,painter:s,tile:r,bucket:n,tileBoundingRegion:o}=t,a={},l=[{name:"icon",readyToCreate:0!==i.paint.get("icon-opacity").constantOr(1)},{name:"text",readyToCreate:0!==i.paint.get("text-opacity").constantOr(1)}];let h,_;if(r.symbolPickIdObject[i.id])for(const e of r.symbolPickIdObject[i.id])e.destroy();r.symbolPickIdObject[i.id]=[];for(let t=0;t<2;t++){const c=l[t];if(!c.readyToCreate)continue;const d=c.name,u="text"==d,m=u?n.text:n.icon;if(!m||!m.segments.get().length)continue;const p=u?n.textSizeData:n.iconSizeData,f=n.matrix,g=Qh({symbolType:d,layer:i,painter:s,tile:r,isText:u,isSDF:u||n.sdfIcons,programConfiguration:m.programConfigurations.get(i.id),sizeData:p,bucket:n});if(n.pickColor&&!h&&!_){const t=new e.StructArrayLayout4f16,o=new e.StructArrayLayout4f16;for(const e of n.symbolInstances){const a=n_(n,r,e.featureIndex,i);a.isSymbolData=!0;const l=s.context.createPickId(a);r.symbolPickIdObject[i.id].push(l);const h=e.numIconVertices>0;if(e.numGlyphVertices>0||e.numVerticalGlyphVertices>0)for(let i=0;i<e.numGlyphVertices+e.numVerticalGlyphVertices;i++)t.emplaceBack(l.color.r,l.color.g,l.color.b,l.color.a);if(h)for(let t=0;t<e.numIconVertices;t++)o.emplaceBack(l.color.r,l.color.g,l.color.b,l.color.a);}h=s.context.createVertexBuffer(t,e.pickColorAttributes.members,!0),_=s.context.createVertexBuffer(o,e.pickColorAttributes.members,!0);}const y=Xh({buffers:m,symbolType:d,tileBoundingRegion:o,bucket:n,pickColorVertexBuffer:u?h:_}),T=new e.Primitive({modelMatrix:f,geometry:y,material:g,allowPick:n.pickColor});a[d]=T;}return a}function n_(e,t,i,s){return {evaluate:()=>{const r=s.id;return t.latestFeatureIndex.lookupSymbolFeatures([i],e.index,e.sourceLayerIndex,null,[r],{[r]:s})[r][0].feature}}}function o_(t){if(Array.isArray(t[0])){const e=[];for(let i=0;i<t.length;i++)e.push(o_(t[i]));return e}return new e.Vector3(t)}class a_{constructor(t){const{tileID:i,tileSize:s,projType:r,tilePrimitiveType:n,sourceId:o,style:a,keepBuffer:l}=t;this.symbolPickIdObject={},this.tileID=i,this.uid=e.uniqueId(),this.uses=0,this.tileSize=s,this.buckets={},this.primitiveMap=new Map,this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.sourceId=o,this.style=a,this.keepBuffer=l,this.dependencies={},this.expiredRequestCount=0,this.state="loading",this.projType=r||e.ProjectionType.MERCATOR,this.tilePrimitiveType=n;}registerFadeDuration(t){const i=t+this.timeAdded;i<e.exported.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i);}wasRequested(){return "errored"===this.state||"loaded"===this.state||"reloading"===this.state}loadVectorData(t,i,s){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){if(t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(e,t){const i={};if(!t)return i;for(const s of e){const e=s.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){s.layers=e,s.stateDependentLayers=e.filter((e=>e.isStateDependent()));for(const t of e)i[t.id]=s;}}return i}(t.buckets,i.style),s)for(const t in this.buckets){const i=this.buckets[t];i.type!=e.VectorLayerType.SYMTRACKING&&i.type!=e.VectorLayerType.SYMBOL||(i.justReloaded=!0);}this.hasSymbolBuckets=!1;for(const t in this.buckets){const i=this.buckets[t];if(i.type==e.VectorLayerType.SYMBOL){if(this.hasSymbolBuckets=!0,!s)break;i.justReloaded=!0;}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const i=this.buckets[t];if(i.type==e.VectorLayerType.SYMBOL&&i.hasRTLText){this.hasRTLText=!0,e.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const e in this.buckets){const t=this.buckets[e];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(t.layerIds[0]).queryRadius(t));}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage);}else this.collisionBoxArray=new e.CollisionBoxArray;}_releaseTileSupplierMesh(){}unloadVectorData(){this.primitiveMap.forEach((t=>{const i=t;if(i instanceof e.Primitive)this._releaseTileSupplierMesh(i),i.destroy();else if(Array.isArray(i))for(let e=0;e<i.length;e++)this._releaseTileSupplierMesh(i[e]),i[e].destroy();else for(const t in i){const s=i[t];if(s instanceof e.Primitive)this._releaseTileSupplierMesh(s),s.destroy();else if(Array.isArray(s))for(let e=0;e<s.length;e++)this._releaseTileSupplierMesh(s[e]),s[e].destroy();}})),this.primitiveMap.clear();for(const e in this.buckets){const t=this.buckets[e];if(this.symbolPickIdObject[e])for(const t of this.symbolPickIdObject[e])t.destroy();this.symbolPickIdObject[e]=[],t.destroy();}this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),this.imageAtlasTexture=null),this.glyphAtlasImage&&(this.glyphAtlasImage=null),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),this.glyphAtlasTexture=null),this.latestFeatureIndex=null,this.state="unloaded";}loadImage(t){const{painter:i,callback:s,url:r}=t;let n=t.data;const o=i.context;if(n.img)if(e.window.hasOwnProperty("createImageBitmap")){let i=e.window.createImageBitmap(n.img);i.then((r=>{const a=o.gl;this.texture=new e.Texture({context:o,image:r,pixelFormat:e.WebGLConstants.RGBA,useMipmap:!1}),this.texture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),o.extTextureFilterAnisotropic&&(a.bindTexture(this.texture._target,this.texture.texture),a.texParameterf(e.WebGLConstants.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.ContextLimits._maximumTextureFilterAnisotropy),a.bindTexture(this.texture._target,null)),n.img=null,n=null,r=null,this.state="loaded",t.url=null,t.painter=null,t=null,s(null),i=null;}));}else this.texture=new e.Texture({context:o,image:n.img,pixelFormat:e.WebGLConstants.RGBA,useMipmap:!1}),this.texture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),n.img=null,n=null,t.url=null,t.painter=null,t=null,this.state="loaded";else e.getImage({url:r},((t,i)=>{if(t)throw new Error(t);this.texture=new e.Texture({context:o,image:i,pixelFormat:e.WebGLConstants.RGBA,useMipmap:!1}),this.texture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),i=null,this.state="loaded",s(null);}));this._createOrCheckPrimitives();}checkCurrentSourceOfLayer(e){return e.source==this.sourceId}changeTexture(e){this.replacedTexture=e;}removeTexture(){this.images=void 0,this.replacedTexture=void 0;}_createOrCheckPrimitives(){const t=this.style,i=t._layers,s=t.rasterSourceCache.quadtree.getBoundingRegionById(this.tileID.key);for(const r in i){const n=i[r];if(!this.checkCurrentSourceOfLayer(n))continue;if(this.primitiveMap.has(r))continue;const o=this.getBucket(n);if(e.defined(o))if(n.type==e.VectorLayerType.CIRCLE)this.primitiveMap.set(r,t_({layer:n,painter:t.map.painter,tile:this,type:e.SHADER_CIRCLE,bucket:o,tileBoundingRegion:s}));else if(n.type==e.VectorLayerType.EXTRUSION||n.type==e.VectorLayerType.HISTOGRAM)this.primitiveMap.set(r,i_({layer:n,painter:t.map.painter,tile:this,bucket:o,tileBoundingRegion:s,animationsInfo:t.getSource(n.source).animationsInfo}));else if(n.type==e.VectorLayerType.FILL)this.primitiveMap.set(r,$h({layer:n,painter:t.map.painter,tile:this,bucket:o,tileBoundingRegion:s}));else if(n.type==e.VectorLayerType.TRACKING||n.type==e.VectorLayerType.SPRITE||n.type==e.VectorLayerType.LINE){const e=t.getSource(n.source);this.primitiveMap.set(r,e_({layer:n,painter:t.map.painter,tile:this,bucket:o,tileBoundingRegion:s,sourceMaxZoom:e.maxzoom,animationsInfo:e.animationsInfo}));}else n.type==e.VectorLayerType.SYMBOL||n.type==e.VectorLayerType.SYMTRACKING?this.primitiveMap.set(r,r_({layer:n,painter:t.map.painter,tile:this,bucket:o,tileBoundingRegion:s})):n.type==e.VectorLayerType.HEATMAP&&this.primitiveMap.set(r,s_({layer:n,painter:t.map.painter,tile:this,bucket:o,tileBoundingRegion:s}));}}getBucket(e){return this.buckets[e.id]}imageAtlasUpload(t){this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new e.Texture({context:t,image:this.imageAtlas.image,pixelFormat:e.WebGLConstants.RGBA}),this.imageAtlas.uploaded=!0);}upload(t){for(const e in this.buckets){const i=this.buckets[e];i.uploadPending()&&i.upload(t);}this.imageAtlasUpload(t),this.glyphAtlasImage&&(this.glyphAtlasTexture=new e.Texture({context:t,image:this.glyphAtlasImage,pixelFormat:e.WebGLConstants.ALPHA}),this.glyphAtlasImage=null),"raster"!==this.tilePrimitiveType&&this._createOrCheckPrimitives();}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture);}queryRenderedFeatures(e,t,i,s,r,n,o,a,l,h){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:i,cameraQueryGeometry:s,scale:r,tileSize:this.tileSize,posMatrix:l,symbolMatrixHelper:o,params:n,queryPadding:this.queryPadding*a},e,t,h):{}}querySourceFeatures(t,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const s=this.latestFeatureIndex.loadVTLayers(),r=s._geojsonTileLayer||s[i?i.sourceLayer:""];if(!r)return;const n=e.createFilter(i&&i.filter),o={z:this.tileID.overscaledZ,x:this.tileID.canonical.x,y:this.tileID.canonical.y};for(let i=0;i<r.length;i++){const s=r.feature(i);if(n(new e.EvaluationParameters(this.tileID.overscaledZ),s)){const i=new e.Feature(s,o.z,o.x,o.y);i.tile=o,t.push(i);}}}clearMask(){}setMask(e){s(this.mask,e)||(this.mask=e,this.clearMask());}_xToLng(t,i,s){return t.xLng(this.tileID.canonical.x+i/e.EXTENT,s)}_yToLat(t,i,s){return t.yLat(this.tileID.canonical.y+i/e.EXTENT,s)}hasData(){if("loading"===this.state&&"raster"===this.tilePrimitiveType){for(const e of this.imagery){if("loading"==e.imagery.state)return !1;if("loaded"===e.imagery.state)return this.state="loaded",this._createOrCheckPrimitives(),!0}return this.state="errored",this._createOrCheckPrimitives(),!1}return "background"==this.tilePrimitiveType?this.primitiveMap.size>0&&("loaded"===this.state||"reloading"===this.state||"expired"===this.state):"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const i=this.expirationTime;if(t.cacheControl){const i=e.parseCacheControl(t.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"]);}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const t=Date.now();let s=!1;if(this.expirationTime>t)s=!1;else if(i)if(this.expirationTime<i)s=!0;else {const r=this.expirationTime-i;r?this.expirationTime=t+Math.max(r,e.CONSTS.SOURCE.CLOCK_SKEW_RETRY_TIMEOUT):s=!0;}else s=!0;s?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0;}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length)return;const i=this.latestFeatureIndex.loadVTLayers();for(const s in this.buckets){const r=this.buckets[s],n=r.layers[0].sourceLayer||"_geojsonTileLayer",o=i[n],a=e[n];o&&a&&0!==Object.keys(a).length&&(r.update(a,o,this.imageAtlas&&this.imageAtlas.patternPositions||{}),t&&t.style&&(this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(r.layerIds[0]).queryRadius(r))));}}setDependencies(e,t){const i={};for(const e of t)i[e]=!0;this.dependencies[e]=i;}hasDependency(e,t){for(const i of e){const e=this.dependencies[i];if(e)for(const i of t)if(e[i])return !0}return !1}destroy(){this.unloadVectorData();}}class l_{constructor(e,t){this.max=e,this.onRemove=t,this.reset();}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,i){const s=e.wrapped().key;void 0===this.data[s]&&(this.data[s]=[]);const r={value:t,timeout:void 0};if(void 0!==i&&(r.timeout=setTimeout((()=>{this.remove(e,r);}),i)),this.data[s].push(r),this.order.push(s),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e);}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}getByKey(e){const t=this.data[e];return t?t[0].value:null}remove(e,t){if(!this.has(e))return this;const i=e.wrapped().key,s=void 0===t?0:this.data[i].indexOf(t),r=this.data[i][s];return this.data[i].splice(s,1),r.timeout&&clearTimeout(r.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(r.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e);}return this}filter(e){const t=[];for(const i in this.data)for(const s of this.data[i])e(s.value)||t.push(s);for(const e of t)this.remove(e.value.tileID,e);}}const h_={NONE:0,CULLED:1,RENDERED:2,REFINED:3,RENDERED_AND_KICKED:6,REFINED_AND_KICKED:7,CULLED_BUT_NEEDED:9,wasKicked:e=>e>=h_.RENDERED_AND_KICKED,originalResult:e=>3&e,kick:e=>4|e},__=new Map([["0_0_0",[1,1]],["1_0_0",[1,1]],["1_0_1",[1,1]],["1_1_1",[1,1]],["1_1_0",[1,1]],["2_0_0",[1,1]],["2_1_0",[1,1]],["2_0_2",[1,1]],["2_3_3",[1,1]],["2_0_3",[1,1]],["2_2_3",[1,1]],["2_3_0",[1,1]],["2_1_1",[1,1]],["2_2_2",[1,1]],["2_2_0",[1,1]],["2_2_1",[1,1]],["2_0_1",[1,1]],["2_1_3",[1,1]],["2_3_2",[1,1]],["2_1_2",[1,1]],["2_3_1",[1,1]],["3_0_4",[0,1526]],["3_1_4",[0,980]],["3_3_0",[0,8760]],["3_2_4",[0,5808]],["3_6_0",[0,913]],["3_5_4",[0,2336]],["3_2_0",[0,8757]],["3_0_0",[0,0]],["3_7_4",[-24,4044]],["3_6_4",[0,2467]],["3_1_0",[0,1906]],["3_7_5",[0,2193]],["3_2_1",[0,12397]],["3_6_1",[0,1901]],["3_4_0",[0,1308]],["3_0_1",[0,2228]],["3_5_5",[0,2709]],["3_7_6",[0,5526]],["3_3_4",[0,2078]],["3_2_2",[0,3867]],["3_4_4",[0,4218]],["3_3_1",[0,12265]],["3_0_5",[0,0]],["3_6_2",[0,4062]],["3_0_2",[0,5260]],["3_3_2",[0,4232]],["3_4_1",[0,1584]],["3_2_5",[0,2716]],["3_2_3",[-37,4510]],["3_1_1",[0,1590]],["3_6_5",[0,2297]],["3_4_5",[0,705]],["3_6_3",[-21,6345]],["3_3_3",[0,3235]],["3_5_0",[0,550]],["3_0_3",[0,3760]],["3_1_5",[0,0]],["3_7_7",[0,5133]],["3_0_6",[0,11575]],["3_4_2",[-4,4140]],["3_7_0",[0,0]],["3_2_6",[-18,10247]],["3_5_1",[0,1008]],["3_6_6",[0,14038]],["3_5_2",[-203,5434]],["3_3_5",[0,1688]],["3_2_7",[-143,11795]],["3_5_3",[-33,6516]],["3_7_1",[0,2022]],["3_4_6",[0,13614]],["3_0_7",[-271,10711]],["3_1_6",[0,12115]],["3_3_6",[0,12954]],["3_6_7",[0,13726]],["3_4_3",[-427,4065]],["3_3_7",[-150,12292]],["3_1_7",[-178,12360]],["3_4_7",[0,13461]],["3_1_2",[0,3647]],["3_1_3",[-81,4039]],["3_5_6",[0,13574]],["3_5_7",[-4,13778]],["3_7_2",[0,3509]],["3_7_3",[0,2378]],["4_10_0",[0,0]],["4_0_0",[0,0]],["4_11_0",[0,0]],["4_5_0",[0,1184]],["4_12_0",[0,0]],["4_4_0",[0,1606]],["4_0_1",[0,0]],["4_11_1",[0,132]],["4_2_0",[0,0]],["4_3_0",[0,0]],["4_11_2",[0,839]],["4_15_0",[0,0]],["4_0_2",[0,0]],["4_9_0",[0,0]],["4_12_1",[0,939]],["4_4_1",[0,2404]],["4_12_2",[0,1055]],["4_8_0",[0,0]],["4_9_1",[0,922]],["4_6_0",[0,1658]],["4_12_3",[0,1586]],["4_7_0",[0,804]],["4_1_0",[0,0]],["4_0_3",[0,1290]],["4_8_1",[0,1378]],["4_0_4",[0,1993]],["4_15_1",[0,0]],["4_8_2",[0,1580]],["4_3_1",[0,1946]],["4_10_1",[0,614]],["4_13_0",[0,0]],["4_3_2",[0,1660]],["4_12_4",[29,2179]],["4_10_2",[0,1154]],["4_1_1",[0,0]],["4_10_3",[0,1132]],["4_14_0",[0,0]],["4_10_4",[3,1455]],["4_10_5",[-137,3745]],["4_3_3",[0,596]],["4_13_1",[0,0]],["4_14_1",[0,0]],["4_8_3",[0,1764]],["4_3_4",[0,848]],["4_9_2",[0,505]],["4_8_4",[0,2167]],["4_9_3",[0,1034]],["4_9_4",[0,455]],["4_0_5",[0,2063]],["4_3_5",[90,3752]],["4_1_2",[0,0]],["4_9_5",[-8,4825]],["4_15_2",[0,0]],["4_13_2",[0,384]],["4_1_3",[0,2397]],["4_15_3",[0,1601]],["4_0_6",[0,1254]],["4_6_1",[-44,11625]],["4_15_4",[0,4197]],["4_13_3",[0,2041]],["4_4_2",[0,2070]],["4_7_1",[0,1541]],["4_9_6",[-427,3968]],["4_7_2",[0,1658]],["4_5_1",[0,9914]],["4_9_7",[-154,4255]],["4_11_3",[0,848]],["4_2_1",[0,0]],["4_2_2",[0,736]],["4_12_5",[70,4328]],["4_11_4",[0,676]],["4_11_5",[-213,5991]],["4_7_3",[0,2006]],["4_14_2",[0,222]],["4_15_5",[0,2798]],["4_3_6",[0,3918]],["4_15_6",[0,0]],["4_0_7",[0,658]],["4_7_4",[0,1956]],["4_10_6",[-35,4468]],["4_7_5",[0,2530]],["4_14_3",[0,2161]],["4_10_7",[0,2307]],["4_4_3",[0,1656]],["4_4_4",[0,742]],["4_10_8",[0,2559]],["4_0_8",[0,1567]],["4_14_4",[0,2641]],["4_10_9",[0,2406]],["4_4_5",[0,1476]],["4_2_3",[0,847]],["4_14_5",[0,1938]],["4_9_8",[0,4865]],["4_10_10",[0,545]],["4_14_6",[0,2720]],["4_9_9",[0,3283]],["4_4_6",[0,1698]],["4_8_5",[0,3853]],["4_0_9",[0,1]],["4_6_2",[5,12459]],["4_7_6",[0,3509]],["4_6_3",[0,12624]],["4_0_10",[0,15]],["4_8_6",[-47,2632]],["4_7_7",[0,1375]],["4_15_7",[0,488]],["4_8_7",[0,3292]],["4_14_7",[0,338]],["4_10_11",[0,3817]],["4_15_8",[0,1697]],["4_15_9",[0,2190]],["4_9_10",[0,974]],["4_13_4",[18,2517]],["4_9_11",[0,0]],["4_13_5",[0,2409]],["4_14_8",[0,4350]],["4_6_4",[0,5867]],["4_10_12",[0,12608]],["4_7_8",[0,459]],["4_11_6",[0,7286]],["4_11_7",[0,2303]],["4_0_11",[0,0]],["4_15_10",[0,2791]],["4_8_8",[0,2286]],["4_4_7",[-36,4886]],["4_2_4",[0,2552]],["4_9_12",[0,3323]],["4_15_11",[0,0]],["4_1_4",[0,5558]],["4_0_12",[0,0]],["4_5_2",[0,12411]],["4_5_3",[0,4924]],["4_7_9",[0,1425]],["4_15_12",[-2,4495]],["4_15_13",[0,3812]],["4_1_5",[0,0]],["4_5_4",[0,8703]],["4_11_8",[0,0]],["4_6_5",[0,0]],["4_1_6",[0,0]],["4_5_5",[0,1109]],["4_6_6",[0,1450]],["4_3_7",[0,4609]],["4_13_6",[-6,3355]],["4_11_9",[0,577]],["4_4_8",[0,5769]],["4_0_13",[0,1072]],["4_3_8",[0,1322]],["4_5_6",[0,0]],["4_4_9",[0,6286]],["4_7_10",[0,0]],["4_15_14",[0,3466]],["4_7_11",[0,0]],["4_11_10",[0,2158]],["4_6_7",[0,1868]],["4_13_7",[-6,3395]],["4_6_8",[0,2305]],["4_11_11",[0,0]],["4_6_9",[0,2386]],["4_13_8",[0,2856]],["4_4_10",[0,3100]],["4_1_7",[0,3991]],["4_5_7",[0,2467]],["4_6_10",[0,2086]],["4_1_8",[0,1014]],["4_11_12",[-4,7868]],["4_5_8",[0,5374]],["4_0_14",[-3,957]],["4_1_9",[0,0]],["4_5_9",[0,5802]],["4_15_15",[0,4115]],["4_10_13",[0,13447]],["4_8_9",[0,2048]],["4_1_10",[0,0]],["4_4_11",[0,4]],["4_7_12",[0,12650]],["4_8_10",[0,493]],["4_4_12",[0,3279]],["4_13_9",[0,1056]],["4_13_10",[0,0]],["4_14_9",[-20,1962]],["4_4_13",[-91,10609]],["4_8_11",[0,0]],["4_14_10",[0,1412]],["4_12_6",[-1,6602]],["4_3_9",[0,196]],["4_13_11",[0,2422]],["4_11_13",[0,13583]],["4_12_7",[-21,2969]],["4_4_14",[-521,11819]],["4_3_10",[0,0]],["4_3_11",[0,0]],["4_10_14",[0,13974]],["4_4_15",[-145,1758]],["4_10_15",[0,5550]],["4_6_11",[0,857]],["4_8_12",[0,13320]],["4_6_12",[0,0]],["4_12_8",[0,2832]],["4_2_5",[0,3596]],["4_3_12",[0,5676]],["4_5_10",[0,1438]],["4_0_15",[0,0]],["4_7_13",[0,12987]],["4_2_6",[-78,3816]],["4_5_11",[0,2244]],["4_1_11",[0,0]],["4_5_12",[0,2869]],["4_3_13",[-132,11849]],["4_1_12",[0,0]],["4_5_13",[-160,3822]],["4_7_14",[596,12294]],["4_6_13",[-86,11617]],["4_14_11",[0,755]],["4_12_9",[0,0]],["4_6_14",[-271,10057]],["4_5_14",[-153,10664]],["4_1_13",[0,11576]],["4_13_12",[0,13172]],["4_14_12",[0,3826]],["4_5_15",[0,1397]],["4_12_10",[0,0]],["4_14_13",[0,5744]],["4_12_11",[0,2697]],["4_12_12",[0,13699]],["4_1_14",[-317,10807]],["4_6_15",[0,1868]],["4_11_14",[0,13983]],["4_7_15",[0,7285]],["4_1_15",[-116,1345]],["4_2_7",[0,51]],["4_11_15",[0,5689]],["4_13_13",[421,13192]],["4_13_14",[556,13196]],["4_2_8",[0,0]],["4_12_13",[135,15727]],["4_14_14",[300,5249]],["4_14_15",[0,2628]],["4_2_9",[0,1]],["4_2_10",[0,0]],["4_9_13",[0,13678]],["4_13_15",[0,6038]],["4_2_11",[0,0]],["4_9_14",[0,13722]],["4_12_14",[193,13775]],["4_9_15",[0,0]],["4_2_12",[-1,3492]],["4_2_13",[-21,12159]],["4_12_15",[0,5772]],["4_3_14",[-475,12482]],["4_2_14",[-364,11988]],["4_2_15",[-220,1503]],["4_3_15",[0,2413]],["4_8_13",[0,13457]],["4_8_14",[0,12940]],["4_8_15",[0,7420]],["5_8_0",[0,0]],["5_10_0",[0,0]],["5_30_0",[0,0]],["5_16_0",[0,0]],["5_24_0",[0,0]],["5_12_0",[0,0]],["5_22_0",[0,0]],["5_20_0",[0,0]],["5_14_0",[0,0]],["5_2_0",[0,0]],["5_20_1",[0,0]],["5_18_0",[0,0]],["5_16_1",[0,0]],["5_24_1",[0,0]],["5_22_1",[0,0]],["5_10_1",[0,939]],["5_2_1",[0,0]],["5_26_0",[0,0]],["5_8_1",[0,889]],["5_12_1",[-77,1622]],["5_20_2",[0,461]],["5_30_1",[0,0]],["5_18_1",[0,0]],["5_8_2",[0,1935]],["5_12_2",[0,3140]],["5_18_2",[0,0]],["5_28_0",[0,0]],["5_14_1",[0,853]],["5_26_1",[0,0]],["5_22_2",[0,0]],["5_16_2",[0,0]],["5_0_0",[0,0]],["5_12_3",[-87,11884]],["5_22_3",[0,0]],["5_6_0",[0,0]],["5_26_2",[0,0]],["5_20_3",[-1,680]],["5_14_2",[0,1547]],["5_30_2",[0,0]],["5_18_3",[0,952]],["5_8_3",[0,1769]],["5_0_1",[0,0]],["5_4_0",[0,0]],["5_24_2",[0,650]],["5_16_3",[0,818]],["5_10_2",[0,1827]],["5_28_1",[0,0]],["5_2_2",[0,0]],["5_12_4",[430,12576]],["5_24_3",[0,974]],["5_6_1",[0,0]],["5_18_4",[0,519]],["5_24_4",[0,1005]],["5_12_5",[508,12502]],["5_22_4",[0,521]],["5_14_3",[0,1610]],["5_2_3",[0,0]],["5_10_3",[0,4560]],["5_0_2",[0,0]],["5_16_4",[0,917]],["5_8_4",[0,2185]],["5_4_1",[0,0]],["5_20_4",[0,0]],["5_30_3",[0,0]],["5_8_5",[0,2068]],["5_26_3",[0,0]],["5_20_5",[0,907]],["5_14_4",[0,1041]],["5_8_6",[0,1597]],["5_30_4",[0,0]],["5_2_4",[0,0]],["5_6_2",[0,0]],["5_22_5",[0,892]],["5_12_6",[515,12193]],["5_24_5",[0,647]],["5_20_6",[0,1152]],["5_8_7",[0,581]],["5_16_5",[0,0]],["5_10_4",[0,11369]],["5_30_5",[0,0]],["5_8_8",[0,568]],["5_12_7",[0,12721]],["5_28_2",[0,0]],["5_0_3",[0,0]],["5_30_6",[0,43]],["5_4_2",[0,0]],["5_22_6",[0,69]],["5_26_4",[0,0]],["5_30_7",[0,1573]],["5_14_5",[-1,1722]],["5_16_6",[0,0]],["5_24_6",[0,636]],["5_8_9",[0,211]],["5_12_8",[0,10004]],["5_14_6",[0,1586]],["5_26_5",[0,436]],["5_28_3",[0,0]],["5_22_7",[0,235]],["5_2_5",[0,0]],["5_20_7",[0,259]],["5_6_3",[0,50]],["5_10_5",[0,2805]],["5_4_3",[0,0]],["5_30_8",[0,1660]],["5_22_8",[0,163]],["5_8_10",[0,496]],["5_10_6",[0,682]],["5_18_5",[0,163]],["5_0_4",[0,0]],["5_26_6",[0,468]],["5_8_11",[72,680]],["5_12_9",[0,2438]],["5_26_7",[12,481]],["5_12_10",[0,0]],["5_4_4",[0,0]],["5_14_7",[0,1035]],["5_12_11",[0,0]],["5_24_7",[24,1641]],["5_22_9",[12,150]],["5_22_10",[22,1395]],["5_2_6",[0,18]],["5_6_4",[0,207]],["5_24_8",[27,997]],["5_22_11",[115,5309]],["5_28_4",[0,0]],["5_26_8",[19,675]],["5_14_8",[0,1982]],["5_24_9",[31,1011]],["5_30_9",[0,4297]],["5_12_12",[0,0]],["5_14_9",[0,0]],["5_6_5",[0,492]],["5_28_5",[0,230]],["5_22_12",[167,7715]],["5_2_7",[0,2227]],["5_12_13",[0,0]],["5_14_10",[0,0]],["5_10_7",[0,2088]],["5_16_7",[0,0]],["5_28_6",[0,489]],["5_20_8",[4,443]],["5_4_5",[0,55]],["5_12_14",[0,0]],["5_24_10",[230,3802]],["5_2_8",[10,5957]],["5_18_6",[0,612]],["5_16_8",[0,2253]],["5_14_11",[0,0]],["5_0_5",[0,0]],["5_12_15",[0,0]],["5_10_8",[-1,1729]],["5_18_7",[0,1155]],["5_24_11",[28,4447]],["5_30_10",[0,3255]],["5_0_6",[0,950]],["5_18_8",[0,495]],["5_0_7",[0,1429]],["5_12_16",[0,1238]],["5_0_8",[0,1155]],["5_18_9",[0,322]],["5_8_12",[0,1767]],["5_26_9",[106,2637]],["5_10_9",[0,1409]],["5_10_10",[0,1173]],["5_14_12",[0,1523]],["5_26_10",[265,2456]],["5_28_7",[3,2267]],["5_6_6",[0,621]],["5_16_9",[0,2173]],["5_14_13",[-23,3303]],["5_22_13",[0,5942]],["5_20_9",[31,373]],["5_10_11",[0,1061]],["5_26_11",[7,2076]],["5_0_9",[0,345]],["5_18_10",[21,1177]],["5_22_14",[0,2413]],["5_4_6",[0,237]],["5_20_10",[-11,599]],["5_12_17",[0,2571]],["5_10_12",[0,1]],["5_16_10",[0,996]],["5_26_12",[-6,2789]],["5_16_11",[0,4361]],["5_28_8",[102,2762]],["5_8_13",[0,966]],["5_8_14",[0,2702]],["5_6_7",[0,549]],["5_10_13",[0,0]],["5_12_18",[0,2474]],["5_30_11",[0,0]],["5_2_9",[0,3726]],["5_16_12",[-35,2133]],["5_10_14",[0,1173]],["5_8_15",[0,3588]],["5_10_15",[0,2718]],["5_0_10",[0,1484]],["5_2_10",[0,24]],["5_14_14",[0,1398]],["5_0_11",[0,0]],["5_0_12",[0,0]],["5_16_13",[122,2557]],["5_14_15",[0,1324]],["5_6_8",[0,624]],["5_2_11",[0,0]],["5_8_16",[0,5547]],["5_24_12",[722,6355]],["5_10_16",[1,1048]],["5_0_13",[0,0]],["5_0_14",[0,0]],["5_24_13",[0,7021]],["5_18_11",[0,2629]],["5_0_15",[0,0]],["5_14_16",[0,402]],["5_10_17",[77,5543]],["5_24_14",[0,2786]],["5_4_7",[0,628]],["5_12_19",[0,0]],["5_0_16",[0,0]],["5_20_11",[-132,4091]],["5_24_15",[0,3202]],["5_22_15",[0,2360]],["5_30_12",[0,0]],["5_22_16",[0,0]],["5_22_17",[0,0]],["5_10_18",[6,6025]],["5_4_8",[16,2518]],["5_2_12",[0,0]],["5_18_12",[0,2816]],["5_0_17",[0,1754]],["5_12_20",[0,0]],["5_8_17",[0,0]],["5_14_17",[0,0]],["5_24_16",[0,2638]],["5_18_13",[-109,1735]],["5_10_19",[0,2510]],["5_30_13",[0,0]],["5_0_18",[0,2]],["5_14_18",[0,0]],["5_30_14",[0,0]],["5_22_18",[0,0]],["5_8_18",[0,0]],["5_30_15",[0,522]],["5_22_19",[0,704]],["5_10_20",[0,1471]],["5_30_16",[0,2054]],["5_14_19",[0,1592]],["5_24_17",[0,0]],["5_12_21",[0,2536]],["5_22_20",[0,507]],["5_2_13",[0,0]],["5_10_21",[0,929]],["5_30_17",[0,1426]],["5_18_14",[171,2833]],["5_22_21",[0,2376]],["5_0_19",[0,0]],["5_8_19",[0,985]],["5_18_15",[354,4538]],["5_24_18",[0,0]],["5_2_14",[0,4036]],["5_28_9",[0,2386]],["5_18_16",[367,3981]],["5_8_20",[0,0]],["5_30_18",[0,1149]],["5_20_12",[-44,5148]],["5_2_15",[0,39]],["5_12_22",[0,326]],["5_22_22",[0,0]],["5_26_13",[-9,3531]],["5_2_16",[0,1]],["5_16_14",[135,1810]],["5_10_22",[0,85]],["5_12_23",[0,0]],["5_30_19",[0,0]],["5_0_20",[0,214]],["5_8_21",[0,0]],["5_26_14",[-7,2631]],["5_6_9",[157,856]],["5_28_10",[0,1854]],["5_20_13",[0,4117]],["5_14_20",[0,0]],["5_20_14",[0,2339]],["5_24_19",[0,0]],["5_2_17",[0,1232]],["5_10_23",[0,2545]],["5_16_15",[0,3590]],["5_30_20",[0,2291]],["5_20_15",[0,2292]],["5_14_21",[0,0]],["5_20_16",[0,511]],["5_22_23",[0,0]],["5_10_24",[0,3028]],["5_16_16",[0,820]],["5_30_21",[0,511]],["5_26_15",[0,3494]],["5_12_24",[0,0]],["5_10_25",[-1,2915]],["5_16_17",[0,0]],["5_0_21",[0,0]],["5_2_18",[0,0]],["5_20_17",[0,2643]],["5_4_9",[0,2704]],["5_6_10",[248,1748]],["5_8_22",[0,0]],["5_10_26",[0,2642]],["5_18_17",[92,2330]],["5_20_18",[0,2495]],["5_0_22",[0,0]],["5_8_23",[0,0]],["5_16_18",[0,0]],["5_28_11",[0,2055]],["5_26_16",[0,3118]],["5_8_24",[0,0]],["5_14_22",[0,0]],["5_2_19",[0,0]],["5_28_12",[0,3377]],["5_0_23",[0,0]],["5_8_25",[0,3425]],["5_16_19",[0,0]],["5_0_24",[0,0]],["5_10_27",[0,216]],["5_18_18",[0,3362]],["5_20_19",[0,0]],["5_28_13",[0,6]],["5_12_25",[0,0]],["5_28_14",[0,653]],["5_0_25",[0,0]],["5_24_20",[0,0]],["5_26_17",[0,655]],["5_22_24",[-46,2715]],["5_18_19",[0,2153]],["5_12_26",[0,0]],["5_30_22",[0,0]],["5_20_20",[0,696]],["5_28_15",[0,0]],["5_10_28",[0,0]],["5_10_29",[-169,619]],["5_16_20",[0,0]],["5_4_10",[0,3355]],["5_2_20",[0,0]],["5_26_18",[0,1039]],["5_20_21",[0,0]],["5_24_21",[0,0]],["5_10_30",[0,858]],["5_4_11",[0,1643]],["5_10_31",[0,0]],["5_0_26",[0,0]],["5_26_19",[0,671]],["5_28_16",[0,4429]],["5_14_23",[0,0]],["5_18_20",[0,0]],["5_30_23",[0,0]],["5_8_26",[-56,10819]],["5_12_27",[0,3962]],["5_28_17",[0,1268]],["5_26_20",[0,0]],["5_14_24",[0,0]],["5_20_22",[0,0]],["5_2_21",[0,0]],["5_20_23",[0,3994]],["5_4_12",[0,1428]],["5_26_21",[0,0]],["5_24_22",[0,0]],["5_20_24",[0,3968]],["5_16_21",[0,633]],["5_4_13",[0,0]],["5_11_0",[0,0]],["5_0_27",[0,0]],["5_4_14",[0,0]],["5_18_21",[0,0]],["5_0_28",[0,0]],["5_30_24",[0,2371]],["5_12_28",[-23,2282]],["5_22_25",[0,5117]],["5_28_18",[-27,910]],["5_26_22",[0,0]],["5_11_1",[0,1187]],["5_6_11",[451,3872]],["5_14_25",[0,1784]],["5_16_22",[0,0]],["5_11_2",[0,1530]],["5_6_12",[264,4098]],["5_24_23",[0,2785]],["5_0_29",[0,0]],["5_2_22",[0,0]],["5_26_23",[0,2532]],["5_30_25",[0,5374]],["5_22_26",[0,6344]],["5_2_23",[0,0]],["5_8_27",[0,6395]],["5_11_3",[-281,11457]],["5_28_19",[0,1367]],["5_16_23",[0,0]],["5_20_25",[117,12952]],["5_30_26",[0,3462]],["5_12_29",[-270,1445]],["5_0_30",[0,0]],["5_18_22",[0,0]],["5_8_28",[-44,11812]],["5_24_24",[-1,4740]],["5_0_31",[0,0]],["5_16_24",[0,2071]],["5_22_27",[0,1690]],["5_22_28",[0,14074]],["5_1_0",[0,0]],["5_8_29",[-776,11827]],["5_14_26",[-1,11632]],["5_18_23",[0,0]],["5_2_24",[0,0]],["5_26_24",[-1,3120]],["5_1_1",[0,0]],["5_14_27",[-83,12126]],["5_8_30",[-161,1803]],["5_28_20",[0,1249]],["5_6_13",[0,3194]],["5_1_2",[0,0]],["5_28_21",[0,0]],["5_22_29",[1112,8648]],["5_6_14",[0,3830]],["5_4_15",[0,0]],["5_12_30",[0,1506]],["5_24_25",[560,13714]],["5_30_27",[0,3863]],["5_2_25",[0,0]],["5_30_28",[-4,3500]],["5_22_30",[0,5588]],["5_18_24",[0,3125]],["5_26_25",[195,13069]],["5_30_29",[-36,3163]],["5_12_31",[0,0]],["5_30_30",[0,4180]],["5_6_15",[0,0]],["5_28_22",[0,0]],["5_2_26",[0,902]],["5_13_0",[0,0]],["5_8_31",[0,0]],["5_6_16",[0,0]],["5_2_27",[-9,1577]],["5_20_26",[533,11655]],["5_22_31",[0,0]],["5_30_31",[0,0]],["5_18_25",[0,3326]],["5_4_16",[0,0]],["5_11_4",[-2,12501]],["5_14_28",[444,4576]],["5_1_3",[0,0]],["5_2_28",[-29,3255]],["5_9_0",[0,0]],["5_4_17",[0,0]],["5_13_1",[0,1738]],["5_31_0",[0,0]],["5_18_26",[673,13490]],["5_1_4",[0,0]],["5_28_23",[0,770]],["5_9_1",[0,1678]],["5_13_2",[0,1446]],["5_11_5",[0,12265]],["5_23_0",[0,0]],["5_31_1",[0,0]],["5_6_17",[0,0]],["5_13_3",[0,2898]],["5_9_2",[0,2490]],["5_1_5",[0,0]],["5_23_1",[0,0]],["5_13_4",[13,3715]],["5_2_29",[-268,10423]],["5_31_2",[0,0]],["5_28_24",[0,4051]],["5_23_2",[0,0]],["5_4_18",[0,13]],["5_28_25",[74,3092]],["5_1_6",[0,18]],["5_16_25",[0,13122]],["5_9_3",[0,2167]],["5_1_7",[0,1349]],["5_4_19",[0,0]],["5_2_30",[-122,437]],["5_1_8",[-1,1108]],["5_9_4",[0,2109]],["5_28_26",[0,6106]],["5_20_27",[0,13528]],["5_9_5",[0,1052]],["5_6_18",[0,408]],["5_4_20",[0,0]],["5_9_6",[-3,1765]],["5_6_19",[0,0]],["5_2_31",[0,0]],["5_23_3",[0,213]],["5_23_4",[0,0]],["5_6_20",[0,0]],["5_1_9",[0,2236]],["5_3_0",[0,0]],["5_6_21",[0,0]],["5_9_7",[0,1653]],["5_23_5",[0,247]],["5_4_21",[0,0]],["5_31_3",[0,0]],["5_23_6",[0,454]],["5_6_22",[0,0]],["5_1_10",[0,2513]],["5_16_26",[409,13489]],["5_9_8",[0,771]],["5_31_4",[0,0]],["5_1_11",[0,0]],["5_4_22",[0,0]],["5_1_12",[0,0]],["5_6_23",[0,0]],["5_1_13",[0,1432]],["5_3_1",[0,0]],["5_23_7",[0,902]],["5_1_14",[0,925]],["5_13_5",[0,12536]],["5_31_5",[0,0]],["5_4_23",[0,0]],["5_28_27",[1462,5952]],["5_9_9",[0,655]],["5_1_15",[0,0]],["5_23_8",[2,689]],["5_9_10",[0,1056]],["5_9_11",[0,1597]],["5_16_27",[389,10452]],["5_23_9",[23,335]],["5_26_26",[308,13234]],["5_9_12",[0,1068]],["5_20_28",[-5,7884]],["5_1_16",[0,0]],["5_4_24",[0,0]],["5_6_24",[0,0]],["5_1_17",[0,16]],["5_16_28",[2115,12400]],["5_11_6",[0,8206]],["5_31_6",[0,574]],["5_3_2",[0,0]],["5_1_18",[0,0]],["5_9_13",[0,60]],["5_26_27",[87,5714]],["5_14_29",[463,11591]],["5_4_25",[0,3164]],["5_3_3",[0,0]],["5_20_29",[0,0]],["5_16_29",[932,12504]],["5_9_14",[-40,2807]],["5_23_10",[74,4066]],["5_23_11",[-216,6733]],["5_4_26",[0,12119]],["5_23_12",[725,6626]],["5_26_28",[739,13228]],["5_3_4",[0,0]],["5_9_15",[0,5165]],["5_3_5",[0,0]],["5_20_30",[0,0]],["5_9_16",[0,5929]],["5_13_6",[0,5060]],["5_1_19",[0,0]],["5_3_6",[0,0]],["5_28_28",[1817,5348]],["5_31_7",[0,1687]],["5_13_7",[0,4228]],["5_3_7",[0,2490]],["5_23_13",[0,7808]],["5_14_30",[0,6507]],["5_1_20",[0,0]],["5_11_7",[0,4372]],["5_1_21",[0,0]],["5_6_25",[0,2721]],["5_20_31",[0,0]],["5_1_22",[0,0]],["5_18_27",[568,13646]],["5_23_14",[0,1371]],["5_21_0",[0,0]],["5_14_31",[0,0]],["5_13_8",[0,1285]],["5_13_9",[0,0]],["5_21_1",[0,0]],["5_18_28",[0,13802]],["5_31_8",[0,2096]],["5_15_0",[0,0]],["5_21_2",[0,583]],["5_31_9",[0,1403]],["5_4_27",[-27,12127]],["5_21_3",[0,643]],["5_31_10",[0,902]],["5_26_29",[494,13201]],["5_18_29",[0,6978]],["5_16_30",[0,7398]],["5_13_10",[0,0]],["5_21_4",[0,522]],["5_31_11",[0,0]],["5_3_8",[112,4818]],["5_31_12",[0,0]],["5_28_29",[574,6004]],["5_31_13",[0,0]],["5_11_8",[0,11521]],["5_6_26",[0,11225]],["5_3_9",[-2,5699]],["5_15_1",[0,0]],["5_23_15",[0,2261]],["5_1_23",[0,0]],["5_13_11",[0,0]],["5_11_9",[0,2035]],["5_26_30",[0,6265]],["5_23_16",[0,0]],["5_31_14",[0,0]],["5_18_30",[0,0]],["5_21_5",[0,1376]],["5_24_26",[73,14065]],["5_11_10",[0,340]],["5_15_2",[0,0]],["5_31_15",[0,1]],["5_21_6",[0,1163]],["5_23_17",[0,0]],["5_1_24",[0,0]],["5_21_7",[0,1316]],["5_24_27",[329,14234]],["5_21_8",[2,1664]],["5_23_18",[0,0]],["5_28_30",[0,2719]],["5_21_9",[12,1411]],["5_31_16",[0,4]],["5_23_19",[0,0]],["5_9_17",[0,6084]],["5_16_31",[0,0]],["5_21_10",[6,1504]],["5_26_31",[0,0]],["5_3_10",[0,0]],["5_11_11",[0,335]],["5_21_11",[-17,931]],["5_15_3",[0,0]],["5_1_25",[0,0]],["5_3_11",[0,0]],["5_17_0",[0,0]],["5_21_12",[-20,4527]],["5_1_26",[0,0]],["5_15_4",[0,0]],["5_3_12",[0,0]],["5_13_12",[0,1912]],["5_1_27",[0,1082]],["5_31_17",[0,1117]],["5_11_12",[0,0]],["5_21_13",[0,4121]],["5_23_20",[0,0]],["5_15_5",[0,0]],["5_4_28",[-303,12031]],["5_31_18",[0,0]],["5_3_13",[0,0]],["5_23_21",[0,0]],["5_21_14",[0,243]],["5_11_13",[0,0]],["5_3_14",[0,0]],["5_27_0",[0,0]],["5_23_22",[0,0]],["5_21_15",[0,0]],["5_18_31",[0,0]],["5_11_14",[0,0]],["5_31_19",[0,2485]],["5_4_29",[-428,11054]],["5_27_1",[0,0]],["5_11_15",[0,866]],["5_9_18",[0,6513]],["5_1_28",[-9,1149]],["5_13_13",[0,0]],["5_28_31",[0,0]],["5_27_2",[0,0]],["5_11_16",[0,842]],["5_13_14",[0,2210]],["5_19_0",[0,0]],["5_23_23",[0,0]],["5_9_19",[0,6287]],["5_13_15",[0,0]],["5_1_29",[0,0]],["5_19_1",[0,0]],["5_31_20",[0,3109]],["5_9_20",[0,3541]],["5_4_30",[-396,1079]],["5_1_30",[0,0]],["5_21_16",[0,0]],["5_13_16",[0,28]],["5_19_2",[0,0]],["5_29_0",[0,0]],["5_17_1",[0,0]],["5_21_17",[0,666]],["5_9_21",[-21,3287]],["5_19_3",[0,0]],["5_13_17",[0,0]],["5_29_1",[0,0]],["5_27_3",[0,0]],["5_24_28",[339,13872]],["5_4_31",[0,0]],["5_21_18",[0,0]],["5_11_17",[109,1585]],["5_3_15",[0,0]],["5_27_4",[0,0]],["5_5_0",[0,0]],["5_13_18",[0,0]],["5_11_18",[0,2040]],["5_19_4",[0,0]],["5_3_16",[0,1029]],["5_23_24",[0,3223]],["5_1_31",[0,0]],["5_9_22",[0,93]],["5_27_5",[0,0]],["5_5_1",[0,0]],["5_11_19",[0,319]],["5_6_27",[-284,11966]],["5_15_6",[0,2078]],["5_29_2",[0,0]],["5_13_19",[0,0]],["5_17_2",[0,0]],["5_27_6",[0,898]],["5_6_28",[7,12548]],["5_21_19",[0,0]],["5_31_21",[0,395]],["5_29_3",[0,0]],["5_27_7",[4,2142]],["5_13_20",[0,0]],["5_5_2",[0,0]],["5_15_7",[0,0]],["5_3_17",[0,1]],["5_31_22",[0,0]],["5_9_23",[0,0]],["5_17_3",[0,1423]],["5_13_21",[0,0]],["5_11_20",[0,0]],["5_29_4",[0,0]],["5_6_29",[-330,11958]],["5_5_3",[0,0]],["5_15_8",[0,607]],["5_19_5",[0,0]],["5_3_18",[0,0]],["5_27_8",[19,1983]],["5_21_20",[0,0]],["5_31_23",[0,0]],["5_23_25",[0,11495]],["5_24_29",[994,13690]],["5_13_22",[0,1112]],["5_24_30",[0,5651]],["5_29_5",[0,239]],["5_27_9",[84,2090]],["5_24_31",[0,0]],["5_6_30",[0,2455]],["5_19_6",[0,0]],["5_11_21",[0,0]],["5_25_0",[0,0]],["5_29_6",[0,317]],["5_25_1",[0,0]],["5_15_9",[0,1186]],["5_5_4",[0,91]],["5_25_2",[0,0]],["5_3_19",[0,0]],["5_17_4",[0,1648]],["5_19_7",[0,1139]],["5_9_24",[0,2951]],["5_6_31",[0,0]],["5_29_7",[-16,863]],["5_11_22",[0,1864]],["5_25_3",[0,230]],["5_9_25",[-11,3402]],["5_17_5",[0,806]],["5_15_10",[0,874]],["5_5_5",[0,750]],["5_27_10",[23,2037]],["5_19_8",[0,272]],["5_9_26",[-2,4848]],["5_31_24",[0,0]],["5_11_23",[0,715]],["5_23_26",[0,13578]],["5_21_21",[0,0]],["5_27_11",[-55,2560]],["5_29_8",[0,2342]],["5_17_6",[0,245]],["5_5_6",[0,677]],["5_25_4",[0,970]],["5_7_0",[0,0]],["5_29_9",[0,1846]],["5_15_11",[0,2948]],["5_23_27",[0,13592]],["5_13_23",[0,0]],["5_19_9",[20,304]],["5_25_5",[0,1097]],["5_9_27",[-173,1991]],["5_3_20",[0,0]],["5_7_1",[0,0]],["5_5_7",[0,856]],["5_11_24",[0,0]],["5_25_6",[0,742]],["5_19_10",[8,276]],["5_25_7",[34,911]],["5_29_10",[0,2108]],["5_27_12",[0,2359]],["5_7_2",[0,883]],["5_21_22",[0,0]],["5_25_8",[153,904]],["5_27_13",[0,1669]],["5_9_28",[0,1520]],["5_21_23",[0,2113]],["5_25_9",[171,2303]],["5_19_11",[-11,5341]],["5_29_11",[0,1360]],["5_17_7",[0,1877]],["5_25_10",[346,2887]],["5_3_21",[0,0]],["5_5_8",[83,1483]],["5_17_8",[0,1683]],["5_9_29",[-256,10411]],["5_31_25",[0,3957]],["5_27_14",[0,922]],["5_29_12",[0,0]],["5_15_12",[0,3540]],["5_25_11",[691,3273]],["5_7_3",[0,1985]],["5_13_24",[0,0]],["5_29_13",[0,0]],["5_25_12",[43,4896]],["5_15_13",[0,3767]],["5_3_22",[0,0]],["5_17_9",[0,1130]],["5_7_4",[0,1739]],["5_9_30",[-200,1010]],["5_23_28",[0,13400]],["5_5_9",[133,2090]],["5_25_13",[-10,6305]],["5_19_12",[-360,4624]],["5_23_29",[0,13692]],["5_21_24",[0,4774]],["5_23_30",[0,5749]],["5_17_10",[0,2193]],["5_9_31",[0,0]],["5_31_26",[0,0]],["5_21_25",[77,4786]],["5_3_23",[0,0]],["5_29_14",[0,0]],["5_13_25",[0,0]],["5_27_15",[0,2567]],["5_21_26",[443,7322]],["5_7_5",[0,601]],["5_25_14",[-22,2598]],["5_3_24",[0,0]],["5_11_25",[0,0]],["5_27_16",[0,2587]],["5_25_15",[0,1872]],["5_31_27",[0,2285]],["5_25_16",[0,3241]],["5_7_6",[0,587]],["5_29_15",[0,14]],["5_15_14",[39,875]],["5_19_13",[-427,2405]],["5_13_26",[0,10992]],["5_25_17",[0,0]],["5_29_16",[0,3848]],["5_15_15",[0,1528]],["5_3_25",[0,0]],["5_11_26",[0,0]],["5_25_18",[0,0]],["5_11_27",[-245,3991]],["5_13_27",[-250,11653]],["5_11_28",[-2,10775]],["5_23_31",[0,0]],["5_15_16",[0,0]],["5_21_27",[0,13367]],["5_17_11",[0,3379]],["5_25_19",[0,0]],["5_13_28",[-10,2687]],["5_19_14",[-152,4329]],["5_3_26",[0,3379]],["5_11_29",[0,1965]],["5_15_17",[0,604]],["5_7_7",[0,555]],["5_17_12",[0,3016]],["5_11_30",[0,1403]],["5_27_17",[0,884]],["5_31_28",[0,0]],["5_27_18",[0,1202]],["5_17_13",[-49,2116]],["5_3_27",[0,11578]],["5_13_29",[-383,11241]],["5_25_20",[0,0]],["5_7_8",[0,583]],["5_21_28",[0,14023]],["5_15_18",[0,0]],["5_11_31",[0,0]],["5_7_9",[0,449]],["5_17_14",[160,3182]],["5_5_10",[0,3323]],["5_15_19",[0,735]],["5_7_10",[84,779]],["5_15_20",[0,0]],["5_13_30",[0,1879]],["5_31_29",[0,0]],["5_17_15",[111,2200]],["5_29_17",[0,1072]],["5_3_28",[-60,1883]],["5_29_18",[0,1488]],["5_31_30",[0,0]],["5_3_29",[-388,10871]],["5_17_16",[0,1800]],["5_7_11",[164,1053]],["5_25_21",[0,0]],["5_13_31",[0,0]],["5_29_19",[0,2057]],["5_25_22",[0,0]],["5_3_30",[-249,1410]],["5_7_12",[14,1025]],["5_15_21",[0,0]],["5_17_17",[0,2400]],["5_27_19",[0,171]],["5_5_11",[0,4189]],["5_7_13",[0,3414]],["5_21_29",[0,8657]],["5_19_15",[0,4219]],["5_31_31",[0,0]],["5_19_16",[0,5606]],["5_29_20",[0,1466]],["5_25_23",[0,2503]],["5_3_31",[0,0]],["5_17_18",[0,2193]],["5_5_12",[-90,3948]],["5_27_20",[0,0]],["5_29_21",[0,0]],["5_7_14",[0,4976]],["5_5_13",[0,2654]],["5_27_21",[0,0]],["5_19_17",[0,2663]],["5_15_22",[0,0]],["5_7_15",[0,1414]],["5_19_18",[0,1234]],["5_7_16",[0,1481]],["5_5_14",[0,0]],["5_15_23",[0,0]],["5_7_17",[0,0]],["5_21_30",[0,5578]],["5_5_15",[0,0]],["5_27_22",[0,0]],["5_19_19",[0,0]],["5_5_16",[0,0]],["5_5_17",[0,0]],["5_27_23",[0,1208]],["5_17_19",[0,1952]],["5_29_22",[0,0]],["5_7_18",[0,0]],["5_5_18",[0,0]],["5_25_24",[-20,7550]],["5_7_19",[0,0]],["5_15_24",[0,0]],["5_5_19",[0,0]],["5_21_31",[0,0]],["5_19_20",[0,1085]],["5_7_20",[0,0]],["5_25_25",[893,5278]],["5_29_23",[0,0]],["5_19_21",[0,0]],["5_27_24",[0,3358]],["5_7_21",[0,0]],["5_25_26",[398,16881]],["5_5_20",[0,0]],["5_17_20",[0,0]],["5_25_27",[409,13607]],["5_29_24",[0,3941]],["5_5_21",[0,0]],["5_7_22",[0,0]],["5_19_22",[0,0]],["5_27_25",[121,13182]],["5_7_23",[0,0]],["5_25_28",[81,11732]],["5_29_25",[206,3659]],["5_15_25",[0,12745]],["5_7_24",[0,6e3]],["5_19_23",[0,0]],["5_17_21",[0,0]],["5_7_25",[0,3818]],["5_27_26",[176,13228]],["5_27_27",[917,5156]],["5_17_22",[0,0]],["5_5_22",[0,0]],["5_19_24",[0,2322]],["5_17_23",[0,0]],["5_15_26",[720,13158]],["5_17_24",[0,2225]],["5_7_26",[-60,10925]],["5_5_23",[0,0]],["5_5_24",[0,0]],["5_25_29",[545,13435]],["5_27_28",[2024,3717]],["5_19_25",[1076,3328]],["5_29_26",[1604,4735]],["5_27_29",[1549,4189]],["5_7_27",[-266,11877]],["5_29_27",[1317,4633]],["5_17_25",[0,13322]],["5_25_30",[0,5836]],["5_29_28",[294,3461]],["5_5_25",[0,3649]],["5_15_27",[594,12372]],["5_27_30",[0,3504]],["5_25_31",[0,0]],["5_17_26",[188,13467]],["5_19_26",[560,13678]],["5_29_29",[893,6492]],["5_7_28",[48,12310]],["5_29_30",[0,2688]],["5_15_28",[1348,12294]],["5_27_31",[0,0]],["5_5_26",[-44,10679]],["5_7_29",[-775,12048]],["5_7_30",[0,2203]],["5_17_27",[0,13641]],["5_17_28",[524,12941]],["5_7_31",[0,0]],["5_15_29",[1307,12179]],["5_5_27",[-132,12220]],["5_19_27",[0,10866]],["5_5_28",[-169,11850]],["5_17_29",[0,12535]],["5_5_29",[-121,11218]],["5_5_30",[0,1513]],["5_17_30",[0,7464]],["5_19_28",[-1,12167]],["5_15_30",[0,7358]],["5_5_31",[0,0]],["5_17_31",[0,0]],["5_19_29",[0,0]],["5_15_31",[0,0]],["5_19_30",[0,0]],["5_19_31",[0,0]],["5_29_31",[0,0]],["6_60_0",[0,0]],["6_20_0",[0,0]],["6_8_0",[0,0]],["6_16_0",[0,0]],["6_40_0",[0,0]],["6_48_0",[0,0]],["6_44_0",[0,0]],["6_56_0",[0,0]],["6_32_0",[0,0]],["6_24_0",[0,0]],["6_4_0",[0,0]],["6_8_1",[0,0]],["6_16_1",[0,0]],["6_36_0",[0,0]],["6_52_0",[0,0]],["6_12_0",[0,0]],["6_0_0",[0,0]],["6_28_0",[0,0]],["6_60_1",[0,0]],["6_16_2",[0,0]],["6_20_1",[0,0]],["6_24_1",[0,0]],["6_16_3",[0,0]],["6_12_1",[0,0]],["6_0_1",[0,0]],["6_40_1",[0,0]],["6_32_1",[0,0]],["6_36_1",[0,0]],["6_44_1",[0,0]],["6_52_1",[0,0]],["6_60_2",[0,0]],["6_28_1",[0,0]],["6_56_1",[0,0]],["6_24_2",[0,0]],["6_16_4",[0,1360]],["6_48_1",[0,0]],["6_4_1",[0,0]],["6_8_2",[0,0]],["6_20_2",[0,0]],["6_0_2",[0,0]],["6_16_5",[0,1569]],["6_40_2",[0,0]],["6_36_2",[0,0]],["6_52_2",[0,0]],["6_24_3",[-80,1388]],["6_0_3",[0,0]],["6_4_2",[0,0]],["6_44_2",[0,0]],["6_56_2",[0,0]],["6_32_2",[0,0]],["6_48_2",[0,0]],["6_28_2",[0,0]],["6_52_3",[0,0]],["6_8_3",[0,0]],["6_60_3",[0,0]],["6_40_3",[0,0]],["6_24_4",[0,1630]],["6_0_4",[0,0]],["6_44_3",[0,0]],["6_36_3",[0,0]],["6_16_6",[0,1259]],["6_32_3",[0,0]],["6_20_3",[0,972]],["6_48_3",[0,0]],["6_60_4",[0,0]],["6_12_2",[0,0]],["6_40_4",[0,0]],["6_24_5",[18,3219]],["6_28_3",[0,890]],["6_44_4",[0,0]],["6_60_5",[0,0]],["6_56_3",[0,0]],["6_0_5",[0,0]],["6_40_5",[0,203]],["6_8_4",[0,0]],["6_32_4",[0,0]],["6_20_4",[0,1881]],["6_16_7",[0,1745]],["6_4_3",[0,0]],["6_48_4",[0,0]],["6_36_4",[0,0]],["6_52_4",[0,0]],["6_56_4",[0,0]],["6_20_5",[0,1374]],["6_8_5",[0,0]],["6_28_4",[0,698]],["6_20_6",[0,1412]],["6_32_5",[0,0]],["6_40_6",[0,713]],["6_4_4",[0,0]],["6_16_8",[0,1721]],["6_0_6",[0,0]],["6_16_9",[0,1668]],["6_12_3",[0,0]],["6_24_6",[-182,2951]],["6_60_6",[0,0]],["6_44_5",[0,0]],["6_48_5",[0,690]],["6_4_5",[0,0]],["6_56_5",[0,0]],["6_48_6",[0,1026]],["6_36_5",[0,0]],["6_4_6",[0,0]],["6_16_10",[0,1378]],["6_28_5",[0,1108]],["6_44_6",[0,0]],["6_16_11",[0,1062]],["6_40_7",[0,450]],["6_8_6",[0,0]],["6_52_5",[0,0]],["6_60_7",[0,0]],["6_20_7",[0,1221]],["6_0_7",[0,0]],["6_12_4",[0,0]],["6_4_7",[0,0]],["6_8_7",[0,0]],["6_56_6",[0,0]],["6_36_6",[0,571]],["6_48_7",[0,899]],["6_52_6",[0,0]],["6_16_12",[0,854]],["6_32_6",[0,0]],["6_60_8",[0,0]],["6_28_6",[0,1663]],["6_44_7",[0,0]],["6_16_13",[0,464]],["6_24_7",[45,12072]],["6_16_14",[0,580]],["6_48_8",[0,92]],["6_0_8",[0,0]],["6_12_5",[0,0]],["6_20_8",[0,3216]],["6_36_7",[0,1059]],["6_16_15",[0,482]],["6_56_7",[0,0]],["6_44_8",[0,0]],["6_60_9",[0,0]],["6_48_9",[0,7]],["6_4_8",[0,0]],["6_52_7",[0,0]],["6_40_8",[0,0]],["6_32_7",[0,0]],["6_40_9",[0,0]],["6_56_8",[0,0]],["6_40_10",[0,0]],["6_44_9",[0,526]],["6_44_10",[0,994]],["6_36_8",[0,203]],["6_16_16",[0,521]],["6_60_10",[0,0]],["6_8_8",[0,0]],["6_28_7",[0,1513]],["6_40_11",[0,0]],["6_8_9",[0,0]],["6_52_8",[0,0]],["6_60_11",[0,0]],["6_44_11",[0,0]],["6_12_6",[0,0]],["6_56_9",[0,0]],["6_4_9",[0,0]],["6_36_9",[0,563]],["6_20_9",[0,3314]],["6_32_8",[0,0]],["6_12_7",[0,0]],["6_8_10",[0,0]],["6_48_10",[0,483]],["6_48_11",[1,651]],["6_0_9",[0,0]],["6_48_12",[0,591]],["6_4_10",[0,0]],["6_16_17",[0,124]],["6_40_12",[0,0]],["6_36_10",[0,0]],["6_32_9",[0,0]],["6_40_13",[0,0]],["6_16_18",[0,0]],["6_28_8",[0,939]],["6_4_11",[0,0]],["6_60_12",[0,0]],["6_20_10",[0,1774]],["6_52_9",[0,0]],["6_60_13",[0,31]],["6_48_13",[5,186]],["6_0_10",[0,0]],["6_48_14",[29,1631]],["6_56_10",[0,127]],["6_40_14",[0,101]],["6_16_19",[0,164]],["6_8_11",[0,0]],["6_12_8",[0,66]],["6_36_11",[0,0]],["6_32_10",[0,0]],["6_0_11",[0,0]],["6_60_14",[0,955]],["6_56_11",[0,401]],["6_28_9",[0,1087]],["6_0_12",[0,0]],["6_40_15",[0,224]],["6_24_8",[550,12621]],["6_16_20",[0,329]],["6_48_15",[50,1537]],["6_36_12",[0,0]],["6_12_9",[0,85]],["6_44_12",[0,63]],["6_48_16",[18,1008]],["6_8_12",[0,0]],["6_0_13",[0,1019]],["6_40_16",[14,371]],["6_56_12",[0,32]],["6_48_17",[27,809]],["6_56_13",[0,376]],["6_44_13",[0,322]],["6_36_13",[-1,633]],["6_44_14",[0,45]],["6_4_12",[0,0]],["6_40_17",[28,454]],["6_12_10",[0,407]],["6_36_14",[0,1085]],["6_52_10",[0,516]],["6_56_14",[7,1479]],["6_44_15",[0,238]],["6_4_13",[0,14]],["6_16_21",[78,478]],["6_8_13",[0,0]],["6_32_11",[0,0]],["6_20_11",[0,0]],["6_40_18",[28,235]],["6_28_10",[0,1754]],["6_0_14",[0,656]],["6_40_19",[43,244]],["6_60_15",[2,1034]],["6_16_22",[175,555]],["6_48_18",[36,1078]],["6_44_16",[0,124]],["6_36_15",[73,785]],["6_16_23",[166,444]],["6_8_14",[0,252]],["6_44_17",[14,166]],["6_32_12",[0,0]],["6_4_14",[0,854]],["6_60_16",[114,1642]],["6_12_11",[0,398]],["6_40_20",[26,313]],["6_0_15",[0,1458]],["6_60_17",[0,1722]],["6_52_11",[0,191]],["6_16_24",[83,512]],["6_44_18",[12,105]],["6_28_11",[-2,1765]],["6_32_13",[0,0]],["6_44_19",[30,138]],["6_28_12",[0,1666]],["6_40_21",[-25,282]],["6_48_19",[63,775]],["6_12_12",[0,549]],["6_4_15",[19,2327]],["6_36_16",[0,315]],["6_0_16",[0,1330]],["6_32_14",[0,0]],["6_60_18",[0,1711]],["6_48_20",[211,2449]],["6_28_13",[0,1284]],["6_4_16",[20,1409]],["6_48_21",[516,3843]],["6_44_20",[29,784]],["6_36_17",[0,225]],["6_8_15",[0,455]],["6_24_9",[368,12580]],["6_48_22",[828,4149]],["6_16_25",[36,1188]],["6_32_15",[0,0]],["6_44_21",[169,907]],["6_60_19",[0,4630]],["6_20_12",[0,0]],["6_44_22",[122,1046]],["6_28_14",[0,1154]],["6_44_23",[121,4225]],["6_8_16",[32,2504]],["6_12_13",[0,627]],["6_20_13",[0,0]],["6_56_15",[93,2381]],["6_16_26",[0,157]],["6_20_14",[0,588]],["6_32_16",[0,0]],["6_36_18",[0,138]],["6_48_23",[-17,4577]],["6_52_12",[0,165]],["6_28_15",[0,0]],["6_0_17",[0,0]],["6_56_16",[325,2482]],["6_48_24",[722,5681]],["6_12_14",[0,310]],["6_0_18",[0,0]],["6_12_15",[0,523]],["6_40_22",[-31,40]],["6_0_19",[0,0]],["6_60_20",[0,3515]],["6_52_13",[9,413]],["6_0_20",[0,0]],["6_56_17",[94,2601]],["6_48_25",[2645,6487]],["6_40_23",[-28,4249]],["6_12_16",[144,603]],["6_0_21",[0,1593]],["6_40_24",[-39,4640]],["6_48_26",[27,7184]],["6_60_21",[0,2152]],["6_12_17",[157,462]],["6_0_22",[0,0]],["6_40_25",[8,4007]],["6_36_19",[0,227]],["6_52_14",[40,468]],["6_32_17",[0,1292]],["6_60_22",[0,0]],["6_12_18",[166,514]],["6_44_24",[243,7130]],["6_16_27",[0,11]],["6_56_18",[121,2044]],["6_20_15",[0,2104]],["6_16_28",[0,967]],["6_0_23",[0,0]],["6_32_18",[0,1161]],["6_60_23",[0,0]],["6_40_26",[0,3902]],["6_36_20",[22,271]],["6_60_24",[0,0]],["6_60_25",[0,0]],["6_32_19",[0,22]],["6_0_24",[0,0]],["6_48_27",[0,3558]],["6_24_10",[508,7191]],["6_40_27",[0,1161]],["6_52_15",[74,429]],["6_60_26",[0,0]],["6_20_16",[-2,1811]],["6_28_16",[0,2019]],["6_48_28",[0,2972]],["6_12_19",[208,863]],["6_40_28",[168,1454]],["6_32_20",[0,84]],["6_48_29",[0,631]],["6_4_17",[22,3174]],["6_32_21",[0,578]],["6_52_16",[73,683]],["6_0_25",[0,0]],["6_36_21",[112,1245]],["6_60_27",[0,0]],["6_48_30",[0,510]],["6_28_17",[0,1557]],["6_40_29",[0,2395]],["6_60_28",[0,0]],["6_4_18",[0,3346]],["6_60_29",[0,0]],["6_52_17",[95,435]],["6_20_17",[-77,1136]],["6_0_26",[0,0]],["6_12_20",[401,765]],["6_40_30",[0,2348]],["6_32_22",[35,1735]],["6_48_31",[0,1887]],["6_52_18",[131,1611]],["6_56_19",[0,1826]],["6_16_29",[0,2807]],["6_20_18",[0,1499]],["6_12_21",[500,1951]],["6_56_20",[0,1966]],["6_48_32",[0,0]],["6_0_27",[0,0]],["6_36_22",[6,2402]],["6_8_17",[518,2744]],["6_60_30",[0,630]],["6_12_22",[675,3696]],["6_28_18",[0,0]],["6_32_23",[0,3143]],["6_20_19",[0,1407]],["6_48_33",[0,0]],["6_12_23",[1110,4012]],["6_16_30",[0,2037]],["6_8_18",[1,2271]],["6_20_20",[78,913]],["6_20_21",[0,1236]],["6_28_19",[0,0]],["6_32_24",[0,1572]],["6_40_31",[0,483]],["6_12_24",[1020,4094]],["6_60_31",[0,353]],["6_0_28",[0,0]],["6_20_22",[0,1106]],["6_40_32",[0,0]],["6_16_31",[0,0]],["6_56_21",[0,1994]],["6_4_19",[0,2258]],["6_8_19",[0,2848]],["6_20_23",[0,188]],["6_16_32",[0,614]],["6_32_25",[0,2073]],["6_36_23",[0,2709]],["6_12_25",[260,3625]],["6_28_20",[0,0]],["6_20_24",[0,0]],["6_32_26",[151,801]],["6_0_29",[0,0]],["6_36_24",[0,2288]],["6_44_25",[167,7389]],["6_8_20",[0,2061]],["6_16_33",[0,0]],["6_28_21",[0,0]],["6_48_34",[0,0]],["6_12_26",[0,2932]],["6_36_25",[0,2310]],["6_60_32",[0,0]],["6_8_21",[0,541]],["6_32_27",[127,2635]],["6_8_22",[0,0]],["6_36_26",[-84,251]],["6_8_23",[0,0]],["6_16_34",[0,0]],["6_32_28",[277,878]],["6_40_33",[0,0]],["6_52_19",[190,2788]],["6_4_20",[0,0]],["6_12_27",[0,3105]],["6_48_35",[0,0]],["6_52_20",[493,2510]],["6_32_29",[151,461]],["6_16_35",[0,0]],["6_20_25",[0,0]],["6_8_24",[0,0]],["6_28_22",[0,0]],["6_60_33",[0,2164]],["6_52_21",[435,1635]],["6_8_25",[0,0]],["6_52_22",[528,1645]],["6_0_30",[0,0]],["6_36_27",[72,1475]],["6_44_26",[34,3290]],["6_56_22",[0,1921]],["6_52_23",[358,2131]],["6_16_36",[0,0]],["6_60_34",[0,0]],["6_20_26",[0,0]],["6_44_27",[0,1592]],["6_12_28",[0,886]],["6_32_30",[0,925]],["6_44_28",[0,838]],["6_28_23",[0,0]],["6_56_23",[0,1354]],["6_44_29",[0,0]],["6_8_26",[0,0]],["6_40_34",[0,2724]],["6_52_24",[-5,2949]],["6_44_30",[0,0]],["6_0_31",[0,0]],["6_36_28",[314,1800]],["6_32_31",[0,15]],["6_4_21",[0,0]],["6_52_25",[9,1728]],["6_36_29",[420,2881]],["6_8_27",[0,0]],["6_56_24",[0,2700]],["6_52_26",[-1,2081]],["6_16_37",[0,0]],["6_12_29",[0,0]],["6_36_30",[389,1303]],["6_60_35",[0,0]],["6_48_36",[0,0]],["6_4_22",[0,0]],["6_32_32",[0,3]],["6_24_11",[420,7267]],["6_44_31",[0,0]],["6_20_27",[0,0]],["6_28_24",[0,0]],["6_16_38",[0,0]],["6_44_32",[0,0]],["6_52_27",[-9,1947]],["6_36_31",[353,1020]],["6_0_32",[0,0]],["6_8_28",[0,0]],["6_4_23",[0,0]],["6_56_25",[0,3615]],["6_60_36",[0,0]],["6_32_33",[0,0]],["6_4_24",[0,0]],["6_52_28",[-7,591]],["6_12_30",[0,0]],["6_0_33",[0,0]],["6_40_35",[0,2478]],["6_8_29",[0,0]],["6_48_37",[0,0]],["6_52_29",[0,0]],["6_36_32",[367,1566]],["6_4_25",[0,0]],["6_32_34",[0,0]],["6_56_26",[0,0]],["6_28_25",[0,1637]],["6_8_30",[0,0]],["6_56_27",[0,0]],["6_48_38",[0,0]],["6_16_39",[0,0]],["6_24_12",[468,7228]],["6_20_28",[0,1188]],["6_56_28",[0,0]],["6_44_33",[0,0]],["6_12_31",[0,0]],["6_56_29",[0,0]],["6_4_26",[0,0]],["6_40_36",[0,2530]],["6_28_26",[0,2285]],["6_36_33",[550,1907]],["6_32_35",[0,0]],["6_48_39",[0,0]],["6_8_31",[0,0]],["6_0_34",[0,398]],["6_4_27",[0,0]],["6_52_30",[0,3863]],["6_44_34",[0,0]],["6_56_30",[0,0]],["6_36_34",[490,1620]],["6_20_29",[0,0]],["6_56_31",[0,0]],["6_24_13",[542,12639]],["6_60_37",[0,350]],["6_48_40",[0,0]],["6_52_31",[0,2419]],["6_0_35",[0,1019]],["6_52_32",[0,2008]],["6_44_35",[0,0]],["6_24_14",[-147,12779]],["6_4_28",[0,4124]],["6_16_40",[0,0]],["6_8_32",[0,0]],["6_52_33",[0,3487]],["6_12_32",[0,0]],["6_40_37",[0,0]],["6_48_41",[0,0]],["6_36_35",[486,1467]],["6_32_36",[0,0]],["6_20_30",[0,2449]],["6_28_27",[0,11]],["6_0_36",[0,0]],["6_52_34",[0,0]],["6_56_32",[0,4621]],["6_16_41",[0,0]],["6_0_37",[0,353]],["6_8_33",[0,0]],["6_36_36",[751,1967]],["6_40_38",[0,0]],["6_48_42",[0,0]],["6_44_36",[0,0]],["6_4_29",[0,0]],["6_32_37",[0,0]],["6_28_28",[0,12]],["6_24_15",[142,4671]],["6_16_42",[0,0]],["6_60_38",[0,0]],["6_20_31",[31,2750]],["6_12_33",[0,0]],["6_52_35",[0,709]],["6_8_34",[0,0]],["6_36_37",[712,2937]],["6_40_39",[0,0]],["6_20_32",[23,701]],["6_16_43",[0,0]],["6_36_38",[0,2300]],["6_48_43",[0,0]],["6_32_38",[0,0]],["6_44_37",[0,0]],["6_56_33",[0,96]],["6_20_33",[38,1076]],["6_28_29",[0,19]],["6_4_30",[0,0]],["6_60_39",[0,0]],["6_52_36",[0,1119]],["6_0_38",[0,0]],["6_20_34",[128,4214]],["6_8_35",[0,0]],["6_60_40",[0,0]],["6_56_34",[0,307]],["6_12_34",[0,0]],["6_48_44",[0,0]],["6_28_30",[0,0]],["6_32_39",[0,0]],["6_16_44",[0,0]],["6_0_39",[0,0]],["6_40_40",[0,0]],["6_8_36",[0,0]],["6_4_31",[0,0]],["6_24_16",[0,4978]],["6_44_38",[0,0]],["6_52_37",[0,490]],["6_60_41",[0,0]],["6_20_35",[197,5686]],["6_56_35",[0,562]],["6_24_17",[0,12078]],["6_0_40",[0,8]],["6_44_39",[0,0]],["6_32_40",[0,0]],["6_28_31",[0,0]],["6_48_45",[0,0]],["6_8_37",[0,0]],["6_4_32",[0,0]],["6_20_36",[149,6114]],["6_60_42",[0,0]],["6_16_45",[0,0]],["6_40_41",[0,767]],["6_12_35",[0,0]],["6_52_38",[0,707]],["6_28_32",[0,0]],["6_24_18",[0,2505]],["6_4_33",[0,0]],["6_44_40",[0,0]],["6_24_19",[0,0]],["6_48_46",[0,0]],["6_20_37",[63,5265]],["6_32_41",[0,0]],["6_24_20",[0,0]],["6_12_36",[0,0]],["6_40_42",[0,0]],["6_8_38",[0,0]],["6_16_46",[0,0]],["6_60_43",[0,372]],["6_0_41",[0,0]],["6_20_38",[81,2644]],["6_44_41",[0,643]],["6_52_39",[0,0]],["6_28_33",[0,0]],["6_20_39",[0,1014]],["6_48_47",[0,392]],["6_56_36",[-4,988]],["6_36_39",[0,0]],["6_4_34",[0,0]],["6_32_42",[0,0]],["6_24_21",[0,0]],["6_48_48",[0,2330]],["6_40_43",[0,0]],["6_8_39",[0,0]],["6_60_44",[0,0]],["6_0_42",[0,0]],["6_8_40",[0,0]],["6_56_37",[-20,972]],["6_32_43",[0,676]],["6_20_40",[0,1541]],["6_16_47",[0,0]],["6_52_40",[0,0]],["6_36_40",[0,0]],["6_24_22",[0,0]],["6_44_42",[0,1340]],["6_60_45",[0,0]],["6_0_43",[0,0]],["6_48_49",[814,3892]],["6_40_44",[0,0]],["6_28_34",[0,0]],["6_4_35",[0,0]],["6_28_35",[0,0]],["6_56_38",[0,854]],["6_52_41",[0,0]],["6_20_41",[0,639]],["6_40_45",[0,0]],["6_36_41",[0,0]],["6_0_44",[0,0]],["6_12_37",[0,440]],["6_48_50",[2020,6377]],["6_24_23",[0,0]],["6_28_36",[0,0]],["6_8_41",[0,0]],["6_44_43",[0,0]],["6_60_46",[0,0]],["6_32_44",[0,0]],["6_4_36",[0,0]],["6_40_46",[0,0]],["6_16_48",[0,0]],["6_28_37",[0,0]],["6_52_42",[0,0]],["6_36_42",[0,0]],["6_0_45",[0,0]],["6_56_39",[0,62]],["6_60_47",[0,0]],["6_24_24",[0,0]],["6_32_45",[0,0]],["6_16_49",[0,0]],["6_20_42",[0,35]],["6_44_44",[0,0]],["6_8_42",[0,0]],["6_48_51",[365,13720]],["6_52_43",[0,0]],["6_4_37",[0,0]],["6_56_40",[0,0]],["6_12_38",[0,0]],["6_24_25",[0,0]],["6_60_48",[0,0]],["6_24_26",[0,0]],["6_40_47",[0,1015]],["6_36_43",[0,0]],["6_20_43",[0,988]],["6_44_45",[0,0]],["6_0_46",[0,0]],["6_12_39",[0,0]],["6_16_50",[0,0]],["6_52_44",[0,0]],["6_8_43",[0,0]],["6_28_38",[0,0]],["6_40_48",[0,2624]],["6_32_46",[0,0]],["6_60_49",[0,2427]],["6_36_44",[0,0]],["6_44_46",[0,0]],["6_56_41",[0,0]],["6_24_27",[0,0]],["6_4_38",[0,0]],["6_0_47",[0,0]],["6_48_52",[554,13723]],["6_60_50",[0,3259]],["6_20_44",[0,343]],["6_16_51",[0,3613]],["6_60_51",[1054,4463]],["6_40_49",[1151,3316]],["6_28_39",[0,0]],["6_8_44",[0,0]],["6_36_45",[0,0]],["6_52_45",[0,0]],["6_16_52",[14,4923]],["6_20_45",[0,0]],["6_32_47",[0,0]],["6_24_28",[0,0]],["6_56_42",[0,0]],["6_48_53",[465,13028]],["6_8_45",[0,0]],["6_12_40",[0,0]],["6_0_48",[0,0]],["6_4_39",[0,0]],["6_52_46",[0,0]],["6_0_49",[0,0]],["6_28_40",[0,0]],["6_60_52",[0,3534]],["6_44_47",[0,0]],["6_56_43",[0,0]],["6_40_50",[1057,3106]],["6_60_53",[-35,3059]],["6_20_46",[0,1904]],["6_36_46",[0,0]],["6_32_48",[0,0]],["6_16_53",[24,4851]],["6_44_48",[0,1907]],["6_24_29",[0,0]],["6_12_41",[0,0]],["6_28_41",[0,0]],["6_8_46",[0,0]],["6_4_40",[0,0]],["6_52_47",[0,2675]],["6_0_50",[0,0]],["6_56_44",[0,0]],["6_60_54",[0,3933]],["6_32_49",[0,87]],["6_44_49",[-142,2775]],["6_24_30",[0,0]],["6_20_47",[0,2722]],["6_40_51",[1194,7588]],["6_4_41",[0,0]],["6_16_54",[9,3605]],["6_32_50",[0,2987]],["6_12_42",[0,0]],["6_0_51",[0,0]],["6_48_54",[210,14290]],["6_8_47",[0,0]],["6_56_45",[0,0]],["6_28_42",[0,0]],["6_36_47",[0,0]],["6_60_55",[0,3872]],["6_44_50",[0,1477]],["6_32_51",[434,12435]],["6_0_52",[0,0]],["6_4_42",[0,0]],["6_52_48",[0,3295]],["6_8_48",[0,0]],["6_12_43",[0,0]],["6_16_55",[301,4808]],["6_40_52",[470,6135]],["6_60_56",[-13,3133]],["6_20_48",[-16,2374]],["6_8_49",[0,0]],["6_0_53",[0,0]],["6_36_48",[0,0]],["6_44_51",[16,2714]],["6_56_46",[0,0]],["6_4_43",[0,0]],["6_28_43",[0,0]],["6_52_49",[1094,3050]],["6_12_44",[0,0]],["6_48_55",[525,13433]],["6_0_54",[0,0]],["6_36_49",[0,3232]],["6_24_31",[0,0]],["6_60_57",[0,3491]],["6_56_47",[0,817]],["6_40_53",[2471,12510]],["6_12_45",[0,0]],["6_20_49",[0,3117]],["6_4_44",[0,0]],["6_20_50",[0,3003]],["6_16_56",[688,2592]],["6_28_44",[0,0]],["6_24_32",[0,1026]],["6_40_54",[0,7309]],["6_60_58",[0,3174]],["6_32_52",[276,13384]],["6_44_52",[0,5044]],["6_8_50",[0,0]],["6_48_56",[175,5523]],["6_12_46",[0,0]],["6_0_55",[0,0]],["6_24_33",[91,1231]],["6_20_51",[0,3031]],["6_16_57",[-81,11830]],["6_52_50",[1343,3738]],["6_4_45",[0,0]],["6_16_58",[-219,11974]],["6_24_34",[50,1807]],["6_56_48",[0,2778]],["6_56_49",[645,4096]],["6_12_47",[0,0]],["6_48_57",[517,13908]],["6_60_59",[-55,3174]],["6_8_51",[0,0]],["6_0_56",[0,0]],["6_44_53",[0,5756]],["6_36_50",[0,2911]],["6_24_35",[0,2655]],["6_40_55",[0,8907]],["6_28_45",[0,0]],["6_32_53",[1395,11656]],["6_12_48",[0,0]],["6_20_52",[0,2835]],["6_52_51",[185,13045]],["6_24_36",[0,2601]],["6_44_54",[0,885]],["6_56_50",[1560,3152]],["6_8_52",[0,2468]],["6_0_57",[0,0]],["6_28_46",[0,0]],["6_48_58",[2104,13692]],["6_60_60",[0,4228]],["6_36_51",[1900,3326]],["6_24_37",[0,0]],["6_32_54",[1231,6715]],["6_40_56",[0,7784]],["6_4_46",[0,0]],["6_24_38",[0,0]],["6_52_52",[86,13187]],["6_20_53",[0,1684]],["6_56_51",[57,2899]],["6_12_49",[0,0]],["6_24_39",[0,0]],["6_0_58",[0,0]],["6_44_55",[0,0]],["6_36_52",[593,13584]],["6_60_61",[0,0]],["6_4_47",[0,0]],["6_48_59",[1539,6753]],["6_40_57",[-4,7549]],["6_8_53",[10,12171]],["6_52_53",[60,5594]],["6_16_59",[-921,2409]],["6_0_59",[0,0]],["6_32_55",[846,7866]],["6_28_47",[0,0]],["6_56_52",[0,4445]],["6_20_54",[0,0]],["6_44_56",[0,3157]],["6_24_40",[0,0]],["6_48_60",[0,5730]],["6_12_50",[0,0]],["6_0_60",[0,0]],["6_28_48",[0,0]],["6_4_48",[0,0]],["6_16_60",[-263,1876]],["6_40_58",[0,0]],["6_20_55",[0,172]],["6_8_54",[117,12130]],["6_60_62",[0,0]],["6_16_61",[0,0]],["6_32_56",[2081,6010]],["6_44_57",[1275,13810]],["6_56_53",[2201,6027]],["6_52_54",[272,4617]],["6_12_51",[0,0]],["6_4_49",[0,0]],["6_48_61",[0,0]],["6_16_62",[0,0]],["6_0_61",[0,0]],["6_36_53",[1969,13530]],["6_44_58",[923,8603]],["6_32_57",[2111,12346]],["6_52_55",[2201,4383]],["6_8_55",[9,11416]],["6_40_59",[0,0]],["6_24_41",[0,0]],["6_60_63",[0,0]],["6_28_49",[0,0]],["6_61_0",[0,0]],["6_20_56",[0,0]],["6_16_63",[0,0]],["6_12_52",[0,2595]],["6_48_62",[0,0]],["6_0_62",[0,0]],["6_56_54",[1606,5352]],["6_40_60",[0,0]],["6_24_42",[0,0]],["6_52_56",[523,13248]],["6_61_1",[0,0]],["6_28_50",[0,0]],["6_12_53",[-16,10965]],["6_36_54",[363,13474]],["6_44_59",[1608,8492]],["6_8_56",[9,11552]],["6_20_57",[0,0]],["6_4_50",[0,0]],["6_17_0",[0,0]],["6_0_63",[0,0]],["6_24_43",[0,0]],["6_8_57",[5,5057]],["6_32_58",[1415,12433]],["6_48_63",[0,0]],["6_56_55",[1863,6227]],["6_4_51",[0,0]],["6_20_58",[-2,685]],["6_52_57",[1344,4094]],["6_61_2",[0,0]],["6_44_60",[0,5626]],["6_40_61",[0,0]],["6_1_0",[0,0]],["6_24_44",[0,0]],["6_28_51",[0,0]],["6_17_1",[0,0]],["6_12_54",[-157,12153]],["6_56_56",[2306,4828]],["6_36_55",[986,13417]],["6_52_58",[328,13202]],["6_49_0",[0,0]],["6_44_61",[0,0]],["6_61_3",[0,0]],["6_40_62",[0,0]],["6_36_56",[403,13885]],["6_4_52",[0,0]],["6_20_59",[-194,648]],["6_24_45",[0,414]],["6_8_58",[-147,10842]],["6_17_2",[0,0]],["6_40_63",[0,0]],["6_32_59",[1426,7362]],["6_56_57",[2312,2552]],["6_61_4",[0,0]],["6_28_52",[0,805]],["6_20_60",[-38,741]],["6_49_1",[0,0]],["6_36_57",[0,3331]],["6_1_1",[0,0]],["6_44_62",[0,0]],["6_17_3",[0,896]],["6_8_59",[-418,1196]],["6_41_0",[0,0]],["6_20_61",[0,0]],["6_24_46",[0,0]],["6_56_58",[1732,2634]],["6_52_59",[718,4102]],["6_28_53",[0,4003]],["6_12_55",[-72,11771]],["6_4_53",[0,0]],["6_61_5",[0,0]],["6_17_4",[0,1975]],["6_1_2",[0,0]],["6_49_2",[0,0]],["6_41_1",[0,0]],["6_44_63",[0,0]],["6_56_59",[1568,2592]],["6_36_58",[0,7050]],["6_32_60",[0,7471]],["6_20_62",[0,0]],["6_17_5",[0,1936]],["6_24_47",[0,0]],["6_49_3",[0,0]],["6_1_3",[0,0]],["6_61_6",[0,0]],["6_17_6",[0,1608]],["6_4_54",[0,1418]],["6_8_60",[-410,1245]],["6_61_7",[0,0]],["6_12_56",[-3,11815]],["6_41_2",[0,0]],["6_1_4",[0,0]],["6_32_61",[0,0]],["6_28_54",[-70,11614]],["6_24_48",[0,0]],["6_36_59",[0,6507]],["6_49_4",[0,0]],["6_20_63",[0,0]],["6_56_60",[0,2637]],["6_17_7",[0,1803]],["6_4_55",[0,1552]],["6_8_61",[0,0]],["6_52_60",[0,6331]],["6_61_8",[0,0]],["6_1_5",[0,0]],["6_49_5",[0,26]],["6_36_60",[0,0]],["6_17_8",[0,2219]],["6_24_49",[0,0]],["6_32_62",[0,0]],["6_21_0",[0,0]],["6_12_57",[4,12618]],["6_41_3",[0,0]],["6_28_55",[-193,11937]],["6_17_9",[0,1779]],["6_1_6",[0,0]],["6_61_9",[0,0]],["6_45_0",[0,0]],["6_56_61",[0,0]],["6_24_50",[0,0]],["6_1_7",[0,0]],["6_21_1",[0,0]],["6_8_62",[0,0]],["6_61_10",[0,0]],["6_49_6",[0,671]],["6_17_10",[0,1641]],["6_41_4",[0,0]],["6_52_61",[0,0]],["6_4_56",[0,116]],["6_8_63",[0,0]],["6_36_61",[0,0]],["6_28_56",[511,1699]],["6_61_11",[0,0]],["6_32_63",[0,0]],["6_21_2",[0,0]],["6_45_1",[0,0]],["6_9_0",[0,0]],["6_17_11",[0,2126]],["6_12_58",[0,11961]],["6_1_8",[0,0]],["6_52_62",[0,0]],["6_17_12",[0,1667]],["6_56_62",[0,0]],["6_61_12",[0,0]],["6_17_13",[-1,1e3]],["6_61_13",[0,0]],["6_41_5",[0,490]],["6_36_62",[0,0]],["6_21_3",[0,0]],["6_49_7",[0,1002]],["6_17_14",[0,609]],["6_28_57",[408,1694]],["6_24_51",[0,0]],["6_17_15",[0,396]],["6_49_8",[0,1025]],["6_61_14",[0,1495]],["6_33_0",[0,0]],["6_17_16",[0,592]],["6_45_2",[0,0]],["6_4_57",[-6,528]],["6_21_4",[0,1070]],["6_56_63",[0,0]],["6_17_17",[0,166]],["6_28_58",[660,11644]],["6_49_9",[0,54]],["6_52_63",[0,0]],["6_9_1",[0,0]],["6_17_18",[0,0]],["6_49_10",[0,607]],["6_49_11",[3,658]],["6_1_9",[0,0]],["6_36_63",[0,0]],["6_49_12",[5,651]],["6_41_6",[0,718]],["6_49_13",[7,409]],["6_17_19",[0,24]],["6_49_14",[43,1569]],["6_45_3",[0,0]],["6_1_10",[0,0]],["6_12_59",[228,2473]],["6_61_15",[35,1660]],["6_4_58",[-293,808]],["6_24_52",[0,0]],["6_21_5",[0,1591]],["6_28_59",[395,2654]],["6_17_20",[0,138]],["6_61_16",[77,1719]],["6_49_15",[189,1463]],["6_17_21",[0,345]],["6_17_22",[173,635]],["6_53_0",[0,0]],["6_33_1",[0,0]],["6_37_0",[0,0]],["6_41_7",[0,491]],["6_57_0",[0,0]],["6_49_16",[94,1013]],["6_9_2",[0,0]],["6_1_11",[0,0]],["6_61_17",[0,1409]],["6_17_23",[70,707]],["6_45_4",[0,0]],["6_1_12",[0,0]],["6_49_17",[74,875]],["6_17_24",[129,1638]],["6_24_53",[0,0]],["6_9_3",[0,0]],["6_21_6",[0,1785]],["6_4_59",[0,814]],["6_1_13",[0,0]],["6_33_2",[0,0]],["6_49_18",[124,784]],["6_37_1",[0,0]],["6_41_8",[0,0]],["6_1_14",[0,0]],["6_28_60",[0,2969]],["6_49_19",[107,940]],["6_57_1",[0,0]],["6_45_5",[0,0]],["6_17_25",[0,1901]],["6_61_18",[0,1216]],["6_49_20",[281,2993]],["6_53_1",[0,0]],["6_41_9",[0,0]],["6_49_21",[707,3289]],["6_41_10",[0,0]],["6_17_26",[0,117]],["6_49_22",[1065,3832]],["6_41_11",[0,993]],["6_4_60",[-9,435]],["6_1_15",[0,935]],["6_61_19",[0,855]],["6_37_2",[0,0]],["6_49_23",[427,3902]],["6_9_4",[0,0]],["6_1_16",[0,1099]],["6_24_54",[0,860]],["6_41_12",[0,1213]],["6_17_27",[0,1028]],["6_49_24",[947,5558]],["6_1_17",[0,584]],["6_53_2",[0,0]],["6_1_18",[0,424]],["6_61_20",[0,632]],["6_21_7",[193,6887]],["6_45_6",[0,0]],["6_49_25",[2200,6096]],["6_33_3",[0,0]],["6_17_28",[0,887]],["6_41_13",[0,578]],["6_28_61",[0,0]],["6_57_2",[0,0]],["6_49_26",[93,6377]],["6_53_3",[0,0]],["6_61_21",[0,0]],["6_4_61",[0,0]],["6_1_19",[0,0]],["6_41_14",[0,418]],["6_45_7",[0,0]],["6_49_27",[62,4457]],["6_37_3",[0,0]],["6_1_20",[0,1456]],["6_49_28",[0,2515]],["6_24_55",[0,4020]],["6_49_29",[0,2025]],["6_61_22",[0,0]],["6_61_23",[0,0]],["6_49_30",[0,1533]],["6_57_3",[0,0]],["6_61_24",[0,0]],["6_17_29",[0,610]],["6_33_4",[0,0]],["6_1_21",[0,1372]],["6_12_60",[0,2032]],["6_49_31",[0,3334]],["6_45_8",[0,0]],["6_61_25",[0,0]],["6_41_15",[0,424]],["6_1_22",[0,0]],["6_61_26",[0,0]],["6_28_62",[0,0]],["6_4_62",[0,0]],["6_53_4",[0,0]],["6_24_56",[0,2293]],["6_9_5",[0,0]],["6_37_4",[0,0]],["6_57_4",[0,0]],["6_41_16",[8,367]],["6_49_32",[0,2781]],["6_12_61",[0,0]],["6_61_27",[0,0]],["6_1_23",[0,0]],["6_41_17",[56,487]],["6_49_33",[0,0]],["6_21_8",[346,11329]],["6_45_9",[0,0]],["6_53_5",[0,0]],["6_1_24",[0,0]],["6_1_25",[0,0]],["6_17_30",[0,3657]],["6_4_63",[0,0]],["6_49_34",[0,0]],["6_28_63",[0,0]],["6_24_57",[0,722]],["6_17_31",[0,2543]],["6_1_26",[0,0]],["6_17_32",[0,6052]],["6_9_6",[0,0]],["6_49_35",[0,0]],["6_45_10",[0,0]],["6_5_0",[0,0]],["6_33_5",[0,0]],["6_45_11",[0,0]],["6_57_5",[0,0]],["6_24_58",[0,875]],["6_29_0",[0,0]],["6_41_18",[98,324]],["6_17_33",[0,3951]],["6_45_12",[0,15]],["6_61_28",[0,0]],["6_45_13",[0,48]],["6_1_27",[0,0]],["6_17_34",[0,0]],["6_45_14",[0,82]],["6_9_7",[0,0]],["6_61_29",[0,0]],["6_45_15",[0,56]],["6_37_5",[0,0]],["6_33_6",[0,0]],["6_45_16",[7,97]],["6_49_36",[0,0]],["6_5_1",[0,0]],["6_24_59",[0,1229]],["6_57_6",[0,0]],["6_45_17",[27,130]],["6_53_6",[0,0]],["6_37_6",[0,581]],["6_21_9",[559,11586]],["6_1_28",[0,0]],["6_49_37",[0,0]],["6_61_30",[0,0]],["6_29_1",[0,0]],["6_17_35",[0,0]],["6_45_18",[25,132]],["6_49_38",[0,0]],["6_41_19",[51,315]],["6_12_62",[0,0]],["6_53_7",[0,0]],["6_45_19",[52,154]],["6_41_20",[45,585]],["6_33_7",[0,867]],["6_1_29",[0,0]],["6_17_36",[0,0]],["6_9_8",[0,0]],["6_29_2",[0,0]],["6_41_21",[-11,561]],["6_37_7",[0,538]],["6_41_22",[-33,239]],["6_24_60",[0,1352]],["6_57_7",[0,0]],["6_41_23",[-134,462]],["6_41_24",[-42,3535]],["6_21_10",[0,2913]],["6_61_31",[0,0]],["6_45_20",[30,170]],["6_17_37",[0,0]],["6_57_8",[0,0]],["6_33_8",[0,982]],["6_61_32",[0,0]],["6_41_25",[-28,5356]],["6_12_63",[0,0]],["6_5_2",[0,0]],["6_1_30",[0,0]],["6_49_39",[0,0]],["6_9_9",[0,0]],["6_45_21",[98,1454]],["6_29_3",[0,0]],["6_41_26",[0,4172]],["6_53_8",[0,0]],["6_17_38",[0,1131]],["6_24_61",[0,0]],["6_41_27",[0,1898]],["6_33_9",[0,0]],["6_37_8",[0,63]],["6_21_11",[0,1215]],["6_45_22",[187,1452]],["6_21_12",[0,763]],["6_61_33",[0,490]],["6_5_3",[0,0]],["6_29_4",[0,0]],["6_41_28",[0,1713]],["6_45_23",[337,5451]],["6_13_0",[0,0]],["6_37_9",[0,0]],["6_1_31",[0,0]],["6_57_9",[0,0]],["6_21_13",[0,0]],["6_17_39",[0,0]],["6_45_24",[889,7328]],["6_49_40",[0,0]],["6_45_25",[187,8091]],["6_24_62",[0,0]],["6_33_10",[0,0]],["6_41_29",[0,1404]],["6_37_10",[0,0]],["6_21_14",[0,0]],["6_1_32",[0,0]],["6_53_9",[0,0]],["6_5_4",[0,0]],["6_21_15",[0,1343]],["6_57_10",[0,31]],["6_45_26",[142,6319]],["6_17_40",[0,0]],["6_9_10",[0,0]],["6_45_27",[21,1187]],["6_13_1",[0,0]],["6_37_11",[0,0]],["6_1_33",[0,0]],["6_61_34",[0,1614]],["6_49_41",[0,0]],["6_45_28",[0,1398]],["6_41_30",[0,417]],["6_41_31",[0,0]],["6_45_29",[0,2490]],["6_53_10",[0,0]],["6_33_11",[0,0]],["6_21_16",[0,674]],["6_29_5",[0,1818]],["6_45_30",[0,2489]],["6_21_17",[0,0]],["6_13_2",[0,0]],["6_24_63",[0,0]],["6_41_32",[0,616]],["6_37_12",[0,0]],["6_13_3",[0,0]],["6_17_41",[0,0]],["6_45_31",[0,0]],["6_61_35",[0,1468]],["6_49_42",[0,0]],["6_9_11",[0,58]],["6_5_5",[0,0]],["6_33_12",[0,0]],["6_21_18",[0,0]],["6_25_0",[0,0]],["6_57_11",[0,375]],["6_45_32",[0,0]],["6_37_13",[0,579]],["6_17_42",[0,0]],["6_53_11",[0,0]],["6_1_34",[0,1787]],["6_57_12",[0,375]],["6_9_12",[0,135]],["6_41_33",[0,0]],["6_33_13",[0,0]],["6_29_6",[0,844]],["6_5_6",[0,0]],["6_33_14",[0,0]],["6_21_19",[0,925]],["6_25_1",[0,0]],["6_45_33",[0,0]],["6_9_13",[0,221]],["6_61_36",[0,1327]],["6_1_35",[0,46]],["6_49_43",[0,0]],["6_37_14",[0,687]],["6_21_20",[0,1150]],["6_53_12",[0,486]],["6_57_13",[0,516]],["6_17_43",[0,0]],["6_33_15",[0,0]],["6_45_34",[0,0]],["6_25_2",[0,0]],["6_21_21",[0,777]],["6_37_15",[0,1191]],["6_1_36",[0,0]],["6_5_7",[0,0]],["6_25_3",[0,1673]],["6_21_22",[0,769]],["6_41_34",[0,0]],["6_29_7",[0,316]],["6_5_8",[0,0]],["6_21_23",[0,14]],["6_13_4",[0,0]],["6_9_14",[0,445]],["6_53_13",[9,395]],["6_61_37",[0,0]],["6_45_35",[0,0]],["6_33_16",[0,636]],["6_57_14",[6,1116]],["6_21_24",[0,0]],["6_1_37",[0,0]],["6_49_44",[0,0]],["6_9_15",[25,650]],["6_5_9",[0,0]],["6_41_35",[0,2753]],["6_17_44",[0,0]],["6_53_14",[16,375]],["6_37_16",[0,525]],["6_45_36",[0,0]],["6_61_38",[0,0]],["6_57_15",[15,2370]],["6_9_16",[25,2262]],["6_53_15",[13,345]],["6_29_8",[0,0]],["6_25_4",[12,1967]],["6_1_38",[0,0]],["6_13_5",[0,0]],["6_37_17",[19,265]],["6_33_17",[0,2355]],["6_37_18",[0,224]],["6_9_17",[66,2552]],["6_49_45",[0,0]],["6_17_45",[0,0]],["6_53_16",[19,274]],["6_5_10",[0,0]],["6_41_36",[0,0]],["6_21_25",[0,0]],["6_45_37",[0,0]],["6_53_17",[61,394]],["6_13_6",[0,0]],["6_49_46",[0,0]],["6_25_5",[174,1846]],["6_61_39",[0,0]],["6_29_9",[0,0]],["6_33_18",[0,2251]],["6_1_39",[0,0]],["6_53_18",[107,1224]],["6_37_19",[16,289]],["6_5_11",[0,0]],["6_17_46",[0,0]],["6_9_18",[210,2312]],["6_57_16",[168,2829]],["6_45_38",[0,0]],["6_33_19",[0,998]],["6_49_47",[0,2876]],["6_53_19",[181,2413]],["6_29_10",[0,0]],["6_1_40",[0,0]],["6_37_20",[119,257]],["6_41_37",[0,0]],["6_21_26",[0,0]],["6_17_47",[0,0]],["6_25_6",[350,3186]],["6_57_17",[548,2789]],["6_9_19",[158,2760]],["6_13_7",[0,36]],["6_5_12",[0,0]],["6_37_21",[69,297]],["6_29_11",[0,0]],["6_1_41",[0,0]],["6_37_22",[0,387]],["6_33_20",[0,123]],["6_21_27",[0,0]],["6_57_18",[0,2462]],["6_49_48",[0,4826]],["6_41_38",[0,0]],["6_17_48",[0,0]],["6_13_8",[0,204]],["6_25_7",[34,3510]],["6_53_20",[260,1881]],["6_29_12",[0,0]],["6_45_39",[0,731]],["6_53_21",[304,1456]],["6_61_40",[0,2550]],["6_29_13",[0,0]],["6_13_9",[0,78]],["6_37_23",[0,2273]],["6_33_21",[-59,1088]],["6_57_19",[0,1081]],["6_41_39",[0,0]],["6_53_22",[136,1670]],["6_1_42",[0,0]],["6_5_13",[0,0]],["6_17_49",[0,0]],["6_53_23",[-71,1866]],["6_5_14",[0,2104]],["6_29_14",[0,0]],["6_49_49",[918,4293]],["6_21_28",[0,0]],["6_57_20",[0,874]],["6_41_40",[0,0]],["6_53_24",[-4,1688]],["6_45_40",[0,0]],["6_37_24",[0,2877]],["6_53_25",[-1,936]],["6_9_20",[0,2480]],["6_25_8",[402,11545]],["6_1_43",[0,0]],["6_37_25",[0,2875]],["6_17_50",[0,1042]],["6_57_21",[0,1417]],["6_13_10",[0,400]],["6_61_41",[0,1770]],["6_53_26",[0,1732]],["6_57_22",[0,1414]],["6_5_15",[110,2299]],["6_49_50",[1120,3339]],["6_33_22",[8,4526]],["6_29_15",[0,9]],["6_53_27",[-1,3687]],["6_17_51",[-10,2453]],["6_5_16",[48,1556]],["6_41_41",[0,846]],["6_13_11",[0,157]],["6_45_41",[0,0]],["6_21_29",[0,1267]],["6_1_44",[0,0]],["6_25_9",[400,12313]],["6_5_17",[16,5985]],["6_57_23",[0,2130]],["6_33_23",[0,3724]],["6_29_16",[0,1884]],["6_61_42",[0,578]],["6_53_28",[0,2639]],["6_37_26",[-51,1906]],["6_25_10",[470,12554]],["6_9_21",[0,3653]],["6_41_42",[0,0]],["6_13_12",[0,175]],["6_9_22",[0,1999]],["6_25_11",[692,5590]],["6_21_30",[0,2058]],["6_57_24",[0,1822]],["6_33_24",[0,1684]],["6_29_17",[0,1978]],["6_53_29",[0,2745]],["6_37_27",[19,1882]],["6_61_43",[0,0]],["6_5_18",[0,3794]],["6_45_42",[0,0]],["6_53_30",[0,2204]],["6_57_25",[0,200]],["6_33_25",[-33,2209]],["6_49_51",[304,6532]],["6_1_45",[0,0]],["6_37_28",[171,1054]],["6_41_43",[0,0]],["6_17_52",[46,10865]],["6_5_19",[0,330]],["6_29_18",[0,0]],["6_61_44",[0,0]],["6_13_13",[0,196]],["6_57_26",[0,0]],["6_45_43",[0,2592]],["6_21_31",[12,2429]],["6_33_26",[137,905]],["6_13_14",[0,197]],["6_37_29",[355,1277]],["6_41_44",[0,0]],["6_53_31",[0,2658]],["6_33_27",[404,2638]],["6_5_20",[0,0]],["6_9_23",[0,1463]],["6_57_27",[0,473]],["6_37_30",[371,1053]],["6_29_19",[0,0]],["6_57_28",[0,807]],["6_5_21",[0,0]],["6_49_52",[53,13566]],["6_33_28",[91,1847]],["6_53_32",[0,3225]],["6_13_15",[0,292]],["6_9_24",[0,1450]],["6_45_44",[0,0]],["6_29_20",[0,0]],["6_61_45",[0,0]],["6_21_32",[1,317]],["6_33_29",[283,731]],["6_37_31",[417,4672]],["6_1_46",[0,0]],["6_29_21",[0,0]],["6_21_33",[42,655]],["6_33_30",[6,2885]],["6_9_25",[0,0]],["6_13_16",[108,436]],["6_13_17",[112,427]],["6_9_26",[0,0]],["6_61_46",[0,0]],["6_21_34",[100,1028]],["6_1_47",[0,0]],["6_29_22",[0,0]],["6_5_22",[0,0]],["6_9_27",[0,0]],["6_53_33",[0,2106]],["6_57_29",[0,471]],["6_5_23",[0,0]],["6_41_45",[0,0]],["6_53_34",[0,223]],["6_17_53",[-38,4222]],["6_13_18",[210,497]],["6_57_30",[0,0]],["6_33_31",[0,3762]],["6_25_12",[228,12305]],["6_13_19",[277,617]],["6_37_32",[641,4165]],["6_49_53",[803,14171]],["6_21_35",[75,1160]],["6_17_54",[0,8849]],["6_45_45",[0,0]],["6_5_24",[0,0]],["6_25_13",[235,12792]],["6_9_28",[0,0]],["6_61_47",[0,0]],["6_13_20",[247,822]],["6_57_31",[0,0]],["6_1_48",[0,0]],["6_21_36",[48,610]],["6_41_46",[0,0]],["6_13_21",[311,877]],["6_61_48",[0,0]],["6_29_23",[0,0]],["6_33_32",[0,877]],["6_25_14",[303,12884]],["6_9_29",[0,0]],["6_53_35",[0,430]],["6_13_22",[452,1418]],["6_5_25",[0,0]],["6_57_32",[0,3749]],["6_25_15",[0,12935]],["6_21_37",[13,254]],["6_17_55",[0,3122]],["6_61_49",[0,578]],["6_41_47",[-1,4282]],["6_25_16",[0,3610]],["6_5_26",[0,0]],["6_25_17",[0,0]],["6_21_38",[0,228]],["6_29_24",[0,0]],["6_13_23",[607,3524]],["6_9_30",[0,0]],["6_1_49",[0,0]],["6_37_33",[517,2718]],["6_45_46",[0,0]],["6_25_18",[0,0]],["6_21_39",[0,679]],["6_53_36",[238,1142]],["6_25_19",[0,0]],["6_13_24",[875,4206]],["6_25_20",[0,0]],["6_5_27",[0,0]],["6_29_25",[0,1263]],["6_45_47",[0,0]],["6_57_33",[0,4231]],["6_33_33",[0,0]],["6_25_21",[0,0]],["6_37_34",[117,1746]],["6_49_54",[219,14051]],["6_13_25",[702,3815]],["6_1_50",[0,0]],["6_21_40",[0,0]],["6_5_28",[0,0]],["6_9_31",[0,0]],["6_57_34",[0,1301]],["6_45_48",[0,452]],["6_17_56",[-33,2395]],["6_53_37",[174,577]],["6_13_26",[335,2806]],["6_17_57",[257,1506]],["6_61_50",[0,5477]],["6_29_26",[0,3462]],["6_25_22",[0,0]],["6_33_34",[0,0]],["6_45_49",[0,2269]],["6_17_58",[-27,10861]],["6_1_51",[0,0]],["6_41_48",[0,4335]],["6_21_41",[0,0]],["6_13_27",[0,3307]],["6_53_38",[0,872]],["6_37_35",[90,2478]],["6_57_35",[0,1482]],["6_5_29",[0,0]],["6_61_51",[-20,3553]],["6_49_55",[871,13751]],["6_25_23",[0,0]],["6_21_42",[0,618]],["6_9_32",[0,0]],["6_13_28",[0,3973]],["6_33_35",[0,0]],["6_29_27",[0,826]],["6_1_52",[0,0]],["6_41_49",[1183,3640]],["6_13_29",[0,0]],["6_17_59",[-27,1841]],["6_45_50",[13,2542]],["6_37_36",[0,2266]],["6_9_33",[0,0]],["6_5_30",[0,0]],["6_49_56",[420,13683]],["6_61_52",[0,2663]],["6_53_39",[0,0]],["6_25_24",[0,0]],["6_57_36",[22,667]],["6_21_43",[0,0]],["6_29_28",[0,779]],["6_13_30",[0,0]],["6_33_36",[0,0]],["6_1_53",[0,0]],["6_41_50",[28,13001]],["6_61_53",[0,0]],["6_53_40",[0,0]],["6_9_34",[0,0]],["6_25_25",[0,0]],["6_5_31",[0,0]],["6_17_60",[0,1728]],["6_45_51",[41,5250]],["6_13_31",[0,0]],["6_37_37",[0,3398]],["6_21_44",[0,0]],["6_57_37",[22,324]],["6_1_54",[0,0]],["6_49_57",[587,13674]],["6_9_35",[0,0]],["6_33_37",[0,0]],["6_53_41",[0,0]],["6_25_26",[0,0]],["6_61_54",[0,3735]],["6_1_55",[0,0]],["6_5_32",[0,0]],["6_21_45",[0,0]],["6_17_61",[0,0]],["6_13_32",[0,0]],["6_41_51",[211,12913]],["6_57_38",[5,310]],["6_29_29",[0,1456]],["6_37_38",[0,1026]],["6_33_38",[0,0]],["6_25_27",[0,0]],["6_45_52",[0,6101]],["6_61_55",[0,2682]],["6_9_36",[0,0]],["6_41_52",[1476,5792]],["6_45_53",[0,6404]],["6_13_33",[0,0]],["6_53_42",[0,0]],["6_21_46",[-3,2139]],["6_17_62",[0,0]],["6_1_56",[0,0]],["6_57_39",[0,1438]],["6_61_56",[0,0]],["6_5_33",[0,0]],["6_21_47",[0,2404]],["6_57_40",[0,1413]],["6_37_39",[0,0]],["6_45_54",[0,1709]],["6_33_39",[0,0]],["6_25_28",[0,0]],["6_17_63",[0,0]],["6_41_53",[1183,6777]],["6_29_30",[0,1369]],["6_21_48",[0,0]],["6_53_43",[0,0]],["6_13_34",[0,0]],["6_5_34",[0,401]],["6_9_37",[0,0]],["6_61_57",[0,0]],["6_1_57",[0,0]],["6_37_40",[0,0]],["6_49_58",[684,13054]],["6_21_49",[0,873]],["6_57_41",[0,0]],["6_18_0",[0,0]],["6_25_29",[0,0]],["6_29_31",[0,0]],["6_33_40",[0,0]],["6_1_58",[0,0]],["6_61_58",[0,0]],["6_53_44",[0,0]],["6_21_50",[0,1373]],["6_45_55",[0,0]],["6_13_35",[0,0]],["6_21_51",[-2,1487]],["6_41_54",[0,6926]],["6_9_38",[0,0]],["6_5_35",[0,1453]],["6_29_32",[0,0]],["6_25_30",[0,0]],["6_1_59",[0,0]],["6_37_41",[0,0]],["6_57_42",[0,0]],["6_33_41",[0,0]],["6_61_59",[0,1531]],["6_1_60",[0,0]],["6_49_59",[1243,6979]],["6_41_55",[2068,13561]],["6_18_1",[0,0]],["6_45_56",[0,1283]],["6_13_36",[0,0]],["6_21_52",[0,1066]],["6_53_45",[0,0]],["6_25_31",[0,0]],["6_61_60",[0,3140]],["6_21_53",[0,0]],["6_1_61",[0,0]],["6_57_43",[0,0]],["6_33_42",[0,0]],["6_25_32",[0,692]],["6_37_42",[0,0]],["6_5_36",[0,0]],["6_29_33",[0,577]],["6_53_46",[0,0]],["6_18_2",[0,0]],["6_9_39",[0,0]],["6_13_37",[0,0]],["6_41_56",[0,7958]],["6_25_33",[0,1132]],["6_41_57",[0,6150]],["6_29_34",[0,0]],["6_49_60",[0,5788]],["6_5_37",[0,0]],["6_1_62",[0,0]],["6_45_57",[647,14080]],["6_25_34",[0,848]],["6_53_47",[0,0]],["6_33_43",[0,0]],["6_37_43",[0,0]],["6_21_54",[0,0]],["6_61_61",[0,0]],["6_9_40",[0,0]],["6_29_35",[0,0]],["6_41_58",[0,0]],["6_18_3",[0,1327]],["6_29_36",[0,0]],["6_25_35",[0,90]],["6_49_61",[0,0]],["6_13_38",[0,0]],["6_61_62",[0,0]],["6_25_36",[0,0]],["6_53_48",[0,2484]],["6_1_63",[0,0]],["6_29_37",[0,0]],["6_33_44",[0,0]],["6_5_38",[0,0]],["6_37_44",[0,0]],["6_21_55",[0,0]],["6_41_59",[0,0]],["6_53_49",[1104,3014]],["6_57_44",[0,0]],["6_13_39",[0,0]],["6_25_37",[0,0]],["6_9_41",[0,0]],["6_2_0",[0,0]],["6_49_62",[0,0]],["6_29_38",[0,0]],["6_18_4",[0,2530]],["6_57_45",[0,0]],["6_2_1",[0,0]],["6_61_63",[0,0]],["6_21_56",[0,0]],["6_37_45",[0,0]],["6_49_63",[0,0]],["6_2_2",[0,0]],["6_13_40",[0,0]],["6_18_5",[0,2548]],["6_45_58",[1584,8601]],["6_25_38",[0,0]],["6_53_50",[792,4591]],["6_62_0",[0,0]],["6_41_60",[0,0]],["6_50_0",[0,0]],["6_9_42",[0,0]],["6_18_6",[0,2161]],["6_33_45",[0,0]],["6_37_46",[0,0]],["6_21_57",[0,0]],["6_29_39",[0,1878]],["6_2_3",[0,0]],["6_57_46",[0,0]],["6_5_39",[0,0]],["6_41_61",[0,0]],["6_13_41",[0,0]],["6_50_1",[0,0]],["6_62_1",[0,0]],["6_45_59",[2290,8795]],["6_25_39",[0,0]],["6_2_4",[0,0]],["6_9_43",[0,0]],["6_33_46",[0,0]],["6_18_7",[0,2210]],["6_13_42",[0,0]],["6_37_47",[0,0]],["6_41_62",[0,0]],["6_62_2",[0,0]],["6_29_40",[0,0]],["6_18_8",[0,1881]],["6_57_47",[0,0]],["6_21_58",[0,0]],["6_50_2",[0,0]],["6_25_40",[0,0]],["6_45_60",[0,5621]],["6_33_47",[0,0]],["6_5_40",[0,0]],["6_62_3",[0,0]],["6_9_44",[0,0]],["6_2_5",[0,0]],["6_53_51",[41,13077]],["6_25_41",[0,0]],["6_21_59",[0,145]],["6_37_48",[0,0]],["6_50_3",[0,0]],["6_41_63",[0,0]],["6_18_9",[0,1239]],["6_45_61",[0,0]],["6_2_6",[0,0]],["6_29_41",[0,0]],["6_57_48",[0,2414]],["6_2_7",[0,0]],["6_37_49",[0,1188]],["6_62_4",[0,0]],["6_45_62",[0,0]],["6_5_41",[0,0]],["6_2_8",[0,0]],["6_53_52",[218,13305]],["6_42_0",[0,0]],["6_50_4",[0,0]],["6_21_60",[0,881]],["6_2_9",[0,0]],["6_9_45",[0,0]],["6_25_42",[0,0]],["6_13_43",[0,0]],["6_62_5",[0,0]],["6_45_63",[0,0]],["6_57_49",[804,2377]],["6_29_42",[0,0]],["6_33_48",[0,0]],["6_18_10",[0,835]],["6_50_5",[0,0]],["6_42_1",[0,0]],["6_2_10",[0,0]],["6_5_42",[0,0]],["6_18_11",[0,0]],["6_13_44",[0,0]],["6_2_11",[0,0]],["6_18_12",[0,1852]],["6_21_61",[0,0]],["6_25_43",[0,2779]],["6_2_12",[0,0]],["6_62_6",[0,0]],["6_46_0",[0,0]],["6_29_43",[0,0]],["6_2_13",[0,0]],["6_9_46",[0,0]],["6_33_49",[0,2362]],["6_42_2",[0,0]],["6_37_50",[0,2255]],["6_57_50",[1845,2511]],["6_18_13",[-12,1815]],["6_53_53",[369,13241]],["6_50_6",[0,0]],["6_21_62",[0,0]],["6_62_7",[0,0]],["6_13_45",[0,0]],["6_2_14",[0,583]],["6_46_1",[0,0]],["6_5_43",[0,0]],["6_25_44",[0,0]],["6_18_14",[0,1208]],["6_57_51",[2276,2653]],["6_18_15",[0,136]],["6_29_44",[0,0]],["6_2_15",[0,923]],["6_9_47",[0,0]],["6_18_16",[0,380]],["6_50_7",[0,173]],["6_42_3",[0,0]],["6_46_2",[0,0]],["6_33_50",[0,3385]],["6_37_51",[1890,3124]],["6_25_45",[0,0]],["6_2_16",[0,1278]],["6_13_46",[0,0]],["6_29_45",[0,0]],["6_5_44",[0,0]],["6_21_63",[0,0]],["6_18_17",[0,660]],["6_9_48",[0,0]],["6_62_8",[0,0]],["6_46_3",[0,0]],["6_2_17",[0,649]],["6_62_9",[0,0]],["6_18_18",[0,598]],["6_42_4",[0,0]],["6_50_8",[-51,1063]],["6_25_46",[0,0]],["6_53_54",[291,5989]],["6_22_0",[0,0]],["6_2_18",[0,466]],["6_9_49",[0,0]],["6_5_45",[0,0]],["6_18_19",[0,358]],["6_37_52",[1395,13530]],["6_62_10",[0,0]],["6_13_47",[0,0]],["6_2_19",[0,0]],["6_46_4",[0,0]],["6_18_20",[0,470]],["6_25_47",[0,0]],["6_18_21",[0,536]],["6_50_9",[0,383]],["6_57_52",[2199,6172]],["6_29_46",[0,0]],["6_62_11",[0,0]],["6_2_20",[0,2562]],["6_42_5",[0,637]],["6_25_48",[0,0]],["6_2_21",[0,0]],["6_37_53",[676,12767]],["6_53_55",[-23,4620]],["6_46_5",[0,0]],["6_33_51",[257,13225]],["6_62_12",[0,0]],["6_2_22",[0,0]],["6_18_22",[9,855]],["6_22_1",[0,0]],["6_50_10",[0,882]],["6_62_13",[0,0]],["6_29_47",[0,0]],["6_9_50",[0,0]],["6_2_23",[0,0]],["6_62_14",[0,1150]],["6_18_23",[0,1473]],["6_13_48",[0,0]],["6_5_46",[0,0]],["6_62_15",[7,1610]],["6_25_49",[0,0]],["6_57_53",[2027,5278]],["6_42_6",[0,609]],["6_37_54",[304,10339]],["6_46_6",[0,327]],["6_33_52",[683,13523]],["6_22_2",[0,0]],["6_50_11",[0,665]],["6_18_24",[0,1155]],["6_53_56",[2020,5716]],["6_50_12",[0,163]],["6_29_48",[0,0]],["6_13_49",[0,0]],["6_2_24",[0,0]],["6_18_25",[0,149]],["6_22_3",[0,359]],["6_9_51",[0,3243]],["6_46_7",[0,0]],["6_22_4",[0,1219]],["6_25_50",[0,0]],["6_62_16",[1,1114]],["6_46_8",[0,0]],["6_5_47",[0,0]],["6_50_13",[5,751]],["6_2_25",[0,0]],["6_29_49",[0,0]],["6_50_14",[18,811]],["6_42_7",[0,586]],["6_62_17",[0,2285]],["6_18_26",[0,0]],["6_53_57",[2915,3126]],["6_25_51",[0,0]],["6_18_27",[0,68]],["6_13_50",[0,1121]],["6_2_26",[0,0]],["6_5_48",[0,0]],["6_50_15",[161,949]],["6_42_8",[0,0]],["6_50_16",[172,954]],["6_57_54",[1901,6014]],["6_9_52",[0,2760]],["6_50_17",[152,846]],["6_46_9",[0,0]],["6_37_55",[566,13720]],["6_2_27",[0,0]],["6_50_18",[184,764]],["6_29_50",[0,1220]],["6_50_19",[187,1160]],["6_46_10",[0,0]],["6_22_5",[0,1587]],["6_42_9",[0,0]],["6_25_52",[0,0]],["6_50_20",[323,2034]],["6_42_10",[0,1195]],["6_46_11",[0,310]],["6_9_53",[622,3370]],["6_50_21",[406,3061]],["6_42_11",[0,1481]],["6_33_53",[1176,7380]],["6_18_28",[0,2076]],["6_50_22",[778,3296]],["6_42_12",[0,1211]],["6_13_51",[0,2872]],["6_2_28",[0,0]],["6_50_23",[694,3444]],["6_53_58",[1044,4077]],["6_57_55",[1324,5328]],["6_42_13",[0,53]],["6_37_56",[781,13866]],["6_46_12",[0,571]],["6_62_18",[0,1551]],["6_50_24",[946,4919]],["6_5_49",[0,0]],["6_18_29",[0,1753]],["6_22_6",[-312,11627]],["6_2_29",[0,0]],["6_42_14",[0,411]],["6_29_51",[0,1833]],["6_50_25",[377,5154]],["6_25_53",[0,0]],["6_46_13",[0,134]],["6_42_15",[0,182]],["6_62_19",[0,0]],["6_37_57",[0,13388]],["6_18_30",[0,5402]],["6_50_26",[121,6872]],["6_2_30",[0,0]],["6_50_27",[35,4013]],["6_46_14",[0,131]],["6_46_15",[0,139]],["6_50_28",[-1,2745]],["6_62_20",[0,852]],["6_42_16",[18,1783]],["6_9_54",[14,12129]],["6_50_29",[0,1795]],["6_46_16",[7,143]],["6_22_7",[-138,11186]],["6_5_50",[0,0]],["6_50_30",[0,1386]],["6_33_54",[299,7815]],["6_25_54",[0,1090]],["6_46_17",[17,199]],["6_29_52",[-47,2705]],["6_53_59",[623,3874]],["6_42_17",[22,1486]],["6_50_31",[0,1997]],["6_57_56",[1694,5434]],["6_62_21",[0,415]],["6_2_31",[0,0]],["6_46_18",[31,141]],["6_13_52",[0,635]],["6_42_18",[11,1499]],["6_50_32",[0,3545]],["6_18_31",[0,5561]],["6_37_58",[0,0]],["6_50_33",[0,1943]],["6_46_19",[46,202]],["6_22_8",[-38,5877]],["6_62_22",[0,0]],["6_57_57",[2096,2339]],["6_25_55",[0,2123]],["6_46_20",[84,364]],["6_9_55",[-40,11694]],["6_29_53",[55,12037]],["6_42_19",[86,833]],["6_62_23",[0,0]],["6_2_32",[0,0]],["6_46_21",[126,2546]],["6_42_20",[-84,1583]],["6_5_51",[0,0]],["6_46_22",[136,3999]],["6_53_60",[0,5562]],["6_50_34",[0,0]],["6_42_21",[93,691]],["6_42_22",[16,585]],["6_37_59",[0,0]],["6_46_23",[136,7162]],["6_62_24",[0,0]],["6_33_55",[554,10487]],["6_62_25",[0,0]],["6_2_33",[0,0]],["6_18_32",[104,5630]],["6_42_23",[1,217]],["6_62_26",[0,0]],["6_53_61",[0,0]],["6_9_56",[-280,12102]],["6_13_53",[18,11237]],["6_62_27",[0,0]],["6_29_54",[682,12229]],["6_46_24",[865,5869]],["6_57_58",[969,8901]],["6_46_25",[1620,6866]],["6_25_56",[0,264]],["6_62_28",[0,0]],["6_50_35",[0,0]],["6_42_24",[30,2979]],["6_42_25",[249,3175]],["6_5_52",[0,0]],["6_46_26",[75,7852]],["6_2_34",[0,0]],["6_18_33",[0,6286]],["6_62_29",[0,0]],["6_42_26",[0,4289]],["6_46_27",[50,1174]],["6_37_60",[0,0]],["6_33_56",[2428,12711]],["6_46_28",[0,1514]],["6_22_9",[24,12804]],["6_42_27",[0,2768]],["6_25_57",[-3,755]],["6_50_36",[0,0]],["6_53_62",[0,0]],["6_46_29",[0,1054]],["6_42_28",[0,219]],["6_42_29",[0,0]],["6_5_53",[0,961]],["6_9_57",[-307,11361]],["6_42_30",[0,0]],["6_57_59",[478,2460]],["6_46_30",[0,2402]],["6_62_30",[0,0]],["6_50_37",[0,0]],["6_18_34",[0,5435]],["6_22_10",[455,11957]],["6_29_55",[541,11875]],["6_33_57",[2477,2846]],["6_18_35",[0,0]],["6_37_61",[0,0]],["6_2_35",[0,0]],["6_42_31",[0,0]],["6_46_31",[0,0]],["6_13_54",[-478,12045]],["6_42_32",[0,0]],["6_25_58",[-323,1223]],["6_33_58",[1406,12504]],["6_18_36",[0,0]],["6_2_36",[0,0]],["6_46_32",[0,0]],["6_46_33",[0,0]],["6_53_63",[0,0]],["6_37_62",[0,0]],["6_62_31",[0,0]],["6_50_38",[0,0]],["6_5_54",[-36,1300]],["6_46_34",[0,0]],["6_57_60",[0,2776]],["6_18_37",[0,0]],["6_22_11",[0,4070]],["6_18_38",[0,0]],["6_25_59",[149,1484]],["6_46_35",[0,0]],["6_22_12",[-2,3923]],["6_9_58",[12,11078]],["6_18_39",[0,1256]],["6_22_13",[-11,10295]],["6_29_56",[767,4672]],["6_42_33",[0,0]],["6_2_37",[0,0]],["6_46_36",[0,0]],["6_54_0",[0,0]],["6_42_34",[0,0]],["6_50_39",[0,0]],["6_62_32",[0,0]],["6_37_63",[0,0]],["6_22_14",[-1,2058]],["6_13_55",[-216,12012]],["6_57_61",[0,0]],["6_18_40",[0,1175]],["6_33_59",[848,6730]],["6_25_60",[0,1530]],["6_22_15",[0,1488]],["6_2_38",[0,0]],["6_18_41",[0,3806]],["6_42_35",[0,718]],["6_5_55",[-27,1604]],["6_9_59",[-566,1566]],["6_46_37",[0,0]],["6_22_16",[0,2061]],["6_18_42",[-6,3419]],["6_54_1",[0,0]],["6_57_62",[0,0]],["6_25_61",[0,0]],["6_29_57",[628,4212]],["6_50_40",[0,0]],["6_62_33",[0,0]],["6_22_17",[0,1420]],["6_46_38",[0,0]],["6_33_60",[0,7335]],["6_2_39",[0,0]],["6_42_36",[0,0]],["6_38_0",[0,0]],["6_18_43",[0,1511]],["6_22_18",[0,0]],["6_22_19",[0,0]],["6_29_58",[954,6947]],["6_9_60",[0,1225]],["6_5_56",[-56,1612]],["6_22_20",[0,147]],["6_25_62",[0,0]],["6_62_34",[0,0]],["6_46_39",[0,0]],["6_50_41",[0,0]],["6_22_21",[0,321]],["6_2_40",[0,0]],["6_5_57",[-1,3733]],["6_42_37",[0,0]],["6_33_61",[0,0]],["6_57_63",[0,0]],["6_18_44",[0,0]],["6_54_2",[0,0]],["6_13_56",[626,12339]],["6_22_22",[0,295]],["6_62_35",[0,841]],["6_9_61",[0,0]],["6_46_40",[0,0]],["6_2_41",[0,0]],["6_58_0",[0,0]],["6_50_42",[0,0]],["6_38_1",[0,0]],["6_25_63",[0,0]],["6_42_38",[0,0]],["6_18_45",[0,0]],["6_22_23",[0,0]],["6_54_3",[0,0]],["6_2_42",[0,0]],["6_33_62",[0,0]],["6_58_1",[0,0]],["6_9_62",[0,0]],["6_5_58",[-52,10478]],["6_29_59",[675,6800]],["6_38_2",[0,0]],["6_46_41",[0,0]],["6_42_39",[0,0]],["6_18_46",[0,0]],["6_2_43",[0,0]],["6_22_24",[0,0]],["6_62_36",[0,0]],["6_29_60",[0,6820]],["6_50_43",[0,0]],["6_54_4",[0,0]],["6_5_59",[-294,1264]],["6_26_0",[0,0]],["6_58_2",[0,0]],["6_33_63",[0,0]],["6_9_63",[0,0]],["6_13_57",[129,12482]],["6_46_42",[0,0]],["6_22_25",[0,0]],["6_18_47",[0,0]],["6_62_37",[0,0]],["6_38_3",[0,0]],["6_29_61",[0,0]],["6_26_1",[0,0]],["6_2_44",[0,0]],["6_58_3",[0,0]],["6_10_0",[0,0]],["6_5_60",[-153,509]],["6_50_44",[0,0]],["6_42_40",[0,0]],["6_54_5",[0,0]],["6_18_48",[0,0]],["6_13_58",[589,11467]],["6_34_0",[0,0]],["6_46_43",[0,0]],["6_2_45",[0,0]],["6_54_6",[0,0]],["6_13_59",[-372,2950]],["6_22_26",[0,0]],["6_18_49",[0,3120]],["6_26_2",[0,0]],["6_38_4",[0,0]],["6_10_1",[0,0]],["6_29_62",[0,0]],["6_5_61",[0,0]],["6_50_45",[0,0]],["6_10_2",[0,0]],["6_46_44",[0,0]],["6_58_4",[0,0]],["6_13_60",[0,2474]],["6_22_27",[0,0]],["6_62_38",[0,685]],["6_42_41",[0,0]],["6_34_1",[0,0]],["6_10_3",[0,0]],["6_2_46",[0,0]],["6_54_7",[0,0]],["6_22_28",[0,0]],["6_29_63",[0,0]],["6_18_50",[0,2744]],["6_38_5",[0,0]],["6_13_61",[0,0]],["6_26_3",[0,1778]],["6_5_62",[0,0]],["6_62_39",[0,2281]],["6_10_4",[0,0]],["6_42_42",[0,0]],["6_46_45",[0,0]],["6_34_2",[0,0]],["6_2_47",[0,0]],["6_22_29",[0,0]],["6_58_5",[0,0]],["6_50_46",[0,0]],["6_5_63",[0,0]],["6_18_51",[-21,3450]],["6_26_4",[0,1496]],["6_10_5",[0,0]],["6_38_6",[0,0]],["6_54_8",[0,0]],["6_30_0",[0,0]],["6_22_30",[0,29]],["6_13_62",[0,0]],["6_42_43",[0,0]],["6_34_3",[0,0]],["6_62_40",[0,3359]],["6_58_6",[0,0]],["6_50_47",[0,3322]],["6_46_46",[0,0]],["6_13_63",[0,0]],["6_50_48",[400,7848]],["6_18_52",[8,4943]],["6_2_48",[0,0]],["6_58_7",[0,0]],["6_54_9",[0,0]],["6_10_6",[0,0]],["6_42_44",[0,0]],["6_22_31",[0,981]],["6_14_0",[0,0]],["6_62_41",[0,2085]],["6_6_0",[0,0]],["6_34_4",[0,0]],["6_30_1",[0,0]],["6_38_7",[0,0]],["6_58_8",[0,0]],["6_46_47",[0,0]],["6_26_5",[0,1402]],["6_42_45",[0,0]],["6_50_49",[1120,6392]],["6_10_7",[0,0]],["6_22_32",[0,808]],["6_2_49",[0,0]],["6_46_48",[0,1810]],["6_18_53",[0,3487]],["6_54_10",[0,0]],["6_14_1",[0,0]],["6_26_6",[738,2998]],["6_22_33",[156,734]],["6_62_42",[0,0]],["6_30_2",[0,0]],["6_38_8",[0,0]],["6_10_8",[0,0]],["6_6_1",[0,0]],["6_42_46",[0,0]],["6_62_43",[0,448]],["6_38_9",[0,0]],["6_22_34",[124,998]],["6_34_5",[0,0]],["6_58_9",[0,0]],["6_46_49",[306,2610]],["6_6_2",[0,0]],["6_2_50",[0,0]],["6_30_3",[0,0]],["6_50_50",[911,4935]],["6_58_10",[0,18]],["6_22_35",[115,999]],["6_18_54",[-8,2232]],["6_58_11",[0,329]],["6_10_9",[0,83]],["6_34_6",[0,0]],["6_38_10",[0,0]],["6_22_36",[94,1327]],["6_14_2",[0,0]],["6_38_11",[0,0]],["6_2_51",[0,0]],["6_42_47",[0,2455]],["6_54_11",[0,0]],["6_6_3",[0,0]],["6_22_37",[0,1130]],["6_34_7",[0,1481]],["6_58_12",[0,3]],["6_26_7",[1196,2011]],["6_38_12",[0,0]],["6_62_44",[0,0]],["6_10_10",[0,203]],["6_62_45",[0,0]],["6_22_38",[0,441]],["6_30_4",[0,0]],["6_18_55",[-285,1371]],["6_46_50",[1310,3881]],["6_26_8",[492,2991]],["6_62_46",[0,0]],["6_54_12",[0,347]],["6_38_13",[0,0]],["6_14_3",[0,0]],["6_34_8",[0,1669]],["6_58_13",[0,349]],["6_22_39",[0,0]],["6_10_11",[0,362]],["6_6_4",[0,0]],["6_2_52",[0,0]],["6_58_14",[3,723]],["6_50_51",[1021,5352]],["6_42_48",[0,2601]],["6_34_9",[0,1256]],["6_2_53",[0,0]],["6_46_51",[0,7083]],["6_50_52",[440,5261]],["6_62_47",[0,0]],["6_38_14",[0,310]],["6_10_12",[0,453]],["6_26_9",[1283,3762]],["6_14_4",[0,0]],["6_54_13",[0,937]],["6_34_10",[0,827]],["6_30_5",[0,0]],["6_38_15",[0,1175]],["6_2_54",[0,0]],["6_58_15",[6,915]],["6_22_40",[0,0]],["6_26_10",[721,12560]],["6_6_5",[0,0]],["6_18_56",[0,840]],["6_62_48",[0,0]],["6_14_5",[0,0]],["6_54_14",[4,1950]],["6_2_55",[0,712]],["6_10_13",[0,692]],["6_38_16",[0,196]],["6_58_16",[11,2425]],["6_54_15",[11,2237]],["6_62_49",[0,0]],["6_34_11",[0,0]],["6_62_50",[0,4073]],["6_38_17",[0,224]],["6_10_14",[0,862]],["6_26_11",[615,9726]],["6_22_41",[0,0]],["6_30_6",[0,0]],["6_54_16",[23,2020]],["6_18_57",[0,621]],["6_38_18",[28,238]],["6_18_58",[0,10334]],["6_2_56",[0,872]],["6_34_12",[0,0]],["6_58_17",[209,2337]],["6_14_6",[0,515]],["6_34_13",[0,0]],["6_62_51",[0,2618]],["6_50_53",[155,6420]],["6_2_57",[0,0]],["6_6_6",[0,0]],["6_42_49",[966,5113]],["6_58_18",[0,1930]],["6_10_15",[149,773]],["6_38_19",[75,253]],["6_6_7",[0,0]],["6_30_7",[0,0]],["6_18_59",[-165,1490]],["6_38_20",[89,267]],["6_54_17",[28,1127]],["6_34_14",[0,861]],["6_50_54",[612,13612]],["6_58_19",[0,0]],["6_6_8",[0,0]],["6_46_52",[0,5890]],["6_62_52",[0,0]],["6_58_20",[0,0]],["6_38_21",[52,250]],["6_2_58",[0,0]],["6_6_9",[0,0]],["6_10_16",[147,1087]],["6_14_7",[0,598]],["6_54_18",[84,770]],["6_22_42",[0,0]],["6_46_53",[413,8143]],["6_10_17",[80,1510]],["6_58_21",[0,0]],["6_46_54",[0,7481]],["6_34_15",[0,1748]],["6_38_22",[0,319]],["6_50_55",[271,13074]],["6_62_53",[0,0]],["6_2_59",[0,0]],["6_18_60",[-10,1013]],["6_22_43",[0,0]],["6_14_8",[0,213]],["6_10_18",[144,1393]],["6_38_23",[0,2447]],["6_34_16",[0,1781]],["6_10_19",[302,2254]],["6_58_22",[0,1429]],["6_46_55",[0,0]],["6_2_60",[0,0]],["6_50_56",[1473,4314]],["6_34_17",[0,1654]],["6_6_10",[0,0]],["6_62_54",[0,2338]],["6_14_9",[0,299]],["6_22_44",[0,0]],["6_54_19",[205,2122]],["6_34_18",[6,1152]],["6_18_61",[0,0]],["6_14_10",[0,383]],["6_58_23",[0,1550]],["6_30_8",[0,0]],["6_42_50",[977,5030]],["6_2_61",[0,0]],["6_58_24",[0,0]],["6_6_11",[0,0]],["6_34_19",[0,358]],["6_14_11",[0,342]],["6_62_55",[0,0]],["6_10_20",[422,3684]],["6_46_56",[0,1283]],["6_22_45",[0,2193]],["6_58_25",[0,0]],["6_26_12",[438,5131]],["6_34_20",[0,166]],["6_38_24",[0,3599]],["6_58_26",[0,0]],["6_14_12",[0,411]],["6_2_62",[0,0]],["6_18_62",[0,0]],["6_22_46",[0,840]],["6_6_12",[0,0]],["6_58_27",[0,0]],["6_50_57",[671,4094]],["6_14_13",[0,409]],["6_22_47",[0,0]],["6_54_20",[202,1597]],["6_42_51",[535,5192]],["6_2_63",[0,0]],["6_34_21",[21,1505]],["6_10_21",[0,3051]],["6_26_13",[0,4436]],["6_54_21",[110,1212]],["6_62_56",[0,0]],["6_58_28",[0,0]],["6_30_9",[0,0]],["6_6_13",[0,0]],["6_54_22",[91,1384]],["6_58_29",[0,0]],["6_34_22",[0,3468]],["6_38_25",[-372,2998]],["6_30_10",[0,0]],["6_54_23",[-84,2603]],["6_3_0",[0,0]],["6_46_57",[692,13968]],["6_54_24",[0,2456]],["6_22_48",[0,0]],["6_34_23",[0,2632]],["6_26_14",[0,4295]],["6_18_63",[0,0]],["6_42_52",[1615,5977]],["6_14_14",[0,166]],["6_38_26",[-427,2447]],["6_58_30",[0,0]],["6_62_57",[0,0]],["6_10_22",[0,4240]],["6_54_25",[0,1802]],["6_30_11",[0,0]],["6_6_14",[0,2610]],["6_54_26",[0,581]],["6_10_23",[27,4084]],["6_3_1",[0,0]],["6_22_49",[0,0]],["6_38_27",[0,2147]],["6_54_27",[0,403]],["6_42_53",[2285,5221]],["6_30_12",[0,0]],["6_14_15",[0,171]],["6_58_31",[0,0]],["6_46_58",[865,9656]],["6_50_58",[481,13441]],["6_54_28",[0,0]],["6_26_15",[0,2547]],["6_19_0",[0,0]],["6_26_16",[0,0]],["6_14_16",[6,277]],["6_3_2",[0,0]],["6_26_17",[0,0]],["6_30_13",[0,2140]],["6_6_15",[110,2003]],["6_42_54",[0,6254]],["6_62_58",[0,0]],["6_22_50",[0,0]],["6_14_17",[6,327]],["6_42_55",[0,13369]],["6_26_18",[0,0]],["6_6_16",[114,1858]],["6_10_24",[-2,4108]],["6_14_18",[65,408]],["6_54_29",[0,1217]],["6_26_19",[0,0]],["6_58_32",[0,2068]],["6_34_24",[0,3139]],["6_46_59",[0,8726]],["6_10_25",[0,4205]],["6_30_14",[0,0]],["6_3_3",[0,0]],["6_6_17",[154,4916]],["6_54_30",[0,2716]],["6_38_28",[0,2577]],["6_26_20",[0,0]],["6_22_51",[0,0]],["6_34_25",[0,923]],["6_19_1",[0,0]],["6_26_21",[0,0]],["6_34_26",[0,1003]],["6_30_15",[0,0]],["6_54_31",[0,1766]],["6_10_26",[0,1206]],["6_6_18",[0,5268]],["6_34_27",[386,1226]],["6_62_59",[0,0]],["6_22_52",[0,0]],["6_30_16",[0,0]],["6_50_59",[501,6514]],["6_26_22",[0,0]],["6_14_19",[92,401]],["6_26_23",[0,0]],["6_19_2",[0,0]],["6_3_4",[0,0]],["6_54_32",[0,2561]],["6_10_27",[0,0]],["6_42_56",[40,13645]],["6_46_60",[0,5570]],["6_38_29",[0,4415]],["6_10_28",[0,0]],["6_26_24",[0,2091]],["6_30_17",[0,735]],["6_14_20",[179,685]],["6_62_60",[0,0]],["6_54_33",[0,2744]],["6_19_3",[0,1712]],["6_19_4",[0,2129]],["6_10_29",[0,0]],["6_34_28",[208,3110]],["6_22_53",[0,0]],["6_6_19",[0,0]],["6_42_57",[0,14103]],["6_14_21",[213,784]],["6_46_61",[0,0]],["6_30_18",[0,476]],["6_62_61",[0,0]],["6_50_60",[0,5895]],["6_38_30",[395,4120]],["6_6_20",[0,0]],["6_26_25",[0,0]],["6_3_5",[0,0]],["6_10_30",[0,0]],["6_14_22",[226,678]],["6_46_62",[0,0]],["6_14_23",[310,1047]],["6_34_29",[209,675]],["6_54_34",[0,768]],["6_30_19",[0,812]],["6_6_21",[0,0]],["6_14_24",[218,1016]],["6_42_58",[0,6846]],["6_26_26",[0,0]],["6_62_62",[0,0]],["6_6_22",[0,0]],["6_38_31",[184,4176]],["6_30_20",[0,833]],["6_22_54",[0,0]],["6_19_5",[0,1784]],["6_50_61",[0,0]],["6_30_21",[0,849]],["6_14_25",[95,1027]],["6_34_30",[112,2308]],["6_3_6",[0,0]],["6_46_63",[0,0]],["6_6_23",[0,0]],["6_26_27",[0,0]],["6_42_59",[0,274]],["6_34_31",[223,1320]],["6_10_31",[0,0]],["6_14_26",[0,1613]],["6_19_6",[0,1928]],["6_30_22",[0,0]],["6_58_33",[0,3917]],["6_34_32",[0,933]],["6_54_35",[12,920]],["6_62_63",[0,0]],["6_6_24",[0,0]],["6_22_55",[0,50]],["6_30_23",[0,2178]],["6_3_7",[0,0]],["6_50_62",[0,0]],["6_30_24",[0,2311]],["6_14_27",[0,3633]],["6_26_28",[0,0]],["6_10_32",[0,0]],["6_34_33",[0,1977]],["6_38_32",[0,5758]],["6_6_25",[0,0]],["6_42_60",[0,0]],["6_63_0",[0,0]],["6_54_36",[258,910]],["6_58_34",[0,0]],["6_19_7",[0,1364]],["6_47_0",[0,0]],["6_3_8",[0,0]],["6_14_28",[0,5224]],["6_30_25",[0,3133]],["6_22_56",[0,1227]],["6_26_29",[0,0]],["6_6_26",[0,0]],["6_38_33",[0,2860]],["6_14_29",[0,3572]],["6_63_1",[0,0]],["6_47_1",[0,0]],["6_34_34",[0,2468]],["6_10_33",[0,0]],["6_3_9",[0,0]],["6_19_8",[0,1510]],["6_42_61",[0,0]],["6_6_27",[0,0]],["6_22_57",[-3,2052]],["6_54_37",[0,499]],["6_26_30",[0,0]],["6_58_35",[0,1142]],["6_3_10",[0,0]],["6_30_26",[0,3908]],["6_50_63",[0,0]],["6_63_2",[0,0]],["6_22_58",[0,0]],["6_10_34",[0,0]],["6_51_0",[0,0]],["6_63_3",[0,0]],["6_19_9",[0,2124]],["6_54_38",[0,159]],["6_26_31",[0,0]],["6_34_35",[0,2419]],["6_47_2",[0,0]],["6_42_62",[0,0]],["6_58_36",[0,1207]],["6_19_10",[0,1095]],["6_14_30",[0,0]],["6_63_4",[0,0]],["6_3_11",[0,0]],["6_22_59",[0,1975]],["6_30_27",[179,589]],["6_6_28",[0,0]],["6_26_32",[0,0]],["6_3_12",[0,0]],["6_51_1",[0,0]],["6_10_35",[0,0]],["6_6_29",[0,0]],["6_19_11",[0,0]],["6_42_63",[0,0]],["6_38_34",[37,2718]],["6_14_31",[0,0]],["6_47_3",[0,0]],["6_30_28",[111,548]],["6_58_37",[111,1501]],["6_26_33",[0,0]],["6_3_13",[0,21]],["6_34_36",[0,2306]],["6_51_2",[0,0]],["6_19_12",[0,0]],["6_47_4",[0,0]],["6_6_30",[0,0]],["6_22_60",[0,1303]],["6_3_14",[0,1230]],["6_10_36",[0,0]],["6_54_39",[0,0]],["6_38_35",[0,1760]],["6_14_32",[0,0]],["6_30_29",[48,915]],["6_3_15",[0,1428]],["6_58_38",[0,2128]],["6_26_34",[0,0]],["6_54_40",[0,0]],["6_3_16",[0,1059]],["6_51_3",[0,0]],["6_22_61",[0,0]],["6_19_13",[-1,1822]],["6_3_17",[0,976]],["6_47_5",[0,0]],["6_19_14",[0,1737]],["6_6_31",[0,0]],["6_10_37",[0,0]],["6_58_39",[0,1873]],["6_30_30",[0,1664]],["6_19_15",[0,1279]],["6_14_33",[0,0]],["6_26_35",[0,0]],["6_38_36",[0,184]],["6_54_41",[0,0]],["6_19_16",[0,707]],["6_10_38",[0,0]],["6_51_4",[0,0]],["6_22_62",[0,0]],["6_54_42",[0,0]],["6_3_18",[0,1423]],["6_63_5",[0,0]],["6_38_37",[0,0]],["6_26_36",[0,0]],["6_3_19",[0,2399]],["6_6_32",[0,0]],["6_63_6",[0,0]],["6_51_5",[0,0]],["6_47_6",[0,0]],["6_14_34",[0,0]],["6_30_31",[0,247]],["6_43_0",[0,0]],["6_19_17",[0,786]],["6_58_40",[0,1502]],["6_26_37",[0,0]],["6_63_7",[0,0]],["6_19_18",[0,609]],["6_54_43",[0,0]],["6_22_63",[0,0]],["6_19_19",[0,708]],["6_10_39",[0,0]],["6_19_20",[151,723]],["6_3_20",[0,2267]],["6_14_35",[0,0]],["6_19_21",[0,1060]],["6_38_38",[0,0]],["6_51_6",[0,0]],["6_6_33",[0,459]],["6_19_22",[0,1412]],["6_58_41",[0,0]],["6_47_7",[0,0]],["6_3_21",[0,0]],["6_51_7",[0,0]],["6_34_37",[0,1598]],["6_19_23",[0,1799]],["6_30_32",[0,0]],["6_23_0",[0,0]],["6_63_8",[0,0]],["6_54_44",[0,0]],["6_26_38",[0,0]],["6_3_22",[0,0]],["6_43_1",[0,0]],["6_6_34",[0,0]],["6_10_40",[0,0]],["6_14_36",[0,0]],["6_38_39",[0,0]],["6_3_23",[0,0]],["6_47_8",[0,0]],["6_51_8",[0,11]],["6_19_24",[0,5]],["6_23_1",[0,0]],["6_30_33",[0,0]],["6_6_35",[0,0]],["6_58_42",[0,0]],["6_34_38",[0,0]],["6_63_9",[0,0]],["6_26_39",[0,0]],["6_3_24",[0,0]],["6_10_41",[0,0]],["6_19_25",[0,0]],["6_3_25",[0,0]],["6_47_9",[0,0]],["6_43_2",[0,0]],["6_54_45",[0,0]],["6_51_9",[0,143]],["6_47_10",[0,0]],["6_38_40",[0,0]],["6_30_34",[0,670]],["6_14_37",[0,0]],["6_19_26",[0,0]],["6_51_10",[0,1113]],["6_23_2",[0,0]],["6_63_10",[0,0]],["6_19_27",[0,0]],["6_34_39",[0,0]],["6_19_28",[-39,2943]],["6_47_11",[0,209]],["6_43_3",[0,0]],["6_30_35",[0,0]],["6_26_40",[0,0]],["6_6_36",[0,0]],["6_3_26",[0,0]],["6_58_43",[0,0]],["6_63_11",[0,0]],["6_23_3",[-2,1196]],["6_34_40",[0,0]],["6_10_42",[0,0]],["6_38_41",[0,1148]],["6_14_38",[0,0]],["6_63_12",[0,0]],["6_54_46",[0,0]],["6_47_12",[0,208]],["6_63_13",[0,611]],["6_51_11",[0,1046]],["6_30_36",[0,0]],["6_19_29",[0,3026]],["6_47_13",[10,164]],["6_43_4",[0,0]],["6_3_27",[0,1476]],["6_63_14",[0,1559]],["6_58_44",[0,0]],["6_26_41",[0,0]],["6_6_37",[0,0]],["6_30_37",[0,0]],["6_14_39",[0,0]],["6_38_42",[0,0]],["6_23_4",[0,1298]],["6_10_43",[0,0]],["6_54_47",[0,469]],["6_47_14",[0,930]],["6_47_15",[1,818]],["6_34_41",[0,0]],["6_51_12",[0,149]],["6_47_16",[3,701]],["6_26_42",[0,0]],["6_3_28",[0,1095]],["6_47_17",[13,532]],["6_58_45",[0,0]],["6_43_5",[0,531]],["6_19_30",[0,5082]],["6_6_38",[0,0]],["6_47_18",[38,186]],["6_14_40",[0,0]],["6_51_13",[8,615]],["6_30_38",[0,0]],["6_26_43",[0,0]],["6_47_19",[61,351]],["6_38_43",[0,0]],["6_58_46",[0,0]],["6_51_14",[57,893]],["6_23_5",[0,1481]],["6_34_42",[0,0]],["6_43_6",[-4,708]],["6_10_44",[0,0]],["6_54_48",[0,2771]],["6_30_39",[0,788]],["6_47_20",[52,2137]],["6_63_15",[81,1763]],["6_51_15",[139,913]],["6_19_31",[73,3760]],["6_3_29",[0,0]],["6_47_21",[173,4248]],["6_23_6",[-15,2778]],["6_51_16",[129,860]],["6_6_39",[0,0]],["6_47_22",[188,3822]],["6_19_32",[58,659]],["6_51_17",[214,721]],["6_34_43",[0,0]],["6_58_47",[0,0]],["6_51_18",[178,715]],["6_47_23",[-214,4866]],["6_43_7",[0,0]],["6_26_44",[0,0]],["6_47_24",[725,6381]],["6_23_7",[237,11741]],["6_38_44",[0,0]],["6_3_30",[0,0]],["6_47_25",[4197,6508]],["6_19_33",[102,488]],["6_54_49",[479,2795]],["6_26_45",[0,0]],["6_30_40",[0,0]],["6_14_41",[0,0]],["6_51_19",[191,2431]],["6_47_26",[71,8317]],["6_6_40",[0,0]],["6_51_20",[423,2542]],["6_47_27",[0,3722]],["6_10_45",[0,0]],["6_51_21",[452,2480]],["6_43_8",[0,0]],["6_47_28",[0,1158]],["6_34_44",[0,0]],["6_3_31",[0,0]],["6_47_29",[0,0]],["6_58_48",[0,1018]],["6_63_16",[0,1260]],["6_51_22",[853,2601]],["6_43_9",[0,526]],["6_19_34",[0,6234]],["6_14_42",[0,0]],["6_47_30",[0,0]],["6_43_10",[0,1013]],["6_51_23",[742,2239]],["6_43_11",[0,79]],["6_47_31",[0,0]],["6_38_45",[0,0]],["6_51_24",[509,2686]],["6_58_49",[67,2025]],["6_10_46",[0,0]],["6_51_25",[46,3565]],["6_19_35",[0,6207]],["6_30_41",[0,0]],["6_6_41",[0,0]],["6_51_26",[6,2928]],["6_63_17",[0,1316]],["6_51_27",[-16,1949]],["6_47_32",[0,0]],["6_26_46",[0,0]],["6_14_43",[0,0]],["6_54_50",[105,13116]],["6_51_28",[-22,1651]],["6_43_12",[0,0]],["6_51_29",[0,2444]],["6_34_45",[0,0]],["6_43_13",[0,12]],["6_54_51",[273,13188]],["6_43_14",[0,560]],["6_47_33",[0,0]],["6_10_47",[0,0]],["6_23_8",[211,12220]],["6_47_34",[0,0]],["6_58_50",[1648,2277]],["6_43_15",[0,1364]],["6_30_42",[0,0]],["6_26_47",[0,0]],["6_63_18",[0,0]],["6_3_32",[0,0]],["6_19_36",[0,6523]],["6_51_30",[0,1184]],["6_14_44",[0,0]],["6_43_16",[2,1323]],["6_6_42",[0,0]],["6_38_46",[0,0]],["6_51_31",[0,1451]],["6_19_37",[0,6674]],["6_14_45",[0,0]],["6_63_19",[0,0]],["6_34_46",[0,0]],["6_58_51",[2167,2483]],["6_3_33",[0,0]],["6_43_17",[3,226]],["6_10_48",[0,0]],["6_19_38",[0,6620]],["6_51_32",[0,1491]],["6_26_48",[0,0]],["6_54_52",[338,13229]],["6_47_35",[0,0]],["6_43_18",[12,148]],["6_30_43",[0,0]],["6_43_19",[33,194]],["6_6_43",[0,0]],["6_3_34",[0,0]],["6_47_36",[0,0]],["6_38_47",[0,0]],["6_43_20",[-106,353]],["6_19_39",[0,4556]],["6_34_47",[0,0]],["6_63_20",[0,0]],["6_14_46",[0,0]],["6_19_40",[0,3095]],["6_26_49",[0,0]],["6_51_33",[0,3185]],["6_3_35",[0,320]],["6_34_48",[0,0]],["6_47_37",[0,0]],["6_63_21",[0,1058]],["6_30_44",[0,0]],["6_51_34",[0,0]],["6_63_22",[0,0]],["6_3_36",[0,0]],["6_54_53",[97,13192]],["6_6_44",[0,0]],["6_43_21",[83,580]],["6_58_52",[2202,2535]],["6_34_49",[0,2258]],["6_23_9",[284,12511]],["6_63_23",[0,0]],["6_51_35",[0,0]],["6_26_50",[0,0]],["6_43_22",[52,1020]],["6_63_24",[0,0]],["6_30_45",[0,0]],["6_43_23",[11,924]],["6_19_41",[0,3324]],["6_10_49",[0,0]],["6_58_53",[2025,4832]],["6_54_54",[656,5155]],["6_47_38",[0,0]],["6_14_47",[0,0]],["6_10_50",[0,0]],["6_26_51",[0,0]],["6_6_45",[0,0]],["6_51_36",[0,0]],["6_30_46",[0,0]],["6_63_25",[0,0]],["6_43_24",[114,3940]],["6_54_55",[2271,3083]],["6_47_39",[0,0]],["6_43_25",[261,4589]],["6_14_48",[0,0]],["6_63_26",[0,0]],["6_26_52",[0,0]],["6_38_48",[0,0]],["6_58_54",[1404,4169]],["6_23_10",[721,12536]],["6_43_26",[43,3405]],["6_43_27",[0,2005]],["6_43_28",[0,0]],["6_34_50",[0,2996]],["6_51_37",[0,0]],["6_47_40",[0,0]],["6_19_42",[0,2638]],["6_30_47",[0,0]],["6_10_51",[0,3751]],["6_6_46",[0,0]],["6_63_27",[0,0]],["6_43_29",[0,0]],["6_23_11",[592,11028]],["6_54_56",[1939,3732]],["6_14_49",[0,0]],["6_26_53",[0,10999]],["6_43_30",[0,0]],["6_58_55",[1103,3390]],["6_63_28",[0,0]],["6_34_51",[827,13323]],["6_43_31",[0,0]],["6_38_49",[0,1569]],["6_30_48",[0,0]],["6_3_37",[0,0]],["6_10_52",[-23,3395]],["6_43_32",[0,0]],["6_63_29",[0,0]],["6_47_41",[0,0]],["6_6_47",[0,0]],["6_43_33",[0,0]],["6_19_43",[0,2395]],["6_14_50",[-17,1545]],["6_47_42",[0,0]],["6_51_38",[0,0]],["6_58_56",[1801,2365]],["6_30_49",[0,0]],["6_23_12",[1133,5279]],["6_26_54",[-3,11040]],["6_47_43",[0,0]],["6_26_55",[-382,10901]],["6_54_57",[2767,2952]],["6_34_52",[189,13471]],["6_3_38",[0,0]],["6_30_50",[0,5018]],["6_10_53",[514,12108]],["6_63_30",[0,0]],["6_38_50",[975,2671]],["6_51_39",[0,0]],["6_23_13",[137,4354]],["6_19_44",[0,377]],["6_14_51",[0,2330]],["6_43_34",[0,0]],["6_58_57",[1505,2198]],["6_54_58",[2196,3249]],["6_3_39",[0,0]],["6_47_44",[0,0]],["6_26_56",[-4,2165]],["6_23_14",[0,6333]],["6_38_51",[2259,3309]],["6_26_57",[0,1688]],["6_23_15",[0,4581]],["6_51_40",[0,0]],["6_19_45",[0,0]],["6_43_35",[0,317]],["6_6_48",[0,0]],["6_63_31",[0,0]],["6_26_58",[-414,10475]],["6_14_52",[-125,3824]],["6_58_58",[1262,6574]],["6_47_45",[0,0]],["6_3_40",[0,0]],["6_30_51",[11,3047]],["6_51_41",[0,0]],["6_58_59",[285,2580]],["6_6_49",[0,0]],["6_19_46",[0,0]],["6_38_52",[898,13575]],["6_43_36",[0,0]],["6_23_16",[0,4555]],["6_51_42",[0,0]],["6_63_32",[0,0]],["6_10_54",[-33,12152]],["6_19_47",[0,0]],["6_3_41",[0,0]],["6_47_46",[0,0]],["6_54_59",[1192,4419]],["6_10_55",[-187,11884]],["6_43_37",[0,0]],["6_6_50",[0,0]],["6_14_53",[-131,10959]],["6_58_60",[0,2745]],["6_47_47",[0,0]],["6_63_33",[0,0]],["6_51_43",[0,0]],["6_54_60",[0,3685]],["6_19_48",[0,2357]],["6_34_53",[823,13234]],["6_3_42",[0,0]],["6_47_48",[0,3314]],["6_19_49",[0,2986]],["6_3_43",[0,0]],["6_58_61",[0,0]],["6_63_34",[-2,791]],["6_30_52",[761,12667]],["6_54_61",[0,0]],["6_6_51",[0,0]],["6_26_59",[323,2233]],["6_3_44",[0,0]],["6_43_38",[0,0]],["6_47_49",[319,3374]],["6_63_35",[0,1198]],["6_23_17",[0,11795]],["6_19_50",[-2,2138]],["6_14_54",[-403,11427]],["6_26_60",[0,1830]],["6_58_62",[0,0]],["6_23_18",[0,2093]],["6_23_19",[0,0]],["6_43_39",[0,0]],["6_51_44",[0,0]],["6_54_62",[0,0]],["6_47_50",[288,5858]],["6_58_63",[0,0]],["6_3_45",[0,0]],["6_6_52",[0,699]],["6_23_20",[0,0]],["6_19_51",[-26,1924]],["6_23_21",[0,0]],["6_51_45",[0,0]],["6_30_53",[621,12542]],["6_63_36",[0,0]],["6_10_56",[-216,11900]],["6_38_53",[754,13657]],["6_14_55",[270,6437]],["6_54_63",[0,0]],["6_51_46",[0,0]],["6_34_54",[0,7617]],["6_26_61",[0,0]],["6_6_53",[0,2207]],["6_59_0",[0,0]],["6_3_46",[0,0]],["6_19_52",[182,2532]],["6_26_62",[0,0]],["6_23_22",[0,0]],["6_34_55",[0,12888]],["6_59_1",[0,0]],["6_43_40",[0,0]],["6_23_23",[0,0]],["6_10_57",[-29,11427]],["6_51_47",[0,1491]],["6_19_53",[0,1750]],["6_51_48",[-76,4917]],["6_63_37",[0,0]],["6_6_54",[0,10875]],["6_55_0",[0,0]],["6_26_63",[0,0]],["6_30_54",[475,12375]],["6_47_51",[242,13175]],["6_43_41",[0,0]],["6_55_1",[0,0]],["6_59_2",[0,0]],["6_51_49",[1060,3091]],["6_63_38",[0,761]],["6_38_54",[205,4027]],["6_19_54",[0,181]],["6_3_47",[0,0]],["6_14_56",[414,12251]],["6_23_24",[0,0]],["6_34_56",[513,12946]],["6_10_58",[66,11340]],["6_43_42",[0,0]],["6_19_55",[0,1308]],["6_27_0",[0,0]],["6_6_55",[10,1731]],["6_55_2",[0,0]],["6_23_25",[0,0]],["6_10_59",[-195,1785]],["6_38_55",[1099,12918]],["6_63_39",[0,2576]],["6_59_3",[0,0]],["6_19_56",[0,1528]],["6_3_48",[0,0]],["6_30_55",[511,7590]],["6_51_50",[811,4679]],["6_27_1",[0,0]],["6_55_3",[0,0]],["6_19_57",[0,819]],["6_34_57",[2167,4563]],["6_6_56",[-110,1903]],["6_59_4",[0,0]],["6_23_26",[0,0]],["6_63_40",[0,1189]],["6_51_51",[980,7287]],["6_34_58",[695,12615]],["6_10_60",[0,1152]],["6_3_49",[0,0]],["6_23_27",[0,0]],["6_43_43",[0,0]],["6_38_56",[0,13358]],["6_3_50",[0,0]],["6_55_4",[0,0]],["6_43_44",[0,0]],["6_63_41",[0,0]],["6_47_52",[85,7548]],["6_30_56",[1526,12067]],["6_6_57",[-25,1790]],["6_38_57",[0,1548]],["6_10_61",[0,0]],["6_23_28",[0,0]],["6_59_5",[0,0]],["6_27_2",[0,0]],["6_14_57",[466,12322]],["6_3_51",[0,0]],["6_51_52",[2675,17037]],["6_30_57",[1201,6817]],["6_63_42",[0,0]],["6_55_5",[0,0]],["6_23_29",[0,0]],["6_59_6",[0,0]],["6_43_45",[0,0]],["6_47_53",[770,13586]],["6_63_43",[0,0]],["6_51_53",[234,13353]],["6_10_62",[0,0]],["6_19_58",[-120,10419]],["6_38_58",[0,0]],["6_23_30",[0,0]],["6_19_59",[-274,733]],["6_27_3",[0,1436]],["6_43_46",[0,0]],["6_30_58",[1631,11977]],["6_59_7",[0,0]],["6_55_6",[0,0]],["6_14_58",[37,12085]],["6_63_44",[0,0]],["6_51_54",[355,12003]],["6_3_52",[0,0]],["6_47_54",[0,13602]],["6_10_63",[0,0]],["6_38_59",[0,0]],["6_27_4",[0,1173]],["6_6_58",[-36,10976]],["6_23_31",[0,22]],["6_34_59",[1933,6644]],["6_43_47",[0,0]],["6_59_8",[0,0]],["6_63_45",[0,0]],["6_3_53",[0,0]],["6_34_60",[0,7565]],["6_51_55",[475,5029]],["6_55_7",[0,0]],["6_23_32",[0,319]],["6_27_5",[0,1143]],["6_43_48",[0,1831]],["6_59_9",[0,0]],["6_23_33",[105,853]],["6_38_60",[0,0]],["6_47_55",[0,12290]],["6_59_10",[0,0]],["6_3_54",[0,684]],["6_19_60",[-202,879]],["6_11_0",[0,0]],["6_59_11",[0,0]],["6_27_6",[0,1344]],["6_55_8",[0,0]],["6_23_34",[186,1617]],["6_6_59",[-422,910]],["6_63_46",[0,0]],["6_34_61",[0,0]],["6_19_61",[0,0]],["6_47_56",[0,11528]],["6_38_61",[0,0]],["6_63_47",[0,0]],["6_51_56",[263,5882]],["6_55_9",[0,0]],["6_19_62",[0,0]],["6_63_48",[0,0]],["6_14_59",[-725,2498]],["6_27_7",[0,1545]],["6_43_49",[22,3508]],["6_59_12",[0,0]],["6_3_55",[0,1266]],["6_23_35",[342,1536]],["6_59_13",[0,36]],["6_34_62",[0,0]],["6_47_57",[97,8174]],["6_11_1",[0,0]],["6_23_36",[0,2119]],["6_30_59",[1340,7406]],["6_6_60",[-198,1377]],["6_38_62",[0,0]],["6_55_10",[0,0]],["6_51_57",[12,12216]],["6_63_49",[0,0]],["6_19_63",[0,0]],["6_23_37",[0,1709]],["6_59_14",[0,583]],["6_3_56",[-37,1193]],["6_23_38",[0,0]],["6_6_61",[0,0]],["6_27_8",[398,3479]],["6_34_63",[0,0]],["6_23_39",[0,0]],["6_59_15",[0,800]],["6_51_58",[1304,13312]],["6_43_50",[13,3520]],["6_14_60",[0,2145]],["6_55_11",[0,0]],["6_3_57",[0,0]],["6_38_63",[0,0]],["6_63_50",[0,0]],["6_27_9",[12,2958]],["6_11_2",[0,0]],["6_51_59",[379,4373]],["6_55_12",[0,27]],["6_23_40",[0,0]],["6_27_10",[0,3619]],["6_35_0",[0,0]],["6_47_58",[2715,14333]],["6_30_60",[0,7523]],["6_39_0",[0,0]],["6_43_51",[141,3136]],["6_6_62",[0,0]],["6_11_3",[0,0]],["6_55_13",[0,753]],["6_63_51",[0,0]],["6_55_14",[12,1387]],["6_14_61",[0,0]],["6_23_41",[0,0]],["6_39_1",[0,0]],["6_43_52",[898,2861]],["6_55_15",[40,1848]],["6_3_58",[0,0]],["6_27_11",[0,4251]],["6_35_1",[0,0]],["6_63_52",[0,0]],["6_47_59",[0,7817]],["6_30_61",[0,0]],["6_6_63",[0,0]],["6_11_4",[0,0]],["6_55_16",[187,2056]],["6_35_2",[0,0]],["6_14_62",[0,0]],["6_59_16",[10,1305]],["6_27_12",[-12,2428]],["6_3_59",[0,0]],["6_39_2",[0,0]],["6_43_53",[201,7476]],["6_59_17",[0,1773]],["6_23_42",[0,0]],["6_47_60",[0,5751]],["6_14_63",[0,0]],["6_3_60",[0,0]],["6_35_3",[0,0]],["6_15_0",[0,0]],["6_47_61",[0,0]],["6_55_17",[52,2043]],["6_59_18",[0,1859]],["6_23_43",[0,0]],["6_7_0",[0,0]],["6_15_1",[0,0]],["6_30_62",[0,0]],["6_63_53",[0,0]],["6_39_3",[0,0]],["6_51_60",[0,5867]],["6_59_19",[0,1101]],["6_55_18",[84,786]],["6_27_13",[-10,2725]],["6_43_54",[0,7448]],["6_59_20",[0,2231]],["6_47_62",[0,0]],["6_7_1",[0,0]],["6_51_61",[0,0]],["6_23_44",[0,0]],["6_3_61",[0,0]],["6_27_14",[0,2839]],["6_35_4",[0,0]],["6_51_62",[0,0]],["6_59_21",[0,2183]],["6_63_54",[0,0]],["6_15_2",[0,0]],["6_27_15",[0,1356]],["6_11_5",[0,0]],["6_7_2",[0,0]],["6_23_45",[0,1188]],["6_43_55",[0,34]],["6_55_19",[182,2241]],["6_30_63",[0,0]],["6_59_22",[0,1264]],["6_39_4",[0,0]],["6_3_62",[0,0]],["6_47_63",[0,0]],["6_27_16",[0,1332]],["6_15_3",[0,0]],["6_51_63",[0,0]],["6_55_20",[18,2175]],["6_11_6",[0,0]],["6_39_5",[0,0]],["6_3_63",[0,0]],["6_59_23",[0,0]],["6_63_55",[0,0]],["6_23_46",[0,0]],["6_59_24",[0,0]],["6_55_21",[38,2094]],["6_7_3",[0,0]],["6_27_17",[0,37]],["6_31_0",[0,0]],["6_11_7",[0,0]],["6_27_18",[0,0]],["6_43_56",[0,7699]],["6_55_22",[8,1346]],["6_39_6",[0,0]],["6_23_47",[0,0]],["6_55_23",[0,1685]],["6_15_4",[0,0]],["6_35_5",[0,0]],["6_63_56",[0,0]],["6_59_25",[0,0]],["6_7_4",[0,0]],["6_15_5",[0,922]],["6_55_24",[0,848]],["6_63_57",[0,0]],["6_59_26",[0,0]],["6_27_19",[0,0]],["6_43_57",[1763,13666]],["6_27_20",[0,0]],["6_55_25",[0,1779]],["6_31_1",[0,0]],["6_27_21",[0,0]],["6_11_8",[0,10]],["6_7_5",[0,0]],["6_55_26",[0,1741]],["6_35_6",[0,730]],["6_59_27",[0,0]],["6_59_28",[0,0]],["6_15_6",[0,1545]],["6_7_6",[0,0]],["6_27_22",[0,0]],["6_59_29",[0,0]],["6_63_58",[0,0]],["6_31_2",[0,0]],["6_39_7",[0,0]],["6_23_48",[0,0]],["6_55_27",[0,0]],["6_11_9",[0,87]],["6_55_28",[0,0]],["6_27_23",[0,0]],["6_63_59",[0,0]],["6_35_7",[0,1401]],["6_15_7",[0,2035]],["6_39_8",[0,0]],["6_59_30",[0,0]],["6_23_49",[0,0]],["6_11_10",[0,694]],["6_43_58",[263,8731]],["6_31_3",[0,0]],["6_63_60",[0,0]],["6_39_9",[0,0]],["6_55_29",[0,0]],["6_35_8",[0,1676]],["6_39_10",[0,0]],["6_27_24",[0,964]],["6_27_25",[0,0]],["6_59_31",[0,0]],["6_39_11",[0,0]],["6_55_30",[0,0]],["6_23_50",[0,0]],["6_35_9",[0,1134]],["6_15_8",[0,1771]],["6_63_61",[0,0]],["6_27_26",[0,0]],["6_39_12",[0,0]],["6_35_10",[0,569]],["6_63_62",[0,0]],["6_15_9",[0,270]],["6_55_31",[0,0]],["6_27_27",[0,0]],["6_11_11",[0,767]],["6_31_4",[0,0]],["6_23_51",[0,0]],["6_59_32",[0,2131]],["6_7_7",[0,0]],["6_35_11",[0,18]],["6_35_12",[0,0]],["6_39_13",[0,0]],["6_15_10",[0,660]],["6_11_12",[0,388]],["6_31_5",[0,0]],["6_63_63",[0,0]],["6_59_33",[0,2603]],["6_15_11",[0,376]],["6_7_8",[0,0]],["6_11_13",[0,655]],["6_35_13",[0,217]],["6_27_28",[0,1821]],["6_23_52",[0,0]],["6_55_32",[0,2737]],["6_39_14",[0,0]],["6_43_59",[0,8511]],["6_35_14",[0,1798]],["6_31_6",[0,0]],["6_11_14",[0,449]],["6_39_15",[0,458]],["6_23_53",[0,0]],["6_15_12",[0,484]],["6_11_15",[0,736]],["6_35_15",[0,1989]],["6_15_13",[0,599]],["6_11_16",[154,521]],["6_39_16",[0,191]],["6_23_54",[-20,2934]],["6_15_14",[0,569]],["6_27_29",[0,2579]],["6_55_33",[0,765]],["6_43_60",[0,5648]],["6_7_9",[0,0]],["6_39_17",[9,228]],["6_35_16",[0,1070]],["6_15_15",[0,480]],["6_31_7",[0,0]],["6_59_34",[0,616]],["6_11_17",[149,696]],["6_23_55",[-295,4024]],["6_7_10",[0,0]],["6_43_61",[0,0]],["6_39_18",[33,246]],["6_15_16",[0,609]],["6_27_30",[0,0]],["6_15_17",[0,315]],["6_11_18",[147,963]],["6_35_17",[0,484]],["6_55_34",[0,459]],["6_11_19",[207,983]],["6_59_35",[0,0]],["6_15_18",[0,123]],["6_7_11",[0,0]],["6_39_19",[64,253]],["6_11_20",[430,3132]],["6_43_62",[0,0]],["6_31_8",[0,0]],["6_35_18",[0,99]],["6_23_56",[-71,10782]],["6_15_19",[0,215]],["6_39_20",[70,259]],["6_27_31",[0,0]],["6_59_36",[0,789]],["6_31_9",[0,0]],["6_35_19",[0,178]],["6_59_37",[0,1515]],["6_39_21",[19,234]],["6_39_22",[-6,586]],["6_15_20",[90,380]],["6_31_10",[0,0]],["6_27_32",[0,0]],["6_35_20",[0,218]],["6_7_12",[0,0]],["6_31_11",[0,0]],["6_35_21",[14,2389]],["6_59_38",[0,585]],["6_11_21",[409,3433]],["6_23_57",[-25,2076]],["6_43_63",[0,0]],["6_35_22",[45,1857]],["6_39_23",[0,5463]],["6_7_13",[0,0]],["6_31_12",[0,0]],["6_15_21",[285,519]],["6_11_22",[195,3179]],["6_27_33",[0,0]],["6_35_23",[0,2560]],["6_15_22",[179,553]],["6_23_58",[0,106]],["6_15_23",[179,491]],["6_35_24",[0,2708]],["6_11_23",[561,3577]],["6_27_34",[0,0]],["6_31_13",[0,0]],["6_23_59",[0,1131]],["6_15_24",[88,523]],["6_39_24",[0,4998]],["6_59_39",[0,0]],["6_7_14",[0,1516]],["6_11_24",[-60,3723]],["6_27_35",[0,0]],["6_55_35",[135,1012]],["6_31_14",[0,0]],["6_15_25",[16,798]],["6_39_25",[10,3263]],["6_31_15",[0,0]],["6_23_60",[0,1447]],["6_35_25",[0,1013]],["6_27_36",[0,0]],["6_15_26",[0,162]],["6_31_16",[0,0]],["6_11_25",[-95,3483]],["6_35_26",[-13,1002]],["6_35_27",[143,2145]],["6_59_40",[0,0]],["6_11_26",[0,2823]],["6_15_27",[0,0]],["6_39_26",[10,1389]],["6_23_61",[0,0]],["6_35_28",[160,3329]],["6_55_36",[167,1344]],["6_7_15",[2,1607]],["6_27_37",[0,0]],["6_11_27",[0,1492]],["6_39_27",[81,1966]],["6_31_17",[0,0]],["6_7_16",[167,2140]],["6_35_29",[192,1311]],["6_39_28",[0,2940]],["6_15_28",[0,2746]],["6_59_41",[0,0]],["6_35_30",[328,913]],["6_31_18",[0,1192]],["6_27_38",[0,0]],["6_55_37",[0,640]],["6_7_17",[295,2137]],["6_35_31",[306,697]],["6_23_62",[0,0]],["6_39_29",[-153,3747]],["6_11_28",[0,0]],["6_59_42",[0,0]],["6_23_63",[0,0]],["6_11_29",[0,0]],["6_35_32",[291,854]],["6_27_39",[0,0]],["6_7_18",[-1,5822]],["6_55_38",[0,150]],["6_15_29",[0,3926]],["6_39_30",[0,4285]],["6_31_19",[0,1237]],["6_59_43",[0,0]],["6_7_19",[0,3675]],["6_31_20",[0,979]],["6_55_39",[0,0]],["6_39_31",[0,1636]],["6_15_30",[0,0]],["6_27_40",[0,0]],["6_11_30",[0,0]],["6_35_33",[428,1669]],["6_31_21",[0,783]],["6_7_20",[0,0]],["6_59_44",[0,0]],["6_55_40",[0,0]],["6_39_32",[0,485]],["6_7_21",[0,0]],["6_15_31",[0,1604]],["6_27_41",[0,0]],["6_11_31",[0,0]],["6_31_22",[0,408]],["6_7_22",[0,0]],["6_35_34",[1021,1799]],["6_31_23",[0,3022]],["6_59_45",[0,0]],["6_55_41",[0,0]],["6_39_33",[0,628]],["6_7_23",[0,0]],["6_15_32",[0,1607]],["6_11_32",[0,0]],["6_27_42",[0,0]],["6_59_46",[0,0]],["6_39_34",[0,2282]],["6_15_33",[0,0]],["6_7_24",[0,0]],["6_11_33",[0,0]],["6_55_42",[0,0]],["6_31_24",[0,3333]],["6_35_35",[930,1977]],["6_27_43",[0,0]],["6_7_25",[0,0]],["6_59_47",[0,0]],["6_39_35",[0,838]],["6_7_26",[0,0]],["6_35_36",[661,2351]],["6_27_44",[0,1163]],["6_35_37",[0,2034]],["6_15_34",[0,0]],["6_11_34",[0,0]],["6_55_43",[0,0]],["6_7_27",[0,0]],["6_59_48",[0,1578]],["6_39_36",[0,1310]],["6_27_45",[0,969]],["6_7_28",[0,0]],["6_11_35",[0,0]],["6_35_38",[0,2115]],["6_39_37",[0,0]],["6_15_35",[0,0]],["6_55_44",[0,0]],["6_7_29",[0,0]],["6_31_25",[0,3597]],["6_27_46",[0,0]],["6_59_49",[0,3962]],["6_55_45",[0,0]],["6_35_39",[0,0]],["6_7_30",[0,0]],["6_15_36",[0,0]],["6_11_36",[0,0]],["6_27_47",[0,0]],["6_31_26",[171,3035]],["6_39_38",[0,0]],["6_15_37",[0,0]],["6_27_48",[0,0]],["6_59_50",[22,3413]],["6_35_40",[0,0]],["6_39_39",[0,0]],["6_11_37",[0,0]],["6_7_31",[0,0]],["6_55_46",[0,0]],["6_27_49",[0,0]],["6_31_27",[170,527]],["6_15_38",[0,0]],["6_59_51",[1454,3889]],["6_11_38",[0,0]],["6_39_40",[0,0]],["6_35_41",[0,0]],["6_55_47",[0,1262]],["6_7_32",[0,0]],["6_27_50",[0,0]],["6_31_28",[250,419]],["6_15_39",[0,0]],["6_59_52",[1553,3702]],["6_11_39",[0,0]],["6_39_41",[0,0]],["6_35_42",[0,0]],["6_27_51",[0,0]],["6_7_33",[0,1065]],["6_55_48",[0,2729]],["6_15_40",[0,0]],["6_59_53",[1668,2430]],["6_11_40",[0,0]],["6_27_52",[0,0]],["6_31_29",[223,956]],["6_39_42",[0,0]],["6_35_43",[0,0]],["6_7_34",[0,0]],["6_27_53",[0,10906]],["6_55_49",[403,3483]],["6_15_41",[0,0]],["6_31_30",[3,806]],["6_11_41",[0,0]],["6_55_50",[716,3188]],["6_59_54",[1098,4690]],["6_7_35",[0,0]],["6_35_44",[0,0]],["6_59_55",[1418,3708]],["6_39_43",[0,0]],["6_15_42",[0,0]],["6_27_54",[-126,11661]],["6_11_42",[0,0]],["6_31_31",[0,167]],["6_7_36",[0,0]],["6_15_43",[0,0]],["6_35_45",[0,0]],["6_11_43",[0,0]],["6_59_56",[669,2790]],["6_7_37",[0,0]],["6_27_55",[-54,3561]],["6_55_51",[607,12800]],["6_31_32",[0,0]],["6_39_44",[0,0]],["6_35_46",[0,0]],["6_15_44",[0,0]],["6_59_57",[289,3456]],["6_11_44",[0,0]],["6_31_33",[0,0]],["6_27_56",[207,2784]],["6_39_45",[0,0]],["6_35_47",[0,0]],["6_7_38",[0,0]],["6_11_45",[0,0]],["6_15_45",[0,0]],["6_31_34",[0,0]],["6_55_52",[485,12990]],["6_27_57",[321,1963]],["6_39_46",[0,0]],["6_7_39",[0,0]],["6_59_58",[1084,10297]],["6_35_48",[0,0]],["6_39_47",[0,0]],["6_31_35",[0,0]],["6_59_59",[1111,2635]],["6_11_46",[0,0]],["6_55_53",[723,4738]],["6_15_46",[0,0]],["6_7_40",[0,0]],["6_27_58",[-393,11344]],["6_31_36",[0,0]],["6_35_49",[0,2296]],["6_59_60",[0,2547]],["6_39_48",[0,1504]],["6_7_41",[0,0]],["6_15_47",[0,0]],["6_11_47",[0,0]],["6_31_37",[0,0]],["6_35_50",[0,3202]],["6_27_59",[-19,1979]],["6_55_54",[2492,3436]],["6_15_48",[0,0]],["6_39_49",[0,2325]],["6_7_42",[0,0]],["6_59_61",[0,0]],["6_11_48",[0,0]],["6_27_60",[0,1935]],["6_55_55",[2607,2922]],["6_35_51",[1901,13322]],["6_31_38",[0,0]],["6_7_43",[0,0]],["6_15_49",[0,6509]],["6_11_49",[0,0]],["6_27_61",[0,0]],["6_59_62",[0,0]],["6_39_50",[1282,2834]],["6_15_50",[0,760]],["6_31_39",[0,0]],["6_7_44",[0,0]],["6_11_50",[0,0]],["6_27_62",[0,0]],["6_55_56",[2544,2834]],["6_39_51",[1263,3332]],["6_7_45",[0,0]],["6_59_63",[0,0]],["6_31_40",[0,0]],["6_27_63",[0,0]],["6_15_51",[0,3905]],["6_35_52",[201,13482]],["6_55_57",[2518,2803]],["6_7_46",[0,0]],["6_39_52",[413,13580]],["6_11_51",[0,863]],["6_31_41",[0,0]],["6_55_58",[2516,2775]],["6_7_47",[0,0]],["6_11_52",[-71,2156]],["6_39_53",[870,13685]],["6_31_42",[0,0]],["6_7_48",[0,0]],["6_15_52",[-194,10602]],["6_35_53",[813,7434]],["6_55_59",[1695,2902]],["6_35_54",[0,13743]],["6_31_43",[0,0]],["6_39_54",[979,7078]],["6_7_49",[0,0]],["6_11_53",[117,4727]],["6_15_53",[-65,3220]],["6_31_44",[0,0]],["6_35_55",[0,10180]],["6_7_50",[0,0]],["6_11_54",[191,12240]],["6_55_60",[0,2831]],["6_7_51",[0,0]],["6_31_45",[0,0]],["6_39_55",[0,12725]],["6_15_54",[204,11480]],["6_35_56",[1224,4276]],["6_55_61",[0,0]],["6_7_52",[0,1856]],["6_55_62",[0,0]],["6_15_55",[88,11909]],["6_35_57",[1806,3426]],["6_31_46",[0,0]],["6_35_58",[555,12233]],["6_11_55",[-195,12083]],["6_39_56",[0,8159]],["6_55_63",[0,0]],["6_7_53",[-45,3407]],["6_31_47",[0,0]],["6_11_56",[-312,11807]],["6_15_56",[15,12190]],["6_35_59",[0,5831]],["6_7_54",[11,11627]],["6_39_57",[0,6919]],["6_31_48",[0,0]],["6_7_55",[30,10735]],["6_11_57",[155,2514]],["6_15_57",[426,12217]],["6_39_58",[0,0]],["6_11_58",[-154,1914]],["6_35_60",[0,5623]],["6_31_49",[0,0]],["6_7_56",[38,1485]],["6_35_61",[0,0]],["6_15_58",[-84,12061]],["6_39_59",[0,0]],["6_7_57",[13,1390]],["6_35_62",[0,0]],["6_11_59",[-103,1932]],["6_31_50",[-3,1729]],["6_39_60",[0,0]],["6_31_51",[904,12745]],["6_35_63",[0,0]],["6_39_61",[0,0]],["6_11_60",[0,1506]],["6_39_62",[0,0]],["6_7_58",[-129,10798]],["6_15_59",[-976,2797]],["6_31_52",[755,13200]],["6_11_61",[0,0]],["6_39_63",[0,0]],["6_7_59",[-337,1240]],["6_15_60",[-115,2281]],["6_11_62",[0,0]],["6_31_53",[535,13165]],["6_7_60",[-266,1519]],["6_15_61",[0,0]],["6_7_61",[0,0]],["6_15_62",[0,0]],["6_11_63",[0,0]],["6_7_62",[0,0]],["6_31_54",[1079,12383]],["6_15_63",[0,0]],["6_7_63",[0,0]],["6_31_55",[1593,12298]],["6_31_56",[1599,7064]],["6_31_57",[1965,12295]],["6_31_58",[1660,12180]],["6_31_59",[1121,8140]],["6_31_60",[0,7279]],["6_31_61",[0,0]],["6_31_62",[0,0]],["6_31_63",[0,0]]]);var c_={"EPSG:4326":new Map([["0_0_0",[1,1]],["1_1_0",[1,1]],["1_0_0",[1,1]],["2_0_1",[1,1]],["2_0_0",[1,1]],["2_3_1",[1,1]],["2_1_1",[1,1]],["2_1_0",[1,1]],["2_3_0",[1,1]],["2_2_1",[1,1]],["2_2_0",[1,1]],["3_0_2",[0,0]],["3_3_2",[0,0]],["3_1_2",[0,0]],["3_0_0",[0,0]],["3_2_0",[0,0]],["3_1_0",[0,0]],["3_2_2",[0,0]],["3_7_2",[0,0]],["3_7_0",[0,409]],["3_3_0",[0,0]],["3_5_2",[0,0]],["3_4_0",[0,0]],["3_6_2",[0,0]],["3_5_0",[0,3632]],["3_4_2",[0,0]],["3_6_0",[0,3407]],["3_0_3",[0,0]],["3_0_1",[0,0]],["3_1_3",[0,0]],["3_1_1",[0,0]],["3_2_1",[0,0]],["3_3_3",[0,0]],["3_3_1",[0,0]],["3_2_3",[0,0]],["3_7_1",[0,0]],["3_5_3",[0,0]],["3_4_1",[0,0]],["3_7_3",[0,0]],["3_6_3",[0,0]],["3_4_3",[0,0]],["3_5_1",[-195,6359]],["3_6_1",[-21,6241]],["4_12_0",[0,0]],["4_4_0",[0,0]],["4_7_0",[0,0]],["4_0_0",[0,0]],["4_1_0",[0,0]],["4_3_0",[0,0]],["4_8_0",[0,0]],["4_5_0",[0,0]],["4_9_0",[0,0]],["4_11_0",[0,0]],["4_2_0",[0,0]],["4_10_0",[0,0]],["4_13_0",[0,0]],["4_14_0",[0,0]],["4_6_0",[0,0]],["4_15_0",[0,0]],["4_0_1",[0,0]],["4_4_1",[0,0]],["4_5_1",[0,0]],["4_7_1",[0,0]],["4_1_1",[0,0]],["4_3_1",[0,0]],["4_2_1",[0,0]],["4_8_1",[0,0]],["4_10_1",[0,0]],["4_12_1",[0,3587]],["4_9_1",[0,0]],["4_6_1",[0,0]],["4_13_1",[0,1540]],["4_14_1",[0,574]],["4_15_1",[0,0]],["4_11_1",[0,3785]],["4_0_2",[0,0]],["4_1_2",[0,0]],["4_4_2",[0,0]],["4_5_2",[0,0]],["4_7_2",[0,0]],["4_3_2",[0,0]],["4_2_2",[0,0]],["4_10_2",[0,0]],["4_6_2",[0,0]],["4_8_2",[0,0]],["4_9_2",[0,0]],["4_14_2",[0,0]],["4_15_2",[0,0]],["4_0_3",[0,0]],["4_1_3",[0,0]],["4_7_3",[0,0]],["4_4_3",[0,0]],["4_5_3",[0,0]],["4_3_3",[0,0]],["4_2_3",[0,0]],["4_10_3",[0,0]],["4_8_3",[0,0]],["4_13_2",[-6,3295]],["4_9_3",[0,0]],["4_6_3",[0,0]],["4_15_3",[0,0]],["4_0_4",[0,0]],["4_14_3",[0,0]],["4_7_4",[0,0]],["4_4_4",[0,0]],["4_1_4",[0,0]],["4_5_4",[0,0]],["4_3_4",[0,0]],["4_2_4",[0,0]],["4_10_4",[0,0]],["4_13_3",[-6,1245]],["4_8_4",[0,0]],["4_9_4",[0,0]],["4_15_4",[0,0]],["4_0_5",[0,0]],["4_7_5",[0,0]],["4_14_4",[0,0]],["4_1_5",[0,0]],["4_4_5",[0,0]],["4_5_5",[0,0]],["4_6_4",[0,0]],["4_3_5",[0,0]],["4_2_5",[0,0]],["4_10_5",[0,0]],["4_8_5",[0,0]],["4_13_4",[0,0]],["4_11_2",[-204,7221]],["4_0_6",[0,0]],["4_9_5",[0,0]],["4_15_5",[0,0]],["4_7_6",[0,0]],["4_1_6",[0,0]],["4_4_6",[0,0]],["4_14_5",[0,0]],["4_5_6",[0,0]],["4_3_6",[0,0]],["4_2_6",[0,0]],["4_10_6",[0,0]],["4_6_5",[0,0]],["4_13_5",[0,0]],["4_8_6",[0,0]],["4_0_7",[0,0]],["4_11_3",[0,0]],["4_7_7",[0,0]],["4_1_7",[0,0]],["4_3_7",[0,0]],["4_15_6",[0,0]],["4_9_6",[0,0]],["4_14_6",[0,0]],["4_4_7",[0,0]],["4_5_7",[0,0]],["4_2_7",[0,0]],["4_10_7",[0,0]],["4_6_6",[0,0]],["4_8_7",[0,0]],["4_13_6",[0,0]],["4_12_2",[0,6582]],["4_11_4",[0,0]],["4_14_7",[0,0]],["4_15_7",[0,0]],["4_9_7",[0,0]],["4_6_7",[0,0]],["4_13_7",[0,0]],["4_11_5",[0,0]],["4_12_3",[-21,2402]],["4_11_6",[0,0]],["4_12_4",[0,0]],["4_11_7",[0,0]],["4_12_5",[0,0]],["4_12_6",[0,0]],["4_12_7",[0,0]],["5_22_0",[0,0]],["5_14_0",[0,0]],["5_8_0",[0,0]],["5_6_0",[0,0]],["5_2_0",[0,0]],["5_0_0",[0,0]],["5_16_0",[0,0]],["5_20_0",[0,0]],["5_4_0",[0,0]],["5_28_0",[0,0]],["5_10_0",[0,0]],["5_30_0",[0,0]],["5_18_0",[0,0]],["5_26_0",[0,0]],["5_12_0",[0,0]],["5_24_0",[0,0]],["5_22_1",[0,0]],["5_14_1",[0,0]],["5_8_1",[0,0]],["5_2_1",[0,0]],["5_6_1",[0,0]],["5_28_1",[0,0]],["5_20_1",[0,0]],["5_0_1",[0,0]],["5_16_1",[0,0]],["5_4_1",[0,0]],["5_10_1",[0,0]],["5_30_1",[0,0]],["5_18_1",[0,0]],["5_26_1",[0,0]],["5_24_1",[0,0]],["5_12_1",[0,0]],["5_8_2",[0,0]],["5_14_2",[0,0]],["5_2_2",[0,0]],["5_6_2",[0,0]],["5_4_2",[0,0]],["5_20_2",[0,0]],["5_28_2",[0,0]],["5_0_2",[0,0]],["5_22_2",[0,0]],["5_16_2",[0,0]],["5_18_2",[0,0]],["5_30_2",[0,0]],["5_26_2",[0,0]],["5_10_2",[0,0]],["5_24_2",[0,0]],["5_6_3",[0,0]],["5_8_3",[0,0]],["5_14_3",[0,0]],["5_20_3",[0,0]],["5_4_3",[0,0]],["5_2_3",[0,0]],["5_12_2",[0,0]],["5_16_3",[0,0]],["5_0_3",[0,0]],["5_28_3",[0,677]],["5_18_3",[0,0]],["5_30_3",[0,0]],["5_22_3",[0,0]],["5_10_3",[0,0]],["5_24_3",[0,3766]],["5_26_3",[0,1590]],["5_14_4",[0,0]],["5_6_4",[0,0]],["5_8_4",[0,0]],["5_20_4",[0,0]],["5_2_4",[0,0]],["5_4_4",[0,0]],["5_28_4",[0,0]],["5_0_4",[0,0]],["5_18_4",[0,0]],["5_30_4",[0,0]],["5_16_4",[0,0]],["5_12_3",[0,0]],["5_10_4",[0,0]],["5_14_5",[0,0]],["5_8_5",[0,0]],["5_6_5",[0,0]],["5_20_5",[0,0]],["5_0_5",[0,0]],["5_4_5",[0,0]],["5_2_5",[0,0]],["5_16_5",[0,0]],["5_28_5",[0,0]],["5_26_4",[-6,2806]],["5_30_5",[0,0]],["5_18_5",[0,0]],["5_10_5",[0,0]],["5_14_6",[0,0]],["5_12_4",[0,0]],["5_8_6",[0,0]],["5_6_6",[0,0]],["5_24_4",[0,6300]],["5_0_6",[0,0]],["5_2_6",[0,0]],["5_20_6",[0,0]],["5_28_6",[0,0]],["5_16_6",[0,0]],["5_4_6",[0,0]],["5_18_6",[0,0]],["5_30_6",[0,0]],["5_10_6",[0,0]],["5_14_7",[0,0]],["5_22_4",[0,7224]],["5_6_7",[0,0]],["5_0_7",[0,0]],["5_8_7",[0,0]],["5_12_5",[0,0]],["5_2_7",[0,0]],["5_20_7",[0,0]],["5_4_7",[0,0]],["5_16_7",[0,0]],["5_28_7",[0,0]],["5_26_5",[-8,3465]],["5_30_7",[0,0]],["5_14_8",[0,0]],["5_10_7",[0,0]],["5_18_7",[0,0]],["5_0_8",[0,0]],["5_6_8",[0,0]],["5_2_8",[0,0]],["5_8_8",[0,0]],["5_12_6",[0,0]],["5_20_8",[0,0]],["5_4_8",[0,0]],["5_26_6",[-7,1616]],["5_22_5",[0,6245]],["5_16_8",[0,0]],["5_14_9",[0,0]],["5_30_8",[0,0]],["5_28_8",[0,0]],["5_18_8",[0,0]],["5_10_8",[0,0]],["5_0_9",[0,0]],["5_6_9",[0,0]],["5_2_9",[0,0]],["5_8_9",[0,0]],["5_20_9",[0,0]],["5_12_7",[0,0]],["5_4_9",[0,0]],["5_26_7",[0,0]],["5_14_10",[0,0]],["5_16_9",[0,0]],["5_22_6",[0,0]],["5_28_9",[0,0]],["5_30_9",[0,0]],["5_18_9",[0,0]],["5_0_10",[0,0]],["5_10_9",[0,0]],["5_6_10",[0,0]],["5_8_10",[0,0]],["5_4_10",[0,0]],["5_2_10",[0,0]],["5_20_10",[0,0]],["5_26_8",[0,0]],["5_12_8",[0,0]],["5_14_11",[0,0]],["5_16_10",[0,0]],["5_22_7",[0,0]],["5_28_10",[0,0]],["5_30_10",[0,0]],["5_0_11",[0,0]],["5_18_10",[0,0]],["5_10_10",[0,0]],["5_6_11",[0,0]],["5_26_9",[0,0]],["5_14_12",[0,0]],["5_12_9",[0,0]],["5_4_11",[0,0]],["5_20_11",[0,0]],["5_16_11",[0,0]],["5_22_8",[0,0]],["5_8_11",[0,0]],["5_2_11",[0,0]],["5_28_11",[0,0]],["5_0_12",[0,0]],["5_30_11",[0,0]],["5_6_12",[0,0]],["5_18_11",[0,0]],["5_10_11",[0,0]],["5_26_10",[0,0]],["5_14_13",[0,0]],["5_20_12",[0,0]],["5_4_12",[0,0]],["5_2_12",[0,0]],["5_8_12",[0,0]],["5_22_9",[0,0]],["5_16_12",[0,0]],["5_24_5",[0,6908]],["5_6_13",[0,0]],["5_28_12",[0,0]],["5_0_13",[0,0]],["5_30_12",[0,0]],["5_12_10",[0,0]],["5_18_12",[0,0]],["5_10_12",[0,0]],["5_14_14",[0,0]],["5_26_11",[0,0]],["5_4_13",[0,0]],["5_20_13",[0,0]],["5_2_13",[0,0]],["5_6_14",[0,0]],["5_16_13",[0,0]],["5_8_13",[0,0]],["5_28_13",[0,0]],["5_10_13",[0,0]],["5_0_14",[0,0]],["5_22_10",[0,0]],["5_18_13",[0,0]],["5_24_6",[0,2341]],["5_12_11",[0,0]],["5_30_13",[0,0]],["5_26_12",[0,0]],["5_14_15",[0,0]],["5_20_14",[0,0]],["5_4_14",[0,0]],["5_6_15",[0,0]],["5_16_14",[0,0]],["5_2_14",[0,0]],["5_8_14",[0,0]],["5_28_14",[0,0]],["5_10_14",[0,0]],["5_0_15",[0,0]],["5_22_11",[0,0]],["5_18_14",[0,0]],["5_24_7",[0,0]],["5_15_0",[0,0]],["5_30_14",[0,0]],["5_26_13",[0,0]],["5_20_15",[0,0]],["5_12_12",[0,0]],["5_2_15",[0,0]],["5_4_15",[0,0]],["5_7_0",[0,0]],["5_8_15",[0,0]],["5_1_0",[0,0]],["5_10_15",[0,0]],["5_16_15",[0,0]],["5_28_15",[0,0]],["5_18_15",[0,0]],["5_22_12",[0,0]],["5_30_15",[0,0]],["5_24_8",[0,0]],["5_15_1",[0,0]],["5_7_1",[0,0]],["5_26_14",[0,0]],["5_21_0",[0,0]],["5_3_0",[0,0]],["5_5_0",[0,0]],["5_12_13",[0,0]],["5_9_0",[0,0]],["5_1_1",[0,0]],["5_11_0",[0,0]],["5_7_2",[0,0]],["5_17_0",[0,0]],["5_29_0",[0,0]],["5_31_0",[0,0]],["5_19_0",[0,0]],["5_26_15",[0,0]],["5_24_9",[0,0]],["5_22_13",[0,0]],["5_15_2",[0,0]],["5_21_1",[0,0]],["5_3_1",[0,0]],["5_1_2",[0,0]],["5_5_1",[0,0]],["5_9_1",[0,0]],["5_11_1",[0,0]],["5_7_3",[0,0]],["5_12_14",[0,0]],["5_17_1",[0,0]],["5_29_1",[0,0]],["5_19_1",[0,0]],["5_15_3",[0,0]],["5_31_1",[0,0]],["5_27_0",[0,0]],["5_7_4",[0,0]],["5_21_2",[0,0]],["5_24_10",[0,0]],["5_1_3",[0,0]],["5_5_2",[0,0]],["5_22_14",[0,0]],["5_3_2",[0,0]],["5_9_2",[0,0]],["5_11_2",[0,0]],["5_17_2",[0,0]],["5_27_1",[0,0]],["5_12_15",[0,0]],["5_29_2",[0,0]],["5_19_2",[0,0]],["5_15_4",[0,0]],["5_31_2",[0,0]],["5_21_3",[0,0]],["5_7_5",[0,0]],["5_3_3",[0,0]],["5_9_3",[0,0]],["5_11_3",[0,0]],["5_5_3",[0,0]],["5_27_2",[0,0]],["5_24_11",[0,0]],["5_1_4",[0,0]],["5_17_3",[0,0]],["5_21_4",[0,0]],["5_29_3",[0,0]],["5_13_0",[0,0]],["5_7_6",[0,0]],["5_19_3",[0,0]],["5_31_3",[0,0]],["5_3_4",[0,0]],["5_15_5",[0,0]],["5_22_15",[0,0]],["5_5_4",[0,0]],["5_21_5",[0,0]],["5_9_4",[0,0]],["5_11_4",[0,0]],["5_17_4",[0,0]],["5_24_12",[0,0]],["5_1_5",[0,0]],["5_7_7",[0,0]],["5_27_3",[0,1306]],["5_3_5",[0,0]],["5_29_4",[0,0]],["5_13_1",[0,0]],["5_5_5",[0,0]],["5_21_6",[0,0]],["5_11_5",[0,0]],["5_31_4",[0,0]],["5_19_4",[0,0]],["5_17_5",[0,0]],["5_15_6",[0,0]],["5_9_5",[0,0]],["5_7_8",[0,0]],["5_24_13",[0,0]],["5_1_6",[0,0]],["5_3_6",[0,0]],["5_23_0",[0,0]],["5_29_5",[0,0]],["5_13_2",[0,0]],["5_27_4",[-29,2496]],["5_5_6",[0,0]],["5_21_7",[0,0]],["5_7_9",[0,0]],["5_11_6",[0,0]],["5_31_5",[0,0]],["5_19_5",[0,0]],["5_17_6",[0,0]],["5_15_7",[0,0]],["5_9_6",[0,0]],["5_27_5",[0,0]],["5_29_6",[0,0]],["5_21_8",[0,0]],["5_5_7",[0,0]],["5_1_7",[0,0]],["5_24_14",[0,0]],["5_7_10",[0,0]],["5_13_3",[0,0]],["5_3_7",[0,0]],["5_31_6",[0,0]],["5_27_6",[0,0]],["5_21_9",[0,0]],["5_15_8",[0,0]],["5_29_7",[0,0]],["5_5_8",[0,0]],["5_11_7",[0,0]],["5_23_1",[0,0]],["5_17_7",[0,0]],["5_19_6",[0,0]],["5_7_11",[0,0]],["5_9_7",[0,0]],["5_1_8",[0,0]],["5_24_15",[0,0]],["5_13_4",[0,0]],["5_3_8",[0,0]],["5_27_7",[0,0]],["5_31_7",[0,0]],["5_11_8",[0,0]],["5_29_8",[0,0]],["5_15_9",[0,0]],["5_21_10",[0,0]],["5_1_9",[0,0]],["5_17_8",[0,0]],["5_7_12",[0,0]],["5_19_7",[0,0]],["5_5_9",[0,0]],["5_9_8",[0,0]],["5_27_8",[0,0]],["5_23_2",[0,0]],["5_25_0",[0,0]],["5_29_9",[0,0]],["5_11_9",[0,0]],["5_21_11",[0,0]],["5_13_5",[0,0]],["5_31_8",[0,0]],["5_3_9",[0,0]],["5_27_9",[0,0]],["5_15_10",[0,0]],["5_1_10",[0,0]],["5_19_8",[0,0]],["5_5_10",[0,0]],["5_17_9",[0,0]],["5_7_13",[0,0]],["5_9_9",[0,0]],["5_25_1",[0,0]],["5_21_12",[0,0]],["5_29_10",[0,0]],["5_31_9",[0,0]],["5_11_10",[0,0]],["5_13_6",[0,0]],["5_27_10",[0,0]],["5_3_10",[0,0]],["5_19_9",[0,0]],["5_1_11",[0,0]],["5_5_11",[0,0]],["5_9_10",[0,0]],["5_17_10",[0,0]],["5_7_14",[0,0]],["5_15_11",[0,0]],["5_25_2",[0,0]],["5_23_3",[0,4087]],["5_11_11",[0,0]],["5_29_11",[0,0]],["5_19_10",[0,0]],["5_31_10",[0,0]],["5_21_13",[0,0]],["5_13_7",[0,0]],["5_3_11",[0,0]],["5_27_11",[0,0]],["5_17_11",[0,0]],["5_5_12",[0,0]],["5_9_11",[0,0]],["5_1_12",[0,0]],["5_7_15",[0,0]],["5_15_12",[0,0]],["5_25_3",[0,1131]],["5_29_12",[0,0]],["5_19_11",[0,0]],["5_5_13",[0,0]],["5_17_12",[0,0]],["5_15_13",[0,0]],["5_13_8",[0,0]],["5_27_12",[0,0]],["5_9_12",[0,0]],["5_21_14",[0,0]],["5_3_12",[0,0]],["5_31_11",[0,0]],["5_1_13",[0,0]],["5_11_12",[0,0]],["5_29_13",[0,0]],["5_19_12",[0,0]],["5_29_14",[0,0]],["5_5_14",[0,0]],["5_19_13",[0,0]],["5_17_13",[0,0]],["5_25_4",[0,4796]],["5_27_13",[0,0]],["5_9_13",[0,0]],["5_21_15",[0,0]],["5_11_13",[0,0]],["5_15_14",[0,0]],["5_31_12",[0,0]],["5_1_14",[0,0]],["5_13_9",[0,0]],["5_3_13",[0,0]],["5_19_14",[0,0]],["5_17_14",[0,0]],["5_29_15",[0,0]],["5_5_15",[0,0]],["5_11_14",[0,0]],["5_9_14",[0,0]],["5_17_15",[0,0]],["5_27_14",[0,0]],["5_1_15",[0,0]],["5_15_15",[0,0]],["5_13_10",[0,0]],["5_31_13",[0,0]],["5_23_4",[-216,6607]],["5_19_15",[0,0]],["5_3_14",[0,0]],["5_9_15",[0,0]],["5_11_15",[0,0]],["5_31_14",[0,0]],["5_13_11",[0,0]],["5_27_15",[0,0]],["5_3_15",[0,0]],["5_31_15",[0,0]],["5_13_12",[0,0]],["5_25_5",[-2,6318]],["5_13_13",[0,0]],["5_25_6",[-22,2600]],["5_23_5",[0,7724]],["5_25_7",[0,0]],["5_13_14",[0,0]],["5_25_8",[0,0]],["5_23_6",[0,0]],["5_13_15",[0,0]],["5_25_9",[0,0]],["5_23_7",[0,0]],["5_25_10",[0,0]],["5_23_8",[0,0]],["5_25_11",[0,0]],["5_23_9",[0,0]],["5_25_12",[0,0]],["5_23_10",[0,0]],["5_25_13",[0,0]],["5_25_14",[0,0]],["5_23_11",[0,0]],["5_25_15",[0,0]],["5_23_12",[0,0]],["5_23_13",[0,0]],["5_23_14",[0,0]],["5_23_15",[0,0]],["6_44_0",[0,0]],["6_28_0",[0,0]],["6_36_0",[0,0]],["6_4_0",[0,0]],["6_52_0",[0,0]],["6_24_0",[0,0]],["6_12_0",[0,0]],["6_40_0",[0,0]],["6_16_0",[0,0]],["6_0_0",[0,0]],["6_8_0",[0,0]],["6_48_0",[0,0]],["6_60_0",[0,0]],["6_20_0",[0,0]],["6_32_0",[0,0]],["6_56_0",[0,0]],["6_28_1",[0,0]],["6_44_1",[0,0]],["6_36_1",[0,0]],["6_24_1",[0,0]],["6_4_1",[0,0]],["6_52_1",[0,0]],["6_12_1",[0,0]],["6_0_1",[0,0]],["6_16_1",[0,0]],["6_60_1",[0,0]],["6_8_1",[0,0]],["6_48_1",[0,0]],["6_40_1",[0,0]],["6_24_2",[0,0]],["6_36_2",[0,0]],["6_4_2",[0,0]],["6_56_1",[0,0]],["6_20_1",[0,0]],["6_28_2",[0,0]],["6_44_2",[0,0]],["6_32_1",[0,0]],["6_52_2",[0,0]],["6_0_2",[0,0]],["6_16_2",[0,0]],["6_60_2",[0,0]],["6_12_2",[0,0]],["6_40_2",[0,0]],["6_8_2",[0,0]],["6_56_2",[0,0]],["6_48_2",[0,0]],["6_36_3",[0,0]],["6_24_3",[0,0]],["6_20_2",[0,0]],["6_28_3",[0,0]],["6_44_3",[0,0]],["6_32_2",[0,0]],["6_4_3",[0,0]],["6_52_3",[0,0]],["6_0_3",[0,0]],["6_16_3",[0,0]],["6_8_3",[0,0]],["6_12_3",[0,0]],["6_60_3",[0,0]],["6_40_3",[0,0]],["6_56_3",[0,0]],["6_36_4",[0,0]],["6_4_4",[0,0]],["6_48_3",[0,0]],["6_24_4",[0,0]],["6_44_4",[0,0]],["6_20_3",[0,0]],["6_28_4",[0,0]],["6_32_3",[0,0]],["6_52_4",[0,0]],["6_40_4",[0,0]],["6_60_4",[0,0]],["6_0_4",[0,0]],["6_16_4",[0,0]],["6_8_4",[0,0]],["6_12_4",[0,0]],["6_56_4",[0,0]],["6_48_4",[0,0]],["6_36_5",[0,0]],["6_4_5",[0,0]],["6_28_5",[0,0]],["6_24_5",[0,0]],["6_44_5",[0,0]],["6_20_4",[0,0]],["6_52_5",[0,0]],["6_32_4",[0,0]],["6_40_5",[0,0]],["6_60_5",[0,0]],["6_4_6",[0,0]],["6_56_5",[0,0]],["6_16_5",[0,0]],["6_0_5",[0,0]],["6_48_5",[0,0]],["6_12_5",[0,0]],["6_20_5",[0,0]],["6_36_6",[0,0]],["6_44_6",[0,0]],["6_8_5",[0,0]],["6_28_6",[0,0]],["6_24_6",[0,0]],["6_32_5",[0,0]],["6_52_6",[0,0]],["6_60_6",[0,0]],["6_4_7",[0,0]],["6_40_6",[0,0]],["6_56_6",[0,0]],["6_16_6",[0,0]],["6_48_6",[0,0]],["6_12_6",[0,0]],["6_0_6",[0,0]],["6_8_6",[0,0]],["6_20_6",[0,0]],["6_44_7",[0,0]],["6_28_7",[0,0]],["6_36_7",[0,0]],["6_24_7",[0,0]],["6_32_6",[0,0]],["6_52_7",[0,1661]],["6_8_7",[0,0]],["6_16_7",[0,0]],["6_4_8",[0,0]],["6_60_7",[0,0]],["6_12_7",[0,0]],["6_40_7",[0,0]],["6_56_7",[0,762]],["6_20_7",[0,0]],["6_44_8",[0,5632]],["6_28_8",[0,0]],["6_32_7",[0,0]],["6_24_8",[0,0]],["6_0_7",[0,0]],["6_36_8",[0,0]],["6_48_7",[0,3926]],["6_56_8",[0,0]],["6_40_8",[0,0]],["6_4_9",[0,0]],["6_8_8",[0,0]],["6_16_8",[0,0]],["6_60_8",[0,0]],["6_52_8",[-3,2660]],["6_12_8",[0,0]],["6_20_8",[0,0]],["6_28_9",[0,0]],["6_44_9",[0,6885]],["6_32_8",[0,0]],["6_24_9",[0,0]],["6_36_9",[0,0]],["6_0_8",[0,0]],["6_48_8",[0,4567]],["6_4_10",[0,0]],["6_8_9",[0,0]],["6_40_9",[0,0]],["6_56_9",[0,0]],["6_16_9",[0,0]],["6_60_9",[0,0]],["6_28_10",[0,0]],["6_12_9",[0,0]],["6_44_10",[0,0]],["6_20_9",[0,0]],["6_52_9",[-6,2882]],["6_32_9",[0,0]],["6_24_10",[0,0]],["6_4_11",[0,0]],["6_16_10",[0,0]],["6_60_10",[0,0]],["6_40_10",[0,0]],["6_44_11",[0,0]],["6_12_10",[0,0]],["6_20_10",[0,0]],["6_28_11",[0,0]],["6_36_10",[0,0]],["6_8_10",[0,0]],["6_56_10",[0,0]],["6_0_9",[0,0]],["6_32_10",[0,0]],["6_24_11",[0,0]],["6_60_11",[0,0]],["6_16_11",[0,0]],["6_4_12",[0,0]],["6_48_9",[1280,6396]],["6_44_12",[0,0]],["6_40_11",[0,0]],["6_12_11",[0,0]],["6_20_11",[0,0]],["6_36_11",[0,0]],["6_28_12",[0,0]],["6_56_11",[0,0]],["6_8_11",[0,0]],["6_52_10",[1,1587]],["6_0_10",[0,0]],["6_12_12",[0,0]],["6_44_13",[0,0]],["6_4_13",[0,0]],["6_40_12",[0,0]],["6_36_12",[0,0]],["6_32_11",[0,0]],["6_24_12",[0,0]],["6_16_12",[0,0]],["6_60_12",[0,0]],["6_20_12",[0,0]],["6_56_12",[0,0]],["6_28_13",[0,0]],["6_8_12",[0,0]],["6_0_11",[0,0]],["6_44_14",[0,0]],["6_20_13",[0,0]],["6_40_13",[0,0]],["6_60_13",[0,0]],["6_12_13",[0,0]],["6_24_13",[0,0]],["6_4_14",[0,0]],["6_36_13",[0,0]],["6_16_13",[0,0]],["6_32_12",[0,0]],["6_28_14",[0,0]],["6_8_13",[0,0]],["6_56_13",[0,0]],["6_0_12",[0,0]],["6_40_14",[0,0]],["6_4_15",[0,0]],["6_24_14",[0,0]],["6_36_14",[0,0]],["6_12_14",[0,0]],["6_32_13",[0,0]],["6_44_15",[0,0]],["6_20_14",[0,0]],["6_60_14",[0,0]],["6_16_14",[0,0]],["6_52_11",[-12,2016]],["6_4_16",[0,0]],["6_8_14",[0,0]],["6_56_14",[0,0]],["6_28_15",[0,0]],["6_0_13",[0,0]],["6_40_15",[0,0]],["6_20_15",[0,0]],["6_60_15",[0,0]],["6_12_15",[0,0]],["6_24_15",[0,0]],["6_36_15",[0,0]],["6_32_14",[0,0]],["6_44_16",[0,0]],["6_16_15",[0,0]],["6_52_12",[-7,726]],["6_56_15",[0,0]],["6_4_17",[0,0]],["6_8_15",[0,0]],["6_28_16",[0,0]],["6_12_16",[0,0]],["6_24_16",[0,0]],["6_0_14",[0,0]],["6_32_15",[0,0]],["6_60_16",[0,0]],["6_40_16",[0,0]],["6_20_16",[0,0]],["6_36_16",[0,0]],["6_44_17",[0,0]],["6_16_16",[0,0]],["6_28_17",[0,0]],["6_8_16",[0,0]],["6_4_18",[0,0]],["6_56_16",[0,0]],["6_52_13",[0,0]],["6_0_15",[0,0]],["6_12_17",[0,0]],["6_24_17",[0,0]],["6_20_17",[0,0]],["6_32_16",[0,0]],["6_60_17",[0,0]],["6_40_17",[0,0]],["6_16_17",[0,0]],["6_56_17",[0,0]],["6_44_18",[0,0]],["6_36_17",[0,0]],["6_8_17",[0,0]],["6_28_18",[0,0]],["6_52_14",[0,0]],["6_4_19",[0,0]],["6_0_16",[0,0]],["6_12_18",[0,0]],["6_32_17",[0,0]],["6_40_18",[0,0]],["6_60_18",[0,0]],["6_24_18",[0,0]],["6_20_18",[0,0]],["6_48_10",[138,6949]],["6_16_18",[0,0]],["6_44_19",[0,0]],["6_56_18",[0,0]],["6_8_18",[0,0]],["6_28_19",[0,0]],["6_36_18",[0,0]],["6_52_15",[0,0]],["6_12_19",[0,0]],["6_0_17",[0,0]],["6_32_18",[0,0]],["6_40_19",[0,0]],["6_4_20",[0,0]],["6_60_19",[0,0]],["6_24_19",[0,0]],["6_20_19",[0,0]],["6_16_19",[0,0]],["6_44_20",[0,0]],["6_8_19",[0,0]],["6_28_20",[0,0]],["6_56_19",[0,0]],["6_32_19",[0,0]],["6_52_16",[0,0]],["6_12_20",[0,0]],["6_36_19",[0,0]],["6_60_20",[0,0]],["6_0_18",[0,0]],["6_4_21",[0,0]],["6_40_20",[0,0]],["6_24_20",[0,0]],["6_20_20",[0,0]],["6_56_20",[0,0]],["6_16_20",[0,0]],["6_8_20",[0,0]],["6_44_21",[0,0]],["6_48_11",[0,7230]],["6_0_19",[0,0]],["6_36_20",[0,0]],["6_4_22",[0,0]],["6_24_21",[0,0]],["6_52_17",[0,0]],["6_12_21",[0,0]],["6_28_21",[0,0]],["6_32_20",[0,0]],["6_60_21",[0,0]],["6_40_21",[0,0]],["6_20_21",[0,0]],["6_44_22",[0,0]],["6_48_12",[0,0]],["6_56_21",[0,0]],["6_16_21",[0,0]],["6_0_20",[0,0]],["6_8_21",[0,0]],["6_24_22",[0,0]],["6_28_22",[0,0]],["6_36_21",[0,0]],["6_12_22",[0,0]],["6_20_22",[0,0]],["6_4_23",[0,0]],["6_52_18",[0,0]],["6_40_22",[0,0]],["6_60_22",[0,0]],["6_32_21",[0,0]],["6_48_13",[0,0]],["6_44_23",[0,0]],["6_8_22",[0,0]],["6_56_22",[0,0]],["6_16_22",[0,0]],["6_24_23",[0,0]],["6_0_21",[0,0]],["6_28_23",[0,0]],["6_52_19",[0,0]],["6_20_23",[0,0]],["6_12_23",[0,0]],["6_36_22",[0,0]],["6_4_24",[0,0]],["6_40_23",[0,0]],["6_60_23",[0,0]],["6_32_22",[0,0]],["6_48_14",[0,0]],["6_44_24",[0,0]],["6_8_23",[0,0]],["6_20_24",[0,0]],["6_12_24",[0,0]],["6_36_23",[0,0]],["6_52_20",[0,0]],["6_4_25",[0,0]],["6_40_24",[0,0]],["6_32_23",[0,0]],["6_56_23",[0,0]],["6_16_23",[0,0]],["6_0_22",[0,0]],["6_24_24",[0,0]],["6_28_24",[0,0]],["6_60_24",[0,0]],["6_52_21",[0,0]],["6_36_24",[0,0]],["6_32_24",[0,0]],["6_4_26",[0,0]],["6_16_24",[0,0]],["6_0_23",[0,0]],["6_56_24",[0,0]],["6_40_25",[0,0]],["6_44_25",[0,0]],["6_48_15",[0,0]],["6_20_25",[0,0]],["6_8_24",[0,0]],["6_12_25",[0,0]],["6_28_25",[0,0]],["6_24_25",[0,0]],["6_4_27",[0,0]],["6_0_24",[0,0]],["6_56_25",[0,0]],["6_36_25",[0,0]],["6_40_26",[0,0]],["6_52_22",[0,0]],["6_20_26",[0,0]],["6_16_25",[0,0]],["6_8_25",[0,0]],["6_48_16",[0,0]],["6_28_26",[0,0]],["6_44_26",[0,0]],["6_12_26",[0,0]],["6_24_26",[0,0]],["6_32_25",[0,0]],["6_60_25",[0,0]],["6_20_27",[0,0]],["6_8_26",[0,0]],["6_0_25",[0,0]],["6_4_28",[0,0]],["6_56_26",[0,0]],["6_36_26",[0,0]],["6_40_27",[0,0]],["6_48_17",[0,0]],["6_24_27",[0,0]],["6_16_26",[0,0]],["6_28_27",[0,0]],["6_52_23",[0,0]],["6_60_26",[0,0]],["6_12_27",[0,0]],["6_44_27",[0,0]],["6_32_26",[0,0]],["6_36_27",[0,0]],["6_4_29",[0,0]],["6_8_27",[0,0]],["6_48_18",[0,0]],["6_56_27",[0,0]],["6_20_28",[0,0]],["6_0_26",[0,0]],["6_40_28",[0,0]],["6_44_28",[0,0]],["6_60_27",[0,0]],["6_32_27",[0,0]],["6_36_28",[0,0]],["6_12_28",[0,0]],["6_48_19",[0,0]],["6_16_27",[0,0]],["6_52_24",[0,0]],["6_24_28",[0,0]],["6_28_28",[0,0]],["6_8_28",[0,0]],["6_0_27",[0,0]],["6_4_30",[0,0]],["6_56_28",[0,0]],["6_20_29",[0,0]],["6_48_20",[0,0]],["6_24_29",[0,0]],["6_36_29",[0,0]],["6_52_25",[0,0]],["6_16_28",[0,0]],["6_28_29",[0,0]],["6_8_29",[0,0]],["6_4_31",[0,0]],["6_56_29",[0,0]],["6_0_28",[0,0]],["6_60_28",[0,0]],["6_40_29",[0,0]],["6_44_29",[0,0]],["6_32_28",[0,0]],["6_12_29",[0,0]],["6_20_30",[0,0]],["6_48_21",[0,0]],["6_36_30",[0,0]],["6_24_30",[0,0]],["6_5_0",[0,0]],["6_0_29",[0,0]],["6_32_29",[0,0]],["6_28_30",[0,0]],["6_52_26",[0,0]],["6_16_29",[0,0]],["6_8_30",[0,0]],["6_56_30",[0,0]],["6_60_29",[0,0]],["6_20_31",[0,0]],["6_12_30",[0,0]],["6_40_30",[0,0]],["6_44_30",[0,0]],["6_48_22",[0,0]],["6_28_31",[0,0]],["6_56_31",[0,0]],["6_0_30",[0,0]],["6_12_31",[0,0]],["6_21_0",[0,0]],["6_8_31",[0,0]],["6_40_31",[0,0]],["6_24_31",[0,0]],["6_16_30",[0,0]],["6_52_27",[0,0]],["6_32_30",[0,0]],["6_36_31",[0,0]],["6_5_1",[0,0]],["6_60_30",[0,0]],["6_44_31",[0,0]],["6_48_23",[0,0]],["6_29_0",[0,0]],["6_41_0",[0,0]],["6_32_31",[0,0]],["6_52_28",[0,0]],["6_16_31",[0,0]],["6_5_2",[0,0]],["6_25_0",[0,0]],["6_37_0",[0,0]],["6_0_31",[0,0]],["6_21_1",[0,0]],["6_57_0",[0,0]],["6_13_0",[0,0]],["6_45_0",[0,0]],["6_9_0",[0,0]],["6_60_31",[0,0]],["6_48_24",[0,0]],["6_29_1",[0,0]],["6_33_0",[0,0]],["6_41_1",[0,0]],["6_52_29",[0,0]],["6_25_1",[0,0]],["6_17_0",[0,0]],["6_5_3",[0,0]],["6_57_1",[0,0]],["6_1_0",[0,0]],["6_45_1",[0,0]],["6_13_1",[0,0]],["6_9_1",[0,0]],["6_37_1",[0,0]],["6_21_2",[0,0]],["6_61_0",[0,0]],["6_29_2",[0,0]],["6_48_25",[0,0]],["6_33_1",[0,0]],["6_41_2",[0,0]],["6_5_4",[0,0]],["6_57_2",[0,0]],["6_25_2",[0,0]],["6_17_1",[0,0]],["6_1_1",[0,0]],["6_52_30",[0,0]],["6_9_2",[0,0]],["6_13_2",[0,0]],["6_37_2",[0,0]],["6_45_2",[0,0]],["6_61_1",[0,0]],["6_21_3",[0,0]],["6_5_5",[0,0]],["6_25_3",[0,0]],["6_17_2",[0,0]],["6_52_31",[0,0]],["6_33_2",[0,0]],["6_41_3",[0,0]],["6_57_3",[0,0]],["6_48_26",[0,0]],["6_29_3",[0,0]],["6_1_2",[0,0]],["6_9_3",[0,0]],["6_13_3",[0,0]],["6_45_3",[0,0]],["6_37_3",[0,0]],["6_25_4",[0,0]],["6_5_6",[0,0]],["6_41_4",[0,0]],["6_9_4",[0,0]],["6_29_4",[0,0]],["6_48_27",[0,0]],["6_57_4",[0,0]],["6_61_2",[0,0]],["6_33_3",[0,0]],["6_17_3",[0,0]],["6_21_4",[0,0]],["6_53_0",[0,0]],["6_45_4",[0,0]],["6_1_3",[0,0]],["6_13_4",[0,0]],["6_37_4",[0,0]],["6_29_5",[0,0]],["6_9_5",[0,0]],["6_17_4",[0,0]],["6_61_3",[0,0]],["6_33_4",[0,0]],["6_53_1",[0,0]],["6_25_5",[0,0]],["6_5_7",[0,0]],["6_41_5",[0,0]],["6_57_5",[0,0]],["6_48_28",[0,0]],["6_21_5",[0,0]],["6_9_6",[0,0]],["6_17_5",[0,0]],["6_25_6",[0,0]],["6_33_5",[0,0]],["6_53_2",[0,0]],["6_5_8",[0,0]],["6_61_4",[0,0]],["6_41_6",[0,0]],["6_1_4",[0,0]],["6_37_5",[0,0]],["6_13_5",[0,0]],["6_45_5",[0,0]],["6_29_6",[0,0]],["6_57_6",[0,0]],["6_48_29",[0,0]],["6_21_6",[0,0]],["6_61_5",[0,0]],["6_53_3",[0,0]],["6_41_7",[0,0]],["6_13_6",[0,0]],["6_45_6",[0,0]],["6_37_6",[0,0]],["6_57_7",[0,0]],["6_48_30",[0,0]],["6_29_7",[0,0]],["6_1_5",[0,0]],["6_17_6",[0,0]],["6_9_7",[0,0]],["6_25_7",[0,0]],["6_33_6",[0,0]],["6_5_9",[0,0]],["6_21_7",[0,0]],["6_53_4",[0,0]],["6_61_6",[0,0]],["6_41_8",[0,0]],["6_37_7",[0,0]],["6_13_7",[0,0]],["6_33_7",[0,0]],["6_17_7",[0,0]],["6_57_8",[0,0]],["6_5_10",[0,0]],["6_45_7",[0,0]],["6_9_8",[0,0]],["6_1_6",[0,0]],["6_48_31",[0,0]],["6_25_8",[0,0]],["6_21_8",[0,0]],["6_29_8",[0,0]],["6_61_7",[0,0]],["6_53_5",[0,0]],["6_41_9",[0,0]],["6_37_8",[0,0]],["6_13_8",[0,0]],["6_17_8",[0,0]],["6_33_8",[0,0]],["6_57_9",[0,0]],["6_25_9",[0,0]],["6_9_9",[0,0]],["6_5_11",[0,0]],["6_49_0",[0,0]],["6_1_7",[0,0]],["6_29_9",[0,0]],["6_21_9",[0,0]],["6_41_10",[0,0]],["6_37_9",[0,0]],["6_61_8",[0,0]],["6_13_9",[0,0]],["6_17_9",[0,0]],["6_57_10",[0,0]],["6_33_9",[0,0]],["6_53_6",[0,1427]],["6_29_10",[0,0]],["6_21_10",[0,0]],["6_41_11",[0,0]],["6_37_10",[0,0]],["6_13_10",[0,0]],["6_25_10",[0,0]],["6_9_10",[0,0]],["6_5_12",[0,0]],["6_1_8",[0,0]],["6_49_1",[0,0]],["6_61_9",[0,0]],["6_57_11",[0,0]],["6_17_10",[0,0]],["6_21_11",[0,0]],["6_13_11",[0,0]],["6_25_11",[0,0]],["6_49_2",[0,0]],["6_9_11",[0,0]],["6_1_9",[0,0]],["6_5_13",[0,0]],["6_33_10",[0,0]],["6_41_12",[0,0]],["6_29_11",[0,0]],["6_53_7",[0,1651]],["6_37_11",[0,0]],["6_61_10",[0,0]],["6_17_11",[0,0]],["6_9_12",[0,0]],["6_5_14",[0,0]],["6_41_13",[0,0]],["6_57_12",[0,0]],["6_21_12",[0,0]],["6_25_12",[0,0]],["6_49_3",[0,0]],["6_33_11",[0,0]],["6_37_12",[0,0]],["6_13_12",[0,0]],["6_29_12",[0,0]],["6_1_10",[0,0]],["6_53_8",[-27,1843]],["6_61_11",[0,0]],["6_45_8",[0,6305]],["6_17_12",[0,0]],["6_5_15",[0,0]],["6_25_13",[0,0]],["6_9_13",[0,0]],["6_57_13",[0,0]],["6_49_4",[0,0]],["6_41_14",[0,0]],["6_33_12",[0,0]],["6_37_13",[0,0]],["6_13_13",[0,0]],["6_29_13",[0,0]],["6_21_13",[0,0]],["6_5_16",[0,0]],["6_61_12",[0,0]],["6_1_11",[0,0]],["6_17_13",[0,0]],["6_53_9",[-4,913]],["6_25_14",[0,0]],["6_9_14",[0,0]],["6_57_14",[0,0]],["6_49_5",[0,0]],["6_33_13",[0,0]],["6_41_15",[0,0]],["6_61_13",[0,0]],["6_21_14",[0,0]],["6_17_14",[0,0]],["6_13_14",[0,0]],["6_5_17",[0,0]],["6_37_14",[0,0]],["6_29_14",[0,0]],["6_25_15",[0,0]],["6_1_12",[0,0]],["6_57_15",[0,0]],["6_49_6",[0,0]],["6_41_16",[0,0]],["6_33_14",[0,0]],["6_9_15",[0,0]],["6_5_18",[0,0]],["6_37_15",[0,0]],["6_13_15",[0,0]],["6_29_15",[0,0]],["6_25_16",[0,0]],["6_61_14",[0,0]],["6_21_15",[0,0]],["6_17_15",[0,0]],["6_53_10",[-1,1650]],["6_57_16",[0,0]],["6_1_13",[0,0]],["6_41_17",[0,0]],["6_49_7",[0,0]],["6_9_16",[0,0]],["6_33_15",[0,0]],["6_5_19",[0,0]],["6_13_16",[0,0]],["6_37_16",[0,0]],["6_61_15",[0,0]],["6_25_17",[0,0]],["6_17_16",[0,0]],["6_29_16",[0,0]],["6_21_16",[0,0]],["6_57_17",[0,0]],["6_41_18",[0,0]],["6_9_17",[0,0]],["6_1_14",[0,0]],["6_49_8",[0,5148]],["6_33_16",[0,0]],["6_5_20",[0,0]],["6_13_17",[0,0]],["6_57_18",[0,0]],["6_21_17",[0,0]],["6_41_19",[0,0]],["6_61_16",[0,0]],["6_37_17",[0,0]],["6_25_18",[0,0]],["6_17_17",[0,0]],["6_9_18",[0,0]],["6_29_17",[0,0]],["6_33_17",[0,0]],["6_1_15",[0,0]],["6_13_18",[0,0]],["6_61_17",[0,0]],["6_25_19",[0,0]],["6_41_20",[0,0]],["6_9_19",[0,0]],["6_17_18",[0,0]],["6_37_18",[0,0]],["6_29_18",[0,0]],["6_33_18",[0,0]],["6_5_21",[0,0]],["6_21_18",[0,0]],["6_57_19",[0,0]],["6_53_11",[-1,3634]],["6_1_16",[0,0]],["6_61_18",[0,0]],["6_13_19",[0,0]],["6_25_20",[0,0]],["6_17_19",[0,0]],["6_9_20",[0,0]],["6_21_19",[0,0]],["6_41_21",[0,0]],["6_37_19",[0,0]],["6_29_19",[0,0]],["6_5_22",[0,0]],["6_33_19",[0,0]],["6_57_20",[0,0]],["6_9_21",[0,0]],["6_17_20",[0,0]],["6_25_21",[0,0]],["6_1_17",[0,0]],["6_53_12",[-1,1766]],["6_61_19",[0,0]],["6_13_20",[0,0]],["6_29_20",[0,0]],["6_57_21",[0,0]],["6_33_20",[0,0]],["6_37_20",[0,0]],["6_21_20",[0,0]],["6_41_22",[0,0]],["6_5_23",[0,0]],["6_25_22",[0,0]],["6_17_21",[0,0]],["6_61_20",[0,0]],["6_13_21",[0,0]],["6_37_21",[0,0]],["6_33_21",[0,0]],["6_5_24",[0,0]],["6_21_21",[0,0]],["6_57_22",[0,0]],["6_41_23",[0,0]],["6_9_22",[0,0]],["6_1_18",[0,0]],["6_53_13",[0,0]],["6_29_21",[0,0]],["6_49_9",[1295,6084]],["6_17_22",[0,0]],["6_25_23",[0,0]],["6_37_22",[0,0]],["6_57_23",[0,0]],["6_61_21",[0,0]],["6_29_22",[0,0]],["6_5_25",[0,0]],["6_33_22",[0,0]],["6_13_22",[0,0]],["6_21_22",[0,0]],["6_53_14",[0,0]],["6_17_23",[0,0]],["6_9_23",[0,0]],["6_41_24",[0,0]],["6_1_19",[0,0]],["6_25_24",[0,0]],["6_33_23",[0,0]],["6_5_26",[0,0]],["6_37_23",[0,0]],["6_13_23",[0,0]],["6_61_22",[0,0]],["6_29_23",[0,0]],["6_57_24",[0,0]],["6_1_20",[0,0]],["6_9_24",[0,0]],["6_17_24",[0,0]],["6_41_25",[0,0]],["6_53_15",[0,0]],["6_21_23",[0,0]],["6_29_24",[0,0]],["6_13_24",[0,0]],["6_25_25",[0,0]],["6_37_24",[0,0]],["6_5_27",[0,0]],["6_45_9",[0,7922]],["6_17_25",[0,0]],["6_21_24",[0,0]],["6_9_25",[0,0]],["6_33_24",[0,0]],["6_61_23",[0,0]],["6_57_25",[0,0]],["6_1_21",[0,0]],["6_53_16",[0,0]],["6_41_26",[0,0]],["6_29_25",[0,0]],["6_37_25",[0,0]],["6_13_25",[0,0]],["6_5_28",[0,0]],["6_25_26",[0,0]],["6_17_26",[0,0]],["6_9_26",[0,0]],["6_57_26",[0,0]],["6_21_25",[0,0]],["6_1_22",[0,0]],["6_61_24",[0,0]],["6_33_25",[0,0]],["6_5_29",[0,0]],["6_29_26",[0,0]],["6_25_27",[0,0]],["6_37_26",[0,0]],["6_41_27",[0,0]],["6_53_17",[0,0]],["6_13_26",[0,0]],["6_57_27",[0,0]],["6_9_27",[0,0]],["6_45_10",[0,6469]],["6_17_27",[0,0]],["6_5_30",[0,0]],["6_29_27",[0,0]],["6_33_26",[0,0]],["6_25_28",[0,0]],["6_61_25",[0,0]],["6_1_23",[0,0]],["6_37_27",[0,0]],["6_21_26",[0,0]],["6_41_28",[0,0]],["6_53_18",[0,0]],["6_13_27",[0,0]],["6_9_28",[0,0]],["6_57_28",[0,0]],["6_45_11",[0,0]],["6_17_28",[0,0]],["6_5_31",[0,0]],["6_33_27",[0,0]],["6_25_29",[0,0]],["6_61_26",[0,0]],["6_29_28",[0,0]],["6_53_19",[0,0]],["6_9_29",[0,0]],["6_13_28",[0,0]],["6_45_12",[0,0]],["6_57_29",[0,0]],["6_17_29",[0,0]],["6_33_28",[0,0]],["6_6_0",[0,0]],["6_29_29",[0,0]],["6_25_30",[0,0]],["6_37_28",[0,0]],["6_21_27",[0,0]],["6_1_24",[0,0]],["6_41_29",[0,0]],["6_61_27",[0,0]],["6_45_13",[0,0]],["6_6_1",[0,0]],["6_13_29",[0,0]],["6_33_29",[0,0]],["6_9_30",[0,0]],["6_53_20",[0,0]],["6_17_30",[0,0]],["6_57_30",[0,0]],["6_29_30",[0,0]],["6_37_29",[0,0]],["6_61_28",[0,0]],["6_1_25",[0,0]],["6_25_31",[0,0]],["6_41_30",[0,0]],["6_21_28",[0,0]],["6_45_14",[0,0]],["6_6_2",[0,0]],["6_13_30",[0,0]],["6_53_21",[0,0]],["6_17_31",[0,0]],["6_33_30",[0,0]],["6_57_31",[0,0]],["6_29_31",[0,0]],["6_37_30",[0,0]],["6_9_31",[0,0]],["6_61_29",[0,0]],["6_1_26",[0,0]],["6_26_0",[0,0]],["6_41_31",[0,0]],["6_21_29",[0,0]],["6_45_15",[0,0]],["6_6_3",[0,0]],["6_58_0",[0,0]],["6_33_31",[0,0]],["6_18_0",[0,0]],["6_13_31",[0,0]],["6_30_0",[0,0]],["6_37_31",[0,0]],["6_53_22",[0,0]],["6_10_0",[0,0]],["6_21_30",[0,0]],["6_61_30",[0,0]],["6_42_0",[0,0]],["6_26_1",[0,0]],["6_45_16",[0,0]],["6_1_27",[0,0]],["6_18_1",[0,0]],["6_58_1",[0,0]],["6_6_4",[0,0]],["6_34_0",[0,0]],["6_14_0",[0,0]],["6_38_0",[0,0]],["6_30_1",[0,0]],["6_26_2",[0,0]],["6_53_23",[0,0]],["6_61_31",[0,0]],["6_10_1",[0,0]],["6_21_31",[0,0]],["6_42_1",[0,0]],["6_18_2",[0,0]],["6_34_1",[0,0]],["6_45_17",[0,0]],["6_58_2",[0,0]],["6_6_5",[0,0]],["6_1_28",[0,0]],["6_14_1",[0,0]],["6_30_2",[0,0]],["6_38_1",[0,0]],["6_62_0",[0,0]],["6_53_24",[0,0]],["6_26_3",[0,0]],["6_10_2",[0,0]],["6_42_2",[0,0]],["6_45_18",[0,0]],["6_14_2",[0,0]],["6_22_0",[0,0]],["6_34_2",[0,0]],["6_18_3",[0,0]],["6_6_6",[0,0]],["6_58_3",[0,0]],["6_30_3",[0,0]],["6_38_2",[0,0]],["6_1_29",[0,0]],["6_53_25",[0,0]],["6_42_3",[0,0]],["6_45_19",[0,0]],["6_26_4",[0,0]],["6_62_1",[0,0]],["6_10_3",[0,0]],["6_6_7",[0,0]],["6_30_4",[0,0]],["6_58_4",[0,0]],["6_34_3",[0,0]],["6_14_3",[0,0]],["6_22_1",[0,0]],["6_18_4",[0,0]],["6_53_26",[0,0]],["6_38_3",[0,0]],["6_1_30",[0,0]],["6_26_5",[0,0]],["6_62_2",[0,0]],["6_45_20",[0,0]],["6_42_4",[0,0]],["6_30_5",[0,0]],["6_10_4",[0,0]],["6_34_4",[0,0]],["6_49_10",[159,6334]],["6_6_8",[0,0]],["6_58_5",[0,0]],["6_18_5",[0,0]],["6_38_4",[0,0]],["6_14_4",[0,0]],["6_22_2",[0,0]],["6_45_21",[0,0]],["6_6_9",[0,0]],["6_26_6",[0,0]],["6_53_27",[0,0]],["6_30_6",[0,0]],["6_1_31",[0,0]],["6_62_3",[0,0]],["6_34_5",[0,0]],["6_10_5",[0,0]],["6_42_5",[0,0]],["6_58_6",[0,0]],["6_18_6",[0,0]],["6_22_3",[0,0]],["6_38_5",[0,0]],["6_45_22",[0,0]],["6_14_5",[0,0]],["6_6_10",[0,0]],["6_26_7",[0,0]],["6_53_28",[0,0]],["6_30_7",[0,0]],["6_2_0",[0,0]],["6_34_6",[0,0]],["6_62_4",[0,0]],["6_22_4",[0,0]],["6_42_6",[0,0]],["6_45_23",[0,0]],["6_10_6",[0,0]],["6_18_7",[0,0]],["6_58_7",[0,0]],["6_38_6",[0,0]],["6_14_6",[0,0]],["6_34_7",[0,0]],["6_2_1",[0,0]],["6_42_7",[0,0]],["6_22_5",[0,0]],["6_62_5",[0,0]],["6_6_11",[0,0]],["6_53_29",[0,0]],["6_30_8",[0,0]],["6_26_8",[0,0]],["6_18_8",[0,0]],["6_10_7",[0,0]],["6_58_8",[0,0]],["6_45_24",[0,0]],["6_38_7",[0,0]],["6_14_7",[0,0]],["6_53_30",[0,0]],["6_62_6",[0,0]],["6_34_8",[0,0]],["6_42_8",[0,0]],["6_22_6",[0,0]],["6_6_12",[0,0]],["6_2_2",[0,0]],["6_30_9",[0,0]],["6_10_8",[0,0]],["6_14_8",[0,0]],["6_53_31",[0,0]],["6_38_8",[0,0]],["6_62_7",[0,0]],["6_34_9",[0,0]],["6_22_7",[0,0]],["6_6_13",[0,0]],["6_30_10",[0,0]],["6_42_9",[0,0]],["6_26_9",[0,0]],["6_18_9",[0,0]],["6_45_25",[0,0]],["6_58_9",[0,0]],["6_2_3",[0,0]],["6_38_9",[0,0]],["6_10_9",[0,0]],["6_14_9",[0,0]],["6_34_10",[0,0]],["6_62_8",[0,0]],["6_54_0",[0,0]],["6_30_11",[0,0]],["6_22_8",[0,0]],["6_6_14",[0,0]],["6_42_10",[0,0]],["6_58_10",[0,0]],["6_45_26",[0,0]],["6_2_4",[0,0]],["6_26_10",[0,0]],["6_18_10",[0,0]],["6_54_1",[0,0]],["6_30_12",[0,0]],["6_6_15",[0,0]],["6_14_10",[0,0]],["6_34_11",[0,0]],["6_38_10",[0,0]],["6_10_10",[0,0]],["6_22_9",[0,0]],["6_45_27",[0,0]],["6_62_9",[0,0]],["6_58_11",[0,0]],["6_42_11",[0,0]],["6_2_5",[0,0]],["6_18_11",[0,0]],["6_26_11",[0,0]],["6_49_11",[0,5156]],["6_30_13",[0,0]],["6_54_2",[0,0]],["6_22_10",[0,0]],["6_45_28",[0,0]],["6_58_12",[0,0]],["6_42_12",[0,0]],["6_6_16",[0,0]],["6_14_11",[0,0]],["6_10_11",[0,0]],["6_38_11",[0,0]],["6_34_12",[0,0]],["6_62_10",[0,0]],["6_2_6",[0,0]],["6_30_14",[0,0]],["6_26_12",[0,0]],["6_18_12",[0,0]],["6_49_12",[0,2435]],["6_38_12",[0,0]],["6_34_13",[0,0]],["6_54_3",[0,0]],["6_45_29",[0,0]],["6_58_13",[0,0]],["6_22_11",[0,0]],["6_6_17",[0,0]],["6_14_12",[0,0]],["6_42_13",[0,0]],["6_62_11",[0,0]],["6_10_12",[0,0]],["6_18_13",[0,0]],["6_30_15",[0,0]],["6_2_7",[0,0]],["6_26_13",[0,0]],["6_49_13",[0,0]],["6_34_14",[0,0]],["6_45_30",[0,0]],["6_38_13",[0,0]],["6_58_14",[0,0]],["6_6_18",[0,0]],["6_22_12",[0,0]],["6_42_14",[0,0]],["6_14_13",[0,0]],["6_54_4",[0,0]],["6_62_12",[0,0]],["6_10_13",[0,0]],["6_18_14",[0,0]],["6_30_16",[0,0]],["6_2_8",[0,0]],["6_49_14",[0,0]],["6_38_14",[0,0]],["6_6_19",[0,0]],["6_54_5",[0,0]],["6_14_14",[0,0]],["6_34_15",[0,0]],["6_45_31",[0,0]],["6_58_15",[0,0]],["6_26_14",[0,0]],["6_42_15",[0,0]],["6_22_13",[0,0]],["6_49_15",[0,0]],["6_10_14",[0,0]],["6_62_13",[0,0]],["6_38_15",[0,0]],["6_30_17",[0,0]],["6_18_15",[0,0]],["6_2_9",[0,0]],["6_6_20",[0,0]],["6_46_0",[0,0]],["6_42_16",[0,0]],["6_58_16",[0,0]],["6_14_15",[0,0]],["6_26_15",[0,0]],["6_54_6",[0,1205]],["6_22_14",[0,0]],["6_34_16",[0,0]],["6_49_16",[0,0]],["6_46_1",[0,0]],["6_6_21",[0,0]],["6_42_17",[0,0]],["6_58_17",[0,0]],["6_22_15",[0,0]],["6_14_16",[0,0]],["6_26_16",[0,0]],["6_34_17",[0,0]],["6_38_16",[0,0]],["6_62_14",[0,0]],["6_30_18",[0,0]],["6_49_17",[0,0]],["6_54_7",[0,1392]],["6_10_15",[0,0]],["6_18_16",[0,0]],["6_2_10",[0,0]],["6_46_2",[0,0]],["6_34_18",[0,0]],["6_38_17",[0,0]],["6_30_19",[0,0]],["6_49_18",[0,0]],["6_6_22",[0,0]],["6_62_15",[0,0]],["6_42_18",[0,0]],["6_22_16",[0,0]],["6_58_18",[0,0]],["6_14_17",[0,0]],["6_26_17",[0,0]],["6_10_16",[0,0]],["6_18_17",[0,0]],["6_46_3",[0,0]],["6_38_18",[0,0]],["6_34_19",[0,0]],["6_30_20",[0,0]],["6_10_17",[0,0]],["6_22_17",[0,0]],["6_14_18",[0,0]],["6_18_18",[0,0]],["6_58_19",[0,0]],["6_49_19",[0,0]],["6_42_19",[0,0]],["6_6_23",[0,0]],["6_62_16",[0,0]],["6_26_18",[0,0]],["6_30_21",[0,0]],["6_10_18",[0,0]],["6_14_19",[0,0]],["6_18_19",[0,0]],["6_22_18",[0,0]],["6_2_11",[0,0]],["6_38_19",[0,0]],["6_46_4",[0,0]],["6_49_20",[0,0]],["6_34_20",[0,0]],["6_62_17",[0,0]],["6_42_20",[0,0]],["6_6_24",[0,0]],["6_58_20",[0,0]],["6_54_8",[-111,2607]],["6_26_19",[0,0]],["6_30_22",[0,0]],["6_10_19",[0,0]],["6_14_20",[0,0]],["6_18_20",[0,0]],["6_46_5",[0,0]],["6_38_20",[0,0]],["6_49_21",[0,0]],["6_6_25",[0,0]],["6_34_21",[0,0]],["6_22_19",[0,0]],["6_62_18",[0,0]],["6_54_9",[0,16]],["6_42_21",[0,0]],["6_58_21",[0,0]],["6_26_20",[0,0]],["6_30_23",[0,0]],["6_18_21",[0,0]],["6_14_21",[0,0]],["6_10_20",[0,0]],["6_49_22",[0,0]],["6_38_21",[0,0]],["6_46_6",[0,0]],["6_22_20",[0,0]],["6_26_21",[0,0]],["6_34_22",[0,0]],["6_58_22",[0,0]],["6_6_26",[0,0]],["6_62_19",[0,0]],["6_42_22",[0,0]],["6_54_10",[0,0]],["6_10_21",[0,0]],["6_38_22",[0,0]],["6_58_23",[0,0]],["6_34_23",[0,0]],["6_26_22",[0,0]],["6_22_21",[0,0]],["6_54_11",[0,0]],["6_6_27",[0,0]],["6_42_23",[0,0]],["6_14_22",[0,0]],["6_49_23",[0,0]],["6_62_20",[0,0]],["6_30_24",[0,0]],["6_18_22",[0,0]],["6_2_12",[0,0]],["6_38_23",[0,0]],["6_10_22",[0,0]],["6_58_24",[0,0]],["6_34_24",[0,0]],["6_22_22",[0,0]],["6_26_23",[0,0]],["6_49_24",[0,0]],["6_62_21",[0,0]],["6_30_25",[0,0]],["6_54_12",[0,0]],["6_14_23",[0,0]],["6_42_24",[0,0]],["6_6_28",[0,0]],["6_18_23",[0,0]],["6_2_13",[0,0]],["6_22_23",[0,0]],["6_10_23",[0,0]],["6_38_24",[0,0]],["6_46_7",[0,4197]],["6_34_25",[0,0]],["6_58_25",[0,0]],["6_49_25",[0,0]],["6_26_24",[0,0]],["6_62_22",[0,0]],["6_54_13",[0,0]],["6_42_25",[0,0]],["6_30_26",[0,0]],["6_22_24",[0,0]],["6_2_14",[0,0]],["6_34_26",[0,0]],["6_58_26",[0,0]],["6_49_26",[0,0]],["6_30_27",[0,0]],["6_26_25",[0,0]],["6_62_23",[0,0]],["6_42_26",[0,0]],["6_6_29",[0,0]],["6_14_24",[0,0]],["6_18_24",[0,0]],["6_10_24",[0,0]],["6_38_25",[0,0]],["6_54_14",[0,0]],["6_22_25",[0,0]],["6_2_15",[0,0]],["6_18_25",[0,0]],["6_38_26",[0,0]],["6_10_25",[0,0]],["6_49_27",[0,0]],["6_6_30",[0,0]],["6_54_15",[0,0]],["6_34_27",[0,0]],["6_14_25",[0,0]],["6_30_28",[0,0]],["6_58_27",[0,0]],["6_42_27",[0,0]],["6_26_26",[0,0]],["6_62_24",[0,0]],["6_22_26",[0,0]],["6_38_27",[0,0]],["6_34_28",[0,0]],["6_2_16",[0,0]],["6_18_26",[0,0]],["6_49_28",[0,0]],["6_10_26",[0,0]],["6_42_28",[0,0]],["6_30_29",[0,0]],["6_54_16",[0,0]],["6_26_27",[0,0]],["6_62_25",[0,0]],["6_6_31",[0,0]],["6_58_28",[0,0]],["6_14_26",[0,0]],["6_22_27",[0,0]],["6_38_28",[0,0]],["6_42_29",[0,0]],["6_34_29",[0,0]],["6_18_27",[0,0]],["6_49_29",[0,0]],["6_2_17",[0,0]],["6_10_27",[0,0]],["6_54_17",[0,0]],["6_7_0",[0,0]],["6_14_27",[0,0]],["6_58_29",[0,0]],["6_30_30",[0,0]],["6_38_29",[0,0]],["6_62_26",[0,0]],["6_26_28",[0,0]],["6_22_28",[0,0]],["6_42_30",[0,0]],["6_34_30",[0,0]],["6_18_28",[0,0]],["6_10_28",[0,0]],["6_2_18",[0,0]],["6_49_30",[0,0]],["6_54_18",[0,0]],["6_7_1",[0,0]],["6_62_27",[0,0]],["6_26_29",[0,0]],["6_30_31",[0,0]],["6_58_30",[0,0]],["6_38_30",[0,0]],["6_14_28",[0,0]],["6_22_29",[0,0]],["6_49_31",[0,0]],["6_54_19",[0,0]],["6_2_19",[0,0]],["6_58_31",[0,0]],["6_62_28",[0,0]],["6_26_30",[0,0]],["6_14_29",[0,0]],["6_34_31",[0,0]],["6_42_31",[0,0]],["6_10_29",[0,0]],["6_38_31",[0,0]],["6_7_2",[0,0]],["6_18_29",[0,0]],["6_31_0",[0,0]],["6_59_0",[0,0]],["6_22_30",[0,0]],["6_2_20",[0,0]],["6_54_20",[0,0]],["6_50_0",[0,0]],["6_35_0",[0,0]],["6_62_29",[0,0]],["6_26_31",[0,0]],["6_14_30",[0,0]],["6_39_0",[0,0]],["6_10_30",[0,0]],["6_18_30",[0,0]],["6_7_3",[0,0]],["6_31_1",[0,0]],["6_43_0",[0,0]],["6_39_1",[0,0]],["6_10_31",[0,0]],["6_35_1",[0,0]],["6_62_30",[0,0]],["6_18_31",[0,0]],["6_14_31",[0,0]],["6_22_31",[0,0]],["6_59_1",[0,0]],["6_27_0",[0,0]],["6_54_21",[0,0]],["6_50_1",[0,0]],["6_2_21",[0,0]],["6_31_2",[0,0]],["6_43_1",[0,0]],["6_7_4",[0,0]],["6_15_0",[0,0]],["6_50_2",[0,0]],["6_27_1",[0,0]],["6_59_2",[0,0]],["6_23_0",[0,0]],["6_2_22",[0,0]],["6_54_22",[0,0]],["6_31_3",[0,0]],["6_35_2",[0,0]],["6_62_31",[0,0]],["6_11_0",[0,0]],["6_39_2",[0,0]],["6_19_0",[0,0]],["6_7_5",[0,0]],["6_43_2",[0,0]],["6_50_3",[0,0]],["6_15_1",[0,0]],["6_2_23",[0,0]],["6_31_4",[0,0]],["6_39_3",[0,0]],["6_43_3",[0,0]],["6_11_1",[0,0]],["6_59_3",[0,0]],["6_27_2",[0,0]],["6_35_3",[0,0]],["6_54_23",[0,0]],["6_7_6",[0,0]],["6_23_1",[0,0]],["6_46_8",[0,6890]],["6_63_0",[0,0]],["6_19_1",[0,0]],["6_50_4",[0,0]],["6_15_2",[0,0]],["6_2_24",[0,0]],["6_31_5",[0,0]],["6_23_2",[0,0]],["6_43_4",[0,0]],["6_59_4",[0,0]],["6_63_1",[0,0]],["6_35_4",[0,0]],["6_19_2",[0,0]],["6_39_4",[0,0]],["6_54_24",[0,0]],["6_11_2",[0,0]],["6_27_3",[0,0]],["6_7_7",[0,0]],["6_50_5",[0,0]],["6_15_3",[0,0]],["6_23_3",[0,0]],["6_2_25",[0,0]],["6_31_6",[0,0]],["6_59_5",[0,0]],["6_54_25",[0,0]],["6_35_5",[0,0]],["6_63_2",[0,0]],["6_39_5",[0,0]],["6_19_3",[0,0]],["6_43_5",[0,0]],["6_11_3",[0,0]],["6_7_8",[0,0]],["6_27_4",[0,0]],["6_50_6",[0,0]],["6_23_4",[0,0]],["6_2_26",[0,0]],["6_15_4",[0,0]],["6_31_7",[0,0]],["6_11_4",[0,0]],["6_7_9",[0,0]],["6_59_6",[0,0]],["6_54_26",[0,0]],["6_35_6",[0,0]],["6_63_3",[0,0]],["6_43_6",[0,0]],["6_39_6",[0,0]],["6_19_4",[0,0]],["6_27_5",[0,0]],["6_50_7",[0,0]],["6_15_5",[0,0]],["6_23_5",[0,0]],["6_2_27",[0,0]],["6_31_8",[0,0]],["6_7_10",[0,0]],["6_54_27",[0,0]],["6_59_7",[0,0]],["6_39_7",[0,0]],["6_35_7",[0,0]],["6_43_7",[0,0]],["6_11_5",[0,0]],["6_63_4",[0,0]],["6_19_5",[0,0]],["6_27_6",[0,0]],["6_50_8",[0,2240]],["6_31_9",[0,0]],["6_23_6",[0,0]],["6_15_6",[0,0]],["6_59_8",[0,0]],["6_7_11",[0,0]],["6_43_8",[0,0]],["6_63_5",[0,0]],["6_11_6",[0,0]],["6_35_8",[0,0]],["6_39_8",[0,0]],["6_2_28",[0,0]],["6_54_28",[0,0]],["6_19_6",[0,0]],["6_27_7",[0,0]],["6_31_10",[0,0]],["6_15_7",[0,0]],["6_23_7",[0,0]],["6_43_9",[0,0]],["6_59_9",[0,0]],["6_63_6",[0,0]],["6_7_12",[0,0]],["6_11_7",[0,0]],["6_35_9",[0,0]],["6_39_9",[0,0]],["6_54_29",[0,0]],["6_27_8",[0,0]],["6_19_7",[0,0]],["6_2_29",[0,0]],["6_46_9",[979,6744]],["6_31_11",[0,0]],["6_23_8",[0,0]],["6_15_8",[0,0]],["6_59_10",[0,0]],["6_43_10",[0,0]],["6_11_8",[0,0]],["6_7_13",[0,0]],["6_63_7",[0,0]],["6_35_10",[0,0]],["6_31_12",[0,0]],["6_23_9",[0,0]],["6_19_8",[0,0]],["6_39_10",[0,0]],["6_54_30",[0,0]],["6_15_9",[0,0]],["6_27_9",[0,0]],["6_11_9",[0,0]],["6_63_8",[0,0]],["6_2_30",[0,0]],["6_43_11",[0,0]],["6_35_11",[0,0]],["6_7_14",[0,0]],["6_59_11",[0,0]],["6_50_9",[709,4891]],["6_15_10",[0,0]],["6_27_10",[0,0]],["6_39_11",[0,0]],["6_23_10",[0,0]],["6_31_13",[0,0]],["6_54_31",[0,0]],["6_19_9",[0,0]],["6_2_31",[0,0]],["6_63_9",[0,0]],["6_11_10",[0,0]],["6_43_12",[0,0]],["6_59_12",[0,0]],["6_35_12",[0,0]],["6_7_15",[0,0]],["6_55_0",[0,0]],["6_23_11",[0,0]],["6_31_14",[0,0]],["6_19_10",[0,0]],["6_43_13",[0,0]],["6_11_11",[0,0]],["6_63_10",[0,0]],["6_59_13",[0,0]],["6_7_16",[0,0]],["6_35_13",[0,0]],["6_15_11",[0,0]],["6_27_11",[0,0]],["6_39_12",[0,0]],["6_3_0",[0,0]],["6_19_11",[0,0]],["6_23_12",[0,0]],["6_43_14",[0,0]],["6_55_1",[0,0]],["6_31_15",[0,0]],["6_7_17",[0,0]],["6_63_11",[0,0]],["6_11_12",[0,0]],["6_59_14",[0,0]],["6_27_12",[0,0]],["6_15_12",[0,0]],["6_39_13",[0,0]],["6_35_14",[0,0]],["6_3_1",[0,0]],["6_23_13",[0,0]],["6_63_12",[0,0]],["6_39_14",[0,0]],["6_27_13",[0,0]],["6_15_13",[0,0]],["6_11_13",[0,0]],["6_7_18",[0,0]],["6_59_15",[0,0]],["6_35_15",[0,0]],["6_31_16",[0,0]],["6_19_12",[0,0]],["6_43_15",[0,0]],["6_55_2",[0,0]],["6_3_2",[0,0]],["6_35_16",[0,0]],["6_59_16",[0,0]],["6_7_19",[0,0]],["6_11_14",[0,0]],["6_15_14",[0,0]],["6_19_13",[0,0]],["6_55_3",[0,0]],["6_63_13",[0,0]],["6_31_17",[0,0]],["6_43_16",[0,0]],["6_23_14",[0,0]],["6_27_14",[0,0]],["6_39_15",[0,0]],["6_3_3",[0,0]],["6_19_14",[0,0]],["6_59_17",[0,0]],["6_35_17",[0,0]],["6_11_15",[0,0]],["6_15_15",[0,0]],["6_7_20",[0,0]],["6_43_17",[0,0]],["6_63_14",[0,0]],["6_31_18",[0,0]],["6_23_15",[0,0]],["6_55_4",[0,0]],["6_39_16",[0,0]],["6_27_15",[0,0]],["6_3_4",[0,0]],["6_11_16",[0,0]],["6_19_15",[0,0]],["6_55_5",[0,0]],["6_15_16",[0,0]],["6_59_18",[0,0]],["6_35_18",[0,0]],["6_7_21",[0,0]],["6_39_17",[0,0]],["6_27_16",[0,0]],["6_23_16",[0,0]],["6_31_19",[0,0]],["6_63_15",[0,0]],["6_43_18",[0,0]],["6_35_19",[0,0]],["6_59_19",[0,0]],["6_11_17",[0,0]],["6_7_22",[0,0]],["6_19_16",[0,0]],["6_15_17",[0,0]],["6_55_6",[0,0]],["6_43_19",[0,0]],["6_27_17",[0,0]],["6_3_5",[0,0]],["6_39_18",[0,0]],["6_63_16",[0,0]],["6_31_20",[0,0]],["6_23_17",[0,0]],["6_11_18",[0,0]],["6_7_23",[0,0]],["6_15_18",[0,0]],["6_19_17",[0,0]],["6_35_20",[0,0]],["6_59_20",[0,0]],["6_27_18",[0,0]],["6_43_20",[0,0]],["6_55_7",[0,1345]],["6_31_21",[0,0]],["6_23_18",[0,0]],["6_3_6",[0,0]],["6_63_17",[0,0]],["6_39_19",[0,0]],["6_19_18",[0,0]],["6_11_19",[0,0]],["6_15_19",[0,0]],["6_7_24",[0,0]],["6_35_21",[0,0]],["6_27_19",[0,0]],["6_59_21",[0,0]],["6_43_21",[0,0]],["6_46_10",[0,7429]],["6_23_19",[0,0]],["6_31_22",[0,0]],["6_63_18",[0,0]],["6_3_7",[0,0]],["6_39_20",[0,0]],["6_55_8",[0,1695]],["6_7_25",[0,0]],["6_15_20",[0,0]],["6_19_19",[0,0]],["6_11_20",[0,0]],["6_35_22",[0,0]],["6_43_22",[0,0]],["6_59_22",[0,0]],["6_27_20",[0,0]],["6_46_11",[0,0]],["6_63_19",[0,0]],["6_23_20",[0,0]],["6_31_23",[0,0]],["6_11_21",[0,0]],["6_7_26",[0,0]],["6_55_9",[0,0]],["6_19_20",[0,0]],["6_15_21",[0,0]],["6_39_21",[0,0]],["6_3_8",[0,0]],["6_59_23",[0,0]],["6_35_23",[0,0]],["6_43_23",[0,0]],["6_46_12",[0,0]],["6_27_21",[0,0]],["6_50_10",[118,6936]],["6_23_21",[0,0]],["6_63_20",[0,0]],["6_31_24",[0,0]],["6_19_21",[0,0]],["6_15_22",[0,0]],["6_11_22",[0,0]],["6_43_24",[0,0]],["6_7_27",[0,0]],["6_35_24",[0,0]],["6_55_10",[0,0]],["6_39_22",[0,0]],["6_3_9",[0,0]],["6_59_24",[0,0]],["6_46_13",[0,0]],["6_23_22",[0,0]],["6_27_22",[0,0]],["6_19_22",[0,0]],["6_31_25",[0,0]],["6_63_21",[0,0]],["6_15_23",[0,0]],["6_43_25",[0,0]],["6_11_23",[0,0]],["6_55_11",[0,0]],["6_7_28",[0,0]],["6_59_25",[0,0]],["6_27_23",[0,0]],["6_19_23",[0,0]],["6_35_25",[0,0]],["6_39_23",[0,0]],["6_3_10",[0,0]],["6_23_23",[0,0]],["6_46_14",[0,0]],["6_31_26",[0,0]],["6_63_22",[0,0]],["6_43_26",[0,0]],["6_11_24",[0,0]],["6_15_24",[0,0]],["6_7_29",[0,0]],["6_59_26",[0,0]],["6_23_24",[0,0]],["6_55_12",[0,0]],["6_27_24",[0,0]],["6_46_15",[0,0]],["6_3_11",[0,0]],["6_19_24",[0,0]],["6_39_24",[0,0]],["6_35_26",[0,0]],["6_63_23",[0,0]],["6_31_27",[0,0]],["6_27_25",[0,0]],["6_55_13",[0,0]],["6_43_27",[0,0]],["6_7_30",[0,0]],["6_15_25",[0,0]],["6_11_25",[0,0]],["6_59_27",[0,0]],["6_23_25",[0,0]],["6_46_16",[0,0]],["6_19_25",[0,0]],["6_3_12",[0,0]],["6_31_28",[0,0]],["6_39_25",[0,0]],["6_35_27",[0,0]],["6_63_24",[0,0]],["6_11_26",[0,0]],["6_55_14",[0,0]],["6_23_26",[0,0]],["6_46_17",[0,0]],["6_19_26",[0,0]],["6_59_28",[0,0]],["6_7_31",[0,0]],["6_27_26",[0,0]],["6_43_28",[0,0]],["6_15_26",[0,0]],["6_31_29",[0,0]],["6_3_13",[0,0]],["6_39_26",[0,0]],["6_63_25",[0,0]],["6_11_27",[0,0]],["6_55_15",[0,0]],["6_35_28",[0,0]],["6_31_30",[0,0]],["6_3_14",[0,0]],["6_27_27",[0,0]],["6_15_27",[0,0]],["6_59_29",[0,0]],["6_19_27",[0,0]],["6_46_18",[0,0]],["6_43_29",[0,0]],["6_23_27",[0,0]],["6_39_27",[0,0]],["6_46_19",[0,0]],["6_23_28",[0,0]],["6_63_26",[0,0]],["6_11_28",[0,0]],["6_55_16",[0,0]],["6_35_29",[0,0]],["6_15_28",[0,0]],["6_3_15",[0,0]],["6_27_28",[0,0]],["6_31_31",[0,0]],["6_59_30",[0,0]],["6_43_30",[0,0]],["6_19_28",[0,0]],["6_39_28",[0,0]],["6_50_11",[40,4118]],["6_59_31",[0,0]],["6_23_29",[0,0]],["6_27_29",[0,0]],["6_63_27",[0,0]],["6_46_20",[0,0]],["6_35_30",[0,0]],["6_55_17",[0,0]],["6_11_29",[0,0]],["6_15_29",[0,0]],["6_3_16",[0,0]],["6_43_31",[0,0]],["6_19_29",[0,0]],["6_39_29",[0,0]],["6_50_12",[-12,2781]],["6_35_31",[0,0]],["6_55_18",[0,0]],["6_3_17",[0,0]],["6_15_30",[0,0]],["6_63_28",[0,0]],["6_23_30",[0,0]],["6_46_21",[0,0]],["6_27_30",[0,0]],["6_11_30",[0,0]],["6_19_30",[0,0]],["6_39_30",[0,0]],["6_50_13",[0,0]],["6_46_22",[0,0]],["6_11_31",[0,0]],["6_15_31",[0,0]],["6_63_29",[0,0]],["6_23_31",[0,0]],["6_3_18",[0,0]],["6_19_31",[0,0]],["6_3_19",[0,0]],["6_27_31",[0,0]],["6_55_19",[0,0]],["6_39_31",[0,0]],["6_50_14",[0,0]],["6_63_30",[0,0]],["6_46_23",[0,0]],["6_46_24",[0,0]],["6_50_15",[0,0]],["6_63_31",[0,0]],["6_55_20",[0,0]],["6_3_20",[0,0]],["6_46_25",[0,0]],["6_50_16",[0,0]],["6_55_21",[0,0]],["6_3_21",[0,0]],["6_46_26",[0,0]],["6_55_22",[0,0]],["6_50_17",[0,0]],["6_3_22",[0,0]],["6_46_27",[0,0]],["6_55_23",[0,0]],["6_50_18",[0,0]],["6_3_23",[0,0]],["6_46_28",[0,0]],["6_3_24",[0,0]],["6_50_19",[0,0]],["6_55_24",[0,0]],["6_3_25",[0,0]],["6_46_29",[0,0]],["6_55_25",[0,0]],["6_50_20",[0,0]],["6_55_26",[0,0]],["6_3_26",[0,0]],["6_46_30",[0,0]],["6_50_21",[0,0]],["6_55_27",[0,0]],["6_46_31",[0,0]],["6_50_22",[0,0]],["6_3_27",[0,0]],["6_50_23",[0,0]],["6_47_0",[0,0]],["6_55_28",[0,0]],["6_3_28",[0,0]],["6_47_1",[0,0]],["6_50_24",[0,0]],["6_55_29",[0,0]],["6_3_29",[0,0]],["6_47_2",[0,0]],["6_50_25",[0,0]],["6_3_30",[0,0]],["6_55_30",[0,0]],["6_50_26",[0,0]],["6_47_3",[0,0]],["6_55_31",[0,0]],["6_3_31",[0,0]],["6_47_4",[0,0]],["6_50_27",[0,0]],["6_50_28",[0,0]],["6_47_5",[0,0]],["6_47_6",[0,0]],["6_50_29",[0,0]],["6_50_30",[0,0]],["6_50_31",[0,0]],["6_47_7",[0,4082]],["6_51_0",[0,0]],["6_51_1",[0,0]],["6_51_2",[0,0]],["6_51_3",[0,0]],["6_51_4",[0,0]],["6_47_8",[-207,4871]],["6_51_5",[0,0]],["6_51_6",[0,0]],["6_47_9",[746,6543]],["6_51_7",[0,1115]],["6_51_8",[0,2233]],["6_51_9",[105,3596]],["6_47_10",[528,7570]],["6_51_10",[7,2909]],["6_47_11",[0,8280]],["6_47_12",[0,0]],["6_51_11",[-12,2303]],["6_47_13",[0,0]],["6_51_12",[-23,1649]],["6_47_14",[0,0]],["6_51_13",[0,0]],["6_47_15",[0,0]],["6_51_14",[0,0]],["6_47_16",[0,0]],["6_51_15",[0,0]],["6_47_17",[0,0]],["6_51_16",[0,0]],["6_47_18",[0,0]],["6_51_17",[0,0]],["6_47_19",[0,0]],["6_47_20",[0,0]],["6_51_18",[0,0]],["6_47_21",[0,0]],["6_51_19",[0,0]],["6_47_22",[0,0]],["6_51_20",[0,0]],["6_47_23",[0,0]],["6_51_21",[0,0]],["6_47_24",[0,0]],["6_51_22",[0,0]],["6_47_25",[0,0]],["6_51_23",[0,0]],["6_47_26",[0,0]],["6_51_24",[0,0]],["6_47_27",[0,0]],["6_51_25",[0,0]],["6_47_28",[0,0]],["6_51_26",[0,0]],["6_47_29",[0,0]],["6_51_27",[0,0]],["6_47_30",[0,0]],["6_51_28",[0,0]],["6_47_31",[0,0]],["6_51_29",[0,0]],["6_51_30",[0,0]],["6_51_31",[0,0]]]),"EPSG:3857":__,MAX_LEVELS:6};const d_=c_;class u_{constructor(t){this.hasTerrainData=t.hasTerrainData,this._tilingScheme=t.tilingScheme,this._x=t.x,this._y=t.y,this._level=t.level,this._parent=t.parent,this._rectangle=this._tilingScheme.tileXYToRectangle(this._x,this._y,this._level),this._southwestChild=void 0,this._southeastChild=void 0,this._northwestChild=void 0,this._northeastChild=void 0,this._distance=0,this._loadPriority=0,this._lastSelectionResult=h_.NONE,this.renderable=!1,this.upsampledFromParent=!1,this._tileIndexVisited=!1,this._tileExistOnServer=1;const i=this._tilingScheme.crs,s=this.getOverscaledTileID(),r=this.hasTerrainData;r&&s.canonical.z>d_.MAX_LEVELS&&(d_[i].has(s.canonical.key)||d_[i].set(s.canonical.key,[this._parent.terrainBounds.minimumHeight,this._parent.terrainBounds.maximumHeight]));const n=this;this._terrainBounds={get minimumHeight(){return r?d_[i].get(s.canonical.key)[0]:0},set minimumHeight(e){r&&(d_[i].get(s.canonical.key)[0]=e,n.tileBoundingRegion.minimumHeight=e,n.tileBoundingRegion.computeBoundingVolumes(n.ellipsoid),n.tileBoundingRegion.isAmbiguousHeight=!1);},get maximumHeight(){return r?d_[i].get(s.canonical.key)[1]:0},set maximumHeight(e){r&&(d_[i].get(s.canonical.key)[1]=e,n.tileBoundingRegion.maximumHeight=e,n.tileBoundingRegion.computeBoundingVolumes(n.ellipsoid),n.tileBoundingRegion.isAmbiguousHeight=!1);}};const o=e.defined(this.parent)&&e.defined(this.parent.customHeight.minimumHeight);this._customHeight={hasCustomHeight:o,minimumHeight:o?this.parent.customHeight.minimumHeight:void 0,maximumHeight:o?this.parent.customHeight.maximumHeight:void 0,tileBoundingRegion:o?new We({computeBoundingVolumes:!0,rectangle:this.rectangle,ellipsoid:this.ellipsoid,minimumHeight:this.parent.customHeight.minimumHeight,maximumHeight:this.parent.customHeight.maximumHeight}):void 0};}get tileBoundingRegion(){if(this._tileBoundingRegion)return this._tileBoundingRegion;if(this._customHeight.hasCustomHeight)this._tileBoundingRegion||(this._tileBoundingRegion=this.customHeight.tileBoundingRegion);else if(this.hasTerrainData){const e=this._tilingScheme.crs,t=this.getOverscaledTileID(),i=d_[e].get(t.canonical.key);if(!i)throw new Error("当前的对象未创建便有了tileBoundingRegion的访问！");if(!i[2]){let e=this.level>d_.MAX_LEVELS;this.level>=14&&!this._parent.tileBoundingRegion.isAmbiguousHeight&&(e=!1),i[2]=new We({computeBoundingVolumes:!0,rectangle:this.rectangle,ellipsoid:this.ellipsoid,minimumHeight:i[0],maximumHeight:i[1],isAmbiguousHeight:e});}this._tileBoundingRegion||(this._tileBoundingRegion=i[2]);}else this._tileBoundingRegion||(this._tileBoundingRegion=new We({computeBoundingVolumes:!0,rectangle:this.rectangle,ellipsoid:this.ellipsoid,minimumHeight:0,maximumHeight:0}));return this._tileBoundingRegion}get terrainBounds(){return this._terrainBounds}getOverscaledTileID(){if(!this.tileId){const t=this._tilingScheme.type,i=this._level+(t==e.ProjectionType.LATLON?1:0),s=this._x,r=this._y,n=Math.pow(2,i);i>=0&&i<=25&&s>=0&&s<n&&r>=0&&r<n&&(this.tileId=new e.OverscaledTileID(i,0,i,this._x,this._y,t));}return this.tileId.distance=this._distance,this.tileId}static createLevelZeroTiles(e,t){const i=e.getNumberOfXTilesAtLevel(0),s=e.getNumberOfYTilesAtLevel(0),r=new Array(i*s);let n=0;for(let o=0;o<s;++o)for(let s=0;s<i;++s)r[n++]=new u_({tilingScheme:e,x:s,y:o,level:0,hasTerrainData:t});return r}get customHeight(){return this._customHeight}set customHeight(t){e.defined(t)&&(this._customHeight.minimumHeight=t.minimumHeight,this._customHeight.maximumHeight=t.maximumHeight);}get tilingScheme(){return this._tilingScheme}get x(){return this._x}get y(){return this._y}get level(){return this._level}get parent(){return this._parent}get rectangle(){return this._rectangle}get children(){return [this.northwestChild,this.northeastChild,this.southwestChild,this.southeastChild]}get southwestChild(){return e.defined(this._southwestChild)||(this._southwestChild=new u_({hasTerrainData:this.hasTerrainData,tilingScheme:this.tilingScheme,x:2*this.x,y:2*this.y+1,level:this.level+1,parent:this})),this._southwestChild}get southeastChild(){return e.defined(this._southeastChild)||(this._southeastChild=new u_({hasTerrainData:this.hasTerrainData,tilingScheme:this.tilingScheme,x:2*this.x+1,y:2*this.y+1,level:this.level+1,parent:this})),this._southeastChild}get northwestChild(){return e.defined(this._northwestChild)||(this._northwestChild=new u_({hasTerrainData:this.hasTerrainData,tilingScheme:this.tilingScheme,x:2*this.x,y:2*this.y,level:this.level+1,parent:this})),this._northwestChild}get northeastChild(){return e.defined(this._northeastChild)||(this._northeastChild=new u_({hasTerrainData:this.hasTerrainData,tilingScheme:this.tilingScheme,x:2*this.x+1,y:2*this.y,level:this.level+1,parent:this})),this._northeastChild}findLevelZeroTile(e,t,i){const s=this.tilingScheme.getNumberOfXTilesAtLevel(0);if(t<0?t+=s:t>=s&&(t-=s),!(i<0||i>=this.tilingScheme.getNumberOfYTilesAtLevel(0)))return e.filter((e=>e.x===t&&e.y===i))[0]}findTileToWest(e){const t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x-1,this.y);if(t.southeastChild===this)return t.southwestChild;if(t.northeastChild===this)return t.northwestChild;const i=t.findTileToWest(e);return void 0!==i?t.southwestChild===this?i.southeastChild:i.northeastChild:void 0}findTileToEast(e){const t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x+1,this.y);if(t.southwestChild===this)return t.southeastChild;if(t.northwestChild===this)return t.northeastChild;const i=t.findTileToEast(e);return void 0!==i?t.southeastChild===this?i.southwestChild:i.northwestChild:void 0}findTileToSouth(e){const t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x,this.y+1);if(t.northwestChild===this)return t.southwestChild;if(t.northeastChild===this)return t.southeastChild;const i=t.findTileToSouth(e);return void 0!==i?t.southwestChild===this?i.northwestChild:i.northeastChild:void 0}findTileToNorth(e){const t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x,this.y-1);if(t.southwestChild===this)return t.northwestChild;if(t.southeastChild===this)return t.northeastChild;const i=t.findTileToNorth(e);return void 0!==i?t.northwestChild===this?i.southwestChild:i.southeastChild:void 0}}var m_=Object.freeze({NONE:-1,PARTIAL:0,FULL:1});class p_{constructor(){this.allAreRenderable=!0,this.anyWereRenderedLastFrame=!1,this.notYetRenderableCount=0;}}class f_{constructor(){this.southwest=new p_,this.southeast=new p_,this.northwest=new p_,this.northeast=new p_;}combine(e){const t=this.southwest,i=this.southeast,s=this.northwest,r=this.northeast;e.allAreRenderable=t.allAreRenderable&&i.allAreRenderable&&s.allAreRenderable&&r.allAreRenderable,e.anyWereRenderedLastFrame=t.anyWereRenderedLastFrame||i.anyWereRenderedLastFrame||s.anyWereRenderedLastFrame||r.anyWereRenderedLastFrame,e.notYetRenderableCount=t.notYetRenderableCount+i.notYetRenderableCount+s.notYetRenderableCount+r.notYetRenderableCount;}}const g_=new Array(31);for(let e=0;e<g_.length;++e)g_[e]=new f_;class y_{constructor(t){if(this.hasTerrainData=t.hasTerrainData,this.tileScheme=t.tileScheme,this._levelZeroMaximumGeometricError=40075.16,this.maximumScreenSpaceError=t.maximumScreenSpaceError||2,this.tileSize=t.tileSize||512,this.type=t.type,this.drawingBufferHeight=t.drawingBufferHeight,this.pixelRatio=t.pixelRatio||1,this.selectedTiles=[],this._tileVisited=!1,this._tileMaxZoom=t.tileMaxZoom,this._tileMinZoom=t.tileMinZoom,this.rootTiles=u_.createLevelZeroTiles(this.tileScheme,this.hasTerrainData),e.defined(t.customHeight)&&(e.defined(t.customHeight.minimumHeight)||e.defined(t.customHeight.maximumHeight)))for(let e=0;e<this.rootTiles.length;e++)this.rootTiles[e].customHeight={minimumHeight:t.customHeight.minimumHeight,maximumHeight:t.customHeight.maximumHeight};this._tmpQuadtreeTileBoundingRegionMap={},this._overscaledTileIDList=[];}set tileMaxZoom(e){this._tileMaxZoom=e;}get tileMaxZoom(){return this._tileMaxZoom}set tileMinZoom(e){this._tileMinZoom=e;}get tileMinZoom(){return this._tileMinZoom}tilesIn(e){this._tileVisited=!1,this._tmpQuadtreeTileBoundingRegionMap={},this._overscaledTileIDList=[],this.selectedTiles=[];for(let t=0;t<this.rootTiles.length;t++)this.visitIfVisible(this.rootTiles[t],e,!1);}getQuadtreeTileByTileKey(t){const i=t.split("_"),s=parseInt(i[0]),r=this.tileScheme.type===e.ProjectionType.LATLON&&0===s?1:s,n=parseInt(i[1]),o=parseInt(i[2]),a=new e.OverscaledTileID(r,0,r,n,o),l=a.scaledTo(this.tileScheme.type===e.ProjectionType.LATLON?1:0);let h=r,_=null;for(;h>=0;){if(!_)for(let e=0;e<this.rootTiles.length;e++){const t=this.rootTiles[e];if(t.tileId.canonical.z===l.canonical.z&&t.tileId.canonical.x===l.canonical.x&&t.tileId.canonical.y===l.canonical.y){_=t;break}}if(0===h)break;const e=a.scaledTo(r-h+1);for(let t=0;t<_.children.length;t++){const i=_.children[t];if(i.tileId.canonical.z===e.canonical.z&&i.tileId.canonical.x===e.canonical.x&&i.tileId.canonical.y===e.canonical.y){_=i;break}}h--;}return _}getBoundingRegionById(e){return this._tmpQuadtreeTileBoundingRegionMap[e]||this.getQuadtreeTileByTileKey(e).tileBoundingRegion}getOverscaledTileIDs(){if(!this._tileVisited){for(let e=0;e<this.selectedTiles.length;e++){const t=this.selectedTiles[e],i=t.getOverscaledTileID();i&&(this._tmpQuadtreeTileBoundingRegionMap[i.key]=t.tileBoundingRegion);}this.selectedTiles.sort(((e,t)=>t.tileId.canonical.z-e.tileId.canonical.z)),this.selectedTiles.sort(((e,t)=>e._loadPriority-t._loadPriority));for(let e=0;e<this.selectedTiles.length;e++){const t=this.selectedTiles[e];t.tileId.canonical.z>=this._tileMinZoom&&(t.tileId.isAmbiguousHeight=t.tileBoundingRegion.isAmbiguousHeight,this._overscaledTileIDList.push(t.tileId));}this._tileVisited=!0;}return this._overscaledTileIDList}visitIfVisible(e,t,i){if(this.computeTileVisibility(e,t)!==m_.NONE)return this.visitTile(t,e,i)}visitTile(t,i,s){let r;r="raster"===this.type?this.screenSpaceError(t,this.drawingBufferHeight,this.pixelRatio,i)<this.maximumScreenSpaceError:i.tilingScheme.type===e.ProjectionType.LATLON?this.screenSpaceError(t,this.drawingBufferHeight,this.pixelRatio,i)<this.maximumScreenSpaceError||i.level+2-Math.log2(512/this.tileSize)>Number(t.mapZoom.toFixed(5)):this.screenSpaceError(t,this.drawingBufferHeight,this.pixelRatio,i)<this.maximumScreenSpaceError||i.level+1-Math.log2(512/this.tileSize)>Number(t.mapZoom.toFixed(5));const n=i.southwestChild,o=i.southeastChild,a=i.northwestChild,l=i.northeastChild;if(r||s)this.selectedTiles.push(i);else {if(this.canRefine(i)){if(n.upsampledFromParent&&o.upsampledFromParent&&a.upsampledFromParent&&l.upsampledFromParent)return void this.selectedTiles.push(i);if(o&&n._level<=this._tileMaxZoom)return void this.visitVisibleChildrenNearToFar(n,o,a,l,t,s)}this.selectedTiles.push(i);}}computeTileVisibility(t,i){const s=this.computeDistanceToTile(t,i);t._distance=s;const r=t.tileBoundingRegion;let n;t._loadPriority=this.computeTileLoadPriority(t,i);const o=i.frustumCrate.cullingVolume.computeVisibility(r.boundingVolume);return o===e.INTERSECTION.OUTSIDE?n=m_.NONE:o===e.INTERSECTION.INTERSECTING?n=m_.PARTIAL:o===e.INTERSECTION.INSIDE&&(n=m_.FULL),n}computeTileLoadPriority(t,i){if(!e.defined(t.tileBoundingRegion)||e.defined(t.tileBoundingRegion._orientedBoundingBox))return 0;const s=i.direction,r=e.Vector3.subtract(t.tileBoundingRegion._orientedBoundingBox.center,i.position,new e.Vector3),n=e.Vector3.magnitude(r);return n<1e-5?0:(e.Vector3.divideByScalar(r,n,r),(1-e.Vector3.dot(r,s))*t._distance)}screenSpaceError(e,t,i,s){let r=this.getLevelMaximumGeometricError(s.level)*t/(s._distance*e.frustumCrate.frustum._sseDenominator);return r/=i,r}computeDistanceToTile(e,t){return e.tileBoundingRegion.distanceToCamera(t)}getLevelMaximumGeometricError(e){return this._levelZeroMaximumGeometricError/(1<<e)}visitVisibleChildrenNearToFar(t,i,s,r,n,o){const a=e.Cartographic.fromVector3(n.position);a.longitude<t.rectangle.east?a.latitude<t.rectangle.north?(this.visitIfVisible(t,n,o),this.visitIfVisible(i,n,o),this.visitIfVisible(s,n,o),this.visitIfVisible(r,n,o)):(this.visitIfVisible(s,n,o),this.visitIfVisible(t,n,o),this.visitIfVisible(r,n,o),this.visitIfVisible(i,n,o)):a.latitude<t.rectangle.north?(this.visitIfVisible(i,n,o),this.visitIfVisible(t,n,o),this.visitIfVisible(r,n,o),this.visitIfVisible(s,n,o)):(this.visitIfVisible(r,n,o),this.visitIfVisible(s,n,o),this.visitIfVisible(i,n,o),this.visitIfVisible(t,n,o));}canRefine(e){return !0}destroy(){this.hasTerrainData=null,this.tileScheme=null,this.selectedTiles=[],this._tileVisited=!1,this._tmpQuadtreeTileBoundingRegionMap={},this._overscaledTileIDList=[];}}class T_ extends e.Evented{constructor(t,i,s){super(),this.id=t,this.dispatcher=s,this.on("data",(e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.map.transform&&this.update(this.map.transform));})),this.on("error",(()=>{this._sourceErrored=!0;}));const r=Gl(t,i,s,this);this._source=r,this._tiles={},this._cache=new l_(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._isIdRenderable=this._isIdRenderable.bind(this),this._coveredTiles={},this._state=new Uh,this.sourceType=i.type,this.adaptTerrain=i.adaptTerrain,this._loadedParentTiles={},this._ancientCoverageTiles={},this._referenceTiles={},this.customHeight={minimumHeight:e.defined(i.customHeight)?i.customHeight.minimumHeight:void 0,maximumHeight:e.defined(i.customHeight)?i.customHeight.maximumHeight:void 0};}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(e);const t=this.coveringTiles();this.currentMaxTileZoom=b_(t).currentMaxTileZoom,this.currentMinTileZoom=b_(t).currentMaxTileZoom;}onRemove(e){this._source&&this._source.onRemove&&this._source.onRemove(e);}loaded(){if(this._sourceErrored)return !0;if("3d-model"===this._source.type&&"loaded"===this._source.state)return this._sourceLoaded=!0,!0;if(!this._sourceLoaded)return !1;for(const e in this._tiles){const t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return !1}return "3d-model"!==this._source.type||"loaded"===this._source.state}getSource(){return this._source}pause(){this._paused=!0;}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.map&&this.update();}_loadTile(e,t){return this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,(()=>{}))}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,(()=>{}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles)this._tiles[t].upload(e),this._tiles[t].prepare(this.map.style.imageManager);}getIds(){return Object.keys(this._tiles).map(String).sort(((e,t)=>this._tiles[e].tileID.overscaledZ-this._tiles[t].tileID.overscaledZ))}getRenderableIds(){return this.getIds().filter(this._isIdRenderable)}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return !!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else if(this._cache.reset(),e)for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(e,"expired");else for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(e,"reloading");}_reloadTile(e,t){const i=this._tiles[e];i&&("loading"!==i.state&&(i.state=t),this._loadTile(i,this._tileLoaded.bind(this,i,e,t)));}_tileLoaded(t,i,s,r){if(r){if(t.state="errored",t._createOrCheckPrimitives(),"aborted"===r)return;404!==r.status?this._source.fire(new e.ErrorEvent(r,{tile:t})):this.update();}else {if("raster"===t.tilePrimitiveType){t.imageryOrigin&&"loaded"===t.imageryOrigin[0].imagery.state&&(t.imagery[0].freeResources(t.tileID.key),t.imagery=t.imageryOrigin,delete t.imageryOrigin);for(const e of t.imagery)if("loaded"!==e.imagery.state)return;t.state="loaded",t._createOrCheckPrimitives();}t.timeAdded=e.exported.now(),"expired"===s&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new e.Event("data",{dataType:"source",tile:t,coord:t.tileID}));}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}getZoom(e){return this.map.style.getNearestTileZoom()+e.scaleZoom(e.tileSize/this._source.tileSize)}_retainLoadedChildren(e,t,i,s){for(const r in this._tiles){let n=this._tiles[r];if(s.has(r)||!n.hasData()||n.tileID.overscaledZ<=t||n.tileID.overscaledZ>i)continue;let o=n.tileID;for(;n&&n.tileID.overscaledZ>t+1;){const e=n.tileID.scaledTo(n.tileID.overscaledZ-1);n=this._tiles[e.key],n&&n.hasData()&&(o=e);}let a=o;for(;a.overscaledZ>t;)if(a=a.scaledTo(a.overscaledZ-1),e[a.key]){s.set(o.key,o);break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const i=this._loadedParentTiles[e.key];return i&&i.tileID.overscaledZ>=t?i:null}for(let i=e.overscaledZ-1;i>=t;i--){const t=e.scaledTo(i),s=this._getLoadedTile(t);if(s)return s}}updateCacheSize(){this._cache.setMaxSize(256);}createQuadtree(){e.defined(this.quadtree)||(this.quadtree=x_({isLngLat:this.map.transform.projection===e.ProjectionType.LATLON,tileSize:this._source.tileSize,hasTerrainData:this.map.style.hasTerrainData,drawingBufferHeight:this.map.painter.context.gl.drawingBufferHeight,spaceErrorScale:this.map.spaceErrorScale,tileMinZoom:this._source.minzoom,tileMaxZoom:this._source.maxzoom,type:this.sourceType,customHeight:this.customHeight}));}coveringTiles(){return this.createQuadtree(),this.quadtree.tilesIn(this.map.transform.activeCamera),this.quadtree.getOverscaledTileIDs()}update(){if(!this._sourceLoaded||this._paused)return;let t;if(this.updateCacheSize(),this._coveredTiles={},"3d-model"===this._source.type)t=[];else if(this._source.tileID){t=this.coveringTiles().map((t=>new e.OverscaledTileID(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y,this.map.projection)));const i=[];t.forEach((e=>{e.isAmbiguousHeight||i.push(e);})),t=i;}else if(t=this.coveringTiles(),this._source.hasTile&&(t=t.filter((e=>this._source.hasTile(e)))),"raster"===this._source.type&&this._source.capabilities){const e=this._source.capabilities.tileGrid;t=t.filter((t=>function(e,t){const i=t.getFullTileRange(e.canonical.z);return !!i&&i.minX<=e.canonical.x&&e.canonical.x<i.maxX&&i.minY<=e.canonical.y&&e.canonical.y<i.maxY}(t,e)));}const i=b_(t);this.currentMaxTileZoom=i.currentMaxTileZoom,this.currentMinTileZoom=i.currentMinTileZoom,this._source.type!==e.VectorLayerType.RASTER?t=t.slice(0,48):t.length>192&&(t=t.slice(0,192)),this.used||(t=[]);const s=this._updateRetainedTiles(t),r=e.keysDifferenceWithMap(this._tiles,s);for(let e=0;e<r.length;e++)this._removeTile(r[e]);}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let i,s=this._tiles[e].tileID;for(;s.overscaledZ>0;){if(s.key in this._loadedParentTiles){i=this._loadedParentTiles[s.key];break}t.push(s.key);const e=s.scaledTo(s.overscaledZ-1);if(i=this._getLoadedTile(e),i)break;s=e;}for(const e of t)this._loadedParentTiles[e]=i;}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}_updateRetainedTiles(e){this._referenceTiles={};const t=new Map;if(0===e.length)return t;const i={},s=e.reduce(((e,t)=>Math.min(e,t.overscaledZ)),1/0),r=e[0].overscaledZ,n=Math.max(r-T_.maxOverzooming,this._source.minzoom),o=Math.max(r+T_.maxUnderzooming,this._source.minzoom),a={};for(const i of e){const e=this._addTile(i);t.set(i.key,i),e.hasData()||(a[i.key]=i);}this._retainLoadedChildren(a,s,o,t);for(const e in a){const s=this._tiles[e],o=a[e];if(o.overscaledZ<this._source.maxzoom){const e=o.children(this._source.maxzoom);if(t.get(e[0].key)&&t.get(e[1].key)&&t.get(e[2].key)&&t.get(e[3].key))continue}let l=s.wasRequested();for(let e=o.overscaledZ-1;e>=n;--e){const s=o.scaledTo(e);if(i[s.key])break;i[s.key]=!0;let n=this.getTile(s);if(!n&&l&&r-s.canonical.z<4&&(n=this._addTile(s)),n){if(t.set(s.key,s),n.hasData())break;l=n.wasRequested();}}}return t}_refineTile(t,i,s){const r=t.imagery[0].imagery,n=this._source.getImageryFromCache(r.x,r.y,r.level,i.key),o=Math.pow(2,i.overscaledZ-r.level),a=i.canonical.x%o/o,l=i.canonical.y%o/o,h=new Nt(n,new e.Vector4(0,0,1,1),new e.Vector4(a,l,1/o,1/o));this._tiles[i.key].imageryOrigin=this._tiles[i.key].imagery,delete this._tiles[i.key].imagery,this._tiles[i.key].imagery=[h],this._tiles[i.key].state="loaded",this._tiles[i.key]._createOrCheckPrimitives(),this._referenceTiles[s.key]=!0;}_addTile(t){let i=this._tiles[t.key];if(i){if(!(i.tileID.canonical.z>this._source.maxzoom))return i.tileID=t,i;if("loaded"===i.state||"loading"===i.state||"reloading"===i.state||"errored"===i.state)return i.tileID=t,i}i=this._cache.getAndRemove(t),i&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));const s=Boolean(i);return s||(i=new a_({tileID:t,tileSize:this._source.tileSize*t.overscaleFactor(),projType:this.map.projection,tilePrimitiveType:"raster"==this._source.type?"raster":"vector",sourceId:this._source.id,style:this.map.style,keepBuffer:this.adaptTerrain&&this.map.style.hasTerrainData}),this._loadTile(i,this._tileLoaded.bind(this,i,t.key,i.state))),i?(i.uses++,this._tiles[t.key]=i,s||this._source.fire(new e.Event("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const i=t.getExpiryTimeout();i&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e];}),i));}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))));}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache&&this._cache.reset(),this._source.unloadGPUData&&this._source.unloadGPUData();}tilesInOfSphereExtrusion(e,t,i){let s=[];s=s.concat(this.quadtree.getOverscaledTileIDs());const r=[];for(let e=0;e<s.length;e++){const t=this.getTile(s[e]);t&&r.push(t.getBucket(i));}return r}tilesIn(t,i,s){const r=[],n=this.map.transform;if(!n)return r;const o=s?this.map.style.symbolMatrixHelper.getCameraQueryGeometry(t):t,a=t.map((e=>n.pointCoordinate(e))).filter((e=>e)),l=o.map((e=>n.pointCoordinate(e))).filter((e=>e));if(0==a.length)return [];const h=this.getIds();let _=1/0,c=1/0,d=-1/0,u=-1/0;const m=a[0].zoom;for(const e of l)_=Math.min(_,e.column),c=Math.min(c,e.row),d=Math.max(d,e.column),u=Math.max(u,e.row);for(let t=0;t<h.length;t++){const s=this._tiles[h[t]],n=s.tileID,o=Math.pow(2,this.map.style.getNearestTileZoom()-s.tileID.overscaledZ),p=i*s.queryPadding*e.EXTENT/s.tileSize/o,f=[C_(n,new e.Coordinate(_,c,m)),C_(n,new e.Coordinate(d,u,m))];if(f[0].x-p<e.EXTENT&&f[0].y-p<e.EXTENT&&f[1].x+p>=0&&f[1].y+p>=0){const t=a.map((t=>{const i=t.zoomTo(n.canonical.z);return n.getTilePoint(new e.pointGeometry3d(i.column,i.row))})),i=l.map((t=>{const i=t.zoomTo(n.canonical.z);return n.getTilePoint(new e.pointGeometry3d(i.column,i.row))}));r.push({tile:s,tileID:n,queryGeometry:t,cameraQueryGeometry:i,scale:o});}}return r}getVisibleCoordinates(){return this.getRenderableIds().map((e=>this._tiles[e].tileID))}hasTransition(){if(this._source.hasTransition())return !0;if("raster"===(t=this._source.type)||"image"===t||"video"===t)for(const t in this._tiles){const i=this._tiles[t];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=e.exported.now())return !0}var t;return !1}setFeatureState(e,t,i){this._state.updateState(e=e||"_geojsonTileLayer",t,i);}removeFeatureState(e,t,i){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,i);}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,i){const s=this._tiles[e];s&&s.setDependencies(t,i);}reloadTilesForDependencies(e,t){for(const i in this._tiles)this._tiles[i].hasDependency(e,t)&&this._reloadTile(i,"reloading");this._cache.filter((i=>!i.hasDependency(e,t)));}resetQuadtree(){if(this.quadtree?.destroy(),delete this.quadtree,this._source.type==e.VectorLayerType.RASTER){for(const e in this._tiles){const t=this._tiles[e];t.unloadVectorData(),t.state="loading";}for(const e in this._cache.data){const t=this._cache.data[e][0].value;t&&(t.unloadVectorData(),t.state="loading");}}}}function C_(t,i){const s=i.zoomTo(t.canonical.z);return new e.pointGeometry3d((s.column-(t.canonical.x+t.wrap*Math.pow(2,t.canonical.z)))*e.EXTENT,(s.row-t.canonical.y)*e.EXTENT)}function x_(t){const i=e.defined(t.spaceErrorScale)?t.spaceErrorScale:1,{tileSize:s,isLngLat:r,drawingBufferHeight:n,hasTerrainData:o,tileMaxZoom:a,tileMinZoom:l,type:h,customHeight:_}=t;return new y_({tileSize:s,hasTerrainData:o,maximumScreenSpaceError:s/512*i,tileScheme:r?new Ot({}):new Dt({}),drawingBufferHeight:n,pixelRatio:e.exported.devicePixelRatio/2*2,tileMaxZoom:a||17,tileMinZoom:l||0,type:h,customHeight:_})}function b_(e){if(0==e.length)return {currentMaxTileZoom:22,currentMinTileZoom:0};let t=e[0].canonical.z,i=e[0].canonical.z;for(const s of e)t=s.canonical.z>t?s.canonical.z:t,i=s.canonical.z<i?s.canonical.z:i;return {currentMaxTileZoom:t,currentMinTileZoom:i}}T_.maxOverzooming=10,T_.maxUnderzooming=3;class v_{constructor(e,t,i){this.item=e,this.previous=t,this.next=i;}}class w_{constructor(){this.head=null,this.tail=null,this._length=0;}get length(){return this._length}add(e){const t=new v_(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length);}splice(e,t){e!==t&&(this.remove(t),this._insert(e,t));}_insert(e,t){const i=e.next;e.next=t,this.tail===e?this.tail=t:i.previous=t,t.next=i,t.previous=e,++this._length;}}function S_(e){return null!=e}class A_{constructor(){this._list=new w_,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1;}reset(){this._list.splice(this._list.tail,this._sentinel);}touch(e){const t=e._cacheNode;S_(t)&&this._list.splice(this._sentinel,t);}add(e,t,i){S_(t._cacheNode)||(t._cacheNode=this._list.add(t),i&&i(e,t));}unloadTile(e,t,i){const s=t._cacheNode;S_(s)&&(this._list.remove(s),t._cacheNode=void 0,i&&i(e,t));}unloadTiles(e,t){const i=this._trimTiles;this._trimTiles=!1;const s=1024*e.maximumMemoryUsage*1024,r=this._sentinel;let n=this._list.head;for(;n!==r&&(e.gpuMemoryUsageInBytes>s||i);){const i=n.item;n=n.next,this.unloadTile(e,i,t);}}trim(){this._trimTiles=!0;}}function E_(e,t,i){return {camera:{position:e.camerapos,direction:e.dir,up:e.up,fov:e.fov},viewport:e,height:i.height,cullingVolume:e.cullingVolume,frameNumber:t,sseDenominator:1.15}}new e.Vector3,new e.Vector3,new e.CullingVolume([new e.Plane,new e.Plane,new e.Plane,new e.Plane,new e.Plane,new e.Plane]);const M_=6356752.314245179,P_=new e.Vector3,R_="I3S",B_="TILES3D",I_="geometricError";function D_(e){return null!=e}const O_=new e.Vector3;new e.Vector3,new e.Vector3;const L_=new e.Rectangle;function V_(t,i,s){if(jt(t,"3D Tile: boundingVolume must be defined"),t.box)return function(t,i,s){const r=new e.Vector3(t[0],t[1],t[2]);i.transform(r,r);let n=[];if(10===t.length){const i=t.slice(3,6),s=new e.Quaternion;s.fromArray(t,6);const r=new e.Vector3(1,0,0),o=new e.Vector3(0,1,0),a=new e.Vector3(0,0,1);r.transformByQuaternion(s),r.scale(i[0]),o.transformByQuaternion(s),o.scale(i[1]),a.transformByQuaternion(s),a.scale(i[2]),n=[...r.toArray(),...o.toArray(),...a.toArray()];}else n=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];const o=i.transformAsVector(n.slice(0,3)),a=i.transformAsVector(n.slice(3,6)),l=i.transformAsVector(n.slice(6,9)),h=new e.Matrix3([o[0],o[1],o[2],a[0],a[1],a[2],l[0],l[1],l[2]]);return D_(s)?(s.center=r,s.halfAxes=h,s):new e.OrientedBoundingBox(r,h)}(t.box,i,s);if(t.region){D_(t.region[0])&&D_(t.region[1])&&D_(t.region[2])&&D_(t.region[3])||(console.warn("注意: 当前的3dtiles bounding region给出的异常，无法正常进行飞行的定位！",JSON.stringify(t.region)),t.region[0]=-Math.PI,t.region[1]=Math.PI/2,t.region[2]=Math.PI,t.region[3]=-Math.PI/2);const i=e.Rectangle.unpack(t.region,0,L_);return new We({rectangle:i,minimumHeight:t.region[4],maximumHeight:t.region[5]})}if(t.sphere)return function(t,i,s){const r=!Array.isArray(t),n=r?new e.Vector3(t.center):new e.Vector3(t[0],t[1],t[2]);i.transform(n,n);const o=i.getScale(O_),a=Math.max(Math.max(o[0],o[1]),o[2]),l=(r?t.radius:t[3])*a;return D_(s)?(s.center=n,s.radius=l,s):new e.BoundingSphere(n,l)}(t.sphere,i,s);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}new e.OrientedBoundingBox,new e.Matrix4;const N_=6378137,F_=Math.PI/2;function G_([t,i,s]){const r=e.toRadians(t),n=e.toRadians(i),o=1+s/N_,a=o*Math.cos(n);return [t=a*Math.cos(r),i=a*Math.sin(r),s=o*Math.sin(n)]}function k_([e,t,i=0],[s,r,n=0]){const o=G_([s,r,n]),a=G_([e,t,i]),l=a[0]-o[0],h=a[1]-o[1],_=a[2]-o[2];return l*l+h*h+_*_}function U_(e,t){const i=t.viewport,s=e.header.mbs[3],r=[e.header.mbs[0],e.header.mbs[1],e.header.mbs[2]],n=k_(i.unprojectPosition(i.cameraPosition),r),o=s/N_,a=n-o*o;if(a<=0)return 170141175e30;let l=function(e,t){const{width:i,height:s,pixelProjectionMatrix:r}=t.viewport,n=Math.tan(Math.atan(Math.sqrt(1/(r[0]*r[0])+1/(r[5]*r[5]))));return Math.sqrt(s*s+i*i)/n}(0,t);return l*=o/Math.sqrt(a)/i.scale,l}const H_=new e.Vector3;function z_(e){return null!=e}class W_{constructor(e,t,i,s,r){jt("object"==typeof t),this.header=t,this.tileset=e,this.id=z_(r)?r:t.id,this.url=t.url,this.parent=i,this._name=this.header.name?this.header.name:this.parent?this.parent._name:"",this.refine=this._getRefine(t.refine),this.type=t.type,this._depth=0,this.contentUrl=t.contentUrl,this.lodMetricType=null,this.lodMetricValue=null,this.boundingVolume=null,this.content=null,this.contentState=0,this.gpuMemoryUsageInBytes=0,this.children=[],this.depth=0,this.viewportIds=[],this._cacheNode=null,this._frameNumber=null,this._cacheNode=null,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),this._lodJudge=null,this._expireDate=null,this._expiredContent=null,this._getPriority=this._getPriority.bind(this),this.userData={},this._updatedVisibilityFrame=0,this._shouldSelect=!1,this._finalResolution=!0,this._ancestorWithContent=void 0,this._ancestorWithContentAvailable=void 0,this._refines=!1,this._priority=0,this._priorityHolder=this,this._priorityProgressiveResolution=!1,this._priorityProgressiveResolutionScreenSpaceErrorLeaf=!1,this._priorityReverseScreenSpaceError=0,this._foveatedFactor=0,this._wasMinPriorityChild=!1,this._screenSpaceErrorProgressiveResolution=0,this.priorityDeferred=!1,this._isClipped=!1,Object.seal(this);}destroy(){this.header=null;}isDestroyed(){return null===this.header}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get show(){return this._show}set show(e){this._show=e;}get opacity(){return this._opacity}set opacity(e){this._opacity=e;}get name(){return this._name}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return !this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return 3===this.contentState||this.hasEmptyContent}get contentAvailable(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return 0===this.contentState}get contentExpired(){return 4===this.contentState}get boundingSphere(){return this.boundingVolume.getBoundingSphere()}get contentFailed(){return 5===this.contentState}get extras(){return this.header.extras}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}getScreenSpaceError(e,t){switch(this.tileset.type){case R_:return U_(this,e);case B_:return this.getTiles3DScreenSpaceError(this,e,t);default:throw new Error("Unsupported tileset type")}}getTiles3DScreenSpaceError(e,t,i){const s=e.tileset,r=z_(e.parent)?e.parent.lodMetricValue:s.lodMetricValue,n=i?r:e.lodMetricValue;if(0===n)return 0;const o=Math.max(e._distanceToCamera,1e-7),{height:a,sseDenominator:l}=t,{viewDistanceScale:h}=s.options;let _=n*a*(h||1)/(o*l);return _-=this.getDynamicScreenSpaceError(s,o),_}fog(e,t){const i=e*t;return 1-Math.exp(-i*i)}getDynamicScreenSpaceError(e,t){if(e.dynamicScreenSpaceError&&e._dynamicScreenSpaceErrorComputedDensity){const i=e.dynamicScreenSpaceErrorFactor;return this.fog(t,e._dynamicScreenSpaceErrorComputedDensity)*i}return 0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser;if(0===this.contentState)return -1;if(this.tileset.frameNumber-this._touchedFrame>=1){const e=this.tileset._abortListMap.get(this.id);return e&&e.abort(),-1}const t=this.parent;return Math.max((e.root?e.root._screenSpaceError:0)-(t&&(0===this._screenSpaceError||t.hasTilesetContent)?t._screenSpaceError:this._screenSpaceError),0)}async loadContent(){if(this.hasEmptyContent)return !1;if(this.content)return !0;this.contentExpired&&(this._expireDate=null),this.contentState=1;const e=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!e)return this.contentState=0,!1;try{const e=this.tileset.getTileUrl(this.contentUrl),t=this.tileset.loader,i={fetch:this.tileset.fetchOptions,[t.id]:{isTileset:"json"===this.type,...this._getLoaderSpecificOptions(t.id)},json:"json"===this.type,transformRequest:this.tileset.options.transformRequest,context:this.tileset.options.context,useMipmap:this.tileset.options.useMipmap,clippingPlanes:this.tileset.clippingPlanes,allowPick:this.tileset.options.allowPick,nodeProperty:this.tileset.options.nodeProperty,dispatcher:this.tileset.options.dispatcher,lightingModel:this.tileset.options.lightingModel,flowOptions:this.tileset.options.flowOptions};return i.fetch.isDestroyed=this.tileset._destroyed,i.fetch._abortListMap=this.tileset._abortListMap,this.content=await Bs(e,t,i),this.tileset._abortListMap.has(this.id)&&this.tileset._abortListMap.delete(this.id),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this,ki(this.contentUrl)),this.contentState=3,this._onContentLoaded(),!0}catch(e){throw this.contentState=5,e}finally{e.done();}}unloadContent(){return this.content&&this.content.batchTable&&this.content.batchTable.destroy(),this.content&&this.content.featureTable&&(this.content.featureTable=void 0),this.content&&this.content.destroy&&this.content.destroy(),this.content&&this.content.gltf&&e.getPrimitives(this.content.gltf).forEach((e=>{e?.destroy();})),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=0,!0}updateVisibility(t,i){if(this._frameNumber===t.frameNumber)return;const s=this.parent,r=s?s._visibilityPlaneMask:e.CullingVolume.MASK_INDETERMINATE;this._updateTransform(s?s.computedTransform:this.tileset.modelMatrix),this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,r),this._visible=this._visibilityPlaneMask!==e.CullingVolume.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=i;}visibility(e,t){const{cullingVolume:i}=e,{boundingVolume:s}=this;return i.computeVisibilityWithPlaneMask(s,t)}contentVisibility(t){return z_(this.boundingVolume)?this._visibilityPlaneMask===e.CullingVolume.MASK_INSIDE?1:t.cullingVolume.computeVisibility(this.boundingVolume):1}distanceToTile(e){const t=this.boundingVolume;return t instanceof We?t.distanceToCamera(e.camera):Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth(e){return H_.subVectors(this.boundingVolume.center,e.position),e.direction.dot(H_)}insideViewerRequestVolume(e){const t=this._viewerRequestVolume;return !t||0===t.distanceToCamera(e.camera.position)}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"));}_initializeTransforms(t){this.transform=t.transform?new e.Matrix4(t.transform):new e.Matrix4;const i=this.parent,s=this.tileset,r=i&&i.computedTransform?i.computedTransform.clone():s.modelMatrix.clone();this.computedTransform=new e.Matrix4(r).multiplyRight(this.transform);const n=i&&i._initialTransform?i._initialTransform.clone():new e.Matrix4;this._initialTransform=new e.Matrix4(n).multiplyRight(this.transform);}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e);}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=0,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1);}_initializeRenderingState(t){const i=this.parent;this.depth=t.level||(i?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=e.CullingVolume.MASK_INDETERMINATE,this._visible=!1;let s=!0;i&&z_(i.show)&&(s=i.show),this._show=s&&(!z_(t.show)||t.show);let r=1;i&&z_(i.opacity)&&(r=i.opacity),this._opacity=r*(z_(t.opacity)?t.opacity:1),this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0;}_getRefine(e){return e||this.parent&&this.parent.refine||2}_isTileset(){return -1!==this.contentUrl.indexOf(".json")}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset.traverser.disableSkipLevelOfDetail=!0;}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes();}_updateBoundingVolume(e){this.boundingVolume=V_(e.boundingVolume,this.computedTransform,this.boundingVolume);const t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=V_(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=V_(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)));}_updateTransform(t=new e.Matrix4){const i=t.clone().multiplyRight(this.transform);!i.equals(this.computedTransform)&&(this.computedTransform=i,this._updateBoundingVolume(this.header));}_getLoaderSpecificOptions(e){return "i3s"===e?{...this.tileset.options.i3s,tile:this.header,tileset:this.tileset.tileset,isTileHeader:!1}:{assetGltfUpAxis:(t=this.tileset.tileset).asset&&t.asset.gltfUpAxis||"Y"};var t;}updateExpiration(){if(z_(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=4,this._expiredContent=this.content);}}}class j_{constructor(e=0){this._array=new Array(e),this._map=new Map,this._length=e;}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e);}get values(){return this._array}get(e){return jt(e<this._array.length),this._array[e]}set(e,t){jt(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e);}delete(e){const t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--);}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const t=this.length++;this._array[t]=e,this._map.set(e,t);}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){jt(e>=0),e>this._array.length&&(this._array.length=e);}resize(e){jt(e>=0),this.length=e;}trim(e){null==e&&(e=this.length),this._array.length=e;}reset(){this._array=[],this._map=new Map,this._length=0;}find(e){return this._map.has(e)}}class X_{constructor(e){this.options={...e},this.traversal={stack:new j_,stackMaximumLength:0},this.emptyTraversal={stack:new j_,stackMaximumLength:0},this.descendantTraversal={stack:new j_,stackMaximumLength:0},this.selectionTraversal={stack:new j_,stackMaximumLength:0,ancestorStack:new j_,ancestorStackMaximumLength:0},this.descendantSelectionDepth=2,this.selectedTiles={},this.requestedTiles={},this.loadTiles=[],this.emptyTiles={},this.root=void 0,this._finalResolution=!0,this._ancestorWithContent=void 0,this._ancestorWithContentAvailable=void 0,this._refines=!1,this._priorityHolder=this,this._priorityProgressiveResolution=!1,this._priorityProgressiveResolutionScreenSpaceErrorLeaf=!1,this._priorityReverseScreenSpaceError=0,this._foveatedFactor=0,this._wasMinPriorityChild=!1;}traverse(e,t,i){if(this.options={...this.options,...i},this.root=e.root,e.parent&&e.parent.debugFreezeFrame)return;this.reset(),e._hasMixedContent=!1;const s=e.root;this.updateTile(e,s,t),this.isVisible(s)?s.getScreenSpaceError(t,!0)<=e._maximumScreenSpaceError?this.options.onTraversalEnd(t):(this.skipLevelOfDetail(e)?e.immediatelyLoadDesiredLevelOfDetail?this.executeSkipTraversal(e,s,t):this.executeBaseAndSkipTraversal(e,s,t):this.executeBaseTraversal(e,s,t),this.traversal.stack.reset(),this.emptyTraversal.stack.reset(),this.descendantTraversal.stack.reset(),this.selectionTraversal.stack.reset(),this.selectionTraversal.ancestorStack.reset(),this.options.onTraversalEnd&&this.options.onTraversalEnd(t)):this.options.onTraversalEnd(t);}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this.loadTiles=[];}executeBaseTraversal(e,t,i){this.executeTraversal(e,t,e._maximumScreenSpaceError,e._maximumScreenSpaceError,i);}executeSkipTraversal(e,t,i){this.executeTraversal(e,t,Number.MAX_VALUE,e._maximumScreenSpaceError,i),this.traverseAndSelect(e,t,i);}executeBaseAndSkipTraversal(e,t,i){this.executeTraversal(e,t,e.baseScreenSpaceError,e._maximumScreenSpaceError,i),this.traverseAndSelect(e,t,i);}skipLevelOfDetail(e){return e.skipLevelOfDetail}addEmptyTile(e,t){this.emptyTiles[t.id]=t;}isVisible(e){return e._visible&&e._inRequestVolume}selectTile(e,t,i){-1!==t.contentVisibility(i)&&(t._selectedFrame=i.frameNumber,this.selectedTiles[t.id]=t);}selectDescendants(e,t,i){const s=this.descendantTraversal.stack;for(s.push(t);s.length>0;){this.descendantTraversal.stackMaximumLength=Math.max(this.descendantTraversal.stackMaximumLength,s.length);const r=s.pop().children,n=r.length;for(let o=0;o<n;++o){const n=r[o];this.isVisible(n)&&(n.contentAvailable?(this.updateTile(e,n,i),this.touchTile(e,n,i),this.selectTile(e,n,i)):n.depth-t.depth<this.descendantSelectionDepth&&s.push(n));}}}selectDesiredTile(e,t,i){if(!this.skipLevelOfDetail(e))return void(t.contentAvailable&&this.selectTile(e,t,i));const s=t.contentAvailable?t:t._ancestorWithContentAvailable;q_(s)?s._shouldSelect=!0:this.selectDescendants(e,t,i);}visitTile(e,t,i){t._visitedFrame=i.frameNumber;}touchTile(e,t,i){t._touchedFrame!==i.frameNumber&&(t.tileset._cache.touch(t),t._touchedFrame=i.frameNumber);}updateMinimumMaximumPriority(e,t){e._maximumPriority.distance=Math.max(t._priorityHolder._distanceToCamera,e._maximumPriority.distance),e._minimumPriority.distance=Math.min(t._priorityHolder._distanceToCamera,e._minimumPriority.distance),e._maximumPriority.depth=Math.max(t.depth,e._maximumPriority.depth),e._minimumPriority.depth=Math.min(t.depth,e._minimumPriority.depth),e._maximumPriority.foveatedFactor=Math.max(t._priorityHolder._foveatedFactor,e._maximumPriority.foveatedFactor),e._minimumPriority.foveatedFactor=Math.min(t._priorityHolder._foveatedFactor,e._minimumPriority.foveatedFactor),e._maximumPriority.reverseScreenSpaceError=Math.max(t._priorityReverseScreenSpaceError,e._maximumPriority.reverseScreenSpaceError),e._minimumPriority.reverseScreenSpaceError=Math.min(t._priorityReverseScreenSpaceError,e._minimumPriority.reverseScreenSpaceError);}isOnScreenLongEnough(e,t,i){if(!e._cullRequestsWhileMoving)return !0;const s=Math.max(2*t.boundingSphere.radius,1),r=i.camera;return e.cullRequestsWhileMovingMultiplier*(0!==r.positionWCDeltaMagnitude?r.positionWCDeltaMagnitude:r.positionWCDeltaMagnitudeLastFrame)/s<1}loadTile(e,t,i){t.id&&this.loadTiles.push(t.id),t._requestedFrame!==i.frameNumber&&(this.hasUnloadedContent(t)||t.contentExpired)&&(t._priority=this.getPriority(t),t._requestedFrame=i.frameNumber,this.requestedTiles[t.id]=t);}updateVisibility(e,t,i){if(t._updatedVisibilityFrame===e._updatedVisibilityFrame)return;const s=[];if(this.options.viewportTraversersMap)for(const e in this.options.viewportTraversersMap)this.options.viewportTraversersMap[e]===i.viewport.id&&s.push(e);else s.push(i.viewport.id);t.updateVisibility(i,s),t._updatedVisibilityFrame=e._updatedVisibilityFrame;}anyChildrenVisible(e,t,i){let s=!1;const r=t.children,n=r.length;for(let t=0;t<n;++t){const n=r[t];this.updateVisibility(e,n,i),s=s||this.isVisible(n);}return s}meetsScreenSpaceErrorEarly(e,t,i){const s=t.parent;return !(!q_(s)||s.hasTilesetContent||1!==s.refine)&&t.getScreenSpaceError(i,!0)<=e._maximumScreenSpaceError}updateTileVisibility(e,t,i){if(this.updateVisibility(e,t,i),!this.isVisible(t))return;const s=t.children.length>0;if(t.hasTilesetContent&&s){const s=t.children[0];return this.updateTileVisibility(e,s,i),void(t._visible=s._visible)}this.meetsScreenSpaceErrorEarly(e,t,i)?t._visible=!1:2===t.refine&&s&&(this.anyChildrenVisible(e,t,i)||(t._visible=!1));}updateTile(e,t,i){this.updateTileVisibility(e,t,i),t.updateExpiration(),t._wasMinPriorityChild=!1,t._priorityHolder=t,t._shouldSelect=!1,t._finalResolution=!0;}updateTileAncestorContentLinks(e,t){e._ancestorWithContent=void 0,e._ancestorWithContentAvailable=void 0;const i=e.parent;if(q_(i)){const s=!this.hasUnloadedContent(i)||i._requestedFrame===t.frameNumber;e._ancestorWithContent=s?i:i._ancestorWithContent,e._ancestorWithContentAvailable=i.contentAvailable?i:i._ancestorWithContentAvailable;}}hasEmptyContent(e){return e.hasEmptyContent||e.hasTilesetContent}hasUnloadedContent(e){return !this.hasEmptyContent(e)&&e.contentUnloaded}reachedSkippingThreshold(e,t){const i=t._ancestorWithContent;return !e.immediatelyLoadDesiredLevelOfDetail&&(t._priorityProgressiveResolutionScreenSpaceErrorLeaf||q_(i)&&t._screenSpaceError<i._screenSpaceError/e.skipScreenSpaceErrorFactor&&t.depth>i.depth+e.skipLevels)}updateAndPushChildren(e,t,i,s){let r;const n=2===t.refine,o=t.children,a=o.length;for(r=0;r<a;++r)this.updateTile(e,o[r],s);o.sort(K_);const l=!this.skipLevelOfDetail(e)&&n&&!this.hasEmptyContent(t);let h,_=!0,c=!1;for(r=0;r<a;++r){var d;h=o[r],this.isVisible(h)?(i.push(h),c=!0):(l||e.loadSiblings)&&(this.loadTile(e,h,s),this.touchTile(e,h,s)),l&&(d=!!h._inRequestVolume&&(this.hasEmptyContent(h)?this.executeEmptyTraversal(e,h,s):h.contentAvailable),_=_&&d);}return c||(_=!1),_}inBaseTraversal(e,t,i){return !this.skipLevelOfDetail(e)||!e.immediatelyLoadDesiredLevelOfDetail&&(!q_(t._ancestorWithContent)||(0===t._screenSpaceError?t.parent._screenSpaceError>i:t._screenSpaceError>i))}canTraverse(e,t){return 0!==t.children.length&&(t.hasTilesetContent?!t.contentExpired:t._screenSpaceError>e._maximumScreenSpaceError)}executeTraversal(e,t,i,s,r){const n=this.traversal.stack;for(n.push(t);n.length>0;){this.traversal.stackMaximumLength=Math.max(this.traversal.stackMaximumLength,n.length);const t=n.pop();this.updateTileAncestorContentLinks(t,r);const s=this.inBaseTraversal(e,t,i),o=1===t.refine,a=2===t.refine,l=t.parent,h=!q_(l)||l._refines;let _=!1;this.canTraverse(e,t)&&(_=this.updateAndPushChildren(e,t,n,r)&&h);const c=!_&&h;this.hasEmptyContent(t)?(this.addEmptyTile(e,t),this.loadTile(e,t,r),c&&this.selectDesiredTile(e,t,r)):o?(this.selectDesiredTile(e,t,r),this.loadTile(e,t,r)):a&&(s?(this.loadTile(e,t,r),c&&this.selectDesiredTile(e,t,r)):c?(this.selectDesiredTile(e,t,r),this.loadTile(e,t,r)):this.reachedSkippingThreshold(e,t)&&this.loadTile(e,t,r)),this.visitTile(e,t,r),this.touchTile(e,t,r),t._refines=_;}}executeEmptyTraversal(e,t,i){let s=!0;const r=this.emptyTraversal.stack;for(r.push(t);r.length>0;){this.emptyTraversal.stackMaximumLength=Math.max(this.emptyTraversal.stackMaximumLength,r.length);const t=r.pop(),n=t.children,o=n.length,a=this.hasEmptyContent(t)&&this.canTraverse(e,t);if(a||t.contentAvailable||(s=!1),this.updateTile(e,t,i),this.isVisible(t)||(this.loadTile(e,t,i),this.touchTile(e,t,i)),a)for(let e=0;e<o;++e)r.push(n[e]);}return s}traverseAndSelect(e,t,i){const s=this.selectionTraversal.stack,r=this.selectionTraversal.ancestorStack;let n;for(s.push(t);s.length>0||r.length>0;){if(this.selectionTraversal.stackMaximumLength=Math.max(this.selectionTraversal.stackMaximumLength,s.length),this.selectionTraversal.ancestorStackMaximumLength=Math.max(this.selectionTraversal.ancestorStackMaximumLength,r.length),r.length>0){const t=r.peek();if(t._stackLength===s.length){r.pop(),t!==n&&(t._finalResolution=!1),this.selectTile(e,t,i);continue}}const t=s.pop();if(!q_(t))continue;const o=1===t.refine,a=t._shouldSelect,l=t.children,h=l.length,_=this.canTraverse(e,t);if(a)if(o)this.selectTile(e,t,i);else {if(t._selectionDepth=r.length,t._selectionDepth>0&&(e._hasMixedContent=!0),n=t,!_){this.selectTile(e,t,i);continue}r.push(t),t._stackLength=s.length;}if(_)for(let e=0;e<h;++e){const t=l[e];this.isVisible(t)&&s.push(t);}}}getPriority(e){const{options:t}=this;switch(e.refine){case 1:return e._distanceToCamera;case 2:const{parent:i}=e;return this.root._screenSpaceError-(!i||t.skipLevelOfDetail&&0!==e._screenSpaceError&&!i.hasTilesetContent?e._screenSpaceError:i._screenSpaceError);default:return assert(!1)}}}function q_(e){return null!=e}function K_(e,t){return 0===t._distanceToCamera&&0===e._distanceToCamera?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}const J_={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2};class Z_{constructor(e){this.options={...J_,...e},this._traversalStack=new j_,this._emptyTraversalStack=new j_,this._frameNumber=null,this.root=null,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={};}traverse(e,t,i){this.root=e,this.options={...this.options,...i},this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t);}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset();}executeTraversal(e,t){const i=this._traversalStack;for(i.push(e);i.length>0;){const e=i.pop();let s=!1;this.canTraverse(e,t)&&(this.updateChildTiles(e,t),s=this.updateAndPushChildren(e,t,i));const r=e.parent,n=Boolean(!r||r._shouldRefine),o=!s;e.hasRenderContent?1===e.refine?(this.loadTile(e,t),this.selectTile(e,t)):2===e.refine&&(this.loadTile(e,t),o&&this.selectTile(e,t)):(this.emptyTiles[e.id]=e,this.loadTile(e,t),o&&this.selectTile(e,t)),this.touchTile(e,t),e._shouldRefine=s&&n;}this.options.onTraversalEnd&&this.options.onTraversalEnd(t);}updateChildTiles(e,t){const i=e.children;for(const e of i)this.updateTile(e,t);return !0}updateAndPushChildren(e,t,i){const{loadSiblings:s,skipLevelOfDetail:r}=this.options,n=e.children;n.sort(this.compareDistanceToCamera);const o=!r&&2===e.refine&&e.hasRenderContent;let a=!1;for(const e of n)if(e.isVisibleAndInRequestVolume?(i.find(e)&&i.delete(e),i.push(e),a=!0):(o||s)&&(this.loadTile(e,t),this.touchTile(e,t)),o){let i;if(i=!!e._inRequestVolume&&(e.hasRenderContent?e.contentAvailable:this.executeEmptyTraversal(e,t)),!i)return i}return a}updateTile(e,t){this.updateTileVisibility(e,t);}selectTile(e,t){this.shouldSelectTile(e,t)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e);}loadTile(e,t){this.shouldLoadTile(e,t)&&(e._requestedFrame=t.frameNumber,e._priority=this.getPriority(e),this.requestedTiles[e.id]=e);}touchTile(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber;}canTraverse(e,t,i=!1,s=!1){return !(!s&&!e.isVisibleAndInRequestVolume)&&!!e.hasChildren&&(e.hasTilesetContent?!e.contentExpired:this.shouldRefine(e,t,i))}shouldLoadTile(e,t){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e,t){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,t,i){let s=e._screenSpaceError;return i&&(s=e.getScreenSpaceError(t,!0)),s>this.options.maximumScreenSpaceError}updateTileVisibility(e,t){const i=[];if(this.options.viewportTraversersMap)for(const e in this.options.viewportTraversersMap)this.options.viewportTraversersMap[e]===t.viewport.id&&i.push(e);else i.push(t.viewport.id);e.updateVisibility(t,i);}compareDistanceToCamera(e,t){return e._distanceToCamera-t._distanceToCamera}getPriority(e){const{options:t}=this;switch(e.refine){case 1:return e._distanceToCamera;case 2:const{parent:i}=e;return this.root._screenSpaceError-(!i||t.skipLevelOfDetail&&0!==e._screenSpaceError&&!i.hasTilesetContent?e._screenSpaceError:i._screenSpaceError);default:return jt(!1)}}anyChildrenVisible(e,t){let i=!1;for(const s of e.children)s.updateVisibility(t),i=i||s.isVisibleAndInRequestVolume;return i}executeEmptyTraversal(e,t){let i=!0;const s=this._emptyTraversalStack;for(;s.length>0;){const e=s.pop();this.updateTile(e,t),e.isVisibleAndInRequestVolume||(this.loadTile(e,t),this.touchTile(e,t));const r=!e.hasRenderContent&&this.canTraverse(e,t,!1,!0);if(r||e.contentAvailable||(i=!1),r){const t=e.children.filter((e=>e));for(const e of t)s.find(e)&&s.delete(e),s.push(e);}}return i}}class Y_{constructor(){this._statusMap={};}add(e,t,i,s){this._statusMap[t]||(this._statusMap[t]={request:e,callback:i,key:t,frameState:s,status:"REQUESTED"},e().then((e=>{this._statusMap[t].status="COMPLETED",this._statusMap[t].callback(e,s);})).catch((e=>{this._statusMap[t].status="ERROR",i(e);})));}update(e,t){this._statusMap[e]&&(this._statusMap[e].frameState=t);}find(e){return this._statusMap[e]}}class Q_ extends Z_{constructor(e){super(e),this._tileManager=new Y_;}shouldRefine(e,t){return e._lodJudge=function(e,t){const i=t.viewport,s=i.metersPerPixel,r=e.header.mbs[1],n=e.header.mbs[0],o=e.header.mbs[2],a=e.header.mbs[3],{height:l,width:h,latitude:_,longitude:c}=i,d=[c,_],u=[n,r,o],m=[c,r],p=[n,_],f=Math.sqrt(l*l+h*h)*s[0],g=k_(d,u),y=.5*l+a/N_,T=.5*h+a/N_;if(g>f+a/N_)return "OUT";if(k_(d,m)>y)return "OUT";if(k_(d,p)>T)return "OUT";if(0===e.lodMetricValue)return "DIG";let C=U_(e,t);return C*=F_,C<.5?"OUT":!e.header.children||C<=e.lodMetricValue?"DRAW":e.header.children?"DIG":"OUT"}(e,t),"DIG"===e._lodJudge}updateChildTiles(e,t){const i=e.header.children||[],s=e.children,r=e.tileset;for(const n of i){const i=`${n.id}-${t.viewport.id}`,o=s&&s.find((e=>e.id===i));if(o)o&&this.updateTile(o,t);else {let s=()=>this._loadTile(n.id,r);this._tileManager.find(i)?this._tileManager.update(i,t):(r.tileset.nodePages&&(s=()=>r.tileset.nodePagesTile.formTileFromNodePages(n.id)),this._tileManager.add(s,i,(t=>this._onTileLoad(t,e,i)),t));}}}async _loadTile(e,t){const{loader:i}=t,s=t.getTileUrl(`${t.url}/nodes/${e}`),r={i3s:{...t.fetchOptions,isTileHeader:!0,loadContent:!1}};return await Bs(s,i,r)}_onTileLoad(e,t,i){const s=new W_(t.tileset,e,t,this.options.basePath,i);t.children.push(s);const r=this._tileManager.find(s.id).frameState;this.updateTile(s,r),this._frameNumber===r.frameNumber&&this.executeTraversal(s,r);}}const $_="Tiles In Tileset(s)",ec="Tiles In Memory",tc="Tiles In View",ic="Tiles To Render",sc="Tiles Loaded",rc="Tiles Loading",nc="Tiles Unloaded",oc="Failed Tile Loads",ac="Points/Vertices",lc="Tile Memory Use",hc=/\/\/.*\.[0-9]{1,4}(:[\w]+)?/g,_c=/^((http:\/\/)|(https:\/\/))?([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,6}()/g,cc={modelMatrix:new e.Matrix4,throttleRequests:!0,maximumMemoryUsage:32,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:(e,t,i)=>{},maximumScreenSpaceError:8};class dc{constructor(e,t={}){jt(e),this.options={...cc,...t},this.subIPs=t.subIPs,this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||ki(this.url),this.modelMatrix=this.options.modelMatrix,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this.fetchOptions=this.options.fetchOptions||{},this.options.headers&&(this.fetchOptions.headers=this.options.headers),this.options.token&&(this.fetchOptions.token=this.options.token),this.root=null,this.roots={},this.cartographicCenter=null,this.cartesianCenter=null,this.zoom=1,this.boundingVolume=null,this._traverser=this._initializeTraverser(),this._cache=new A_,this._requestScheduler=new Ni({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this._frameNumber=0,this._updateFrameNumber=0,this._pendingCount=0,this.selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this._selectedTilesToStyle=[],this.frameStateData={},this._queryParams={},this._queryParamsString=null,this.maximumMemoryUsage=this.options.maximumMemoryUsage,this.gpuMemoryUsageInBytes=0,this.stats=new Li({id:this.url}),this._initializeStats(),this._hasMixedContent=!1,this._maximumScreenSpaceError=this.options.maximumScreenSpaceError,this._properties=void 0,this._extensionsUsed=void 0,this._gltfUpAxis=void 0,this._dynamicScreenSpaceErrorComputedDensity=0,this.extras=null,this.asset={},this.credits={},this.description=this.options.description,this._defaultGeometrySchema=[],this.loadSiblings=this.options.loadSiblings,this.skipLevelOfDetail=this.options.skipLevelOfDetail,this.baseScreenSpaceError=this.options.baseScreenSpaceError,this._updatedVisibilityFrame=0,this.skipLevels=this.options.skipLevels,this.skipScreenSpaceErrorFactor=this.options.skipScreenSpaceErrorFactor,this.immediatelyLoadDesiredLevelOfDetail=this.options.immediatelyLoadDesiredLevelOfDetail,this._hasMixedContent=!1,this.clippingPlanes=this.options.clippingPlanes,this.allowPick=this.options.allowPick,this.nodeProperty=this.options.nodeProperty,this._maximumPriority={foveatedFactor:-Number.MAX_VALUE,depth:-Number.MAX_VALUE,distance:-Number.MAX_VALUE,reverseScreenSpaceError:-Number.MAX_VALUE},this._minimumPriority={foveatedFactor:Number.MAX_VALUE,depth:Number.MAX_VALUE,distance:Number.MAX_VALUE,reverseScreenSpaceError:Number.MAX_VALUE},this.transformRequest=t.transformRequest,this._initializeTileSet(e,this.options),this.cull=!1,this._abortListMap=new Map,this._destroyed=!1,this.parent=t.parent,this.flowOptions=t.flowOptions;}isLoaded(){return 0===this._pendingCount&&0!==this._frameNumber&&0===this._requestedTiles.length}destroy(){this._destroy();}get frameNumber(){return this._frameNumber}setOptions(e){this.options={...this.options,...e};}getTileUrl(e){if(e.startsWith("data:"))return e;if(e=e.replace(/\+/g,"%2B"),this.subIPs&&this.subIPs.length>0){let t="";return hc.test(e)&&(t=`${e.replace(hc,`//${this.subIPs[Math.floor(Math.random()*this.subIPs.length)]}`)}${this.queryParams}`),_c.test(e)&&(t=`${e.split("/")[0]}//${e.replace(_c,`${this.subIPs[Math.floor(Math.random()*this.subIPs.length)]}`)}${this.queryParams}`),La({baseUrl:this.url,url:t})}return La({baseUrl:this.url,url:e})}update(e,t){if("loadTiles"in this.options&&!this.options.loadTiles)return;if(this.traverseCounter>0)return;e instanceof Array||(e=[e]),this._cache.reset(),this._frameNumber++,++this._updatedVisibilityFrame,this.traverseCounter=e.length;const i=[];for(const t of e){const e=t.id;this._needTraverse(e)?i.push(e):this.traverseCounter--;}for(const s of e){const e=s.id;if(this.roots[e]||(this.roots[e]=this._initializeTileHeaders(this.tileset,null,this.basePath)),!i.includes(e))continue;const r=E_(s,this._frameNumber,t);this._traverser.traverse(this.roots[e].tileset,r,this.options);}}_needTraverse(e){let t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}_onTraversalEnd(e){const t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const i=this.frameStateData[t],s=Object.values(this._traverser.selectedTiles);i.selectedTiles=s,i._requestedTiles=Object.values(this._traverser.requestedTiles),i._emptyTiles=Object.values(this._traverser.emptyTiles),this.cull=!(s.length>0),this.traverseCounter--,this.traverseCounter>0||this._updateTiles();}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles);}this._loadTiles(),this._unloadTiles(),this._updateStats();}_tilesChanged(e,t){if(e.length!==t.length)return !0;const i=new Set(e.map((e=>e.id))),s=new Set(t.map((e=>e.id)));let r=e.filter((e=>!s.has(e.id))).length>0;return r=r||t.filter((e=>!i.has(e.id))).length>0,r}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e);}_unloadTiles(){this._cache.unloadTiles(this,((e,t)=>e._unloadTile(t)));}_updateStats(){let e=0,t=0;for(const i of this.selectedTiles)i.contentAvailable&&(e++,i.content.pointCount&&(t+=i.content.pointCount));this.stats.get(tc).count=this.selectedTiles.length,this.stats.get(ic).count=e,this.stats.get(ac).count=t;}_initializeTileSet(e){this.root=this._initializeTileHeaders(e,null,this.basePath),this.type===B_&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===R_&&this._initializeI3STileset(e);}calculateViewPropsTiles3D(){const t=this.root,{center:i}=t.boundingVolume;if(!i)return console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new e.Vector3,void(this.zoom=1);0!==i[0]||0!==i[1]||0!==i[2]?(this.cartographicCenter=new e.Vector3,e.Ellipsoid.WGS84.cartesianToCartographic(i,this.cartographicCenter)):this.cartographicCenter=new e.Vector3(0,0,-e.Ellipsoid.WGS84.radii[0]),this.cartesianCenter=i,this.zoom=function(e){const{halfAxes:t,radius:i,width:s,height:r}=e;if(t){const e=function(e){e.getColumn(0,P_);const t=e.getColumn(1),i=e.getColumn(2);return P_.add(t).add(i).len()}(t);return Math.log2(M_/e)}return i?Math.log2(M_/i):r&&s?(Math.log2(6378137/s)+Math.log2(6378137/r))/2:1}(t.boundingVolume);}_initializeStats(){this.stats.get($_),this.stats.get(rc),this.stats.get(ec),this.stats.get(tc),this.stats.get(ic),this.stats.get(sc),this.stats.get(nc),this.stats.get(oc),this.stats.get(ac,"memory"),this.stats.get(lc,"memory");}_initializeTileHeaders(e,t,i){const s=new W_(this,e.root,t,i,void 0);if(t&&(t.children.push(s),s.depth=t.depth+1),this.type===B_){const e=[];for(e.push(s);e.length>0;){const t=e.pop();this.stats.get($_).incrementCount();const s=t.header.children||[];for(const r of s){const s=new W_(this,r,t,i,void 0);t.children.push(s),s.depth=t.depth+1,e.push(s);}}}return s}_initializeTraverser(){let e;switch(this.type){case B_:e=X_;break;case R_:e=Q_;break;default:e=Z_;}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e);}async _loadTile(e){let t;try{this._onStartTileLoading(),t=await e.loadContent();}catch(t){this._onTileLoadError(e,t instanceof Error?t:new Error("load failed"));}finally{this._onEndTileLoading(),this._onTileLoad(e,t);}}_onTileLoadError(e,t){this.stats.get(oc).incrementCount();const i=t.message||t.toString(),s=e.contentUrl;console.error(`A 3D tile failed to load: ${e.contentUrl} ${i}`),this.options.onTileError(e,i,s);}_onTileLoad(t,i){i&&(t&&t.content&&function(t,i){jt(t),jt(i);const{computedTransform:s,boundingVolume:{center:r}}=t;let n,o;if("cmpt"===i.type){for(const t of i.tiles){o=t.rtcCenter,n=t.gltfUpAxis;let i=new e.Matrix4(s);if(o){const t=(new e.Matrix4).makeTranslation(o[0],o[1],o[2]);i=i.multiplyRight(t);}if("i3dm"!==t.type)switch(n){case"Z":break;case"Y":const t=(new e.Matrix4).rotateX(Math.PI/2);i=i.multiplyRight(t);break;case"X":const s=(new e.Matrix4).rotateY(-Math.PI/2);i=i.multiplyRight(s);}t.childModelMatrix=i;}return}o=i.rtcCenter,n=i.gltfUpAxis;let a=new e.Matrix4(s);if(o&&a.translate(o),"i3dm"!==i.type)switch(n){case"Z":break;case"Y":const t=(new e.Matrix4).rotateX(Math.PI/2);a=a.multiplyRight(t);break;case"X":const i=(new e.Matrix4).rotateY(-Math.PI/2);a=a.multiplyRight(i);}const l=new e.Vector3(r);i.cartesianModelMatrix=a,i.cartesianOrigin=l;const h=e.Ellipsoid.WGS84.cartesianToCartographic(l,new e.Vector3),_=e.Ellipsoid.WGS84.eastNorthUpToFixedFrame(l).invert();i.cartographicModelMatrix=_.multiplyRight(a),i.cartographicOrigin=h,i.modelMatrix=i.cartographicModelMatrix;}(t,t.content),this._addTileToCache(t),this.options.onTileLoad(t));}_onStartTileLoading(){this._pendingCount++,this.stats.get(rc).incrementCount();}_onEndTileLoading(){this._pendingCount--,this.stats.get(rc).decrementCount();}_addTileToCache(e){this._cache.add(this,e,(t=>t._updateCacheStats(e)));}_updateCacheStats(e){this.stats.get(sc).incrementCount(),this.stats.get(ec).incrementCount(),this.gpuMemoryUsageInBytes+=e.content.byteLength||0,this.gpuMemoryUsageInBytes+=e.content.gltf?e.content.gltf.textureByteSize:0,this.stats.get(lc).count=this.gpuMemoryUsageInBytes;}_unloadTile(t){e.defined(t.content)&&(this.gpuMemoryUsageInBytes-=t.content.byteLength||0,this.gpuMemoryUsageInBytes-=t.content.gltf?t.content.gltf.textureByteSize:0,this.stats.get(ec).decrementCount(),this.stats.get(nc).incrementCount(),this.stats.get(lc).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent());}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const t=e.pop();for(const i of t.children)e.push(i);this._destroyTile(t);}this.root=null;}_destroySubtree(e){const t=e,i=[];for(i.push(t);i.length>0;){e=i.pop();for(const t of e.children)i.push(t);e!==t&&this._destroyTile(e);}t.children=[];}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy();}_initializeTiles3DTileset(e){if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version&&"1.1"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras;}_initializeI3STileset(e){"token"in this.options&&(this._queryParams.token=this.options.token),this._defaultGeometrySchema=e.store.defaultGeometrySchema;}hasExtension(e){return Boolean(this._extensionsUsed&&this._extensionsUsed.indexOf(e)>-1)}trimTiles(){this._cache.trim();}get queryParams(){return this._queryParamsString||(this._queryParamsString=function(e){const t=[];for(const i of Object.keys(e))t.push(`${i}=${e[i]}`);switch(t.length){case 0:return "";case 1:return `?${t[0]}`;default:return `?${t.join("&")}`}}(this._queryParams)),this._queryParamsString}}const uc="undefined"!=typeof __VERSION__?__VERSION__:"latest";function mc(e,t,i){jt(e instanceof ArrayBuffer);const s=new TextDecoder("utf8"),r=new Uint8Array(e.slice(t,t+i));return s.decode(r)}const pc={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},fc={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,...pc},gc={[pc.DOUBLE]:Float64Array,[pc.FLOAT]:Float32Array,[pc.UNSIGNED_SHORT]:Uint16Array,[pc.UNSIGNED_INT]:Uint32Array,[pc.UNSIGNED_BYTE]:Uint8Array,[pc.BYTE]:Int8Array,[pc.SHORT]:Int16Array,[pc.INT]:Int32Array},yc={DOUBLE:pc.DOUBLE,FLOAT:pc.FLOAT,UNSIGNED_SHORT:pc.UNSIGNED_SHORT,UNSIGNED_INT:pc.UNSIGNED_INT,UNSIGNED_BYTE:pc.UNSIGNED_BYTE,BYTE:pc.BYTE,SHORT:pc.SHORT,INT:pc.INT},Tc="Failed to convert GL type";class Cc{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const t in gc)if(gc[t]===e)return t;throw new Error(Tc)}static fromName(e){const t=yc[e];if(!t)throw new Error(Tc);return t}static getArrayType(e,t=!1){switch(e){case pc.UNSIGNED_SHORT_5_6_5:case pc.UNSIGNED_SHORT_4_4_4_4:case pc.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const t=gc[e];if(!t)throw new Error(Tc);return t}}static getByteSize(e){return Cc.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return Boolean(Cc.getArrayType(e))}static createTypedArray(e,t,i=0,s){return void 0===s&&(s=(t.byteLength-i)/Cc.getByteSize(e)),new(Cc.getArrayType(e))(t,i,s)}}function xc(e,t=[0,0,0]){const i=e>>5&63,s=31&e;return t[0]=(e>>11&31)<<3,t[1]=i<<2,t[2]=s<<3,t}class bc{constructor(e,t){this.json=e,this.buffer=t,this.featuresLength=0,this._cachedTypedArrays={};}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return Boolean(this.json[e])}getGlobalProperty(e,t=fc.UNSIGNED_INT,i=1){const s=this.json[e];return s&&Number.isFinite(s.byteOffset)?this._getTypedArrayFromBinary(e,t,i,1,s.byteOffset):s}getPropertyArray(e,t,i){const s=this.json[e];return s&&Number.isFinite(s.byteOffset)?("componentType"in s&&(t=Cc.fromName(s.componentType)),this._getTypedArrayFromBinary(e,t,i,this.featuresLength,s.byteOffset)):this._getTypedArrayFromArray(e,t,s)}getProperty(e,t,i,s,r){const n=this.json[e];if(!n)return n;const o=this.getPropertyArray(e,t,i);if(1===i)return o[s];for(let e=0;e<i;++e)r[e]=o[i*s+e];return r}_getTypedArrayFromBinary(e,t,i,s,r){const n=this._cachedTypedArrays;let o=n[e];return o||(o=Cc.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+r,s*i),n[e]=o),o}_getTypedArrayFromArray(e,t,i){const s=this._cachedTypedArrays;let r=s[e];return r||(r=Cc.createTypedArray(t,i),s[e]=r),r}}const vc={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},wc={SCALAR:(e,t)=>e[t],VEC2:(e,t)=>[e[2*t+0],e[2*t+1]],VEC3:(e,t)=>[e[3*t+0],e[3*t+1],e[3*t+2]],VEC4:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT2:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT3:(e,t)=>[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]],MAT4:(e,t)=>[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]},Sc={SCALAR:(e,t,i)=>{t[i]=e;},VEC2:(e,t,i)=>{t[2*i+0]=e[0],t[2*i+1]=e[1];},VEC3:(e,t,i)=>{t[3*i+0]=e[0],t[3*i+1]=e[1],t[3*i+2]=e[2];},VEC4:(e,t,i)=>{t[4*i+0]=e[0],t[4*i+1]=e[1],t[4*i+2]=e[2],t[4*i+3]=e[3];},MAT2:(e,t,i)=>{t[4*i+0]=e[0],t[4*i+1]=e[1],t[4*i+2]=e[2],t[4*i+3]=e[3];},MAT3:(e,t,i)=>{t[9*i+0]=e[0],t[9*i+1]=e[1],t[9*i+2]=e[2],t[9*i+3]=e[3],t[9*i+4]=e[4],t[9*i+5]=e[5],t[9*i+6]=e[6],t[9*i+7]=e[7],t[9*i+8]=e[8],t[9*i+9]=e[9];},MAT4:(e,t,i)=>{t[16*i+0]=e[0],t[16*i+1]=e[1],t[16*i+2]=e[2],t[16*i+3]=e[3],t[16*i+4]=e[4],t[16*i+5]=e[5],t[16*i+6]=e[6],t[16*i+7]=e[7],t[16*i+8]=e[8],t[16*i+9]=e[9],t[16*i+10]=e[10],t[16*i+11]=e[11],t[16*i+12]=e[12],t[16*i+13]=e[13],t[16*i+14]=e[14],t[16*i+15]=e[15];}},Ac=e=>void 0!==e;function Ec(e,t,i){if(!e)return;const s=e.parentCounts;return e.parentIds?i(e,t):s>0?function(e,t,i){const s=e.parentCounts,r=e.parentIds,n=e.parentIndexes,o=scratchVisited;o.length=Math.max(o.length,e.classIds.length);const a=++marker,l=scratchStack;for(l.length=0,l.push(t);l.length>0;){if(o[t=l.pop()]===a)continue;o[t]=a;const h=i(e,t);if(Ac(h))return h;const _=s[t],c=n[t];for(let e=0;e<_;++e){const i=r[c+e];i!==t&&l.push(i);}}return null}(e,t,i):function(e,t,i){let s=!0;for(;s;){const r=i(e,t);if(Ac(r))return r;const n=e.parentIds[t];s=n!==t,t=n;}throw new Error("traverseHierarchySingleParent")}(e,t,i)}function Mc(e,t,i){const s=e.parentCounts,r=e.parentIds,n=e.parentIndexes,o=e.classIds.length;if(!Ac(r))return;assert(t<o,`Parent index ${t} exceeds the total number of instances: ${o}`),assert(-1===i.indexOf(t),"Circular dependency detected in the batch table hierarchy."),i.push(t);const a=Ac(s)?s[t]:1,l=Ac(s)?n[t]:t;for(let s=0;s<a;++s){const n=r[l+s];n!==t&&Mc(e,n,i);}i.pop(t);}function Pc(t,i,s,r){if("function"==typeof t.fill)return t.fill(i,s,r);const n=t.length>>>0,o=e.defaultValue(s,0);let a=o<0?Math.max(n+o,0):Math.min(o,n);const l=e.defaultValue(r,n),h=l<0?Math.max(n+l,0):Math.min(l,n);for(;a<h;)t[a]=i,a++;return t}class Rc{constructor(t){const i=t.featuresLength;let s,r;if(this._showAlphaProperties=void 0,this._batchValues=void 0,this._batchValuesDirty=!1,this._batchTexture=void 0,this._defaultTexture=void 0,this._pickTexture=void 0,this._pickIds=[],i>0){const t=Math.min(i,e.ContextLimits.maximumTextureSize),n=Math.ceil(i/e.ContextLimits.maximumTextureSize),o=1/t,a=.5*o,l=1/n,h=.5*l;s=new e.Vector2(t,n),r=new e.Vector4(o,a,l,h);}this._translucentFeaturesLength=0,this._featuresLength=i,this._textureDimensions=s,this._textureStep=r,this._owner=t.owner,this._statistics=t.statistics,this._colorChangedCallback=t.colorChangedCallback;}get translucentFeaturesLength(){return this._translucentFeaturesLength}get textureDimensions(){return this._textureDimensions}get textureStep(){return this._textureStep}get batchTexture(){return this._batchTexture}get defaultTexture(){return this._defaultTexture}get pickTexture(){return this._pickTexture}setShow(t,i){if(i&&!e.defined(this._showAlphaProperties))return;const s=Oc(this),r=2*t,n=i?255:0;s[r]!==n&&(s[r]=n,Dc(this)[4*t+3]=i?s[r+1]:0,this._batchValuesDirty=!0);}setAllShow(e){const t=this._featuresLength;for(let i=0;i<t;++i)this.setShow(i,e);}getShow(t){return Lc(t,this._featuresLength),!e.defined(this._showAlphaProperties)||255===this._showAlphaProperties[2*t]}setColor(t,i){if(Lc(t,this._featuresLength),e.Color.equals(i,Rc.DEFAULT_COLOR_VALUE)&&!e.defined(this._batchValues))return;const s=i.toBytes(Vc),r=s[3],n=Dc(this),o=4*t,a=Oc(this),l=2*t;if(n[o]!==s[0]||n[o+1]!==s[1]||n[o+2]!==s[2]||a[l+1]!==r){n[o]=s[0],n[o+1]=s[1],n[o+2]=s[2];const h=255!==a[l+1];n[o+3]=0!==a[l]?r:0,a[l+1]=r;const _=255!==r;_&&!h?++this._translucentFeaturesLength:!_&&h&&--this._translucentFeaturesLength,this._batchValuesDirty=!0,e.defined(this._colorChangedCallback)&&this._colorChangedCallback(t,i);}}setAllColor(e){const t=this._featuresLength;for(let i=0;i<t;++i)this.setColor(i,e);}getColor(t,i){if(Lc(t,this._featuresLength),!e.defined(this._batchValues))return e.Color.clone(Rc.DEFAULT_COLOR_VALUE,i);const s=this._batchValues,r=4*t;return e.Color.fromBytes(s[r],s[r+1],s[r+2],this._showAlphaProperties[2*t+1],i)}getPickColor(e){return Lc(e,this._featuresLength),this._pickIds[e]}update(t){const i=t.context;this._defaultTexture=i.defaultTexture,function(t,i){const s=t._featuresLength;if(!e.defined(t._pickTexture)&&s>0){const r=t._pickIds,n=Ic(t),o=new Uint8Array(n),a=t._owner;for(let t=0;t<s;++t){const s=i.createPickId(a.getFeature(t,a.nodeProperty));r.push(s);const n=s.color,l=4*t;o[l]=e.Color.floatToByte(n.r),o[l+1]=e.Color.floatToByte(n.g),o[l+2]=e.Color.floatToByte(n.b),o[l+3]=e.Color.floatToByte(n.a);}t._pickTexture=Bc(t,i,o);}}(this,i),this._batchValuesDirty&&(this._batchValuesDirty=!1,e.defined(this._batchTexture)?function(e){const t=e._textureDimensions;e._batchTexture.copyFrom({source:{width:t.x,height:t.y,arrayBufferView:e._batchValues}});}(this):this._batchTexture=Bc(this,i,this._batchValues));}destroy(){this._batchTexture=this._batchTexture&&this._batchTexture.destroy(),this._pickTexture=this._pickTexture&&this._pickTexture.destroy();const t=this._pickIds,i=t.length;for(let e=0;e<i;++e)t[e].destroy();return e.destroyObject(this)}getUniformMapCallback(){if(0===this.featuresLength)return;const t=this;return function(i){i?.has("batchTexture")&&i.delete("batchTexture"),i?.has("batch_textureDimensions")&&i.delete("batch_textureDimensions"),i?.has("batch_textureStep")&&i.delete("batch_textureStep"),i?.has("pickColorTexture")&&i.delete("pickColorTexture");const s=new Map([["batchTexture",()=>{const i=e.defaultValue(t.batchTexture,t.defaultTexture);return i.bind(e.TextureMagnificationFilter.NEAREST,e.TextureWrap.CLAMP_TO_EDGE),i}],["batch_textureDimensions",()=>t.textureDimensions],["batch_textureStep",()=>t.textureStep],["pickColorTexture",()=>(t.pickTexture.bind(e.TextureMagnificationFilter.NEAREST,e.TextureWrap.CLAMP_TO_EDGE),t.pickTexture)]]);return e.combineInternalMap(i,s)}}static DEFAULT_COLOR_VALUE=e.Color.white;static DEFAULT_SHOW_VALUE=!0}function Bc(t,i,s){const r=t._textureDimensions;return new e.Texture({context:i,pixelFormat:e.PixelFormat.RGBA,pixelDatatype:e.PixelDatatype.UNSIGNED_BYTE,image:{width:r.x,height:r.y,arrayBufferView:s},flipY:!1})}function Ic(e){const t=e._textureDimensions;return t.x*t.y*4}function Dc(t){if(!e.defined(t._batchValues)){const e=Ic(t),i=new Uint8Array(e);Pc(i,255),t._batchValues=i;}return t._batchValues}function Oc(t){if(!e.defined(t._showAlphaProperties)){const e=new Uint8Array(2*t._featuresLength);Pc(e,255),t._showAlphaProperties=e;}return t._showAlphaProperties}function Lc(t,i){if(!e.defined(t)||t<0||t>=i)throw new Error(`batchId is required and between zero and featuresLength - 1 (${i}`-NaN)}const Vc=new Array(4);class Nc{constructor(e,t,i){this._batchId=e,this._nodeProperty=t,this._content=i,this._color=void 0,this._properties=void 0;}get color(){return e.defined(this._color)||(this._color=new e.Color),this._content._batchTexture.getColor(this._batchId,this._color)}set color(t){t=e.Color.parse(t).toVector4(),e.defined(this._color)||(this._color=new e.Color),t[3]=0===t[3]?.98:t[3]<1?1-t[3]:t[3],this._color.set(t),this._content._batchTexture.setColor(this._batchId,this._color);}get show(){return this._content._batchTexture.getShow(this._batchId)}set show(e){this._content._batchTexture.setShow(this._batchId,e);}hasProperty(e){return this._content.hasProperty(this._batchId,e)}getPropertyNames(e){return this._content.getPropertyNames(this._batchId,e)}getProperty(e){return this._content.getProperty(this._batchId,e)}getProperties(){if(!this._properties){this._properties={};const e=this.getPropertyNames();for(let t=0;t<e.length;t++){const i=e[t];this._properties[i]=this.getProperty(i);}}return this._properties}getParentPrimitive(e){return this._content.getParentPrimitive(e.painter.context)}destroy(){this._content=void 0,this._batchId=void 0,this._color=void 0,this._properties=void 0;}}function Fc(e){return null!=e}const Gc=(e,t)=>e,kc={HIERARCHY:!0,extensions:!0,extras:!0};class Uc{constructor(e,t,i,s,r,n={}){jt(i>=0),this.json=e||{},this.binary=t,this.featureCount=i,this._extensions=this.json&&this.json.extensions||{},this.nodeProperty=r,this._properties={};for(const e in this.json)kc[e]||(this._properties[e]=this.json[e]);this._binaryProperties=this._initializeBinaryProperties(),n["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=function(e,t,i){if(!t)return null;let s=e.getExtension("3DTILES_batch_table_hierarchy");const r=t.HIERARCHY;return r&&(t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=r,s=r),s?function(e,t){let i,s,r;const n=e.instancesLength,o=e.classes;let a,l=e.classIds,h=e.parentCounts,_=e.parentIds,c=n;if(Ac(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,r=getBinaryAccessor(l),l=r.createArrayBufferView(t.buffer,t.byteOffset+l.byteOffset,n)),Ac(h))for(Ac(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,r=getBinaryAccessor(h),h=r.createArrayBufferView(t.buffer,t.byteOffset+h.byteOffset,n)),a=new Uint16Array(n),c=0,i=0;i<n;++i)a[i]=c,c+=h[i];Ac(_)&&Ac(_.byteOffset)&&(_.componentType=defaultValue(_.componentType,GL.UNSIGNED_SHORT),_.type=AttributeType.SCALAR,r=getBinaryAccessor(_),_=r.createArrayBufferView(t.buffer,t.byteOffset+_.byteOffset,c));const d=o.length;for(i=0;i<d;++i){const e=o[i].instances,s=getBinaryProperties(o[i].length,e,t);o[i].instances=combine(s,e);}const u=new Array(d).fill(0),m=new Uint16Array(n);for(i=0;i<n;++i)s=l[i],m[i]=u[s],++u[s];const p={classes:o,classIds:l,classIndexes:m,parentCounts:h,parentIndexes:a,parentIds:_};return function(e){const t=e.classIds.length;for(let i=0;i<t;++i)Mc(e,i,stack);}(p),p}(s,i):null}(this,this.json,this.binary)),this._batchTexture=new Rc({featuresLength:i,owner:this}),this._features=void 0,this._url=s,this._parentPickColor=void 0;}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){return this._checkBatchId(e),jt("string"==typeof t,t),!!this._hierarchy&&Fc(Ec(this._hierarchy,e,((e,i)=>e.classes[e.classIds[i]].name===t)))}isExactClass(e,t){return jt("string"==typeof t,t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy)return this._hierarchy.classes[this._hierarchy.classIds[e]].name}hasProperty(e,t){return this._checkBatchId(e),jt("string"==typeof t,t),Fc(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),(t=Fc(t)?t:[]).length=0;const i=Object.keys(this._properties);return t.push(...i),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),jt("string"==typeof t,t),this._binaryProperties){const i=this._binaryProperties[t];if(Fc(i))return this._getBinaryProperty(i,e)}const i=this._properties[t];if(Fc(i))return Gc(i[e]);if(this._hierarchy){const i=this._getHierarchyProperty(e,t);if(Fc(i))return i}}setProperty(e,t,i){const s=this.featureCount;if(this._checkBatchId(e),jt("string"==typeof t,t),this._binaryProperties){const s=this._binaryProperties[t];if(s)return void this._setBinaryProperty(s,e,i)}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,i))return;let r=this._properties[t];Fc(r)||(this._properties[t]=new Array(s),r=this._properties[t]),r[e]=Gc(i);}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,i){e.pack(i,e.typedArray,t);}_initializeBinaryProperties(){let e=null;for(const t in this._properties){const i=this._initializeBinaryProperty(t,this._properties[t]);i&&(e=e||{},e[t]=i);}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){const i=t;jt(this.binary,`Property ${e} requires a batch table binary.`),jt(i.type,`Property ${e} requires a type.`);const s=function(e,t,i,s){const{componentType:r}=e;jt(e.componentType);const n="string"==typeof r?Cc.fromName(r):r,o=vc[e.type],a=wc[e.type],l=Sc[e.type];return {values:Cc.createTypedArray(n,t,i+=e.byteOffset,o*s),type:n,size:o,unpacker:a,packer:l}}(i,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return {typedArray:s.values,componentCount:s.size,unpack:s.unpacker,pack:s.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return !1;const i=Ec(this._hierarchy,e,((e,i)=>Fc(e.classes[e.classIds[i]].instances[t])));return Fc(i)}_getPropertyNamesInHierarchy(e,t){Ec(this._hierarchy,e,((e,i)=>{const s=e.classes[e.classIds[i]].instances;for(const e in s)s.hasOwnProperty(e)&&-1===t.indexOf(e)&&t.push(e);}));}_getHierarchyProperty(e,t){return Ec(this._hierarchy,e,((e,i)=>{const s=e.classIndexes[i],r=e.classes[e.classIds[i]].instances[t];return Fc(r)?Fc(r.typedArray)?this._getBinaryProperty(r,s):Gc(r[s]):null}))}_setHierarchyProperty(e,t,i,s){const r=Ec(this._hierarchy,t,((e,r)=>{const n=e.classIndexes[r],o=e.classes[e.classIds[r]].instances[i];return !!Fc(o)&&(jt(r===t,`Inherited property "${i}" is read-only.`),Fc(o.typedArray)?this._setBinaryProperty(o,n,s):o[n]=Gc(s),!0)}));return Fc(r)}getFeature(e,t){const i=this.featuresLength;if(!Fc(e)||e<0||e>=i)throw new Error(`batchId is required and between zero and featuresLength - 1 (${i-1}).`);return function(e,t){const i=t.featureCount;if(!Fc(t._features)&&i>0){const s=new Array(i);for(let r=0;r<i;++r)s[r]=new Nc(r,e,t);t._features=s;}}(t,this),this._features[e]}update(e,t,i){i&&(this._parentPickColor=i),this._batchTexture.update(e,t);}getParentPrimitive(e){return this._parentPickColor?e.getObjectByPickColor(this._parentPickColor):void 0}destroy(){this._hierarchy=void 0,this.json=void 0,this.binary=void 0,this.featureCount=0,this._properties=void 0,this._extensions=void 0,this._binaryProperties=void 0,this._batchTexture.destroy();}}const Hc=4;function zc(e,t,i=0){const s=new DataView(t);if(e.magic=s.getUint32(i,!0),e.version=s.getUint32(i+=Hc,!0),e.byteLength=s.getUint32(i+=Hc,!0),i+=Hc,1!==e.version)throw new Error(`3D Tile Version ${e.version} not supported`);return i}const Wc=4;function jc(e,t,i){const s=new DataView(t);return e.header=e.header||{},e.header.featureTableJsonByteLength=s.getUint32(i,!0),e.header.featureTableBinaryByteLength=s.getUint32(i+=Wc,!0),e.header.batchTableJsonByteLength=s.getUint32(i+=Wc,!0),e.header.batchTableBinaryByteLength=s.getUint32(i+=Wc,!0),i+Wc}function Xc(e,t,i,s){return i=function(e,t,i,s){const{featureTableJsonByteLength:r,featureTableBinaryByteLength:n}=e.header;if(e.featureTableJson={BATCH_LENGTH:0},r>0){const s=mc(t,i,r);e.featureTableJson=JSON.parse(s);}return i+=r,e.featureTableBinary=new Uint8Array(t.slice(i,i+n)),i+n}(e,t,i),i=function(e,t,i,s){const{batchTableJsonByteLength:r,batchTableBinaryByteLength:n}=e.header;if(r>0){const s=mc(t,i,r);e.batchTableJson=JSON.parse(s),i+=r,n>0&&(e.batchTableBinary=new Uint8Array(t.slice(i,i+n)),e.batchTableBinary=new Uint8Array(e.batchTableBinary),i+=n);}return i}(e,t,i),i}function qc(e,t,i){if(!(t||e&&e.batchIds&&i))return null;const{isRGB565:s,pointCount:r}=e;if(s){const e=new Uint8ClampedArray(3*r);for(let i=0;i<r;i++){const s=xc(t[i]);e[3*i]=s[0],e[3*i+1]=s[1],e[3*i+2]=s[2];}return {type:fc.FLOAT,value:Float32Array.from(t),size:3,normalized:!0}}if(t&&t.length===3*r){const e=Float32Array.from(t).map((e=>e/255));return {type:fc.FLOAT,value:e,size:3,normalized:!0}}if(t&&t.length===4*r){const e=Float32Array.from(t).map((e=>e/255));return {type:fc.FLOAT,value:e,size:4,normalized:!0}}const n=new Float32Array(3*r);for(let e=0;e<r;e++)n[3*e]=0,n[3*e+1]=0,n[3*e+2]=0;return {type:fc.FLOAT,value:n,size:3,normalized:!0}}const Kc=new e.Vector3;const Jc={URI:0,EMBEDDED:1};function Zc(t,i,s,r){t.rotateYtoZ=!0;const n=t.byteOffset+t.byteLength-s;if(0===n)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=r["3d-tiles"]&&r["3d-tiles"].assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=function(t,i,s){return function(t,i,s){let r;try{r=e.defined(s)&&s+i<=t.length?t.slice(i,i+s):t.slice(i);}catch(e){console.log(e);}finally{return r||(new Uint8Array).buffer}}(t,i,s)}(i,s,n),t.gltfByteOffset=0,t.gltfByteLength=n,s%4==0||console.warn(`${t.type}: embedded glb is not aligned to a 4-byte boundary.`),(t.byteOffset||0)+(t.byteLength||0)}async function Yc(e,t,i,s){const r=i["3d-tiles"]||{};if(function(e,t,i){switch(t){case Jc.URI:const t=new Uint8Array(e.gltfArrayBuffer.slice(e.gltfByteOffset)),i=(new TextDecoder).decode(t);e.gltfUrl=i.replace(/[\s\0]+$/,""),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case Jc.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}(e,t),r.loadGLTF){const{_parse:t,fetch:r}=s;if(e.gltfUrl){let t=e.gltfUrl;if(-1==t.indexOf("http://")||-1==t.indexOf("https://")){let e=ki(i.url);"/"!=t[0]&&(e+="/"),t=e+t;}e.gltfArrayBuffer=await r(t,i),e.gltfByteOffset=0;}e.gltfArrayBuffer&&(e.instances&&(i.instances=e.instances),e.batchTable&&(i.batchTable=e.batchTable),e.gltf=await t(e.gltfArrayBuffer,Ga,i,s),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength);}}function Qc(t,i,s){return i=i||0,s||(s=new e.Vector3),s.x=t[i++],s.y=t[i++],s.z=t[i],s}function $c(t,i,s,r){r||(r=new e.Matrix4);const n=s.x,o=s.y,a=s.z,l=i.x*i.x,h=i.x*i.y,_=i.x*i.z,c=i.x*i.w,d=i.y*i.y,u=i.y*i.z,m=i.y*i.w,p=i.z*i.z,f=i.z*i.w,g=i.w*i.w,y=2*(h-f),T=2*(_+m),C=2*(h+f),x=-l+d-p+g,b=2*(u-c),v=2*(_-m),w=2*(u+c),S=-l-d+p+g;return r[0]=(l-d-p+g)*n,r[1]=C*n,r[2]=v*n,r[3]=0,r[4]=y*o,r[5]=x*o,r[6]=w*o,r[7]=0,r[8]=T*a,r[9]=b*a,r[10]=S*a,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,r}async function ed(t,i=0,s,r,n={}){switch(n.byteOffset=i,n.type=function(e,t=0){const i=new DataView(e);return `${String.fromCharCode(i.getUint8(t+0))}${String.fromCharCode(i.getUint8(t+1))}${String.fromCharCode(i.getUint8(t+2))}${String.fromCharCode(i.getUint8(t+3))}`}(t,i),n.type){case"cmpt":return await async function(e,t,i,s,r,n){i=zc(e,t,i);const o=new DataView(t);for(e.tilesLength=o.getUint32(i,!0),i+=4,e.tiles=[];e.tiles.length<e.tilesLength;){const o={};e.tiles.push(o),i=await n(t,i,s,r,o);}return i}(n,t,i,s,r,ed);case"b3dm":return await async function(e,t,i,s,r){i=function(e,t,i,s,r){i=Zc(e,t,i=Xc(e,t,i=jc(e,t,i=zc(e,t,i))),s);const n=new bc(e.featureTableJson,e.featureTableBinary);e.rtcCenter=n.getGlobalProperty("RTC_CENTER",fc.FLOAT,3),e.featureTable=n;const o=n.getGlobalProperty("BATCH_LENGTH");return e.batchTable=new Uc(e.batchTableJson,e.batchTableBinary,o,r.url,s.nodeProperty),delete e.featureTableJson,delete e.featureTableBinary,delete e.batchTableJson,delete e.batchTableBinary,i}(e,t,i,s,r),await Yc(e,Jc.EMBEDDED,s,r);const{extensions:n}=e.gltf||{};return n&&n.CESIUM_RTC&&(e.rtcCenter=n.CESIUM_RTC.center),i}(n,t,i,s,r);case"glTF":return await async function(e,t,i,s){if(e.rotateYtoZ=!0,e.gltfUpAxis=i?.["3d-tiles"]?.assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",i?.["3d-tiles"]?.loadGLTF){if(!s)return t.byteLength;const r=await async function(e,t,i,s){return s._parse(e,t,i,s)}(t,Ga,i,s);e.gltf=Ma(r,i),e.gpuMemoryUsageInBytes=function(e){let{images:t,bufferViews:i}=e;t=t||[],i=i||[];const s=t.map((e=>e.bufferView));return i=i.filter((e=>!s.includes(e))),i.reduce(((e,t)=>e+t.byteLength),0)+Math.ceil(4*(e.imagesSize||0)*1.33)}(e.gltf);}else e.gltfArrayBuffer=t;for(let t=0;e.gltf.bufferViews&&t<e.gltf.bufferViews.length;t++)e.gltf.bufferViews[t].data=null,e.gltf.bufferViews[t].buffer=null;for(let t=0;e.gltf.images&&t<e.gltf.images.length;t++)e.gltf.images[t].bufferView=null,e.gltf.images[t].image=null;return t.byteLength}(n,t,s,r);case"i3dm":return await async function(t,i,s,r,n){return s=function(t,i,s,r,n){if(s=zc(t,i,s),1!==t.version)throw new Error(`Instanced 3D Model version ${t.version} is not supported`);s=jc(t,i,s);const o=new DataView(i);if(t.gltfFormat=o.getUint32(s,!0),s=Zc(t,i,s=Xc(t,i,s+=4),r),0===t.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const a=new bc(t.featureTableJson,t.featureTableBinary),l=a.getGlobalProperty("INSTANCES_LENGTH");if(a.featuresLength=l,!Number.isFinite(l))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=a.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=a.getGlobalProperty("RTC_CENTER",fc.FLOAT,3);const h=new Uc(t.batchTableJson,t.batchTableBinary,l,n.url);return h._url=n.url,function(t,i,s,r){const n=new Array(r),o=new e.Vector3,a=new e.Vector3,l=new e.Vector3,h=new e.Vector3,_=new e.Matrix3,c=new e.Quaternion,d=new e.Vector3,u={},m=new e.Matrix4,p=[],f=[],g=new e.Vector3,y=new e.Vector3;for(let s=0;s<r;s++){let r;if(i.hasProperty("POSITION"))r=i.getProperty("POSITION",fc.FLOAT,3,s,o);else if(i.hasProperty("POSITION_QUANTIZED")){r=i.getProperty("POSITION_QUANTIZED",fc.UNSIGNED_SHORT,3,s,o);const e=i.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",fc.FLOAT,3,g);if(!e)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const t=i.getGlobalProperty("QUANTIZED_VOLUME_SCALE",fc.FLOAT,3,y);if(!t)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const n=65535;for(let i=0;i<3;i++)r[i]=r[i]/n*t[i]+e[i];}if(!r)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(o.copy(r),u.translation=o,t.normalUp=i.getProperty("NORMAL_UP",fc.FLOAT,3,s,p),t.normalRight=i.getProperty("NORMAL_RIGHT",fc.FLOAT,3,s,f),t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");Qc(t.normalUp,0,l),Qc(t.normalRight,0,a),t.hasCustomOrientation=!0;}else {if(t.octNormalUp=i.getProperty("NORMAL_UP_OCT32P",fc.UNSIGNED_SHORT,2,p),t.octNormalRight=i.getProperty("NORMAL_RIGHT_OCT32P",fc.UNSIGNED_SHORT,2,f),t.octNormalUp){if(!t.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}t.eastNorthUp?(e.Ellipsoid.WGS84.eastNorthUpToFixedFrame(o,m),m.getRotationMatrix3(_)):_.identity();}t.hasCustomOrientation&&(h.copy(a).cross(l).normalize(),_.setColumn(0,a),_.setColumn(1,l),_.setColumn(2,h)),c.fromMatrix3(_),u.rotation=c,d.set(1,1,1);const T=i.getProperty("SCALE",fc.FLOAT,1,s);Number.isFinite(T)&&d.multiplyByScalar(T);const C=i.getProperty("SCALE_NON_UNIFORM",fc.FLOAT,3,s,p);C&&d.scale(C),u.scale=d;let x=i.getProperty("BATCH_ID",fc.UNSIGNED_SHORT,1,s);void 0===x&&(x=s);const b=$c(u.translation,u.rotation,u.scale,new e.Matrix4);if(t.gltfFormat==Jc.URI){const t=(new e.Matrix4).rotateX(-Math.PI/2);b.multiplyRight(t);}n[s]={modelMatrix:b,batchId:x};}t.instances=n;}(t,a,0,l),t.featureTable=a,t.batchTable=h,delete t.featureTableJson,delete t.featureTableBinary,delete t.batchTableJson,delete t.batchTableBinary,s}(t,i,s,r,n),await Yc(t,t.gltfFormat,r,n),s}(n,t,i,s,r);case"pnts":return await async function(t,i,s,r,n){s=Xc(t,i,s=jc(t,i,s=zc(t,i,s))),function(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1;}(t);const{featureTable:o,batchTable:a}=function(e,t){const i=new bc(e.featureTableJson,e.featureTableBinary),s=i.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(s))throw new Error("POINTS_LENGTH must be defined");i.featuresLength=s,e.featuresLength=s,e.pointsLength=s,e.pointCount=s,e.rtcCenter=i.getGlobalProperty("RTC_CENTER",fc.FLOAT,3);const r=function(e,t,i){let s=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",fc.UNSIGNED_SHORT,1),e.batchIds)){const r=t.getGlobalProperty("BATCH_LENGTH");if(!r)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:n,batchTableBinary:o}=e;s=new Uc(n,o,r,i.url);}return s}(e,i,t);return {featureTable:i,batchTable:r}}(t,n);return await async function(t,i,s,r,n){let o,a,l;const h=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];h&&(l=h.properties);const _=i.getExtension("3DTILES_draco_point_compression");if(_){a=_.properties;const e=_.byteOffset,i=_.byteLength;if(!a||!Number.isFinite(e)||!i)throw new Error("Draco properties, byteOffset, and byteLength must be defined");o=t.featureTableBinary.slice(e,e+i),t.hasPositions=Number.isFinite(a.POSITION),t.hasColors=Number.isFinite(a.RGB)||Number.isFinite(a.RGBA),t.hasNormals=Number.isFinite(a.NORMAL),t.hasBatchIds=Number.isFinite(a.BATCH_ID),t.isTranslucent=Number.isFinite(a.RGBA);}if(!o)return !0;const c={buffer:o,properties:{...a,...l},featureTableProperties:a,batchTableProperties:l,dequantizeInShader:!1},d=await async function(t,i,s,r){const{_parse:n}=r,o={...s,draco:{...s.draco,extraAttributes:i.batchTableProperties||{}}};delete o["3d-tiles"],delete o.context;const a=await n(i.buffer,mo,o),l=a.attributes.POSITION&&a.attributes.POSITION.value,h=a.attributes.COLOR_0&&a.attributes.COLOR_0.value,_=a.attributes.NORMAL&&a.attributes.NORMAL.value,c=a.attributes.BATCH_ID&&a.attributes.BATCH_ID.value,d=_&&a.attributes.NORMAL.value.quantization;if(l&&a.attributes.POSITION.value.quantization){const i=a.POSITION.data.quantization,s=i.range;t.quantizedVolumeScale=new e.Vector3(s,s,s),t.quantizedVolumeOffset=new e.Vector3(i.minValues),t.quantizedRange=(1<<i.quantizationBits)-1,t.isQuantizedDraco=!0;}d&&(t.octEncodedRange=(1<<a.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const u={};if(i.batchTableProperties)for(const e of Object.keys(i.batchTableProperties))a.attributes[e]&&a.attributes[e].value&&(u[e.toLowerCase()]=a.attributes[e].value);t.attributes={positions:{type:fc.FLOAT,value:l,size:3,normalized:!0},colors:qc(t,h),normals:_,batchIds:c,...u};}(t,c,r,n);return d}(t,o,0,r,n),function(t,i,s){if(!t.attributes.positions)if(i.hasProperty("POSITION"))t.attributes.positions={type:fc.FLOAT,value:i.getPropertyArray("POSITION",fc.FLOAT,3),size:3,normalized:!0};else if(i.hasProperty("POSITION_QUANTIZED")){const r=i.getPropertyArray("POSITION_QUANTIZED",fc.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65535,t.quantizedVolumeScale=i.getGlobalProperty("QUANTIZED_VOLUME_SCALE",fc.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=i.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",fc.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=function(t,i,s){return t.isQuantized?s["3d-tiles"]&&s["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,function(t,i){const s=new e.Vector3,r=new Float32Array(3*t.pointCount);for(let e=0;e<t.pointCount;e++)s.set(i[3*e],i[3*e+1],i[3*e+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(r,3*e);return r}(t,i)):{type:fc.UNSIGNED_SHORT,value:i,size:3,normalized:!0}:{type:fc.FLOAT,value:i,size:3,normalized:!0}}(t,r,s);}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}(t,o,r),function(e,t,i){if(!e.attributes.colors){let s=null;t.hasProperty("RGBA")?(s=t.getPropertyArray("RGBA",fc.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?s=t.getPropertyArray("RGB",fc.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(s=t.getPropertyArray("RGB565",fc.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=qc(e,s,i);}if(t.hasProperty("CONSTANT_RGBA")){const i=t.getGlobalProperty("CONSTANT_RGBA",fc.UNSIGNED_BYTE,4);e.constantRGBA=i.map((e=>e/255));}}(t,o,a),function(t,i){if(!t.attributes.normals){let s=null;i.hasProperty("NORMAL")?s=i.getPropertyArray("NORMAL",fc.FLOAT,3):i.hasProperty("NORMAL_OCT16P")&&(s=i.getPropertyArray("NORMAL_OCT16P",fc.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=function(t,i){if(!i)return null;if(t.isOctEncoded16P){const s=new Float32Array(3*t.pointsLength);for(let r=0;r<t.pointsLength;r++)e.octDecode(i[2*r],i[2*r+1],Kc),Kc.toArray(s,3*r);return {type:fc.FLOAT,size:2,value:s}}return {type:fc.FLOAT,size:2,value:i}}(t,s);}}(t,o),s}(n,t,i,s,r);default:throw new Error(`3DTileLoader: unknown type ${n.type}`)}}function td(e,t){return e&&e.content&&(e.contentUrl=`${t.basePath}/${e.content.uri||e.content.url}`),e.id=e.contentUrl,e.lodMetricType=I_,e.lodMetricValue=e.geometricError,e.transformMatrix=e.transform,e.type=function(e){if(!e.contentUrl)return "empty";const t=e.contentUrl.split(".").pop();switch(t){case"pnts":return "pointcloud";case"i3dm":case"b3dm":return "scenegraph";default:return t}}(e),e.refine=function(e){switch(e){case"REPLACE":case"replace":return 2;case"ADD":case"add":return 1;default:return e}}(e.refine),e}const id={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:uc,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:async function(t,i,s,r){const n=i["3d-tiles"]||{};let o;return o="auto"===n.isTileset?s.url&&-1!==s.url.indexOf(".json"):n.isTileset,t=o?await async function(t,i,s){const r=JSON.parse((new TextDecoder).decode(t));return r.loader=i.loader||id,r.url=s?.url||"",r.name=i.name||"",r.show=!e.defined(i.show)||i.show,r.opacity=e.defined(i.opacity)?i.opacity:1,r.basePath=ki(r.url),r.root=function(e){const t=e.basePath,i=td(e.root,e);e.gltfUpAxis=e?.asset?.gltfUpAxis||"Y";const s=[];for(s.push(i);s.length>0;){const e=s.pop().children||[];for(const i of e)td(i,{basePath:t}),s.push(i);}return i}(r),r.type=B_,r.shape="tileset3d",r.lodMetricType=I_,r.geometricError?r.lodMetricValue=r.geometricError:(r.geometricError=r.root.geometricError,r.lodMetricValue=r.root.lodMetricValue),r}(t,i,s):await async function(e,t,i){const s={content:{shape:"tile3d",featureIds:null}};return await ed(e,0,t,i,s.content),s.content}(t,i,s),t},options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}},sd="https://api.cesium.com/v1/assets",rd={...id,id:"cesium-ion",name:"Cesium Ion",preload:async function(e,t={}){t=t["cesium-ion"]||{};const{accessToken:i}=t;let s=t.assetId;if(!Number.isFinite(s)){const t=e.match(/\/([0-9]+)\/tileset.json/);s=t&&t[1];}return async function(e,t){if(!t){const i=await async function(e){jt(e);const t=sd,i={Authorization:`Bearer ${e}`},s=await as(t,{headers:i,throws:!0});return await s.json()}(e);for(const e of i.items)"3DTILES"===e.type&&(t=e.id);}const i=await async function(e,t){jt(e,t);const i={Authorization:`Bearer ${e}`},s=`${sd}/${t}`;let r=await as(`${s}`,{headers:i,throws:!0}),n=await r.json();r=await as(`${s}/endpoint`,{headers:i,throws:!0});const o=await r.json();return n={...n,...o},n}(e,t),{type:s,url:r}=i;return jt("3DTILES"===s&&r),i.headers={Authorization:`Bearer ${i.accessToken}`},i}(i,s)},parse:async(e,t,i,s)=>(t["3d-tiles"]=t["cesium-ion"],t.loader=rd,id.parse(e,t,i)),options:{"cesium-ion":{...id.options["3d-tiles"],accessToken:null}}};class nd{constructor(e,t,i){this.attributes=i,this.context=e,this.buffers={},this._parsePntsObject(t);}getBuffers(){return this.buffers}bind(){this.bindPerAttibuteBufferAndPointer();}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e);}enableAttributes(e,t){this.bindPerAttibuteBufferAndPointer(e,t);}setVertexAttribPointers(){}bindPerAttibuteBufferAndPointer(e,t){for(let i=0;i<this.attributes.length;i++){const s=this.attributes[i];this.context.bindVertexBuffer.set(this.buffers[s.name]);const r=t.attributes[s.name];void 0!==r&&(e.enableVertexAttribArray(r),e.vertexAttribPointer(r,s.components,s.type,!1,s.byteStride,s.offset)),this.context.bindVertexBuffer.set(null);}}_parsePntsObject(e){const t=this.context.gl;let i={};for(let s=0;s<this.attributes.length;s++){const r=this.attributes[s],n=r.bufferName,o=r.name;if(i[n])this.buffers[o]=i[n];else {const s=t.createBuffer();this.context.bindVertexBuffer.set(s),t.bufferData(t.ARRAY_BUFFER,e[n],t.STATIC_DRAW),i[n]=s,this.buffers[o]=s;}}i=null;}destroy(){const e=this.context.gl;for(const t in this.buffers)e.deleteBuffer(this.buffers[t]),delete this.buffers[t];this.context=null;}}const od={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class ad{process(t){const{content:i,context:s,customizedColor:r,pointSize:n}=t;this.usesNormals=!1,this.isOctEncoded16P=i.isOctEncoded16P,this.isQuantized=i.isQuantized,this.isRGB565=i.isRGB565,this.isTranslucent=i.isTranslucent,this.isQuantizedDraco=i.isQuantizedDraco,this.isOctEncodedDraco=i.isOctEncodedDraco,this.usesCustomizedColor=!1,this.customizedColor=r;const o=i.attributes.positions.value,a=[];i.attributes.normals&&(this.usesNormals=!0),i.featureTableJson.POSITION?a.push({name:"a_POSITION",type:i.attributes.positions.type,components:3,offset:i.featureTableJson.POSITION.byteOffset,byteStride:3*e.WebGLSizes[i.attributes.positions.type],bufferName:"vertexBuf"}):i.featureTableJson.POSITION_QUANTIZED&&a.push({name:"a_POSITION",type:i.attributes.positions.type,components:3,offset:0,byteStride:3*e.WebGLSizes[i.attributes.positions.type],bufferName:"vertexBuf"});let l=null;i.attributes.colors&&(this.colorSize=i.attributes.colors.size,l=i.attributes.colors.value,a.push({name:"a_RGB",type:i.attributes.colors.type,components:i.attributes.colors.size,offset:0,byteStride:i.attributes.colors.size*e.WebGLSizes[i.attributes.colors.type],bufferName:"colorBuf"})),this.attributesForVertexShader="";const h=i.batchTableBinary;for(const t in i.batchTableJson){const s=i.batchTableJson[t];if(s.byteOffset){const i=`a_${t}`;this.attributesForVertexShader+=`attribute ${e.WebGLComponentToShaderVariableType[s.type]} ${i}; \n`,a.push({name:i,type:od[s.componentType],components:e.WebGLComponentCounts[s.type],offset:s.byteOffset,byteStride:(_=s.type,c=od[s.componentType]||5126,e.WebGLComponentCounts[_]*e.WebGLSizes[c]),bufferName:"propertyBuf"});}this.customizedColor&&t===this.customizedColor.property&&(this.usesCustomizedColor=!0);}var _,c;this.customizedColor&&!this.usesCustomizedColor&&console.warn(`Point cloud does not have property named ${this.customizedColor.property}`);const d=e.createLayoutPnts(a),u=new nd(s,{propertyBuf:h,vertexBuf:o,colorBuf:l},d.members),m={segmentVector:e.SegmentVector.simpleSegment(0,0,i.pointCount,i.pointCount),layoutVertexBuffer:u,mode:e.WebGLConstants.POINTS,count:i.pointCount,u_PointSize:n};if(this.isQuantized){const t=i.featureTableJson.QUANTIZED_VOLUME_SCALE,s=i.featureTableJson.QUANTIZED_VOLUME_OFFSET;m.u_QuantizedOffset=new e.Vector3(s[0],s[1],s[2]),m.u_QuantizedVolumeScaleAndOctEncodedRange=new e.Vector4(t[0],t[1],t[2],255);}if(!i.attributes.colors)if(i.constantRGBA){const t=i.constantRGBA;m.u_ConstantColor=new e.Color(t[0],t[1],t[2],t[3]);}else m.u_ConstantColor=new e.Color(0,0,0,1);return m}genPropertyFunction(){}static genShaderScript(t,i){let s="precision highp float;\nprecision highp int;\nattribute vec3 a_POSITION; \nvarying vec4 v_color; \nuniform vec4 u_ConstantColor; \nuniform vec4 u_HighlightColor; \nuniform mat4 u_ModelMatrix; \nuniform bool u_InShadow;\nuniform mat4 u_ModelViewProjectionMatrix; \n";return s+="uniform float u_PointSize; \n",s+=t.attributesForVertexShader,(t.isQuantized||t.isQuantizedDraco||t.isOctEncodedDraco)&&(s+="uniform vec4 u_QuantizedVolumeScaleAndOctEncodedRange; \n",s+="uniform vec3 u_QuantizedOffset; \n"),t.colorSize&&(s+=3===t.colorSize?"attribute vec3 a_RGB; \n":"attribute vec4 a_RGB; \n"),s+="#include <fn_getExponentialInterpColor>\n",s+="void main() \n{ \n",t.isQuantized?(s+="    const float inv65535=1.0/65535.0;\n",s+="    vec3 position = a_POSITION * u_QuantizedVolumeScaleAndOctEncodedRange.xyz / 65535.0  + u_QuantizedOffset;\n",s+="    vec3 posOri = a_POSITION * u_QuantizedVolumeScaleAndOctEncodedRange.xyz / 65535.0 + u_QuantizedOffset;\n"):(s+="    vec3 position = a_POSITION; \n",s+="    vec3 posOri = a_POSITION; \n"),s+="    vec3 position_absolute = vec3(u_ModelMatrix * vec4(position, 1.0)); \n",s+="    vec3 normal = vec3(1.0); \n",s+="    gl_PointSize = u_PointSize; \n",t.customizedColor?(s+=e.genColorBarScript(t.customizedColor,!0),s+="    v_color = color; \n"):s+=t.colorSize?3===t.colorSize?"    v_color = vec4(a_RGB, 1.0); \n":"    v_color = a_RGB; \n":"    v_color = u_ConstantColor; \n",i&&(s+=i),s+="    const float EPS=12.0;\n",s+="    if(u_InShadow==true){gl_Position=u_ModelViewProjectionMatrix*vec4(posOri,1.0);}\n",s+="    else {gl_Position=u_ModelViewProjectionMatrix*vec4(position,1.0);}\n",s+="} \n",{vs:s,fs:"varying vec4 v_color;\n\nvoid main() {\n    gl_FragColor = v_color;\n}"}}}class ld extends e.Material{constructor(t){super(t),this._color=t.u_ConstantColor||new e.Color(0,0,0),this.u_PointSize=t.u_PointSize||1,this.u_QuantizedOffset=t.u_QuantizedOffset,this.u_QuantizedVolumeScaleAndOctEncodedRange=t.u_QuantizedVolumeScaleAndOctEncodedRange,this.updateRenderState(),this.createUniforms(),this.buildDefines();}update(e,t,i={}){super.update(e,t,i),this.updateRenderState();}updateRenderState(){this.renderState={depthTest:{enabled:!0,func:e.WebGLConstants.LESS},blending:{enabled:!0,color:{red:0,green:0,blue:0,alpha:0},equationRgb:e.WebGLConstants.FUNC_ADD,equationAlpha:e.WebGLConstants.FUNC_ADD,functionSourceRgb:e.WebGLConstants.SRC_ALPHA,functionSourceAlpha:e.WebGLConstants.ONE,functionDestinationRgb:e.WebGLConstants.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:e.WebGLConstants.ONE_MINUS_SRC_ALPHA}};}createUniforms(){e.defined(this._color)&&(this._uniforms.set("u_ConstantColor",(()=>{let t=!1;return (this._color.r>1||this._color.g>1||this._color.b>1)&&(t=!0),e.Vector4.fromColor(this._color,t)})),this._uniforms.set("u_HighlightColor",(()=>{let t=!1;return (this._color.r>1||this._color.g>1||this._color.b>1)&&(t=!0),e.Vector4.fromColor(this._color,t)})),this._uniforms.set("u_PointSize",(()=>this.u_PointSize)),this._uniforms.set("u_QuantizedVolumeScaleAndOctEncodedRange",(()=>this.u_QuantizedVolumeScaleAndOctEncodedRange)),this._uniforms.set("u_QuantizedOffset",(()=>this.u_QuantizedOffset)));}buildDefines(){const t={USE_RGBA_COLOR:e.defined(this._color)};this.defines=t;}destroy(){}}class hd{constructor(t){const{tileID:i,boundingVolume:s,customizedColor:r,pointSize:n,opacity:o}=t;this.tileID=i,this.uid=e.uniqueId(),this.uses=0,this.boundingVolume=s,this.state="loading",this.content={},this.tileType="tiles",this.customizedColor=r,this.pointSize=n,this.opacity=o;}loadVectorData(e){this.content=e,this.state="data-down-finished";}unloadVectorData(){for(let e=0;e<this.primitives.length;e++)this.primitives[e].destroy();this.state="unloaded",this.primitives=[],this.content=void 0,this.state="unloaded",this.boundingVolume=null;}upload(t,i,s){this.source=s;const r=new ad,n=r.process({content:t,context:i,customizedColor:this.customizedColor,pointSize:this.pointSize}),o=ad.genShaderScript(r);this.primitives=[new e.Primitive({modelMatrix:t.cartesianModelMatrix,geometry:e.Geometry.fromPointCloudData(n),material:new ld({type:"geometry-point-cloud-pnts",vertexSource:e.reduceComma(o.vs),fragmentSource:e.reduceComma(o.fs),...n})})];}fire(e){this.source.fire(e);}destroy(){this.unloadVectorData();}}class _d{constructor(t){let i;this._url=e.defaultValue(t.url,void 0),this._urls=e.defaultValue(t.urls,[]);try{if(i=this._getSourceUrls(this._urls,this._url),!i.length)throw new Error("urls 和 url 参数至少配置一个")}catch(e){throw new Error("urls 或 url参数不规范，请检查")}const{translation:s}=t;if(e.defined(s)&&!(s instanceof e.Vector3)&&!Array.isArray(s))throw new Error("options.translation is unKnown type!");if(this.translation=e.defaultValue(new e.Vector3(s),void 0),e.defined(t.clippingPlanes)&&!(t.clippingPlanes instanceof e.ClippingPlaneCollection))throw new Error("options.clippingPlanes is unKnown type!");if(this._clippingPlanes=e.defaultValue(t.clippingPlanes,void 0),this._flowOptions=e.defaultValue(t.flowOptions,void 0),this._maximumScreenSpaceError=e.defaultValue(t.maximumScreenSpaceError,16),this._maximumMemoryUsage=e.defaultValue(t.maximumMemoryUsage,64),this._subIPs=e.defaultValue(t.subIPs,void 0),this._loadSiblings=e.defaultValue(t.loadSiblings,!1),this.skipLevelOfDetail=e.defaultValue(t.skipLevelOfDetail,!1),this.baseScreenSpaceError=e.defaultValue(t.baseScreenSpaceError,1024),this.skipLevels=e.defaultValue(t.skipLevels,1),this.skipScreenSpaceErrorFactor=e.defaultValue(t.skipScreenSpaceErrorFactor,16),this.immediatelyLoadDesiredLevelOfDetail=e.defaultValue(t.immediatelyLoadDesiredLevelOfDetail,!1),this.useMipmap=e.defaultValue(t.useMipmap,!1),this.pointSize=e.defaultValue(t.pointSize,1),this._allowPick=e.defaultValue(t.allowPick,!0),this.customizedColor=e.defaultValue(t.customizedColor,void 0),this._lightingModel=e.defaultValue(t.lightingModel,e.LightingModelType.NONE),this.classificationType=t.classificationType,e.defined(t.sourceLoaded)&&!(t.sourceLoaded instanceof Function))throw new Error("options.sourceLoaded is not a function!");this.sourceLoadedCallback=e.defaultValue(t.sourceLoaded,void 0),this._geoBoundsOptions=e.defaultValue(t.geoBoundsOptions,{index:0,combine:!1}),this.id=t.id,this._show=e.defaultValue(t.show,!0),this.map=t.map,this._ready=!1,this._selectedTiles=[],this._opaqueList=[],this._translucentList=[],this._cacheTile=new U,this._debugFreezeFrame=e.defaultValue(t.debugFreezeFrame,!1),this._activeCamera=new l,this.backCulling=e.defaultValue(t.backCulling,void 0),this.loadTileset(i),this.visibility="visible",this.minzoom=e.defaultValue(t.minzoom,0),this.maxzoom=t.maxzoom,this.opacity=e.defaultValue(t.opacity,1);}get allowPick(){return this._allowPick}set allowPick(e){this._allowPick=e;let t=[];t=t.concat(this._translucentList,this._opaqueList);for(let i=0;i<t.length;i++)t[i].allowPick=e;}get clippingPlanes(){return this._clippingPlanes}set clippingPlanes(t){this._clippingPlanes=t instanceof e.ClippingPlaneCollection?t:void 0;}get debugFreezeFrame(){return this._debugFreezeFrame}set debugFreezeFrame(t){e.isBoolean(t)&&null!=this.tileset3d&&(this._debugFreezeFrame=t,this.tileset3d.traverseCounter=0);}get lightingModel(){return this._lightingModel}set lightingModel(t){Object.values(e.LightingModelType).includes(t)?this._lightingModel=t:console.warn(`不支持该值的光照模型: ${t}`);}get show(){return this._show}set show(t){e.isBoolean(t)&&(this._show=t,this._opaqueList=[],this._translucentList=[],this.map.needRepaint=!0);}getBounds(){let t;if(this._geoBounds.length>0){const i=this._geoBoundsOptions.index,s=this._geoBoundsOptions.combine;if(e.defined(i))t=e.defined(this._geoBounds[i])?this._geoBounds[i]:this._geoBounds[0];else if(s){t=new e.LngLatBounds(this._geoBounds[0].sw,this._geoBounds[0].ne);for(let e=this._geoBounds.length-1;e>0;e--)t.extend(this._geoBounds[e]);}}return t}buildGltfTile(t){const i=t.type;if("cmpt"===i){const i=new e.GltfTile({tileID:t.id,boundingVolume:t.boundingVolume,minemap3DType:t.type,instances:t.instances||[],normalRight:t.normalRight||[],normalUp:t.normalUp||[],relativeCenter:t.relativeCenter||[],opacity:t.opacity});this._cacheTile.set(t.id,i);const s=t.content.tiles;for(let r=0;r<s.length;r++){const n=s[r],o=new e.GltfTile({tileID:t.id+r,boundingVolume:t.boundingVolume,minemap3DType:n.type,instances:n.instances||[],normalRight:n.normalRight||[],normalUp:n.normalUp||[],relativeCenter:t.relativeCenter||[],opacity:t.opacity});e.defined(n.cartesianModelMatrix)||(n.cartesianModelMatrix=t.content.cartesianModelMatrix),e.defined(n.content)?n.content.extra={featureTable:n.featureTable,batchTable:n.batchTable,selectionDepth:n._selectionDepth,depth:t.depth,finalResolution:t._finalResolution,markAsRoot:t.userData.markAsRoot}:n.extra={featureTable:n.featureTable,batchTable:n.batchTable,selectionDepth:n._selectionDepth,depth:t.depth,finalResolution:t._finalResolution,markAsRoot:t.userData.markAsRoot},o.upload(n,this.map.painter.context,{type:"3d-tiles"}),t.show&&this._selectedTiles.push(o),i.childTiles.push(o);}}else {let s;s="pointcloud"===i||"pnts"===t.content.type?new hd({tileID:t.id,boundingVolume:t.boundingVolume,minemap3DType:t.content.type,instances:t.instances||[],normalRight:t.normalRight||[],normalUp:t.normalUp||[],relativeCenter:t.relativeCenter||[],customizedColor:this.customizedColor,pointSize:this.pointSize,opacity:t.opacity}):new e.GltfTile({tileID:t.id,boundingVolume:t.boundingVolume,minemap3DType:t.content.type,instances:t.instances||[],normalRight:t.normalRight||[],normalUp:t.normalUp||[],relativeCenter:t.relativeCenter||[],customizedColor:this.customizedColor,opacity:t.opacity}),this._cacheTile.set(t.id,s),e.defined(t.content)&&(t.content.extra={featureTable:t.content.featureTable,batchTable:t.content.batchTable,selectionDepth:t._selectionDepth,depth:t.depth,finalResolution:t._finalResolution,markAsRoot:t.userData.markAsRoot}),s.upload(t.content,this.map.painter.context,{type:"3d-tiles"}),t.show&&this._selectedTiles.push(s);}}_removeTile(t){const i=this._cacheTile._hash[t];i&&(e.defined(i.childTiles)&&i.childTiles.length>0&&i.childTiles.forEach((e=>{e.unloadVectorData();})),i.unloadVectorData(),this._cacheTile.remove(t));}_unloadTiles(e){this._removeTile(e.id);}async loadTileset(t){const i=[];for(let e=0;e<t.length;e++)i.push(await Bs(vt(t[e].url),id,{transformRequest:this.map._transformRequest,json:!0,dispatcher:this.map.style.dispatcher,name:t[e].name,show:t[e].show,opacity:t[e].opacity}));if(0==i.length)throw new Error("Error getting tileset data");{const t=this._unionBoundingVolume(i);this.translation&&this._shiftBoundingVolume(t,this.translation),this.tileset3d=new dc(t,{onTileLoad:()=>{this.map.repaint||(this.update(),this.map.needRepaint=!0);},onTileUnload:e=>{this._unloadTiles(e);},subIPs:this._subIPs,maximumScreenSpaceError:this._maximumScreenSpaceError,throttleRequests:!0,maximumMemoryUsage:this._maximumMemoryUsage,loadSiblings:this._loadSiblings,skipLevelOfDetail:this.skipLevelOfDetail,baseScreenSpaceError:this.baseScreenSpaceError,skipLevels:this.skipLevels,skipScreenSpaceErrorFactor:this.skipScreenSpaceErrorFactor,immediatelyLoadDesiredLevelOfDetail:this.immediatelyLoadDesiredLevelOfDetail,context:this.map.painter.context,useMipmap:this.useMipmap,maxRequests:e.defined(this.subIPs)&&e.defined(this.subIPs.length)?6*this.subIPs.length:6,modelMatrix:e.Matrix4.IDENTITY,transformRequest:this.map._transformRequest,allowPick:this.allowPick,parent:this,dispatcher:this.map.style.dispatcher,lightingModel:this.lightingModel,flowOptions:this._flowOptions}),this.tileset3d.root.boundingVolume=t.root.boundingVolume.sphere,this._geoCenters=t.tileCenters,this._geoBounds=t.tileBounds,this._ready=!0,e.defined(this.sourceLoadedCallback)&&this.sourceLoadedCallback(this),this.map.repaint||(this.update(),this.map.needRepaint=!0);}}_getSourceUrls(e,t){const i=e.filter((e=>e.url));return t&&!i.find((e=>e.url===t))&&i.push({url:t}),i}_shiftBoundingVolume(t,i){const s=new e.Vector3(e.defined(t.tileCenters[0])?t.tileCenters[0]:t.boundingVolume.sphere.center);s.z=0;const r=e.Ellipsoid.WGS84.cartographicToCartesian(s,new e.Vector3),n=e.Transforms.eastNorthUpToFixedFrame(r);let o=e.Matrix4.multiplyByVector(n,new e.Vector4(i.x,i.y,i.z,1),new e.Vector4);o=new e.Vector3(o[0],o[1],o[2]);const a=o.subVectors(o,r),l=e.Matrix4.fromRotationTranslation(e.Matrix3.IDENTITY,a,new e.Matrix4);t.root.transform=l,t.root.transformMatrix=l;const h=new e.Vector4(t.root.boundingVolume.sphere.center);h.w=1,e.Matrix4.multiplyByVector(l,h,h),t.root.boundingVolume.sphere.center=new e.Vector3(h[0],h[1],h[2]);}_unionBoundingVolume(t){const i={asset:{version:"0.0",tilesetVersion:"minemap-top-merge",gltfUpAxis:t[0].gltfUpAxis||"Y"},geometricError:1/0,root:{children:[],transform:[],boundingVolume:{sphere:null},geometricError:1/0,refine:"REPLACE"},tileCenters:[],tileBounds:[]};let s,r=0;for(let n=0;n<t.length;n++){r=Math.max(r,t[n].geometricError);const o=new e.Matrix4(t[n].root.transform);let a,l,h=V_(t[n].root.boundingVolume,o);if(h instanceof We)h=h.boundingVolume,a=h.getBoundingSphere();else if(h instanceof e.BoundingSphere){a=h;const t=h.getBoundingMaximum(),i=e.Transforms.cartesian3ToCartographic(t.boundingMaxValue),s=e.Transforms.cartesian3ToCartographic(t.boundingMinValue);l=new e.LngLatBounds([s[0],s[1]],[i[0],i[1]]);}else h instanceof e.OrientedBoundingBox&&(a=h.getBoundingSphere());if(s=0===n?new e.BoundingSphere(a.center,a.radius):s.union(a),!e.defined(l)){const t=e.Rectangle.fromVector3Array(h.computeCorners()),i=e.CONSTS.CesiumMath.toDegrees(t.west),s=e.CONSTS.CesiumMath.toDegrees(t.south),r=e.CONSTS.CesiumMath.toDegrees(t.east),n=e.CONSTS.CesiumMath.toDegrees(t.north);l=new e.LngLatBounds([i,s],[r,n]);}i.tileBounds.push(l),i.tileCenters.push(e.Transforms.DefaultEllipsoid.cartesianToCartographic(a.center)),t[n].root.name=t[n].name,t[n].root.show=t[n].show,t[n].root.opacity=t[n].opacity,i.root.children.push(t[n].root);}return i.root.geometricError=r,i.root.boundingVolume.sphere=s,i.root.id=void 0,i.root.lodMetricType=t[0].root.lodMetricType,i.root.lodMetricValue=r,i.root.refine=void 0,i.root.transform=new e.Matrix4,i.root.transformMatrix=new e.Matrix4,i.root.type=t[0].root.type,i.geometricError=r,i.basePath=t[0].basePath,i.loader=t[0].loader,i.lodMetricType=t[0].lodMetricType,i.lodMetricValue=r,i.type=t[0].type,i.url=t[0].url,i}_calcActiveCamera(){const e=this.map.transform;return this._activeCamera.updatePerspectiveOptions({fov:e.fov,aspect:e.width/e.height,near:.1,far:Math.max(e.far,1e4)}),this._activeCamera.setMatrix(e.activeCamera.matrixWorld.clone()),this._activeCamera}update(){if(!this._ready||!this._show||!this.tileset3d)return;const t=this._calcActiveCamera();if(this.tileset3d.update(t.frustumCrate,{width:this.map.transform.width,height:this.map.transform.height}),e.isHiddenByMapZoom(this,this.map.getZoom())&&(this.tileset3d.selectedTiles=[]),this._selectedTiles=[],this.tileset3d.selectedTiles.length>0){let e;const t=this.tileset3d.selectedTiles.filter((e=>e._finalResolution)),i=this.tileset3d.selectedTiles.filter((e=>!e._finalResolution)),s=t.concat(i);for(let t=0;t<s.length;++t){e=s[t];const i=this._cacheTile.get(e.id);if(i)if(i.childTiles?.length>0){const t=e;i.childTiles.forEach((e=>{e.extra.selectionDepth=t._selectionDepth,e.extra.depth=t.depth,e.extra.finalResolution=t._finalResolution,i.extra?i.extra.markAsRoot=t.userData.markAsRoot:e.extra.markAsRoot=t.userData.markAsRoot,e.opacity=t.opacity,t.show&&this._selectedTiles.push(e);}));}else i.extra&&(i.extra.selectionDepth=e._selectionDepth,i.extra.depth=e.depth,i.extra.finalResolution=e._finalResolution,i.extra.markAsRoot=e.userData.markAsRoot),i.opacity=e.opacity,e.show&&this._selectedTiles.push(i);else this.buildGltfTile(e);}}this._opaqueList=[],this._translucentList=[];const i=this;this._selectedTiles.forEach((e=>{e.primitives.forEach((t=>{t._material&&t._geometry&&(t._material.clippingPlanes=i.clippingPlanes,t._material.backCulling=this.backCulling,t._material._opacity=this.opacity*e.opacity,t._material.isTranslucent?(t.boundingVolume=e.boundingVolume,t.tileUid=e.uid,i._translucentList.push(t)):i._opaqueList.push(t),dd(t,this));}));})),this._processTileFeatureStyle();}loaded(){return !!this.tileset3d&&this.tileset3d&&0===this.tileset3d.stats.get("Tiles Loading").count}setTileFeatureStyle(e){this.tileFeatureStyleUpdateFunction=e,this._processTileFeatureStyle();}_processTileFeatureStyle(){if(this.tileFeatureStyleUpdateFunction&&(this.tileFeatureStyled=!0),this.tileFeatureStyled){for(let e=0;e<this._selectedTiles.length;e++){const t=this._selectedTiles[e];if(t.extra.batchTable&&t.extra.batchTable._features&&t.extra.batchTable.processFn!=this.tileFeatureStyleUpdateFunction)for(let e=0;e<t.extra.batchTable._features.length;e++){const i=t.extra.batchTable._features[e];this.tileFeatureStyleUpdateFunction?(this.tileFeatureStyleUpdateFunction(i),t.extra.batchTable.processFn=this.tileFeatureStyleUpdateFunction):(i.color=[1,1,1,0],i.show=!0,t.extra.batchTable.processFn=void 0);}}this.tileFeatureStyleUpdateFunction||(this.tileFeatureStyled=!1);}}setShowByUrlName(e,t){if(this._urls.length>0){cd("show",e,t,this.tileset3d.root.children);for(const i of this._urls)i.name===t&&(i.show=e);this.map.repaint||(this.update(),this.map.needRepaint=!0);}}setOpacityByUrlName(e,t){if(this._urls.length>0){cd("opacity",e,t,this.tileset3d.root.children);for(const i of this._urls)i.name===t&&(i.opacity=e);this.map.repaint||(this.update(),this.map.needRepaint=!0);}}destroy(){return this._selectedTiles.forEach((e=>{e.destroy();})),this._selectedTiles=null,this._opaqueList=null,this._translucentList=null,e.defined(this.tileset3d)&&this.tileset3d.destroy(),e.defined(this.sourceLoadedCallback)&&(this.sourceLoadedCallback=null),this.tileset3d=null,e.destroyObject(this)}}function cd(e,t,i,s){if(s)for(const r of s)r.name===i&&r[e]!==t&&(r[e]=t,cd(e,t,i,r.children));}function dd(t,i){i.lightingModel===e.LightingModelType.PBR?(t._material.defines.USE_PBR=!0,t._material.defines.USE_IBL=!0):(t._material.defines.USE_PBR=!1,t._material.defines.USE_IBL=!1),t._material.defines.PHONG_LIGHT=i.lightingModel==e.LightingModelType.PHONG;}class ud extends e.Evented{constructor(e,t,i){super(),this.id=e,this.dispatcher=i,this._firstLoadingTilesFlag=!0,this.on("data",(e=>{"cesium-tile"===e.dataType&&this.map&&this.update();})),this.on("error",(()=>{this._sourceErrored=!0;}));const s=Gl(e,t,i,this);this._source=s,this._tiles={},this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this.idealTileIDs=[],this._glTFTiles=[],this._preCesiumTiles=[],this._cacheTile=new U,this._geoCenters=[],this._geoBounds=[],this.lastFrameHasMixedContent=void 0,this.sourceOptions=t,this._activeCamera=new l;}_verifiableSourceUrls(e,t){const i=[];if(t&&i.push({url:t}),e&&e.length)for(let s=0;s<e.length;s++){const r=e[s];t!==r.url&&r.url&&i.push(r);}return i.length?i:{msg:"urls 和 url 参数至少配置一个"}}async loadTileset(t){const{url:i,urls:s,maximumScreenSpaceError:r,maximumMemoryUsage:n,loadSiblings:o,skipLevelOfDetail:a,baseScreenSpaceError:l,skipLevels:h,skipScreenSpaceErrorFactor:_,immediatelyLoadDesiredLevelOfDetail:c,sourceLoaded:d,viewFrustum:u,subIPs:m,useMipmap:p,clippingPlanes:f,allowPick:g,translation:y}=this.sourceOptions,T=[],C=this._verifiableSourceUrls(s,i);if(!(C instanceof Array))throw new Error(C.msg);for(let e=0;e<C.length;e++)T.push(await Bs(vt(C[e].url),id,{transformRequest:this.map._transformRequest,json:!0,dispatcher:this.map.style.dispatcher}));if(0==T.length)throw new Error("Error getting tileset data");{const i=this._unionBoundingVolume(T);y&&this._shiftBoundingVolume(i,y),this.tileset3d=new dc(i,{onTileLoad:()=>{this.update();},onTileUnload:e=>{this._unloadTiles(e);},subIPs:m,maximumScreenSpaceError:r||16,throttleRequests:!0,maximumMemoryUsage:n||64,loadSiblings:o||!1,skipLevelOfDetail:a||!1,baseScreenSpaceError:l||1024,skipLevels:h||1,skipScreenSpaceErrorFactor:_||16,immediatelyLoadDesiredLevelOfDetail:c||!1,context:this.map.painter.context,useMipmap:p||!1,maxRequests:m?.length?6*m.length:6,modelMatrix:e.Matrix4.IDENTITY,transformRequest:this.map._transformRequest,clippingPlanes:f,allowPick:g,nodeProperty:{sourceId:t,sourceOptions:this.sourceOptions},dispatcher:this.dispatcher}),this.tileset3d.root.boundingVolume=i.root.boundingVolume.sphere,this._geoCenters=i.tileCenters,this._geoBounds=i.tileBounds,this.sourceLoadedCallback=d,this.sourceLoadedCallback&&this.sourceLoadedCallback(this),this._viewFrustum=u||null,this.update(),this.map.needRepaint=!0;}}_setViewFrustum(e){this._viewFrustum=e;}update(){if(this._paused||!this.used)return;const e=this._calcActiveCamera();this.tileset3d&&e.frustumCrate&&(this.tileset3d.update(e.frustumCrate,{width:this.map.transform.width,height:this.map.transform.height}),this.traversalTileRootToFindTopMergeTile());}_calcActiveCamera(){const e=this.map.transform;return this._activeCamera.updatePerspectiveOptions({fov:e.fov,aspect:e.width/e.height,near:.1,far:e.far}),this._activeCamera.setMatrix(e.activeCamera.matrixWorld.clone()),this._activeCamera}_unloadTiles(e){this._removeTile(e.id);}prepare(e){this._source.prepare&&this._source.prepare(),this._context||(this._context=e);}get tilesForRender(){if(this._glTFTiles=[],this?.tileset3d?.selectedTiles){let e;const t=this.tileset3d.selectedTiles.filter((e=>e._finalResolution)),i=this.tileset3d.selectedTiles.filter((e=>!e._finalResolution)),s=t.concat(i);for(let t=0;t<s.length;++t){e=s[t];const i=this._cacheTile.get(e.id);i?i.childTiles?.length>0?i.childTiles.forEach((t=>{t.extra.selectionDepth=e._selectionDepth,t.extra.depth=e.depth,t.extra.finalResolution=e._finalResolution,i.extra?i.extra.markAsRoot=e.userData.markAsRoot:t.extra.markAsRoot=e.userData.markAsRoot,this._glTFTiles.push(t);})):(i.extra&&(i.extra.selectionDepth=e._selectionDepth,i.extra.depth=e.depth,i.extra.finalResolution=e._finalResolution,i.extra.markAsRoot=e.userData.markAsRoot),this._glTFTiles.push(i)):this.buildCesiumGltfTile(e);}}return this.tileset3d&&0!=this.tileset3d.stats.get("Tiles Loading").count&&(this.lastFrameHasMixedContent=this.tileset3d._hasMixedContent,this.fire(new e.Event("data",{dataType:"cesium-tile"}))),null!=this.lastFrameHasMixedContent&&this.tileset3d._hasMixedContent&&!this.lastFrameHasMixedContent&&this.fire(new e.Event("data",{dataType:"cesium-tile"})),this._glTFTiles}traversalTileRootToFindTopMergeTile(){this.tileset3d&&this.tileset3d.skipLevelOfDetail&&pd(this.tileset3d.root.children,0);}tilesIn(){return this._glTFTiles}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._source&&(this._source.onAdd(e),this.loadTileset(this.id));}buildCesiumGltfTile(t){const i=t.type;if("cmpt"===i){const i=new e.GltfTile({tileID:t.id,modelFolder:this._source.modelFolder,boundingVolume:t.boundingVolume,minemap3DType:t.type,instances:t.instances||[],normalRight:t.normalRight||[],normalUp:t.normalUp||[],relativeCenter:t.relativeCenter||[],clippingPlaneCollection:this._clippingPlaneCollection});this._cacheTile.set(t.id,i);const s=t.content.tiles;for(let r=0;r<s.length;r++){const n=s[r],o=new e.GltfTile({tileID:t.id+r,modelFolder:this._source.modelFolder,boundingVolume:t.boundingVolume,minemap3DType:n.type,instances:n.instances||[],normalRight:n.normalRight||[],normalUp:n.normalUp||[],relativeCenter:t.relativeCenter||[],clippingPlaneCollection:this._clippingPlaneCollection});void 0===n.cartesianModelMatrix&&(n.cartesianModelMatrix=t.content.cartesianModelMatrix),n?.content?n.content.extra={featureTable:n.featureTable,batchTable:n.batchTable,selectionDepth:n._selectionDepth,depth:t.depth,finalResolution:t._finalResolution,markAsRoot:t.userData.markAsRoot}:n.extra={featureTable:n.featureTable,batchTable:n.batchTable,selectionDepth:n._selectionDepth,depth:t.depth,finalResolution:t._finalResolution,markAsRoot:t.userData.markAsRoot},o.upload(n,this._context,this._source),this._glTFTiles.push(o),i.childTiles.push(o);}}else {let s;s="pointcloud"===i||"pnts"===t.content.type?new hd({tileID:t.id,modelFolder:this._source.modelFolder,boundingVolume:t.boundingVolume,minemap3DType:t.content.type,instances:t.instances||[],normalRight:t.normalRight||[],normalUp:t.normalUp||[],relativeCenter:t.relativeCenter||[],clippingPlaneCollection:this._clippingPlaneCollection,customizedColor:this.customizedColor}):new e.GltfTile({tileID:t.id,modelFolder:this._source.modelFolder,boundingVolume:t.boundingVolume,minemap3DType:t.content.type,instances:t.instances||[],normalRight:t.normalRight||[],normalUp:t.normalUp||[],relativeCenter:t.relativeCenter||[],clippingPlaneCollection:this._clippingPlaneCollection,customizedColor:this.customizedColor}),this._cacheTile.set(t.id,s),t?.content&&(t.content.extra={featureTable:t.content.featureTable,batchTable:t.content.batchTable,selectionDepth:t._selectionDepth,depth:t.depth,finalResolution:t._finalResolution,markAsRoot:t.userData.markAsRoot}),s.upload(t.content,this._context,this._source),this._glTFTiles.push(s);}}onRemove(e){this._source&&this._source.onRemove&&this._source.onRemove(e);}loaded(){return !!this.tileset3d&&this.tileset3d&&0===this.tileset3d.stats.get("Tiles Loading").count}getSource(){return this._source}pause(){this._paused=!0;}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.map&&this.update();}serialize(){return this._source.serialize()}reload(){}updateCacheSize(e){}hasTransition(){return !1}setFeatureState(e,t,i){}getFeatureState(e,t){}clearTiles(){if(this._shouldReloadOnResume=!1,this._paused=!1,this.tileset3d){this.tileset3d._destroyed=!0;for(const e in this._cacheTile._hash)this._removeTile(e);this.tileset3d._abortListMap.forEach(((e,t)=>{e.abort(),this.tileset3d._abortListMap.delete(t);}));}}_removeTile(e){const t=this._cacheTile._hash[e];t&&(t.childTiles&&t.childTiles.length>0&&t.childTiles.forEach((e=>{e.unloadVectorData();})),t.unloadVectorData(),this._cacheTile.remove(e));}getTilesSourceConfig(t,i="name"){if(this._geoCenters.length){const{urls:s=[],url:r}=this._source._options,n=this.map.transform;r&&(s.filter((e=>e.url===r)).length||s.push({name:"custom-tiles",url:r}));const o=s.map(((t,i)=>{let s=e.getZoomFromDistance(n._fov,this._geoCenters[i][2]+e.CONSTS.TRANSFORM.R+1e3,e.CONSTS.TRANSFORM.R);return s=isNaN(s)?n._maxZoom-1:s,{center:this._geoCenters[i],bounds:this._geoBounds.length?this._geoBounds[i]:null,zoom:s,...t}}));return t&&"string"==typeof t?o.filter((e=>e[i]===t)):o}}_unionBoundingVolume(t){const i={asset:{version:"0.0",tilesetVersion:"minemap-top-merge",gltfUpAxis:t[0].gltfUpAxis||"Y"},geometricError:1/0,root:{children:[],transform:[],boundingVolume:{sphere:null},geometricError:1/0,refine:"REPLACE"},tileCenters:[],tileBounds:[]};let s,r=0;for(let n=0;n<t.length;n++){r=Math.max(r,t[n].geometricError);const o=new e.Matrix4(t[n].root.transform);let a,l,h=V_(t[n].root.boundingVolume,o);if(h instanceof We)h=h.boundingVolume,a=h.getBoundingSphere();else if(h instanceof e.BoundingSphere){a=h;const t=h.getBoundingMaximum(),i=e.Transforms.cartesian3ToCartographic(t.boundingMaxValue),s=e.Transforms.cartesian3ToCartographic(t.boundingMinValue);l=new e.LngLatBounds([s[0],s[1]],[i[0],i[1]]);}else h instanceof e.OrientedBoundingBox&&(a=h.getBoundingSphere());if(0===n?s=new e.BoundingSphere(a.center,a.radius):s.union(a),!e.defined(l)){const t=e.Rectangle.fromVector3Array(h.computeCorners()),i=e.CONSTS.CesiumMath.toDegrees(t.west),s=e.CONSTS.CesiumMath.toDegrees(t.south),r=e.CONSTS.CesiumMath.toDegrees(t.east),n=e.CONSTS.CesiumMath.toDegrees(t.north);l=new e.LngLatBounds([i,s],[r,n]);}i.tileBounds.push(l),i.tileCenters.push(e.Transforms.DefaultEllipsoid.cartesianToCartographic(a.center)),i.root.children.push(t[n].root);}return i.root.geometricError=r,i.root.boundingVolume.sphere=s,i.root.id=void 0,i.root.lodMetricType=t[0].root.lodMetricType,i.root.lodMetricValue=r,i.root.refine=void 0,i.root.transform=new e.Matrix4,i.root.transformMatrix=new e.Matrix4,i.root.type=t[0].root.type,i.geometricError=r,i.basePath=t[0].basePath,i.loader=t[0].loader,i.lodMetricType=t[0].lodMetricType,i.lodMetricValue=r,i.type=t[0].type,i.url=t[0].url,i}getTranslucentPrimitives(t,i,s){const r=[];if(!(i=i||e.checkIsDepthSupportDataType)(s.classificationType))return r;const n=this.clippingPlanes;return this.tilesForRender.forEach((e=>{e.primitives.forEach((t=>{t._material.isTranslucent&&(t.boundingVolume=e.boundingVolume,t.tileUid=e.uid,t._material.clippingPlanes=n,ud.setLightDefines(t,s),r.push(t)),dd(t,this._source);}));})),r}static setLightDefines(t,i){i&&i.lightingModel===e.LightingModelType.PBR?(t._material.defines.USE_PBR=!0,t._material.defines.USE_IBL=!0):(t._material.defines.USE_PBR=!1,t._material.defines.USE_IBL=!1),t._material.defines.PHONG_LIGHT=i.lightingModel==e.LightingModelType.PHONG;}getOpaquePrimitives(t,i,s){const r=[];if(!(i=i||e.checkIsDepthSupportDataType)(s.classificationType))return r;const n=this.clippingPlanes;return this.tilesForRender.forEach((e=>{e.primitives.forEach((t=>{t._material.isTranslucent||(t.boundingVolume=e.boundingVolume,t.tileUid=e.uid,t._material.clippingPlanes=n,ud.setLightDefines(t,s),r.push(t));}));})),r}addClippingPlanes(e){this.clippingPlanes=e;}addCustomizedStyle(e){this.customizedColor=e.get("point-cloud-color").value._parameters;}_shiftBoundingVolume(t,i){const s=new e.Vector3(t?.tileCenters[0]||t.boundingVolume.sphere.center);s.z=0;const r=e.Ellipsoid.WGS84.cartographicToCartesian(s,new e.Vector3),n=e.Transforms.eastNorthUpToFixedFrame(r);let o=e.Matrix4.multiplyByVector(n,new e.Vector4(i[0],i[1],i[2],1),new e.Vector4);o=new e.Vector3(o[0],o[1],o[2]);const a=o.subVectors(o,r),l=e.Matrix4.fromRotationTranslation(e.Matrix3.IDENTITY,a,new e.Matrix4);t.root.transform=l,t.root.transformMatrix=l;const h=new e.Vector4(t.root.boundingVolume.sphere.center);h.w=1,e.Matrix4.multiplyByVector(l,h,h),t.root.boundingVolume.sphere.center=new e.Vector3(h[0],h[1],h[2]);}}const md=3;function pd(e,t){for(let i=0;i<e.length;i++){const s=e[i];"scenegraph"==s.type?(s.userData.markAsRoot=!0,t+1<=md&&pd(s.children,t+1)):t<md&&pd(s.children,t);}}ud.maxOverzooming=10,ud.maxUnderzooming=3;class fd extends e.Evented{constructor(e,t,i){super(),this.id=e,this.dispatcher=i,this.on("data",(e=>{"cesium-tile"===e.dataType&&this.transform&&this.update(this.transform);})),this.on("error",(()=>{this._sourceErrored=!0;}));const s=Gl(e,t,i,this);this._source=s,this._tiles={},this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this.idealTileIDs=[],this._glTFTiles=[],this._preCesiumTiles=[],this._cacheTile=new U,this._geoCenter=[];}update(e){this.transform||(this.transform=e);}_unloadTiles(e){const t=this._cacheTile.get(e.id);t&&(t.childTiles.length>0&&t.childTiles.forEach((e=>{t.unloadVectorData();})),t.unloadVectorData(),this._cacheTile.remove(e.id));}prepare(e){this._source.prepare&&this._source.prepare(),this._context||(this._context=e);}get tilesForRender(){return this._glTFTiles}tilesIn(){return this._glTFTiles}onAdd(t){this.map=t,this._source&&this._source.onAdd&&this._source.onAdd(t,((t,i)=>{if(t)throw new Error("请求出错，请检查model路径问题、跨域问题或者资源是否存在");this.buildCesiumGltfTile({content:{gltf:i,cartographicOrigin:[],type:"3d-model"},id:e.uniqueId(),instances:null,normalRight:null,normalUp:null,relativeCenter:null}),this._glTFTiles.forEach((e=>{e.primitives.forEach((e=>{dd(e,this._source);}));}));}));}buildCesiumGltfTile(t){const i=new e.GltfTile({tileID:t.id,modelFolder:this._source.modelFolder,boundingVolume:t.boundingVolume,minemap3DType:t.content.type,instances:t.instances||[],normalRight:t.normalRight||[],normalUp:t.normalUp||[],relativeCenter:t.relativeCenter||[]});this._cacheTile.set(t.id,i),t?.content&&(t.content.extra={featureTable:t.featureTable||void 0,batchTable:t.batchTable||void 0,selectionDepth:t._selectionDepth||void 0,depth:t.depth||0,finalResolution:t._finalResolution||!1}),i.upload(t.content,this._context,this._source),this._glTFTiles.push(i),this.fire(new e.Event("data",{dataType:"cesium-tile"}));}onRemove(e){this._source&&this._source.onRemove&&this._source.onRemove(e);}loaded(){return !!this.tileset3d&&this.tileset3d&&0===this.tileset3d.stats.get("Tiles Loading").count}getSource(){return this._source}pause(){this._paused=!0;}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform);}serialize(){return this._source.serialize()}reload(){}updateCacheSize(e){}hasTransition(){return !1}setFeatureState(e,t,i){}getFeatureState(e,t){}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;}getLocation(e){const{urls:t,url:i}=this._source._options;if(t){const i=t.map(((e,t)=>({center:this._geoCenter[t],...e})));return "string"!=typeof e?i:i.filter((t=>t.name===e))}return [{center:this._geoCenter[0],url:i}]}getTranslucentPrimitives(t,i,s){const r=[];return (i=i||e.checkIsDepthSupportDataType)(s.classificationType)?(this.tilesForRender.forEach((i=>{i.primitives.forEach((i=>{i._material.isTranslucent&&(i.tileUid||(i.tileUid=`3d-model${this._source.id}${Math.random()}`),t?t.computeVisibility(i.boundingVolume)!==e.INTERSECTION.OUTSIDE&&r.push(i):r.push(i));}));})),r):r}getOpaquePrimitives(t,i,s){const r=[];return (i=i||e.checkIsDepthSupportDataType)(s.classificationType)?(this.tilesForRender.forEach((i=>{i.primitives.forEach((i=>{i._material.isTranslucent||(i.tileUid||(i.tileUid=`3d-model${this._source.id}${Math.random()}`),t?t.computeVisibility(i.boundingVolume)!==e.INTERSECTION.OUTSIDE&&r.push(i):r.push(i));}));})),r):r}}fd.maxOverzooming=10,fd.maxUnderzooming=3;class gd{constructor(t){this.tileID=t.tileID,this.sourceCache=t.sourceCache,this.rectangle=this.sourceCache.map._tilingScheme.tileXYToRectangle(this.tileID.canonical.x,this.tileID.canonical.y,this.sourceCache.map._tilingScheme.type===e.ProjectionType.LATLON?this.tileID.canonical.z-1:this.tileID.canonical.z),this.uid=e.uniqueId(),this.state=Lt,this.terrainState=1,this.images=[],this.terrain=null,this.primitive=null,this.proxyImage=null;}get eligibleForUnloading(){let t=!0;const i=this.images;for(let s=0,r=i.length;t&&s<r;++s){const r=i[s];t=!e.defined(r.loadingImagery)||1!==r.loadingImagery.state;}return t}loadTile(e){this.state="loading",0===e.state&&(e.state=1,this.checkTileAvailable(e),this.loadRaster(),this.loadTerrain(e));}loadRaster(){this.images=[];for(const e of this.sourceCache.order){const t=this.sourceCache.map.style._layers[e].source,i=this.sourceCache.rasterSources[t]||this.sourceCache.imageSources[t],s=i.createTileImagerySkeletons(this);for(const t of s)t.process(this,i),t.layerId=e,this.images.push(t);}}loadTerrain(e){1===this.terrainState?this.sourceCache.terrainSource.loadTile(e,((t,i)=>{3===this.terrainState&&(this.terrain=i,i||console.error("瓦片数据不存在，请检查0级瓦片是否部署！或者其它zoom级别瓦片存在空数据现象！"),this.createPrimitive(),e.renderable=!0,this.state=Vt,this.terrainState=6,this.sourceCache.map.needRepaint=!0);})):0===this.terrainState&&(this.terrain=this.sourceCache.terrainSource.processUpsample(e),this.terrainState=3,this.upsample=!0,this.createPrimitive(),e.renderable=!0,this.state=Vt,this.terrainState=6,this.sourceCache.map.needRepaint=!0);}createPrimitive(){this.primitive=function(t){const{layer:i,painter:s,tile:r,defines:n,programId:o,parentTile:a,geomType:l}=t,h=s.style?.terrainAnalysis;let _;if(h){const t=e.TerrainTileParser.genShaderScript(h);_=new e.RasterMaterial({layer:i,painter:s,tile:r,renderState:{depthTest:e.renderStateEnum.enableDepthTest},type:"background-analysis",defines:e.addColorDefines(h),vertexSource:e.reduceComma(t.vs),fragmentSource:e.reduceComma(t.fs),noCache:!0});}else _=new e.RasterMaterial({layer:i,painter:s,tile:r,defines:n,type:o,parentTile:a,renderState:{}});return new e.Primitive({modelMatrix:l.matrix,geometry:l.geometry,material:_,allowPick:!1,keepGeometryWhenFree:!0})}({painter:this.sourceCache.map.painter,tile:this,defines:{},programId:e.SHADER_RASTER,parentTile:null,geomType:this.terrain});}checkTileAvailable(t){if(!this.sourceCache.terrainSource.isTerrain())return;const i=this.sourceCache.terrainSource.getTileDataAvailable(this.tileID);if(!e.defined(i)&&e.defined(t.parent)){const i=t.parent.data;e.defined(i)&&e.defined(i.terrainData);}!1===i&&(t.data.terrainState=0);}addProxyTexture(e,t,i){t&&(this.proxyImage=e.createTileImagerySkeletons(this,i)[0],this.proxyImage.imagery=this.proxyImage.loadingImagery,this.proxyImage.loadingImagery=void 0,this.proxyImage.imagery.texture=t);}unloadTile(){for(const e of this.images)e.freeResources();this.images.length=0,2===this.terrainState?this.sourceCache.terrainSource.abortTile(this.tileID):this.sourceCache.terrainSource.unloadTile(this.tileID),this.primitive&&this.primitive.destroy(),this.terrain=void 0,this.terrainState=7,this.state=Lt;}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}}const yd=c_;class Td{constructor(t){this.hasTerrainData=t.hasTerrainData,this._tilingScheme=t.tilingScheme,this._x=t.x,this._y=t.y,this._level=t.level,this._parent=t.parent,this._rectangle=this._tilingScheme.tileXYToRectangle(this._x,this._y,this._level),this._southwestChild=void 0,this._southeastChild=void 0,this._northwestChild=void 0,this._northeastChild=void 0,this._distance=0,this._loadPriority=0,this._lastSelectionResult=h_.NONE,this._lastSelectionResultFrame=void 0,this.state=0,this.renderable=!1,this.upsampledFromParent=!1,this._tileIndexVisited=!1,this._tileExistOnServer=1;const i=this._tilingScheme.crs,s=this.getOverscaledTileID(),r=this.hasTerrainData;r&&s.canonical.z>yd.MAX_LEVELS&&(yd[i].has(s.canonical.key)||yd[i].set(s.canonical.key,[this._parent.terrainBounds.minimumHeight,this._parent.terrainBounds.maximumHeight]));const n=this;this._terrainBounds={get minimumHeight(){return r?yd[i].get(s.canonical.key)[0]:0},set minimumHeight(e){r&&(yd[i].get(s.canonical.key)[0]=e,n.tileBoundingRegion.minimumHeight=e,n.tileBoundingRegion.computeBoundingVolumes(n.ellipsoid),n.tileBoundingRegion.isAmbiguousHeight=!1);},get maximumHeight(){return r?yd[i].get(s.canonical.key)[1]:0},set maximumHeight(e){r&&(yd[i].get(s.canonical.key)[1]=e,n.tileBoundingRegion.maximumHeight=e,n.tileBoundingRegion.computeBoundingVolumes(n.ellipsoid),n.tileBoundingRegion.isAmbiguousHeight=!1);}};const o=e.defined(this.parent)&&e.defined(this.parent.customHeight.minimumHeight);this._customHeight={hasCustomHeight:o,minimumHeight:o?this.parent.customHeight.minimumHeight:void 0,maximumHeight:o?this.parent.customHeight.maximumHeight:void 0,tileBoundingRegion:o?new We({computeBoundingVolumes:!0,rectangle:this.rectangle,ellipsoid:this.ellipsoid,minimumHeight:this.parent.customHeight.minimumHeight,maximumHeight:this.parent.customHeight.maximumHeight}):void 0},this.data=void 0;}get needsLoading(){return this.state<2}get eligibleForUnloading(){let t=!0;return e.defined(this.data)&&(t=this.data.eligibleForUnloading,e.defined(t)||(t=!0)),t}get tileBoundingRegion(){if(this._tileBoundingRegion)return this._tileBoundingRegion;if(this._customHeight.hasCustomHeight)this._tileBoundingRegion||(this._tileBoundingRegion=this.customHeight.tileBoundingRegion);else if(this.hasTerrainData){const e=this._tilingScheme.crs,t=this.getOverscaledTileID(),i=yd[e].get(t.canonical.key);if(!i)throw new Error("当前的对象未创建便有了tileBoundingRegion的访问！");if(!i[2]){let e=this.level>yd.MAX_LEVELS;this.level>=14&&!this._parent.tileBoundingRegion.isAmbiguousHeight&&(e=!1),i[2]=new We({computeBoundingVolumes:!0,rectangle:this.rectangle,ellipsoid:this.ellipsoid,minimumHeight:i[0],maximumHeight:i[1],isAmbiguousHeight:e});}this._tileBoundingRegion||(this._tileBoundingRegion=i[2]);}else this._tileBoundingRegion||(this._tileBoundingRegion=new We({computeBoundingVolumes:!0,rectangle:this.rectangle,ellipsoid:this.ellipsoid,minimumHeight:0,maximumHeight:0}));return this._tileBoundingRegion}get terrainBounds(){return this._terrainBounds}getOverscaledTileID(){if(!this.tileID){const t=this._tilingScheme.type,i=this._level+(t==e.ProjectionType.LATLON?1:0);this.tileID=new e.OverscaledTileID(i,0,i,this._x,this._y,t);}return this.tileID.distance=this._distance,this.tileID}get customHeight(){return this._customHeight}set customHeight(t){e.defined(t)&&(this._customHeight.minimumHeight=t.minimumHeight,this._customHeight.maximumHeight=t.maximumHeight);}get tilingScheme(){return this._tilingScheme}get x(){return this._x}get y(){return this._y}get level(){return this._level}get parent(){return this._parent}get rectangle(){return this._rectangle}get children(){return [this.northwestChild,this.northeastChild,this.southwestChild,this.southeastChild]}get southwestChild(){return e.defined(this._southwestChild)||(this._southwestChild=new Td({hasTerrainData:this.hasTerrainData,tilingScheme:this.tilingScheme,x:2*this.x,y:2*this.y+1,level:this.level+1,parent:this})),this._southwestChild}get southeastChild(){return e.defined(this._southeastChild)||(this._southeastChild=new Td({hasTerrainData:this.hasTerrainData,tilingScheme:this.tilingScheme,x:2*this.x+1,y:2*this.y+1,level:this.level+1,parent:this})),this._southeastChild}get northwestChild(){return e.defined(this._northwestChild)||(this._northwestChild=new Td({hasTerrainData:this.hasTerrainData,tilingScheme:this.tilingScheme,x:2*this.x,y:2*this.y,level:this.level+1,parent:this})),this._northwestChild}get northeastChild(){return e.defined(this._northeastChild)||(this._northeastChild=new Td({hasTerrainData:this.hasTerrainData,tilingScheme:this.tilingScheme,x:2*this.x+1,y:2*this.y,level:this.level+1,parent:this})),this._northeastChild}checkTileState(){if(1===this.state){let t=!0;const i=this.data;for(const s of i.images)s.loadingImagery&&(4===s.loadingImagery.state?(e.defined(s.imagery)&&0===s.imagery.releaseReference(this.tileID.key)&&s.imagery.rasterTileSource.unloadTile(s.imagery),s.imagery=s.loadingImagery,s.loadingImagery=void 0,s.textureTranslationAndScale=s.imagery.rasterTileSource.calculateTextureTranslationAndScale(i,s)):5===s.loadingImagery.state||6===s.loadingImagery.state?(s.process(i,s.loadingImagery.rasterTileSource,!0),t=!1):t=!1);t&&(this.state=2);}}findLevelZeroTile(e,t,i){const s=this.tilingScheme.getNumberOfXTilesAtLevel(0);if(t<0?t+=s:t>=s&&(t-=s),!(i<0||i>=this.tilingScheme.getNumberOfYTilesAtLevel(0)))return e.filter((e=>e.x===t&&e.y===i))[0]}findTileToWest(e){const t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x-1,this.y);if(t.southeastChild===this)return t.southwestChild;if(t.northeastChild===this)return t.northwestChild;const i=t.findTileToWest(e);return void 0!==i?t.southwestChild===this?i.southeastChild:i.northeastChild:void 0}findTileToEast(e){const t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x+1,this.y);if(t.southwestChild===this)return t.southeastChild;if(t.northwestChild===this)return t.northeastChild;const i=t.findTileToEast(e);return void 0!==i?t.southeastChild===this?i.southwestChild:i.northwestChild:void 0}findTileToSouth(e){const t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x,this.y+1);if(t.northwestChild===this)return t.southwestChild;if(t.northeastChild===this)return t.southeastChild;const i=t.findTileToSouth(e);return void 0!==i?t.southwestChild===this?i.northwestChild:i.northeastChild:void 0}findTileToNorth(e){const t=this.parent;if(void 0===t)return this.findLevelZeroTile(e,this.x,this.y-1);if(t.southwestChild===this)return t.northwestChild;if(t.southeastChild===this)return t.northeastChild;const i=t.findTileToNorth(e);return void 0!==i?t.northwestChild===this?i.southwestChild:i.southeastChild:void 0}freeResources(){this.state=0,this.renderable=!1,this.upsampledFromParent=!1,e.defined(this.data)&&(this.data.unloadTile(),this.data=void 0),Cd(this._southwestChild),this._southwestChild=void 0,Cd(this._southeastChild),this._southeastChild=void 0,Cd(this._northwestChild),this._northwestChild=void 0,Cd(this._northeastChild),this._northeastChild=void 0;}}function Cd(t){e.defined(t)&&t.freeResources();}function xd(){this.head=void 0,this.tail=void 0,this.count=0,this._lastBeforeStartOfFrame=void 0;}function bd(e,t){const i=t.replacementPrevious,s=t.replacementNext;t===e._lastBeforeStartOfFrame&&(e._lastBeforeStartOfFrame=s),t===e.head?e.head=s:i.replacementNext=s,t===e.tail?e.tail=i:s.replacementPrevious=i,t.replacementPrevious=void 0,t.replacementNext=void 0,--e.count;}xd.prototype.markStartOfRenderFrame=function(){this._lastBeforeStartOfFrame=this.head;},xd.prototype.trimTiles=function(t){let i=this.tail,s=!0;for(;s&&e.defined(this._lastBeforeStartOfFrame)&&this.count>t&&e.defined(i);){s=i!==this._lastBeforeStartOfFrame;const e=i.replacementPrevious;i.eligibleForUnloading&&(i.freeResources(),bd(this,i)),i=e;}},xd.prototype.markTileRendered=function(t){const i=this.head;if(i!==t){if(++this.count,!e.defined(i))return t.replacementPrevious=void 0,t.replacementNext=void 0,this.head=t,void(this.tail=t);(e.defined(t.replacementPrevious)||e.defined(t.replacementNext))&&bd(this,t),t.replacementPrevious=void 0,t.replacementNext=i,i.replacementPrevious=t,this.head=t;}else t===this._lastBeforeStartOfFrame&&(this._lastBeforeStartOfFrame=t.replacementNext);};class vd{constructor(){this.allAreRenderable=!0,this.anyWereRenderedLastFrame=!1,this.notYetRenderableCount=0;}}class wd{constructor(){this.southwest=new vd,this.southeast=new vd,this.northwest=new vd,this.northeast=new vd;}combine(e){const t=this.southwest,i=this.southeast,s=this.northwest,r=this.northeast;e.allAreRenderable=t.allAreRenderable&&i.allAreRenderable&&s.allAreRenderable&&r.allAreRenderable,e.anyWereRenderedLastFrame=t.anyWereRenderedLastFrame||i.anyWereRenderedLastFrame||s.anyWereRenderedLastFrame||r.anyWereRenderedLastFrame,e.notYetRenderableCount=t.notYetRenderableCount+i.notYetRenderableCount+s.notYetRenderableCount+r.notYetRenderableCount;}}const Sd=new Array(31);for(let e=0;e<Sd.length;++e)Sd[e]=new wd;const Ad=[];class Ed{constructor(t){if(this.hasTerrainData=t.hasTerrainData,this.tileScheme=t.tileScheme,this._levelZeroMaximumGeometricError=40075.16,this.maximumScreenSpaceError=t.maximumScreenSpaceError||2,this.type=t.type,this.terrainSource=t.terrainSource,this.drawingBufferHeight=t.drawingBufferHeight,this.pixelRatio=t.pixelRatio||1,this.selectedTiles=[],this.selectedAncestorTiles=[],this.tileLoadQueue=[],this._tileMaxZoom=t.tileMaxZoom,this._tileMinZoom=t.tileMinZoom,this.rootTiles=this.createLevelZeroTiles(),e.defined(t.customHeight)&&(e.defined(t.customHeight.minimumHeight)||e.defined(t.customHeight.maximumHeight)))for(let e=0;e<this.rootTiles.length;e++)this.rootTiles[e].customHeight={minimumHeight:t.customHeight.minimumHeight,maximumHeight:t.customHeight.maximumHeight};this._tmpQuadtreeTileBoundingRegionMap={},this._tileReplacementQueue=function(){const e=new xd;return e.head=void 0,e.tail=void 0,e.count=0,e}();}set tileMaxZoom(e){this._tileMaxZoom=e;}get tileMaxZoom(){return this._tileMaxZoom}set tileMinZoom(e){this._tileMinZoom=e;}get tileMinZoom(){return this._tileMinZoom}forEachLoadedTile(t){let i=this._tileReplacementQueue.head;for(;e.defined(i);)0!==i.state&&t(i),i=i.replacementNext;}tilesIn(e){this._tmpQuadtreeTileBoundingRegionMap={},this._tileReplacementQueue.markStartOfRenderFrame(),this.selectedTiles=[],this.selectedAncestorTiles=[],this.tileLoadQueue=[];for(let t=0;t<this.rootTiles.length;t++){const i=this.rootTiles[t];this._tileReplacementQueue.markTileRendered(i),i.renderable?(i.checkTileState(),this.visitIfVisible(this.rootTiles[t],!1,Ad[t],e)):this.addToLoadQueue(i,e.camera);}this._lastSelectionFrameNumber=e.frameNumber,this._tilesInEnd();}getQuadtreeTileByTileKey(t){const i=t.split("_"),s=parseInt(i[0]),r=this.tileScheme.type===e.ProjectionType.LATLON&&0===s?1:s,n=parseInt(i[1]),o=parseInt(i[2]),a=new e.OverscaledTileID(r,0,r,n,o),l=a.scaledTo(this.tileScheme.type===e.ProjectionType.LATLON?1:0);let h=r,_=null;for(;h>=0;){if(!_)for(let e=0;e<this.rootTiles.length;e++){const t=this.rootTiles[e];if(t.tileID.canonical.z===l.canonical.z&&t.tileID.canonical.x===l.canonical.x&&t.tileID.canonical.y===l.canonical.y){_=t;break}}if(0===h)break;const e=a.scaledTo(r-h+1);for(let t=0;t<_.children.length;t++){const i=_.children[t];if(i.tileID.canonical.z===e.canonical.z&&i.tileID.canonical.x===e.canonical.x&&i.tileID.canonical.y===e.canonical.y){_=i;break}}h--;}return _}getBoundingRegionById(e){return this._tmpQuadtreeTileBoundingRegionMap[e]||this.getQuadtreeTileByTileKey(e).tileBoundingRegion}_tilesInEnd(){for(let e=0;e<this.selectedTiles.length;e++){const t=this.selectedTiles[e];t.data&&(t.data.isAncestor=void 0,t.data.childDiscard=void 0);const i=t.getOverscaledTileID();i&&(this._tmpQuadtreeTileBoundingRegionMap[i.key]=t.tileBoundingRegion),t.tileID.canonical.z>=this._tileMinZoom&&(t.tileID.isAmbiguousHeight=t.tileBoundingRegion.isAmbiguousHeight);}this.selectedTiles.sort(((e,t)=>t.tileID.canonical.z-e.tileID.canonical.z)),this.selectedTiles.sort(((e,t)=>e._loadPriority-t._loadPriority));}visitIfVisible(t,i,s,r){if(this.computeTileVisibility(t,r.camera)!==m_.NONE)return this.visitTile(t,i,s,r);this._tileReplacementQueue.markTileRendered(t),s.allAreRenderable=!0,s.anyWereRenderedLastFrame=!1,s.notYetRenderableCount=0,function(t,i){const s=i.rectangle,r=e.toRadians(t.cartographicPosition[0]),n=e.toRadians(t.cartographicPosition[1]),o=new e.Cartographic(r,n,t.cartographicPosition[2]);return e.Rectangle.contains(s,o)}(r.camera,t)?(e.defined(t.data)&&e.defined(t.data.terrain)||this.addToLoadQueue(t),t._lastSelectionResult=h_.CULLED_BUT_NEEDED):t._lastSelectionResult=h_.CULLED,t._lastSelectionResultFrame=r.frameNumber;}visitTile(e,t,i,s){e.checkTileState(),this._tileReplacementQueue.markTileRendered(e);const r=this.screenSpaceError(s.camera,this.drawingBufferHeight,this.pixelRatio,e),n=e.southwestChild,o=e.southeastChild,a=e.northwestChild,l=e.northeastChild,h=e._lastSelectionResultFrame===this._lastSelectionFrameNumber?e._lastSelectionResult:h_.NONE;if(r<this.maximumScreenSpaceError||e.tileID.canonical.z>24||t)return this.selectedTiles.push(e),e.renderable||this.addToLoadQueue(e,s.camera),i.allAreRenderable=e.renderable,i.anyWereRenderedLastFrame=h===h_.RENDERED,i.notYetRenderableCount=e.renderable?0:1,e._lastSelectionResultFrame=s.frameNumber,void(e._lastSelectionResult=h_.RENDERED);if(this.canRefine(e)){if(n.upsampledFromParent&&o.upsampledFromParent&&a.upsampledFromParent&&l.upsampledFromParent)return this.selectedTiles.push(e),this._tileReplacementQueue.markTileRendered(n),this._tileReplacementQueue.markTileRendered(o),this._tileReplacementQueue.markTileRendered(a),this._tileReplacementQueue.markTileRendered(l),i.allAreRenderable=e.renderable,i.anyWereRenderedLastFrame=h===h_.RENDERED,i.notYetRenderableCount=e.renderable?0:1,e._lastSelectionResultFrame=s.frameNumber,void(e._lastSelectionResult=h_.RENDERED);e._lastSelectionResultFrame=s.frameNumber,e._lastSelectionResult=h_.REFINED;const _=this.selectedTiles.length;if(this.visitVisibleChildrenNearToFar(n,o,a,l,t,i,s),_!==this.selectedTiles.length){const t=i.allAreRenderable,s=i.anyWereRenderedLastFrame;if(t||s){if(!t&&s){this.selectedAncestorTiles.push(e),e.data.isAncestor=!0,e.data.sse=r,e.data.childDiscard=[0,0,0,0],e._southeastChild.renderable&&(e.data.childDiscard[3]=1),e._southwestChild.renderable&&(e.data.childDiscard[2]=1),e._northwestChild.renderable&&(e.data.childDiscard[0]=1),e._northeastChild.renderable&&(e.data.childDiscard[1]=1),e._lastSelectionResult=h_.RENDERED;const t=h===h_.RENDERED;i.allAreRenderable=e.renderable,i.anyWereRenderedLastFrame=t;}}else {this.selectedTiles.length=_,this.selectedTiles.push(e),e._lastSelectionResult=h_.RENDERED;const t=h===h_.RENDERED;i.allAreRenderable=e.renderable,i.anyWereRenderedLastFrame=t;}}}else e._lastSelectionResultFrame=s.frameNumber,e._lastSelectionResult=h_.RENDERED,this.addToLoadQueue(e,s.camera),this.selectedTiles.push(e),i.allAreRenderable=e.renderable,i.anyWereRenderedLastFrame=h===h_.RENDERED,i.notYetRenderableCount=e.renderable?0:1;}addToLoadQueue(e,t){e.needsLoading&&(e._loadPriority=this.computeTileLoadPriority(e,t),this.tileLoadQueue.push(e));}computeTileVisibility(t,i){const s=this.computeDistanceToTile(t,i);let r;t._distance=s;const n=i.frustumCrate.cullingVolume.computeVisibility(t.tileBoundingRegion.boundingVolume);return n===e.INTERSECTION.OUTSIDE?r=m_.NONE:n===e.INTERSECTION.INTERSECTING?r=m_.PARTIAL:n===e.INTERSECTION.INSIDE&&(r=m_.FULL),r}computeTileLoadPriority(t,i){if(!e.defined(t.tileBoundingRegion)||e.defined(t.tileBoundingRegion._orientedBoundingBox))return 0;const s=i.direction,r=e.Vector3.subtract(t.tileBoundingRegion._orientedBoundingBox.center,i.position,new e.Vector3),n=e.Vector3.magnitude(r);return n<1e-5?0:(e.Vector3.divideByScalar(r,n,r),(1-e.Vector3.dot(r,s))*t._distance)}screenSpaceError(e,t,i,s){let r=this.getLevelMaximumGeometricError(s.level)*t/(s._distance*e.frustumCrate.frustum._sseDenominator);return r/=i,r}computeDistanceToTile(e,t){return e.tileBoundingRegion.distanceToCamera(t)}getLevelMaximumGeometricError(e){return this._levelZeroMaximumGeometricError/(1<<e)}visitVisibleChildrenNearToFar(t,i,s,r,n,o,a){const l=e.Cartographic.fromVector3(a.camera.position),h=Sd[t.level],_=h.southwest,c=h.southeast,d=h.northwest,u=h.northeast;l.longitude<t.rectangle.east?l.latitude<t.rectangle.north?(this.visitIfVisible(t,n,_,a),this.visitIfVisible(i,n,c,a),this.visitIfVisible(s,n,d,a),this.visitIfVisible(r,n,u,a)):(this.visitIfVisible(s,n,d,a),this.visitIfVisible(t,n,_,a),this.visitIfVisible(r,n,u,a),this.visitIfVisible(i,n,c,a)):l.latitude<t.rectangle.north?(this.visitIfVisible(i,n,c,a),this.visitIfVisible(t,n,_,a),this.visitIfVisible(r,n,u,a),this.visitIfVisible(s,n,d,a)):(this.visitIfVisible(r,n,u,a),this.visitIfVisible(s,n,d,a),this.visitIfVisible(i,n,c,a),this.visitIfVisible(t,n,_,a)),h.combine(o);}canRefine(e){return !!e.renderable}createLevelZeroTiles(){const e=this.tileScheme.getNumberOfXTilesAtLevel(0),t=this.tileScheme.getNumberOfYTilesAtLevel(0),i=new Array(e*t);let s=0;for(let r=0;r<t;++r)for(let t=0;t<e;++t)Ad[s]=new vd,i[s++]=new Td({tilingScheme:this.tileScheme,x:t,y:r,level:0,hasTerrainData:this.hasTerrainData});return i}destroy(){this.hasTerrainData=null,this.tileScheme=null,this.selectedTiles=[],this.selectedAncestorTiles=[],this._tmpQuadtreeTileBoundingRegionMap={},this.forEachLoadedTile((e=>{e.freeResources();})),this._tileReplacementQueue=void 0;}}class Md extends e.Evented{constructor(e,t,i){super(),this.id=e,this.map=t.map,this.dispatcher=i,this._tiles={},this.rasterSources={},this.imageSources={},this.order=[],this.terrainSource=new Gl("ellipsoid",{type:"ellipsoid",map:this.map},this.dispatcher),this._init();}_init(){this._createQuadtree();}addOrMoveLayer(){this.getRasterLayerOrder(),this.quadtree.forEachLoadedTile((e=>{e.state=1,e.data?.loadRaster();}));}removeLayer(t){this.getRasterLayerOrder(),this.quadtree.forEachLoadedTile((i=>{const s=i.data.images;let r=-1,n=0;for(let i=0,o=s.length;i<o;++i){const o=s[i];let a=o.loadingImagery;if(e.defined(a)||(a=o.imagery),o.layerId===t)-1===r&&(r=i),o.freeResources(),++n;else if(-1!==r)break}-1!==r&&s.splice(r,n);}));}addTerrainAnalysisLayer(){this.quadtree.forEachLoadedTile((e=>{e.data.primitive&&(e.data.primitive.destroy(),e.data.createPrimitive());}));}removeTerrainAnalysisLayer(){this.quadtree.forEachLoadedTile((e=>{e.data.primitive&&e.data.primitive.destroy();})),this.quadtree=void 0,this._createQuadtree();}addSource(e,t){const i=Gl(e,t,this.dispatcher);i.onAdd(this.map),"raster"===t.type?this.rasterSources[e]=i:"image"===t.type&&(this.imageSources[e]=i);}getAllSources(){const e={};for(const t in this.imageSources)e[t]=this.imageSources[t];for(const t in this.rasterSources)e[t]=this.rasterSources[t];return e}getSource(e){return this.imageSources[e]||this.rasterSources[e]}removeSource(e){delete this.rasterSources[e],delete this.imageSources[e];}getRasterLayerOrder(){const e=this.map.style._layers,t=this.map.style._order;this.order=[];for(let i=0;i<t.length;i++)"raster"===e[t[i]].type&&this.order.push(t[i]);}_coveringTiles(){this._createQuadtree(),this.terrainSource.isTerrain()&&"loading"===this.terrainSource.availability.state||(this.map.painter.frameState.camera||(this.map.painter.frameState.camera=this.map.transform.activeCamera),this.quadtree.tilesIn(this.map.painter.frameState));}_createQuadtree(){if(e.defined(this.quadtree))return;const t=this.map.painter.context.gl.drawingBufferHeight;this.quadtree=new Ed({hasTerrainData:this.terrainSource instanceof Bl,terrainSource:this.terrainSource,maximumScreenSpaceError:this.map.rasterScreenSpaceError,tileScheme:this.map.transform.projection===e.ProjectionType.LATLON?new Ot({}):new Dt({}),drawingBufferHeight:t,pixelRatio:e.exported.devicePixelRatio,tileMinZoom:0,tileMaxZoom:22,type:"raster"});}update(){this._tiles={},this._coveringTiles();const e=this.quadtree.selectedAncestorTiles.concat(this.quadtree.selectedTiles),t=this.quadtree.tileLoadQueue;this.ambiguousSet=new Set,t.forEach((e=>{this._addTile(e);})),e.forEach((e=>{if(!e.renderable)return;const t=e.tileID;t.isAmbiguousHeight&&this.ambiguousSet.add(t.canonical.key),this._tiles[e.tileID.key]=e.data;})),this.quadtree._tileReplacementQueue.trimTiles(200),this.deferCallback&&this.loaded()?(this.deferCallback(),delete this.deferCallback):this.previousTiles&&(this._tiles=this.previousTiles);}_addTile(e){const t=e.tileID;if(e.data)"loaded"===e.data.state&&(e.renderable=!0);else {const i=new gd({tileID:t,sourceCache:this});e.data=i,this.quadtree._tileReplacementQueue.markTileRendered(e),i.loadTile(e);}}_unloadTile(e){e.unloadTile();}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}getVisibleCoordinates(){return Object.keys(this._tiles).map((e=>this._tiles[e].tileID))}resetQuadtree(){this.quadtree?.destroy(),delete this.quadtree,this._tiles={};}setTerrain(e){this.previousQuadtree=this.quadtree,delete this.quadtree,this.previousTerrainSource=this.terrainSource,delete this.terrainSource,this.previousTiles=this._tiles,this.deferCallback=()=>{this.previousQuadtree.forEachLoadedTile((e=>{this.previousTerrainSource.unloadTile(e.tileID),e.data.primitive&&e.data.primitive.destroy();})),delete this.previousQuadtree,this.previousTerrainSource.destroy(),delete this.previousTerrainSource,delete this.previousTiles;},e&&e.tiles?(e.format||(e.format="quantized"),e.type="terrain",e.map=this.map,this.terrainSource=new Gl("terrain",e,this.dispatcher),this.map.style.hasTerrainData=!0):(this.terrainSource=new Gl("ellipsoid",{type:"ellipsoid",map:this.map},this.dispatcher),this.map.style.hasTerrainData=!1),this.map.style.updateHasTerrainFlag(),this._createQuadtree(),this.map.needRepaint=!0;}loaded(){return this.quadtree.tileLoadQueue.length<1&&this.quadtree.selectedAncestorTiles.length<1}clearTiles(){this.resetQuadtree(),this.terrainSource.destroy();}}const Pd={RGBA4:e.WebGLConstants.RGBA4,RGBA8:e.WebGLConstants.RGBA8,RGBA16F:e.WebGLConstants.RGBA16F,RGBA32F:e.WebGLConstants.RGBA32F,RGB5_A1:e.WebGLConstants.RGB5_A1,RGB565:e.WebGLConstants.RGB565,DEPTH_COMPONENT16:e.WebGLConstants.DEPTH_COMPONENT16,STENCIL_INDEX8:e.WebGLConstants.STENCIL_INDEX8,DEPTH_STENCIL:e.WebGLConstants.DEPTH_STENCIL,DEPTH24_STENCIL8:e.WebGLConstants.DEPTH24_STENCIL8,validate:e=>e===Pd.RGBA4||e===Pd.RGBA8||e===Pd.RGBA16F||e===Pd.RGBA32F||e===Pd.RGB5_A1||e===Pd.RGB565||e===Pd.DEPTH_COMPONENT16||e===Pd.STENCIL_INDEX8||e===Pd.DEPTH_STENCIL||e===Pd.DEPTH24_STENCIL8,getColorFormat:t=>t===e.WebGLConstants.FLOAT?Pd.RGBA32F:t===e.WebGLConstants.HALF_FLOAT_OES?Pd.RGBA16F:Pd.RGBA8};var Rd=Object.freeze(Pd);class Bd{constructor(t){const i=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).context.gl,s=e.ContextLimits.maximumRenderbufferSize,r=e.defaultValue(t.format,Rd.RGBA4),n=e.defined(t.width)?t.width:i.drawingBufferWidth,o=e.defined(t.height)?t.height:i.drawingBufferHeight;if(!Rd.validate(r))throw new Error("Invalid format.");if(n>s)throw new Error(`宽度必须小于等于 renderbuffer size (${s}).  Check maximumRenderbufferSize.`);if(o>s)throw new Error(`高度必须小于等于 renderbuffer size (${s}).  Check maximumRenderbufferSize.`);this._gl=i,this._format=r,this._width=n,this._height=o,this._renderbuffer=this._gl.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,this._renderbuffer),i.renderbufferStorage(i.RENDERBUFFER,r,n,o),i.bindRenderbuffer(i.RENDERBUFFER,null);}get format(){return this._format}get width(){return this._width}get height(){return this._height}_getRenderbuffer(){return this._renderbuffer}isDestroyed(){return !1}destroy(){return this._gl.deleteRenderbuffer(this._renderbuffer),e.destroyObject(this)}}function Id(t,i,s){t.framebufferTexture2D(e.WebGLConstants.FRAMEBUFFER,i,s._target,s.texture,0);}function Dd(e,t,i){e.framebufferRenderbuffer(e.FRAMEBUFFER,t,e.RENDERBUFFER,i._getRenderbuffer());}class Od{constructor(t){const{context:i,width:s,height:r}=t;this.context=i,this.width=s,this.height=r;const n=i.gl;this._gl=n,this.framebuffer=n.createFramebuffer(),this._colorTextures=[],this._colorRenderbuffers=[],this._activeColorAttachments=[];const o=e.ContextLimits._maximumColorAttachments;if(this.destroyAttachments=!0,e.defined(t.colorTextures)&&e.defined(t.colorRenderbuffers))throw new Error("color texture 和 color renderbuffer attachments 不能同时存在。");if(e.defined(t.depthTexture)&&e.defined(t.depthRenderbuffer))throw new Error("depth texture 和 depth renderbuffer attachment 不能同时存在。");if(e.defined(t.depthStencilTexture)&&e.defined(t.depthStencilRenderbuffer))throw new Error("depth-stencil texture 和 depth-stencil renderbuffer attachment 不能同时存在。");const a=e.defined(t.depthTexture)||e.defined(t.depthRenderbuffer),l=e.defined(t.depthStencilTexture)||e.defined(t.depthStencilRenderbuffer);if(a&&l)throw new Error("depth 和 depth-stencil attachment 不能同时存在。");if(e.defined(t.stencilRenderbuffer)&&l)throw new Error("stencil 和 depth-stencil attachment 不能同时存在。");if(a&&e.defined(t.stencilRenderbuffer))throw new Error("depth 和 stencil attachment 不能同时存在。");let h,_,c,d;if(this._bind(),e.defined(t.colorTextures)){const s=t.colorTextures;if(c=this._colorTextures.length=this._activeColorAttachments.length=s.length,c>o)throw new Error("color attachments 越界！");for(let t=0;t<c;++t){if(h=s[t],!e.PixelFormat.isColorFormat(h.pixelFormat))throw new Error("color-texture 像素格式必须是颜色格式");if(h.pixelDatatype===e.WebGLConstants.FLOAT&&!i.extColorBufferFloat)throw new Error("The color texture pixel datatype is FLOAT and the WebGL implementation does not support the EXT_color_buffer_float or WEBGL_color_buffer_float extensions. See Context.colorBufferFloat.");if(h.pixelDatatype===e.WebGLConstants.HALF_FLOAT&&!i.extColorBufferHalfFloat)throw new Error("The color texture pixel datatype is HALF_FLOAT and the WebGL implementation does not support the EXT_color_buffer_half_float extension. See Context.colorBufferHalfFloat.");d=e.WebGLConstants.COLOR_ATTACHMENT0+t,Id(n,d,h),this._activeColorAttachments[t]=d,this._colorTextures[t]=h;}}if(e.defined(t.colorRenderbuffers)){const i=t.colorRenderbuffers;if(c=this._colorRenderbuffers.length=this._activeColorAttachments.length=i.length,c>o)throw new Error("color attachments 超过显卡数量限制");for(let t=0;t<c;++t)_=i[t],d=e.WebGLConstants.COLOR_ATTACHMENT0+t,Dd(n,d,_),this._activeColorAttachments[t]=d,this._colorRenderbuffers[t]=_;}if(e.defined(t.depthTexture)){if(h=t.depthTexture,h.pixelFormat!==e.WebGLConstants.DEPTH_COMPONENT)throw new Error("depth-texture 像素格式必须是 DEPTH_COMPONENT.");Id(n,e.WebGLConstants.DEPTH_ATTACHMENT,h),this._depthTexture=h;}if(e.defined(t.depthRenderbuffer)&&(_=t.depthRenderbuffer,Dd(n,e.WebGLConstants.DEPTH_ATTACHMENT,_),this._depthRenderbuffer=_),e.defined(t.stencilRenderbuffer)&&(_=t.stencilRenderbuffer,Dd(n,e.WebGLConstants.STENCIL_ATTACHMENT,_),this._stencilRenderbuffer=_),e.defined(t.depthStencilTexture)){if(h=t.depthStencilTexture,h.pixelFormat!==e.WebGLConstants.DEPTH_STENCIL)throw new Error("depth-stencil 的像素格式 必须是 DEPTH_STENCIL.");Id(n,e.WebGLConstants.DEPTH_STENCIL_ATTACHMENT,h),this._depthStencilTexture=h;}e.defined(t.depthStencilRenderbuffer)&&(_=t.depthStencilRenderbuffer,Dd(n,e.WebGLConstants.DEPTH_STENCIL_ATTACHMENT,_),this._depthStencilRenderbuffer=_),this._unBind();}get status(){this._bind();const e=this._gl.checkFramebufferStatus(this._gl.FRAMEBUFFER);return this._unBind(),e}get numberOfColorAttachments(){return this._activeColorAttachments.length}get depthTexture(){return this._depthTexture}get depthRenderbuffer(){return this._depthRenderbuffer}get stencilRenderbuffer(){return this._stencilRenderbuffer}get depthStencilTexture(){return this._depthStencilTexture}get depthStencilRenderbuffer(){return this._depthStencilRenderbuffer}get hasDepthAttachment(){return !!(this.depthTexture||this.depthRenderbuffer||this.depthStencilTexture||this.depthStencilRenderbuffer)}_bind(){this.context.gl.bindFramebuffer(e.WebGLConstants.FRAMEBUFFER,this.framebuffer);}_unBind(){this.context.gl.bindFramebuffer(e.WebGLConstants.FRAMEBUFFER,null);}bindDraw(){this.context.gl.bindFramebuffer(e.WebGLConstants.DRAW_FRAMEBUFFER,this.framebuffer);}bindRead(){this.context.gl.bindFramebuffer(e.WebGLConstants.READ_FRAMEBUFFER,this.framebuffer);}_getActiveColorAttachments(){return this._activeColorAttachments}getColorTexture(t){if(!e.defined(t)||t<0||t>=this._colorTextures.length)throw new Error("color的索引值必须输入，并且是≥0切小于color attachments的数量");return this._colorTextures[t]}getColorRenderbuffer(t){if(!e.defined(t)||t<0||t>=this._colorRenderbuffers.length)throw new Error("color的索引值必须输入，并且是≥0切小于color attachments的数量");return this._colorRenderbuffers[t]}destroy(t){const i=this.context.gl;if(this.destroyAttachments){let i=0;const s=this._colorTextures;let r=s.length;if(!t)for(;i<r;++i){const t=s[i];e.defined(t)&&t.destroy();}const n=this._colorRenderbuffers;for(r=n.length,i=0;i<r;++i){const t=n[i];e.defined(t)&&t.destroy();}this._depthTexture=this._depthTexture&&this._depthTexture.destroy(),this._depthRenderbuffer=this._depthRenderbuffer&&this._depthRenderbuffer.destroy(),this._stencilRenderbuffer=this._stencilRenderbuffer&&this._stencilRenderbuffer.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy();}return i.deleteFramebuffer(this.framebuffer),e.destroyObject(this)}}class Ld extends jo{constructor(t,i){const s=e.Color.parse(t).toVector3().multiplyScalar(i);super(new e.Color(s[0],s[1],s[2],1),i),this.type="AmbientLight",this.isAmbientLight=!0,this.castShadow=void 0;}serialize(){return {color:e.Vector3.pack(this.color,new Array(3)),intensity:this.intensity,type:this.type}}}class Vd{constructor(t){this.passType=t||e.RenderPassConsts.REAL_RENDER_PASS,this._sunLight=new ra(new e.Color(1,1,1),1,Date.now()),this._lights=[new Ld("#aaaaaa",1)],this._enableLight=!0,this._shadowModel=e.ShadowsType.ShadowMapping,this.overrideMaterial=void 0,this._shadows=!1,this.frameNumber=0,this.hasDefaultAmbientLight=!0;}set shadowModel(e){this._shadowModel=e;}setShadows(e){this._shadows=e;}set passType(t){e.defined(t)&&(this._type=t);}get passType(){return this._type}set framebuffer(e){this._framebuffer=e;}get framebuffer(){return this._framebuffer}get sunLight(){return this._sunLight}set sunLight(e){this._sunLight=e;}set lights(e){this._lights=e;}get lights(){return this._lights}addLight(e){"AmbientLight"==e.type&&this.hasDefaultAmbientLight&&(this._lights.splice(0,1),this.hasDefaultAmbientLight=!1),this._lights.push(e);}set camera(e){this._camera=e;}get camera(){return this._camera}get sameLayerFrame(){return this._sameLayerFrame}set sameLayerFrame(e){this._sameLayerFrame=e;}update(e){e.hasOwnProperty("framebuffer")&&(this.framebuffer=e.framebuffer),e.hasOwnProperty("lights")&&(this.lights=e.lights),e.hasOwnProperty("camera")&&(this.camera=e.camera),e.hasOwnProperty("passType")&&(this.passType=e.passType),e.hasOwnProperty("shadowCamera")&&(this.shadowCamera=e.shadowCamera),this.frameNumber=this.frameNumber>15e6?0:this.frameNumber+1;}bindFramebuffer(e){e.bindFramebuffer.set(this.framebuffer?this.framebuffer.framebuffer:null);}applyFrameState(e){e.bindFramebuffer.set(this.framebuffer.framebuffer);}lightSerialize(){const t=[];for(let e=0;e<this.lights.length;e++)t.push(this.lights[e].serialize());return e.defined(this.sunLight)&&t.push(this.sunLight.serialize()),t.push({enableLight:this._enableLight}),t}destroy(){this._framebuffer&&this._framebuffer.destroy();}}class Nd{constructor(e){const{passType:t}=e;this.passType=t,this.replaceMaterial=void 0,this._SSAASamples=1,this._SSAASamplesDirty=!0;}set SSAASamples(e){e!=this._SSAASamples&&(this._SSAASamples=e,this._SSAASamplesDirty=!0);}get SSAASamples(){return this._SSAASamples}middleRender(t,i,s,r){e.RenderState.applyRenderState(i,e.RenderState.fromCache({viewport:{x:0,y:0,width:this.width*this._SSAASamples,height:this.height*this._SSAASamples}})),i.clear({color:t._map._canvasTransparent?e.Color.transparent:e.Color.black,depth:1,stencil:0}),t.renderGroup.update({layers:t.style._layers,orders:t.style._order,frameState:s,ignoreNonePickPrimitive:r}),t.renderGroup.render({layers:t.style._layers,frameState:s}),1!=this.SSAASamples&&e.RenderState.applyRenderState(i,e.RenderState.fromCache({viewport:{x:0,y:0,width:this.width,height:this.height}}));}createFramebuffer({width:t,height:i,context:s}){const r=new e.Sampler({minificationFilter:e.TextureMinificationFilter.NEAREST,magnificationFilter:e.TextureMagnificationFilter.NEAREST}),n=t*this._SSAASamples,o=i*this._SSAASamples;return new Od({context:s,width:n,height:o,colorTextures:[new e.Texture({width:n,height:o,context:s,pixelFormat:e.WebGLConstants.RGBA})],depthStencilTexture:new e.Texture({context:s,width:n,height:o,minFilter:e.WebGLConstants.LINEAR,magFilter:e.WebGLConstants.LINEAR,pixelFormat:e.PixelFormat.DEPTH_STENCIL,pixelDatatype:e.PixelDatatype.UNSIGNED_INT_24_8,sampler:r,anisotropy:1})})}update(t,i,s){const{context:r}=t;if(!e.defined(i)||!e.defined(s))throw new Error("pass 必须手动设定宽高");this.width===i&&this.height===s&&this.framebuffer&&!this._SSAASamplesDirty||(this.framebuffer&&this.framebuffer.destroy(),this.framebuffer=this.createFramebuffer({width:i,height:s,context:r}),this._SSAASamplesDirty=!1),t.frameState.update({framebuffer:this.framebuffer}),t.frameState.bindFramebuffer(r),this.width=i,this.height=s;}destroy(t){return this.camera=void 0,this.framebuffer&&this.framebuffer.destroy(t),this.framebuffer=void 0,this.width=void 0,this.height=void 0,this.frameState&&(this.frameState.framebuffer=void 0,this.frameState.destroy()),this.frameState=void 0,this.passType=void 0,this.replaceMaterial&&this.replaceMaterial.destroy(),this.replaceMaterial=void 0,this.geometry&&this.geometry.destroy(),this.geometry=void 0,this.material&&(e.isFunction(this.material.destroy)?this.material.destroy():(this.renderState=void 0,this.uniforms=void 0,this.shaderSource&&this.shaderSource.destroy(),this.shaderSource=void 0)),this.material=void 0,e.destroyObject(this)}}function Fd(t,i,s,r,n,o=4,a=1){let l=new Uint8Array(o);n===e.WebGLConstants.FLOAT&&(l=new Float32Array(o));const h=i.bindFramebuffer.get();return i.bindFramebuffer.set(s?.framebuffer),i.gl.readPixels(t.x*e.window.devicePixelRatio*a,(r-t.y*e.window.devicePixelRatio)*a,t.width||1,t.height||1,e.WebGLConstants.RGBA,n||e.WebGLConstants.UNSIGNED_BYTE,l),i.bindFramebuffer.set(h),l}function Gd(e,t,i,s){switch(t.type){case e.FLOAT:return new kd(e,t,i,s);case e.FLOAT_VEC2:return new Ud(e,t,i,s);case e.FLOAT_VEC3:return new Hd(e,t,i,s);case e.FLOAT_VEC4:return new zd(e,t,i,s);case e.SAMPLER_2D:case e.SAMPLER_CUBE:return new Wd(e,t,i,s);case e.INT:case e.BOOL:return new jd(e,t,i,s);case e.INT_VEC2:case e.BOOL_VEC2:return new Xd(e,t,i,s);case e.INT_VEC3:case e.BOOL_VEC3:return new qd(e,t,i,s);case e.INT_VEC4:case e.BOOL_VEC4:return new Kd(e,t,i,s);case e.FLOAT_MAT2:return new Jd(e,t,i,s);case e.FLOAT_MAT3:return new Zd(e,t,i,s);case e.FLOAT_MAT4:return new Yd(e,t,i,s);default:console.warn(`Unrecognized uniform type: ${t.type} for uniform "${i}".`);}}class kd{constructor(e,t,i,s){this.name=i,this.value=void 0,this._value=0,this._gl=e,this._location=s;}set(){this.value!==this._value&&(this._value=this.value,this._gl.uniform1f(this._location,this.value));}}class Ud{constructor(t,i,s,r){this.name=s,this.value=void 0,this._value=new e.Vector2,this._gl=t,this._location=r;}set(){const t=this.value;e.Vector2.equalsArray(t,this._value)||(this._value.copy(t),this._gl.uniform2f(this._location,t.x,t.y));}}class Hd{constructor(t,i,s,r){this.name=s,this.value=void 0,this._value=new e.Vector3,this._gl=t,this._location=r;}set(){const t=this.value;t&&e.defined(t.x)&&(e.Vector3.equalsArray(t,this._value)||(this._value.copy(t),this._gl.uniform3f(this._location,t.x,t.y,t.z)));}}class zd{constructor(t,i,s,r){this.name=s,this.value=void 0,this._value=new e.Vector4,this._gl=t,this._location=r;}set(){const t=this.value;e.defined(t.x)&&(e.Vector4.equalsArray(t,this._value)||(this._value.copy(t),this._gl.uniform4f(this._location,t.x,t.y,t.z,t.w)));}}class Wd{constructor(e,t,i,s){this.name=i,this.value=void 0,this._gl=e,this._location=s,this.textureUnitIndex=void 0;}set(){const e=this._gl,t=this.value;t?(e.activeTexture(e.TEXTURE0+this.textureUnitIndex),e.bindTexture(t._target,t.texture)):console.error("Error set null Texture!");}_setSampler(e){return this.textureUnitIndex=e,this._gl.uniform1i(this._location,e),e+1}}class jd{constructor(e,t,i,s){this.name=i,this.value=void 0,this._value=0,this._gl=e,this._location=s;}set(){this.value!==this._value&&(this._value=this.value,this._gl.uniform1i(this._location,this.value));}}class Xd{constructor(t,i,s,r){this.name=s,this.value=void 0,this._value=new e.Vector2,this._gl=t,this._location=r;}set(){const t=this.value;e.Vector2.equalsArray(t,this._value)||(this._value.copy(t),this._gl.uniform2i(this._location,t.x,t.y));}}class qd{constructor(t,i,s,r){this.name=s,this.value=void 0,this._value=new e.Vector3,this._gl=t,this._location=r;}set(){const t=this.value;e.Vector3.equalsArray(t,this._value)||(this._value.copy(t),this._gl.uniform3i(this._location,t.x,t.y,t.z));}}class Kd{constructor(t,i,s,r){this.name=s,this.value=void 0,this._value=new e.Vector4,this._gl=t,this._location=r;}set(){const t=this.value;e.Vector4.equalsArray(t,this._value)||(this._value.copy(t),this._gl.uniform4i(this._location,t.x,t.y,t.z,t.w));}}class Jd{constructor(t,i,s,r){this.name=s,this.value=void 0,this._value=new e.Matrix2(e.Matrix2.ZERO),this._gl=t,this._location=r;}set(){if(!e.Matrix2.equalsArray(this.value,this._value)){this._value.copy(this.value);const e=this.value.toFloat32Array();this._gl.uniformMatrix2fv(this._location,!1,e);}}}class Zd{constructor(t,i,s,r){this.name=s,this.value=void 0,this._value=new e.Matrix3(e.Matrix3.ZERO),this._gl=t,this._location=r;}set(){if(!e.Matrix3.equalsArray(this.value,this._value,0)){this._value.copy(this.value);const e=this.value.toFloat32Array();this._gl.uniformMatrix3fv(this._location,!1,e);}}}class Yd{constructor(t,i,s,r){this.name=s,this.value=void 0,this._value=new e.Matrix4(e.Matrix4.ZERO),this._gl=t,this._location=r;}set(){if(!e.Matrix4.equalsArray(this.value,this._value,0)){this._value.copy(this.value);const e=this.value.toFloat32Array();this._gl.uniformMatrix4fv(this._location,!1,e);}}}function Qd(e,t,i,s){switch(t.type){case e.FLOAT:return new $d(e,t,i,s);case e.FLOAT_VEC2:return new eu(e,t,i,s);case e.FLOAT_VEC3:return new tu(e,t,i,s);case e.FLOAT_VEC4:return new iu(e,t,i,s);case e.SAMPLER_2D:case e.SAMPLER_CUBE:return new su(e,t,i,s);case e.INT:case e.BOOL:return new ru(e,t,i,s);case e.INT_VEC2:case e.BOOL_VEC2:return new nu(e,t,i,s);case e.INT_VEC3:case e.BOOL_VEC3:return new ou(e,t,i,s);case e.INT_VEC4:case e.BOOL_VEC4:return new au(e,t,i,s);case e.FLOAT_MAT2:return new lu(e,t,i,s);case e.FLOAT_MAT3:return new hu(e,t,i,s);case e.FLOAT_MAT4:return new _u(e,t,i,s);default:console.warn(`Unrecognized uniform type: ${t.type} for uniform "${i}".`);}}class $d{constructor(e,t,i,s){const r=s.length;this.name=i,this.value=new Array(r),this._value=new Float32Array(r),this._gl=e,this._location=s[0];}set(){const e=this.value,t=e.length,i=this._value;let s=!1;for(let r=0;r<t;++r){const t=e[r];t!==i[r]&&(i[r]=t,s=!0);}s&&this._gl.uniform1fv(this._location,i);}}class eu{constructor(e,t,i,s){const r=s.length;this.name=i,this.value=new Array(r),this._value=new Float32Array(2*r),this._gl=e,this._location=s[0];}set(){const t=this.value,i=t.length,s=this._value;let r=!1,n=0;for(let o=0;o<i;++o){const i=t[o];e.Vector2.equalsArray(i,s,n)||(e.Vector2.pack(i,s,n),r=!0),n+=2;}r&&this._gl.uniform2fv(this._location,s);}}class tu{constructor(e,t,i,s){const r=s.length;this.name=i,this.value=new Array(r),this._value=new Float32Array(3*r),this._gl=e,this._location=s[0];}set(){const t=this.value,i=t.length,s=this._value;let r=!1,n=0;for(let o=0;o<i;++o){const i=t[o];if(!e.defined(i))break;e.defined(i.r)?i.r===s[n]&&i.g===s[n+1]&&i.b===s[n+2]||(s[n]=i.r,s[n+1]=i.g,s[n+2]=i.b,r=!0):e.defined(i.x)?e.Vector3.equalsArray(i,s,n)||(e.Vector3.pack(i,s,n),r=!0):console.warn("Invalid vec3 value."),n+=3;}r&&this._gl.uniform3fv(this._location,s);}}class iu{constructor(e,t,i,s){const r=s.length;this.name=i,this.value=new Array(r),this._value=new Float32Array(4*r),this._gl=e,this._location=s[0];}set(){const t=this.value,i=t.length,s=this._value;let r=!1,n=0;for(let o=0;o<i;++o){const i=t[o];e.defined(i.x)&&(e.Vector4.equalsArray(i,s,n)||(e.Vector4.pack(i,s,n),r=!0)),n+=4;}r&&this._gl.uniform4fv(this._location,s);}}class su{constructor(e,t,i,s){const r=s.length;this.name=i,this.value=new Array(r),this._value=new Float32Array(r),this._gl=e,this._locations=s,this.textureUnitIndex=void 0;}set(){const e=this._gl,t=e.TEXTURE0+this.textureUnitIndex,i=this.value,s=i.length;for(let r=0;r<s;++r){const s=i[r];e.activeTexture(t+r),e.bindTexture(s._target,s.texture);}}_setSampler(e){this.textureUnitIndex=e;const t=this._locations,i=t.length;for(let s=0;s<i;++s)this._gl.uniform1i(t[s],e+s);return e+i}}class ru{constructor(e,t,i,s){const r=s.length;this.name=i,this.value=new Array(r),this._value=new Int32Array(r),this._gl=e,this._location=s[0];}set(){const e=this.value,t=e.length,i=this._value;let s=!1;for(let r=0;r<t;++r){const t=e[r];t!==i[r]&&(i[r]=t,s=!0);}s&&this._gl.uniform1iv(this._location,i);}}class nu{constructor(e,t,i,s){const r=s.length;this.name=i,this.value=new Array(r),this._value=new Int32Array(2*r),this._gl=e,this._location=s[0];}set(){const t=this.value,i=t.length,s=this._value;let r=!1,n=0;for(let o=0;o<i;++o){const i=t[o];e.Vector2.equalsArray(i,s,n)||(e.Vector2.pack(i,s,n),r=!0),n+=2;}r&&this._gl.uniform2iv(this._location,s);}}class ou{constructor(e,t,i,s){const r=s.length;this.name=i,this.value=new Array(r),this._value=new Int32Array(3*r),this._gl=e,this._location=s[0];}set(){const t=this.value,i=t.length,s=this._value;let r=!1,n=0;for(let o=0;o<i;++o){const i=t[o];e.Vector3.equalsArray(i,s,n)||(e.Vector3.pack(i,s,n),r=!0),n+=3;}r&&this._gl.uniform3iv(this._location,s);}}class au{constructor(e,t,i,s){const r=s.length;this.name=i,this.value=new Array(r),this._value=new Int32Array(4*r),this._gl=e,this._location=s[0];}set(){const t=this.value,i=t.length,s=this._value;let r=!1,n=0;for(let o=0;o<i;++o){const i=t[o];e.Vector4.equalsArray(i,s,n)||(e.Vector4.pack(i,s,n),r=!0),n+=4;}r&&this._gl.uniform4iv(this._location,s);}}class lu{constructor(e,t,i,s){const r=s.length;this.name=i,this.value=new Array(r),this._value=new Float32Array(4*r),this._gl=e,this._location=s[0];}set(){const t=this.value,i=t.length,s=this._value;let r=!1,n=0;for(let o=0;o<i;++o){const i=t[o];e.Matrix2.equalsArray(i,s,n)||(e.Matrix2.pack(i,s,n),r=!0),n+=4;}r&&this._gl.uniformMatrix2fv(this._location,!1,s);}}class hu{constructor(e,t,i,s){const r=s.length;this.name=i,this.value=new Array(r),this._value=new Float32Array(9*r),this._gl=e,this._location=s[0];}set(){const t=this.value,i=t.length,s=this._value;let r=!1,n=0;for(let o=0;o<i;++o){const i=t[o];if(!i)break;e.Matrix3.equalsArray(i,s,n)||(e.Matrix3.pack(i,s,n),r=!0),n+=9;}r&&this._gl.uniformMatrix3fv(this._location,!1,s);}}class _u{constructor(e,t,i,s){const r=s.length;this.name=i,this.value=new Array(r),this._value=new Float32Array(16*r),this._gl=e,this._location=s[0];}set(){const t=this.value,i=t.length,s=this._value;let r=!1,n=0;for(let o=0;o<i;++o){const i=t[o];if(!i)break;e.Matrix4.equalsArray(i,s,n)||(e.Matrix4.pack(i,s,n),r=!0),n+=16;}r&&this._gl.uniformMatrix4fv(this._location,!1,s);}}class cu{constructor(e){this.name=e,this._value={},this._locations={},this.isUniformStruct=!0;}addLocation(e){this._locations[e.name]||(this._locations[e.name]=e.value);}set(){const e=Object.getOwnPropertyNames(this._locations);for(let t=0;t<e.length;t++)this._locations[e[t]].set();}}function du(e,t){return new cu(e,t)}Object.defineProperties(cu.prototype,{value:{set(e){if(!function(e,t){const i=Object.getOwnPropertyNames(e),s=Object.getOwnPropertyNames(t);if(i.length!=s.length)return !1;for(let s=0;s<i.length;s++){const r=i[s];if(e[r]!==t[r])return !1}return !0}(e,this._value)){const t=Object.getOwnPropertyNames(e);for(let i=0;i<t.length;i++)this._locations[t[i]].value=(0,e[i])();}}}});const uu={[e.WebGLConstants.POINTS]:1,[e.WebGLConstants.LINES]:2,[e.WebGLConstants.LINE_LOOP]:2,[e.WebGLConstants.LINE_STRIP]:2,[e.WebGLConstants.TRIANGLES]:3};class mu{constructor(t,i,s){const r=t.gl;this.program=r.createProgram();const n=s?s.getBinderAttributes():[],o=s.defines().concat(this._setMicroDefines(i.defines)),a=o.concat(e.shaders.prelude.fragmentSource,e.shaders.unpackAll.fragmentSource,i.fragmentSource).join("\n"),l=o.concat(e.shaders.prelude.vertexSource,e.shaders.unpackAll.vertexSource,i.vertexSource).join("\n"),h=r.createShader(e.WebGLConstants.FRAGMENT_SHADER);r.shaderSource(h,a),r.compileShader(h),r.attachShader(this.program,h);const _=r.createShader(e.WebGLConstants.VERTEX_SHADER);r.shaderSource(_,l),r.compileShader(_),r.attachShader(this.program,_),this.attributes={},this.numAttributes=n.length;for(let e=0;e<this.numAttributes;e++)n[e]&&(r.bindAttribLocation(this.program,e,n[e]),this.attributes[n[e]]=e);r.linkProgram(this.program),r.deleteShader(_),r.deleteShader(h),this.numAttributes=r.getProgramParameter(this.program,e.WebGLConstants.ACTIVE_ATTRIBUTES);for(let e=0;e<this.numAttributes;e++){const t=r.getActiveAttrib(this.program,e);t&&(this.attributes[t.name]=r.getAttribLocation(this.program,t.name));}const c=s?s.getBinderUniforms():[],d={};for(let e=0;e<c.length;e++){const t=c[e];if(t&&!d[t]){const e=r.getUniformLocation(this.program,t);e&&(d[t]=e);}}this.binderUniforms=s?s.getUniforms(t,d):[],this.programUniforms=mu.findUniforms(r,this.program),this.programUniforms&&this.programUniforms.samplerUniforms.length>0&&(this.maximumTextureUnitIndex=this._setSamplerUniforms(r,this.program));}_setUniforms(t){const i=this.programUniforms.uniformsByName,s=e.intersectionMapKeys(i,t);for(let e=0;e<s.length;e++){const r=s[e],n=t.get(r),o=i.get(r);if(o.isUniformStruct)for(const e in o._locations)Object.hasOwnProperty.call(o._locations,e)&&(o._locations[e].value=n[e]());else o.value=n();}const r=this.programUniforms.uniforms,n=r.length;for(let e=0;e<n;++e)if(r[e].isUniformStruct)for(const t in r[e]._locations)Object.hasOwnProperty.call(r[e]._locations,t)&&r[e]._locations[t].set();else null!=r[e].value&&r[e].set();}_setSamplerUniforms(e,t){e.useProgram(t);let i=0;const s=this.programUniforms.samplerUniforms.length;for(let e=0;e<s;++e)i=this.programUniforms.samplerUniforms[e]._setSampler(i);return e.useProgram(null),i}_setMicroDefines(e){let t="";for(const i in e)"string"==typeof e[i]&&e[i]?.includes("#define")?t+=`${e[i]}\r\n`:"boolean"==typeof e[i]?e[i]&&(t+=`#define M_${i} \r\n`):t+=`#define M_${i} ${e[i]} \r\n`;return t}draw(t){const{context:i,drawMode:s,layerID:r,layoutVertexBuffer:n,indexBuffer:o,segments:a,configuration:l,dynamicLayoutBuffer:h,dynamicLayoutBuffer2:_,dynamicLayoutBuffer3:c,animationVertexBuffers:d,instanceVerterBuffers:u,numScaleForWireframe:m}=t,p=i.gl,f=uu[s];for(let t=0;t<a.segments.length;t++){const g=a.segments[t],y=g.vaos||(g.vaos={}),T=y[r+s]||(y[r+s]=new pl);if(g.isModel)o?(T.bind(i,this,n,[],o,g.vertexOffset,h),g.isInstance?i.drawInstance.drawElementsInstancedANGLE(s,g.modelVertexCount,o.type,g.modelVertexOffset,g.instancesCount):p.drawElements(s,g.modelVertexCount,o.type,g.modelVertexOffset)):(T.bind(i,this,n,[],null,g.vertexOffset,h),g.isInstance?i.drawInstance.drawArraysInstancedANGLE(s,0,g.modelVertexCount,g.instancesCount):p.drawArrays(s,g.modelVertexOffset,g.modelVertexCount));else {if(!n)return;g.isInstance&&o?(T.bind(i,this,n,l?l.getPaintVertexBuffers():[],o,g.vertexOffset,h,_,c,d,u),i.drawInstance.drawElementsInstancedANGLE(s,g.indicesCount,e.WebGLConstants.UNSIGNED_SHORT,0,g.instanceCount)):(T.bind(i,this,n,l?l.getPaintVertexBuffers():[],o||void 0,g.vertexOffset,h,_,c,d),o?p.drawElements(s,g.primitiveLength*f*(m||1),o.type?o.type:e.WebGLConstants.UNSIGNED_SHORT,g.primitiveOffset*f*2):p.drawArrays(s,0,g.vertexLength));}}}static findUniforms(t,i){const s=new Map,r=[],n=[],o=t.getProgramParameter(i,e.WebGLConstants.ACTIVE_UNIFORMS);for(let a=0;a<o;++a){const o=t.getActiveUniform(i,a),l="[0]",h=-1!==o.name.indexOf(l,o.name.length-l.length)?o.name.slice(0,o.name.length-3):o.name;if(0!==h.indexOf("gl_")){const a=t.getUniformLocation(i,h);if(o.name.indexOf(".")>0&&o.name.indexOf("[")<0){const e=o.name.slice(o.name.indexOf(".")+1,o.name.length),i=o.name.slice(0,o.name.indexOf(".")),n=Gd(t,o,e,a);let l=s.get(i);l||(l=du(i),s.set(i,l),r.push(l)),l.addLocation({name:e,value:n});}else if(o.name.indexOf("[")<0){if(null!==a){const e=Gd(t,o,h,a);s.set(h,e),r.push(e),e._setSampler&&n.push(e);}}else {let a,l,_,c;const d=h.indexOf("[");if(d>=0){if(a=s.get(h.slice(0,d)),!e.defined(a))continue;l=a._locations,l.length<=1&&(_=a.value,c=t.getUniformLocation(i,h),null!==c&&(l.push(c),_.push(t.getUniform(i,c))));}else {l=[];for(let e=0;e<o.size;++e)c=t.getUniformLocation(i,`${h}[${e}]`),null!==c&&l.push(c);a=Qd(t,o,h,l),s.set(h,a),r.push(a),a._setSampler&&n.push(a);}}}}return {uniformsByName:s,uniforms:r,samplerUniforms:n}}destroy(e){e.gl.deleteProgram(this.program);}}class pu{constructor(t){this.programCache=new Map,this._context=t.context,this.globalDefinitions={DEVICE_PIXEL_RATIO:e.exported.devicePixelRatio.toFixed(1),TEXTURE_LOD_SUPPORTED:!!this._context.hasLODExtension,STANDARD_DERIVATIVES_SUPPORTED:!!this._context.hasDerivativesExt,LOG_DEPTH:!1,DEPTH_EXT:!!this._context.extFragDepth,UNSUPPORTED_COLOR_BUFFER_FLOAT:!this._context.extColorBufferFloat};}setGlobalMacroDefinition(e){for(const t in e)this.globalDefinitions[t]=e[t];}_makeSpecialKey(t){if(!t)return "";for(const i in this.globalDefinitions)e.defined(t[i])||(t[i]=this.globalDefinitions[i]);const i=Object.keys(t).sort();let s="";for(let e=0;e<i.length;e++){const r=i[e];"boolean"==typeof t[r]?t[r]&&(s+=`${r}:${t[r]},`):s+=`${r}:${t[r]},`;}return s}getFullId(e,t,i){return `${e}_${this._makeSpecialKey(t)}_${i}`}hasProgram(e){return this.programCache.has(e)}getProgramByGLSLMacroDefinition(e,t){const i=this.getFullId(e.type,e.defines,t.cacheKey);return this.hasProgram(i)||(this.globalDefinitions.LOG_DEPTH=this._context._logDepth,e.defines=Object.assign({},e.defines,this.globalDefinitions),this.programCache.set(i,new mu(this._context,e,t))),this.programCache.get(i)}static getVectorLineDefinition(t,i){const s={};return e.checkIsVectorShadowVolumeDataType(i.classificationType)&&(s.SHADOW_VOLUME=!0),s}static getSphereCircleDefinition(t,i){const s={};return e.checkIsVectorShadowVolumeDataType(i.classificationType)&&(s.SHADOW_VOLUME=!0),s}static getSphereHeatmapDefinition(t,i){const s={};return e.checkIsVectorShadowVolumeDataType(i.classificationType)&&(s.SHADOW_VOLUME=!0),s}static getRasterSourceAndLayerMicroDefinition(){return {}}static getExtrusionMicroDefinition(t,i){const s={};return s.ANS_ENABLED=!!i&&!!i.enabled,s.PHONG_LIGHT=t.lightingModel===e.LightingModelType.PHONG,s}static getEarthMaterialDefinition(t){return {HAS_NIGHT_MAP:e.defined(t.nightTexture),HAS_BASE_MAP:e.defined(t.earthTexture),HAS_CLOUD_MAP:e.defined(t.earthCloudTexture)}}destroy(){this.programCache.forEach((e=>{e.destroy(this._context);})),this.programCache.clear();}}class fu extends e.Material{constructor(t){super(t),this.layer=t.layer,this.tile=t.tile,this.coord=t.coord,this._programConfiguration=t.programConfiguration,this._renderState=t.renderState,this._unitsToPixels=new e.Vector2,this._cameraPosition=new e.Vector3,this._pixelMatrix=new e.Matrix2;const i=t.painter;this.matrix=new e.Matrix4,this.matrix.ortho({left:0,right:i.width,bottom:i.height,top:0,near:0,far:1}),this.colorRampTexture=new e.Texture({context:i.context,image:this.layer.colorRamp,pixelFormat:e.WebGLConstants.RGBA}),this._createUniforms(i);}update(t,i,s={}){super.update(t,i,s),this.basecolorTexture=s.texture,this._uniforms.set("u_ModelViewProjectionMatrix",(()=>this.matrix)),this.renderState.blending={enabled:!0,color:{red:0,green:0,blue:0,alpha:0},equationRgb:e.WebGLConstants.FUNC_ADD,equationAlpha:e.WebGLConstants.FUNC_ADD,functionSourceRgb:e.WebGLConstants.SRC_ALPHA,functionSourceAlpha:e.WebGLConstants.ONE,functionDestinationRgb:e.WebGLConstants.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:e.WebGLConstants.ONE_MINUS_SRC_ALPHA};}_createUniforms(t){this._uniforms.set("u_GlUnitsToPixels",(()=>this._unitsToPixels.set(t.style.symbolMatrixHelper.width/2,t.style.symbolMatrixHelper.height/2))),this._uniforms.set("u_PixelMatrix",(()=>(this._pixelMatrix.identity(),this._pixelMatrix.scale([1,Math.cos(t.transform.hpr.pitch)]),this._pixelMatrix.rotate(-t.transform.hpr.heading),this._pixelMatrix))),this._uniforms.set("u_Opacity",(()=>this.layer.paint.get("heatmap-opacity"))),this._uniforms.set("u_BaseColorSampler",(()=>(this.basecolorTexture.sampler={minificationFilter:e.WebGLConstants.LINEAR,magnificationFilter:e.WebGLConstants.LINEAR,wrapS:e.WebGLConstants.CLAMP_TO_EDGE,wrapT:e.WebGLConstants.CLAMP_TO_EDGE},this.basecolorTexture))),this._uniforms.set("u_color_ramp",(()=>(this.colorRampTexture.sampler={minificationFilter:e.WebGLConstants.LINEAR,magnificationFilter:e.WebGLConstants.LINEAR,wrapS:e.WebGLConstants.CLAMP_TO_EDGE,wrapT:e.WebGLConstants.CLAMP_TO_EDGE},this.colorRampTexture))),this._uniforms.set("u_World",(()=>new e.Vector2(t.context.drawingBufferWidth,t.context.drawingBufferHeight)));}destroy(){this.layer=void 0,this.tile=void 0,this.coord=void 0,this.pattern=void 0,this.type=void 0,this._uniforms=void 0,this._textures=void 0,this._program=void 0,this._programConfiguration=void 0,this._renderState=void 0,this._unitsToPixels=void 0,this._cameraPosition=void 0,this._pixelMatrix=void 0;}}class gu{constructor(e){this.textures={},this.requests={},this.source=e||{fire(){}};}addTexture(t,i,s,r,n){if(this.getTexture(t)||this.requests[t])r&&(r.state="loaded"),this.source.fire(new e.Event("data",{dataType:"gltf-data-loaded"}));else {if(i)this.requests[t]=e.getImage({url:i},((i,r)=>{if(i)throw new e.ErrorEvent(i);if(r){const i=new e.Texture({context:s,image:r,pixelFormat:e.WebGLConstants.RGBA,useMipmap:!0});i.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),this.textures[t]=i,this.requests[t]=null,delete this.requests[t];}}));else {const i=new e.window.Image,o=e.window.URL||e.window.webkitURL;i.onload=()=>{const r=new e.Texture({context:s,image:i,pixelFormat:e.WebGLConstants.RGBA,useMipmap:!0});r.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),this.textures[t]=r,this.requests[t]=null,delete this.requests[t];};const a=t.slice(t.lastIndexOf("_")+1),l=new e.window.Blob([new Uint8Array(n)],{type:r.result.gltf.images[a].mimeType});i.src=n.length?o.createObjectURL(l):e.CONSTS.SOURCE.TRANSPARENT_PNG_URL;}r.requestImages++;}}getTexture(e){return this.textures[e]}removeTexture(e){this.textures[e]&&(this.requests[e]&&(this.requests[e].cancel(),this.requests[e]=null,delete this.requests[e]),this.textures[e].destroy(),this.textures[e]=null,delete this.textures[e]);}getCanvasData(e){}removeAllTexture(){for(const e in this.textures)this.removeTexture(e),this.requests[e].cancel();}}class yu extends e.Evented{constructor(){super(),this._drawCommands=new U,this.sharedTextures=new gu,this.isPlotter=!0;}update(){}updateFrameState(e){this.frameState=e;}parse(e,t,i,s){}render(e){}createMaterial(e){}parseMaterial(){}parseGeometry(){}static parseRenderState(t,i){if(e.checkIsVectorShadowVolumeDataType(i.classificationType)){const t={};t.blending=e.renderStateEnum.disableBlending,t.cull=e.renderStateEnum.disableCull,t.depthTest=e.renderStateEnum.enableDepthTest,t.depthRange=e.renderStateEnum.depthRange,t.depthMask=e.renderStateEnum.disableDepthMask,t.stencilTest=e.renderStateEnum.enableClassificationStencilTest,t.stencilMask=e.renderStateEnum.enableStencilMask,t.colorMask=e.renderStateEnum.disabledColorMask;const i={};return i.blending=e.renderStateEnum.enableBlending,i.cull=e.renderStateEnum.disableCull,i.depthTest=e.renderStateEnum.disableDepthTest,i.depthRange=e.renderStateEnum.depthRange,i.depthMask=e.renderStateEnum.disableDepthMask,i.stencilTest=e.renderStateEnum.openClassificationStencilTest,i.colorMask=e.renderStateEnum.enableColorMask,i.stencilMask=e.renderStateEnum.enableStencilMask,e.deepCopyObj({pass1:t,pass2:i})}{const t={};return t.blending=e.renderStateEnum.enableBlending,t.depthRange=e.renderStateEnum.depthRange,i.depthTest?(t.depthTest=e.renderStateEnum.enableDepthTest,t.depthMask=e.renderStateEnum.enableDepthMask):(t.depthTest=e.renderStateEnum.disableDepthTest,t.depthMask=e.renderStateEnum.disableDepthMask),t.cull=e.renderStateEnum.enableCull,t.frontFace=e.WebGLConstants.CW,t.stencilTest=e.renderStateEnum.disableStencilTest,t.stencilMask=e.renderStateEnum.disableStencilMask,e.deepCopyObj(t)}}}const Tu={[e.RenderPassConsts._USER_DEFINED_PRE_PASS]:(e,t)=>t(e),[e.RenderPassConsts.PICK_PASS]:e=>e,[e.RenderPassConsts.SHADOW_PASS]:e=>e,[e.RenderPassConsts.VIEWSHED_PASS]:e=>e,[e.RenderPassConsts.REAL_RENDER_PASS]:e=>e,[e.RenderPassConsts.FXAA_PASS]:e=>e,[e.RenderPassConsts.BLOOM_PASS]:()=>[],[e.RenderPassConsts.TOON_SHADING_PASS]:()=>[],[e.RenderPassConsts.HDR_PASS]:()=>[],[e.RenderPassConsts.USER_DEFINED_POST_PROCESS_PASS]:()=>[],[e.RenderPassConsts.PICK_COLOR_PASS]:e=>e,[e.RenderPassConsts.CUBE_MAP_RENDER_FOR_SKYBOX]:t=>{const i=[];for(let s=0;s<t.length;s++)if(e.RenderPassConsts.CUBE_MAP_RENDER_FOR_SKYBOX in t[s].filterPassIds)return i.push(t[s]);return i},[e.RenderPassConsts.EARTH_EFFECT_PASS]:e=>e,[e.RenderPassConsts.PROXY_PASS]:e=>e},Cu=Object.freeze({ENCODE_DEPTH_TO_FRAGCOLOR:!1,RENDER_GRAY_IMAGE:!1});function xu({source:t,layer:i,isInstance:s,passType:r,animationsInfo:n}){const o=function(t,i,s){const{animationsInfo:r}=s,n={};return n.ANS_ENABLED=!!r&&e.defaultValue(r.enabled,!1),i&&e.checkIsVectorShadowVolumeDataType(i.classificationType)&&(n.SHADOW_VOLUME=!0),t&&t.clampEnabled&&(n.HAS_CLIPPING=!0,t.clampPlane?n.IS_CLIPPING_PLANE=!0:t.clampBox?n.IS_CLIPPING_BOX=!0:t.clampRange&&(n.IS_CLIPPING_RANGE=!0)),i&&i.lightingModel===e.LightingModelType.PBR?(n.USE_PBR=!0,n.USE_IBL=!0):(n.USE_PBR=!1,n.USE_IBL=!1),n.PHONG_LIGHT=i?.lightingModel===e.LightingModelType.PHONG,n}(t,i,{isInstance:s,passType:r,animationsInfo:n}),a=function(t){switch(t){case e.RenderPassConsts.PICK_PASS:return e.extend({},Cu,{ENCODE_DEPTH_TO_FRAGCOLOR:!0});case e.RenderPassConsts.SHADOW_PASS:case e.RenderPassConsts.VIEWSHED_PASS:case e.RenderPassConsts.REAL_RENDER_PASS:case e.RenderPassConsts.BLOOM_PASS:case e.RenderPassConsts.FXAA_PASS:case e.RenderPassConsts.HDR_PASS:case e.RenderPassConsts.TOON_SHADING_PASS:return e.extend({},Cu,{});case e.RenderPassConsts.PICK_COLOR_PASS:return e.extend({},Cu,{USE_PICKING:!0});default:return e.extend({},Cu,{})}}(r);return e.extend(o,a)}var bu=e.createLayout([{name:"a_POSITION",type:"Int16",components:2}]);class vu{constructor(t){this.type="ViewportQuadGeometry",this.primitiveType=e.WebGLConstants.TRIANGLE_STRIP,this._segmentVector=e.SegmentVector.simpleSegment(0,0,4);const i=new e.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(1,0),i.emplaceBack(0,1),i.emplaceBack(1,1),this.state=e.State.PROCESSINGFISH,this._vertexBuffer=t.context.createVertexBuffer(i,bu.members);}update(){}destroy(){this.type=void 0,this.primitiveType=void 0,this._vertexBuffer.destroy(),this._vertexBuffer=void 0,this._segmentVector.destroy(),this._segmentVector=void 0;}}class wu extends e.Geometry{constructor(t){super(),this.type="HeatMapViewPortGeometry",this.primitiveType=e.WebGLConstants.TRIANGLES,this.widthSegments=t.widthSegments,this.heightSegments=t.heightSegments,this.transform=t.transform,this._vertexArray=void 0,this._indexArray=void 0,this._width=1,this._height=1,this._vertexLength=0,this._primitiveLength=0,this._needUpdate=!1,this.parse();}parse(){this._vertexArray=new e.StructArrayLayout5f20,this._indexArray=new e.StructArrayLayout3ul12;const t=Math.floor(this.widthSegments),i=Math.floor(this.heightSegments),s=t+1,r=i+1,n=this._width/t,o=this._height/i;for(let e=0;e<r;e++){const r=e*o;for(let o=0;o<s;o++)this._vertexArray.emplaceBack(o*n/this._width*2-1,1-r/this._height*2,1,o/t,1-e/i);}this._vertexLength=s*r;for(let e=0;e<i;e++)for(let i=0;i<t;i++){const t=i+s*(e+1),r=i+1+s*(e+1),n=i+1+s*e;this._indexArray.emplaceBack(i+s*e,n,t),this._indexArray.emplaceBack(n,t,r);}this._primitiveLength=t*i*2,this._needUpdate=!0;}update(t){const i=t.painter.context;this.transform=t.painter.transform,this.widthSegments===this.transform.width/4&&this.heightSegments===this.transform.height/4||(this.widthSegments=this.transform.width/4,this.heightSegments=this.transform.height/4,this.parse()),this._needUpdate&&(this._vertexBuffer&&this._indexBuffer&&this._segmentVector?(this._vertexBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indexArray),this._segmentVector.destroy(),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this._vertexLength,this._primitiveLength)):(this._vertexBuffer=i.createVertexBuffer(this._vertexArray,Wa.members,!0),this._indexBuffer=new na(i,this._indexArray,!0,e.WebGLConstants.UNSIGNED_INT),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this._vertexLength,this._primitiveLength)),this._needUpdate=!1);}destroy(){this.type=void 0,this.primitiveType=void 0,this.widthSegments=void 0,this.heightSegments=void 0,this.transform=void 0,this._vertexArray=void 0,this._indexArray=void 0,this._width=void 0,this._height=void 0,this._vertexLength=void 0,this._primitiveLength=void 0,this._needUpdate=void 0,this._segmentVector.destroy(),this._segmentVector=void 0,this._vertexBuffer.destroy(),this._vertexBuffer=void 0,this._indexBuffer.destroy(),this._indexBuffer=void 0;}}class Su extends e.Material{constructor(t){super(t),this.layer=t.layer,this.tile=t.tile,this.coord=t.coord,this._programConfiguration=t.programConfiguration,this._renderState=t.renderState,this.colorRampTexture=new e.Texture({context:t.painter.context,image:this.layer.colorRamp,pixelFormat:e.WebGLConstants.RGBA}),this._createUniforms();}update(t,i,s={}){super.update(t,i,s),this.basecolorTexture=s.texture;const r=this.getCamera(i);this._uniforms.set("u_ModelViewProjectionMatrix",(()=>r.getVPMatrix())),this._uniforms.set("u_InvertViewMatrix",(()=>r.getViewMatrix().invert())),this._uniforms.set("u_ViewMatrix",(()=>r.getViewMatrix().setTranslation(new e.Vector3(0,0,0)))),this._uniforms.set("u_HeightFactor",(()=>this.layer.paint.get("heatmap-height-factor").value.value)),this.renderState.blending={enabled:!0,color:{red:0,green:0,blue:0,alpha:0},equationRgb:e.WebGLConstants.FUNC_ADD,equationAlpha:e.WebGLConstants.FUNC_ADD,functionSourceRgb:e.WebGLConstants.SRC_ALPHA,functionSourceAlpha:e.WebGLConstants.ONE,functionDestinationRgb:e.WebGLConstants.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:e.WebGLConstants.ONE_MINUS_SRC_ALPHA};}_createUniforms(){this._uniforms.set("u_Opacity",(()=>this.layer.paint.get("heatmap-opacity"))),this._uniforms.set("u_BaseColorSampler",(()=>(this.basecolorTexture.sampler={minificationFilter:e.WebGLConstants.LINEAR,magnificationFilter:e.WebGLConstants.LINEAR,wrapS:e.WebGLConstants.CLAMP_TO_EDGE,wrapT:e.WebGLConstants.CLAMP_TO_EDGE},this.basecolorTexture))),this._uniforms.set("u_color_ramp",(()=>(this.colorRampTexture.sampler={minificationFilter:e.WebGLConstants.LINEAR,magnificationFilter:e.WebGLConstants.LINEAR,wrapS:e.WebGLConstants.CLAMP_TO_EDGE,wrapT:e.WebGLConstants.CLAMP_TO_EDGE},this.colorRampTexture))),this._uniforms.set("u_Bezier",(()=>new e.Vector4(.5,0,1,.5)));}destroy(){this.layer=void 0,this.tile=void 0,this.coord=void 0,this.pattern=void 0,this.type=void 0,this._uniforms=void 0,this._textures=void 0,this._program=void 0,this._programConfiguration=void 0,this._renderState=void 0,this.colorRampTexture.destroy(),this.colorRampTexture=void 0;}}class Au extends yu{constructor(e){super(e),this._renderPrimitives=[],this.plotterType="heatmap",this._texturePrimitive=null,this.framebuffer=null;}update(e,t,i,s,r){this.parse(e,t,i,s,r),this.render(e,i,r);}render(t,i,s){const r=Tu[s.passType](this._renderPrimitives);if(0==r.length||!this._texturePrimitive)return;const n=t.context,o=s.framebuffer;s.framebuffer=this.framebuffer,n.bindFramebuffer.set(this.framebuffer.framebuffer),n.clear({color:e.Color.transparent,depth:1,stencil:0});for(let e=0;e<r.length;e++){const n=r[e];n.update(t,s),n.render(t,i,s);}s.framebuffer=o,this._texturePrimitive.update(t,s,{texture:this.framebuffer.getColorTexture(0)}),this._texturePrimitive.render(t,i,s),this._renderPrimitives=[],t.tileClippingMask.status=!1;}parse(t,i,s,r,n){if(r.length>0){const o=xu({source:null,layer:null,isInstance:!1,passType:n.passType}),a=pu.getSphereHeatmapDefinition(null,s);e.extend(o,a);for(let e=0;e<r.length;e++){const n=i.getTile(r[e]);if(!n.getBucket(s))continue;const a=n.primitiveMap.get(s.id);a&&(a._material.renderState=this._createRenderState(t,s),a._material.defines=o,this._renderPrimitives.push(a));}if(!this._texturePrimitive||!this.framebuffer||s.colorRampChanged){s.colorRampChanged&&this.resize();const e=s.getLayoutProperty("display-mode");if("3d"===e||"3D"===e){const e=new wu({widthSegments:t.transform.width/4,heightSegments:t.transform.height/4,transform:t.transform});this._create3DTexturePrimitive({layer:s,painter:t,type:"heatmap3DTexture",geometry:e});}else this._createTexturePrimitive({layer:s,painter:t,type:"heatmapTexture"});this._createFramebuffer(t.width,t.height,t.context),s.colorRampChanged=!1;}}}_createFramebuffer(t,i,s){this.framebuffer||(this.framebuffer=new Od({context:s,width:t,height:i,colorTextures:[new e.Texture({width:t,height:i,context:s,pixelFormat:e.WebGLConstants.RGBA,pixelDatatype:e.WebGLConstants.FLOAT})],depthStencilRenderbuffer:new Bd({context:s,width:t,height:i,format:Rd.DEPTH_STENCIL})}));}_create3DTexturePrimitive(t){const{layer:i,painter:s,type:r,geometry:n}=t;if(!this._texturePrimitive){const t=this._create3DTextureMaterial({layer:i,painter:s,type:r});this._texturePrimitive=new e.Primitive({geometry:n,material:t});}}_create3DTextureMaterial(e){const{layer:t,painter:i,type:s}=e,r=this._createRenderState(i,t);return new Su({layer:t,painter:i,type:s,renderState:r})}_createTexturePrimitive(t){const{layer:i,painter:s,type:r}=t;if(!this._texturePrimitive){const t=this._createTextureMaterial({layer:i,painter:s,type:r}),n=new vu(s),o=new e.Primitive({geometry:n,material:t});this._texturePrimitive=o;}}_createTextureMaterial(e){const{layer:t,painter:i,type:s}=e,r=this._createRenderState(i,t);return new fu({layer:t,painter:i,type:s,renderState:r})}_createRenderState(t,i){const s=Au.parseRenderState(t,i);return s.cull=e.renderStateEnum.disableCull,s}resize(){this.framebuffer&&(this.framebuffer.destroy(),this.framebuffer=null),this._texturePrimitive=null;}destroy(){this.isPlotter=void 0,this.plotterType=void 0,this._renderPrimitives=void 0;}}class Eu extends Nd{constructor(e){super(e),this.width=e.width?e.width:1024,this.height=e.height?e.height:1024,this.tileID=e.tileID,this.zoom=void 0,this.hasLine=!1,this.hasSprite=!1,this.dirty=!0,this.needRepaint=!1,this.hasHeatmap=!1,this.hasPattern=!1,this.heatmapPlotter=new Au({});}update(e,t,i){e.frameState.passType=this.passType,super.update(e,t,i);}render(t){const{painter:i,primitives:s,layers:r,projMatrix:n}=t;let{needReload:o}=t;const{context:a,frameState:l}=i;if(this.hasSprite?this.dirty=!0:this.zoom!==i.style.symbolMatrixHelper.zoom&&(this.zoom=i.style.symbolMatrixHelper.zoom,(this.hasLine||this.hasHeatmap||this.hasPattern)&&(this.dirty=!0)),!this.dirty&&!this.needRepaint&&!o)return;const h=i.frameState.framebuffer,_=i.frameState.passType;this.update(i,this.width,this.height),e.RenderState.applyRenderState(a,e.RenderState.fromCache({viewport:{x:0,y:0,width:this.width,height:this.height},cull:e.renderStateEnum.disableCull,depthTest:e.renderStateEnum.disableDepthTest,depthMask:e.renderStateEnum.disableDepthMask})),a.clear({color:new e.Color(0,0,0,0),depth:1,stencil:0}),this.hasLine=!1,this.hasHeatmap=!1;for(let t=0;t<s.length;t++){const h=s[t],_=h._geometry._vertexBuffer;if(!e.defined(_)||!e.defined(_.context)){o=!0;continue}const c=i.style._layers[r[t]];if(c.type===e.VectorLayerType.LINE||c.type===e.VectorLayerType.SPRITE){c.type===e.VectorLayerType.SPRITE?this.hasSprite=!0:this.hasLine=!0,h.material._uniforms.set("u_PixelsToTileUnits",(()=>{const t=Math.pow(2,this.tileID.canonical.z-this.zoom-(this.tileID.canonical.z-this.tileID.overscaledZ))*e.EXTENT/512;return new e.Matrix2([t,0,0,t])})),h.material._uniforms.set("u_Matrix",(()=>n)),h.material._uniforms.set("u_GlUnitsToPixels",(()=>new e.Vector2(this.width/2,-this.height/2)));const t=h.material.isBorder;t&&(h.update(i,l),h.render(i,c,l)),t&&(h.material.isBorder=!1),h.update(i,l),h.render(i,c,l),t&&(h.material.isBorder=!0);}else c.type===e.VectorLayerType.FILL?("function"==typeof h.material.hasPattern&&h.material.hasPattern()&&(this.hasPattern=!0),h.material._uniforms.set("u_Matrix",(()=>n)),h.update(i,l),h.render(i,c,l)):c.type===e.VectorLayerType.HEATMAP&&(this.hasHeatmap=!0,h.material._uniforms.set("u_extrude_scale",(()=>e.EXTENT/(512*Math.pow(2,this.zoom-this.tileID.overscaledZ)))),h.material._uniforms.set("u_Matrix",(()=>n)),this.heatmapPlotter._renderPrimitives.push(h),this.heatmapPlotter._texturePrimitive&&this.heatmapPlotter.framebuffer&&!c.colorRampChanged||(c.colorRampChanged&&this.heatmapPlotter.resize(),this.heatmapPlotter._createTexturePrimitive({layer:c,painter:i,type:"heatmapTexture"}),this.heatmapPlotter._texturePrimitive.material.defines={CANVAS_2D:!0},this.heatmapPlotter._createFramebuffer(this.width,this.height,a),c.colorRampChanged=!1),this.heatmapPlotter.render(i,c,l));}return i.frameState.passType=_,i.frameState.update({framebuffer:h}),i.frameState.bindFramebuffer(a),e.RenderState.applyRenderState(a,e.RenderState.fromCache({viewport:{x:0,y:0,width:i.mainPass.width,height:i.mainPass.height}})),this.dirty=!1,this.needRepaint=o,o}readPixel(t,i){return Fd(t,i,this.framebuffer,this.height,e.WebGLConstants.UNSIGNED_BYTE)}}class Mu{constructor(t){this.tileID=t.tileID,this.sourceCache=t.sourceCache,this.tileBoundingRegion=t.tileBoundingRegion,this.projMatrix=(new e.Matrix4).ortho({left:0,right:e.EXTENT,bottom:0,top:e.EXTENT,near:0,far:1}),this.state="initialized",this.texture=void 0,this.primitives=void 0,this.pass=void 0,this.renderlayers=void 0,this.attachedRasterTileIDSet=new Set;}unloadTile(){if(this.primitives){for(const e of this.primitives)e._geometry=void 0,e.destroy();this.primitives=void 0;}this.unbindTile(),this.texture&&(this.texture.destroy(),this.texture=void 0),this.pass&&(this.pass.destroy(!1),this.pass=void 0),this.renderlayers=void 0,this.state="unloaded";}unbindTile(){const e=this.sourceCache.map.style.rasterSourceCache;this.attachedRasterTileIDSet.forEach((t=>{const i=e._tiles[t];i?.proxyImage?.imagery?.texture&&i.proxyImage.imagery.texture===this.texture&&(i.proxyImage=void 0);})),this.attachedRasterTileIDSet.clear();}attachToMostIdealRasterTile(){if(!this.texture)return;const[,e]=this.sourceCache.sourceCaches.entries().next().value,t=this.sourceCache.map.style.rasterSourceCache,i=t.getTile(this.tileID);if(i)this.attachRasterTile(e._source,i),i.isAncestor&&i.tileID.children().forEach((i=>{const s=t.getTile(i);s&&this.attachRasterTile(e._source,s);}));else {const i=this.tileID.canonical.z,s=this.tileID.canonical.x,r=this.tileID.canonical.y;for(const n in t._tiles){const o=t._tiles[n],a=o.tileID;if(a.canonical.z>i){const t=a.scaledTo(i);t.canonical.x===s&&t.canonical.y===r&&this.attachRasterTile(e._source,o);}}}}attachRasterTile(e,t){t.proxyImage?.imagery?.texture!==this.texture&&(this.attachedRasterTileIDSet.add(t.tileID.key),t.addProxyTexture(e,this.texture,this.tileID));}loadTile(){let t=!1;if("loaded"!==this.state){const i=function(t){const{tileID:i,painter:s,sourceCaches:r,tileBoundingRegion:n,layerOrder:o}=t,a=[],l=[],h=s.style,_=s.context,c=h._layers;let d=!1;for(const t of o){const o=c[t],u=r.get(o.source);o.hasTransition()&&(d=!0);const m=u.getTile(i);if(!m)continue;if("loaded"!==m.state){d=!0;continue}const p=m.getBucket(o);if(e.defined(p))if(p.uploadPending()&&p.upload(_),o.type===e.VectorLayerType.FILL){const i=p.programConfigurations.get(o.id),r=p.matrix,h=Wh({bucket:p,tileBoundingRegion:n,isRegularVector:!0}),_=h[0]._vertexBuffer;if(!e.defined(_)||!e.defined(_.context)){d=!0;continue}const c=Zh({layer:o,painter:s,tile:m,programConfiguration:i,isRegularVector:!0});c[0].defines={CANVAS_2D:!0},c[0].renderState.blending=e.renderStateEnum.enableBlending;const u=new e.Primitive({modelMatrix:r,geometry:h[0],material:c[0]});if(a.push(u),l.push(t),c[0].hasPattern()&&o.outlineFromFillColor)continue;if(h[1]&&o.paint?.get("fill-antialias")){c[1].defines={CANVAS_2D:!0},c[1].renderState.blending=e.renderStateEnum.enableBlending;const i=new e.Primitive({modelMatrix:r,geometry:h[1],material:c[1]});a.push(i),l.push(t);}}else if(o.type===e.VectorLayerType.LINE||o.type===e.VectorLayerType.SPRITE){const i=h.getSource(o.source),r=p.programConfigurations.get(o.id),_=p.matrix,c=Yh({layer:o,painter:s,tile:m,bucket:p,programConfiguration:r,isRegularVector:!0,sourceMaxZoom:i.maxzoom,animationsInfo:i.animationsInfo});c.defines={CANVAS_2D:!0},c.renderState.blending=e.renderStateEnum.enableBlending;const u=jh({bucket:p,tileBoundingRegion:n,isRegularVector:!0}),f=u._vertexBuffer;if(!e.defined(f)||!e.defined(f.context)){d=!0;continue}const g=new e.Primitive({modelMatrix:_,geometry:u,material:c});a.push(g),l.push(t);}else if(o.type===e.VectorLayerType.HEATMAP){const i=s_({layer:o,painter:s,tile:m,bucket:p,tileBoundingRegion:n}),r=i._material;if(!i._geometry._vertexBuffer.context){d=!0;continue}r.defines={CANVAS_2D:!0},r.renderState.blending=e.renderStateEnum.enableBlending,a.push(i),l.push(t);}}return {primitives:a,renderLayerOrder:l,needReload:d}}({tileID:this.tileID,painter:this.sourceCache.map.painter,sourceCaches:this.sourceCache.sourceCaches,tileBoundingRegion:this.tileBoundingRegion,layerOrder:this.sourceCache.order});this.primitives=i.primitives,this.renderlayers=i.renderLayerOrder,t=i.needReload;}this.primitives&&this.primitives.length>0&&(this.pass||(this.pass=new Eu({passType:e.RenderPassConsts.PROXY_PASS,tileID:this.tileID})),t=this.pass.render({painter:this.sourceCache.map.painter,primitives:this.primitives,layers:this.renderlayers,projMatrix:this.projMatrix,needReload:t}),this.texture=this.pass.framebuffer.getColorTexture(0),this.texture.sampler={minificationFilter:e.WebGLConstants.LINEAR,magnificationFilter:e.WebGLConstants.LINEAR,wrapS:e.WebGLConstants.CLAMP_TO_EDGE,wrapT:e.WebGLConstants.CLAMP_TO_EDGE},this.attachToMostIdealRasterTile()),this.state="loaded",t&&(this.state="loading");}}class Pu extends e.Evented{constructor(e,t,i){super(),this.id=e,this.map=t.map,this.dispatcher=i,this._tiles={},this._cache=new l_(100,this._unloadTile.bind(this)),this.sourceCaches=new Map,this.order=[],this._enabled=!1;}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(this._enabled=e);}update(){if(!this.enabled)return;const[,t]=this.sourceCaches.entries().next().value;if(!t)return;const i=t._tiles,s=e.keysDifference(this._tiles,i);for(let e=0;e<s.length;e++)this._removeTile(s[e]);for(const e in i){const i=t.getTileByID(e),s=t.quadtree.getBoundingRegionById(e);this._loadTile(i.tileID,s);}}_removeTile(e){const t=this._tiles[e];t&&(delete this._tiles[e],this._unbindTile(t),this._cache.add(t.tileID,t));}_loadTile(e,t){let i=this._tiles[e.key];if(i)i.loadTile();else {if(i=this._cache.getAndRemove(e),Boolean(i))return this._tiles[e.key]=i,void i.loadTile();i=new Mu({tileID:e,sourceCache:this,rasterSourceCache:this.map.style.rasterSourceCache,tileBoundingRegion:t}),i.loadTile(),this._tiles[e.key]=i;}}_unloadTile(e){e.unloadTile();}_unbindTile(e){e.unbindTile();}updateLayer(){this.getLayerOrder(),this.clearTiles();}getLayerOrder(){const e=this.map.style;if(!e.hasTerrainData)return void(this.enabled=!1);const t=e._layers,i=e._order,s=e.sourceCaches;this.order=[],this.sourceCaches=new Map,this.beforeRaster=null;let r=!1;for(let e=0;e<i.length;e++){const n=t[i[e]];if("visible"===n.visibility){if("line"===n.type||"sprite"===n.type||"fill"===n.type||"heatmap"===n.type){r=!0,this.beforeRaster=null;const t=s[n.source];t.adaptTerrain&&(this.sourceCaches.set(n.source,t),this.order.push(i[e]));}"raster"===n.type&&r&&(this.beforeRaster=n.id,r=!1);}}this.enabled=0!==this.order.length;}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}clearTiles(){for(const e in this._tiles)this._removeTile(e);this._cache.reset();}}const Ru=function(e,t,i){return "3d-tiles"===t.type?new ud(e,t,i):"3d-model"===t.type?new fd(e,t,i):"raster"===t.type?new Md(e,t,i):"proxy"===t.type?new Pu(e,t,i):new T_(e,t,i)};class Bu{constructor(t){this.options=t||{},this.requestPerformanceManager=new e.RequestPerformanceManger({}),this.updateSourceCaches=[];}prepare(){const e=this.options.style;this.updateSourceCaches=[];const t=[];for(const i in e.sourceCaches)t.push(e.sourceCaches[i]);this.updateSourceCaches=t;}run(){this._updateLoop();}beforeStop(){const e=this.options.style;this.updateSourceCaches=[],this.updateSourceCaches.push(e.rasterSourceCache);for(const t in e.sourceCaches)this.updateSourceCaches.push(e.sourceCaches[t]);this.updateSourceCaches.push(e.proxySourceCache);}_updateLoop(){for(const e of this.updateSourceCaches)e.update();}stop(){this._updateLoop();}clearUpdateSourceCaches(){this.updateSourceCaches=[];}}class Iu{constructor(t){this._style=t,this.status=3,this.resourcePerformaceManager=new Bu({style:this._style,mode:e.CONSTS.PERFORMANCE.MODE.MANUAL}),this.previousTime=Date.now();}startAction(){0!==Object.keys(this._style.sourceCaches).length&&(2!==this.status?(this.status=1,this.resourcePerformaceManager.prepare(),this.previousTime=Date.now(),this.animateAction()):(this.previousTime=Date.now(),this.animateAction()));}animateAction(){this.status=2,this.resourcePerformaceManager.run();}isStopped(){return 3===this.status}stopAction(){this.status=3,this.resourcePerformaceManager.beforeStop(),this.resourcePerformaceManager.stop();}}class Du{constructor(){this._data=new Map,this._orders=[];}add(e){}get(e){return this._data.get(e)}getAll(){const e=[];for(let t=0;t<this._orders.length;t++){const i=this.get(this._orders[t]);e.push(i);}return e}has(e){return this._data.has(e)}sort(e){this._orders.sort(e);}remove(e,t){if(this.has(e)){if(t){const t=this.get(e);t.destroy&&t.destroy();}this._data.delete(e);const i=this._orders.indexOf(e);this._orders.splice(i,1);}}removeAll(e){for(;this._orders.length>0;)this.remove(this._orders[0],e);}getIgnoreClassificationPrimitiveObject(t){return {opaque:this.getOpaquePrimitives(t,e.checkIsIgnoreClassificationDataType),translucent:this.getTranslucentPrimitives(t,e.checkIsIgnoreClassificationDataType)}}getTranslucentPrimitives(){}getOpaquePrimitives(){}getIndependentPrimitiveObject(t){return {opaque:this.getOpaquePrimitives(t,e.checkIsDepthSupportDataType),translucent:this.getTranslucentPrimitives(t,e.checkIsDepthSupportDataType)}}getClassificationPrimitiveObject(t){return {opaque:this.getOpaquePrimitives(t,e.checkIsVectorShadowVolumeDataType),translucent:this.getTranslucentPrimitives(t,e.checkIsVectorShadowVolumeDataType)}}get keys(){return this._orders}get size(){return this._data.size}loaded(){return !0}}Du.RENDER_TYPE={OPAQUE_TYPE:"OPAQUE_TYPE",TRANSLUCENT_TYPE:"TRANSLUCENT_TYPE"};class Ou extends Du{constructor(e){super(),this.type=e.type;}add(e){if(this.has(e.id))throw new Error(`There is already a sceneComponent with this ID: ${e.id}`);return this._orders.push(e.id),this._data.set(e.id,e),e}getTranslucentPrimitives(t,i){i=i||e.checkIsDepthSupportDataType;let s=[];for(let r=0;r<this._orders.length;r++){const n=this.get(this._orders[r]);if(i(n.classificationType))if(n instanceof _d)s=s.concat(n._translucentList);else if(t)if(e.defined(n.modelInstanceCollection))t.computeVisibility(n.modelInstanceCollection.boundingVolume)!==e.INTERSECTION.OUTSIDE&&(s=s.concat(n.translucentList));else for(let i=0;i<n.translucentList.length;i++){const r=n.translucentList[i];t.computeVisibility(r.boundingVolume)!==e.INTERSECTION.OUTSIDE&&s.push(r);}else s=s.concat(n.translucentList);}return s}getOpaquePrimitives(t,i){i=i||e.checkIsDepthSupportDataType;let s=[];for(let r=0;r<this._orders.length;r++){const n=this.get(this._orders[r]);if(i(n.classificationType))if(n instanceof _d)s=s.concat(n._opaqueList);else if(t)if(e.defined(n.modelInstanceCollection))t.computeVisibility(n.modelInstanceCollection.boundingVolume)!==e.INTERSECTION.OUTSIDE&&(s=s.concat(n.opaqueList));else for(let i=0;i<n.opaqueList.length;i++){const r=n.opaqueList[i];t.computeVisibility(r.boundingVolume)!==e.INTERSECTION.OUTSIDE&&s.push(r);}else s=s.concat(n.opaqueList);}return s}update(e){for(let t=0;t<this._orders.length;t++)this.get(this._orders[t]).update(e);}serialize(){if("3d-model"===this.type||"3d-model-instance"===this.type){const t=[];return this._data.forEach((i=>{const s={id:i.id,data:i._data,modelFolder:i.modelFolder,backCulling:i.backCulling,lightingModel:i.lightingModel,activeAnimation:i.activeAnimation,classificationType:i.classificationType};if(e.defined(i.modelInstanceCollection)){s.type="3d-model-instance";const t=[],r=[],n=[],o=[],a=[],l=[];i.modelInstanceCollection._instances.forEach((i=>{const s=e.Cartographic.fromVector3(i.position);s.x*=e.CONSTS.CesiumMath.DEGREES_PER_RADIAN,s.y*=e.CONSTS.CesiumMath.DEGREES_PER_RADIAN,t.push([s.x,s.y,s.z]),r.push({heading:i.rotation.heading,pitch:i.rotation.pitch,roll:i.rotation.roll}),n.push(e.Vector3.pack(i.scale,new Array(3))),o.push(i.instanceName),a.push(e.Color.pack(i.color,new Array(4))),l.push(i.show);})),s.positions=t,s.rotations=r,s.scales=n,s.instanceNames=o,s.colors=a,s.shows=l;}else s.type="3d-model",e.defined(i._options.scale)&&(s.scale=i._options.scale),e.defined(i._options.position)&&(s.position=i._options.position),s.rotation=i._rotation;e.defined(i.clippingPlanes)&&(s.clippingPlanes=i.clippingPlanes.serialize()),t.push(s);})),t.length>0?t:void 0}if("3d-tiles"===this.type){const t=[];return this._data.forEach((i=>{const s={id:i.id,type:"3d-tiles",show:i.show,translation:e.defined(i.translation)?e.Vector3.pack(i.translation,new Array(3)):void 0,skipLevelOfDetail:i.skipLevelOfDetail,maximumScreenSpaceError:i._maximumScreenSpaceError,useMipmap:i.useMipmap,allowPick:i.allowPick,lightingModel:i.lightingModel,geoBoundsOptions:i._geoBoundsOptions,clippingPlanes:e.defined(i.clippingPlanes)?i.clippingPlanes.serialize():void 0,backCulling:i.backCulling,classificationType:i.classificationType};e.defined(i._url)&&(s.url=i._url),i._urls.length>0&&(s.urls=i._urls),e.defined(i.clippingPlanes)&&(s.clippingPlanes=i.clippingPlanes.serialize()),t.push(s);})),t.length>0?t:void 0}}loaded(){for(let e=0;e<this._orders.length;e++)if(!this._data.get(this._orders[e]).loaded())return !1;return !0}destroy(){return this.removeAll(!0),e.destroyObject(this)}}class Lu extends Du{constructor(){super();}add(e){if(this.has(e.id))throw new Error(`There is already a sceneComponent with this ID: ${e.id}`);this._data.set(e.id,e),this._orders.push(e.id);}getTranslucentPrimitives(t,i){let s=[];i=i||e.checkIsDepthSupportDataType;for(let e=0;e<this._orders.length;e++){const t=this.get(this._orders[e]);i(t.classificationType)&&(s=s.concat(t.getTranslucentPrimitives()));}return s}getOpaquePrimitives(t,i){let s=[];i=i||e.checkIsDepthSupportDataType;for(let e=0;e<this._orders.length;e++){const t=this.get(this._orders[e]);i(t.classificationType)&&(s=s.concat(t.getOpaquePrimitives()));}return s}update(e){this._data.forEach((t=>{t.update(e);}));}destroy(){return this.removeAll(!0),e.destroyObject(this)}}class Vu extends Du{constructor(){super(),this._data=new Map;}add(e){if(this.has(e.id))throw new Error(`There is already a sceneComponent with this ID: ${e.id}`);this._data.set(e.id,e),this._orders.push(e.id);}getTranslucentPrimitives(t,i){i=i||e.checkIsDepthSupportDataType;const s=[];for(let r=0;r<this._orders.length;r++){const n=this.get(this._orders[r]);this.computePrimitiveBounding(n),i(n.classificationType)&&n._material.isTranslucent&&(!t||!n.boundingVolume||t&&t.computeVisibility(n.boundingVolume)!==e.INTERSECTION.OUTSIDE)&&s.push(n);}return s}getOpaquePrimitives(t,i){const s=[];i=i||e.checkIsDepthSupportDataType;for(let r=0;r<this._orders.length;r++){const n=this.get(this._orders[r]);this.computePrimitiveBounding(n),i(n.classificationType)&&(n._material.isTranslucent||(!t||!n.boundingVolume||t&&t.computeVisibility(n.boundingVolume)!==e.INTERSECTION.OUTSIDE)&&s.push(n));}return s}update(){}computePrimitiveBounding(t){e.defined(t._geometry)&&t._geometry._needUpdate&&t.computeBounding();}serialize(){const t=[];return this._data.forEach((i=>{const s=i.serialize();e.defined(s)&&t.push(s);})),t.length>0?t:void 0}destroy(){return this.removeAll(!0),e.destroyObject(this)}}class Nu extends e.Geometry{constructor(e){super(e),this.type="SkyBoxGeometry",this.parse(e);}parse({context:t}){this._vertexArray=new e.StructArrayLayout3f12,this._indexArray=new e.StructArrayLayout3ui6;const i=[-1,-1,1,1,-1,1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1];for(let e=0;e<i.length;e+=3)this._vertexArray.emplaceBack(i[e],i[e+1],i[e+2]);const s=[5,1,3,3,7,5,6,2,0,0,4,6,2,6,7,7,3,2,5,4,0,0,1,5,0,2,3,3,1,0,7,6,4,4,5,7];for(let e=0;e<s.length;e+=3)this._indexArray.emplaceBack(s[e],s[e+1],s[e+2]);this._vertexBuffer=t.createVertexBuffer(this._vertexArray,dl.members,!1),this._indexBuffer=t.createIndexBuffer(this._indexArray,!1),this._segmentVector=e.SegmentVector.simpleSegment(0,0,36,12),this.primitiveType=e.WebGLConstants.TRIANGLES;}destroy(){super.destroy(),this.type=void 0;}}class Fu{constructor(t){this.context=t.context,this.pixelFormat=t.pixelFormat,this.texture=this.context.gl.createTexture(),this._powerOfTwoCalculated=!1,this.powerOfTwoNoneSquareFlag=!1,this.flipY=!(!t||!t.flipY),this._target=t.target||e.WebGLConstants.TEXTURE_CUBE_MAP,this._fboTextureParameter=t.fboTextureParameter,t.texture?this.texture=t.texture:this.update(t);}update(t){const{images:i}=t,{context:s}=this,{gl:r}=s;s.pixelStoreUnpackFlipY.set(this.flipY),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(!(!t||!t.premultiply)),r.bindTexture(this._target,this.texture);const n=e.CONSTS.SOURCE.TEXTURE_CUBE_KEYS;for(let t=0;t<6;t++)void 0===i&&this._fboTextureParameter?r.texImage2D(e.WebGLConstants.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,e.WebGLConstants.RGBA,this._fboTextureParameter.width,this._fboTextureParameter.height,0,e.WebGLConstants.RGBA,e.WebGLConstants.UNSIGNED_BYTE,null):r.texImage2D(e.WebGLConstants.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,e.WebGLConstants.RGBA,e.WebGLConstants.RGBA,e.WebGLConstants.UNSIGNED_BYTE,i[n[t]]);r.texParameteri(this._target,e.WebGLConstants.TEXTURE_MAG_FILTER,e.WebGLConstants.LINEAR),r.texParameteri(this._target,e.WebGLConstants.TEXTURE_MIN_FILTER,e.WebGLConstants.LINEAR),r.texParameteri(this._target,e.WebGLConstants.TEXTURE_WRAP_S,e.WebGLConstants.CLAMP_TO_EDGE),r.texParameteri(this._target,e.WebGLConstants.TEXTURE_WRAP_T,e.WebGLConstants.CLAMP_TO_EDGE),r.bindTexture(this._target,null);}bind(t){const{context:i}=this,{gl:s}=i;s.bindTexture(this._target,this.texture),s.texParameteri(this._target,e.WebGLConstants.TEXTURE_MAG_FILTER,e.WebGLConstants.LINEAR),s.texParameteri(this._target,e.WebGLConstants.TEXTURE_MIN_FILTER,e.WebGLConstants.LINEAR),s.texParameteri(this._target,e.WebGLConstants.TEXTURE_WRAP_S,e.WebGLConstants.CLAMP_TO_EDGE),s.texParameteri(this._target,e.WebGLConstants.TEXTURE_WRAP_T,e.WebGLConstants.CLAMP_TO_EDGE),t||s.bindTexture(this._target,null);}destroy(){if(!this.context)return;const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null,this.context=null;}}class Gu extends e.Material{constructor(e){super(e),this._opacity=1,this._onGround=!1,this._fboTextureCube=void 0,this._renderState=this.createRenderState(),this.createUniforms(),this._transformValues={};}createRenderState(){const t={};return t.depthTest=e.renderStateEnum.disableDepthTest,t.depthMask=e.renderStateEnum.disableDepthMask,t.stencilTest=e.renderStateEnum.disableStencilTest,t}buildDefines(){const t={HAS_STARRY_SKY_MAP:e.defined(this.starrySkyTexture),HAS_DAY_MAP:e.defined(this.dayTexture)};this.defines=t;}update(t,i,s={}){let r;super.update(t,i,s),this._transformValues={_fov:t.style.symbolMatrixHelper.fov,aspect:t.width/t.height,width:t.width,height:t.height,pitch:t.style.symbolMatrixHelper.getMapViewParams().pitch*e.CONSTS.TRANSFORM.DEG_TO_RAD,heading:-t.transform.hpr.heading,lng:t.style.symbolMatrixHelper.getMapViewParams().lng},r=null==t.frameState.sunLight?12:new Date(t.frameState.sunLight.timestamp).getHours(),this.updateOpacity(t.style.getNearestTileZoom(),r),this._uniforms.set("u_matrixSkyBox",(()=>{const i=new e.Matrix4([0]).perspective({fov:this._transformValues._fov,aspect:this._transformValues.aspect,near:1,far:100});let s=new e.Matrix4;if(null!=t.frameState.sunLight&&(s=e.Transforms.computeTemeToPseudoFixedMatrix(new Date(t.frameState.sunLight.timestamp))),this._onGround){const t=.1,r=new e.Vector3,n=(new e.Matrix4).scale([1,-1,1]),o=this._transformValues.pitch,a=this._transformValues.heading;n.rotateX(o).rotateZ(a-this._transformValues.lng*(Math.PI/180));const l=(Math.PI/2-o)*(this._transformValues.height/this._transformValues._fov)*t;return i[8]=2*-r.x/this._transformValues.width,i[9]=2*(r.y+l)/this._transformValues.height,e.Matrix4.multiply(new e.Matrix4,n.multiplyLeft(i),s)}{const r=t.frameState.camera.matrixWorldInverse.getRotation();return e.Matrix4.multiply(new e.Matrix4,r.multiplyLeft(i),s)}}));}upload(){this._program&&this._program._setUniforms(this._uniforms);}updateOpacity(t,i){const s=[0,.3,1],r=[0,5,15],n=e.smoothstep(7,8,t);this._opacity=function(){const i=r.length;if(t<=r[0])return s[0];if(t>=r[i-1])return s[i-1];const n=e.findStopLessThanOrEqualTo(r,t),o=e.Interpolate.interpolationFactor({name:"linear"},t,r[n],r[n+1]);return e.number(s[n],s[n+1],o)}()*n*function(e){return e>6&&e<18?1:.02}(i),this._onGround=t>7;}createUniforms(){this._uniforms.set("u_cubemap",(()=>this._fboTextureCube)),this._uniforms.set("u_dayTextureMap",(()=>this.dayTexture)),this._uniforms.set("u_starrySkyTextureMap",(()=>this.starrySkyTexture)),this._uniforms.set("u_Opacity",(()=>this._opacity));}destroy(){}}class ku extends e.Material{constructor(e){super(e),this._renderState=this.createRenderState(),this.createUniforms();}createRenderState(){const t={};return t.depthTest=e.renderStateEnum.disableDepthTest,t.stencilTest=e.renderStateEnum.disableStencilTest,t.blending=e.renderStateEnum.disableBlending,t}setMatrixByFaces(t){switch(this._faceRotate=new e.Matrix4,t){case e.CONSTS.SOURCE.TEXTURE_CUBE_KEYS[0]:this._faceRotate.identity(),this._faceRotate.rotateY(.5*-Math.PI);break;case e.CONSTS.SOURCE.TEXTURE_CUBE_KEYS[1]:this._faceRotate.identity(),this._faceRotate.rotateY(.5*Math.PI);break;case e.CONSTS.SOURCE.TEXTURE_CUBE_KEYS[2]:this._faceRotate.identity(),this._faceRotate.rotateX(.5*-Math.PI);break;case e.CONSTS.SOURCE.TEXTURE_CUBE_KEYS[3]:this._faceRotate.identity(),this._faceRotate.rotateX(.5*Math.PI);break;case e.CONSTS.SOURCE.TEXTURE_CUBE_KEYS[4]:this._faceRotate.identity();break;case e.CONSTS.SOURCE.TEXTURE_CUBE_KEYS[5]:this._faceRotate.identity(),this._faceRotate.rotateY(Math.PI);}}update(e,t,i={}){super.update(e,t,i);}createUniforms(){this._uniforms.set("u_matrix_3f",(()=>{const t=new e.Matrix3;return t.set(this._faceRotate[0],this._faceRotate[1],this._faceRotate[2],this._faceRotate[4],this._faceRotate[5],this._faceRotate[6],this._faceRotate[8],this._faceRotate[9],this._faceRotate[10]),t})),this._uniforms.set("u_color_tint_r",(()=>new e.Vector4(1,1,1,1))),this._uniforms.set("u_color_tint_m",(()=>new e.Vector4(1,1,1,1))),this._uniforms.set("u_luminance",(()=>5e-5));}}class Uu{constructor(t){t=t||{},this.type="scene-object",this.starrySkyTextureUrls=t.starrySkyTextureUrls,this.dayTextureUrls=t.dayTextureUrls,this.id=`skybox-${e.uniqueId()}`,this.checkInputTextureExists(t)&&(this._ready=!0),this.isSceneObject=!0,this.initialized=!1;}checkInputTextureExists(e){return !(!e.starrySkyTextureUrls||6!==Object.keys(e.starrySkyTextureUrls).length)}init(t){const{painter:i}=t,{context:s}=i;this.geometry=new Nu({context:s}),this._skyMaterial=new Gu({type:"skybox"}),this._cubeMapRenderingMaterial=new ku({type:"skyboxCapture"}),this.primitive=new e.Primitive({material:this._skyMaterial,geometry:this.geometry,allowPick:!1}),this.primitiveToGenerateTexture=new e.Primitive({material:this._cubeMapRenderingMaterial,geometry:this.geometry,allowPick:!1}),this._prepareTextures(i).then((()=>{this._skyMaterial.buildDefines(),this.initialized=!0;}));}getPrimitiveForPass(){return this.primitiveToGenerateTexture}updateSkyCubeTexture(e){this._skyMaterial._fboTextureCube=e,this.ready=!0;}async _requestBoxImages(t,i){const s=e.CONSTS.SOURCE.TEXTURE_CUBE_KEYS,r=[];for(let n=0;n<6;n++){const o=new Promise(((r,o)=>{e.getImage(t._map._transformRequest(i[s[n]],e.ResourceType.Image),((e,t)=>{e&&o(e),r(t);}));}));r.push(o);}const n=await Promise.all(r),o={};for(let e=0;e<s.length;e++)o[s[e]]=n[e];return this._createTexture(t,o)}async _requestSingleImage(t,i){const s=new Promise(((s,r)=>{e.getImage(t._map._transformRequest(i,e.ResourceType.Image),((e,t)=>{e&&r(e),s(t);}));})),r=await s;return this._createTexture(t,r)}async _createTexture(t,i){const s=new Fu({context:t.context,images:i,pixelFormat:e.WebGLConstants.RGBA,flipY:!0});return s.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),s}async _prepareTextures(e){this.starrySkyTextureUrls&&(this._skyMaterial.starrySkyTexture=await this._requestBoxImages(e,this.starrySkyTextureUrls)),this.dayTextureUrls&&(this._skyMaterial.dayTexture=await this._requestBoxImages(e,this.dayTextureUrls));}prepare(e){e.shaderProgramManager.setGlobalMacroDefinition({SKYBOX_CUBE_MAP_G:this.isCubeMap}),this._ready=!0;}get ready(){return this._ready}set ready(e){this._ready=e;}onAdd(e){this.init({painter:e.painter});}serialize(){const t={};return e.defined(this.starrySkyTextureUrls)&&(t.starrySkyTextureUrls=this.starrySkyTextureUrls),e.defined(this.dayTextureUrls)&&(t.dayTextureUrls=this.dayTextureUrls),t}destroy(){this.primitive.destroy(),this.primitiveToGenerateTexture.destroy();}loaded(){return this._ready}collect(){return this._ready?[this.primitive]:[]}}class Hu extends e.Material{constructor(e){super(e),this._renderState=this.createRenderState(e.depth),this.createUniforms(e.painter),this.cloudTime=0;}createRenderState(t){const i={};return i.depthTest=t?e.renderStateEnum.enableDepthTest:e.renderStateEnum.disableDepthTest,i.depthMask=t?e.renderStateEnum.enableDepthMask:e.renderStateEnum.disableDepthMask,i.stencilTest=e.renderStateEnum.disableStencilTest,i}update(e,t,i={}){super.update(e,t,i),this.cloudTime++;}createUniforms(t){this._uniforms.set("u_earthMap",(()=>(this.earthTexture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.REPEAT),this.earthTexture))),this._uniforms.set("u_earthCloudMap",(()=>(this.earthCloudTexture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.REPEAT),this.earthCloudTexture))),this._uniforms.set("u_earthNightMap",(()=>(this.nightTexture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.REPEAT),this.nightTexture))),this._uniforms.set("u_earthTime",(()=>this.cloudTime/1e3)),this._uniforms.set("u_DayTexPercent",(()=>e.clamp(.25*(t.style.getNearestTileZoom()-1),0,1))),this._uniforms.set("u_GlobalInnerColor",(()=>t._map.directionLightParameter.globalInnerColor)),this._uniforms.set("u_LightPer",(()=>t._map.directionLightParameter.globalLightPercent)),this._uniforms.set("u_NightGlobalPer",(()=>t._map.directionLightParameter.nightGlobalPer)),this._uniforms.set("u_NightVisible",(()=>t._map.directionLightParameter.nightVisible));}destroy(){}}class zu extends e.Material{constructor(t){super(t);const i=t.painter;this._renderState={depthTest:{enabled:!1,func:e.WebGLConstants.LESS},cull:{enabled:!1},blending:{enabled:!0,color:{red:0,green:0,blue:0,alpha:0},equationRgb:e.WebGLConstants.FUNC_ADD,equationAlpha:e.WebGLConstants.FUNC_ADD,functionSourceRgb:e.WebGLConstants.SRC_ALPHA,functionSourceAlpha:e.WebGLConstants.ONE,functionDestinationRgb:e.WebGLConstants.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:e.WebGLConstants.ONE_MINUS_SRC_ALPHA}},this.createUniforms(i);}update(e,t,i={}){super.update(e,t,i);}createUniforms(t){this._uniforms.set("u_GlobalOuterColor",(()=>t._map.directionLightParameter.globalOuterColor)),this._uniforms.set("u_GlobalOuterPara",(()=>t._map.directionLightParameter.globalOuterPara)),this._uniforms.set("u_DayTexPercent",(()=>e.clamp(.25*(t.style.getNearestTileZoom()-1),0,1)));}destroy(){}}class Wu{constructor(t){this.type="scene-object",this.id="earthCrate-MinemapInternal",this.isSceneObject=!0,this.visible=!0,this.minzoom=t.minzoom?t.minzoom:0,this.maxzoom=t.maxzoom?t.maxzoom:3,t.radius=t.radius||e.CONSTS.TRANSFORM.R,t.widthSegments=t.widthSegments||128,t.heightSegments=t.heightSegments||64,this.url=t.url,this.cloudImageUrl=t.cloudImageUrl,this.nightImageUrl=t.nightImageUrl,this.cloudSpeed=t.cloudSpeed,this.depth=e.defaultValue(t.depth,!1),this.geometry=new zh(t);}_requestSource(t){if(this.url){const i=new Promise(((i,s)=>{this.url?e.getImage(t._transformRequest(this.url,e.ResourceType.Image),((r,n)=>{r&&s(r);const o=new e.Texture({context:t.painter.context,image:n,pixelFormat:e.WebGLConstants.RGB,useMipmap:!1});o.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.REPEAT),this.material.earthTexture=o,i(!0);})):i(!0);})),s=new Promise(((i,s)=>{this.cloudImageUrl?e.getImage(t._transformRequest(this.cloudImageUrl,e.ResourceType.Image),((r,n)=>{r&&s(r);const o=new e.Texture({context:t.painter.context,image:n,pixelFormat:e.WebGLConstants.RGBA,useMipmap:!1});o.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.REPEAT),this.material.earthCloudTexture=o,i(!0);})):i(!0);})),r=new Promise(((i,s)=>{this.nightImageUrl?e.getImage(t._transformRequest(this.nightImageUrl,e.ResourceType.Image),((r,n)=>{r&&s(r);const o=new e.Texture({context:t.painter.context,image:n,pixelFormat:e.WebGLConstants.RGBA,useMipmap:!1});o.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.REPEAT),this.material.nightTexture=o,i(!0);})):i(!0);}));Promise.all([i,s,r]).then((()=>{this.material.defines=pu.getEarthMaterialDefinition(this.material),this._ready=!0,t.needRepaint=!0;}));}else this._ready=!0;}onAdd(t){this.painter=t.painter;const i=this.painter._map.directionLightParameter;e.defined(this.cloudSpeed)&&(i.globalLightPercent.y=this.cloudSpeed),this.material=new Hu({type:"sphere",painter:this.painter,depth:this.depth}),this.primitive=new e.Primitive({material:this.material,geometry:this.geometry,modelMatrix:new e.Matrix4}),this.primitive._afterRenderFunction=()=>{this.painter.context.clear(this.depth?{stencil:0}:{depth:1,stencil:0});},this.sphereAtmosphereMaterial=new zu({type:"sphereAtmosphere",painter:this.painter}),this.sphereAtmospherePrimitive=new e.Primitive({material:this.sphereAtmosphereMaterial,geometry:this.geometry,modelMatrix:new e.Matrix4}),this.sphereAtmospherePrimitive._afterRenderFunction=()=>{this.painter.context.clear({depth:1,stencil:0});},this.primitive._geometry.update({painter:this.painter}),this._requestSource(t);}destroy(){this.primitive.destroy();}setNightVisible(e){this.painter._map.directionLightParameter.nightVisible=e;}loaded(){return this._ready}collect(){if(this._ready){let e=!0;const t=this.painter.style.getNearestTileZoom();return t<this.minzoom&&(e=!1),t>this.maxzoom&&(e=!1),this.visible&&e?[this.sphereAtmospherePrimitive,this.primitive]:[]}return []}}const ju=e.createLayout([{name:"a_PositionHigh",type:"Float32",components:3},{name:"a_PositionLow",type:"Float32",components:3}],4),Xu=e.createLayout([{name:"a_POSITION",type:"Float32",components:3}],4);class qu extends e.Geometry{constructor(e){super(e),this.setData(e);}setData(t){super.setData(),this.positions=t.positions,this.colors=t.colors,this.arcType=e.defaultValue(t.arcType,e.ARCTYPE.NONE),this.colorsPerVertex=t.colorsPerVertex,this.type="SimplePolylineGeometry",this._usedDoublePrecision=!e.defined(t.referenceCenter),this._vertexArray?this._vertexArray.clear():this._vertexArray=this._usedDoublePrecision?new e.StructArrayLayout3f3f24:new e.StructArrayLayout3f12,this.primitiveType=e.WebGLConstants.LINE_STRIP,this.perSegmentColors=e.defined(t.colors)&&!this.colorsPerVertex,this.granularity=e.CONSTS.CesiumMath.RADIANS_PER_DEGREE,this.ellipsoid=e.Ellipsoid.WGS84,this.minDistance=2*this.ellipsoid.maximumRadius*Math.sin(.5*this.granularity),this._referenceCenter=e.defaultValue(t.referenceCenter,new e.Vector3),this.parse();}updateProperty(e){this.setData(e);}parse(){let t;const i=this.positions.length;let s,r,n,o,a,l;this.needUpdate=!0;let h=0;const _=e.CONSTS.CesiumMath.chordLength(this.granularity,this.ellipsoid.maximumRadius);if(this.arcType===e.ARCTYPE.GEODESIC||this.arcType===e.ARCTYPE.RHUMB){let o;this.arcType===e.ARCTYPE.GEODESIC?(o=_,s=e.PolylinePipeline.numberOfPoints,r=e.PolylinePipeline.generateArc):(o=this.granularity,s=e.PolylinePipeline.numberOfPointsRhumbLine,r=e.PolylinePipeline.generateRhumbArc);const c=e.PolylinePipeline.extractHeights(this.positions,this.ellipsoid),d=new Array(2),u=new Array(2),m={positions:d,height:u,ellipsoid:void 0,minDistance:void 0,granularity:void 0};if(this.arcType===e.ARCTYPE.GEODESIC?m.minDistance=_:m.granularity=this.granularity,m.ellipsoid=this.ellipsoid,this.perSegmentColors){let r=0;for(t=0;t<i-1;t++)r+=s(this.positions[t],this.positions[t+1],o)+1;n=new Float64Array(3*r),a=new Uint8Array(4*r),m.positions=d,m.height=u;let _=0;for(t=0;t<i-1;++t){d[0]=this.positions[t],d[1]=this.positions[t+1],u[0]=c[t],u[1]=c[t+1];const i=e.PolylinePipeline.generateArc(m);if(e.defined(this.colors)){const s=i.length/3;l=this.colors[t];for(let t=0;t<s;++t)a[_++]=e.Color.floatToByte(l.red),a[_++]=e.Color.floatToByte(l.green),a[_++]=e.Color.floatToByte(l.blue),a[_++]=e.Color.floatToByte(l.alpha);}n.set(i,h),h+=i.length;}}else if(m.positions=this.positions,m.height=c,n=new Float64Array(r(m)),e.defined(this.colors)){for(a=new Uint8Array(n.length/3*4),t=0;t<i-1;++t)h=this.interpolateColors(this.positions[t],this.positions[t+1],this.colors[t],this.colors[t+1],this.minDistance,a,h);const s=this.colors[i-1];a[h++]=e.Color.floatToByte(s.red),a[h++]=e.Color.floatToByte(s.green),a[h++]=e.Color.floatToByte(s.blue),a[h++]=e.Color.floatToByte(s.alpha);}this.vertices=n;}else {o=this.perSegmentColors?2*i-2:i,n=new Float64Array(3*o),a=e.defined(this.colors)?new Uint8Array(4*o):void 0;let s=0,r=0;for(t=0;t<i;++t){const o=this.positions[t];if(this.perSegmentColors&&t>0&&(e.Vector3.pack(o,n,s),s+=3,l=this.colors[t-1],a[r++]=e.Color.floatToByte(l.red),a[r++]=e.Color.floatToByte(l.green),a[r++]=e.Color.floatToByte(l.blue),a[r++]=e.Color.floatToByte(l.alpha)),this.perSegmentColors&&t===i-1)break;e.Vector3.pack(o,n,s),s+=3,e.defined(this.colors)&&(l=this.colors[t],a[r++]=e.Color.floatToByte(l.red),a[r++]=e.Color.floatToByte(l.green),a[r++]=e.Color.floatToByte(l.blue),a[r++]=e.Color.floatToByte(l.alpha));}this.vertices=n;}for(let e=0;e<this.vertices.length/3;e++)this.vertices[3*e]=this.vertices[3*e]-this._referenceCenter[0],this.vertices[3*e+1]=this.vertices[3*e+1]-this._referenceCenter[1],this.vertices[3*e+2]=this.vertices[3*e+2]-this._referenceCenter[2];if(6===this.vertices.length){const t=e.Vector3.unpack(this.vertices,0),i=e.Vector3.unpack(this.vertices,3),s=new e.Vector3;e.Vector3.lerp(t,i,.5,s),s[0]+=1;const r=[t,s,i];this.computeBoundingSphere(r),this.computeBoundingBox(r);}else this.computeBoundingSphere(),this.computeBoundingBox();this.emplaceVertexBufferOfLines();}interpolateColors(t,i,s,r,n,o,a){const l=e.PolylinePipeline.numberOfPoints(t,i,n);let h;const _=s.red,c=s.green,d=s.blue,u=s.alpha,m=r.red,p=r.green,f=r.blue,g=r.alpha;if(e.Color.equals(s,r)){for(h=0;h<l;h++)o[a++]=e.Color.floatToByte(_),o[a++]=e.Color.floatToByte(c),o[a++]=e.Color.floatToByte(d),o[a++]=e.Color.floatToByte(u);return a}const y=(m-_)/l,T=(p-c)/l,C=(f-d)/l,x=(g-u)/l;let b=a;for(h=0;h<l;h++)o[b++]=e.Color.floatToByte(_+h*y),o[b++]=e.Color.floatToByte(c+h*T),o[b++]=e.Color.floatToByte(d+h*C),o[b++]=e.Color.floatToByte(u+h*x);return b}update(t){if(this.needUpdate&&t.painter){this.needUpdate=!1;const i=t.painter.context;this._vertexBuffer?this._vertexBuffer.updateData(this._vertexArray):this._vertexBuffer=i.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?ju.members:Xu.members,this.dynamicDraw),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.vertices.length/3/2);}}serialize(){const t=[];for(let i=0;i<this.positions.length;i++)t.push(e.Vector3.pack(this.positions[i],new Array(3)));return {type:this.type,positions:t,arcType:this.arcType}}destroy(){super.destroy(),this.vertices=null,this.indices=null,this.ellipsoid=null,this.positions=null,this.colors=null,this.arcType=null,this.colorsPerVertex=null,this.type=null,this._vertexArray=null,this.primitiveType=null,this.perSegmentColors=null,this.granularity=null,this.minDistance=null;}}class Ku{constructor(){}static area(t){if(!(t instanceof Array))throw new Error("positions is not type of Array!");if(t.length<3)throw new Error("positions' length must be greater than 3!");const i=[];t.forEach((t=>{if(!(t instanceof e.Vector3))throw new Error("positions' item contains the type of not Vector3!");i.push(t.x),i.push(t.y),i.push(t.z);}));const s=new e.PolygonGeometry({polygonHierarchy:{positions:e.Vector3.fromDegreesArrayHeights(i)},perPositionHeight:!0}),r=s.vertices,n=s.indices,o=[];let a=0;for(let t=0;t<r.length/3;t++){const i=new e.Vector3;i.set(r[3*t],r[3*t+1],r[3*t+2]),o.push(i);}for(let e=0;e<n.length/3;e++)a+=Ku.areaFromTriangle([o[n[3*e]],o[n[3*e+1]],o[n[3*e+2]]]);return s.destroy(),a.toFixed(2)}static areaFromTriangle(t){const i=e.Vector3.distance(t[0],t[1]),s=e.Vector3.distance(t[0],t[2]),r=e.Vector3.distance(t[1],t[2]),n=(i+s+r)/2;return Math.sqrt(n*(n-i)*(n-r)*(n-s))}static clampedArea(t,i,s=!1,r=400,n=400){if(!(t instanceof Array))throw new Error("positions is not type of Array!");if(t.length<2)throw new Error("positions' length must be greater than 2!");if(!e.isNumber(r))throw new Error("sampleRatio' is not a number!");if(r<=0)throw new Error("'sampleRatio' should be greater than zero!");if(!e.isNumber(n))throw new Error("minArea' is not a number!");if(n<=0)throw new Error("'minArea' should be greater than zero!");const o=[],a=[];t.forEach((t=>{if(t instanceof e.Vector3)o.push(new e.Vector2(t.x,t.y)),a.push(e.Vector3.fromDegrees(t.x,t.y));else {if(!(t instanceof e.Vector2))throw new Error("positions' item contains the type of not Vector2 or Vector3!");o.push(t),a.push(e.Vector3.fromDegrees(t.x,t.y));}}));const l=e.PolygonPipeline.triangulate(o);let h=l.length;if(h<3)throw new Error("cannot form valid polygon, please check your input");let _=0;for(let e=0;e<h;e+=3)_+=Ku.areaFromTriangle([a[l[e]],a[l[e+1]],a[l[e+2]]]);n=Math.max(n,_/r);const c=[];for(let e=0;e<h;e+=3)Ku.splitTriangle([l[e],l[e+1],l[e+2]],a,c,n);const d=a.length;if(d>1e4)throw new Error("Too many sample points, please decrease sampleRatio or shrink measured polygon");const u=[],m=new e.StructArrayLayout3f3f24;for(let t=0;t<d;t++){const s=e.Transforms.cartesian3ToCartographic(a[t]);let r=0;if(i.style.rasterSourceCache.terrainSource.isTerrain()&&(r=Ol([s[0],s[1]],i.style.rasterSourceCache.terrainSource,i.projection)),!e.defined(r))throw new Error("cannot find terrain");{const t=e.Vector3.fromDegrees(s[0],s[1],r);u.push(t);const i=e.EncodedVector3.encode(t.x),n=e.EncodedVector3.encode(t.y),o=e.EncodedVector3.encode(t.z);m.emplaceBack(i.high,n.high,o.high,i.low,n.low,o.low);}}h=c.length;let p=0;const f=new e.StructArrayLayout2ui4;for(let e=0;e<h;e+=3){const t=[u[c[e]],u[c[e+1]],u[c[e+2]]];f.emplaceBack(c[e],c[e+1]),f.emplaceBack(c[e+1],c[e+2]),f.emplaceBack(c[e+2],c[e]),p+=Ku.areaFromTriangle(t);}const g=i.painter.context,y=g.createVertexBuffer(m,ju.members),T=g.createIndexBuffer(f),C=e.SegmentVector.simpleSegment(0,0,d,h),x=new e.Geometry({vertexBuffer:y,indexBuffer:T,segmentVector:C,primitiveType:e.WebGLConstants.LINES});return x._usedDoublePrecision=!0,{geometry:x,area:p.toFixed(2)}}static splitTriangle(t,i,s,r){const n=[i[t[0]],i[t[1]],i[t[2]]];if(Ku.areaFromTriangle(n)<r)return void s.push(t[0],t[1],t[2]);const o=[e.Cartographic.fromVector3(n[0]),e.Cartographic.fromVector3(n[1]),e.Cartographic.fromVector3(n[2])],a=[];for(let t=0;t<3;t++){const s=t<2?t+1:0;i.push(e.Vector3.fromRadians((o[t].longitude+o[s].longitude)/2,(o[t].latitude+o[s].latitude)/2)),a.push(i.length-1);}const l=[t[1],a[0],a[1]],h=[t[2],a[1],a[2]],_=[a[0],a[1],a[2]];Ku.splitTriangle([t[0],a[0],a[2]],i,s,r),Ku.splitTriangle(l,i,s,r),Ku.splitTriangle(h,i,s,r),Ku.splitTriangle(_,i,s,r);}static distance(t){if(!(t instanceof Array))throw new Error("positions is not type of Array!");if(t.length<2)throw new Error("positions' length must be greater than 2!");let i=[];t.forEach((t=>{if(!(t instanceof e.Vector3))throw new Error("positions' item contains the type of not Vector3!");i=i.concat(e.Vector3.fromDegreesArrayHeights(t));}));let s=0;for(let t=0;t<i.length-1;t++)s+=e.Vector3.distance(i[t],i[t+1]);return s.toFixed(2)}static clampedDistance(t,i,s=!1,r=30){if(!(t instanceof Array))throw new Error("positions is not type of Array!");if(t.length<2)throw new Error("positions' length must be greater than 2!");if(!e.isNumber(r))throw new Error("minDistance' is not a number!");if(r<=0)throw new Error("'minDistance' should be greater than zero!");let n=[];t.forEach((t=>{if(t instanceof e.Vector3)n=n.concat(e.Vector3.fromDegreesArrayHeights(t));else {if(!(t instanceof e.Vector2))throw new Error("positions' item contains the type of not Vector2 or Vector3!");n=n.concat(e.Vector3.fromDegreesArray(t));}}));const o=e.PolylinePipeline.generateCartesianArc({positions:n,height:0,ellipsoid:e.Transforms.DefaultEllipsoid,minDistance:r}),a=o.length;if(a>1e4)throw new Error("Too many points, please decrease sample distance or shorten measured polyline");let l,h,_=0;const c=[];for(let t=0;t<a-1;t++){if(0===t){l=o[0];const t=e.Transforms.cartesian3ToCartographic(l);let s=0;if(i.style.rasterSourceCache.terrainSource.isTerrain()&&(s=Ol([t[0],t[1]],i.style.rasterSourceCache.terrainSource,i.projection)),!e.defined(s))throw new Error("cannot find terrain");l=e.Vector3.fromDegrees(t[0],t[1],s),c.push(l);}h=o[t+1];const s=e.Transforms.cartesian3ToCartographic(h);let r=0;if(i.style.rasterSourceCache.terrainSource.isTerrain()&&(r=Ol([s[0],s[1]],i.style.rasterSourceCache.terrainSource,i.projection)),!e.defined(r))throw new Error("cannot find terrain");h=e.Vector3.fromDegrees(s[0],s[1],r),c.push(h),_+=e.Vector3.distance(l,h),l=h;}return {geometry:new qu({positions:c,arcType:e.ARCTYPE.NONE}),distance:_.toFixed(2)}}static height(t,i){if(!(t instanceof e.Vector3))throw new Error("startPoint is not type of Vector3!");if(!(i instanceof e.Vector3))throw new Error("endPoint is not type of Vector3!");const s=t.x,r=t.y,n=i.x,o=i.y,a=i.z,l=e.Vector3.fromDegrees(s,r,t.z),h=e.Vector3.fromDegrees(n,o,a),_=e.Vector3.distance(l,e.Vector3.fromDegrees(s,r,a)),c=e.Vector3.distance(h,e.Vector3.fromDegrees(s,r,a)),d=e.Vector3.distance(l,h);return {horizontalDistance:parseFloat(c.toFixed(2)),verticalHeight:parseFloat(_.toFixed(2)),spatialDistance:parseFloat(d.toFixed(2))}}}class Ju{constructor(t){if(this.type="scene-object",!e.defined(t.data))throw new Error("options.data is required.");if(this._ready=!1,this.data=t.data,this.width=e.defined(t["airline-width"])?t["airline-width"]:1,this.segGroup=e.defined(t["airline-seg-group"])?t["airline-seg-group"]:5,this.speed=e.defined(t["airline-speed"])?t["airline-speed"]:60,this.opacity=e.defined(t["airline-opacity"])?t["airline-opacity"]:1,null!=t["airline-color"]){if(this.steps=t["airline-color"].steps,this.colorIndex=t["airline-color"]["color-index"],null==this.steps||null==this.colorIndex)throw new Error("options.airline-color.steps and options.airline-color.color-index are both required.");if(this.colorIndex>t.data[0].length)throw new Error("options.airline-color.color-index 不可以超过传入数据的范围");this.steps.forEach((t=>{t.push(e.Color.parse(t[1]).toVector3());}));}this.id=e.defined(t.id)?t.id:e.uuid(),this.minzoom=1,this.maxzoom=18,this.visible=!0,this.positions=[],this.lineSegmentation=[],this.colorArray=[],this.parse(t.data),this.getGeometry(),this.material=new e.PolylineMaterial({opacity:this.opacity}),this.material.defines.VERTEX_COLOR=!0;}onAdd(t){this.painter=t.painter;const i=new e.Primitive({material:this.material,geometry:this.staticGeometry,modelMatrix:new e.Matrix4}),s=new e.Primitive({material:this.material,geometry:this.dynamicGeometry,modelMatrix:new e.Matrix4});this.primitive=[i,s],this._ready=!0;}collect(){let e=!0;const t=this.painter.style.getNearestTileZoom();return t<this.minzoom&&(e=!1),t>this.maxzoom&&(e=!1),this.visible&&e?[this.primitive]:[]}parse(e){let t=0;const i=[];e.forEach((e=>{i.push(t);const s=this.getColor(e[this.colorIndex-1]);this.getBSRPoints(e[0],e[1],e[2],e[3],1e4*e[4]).map((e=>{this.positions.push(...e),this.colorArray.push(s),t++;}));})),i.push(t);for(let e=0;e<i.length-1;e++)this.lineSegmentation.push([i[e],i[e+1],i[e],i[e+1]]);}getGeometry(){this.staticGeometry=new e.PolylineGeometry({positions:e.Vector3.fromDegreesArrayHeights(this.positions),width:this.width,arcType:e.ARCTYPE.GEODESIC,lineSegmentation:this.lineSegmentation,colorArray:this.colorArray}),this.staticGeometry.type="airLine",this.dynamicGeometry=new e.PolylineGeometry({positions:e.Vector3.fromDegreesArrayHeights(this.positions),width:this.width+2,arcType:e.ARCTYPE.GEODESIC,lineSegmentation:this.lineSegmentation,colorArray:this.colorArray,speed:this.speed,segGroup:this.segGroup,dynamicAirLine:!0}),this.dynamicGeometry.type="airLine";}getColor(t){if(null==this.steps)return this.getRandomColor();{const i=this.steps.length;if(t<=this.steps[0][0])return [this.steps[0][2][0],this.steps[0][2][1],this.steps[0][2][2]];if(t>=this.steps[i-1][0])return [this.steps[i-1][2][0],this.steps[i-1][2][1],this.steps[i-1][2][2]];for(let s=0;s<i-1;s++)if(t<=this.steps[s+1][0]&&t>=this.steps[s][0]){const i=(t-this.steps[s][0])/(this.steps[s+1][0]-this.steps[s][0]),r=e.Vector3.add(e.Vector3.multiplyByScalar(this.steps[s+1][2],i),e.Vector3.multiplyByScalar(this.steps[s][2],1-i));return [r[0],r[1],r[2]]}}}getRandomColor(){return [Math.random(),Math.random(),Math.random()]}loaded(){return this._ready}destroy(){this.primitive.destroy();}getBSRPoints(t,i,s,r,n){const o=[i,0],a=[(r+i)/2,n],l=[r,0],h=Ku.distance([new e.Vector3(t,i,0),new e.Vector3(s,r,0)]),_=this.getBSR(o,a,l,h),c=[];for(const e in _)c.push([(s-t)*(_[e][0]-i)/(r-i)+t,_[e][0],_[e][1]]);return c}getBSR(e,t,i,s){return this.createBezierPoints([{x:e[0],y:e[1]},{x:t[0],y:t[1]},{x:i[0],y:i[1]}],Math.floor(s/14e3))}createBezierPoints(e,t){const i=[];for(let s=0;s<t;s++){const r=this.multiPointBezier(e,s/(t-1));i.push([r.x,r.y]);}return i}multiPointBezier(e,t){const i=e.length;let s=0,r=0;const n=function(e,t){let i=1,s=1;for(;t>0;)i*=e,s*=t,e--,t--;return i/s};for(let o=0;o<i;o++){const a=e[o];s+=a.x*Math.pow(1-t,i-1-o)*Math.pow(t,o)*n(i-1,o),r+=a.y*Math.pow(1-t,i-1-o)*Math.pow(t,o)*n(i-1,o);}return {x:s,y:r}}}class Zu extends Du{constructor(){super(),this._hasSkyBox=!1,this._hasEarthCrate=!1,this._skyOrders=[];}add(e){if(!(e.id.indexOf("skybox-")>-1&&this._hasSkyBox)){if(!(e.id.indexOf("earthCrate-")>-1&&this._hasEarthCrate)){if(this.has(e.id))throw new Error(`There is already a sceneComponent with this ID: ${e.id}`);return -1!==e.id.indexOf("skybox-")?this._skyOrders.unshift(e.id):-1!==e.id.indexOf("earthCrate-")||-1!==e.id.indexOf("sun-")?this._skyOrders.push(e.id):this._orders.push(e.id),e.id.indexOf("skybox-")>-1&&(this._hasSkyBox=!0),e.id.indexOf("earthCrate-")>-1&&(this._hasEarthCrate=!0),this._data.set(e.id,e),e}console.error("The current map instance has added map skin. Please do not add it again!");}}getSkyAndEarthPrimitives(t,i){i=i||e.checkIsDepthSupportDataType;let s=[];for(let e=0;e<this._skyOrders.length;e++){const t=this.get(this._skyOrders[e]);i(t.classificationType)&&(s=s.concat(t.collect()));}return s}getEarthObject(){for(let e=0;e<this._skyOrders.length;e++){const t=this.get(this._skyOrders[e]);if(t instanceof Wu)return t}}getSkyboxObject(){for(let e=0;e<this._skyOrders.length;e++){const t=this.get(this._skyOrders[e]);if(t instanceof Uu)return t}}getTranslucentPrimitives(t,i){i=i||e.checkIsDepthSupportDataType;const s=[];for(let r=0;r<this._orders.length;r++){const n=this.get(this._orders[r]).primitive;for(let r=0;r<n.length;r++){const o=n[r];i(o.classificationType)&&o._material.isTranslucent&&(!t||!o.boundingVolume||t&&t.computeVisibility(o.boundingVolume)!==e.INTERSECTION.OUTSIDE)&&s.push(o);}}return s}getOpaquePrimitives(t,i){const s=[];i=i||e.checkIsDepthSupportDataType;for(let r=0;r<this._orders.length;r++){const n=this.get(this._orders[r]).primitive;for(let r=0;r<n.length;r++){const o=n[r];i(o.classificationType)&&(o._material.isTranslucent||(!t||!o.boundingVolume||t&&t.computeVisibility(o.boundingVolume)!==e.INTERSECTION.OUTSIDE)&&s.push(o));}}return s}removeAll(e){for(super.removeAll(e);this._skyOrders.length>0;)this.removeSky(this._skyOrders[0],e);}serialize(){const e=[];for(let t=0;t<this._orders.length;t++){const i=this.get(this._orders[t]);i instanceof Ju&&e.push({type:"airLine",data:i.data,"airline-seg-group":i.segGroup,"airline-width":i.width,"airline-speed":i.speed,"airline-opacity":i.opacity,"airline-color":{steps:i.steps,"color-index":i.colorIndex},id:i.id});}return e.length>0?e:void 0}removeSky(e,t){if(this.has(e)){if(t){const t=this.get(e);t.destroy&&t._loaded&&t.destroy();}this._data.delete(e);const i=this._skyOrders.indexOf(e);this._skyOrders.splice(i,1);}}loaded(){for(let e=0;e<this._orders.length;e++)if(!this._data.get(this._orders[e]).loaded())return !1;for(let e=0;e<this._skyOrders.length;e++)if(!this._data.get(this._skyOrders[e]).loaded())return !1;return !0}destroy(){return this.removeAll(!0),e.destroyObject(this)}}class Yu extends Du{constructor(){super(),this._data=new Map;}add(e){this.has(e.id)||(this._data.set(e.id,e),this._orders.push(e.id));}getAllPrimitives(){const e=[];for(let t=0;t<this._orders.length;t++){const i=this.get(this._orders[t]);e.push(i);}return e}getPrimitiveById(e){if(!this.has(e))return this.get(this._orders[e])}remove(e){this.get(e)&&this.get(e).destroy(),super.remove(e);}removeAll(e){for(;this._orders.length>0;)this.remove(this._orders[0],e);}getAllNeedRenderPrimitive(){return this.getAllPrimitives()}removeNeedRenderPrimitiveList(){this.removeAll(!0);}destroy(){return this.removeAll(!0),e.destroyObject(this)}}const Qu=new e.Vector2(400,400),$u=new e.Matrix4,em=new e.Vector3;class tm extends e.Material{constructor(e){super(e),this.type="sun",this._texture=e.texture,this._pixelResolution=Qu.multiplyScalar(e.scale),this._radius=7e7,this._renderState=this._createRenderState(),this._createUniforms(e.painter),this._modelMatrixDirty=!0;}_createRenderState(){const t={};return t.depthTest=e.renderStateEnum.enableDepthTest,t.depthMask=e.renderStateEnum.enableDepthMask,t.stencilTest=e.renderStateEnum.disableStencilTest,t.blending=e.renderStateEnum.enableBlending,t}_createUniforms(e){this._uniforms.set("u_MVMatrix",(()=>(e.frameState.camera.viewMatrix.multiplyRight(this._modelMatrix,$u),$u))),this._uniforms.set("u_SunTexture",(()=>this._texture)),this._uniforms.set("u_ProjectionMatrix",(()=>e.frameState.camera.getProjectionMatrix())),this._uniforms.set("u_PixelResolution",(()=>this._pixelResolution));}update(t,i,s={}){if(super.update(t,i,s),this._modelMatrixDirty){const t=e.Vector3.clone(i.sunLight.getSunDirectionGlobalWithCache(),em).multiplyScalar(this._radius);this._modelMatrix=e.Transforms.cartesianToFixedFrame(t);}}}class im{constructor(t){this.type="scene-object",this.id="sun-MinemapInternal",this.isSceneObject=!0,this._url=t.url,this._scale=e.defaultValue(t.scale,1),this.geometry=new ja(t);}onAdd(t){e.getImage({url:t._transformRequest(this._url,e.ResourceType.Image).url,imageBitmapOptions:{premultiplyAlpha:"premultiply"}},((i,s)=>{if(i)return;const r=new e.Texture({context:t.painter.context,image:s,pixelFormat:e.WebGLConstants.RGBA,useMipmap:!1});r.bind(e.WebGLConstants.NEAREST,e.WebGLConstants.CLAMP_TO_EDGE),this.material=new tm({painter:t.painter,texture:r,scale:this._scale}),this.primitive=new e.Primitive({material:this.material,geometry:this.geometry,modelMatrix:new e.Matrix4}),this._ready=!0,t.needRepaint=!0;}));}loaded(){return this._ready}collect(){return this._ready?[this.primitive]:[]}}const sm=(t,i)=>e.emitValidationErrors(t,i&&i.filter((e=>"source.canvas"!==e.identifier))),rm=e.pick(Zl,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),nm=e.pick(Zl,["setCenter","setZoom","setBearing","setPitch"]),om=function(){const t={},i=e.spec.$version;for(const s in e.spec.$root){const r=e.spec.$root[s];if(r.required){let e=null;e="version"===s?i:"array"===r.type?[]:{},null!=e&&(t[s]=e);}}return t}();class am extends e.Evented{constructor(t,i={}){super(),this.map=t,this.dispatcher=new hl((ql||(ql=new jl),ql),this),this.imageManager=new sl,this.imageManager.setEventedParent(this),this.glyphManager=new al(t._transformRequest,i.localIdeographFontFamily),this.lineAtlas=new ll(256,512),this.crossTileSymbolIndex=new Bh,this.classificationLayer=[],this._layers={},this._customLayers=[],this._order=[],this.sourceCaches={},this.zoomHistory=new e.ZoomHistory,this._loaded=!1,this.firstClassificationTypeId=void 0,this._availableImages=[],this._videoSource=void 0,this.hasTerrainData=!1,this.terrainAnalysis=null,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",e.getReferrer());const s=this;this._rtlTextPluginCallback=am.registerForPluginStateChange((t=>{s.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},((t,i)=>{if(e.triggerPluginCompletionEvent(t),i&&i.every((e=>e)))for(const e in s.sourceCaches)s.sourceCaches[e].reload();}));})),this.modelCollection=new Ou({type:"3d-model"}),this.tilesetCollection=new Ou({type:"3d-tiles"}),this.scenePointPrimitiveCollection=new Lu,this.primitiveCollection=new Vu,this.primitivePreRenderCollection=new Vu,this.sceneObjectCollection=new Zu,this.debugBoundingBoxPrimitiveCollection=new Yu,this.changWorkerProjection(i.projection||e.ProjectionType.MERCATOR),this.performanceManager=new Iu(this),this.symbolMatrixHelper=new el(this.map.transform),this.on("data",(e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.sourceCaches[e.sourceId];if(!t)return;const i=t.getSource();if(i&&i.vectorLayerIds)for(const e in this._layers){const t=this._layers[e];t.source===i.id&&this._validateLayer(t);}})),this._performanceManagerEvent=this._performanceManagerEvent.bind(this),this.map.on&&this.map.on("moveend",this._performanceManagerEvent),this.map.on&&this.map.on("handler-moveend",this._performanceManagerEvent),this.once("load",(()=>{this.performanceManager.stopAction();})),this.rasterSourceCache=Ru("MINEMAP_RASTER_ID",{type:"raster",map:this.map},this.dispatcher),this.proxySourceCache=Ru("MINEMAP_PROXY_ID",{type:"proxy",map:this.map},this.dispatcher);}_performanceManagerEvent(){this.performanceManager.forceServericeRequest=!0,this.performanceManager.stopAction(),this.performanceManager.eventDone=!0;}changWorkerProjection(e){this.dispatcher.broadcast("setProjection",{projection:e},(()=>{}));}loadURL(t,i={}){this.fire(new e.Event("dataloading",{dataType:"style"})),i.validate="boolean"==typeof i.validate?i.validate:!xt(t),t=bt(t,i.key,i.appKey);const s=this.map._transformRequest(t,e.ResourceType.Style);this._request=e.getJSON(s,((t,s)=>{this._request=null,t?this.fire(new e.ErrorEvent(t)):s&&this._load(s,i);}));}loadJSON(t,i={}){this.fire(new e.Event("dataloading",{dataType:"style"})),this._request=e.exported.frame((()=>{this._request=null,i.validate=!1!==i.validate,this._load(t,i);}));}loadEmpty(){this.fire(new e.Event("dataloading",{dataType:"style"})),this._load(om,!1);}markOriginalStyle(e){for(const t in e.sourceCaches)e.sourceCaches[t]._original_style=!0;for(const t in e._layers)e._layers[t]._original_style=!0;}registCommonQuadtree(e){this.commonQuadtree=e;}set commonQuadtree(e){this._commonQuadtree=e;}get commonQuadtree(){return this._commonQuadtree||(this._commonQuadtree=x_({tileSize:512,isLngLat:this.map.transform.projection===e.ProjectionType.LATLON,drawingBufferHeight:this.map.painter.context.gl.drawingBufferHeight,hasTerrainData:this.hasTerrainData,spaceErrorScale:this.map.spaceErrorScale})),this._commonQuadtree}coveringTiles(){return this.commonQuadtree.tilesIn(this.map.transform.activeCamera),this.commonQuadtree.getOverscaledTileIDs()}_load(t,i){if(i.validate&&sm(this,e.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t;for(const e in t.sources)this.addSource(e,t.sources[e],{validate:!1});t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0));const{map:s}=this;t.images&&Object.entries(t.images).forEach((([e,t])=>{s.hasImage(e)||s.loadImage(t,((i,r)=>{i||s.addImage(e,r,{url:t});}));})),this.glyphManager.setURL(t.glyphs);const r=Jl(this.stylesheet.layers);this._order=r.map((e=>e.id)),this._layers={};for(let t of r)t=e.createStyleLayer(t),t.setEventedParent(this,{layer:{id:t.id}}),this._layers[t.id]=t,"background"===t.type&&t.getPaintProperty("background-terrain-analysis")&&(this.terrainAnalysis=t.getPaintProperty("background-terrain-analysis"));this.rasterSourceCache.addOrMoveLayer(),this.proxySourceCache.updateLayer(),this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.markOriginalStyle(this),this.fire(new e.Event("data",{dataType:"style"})),this.fire(new e.Event("style.load")),this.fire(new e.Event("processStyleJson",{dataType:"style",styleJsonData:t,diff:i.diff,keepUserInfo:i.keepUserInfo,useCustomCamera:i.useCustomCamera}));}_validateLayer(t){const i=this.sourceCaches[t.source];if(!i)return;const s=t.sourceLayer;if(!s)return;const r=i.getSource();("geojson"===r.type||r.vectorLayerIds&&-1===r.vectorLayerIds.indexOf(s))&&this.fire(new e.ErrorEvent(new Error(`Source layer "${s}" does not exist on source "${r.id}" as specified by style layer "${t.id}"`)));}_loadSprite(t){this._spriteRequest=function(t,i,s){const r=[],n=e.exported.devicePixelRatio>1?"@2x":"",o=(e=>{const{url:t}=e;if(!xt(t))return t;const i=Pt(t);return i.path=`${yt.SRC_URL}/sprite/sprite`,i.path})({url:t,format:n}),a=Array.isArray(yt.spriteUrl)?yt.spriteUrl:[yt.spriteUrl];yt.spriteUrl=a?Array.from(new Set([...a])):o;for(let e=0;e<yt.spriteUrl.length;e++)(e=>{if("string"==typeof t)r.push({}),l(e,t);else if(t instanceof Array)for(let i=0;i<t.length;i++)r.push({}),l(e+i,t[i]);else console.log(`不支持当前格式的sprite${t}`);})(e);function l(t,o){const a=At({url:o,format:n,extension:".json",index:t});e.getJSON(i(a,e.ResourceType.SpriteJSON),((e,i)=>{r[t].json=i,r[t].error||(r[t].error=e),tl(r,yt.spriteUrl.length,s);}));const l=At({url:o,format:n,extension:".png",index:t});e.getImage(i(l,e.ResourceType.SpriteImage),((e,i)=>{r[t].image=i,r[t].error||(r[t].error=e),tl(r,yt.spriteUrl.length,s);}));}}(t,this.map._transformRequest,((t,i)=>{if(this._spriteRequest=null,t)this.fire(new e.ErrorEvent(t));else if(i)for(const e in i)this.imageManager.addImage(e,i[e]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new e.Event("data",{dataType:"style"}));}));}loaded(){if(!this._loaded)return !1;if(Object.keys(this._updatedSources).length)return !1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return !1;if(!this.imageManager.isLoaded())return !1;if(this.skybox&&!this.isSkyboxReady)return !1;if(this.earthSkin&&!this.isEarthSkinReady)return !1;for(const t in this._layers)if(Object.hasOwnProperty.call(this._layers,t)){const i=this._layers[t];if(!(i.lightingModel!==e.LightingModelType.PBR||"3d-model"!==i.type&&"3d-tiles"!==i.type||this.map._iBLtextures&&this.map._iBLtextures.isLoaded))return !1}return !0}_serializeLayers(e){const t=[];for(const i of e){const e=this._layers[i];"custom"!==e.type&&t.push(e.serialize());}return t}hasTransitions(){for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return !0;for(const e in this._layers)if(this._layers[e].hasTransition())return !0;return !1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(this._loaded){if(this._changed){const i=Object.keys(this._updatedLayers),s=Object.keys(this._removedLayers);(i.length||s.length)&&this._updateWorkerLayers(i,s);for(const e in this._updatedSources){const t=this._updatedSources[e];"reload"===t?this._reloadSource(e):"clear"===t&&this._clearSource(e);}for(const e in this._updatedPaintProps)this._layers[e].updateTransitions(t);this._resetUpdates(),this.fire(new e.Event("data",{dataType:"style"}));}for(const e in this.sourceCaches)this.sourceCaches[e].used=!1;for(const e of this._order){const i=this._layers[e];i.recalculate(t,this._availableImages),i.source&&"raster"!==i.type&&(i.isHiddenByMapZoom(this.z)||(this.sourceCaches[i.source].used=!0));}this.z=t.zoom;}}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={};}}_updateWorkerLayers(e,t){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(e),removedIds:t});}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={};}setState(t,i){if(this._checkLoaded(),sm(this,e.validateStyle(t)))return !1;(t=e.clone(t)).layers=Jl(t.layers);const r=function(e,t,i){if(!e)return [{command:Zl.setStyle,args:[t]}];let r=[];try{if(!s(e.version,t.version))return [{command:Zl.setStyle,args:[t]}];s(e.center,t.center)||r.push({command:Zl.setCenter,args:[t.center]}),s(e.zoom,t.zoom)||r.push({command:Zl.setZoom,args:[t.zoom]}),s(e.bearing,t.bearing)||r.push({command:Zl.setBearing,args:[t.bearing]}),s(e.pitch,t.pitch)||r.push({command:Zl.setPitch,args:[t.pitch]}),s(e.sprite,t.sprite),s(e.glyphs,t.glyphs)||r.push({command:Zl.setGlyphs,args:[t.glyphs]}),s(e.transition,t.transition)||r.push({command:Zl.setTransition,args:[t.transition]});const n={};t.layers.forEach((e=>{e._original_style=!0;}));for(const e in t.sources)t.sources[e]._original_style=!0;const o=[];!function(e,t,i,r,n){let o;for(o in t=t||{},e=e||{})e.hasOwnProperty(o)&&(n&&!e[o]._original_style||t.hasOwnProperty(o)||Ql(o,i,r));for(o in t)t.hasOwnProperty(o)&&(e.hasOwnProperty(o)?s(e[o],t[o])||("geojson"===e[o].type&&"geojson"===t[o].type&&eh(e,t,o)?i.push({command:Zl.setGeoJSONSourceData,args:[o,t[o].data]}):$l(o,t,i,r,t[o]._original_style)):Yl(o,t,i,!!t[o]._original_style));}(e.sources,t.sources,o,n,i);const a=[];e.layers&&e.layers.forEach((e=>{n[e.source]?r.push({command:Zl.removeLayer,args:[e.id]}):a.push(e);})),r=r.concat(o),i&&a.forEach((e=>{e._original_style||t.layers.push(e);})),function(e,t,i,r){t=t||[];const n=(e=e||[]).map(ih),o=t.map(ih),a=e.reduce(sh,{}),l=t.reduce(sh,{}),h=n.slice(),_=Object.create(null);let c,d,u,m,p,f,g;for(c=0,d=0;c<n.length;c++)u=n[c],r&&a.hasOwnProperty(u)&&!a[u]._original_style||l.hasOwnProperty(u)?d++:(i.push({command:Zl.removeLayer,args:[u]}),h.splice(h.indexOf(u,d),1));for(c=0,d=0;c<o.length;c++)u=o[o.length-1-c],h[h.length-1-c]!==u&&(a.hasOwnProperty(u)?(i.push({command:Zl.removeLayer,args:[u]}),h.splice(h.lastIndexOf(u,h.length-d),1)):d++,f=h[h.length-c],i.push({command:Zl.addLayer,args:[l[u],f,{isOriginal:l[u]._original_style}]}),h.splice(h.length-c,0,u),_[u]=!0);for(c=0;c<o.length;c++)if(u=o[c],m=a[u],p=l[u],!_[u]&&!s(m,p))if(s(m.source,p.source)&&s(m["source-layer"],p["source-layer"])&&s(m.type,p.type)){for(g in th(m.layout,p.layout,i,u,null,Zl.setLayoutProperty),th(m.paint,p.paint,i,u,null,Zl.setPaintProperty),s(m.filter,p.filter)||i.push({command:Zl.setFilter,args:[u,p.filter]}),s(m.minzoom,p.minzoom)&&s(m.maxzoom,p.maxzoom)||i.push({command:Zl.setLayerZoomRange,args:[u,p.minzoom,p.maxzoom]}),m)m.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?th(m[g],p[g],i,u,g.slice(6),Zl.setPaintProperty):s(m[g],p[g])||i.push({command:Zl.setLayerProperty,args:[u,g,p[g]]}));for(g in p)p.hasOwnProperty(g)&&!m.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?th(m[g],p[g],i,u,g.slice(6),Zl.setPaintProperty):s(m[g],p[g])||i.push({command:Zl.setLayerProperty,args:[u,g,p[g]]}));}else i.push({command:Zl.removeLayer,args:[u]}),f=h[h.lastIndexOf(u)+1],i.push({command:Zl.addLayer,args:[p,f,{isOriginal:l[u]._original_style}]});}(a,t.layers,r,i);}catch(e){r=[{command:Zl.setStyle,args:[t]}];}return r}(this.roughSerialize(),t,i).filter((e=>!(e.command in nm)));if(0===r.length)return !1;const n=r.filter((e=>!(e.command in rm)));if(n.length>0)throw new Error(`Unimplemented: ${n.map((e=>e.command)).join(", ")}.`);return r.forEach((e=>{"setTransition"!==e.command&&this[e.command].apply(this,e.args);})),this.stylesheet=t,!0}updateImage(e,t){this.imageManager.updateImage(e,t);}addImage(t,i){if(this.getImage(t))return this.fire(new e.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(t,i),this._afterImageUpdated(t);}getImage(e){return this.imageManager.getImage(e)}removeImage(t){if(!this.getImage(t))return this.fire(new e.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(t),this._afterImageUpdated(t),this.fire(new e.Event("data",{dataType:"style"}));}listImages(){return this._checkLoaded(),this._availableImages.slice()}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new e.Event("data",{dataType:"style"}));}addSceneComponent(e){let t;switch(e.type){case"3d-model":t=this.addSceneModel(e);break;case"3d-tiles":t=this.addSceneTileset(e);break;case"scene-object":t=this.addSceneObject(e);}return t}addSceneModel(e){e.map=this.map;const t=new Ua(e);return t.load(),this.modelCollection.add(t)}addSceneTileset(e){return e.map=this.map,this.tilesetCollection.add(new _d(e))}addSceneObject(e){e instanceof Uu&&(this._skybox=e),e instanceof Wu&&(this._earthSkin=e),e instanceof im&&(this._sun=e),e.onAdd(this.map),this.sceneObjectCollection.add(e);}getSceneComponent(e){return this.modelCollection.get(e)||this.sceneObjectCollection.get(e)||this.tilesetCollection.get(e)}removeSceneComponent(e){if(!this.getSceneComponent(e))throw new Error(`There is no one sceneComponent with this ID: ${e}`);this.modelCollection.remove(e,!0),this.sceneObjectCollection.remove(e,!0),this.tilesetCollection.remove(e,!0);}addPrimitive(e){return e instanceof kh?this.scenePointPrimitiveCollection.add(e):this.primitiveCollection.add(e),e}removePrimitive(t){if(t instanceof kh)return this.scenePointPrimitiveCollection.remove(t.id);if(!(t instanceof e.Primitive))throw new Error("There is not a primitive!");this.primitiveCollection.remove(t.id);}removePrimitiveById(e){this.primitiveCollection.has(e)&&this.primitiveCollection.remove(e);}getPrimitiveById(e){if(this.primitiveCollection.has(e))return this.primitiveCollection.get(e)}addPrimitiveForPreRender(e){this.primitivePreRenderCollection.add(e);}removePrimitiveForPreRender(t){if(!(t instanceof e.Primitive))throw new Error("There is not a primitive!");this.primitivePreRenderCollection.remove(t.id);}addSource(e,t,i){if(this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error(`There is already a source with this ID '${e}'`);if(!t.type)throw new Error(`The type property must be defined, but the only the following properties were given: ${Object.keys(t).join(", ")}.`);if("raster"===t.type||"image"===t.type)this.rasterSourceCache.addSource(e,t);else {this.map&&this.map._collectResourceTiming&&(t.collectResourceTiming=!0);const s=this.sourceCaches[e]=Ru(e,t,this.dispatcher);i&&i.isOriginal&&(this.sourceCaches[e]._original_style=!0),s.style=this,s.setEventedParent(this,(()=>({isSourceLoaded:this.loaded(),source:s.serialize(),sourceId:e}))),s.onAdd(this.map);}this._changed=!0;}removeSource(t){this._checkLoaded();const i=this.rasterSourceCache.getSource(t);if(void 0===this.sourceCaches[t]&&!i)throw new Error("找不到对应id的数据源");for(const i in this._layers)if(this._layers[i].source===t)return this.fire(new e.ErrorEvent(new Error(`"${i}"正在使用数据源 "${t}"，无法执行删除操作`)));if(i)this.rasterSourceCache.removeSource(t),this._changed=!0;else {const i=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],i.fire(new e.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),i.setEventedParent(null),i.clearTiles(),i.onRemove&&i.onRemove(this.map),this._changed=!0;}}setGeoJSONSourceData(e,t){this._checkLoaded(),this.sourceCaches[e].getSource().setData(t),this._changed=!0;}getSource(e){return this.rasterSourceCache.getSource(e)||this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(t,i,s){this._checkLoaded();const r=t.id;if(this.getLayer(r))return void this.fire(new e.ErrorEvent(new Error(`Layer with id "${r}" already exists on this map`)));let n;if("custom"===t.type)return n=e.createStyleLayer(t),n.onAdd&&n.onAdd(this.map),void this._customLayers.push(n);if("object"==typeof t.source&&(this.addSource(r,t.source),t=e.clone(t),t=e.extend(t,{source:r})),this._validate(e.validateStyle.layer,`layers.${r}`,t,{arrayIndex:-1},s))return;n=e.createStyleLayer(t),this._validateLayer(n),"background"===n.type&&n.getPaintProperty("background-terrain-analysis")&&(this.terrainAnalysis=n.getPaintProperty("background-terrain-analysis")),n.setEventedParent(this,{layer:{id:r}}),n.uuid=e.uuid();const o=i?this._order.indexOf(i):this._order.length;if(i&&-1===o)this.fire(new e.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`)));else {if(null!=t.lightingModel&&(n.lightingModel=t.lightingModel),e.checkIsVectorShadowVolumeDataType(n.classificationType)?this.classificationLayer.indexOf(r)<0&&this.classificationLayer.push(r):this._order.splice(o,0,r),this.classificationLayer.length>0&&(this.classificationLayer.forEach((e=>{const t=this._order.indexOf(e);t>-1&&this._order.splice(t,1);})),this._order=this._order.concat(this.classificationLayer)),this._layerOrderChanged=!0,this._layers[r]=n,s&&s.isOriginal&&(this._layers[r]._original_style=!0),this._removedLayers[r]&&n.source&&"custom"!==n.type&&"raster"!==n.type){const e=this._removedLayers[r];delete this._removedLayers[r],e.type!==n.type?this._updatedSources[n.source]="clear":(this._updatedSources[n.source]="reload",this.sourceCaches[n.source].pause());}this._updateLayer(n),n.onAdd&&n.onAdd(this.map),"raster"===n.type?(this.proxySourceCache.enabled&&this.proxySourceCache.updateLayer(),this.rasterSourceCache.addOrMoveLayer()):"background"===n.type?n.getPaintProperty("background-terrain-analysis")&&this.rasterSourceCache.addTerrainAnalysisLayer():!this.sourceCaches[n.source]?.adaptTerrain||"line"!==n.type&&"sprite"!==n.type&&"fill"!==n.type&&"heatmap"!==n.type||this.proxySourceCache.updateLayer();}}updateHasTerrainFlag(){this.hasTerrainData=this.rasterSourceCache.terrainSource.isTerrain(),this.map.transform.terrainRender=this.hasTerrainData,this.map.transform.terrainSupplier=this.rasterSourceCache.terrainSource;}resetSourceQuadtree(){for(const e in this.sourceCaches)this.sourceCaches[e].resetQuadtree&&this.sourceCaches[e].resetQuadtree();}getId(e){return this._order[e]}moveLayer(t,i){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===i)return;const s=this._order.indexOf(t);this._order.splice(s,1);const r=i?this._order.indexOf(i):this._order.length;i&&-1===r?this.fire(new e.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`))):(this._order.splice(r,0,t),this.rasterSourceCache.addOrMoveLayer(),this.proxySourceCache.updateLayer(),this._layerOrderChanged=!0);}upwardMoveLayer(t,i){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===i)return;const s=this._order.indexOf(t);this._order.splice(s,1);const r=i?this._order.indexOf(i):this._order.length;i&&-1===r?this.fire(new e.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`))):(this._order.splice(r+1,0,t),this.rasterSourceCache.addOrMoveLayer(),this.proxySourceCache.updateLayer(),this._layerOrderChanged=!0);}removeLayer(t){this._checkLoaded();const i=this._layers[t];if(!i)return void this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));this.classificationLayer.length>0&&(this.classificationLayer=this.classificationLayer.filter((e=>e!=t))),i.setEventedParent(null);const s=this._order.indexOf(t);this._order.splice(s,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=i,delete this._layers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],"raster"===i.type?(this.rasterSourceCache.removeLayer(i.id),i.onRemove&&i.onRemove(this.map),this.proxySourceCache.enabled&&this.proxySourceCache.updateLayer()):"background"===i.type?i.getPaintProperty("background-terrain-analysis")&&(this.terrainAnalysis=null,this.rasterSourceCache.removeTerrainAnalysisLayer()):!this.sourceCaches[i.source]?.adaptTerrain||"line"!==i.type&&"sprite"!==i.type&&"fill"!==i.type&&"heatmap"!==i.type||this.proxySourceCache.updateLayer();}getLayer(e){return this._layers[e]}setLayerZoomRange(t,i,s){this._checkLoaded();const r=this.getLayer(t);r?r.minzoom===i&&r.maxzoom===s||(null!=i&&(r.minzoom=i),null!=s&&(r.maxzoom=s),this._updateLayer(r)):this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)));}setSourceFilter(e,t){const i=this.getSource(e);i&&(i.setFilter(t),this._reloadSource(e));}setFilter(t,i){this._checkLoaded();const r=this.getLayer(t);if(r){if(!s(r.filter,i))return null==i?(r.filter=void 0,void this._updateLayer(r)):void(this._validate(e.validateStyle.filter,`layers.${r.id}.filter`,i)||(r.filter=e.clone(i),this._updateLayer(r)))}else this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be filtered.`)));}getFilter(t){return e.clone(this.getLayer(t).filter)}setLayoutProperty(t,i,r){this._checkLoaded();const n=this.getLayer(t);n?s(n.getLayoutProperty(i),r)||(n.setLayoutProperty(i,r),this._updateLayer(n),!this.sourceCaches[n.source]?.adaptTerrain||"line"!==n.type&&"sprite"!==n.type&&"fill"!==n.type&&"heatmap"!==n.type||this.proxySourceCache.updateLayer()):this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)));}getLayoutProperty(t,i){const s=this.getLayer(t);if(s)return s.getLayoutProperty(i);this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)));}setPaintProperty(t,i,r){this._checkLoaded();const n=this.getLayer(t);n?s(n.getPaintProperty(i),r)||(n.setPaintProperty(i,r)&&this._updateLayer(n),this._changed=!0,this._updatedPaintProps[t]=!0,!this.sourceCaches[n.source]?.adaptTerrain||"line"!==n.type&&"sprite"!==n.type&&"fill"!==n.type&&"heatmap"!==n.type||this.proxySourceCache.updateLayer(),"background"===n.type&&"background-terrain-analysis"===i&&(this.terrainAnalysis=n.getPaintProperty("background-terrain-analysis"),this.rasterSourceCache.addTerrainAnalysisLayer())):this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)));}getPaintProperty(e,t){return this.getLayer(e).getPaintProperty(t)}setFeatureState(t,i){this._checkLoaded();const s=t.source,r=t.sourceLayer,n=this.getSource(s);if(void 0===n)return void this.fire(new e.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)));const o=n.type;"geojson"===o&&r?this.fire(new e.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==o||r?(void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided."))),this.sourceCaches[s].setFeatureState(r,t.id,i)):this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));}removeFeatureState(t,i){this._checkLoaded();const s=t.source,r=this.getSource(s);if(void 0===r)return void this.fire(new e.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)));const n=r.type,o="vector"===n?t.sourceLayer:void 0;"vector"!==n||o?i&&"string"!=typeof t.id&&"number"!=typeof t.id?this.fire(new e.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):this.sourceCaches[s].removeFeatureState(o,t.id,i):this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));}getFeatureState(t){this._checkLoaded();const i=t.source,s=t.sourceLayer,r=this.getSource(i);if(void 0!==r){if("vector"!==r.type||s)return void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided."))),this.sourceCaches[i].getFeatureState(s,t.id);this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));}else this.fire(new e.ErrorEvent(new Error(`The source '${i}' does not exist in the map's style.`)));}getTransition(){return e.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t=this.map.getCameraPosition();return e.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:e.combine(this.stylesheet.metadata,{enableNormal:this.map._enableNormal,resolvePass:this.map._resolvePass}),sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:e.mapObject(this.map.getAllSources(),(e=>e.serialize())),layers:this._serializeLayers(this._order),IBL:this.stylesheet.IBL,animations:e.defined(this.map.animationManager.serialize())?this.map.animationManager.serialize().contents:void 0,camera:{position:[t.x,t.y,t.z],pitch:this.map.getCameraPitch(),bearing:this.map.getCameraBearing(),roll:this.map.getCameraRoll()},projection:this.map.projection,postProcess:this.map.postProcessStages.serialize(),videoProjection:this.map.videoManager.serialize(),analysis:{cutFill:this.map.analysis.cutFillCollection.serialize(),viewDome:this.map.analysis.viewDomeCollection.serialize(),viewshed:this.map.analysis.viewshed3DCollection.serialize(),sightLine:this.map.analysis.sightlineCollection.serialize(),excavation:this.map.analysis.excavationCollection.serialize(),highlight:this.map.analysis.highlightCollection.serialize()},lights:this.map.painter.frameState.lightSerialize(),sceneComponent:{sceneModels:this.modelCollection.serialize(),sceneTilesets:this.tilesetCollection.serialize(),primitives:this.primitiveCollection.serialize(),sceneObjects:this.sceneObjectCollection.serialize(),skybox:e.defined(this.skybox)?this.skybox.serialize():void 0},terrain:this.rasterSourceCache.terrainSource.serialize(),images:this.imageManager.serialize(),particleSystem:{}},(e=>void 0!==e))}roughSerialize(){return e.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:this.sourceCaches,layers:this._serializeLayers(this._order)},(e=>void 0!==e))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&"raster"!==e.type&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._changed=!0;}_flattenRenderedFeatures(e){const t=[],i=[];for(let s=this._order.length-1;s>=0;s--){const r=this._order[s];for(const s of e){const e=s[r],n=this._layers[r].type;if(e)if("extrusion"===n||"histogram"===n||"3d-tiles"===n||"3d-model"===n||"raster"===n)for(const t of e)i.push(t);else for(const i of e)t.push(i);}}i.sort(((e,t)=>e.intersectionZ-t.intersectionZ));for(const e of i)t.push(e);return t}queryRenderedFeatures(t,i,s,r){i&&i.filter&&this._validate(e.validateStyle.filter,"queryRenderedFeatures.filter",i.filter);const n={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new e.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const e of i.layers){const t=this._layers[e];if(!t)return [];n[t.source]=!0;}}const o=[];i.availableImages=this._availableImages,this.ray=this.map.painter.getPickRay(t[0]),this.fire(new e.Event("data",{}));for(const e in this.sourceCaches){if(i.layers&&!n[e])continue;const a=this.sourceCaches[e].getSource().type;"3d-tiles"===a||"3d-model"===a||(o.push(Hl(this.sourceCaches[e],this._layers,t,i,s)),i.modelHighlight||o.push(Ul(this.sourceCaches[e],this._layers,t,i,this.symbolMatrixHelper,r)));}return this.placement&&o.push(function(e,t,i,s,r){const n={},o=r.getFeatureByGPUPick(i[0],!0,!0);if(o&&o.isSymbolData){const e=o.evaluate();-1!==s.layers.indexOf(e.layer.id)&&(n[e.layer.id]=[e]);}for(const i in n)n[i].forEach((s=>{const r=t[e[i].source].getFeatureState(s.layer["source-layer"],s.id);s.source=s.layer.source,s.layer["source-layer"]&&(s.sourceLayer=s.layer["source-layer"]),s.state=r;}));return n}(this._layers,this.sourceCaches,t,i,this.map.painter)),this._flattenRenderedFeatures(o)}querySourceFeatures(t,i){i&&i.filter&&this._validate(e.validateStyle.filter,"querySourceFeatures.filter",i.filter);const s=this.sourceCaches[t];return s?function(e,t){const i=e.getRenderableIds().map((t=>e.getTileByID(t))),s=[],r={};for(let e=0;e<i.length;e++){const n=i[e],o=n.tileID.canonical.key;r[o]||(r[o]=!0,n.querySourceFeatures(s,t));}return s}(s,i):[]}addSourceType(e,t,i){return am.getSourceType(e)?i(new Error(`A source type called "${e}" already exists.`)):(am.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},i):i(null,null))}_validate(t,i,s,r,n){return (!n||!1!==n.validate)&&sm(this,t.call(e.validateStyle,e.extend({key:i,style:this.serialize(),value:s,styleSpec:e.spec},r)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._layers)this._layers[e].setEventedParent(null),delete this._layers[e];for(const e in this.sourceCaches)this.sourceCaches[e].clearTiles(),this.sourceCaches[e].setEventedParent(null),delete this.sourceCaches[e];this.performanceManager.resourcePerformaceManager.updateSourceCaches.length>0&&(this.map.off("moveend",this._performanceManagerEvent),this.map.off("handler-moveend",this._performanceManagerEvent),this.performanceManager=null),this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(),this.proxySourceCache.setEventedParent(null),this.proxySourceCache.clearTiles(),delete this.proxySourceCache,this.rasterSourceCache.setEventedParent(null),this.rasterSourceCache.clearTiles(),delete this.rasterSourceCache,this.debugBoundingBoxPrimitiveCollection.removeAll(!0),this.imageManager.destroy(),this.lineAtlas.destroy(),this.primitiveCollection.destroy(),this.primitivePreRenderCollection.destroy(),this.sceneObjectCollection.destroy(),this.scenePointPrimitiveCollection.destroy(),this.stylesheet=void 0,this._availableImages=[],this._order=[],this.tilesetCollection.destroy(),e.defined(this.skybox)&&this.skybox.destroy();}_clearSource(e){this.sourceCaches[e].clearTiles();}_reloadSource(e){this.sourceCaches[e]&&(this.sourceCaches[e].resume(),this.sourceCaches[e].reload());}_updateSources(){this.performanceManager.stopAction();}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e);}_updatePlacement(t,i,s,r,n=!1){let o=!1,a=!1;const l={};for(const e of this._order){const t=this._layers[e];if("symbol"!==t.type&&"symtracking"!==t.type)continue;if(!l[t.source]){const e=this.sourceCaches[t.source];l[t.source]=e.getRenderableIds().map((t=>e.getTileByID(t))).sort(((e,t)=>("string"!=typeof e.tileID&&"string"!=typeof t.tileID?t.tileID.overscaledZ-e.tileID.overscaledZ:0)||("string"!=typeof e.tileID&&"string"!=typeof t.tileID&&e.tileID.isLessThan(t.tileID)?-1:1)));}const i=this.crossTileSymbolIndex.addLayer(t,l[t.source]);o=o||i;}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((n=n||this._layerOrderChanged||0===s)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.exported.now()))&&(this.pauseablePlacement=new Sh(this,t,this._order,n,i,s,r),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(this.placement,e.exported.now()),a=!0),o&&this.pauseablePlacement.placement.setStale()),a||o)for(const e of this._order){const t=this._layers[e];"symbol"!==t.type&&"symtracking"!==t.type||this.placement.updateLayerOpacities(t,l[t.source]);}return !this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.exported.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles();}getImages(e,t,i){this.imageManager.getImages(t.icons,i),this._updateTilesForChangedImages();const s=this.sourceCaches[t.source];s&&s.setDependencies(t.tileID.key,t.type,t.icons);}getGlyphs(e,t,i){this.glyphManager.getGlyphs(t.stacks,i);}getResource(t,i,s){return e.makeRequest(i,s)}clearWorkerCaches(){this.dispatcher.broadcast("clearCaches");}get skybox(){return this._skybox}get isSkyboxReady(){return this._skybox&&this._skybox.loaded()}get earthSkin(){return this._earthSkin}get isEarthSkinReady(){return this._earthSkin&&this._earthSkin.loaded()}getNearestTileZoom(){return this.symbolMatrixHelper.zoom}updateSymbolHelperMatrix(){const t=this.map.transform.activeCamera.heading,i=this.map.transform.activeCamera.pitch+.5*Math.PI,s=this.map.transform.activeCamera.roll;this.map.transform.hpr.heading=t,this.map.transform.hpr.pitch=i,this.map.transform.hpr.roll=s,this.symbolMatrixHelper.update({position:new e.Vector3(this.map.transform.activeCamera.cartographicPosition),projection:this.map.projection,screenSize:new e.Vector2(this.map.transform.width,this.map.transform.height),fov:this.map.transform.fov*e.CONSTS.TRANSFORM.DEG_TO_RAD,headingPitchRoll:new e.HeadingPitchRoll(t,i,s)});}}am.getSourceType=function(e){return Fl[e]},am.setSourceType=function(e,t){Fl[e]=t;},am.registerForPluginStateChange=e.registerForPluginStateChange;class lm{constructor(e){this.context=e,this.default=null,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){this.current===e&&!0!==this.dirty||(this.context.gl.useProgram(e),this.current=e,this.dirty=!1);}}class hm{constructor(t){this.context=t,this.default=e.CONSTS.GL_CONST.MODEL_TEXTURE_UNIT1.VALUE,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){this.current===e&&!0!==this.dirty||(this.context.gl.activeTexture(e),this.current=e,this.dirty=!1);}}class _m{constructor(e){this.context=e,this.default=null,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(t){this.current===t&&!0!==this.dirty||(this.context.gl.bindFramebuffer(e.WebGLConstants.FRAMEBUFFER,t),this.current=t,this.dirty=!1);}}class cm{constructor(e){this.context=e,this.default=null,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(t){this.current===t&&!0!==this.dirty||(this.context.gl.bindRenderbuffer(e.WebGLConstants.RENDERBUFFER,t),this.current=t,this.dirty=!1);}}class dm{constructor(e){this.context=e,this.default=null,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(t){this.current===t&&!0!==this.dirty||(this.context.gl.bindTexture(e.WebGLConstants.TEXTURE_2D,t),this.current=t,this.dirty=!1);}}class um{constructor(e){this.context=e,this.default=null,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(t){this.current===t&&!0!==this.dirty||(this.context.gl.bindBuffer(e.WebGLConstants.ARRAY_BUFFER,t),this.current=t,this.dirty=!1);}}class mm{constructor(e){this.context=e,this.default=null,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(t){this.context.gl.bindBuffer(e.WebGLConstants.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1;}}class pm{constructor(e){this.context=e,this.default=null,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){(this.current!==e&&this.context.extVertexArrayObject||!0===this.dirty)&&(this.context.extVertexArrayObject.bindVertexArrayOES(e),this.current=e,this.dirty=!1);}}class fm{constructor(e){this.context=e,this.default=4,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(t){this.current===t&&!0!==this.dirty||(this.context.gl.pixelStorei(e.WebGLConstants.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1);}}class gm{constructor(e){this.context=e,this.default=!1,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(t){this.current===t&&!0!==this.dirty||(this.context.gl.pixelStorei(e.WebGLConstants.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1);}}class ym{constructor(e){this.context=e,this.default=!1,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(t){this.current===t&&!0!==this.dirty||(this.context.gl.pixelStorei(e.WebGLConstants.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1);}}class Tm{constructor(e){this.context=e,this.default={red:!0,green:!0,blue:!0,alpha:!0},this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.current;e.red===t.red&&e.green===t.green&&e.blue===t.blue&&e.alpha===t.alpha&&!0!==this.dirty||(this.context.gl.colorMask(e.red,e.green,e.blue,e.alpha),this.current=e,this.dirty=!1);}}class Cm{constructor(e){this.context=e,this.default=255,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){this.current===e&&!0!==this.dirty||(this.context.gl.stencilMask(e),this.current=e,this.dirty=!1);}}class xm{constructor(e){this.context=e,this.default=!0,this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){this.current===e&&!0!==this.dirty||(this.context.gl.depthMask(e),this.current=e,this.dirty=!1);}}class bm{constructor(e){this.context=e,this.default={near:0,far:1},this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.current;e.near===t.near&&e.far===t.far&&!0!==this.dirty||(this.context.gl.depthRange(e.near,e.far),this.current=e,this.dirty=!1);}}class vm{constructor(t){this.context=t,this.default={enabled:!1,face:e.WebGLConstants.BACK},this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){if(this.current.enabled!==e.enabled||this.current.face!==e.face||!0===this.dirty){const t=this.context.gl;Im(t,t.CULL_FACE,e.enabled),e.enabled&&t.cullFace(e.face),this.current=e,this.dirty=!1;}}}class wm{constructor(e){this.context=e,this.current=this.context.gl.CCW,this.default=this.context.gl.CCW,this.dirty=!1;}set(e){e!==this.current&&(this.context.gl.frontFace(e),this.current=e);}get(){return this.current||this.context.gl.CCW}setDefault(){this.set(this.default);}}class Sm{constructor(e){this.context=e;const t=this.context.gl;this.default={x:0,y:0,width:t.drawingBufferWidth,height:t.drawingBufferHeight},this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.current;e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height&&!0!==this.dirty||(this.context.gl.viewport(e.x,e.y,e.width,e.height),this.dirty=!1),this.current=e;}}class Am{constructor(e){this.context=e;const t=this.context.gl;this.default={x:0,y:0,width:t.drawingBufferWidth,height:t.drawingBufferHeight},this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.current,i=this.context.gl;e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height&&!0!==this.dirty||(Im(i,i.SCISSOR_TEST,e.enabled),e.enabled&&i.scissor(e.rectangle.x,e.rectangle.y,e.rectangle.width,e.rectangle.height),this.current=e);}}class Em{constructor(t){this.context=t,this.default={enabled:!1,color:{red:0,green:0,blue:0,alpha:0},equationRgb:e.WebGLConstants.FUNC_ADD,equationAlpha:e.WebGLConstants.FUNC_ADD,functionSourceRgb:e.WebGLConstants.ONE,functionSourceAlpha:e.WebGLConstants.ONE,functionDestinationRgb:e.WebGLConstants.ZERO,functionDestinationAlpha:e.WebGLConstants.ZERO},this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.current,i=this.context.gl;e.enabled==t.enabled&&e.equationRgb==t.equationRgb&&e.equationAlpha==t.equationAlpha&&e.functionSourceRgb==t.functionSourceRgb&&e.functionSourceAlpha==t.functionSourceAlpha&&e.functionDestinationRgb==t.functionDestinationRgb&&e.functionDestinationAlpha==t.functionDestinationAlpha&&e.color.red==t.color.red&&e.color.green==t.color.green&&e.color.blue==t.color.blue&&e.color.alpha==t.color.alpha&&!0!==this.dirty||(Im(i,i.BLEND,e.enabled),e.enabled&&(i.blendColor(e.color.red,e.color.green,e.color.blue,e.color.alpha),i.blendEquationSeparate(e.equationRgb,e.equationAlpha),i.blendFuncSeparate(e.functionSourceRgb,e.functionDestinationRgb,e.functionSourceAlpha,e.functionDestinationAlpha)),this.current=e);}}class Mm{constructor(t){this.context=t,this.default={enabled:!1,frontFunction:e.WebGLConstants.ALWAYS,backFunction:e.WebGLConstants.ALWAYS,reference:0,mask:-1,frontOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.KEEP},backOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.KEEP}},this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.current,i=this.context.gl;if(e.enabled!==t.enabled||e.frontOperation.fail!==t.frontOperation.fail||e.frontOperation.zFail!==t.frontOperation.zFail||e.frontOperation.zPass!==t.frontOperation.zPass||e.backOperation.fail!==t.backOperation.fail||e.backOperation.zFail!==t.backOperation.zFail||e.backOperation.zPass!==t.backOperation.zPass||e.frontFunction!==t.frontFunction||e.backFunction!==t.backFunction||e.reference!==t.reference||e.mask!==t.mask||!0===this.dirty){if(Im(i,i.STENCIL_TEST,e.enabled),e.enabled){const t=e.frontFunction,s=e.backFunction,r=e.reference,n=e.mask;i.stencilFunc(t,r,n),i.stencilFuncSeparate(i.BACK,s,r,n),i.stencilFuncSeparate(i.FRONT,t,r,n);const o=e.frontOperation;i.stencilOpSeparate(i.FRONT,o.fail,o.zFail,o.zPass);const a=e.backOperation;i.stencilOpSeparate(i.BACK,a.fail,a.zFail,a.zPass);}this.current=e;}}}class Pm{constructor(t){this.context=t,this.default={enabled:!1,func:e.WebGLConstants.LESS},this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.current,i=this.context.gl;e.enabled===t.enabled&&e.func===t.func&&!0!==this.dirty||(Im(i,i.DEPTH_TEST,e.enabled),e.enabled&&i.depthFunc(e.func),this.current=e);}}class Rm{constructor(e){this.context=e,this.default={enabled:!1,factor:0,units:0},this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.current,i=this.context.gl;e.enabled===t.enabled&&e.factor===t.factor&&e.units===t.units&&!0!==this.dirty||(Im(i,i.POLYGON_OFFSET_FILL,e.enabled),e.enabled&&i.polygonOffset(e.factor,e.units),this.current=e);}}class Bm{constructor(e){this.context=e,this.default={enabled:!1,value:1,invert:!1},this.current=this.default,this.dirty=!1;}get(){return this.current}setDefault(){this.set(this.default);}set(e){const t=this.current,i=this.context.gl;e.enabled===t.enabled&&e.invert===t.invert&&e.value===t.value&&!0!==this.dirty||(Im(this.context,i.SAMPLE_COVERAGE,e.enabled),e.enabled&&i.sampleCoverage(e.value,e.invert),this.current=e);}}function Im(e,t,i){i?e.enable(t):e.disable(t);}class Dm{constructor(t,i){this.painter=i,this.gl=t,this._logDepth=!1,this.program=new lm(this),this.activeTexture=new hm(this),this.bindFramebuffer=new _m(this),this.bindRenderbuffer=new cm(this),this.bindTexture=new dm(this),this.bindVertexBuffer=new um(this),this.bindElementBuffer=new mm(this),this.bindVertexArrayOES=new pm(this),this.pixelStoreUnpack=new fm(this),this.pixelStoreUnpackPremultiplyAlpha=new gm(this),this.pixelStoreUnpackFlipY=new ym(this),this._pickObjects={},this._nextPickColor=new Uint32Array(1),this.supportPBR=!0,e.ContextLimits._maximumCombinedTextureImageUnits=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),e.ContextLimits._maximumCubeMapSize=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),e.ContextLimits._maximumFragmentUniformVectors=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),e.ContextLimits._maximumTextureImageUnits=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),e.ContextLimits._maximumRenderbufferSize=t.getParameter(t.MAX_RENDERBUFFER_SIZE),e.ContextLimits._maximumTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),e.ContextLimits._maximumVaryingVectors=t.getParameter(t.MAX_VARYING_VECTORS),e.ContextLimits._maximumVertexAttributes=t.getParameter(t.MAX_VERTEX_ATTRIBS),e.ContextLimits._maximumVertexTextureImageUnits=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),e.ContextLimits._maximumVertexUniformVectors=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS);const s=t.getParameter(t.ALIASED_LINE_WIDTH_RANGE);e.ContextLimits._minimumAliasedLineWidth=s[0],e.ContextLimits._maximumAliasedLineWidth=s[1];const r=t.getParameter(t.ALIASED_POINT_SIZE_RANGE);e.ContextLimits._minimumAliasedPointSize=r[0],e.ContextLimits._maximumAliasedPointSize=r[1];const n=t.getParameter(t.MAX_VIEWPORT_DIMS);e.ContextLimits._maximumViewportWidth=n[0],e.ContextLimits._maximumViewportHeight=n[1];const o=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);e.ContextLimits._highpFloatSupported=0!==o.precision;const a=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_INT);e.ContextLimits._highpIntSupported=0!==a.rangeMax,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic?(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT),e.ContextLimits._maximumTextureFilterAnisotropy=this.extTextureFilterAnisotropicMax):e.ContextLimits._maximumTextureFilterAnisotropy=1,this.drawBuffers=Lm(t,["WEBGL_draw_buffers"]),e.ContextLimits._maximumDrawBuffers=this.drawBuffers?t.getParameter(e.WebGLConstants.MAX_DRAW_BUFFERS):1,e.ContextLimits._maximumColorAttachments=this.drawBuffers?t.getParameter(e.WebGLConstants.MAX_COLOR_ATTACHMENTS):1,this.extDebugShaders=Lm(t,["WEBGL_debug_shaders"]),this.extTextureFloat=!!Lm(t,["OES_texture_float"]),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&t.getExtension("OES_texture_half_float_linear"),this.extTextureFloatLinear=!!Lm(t,["OES_texture_float_linear"]),this.extColorBufferFloat=!!Lm(t,["EXT_color_buffer_float","WEBGL_color_buffer_float"]),this.extFloatBlend=!!Lm(t,["EXT_float_blend"]),this.extColorBufferHalfFloat=!!Lm(t,["EXT_color_buffer_half_float"]),this.hasDerivativesExt=t.getExtension("OES_standard_derivatives"),null==this.hasDerivativesExt&&(this.supportPBR=!1,e.warnOnce("OES_standard_Derivatives are not supported")),this.drawInstance=t.getExtension("ANGLE_instanced_arrays"),null==this.drawInstance&&e.warnOnce("ANGLE_instanced_arraysd"),null==t.getExtension("EXT_SRGB")&&(this.supportPBR=!1,e.warnOnce("EXT_SRGB are not supported")),this.hasLODExtension=t.getExtension("EXT_shader_texture_lod"),null==this.hasLODExtension&&(this.supportPBR=!1,e.warnOnce("EXT_shader_texture_lod are not supported")),this.extDepthTexture=!!Lm(t,["WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]),this.extBlendMinmax=!!Lm(t,["EXT_blend_minmax"]),this.extElementIndexUint||t.getExtension("OES_element_index_uint");const l=t.getSupportedExtensions();for(let e=0;e<l.length;e++)"EXT_frag_depth"===l[e]&&(this.extFragDepth=t.getExtension("EXT_frag_depth"));this.maxTextureSize=t.getParameter(e.WebGLConstants.MAX_TEXTURE_SIZE),this._s3tc=!!Lm(t,["WEBGL_compressed_texture_s3tc","MOZ_WEBGL_compressed_texture_s3tc","WEBKIT_WEBGL_compressed_texture_s3tc"]),this._pvrtc=!!Lm(t,["WEBGL_compressed_texture_pvrtc","WEBKIT_WEBGL_compressed_texture_pvrtc"]),this._etc1=!!Lm(t,["WEBGL_compressed_texture_etc1"]),this._astc=!!Lm(t,["WEBGL_compressed_texture_astc"]),this._etc=!!Lm(t,["WEBG_compressed_texture_etc"]),this._bc7=!!Lm(t,["EXT_texture_compression_bptc"]),this._colorMask=new Tm(this),this._stencilMask=new Cm(this),this._depthMask=new xm(this),this._depthRange=new bm(this),this._cullFace=new vm(this),this._frontFace=new wm(this),this.viewport=new Sm(this),this._viewport=this.viewport,this._scissorTest=new Am(this),this._blending=new Em(this),this._stencilTest=new Mm(this),this._depthTest=new Pm(this),this._polygonOffset=new Rm(this),this._sampleCoverage=new Bm(this),this._defaultTexture=void 0,this._maxFrameTextureUnitIndex=0,this._clearDepth=1,this._enableNormal=!1;}get defaultTexture(){return this._defaultTexture||(this._defaultTexture=new e.Texture({context:this,source:{width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])},flipY:!1})),this._defaultTexture}get drawingBufferHeight(){return this.gl.drawingBufferHeight}get floatingPointTexture(){return this.extTextureFloat}get drawingBufferWidth(){return this.gl.drawingBufferWidth}setDirty(){this.program.dirty=!0,this.activeTexture.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0;}createIndexBuffer(e,t){return new na(this,e,t)}createVertexBuffer(t,i,s){return new e.VertexBuffer({context:this,array:t,attributes:i,dynamicDraw:s})}createRenderbuffer(t,i,s){const r=this.gl,n=r.createRenderbuffer();return this.bindRenderbuffer.set(n),r.renderbufferStorage(e.WebGLConstants.RENDERBUFFER,t,i,s),this.bindRenderbuffer.set(null),n}createFramebuffer(t,i){return new Od({context:this,width:t,height:i,colorTextures:[new e.Texture({image:null,context:this,width:t,height:i,pixelFormat:e.WebGLConstants.RGBA})],depthStencilTexture:new e.Texture({context:this,width:t,height:i,pixelFormat:e.PixelFormat.DEPTH_STENCIL,pixelDatatype:e.PixelDatatype.UNSIGNED_INT_24_8,sampler:e.Sampler.NEAREST})})}draw(t){const{painter:i,layer:s,framebuffer:r,clearStates:n,frameState:o,material:{renderState:a,_uniforms:l,_shaderSource:h,_programConfiguration:_},geometry:{primitiveType:c,_vertexBuffer:d,_indexBuffer:u,_segmentVector:m,dynamicLayoutBuffer1:p,dynamicLayoutBuffer2:f,dynamicLayoutBuffer3:g,animationVertexBuffers:y,instanceVerterBuffers:T}}=t,C=i.useProgram(h,_);if(this.bindFramebuffer.set(r),this.setRenderState(a,n,i),_&&_.setUniforms(this,C.binderUniforms,s.paint,{zoom:i.style.getNearestTileZoom()}),C._setUniforms(e.defined(t.material.getMinimumUniforms)?t.material.getMinimumUniforms(o):l),!e.defined(d)||!e.defined(d.context))return;let x,b=c,v=u;if(e.defined(s.drawMode))b=s.drawMode,v=t.geometry.wireframeIndexBuffer,x=3;else if(Array.isArray(s))for(let i=0;i<s.length;i++)if(e.defined(s[i].drawMode)){b=s[i].drawMode,v=t.geometry.wireframeIndexBuffer,x=3;break}C.draw({context:this,drawMode:b,layerID:s.id,layoutVertexBuffer:d,indexBuffer:v,segments:m,configuration:_,dynamicLayoutBuffer:p,dynamicLayoutBuffer2:f,dynamicLayoutBuffer3:g,animationVertexBuffers:y,instanceVerterBuffers:T,numScaleForWireframe:x});}clear({color:t,depth:i,stencil:s}){const r=this.gl;let n=0;t&&(n|=e.WebGLConstants.COLOR_BUFFER_BIT,r.clearColor(t.r,t.g,t.b,t.a)),e.defined(i)&&(i!==this._clearDepth&&(this._clearDepth=i,r.clearDepth(i)),n|=e.WebGLConstants.DEPTH_BUFFER_BIT),void 0!==s&&(n|=e.WebGLConstants.STENCIL_BUFFER_BIT,r.clearStencil(s)),r.clear(n);}setRenderState(t,i,s){t=t instanceof e.RenderState?t:e.RenderState.fromCache(t),e.RenderState.applyRenderState(this,t,s),e.defined(i)&&this.clear({color:i.color,depth:i.depth,stencil:i.stencil});}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null);}createPickId(t){++this._nextPickColor[0];const i=this._nextPickColor[0];if(0===i)throw new Error("Out of unique Pick IDs.");return this._pickObjects[i]=t,new Om(this._pickObjects,i,e.Color.fromRgba(i))}removePickId(e){e.destroy();}getObjectByPickColor(e){return this._pickObjects[e.toRgba()]}}class Om{constructor(e,t,i){this._pickObject=e,this.key=t,this.color=i;}get pickObject(){return this._pickObject[this.key]}set pickObject(e){this._pickObject[this.key]=e;}destroy(){this._pickObject[this.key]=void 0,this._pickObject=void 0,this.color=void 0,this.key=void 0;}}function Lm(e,t){const i=t.length;for(let s=0;s<i;++s){const i=e.getExtension(t[s]);if(i)return i}}const{HTMLImageElement:Vm,HTMLCanvasElement:Nm,HTMLVideoElement:Fm,ImageData:Gm}=e.window,km=/uniform\s+sampler2D\s+depthTexture/g;class Um{constructor(t){const i=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).vertexShader||e.shaders.screen.vertexSource,s=t.fragmentShader,r=e.defaultValue(t.textureScale,1),n=e.defaultValue(t.pixelFormat,e.PixelFormat.RGBA);if(i.constructor!==String)throw new Error("options.vertexShader must be string!");if(s.constructor!==String)throw new Error("options.fragmentShader must be string!");if(r<=0)throw new Error("options.textureScale must be greater than 0!");if(r>1)throw new Error("options.textureScale must be less than 1!");if(!e.PixelFormat.isColorFormat(n))throw new Error("options.pixelFormat must be a color format.");this.extraData={},this._vertexShader=i,this._fragmentShader=s,this._uniforms=t.uniforms,this._textureScale=r,this._forcePowerOfTwo=e.defaultValue(t.forcePowerOfTwo,!1),this._sampleMode=e.defaultValue(t.sampleMode,0),this._pixelFormat=n,this._pixelDatatype=e.defaultValue(t.pixelDatatype,e.PixelDatatype.UNSIGNED_BYTE),this._clearColor=e.defaultValue(t.clearColor,e.Color.black),this._command=void 0,this.shaderSource=new e.ShaderSource({type:t.name,vertexSource:this._vertexShader,fragmentSource:this._fragmentShader}),this._colorTexture=void 0,this._depthTexture=void 0,this._idTexture=void 0,this._actualUniforms={},this._dirtyUniforms=[],this._texturesToRelease=[],this._texturesToCreate=[],this._texturePromise=void 0;const o={};o.scissorTest={enabled:!0,rectangle:e.defined(t.scissorRectangle)?e.BoundingRectangle.clone(t.scissorRectangle):new e.BoundingRectangle},this._passState=o,this._renderState={blending:e.renderStateEnum.disableBlending},this._ready=!1;let a=t.name;e.defined(a)||(a=e.uuid()),this._name=a,this._logDepthChanged=void 0,this._useLogDepth=void 0,this._selectedIdTexture=void 0,this._selected=void 0,this._selectedShadow=void 0,this._parentSelected=void 0,this._parentSelectedShadow=void 0,this._combinedSelected=void 0,this._combinedSelectedShadow=void 0,this._selectedLength=0,this._parentSelectedLength=0,this._selectedDirty=!0,this._textureCache=void 0,this._index=void 0,this.enabled=!0,this._enabled=!0;}get uniformMap(){return this._uniformMap}get ready(){return this._ready}get name(){return this._name}get fragmentShader(){return this._fragmentShader}get uniforms(){return this._uniforms}get textureScale(){return this._textureScale}get forcePowerOfTwo(){return this._forcePowerOfTwo}get sampleMode(){return this._sampleMode}get pixelFormat(){return this._pixelFormat}get pixelDatatype(){return this._pixelDatatype}get clearColor(){return this._clearColor}get scissorRectangle(){return this._passState.scissorTest.rectangle}get outputTexture(){if(e.defined(this._textureCache)){const t=this._textureCache.getFramebuffer(this._name);if(e.defined(t))return t.getColorTexture(0)}}get selected(){return this._selected}set selected(e){this._selected=e;}get parentSelected(){return this._parentSelected}set parentSelected(e){this._parentSelected=e;}_isSupported(e){return !km.test(this._fragmentShader)||e.extDepthTexture}update(t,i){if(this.enabled===this._enabled||this.enabled||Xm(this),this._enabled=this.enabled,!this._enabled)return;if(this._logDepthChanged=i!==this._useLogDepth,this._useLogDepth=i,this._selectedDirty=function(t){let i=e.defined(t._selected)?t._selected.length:0;const s=e.defined(t._parentSelected)?t._parentSelected:0;let r=t._selected!==t._selectedShadow||i!==t._selectedLength;if(r=r||t._parentSelected!==t._parentSelectedShadow||s!==t._parentSelectedLength,t._combinedSelected=e.defined(t._selected)&&e.defined(t._parentSelected)?t._selected.concat(t._parentSelected):e.defined(t._parentSelected)?t._parentSelected:t._selected,!r&&e.defined(t._combinedSelected)){if(!e.defined(t._combinedSelectedShadow))return !0;i=t._combinedSelected.length;for(let e=0;e<i;++e)if(t._combinedSelected[e]!==t._combinedSelectedShadow[e])return !0}return r}(this),this._selectedShadow=this._selected,this._parentSelectedShadow=this._parentSelected,this._combinedSelectedShadow=this._combinedSelected,this._selectedLength=e.defined(this._selected)?this._selected.length:0,this._parentSelectedLength=e.defined(this._parentSelected)?this._parentSelected.length:0,function(t,i){if(!t._selectedDirty)return;t._selectedIdTexture=t._selectedIdTexture&&t._selectedIdTexture.destroy(),t._selectedIdTexture=void 0;const s=t._combinedSelected;if(!e.defined(s))return;let r,n,o=0;const a=s.length;for(r=0;r<a;++r)n=s[r],e.defined(n.pickIds)?o+=n.pickIds.length:e.defined(n.pickId)&&++o;if(0===a||0===o){const s=new Uint8Array(4);return s[0]=255,s[1]=255,s[2]=255,s[3]=255,void(t._selectedIdTexture=new e.Texture({context:i,pixelFormat:e.PixelFormat.RGBA,pixelDatatype:e.PixelDatatype.UNSIGNED_BYTE,source:{arrayBufferView:s,width:1,height:1},sampler:e.Sampler.NEAREST}))}let l,h=0;const _=new Uint8Array(4*o);for(r=0;r<a;++r)if(n=s[r],e.defined(n.pickIds)){const t=n.pickIds,i=t.length;for(let s=0;s<i;++s)l=t[s].color,_[h]=e.Color.floatToByte(l.red),_[h+1]=e.Color.floatToByte(l.green),_[h+2]=e.Color.floatToByte(l.blue),_[h+3]=e.Color.floatToByte(l.alpha),h+=4;}else e.defined(n.pickId)&&(l=n.pickId.color,_[h]=e.Color.floatToByte(l.red),_[h+1]=e.Color.floatToByte(l.green),_[h+2]=e.Color.floatToByte(l.blue),_[h+3]=e.Color.floatToByte(l.alpha),h+=4);t._selectedIdTexture=new e.Texture({context:i,pixelFormat:e.PixelFormat.RGBA,pixelDatatype:e.PixelDatatype.UNSIGNED_BYTE,source:{arrayBufferView:_,width:o,height:1},sampler:e.Sampler.NEAREST});}(this,t),function(t,i){if(e.defined(t._uniformMap))return;const s=new Map,r={},n=t._uniforms,o=t._actualUniforms;for(const i in n)if(n.hasOwnProperty(i)){"function"!=typeof n[i]?(s.set(i,zm(t,i)),r[i]=Hm(t,n,i)):(s.set(i,n[i]),r[i]=n[i]),o[i]=n[i];const a=s.get(i);("string"==typeof a||a instanceof e.Texture||a instanceof Vm||a instanceof Nm||a instanceof Fm)&&(s[`${i}Dimensions`]=Wm(s,i));}t._uniforms={},Object.defineProperties(t._uniforms,r),t._uniformMap=e.combineInternalMap(s,new Map([["u_ModelViewProjectionMatrix",()=>(new e.Matrix4).ortho({left:0,right:i.drawingBufferWidth,bottom:i.drawingBufferHeight,top:0,near:0,far:1})],["u_World",()=>new e.Vector2(i.drawingBufferWidth,i.drawingBufferHeight)],["u_Resolution",()=>new e.Vector2(i.painter.width,i.painter.height)],["colorTexture",()=>t._colorTexture],["colorTextureDimensions",()=>t._colorTexture.dimensions],["depthTexture",()=>t._depthTexture],["u_depthTexture",()=>t._depthTexture],["depthTextureDimensions",()=>t._depthTexture.dimensions],["idTexture",()=>t._idTexture],["czm_selectedIdTexture",()=>t._selectedIdTexture],["czm_selectedIdTextureStep",()=>1/t._selectedIdTexture.width],["u_Viewport",()=>{const t=i.viewport.current;return new e.Vector4(t.x,t.y,t.width,t.height)}],["u_FrameTime",()=>Date.now()],["u_PixelRatio",()=>e.exported.devicePixelRatio],["u_ViewportTransformation",()=>{const t=i.viewport.current,s=new e.Matrix4;return e.Matrix4.computeViewportTransformation(t,0,1,s),s}],["u_FrustumPlanes",()=>new e.Vector4(i.painter.frameState.camera.frustumCrate.frustum._offCenterFrustum.top,i.painter.frameState.camera.frustumCrate.frustum._offCenterFrustum.bottom,i.painter.frameState.camera.frustumCrate.frustum._offCenterFrustum.left,i.painter.frameState.camera.frustumCrate.frustum._offCenterFrustum.right)],["u_CurrentFrustum",()=>new e.Vector2(i.painter.transform.near,i.painter.transform.far)],["u_InverseProjection",()=>i.painter.frameState.camera.projectionMatrixInverse]]));}(this,t),function(t,i){let s,r,n;const o=t._texturesToRelease;let a=o.length;for(s=0;s<a;++s)r=o[s],r=r&&r.destroy();o.length=0;const l=t._texturesToCreate;for(a=l.length,s=0;s<a;++s){const r=l[s];n=r.name,t._actualUniforms[n]=new e.Texture({context:i,source:r.source});}l.length=0;const h=t._dirtyUniforms;if(0===h.length&&!e.defined(t._texturePromise))return void(t._ready=!0);if(0===h.length||e.defined(t._texturePromise))return;a=h.length;const _=t._uniforms,c=[];for(s=0;s<a;++s){n=h[s];const i=_[n],r=t._textureCache.getStageByName(i);e.defined(r)?t._actualUniforms[n]=jm(t,i):"string"==typeof i?c.push(new Promise(((t,s)=>{e.getImage({url:i},((e,i)=>{e&&s(e),t(i);}));}))):t._texturesToCreate.push({name:n,source:i});}h.length=0,c.length>0?(t._ready=!1,t._texturePromise=Promise.all(c).then((()=>{t._ready=!0,t._texturePromise=void 0;}))):t._ready=!0;}(this,t),function(t,i){if(e.defined(t._command)&&!t._logDepthChanged&&!t._selectedDirty)return;let s=t._fragmentShader;if(e.defined(t._selectedIdTexture)){const e=t._selectedIdTexture.width;s=s.replace(/varying\s+vec2\s+v_TexCoord;/g,""),s=`#define CZM_SELECTED_FEATURE \nuniform sampler2D idTexture; \nuniform sampler2D czm_selectedIdTexture; \nuniform float czm_selectedIdTextureStep; \nvarying vec2 v_TexCoord; \nbool czm_selected(vec2 offset) \n{ \n    bool selected = false;\n    vec4 id = texture2D(idTexture, v_TexCoord + offset); \n    for (int i = 0; i < ${e}; ++i) \n    { \n        vec4 selectedId = texture2D(czm_selectedIdTexture, vec2((float(i) + 0.5) * czm_selectedIdTextureStep, 0.5)); \n        if (all(equal(id, selectedId))) \n        { \n            return true; \n        } \n    } \n    return false; \n} \n\nbool czm_selected() \n{ \n    return czm_selected(vec2(0.0)); \n} \n\n${s}`;}t.shaderSource.fragmentSource=e.reduceComma(s),-1!==t.shaderSource.fragmentSource.indexOf("#include")&&console.error("检查着色器文件，里面的#include <>没有被正确替换。请将其前面和后面输入换行符\r\n或者\n，因为它没有被当成一行可以替换的代码。"),t._command={painter:i.painter,framebuffer:void 0,layer:{id:"postprocess"},geometry:new vu(i.painter),material:{renderState:t._renderState,_uniforms:t._uniformMap,_shaderSource:t.shaderSource}};}(this,t),function(t){let i,s;1===t._sampleMode?(i=e.TextureMinificationFilter.LINEAR,s=e.TextureMagnificationFilter.LINEAR):(i=e.TextureMinificationFilter.NEAREST,s=e.TextureMagnificationFilter.NEAREST);const r=t._sampler;e.defined(r)&&r.minificationFilter===i&&r.magnificationFilter===s||(t._sampler=new e.Sampler({wrapS:e.TextureWrap.CLAMP_TO_EDGE,wrapT:e.TextureWrap.CLAMP_TO_EDGE,minificationFilter:i,magnificationFilter:s}));}(this),this._selectedDirty=!1,!this._ready)return;const s=this._textureCache.getFramebuffer(this._name);if(this._command.framebuffer=s.framebuffer,!e.defined(s))return;const r=s.getColorTexture(0);let n;const[o,a]=r.size;o===t.drawingBufferWidth&&a===t.drawingBufferHeight||(n=this._renderState,e.defined(n)&&o===n.viewport.width&&a===n.viewport.height||(this._renderState=e.RenderState.fromCache({viewport:new e.BoundingRectangle(0,0,o,a)}))),this._command.material.renderState=n;}execute(t,i,s,r){if(!e.defined(this._command)||!this._ready||!this._enabled)return;this._colorTexture=i,this._depthTexture=s,this._idTexture=r,e.Sampler.equals(this._colorTexture.sampler,this._sampler)||(this._colorTexture.sampler=this._sampler,this._depthTexture.sampler=this._sampler);const n=this.scissorRectangle.width>0&&this.scissorRectangle.height>0?this._passState:void 0;e.defined(n)&&e.RenderState.applyRenderState(t,n),t.draw(this._command);}isDestroyed(){return !1}destroy(){return Xm(this),e.destroyObject(this)}}function Hm(t,i,s){const r=i[s];return ("string"==typeof r||r instanceof Nm||r instanceof Vm||r instanceof Fm||r instanceof Gm)&&t._dirtyUniforms.push(s),{get:()=>i[s],set(r){const n=i[s];i[s]=r;const o=t._actualUniforms,a=o[s];e.defined(a)&&a!==n&&a instanceof e.Texture&&!e.defined(t._textureCache.getStageByName(s))&&(t._texturesToRelease.push(a),delete o[s],delete o[`${s}Dimensions`]),n instanceof e.Texture&&t._texturesToRelease.push(n),"string"==typeof r||r instanceof Nm||r instanceof Vm||r instanceof Fm||r instanceof Gm?t._dirtyUniforms.push(s):o[s]=r;}}}function zm(e,t){return function(){const i=e._actualUniforms[t];return "function"==typeof i?i():i}}function Wm(t,i){return function(){const s=t[i]();if(e.defined(s))return s.dimensions}}function jm(e,t){return function(){return e._textureCache.getOutputTexture(t)}}function Xm(t){e.defined(t._command)&&(t._command=void 0),t._selectedIdTexture=t._selectedIdTexture&&t._selectedIdTexture.destroy();const i=t._textureCache;if(!e.defined(i))return;const s=t._uniforms,r=t._actualUniforms;for(const n in r)r.hasOwnProperty(n)&&r[n]instanceof e.Texture&&(e.defined(i.getStageByName(s[n]))||r[n].destroy(),t._dirtyUniforms.push(n));}class qm{constructor(t){if(!t.stages)throw new Error("options.stages must be defined!");if(t.stages.length<=0)throw new Error("options.stages length must greater than 0!");this._stages=t.stages,this._inputPreviousStageTexture=e.defaultValue(t.inputPreviousStageTexture,!0);let i=t.name;e.defined(i)||(i=e.uuid()),this._name=i,this._uniforms=t.uniforms,this._textureCache=void 0,this._index=void 0,this._selected=void 0,this._selectedShadow=void 0,this._parentSelected=void 0,this._parentSelectedShadow=void 0,this._combinedSelected=void 0,this._combinedSelectedShadow=void 0,this._selectedLength=0,this._parentSelectedLength=0,this._selectedDirty=!0;}get ready(){const e=this._stages,t=e.length;for(let i=0;i<t;++i)if(!e[i].ready)return !1;return !0}get name(){return this._name}get enabled(){return this._stages[0].enabled}set enabled(e){const t=this._stages,i=t.length;for(let s=0;s<i;++s)t[s].enabled=e;}get uniforms(){return this._uniforms}get inputPreviousStageTexture(){return this._inputPreviousStageTexture}get length(){return this._stages.length}get selected(){return this._selected}set selected(e){this._selected=e;}get parentSelected(){return this._parentSelected}set parentSelected(e){this._parentSelected=e;}_isSupported(e){const t=this._stages,i=t.length;for(let s=0;s<i;++s)if(!t[s]._isSupported(e))return !1;return !0}get(e){if(e<0)throw new Error("index must be greater than 0!");if(e>=this.length)throw new Error("index must be less than stages length!");return this._stages[e]}update(t,i){this._selectedDirty=function(t){let i=e.defined(t._selected)?t._selected.length:0;const s=e.defined(t._parentSelected)?t._parentSelected:0;let r=t._selected!==t._selectedShadow||i!==t._selectedLength;if(r=r||t._parentSelected!==t._parentSelectedShadow||s!==t._parentSelectedLength,t._combinedSelected=e.defined(t._selected)&&e.defined(t._parentSelected)?t._selected.concat(t._parentSelected):e.defined(t._parentSelected)?t._parentSelected:t._selected,!r&&e.defined(t._combinedSelected)){if(!e.defined(t._combinedSelectedShadow))return !0;i=t._combinedSelected.length;for(let e=0;e<i;++e)if(t._combinedSelected[e]!==t._combinedSelectedShadow[e])return !0}return r}(this),this._selectedShadow=this._selected,this._parentSelectedShadow=this._parentSelected,this._combinedSelectedShadow=this._combinedSelected,this._selectedLength=e.defined(this._selected)?this._selected.length:0,this._parentSelectedLength=e.defined(this._parentSelected)?this._parentSelected.length:0;const s=this._stages,r=s.length;for(let e=0;e<r;++e){const r=s[e];this._selectedDirty&&(r.parentSelected=this._combinedSelected),r.update(t,i);}}destroy(){const t=this._stages,i=t.length;for(let e=0;e<i;++e)t[e].destroy();return e.destroyObject(this)}}class Km{constructor(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this.color=t.color,this.depth=t.depth,this.stencil=t.stencil,this.renderState=t.renderState,this.framebuffer=t.framebuffer,this.owner=t.owner;}static ALL=Object.freeze(new Km({color:new e.Color(0,0,0,0),depth:1,stencil:0}));execute(e){const t=e.bindFramebuffer.get();e.bindFramebuffer.set(this.framebuffer.framebuffer),e.clear(this),e.bindFramebuffer.set(t);}}class Jm{constructor(t){const i=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).context,s=t.height;this._width=t.width,this._height=s;const r=t.colorRenderbuffers,n=t.colorTextures;if(e.defined(r)!==e.defined(n))throw new Error("Both color renderbuffer and texture attachments must be provided.");const o=t.depthStencilRenderbuffer,a=t.depthStencilTexture;if(e.defined(o)!==e.defined(a))throw new Error("Both depth-stencil renderbuffer and texture attachments must be provided.");this._renderFramebuffer=new Od({context:i,colorRenderbuffers:r,depthStencilRenderbuffer:o,destroyAttachments:t.destroyAttachments}),this._colorFramebuffer=new Od({context:i,colorTextures:n,depthStencilTexture:a,destroyAttachments:t.destroyAttachments});}getRenderFramebuffer(){return this._renderFramebuffer}getColorFramebuffer(){return this._colorFramebuffer}blitFramebuffers(t,i){this._renderFramebuffer.bindRead(),this._colorFramebuffer.bindDraw();const s=t.gl;let r=0;this._colorFramebuffer._colorTextures.length>0&&(r|=e.WebGLConstants.COLOR_BUFFER_BIT),e.defined(this._colorFramebuffer.depthStencilTexture)&&(r|=e.WebGLConstants.DEPTH_BUFFER_BIT|(i?e.WebGLConstants.STENCIL_BUFFER_BIT:0)),s.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,r,e.WebGLConstants.NEAREST),s.bindFramebuffer(e.WebGLConstants.READ_FRAMEBUFFER,null),s.bindFramebuffer(e.WebGLConstants.DRAW_FRAMEBUFFER,null);}isDestroyed(){return !1}destroy(){return this._renderFramebuffer.destroy(),this._colorFramebuffer.destroy(),e.destroyObject(this)}}class Zm{constructor(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this._numSamples=e.defaultValue(t.numSamples,1),this._colorAttachmentsLength=e.defaultValue(t.colorAttachmentsLength,1),this._color=e.defaultValue(t.color,!0),this._depth=e.defaultValue(t.depth,!1),this._depthStencil=e.defaultValue(t.depthStencil,!1),this._supportsDepthTexture=e.defaultValue(t.supportsDepthTexture,!1),this._createColorAttachments=e.defaultValue(t.createColorAttachments,!0),this._createDepthAttachments=e.defaultValue(t.createDepthAttachments,!0),this._pixelDatatype=t.pixelDatatype,this._pixelFormat=t.pixelFormat,this._width=void 0,this._height=void 0,this._framebuffer=void 0,this._multisampleFramebuffer=void 0,this._colorTextures=void 0,this._color&&(this._colorTextures=new Array(this._colorAttachmentsLength),this._colorRenderbuffers=new Array(this._colorAttachmentsLength)),this._colorRenderbuffer=void 0,this._depthStencilRenderbuffer=void 0,this._depthStencilTexture=void 0,this._depthRenderbuffer=void 0,this._depthTexture=void 0,this._attachmentsDirty=!1;}get framebuffer(){return this._numSamples>1?this._multisampleFramebuffer.getRenderFramebuffer():this._framebuffer}get numSamples(){return this._numSamples}get status(){return this.framebuffer.status}isDirty(t,i,s,r,n){s=e.defaultValue(s,1);const o=this._width!==t||this._height!==i,a=this._numSamples!==s,l=e.defined(r)&&this._pixelDatatype!==r||e.defined(n)&&this._pixelFormat!==n,h=e.defined(1===s?this._framebuffer:this._multisampleFramebuffer);return this._attachmentsDirty||o||a||l||!h||this._color&&!e.defined(this._colorTextures[0])}update(t,i,s,r,n,o){if(r=t.msaa?e.defaultValue(r,1):1,n=e.defaultValue(n,this._color?e.defaultValue(this._pixelDatatype,e.PixelDatatype.UNSIGNED_BYTE):void 0),o=e.defaultValue(o,this._color?e.defaultValue(this._pixelFormat,e.PixelFormat.RGBA):void 0),this.isDirty(i,s,r,n,o)){if(this.destroy(),this._width=i,this._height=s,this._numSamples=r,this._pixelDatatype=n,this._pixelFormat=o,this._attachmentsDirty=!1,this._color&&this._createColorAttachments)for(let r=0;r<this._colorAttachmentsLength;++r)if(this._colorTextures[r]=new e.Texture({context:t,width:i,height:s,pixelFormat:o,pixelDatatype:n,sampler:e.Sampler.NEAREST}),this._numSamples>1){const e=Rd.getColorFormat(n);this._colorRenderbuffers[r]=new Bd({context:t,width:i,height:s,format:e,numSamples:this._numSamples});}this._depthStencil&&this._createDepthAttachments&&(this._supportsDepthTexture&&t.depthTexture?(this._depthStencilTexture=new e.Texture({context:t,width:i,height:s,pixelFormat:e.PixelFormat.DEPTH_STENCIL,pixelDatatype:e.PixelDatatype.UNSIGNED_INT_24_8,sampler:e.Sampler.NEAREST}),this._numSamples>1&&(this._depthStencilRenderbuffer=new Bd({context:t,width:i,height:s,format:Rd.DEPTH24_STENCIL8,numSamples:this._numSamples}))):this._depthStencilRenderbuffer=new Bd({context:t,width:i,height:s,format:Rd.DEPTH_STENCIL})),this._depth&&this._createDepthAttachments&&(this._supportsDepthTexture&&t.depthTexture?this._depthTexture=new e.Texture({context:t,width:i,height:s,pixelFormat:e.PixelFormat.DEPTH_COMPONENT,pixelDatatype:e.PixelDatatype.UNSIGNED_INT,sampler:e.Sampler.NEAREST}):this._depthRenderbuffer=new Bd({context:t,width:i,height:s,format:Rd.DEPTH_COMPONENT16})),this._numSamples>1?this._multisampleFramebuffer=new Jm({context:t,width:this._width,height:this._height,colorTextures:this._colorTextures,colorRenderbuffers:this._colorRenderbuffers,depthStencilTexture:this._depthStencilTexture,depthStencilRenderbuffer:this._depthStencilRenderbuffer,destroyAttachments:!1}):this._framebuffer=new Od({context:t,colorTextures:this._colorTextures,depthTexture:this._depthTexture,depthRenderbuffer:this._depthRenderbuffer,depthStencilTexture:this._depthStencilTexture,depthStencilRenderbuffer:this._depthStencilRenderbuffer,destroyAttachments:!1});}}getColorTexture(t){return t=e.defaultValue(t,0),this._colorTextures[t]}setColorTexture(t,i){i=e.defaultValue(i,0),this._attachmentsDirty=t!==this._colorTextures[i],this._colorTextures[i]=t;}getColorRenderbuffer(t){return t=e.defaultValue(t,0),this._colorRenderbuffers[t]}setColorRenderbuffer(t,i){i=e.defaultValue(i,0),this._attachmentsDirty=t!==this._colorRenderbuffers[i],this._colorRenderbuffers[i]=t;}getDepthRenderbuffer(){return this._depthRenderbuffer}setDepthRenderbuffer(e){this._attachmentsDirty=e!==this._depthRenderbuffer,this._depthRenderbuffer=e;}getDepthTexture(){return this._depthTexture}setDepthTexture(e){this._attachmentsDirty=e!==this._depthTexture,this._depthTexture=e;}getDepthStencilRenderbuffer(){return this._depthStencilRenderbuffer}setDepthStencilRenderbuffer(e){this._attachmentsDirty=e!==this._depthStencilRenderbuffer,this._depthStencilRenderbuffer=e;}getDepthStencilTexture(){return this._depthStencilTexture}setDepthStencilTexture(e){this._attachmentsDirty=e!==this._depthStencilTexture,this._depthStencilTexture=e;}prepareTextures(e,t){this._numSamples>1&&this._multisampleFramebuffer.blitFramebuffers(e,t);}clear(e,t,i){const s=t.framebuffer;t.framebuffer=this.framebuffer,e.bindFramebuffer.set(this.framebuffer.framebuffer),t.execute(e,i),t.framebuffer=s;}destroyFramebuffer(){this._framebuffer=this._framebuffer&&this._framebuffer.destroy(),this._multisampleFramebuffer=this._multisampleFramebuffer&&this._multisampleFramebuffer.destroy();}destroy(){if(this._color){let t;const i=this._colorTextures.length;for(t=0;t<i;++t){const i=this._colorTextures[t];this._createColorAttachments&&e.defined(i)&&!i.isDestroyed()&&(this._colorTextures[t].destroy(),this._colorTextures[t]=void 0),e.defined(i)&&i.isDestroyed()&&(this._colorTextures[t]=void 0);const s=this._colorRenderbuffers[t];this._createColorAttachments&&e.defined(s)&&!s.isDestroyed()&&(this._colorRenderbuffers[t].destroy(),this._colorRenderbuffers[t]=void 0),e.defined(s)&&s.isDestroyed()&&(this._colorRenderbuffers[t]=void 0);}}this._depthStencil&&(this._createDepthAttachments&&(this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy()),e.defined(this._depthStencilTexture)&&this._depthStencilTexture.isDestroyed()&&(this._depthStencilTexture=void 0),e.defined(this._depthStencilRenderbuffer)&&this._depthStencilRenderbuffer.isDestroyed()&&(this._depthStencilRenderbuffer=void 0)),this._depth&&(this._createDepthAttachments&&(this._depthTexture=this._depthTexture&&this._depthTexture.destroy(),this._depthRenderbuffer=this._depthRenderbuffer&&this._depthRenderbuffer.destroy()),e.defined(this._depthTexture)&&this._depthTexture.isDestroyed()&&(this._depthTexture=void 0),e.defined(this._depthRenderbuffer)&&this._depthRenderbuffer.isDestroyed()&&(this._depthRenderbuffer=void 0)),this.destroyFramebuffer();}}class Ym{constructor(){this._uniformMap=void 0,this._colorTexture=void 0,this._depthTexture=void 0,this._ready=!1,this._name="czm_autoexposure",this._logDepthChanged=void 0,this._useLogDepth=void 0,this._framebuffers=void 0,this._previousLuminance=new Zm,this._commands=void 0,this._clearCommand=void 0,this._minMaxLuminance=new e.Vector2,this.enabled=!0,this._enabled=!0,this.minimumLuminance=.1,this.maximumLuminance=10;}get ready(){return this._ready}get name(){return this._name}get outputTexture(){const t=this._framebuffers;if(e.defined(t))return t[t.length-1].getColorTexture(0)}update(t){const i=t.drawingBufferWidth,s=t.drawingBufferHeight;i===this._width&&s===this._height||(this._width=i,this._height=s,function(t,i){Qm(t);let s=t._width,r=t._height;const n=i.extTextureHalfFloat?e.PixelDatatype.HALF_FLOAT:e.PixelDatatype.FLOAT,o=Math.ceil(Math.log(Math.max(s,r))/Math.log(3)),a=new Array(o);for(let e=0;e<o;++e)s=Math.max(Math.ceil(s/3),1),r=Math.max(Math.ceil(r/3),1),a[e]=new Zm,a[e].update(i,s,r,1,n);const l=a[o-1].getColorTexture(0);t._previousLuminance.update(i,l.width,l.height,1,n),t._framebuffers=a;}(this,t),function(e,t){$m(e);const i=e._framebuffers,s=i.length,r=new Array(s);for(let n=0;n<s;++n)r[n]=ip(t,tp(n,s),i[n].framebuffer,ep(e,n));e._commands=r;}(this,t),this._ready||(this._ready=!0)),this._minMaxLuminance.x=this.minimumLuminance,this._minMaxLuminance.y=this.maximumLuminance;const r=this._framebuffers,n=r[r.length-1];r[r.length-1]=this._previousLuminance,this._commands[this._commands.length-1].framebuffer=this._previousLuminance.framebuffer,this._previousLuminance=n;}execute(t,i){this._colorTexture=i;const s=this._commands;if(!e.defined(s))return;const r=s.length;for(let e=0;e<r;++e)t.draw(s[e]);}isDestroyed(){return !1}destroy(){return Qm(this),$m(this),e.destroyObject(this)}clear(t){const i=this._framebuffers;if(!e.defined(i))return;let s=this._clearCommand;e.defined(s)||(s=this._clearCommand=new Km({color:new e.Color(0,0,0,0),framebuffer:void 0}));const r=i.length;for(let e=0;e<r;++e)i[e].clear(t,s);}}function Qm(t){const i=t._framebuffers;if(!e.defined(i))return;const s=i.length;for(let e=0;e<s;++e)i[e].destroy();t._framebuffers=void 0,t._previousLuminance.destroy(),t._previousLuminance=void 0;}function $m(t){const i=t._commands;if(!e.defined(i))return;const s=i.length;for(let e=0;e<s;++e)i[e].shaderProgram.destroy();t._commands=void 0;}function ep(e,t){const i=new Map;if(0===t)i.set("colorTexture",(()=>e._colorTexture)),i.set("colorTextureDimensions",(()=>e._colorTexture.dimensions));else {const s=e._framebuffers[t-1].getColorTexture(0);i.set("colorTexture",(()=>s)),i.set("colorTextureDimensions",(()=>s.dimensions));}return i.set("minMaxLuminance",(()=>e._minMaxLuminance)),i.set("previousLuminance",(()=>e._previousLuminance.getColorTexture(0))),i}function tp(e,t){let i="uniform sampler2D colorTexture; \nvarying vec2 v_TexCoord; \nfloat sampleTexture(vec2 offset) { \n";return i+=0===e?"    vec4 color = texture2D(colorTexture, v_TexCoord + offset); \n    return czm_luminance(color.rgb); \n":"    return texture2D(colorTexture, v_TexCoord + offset).r; \n",i+="}\n\n",i+="uniform vec2 colorTextureDimensions; \nuniform vec2 minMaxLuminance; \nuniform sampler2D previousLuminance; \nvoid main() { \n    float color = 0.0; \n    float xStep = 1.0 / colorTextureDimensions.x; \n    float yStep = 1.0 / colorTextureDimensions.y; \n    int count = 0; \n    for (int i = 0; i < 3; ++i) { \n        for (int j = 0; j < 3; ++j) { \n            vec2 offset; \n            offset.x = -xStep + float(i) * xStep; \n            offset.y = -yStep + float(j) * yStep; \n            if (offset.x < 0.0 || offset.x > 1.0 || offset.y < 0.0 || offset.y > 1.0) { \n                continue; \n            } \n            color += sampleTexture(offset); \n            ++count; \n        } \n    } \n    if (count > 0) { \n        color /= float(count); \n    } \n",e===t-1&&(i+="    float previous = texture2D(previousLuminance, vec2(0.5)).r; \n    color = clamp(color, minMaxLuminance.x, minMaxLuminance.y); \n    color = previous + (color - previous) / (60.0 * 1.5); \n    color = clamp(color, minMaxLuminance.x, minMaxLuminance.y); \n"),i+="    gl_FragColor = vec4(color); \n} \n",i}function ip(t,i,s,r){this._copyColorCommand={painter:t.painter,framebuffer:s,layer:{id:`postprocess-autoExposure${Date.now()}`},geometry:new vu(t.painter),material:{_uniforms:r,_shaderSource:new e.ShaderSource({vertexSource:e.shaders.screen.vertexSource,fragmentSource:i})}};}const sp="skyline",rp="mm_fog_effect";function np(t){const i=`#define USE_STEP_SIZE\n${e.shaders.GaussianBlur1D.fragmentSource}`,s=new Um({name:`${t}_x_direction`,fragmentShader:i,uniforms:{delta:1,sigma:2,stepSize:1,direction:0},sampleMode:1}),r=new Um({name:`${t}_y_direction`,fragmentShader:i,uniforms:{delta:1,sigma:2,stepSize:1,direction:1},sampleMode:1}),n={};return Object.defineProperties(n,{delta:{get:()=>s.uniforms.delta,set(e){s.uniforms.delta=r.uniforms.delta=e;}},sigma:{get:()=>s.uniforms.sigma,set(e){s.uniforms.sigma=r.uniforms.sigma=e;}},stepSize:{get:()=>s.uniforms.stepSize,set(e){s.uniforms.stepSize=r.uniforms.stepSize=e;}}}),new qm({name:t,stages:[s,r],uniforms:n})}class op{static createBlurStage(){return np("czm_blur")}static createDepthOfFieldStage(){const t=np("czm_depth_of_field_blur"),i=new Um({name:"czm_depth_of_field_composite",fragmentShader:e.shaders.DepthOfField.fragmentSource,uniforms:{focalDistance:5,blurTexture:t.name}}),s={};return Object.defineProperties(s,{focalDistance:{get:()=>i.uniforms.focalDistance,set(e){i.uniforms.focalDistance=e;}},delta:{get:()=>t.uniforms.delta,set(e){t.uniforms.delta=e;}},sigma:{get:()=>t.uniforms.sigma,set(e){t.uniforms.sigma=e;}},stepSize:{get:()=>t.uniforms.stepSize,set(e){t.uniforms.stepSize=e;}}}),new qm({name:"czm_depth_of_field",stages:[t,i],inputPreviousStageTexture:!1,uniforms:s})}static isDepthOfFieldSupported(e){return e.extDepthTexture}static createEdgeDetectionStage(t={}){const i=Date.now();return new Um({name:`czm_edge_detection_${i}`,fragmentShader:e.shaders.EdgeDetection.fragmentSource,uniforms:{length:e.defaultValue(t.length,.25),color:new e.Vector4(0,0,0,1)}})}static isEdgeDetectionSupported(e){return e.extDepthTexture}static createSilhouetteStage(t){const i=function(t){if(!e.defined(t))return op.createEdgeDetectionStage();const i=new qm({name:"czm_edge_detection_multiple",stages:t,inputPreviousStageTexture:!1}),s={};let r="",n="";for(let e=0;e<t.length;++e)r+=`uniform sampler2D edgeTexture${e}; \n`,n+=`        vec4 edge${e} = texture2D(edgeTexture${e}, v_TexCoord); \n        if (edge${e}.a > 0.0) \n        { \n            color = edge${e}; \n            break; \n        } \n`,s[`edgeTexture${e}`]=t[e].name;const o=new Um({name:"czm_edge_detection_combine",fragmentShader:`${r}varying vec2 v_TexCoord; \nvoid main() { \n    vec4 color = vec4(0.0); \n    for (int i = 0; i < ${t.length}; i++) \n    { \n${n}    } \n    gl_FragColor = color; \n} \n`,uniforms:s});return new qm({name:"czm_edge_detection_composite",stages:[i,o]})}(t),s=new Um({name:"czm_silhouette_color_edges",fragmentShader:e.shaders.Silhouette.fragmentSource,uniforms:{silhouetteTexture:i.name}});return new qm({name:"czm_silhouette",stages:[i,s],inputPreviousStageTexture:!1,uniforms:i.uniforms})}static isSilhouetteSupported(e){return e.extDepthTexture}static createBloomStage(){const t=new Um({name:"czm_bloom_contrast_bias",fragmentShader:e.shaders.ContrastBias.fragmentSource,uniforms:{contrast:128,brightness:-.3}}),i=np("czm_bloom_blur"),s=new qm({name:"czm_bloom_contrast_bias_blur",stages:[t,i]}),r=new Um({name:"czm_bloom_generate_composite",fragmentShader:e.shaders.BloomComposite.fragmentSource,uniforms:{glowOnly:!1,bloomTexture:s.name}}),n={};return Object.defineProperties(n,{glowOnly:{get:()=>r.uniforms.glowOnly,set(e){r.uniforms.glowOnly=e;}},contrast:{get:()=>t.uniforms.contrast,set(e){t.uniforms.contrast=e;}},brightness:{get:()=>t.uniforms.brightness,set(e){t.uniforms.brightness=e;}},delta:{get:()=>i.uniforms.delta,set(e){i.uniforms.delta=e;}},sigma:{get:()=>i.uniforms.sigma,set(e){i.uniforms.sigma=e;}},stepSize:{get:()=>i.uniforms.stepSize,set(e){i.uniforms.stepSize=e;}}}),new qm({name:"czm_bloom",stages:[s,r],inputPreviousStageTexture:!1,uniforms:n})}static createAmbientOcclusionStage(){const t=new Um({name:"czm_ambient_occlusion_generate",fragmentShader:e.shaders.AmbientOcclusionGenerate.fragmentSource,uniforms:{intensity:3,bias:.1,lengthCap:.26,stepSize:1.95,frustumLength:1e3,randomTexture:void 0}}),i=np("czm_ambient_occlusion_blur");i.uniforms.stepSize=.86;const s=new qm({name:"czm_ambient_occlusion_generate_blur",stages:[t,i]}),r=new Um({name:"czm_ambient_occlusion_composite",fragmentShader:e.shaders.AmbientOcclusionModulate.fragmentSource,uniforms:{ambientOcclusionOnly:!1,ambientOcclusionTexture:s.name}}),n={};return Object.defineProperties(n,{intensity:{get:()=>t.uniforms.intensity,set(e){t.uniforms.intensity=e;}},bias:{get:()=>t.uniforms.bias,set(e){t.uniforms.bias=e;}},lengthCap:{get:()=>t.uniforms.lengthCap,set(e){t.uniforms.lengthCap=e;}},stepSize:{get:()=>t.uniforms.stepSize,set(e){t.uniforms.stepSize=e;}},frustumLength:{get:()=>t.uniforms.frustumLength,set(e){t.uniforms.frustumLength=e;}},randomTexture:{get:()=>t.uniforms.randomTexture,set(e){t.uniforms.randomTexture=e;}},delta:{get:()=>i.uniforms.delta,set(e){i.uniforms.delta=e;}},sigma:{get:()=>i.uniforms.sigma,set(e){i.uniforms.sigma=e;}},blurStepSize:{get:()=>i.uniforms.stepSize,set(e){i.uniforms.stepSize=e;}},ambientOcclusionOnly:{get:()=>r.uniforms.ambientOcclusionOnly,set(e){r.uniforms.ambientOcclusionOnly=e;}}}),new qm({name:"czm_ambient_occlusion",stages:[s,r],inputPreviousStageTexture:!1,uniforms:n})}static isAmbientOcclusionSupported(e){return e.extDepthTexture}static createFXAAStage(){return new Um({name:"czm_FXAA",fragmentShader:`#define M_FXAA_QUALITY_PRESET 39 \n${e.shaders.FXAA.fragmentSource}`,sampleMode:1})}static createAcesTonemappingStage(t){let i=t?"#define AUTO_EXPOSURE\n":"";return i+=e.shaders.AcesTonemappingStage.fragmentSource,new Um({name:"czm_aces",fragmentShader:i,uniforms:{autoExposure:void 0,u_Gamma:1.53846}})}static createFilmicTonemappingStage(t){let i=t?"#define AUTO_EXPOSURE\n":"";return i+=e.shaders.FilmicTonemapping.fragmentSource,new Um({name:"czm_filmic",fragmentShader:i,uniforms:{autoExposure:void 0,u_Gamma:1.53846}})}static createReinhardTonemappingStage(t){let i=t?"#define AUTO_EXPOSURE\n":"";return i+=e.shaders.ReinhardTonemapping.fragmentSource,new Um({name:"czm_reinhard",fragmentShader:i,uniforms:{autoExposure:void 0,u_Gamma:1.53846}})}static createModifiedReinhardTonemappingStage(t){let i=t?"#define AUTO_EXPOSURE\n":"";return i+=e.shaders.ModifiedReinhardTonemapping.fragmentSource,new Um({name:"czm_modified_reinhard",fragmentShader:i,uniforms:{white:e.Color.white,autoExposure:void 0,u_Gamma:1.53846}})}static createAutoExposureStage(){return new Ym}static createBlackAndWhiteStage(){return new Um({name:"czm_black_and_white",fragmentShader:e.shaders.BlackAndWhite.fragmentSource,uniforms:{gradations:5}})}static createBrightnessStage(){return new Um({name:"czm_brightness",fragmentShader:e.shaders.Brightness.fragmentSource,uniforms:{brightness:.5}})}static createNightVisionStage(){return new Um({name:"czm_night_vision",fragmentShader:e.shaders.NightVision.fragmentSource})}static createDepthViewStage(){return new Um({name:"czm_depth_view",fragmentShader:e.shaders.DepthView.fragmentSource})}static createSkyline(t={}){const i=t.color||[.5,1,0],s=e.defined(t.width)?t.width:1,r=e.Color.parse(i);if(!r)throw new Error("color's type is not support! please use minemap.Color or minemap.Math.Vector3 or minemap.Math.Vector3 or Array<number,3>,4 or Array<number,4> or css color string instead!");(r.r>1||r.g>1||r.b>1)&&(r.r=e.Color.byteToFloat(r.r),r.g=e.Color.byteToFloat(r.g),r.b=e.Color.byteToFloat(r.b),console.warn("请检查，传入的color是否有标准，错误示范如 new minemap.Color(255,0,0); 非0-1， 或 new minemap.Math.Vector3(255,0,0); 或者 [123, 1,5]等数值传入！"));const n=e.Vector4.fromColor(r),o=op.createEdgeDetectionStage({length:t.edgeDetectionLength||1e-4}),a=new Um({name:"mm_skyline_red",fragmentShader:"uniform sampler2D colorTexture;uniform sampler2D depthTexture;varying vec2 v_TexCoord;\r\n#include <fn_readDepth> \r\nvoid main(void){float depth = readDepth(depthTexture, v_TexCoord, true);vec4 color = texture2D(colorTexture, v_TexCoord);if (depth < 1.0 - 0.00001) {gl_FragColor = vec4(0.0);}else{gl_FragColor = vec4(1.0,0.0,0.0,1.0);}}"}),l=new Um({name:"mm_skyline_merge_edge",fragmentShader:"uniform sampler2D colorTexture;uniform sampler2D redTexture;uniform sampler2D silhouetteTexture;uniform vec4 u_Viewport;uniform vec4 linecolor;uniform float u_PixelRatio;uniform float width;varying vec2 v_TexCoord;void main(void){ vec2 offxy = width* u_PixelRatio / u_Viewport.zw;vec4 redcolor=texture2D(redTexture, v_TexCoord);vec4 silhouetteColor = texture2D(silhouetteTexture, v_TexCoord);silhouetteColor += texture2D(silhouetteTexture, v_TexCoord+vec2(offxy.x,0.));silhouetteColor += texture2D(silhouetteTexture, v_TexCoord+vec2(-offxy.x,0.));silhouetteColor += texture2D(silhouetteTexture, v_TexCoord+vec2(0.,offxy.y));silhouetteColor += texture2D(silhouetteTexture, v_TexCoord+vec2(0.,-offxy.y));vec4 color = texture2D(colorTexture, v_TexCoord);if(redcolor.r == 1.0 &&silhouetteColor.a!=0.){gl_FragColor = linecolor;}else{gl_FragColor = color;}}",uniforms:{redTexture:a.name,silhouetteTexture:o.name,linecolor:()=>n,width:()=>s}});return new qm({stages:[o,a,l],inputPreviousStageTexture:!1,uniforms:o.uniforms,name:sp})}static createFogEffect(t){let i=e.defaultValue(t?.fogDensity,50);const s=e.Vector4.fromColor(e.Color.parse(e.defaultValue(t?.fogColor,"rgba(255,255,255,1)")),!1);i<=0?(i=1,s.w=0):i>100&&(i=100);const r=e.defined(t.fogFar)?t.fogFar:function(){return 25e3/i},n=e.defined(t.fogNear)?t.fogNear:function(){return 25},o=new Um({name:`${rp}${Math.random()}`,fragmentShader:"#define GLSLIFY 1\n#include <infinity>\n#include <u_FrustumPlanes>\n#include <u_CurrentFrustum>\n#include <u_Viewport>\nuniform mat4 u_ViewportTransformation;uniform mat4 u_InverseProjection;uniform float u_PixelRatio;\n#include <fn_windowToEyeCoordinates>\n#include <fn_readDepth>\nuniform sampler2D colorTexture;uniform sampler2D depthTexture;uniform vec4 fogByDistance;uniform vec4 fogColor;uniform bool u_HasSkyline;uniform vec4 u_SkipColor;uniform bool u_AtmosphereFlag;float getDistance(sampler2D depthTexture,vec2 texCoords){float depth=readDepth(depthTexture,texCoords,true);if(depth==0.0){return infinity;}vec4 eyeCoordinate=windowToEyeCoordinates(gl_FragCoord.xy,depth);return-eyeCoordinate.z/eyeCoordinate.w;}float interpolateByDistance(vec4 nearFarScalar,float distance){float startDistance=nearFarScalar.x;float startValue=nearFarScalar.y;float endDistance=nearFarScalar.z;float endValue=nearFarScalar.w;float t=clamp((distance-startDistance)/(endDistance-startDistance),0.0,1.0);return mix(startValue,endValue,t);}vec4 alphaBlend(vec4 sourceColor,vec4 destinationColor){return sourceColor*vec4(sourceColor.aaa,1.0)+destinationColor*(1.0-sourceColor.a);}void main(void){vec2 v_textureCoordinates=vec2(gl_FragCoord.x,gl_FragCoord.y)/u_Viewport.zw;float distance=getDistance(depthTexture,v_textureCoordinates);vec4 sceneColor=texture2D(colorTexture,v_textureCoordinates);if(u_HasSkyline&&abs(sceneColor.x-u_SkipColor.x)<0.005&&abs(sceneColor.y-u_SkipColor.y)<0.005&&abs(sceneColor.z-u_SkipColor.z)<0.005){gl_FragColor=sceneColor;}else{float blendAmount=interpolateByDistance(fogByDistance,distance);vec4 finalFogColor=vec4(fogColor.rgb,fogColor.a*blendAmount);if(u_AtmosphereFlag){sceneColor.a=sceneColor.a*(1.-blendAmount/4.0);}gl_FragColor=alphaBlend(finalFogColor,sceneColor);}}",uniforms:{fogByDistance:()=>new e.Vector4(n(),0,r(),1),fogColor:()=>o.extraData.color,u_SkipColor:()=>new e.Vector4,u_HasSkyline:()=>!1,u_AtmosphereFlag:()=>!!o.extraData.atmosphereFlag},inputPreviousStageTexture:!1});return o.extraData.color=s,o}}class ap{constructor(e){this._collection=e,this._framebuffers=[],this._stageNameToFramebuffer={},this._width=void 0,this._height=void 0,this._updateDependencies=!1;}updateDependencies(){this._updateDependencies=!0;}update(t){const i=this._collection,s=this._updateDependencies,r=e.defined(i.ambientOcclusion)&&i.ambientOcclusion.enabled&&i.ambientOcclusion._isSupported(t),n=e.defined(i.bloom)&&i.bloom.enabled&&i.bloom._isSupported(t),o=e.defined(i._tonemapping)&&i._tonemapping.enabled&&i._tonemapping._isSupported(t),a=e.defined(i.fxaa)&&i.fxaa.enabled&&i.fxaa._isSupported(t),l=e.defined(i.atmosphere)&&i.atmosphere.enabled&&i.atmosphere._isSupported(t),h=!e.defined(i._activeStages)||i._activeStages.length>0||r||n||o||a||l;if((s||!h&&this._framebuffers.length>0)&&(dp(this),this._framebuffers.length=0,this._stageNameToFramebuffer={},this._width=void 0,this._height=void 0),!s&&!h)return;0===this._framebuffers.length&&function(t,i){const s=function(t,i){const s={};if(e.defined(t.ambientOcclusion)){const e=t.bloom,r=t._tonemapping,n=t.fxaa,o=t.atmosphere;let a=_p(t,i,s,t.ambientOcclusion,void 0);a=_p(t,i,s,e,a),a=hp(t,i,s,r,a),a=_p(t,i,s,t,a),a=hp(t,i,s,n,a),hp(t,i,s,o,a);}else _p(t,i,s,t,void 0);return s}(t._collection,i);for(const e in s)s.hasOwnProperty(e)&&(t._stageNameToFramebuffer[e]=cp(t,e,s[e]));}(this,t);const _=t.drawingBufferWidth,c=t.drawingBufferHeight;(s||this._width!==_||this._height!==c)&&(this._width=_,this._height=c,this._updateDependencies=!1,dp(this),function(t,i){const s=t._width,r=t._height,n=t._framebuffers,o=n.length;for(let t=0;t<o;++t){const o=n[t],a=o.textureScale;let l=Math.ceil(s*a),h=Math.ceil(r*a),_=Math.min(l,h);o.forcePowerOfTwo&&(e.isPowerOfTwo(_)||(_=e.nextPowerOfTwo(_)),l=_,h=_),o.buffer.update(i,l,h),o.clear=new Km({color:o.clearColor,framebuffer:o.buffer.framebuffer});}}(this,t));}clear(e){const t=this._framebuffers;for(let i=0;i<t.length;++i)t[i].clear.execute(e);}getStageByName(e){return this._collection.getStageByName(e)}getOutputTexture(e){return this._collection.getOutputTexture(e)}getFramebuffer(t){const i=this._stageNameToFramebuffer[t];if(e.defined(i))return i.buffer.framebuffer}isDestroyed(){return !1}destroy(){return dp(this),e.destroyObject(this)}}function lp(t){for(;e.defined(t.length);)t=t.get(t.length-1);return t.name}function hp(t,i,s,r,n){if(!r.enabled||!r._isSupported(i))return n;const o=s[r.name]={};e.defined(n)&&(o[lp(t.getStageByName(n))]=!0);const a=r.uniforms;if(e.defined(a)){const i=Object.getOwnPropertyNames(a),s=i.length;for(let r=0;r<s;++r){const s=a[i[r]];if("string"==typeof s){const i=t.getStageByName(s);e.defined(i)&&(o[lp(i)]=!0);}}}return r.name}function _p(t,i,s,r,n){if(e.defined(r.enabled)&&!r.enabled||e.defined(r._isSupported)&&!r._isSupported(i))return n;const o=n,a=!e.defined(r.inputPreviousStageTexture)||r.inputPreviousStageTexture;let l=n;const h=r.length;for(let o=0;o<h;++o){const h=r.get(o);l=e.defined(h.length)?_p(t,i,s,h,n):hp(t,i,s,h,n),a&&(n=l);}let _,c;if(a)for(_=1;_<h;++_)c=lp(r.get(_)),e.defined(s[c])||(s[c]={}),s[c][o]=!0;else for(_=1;_<h;++_){c=lp(r.get(_));const e=s[c];for(let t=0;t<_;++t)e[lp(r.get(t))]=!0;}return l}function cp(t,i,s){const r=t._collection.getStageByName(i),n=r._textureScale,o=r._forcePowerOfTwo,a=r._pixelFormat,l=r._pixelDatatype,h=r._clearColor;let _,c;const d=t._framebuffers,u=d.length;for(_=0;_<u;++_){if(c=d[_],n!==c.textureScale||o!==c.forcePowerOfTwo||a!==c.pixelFormat||l!==c.pixelDatatype||!e.Color.equals(h,c.clearColor))continue;const t=c.stages,i=t.length;let r=!1;for(let e=0;e<i;++e)if(s[t[e]]){r=!0;break}if(!r)break}return e.defined(c)&&_<u?(c.stages.push(i),c):(c={textureScale:n,forcePowerOfTwo:o,pixelFormat:a,pixelDatatype:l,clearColor:h,stages:[i],buffer:new Zm({pixelFormat:a,pixelDatatype:l}),clear:void 0},d.push(c),c)}function dp(e){const t=e._framebuffers,i=t.length;for(let e=0;e<i;++e)t[e].buffer.destroy();}const up={REINHARD:0,MODIFIED_REINHARD:1,FILMIC:2,ACES:3,validate:e=>e===up.REINHARD||e===up.MODIFIED_REINHARD||e===up.FILMIC||e===up.ACES};var mp=Object.freeze(up);const pp=[];class fp{constructor(t){const i=op.createFXAAStage(),s=op.createAmbientOcclusionStage(),r=op.createBloomStage(),n=op.createFogEffect({fogColor:"rgba(172, 205, 255, 0.88)",fogNear:t.fogNearFunction,fogFar:t.fogFarFunction});n.extraData.atmosphereFlag=!0,this._autoExposureEnabled=!1,this._autoExposure=op.createAutoExposureStage(),this._tonemapping=void 0,this._tonemapper=void 0,this.useHdr=!1,this.tonemapper=mp.ACES;const o=this._tonemapping;i.enabled=!1,s.enabled=!1,r.enabled=!1,o.enabled=!1,n.enabled=!0;const a=new ap(this),l={},h=pp;for(h.push(i,s,r,o,n);h.length>0;){const t=h.pop();l[t.name]=t,t._textureCache=a;const i=t.length;if(e.defined(i))for(let e=0;e<i;++e)h.push(t.get(e));}this._stages=[],this._activeStages=[],this._previousActiveStages=[],this._randomTexture=void 0;const _=this;s.uniforms.randomTexture=function(){return _._randomTexture},this._ao=s,this._bloom=r,this._fxaa=i,this._atmosphere=n,this._aoEnabled=void 0,this._bloomEnabled=void 0,this._tonemappingEnabled=void 0,this._fxaaEnabled=void 0,this._fogEnabled=!0,this._activeStagesChanged=!1,this._stagesRemoved=!1,this._textureCacheDirty=!1,this._stageNames=l,this._textureCache=a;}get ready(){let e=!1;const t=this._stages;for(let i=t.length-1;i>=0;--i){const s=t[i];e=e||s.ready&&s.enabled;}const i=this._fxaa,s=this._ao,r=this._bloom,n=this._tonemapping,o=this._atmosphere;return e=e||i.ready&&i.enabled,e=e||s.ready&&s.enabled,e=e||r.ready&&r.enabled,e=e||n.ready&&n.enabled,e=e||o.ready&&o.enabled,e}get atmosphere(){return this._atmosphere}get fxaa(){return this._fxaa}get ambientOcclusion(){return this._ao}get bloom(){return this._bloom}get length(){return gp(this),this._stages.length}get outputTexture(){const t=this._fxaa;if(t.enabled&&t.ready)return this.getOutputTexture(t.name);const i=this._atmosphere;if(i.enabled&&i.ready)return this.getOutputTexture(i.name);const s=this._stages;for(let t=s.length-1;t>=0;--t){const i=s[t];if(e.defined(i)&&i.ready&&i.enabled)return this.getOutputTexture(i.name)}const r=this._tonemapping;if(r.enabled&&r.ready)return this.getOutputTexture(r.name);const n=this._bloom;if(n.enabled&&n.ready)return this.getOutputTexture(n.name);const o=this._ao;return o.enabled&&o.ready?this.getOutputTexture(o.name):void 0}get hasSelected(){const t=this._stages.slice();for(;t.length>0;){const i=t.pop();if(!e.defined(i))continue;if(e.defined(i.selected))return !0;const s=i.length;if(e.defined(s))for(let e=0;e<s;++e)t.push(i.get(e));}return !1}get tonemapper(){return this._tonemapper}set tonemapper(t){if(this._tonemapper===t)return;e.defined(this._tonemapping)&&(delete this._stageNames[this._tonemapping.name],this._tonemapping.destroy());const i=this._autoExposureEnabled;let s;switch(t){case mp.REINHARD:s=op.createReinhardTonemappingStage(i);break;case mp.MODIFIED_REINHARD:s=op.createModifiedReinhardTonemappingStage(i);break;case mp.FILMIC:s=op.createFilmicTonemappingStage(i);break;default:s=op.createAcesTonemappingStage(i);}if(i){const e=this._autoExposure;s.uniforms.autoExposure=function(){return e.outputTexture};}this._tonemapper=t,this._tonemapping=s,e.defined(this._stageNames)&&(this._stageNames[s.name]=s,s._textureCache=this._textureCache),this._textureCacheDirty=!0;}add(t){const i=this._stageNames,s=pp;for(s.push(t);s.length>0;){const t=s.pop();if(e.defined(i[t.name]))throw new Error(`${t.name} has already been added to the collection or does not have a unique name.`);i[t.name]=t,t._textureCache=this._textureCache;const r=t.length;if(e.defined(r))for(let e=0;e<r;++e)s.push(t.get(e));}const r=this._stages;return t._index=r.length,r.push(t),this._textureCacheDirty=!0,t}remove(t){if(!this.contains(t))return !1;const i=this._stageNames,s=pp;for(s.push(t);s.length>0;){const t=s.pop();delete i[t.name];const r=t.length;if(e.defined(r))for(let e=0;e<r;++e)s.push(t.get(e));}return this._stages[t._index]=void 0,this._stagesRemoved=!0,this._textureCacheDirty=!0,t._index=void 0,t._textureCache=void 0,t.destroy(),!0}contains(t){return e.defined(t)&&e.defined(t._index)&&t._textureCache===this._textureCache}get(e){gp(this);const t=this._stages,i=t.length;if(i<0)throw new Error("stages length is 0!");if(e<0)throw new Error("index must be greater than 0!");if(e>=i)throw new Error("index must be less than stages length!");return t[e]}removeAll(){const e=this._stages,t=e.length;for(let i=0;i<t;++i)this.remove(e[i]);e.length=0;}getStageByName(e){return this._stageNames[e]}update(t,i){gp(this);const s=this.useHdr,r=this._activeStages,n=this._activeStages=this._previousActiveStages;this._previousActiveStages=r;const o=this._stages;let a,l,h=n.length=o.length,_=0;for(a=0;a<h;++a)l=o[a],l.ready&&l.enabled&&l._isSupported(t)&&(n[_++]=l);n.length=_;let c=_!==r.length;if(!c)for(a=0;a<_;++a)if(n[a]!==r[a]){c=!0;break}const d=this._ao,u=this._bloom,m=this._autoExposure,p=this._tonemapping,f=this._fxaa,g=this._atmosphere;p.enabled=s;const y=d.enabled&&d._isSupported(t),T=u.enabled&&u._isSupported(t),C=p.enabled&&p._isSupported(t),x=f.enabled&&f._isSupported(t),b=g.enabled&&g._isSupported(t);if((c||this._textureCacheDirty||y!==this._aoEnabled||T!==this._bloomEnabled||C!==this._tonemappingEnabled||x!==this._fxaaEnabled||b!==this._fogEnabled)&&(this._textureCache.updateDependencies(),this._aoEnabled=y,this._bloomEnabled=T,this._tonemappingEnabled=C,this._fxaaEnabled=x,this._fogEnabled=b,this._textureCacheDirty=!1),e.defined(this._randomTexture)&&!y&&(this._randomTexture.destroy(),this._randomTexture=null),!e.defined(this._randomTexture)&&y){h=196608;const i=new Uint8Array(h);for(a=0;a<h;a+=3)i[a]=Math.floor(255*Math.random());this._randomTexture=new e.Texture({context:t,pixelFormat:e.PixelFormat.RGB,pixelDatatype:e.PixelDatatype.UNSIGNED_BYTE,source:{arrayBufferView:i,width:256,height:256},sampler:new e.Sampler({wrapS:e.TextureWrap.REPEAT,wrapT:e.TextureWrap.REPEAT,minificationFilter:e.TextureMinificationFilter.NEAREST,magnificationFilter:e.TextureMagnificationFilter.NEAREST})});}this._textureCache.update(t),f.update(t,i),d.update(t,i),u.update(t,i),p.update(t,i),g.update(t,i),this._autoExposureEnabled&&m.update(t,i),h=o.length;let v=!1;for(a=0;a<h;++a){if(o[a].name==sp){v=!0;const e=o[a].get(o[a].length-1).uniforms.linecolor;"function"==typeof e&&(g.uniformMap?.set("u_SkipColor",e),g.uniformMap?.set("u_HasSkyline",(()=>!0)));}o[a].update(t,i);}for(v||(g.uniformMap?.set("u_SkipColor",(()=>new e.Vector4)),g.uniformMap?.set("u_HasSkyline",(()=>!1))),_=0,a=0;a<h;++a)l=o[a],l.ready&&l.enabled&&l._isSupported(t)&&_++;c=_!==n.length,c&&this.update(t,i,s);}clear(e){this._textureCache.clear(e),this._autoExposure&&this._autoExposure.clear(e);}getOutputTexture(t){const i=this.getStageByName(t);if(e.defined(i))return yp(i)}execute(e,t,i,s){const r=this._activeStages,n=r.length,o=this._fxaa,a=this._ao,l=this._bloom,h=this._autoExposure,_=this._tonemapping,c=this._atmosphere,d=a.enabled&&a._isSupported(e),u=l.enabled&&l._isSupported(e),m=this._autoExposureEnabled,p=_.enabled&&_._isSupported(e),f=o.enabled&&o._isSupported(e),g=c.enabled&&c._isSupported(e);if(!(f||d||u||p||g||0!==n))return;let y=t;d&&a.ready&&(Tp(a,e,y,i,s),y=yp(a)),u&&l.ready&&(Tp(l,e,y,i,s),y=yp(l)),m&&h.ready&&Tp(h,e,y,i,s),p&&_.ready&&(Tp(_,e,y,i,s),y=yp(_));let T=y;if(n>0){Tp(r[0],e,y,i,s);for(let t=1;t<n;++t)Tp(r[t],e,yp(r[t-1]),i,s);T=yp(r[n-1]);}g&&c.ready&&(Tp(c,e,T,i,s),T=yp(c)),f&&o.ready&&Tp(o,e,T,i,s);}createViewportQuadCommand(t){const i=this;return e.defined(this._copyColorCommand)||(this._copyColorCommand={painter:t.painter,framebuffer:void 0,layer:{id:"postprocess"},geometry:new vu(t.painter),material:{_uniforms:new Map([["colorTexture",()=>i.outputTexture]]),_shaderSource:new e.ShaderSource({vertexSource:e.shaders.screen.vertexSource,fragmentSource:e.shaders.PassThrough.fragmentSource})}}),this._copyColorCommand}copy(e,t){this._copyColorCommand=this.createViewportQuadCommand(e),this._copyColorCommand.framebuffer=t.framebuffer,e.draw(this._copyColorCommand);}serialize(){const t={fxaa:this.fxaa.enabled,bloom:this.bloom.enabled,hdr:this.useHdr,nightVision:!1},i={color:[112,78,200],width:10},s={fogColor:[],fogDensity:[]};for(let r=0;r<this._stages.length;r++){const n=this._stages[r];if(e.defined(n)){if("czm_black_and_white"===n.name&&(t.blackWhite=!0),"czm_night_vision"===n.name&&(t.nightVision=!0),"skyline"===n.name){const s=n._stages[2]._uniformMap.get("linecolor")(),r=n._stages[2]._uniformMap.get("width")();i.color=e.Vector4.pack(s,new Array(4)),i.width=r,t.skyline=i;}if(n.name===rp){s.fogColor=e.Vector4.pack(n._uniformMap.get("fogColor")(),new Array(4));const i=1e4/n._uniformMap.get("fogByDistance")()[2];s.fogDensity=Math.max(Math.min(i,100),1),t.fog=s;}}}return t}destroy(){return this._fxaa.destroy(),this._ao.destroy(),this._bloom.destroy(),this._autoExposure.destroy(),this._tonemapping.destroy(),this._atmosphere.destroy(),this.removeAll(),this._textureCache=this._textureCache&&this._textureCache.destroy(),e.destroyObject(this)}}function gp(e){if(!e._stagesRemoved)return;e._stagesRemoved=!1;const t=[],i=e._stages,s=i.length;for(let e=0,r=0;e<s;++e){const s=i[e];s&&(s._index=r++,t.push(s));}e._stages=t;}function yp(t){for(;e.defined(t.length);)t=t.get(t.length-1);return t.outputTexture}function Tp(t,i,s,r,n){if(e.defined(t.execute))return void t.execute(i,s,r,n);const o=t.length;let a;if(t.inputPreviousStageTexture)for(Tp(t.get(0),i,s,r,n),a=1;a<o;++a)Tp(t.get(a),i,yp(t.get(a-1)),r,n);else for(a=0;a<o;++a)Tp(t.get(a),i,s,r,n);}const Cp=e.createLayout([{name:"a_POSITION",components:3,type:"Float32"}],4),{members:xp}=Cp;class bp{constructor(t){this._tileCount=0,this.cache={},this.keys=[],this._context=t.context,this._projectionType=t.projection||e.ProjectionType.MERCATOR,this.debugVAO=new pl;}setProjection(e){this._projectionType=e;}setMaxTile(e){for(this._tileCount=e;this.keys.length>this._tileCount;)this.removeTileById(this.keys[0]);}addTileByCoord(t){const i=t.canonical,s=i.z,r=i.x,n=i.y,o=t.key,a=new e.StructArrayLayout3f12;let l=8-s;l<1&&(l=1);let h=0,_=[];for(let t=0;t<l+1;t++){const i=e.getSpherePos(t/(l+1)*e.EXTENT,5,0,r,n,s,this._projectionType);0===_.length&&(_=i),a.emplaceBack(i[0]-_[0],i[1]-_[1],i[2]-_[2]),h++;}for(let t=0;t<l+1;t++){const i=e.getSpherePos(e.EXTENT,t/(l+1)*e.EXTENT,0,r,n,s,this._projectionType);a.emplaceBack(i[0]-_[0],i[1]-_[1],i[2]-_[2]),h++;}for(let t=l+1;t>0;t--){const i=e.getSpherePos(t/(l+1)*e.EXTENT,e.EXTENT,0,r,n,s,this._projectionType);a.emplaceBack(i[0]-_[0],i[1]-_[1],i[2]-_[2]),h++;}for(let t=l+1;t>=0;t--){const i=e.getSpherePos(0,t/(l+1)*e.EXTENT,0,r,n,s,this._projectionType);a.emplaceBack(i[0]-_[0],i[1]-_[1],i[2]-_[2]),h++;}const c=function(e,t,i,s){s=s||1;const r=[];let n,o,a,l,h,_,c,d;for(n=0,o=e.length;n<o;n++)if(h=vp[e[n]],h){for(d=null,a=0,l=h[1].length;a<l;a+=2)-1===h[1][a]&&-1===h[1][a+1]?d=null:(_=t+h[1][a]*s,c=800-h[1][a+1]*s,d&&r.push(d.x,d.y,_,c),d={x:_,y:c});t+=h[0]*s;}return r}(t.toString(),50,0,20);let d=0;for(let t=0;t<c.length;t+=2){const i=e.getSpherePos(c[t],c[t+1],0,r,n,s,this._projectionType);a.emplaceBack(i[0]-_[0],i[1]-_[1],i[2]-_[2]),d++;}const u=this._context.createVertexBuffer(a,xp);return this.keys.push(o),this.cache[o]={rP:_,matrix:(new e.Matrix4).translate(_),debugBuffer:u,lineVerticesCount:h,textVerticesCount:d},this.cache[o]}getTileByCoord(e){if(!this.hasTile(e.key))return this.addTileByCoord(e);for(let t=0;t<this.keys.length;t++)if(this.keys[t]===e.key)return this.keys.splice(t,1),this.keys.push(e.key),this.cache[e.key]}removeTileById(e){this.cache[e].debugBuffer.destroy(),this.cache[e]=null,delete this.cache[e];for(let t=0;t<this.keys.length;t++)if(this.keys[t]===e){this.keys.splice(t,1);break}}hasTile(e){return !!this.cache[e]}release(){for(;this.keys.length>0;)this.removeTileById(this.keys[0]);}}const vp={" ":[16,[]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]]};class wp extends yu{constructor(e){super(e),this._renderPrimitives=[],this._needClearStencilPrimitives=[],this.plotterType="fill";}update(e,t,i,s,r){this.parse(e,t,i,s,r),this.render(e,i,r);}render(t,i,s){const r=Tu[s.passType](this._renderPrimitives);let n=!0;for(let o=0;o<r.length;o++){const a=r[o];a._material instanceof e.VectorFillMaterial&&(a.update(t,s),a._material.renderState.stencilTest={enabled:!0,frontFunction:e.WebGLConstants.NOTEQUAL,backFunction:e.WebGLConstants.NOTEQUAL,reference:t.tileClippingMask.vectorLayerStencilID,mask:255,frontOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.KEEP},backOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.KEEP}},a._material.renderState.colorMask=e.renderStateEnum.enableColorMask,a.render(t,i,s),a._material.renderState.stencilTest={enabled:!0,frontFunction:e.WebGLConstants.NOTEQUAL,backFunction:e.WebGLConstants.NOTEQUAL,reference:t.tileClippingMask.vectorLayerStencilID,mask:255,frontOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.REPLACE},backOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.REPLACE}},a._material.renderState.colorMask=e.renderStateEnum.disabledColorMask,a.render(t,i,s)),a._material instanceof qh&&(n&&(t.clearStencil(),n=!1),a.update(t,s),a.render(t,i,s));}this._renderPrimitives=[],t.tileClippingMask.status=!1;}parse(e,t,i,s,r){if(s.length>0){const n=i.paint?.get("fill-antialias");for(let o=0;o<s.length;o++){const a=s[o],l=t.getTile(s[o]);if(!l.getBucket(i))continue;const h=xu({source:null,layer:i,isInstance:!1,passType:r.passType}),_=l.primitiveMap.get(i.id);if(!_)continue;const c=this._createRenderState(e,i,a),d=_.fill;if(d&&Array.isArray(d))continue;d&&(d._material.defines=h,d._material.renderState=c,this._renderPrimitives.unshift(d));const u=_.outline;u&&n&&(!d?.material?.hasPattern()||d?.material?.hasPattern()&&!i.outlineFromFillColor)&&(u._material.defines=h,u._material.renderState=c,this._renderPrimitives.push(u));}}}_createRenderState(e,t){return wp.parseRenderState(e,t)}destroy(){this.programId=void 0,this._renderPrimitives=void 0,this.plotterType=void 0;}}class Sp{constructor(){this.writeMaskRs=void 0,this.useMaskRs=void 0,this.uniforms={},this.programType="sphereClipping";}renderMask(){}createProgram(){}}class Ap extends Sp{constructor(){super(),this.status=!1,this.nextStencilID=1,this.vectorLayerStencilID=1,this.requestedVectorLayerIDs=[1];}increaseVectorLayerID(e){this.requestedVectorLayerIDs=[];for(let t=0;t<e;t++)this.vectorLayerStencilID++,this.vectorLayerStencilID>255&&(this.vectorLayerStencilID=1),this.requestedVectorLayerIDs.push(this.vectorLayerStencilID);}}const Ep="Classification",Mp=Object.freeze({});class Pp{constructor(e){this.setup(e);}setup(e){this._setRenderListEmpty(),this.painter=e.painter,e.painter.style&&this.update(e);}_setRenderListEmpty(){this.globeRaster=[],this.raster=[],this.sphereLayerOrder=[],this.modelPrimitiveList=[],this.modelOpaquePrimitiveList=[],this.modelTranslucentPrimitiveList=[],this.modelClassificationPrimitiveList=[],this.modelClassificationPrimitiveListClone=[],this.modelClassificationOpaquePrimitiveList=[],this.modelClassificationTranslucentPrimitiveList=[],this.modelIgnoreClassificationPrimitiveList=[],this.modelIgnoreClassificationOpaquePrimitiveList=[],this.modelIgnoreClassificationTranslucentPrimitiveList=[],this.forceOverModelVectorLayerList=[],this.terrainAdaptionPrimitiveListNow=[];}getNearFarPlane(t,i){const s=i.activeCamera.directionWC,r=i.activeCamera.positionWC;let n=+Number.MAX_VALUE,o=-Number.MAX_VALUE;if(this.painter.style.hasTerrainData)for(const t in this.painter.style.rasterSourceCache._tiles){const i=this.painter.style.rasterSourceCache._tiles[t];if("loaded"===i.state&&e.defined(i.primitive)){if(i.tileID.overscaledZ<10)continue;const e=i.primitive.boundingVolume;let t=e.distanceTo(r);const a=e.computePlaneDistances(r,s);let l=a.stop;if(0===t)t=.1,l=a.stop;else if(t=Math.min(t,a.start),t<0)continue;n=Math.min(n,t),o=Math.max(o,l);}}const a=this.modelPrimitiveList;for(let t=0;t<a.length;t++){const i=a[t];let l=i.boundingVolume;if(e.defined(i.modelInstanceCollection)?l=i.modelInstanceCollection.boundingVolume:e.defined(i.animationModelInstanceCollection)&&(l=i.animationModelInstanceCollection.boundingVolume),l){if("pointCollection"===i.name)continue;let e=l.distanceTo(r);const t=l.computePlaneDistances(r,s);let a=t.stop;if(0===e)e=.1,a=t.stop;else if(e=Math.min(e,t.start),e<0)continue;n=Math.min(n,e),o=Math.max(o,a);}}for(let e=0;e<this.terrainAdaptionPrimitiveListNow.length;e++){const t=this.terrainAdaptionPrimitiveListNow[e].boundingVolume.computePlaneDistances(r,s);o=Math.max(o,t.stop);}for(let e=0;e<this.modelClassificationPrimitiveListClone.length;e++){const t=this.modelClassificationPrimitiveListClone[e].boundingVolume;if(!t)continue;const i=t.computePlaneDistances(r,s);o=Math.max(o,i.stop);}return {near:n,far:o}}update(t){const{layers:i,orders:s,frameState:r}=t,n=this.painter,o=r.camera.frustumCrate.cullingVolume;this._setRenderListEmpty();for(let t=0;t<s.length;t++){const r=i[s[t]];if((!r||n.style.map._cameraUnderground||!r.isHiddenByMapZoom(n.transform.zoom))&&"visible"===r.visibility&&r.paint)if(r.type==e.VectorLayerType.TILES||r.type==e.VectorLayerType.MODEL)n.style.sourceCaches[r.source].addClippingPlanes&&n.style.sourceCaches[r.source].addClippingPlanes(r.clippingPlanes),n.style.sourceCaches[r.source].addCustomizedStyle&&n.style.sourceCaches[r.source].addCustomizedStyle(r.paint),r.classificationType===e.ClassificationType.IGNORECLASSIFICATION?(this.modelIgnoreClassificationOpaquePrimitiveList=this.modelIgnoreClassificationOpaquePrimitiveList.concat(n.style.sourceCaches[r.source].getOpaquePrimitives(o,void 0,r)),this.modelIgnoreClassificationTranslucentPrimitiveList=this.modelIgnoreClassificationTranslucentPrimitiveList.concat(n.style.sourceCaches[r.source].getTranslucentPrimitives(o,void 0,r))):(this.modelOpaquePrimitiveList=this.modelOpaquePrimitiveList.concat(n.style.sourceCaches[r.source].getOpaquePrimitives(o,void 0,r)),this.modelTranslucentPrimitiveList=this.modelTranslucentPrimitiveList.concat(n.style.sourceCaches[r.source].getTranslucentPrimitives(o,void 0,r)));else {if(r.type===e.VectorLayerType.RASTER||r.type===e.VectorLayerType.BACKGROUND){if(r.depthTest||n.style.map.style.hasTerrainData){this.globeRaster.push(s[t]);continue}r.independent||this.raster.push(s[t]);}if(e.checkIsVectorShadowVolumeDataType(r.classificationType)){const e=n.style.sourceCaches[r.source],t=e.getVisibleCoordinates();for(let i=0;i<t.length;i++){const s=e.getTile(t[i]);if(!s.getBucket(r))continue;const n=s.primitiveMap.get(r.id);if(!n)continue;const o=n[r.type];Array.isArray(o)&&this.terrainAdaptionPrimitiveListNow.push(...o);}}else r.classificationType==e.ClassificationType.FORCE_VECTOR_OVER_MODEL||r.classificationType==e.ClassificationType.IGNORECLASSIFICATION?this.forceOverModelVectorLayerList.push(s[t]):this.sphereLayerOrder.push(s[t]);}}n.style.tilesetCollection.update(r),n.style.modelCollection.update(r),n._map.videoManager.clear3DModel(),n._map.videoManager.clear3DTiles(),[n.style.modelCollection,n.style.tilesetCollection,n.style.primitiveCollection,n.style.scenePointPrimitiveCollection,n.style.sceneObjectCollection].forEach(((e,t)=>{const i=e.getIndependentPrimitiveObject(o);e instanceof Ou&&t<=2&&(n._map.videoManager.update3DModel(i.opaque),n._map.videoManager.update3DModel(i.translucent)),this.modelOpaquePrimitiveList=this.modelOpaquePrimitiveList.concat(i.opaque),this.modelTranslucentPrimitiveList=this.modelTranslucentPrimitiveList.concat(i.translucent);const s=e.getIgnoreClassificationPrimitiveObject(o);this.modelIgnoreClassificationOpaquePrimitiveList=this.modelIgnoreClassificationOpaquePrimitiveList.concat(s.opaque),this.modelIgnoreClassificationTranslucentPrimitiveList=this.modelIgnoreClassificationTranslucentPrimitiveList.concat(s.translucent);})),this.modelPrimitiveList=this.modelOpaquePrimitiveList.concat(this.modelTranslucentPrimitiveList);const a=n.style.primitiveCollection.getClassificationPrimitiveObject(o);this.modelClassificationOpaquePrimitiveList=this.modelClassificationOpaquePrimitiveList.concat(a.opaque),this.modelClassificationTranslucentPrimitiveList=this.modelClassificationTranslucentPrimitiveList.concat(a.translucent),this.modelClassificationPrimitiveList=this.modelClassificationOpaquePrimitiveList.concat(this.modelClassificationTranslucentPrimitiveList),this.modelIgnoreClassificationPrimitiveList=this.modelIgnoreClassificationOpaquePrimitiveList.concat(this.modelIgnoreClassificationTranslucentPrimitiveList),this.modelClassificationPrimitiveListClone=this.modelClassificationPrimitiveList.slice(),t.ignoreNonePickPrimitive&&(this.modelPrimitiveList=this.modelPrimitiveList.filter((e=>e.allowPick)),this.modelClassificationPrimitiveList=this.modelClassificationPrimitiveList.filter((e=>e.allowPick)),this.modelIgnoreClassificationPrimitiveList=this.modelIgnoreClassificationPrimitiveList.filter((e=>e.allowPick)));}setFilter(){}render(e){const{layers:t,frameState:i,vectorQuery:s}=e,r=this.painter;this.currentLayer=0,this._renderPrimitives({primitives:r.style.sceneObjectCollection.getSkyAndEarthPrimitives(),frameState:i}),this._renderRasterLayers(t,i),this.renderLayers(this.sphereLayerOrder,t,i),s||this._renderPrimitives({primitives:this.modelPrimitiveList,frameState:i}),this._renderPrimitives({primitives:this.terrainAdaptionPrimitiveListNow,frameState:i,renderType:Ep}),s||this._renderPrimitives({primitives:this.modelClassificationPrimitiveList,frameState:i,renderType:Ep}),(this.modelClassificationPrimitiveList.length>0||this.terrainAdaptionPrimitiveListNow.length>0)&&this.globeRaster.length<1&&(Rp(!0,i,r),this._renderPrimitives({primitives:this.terrainAdaptionPrimitiveListNow,frameState:i,renderType:Ep}),s||this._renderPrimitives({primitives:this.modelClassificationPrimitiveList,frameState:i,renderType:Ep}),Rp(!1,i,r)),s||this._renderPrimitives({primitives:this.modelIgnoreClassificationPrimitiveList,frameState:i}),this.renderLayers(this.forceOverModelVectorLayerList,t,i);}renderLayers(t,i,s){if(0===t.length)return;let r,n=[];const o=[],a=this.painter;for(let l=0;l<t.length;l++){const h=i[t[l]];if(h.type===e.VectorLayerType.RASTER||h.type===e.VectorLayerType.BACKGROUND&&!h.getPaintProperty("background-terrain-analysis"))h.independent?(n=a.style.rasterSourceCache.getVisibleCoordinates(!1),this.executePaint({sourceCache:a.style.rasterSourceCache,layer:[h],coords:n,frameState:s})):(o.push(h),this.raster[this.raster.length-1]===t[l]&&(n=a.style.rasterSourceCache.getVisibleCoordinates(!1),this.executePaint({sourceCache:a.style.rasterSourceCache,layer:o,coords:n,frameState:s})));else if("background"===h.type&&h.getPaintProperty("background-terrain-analysis"))n=a.style.rasterSourceCache.getVisibleCoordinates(!1),this.executePaint({sourceCache:a.style.rasterSourceCache,layer:[h],coords:n,frameState:s});else {if(h?.source!==(r&&r.id))r=a.style.sourceCaches[h.source],r&&r.getVisibleCoordinates&&(n=r.getVisibleCoordinates(h.type===e.VectorLayerType.SYMBOL||h.type===e.VectorLayerType.SYMTRACKING));else {const t=h.layout&&h.layout.get("symbol-placement"),i=n.every((e=>e.posMatrix));!t||"point"!==t&&"line"!==t&&"line-center"!==t||i||r&&r.getVisibleCoordinates&&(n=r.getVisibleCoordinates(h.type===e.VectorLayerType.SYMBOL||h.type===e.VectorLayerType.SYMTRACKING));}this.executePaint({sourceCache:r,layer:h,coords:n,frameState:s});}}}_renderRasterLayers(e,t){const i=this.painter,s=[];for(let t=0;t<this.globeRaster.length;t++)s.push(e[this.globeRaster[t]]);if(s.length>0||i.style.proxySourceCache.enabled&&i.style.map.style.hasTerrainData){const e=i.style.rasterSourceCache.getVisibleCoordinates(!1);this.executePaint({sourceCache:i.style.rasterSourceCache,layer:s,coords:e,frameState:t});}}executePaint(t){const{sourceCache:i,layer:s,coords:r,primitives:n,frameState:o}=t,a=void 0===o.overrideMaterial,l=this.painter;if(e.defined(n)&&e.defined(o.overrideMaterial)&&"depthMaterial"===o.overrideMaterial._type)for(let t=0;t<n.length;t++)e.defined(n[t]._material)&&"BillboardMaterial"===n[t]._material._type&&n.splice(t--,1);let h=!1;if(s){if(s instanceof Array)l.rasterPlotter.update(l,i,s,r,o);else if(s.type===e.VectorLayerType.LINE&&a&&!1!==s.stencilTest){const e=s.paint.get("line-opacity"),t=s.getPaintProperty("line-pattern");(e.constantOr(1)<1||!e.isConstant()||t)&&r.length&&(l.tileClippingMask.increaseVectorLayerID(2),l.tileClippingMask.status=!0,h=!0);}else if(s.type===e.VectorLayerType.FILL&&a){const t=s.paint.get("fill-opacity").constantOr(1),i=!s.paint.get("fill-opacity").isConstant(),r=s.paint.get("fill-color").constantOr(new e.Color(1,1,1,1)),n=s.getPaintProperty("fill-outline-color"),o=s.getPaintProperty("fill-pattern");(t<1||i||n||r.a<1||o)&&(l.tileClippingMask.increaseVectorLayerID(1),l.tileClippingMask.status=!0,h=!0);}if(s.type===e.VectorLayerType.FILL){if(!i.adaptTerrain||!l.style.hasTerrainData){const e=this.filterTile(i,s,r,l);l.fillPlotter.update(l,i,s,e,o);}}else if(s.type===e.VectorLayerType.SYMBOL||s.type===e.VectorLayerType.SYMTRACKING){const e=this.filterTile(i,s,r,l);e.length&&l.symbolPlotter.update(l,i,s,e,o);}else if(s.type===e.VectorLayerType.MODEL||s.type===e.VectorLayerType.TILES)l.modelPlotter.update(l,i,s,o,n);else if(s.type===e.VectorLayerType.LINE||s.type===e.VectorLayerType.SPRITE){if(!i.adaptTerrain||!l.style.hasTerrainData){const e=this.filterTile(i,s,r,l);e.length&&l.linePlotter.update(l,i,s,e,o);}}else if(s.type===e.VectorLayerType.TRACKING){const e=this.filterTile(i,s,r,l);e.length&&l.linePlotter.update(l,i,s,e,o);}else if(s.type===e.VectorLayerType.CIRCLE)l.circlePlotter.update(l,i,s,r,o);else if(s.type===e.VectorLayerType.HEATMAP){if(!i.adaptTerrain||!l.style.hasTerrainData){const e=this.filterTile(i,s,r,l);e.length&&l.heatmapPlotter.update(l,i,s,e,o);}}else if(s.type===e.VectorLayerType.EXTRUSION||s.type===e.VectorLayerType.HISTOGRAM){const e=this.filterTile(i,s,r,l);e.length&&(l.extrusionPlotter.update(l,i,s,e,o),l.clearStencil());}l.tileClippingMask.status=!1,s.type!==e.VectorLayerType.RASTER&&s.type!==e.VectorLayerType.MODEL&&s.type!==e.VectorLayerType.TILES||!l.options.showDebugBoundingBox||l.debugBoundingBoxPlotter.update(l,i,s,o),h&&l.clearStencil();}o.sameLayerFrame=!1;}filterTile(t,i,s,r){const n=[];e.checkIsVectorShadowVolumeDataType(i.classificationType)&&r.clearStencil();for(let e=0;e<s.length;e++)t.getTile(s[e]).getBucket(i)&&n.push(s[e]);return n}_renderPrimitives({primitives:t,frameState:i,renderType:s}){0!==t.length&&this.executePaint({sourceCache:Mp,layer:{lightingModel:this.painter._map.lightingModel,type:e.VectorLayerType.MODEL,isHidden:()=>!1,classificationType:s===Ep?e.ClassificationType.ALL:e.ClassificationType.NONE},primitives:t,frameState:i});}}function Rp(t,i,s){if(t){i.preMainDepthStencilTexture=s.mainPass.framebuffer.depthStencilTexture;const t=s.backgroundPass.framebuffer.depthStencilTexture;s.context.gl.framebufferTexture2D(e.WebGLConstants.FRAMEBUFFER,e.WebGLConstants.DEPTH_STENCIL_ATTACHMENT,t._target,t.texture,0);}else s.context.gl.framebufferTexture2D(e.WebGLConstants.FRAMEBUFFER,e.WebGLConstants.DEPTH_STENCIL_ATTACHMENT,i.preMainDepthStencilTexture._target,i.preMainDepthStencilTexture.texture,0),i.preMainDepthStencilTexture=void 0;}class Bp extends yu{constructor(e){super(e),this._renderPrimitives=[],this.plotterType="symbol";}update(t,i,s,r,n){void 0!==s.paint&&n.passType!==e.RenderPassConsts.PICK_PASS&&(this.parse(t,i,s,r,n),this.render(t,s,n));}render(e,t,i){const s=Tu[i.passType](this._renderPrimitives);for(let r=0;r<s.length;r++){const n=s[r];n._material.isSDF&&n._material.hasHalo&&(n._material.ishalo=!0,n.update(e,i),n.render(e,t,i)),n._material.ishalo=!1,n.update(e,i),n.render(e,t,i);}this._renderPrimitives=[];}removePrimitive(e,t){}parse(t,i,s,r,n){if(r.length>0){"symtracking"===s.type&&e.SymbolMaterial.updateSymtrackingLayerProperty(s,t,i);const o=xu({source:null,layer:null,isInstance:!1,passType:n.passType}),a=this._createRenderState();for(const e of r){const t=i.getTile(e);if(!t.getBucket(s))continue;const r=t.primitiveMap.get(s.id);if(!r)continue;const n=r.icon;n&&(n._material.defines=o,n._material.renderState=a,this._renderPrimitives.unshift(n));const l=r.text;l&&(l._material.defines=o,l._material.renderState=a,this._renderPrimitives.push(l));}}}_createRenderState(){const t={};return t.blending=e.renderStateEnum.enableBlending,t.depthTest=e.renderStateEnum.disableDepthTest,t.depthMask=e.renderStateEnum.disableDepthMask,t.cull=e.renderStateEnum.disableCull,t.stencilTest=e.renderStateEnum.disableStencilTest,t.stencilMask=e.renderStateEnum.disableStencilMask,t}destroy(){this._renderPrimitives=[],this.plotterType=void 0;}}class Ip extends yu{constructor(e){super(e),this._renderPrimitives=[],this.plotterType="extrusion";}update(e,t,i,s,r){if(!i.paint||0===i.paint.get("extrusion-opacity")?.value?.value)return;const n=t.getSource();this._updateAnimation(n),this.parse(e,t,i,s,r,n.animationsInfo),this._error||this.render(e,i,r,n.animationsInfo);}render(t,i,s,r){const n=Tu[s.passType](this._renderPrimitives);t.clearStencil();const o=i.paint.get("extrusion-opacity")?.value?.value,a=i.paint.get("histogram-opacity")?.value?.value,l=1===o||1===a,h=e.stencilModeforExtrusion(t);for(let e=0;e<n.length;e++){const o=n[e];o.update(t,s,{renderStateTag:"first",enableColorMask:l,animationsInfo:r}),o.render(t,i,s);}if(!l)for(let e=0;e<n.length;e++){const o=n[e];o.update(t,s,{renderStateTag:"second",stencilTest:h,animationsInfo:r}),o.render(t,i,s);}this._renderPrimitives=[];}parse(e,t,i,s,r,n){if(s.length>0){const o=this.getMicroDefinition(e,i,r,n);for(const r of s){const s=t.getTile(r).primitiveMap.get(i.id);s&&(s._material.initializedRenderState||(s._material.renderState=this._createRenderState(e,i),s._material.initializedRenderState=!0),s._material.defines=o,this._renderPrimitives.push(s));}}}_createRenderState(){return {depthMask:e.renderStateEnum.enableDepthMask,depthTest:e.renderStateEnum.enableDepthTestWithLEQUAL,stencilMask:e.renderStateEnum.enableStencilMask,colorMask:e.renderStateEnum.enableColorMask,cull:e.renderStateEnum.disableCull,blending:e.renderStateEnum.enableBlending}}destroy(){this._renderPrimitives=void 0,this.isRegularVector=void 0,this.plotterType=void 0;}getMicroDefinition(t,i,s,r){const n=xu({source:null,layer:null,isInstance:!1,passType:s.passType}),o=pu.getExtrusionMicroDefinition(i,r);return e.extend(n,o)}_updateAnimation(e){if(!e.animationPropertyCollection||0===e.animationPropertyCollection.size)return;const t=e?.animationPropertyCollection,i=t.getAll();1===i.length&&i[0].updateAnimation(e);}}class Dp extends e.Geometry{constructor(t){super(t),this.type="BoxOutlineGeometry",this.primitiveType=e.WebGLConstants.LINES,this.setData(t);}setData(t){if(super.setData(),t.minPoint&&t.maxPoint){t.minPoint=e.Vector3.unpack(t.minPoint),t.maxPoint=e.Vector3.unpack(t.maxPoint);const i=(t.maxPoint.x-t.minPoint.x)/2,s=(t.maxPoint.y-t.minPoint.y)/2,r=(t.maxPoint.z-t.minPoint.z)/2;this.minPoint=new e.Vector3(-i,-s,-r),this.maxPoint=new e.Vector3(i,s,r);}else this.maxPoint=e.Vector3.multiplyByScalar(new e.Vector3(t.width,t.height,t.depth),.5,new e.Vector3),this.minPoint=e.Vector3.negate(this.maxPoint,new e.Vector3);this._usedDoublePrecision=!1,this._vertexArray?(this._vertexArray.clear(),this._indexArray.clear()):(this._vertexArray=this._usedDoublePrecision?new e.StructArrayLayout3f3f24:new e.StructArrayLayout3f12,this._indexArray=new e.StructArrayLayout2ui4),this.parse(),this.computeBoundingSphere(),this.computeBoundingBox();}parse(){this.computeNearFarPlanes(),this.emplaceVertexBufferOfLines(),this.computeIndices();for(let e=0;e<this.indices.length;e+=2)this._indexArray.emplaceBack(this.indices[e],this.indices[e+1]);this.needUpdate=!0;}computeNearFarPlanes(){const e=new Float64Array(24);e[0]=this.minPoint.x,e[1]=this.minPoint.y,e[2]=this.minPoint.z,e[3]=this.maxPoint.x,e[4]=this.minPoint.y,e[5]=this.minPoint.z,e[6]=this.maxPoint.x,e[7]=this.maxPoint.y,e[8]=this.minPoint.z,e[9]=this.minPoint.x,e[10]=this.maxPoint.y,e[11]=this.minPoint.z,e[12]=this.minPoint.x,e[13]=this.minPoint.y,e[14]=this.maxPoint.z,e[15]=this.maxPoint.x,e[16]=this.minPoint.y,e[17]=this.maxPoint.z,e[18]=this.maxPoint.x,e[19]=this.maxPoint.y,e[20]=this.maxPoint.z,e[21]=this.minPoint.x,e[22]=this.maxPoint.y,e[23]=this.maxPoint.z,this.vertices=e;}computeIndices(){const e=new Uint16Array(24);e[0]=4,e[1]=5,e[2]=5,e[3]=6,e[4]=6,e[5]=7,e[6]=7,e[7]=4,e[8]=0,e[9]=1,e[10]=1,e[11]=2,e[12]=2,e[13]=3,e[14]=3,e[15]=0,e[16]=0,e[17]=4,e[18]=1,e[19]=5,e[20]=2,e[21]=6,e[22]=3,e[23]=7,this.indices=e;}update(t){if(this.needUpdate&&t.painter){this.needUpdate=!1;const i=t.painter.context;this._vertexBuffer&&this._indexBuffer?(this._vertexBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indexArray)):(this._vertexBuffer=i.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?ju.members:Xu.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indexArray,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/2);}}serialize(){return {type:this.type,maxPoint:e.Vector3.pack(this.maxPoint,new Array(3)),minPoint:e.Vector3.pack(this.minPoint,new Array(3))}}destroy(){super.destroy(),this.type=null,this.primitiveType=null,this._vertexArray=null,this._indexArray=null,this.maxPoint=null,this.minPoint=null,this.vertices=null;}static fromDiagonal(t,i){if(!e.defined(t)||!e.defined(i))throw new Error("diagonal positios must be defined!");if(!e.Vector3.equals(t,i))return new Dp({minPoint:t,maxPoint:i});console.error("两点不能是同一个点");}}class Op extends yu{constructor(e){super(e);}update(e,t,i,s){this.render(e,i,s,t);}render(e,t,i,s){e.clearStencil();const r=e.style.debugBoundingBoxPrimitiveCollection.getAllNeedRenderPrimitive();for(let s=0;s<r.length;s++){const n=r[s];n.update(e,i,{}),n.render(e,t,i);}e.style.debugBoundingBoxPrimitiveCollection.removeNeedRenderPrimitiveList();}removePrimitive(){}static createDebugBoundingBoxPrimitive(t){const i=e.Matrix4.fromRotationTranslation(t.halfAxes,t.center,new e.Matrix4),s=new Dp({width:2,height:2,depth:2}),r=e.StandardMaterial.fromType("Color",{color:"white",opacity:1,lightingModel:e.LightingModelType.NONE}),n=new e.Primitive({modelMatrix:i,geometry:s,material:r});return n.id=t.id,t.painter.style.debugBoundingBoxPrimitiveCollection.add(n),n}destroy(){this.programId=void 0,this.sharedTextures=void 0;}}class Lp extends yu{constructor(e){super(e),this.programId="gltfPBR",this._renderPrimitives=[],this.plotterType="model";}update(e,t,i,s,r){this.parse(e,t,i,s,r),this.render(e,i,s,t);}render(t,i,s,r){const n=Tu[s.passType](this._renderPrimitives),o=!e.checkIsVectorShadowVolumeDataType(i.classificationType);let a;o||(t.clearStencil(),a=Lp._createRenderState(t,i));for(let r=0;r<n.length;r++){const l=n[r];if(void 0!==s.overrideMaterial&&l.framebuffer)continue;if(null!=l.rootId){const e=t._map.getSceneComponent(l.rootId);i.lightingModel=void 0===e?0:e.lightingModel,ud.setLightDefines(l,i);}const h=s.overrideMaterial||l._material;o?(l._material.overrideRenderState=void 0,l.update(t,s,{}),l.render(t,i,s)):(h.overrideRenderState=a.pass1,l.update(t,s,{}),l.render(t,i,s),h.overrideRenderState=a.pass2,h instanceof e.PickColorMaterial&&(h.overrideRenderState.blending=e.renderStateEnum.disableBlending),l.update(t,s,{}),l.render(t,i,s)),l._afterRenderFunction&&l.afterRender(l._afterRenderFunction),h.overrideRenderState=void 0;}this._renderPrimitives=[];}parse(t,i,s,r,n){const o=xu({source:i?._source,layer:s,passType:r.passType}),a=i?.tilesForRender||[];for(let e=0;e<a.length;e++){const t=a[e];t.animations&&t.animations.length>0&&(t.animations[0].isRunning||t.animations[0].play(),t.rootNode.updateMatrixWorld(!0));}this._renderPrimitives=n,this._renderPrimitives.forEach((i=>{(r.overrideMaterial||i._material).defines=o;let s=i.boundingVolume;e.defined(i.modelInstanceCollection)?s=i.modelInstanceCollection.boundingVolume:e.defined(i.animationModelInstanceCollection)&&(s=i.animationModelInstanceCollection.boundingVolume),t.options.showDebugBoundingBox&&this.createDebugBoundingBox(t,s,i.tileUid||i.id);}));}createDebugBoundingBox(e,t,i){if(!t)return;let s=e.style.debugBoundingBoxPrimitiveCollection.get(i);s||(s=Op.createDebugBoundingBoxPrimitive({painter:e,center:t.center,halfAxes:t.halfAxes,id:i})),e.style.debugBoundingBoxPrimitiveCollection.add(s);}static _createRenderState(e,t){return Lp.parseRenderState(e,t)}destroy(){this.programId=void 0,this._renderPrimitives=void 0;}}class Vp extends yu{constructor(e){super(e),this._renderPrimitives=[],this.plotterType="line",this.lastCoords=[];}update(t,i,s,r,n){if(void 0===s.paint)return;if(n.overrideMaterial instanceof e.PickColorMaterial)return;const o=s.paint.get("line-opacity")||s.paint.get("tracking-opacity")||s.paint.get("sprite-opacity"),a=s.paint.get("line-width")||s.paint.get("tracking-width")||s.paint.get("sprite-width");if(0===o.constantOr(1)||0===a.constantOr(1))return;const l=i.getSource();l.animationsInfo={},"trips"===s.paint.get("tracking-type")&&this._updateAnimation(l),this.parse(t,i,s,r,n,l.animationsInfo),this.render(t,s,n,l.animationsInfo);}render(e,t,i,s){const r=Tu[i.passType](this._renderPrimitives);for(let n=0;n<r.length;n++){const o=r[n],a=o._material.isBorder;a&&(o.update(e,i,{animationsInfo:s}),o.render(e,t,i)),a&&(o._material.isBorder=!1),o.update(e,i,{animationsInfo:s}),o.render(e,t,i),a&&(o._material.isBorder=!0);}this._renderPrimitives=[],e.tileClippingMask.status=!1;}parse(t,i,s,r,n,o){if(r.length>0){"tracking"===s.type&&Kh.updateLayerProperty(s,t);const a=xu({source:null,layer:null,isInstance:!1,passType:n.passType,animationsInfo:o}),l=pu.getVectorLineDefinition(null,s);e.extend(a,l);for(let e=0;e<r.length;e++){const n=r[e],o=i.getTile(n);if(!o.getBucket(s))continue;const l=o.primitiveMap.get(s.id);if(!l)continue;const h=this._createRenderState(t,s,n),_=l.line;_&&Array.isArray(_)||(_._material.defines=a,_._material.renderState=h,this._renderPrimitives.push(_));}}}_createRenderState(t,i){const s=Vp.parseRenderState(t,i);return s.cull=e.renderStateEnum.disableCull,s}destroy(){this.programId=void 0,this._renderPrimitives=void 0,this.plotterType=void 0;}_updateAnimation(e){if(!e.animationPropertyCollection||0===e.animationPropertyCollection.size)return;const t=e?.animationPropertyCollection,i=t.getAll();1===i.length&&i[0].updateAnimation(e);}}const Np=new e.Vector3(1,0,0);class Fp extends yu{constructor(e){super(e),this.sourceType=void 0,this._renderPrimitives=[],this.programId="sphereRaster",this.plotterType="raster";}update(e,t,i,s,r){this.parse(e,t,i,s),this.render(e,i,r);}render(t,i,s){const r=Tu[s.passType](this._renderPrimitives);if(t._map.analysis.excavationCollection.length>0){t._map.analysis.excavationCollection.update(t,r,i);for(let t=0;t<r.length;t++)r[t]._material.renderState.stencilMask=255,r[t]._material.renderState.stencilTest={enabled:!0,frontFunction:e.WebGLConstants.EQUAL,backFunction:e.WebGLConstants.EQUAL,reference:0,mask:255,frontOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.KEEP},backOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.KEEP}};}for(const n of i)if(n.maskingEnabled){const i=n.maskingPolygonPrimitive;i&&(i._material.renderState.depthTest=e.renderStateEnum.disableDepthTest,i.update(t,s),i.render(t,n,s));for(let t=0;t<r.length;t++)r[t]._material.renderState.stencilMask=255,r[t]._material.renderState.stencilTest={enabled:!0,frontFunction:e.WebGLConstants.EQUAL,backFunction:e.WebGLConstants.EQUAL,reference:n.maskingId,mask:255,frontOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.REPLACE},backOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.REPLACE}};}for(let e=0;e<r.length;e++){const n=r[e];n.update(t,s),n.render(t,i,s);}this._renderPrimitives=[];}parse(t,i,s){const r={};let n=!1,o=new e.Vector4,a=0,l=s.length;for(const t of s)r[t.id]=t,t.type!==e.VectorLayerType.BACKGROUND||t.getPaintProperty("background-terrain-analysis")?t.type===e.VectorLayerType.RASTER&&(t.layerIndex=a++):(n=!0,o=e.Vector4.fromColor(e.Color.parse(t.paint.get("background-color"))),o.w=t.paint.get("background-opacity"));const h=t.style.rasterSourceCache._tiles;let _=!1;const c=s.length>0?this._createRenderState(t,s[0]):{blending:e.renderStateEnum.enableBlending,depthRange:e.renderStateEnum.depthRange,stencilTest:e.renderStateEnum.disableStencilTest,stencilMask:e.renderStateEnum.disableStencilMask,depthTest:e.renderStateEnum.enableDepthTest,depthMask:e.renderStateEnum.enableDepthMask};for(const i in h){const a=h[i];if(a.terrain&&"replaced"!==a.terrain.state&&t.style.rasterSourceCache.ambiguousSet.has(i))continue;if(!a.primitive)continue;a.proxyImage&&(a.proxyImage.imagery?.texture?.isDestroyed()?a.proxyImage=void 0:t.frameState.passType===e.RenderPassConsts.PICK_PASS?(a.proxyImage.opacity=0,a.proxyImage.brightnessMax=1,a.proxyImage.brightnessMin=0,a.proxyImage.contrast=1,a.proxyImage.saturation=0,a.proxyImage.spinWeight=Np):(a.proxyImage.opacity=1,a.proxyImage.brightnessMax=1,a.proxyImage.brightnessMin=0,a.proxyImage.contrast=1,a.proxyImage.saturation=0,a.proxyImage.spinWeight=Np),r[t.style.proxySourceCache.beforeRaster]&&(l=r[t.style.proxySourceCache.beforeRaster].layerIndex-1));const m=[];let p,f=!1;a.isOpacity=!1;for(const e of a.images){const t=r[e.layerId];t?(e.opacity=t.paint.get("raster-opacity"),e.brightnessMin=t.paint.get("raster-brightness-min"),e.brightnessMax=t.paint.get("raster-brightness-max"),e.saturation=(u=t.paint.get("raster-saturation"))>0?1-1/(1.001-u):-u,e.contrast=(d=t.paint.get("raster-contrast"))>0?1/(1-d):1+d,e.spinWeight=Gp(t.paint.get("raster-hue-rotate")),t.lightingModel&&(p=t.lightingModel),_=t.depthTest,e.opacity>.99&&(a.isOpacity=!0),a.proxyImage&&!f&&l<t.layerIndex&&(m.push(a.proxyImage),f=!0),m.push(e)):(e.opacity=0,e.brightnessMin=0,e.brightnessMax=1,e.saturation=0,e.contrast=1,e.spinWeight=Np);}null===t.style.proxySourceCache.beforeRaster&&a.proxyImage&&m.push(a.proxyImage),a.orderedImages=m,a.backgroundColor=o;const g=pu.getRasterSourceAndLayerMicroDefinition();g.HAS_BACKGROUNDLAYER=n;const y=_||t.style.map.style.hasTerrainData;s.length>0&&(g.NW_DISCARD=y&&e.defined(a.isAncestor)&&a.childDiscard[0]>0,g.NE_DISCARD=y&&e.defined(a.isAncestor)&&a.childDiscard[1]>0,g.SW_DISCARD=y&&e.defined(a.isAncestor)&&a.childDiscard[2]>0,g.SE_DISCARD=y&&e.defined(a.isAncestor)&&a.childDiscard[3]>0);const T=a.primitive;T&&(T._material.renderState=c,T._material.defines=g,ud.setLightDefines(T,{lightingModel:p}),t.options.showDebugBoundingBox&&this.createDebugBoundingBox(t,T.boundingBox,i),this._renderPrimitives.push(T));}var d,u;}_createRenderState(t,i){const s={};return s.blending=e.renderStateEnum.enableBlending,s.depthRange=e.renderStateEnum.depthRange,s.stencilTest=e.renderStateEnum.disableStencilTest,s.stencilMask=e.renderStateEnum.disableStencilMask,s.cull=e.renderStateEnum.enableCull,s.frontFace=e.WebGLConstants.CCW,i.depthTest||t.style.map.style.hasTerrainData?(s.depthTest=e.renderStateEnum.enableDepthTest,s.depthMask=e.renderStateEnum.enableDepthMask):(s.cull=e.renderStateEnum.enableCull,s.frontFace=e.WebGLConstants.CCW,s.depthTest=e.renderStateEnum.disableDepthTest,s.depthMask=e.renderStateEnum.disableDepthMask),t._map.enableUnderGround&&(s.cull=e.renderStateEnum.disableCull),s}destroy(){this.sourceType=void 0,this._renderPrimitives=void 0,this.programId=void 0,this.plotterType=void 0;}createDebugBoundingBox(e,t,i){if(!t)return;let s=e.style.debugBoundingBoxPrimitiveCollection.get(i);s||(s=Op.createDebugBoundingBoxPrimitive({painter:e,center:t.center,halfAxes:t.halfAxes,id:i})),e.style.debugBoundingBoxPrimitiveCollection.add(s);}}function Gp(t){t*=Math.PI/180;const i=Math.sin(t),s=Math.cos(t);return new e.Vector3((2*s+1)/3,(-Math.sqrt(3)*i-s+1)/3,(Math.sqrt(3)*i-s+1)/3)}class kp extends yu{constructor(e){super(e),this._renderPrimitives=[],this.plotterType="circle";}update(e,t,i,s,r){this.parse(e,t,i,s,r),this.render(e,t,i,s,r);}render(e,t,i,s,r){const n=Tu[r.passType](this._renderPrimitives);for(let t=0;t<n.length;t++){const s=n[t];s.update(e,r),s.render(e,i,r);}this._renderPrimitives=[],e.tileClippingMask.status=!1;}parse(t,i,s,r,n){if(r.length>0){const o=xu({source:null,layer:null,isInstance:!1,passType:n.passType}),a=pu.getSphereCircleDefinition(null,s);e.extend(o,a);for(let e=0;e<r.length;e++){const n=i.getTile(r[e]).primitiveMap.get(s.id);n&&(n._material.renderState=this._createRenderState(t,s),n._material.defines=o,this._renderPrimitives.push(n));}}}_createRenderState(t,i){const s=kp.parseRenderState(t,i);return s.cull=e.renderStateEnum.disableCull,s}destroy(){this.isPlotter=void 0,this.plotterType=void 0,this._renderPrimitives=void 0;}}class Up{constructor(){this.texMap=new Map;}getTexture(t){const i=e.defaultValue(t.name,""),s=e.defaultValue(t.texUrl,"");let r=i;""==i&&(r=s);const n=this.texMap.get(r);if(n)return n.addReference(),n;{const i=new e.Texture(t);return r&&""!=r&&this.texMap.set(r,i),i}}getTextureByName(e){const t=this.texMap.get(e);return t&&t.addReference(),t}addTexture(e,t){e&&""!=e&&this.texMap.set(e,t);}removeTexture(e){const t=this.texMap.get(e);t&&(t.reduceReference(),0===t.referenceCount&&(this.texMap.delete(e),t.destroy()));}}class Hp{constructor(t){this.context=t.context,this.map=t.savedMap;const{gl:i}=this.context,s=i.getExtension("EXT_SRGB"),r=s?s.SRGB_EXT:e.WebGLConstants.RGBA,n=this.map.getStyle(),o="minemap://assets/IBLtextures_BlueSky";this.IBLUrl=(e=>{if(!xt(e))return e;const t=Pt(e);return `${yt.SRC_URL}/${t.authority}${t.path}`})(n.IBL?n.IBL:o),n.IBL||this.map.testMode||e.warnOnce(`map.style has no IBL defined, minemap.js sets the default value to ${o}`),this.getIBLImage(`${this.IBLUrl}/SkyBox0/brdfLUT.png`,r,i),this.mDiffuseEnvTex=this.loadCubeMap(i,"diffuse"),this.mSpecularEnvTex=this.loadCubeMap(i,"specular"),this.isLoaded=!0;}async getIBLImage(t,i){const s=await(()=>new Promise(((i,s)=>{e.getImage(this.map._transformRequest(t,e.ResourceType.Image),((e,t)=>{e&&s(e),i(t);}));})))();if(!(s.nodeName||s.width&&s.height))throw this.isLoaded=!1,new Error("load IBL image error");{const t=new e.Texture({context:this.context,image:s,pixelFormat:i,useMipmap:!1});t.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),this.mBrdfTex=t;}}loadCubeMap(t,i){const s=t.getExtension("EXT_SRGB"),r=t.createTexture();let n=-1,o=e.WebGLConstants.TEXTURE0,a=0;if("diffuse"===i?(o=e.WebGLConstants.TEXTURE1,n=1,a=1):"specular"===i?(o=e.WebGLConstants.TEXTURE2,n=2,a=1):"environment"===i&&(o=e.WebGLConstants.TEXTURE0,n=0,a=1),-1===n)return null;t.activeTexture(o),t.bindTexture(e.WebGLConstants.TEXTURE_CUBE_MAP,r),t.texParameteri(e.WebGLConstants.TEXTURE_CUBE_MAP,e.WebGLConstants.TEXTURE_WRAP_S,e.WebGLConstants.CLAMP_TO_EDGE),t.texParameteri(e.WebGLConstants.TEXTURE_CUBE_MAP,e.WebGLConstants.TEXTURE_WRAP_T,e.WebGLConstants.CLAMP_TO_EDGE),a<2?(t.texParameteri(e.WebGLConstants.TEXTURE_CUBE_MAP,e.WebGLConstants.TEXTURE_MIN_FILTER,e.WebGLConstants.LINEAR),t.texParameteri(e.WebGLConstants.TEXTURE_CUBE_MAP,e.WebGLConstants.TEXTURE_MAG_FILTER,e.WebGLConstants.LINEAR)):(t.texParameteri(e.WebGLConstants.TEXTURE_CUBE_MAP,e.WebGLConstants.TEXTURE_MIN_FILTER,e.WebGLConstants.LINEAR_MIPMAP_LINEAR),t.texParameteri(e.WebGLConstants.TEXTURE_CUBE_MAP,e.WebGLConstants.TEXTURE_MAG_FILTER,e.WebGLConstants.LINEAR));const l=`${this.IBLUrl}/SkyBox0/${i}/${i}`;for(let i=0;i<a;i++){const n=[[`${l}_right_${i}.jpg`,e.WebGLConstants.TEXTURE_CUBE_MAP_POSITIVE_X],[`${l}_left_${i}.jpg`,e.WebGLConstants.TEXTURE_CUBE_MAP_NEGATIVE_X],[`${l}_top_${i}.jpg`,e.WebGLConstants.TEXTURE_CUBE_MAP_POSITIVE_Y],[`${l}_bottom_${i}.jpg`,e.WebGLConstants.TEXTURE_CUBE_MAP_NEGATIVE_Y],[`${l}_front_${i}.jpg`,e.WebGLConstants.TEXTURE_CUBE_MAP_POSITIVE_Z],[`${l}_back_${i}.jpg`,e.WebGLConstants.TEXTURE_CUBE_MAP_NEGATIVE_Z]];for(let e=0;e<n.length;e++)this.loadCubeImage(0,n[e][1],n[e][0],o,s,r,t);}return new Fu({context:this.context,texture:r})}async loadCubeImage(t,i,s,r,n,o,a){const l=await(()=>new Promise(((t,i)=>e.getImage(this.map._transformRequest(s,e.ResourceType.Image),((e,s)=>{e&&i(e),t(s);})))))();if(l.nodeName||l.width&&l.height)this.onLoadEnvironmentURLImage(r,n,o,i,l,t,a);else if(l)throw this.isLoaded=!1,new Error("load IBL image error")}onLoadEnvironmentURLImage(t,i,s,r,n,o,a){const l=i?i.SRGB_EXT:e.WebGLConstants.RGBA;a.activeTexture(t),a.bindTexture(e.WebGLConstants.TEXTURE_CUBE_MAP,s),a.pixelStorei(e.WebGLConstants.UNPACK_FLIP_Y_WEBGL,!1),a.texImage2D(r,o,l,l,e.WebGLConstants.UNSIGNED_BYTE,n),s[r]=!0;}}class zp extends e.Material{constructor(e){super(e),this.type="distanceMaterial",this.renderState=this._createRenderState(),this.dirty=!1,this.bUniformCreated=!1;}update(e,t,i={}){super.update(e,t,i),this._updateDefines(i.primitive,e),this.bUniformCreated||this._createUniform();}_updateDefines(t,i){this.defines={JOINT_MATRIX_CNT:e.defaultValue(t?._material?.defines?.JOINT_MATRIX_CNT,!1),INSTANCE_MATRIX:e.defaultValue(t?._material?.defines?.INSTANCE_MATRIX,!1),USE_MORPHTARGETS:e.defaultValue(t?._material?.defines?.USE_MORPHTARGETS,!1),LOG_DEPTH:e.defaultValue(i._logDepth,!1)};}_createRenderState(){return {cull:{enabled:!1},depthTest:{enabled:!0,func:e.WebGLConstants.LESS},blending:e.renderStateEnum.disableBlending,stencilTest:{enabled:!1,frontFunction:e.WebGLConstants.ALWAYS,backFunction:e.WebGLConstants.ALWAYS,reference:0,mask:0,frontOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.REPLACE},backOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.REPLACE}}}}_createUniform(){this.bUniformCreated=!0;}destroy(){return this.type=void 0,this._renderState=void 0,this.dirty=void 0,this.bUniformCreated=void 0,this._uniforms=void 0,this._programConfiguration=void 0,this._shaderSource.destroy(),this._shaderSource=void 0,this.layer=void 0,this._pickColor=void 0,this._usePickColorTexture=void 0,this._isOneDimensionBatchTexture=void 0,this._pickTextureUniformsCallBack=void 0,e.destroyObject(this)}}function Wp(e){return (e[0]+e[1]/255+e[2]/65025+e[3]/16581375)/255}class jp extends Nd{constructor(e){super(e),this.replaceMaterial=new zp({});}update(e,t,i){e.frameState.overrideMaterial=this.replaceMaterial,super.update(e,t,i);}createFramebuffer({width:e,height:t,context:i}){return super.createFramebuffer({width:e,height:t,context:i})}initSize(t,i){e.defined(this.width)&&e.defined(this.height)||(this.width=t,this.height=i,this.bufferSize=this.width*this.height*4);}render(e){const{painter:t}=e,{context:i,frameState:s}=t,r=t.frameState.framebuffer,{width:n,height:o}=t.getMaxFramebufferSize();this.initSize(Math.floor(n/20),Math.floor(o/20)),this.update(t,this.width,this.height),super.middleRender(t,i,s),t.frameState.overrideMaterial=void 0,t.frameState.update({framebuffer:r}),t.frameState.bindFramebuffer(i);}getDistance(t){if(!this.height||!this.width)return Number.MAX_VALUE;const i=Fd({x:0,y:this.height/e.window.devicePixelRatio,height:this.height,width:this.width},t,this.framebuffer,this.height,e.WebGLConstants.UNSIGNED_BYTE,this.bufferSize),s=new e.Vector4,r=new e.Vector4(1,1/255,1/65025,1/16581375);let n=Number.MAX_VALUE;for(let e=0;e<this.bufferSize;e+=4){if(0==i[e]&&0==i[e+1]&&0==i[e+2]&&0==i[e+3])continue;s.set(i[e],i[e+1],i[e+2],i[e+3]);const t=s.dot(r);n=Math.min(n,64.25*t);}return n<=0?.01:n}readPixel(e,t){return Wp(Fd(e,t,this.framebuffer,this.height))}}class Xp extends Nd{constructor(t){super(t),this.replaceMaterial=new e.DepthMaterial({});}update(e,t,i){e.frameState.overrideMaterial=this.replaceMaterial;const{context:s}=e;this.width===t&&this.height===i&&this.framebuffer||(this.framebuffer&&this.framebuffer.destroy(),this.framebuffer=this.createFramebuffer({width:t,height:i,context:s})),e.frameState.update({framebuffer:this.framebuffer}),e.frameState.bindFramebuffer(s),this.width=t,this.height=i;}createFramebuffer({width:t,height:i,context:s}){const r={width:t,height:i,context:s,pixelFormat:e.WebGLConstants.RGBA,pixelDatatype:e.WebGLConstants.FLOAT};return s.extColorBufferFloat||delete r.pixelDatatype,new Od({context:s,width:t,height:i,colorTextures:[new e.Texture(r)]})}render(t){const{painter:i}=t,{context:s,mainPass:r,backgroundPass:n}=i,o=i.frameState.framebuffer,a=i.frameState.passType,{width:l,height:h}=i.getMaxFramebufferSize();this.update(i,l,h),s.clear({color:e.Color.white,depth:1,stencil:0}),this._uniforms||(this._uniforms=new Map([["u_ModelViewProjectionMatrix",()=>(new e.Matrix4).ortho({left:0,right:s.drawingBufferWidth,bottom:s.drawingBufferHeight,top:0,near:0,far:1})],["u_BaseColorSampler",()=>r.framebuffer.depthStencilTexture],["u_BackgroundSampler",()=>n.framebuffer.depthStencilTexture],["u_World",()=>new e.Vector2(s.drawingBufferWidth,s.drawingBufferHeight)]])),this.geometry=new vu(i),this.material={renderState:e.RenderState.fromCache({depthTest:{enabled:!1},depthMask:!1,blending:e.renderStateEnum.disableBlending}),_uniforms:this._uniforms,_shaderSource:new e.ShaderSource({type:"showDepth"})},s.draw({painter:i,framebuffer:this.framebuffer.framebuffer,layer:{id:"depth"},geometry:this.geometry,material:this.material}),i.frameState.overrideMaterial=void 0,i.frameState.passType=a,i.frameState.update({framebuffer:o}),i.frameState.bindFramebuffer(s);}readPixel(t,i){const s=Fd(t,i,this.framebuffer,this.height,i.extColorBufferFloat?e.WebGLConstants.FLOAT:e.WebGLConstants.UNSIGNED_BYTE);return i.extColorBufferFloat?s[0]:Wp(s)}}class qp extends Nd{constructor(t){super(t),this.replaceMaterial=new e.NormalMaterial({});}update(e,t,i){e.frameState.overrideMaterial=this.replaceMaterial,super.update(e,t,i);}createFramebuffer({width:t,height:i,context:s}){return new Od({context:s,width:t,height:i,colorTextures:[new e.Texture({width:t,height:i,context:s,pixelFormat:e.WebGLConstants.RGBA,pixelDatatype:e.PixelDatatype.UNSIGNED_BYTE})],depthStencilRenderbuffer:new Bd({context:s,width:t,height:i,format:Rd.DEPTH_STENCIL})})}render(e){const{painter:t}=e,{context:i,frameState:s}=t,r=t.frameState.framebuffer,{width:n,height:o}=t.getMaxFramebufferSize();this.update(t,n,o),super.middleRender(t,i,s),t.frameState.overrideMaterial=void 0,t.frameState.update({framebuffer:r}),t.frameState.bindFramebuffer(i);}readPixel(e,t){return Wp(Fd(e,t,this.framebuffer,this.height))}}class Kp extends e.Material{constructor(t){super(t),this.type="depthMaterial",this.renderState=this.createRenderState(),this.updateMVPMatrix=(t,i,s)=>{this._uniforms.set("u_ModelViewProjectionMatrix",(()=>{const i=t.transform.shadowCamera.vpMatrix.clone();return e.defined(s)?i.multiplyRight(s.matrixWorld):i}));};}createRenderState(){return {blending:{enabled:!1}}}}class Jp extends Nd{constructor(e){super(e),this.replaceMaterial=new Kp({});}update(e,t,i){e.frameState.overrideMaterial=this.replaceMaterial,super.update(e,t,i);}createFramebuffer({width:e,height:t,context:i}){return super.createFramebuffer({width:e,height:t,context:i})}render(e){const{painter:t}=e,{context:i,frameState:s}=t,r=t.frameState.framebuffer,{width:n,height:o}=t.getMaxFramebufferSize();this.update(t,n,o),super.middleRender(t,i,s),t.frameState.overrideMaterial=void 0,t.frameState.update({framebuffer:r}),t.frameState.bindFramebuffer(i);}readPixel(e,t){return Wp(Fd(e,t,this.framebuffer,this.height))}}class Zp extends Nd{constructor(t){super(t),this.replaceMaterial=new e.PickColorMaterial({});}update(e,t,i){e.frameState.overrideMaterial=this.replaceMaterial;const{context:s}=e;this.width===t&&this.height===i&&this.framebuffer&&!this._SSAASamplesDirty||(this.framebuffer&&this.framebuffer.destroy(),this.framebuffer=this.createFramebuffer({width:t,height:i,context:s}),this._SSAASamplesDirty=!1),e.frameState.update({framebuffer:this.framebuffer}),e.frameState.bindFramebuffer(s),this.bindDepthTexture(e),this.width=t,this.height=i;}createFramebuffer({width:t,height:i,context:s}){return new Od({context:s,width:t*this.SSAASamples,height:i*this.SSAASamples,colorTextures:[new e.Texture({width:t*this.SSAASamples,height:i*this.SSAASamples,context:s,pixelFormat:e.WebGLConstants.RGBA})]})}render(t){const{painter:i,ignoreNonePickPrimitive:s,vectorQuery:r}=t,{context:n,frameState:o}=i,a=i.frameState.framebuffer,{width:l,height:h}=i.getMaxFramebufferSize(),_=i.mainPass.SSAASamples;this.SSAASamples=_,this.update(i,l,h),e.RenderState.applyRenderState(n,e.RenderState.fromCache({viewport:{x:0,y:0,width:l*_,height:h*_}})),n.clear({color:e.Color.transparent,stencil:0}),i.renderGroup.update({layers:i.style._layers,orders:i.style._order,painter:i,frameState:o,ignoreNonePickPrimitive:s}),i.renderGroup.render({layers:i.style._layers,painter:i,frameState:o,vectorQuery:r}),i.frameState.overrideMaterial=void 0,i.frameState.update({framebuffer:a}),i.frameState.bindFramebuffer(n);}readPixel(e,t){return Fd(e,t,this.framebuffer,this.height,void 0,void 0,this.SSAASamples)}bindDepthTexture(t){if(!t.mainPass.framebuffer)return;const{gl:i}=t.context,s=t.mainPass.framebuffer.depthStencilTexture;i.framebufferTexture2D(e.WebGLConstants.FRAMEBUFFER,e.WebGLConstants.DEPTH_STENCIL_ATTACHMENT,s._target,s.texture,0);}}class Yp extends Nd{constructor(t){t.passType=e.RenderPassConsts.REAL_RENDER_PASS,super(t),this.width=32,this.height=32;}update(e,t,i){this.framebuffer||(this.framebuffer=this._createFramebuffer({width:t,height:i,context:e.context})),e.frameState.update({framebuffer:this.framebuffer}),this.cameraStatusStore=null;}_createFramebuffer({width:e,height:t,context:i}){return i.createFramebuffer(e,t)}render(t){const{painter:i,skybox:s}=t,r=i.context,n=r.gl;if(s.ready)return;this.update(i,this.width,this.height);const o=i.frameState.framebuffer,a=i.frameState.passType;i.frameState.passType=this.passType,i.frameState.bindFramebuffer(r),e.RenderState.applyRenderState(r,e.RenderState.fromCache({viewport:{x:0,y:0,width:this.width,height:this.height}})),r.clear({color:e.Color.transparent,depth:1,stencil:0});const l=new Fu({context:r,pixelFormat:e.WebGLConstants.RGBA,fboTextureParameter:{width:this.width,height:this.height}});for(let t=0;t<6;t++)n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,e.WebGLConstants.TEXTURE_CUBE_MAP_POSITIVE_X+t,l.texture,0),s.primitiveToGenerateTexture._material.setMatrixByFaces(e.CONSTS.SOURCE.TEXTURE_CUBE_KEYS[t]),i.renderGroup.executePaint({sourceCache:{},layer:{type:"3d-model",isHidden(){}},primitives:[s.primitiveToGenerateTexture],frameState:i.frameState});s.updateSkyCubeTexture(l),e.RenderState.applyRenderState(r,e.RenderState.fromCache({viewport:{x:0,y:0,width:i.width,height:i.height}})),i.frameState.passType=a,i.frameState.update({framebuffer:o}),i.frameState.bindFramebuffer(r);}}class Qp{constructor(t,i,s){this.texture=t.createTexture(),this._target=e.WebGLConstants.TEXTURE_CUBE_MAP,t.bindTexture(this._target,this.texture);for(let r=0;r<6;r++)t.texImage2D(e.WebGLConstants.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,e.WebGLConstants.RGBA,i,s,0,e.WebGLConstants.RGBA,e.WebGLConstants.UNSIGNED_BYTE,null);t.texParameteri(e.WebGLConstants.TEXTURE_CUBE_MAP,e.WebGLConstants.TEXTURE_MAG_FILTER,e.WebGLConstants.LINEAR),t.texParameteri(e.WebGLConstants.TEXTURE_CUBE_MAP,e.WebGLConstants.TEXTURE_MIN_FILTER,e.WebGLConstants.LINEAR),t.texParameteri(e.WebGLConstants.TEXTURE_CUBE_MAP,e.WebGLConstants.TEXTURE_WRAP_S,e.WebGLConstants.CLAMP_TO_EDGE),t.texParameteri(e.WebGLConstants.TEXTURE_CUBE_MAP,e.WebGLConstants.TEXTURE_WRAP_T,e.WebGLConstants.CLAMP_TO_EDGE),t.bindTexture(this._target,null);}}class $p extends Nd{constructor(t){t.passType=e.RenderPassConsts.REAL_RENDER_PASS,super(t),this.width=t.textureSize?t.textureSize:512,this.height=t.textureSize?t.textureSize:512;}update(e,t,i){this.framebuffer||(this.framebuffer=this._createFramebuffer({width:t,height:i,context:e.context})),e.frameState.update({framebuffer:this.framebuffer}),this.cameraStatusStore=null;}_createFramebuffer({width:e,height:t,context:i}){return i.createFramebuffer(e,t)}render(t){const{painter:i,cubeMap:s,position:r,near:n,far:o}=t,{frameState:a,context:h}=i,{gl:_}=h,c=i.frameState.camera,d=new l(90,1,n,o);this.update(i,this.width,this.height),i.frameState.bindFramebuffer(h),e.RenderState.applyRenderState(h,e.RenderState.fromCache({viewport:{x:0,y:0,width:this.width,height:this.height}})),h.clear({color:e.Color.transparent,depth:1,stencil:0});const u=new Qp(h.gl,this.width,this.height);this.renderCubeTexture(i,a,_,u,r,d),i.frameState.camera=c,s.cubeMap=u;}renderCubeTexture(t,i,s,r,n,o){for(let a=0;a<6;a++){s.clear(s.DEPTH_BUFFER_BIT),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,e.WebGLConstants.TEXTURE_CUBE_MAP_POSITIVE_X+a,r.texture,0);const l=e.Transforms.cartographicToFixedFrame(n);0==a?o.setMatrix(l.clone().rotateY(.5*-Math.PI).rotateZ(Math.PI)):1==a?o.setMatrix(l.clone().rotateY(.5*Math.PI).rotateZ(Math.PI)):2==a?o.setMatrix(l.clone().rotateX(.5*Math.PI)):3==a?o.setMatrix(l.clone().rotateX(.5*-Math.PI)):4==a?o.setMatrix(l.clone().rotateY(-Math.PI).rotateZ(Math.PI)):5==a&&o.setMatrix(l.clone().rotateZ(Math.PI)),t.frameState.camera=o,t.renderGroup.update({layers:t.style._layers,orders:t.style._order,frameState:i}),t.renderGroup.render({layers:t.style._layers,frameState:i});}}}class ef extends Nd{constructor(e){super(e);}update(e,t,i){e.frameState.passType=this.passType,super.update(e,t,i);}render(e){const{painter:t,ignoreNonePickPrimitive:i}=e,{context:s,frameState:r}=t,n=t.frameState.framebuffer,o=t.frameState.passType,{width:a,height:l}=t.getMaxFramebufferSize();this.update(t,a,l),super.middleRender(t,s,r,i),t.frameState.passType=o,t.frameState.update({framebuffer:n}),t.frameState.bindFramebuffer(s);}}class tf{constructor(e,t){this.painter=e,this.pass=t,this._init();}_init(){this.shaderSource=new e.ShaderSource({type:"screen"}),this.geometry=new vu(this.painter),this.uniforms=new Map([["u_World",()=>new e.Vector2(this.painter.context.drawingBufferWidth,this.painter.context.drawingBufferHeight)],["u_ModelViewProjectionMatrix",()=>(new e.Matrix4).ortho({left:0,right:this.painter.context.drawingBufferWidth,bottom:this.painter.context.drawingBufferHeight,top:0,near:0,far:1})],["u_BaseColorSampler",()=>{let t;return t=this.painter.usePostProcess?this.painter.postProcessStages.outputTexture:this.pass.framebuffer.getColorTexture(0),t.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),t}],["u_Resolution",()=>new e.Vector2(this.painter.width,this.painter.height)]]),this.renderState={depthTest:{enabled:!0,func:e.WebGLConstants.LESS},blending:{color:{red:0,green:0,blue:0,alpha:0},enabled:!1,equationRgb:e.WebGLConstants.FUNC_ADD,equationAlpha:e.WebGLConstants.FUNC_ADD,functionSourceRgb:e.WebGLConstants.SRC_ALPHA,functionSourceAlpha:e.WebGLConstants.ONE,functionDestinationRgb:e.WebGLConstants.ONE_MINUS_SRC_ALPHA,functionDestinationAlpha:e.WebGLConstants.ONE_MINUS_SRC_ALPHA},stencilTest:{enabled:!1,frontFunction:e.WebGLConstants.ALWAYS,backFunction:e.WebGLConstants.ALWAYS,reference:0,mask:0,frontOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.REPLACE},backOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.REPLACE}}};}resolveFramebufferToScreen(){this.painter.context.bindFramebuffer.set(null),this.painter.context.clear({color:this.painter._map._canvasTransparent?e.Color.transparent:e.Color.black,depth:1,stencil:0}),this.shaderSource._defines.SSAASamples=this.painter._map.SSAASamples,this.painter.context.draw({painter:this.painter,framebuffer:null,layer:{id:"resovescreeen"},geometry:this.geometry,material:{renderState:this.renderState,_uniforms:this.uniforms,_shaderSource:this.shaderSource}});}destroy(){this.uniforms=null,this.painter=null,this._segmentVector=null,this.pass=null,this.shaderSource=null;}}class sf{constructor(){this.framebuffer=void 0;}initialize(t){const i=t.context,s=t.width,r=t.height;this.framebuffer=new Od({context:i,width:s,height:r,colorTextures:[new e.Texture({width:s,height:r,context:i,pixelFormat:e.WebGLConstants.RGBA})],depthStencilRenderbuffer:new Bd({context:i,width:s,height:r,format:Rd.DEPTH_STENCIL})});}update(t){e.defined(this.framebuffer)||this.initialize(t);}destroy(){}}class rf extends Nd{constructor(t){t.passType=e.RenderPassConsts.REAL_RENDER_PASS,super(t);}update(e,t,i){}static render(t){const{painter:i,style:s}=t,{context:r}=i,{width:n,height:o}=i.getMaxFramebufferSize();if(!i||!s||!r)return;const a=i.frameState.framebuffer,l=i.frameState.passType;e.RenderState.applyRenderState(r,e.RenderState.fromCache({viewport:{x:0,y:0,width:n,height:o},blending:e.renderStateEnum.disableBlending})),r.clear({color:i._map._canvasTransparent?e.Color.transparent:e.Color.black,depth:1,stencil:0});const h=s.primitivePreRenderCollection.getAll();h.length>0&&i.renderGroup.executePaint({sourceCache:{},layer:{type:"3d-model",isHidden(){}},primitives:h,frameState:i.frameState}),i.frameState.passType=l,i.frameState.update({framebuffer:a}),i.frameState.bindFramebuffer(r);}}class nf extends yu{constructor(e){super(e),this._renderPrimitives=[],this.plotterType="tile-debug",this.layerId="tile-debug";}update(e,t,i,s,r){this.parse(e,t,i,s,r),this.render(e,t,i,s,r);}render(e,t,i,s,r){const n=Tu[r.passType](this._renderPrimitives);for(let t=0;t<n.length;t++){const i=n[t];i.update(e,r),i.render(e,{id:this.layerId},r);}this._renderPrimitives=[];}parse(e,t,i,s){if(s.length>0){let t=this._drawCommands.get(this.layerId);t||(t=this._drawCommands.set(this.layerId,new U)),this._createMaterial();const i={};for(let r=0;r<s.length;r++){const n=s[r],o=e.debugTileCache.getTileByCoord(n);if(!o)continue;const a=o.matrix,l=t.get(n.key);l?(l.line._material.defines=i,this._renderPrimitives.push(l.line),l.text._material.defines=i,this._renderPrimitives.push(l.text)):this._createPrimitive({painter:e,tile:o,tileID:n,modelMatrix:a,currentLayerDrawCommands:t});}}}_createPrimitive(t){const{painter:i,tile:s,tileID:r,modelMatrix:n,currentLayerDrawCommands:o}=t,a=this._createGeometry(s,i.style.rasterSourceCache.quadtree.getBoundingRegionById(r.key)),l=new e.Primitive({modelMatrix:n,geometry:a.lineGeom,material:this.redColorMaterial}),h=new e.Primitive({modelMatrix:n,geometry:a.textGeom,material:this.blackColorMaterial});this._renderPrimitives.push(l,h),o.set(r.key,{line:l,text:h});}_createMaterial(){if(!this.redColorMaterial||!this.blackColorMaterial){const t=this._createRenderState();this.redColorMaterial=new e.Material({type:"debug"}),this.redColorMaterial._uniforms.set("u_Color",(()=>new e.Vector4(1,1,0,1))),this.redColorMaterial.renderState=t,this.blackColorMaterial=new e.Material({type:"debug"}),this.blackColorMaterial._uniforms.set("u_Color",(()=>new e.Vector4(0,1,0,1))),this.blackColorMaterial.renderState=t;}}_createRenderState(){return e.TileDebugJSONRenderState}_createGeometry(t,i){return {lineGeom:new e.Geometry({vertexBuffer:t.debugBuffer,segmentVector:e.SegmentVector.simpleSegment(0,0,t.lineVerticesCount,0),primitiveType:e.WebGLConstants.LINE_STRIP,tileBoundingRegion:i}),textGeom:new e.Geometry({vertexBuffer:t.debugBuffer,segmentVector:e.SegmentVector.simpleSegment(t.lineVerticesCount,0,t.textVerticesCount,0),primitiveType:e.WebGLConstants.LINES,tileBoundingRegion:i})}}removePrimitive(e){const t=e.tileID.key,i=this._drawCommands.get(this.layerId);if(i){const e=i.remove(t);e.line&&e.line.destroy(),e.text&&e.text.destroy();}}removeAllPrimitives(){const e=this._drawCommands.get(this.layerId).values;for(let t=0;t<e.length;t++)e[t].line&&e[t].line.destroy(),e[t].text&&e[t].text.destroy();this._drawCommands.remove(this.layerId),this.blackColorMaterial=void 0,this.redColorMaterial=void 0;}destroy(){this.isPlotter=void 0,this.plotterType=void 0,this._drawCommands=void 0,this._renderPrimitives=void 0;}}class of{constructor(t){t=t||{},this.type="scene-object",this.id=`skybox-${e.uniqueId()}`,this.isSceneObject=!0,this._ready=!1,this.initialized=!1,this.cubeMap=void 0,this.init(t.painter);}init(t){const{context:i}=t;this.geometry=new Nu({context:i}),this._cubeMapRenderingMaterial=new ku({type:"skyboxCapture"}),this.primitiveToGenerateTexture=new e.Primitive({material:this._cubeMapRenderingMaterial,geometry:this.geometry,allowPick:!1});}getPrimitiveForPass(){return this.primitiveToGenerateTexture}updateSkyCubeTexture(e){this._skyMaterial._fboTextureCube=e,this._ready=!0;}async _requestBoxImages(t,i){const s=e.CONSTS.SOURCE.TEXTURE_CUBE_KEYS,r=[];for(let n=0;n<6;n++){const o=new Promise(((r,o)=>{e.getImage(t._map._transformRequest(i[s[n]],e.ResourceType.Image),((e,t)=>{e&&o(e),r(t);}));}));r.push(o);}const n=await Promise.all(r),o={};for(let e=0;e<s.length;e++)o[s[e]]=n[e];return this._createTexture(t,o)}async _requestSingleImage(t,i){const s=new Promise(((s,r)=>{e.getImage(t._map._transformRequest(i,e.ResourceType.Image),((e,t)=>{e&&r(e),s(t);}));})),r=await s;return this._createTexture(t,r)}async _createTexture(t,i){const s=new Fu({context:t.context,images:i,pixelFormat:e.WebGLConstants.RGBA});return s.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE),s}async _prepareTextures(e){this.starrySkyTextureUrls&&(this._skyMaterial.starrySkyTexture=await this._requestBoxImages(e,this.starrySkyTextureUrls)),this.dayTextureUrls&&(this._skyMaterial.dayTexture=await this._requestBoxImages(e,this.dayTextureUrls));}prepare(e){e.shaderProgramManager.setGlobalMacroDefinition({SKYBOX_CUBE_MAP_G:this.isCubeMap}),this._ready=!0;}get ready(){return this._ready}set ready(e){this._ready=e;}onAdd(e){this.init({painter:e.painter});}loaded(){return this._ready}destroy(){this.primitive.destroy(),this.primitiveToGenerateTexture.destroy();}collect(){return this._ready?[this.primitive]:[]}}class af extends Xo{constructor(){super(new l(90,1,.5,500)),this._frameExtents=new e.Vector2(4,2),this._viewportCount=6,this._viewports=[new e.Vector4(2,1,1,1),new e.Vector4(0,1,1,1),new e.Vector4(3,1,1,1),new e.Vector4(1,1,1,1),new e.Vector4(3,0,1,1),new e.Vector4(1,0,1,1)],this._cubeDirections=[new e.Vector3(1,0,0),new e.Vector3(-1,0,0),new e.Vector3(0,0,1),new e.Vector3(0,0,-1),new e.Vector3(0,1,0),new e.Vector3(0,-1,0)],this._cubeUps=[new e.Vector3(0,1,0),new e.Vector3(0,1,0),new e.Vector3(0,1,0),new e.Vector3(0,1,0),new e.Vector3(0,0,1),new e.Vector3(0,0,-1)];}updateMatrices(e,t,i){const s=this.camera,r=this.matrix,n=this._lightPositionWorld,o=this._lookTarget;let a=this._projScreenMatrix;n.setFromMatrixPosition(e.matrixWorld),s.position.copy(n),o.copy(s.position),o.add(this._cubeDirections[i]),s.up.copy(this._cubeUps[i]),s.lookAt(o),s.updateMatrixWorld(),r.makeTranslation(-n.x,-n.y,-n.z),a=s.projectionMatrix.clone().multiplyRight(s.matrixWorldInverse),this._frustum.setFromMatrix(a);}}class lf extends jo{constructor(e,t){super(e,t),this.type="PointLight",this.isPointLight=!0,this.shadow=new af;}setPosition(t){this.position=e.Vector3.unpack(t);}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI);}serialize(){return {color:e.Vector3.pack(this.color,new Array(3)),intensity:this.intensity,position:e.Vector3.pack(this.position,new Array(3)),distane:this.distane,decay:this.decay,type:this.type}}}class hf extends e.Material{constructor(t){t.type="mirrorMaterial",super(t),this.renderState=this._createRenderState(),this._reflectNear=e.defaultValue(t.reflectNear,1),this._reflectFar=e.defaultValue(t.reflectFar,1e3);}enableSSR(){this._enableSSR=!0;}disableSSR(){this._enableSSR=!1;}update(e,t,i={}){super.update(e,t,i),this._uniforms.set("u_EnvMap",(()=>{if(null!=e.cubeMapCollection[this.id])return e.cubeMapCollection[this.id].cubeMap}));}createRenderState(){const t={};return t.depthTest=e.renderStateEnum.disableDepthTest,t.depthMask=e.renderStateEnum.disableDepthMask,t.stencilTest=e.renderStateEnum.disableStencilTest,t}_createRenderState(){const t=e.Material.getDefaultRenderState();return t.cull.enabled=!0,t.polygonOffset={enabled:!0,factor:1,units:1},t}set reflectNear(e){this._reflectNear=e;}get reflectNear(){return this._reflectNear}set reflectFar(e){this._reflectNear=e;}get reflectFar(){return this._reflectFar}serialize(){return {reflectFar:this._reflectFar,reflectNear:this._reflectNear}}destroy(){}}class _f extends $p{constructor(t){super(t),this.replaceMaterial=new e.DepthMaterial({}),this.replaceMaterial.defines.DEPTH_DISTANCE=!0;}update(e,t,i){e.frameState.overrideMaterial=this.replaceMaterial,super.update(e,t,i);}render(e){super.render(e),e.painter.frameState.overrideMaterial=null;}}class cf extends Nd{constructor(e){super(e);}update(e,t,i){e.frameState.passType=this.passType;const{context:s}=e;this.width===t&&this.height===i&&this.framebuffer||(this.framebuffer&&this.framebuffer.destroy(),this.framebuffer=this.createFramebuffer({width:t,height:i,context:s})),e.frameState.update({framebuffer:this.framebuffer}),e.frameState.bindFramebuffer(s),this.width=t,this.height=i;}createFramebuffer({width:t,height:i,context:s}){const r=new e.Sampler({minificationFilter:e.TextureMinificationFilter.NEAREST,magnificationFilter:e.TextureMagnificationFilter.NEAREST});return new Od({context:s,width:t,height:i,colorTextures:[new e.Texture({width:t,height:i,context:s,pixelFormat:e.WebGLConstants.RGBA})],depthStencilTexture:new e.Texture({context:s,width:t,height:i,minFilter:e.WebGLConstants.LINEAR,magFilter:e.WebGLConstants.LINEAR,pixelFormat:e.PixelFormat.DEPTH_STENCIL,pixelDatatype:e.PixelDatatype.UNSIGNED_INT_24_8,sampler:r,anisotropy:1,name:"background_depth_stencil"})})}render(t){const{painter:i}=t,{context:s}=i,r=i.frameState.framebuffer,n=i.frameState.passType,{width:o,height:a}=i.getMaxFramebufferSize();this.update(i,o,a),e.RenderState.applyRenderState(s,e.RenderState.fromCache({viewport:{x:0,y:0,width:o,height:a}})),s.clear({color:e.Color.white,depth:1,stencil:0}),i.renderGroup.executePaint({sourceCache:{},layer:[],frameState:i.frameState,coords:[]}),i.frameState.passType=n,i.frameState.update({framebuffer:r}),i.frameState.bindFramebuffer(s);}readPixel(t,i){return Fd(t,i,this.framebuffer,this.height,e.WebGLConstants.UNSIGNED_BYTE)}}const df=new e.ProgramConfiguration;class uf{constructor(t,i){this.textureResourceManager=new Up,this.context=new Dm(t,this),this.transform=i.transform,this.transform.shadowCamera._painter=this,this.setup(),this._logDepth=i._logDepth,this.context._logDepth=this._logDepth,this.shadowOff=e.CONSTS.EFFECTS.SHADOW_OFFSET,this._map=i,this.emptyTileTextureCanvas=null,this.shaderProgramManager=new pu({context:this.context}),this.fillPlotter=new wp({}),this.extrusionPlotter=new Ip({}),this.tileClippingMask=new Ap,this.symbolPlotter=new Bp({}),this.modelPlotter=new Lp({}),this.linePlotter=new Vp({}),this.debugBoundingBoxPlotter=new Op({}),this.rasterPlotter=new Fp({}),this.circlePlotter=new kp({}),this.heatmapPlotter=new Au({}),this.debugTilePlotter=new nf({}),this.plotterMap={[e.VectorLayerType.SYMBOL]:this.symbolPlotter,[e.VectorLayerType.SYMTRACKING]:this.symbolPlotter,[e.VectorLayerType.LINE]:this.linePlotter,[e.VectorLayerType.SPRITE]:this.linePlotter,[e.VectorLayerType.TRACKING]:this.linePlotter,[e.VectorLayerType.DYNAMIC_LINE]:this.linePlotter,[e.VectorLayerType.FILL]:this.fillPlotter,[e.VectorLayerType.RASTER]:this.rasterPlotter,[e.VectorLayerType.MODEL]:this.modelPlotter,[e.VectorLayerType.EXTRUSION]:this.extrusionPlotter,[e.VectorLayerType.HISTOGRAM]:this.extrusionPlotter,[e.VectorLayerType.CIRCLE]:this.circlePlotter,[e.VectorLayerType.DEBUG_TILE]:this.debugTilePlotter,[e.VectorLayerType.HEATMAP]:this.heatmapPlotter},this.renderGroup=new Pp({layers:{},orders:[],painter:this}),this.backgroundPass=new cf({passType:e.RenderPassConsts.PICK_PASS}),this.distancePass=new jp({context:this.context,passType:e.RenderPassConsts.PICK_PASS}),this.depthPass=new Xp({context:this.context,passType:e.RenderPassConsts.PICK_PASS}),this.commonDepthPass=new Xp({context:this.context,passType:e.RenderPassConsts.PICK_PASS}),this.normalPass=new qp({context:this.context,passType:e.RenderPassConsts.PICK_PASS}),this.shadowPass=new Jp({context:this.context,passType:e.RenderPassConsts.PICK_PASS}),this.mainPass=new ef({passType:e.RenderPassConsts.REAL_RENDER_PASS}),this.ssrPass=new ef({passType:e.RenderPassConsts.REAL_RENDER_PASS}),this.colorPass=new Zp({context:this.context,passType:e.RenderPassConsts.PICK_COLOR_PASS}),this.frameState=new Vd,this.resolveFramebuffer=new tf(this,this.mainPass),this.postProcessStages=new fp({fogNearFunction:()=>{if(i._cameraUnderground)return 25e4;const e=1.25*i.camera.cartographicPosition[2];return e<250?250:e},fogFarFunction:()=>{if(i._cameraUnderground)return 5e5;let t=25*i.camera.cartographicPosition[2];return t=t<5e3?5e3:t,i.transform.pitch*e.CONSTS.TRANSFORM.DEG_TO_RAD>70*e.CONSTS.TRANSFORM.DEG_TO_RAD&&t>i.transform.far&&(t=i.transform.far),t}}),this.usePostProcess=!1,this.usePostProcessSelected=!1,this.postProcessFramebuffer=new sf,this.shadowOptions={EPSILON:.005,MapSizeScale:.1},this.cubeMapCollection={},this.cubeMapRenderPassCollection={};}setShadowOptions(e,t){this.shadowOptions[e]=t;}get iBLTextures(){return this._iBLTextures||(this._iBLTextures=new Hp({context:this.context,savedMap:this._map})),this._iBLTextures}get getAllPlotter(){return [this.symbolPlotter,this.fillPlotter,this.modelPlotter,this.debugBoundingBoxPlotter,this.linePlotter,this.rasterPlotter,this.circlePlotter,this.heatmapPlotter,this.extrusionPlotter,this.debugTilePlotter]}getPlotterByKey(e){return this.plotterMap[e]}get projection(){return this._projection}set projection(t){t!==e.ProjectionType.MERCATOR&&t!==e.ProjectionType.LATLON||(this._projection=t);}getMaxFramebufferSize(){let t=this.width,i=this.height;const s=Math.min(e.ContextLimits.maximumViewportWidth,e.ContextLimits.maximumRenderbufferSize),r=Math.min(e.ContextLimits.maximumViewportHeight,e.ContextLimits.maximumRenderbufferSize);return (this.width>s||this.height>r)&&(this.width/s>this.height/r?(t=s,i=t/(this.width/this.height)):(i=r,t=this.width/this.height*i)),{width:t,height:i}}resize(t,i){if(this.width=t*e.exported.devicePixelRatio,this.height=i*e.exported.devicePixelRatio,this.context.viewport.set({x:0,y:0,width:this.width,height:this.height}),this.style)for(const e of this.style._order)this.style._layers[e].resize();this.heatmapPlotter.resize();}getPickRay(e){return this.frameState.camera.getPickRay(e,this._map._canvas)}getDistance(){return this.distancePass.render({painter:this}),this.distancePass.getDistance(this.context)}getPositionByGPUPick(t,i,s=this.depthPass){i?.ignoreNoneAllowPick&&(this.mainPass.render({painter:this,ignoreNonePickPrimitive:!0}),s.render({painter:this,ignoreNonePickPrimitive:!0}));const r=this.context,n=t,o=new e.Vector2(n.x*(r.drawingBufferWidth/this._map._canvas.clientWidth),n.y*(r.drawingBufferHeight/this._map._canvas.clientHeight));o.y=r.drawingBufferHeight-o.y;const a=s.readPixel(n,r);if(1===a)return;const l=new e.Vector4;l.x=(o.x-r._viewport.current.x)/r._viewport.current.width*2-1,l.y=(o.y-r._viewport.current.y)/r._viewport.current.height*2-1,l.z=2*a-1,l.w=1;let h=this.frameState.camera?.getVPMatrix().invert();h||(h=new e.Matrix4);const _=new e.Vector4;e.Matrix4.multiplyByVector(h,l,_);const c=1/_.w,d=new e.Vector3;return e.Vector3.multiplyByScalar(_,c,d),new e.Vector3(e.Transforms.cartesian3ToCartographic(d))}getFeatureByGPUPick(t,i,s){if(!this._map.unproject(t))return null;const r=t;i||this.mainPass.render({painter:this,ignoreNonePickPrimitive:!0}),this.colorPass.render({painter:this,ignoreNonePickPrimitive:!0,vectorQuery:s});const n=this.colorPass.readPixel(r,this.context);return this.context.getObjectByPickColor(new e.Color(e.Color.byteToFloat(n[0]),e.Color.byteToFloat(n[1]),e.Color.byteToFloat(n[2]),e.Color.byteToFloat(n[3])))}getFeatureByPickColor(t){const i=new e.Color(e.Color.byteToFloat(t[0]),e.Color.byteToFloat(t[1]),e.Color.byteToFloat(t[2]),e.Color.byteToFloat(t[3]));return this.context.getObjectByPickColor(i)}queryPixelColor(t){const i=Fd(t[0],this.context,null,this.height),s=`rgba(${i[0]}, ${i[1]}, ${i[2]}, ${+parseFloat(i[3]/255).toFixed(2)})`;return {rgba:s,hex:e.rgba2Hex(s),color:new e.Color(i[0]/255,i[1]/255,i[2]/255,i[3]/255)}}setup(){}clearStencil(){this.context.clear({stencil:0});}_onBeforeRender(t,i){this.tileClippingMask.nextStencilID=1,this.style=t,this.options=i,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.imageManager.beginFrame(),this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.exported.now());for(const e in t.sourceCaches){const t=this.style.sourceCaches[e];t.used&&t.prepare(this.context);}this.frameState.update({camera:this.transform.activeCamera,shadowCamera:this.transform.shadowCamera});}_updateObjectsNeedCubeMap(){this.objectsNeedCubeMap=[],this.frameState._lights.length>0&&this.frameState._shadows&&this.frameState._lights.forEach((e=>{e instanceof lf&&this.objectsNeedCubeMap.push(e);}));const e=this.frameState.camera.frustumCrate.cullingVolume;this.style.primitiveCollection.getOpaquePrimitives(e).forEach((e=>{e._material instanceof hf&&this.objectsNeedCubeMap.push(e);})),this.style.primitiveCollection.getTranslucentPrimitives(e).forEach((e=>{e._material instanceof hf&&(e._material.id=e.id,this.objectsNeedCubeMap.push(e));}));}_updateObjectCollectionNeedCubeMap(){this.objectsNeedCubeMap.forEach((e=>{null==this.cubeMapCollection[e.id]&&(this.cubeMapCollection[e.id]=new of({painter:this}));}));}_renderCubeMapTexture(){this._updateObjectsNeedCubeMap(),this._updateObjectCollectionNeedCubeMap(),this.objectsNeedCubeMap.forEach((t=>{const i=e.Transforms.cartesian3ToCartographic(t.position);let s;t instanceof lf?(null==this.cubeMapRenderPassCollection[t.id]?(s=new _f({passType:e.RenderPassConsts.CUBE_MAP_RENDER,textureSize:t.textureSize}),this.cubeMapRenderPassCollection[t.id]=s):s=this.cubeMapRenderPassCollection[t.id],t.shadowRepaint&&(s.render({painter:this,cubeMap:this.cubeMapCollection[t.id],position:new e.Vector3(i[0],i[1],i[2]),near:t.shadowNear,far:t.shadowFar}),t.shadowRepaint=!1)):(null==this.cubeMapRenderPassCollection[t.id]?(s=new $p({passType:e.RenderPassConsts.CUBE_MAP_RENDER}),this.cubeMapRenderPassCollection[t.id]=s):s=this.cubeMapRenderPassCollection[t.id],s.render({painter:this,cubeMap:this.cubeMapCollection[t.id],position:new e.Vector3(i[0],i[1],i[2]),near:t._material.reflectNear,far:t._material.reflectFar}));}));}_onPreRender(){const t=this.renderGroup.getNearFarPlane(this.style,this.transform);this.transform.updateNearFarPlane(t),rf.render({painter:this,style:this.style}),!this.style.isSkyboxReady&&this.style.skybox&&(this.frameState.update({camera:this.transform.activeCamera}),new Yp({passType:e.RenderPassConsts.CUBE_MAP_RENDER_FOR_SKYBOX}).render({painter:this,skybox:this.style.skybox})),this._shadows&&this.shadowPass.render({painter:this}),this.style.scenePointPrimitiveCollection.update(this),this._map.videoManager.update(this),this._map.analysis.cutFillCollection.update(this),this._map.analysis.highlightCollection.update(this),this._map.analysis.interferenceCollection.update(this),this._map.analysis.sightlineCollection.update(this),this._map.analysis.viewDomeCollection.update(this),this._map.analysis.viewshed3DCollection.update(this),this.backgroundPass.render({painter:this});}_onRealRender(){this.mainPass.render({painter:this}),this._onCustomLayersRender(),this.depthPass.render({painter:this}),this._enableNormal&&this.normalPass.render({painter:this});}_onCustomLayersRender(){if(this.style._customLayers.length>0){this.context.bindFramebuffer.set(this.mainPass.framebuffer.framebuffer);for(let e=0;e<this.style._customLayers.length;e++)this.style._customLayers[e].implementation.render(this.context.gl,this.mainPass.framebuffer.framebuffer);this.context.bindFramebuffer.set(null);}}_onPostProcessRender(){this._map.analysis.viewshed3DCollection.render(this),this._map.analysis.viewDomeCollection.render(this),this._map.analysis.highlightCollection.render(this),this._map.analysis.cutFillCollection.render(this),this._map.analysis.sightlineCollection.render(this),this._map.analysis.interferenceCollection.render(this);const e=this.postProcessStages;let t=this.usePostProcess=e.length>0||e.fxaa.enabled||e.bloom.enabled||e.atmosphere.enabled;if(this.usePostProcessSelected=!1,t&&(e.update(this.context,!1),e.clear(this.context),t=this.usePostProcess=e.ready,this.usePostProcessSelected=t&&e.hasSelected),this._handleFogs(),t){const e=this.postProcessStages,t=this.mainPass.framebuffer.getColorTexture(0),i=this.colorPass.framebuffer?.getColorTexture(0),s=this.depthPass.framebuffer.getColorTexture(0);e.execute(this.context,t,s,i),e.copy(this.context,this.mainPass.framebuffer);}this.enableSSR?(this._SSRRender(),this.resolveFramebuffer.pass=this.ssrPass):"main"==this._resolvePass?this.resolveFramebuffer.pass=this.mainPass:"normal"==this._resolvePass?this.resolveFramebuffer.pass=this.normalPass:"depth"==this._resolvePass?this.resolveFramebuffer.pass=this.depthPass:"shadow"==this._resolvePass&&(this.resolveFramebuffer.pass=this.shadowPass),this.resolveFramebuffer.resolveFramebufferToScreen();}_SSRRender(){this.depthTexture=this.depthPass.framebuffer.getColorTexture(0),this.normalTexture=this.normalPass.framebuffer.getColorTexture(0),this.colorTexture=this.mainPass.framebuffer.getColorTexture(0),this.normalTexture.sampler={wrapS:e.WebGLConstants.REPEAT,wrapT:e.WebGLConstants.REPEAT},this.depthTexture.sampler={wrapS:e.WebGLConstants.REPEAT,wrapT:e.WebGLConstants.REPEAT},this.colorTexture.sampler={wrapS:e.WebGLConstants.REPEAT,wrapT:e.WebGLConstants.REPEAT},this.SSRState=!0,this.ssrPass.render({painter:this}),this.SSRState=!1;}_onAfterRender(){}_processRenderLoops(e,t){this._onBeforeRender(e,t),this._onPreRender(),this._onRealRender(),this._onPostProcessRender(),this._onAfterRender();}render(e,t){this._processRenderLoops(e,t),this._debugRender();}_debugRender(){const e=this.options.showTileBoundaries;if(e){let t;this.debugTileCache||(this.debugTileCache=new bp({projection:this._map.projection,context:this.context})),this.frameState.framebuffer=null,t="string"==typeof e?this.style.sourceCaches[e]:this.style.rasterSourceCache;const i=t.getVisibleCoordinates();this.debugTilePlotter.update(this,t,null,i,this.frameState);}else this.debugTileCache&&(this.debugTileCache.release(),this.debugTileCache=null,this.debugTilePlotter.removeAllPrimitives());}useProgram(e,t){const i=this.shaderProgramManager.getProgramByGLSLMacroDefinition(e,t||df);return this.context.program.set(i.program),i}setBaseState(){const t=e.RenderState.fromCache({viewport:{x:0,y:0,width:this.width,height:this.height}});e.RenderState.applyRenderState(this.context,t);}setShadows(e){this._shadows=e;}setNearDetection(e){this._nearDetection=e;}setNormalPass(e){this._enableNormal=e,this.context._enableNormal=e;}setResolvePass(e){this._resolvePass=e;}_handleFogs(){if(Object.keys(this.postProcessStages._stageNames).filter((e=>e.includes("mm_fog_effect"))).length>1)this._map.atmosphere=!1;else {if(!this._map.atmosphere)return;this._map.atmosphere=!0;}}destroy(){this.shaderProgramManager.destroy(),this.resolveFramebuffer.destroy(),this.backgroundPass.destroy(),this.distancePass.destroy(),this.depthPass.destroy(),this.commonDepthPass.destroy(),this.normalPass.destroy(),this.shadowPass.destroy(),this.mainPass.destroy(),this.colorPass.destroy(),this.ssrPass.destroy();}}class mf{constructor(){e.bindAll(["_onHashChange","_updateHash"],this),this._updateHash=function(e,t){let i=!1,s=0;const r=()=>{s=0,i&&(e(),s=setTimeout(r,300),i=!1);};return ()=>(i=!0,s||r(),s)}(this._updateHashUnthrottled.bind(this));}addTo(t){return this._map=t,e.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return e.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(e){const t=this._map.getCenter(),i=Math.round(100*this._map.getZoom())/100,s=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),r=Math.pow(10,s),n=Math.round(t.lng*r)/r,o=Math.round(t.lat*r)/r,a=this._map.getBearing(),l=this._map.getPitch();let h="";return h+=e?`#/${n}/${o}/${i}`:`#${i}/${o}/${n}`,(a||l)&&(h+="/"+Math.round(10*a)/10),l&&(h+=`/${Math.round(l)}`),h}_onHashChange(){const t=e.window.location.hash.replace("#","").split("/");return t.length>=3&&(this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:+(t[3]||0),pitch:+(t[4]||0)}),!0)}_updateHashUnthrottled(){const t=this.getHashString();e.window.history.replaceState(e.window.history.state,"",t);}}const pf=function(){let e=[];return {getAll:()=>e,removeAll(){e=[];},add(t){e.push(t);},remove(t){const i=e.indexOf(t);-1!==i&&e.splice(i,1);},update(t,i){if(0===e.length)return !1;let s=0;for(t=void 0!==t?t:pf.now();s<e.length;)e[s].update(t)||i?s++:e.splice(s,1);return !0}}}();pf.now=void 0!==e.window&&void 0!==e.window.performance&&void 0!==e.window.performance.now?e.window.performance.now.bind(e.window.performance):void 0!==Date.now?Date.now:function(){return (new Date).getTime()},pf.Tween=function(e){const t=e,i={};let s={};const r={};let n,o=1e3,a=0,l=!1,h=!1,_=0,c=null,d=pf.Easing.Linear.None,u=pf.Interpolation.Linear,m=[],p=null,f=!1,g=null,y=null,T=null;this.to=function(e,t){return s=e,void 0!==t&&(o=t),this},this.start=function(e){pf.add(this),h=!0,f=!1,c=void 0!==e?e:pf.now(),c+=_;for(const e in s){if(s[e]instanceof Array){if(0===s[e].length)continue;s[e]=[t[e]].concat(s[e]);}void 0!==t[e]&&(i[e]=t[e],i[e]instanceof Array==0&&(i[e]*=1),r[e]=i[e]||0);}return this},this.stop=function(){return h?(pf.remove(this),h=!1,null!==T&&T.call(t,t),this.stopChainedTweens(),this):this},this.end=function(){return this.update(c+o),this},this.stopChainedTweens=function(){let e=0;const t=m.length;for(;e<t;e++)m[e].stop();},this.delay=function(e){return _=e,this},this.repeat=function(e){return a=e,this},this.repeatDelay=function(e){return n=e,this},this.yoyo=function(e){return l=e,this},this.easing=function(e){return d=e,this},this.interpolation=function(e){return u=e,this},this.chain=function(){return m=arguments,this},this.onStart=function(e){return p=e,this},this.onUpdate=function(e){return g=e,this},this.onComplete=function(e){return y=e,this},this.onStop=function(e){return T=e,this},this.update=function(e){let h,T,C;if(e<c)return !0;for(h in !1===f&&(null!==p&&p.call(t,t),f=!0),T=(e-c)/o,T=T>1?1:T,C=d(T),s){if(void 0===i[h])continue;const e=i[h]||0;let r=s[h];r instanceof Array?t[h]=u(r,C):("string"==typeof r&&(r="+"===r.charAt(0)||"-"===r.charAt(0)?e+parseFloat(r):parseFloat(r)),"number"==typeof r&&(t[h]=e+(r-e)*C));}if(null!==g&&g.call(t,C),1===T){if(a>0){for(h in isFinite(a)&&a--,r){if("string"==typeof s[h]&&(r[h]=r[h]+parseFloat(s[h])),l){const e=r[h];r[h]=s[h],s[h]=e;}i[h]=r[h];}return c=void 0!==n?e+n:e+_,!0}{null!==y&&y.call(t,t);let e=0;const i=m.length;for(;e<i;e++)m[e].start(c+o);return !1}}return !0};},pf.Easing={Linear:{None:e=>e},Quadratic:{In:e=>e*e,Out:e=>e*(2-e),InOut:e=>(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},Cubic:{In:e=>e*e*e,Out:e=>--e*e*e+1,InOut:e=>(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},Quartic:{In:e=>e*e*e*e,Out:e=>1- --e*e*e*e,InOut:e=>(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)},Quintic:{In:e=>e*e*e*e*e,Out:e=>--e*e*e*e*e+1,InOut:e=>(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},Sinusoidal:{In:e=>1-Math.cos(e*Math.PI/2),Out:e=>Math.sin(e*Math.PI/2),InOut:e=>.5*(1-Math.cos(Math.PI*e))},Exponential:{In:e=>0===e?0:Math.pow(1024,e-1),Out:e=>1===e?1:1-Math.pow(2,-10*e),InOut:e=>0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))},Circular:{In:e=>1-Math.sqrt(1-e*e),Out:e=>Math.sqrt(1- --e*e),InOut:e=>(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},Elastic:{In:e=>0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI),Out:e=>0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1,InOut:e=>0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1},Back:{In(e){const t=1.70158;return e*e*((t+1)*e-t)},Out(e){const t=1.70158;return --e*e*((t+1)*e+t)+1},InOut(e){const t=2.5949095;return (e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:e=>1-pf.Easing.Bounce.Out(1-e),Out:e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,InOut:e=>e<.5?.5*pf.Easing.Bounce.In(2*e):.5*pf.Easing.Bounce.Out(2*e-1)+.5}},pf.Interpolation={Linear(e,t){const i=e.length-1,s=i*t,r=Math.floor(s),n=pf.Interpolation.Utils.Linear;return t<0?n(e[0],e[1],s):t>1?n(e[i],e[i-1],i-s):n(e[r],e[r+1>i?i:r+1],s-r)},Bezier(e,t){let i=0;const s=e.length-1,r=Math.pow,n=pf.Interpolation.Utils.Bernstein;for(let o=0;o<=s;o++)i+=r(1-t,s-o)*r(t,o)*e[o]*n(s,o);return i},CatmullRom(e,t){const i=e.length-1;let s=i*t,r=Math.floor(s);const n=pf.Interpolation.Utils.CatmullRom;return e[0]===e[i]?(t<0&&(r=Math.floor(s=i*(1+t))),n(e[(r-1+i)%i],e[r],e[(r+1)%i],e[(r+2)%i],s-r)):t<0?e[0]-(n(e[0],e[0],e[1],e[1],-s)-e[0]):t>1?e[i]-(n(e[i],e[i],e[i-1],e[i-1],s-i)-e[i]):n(e[r?r-1:0],e[r],e[i<r+1?i:r+1],e[i<r+2?i:r+2],s-r)},Utils:{Linear:(e,t,i)=>(t-e)*i+e,Bernstein(e,t){const i=pf.Interpolation.Utils.Factorial;return i(e)/i(t)/i(e-t)},Factorial:function(){const e=[1];return function(t){let i=1;if(e[t])return e[t];for(let e=t;e>1;e--)i*=e;return e[t]=i,i}}(),CatmullRom(e,t,i,s,r){const n=.5*(i-e),o=.5*(s-t),a=r*r;return (2*t-2*i+n+o)*(r*a)+(-3*t+3*i-2*n-o)*a+n*r+t}}};var ff=Object.freeze({LINEAR_NONE:pf.Easing.Linear.None,QUADRATIC_IN:pf.Easing.Quadratic.In,QUADRATIC_OUT:pf.Easing.Quadratic.Out,QUADRATIC_IN_OUT:pf.Easing.Quadratic.InOut,CUBIC_IN:pf.Easing.Cubic.In,CUBIC_OUT:pf.Easing.Cubic.Out,CUBIC_IN_OUT:pf.Easing.Cubic.InOut,QUARTIC_IN:pf.Easing.Quartic.In,QUARTIC_OUT:pf.Easing.Quartic.Out,QUARTIC_IN_OUT:pf.Easing.Quartic.InOut,QUINTIC_IN:pf.Easing.Quintic.In,QUINTIC_OUT:pf.Easing.Quintic.Out,QUINTIC_IN_OUT:pf.Easing.Quintic.InOut,SINUSOIDAL_IN:pf.Easing.Sinusoidal.In,SINUSOIDAL_OUT:pf.Easing.Sinusoidal.Out,SINUSOIDAL_IN_OUT:pf.Easing.Sinusoidal.InOut,EXPONENTIAL_IN:pf.Easing.Exponential.In,EXPONENTIAL_OUT:pf.Easing.Exponential.Out,EXPONENTIAL_IN_OUT:pf.Easing.Exponential.InOut,CIRCULAR_IN:pf.Easing.Circular.In,CIRCULAR_OUT:pf.Easing.Circular.Out,CIRCULAR_IN_OUT:pf.Easing.Circular.InOut,ELASTIC_IN:pf.Easing.Elastic.In,ELASTIC_OUT:pf.Easing.Elastic.Out,ELASTIC_IN_OUT:pf.Easing.Elastic.InOut,BACK_IN:pf.Easing.Back.In,BACK_OUT:pf.Easing.Back.Out,BACK_IN_OUT:pf.Easing.Back.InOut,BOUNCE_IN:pf.Easing.Bounce.In,BOUNCE_OUT:pf.Easing.Bounce.Out,BOUNCE_IN_OUT:pf.Easing.Bounce.InOut});const{CesiumMath:gf}=e.CONSTS,yf={},Tf=new e.Vector3,Cf=new e.Vector3;function xf(e,t){return gf.equalsEpsilon(e,gf.TWO_PI,gf.EPSILON11)&&(e=0),t>e+Math.PI?e+=gf.TWO_PI:t<e-Math.PI&&(e-=gf.TWO_PI),e}function bf(t,i,s,r,o,a,l,h,_,c,d,u){const m=t.activeCamera,p=e.Cartographic.fromDegrees(m.cartographicPosition[0],m.cartographicPosition[1],m.cartographicPosition[2],Tf),f=t.pitch*e.CONSTS.TRANSFORM.DEG_TO_RAD,g=xf(t.bearing*e.CONSTS.TRANSFORM.DEG_TO_RAD,r),y=xf(t.roll*e.CONSTS.TRANSFORM.DEG_TO_RAD,a),T=new e.Cartographic;e.Cartographic.fromDegrees(s[0],s[1],s[2],T),p.longitude=gf.zeroToTwoPi(p.longitude),T.longitude=gf.zeroToTwoPi(T.longitude);let C=!1;if(e.defined(h)){const t=gf.zeroToTwoPi(h),i=Math.min(p.longitude,T.longitude),s=Math.max(p.longitude,T.longitude),r=t>=i&&t<=s;if(e.defined(_)){const e=Math.abs(p.longitude-T.longitude),t=gf.TWO_PI-e;(r?e:t)<(r?t:e)*_&&!r&&(C=!0);}else r||(C=!0);}C?function(e,t){e.longitude<t.longitude?e.longitude+=gf.TWO_PI:t.longitude+=gf.TWO_PI;}(p,T):function(e,t){const i=e.longitude-t.longitude;i<-gf.PI?e.longitude+=gf.TWO_PI:i>gf.PI&&(t.longitude+=gf.TWO_PI);}(p,T);const x=function(t,i,s,r,o,a){let l=o;const h=Math.max(s,r);if(!a){if(!e.defined(l)){const s=t.position,r=e.Vector3.fromDegrees(i[0],i[1],i[2]),o=t.up,a=t.right,h=t.frustumCrate.frustum,_=e.Vector3.subtract(s,r,Tf),c=e.Vector3.magnitude(e.Vector3.multiplyByScalar(o,e.Vector3.dot(_,o),Cf)),d=e.Vector3.magnitude(e.Vector3.multiplyByScalar(a,e.Vector3.dot(_,a),Cf));l=Math.min(.2*function(t,i,s){let r,o,a;if(t instanceof n){const e=Math.tan(.5*t.fovy);return r=t.near,o=t.near*e,a=t.aspectRatio*o,Math.max(i*r/a,s*r/o)}return t instanceof e.PerspectiveOffCenterFrustum?(r=t.near,o=t.top,a=t.right,Math.max(i*r/a,s*r/o)):Math.max(i,s)}(h,c,d),1e9);}if(h<l){const e=8,t=1e6,i=-Math.pow((l-s)*t,1/e),n=Math.pow((l-r)*t,1/e);return function(s){return -Math.pow(s*(n-i)+i,e)/t+l}}}return function(t){return e.lerp(s,r,t)}}(m,s,p.height,T.height,l,d),b=function(t,i,s){return function(r){let n=e.lerp(t,i,Math.pow(r,i>t?4:1/4));return s&&(n=e.lerp(t,i,r)),n}}(f,o,u);return function(){const s=p.longitude,n=T.longitude,o=p.latitude,l=T.latitude;return function(h){const _=h.time/i,d=e.lerp(s,n,_),u=e.lerp(o,l,_),m=x(_);t.activeCamera.setView({destination:e.Vector3.fromDegrees(d*e.CONSTS.TRANSFORM.RAD_TO_DEG,u*e.CONSTS.TRANSFORM.RAD_TO_DEG,m),orientation:{heading:e.lerp(g,r,_),pitch:b(_)-.5*Math.PI,roll:e.lerp(y,a,_)}}),c();}}()}function vf(e,t){return {startObject:{},stopObject:{},duration:0,complete:e,cancel:t}}function wf(t,i){if(null===t||"object"!=typeof t)return t;i=e.defaultValue(i,!1);const s=new t.constructor;for(const e in t)if(t.hasOwnProperty(e)){let r=t[e];i&&(r=wf(r,i)),s[e]=r;}return s}yf.createTween=function(t,i){const s=t.activeCamera,r=(i=e.defaultValue(i,e.defaultValue.EMPTY_OBJECT)).destination,n=i.maximumHeight,o=i.flyOverLongitude,a=i.flyOverLongitudeWeight;let l=i.easingFunction;const h=i.updateExtraFunction,_=i.isEaseToType,c=i.linearPitch;let d=i.duration;e.defined(d)||(d=Math.ceil(e.Vector3.distance(s.position,r)/1e6)+2,d=Math.min(d,3));const u=e.defaultValue(i.heading,0),m=e.defaultValue(i.pitch,-gf.PI_OVER_TWO),p=e.defaultValue(i.roll,0),f=i.complete,g=i.cancel;let y=!1;if(y=y||e.Vector3.equalsEpsilon(e.Vector3.fromDegrees(r[0],r[1],r[2]),s.position,gf.EPSILON10),y=y&&gf.equalsEpsilon(gf.negativePiToPi(u),gf.negativePiToPi(t.bearing*e.CONSTS.TRANSFORM.DEG_TO_RAD),gf.EPSILON10)&&gf.equalsEpsilon(gf.negativePiToPi(m),gf.negativePiToPi(t.pitch*e.CONSTS.TRANSFORM.DEG_TO_RAD),gf.EPSILON10)&&gf.equalsEpsilon(gf.negativePiToPi(p),gf.negativePiToPi(t.roll*e.CONSTS.TRANSFORM.DEG_TO_RAD,p),gf.EPSILON10),y)return vf(f,g);const T=new Array(4);if(T.SCENE3D=bf,d<=0)return vf((function(){T.SCENE3D(t,1,r,u,m,p,n,o,a,h,_,c)({time:1}),"function"==typeof f&&f();}),g);const C=T.SCENE3D(t,d,r,u,m,p,n,o,a,h,_,c);if(!e.defined(l)){const e=t.cameraHeightToSurface;l=e>r[2]&&e>11500?ff.CUBIC_OUT:ff.QUINTIC_IN_OUT;}return {duration:d,easingFunction:l,startObject:{time:0},stopObject:{time:d},update:C,complete:f,cancel:g}};var Sf=Object.freeze({SECONDS_PER_MILLISECOND:.001,SECONDS_PER_MINUTE:60,MINUTES_PER_HOUR:60,HOURS_PER_DAY:24,SECONDS_PER_HOUR:3600,MINUTES_PER_DAY:1440,SECONDS_PER_DAY:86400,DAYS_PER_JULIAN_CENTURY:36525,PICOSECOND:1e-9,MODIFIED_JULIAN_DATE_DIFFERENCE:2400000.5});class Af{constructor(e,t,i,s,r,n,o,a,l,h){this._tweens=e,this._tweenjs=t,this._startObject=wf(i),this._stopObject=wf(s),this._duration=r,this._delay=n,this._easingFunction=o,this._update=a,this._complete=l,this.cancel=h,this.needsStart=!0;}get startObject(){return this._startObject}get stopObject(){return this._stopObject}get duration(){return this._duration}get delay(){return this._delay}get easingFunction(){return this._easingFunction}get update(){return this._update}get complete(){return this._complete}get tweenjs(){return this._tweenjs}cancelTween(){this._tweens.remove(this);}}class Ef{constructor(){this._tweens=[];}get length(){return this._tweens.length}add(t){if(0===(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).duration)return e.defined(t.complete)&&t.complete(),new Af(this);const i=t.duration/Sf.SECONDS_PER_MILLISECOND,s=e.defaultValue(t.delay,0),r=s/Sf.SECONDS_PER_MILLISECOND,n=e.defaultValue(t.easingFunction,ff.LINEAR_NONE),o=t.startObject,a=new pf.Tween(o);a.to(wf(t.stopObject),i),a.delay(r),a.easing(n),e.defined(t.update)&&a.onUpdate((()=>{t.update(o);})),a.onComplete(e.defaultValue(t.complete,null)),a.repeat(e.defaultValue(t._repeat,0));const l=new Af(this,a,t.startObject,t.stopObject,t.duration,s,n,t.update,t.complete,t.cancel);return this._tweens.push(l),l}addProperty(t){const i=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).object,s=t.property;return this.add({startObject:{value:t.startValue},stopObject:{value:t.stopValue},duration:e.defaultValue(t.duration,3),delay:t.delay,easingFunction:t.easingFunction,update:function(e){i[s]=e.value;},complete:t.complete,cancel:t.cancel,_repeat:t._repeat})}addAlpha(t){const i=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).material,s=[];for(const t in i.uniforms)i.uniforms.hasOwnProperty(t)&&e.defined(i.uniforms[t])&&e.defined(i.uniforms[t].alpha)&&s.push(t);return this.add({startObject:{alpha:e.defaultValue(t.startValue,0)},stopObject:{alpha:e.defaultValue(t.stopValue,1)},duration:e.defaultValue(t.duration,3),delay:t.delay,easingFunction:t.easingFunction,update:function(e){const t=s.length;for(let r=0;r<t;++r)i.uniforms[s[r]].alpha=e.alpha;},complete:t.complete,cancel:t.cancel})}addOffsetIncrement(t){const i=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).material.uniforms;return this.addProperty({object:i,property:"offset",startValue:i.offset,stopValue:i.offset+1,duration:t.duration,delay:t.delay,easingFunction:t.easingFunction,update:t.update,cancel:t.cancel,_repeat:1/0})}remove(t){if(!e.defined(t))return !1;const i=this._tweens.indexOf(t);return -1!==i&&(t.tweenjs.stop(),e.defined(t.cancel)&&t.cancel(),this._tweens.splice(i,1),!0)}removeAll(){const t=this._tweens;for(let i=0;i<t.length;++i){const s=t[i];s.tweenjs.stop(),e.defined(s.cancel)&&s.cancel();}t.length=0;}contains(t){return e.defined(t)&&-1!==this._tweens.indexOf(t)}get(e){return this._tweens[e]}update(t){const i=this._tweens;let s=0;for(t=e.defined(t)?t/Sf.SECONDS_PER_MILLISECOND:z();s<i.length;){const e=i[s],r=e.tweenjs;e.needsStart?(e.needsStart=!1,r.start(t)):r.update(t)?s++:(r.stop(),i.splice(s,1));}}}class Mf{constructor(){}static createUpdateFunction(t,i,s,r,n){let o=0;return function(a){const l=a.time/i;t._pinchOperationData._headingDiff=(s*l-o)*e.CONSTS.TRANSFORM.DEG_TO_RAD||0,o=s*l,t.pinchPosition=r,n();}}static createTween(e,t){const i=t.duration,s=t.complete,r=t.cancel;return {duration:i,easingFunction:t.easingFunction,startObject:{time:0},stopObject:{time:i},update:Mf.createUpdateFunction(e,i,t.heading,t.pinchPosition,t.updateExtraFunction),complete:s,cancel:r}}}class Pf{constructor(){}static reduceVertices(t,i){const s=new e.Vector3,r=new e.Vector3,n=[],o=t.length;if(o<=2)return t;let a=0,l=0;for(n.push(e.clone(t[0]));a<o-1;){let h=a+1;for(If(t,a,s),If(t,h,r),l=Of(s,r);l<=i&&(h+=1,!(h>o-1));)If(t,h,r),l=Of(s,r);n.push(e.clone(r)),a=h;}return e.clone(n)}static chaiken(t,i,s){let r=0,n=new e.Vector3,o=new e.Vector3,a=[];if(r=t.length,r<3)return t;const l=1/(1+s),h=s/(1+s);n=If(t,0,n),o=If(t,r-1,o);let _=e.clone(t);for(let t=0;t<i;t++)Bf(_,a,l,h),_=e.clone(a),a=[];return _.unshift(n),_.push(o),e.clone(_)}static boyle(t,i){const s=new e.Vector3,r=new e.Vector3;let n=new e.Vector3,o=1,a=0,l=0,h=0,_=0;const c=t.length;if(i<2||i>c)return t;for(If(t,0,n),h=1/(i-1),_=1-h;a<c-2;)l=a+i,l>=c&&(l=c-1),If(t,l,s),Df(s,h,s),Df(n,_,n),(m=r).x=(d=n).x+(u=s).x,m.y=d.y+u.y,m.z=d.z+u.z,t[o]=e.clone(r),o+=1,a+=1,n=e.clone(r);var d,u,m;return function(e,t){const i=e.length;e[t].x=e[i-1].x,e[t].y=e[i-1].y,e[t].z=e[i-1].z;}(t,o),t}}function Rf(e,t,i,s){s.x=e.x+(t.x-e.x)*i,s.y=e.y+(t.y-e.y)*i,s.z=e.z+(t.z-e.z)*i;}function Bf(t,i,s,r){const n=new e.Vector3,o=new e.Vector3,a=new e.Vector3,l=new e.Vector3;for(let h=0;h<t.length&&h!==t.length-1;h++)If(t,h,n),If(t,h+1,o),Rf(n,o,s,a),Rf(n,o,r,l),i.push(e.clone(a)),i.push(e.clone(l));}function If(e,t,i){return i.x=e[t].x,i.y=e[t].y,i.z=e[t].z,i}function Df(e,t,i){return i.x=e.x*t,i.y=e.y*t,i.z=e.z*t,i}function Of(e,t){const i=e.x-t.x,s=e.y-t.y,r=e.z-t.z;return Math.sqrt(i*i+s*s+r*r)}class Lf{constructor(t,i){this.roamingOptions=t,this.map=i,this.roamInterval=t.roamInterval,this.roamPitch=t.pitch,this.bearing=t.bearing,this.heightOffset=t.heightOffset,this.currentMileage=0,this.currentIndex=0,this.roamLength=0,this.roamSegments=[],this.points=[],this.stages=[];let s=t.positions;if(s&&s.length%3!=0)throw new Error("Incorrect number of positions!");let r,n=s.length/3,o=[];for(let t=0;t<n;t++)o.push(e.Vector3.fromArray(s.slice(3*t,3*t+3)));t.pathOptimization&&n>50?(o=Pf.reduceVertices(o,5e-5),o=Pf.boyle(o,7),o=Pf.boyle(o,5),r=Pf.chaiken(o,1,3),s=r.map((e=>[e[0],e[1],e[2]])).flat()):r=o,n=r.length;for(let t=0;t<n-1;t++){const i=e.Vector3.fromArray(e.Transforms.cartographicToCartesian3(s.slice(3*t,3*t+3))),r=e.Vector3.fromArray(e.Transforms.cartographicToCartesian3(s.slice(3*(t+1),3*(t+1)+3))),n=e.Vector3.distance(i,r);this.roamSegments.push(n),this.roamLength+=n;}let a=0;for(let t=0;t<n;t++)this.points.push(e.Vector3.fromArray(e.Transforms.cartographicToCartesian3(s.slice(3*t,3*t+3)))),0===t?this.stages.push(0):(a+=this.roamSegments[t-1],this.stages.push(a));}getRoamingParam(){this.update();const{weight:t,pointCurrent:i,pointNext:s,currentIndex:r}=this.getWeightAndPoints(this.stages,this.points,this.currentMileage);let n;this.currentIndex=r,n=0===this.currentMileage?this.points[0]:this.map.camera.position;const o=this.getLinearInterpolationPosition(t,i,s);1===t&&(this.currentMileage=this.stages.at(r+1)),o[0]===this.points.at(-1)[0]&&o[1]===this.points.at(-1)[1]&&o[2]===this.points.at(-1)[2]&&(this.map._roaming=!1);const a=e.Transforms.cartesian3ToCartographic(n),l=e.Transforms.cartesian3ToCartographic(o),h=st(a[1],a[0],l[1],l[0]).bearing;let _=(l[2]-a[2])/e.Vector3.distance(e.Vector3.fromArray(o),e.Vector3.fromArray(n));_=e.clamp(_,-1,1);const c=Math.asin(_);return {position:[l[0],l[1],l[2]+this.heightOffset],bearing:e.defined(this.bearing)?this.bearing+h:h,pitch:this.roamPitch+c,trackIndex:this.currentIndex+1,currentPosition:l,currentMileage:this.currentMileage,totalMileage:this.roamLength}}getWeightAndPoints(e,t,i){const s=this.leftBinarySearch(e,i,0,e.length-2),r=e[s];return {weight:Math.min((i-r)/(e[s+1]-r),1),pointCurrent:t[s],pointNext:t[s+1],currentIndex:s}}getLinearInterpolationPosition(e,t,i){return [(i[0]-t[0])*e+t[0],(i[1]-t[1])*e+t[1],(i[2]-t[2])*e+t[2]]}leftBinarySearch(e,t,i,s){const r=Math.floor((i+s)/2),n=e[r];return i>s?r:n>t?this.leftBinarySearch(e,t,i,r-1):n<t?this.leftBinarySearch(e,t,r+1,s):r}update(){this.roamInterval=this.map.roamingOptions.roamInterval,this.roamPitch=this.map.roamingOptions.pitch,this.bearing=this.map.roamingOptions.bearing,this.heightOffset=this.map.roamingOptions.heightOffset,this.currentMileage+=this.roamInterval;}}class Vf extends e.Evented{_minimumCameraCheckHeight=2e3;_minimumCameraCheckHeightNoTerrain=1;_maxmumCameraCheckHeight=1e4;constructor(t,i){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=i.bearingSnap,this.latRange=[e.CONSTS.TRANSFORM.MIN_LAT,e.CONSTS.TRANSFORM.MAX_LAT],this._roaming=!1,this.roamObject=void 0,this.tweens=new Ef,e.bindAll(["_renderFrameCallback"],this);}getCenter(){return this.transform.center}setCenter(e,t){return this.jumpTo({center:e,zoom:this.getZoom()},t)}getCameraPosition(){return new e.Vector3(this.transform.activeCamera.cartographicPosition)}setCameraPosition(e,t){return this.jumpTo({target:e},t),this}panBy(t,i,s){return t=e.pointGeometry3d.convert(t).mult(-1),this.panTo(this.transform.center,e.extend({offset:t},i),s)}panTo(t,i,s){return this.easeTo(e.extend({center:t},i),s)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e,center:this.getCenter()},t),this}setCameraHeight(e,t){return this.jumpTo({target:[this.transform.activeCamera.cartographicPosition[0],this.transform.activeCamera.cartographicPosition[1],e]},t),this}zoomTo(t,i,s){return this.easeTo(e.extend({center:this.getCenter(),zoom:e.clamp(t,this.transform.minZoom,this.transform.maxZoom)},i),s)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.getMapViewParams().bearing}getCameraBearing(){return this.transform.bearing}setBearing(e,t){const i=this.transform.getMapViewParams();return this.jumpTo({bearing:e,center:i.center,zoom:i.zoom},t),this}setCameraBearing(e,t){return this.jumpTo({target:[this.camera.cartographicPosition[0],this.camera.cartographicPosition[1],this.camera.cartographicPosition[2]],bearing:e,pitch:this.getCameraPitch(),roll:this.getCameraRoll()},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(t,i,s){return this.easeTo(e.extend({bearing:t,center:this.getCenter(),zoom:this.getZoom()},i),s)}resetNorth(t,i){return this.rotateTo(0,e.extend({duration:1e3},t),i),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.getMapViewParams().pitch}getCameraPitch(){return this.transform.pitch}setPitch(e,t){const i=this.transform.getMapViewParams();return this.jumpTo({pitch:e,center:i.center,zoom:i.zoom},t),this}setCameraPitch(e,t){return this.jumpTo({target:[this.camera.cartographicPosition[0],this.camera.cartographicPosition[1],this.camera.cartographicPosition[2]],bearing:this.getCameraBearing(),pitch:e,roll:this.getCameraRoll()},t),this}getRoll(){return this.transform.getMapViewParams().roll}getCameraRoll(){return this.transform.roll}setRoll(e,t){const i=this.transform.getMapViewParams();return this.jumpTo({roll:e,center:i.center,zoom:i.zoom},t),this}setCameraRoll(e,t){return this.jumpTo({roll:e},t),this}cameraForBounds(t,i){return t=e.LngLatBounds.convert(t),this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),0,i)}_cameraForBoxAndBearing(t,i,r,n){if("number"==typeof(n=e.extend({padding:{top:0,bottom:0,right:0,left:0},offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding){const e=n.padding;n.padding={top:e,bottom:e,right:e,left:e};}if(!s(Object.keys(n.padding).sort(((e,t)=>e<t?-1:e>t?1:0)),["bottom","left","right","top"]))return void e.warnOnce("options.padding must be a positive number, or an Object with keys 'bottom', 'left', 'right', 'top'");const o=[(n.padding.left-n.padding.right)/2,(n.padding.top-n.padding.bottom)/2],a=Math.min(n.padding.right,n.padding.left),l=Math.min(n.padding.top,n.padding.bottom);n.offset=[n.offset[0]+o[0],n.offset[1]+o[1]];const h=e.pointGeometry3d.convert(n.offset),_=this.transform,c=this._calcOffsetDifLngLat(h);n.center={lng:(t.lng+i.lng)/2-c[0],lat:(t.lat+i.lat)/2-c[1]};const d=e.Transforms.cartographicToCartesian3([(t.lng+i.lng)/2,t.lat,0]),u=e.Transforms.cartographicToCartesian3([(t.lng+i.lng)/2,i.lat,0]),m=Math.sqrt(Math.pow(d[0]-u[0],2)+Math.pow(d[1]-u[1],2)+Math.pow(d[2]-u[2],2)),p=Math.atan((_.height-l)/_.height*Math.tan(_._fov/2)),f=e.Transforms.cartographicToCartesian3([t.lng,(t.lat+i.lat)/2,0]),g=e.Transforms.cartographicToCartesian3([i.lng,(t.lat+i.lat)/2,0]),y=Math.sqrt(Math.pow(f[0]-g[0],2)+Math.pow(f[1]-g[1],2)+Math.pow(f[2]-g[2],2)),T=Math.atan((_.width-a)/_.height*Math.tan(_._fov/2)),C=_.width/y,x=_.height/m;if(x<0||C<0)return void e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");let b,v;x<C?(b=p,v=m):(b=T,v=y);const w=Math.asin(v/2/e.CONSTS.TRANSFORM.R),S=Math.sin(Math.PI-b-w)*e.CONSTS.TRANSFORM.R/Math.sin(b);return n.zoom=e.getZoomFromDistance(_._fov,S,e.CONSTS.TRANSFORM.R),n.bearing=0,n}fitBounds(t,i,s,r){const n=this.boundsToPosition(t,i,r);return i=i||{},this.flyTo(void 0!==(s=s||void 0)?{target:[n[0],n[1],n[2]+s],bearing:0,pitch:e.defined(i.pitch)?i.pitch:0,roll:0,duration:i.duration,complete:i.complete,cancel:i.cancel,endTransform:i.endTransform,maximumHeight:i.maximumHeight,easingFunction:i.easing,flyOverLongitude:i.flyOverLongitude,flyOverLongitudeWeight:i.flyOverLongitudeWeight}:{center:[n[0],n[1]],zoom:e.defined(i.zoom)?i.zoom:n[3],bearing:0,pitch:e.defined(i.pitch)?i.pitch:0,roll:0,duration:i.duration,complete:i.complete,cancel:i.cancel,endTransform:i.endTransform,maximumHeight:i.maximumHeight,easingFunction:i.easing,flyOverLongitude:i.flyOverLongitude,flyOverLongitudeWeight:i.flyOverLongitudeWeight},r)}boundsToPosition(t,i,s){const r=(t=e.LngLatBounds.convert(t)).getNorthWest(),n=t.getSouthEast(),o=180;let a=o;(i=i||{})&&i.padding&&null!=i.padding.left&&(a=i.padding.left);let l=o;i&&i.padding&&null!=i.padding.right&&(l=i.padding.right);let h=o;i&&i.padding&&null!=i.padding.top&&(h=i.padding.top);let _=o;i&&i.padding&&null!=i.padding.bottom&&(_=i.padding.bottom);const c=r.lat>n.lat?r.lat:n.lat,d=r.lat<n.lat?r.lat:n.lat;let u=(c+d)/2;const m=r.lng<n.lng?r.lng:n.lng,p=r.lng>n.lng?r.lng:n.lng;let f=(m+p)/2;const g=new e.Vector3(e.Transforms.DefaultEllipsoid.cartographicToCartesian([f,c,0])),y=new e.Vector3(e.Transforms.DefaultEllipsoid.cartographicToCartesian([f,d,0]));let T=e.Vector3.distance(g,y);T*=this.transform.height/(this.transform.height-h-_),T=T/2/Math.tan(this.transform._fov/2);const C=new e.Vector3(e.Transforms.DefaultEllipsoid.cartographicToCartesian([m,u,0])),x=new e.Vector3(e.Transforms.DefaultEllipsoid.cartographicToCartesian([p,u,0]));let b=e.Vector3.distance(C,x);b*=this.transform.width/(this.transform.width-a-l),b=b/2/Math.tan(this.transform._fov/2*this.transform.width/this.transform.height);const v=T>b?T:b;f-=(a-l)/(this.transform.width-a-l)*((p-m)/2),u-=(_-h)/(this.transform.height-h-_)*((c-d)/2);const w=new e.Vector3(e.Transforms.DefaultEllipsoid.cartographicToCartesian([f,u,0])),S=e.Vector3.normalize(w,new e.Vector3).multiplyScalar(v);S.add(w);const A=e.Transforms.DefaultEllipsoid.cartesianToCartographic(S,new e.Vector3),E=e.getZoomFromDistance(this.transform._fov,A[2]+e.CONSTS.TRANSFORM.R,e.CONSTS.TRANSFORM.R);return [A[0],A[1],A[2],E]}fitScreenCoordinates(t,i,s,r,n){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(e.pointGeometry3d.convert(t)),this.transform.pointLocation(e.pointGeometry3d.convert(i)),s,r),r,n)}_fitInternal(t,i,s){return t?(i=e.extend(t,i)).linear?this.easeTo(i,s):this.flyTo(i,s):this}async jumpTo(t,i){const s=t={...t},r=await this._convertToMainCameraOptions(s);if(1==r.unchanged)return void(t.callback&&t.callback(i));let n;return e.getZoomFromDistance(this.transform._fov,r.position[2]+e.CONSTS.TRANSFORM.R,e.CONSTS.TRANSFORM.R)-this.transform.zoom>e.CONSTS.CesiumMath.EPSILON3&&(n=!0),this.jumpTo3D(r,i),n&&(Ge.executeEvent(this,"zoomstart"),Ge.executeEvent(this,"zoom"),Ge.executeEvent(this,"zoomend")),this}jumpTo3D(t){this.stop();const i=this.transform,s=e.Vector3.unpack(t.position);let r=!1,n=!1,o=!1;"bearing"in t&&i.bearing!==+t.bearing&&(r=!0,i.bearing=+t.bearing),"pitch"in t&&i.pitch!==+t.pitch&&(n=!0,i.pitch=+t.pitch),"roll"in t&&i.roll!==+t.roll&&(o=!0,i.roll=+t.roll),i.activeCamera.setView({destination:e.Vector3.fromDegrees(s.x,s.y,s.z),orientation:{heading:e.defined(t.bearing)?t.bearing*Math.PI/180:void 0,pitch:e.defined(t.pitch)?t.pitch*Math.PI/180-.5*Math.PI:void 0,roll:e.defined(t.roll)?t.roll*Math.PI/180:void 0}}),Ge.executeEvent(this,"movestart"),Ge.executeEvent(this,"move"),r&&(Ge.executeEvent(this,"rotatestart"),Ge.executeEvent(this,"rotate"),Ge.executeEvent(this,"rotateend")),n&&(Ge.executeEvent(this,"pitchstart"),Ge.executeEvent(this,"pitch"),Ge.executeEvent(this,"pitchend")),o&&(Ge.executeEvent(this,"rollstart"),Ge.executeEvent(this,"roll"),Ge.executeEvent(this,"rollend")),Ge.executeEvent(this,"moveend");}easeToByPinchPosition(e,t){this._stop(!1,e.easeId);const i=Mf.createTween(this.transform,{duration:e.duration/1e3||3,heading:e.bearing,pinchPosition:e.pinchPosition,easingFunction:e.easing||ff.QUINTIC_OUT,cancel:()=>{this._afterEase(t);},complete:()=>{this.transform.pinchPosition=null,this._afterEase(t),e.callback&&e.callback(t);},updateExtraFunction:()=>{this._fireMoveEvents(t);}});0!==i.duration?(this._currentFlight=this.tweens.add(i),this._rotating=this._rotating||!0,this._prepareEase(t,!1),this._ease()):"function"==typeof i.complete&&i.complete();}roam(){if(!this._roaming||!this.roamingOptions)return;this.roamObject||(this.roamObject=new Lf(this.roamingOptions,this));const e=this.roamObject.getRoamingParam();this.jumpTo({target:e.position,bearing:e.bearing,pitch:e.pitch}),this.callback&&this.callback({trackIndex:e.trackIndex,currentPosition:e.currentPosition,currentMileage:e.currentMileage,totalMileage:e.totalMileage});}initRoam(e){this._roaming=!0,e&&(this.callback=e);}pauseRoam(){this._roaming=!1;}resumeRoam(){this._roaming=!0;}stopRoam(){this._roaming=!1,this.roamObject=void 0,this.roamingOptions=null;}async _convertToMainCameraOptions(t){const i=this.transform,s=this.transform.minZoom,r=this.transform.maxZoom;if(e.defined(t.center)&&e.defined(t.zoom)){const n=i.getMapViewParams(),o=n.bearing,a=n.pitch,l=n.roll;t.bearing=e.defined(t.bearing)?this._normalizeBearing(t.bearing,o):o,t.pitch=e.defined(t.pitch)?this._normalizeBearing(t.pitch,a):a,t.roll=e.defined(t.roll)?this._normalizeBearing(t.roll,l):l,t.center=e.LngLat.convert(e.defined(t.center)?t.center:n.center).toArray(),t.zoom=e.defined(t.zoom)?t.zoom:n.zoom;const h=n.center,_=n.zoom,c=n.bearing,d=n.pitch,u=n.roll;let m=!0;const p=e.LngLat.convert(t.center);if((Math.abs(p.lng-h.lng)>e.CONSTS.CesiumMath.EPSILON11||Math.abs(p.lat-h.lat)>e.CONSTS.CesiumMath.EPSILON11||e.defined(t.zoom)&&Math.abs(t.zoom-_)>e.CONSTS.CesiumMath.EPSILON9||e.defined(t.bearing)&&Math.abs(t.bearing-c)>e.CONSTS.CesiumMath.EPSILON8||e.defined(t.pitch)&&Math.abs(t.pitch-d)>e.CONSTS.CesiumMath.EPSILON8||e.defined(t.roll)&&Math.abs(t.roll-u)>e.CONSTS.CesiumMath.EPSILON8)&&(m=!1),m)return {unchanged:!0,callback:t.callback};const f=[t.center[0],t.center[1],e.clamp(t.zoom,s,r),t.bearing,t.pitch,t.roll],g=e.Transforms.convertV34Pos2V4(f);return t.position=[g[0],g[1],Math.min(g[6][2],38268822)],delete t.zoom,delete t.center,t.bearing=g[3],t.pitch=g[4],t.roll=g[5],t}if(e.defined(t.target)||e.defined(t.center)&&e.defined(t.zoom)){if(e.defined(t.target)||(t.target=i.activeCamera.cartographicPosition),t.target instanceof Array||t.target instanceof e.Vector3){const e=await async function(e){return {target:e,range:0}}(t.target);t.position=e.target,t.position[2]+=t.range?t.range+e.range:e.range;}else if(t.target instanceof e.Primitive){const i=await async function(t){if(!t.boundingSphere)throw new Error("当前的飞行目标没有包围球");const i=2*t.boundingSphere.radius;return {target:e.Transforms.cartesian3ToCartographic(t.boundingSphere.center),range:i}}(t.target);t.position=i.target,t.position[2]+=t.range?t.range+i.range:i.range;}else if(t.target instanceof e.BoundingSphere||t.target instanceof e.OrientedBoundingBox||t.target instanceof e.AxisAlignedBoundingBox){const i=await async function(t){let i,s;if(t instanceof e.BoundingSphere)i=t.center,s=t.radius;else if(t instanceof e.OrientedBoundingBox){const e=t.getBoundingSphere();i=e.center,s=e.radius;}else if(t instanceof e.AxisAlignedBoundingBox){i=t.center;const e=t.halfDiagonal;s=Math.max(e[0],e[1],e[2]);}return {target:e.Transforms.cartesian3ToCartographic(i),range:2*s}}(t.target);t.position=i.target,t.position[2]+=t.range?t.range+i.range:i.range;}else if(t.target instanceof fl){const i=this.style.sourceCaches[t.target.id];let s=[],r=[];s=s.concat(i.getOpaquePrimitives(),i.getTranslucentPrimitives()),s.forEach((e=>{r.push(e.boundingBox.center);})),r=r.filter((e=>!isNaN(e[0])&&!isNaN(e[1])&&!isNaN(e[2])));const n=Math.min.apply(null,r.map((e=>e.x))),o=Math.max.apply(null,r.map((e=>e.x))),a=Math.min.apply(null,r.map((e=>e.y))),l=Math.max.apply(null,r.map((e=>e.y))),h=Math.min.apply(null,r.map((e=>e.z))),_=Math.max.apply(null,r.map((e=>e.z)));t.position=e.Transforms.cartesian3ToCartographic(new e.Vector3((n+o)/2,(a+l)/2,(h+_)/2)),t.range&&(t.position[2]+=t.range);}else if(t.target instanceof gl){const e=this.boundsToPosition(this.style.sourceCaches[t.target.id]._geoBounds[0]);t.position=e,t.range&&(t.position[2]+=t.range);}else if(t.target instanceof Ua||t.target instanceof tt){const e=this.boundsToPosition(t.target.getBounds());t.position=e,t.range&&(t.position[2]+=t.range);}else if(t.target instanceof _d){const e=this.boundsToPosition(t.target.getBounds());t.position=e,t.range&&(t.position[2]+=t.range);}const s=i.activeCamera.cartographicPosition,r=this.getCameraBearing(),n=this.getCameraPitch(),o=this.getCameraRoll();let a=!0;return (Math.abs(s[0]-t.position[0])>e.CONSTS.CesiumMath.EPSILON11||Math.abs(s[1]-t.position[1])>e.CONSTS.CesiumMath.EPSILON11||Math.abs(s[2]-t.position[2])>e.CONSTS.CesiumMath.EPSILON10||e.defined(t.bearing)&&Math.abs(t.bearing-r)>e.CONSTS.CesiumMath.EPSILON8||e.defined(t.pitch)&&Math.abs(t.pitch-n)>e.CONSTS.CesiumMath.EPSILON8||e.defined(t.roll)&&Math.abs(t.roll-o)>e.CONSTS.CesiumMath.EPSILON8)&&(a=!1),a?{unchanged:!0,callback:t.callback}:(t.position[2]=Math.min(t.position[2],38268822),t.target[2]=Math.min(t.position[2],38268822),e.defined(t.pitch)||(t.pitch=n),e.defined(t.bearing)||(t.bearing=r),e.defined(t.roll)||(t.roll=o),t)}{const n=i.getMapViewParams();t.center=e.LngLat.convert(t.center||n.center).toArray(),e.defined(t.zoom)||(t.zoom=n.zoom);const o=[t.center[0],t.center[1],e.clamp(t.zoom,s,r),e.defined(t.bearing)?t.bearing:n.bearing,e.defined(t.pitch)?t.pitch:n.pitch,e.defined(t.roll)?t.roll:n.roll],a=e.Transforms.convertV34Pos2V4(o);return t.position=[a[0],a[1],Math.min(a[6][2],38268822)],delete t.center,t.bearing=a[3],t.pitch=a[4],t.roll=a[5],t}}async easeTo(t,i){if(t={...t},1==(t=await this._convertToMainCameraOptions(t)).unchanged)return void(t.callback&&t.callback(i));t.cameraHeight&&(t.position[2]=t.cameraHeight),this._stop(!1,t.easeId),!1===(t=e.extend({offset:[0,0],duration:500},t)).animate&&(t.duration=0);const s=this.getBearing(),r=this.getPitch(),n=this.getRoll(),o="bearing"in t?this._normalizeBearing(t.bearing,s):s,a="pitch"in t?+t.pitch:r,l="roll"in t?this._normalizeBearing(t.roll,n):n;let h;h=t.position&&0==t.offset[0]&&0==t.offset[1]?[0,0]:this._calcOffsetDifLngLat(t.offset),this._easeId=t.easeId;const _={};_.cancel=()=>{this._afterEase(i),t.cancel&&t.cancel(i);},_.complete=()=>{this._afterEase(i),t.callback&&t.callback(i);},_.updateExtraFunction=()=>{this._fireMoveEvents(i);},_.destination=[t.position[0]+h[0],t.position[1]+h[1],t.position[2]],_.heading=o*e.CONSTS.TRANSFORM.DEG_TO_RAD,_.pitch=a*e.CONSTS.TRANSFORM.DEG_TO_RAD,_.roll=l*e.CONSTS.TRANSFORM.DEG_TO_RAD,_.duration=e.defined(t.duration)?t.duration:1e3,_.duration/=1e3,_.maximumHeight=t.maximumHeight,_.flyOverLongitude=t.flyOverLongitude,_.flyOverLongitudeWeight=t.flyOverLongitudeWeight,_.isEaseToType=!0,_.easingFunction=t.easing||ff.QUINTIC_OUT,_.linearPitch=t.linearPitch;const c=yf.createTween(this.transform,_);if(0===c.duration)return void("function"==typeof c.complete&&c.complete());let d;return this._currentFlight=this.tweens.add(c),e.getZoomFromDistance(this.transform._fov,t.position[2]+e.CONSTS.TRANSFORM.R,e.CONSTS.TRANSFORM.R)-this.transform.zoom>e.CONSTS.CesiumMath.EPSILON3&&(d=!0),this._zooming=d,this._rotating=this._rotating||s!==o,this._pitching=this._pitching||a!==r,this._rolling=this._rolling||l!==n,this._prepareEase(i,!1,{moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling}),this._ease(),this}_calcOffsetDifLngLat(t){t instanceof Array&&(t={x:t[0],y:t[1]});const i=this.transform;let s=0,r=0,n=0;if(0!==t.x&&0!==t.y)Math.abs(t.x)>Math.abs(t.y)?(s=10,r=10*t.y/t.x,n=t.x/10):(s=10*t.x/t.y,r=10,n=t.y/10);else if(0!==t.x&&0===t.y)s=10,n=t.x/10;else {if(0!==t.x||0===t.y)return [0,0];r=10,n=t.y/10;}const o=i.pointLocation(new e.pointGeometry3d(i.width/2+s,i.height/2+10+r)),a=i.pointLocation(new e.pointGeometry3d(i.width/2,i.height/2+10));return o&&a?[(a.lng-o.lng)*n,(a.lat-o.lat)*n]:[0,0]}_prepareEase(e,t,i={}){this._moving=!0,t||i.moving||Ge.executeEvent(this,"movestart"),this._zooming&&!i.zooming&&Ge.executeEvent(this,"zoomstart"),this._rotating&&!i.rotating&&Ge.executeEvent(this,"rotatestart"),this._pitching&&!i.pitching&&Ge.executeEvent(this,"pitchstart"),this._rolling&&!i.rolling&&Ge.executeEvent(this,"rollstart");}_fireMoveEvents(){Ge.executeEvent(this,"move"),this._zooming&&Ge.executeEvent(this,"zoom"),this._rotating&&Ge.executeEvent(this,"rotate"),this._pitching&&Ge.executeEvent(this,"pitch"),this._rolling&&Ge.executeEvent(this,"roll");}_afterEase(e,t){if(this._easeId&&t&&this._easeId===t)return;delete this._easeId;const i=this._zooming,s=this._rotating,r=this._pitching,n=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,i&&Ge.executeEvent(this,"zoomend"),s&&Ge.executeEvent(this,"rotateend"),r&&Ge.executeEvent(this,"pitchend"),n&&Ge.executeEvent(this,"rollend"),Ge.executeEvent(this,"moveend");}flyToBoundingSphere(e,t){console.error("此方法已经废弃！ //替代方案，采用map.flyTo({target: boundingSphere}); 或参考开发文档");}async flyTo(t,i){if(t={...t},1==(t=await this._convertToMainCameraOptions(t)).unchanged)return void(t.callback&&t.callback(i));this.stop(),t=e.extend({offset:[0,0],speed:1.2,curve:1.42,easing:e.ease},t);const s=this.getCameraBearing(),r=this.getCameraPitch(),n=this.getCameraRoll(),o="bearing"in t?this._normalizeBearing(t.bearing,s):s,a="pitch"in t?+t.pitch:r,l="roll"in t?this._normalizeBearing(t.roll,n):n,h={};h.cancel=()=>{this._afterEase(i),t.cancel&&t.cancel(i);},h.complete=()=>{this._afterEase(i),t.callback&&t.callback(i);},h.updateExtraFunction=()=>{this._fireMoveEvents(i);},h.destination=t.position,h.heading=o*e.CONSTS.TRANSFORM.DEG_TO_RAD,h.pitch=a*e.CONSTS.TRANSFORM.DEG_TO_RAD,h.roll=l*e.CONSTS.TRANSFORM.DEG_TO_RAD,h.duration=e.defined(t.duration)?t.duration:1e3,h.duration/=1e3,h.maximumHeight=t.maximumHeight,h.flyOverLongitude=t.flyOverLongitude,h.flyOverLongitudeWeight=t.flyOverLongitudeWeight,h.easingFunction=t.easing,h.isEaseToType=t.isEaseToType;const _=yf.createTween(this.transform,h);if(0===_.duration)return void("function"==typeof _.complete&&_.complete());let c;return this._currentFlight=this.tweens.add(_),e.getZoomFromDistance(this.transform._fov,t.position[2]+e.CONSTS.TRANSFORM.R,e.CONSTS.TRANSFORM.R)-this.transform.zoom>e.CONSTS.CesiumMath.EPSILON3&&(c=!0),this._zooming=c,this._rotating=Math.abs(s-o)>1e-4,this._pitching=Math.abs(r-a)>1e-4,this._rolling=Math.abs(n-l)>1e-4,this._prepareEase(i,!1,{moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling}),this._ease(),this}jumpToTargetWithRelativeBearingPitchPosition(t,i,s,r,n){const o=new e.Vector3(e.Transforms.cartographicToCartesian3(t)),a=new e.Vector3(e.Transforms.cartographicToCartesian3(i)),l=e.Transforms.DefaultEllipsoid.geodeticSurfaceNormal(a);o.sub(a);const h=new e.Vector3(o).normalize(),_=new e.Vector3(l),c=e.Vector3.cross(h,_).normalize(),d=e.Vector3.cross(_,c).normalize(),u=e.Vector3.add(d.multiplyByScalar(Math.cos((90-s)*e.CONSTS.TRANSFORM.DEG_TO_RAD)),_.multiplyByScalar(Math.sin((90-s)*e.CONSTS.TRANSFORM.DEG_TO_RAD))).multiplyByScalar(Math.cos((90-s)*e.CONSTS.TRANSFORM.DEG_TO_RAD)*o.len()),m=(new e.Matrix4).rotateAxis(r*e.CONSTS.TRANSFORM.DEG_TO_RAD,l);u.transform(m),u.add(a);const p=e.Transforms.cartographicToFixedFrame(i),f=new e.Vector3(p[4],p[5],p[6]).normalize(),g=e.Vector3.angleBetween(d,f)*e.CONSTS.TRANSFORM.RAD_TO_DEG;this.jumpTo({target:e.Transforms.cartesian3ToCartographic(u),pitch:s,bearing:-r-(180-g)});}isEasing(){return !!this._easeFrameId}stop(){return this._stop()}_stop(t,i){if(this._currentFlight&&(this._currentFlight.cancelTween(),this._currentFlight=null),this.tweens.removeAll(),this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const e=this._onEaseEnd;delete this._onEaseEnd,e.call(this,i);}if(!t){const e=this.handlers;e&&e.stop(!1);}return e.defined(this._cameraController)&&this._cameraController._stopInertia(),this}_ease(){e.defined(this._easeFrameId)||(this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback));}_renderFrameCallback(){this.tweens.update(),this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback);}_normalizeBearing(t,i){t=e.wrap(t,-180,180);const s=Math.abs(t-i);return Math.abs(t-360-i)<s&&(t-=360),Math.abs(t+360-i)<s&&(t+=360),t}get staticState(){return !(this._moving||this._mouseAnimating)}_addHandOperationEventListener(){this.on("mousedown",(()=>{this._mouseAnimating=!0;})),this.on("zoomstart",(()=>{this._mouseAnimating=!0;})),this.on("touchstart",(()=>{this._mouseAnimating=!0;})),this.on("mouseup",(()=>{this._mouseAnimating=!1;})),this.on("zoomend",(()=>{this._mouseAnimating=!1;})),this.on("touchend",(()=>{this._mouseAnimating=!1;}));}}class Nf{constructor(t={}){this.options=t,e.bindAll(["_updateEditLink","_updateData","_updateCompact"],this);}getDefaultPosition(){return "bottom-right"}onAdd(e){const t=this.options&&this.options.compact;return this._map=e,this._container=W.create("div","minemap-ctrl minemap-ctrl-attrib"),t&&this._container.classList.add("minemap-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){W.remove(this._container),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0;}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".minemap-improve-map"));const t=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:yt.ACCESS_TOKEN}];if(e){const i=t.reduce(((e,i,s)=>(i.value&&(e+=`${i.key}=${i.value}${s<t.length-1?"&":""}`),e)),"?");e.href=`https://www.minemap.com/feedback/${i}${this._map._hash?this._map._hash.getHashString(!0):""}`;}}_updateData(e){e&&"metadata"===e.sourceDataType&&(this._updateAttributions(),this._updateEditLink());}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id;}const t=this._map.style.sourceCaches;for(const i in t){const s=t[i].getSource();s.attribution&&e.indexOf(s.attribution)<0&&e.push(s.attribution);}e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,i)=>{for(let s=i+1;s<e.length;s++)if(e[s].indexOf(t)>=0)return !1;return !0})),e.length?(this._container.innerHTML=e.join(" | "),this._container.classList.remove("minemap-attrib-empty")):this._container.classList.add("minemap-attrib-empty"),this._editLink=null;}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("minemap-compact"):this._container.classList.remove("minemap-compact");}}class Ff{constructor(){e.bindAll(["_updateLogo"],this);}onAdd(e,t){this._map=e,this._container=W.create("div","minemap-ctrl");const i=W.create("a","minemap-ctrl-logo");return i.target="_blank",i.href=t||"https://www.minedata.cn/",i.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),i.setAttribute("rel","noopener"),this._container.appendChild(i),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._container}onRemove(){W.remove(this._container),this._map.off("sourcedata",this._updateLogo);}getDefaultPosition(){return "bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none");}_logoRequired(){if(this._map.style)return !0}}class Gf{constructor(){}max(e){return Math.max.apply(null,e)}min(e){return Math.min.apply(null,e)}range(e){return this.max(e)-this.min(e)}midrange(e){return this.range(e)/2}sum(e){let t=0;for(let i=0,s=e.length;i<s;i++)t+=e[i];return t}mean(e){return this.sum(e)/e.length}median(e){e.sort(((e,t)=>e-t));const t=e.length/2;return t%1?e[t-.5]:(e[t-1]+e[t])/2}modes(e){if(!e.length)return [];const t={};let i=0,s=[];return e.forEach((e=>{t[e]?t[e]++:t[e]=1,t[e]>i?(s=[e],i=t[e]):t[e]===i&&(s.push(e),i=t[e]);})),s}variance(e){const t=this.mean(e);return this.mean(e.map((e=>Math.pow(e-t,2))))}standardDeviation(e){return Math.sqrt(this.variance(e))}meanAbsoluteDeviation(e){const t=this.mean(e);return this.mean(e.map((e=>Math.abs(e-t))))}zScores(e){const t=this.mean(e),i=this.standardDeviation(e);return e.map((e=>(e-t)/i))}average(e){return this.mean(e)}}const kf=function(){return window&&window.performance?window.performance.now():Date.now()};class Uf{constructor(e={}){this.options=e,this.framesCounter=0,this.lastFPSTimestamp=null,this.lastFPSMeasure=0,this.measurements=[],this.lastMeasurementTimestamp=null,this.started=!1,this.stat=new Gf;}startMeasuring(e){this.started=!0,this.updateFPS(),e&&!isNaN(e)&&e>0&&setTimeout(this.stopMeasuring.bind(this),e);}stopMeasuring(){this.started=!1;}registerRenderFrame(){this.started&&(this.framesCounter++,this.updateFPS());}getLastMeasurement(){return this.measurements.length?this.measurements[this.measurements.length-1]:0}updateFPS(){null===this.lastFPSTimestamp&&(this.lastFPSTimestamp=kf());const e=kf(),t=e-this.lastFPSTimestamp;if(t>500){let i=Math.round(this.framesCounter/(t/1e3)*10)/10;i=i>60?60:i,this.lastFPSTimestamp=e,this.framesCounter=0,this.recordMeasurement(i,t);}}recordMeasurement(e){this.measurements.push(e);}getMeasurements(){return this.measurements.slice()}getMeasurementsReport(){const e=this.getMeasurements();return {measurements:e,median:Number(this.stat.median(e).toFixed(1)),average:Number(this.stat.average(e).toFixed(1)),variance:Number(this.stat.variance(e).toFixed(1)),stdDev:Number(this.stat.standardDeviation(e).toFixed(1))}}}class Hf{constructor(e={className:"minemap-fps-control"}){this.measurer=new Uf,this.options=e,this.countRenderBound=this.measurer.registerRenderFrame.bind(this.measurer),this.updateFPSCounterBound=this.updateFPSCounter.bind(this),this.lastFPSMeasure=null;}updateFPSCounter(){const e=this.measurer.getLastMeasurement(),t=this.measurer.getMeasurementsReport();if(e===this.lastFPSMeasure)return;let i=`FPS:${e.toFixed(1)}<br />`;i+=`平均值:${t.median}<br />`,this._container.innerHTML=i;}onAdd(e){return this._map=e,this._container=document.createElement("div"),this._container.className=`${this.options.className} minemap-ctrl-group minemap-ctrl`,this.addEventListeners(),this.measurer.startMeasuring(),this._container}remove(){this.onRemove();}onRemove(){this.removeEventListeners(),this.measurer.stopMeasuring(),this._container.remove();}addEventListeners(){this._map.on("render",this.countRenderBound),this._map.on("render",this.updateFPSCounterBound);}removeEventListeners(){this._map.off("render",this.countRenderBound),this._map.off("render",this.updateFPSCounterBound);}}var zf=e.createCommonjsModule((function(e){function t(e){return !i(e)}function i(e){return "undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return !1;var e,t,i=new Blob([""],{type:"text/javascript"}),s=URL.createObjectURL(i);try{t=new Worker(s),e=!0;}catch(t){e=!1;}return t&&t.terminate(),URL.revokeObjectURL(s),e}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){const e=document.createElement("canvas");e.width=e.height=1;const t=e.getContext("2d");if(!t)return !1;const i=t.getImageData(0,0,1,1);return i&&i.width===e.width}()?(void 0===s[i=e&&e.failIfMajorPerformanceCaveat]&&(s[i]=function(e){const i=function(e){var i=document.createElement("canvas"),s=Object.create(t.webGLContextAttributes);return s.failIfMajorPerformanceCaveat=e,i.probablySupportsContext?i.probablySupportsContext("webgl",s)||i.probablySupportsContext("experimental-webgl",s):i.supportsContext?i.supportsContext("webgl",s)||i.supportsContext("experimental-webgl",s):i.getContext("webgl",s)||i.getContext("experimental-webgl",s)}(e);if(!i)return !1;const s=i.createShader(i.VERTEX_SHADER);return !(!s||i.isContextLost())&&(i.shaderSource(s,"void main() {}"),i.compileShader(s),!0===i.getShaderParameter(s,i.COMPILE_STATUS))}(i)),s[i]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var i;}e.exports?e.exports=t:window&&(window.minemap=window.minemap||{},window.minemap.supported=t,window.minemap.notSupportedReason=i);var s={};t.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};}));class Wf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1;}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,i=t?this._queue.concat(t):this._queue;for(const t of i)if(t.id===e)return void(t.cancelled=!0)}run(e=0){const t=this._currentlyRunning=this._queue;this._queue=[];for(const i of t)if(!i.cancelled&&(i.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1;}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[];}}class jf{constructor(t,i){this.map=i,this._sphereRender=t.sphereRender||!1,this._projection=t.projection||e.ProjectionType.MERCATOR,this.options=t;}get projection(){return this._projection}set projection(t){this._projection=t||e.ProjectionType.MERCATOR,this.map.transform.projection=this._projection,this.map.style.changWorkerProjection(this._projection),this.map.painter.projection=this._projection,this.map.isLatLon="LATLON"===t,this.map._tilingScheme="LATLON"===t?new Ot:new Dt;}}class Xf{constructor(e){this.camera=e,this._cameraClone=l.clone(e),this._cameraStartFired=!1,this._cameraMovedTime=void 0;}checkForCameraUpdates(){const t=this.camera,i=this._cameraClone;return Jf(t,i,e.CONSTS.CesiumMath.EPSILON15)?(this._cameraStartFired&&z()-this._cameraMovedTime>500&&(this._cameraStartFired=!1),!1):(this._cameraStartFired||(this._cameraStartFired=!0),this._cameraMovedTime=z(),l.clone(t,i),!0)}}const qf=new e.Vector3,Kf=new e.Vector3,Jf=(t,i,s)=>{const r=1/Math.max(1,((e,t)=>{const i=Math.max(Math.abs(e.x),Math.abs(t.x)),s=Math.max(Math.abs(e.y),Math.abs(t.y)),r=Math.max(Math.abs(e.z),Math.abs(t.z));return Math.max(Math.max(i,s),r)})(t.positionWC,i.positionWC));return e.Vector3.multiplyByScalar(t.positionWC,r,qf),e.Vector3.multiplyByScalar(i.positionWC,r,Kf),e.Vector3.equalsEpsilon(qf,Kf,s)&&e.Vector3.equalsEpsilon(t.directionWC,i.directionWC,s)&&e.Vector3.equalsEpsilon(t.upWC,i.upWC,s)&&e.Vector3.equalsEpsilon(t.rightWC,i.rightWC,s)&&e.Matrix4.equalsEpsilon(t.transform,i.transform,s)&&t.frustumCrate.frustum.equalsEpsilon(i.frustumCrate.frustum,s)};class Zf{constructor(t,i,s,r,n){this.tileSize=512,this._minZoom=t||0,this._maxZoom=i||22,this.width=0,this.height=0,this._position=new e.Vector3(0,0,0),this._cameraHeightConvertedZoom=0,this.scale=this.zoomScale(0),this._fov=e.CONSTS.TRANSFORM.FOV_IN_RADIANS,this._3dNearPlaneNumber=Number.MAX_VALUE,this._3dFarPlaneNumber=Number.MIN_VALUE,this._unmodified=!0,this._posMatrixCache={},this.latRange=[e.CONSTS.TRANSFORM.MIN_LAT,e.CONSTS.TRANSFORM.MAX_LAT],this._projection=s,this._terrainRender=!1,this.pixelMatrix=new e.Matrix4,this._hpr=new e.HeadingPitchRoll(0,0,0),this._pinchOperationData={lastMatrix:new e.Matrix4,_rollDiff:0,_pitchDiff:0,_headingDiff:0},this.near=.1,this.far=1e4,this._pinchPosition=null,this._adjustHeightStep=10,this._minHeightToDemSurface=1,this._maximumCameraCheckHeight=1e4,this._minimumCameraCheckHeightNoTerrain=1,this.activeCamera=new l,this.cameraCheck=new Xf(this.activeCamera),this.shadowCamera=new h,this._calcProjectionsMatrix(),this._minPitch=e.defined(r)?r:0,this._maxPitch=e.defined(n)?n:90,this._zoomDelta=0,this._panDelta=new e.Vector3(0,0,0),this._justTerrain=!1;}clone(){const e=new Zf(this._minZoom,this._maxZoom,this._projection);return e.width=this.width,e.height=this.height,e._position=this._position,e._cameraHeightConvertedZoom=this._cameraHeightConvertedZoom,e._fov=this._fov,e.hpr=this.hpr,e._unmodified=this._unmodified,e.update(),e}set minHeightToDemSurface(t){this._minHeightToDemSurface=e.defined(t)?t:1;}get minHeightToDemSurface(){return this._minHeightToDemSurface}updateNearFarPlane(e){this._3dNearPlaneNumber=e.near,this._3dFarPlaneNumber=e.far,this._calcProjectionsMatrix();}get terrainRender(){return this._terrainRender}set terrainRender(e){this._terrainRender=e;}set terrainSupplier(e){e instanceof Bl&&(this._terrainSupplier=e);}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.cameraPitch=Math.max(this.pitch,e));}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.cameraPitch=Math.min(this.pitch,e));}resize(t,i){this.width=t,this.height=i,this.pixelsToGLUnits=[2/t,-2/i],this._constrain(),this.cameraHeightToCartesianCenter=e.getDistanceFromZoom(this._fov,this.cameraHeightConvertedZoom,e.CONSTS.TRANSFORM.R),this.position[2]=this.cameraHeightToCartesianCenter-e.CONSTS.TRANSFORM.R,this.pixelMatrix=(new e.Matrix4).scale([this.width/2,-this.height/2,1]),this.pixelMatrix=new e.Matrix4(this.pixelMatrix).translate([1,-1,0]),this.update();}get zoom(){return Math.min(this.getMapViewParams().zoom,22)}get cameraHeightConvertedZoom(){return this._cameraHeightConvertedZoom}set zoomDelta(e){this._zoomDelta=e;}get zoomDelta(){return this._zoomDelta}set panDelta(e){this._panDelta=e;}get panDelta(){return this._panDelta}set positionHeight(t){this._fov&&this.positionHeight!==t&&(this._unmodified=!1,this._cameraHeightConvertedZoom=e.getZoomFromDistance(this._fov,t+e.CONSTS.TRANSFORM.R,e.CONSTS.TRANSFORM.R),this.scale=this.zoomScale(this._cameraHeightConvertedZoom),this.tileZoom=Math.floor(this._cameraHeightConvertedZoom),this.cameraHeightToCartesianCenter=e.CONSTS.TRANSFORM.R+t,this._position[2]=t,this._constrain(),this.update());}get positionHeight(){return this.position[2]}set pinchPosition(e){this._pinchPosition=e,this.update();}get pinchPosition(){return this._pinchPosition}_calcProjectionsMatrix(){if(0===this.width||0===this.height)return;const t=this._getIntersectionResultFromSharedTerrainTileCache(this.position[0],this.position[1],this.position[2]);let i,s;if(this.cameraHeightToTerrainSurface=Number.isFinite(t.intersectionZ)?t.intersectionZ:this.position[2],i=this.cameraHeightToTerrainSurface/40,this.zoom>5){const t=e.binaryFindRayIntersectionTop(this);s=t?Math.ceil(1.5*e.Vector3.distance(t.cartesian,this.getCameraPos())):3*this.position[2],this._3dNearPlaneNumber<i&&(i=this._3dNearPlaneNumber),this._3dFarPlaneNumber>s&&(s=this._3dFarPlaneNumber);}else s=this.position[2]+e.CONSTS.TRANSFORM.R/Math.pow(1.2,this.zoom);i<.1&&(i=.1),s<=i+500&&(s=i+500),this.near=i,this.far=s,this.activeCamera.updatePerspectiveOptions({fov:this.fov,aspect:this.width/this.height,near:i,far:s}),this.activeCamera.updateCullingVolume(),this.shadowCamera.update();}set projection(e){this._projection=e;}get projection(){return this._projection}locationPoint(t,i){const s=e.Transforms.cartographicToCartesian3([t.lng,t.lat,i||0]),r=e.Transforms.pointToWindowCoordinates(this.activeCamera.getVPMatrix(),this.pixelMatrix,new e.Vector3(s));return new e.pointGeometry3d(r.x,r.y)}set hpr(e){this._hpr=e,this.update();}get hpr(){return this._hpr}get pitch(){return (this.activeCamera.pitch+.5*Math.PI)*e.CONSTS.TRANSFORM.RAD_TO_DEG}set pitch(t){const i=e.clamp(t,this.minPitch,this.maxPitch)*e.CONSTS.TRANSFORM.DEG_TO_RAD;this._hpr.pitch!==i&&(this._unmodified=!1,this._hpr.pitch=i,this.update());}get bearing(){return e.wrap(this.activeCamera.heading,-Math.PI,Math.PI)*e.CONSTS.TRANSFORM.RAD_TO_DEG}set bearing(t){const i=e.wrap(t,-180,180)*e.CONSTS.TRANSFORM.DEG_TO_RAD;this._hpr.heading!==i&&(this._unmodified=!1,this._hpr.heading=i,this.update());}get roll(){return e.wrap(this.activeCamera.roll,-Math.PI,Math.PI)*e.CONSTS.TRANSFORM.RAD_TO_DEG}set roll(t){const i=e.wrap(t,-180,180)*Math.PI/180;this._hpr.roll!==i&&(this._unmodified=!1,this._hpr.roll=i,this.update());}get center(){return this.getMapViewParams().center}checkCameraChanged(){const e=this.__oldVal;return !e||e[0]!==this.activeCamera.cartographicPosition[0]||e[1]!==this.activeCamera.cartographicPosition[1]||e[2]!==this._cameraHeightConvertedZoom||e[3]!==this.bearing||e[4]!==this.pitch||e[5]!==this.roll}getMapViewParams(){if(!this.checkCameraChanged())return this.__oldVal[6];this._cameraHeightConvertedZoom=e.getZoomFromDistance(this._fov,this.position[2]+e.CONSTS.TRANSFORM.R,e.CONSTS.TRANSFORM.R);const t=[this.activeCamera.cartographicPosition[0],this.activeCamera.cartographicPosition[1],this._cameraHeightConvertedZoom,this.bearing,this.pitch,this.roll],i=e.Transforms.convertV4Pos2V34Traversal(t,this);let s;return this.scale=this.zoomScale(this._cameraHeightConvertedZoom),this.tileZoom=Math.floor(this._cameraHeightConvertedZoom),this.cameraHeightToCartesianCenter=e.CONSTS.TRANSFORM.R+this.position[2],s=i?{center:new e.LngLat(i[0],i[1]),zoom:i[2],bearing:i[3],pitch:i[4],roll:i[5]}:{center:new e.LngLat(this.activeCamera.cartographicPosition[0],this.activeCamera.cartographicPosition[1]),zoom:this._cameraHeightConvertedZoom,pitch:this.pitch,bearing:this.bearing,roll:this.roll},s.zoom<0&&(s.zoom=0),this.activeCamera.mapZoom=s.zoom,this._position=this.activeCamera.cartographicPosition,this.activeCamera.heightZoom=this._cameraHeightConvertedZoom,this.__oldVal=t,this.__oldVal.push(s),s}get position(){return this.activeCamera.cartographicPosition}set position(e){!e||e[0]===this.position[0]&&e[1]===this.position[1]&&e[2]===this.position[2]||(this._unmodified=!1,this._position[0]=e[0],this._position[1]=e[1],this._constrain(),this.update(),this.positionHeight=e[2]);}_constrain(){}pointLocation(t,i){return e.getPickPositionOfSurface({canvasX:t.x,canvasY:t.y,transform:this,ellipsoid:i}).lngLat}getLocationAtPointDiff(t,i,s){const r=e.getPickPositionOfSurface({canvasX:i.x,canvasY:i.y,transform:this,ellipsoid:s});return r.lngLat&&t?[r.lngLat.lng-t.lng,r.lngLat.lat-t.lat]:[0,0]}setLocationAtPoint(e,t){const i=this.getLocationAtPointDiff(e,t);0==i[0]&&0==i[1]||(this.position=[this.position[0]-i[0],this.position[1]-i[1],this.position[2]]);}_getIntersectionResultFromSharedTerrainTileCache(t,i,s){if(this._terrainRender&&this._terrainSupplier){const r=e.defined(s)?s:this.position[2];return Il([t,i,r],e.Vector3.fromDegrees(t,i,r),this._terrainSupplier,this._projection)}return {intersectionZ:1/0,intersectionPoint:null,isUnderground:!1}}pointCoordinate(t,i){const s=e.getPickPositionOfSurface({canvasX:t.x,canvasY:t.y,transform:this});return s.lngLat?new e.Coordinate(e.ProjectionProxy.lngX(s.lngLat.lng,this.worldSize,this._projection)/this.tileSize,e.ProjectionProxy.latY(s.lngLat.lat,this.worldSize,this._projection)/this.tileSize,this.cameraHeightConvertedZoom)._zoomTo(i||this.cameraHeightConvertedZoom):null}_calculateTDSceneMatrix(){this._calcProjectionsMatrix();const t={destination:e.Vector3.fromDegrees(this._position[0],this._position[1],this._position[2]),orientation:new e.HeadingPitchRoll(this.hpr.heading,this.hpr.pitch-.5*Math.PI,this.hpr.roll)};this.activeCamera.setView(t);}update(){this.height&&(e.Vector3.equals(new e.Vector3(this._position),e.Vector3.ZERO)&&(this._position=this.activeCamera.cartographicPosition),this._calculateTDSceneMatrix());}calculateVPMatrix(){return this.activeCamera.getVPMatrix()}getCameraPos(){return this.activeCamera.positionWC}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e);}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e);}get worldSize(){return this.tileSize*this.scale}get centerPoint(){return this.size._div(2)}get size(){return new e.pointGeometry3d(this.width,this.height)}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(179.99,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this.update());}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(t){return new e.pointGeometry3d(e.ProjectionProxy.lngX(t.lng,this.worldSize,this._projection),e.ProjectionProxy.latY(t.lat,this.worldSize,this._projection))}unproject(t){return new e.LngLat(e.ProjectionProxy.xLng(t.x,this.worldSize,this._projection),e.ProjectionProxy.yLat(t.y,this.worldSize,this._projection))}get x(){return e.ProjectionProxy.lngX(this.center.lng,this.worldSize,this._projection)}get y(){return e.ProjectionProxy.latY(this.center.lat,this.worldSize,this._projection)}get point(){return new e.pointGeometry3d(this.x,this.y)}locationCoordinate(t){const i=e.ProjectionProxy.latY(t.lat,this.worldSize,this._projection);return this.tileZoom||(this.tileZoom=this.cameraHeightConvertedZoom),new e.Coordinate(e.ProjectionProxy.lngX(t.lng,this.worldSize,this._projection)/this.tileSize,i/this.tileSize,this.cameraHeightConvertedZoom).zoomTo(this.tileZoom)}}const Yf={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Qf extends e.Evented{constructor(t){if(super(),(arguments[0]instanceof e.window.HTMLElement||2===arguments.length)&&(t=e.extend({element:t},arguments[1])),e.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._lngLat=new e.LngLat(0,0),this._anchor=t&&t.anchor||"top-left",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this.heightToSurface=0,this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&"auto"!==t.pitchAlignment?t.pitchAlignment:this._rotationAlignment,this._uuid=e.uuid(),this._updateMoving=()=>this._update(!0),t&&t.element)this._element=t.element,this._offset=e.pointGeometry3d.convert(t&&t.offset||[0,0]);else {this._defaultMarker=!0,this._element=W.create("div"),this._element.oncontextmenu=()=>!1;const i=41,s=27,r=W.createNS("http://www.w3.org/2000/svg","svg");r.setAttributeNS(null,"height",`${i}px`),r.setAttributeNS(null,"width",`${s}px`),r.setAttributeNS(null,"viewBox",`0 0 ${s} ${i}`);const n=W.createNS("http://www.w3.org/2000/svg","g");n.setAttributeNS(null,"stroke","none"),n.setAttributeNS(null,"stroke-width","1"),n.setAttributeNS(null,"fill","none"),n.setAttributeNS(null,"fill-rule","evenodd");const o=W.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"fill-rule","nonzero");const a=W.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"transform","translate(3.0, 29.0)"),a.setAttributeNS(null,"fill","#000000");const l=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const e of l){const t=W.createNS("http://www.w3.org/2000/svg","ellipse");t.setAttributeNS(null,"opacity","0.04"),t.setAttributeNS(null,"cx","10.5"),t.setAttributeNS(null,"cy","5.80029008"),t.setAttributeNS(null,"rx",e.rx),t.setAttributeNS(null,"ry",e.ry),a.appendChild(t);}const h=W.createNS("http://www.w3.org/2000/svg","g");h.setAttributeNS(null,"fill",this._color);const _=W.createNS("http://www.w3.org/2000/svg","path");_.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),h.appendChild(_);const c=W.createNS("http://www.w3.org/2000/svg","g");c.setAttributeNS(null,"opacity","0.25"),c.setAttributeNS(null,"fill","#000000");const d=W.createNS("http://www.w3.org/2000/svg","path");d.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),c.appendChild(d);const u=W.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"transform","translate(6.0, 7.0)"),u.setAttributeNS(null,"fill","#FFFFFF");const m=W.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(8.0, 8.0)");const p=W.createNS("http://www.w3.org/2000/svg","circle");p.setAttributeNS(null,"fill","#000000"),p.setAttributeNS(null,"opacity","0.25"),p.setAttributeNS(null,"cx","5.5"),p.setAttributeNS(null,"cy","5.5"),p.setAttributeNS(null,"r","5.4999962");const f=W.createNS("http://www.w3.org/2000/svg","circle");f.setAttributeNS(null,"fill","#FFFFFF"),f.setAttributeNS(null,"cx","5.5"),f.setAttributeNS(null,"cy","5.5"),f.setAttributeNS(null,"r","5.4999962"),m.appendChild(p),m.appendChild(f),o.appendChild(a),o.appendChild(h),o.appendChild(c),o.appendChild(u),o.appendChild(m),r.appendChild(o),r.setAttributeNS(null,"height",i*this._scale+"px"),r.setAttributeNS(null,"width",s*this._scale+"px"),this._element.appendChild(r),this._offset=e.pointGeometry3d.convert(t&&t.offset||[-13.5*this._scale,-35*this._scale]);}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("minemap-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault();})),this._element.addEventListener("mousedown",(e=>{"INPUT"!==e.view.document.activeElement.tagName&&e.preventDefault();}));const i=this._element.classList;for(const e in Yf)i.remove(`minemap-marker-anchor-${e}`);i.add(`minemap-marker-anchor-${this._anchor}`),this._popup=null,this.updateBoundingVolume();}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),e._markers.push(this)),this}remove(){const e=this._map;if(e){e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer);const t=e._markers.indexOf(this);-1!==t&&e._markers.splice(t,1),this._draggable&&!1===this._map.cameraController.enableInputs&&(this._map.cameraController.enableInputs=!0),this._map=void 0;}return this._clearFadeTimer(),W.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return t=e.LngLat.convert(t),this._lngLat=t,this._pos=null,this.updateBoundingVolume(),this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getAltitude(){return this.heightToSurface}setAltitude(e){return this.heightToSurface=e,this.updateBoundingVolume(),this._pos=null,this._popup&&this._popup.setAltitude(this.heightToSurface),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,i=13.5,s=Math.sqrt(Math.pow(i,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[s,-1*(t-i+s)],"bottom-right":[-s,-1*(t-i+s)],left:[i,-1*(t-i)],right:[-i,-1*(t-i)]}:this._offset;}e._markerBinded=!0,this._popup=e,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false");}return this}_onKeyPress(e){const t=e.code,i=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==i&&13!==i||this.togglePopup();}_onMapClick(e){const t=e.originalEvent.target,i=this._element;this._popup&&(t===i||i.contains(t))&&this.togglePopup();}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null);}_updateDOM(){const t=this._pos||new e.pointGeometry3d(0,0),i=this._calculatePitch(),s=this._calculateRotation();this._element.style.transform=`${Yf[this._anchor]} translate(${t.x}px, ${t.y}px) rotateX(${i}deg) rotateZ(${s}deg)`;}_calculatePitch(){return "viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?0:"map"===this._pitchAlignment?this._map.getPitch():0}_calculateRotation(){return "viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?this._rotation:"map"===this._rotationAlignment?this._rotation-this._map.getBearing():0}_calculatePanoramaMode(){const t=this._map.transform.activeCamera.frustumCrate.cullingVolume.computeVisibility(this.boundingVolume);if(this._element.style.visibility=t===e.INTERSECTION.OUTSIDE?"hidden":"visible","visible"==this._element.style.visibility){const t=e.Transforms.cartographicToCartesian3([this._lngLat.lng,this._lngLat.lat,this.heightToSurface]),i=new e.Vector3(this._map.transform.getCameraPos()),s=new e.Vector3(t[0]-i[0],t[1]-i[1],t[2]-i[2]).normalize(),r=e.getPickPositionOfSurfaceByOriginAndDir(i,s);r&&i.distance(r)<i.distance(t)-1e4&&(this._element.style.visibility="hidden");}}_calculateOffset(){return "viewport"===this._rotationAlignment||"auto"===this._rotationAlignment||"map"===this._rotationAlignment||"map"===this._pitchAlignment?this._offset:e.pointGeometry3d.convert([0,0])}calculateScreenCoordinates(){const t=e.Transforms.cartographicToCartesian3(new e.Vector3(this._lngLat.lng,this._lngLat.lat,this.heightToSurface||0)),i=this._map.transform,s=e.Transforms.pointToWindowCoordinatesFrontCheck(i.activeCamera.getVPMatrix(),i.pixelMatrix,new e.Vector3(t));return new e.pointGeometry3d(s.x<0?s.x:s.x*s.z,s.y<0?s.y:s.y*s.z)}_update(t){if(e.window.cancelAnimationFrame(this._updateFrameId),!this._map)return;this._pos=this.calculateScreenCoordinates()._add(this._offset),this._calculatePanoramaMode(),!0===t?this._updateFrameId=e.window.requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM());})):this._pos=this._pos.round();const i=this._calculateOffset(),s=Math.abs(i.x)/parseFloat(W.getAllStyle(this._element).width)*100,r=Math.abs(i.y)/parseFloat(W.getAllStyle(this._element).height)*100;W.setTransformOrigin(this._element,`${s}% ${r}%`),this._map._requestDomTask((()=>{this._element&&this._pos&&this._anchor&&this._updateDOM();}));}getOffset(){return this._offset}setOffset(t){return this._offset=e.pointGeometry3d.convert(t),this._update(),this}updateBoundingVolume(){this.boundingVolume=new e.BoundingSphere(e.Vector3.fromDegrees(this._lngLat.lng,this._lngLat.lat,this.heightToSurface),100);}_onMove(t){if(!this._isDragging){const e=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=e;}if(!this._isDragging)return;this._pos=t.point.sub(this._positionDelta);const i=new e.Ellipsoid(e.WGS84_RADIUS_X+this.heightToSurface,e.WGS84_RADIUS_Y+this.heightToSurface,e.WGS84_RADIUS_Z+this.heightToSurface),s=this._map.isTerrain(),r=s?this._map.getPositionByGPUPick(this._pos):this._map.unproject(this._pos,i);r&&(this._lngLat=s?e.LngLat.convert([r[0],r[1]]):r,s&&this.setAltitude(r[2]),this.setLngLat(this._lngLat),this.updateBoundingVolume(),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.Event("dragstart"))),this.fire(new e.Event("drag")));}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),"active"===this._state&&this.fire(new e.Event("dragend")),this._state="inactive",this._map.cameraController.enableInputs=!0;}_addDragHandler(e){this._element.contains(e.originalEvent.target)&&(this._positionDelta=e.point.sub(this._pos).add(this._offset),this._pointerdownPos=e.point,this._map.cameraController.enableInputs=!1,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.on("mouseup",this._onUp),this._map.on("touchend",this._onUp));}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}enableDragging(){return this.setDraggable(!0),this}disableDragging(){return this.setDraggable(!1),this}isDraggable(){return this._draggable}getDraggable(){return this.isDraggable()}getMap(){return this._map}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&"auto"!==e?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class $f{constructor(){this.startTime=eg(),this.oldTime=this.startTime,this.totalTime=0,this._running=!1,this.needClearTime=!0,this._pause=!1,this.delta=0,this.counter=0;}update(t){if(this._running){const i=e.defaultValue(t,eg());this.needClearTime?this.needClearTime=!1:(this.delta=(i-this.oldTime)/1e3,this.counter+=(i-this.oldTime)/1e3,this.totalTime+=this.delta),this.oldTime=i;}}reset(){return this.startTime=eg(),this.oldTime=this.startTime,this.totalTime=0,this._running=!1,this.needClearTime=!0,this._pause=!1,this.delta=0,this.counter=0,this.totalTime}get state(){return this._running}set state(e){this._running=e,e||(this.needClearTime=!0);}pauseTimer(){this.state=!1;}resumeTimer(){this.state=!0;}getDelta(){let e=0;return this._running&&(e=this.delta),e}}function eg(){return ("undefined"==typeof performance?Date:performance).now()}const tg={"FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","GeolocateControl.Geolocate":"Geolocate","LogoControl.Title":"MineMap logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},ig=["u_VIDEOMATCH_MVPMATRIX","u_VIDEOMATCH_RTP","u_ClipColors","u_VideoSampler","u_HAS_VIDEOMATCHMAP","u_Alpha","u_ActiveClipVideoTexture","u_ClipVideo","u_ClipMatrix","u_MaskSample","u_TextureSize"];class sg{constructor(e,t){this._videoManager=e,this._usedVideos=[],this._videoUniform=void 0,this.type=t,"Raster"===this.type?this._rasterTiles=[]:"3DTiles"===this.type?this._selectedTiles=[]:"3DModel"===this.type?this._selectedModelTiles=[]:"Polygon"===this.type&&(this._selectedPolygons=[]);}update(t){"3DModel"!==this.type&&"3DTiles"!==this.type?(this.selectTiles(t),this._usedVideos.length<1||(e.defined(this._videoUniform)||(this._videoUniform=this.getVideoUniformsCallback()),this.addUniforms())):this._usedVideos=[];}addUniforms(){if("Raster"===this.type)for(let t=0;t<this._rasterTiles.length;t++)this._rasterTiles[t]._material._uniforms=e.combineInternalMap(this._rasterTiles[t]._material._uniforms,this._videoUniform),this._rasterTiles[t]._material.defines={NUM_VIDEOS:this._usedVideos.length};else if("3DTiles"===this.type){if(this._selectedTiles.length>0)for(let t=0;t<this._selectedTiles.length;t++){const i=this._selectedTiles[t]._material;i._uniforms=e.combineInternalMap(i._uniforms,this._videoUniform),i.defines={NUM_VIDEOS:this._usedVideos.length};}}else if("3DModel"===this.type){if(this._selectedModelTiles.length>0)for(let t=0;t<this._selectedModelTiles.length;t++){const i=this._selectedModelTiles[t]._material;i._uniforms=e.combineInternalMap(i._uniforms,this._videoUniform),i.defines={NUM_VIDEOS:this._usedVideos.length};}}else if("Polygon"===this.type){const t=this._selectedPolygons;if(t.length>0)for(let i=0;i<t.length;i++){const s=t[i]._material;s._uniforms=e.combineInternalMap(s._uniforms,this._videoUniform),s.defines={NUM_VIDEOS:this._usedVideos.length};}}}removeUniforms(){if("Raster"===this.type){if(this._rasterTiles.length>0){for(let t=0;t<this._rasterTiles.length;t++)if(e.defined(this._rasterTiles[t]._material&&this._rasterTiles[t]._material._uniforms)){for(let e=0;e<ig.length;e++)this._rasterTiles[t]._material._uniforms.delete(ig[e]);this._rasterTiles[t]._material.defines={NUM_VIDEOS:0};}this._rasterTiles=[];}}else if("3DTiles"===this.type){if(this._selectedTiles.length>0){for(let e=0;e<this._selectedTiles.length;e++){const t=this._selectedTiles[e]._material;if(null!=t&&null!=t._uniforms){for(let e=0;e<ig.length;e++)t._uniforms.delete(ig[e]);t.defines={NUM_VIDEOS:0};}}this._selectedTiles=[];}}else if("3DModel"===this.type){if(this._selectedModelTiles.length>0){for(let e=0;e<this._selectedModelTiles.length;e++){const t=this._selectedModelTiles[e]._material;if(null!=t&&null!=t._uniforms){for(let e=0;e<ig.length;e++)t._uniforms.delete(ig[e]);t.defines={NUM_VIDEOS:0};}}this._selectedModelTiles=[];}}else if("Polygon"===this.type){const e=this._selectedPolygons;if(e.length>0){for(let t=0;t<e.length;t++){const i=e[t]._material;for(let e=0;e<ig.length;e++)i._uniforms.delete(ig[e]);i.defines={NUM_VIDEOS:0};}this._selectedPolygons=[];}}}selectTiles(t){this._usedVideos=[],e.defined(t.style)&&("Raster"===this.type&&this._selectRaster(t.style.rasterSourceCache),"Polygon"===this.type&&this._selectPolygons(t));}_selectRaster(e){let t=[];if(e&&e.getVisibleCoordinates){t=e.getVisibleCoordinates(!1);const i=this._videoManager.getAll(),s=i.length<=this._videoManager._maxUsedVideoUnit?i.length:this._videoManager._maxUsedVideoUnit;for(let r=0;r<s;r++){if(!i[r].usedRaster||!i[r].enabled)continue;const s=i[r]._perspectiveCamera.frustumCrate.cullingVolume;let n=!1;for(let i=0;i<t.length;i++){const r=e.getTile(t[i]).primitive;r&&-1!==(s?s.computeVisibility(r.boundingBox):-1)&&(this._rasterTiles.push(r),n=!0);}n&&this._usedVideos.push(i[r]);}}}select3DModel(t){e.defined(t)&&t.length>0&&this._select3DModel(t),this._usedVideos.length<1||(e.defined(this._videoUniform)||(this._videoUniform=this.getVideoUniformsCallback()),this.addUniforms());}_select3DModel(e){let t;const i=this._videoManager.getAll(),s=i.length<=this._videoManager._maxUsedVideoUnit?i.length:this._videoManager._maxUsedVideoUnit;for(let r=0;r<s;r++){if(!i[r].used3DModel||!i[r].enabled)continue;let s=!1;const n=i[r]._perspectiveCamera.frustumCrate.cullingVolume;if(e.length>0)for(let i=0;i<e.length;i++)t=e[i],void 0!==t&&(t.updateMatrixWorld(!0),-1!==(n?n.computeVisibility(t.boundingVolume):-1)&&(this._selectedModelTiles.push(t),s=!0));s&&this._usedVideos.push(i[r]);}}select3DTiles(t){e.defined(t)&&t.length>0&&this._select3DTiles(t),this._usedVideos.length<1||(e.defined(this._videoUniform)||(this._videoUniform=this.getVideoUniformsCallback()),this.addUniforms());}_select3DTiles(e){let t;const i=this._videoManager.getAll(),s=i.length<=this._videoManager._maxUsedVideoUnit?i.length:this._videoManager._maxUsedVideoUnit;for(let r=0;r<s;r++){if(!i[r].used3DTiles||!i[r].enabled)continue;let s=!1;const n=i[r]._perspectiveCamera.frustumCrate.cullingVolume;if(e.length>0)for(let i=0;i<e.length;i++)t=e[i],void 0!==t&&(t.updateMatrixWorld(!0),-1!==(n?n.computeVisibility(t.boundingVolume):-1)&&(this._selectedTiles.push(t),s=!0));s&&this._usedVideos.push(i[r]);}}_selectPolygons(e){let t;const i=e.style.primitiveCollection.getAll(),s=this._videoManager.getAll(),r=s.length<=this._videoManager._maxUsedVideoUnit?s.length:this._videoManager._maxUsedVideoUnit;for(let e=0;e<r;e++){if(!s[e].usedPolygon||!s[e].enabled)continue;let r=!1;const n=s[e]._perspectiveCamera.frustumCrate.cullingVolume;if(i.length>0)for(let e=0;e<i.length;e++)t=i[e],void 0!==t&&t.usedVideoProjection&&(i[e].updateMatrixWorld(!0),-1!==(n?n.computeVisibility(t.boundingVolume):-1)&&(-1===this._selectedPolygons.indexOf(t)&&this._selectedPolygons.push(t),r=!0));r&&this._usedVideos.push(s[e]);}}getVideoUniformsCallback(){const t=this;let i=[],s=[],r=[],n=[],o=[],a=[],l=[];return new Map([["u_VIDEOMATCH_MVPMATRIX",()=>{const e=t._usedVideos,s=e.length;i=[];for(let t=0;t<s;t++){const s=e[t];s.enabled&&i.push(s.videoMatrix);}return i}],["u_VIDEOMATCH_RTP",()=>{const e=t._usedVideos,i=e.length;s=[];for(let t=0;t<i;t++){const i=e[t];i.enabled&&s.push(i.cartographic);}return s}],["u_ClipColors",()=>{const e=t._usedVideos,i=e.length;r=[];for(let t=0;t<i;t++){const i=e[t];i.enabled&&r.push(i._clipColor);}return r}],["u_VideoSampler",()=>{const e=t._usedVideos,i=e.length;n=[];for(let t=0;t<i;t++){const i=e[t];void 0!==i.videoTexture&&i.enabled&&n.push(i.videoTexture);}return n}],["u_HAS_VIDEOMATCHMAP",()=>{const e=t._usedVideos,i=e.length;o=[];for(let t=0;t<i;t++){const i=e[t].enabled;i&&o.push(i);}return o}],["u_Alpha",()=>{const e=t._usedVideos,i=e.length;a=[];for(let t=0;t<i;t++){const i=e[t];i.enabled&&a.push(i._alpha);}return a}],["u_ActiveClipVideoTexture",()=>{const e=t._usedVideos,i=e.length;l=[];for(let t=0;t<i;t++)e[t].enabled&&l.push(e[t]._clip&&this._videoManager._clipManager.getByName(e[t].uniqueId).length>0);return l}],["u_ClipVideo",()=>t._videoManager.enableClip],["u_ClipMatrix",()=>t._videoManager._projectionMatrix],["u_MaskSample",()=>{const e=t._usedVideos,i=e.length;n=[];for(let t=0;t<i;t++){const i=e[t];void 0!==i.videoTexture&&i.enabled&&n.push(i.videoTexture);}const s=t._videoManager._clipFill.framebuffer.getColorTexture(0);return s.bind(),s}],["u_TextureSize",()=>new e.Vector2(t._videoManager._clipFill.framebuffer.width,t._videoManager._clipFill.framebuffer.height)]])}empty(){this._selectedModelTiles=[],this._rasterTiles=[],this._selectedTiles=[],this._selectedPolygons=[];}}class rg extends e.Geometry{constructor(t){super({}),this.type="FrustumGeometry",this.primitiveType=e.WebGLConstants.TRIANGLES,this.setData(t);}setData(t){super.setData(),this.near=t.near,this.far=t.far,this.frustumType=t.type,this.position=new e.Vector3,this.quaternion=new e.Quaternion,this.camera=t,this._usedDoublePrecision=!1,this._vertexArray?(this._vertexArray.clear(),this._indexArray.clear()):(this._vertexArray=this._usedDoublePrecision?new e.StructArrayLayout11f44:new e.StructArrayLayout3f2f3f32,this._indexArray=new e.StructArrayLayout3ui6),this.numberOfPlanes=6,this.parse(),this.computeBoundingSphere(),this.computeBoundingBox();}parse(){let e=new Float64Array(72);e=this.computeNearFarPlanes(this.position,this.quaternion,this.frustumType,this.camera,e),e=this.computerOthersPlans(e),this.vertices=e,this.computerNormalAndUvAndIndices();for(let e=0;e<this.indices.length;e+=3)this._indexArray.emplaceBack(this.indices[e],this.indices[e+2],this.indices[e+1]);this.emplaceVertexBufferTriangle(),this.needUpdate=!0;}computeNearFarPlanes(t,i,s,r,n,o,a,l){const h=new e.Matrix3,_=new e.Matrix4,c=new e.Matrix4;this.scratchXDirection=new e.Vector3,this.scratchYDirection=new e.Vector3,this.scratchZDirection=new e.Vector3;const d=new Array(3),u=new Array(4);u[0]=new e.Vector4(-1,-1,1,1),u[1]=new e.Vector4(1,-1,1,1),u[2]=new e.Vector4(1,1,1,1),u[3]=new e.Vector4(-1,1,1,1);const m=(new e.Matrix3).fromQuaternion(i,h);let p=e.defaultValue(o,this.scratchXDirection),f=e.defaultValue(a,this.scratchYDirection),g=e.defaultValue(l,this.scratchZDirection);p=e.Matrix3.getColumn(m,0,p),f=e.Matrix3.getColumn(m,1,f),g=e.Matrix3.getColumn(m,2,g),e.Vector3.normalize(p,p),e.Vector3.normalize(f,f),e.Vector3.normalize(g,g),e.Vector3.negate(p,p),e.Vector3.negate(g,g);const y=e.Matrix4.computeView(t,g,f,p,_),T=new Array(4);for(let t=0;t<4;++t)T[t]=new e.Vector4;let C,x;if("PerspectiveCamera"===this.frustumType){const t=e.Matrix4.multiply(c,y,r.frustumCrate.frustum.projectionMatrix);x=e.Matrix4.inverse(t,c);}else "OrthographicCamera"===this.frustumType&&(C=e.Matrix4.inverseTransformation(y,c));e.defined(x)?(d[0]=this.near,d[1]=this.far):(d[0]=0,d[1]=this.near,d[2]=this.far);for(let i=0;i<2;++i)for(let s=0;s<4;++s){let o=e.Vector4.clone(u[s],T[s]);if(e.defined(x)){o=e.Matrix4.multiplyByVector(x,o,o),e.Vector3.multiplyByScalar(o,1/o.w,o),e.Vector3.subtract(o,t,o),e.Vector3.normalize(o,o);const s=e.Vector3.dot(g,o);e.Vector3.multiplyByScalar(o,d[i]/s,o),e.Vector3.add(o,t,o);}else {e.defined(r.frustumCrate.frustum._offCenterFrustum)&&(r.frustumCrate.frustum=r.frustumCrate.frustum._offCenterFrustum);const t=d[i],s=d[i+1];o.x=.5*(o.x*(r.frustumCrate.frustum.right-r.frustumCrate.frustum.left)+r.frustumCrate.frustum.left+r.frustumCrate.frustum.right),o.y=.5*(o.y*(r.frustumCrate.frustum.top-r.frustumCrate.frustum.bottom)+r.frustumCrate.frustum.bottom+r.frustumCrate.frustum.top),o.z=.5*(o.z*(t-s)-t-s),o.w=1,e.Matrix4.multiplyByVector(C,o,o);}n[12*i+3*s]=o.x,n[12*i+3*s+1]=o.y,n[12*i+3*s+2]=o.z;}return n}computerOthersPlans(e){let t=24;return e[t]=e[12],e[t+1]=e[13],e[t+2]=e[14],e[t+3]=e[0],e[t+4]=e[1],e[t+5]=e[2],e[t+6]=e[9],e[t+7]=e[10],e[t+8]=e[11],e[t+9]=e[21],e[t+10]=e[22],e[t+11]=e[23],t+=12,e[t]=e[15],e[t+1]=e[16],e[t+2]=e[17],e[t+3]=e[3],e[t+4]=e[4],e[t+5]=e[5],e[t+6]=e[0],e[t+7]=e[1],e[t+8]=e[2],e[t+9]=e[12],e[t+10]=e[13],e[t+11]=e[14],t+=12,e[t]=e[3],e[t+1]=e[4],e[t+2]=e[5],e[t+3]=e[15],e[t+4]=e[16],e[t+5]=e[17],e[t+6]=e[18],e[t+7]=e[19],e[t+8]=e[20],e[t+9]=e[6],e[t+10]=e[7],e[t+11]=e[8],t+=12,e[t]=e[6],e[t+1]=e[7],e[t+2]=e[8],e[t+3]=e[18],e[t+4]=e[19],e[t+5]=e[20],e[t+6]=e[21],e[t+7]=e[22],e[t+8]=e[23],e[t+9]=e[9],e[t+10]=e[10],e[t+11]=e[11],e}getAttributes(t,i,s,r,n,o,a,l){const h=t/3*2;for(let n=0;n<4;++n)e.defined(i)&&(i[t]=o.x,i[t+1]=o.y,i[t+2]=o.z),e.defined(s)&&(s[t]=a.x,s[t+1]=a.y,s[t+2]=a.z),e.defined(r)&&(r[t]=l.x,r[t+1]=l.y,r[t+2]=l.z),t+=3;n[h]=0,n[h+1]=0,n[h+2]=1,n[h+3]=0,n[h+4]=1,n[h+5]=1,n[h+6]=0,n[h+7]=1;}computerNormalAndUvAndIndices(){const t=new Float32Array(12*this.numberOfPlanes),i=new Float32Array(12*this.numberOfPlanes),s=new Float32Array(12*this.numberOfPlanes),r=new Float32Array(8*this.numberOfPlanes),n=this.scratchXDirection,o=this.scratchYDirection,a=this.scratchZDirection,l=new e.Vector3,h=new e.Vector3,_=new e.Vector3,c=e.Vector3.negate(n,l),d=e.Vector3.negate(o,h),u=e.Vector3.negate(a,_);let m=0;this.getAttributes(m,t,i,s,r,a,c,o),m+=12,this.getAttributes(m,t,i,s,r,c,u,o),m+=12,this.getAttributes(m,t,i,s,r,d,u,c),m+=12,this.getAttributes(m,t,i,s,r,n,a,o),m+=12,this.getAttributes(m,t,i,s,r,o,a,c),this.indices=new Uint16Array(6*this.numberOfPlanes),this.normals=t,this.uvs=r;for(let e=0;e<this.numberOfPlanes;++e){const t=6*e,i=4*e;this.indices[t]=i,this.indices[t+1]=i+1,this.indices[t+2]=i+2,this.indices[t+3]=i,this.indices[t+4]=i+2,this.indices[t+5]=i+3;}}update(t){if(this.needUpdate&&t.painter){this.needUpdate=!1;const i=t.painter.context;this._vertexBuffer&&this._indexBuffer?(this._vertexBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indexArray)):(this._vertexBuffer=i.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?e.layout.members:e.layout$1.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indexArray,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/3);}}serialize(){return {type:this.type,camera:this.camera.serialize()}}destroy(){super.destroy(),this.needUpdate=null,this.indices=null,this.vertices=null,this.uvs=null,this.vertices=null;}}class ng extends e.Geometry{constructor(t){super({}),this.type="FrustumOutlineGeometry",this.primitiveType=e.WebGLConstants.LINES,this.setData(t);}setData(t){super.setData(),this.frustumType=t.type,this.position=new e.Vector3,this.quaternion=new e.Quaternion,this.camera=t,this.numberOfPlanes=6,this.vertices=new Float64Array(24),this.indices=new Uint16Array(24),this._usedDoublePrecision=!1,this._vertexArray?(this._vertexArray.clear(),this._indexArray.clear()):(this._vertexArray=this._usedDoublePrecision?new e.StructArrayLayout3f3f24:new e.StructArrayLayout3f12,this._indexArray=new e.StructArrayLayout2ui4),this.needUpdate=!0,this.parse(),this.computeBoundingSphere(),this.computeBoundingBox();}parse(){this._computeNearFarPlanes(),this._computeIndices(),this._createStructArray();}update(t){if(this.needUpdate&&t.painter){this.needUpdate=!1;const i=t.painter.context;this._vertexBuffer&&this._indexBuffer?(this._vertexBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indexArray)):(this._vertexBuffer=i.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?ju.members:Xu.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indexArray,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/2);}}_createStructArray(){this.emplaceVertexBufferOfLines();for(let e=0;e<this.indices.length;e+=2)this._indexArray.emplaceBack(this.indices[e],this.indices[e+1]);}_computeNearFarPlanes(){const t=new e.Matrix3,i=(new e.Matrix3).fromQuaternion(this.quaternion,t),s=new e.Matrix4,r=new Array(4);r[0]=new e.Vector4(-1,-1,1,1),r[1]=new e.Vector4(1,-1,1,1),r[2]=new e.Vector4(1,1,1,1),r[3]=new e.Vector4(-1,1,1,1);const n=new Array(4);for(let t=0;t<4;++t)n[t]=new e.Vector4;let o=new e.Vector3,a=new e.Vector3,l=new e.Vector3;o=e.Matrix3.getColumn(i,0,o),a=e.Matrix3.getColumn(i,1,a),l=e.Matrix3.getColumn(i,2,l),e.Vector3.normalize(o,o),e.Vector3.normalize(a,a),e.Vector3.normalize(l,l),e.Vector3.negate(o,o),e.Vector3.negate(l,l);const h=e.Matrix4.computeView(this.position,l,a,o,new e.Matrix4);let _,c;if("PerspectiveCamera"===this.frustumType){const t=e.Matrix4.multiply(s,this.camera.frustumCrate.frustum.projectionMatrix,h);c=e.Matrix4.inverse(t,s);}else _=e.Matrix4.inverseTransformation(h,s);const d=new Array(3);e.defined(c)?(d[0]=this.camera.near,d[1]=this.camera.far):(d[0]=0,d[1]=this.camera.near,d[2]=this.camera.far);for(let t=0;t<2;++t)for(let i=0;i<4;++i){let s=e.Vector4.clone(r[i],n[i]);if(e.defined(c)){s=e.Matrix4.multiplyByVector(c,s,s),e.Vector3.multiplyByScalar(s,1/s.w,s),e.Vector3.subtract(s,this.position,s),e.Vector3.normalize(s,s);const i=e.Vector3.dot(l,s);e.Vector3.multiplyByScalar(s,d[t]/i,s),e.Vector3.add(s,this.position,s);}else {e.defined(this.camera.frustumCrate.frustum._offCenterFrustum)&&(this.camera.frustumCrate.frustum=this.camera.frustumCrate.frustum._offCenterFrustum);const i=d[t],r=d[t+1];s.x=.5*(s.x*(this.camera.frustumCrate.frustum.right-this.camera.frustumCrate.frustum.left)+this.camera.frustumCrate.frustum.left+this.camera.frustumCrate.frustum.right),s.y=.5*(s.y*(this.camera.frustumCrate.frustum.top-this.camera.frustumCrate.frustum.bottom)+this.camera.frustumCrate.frustum.bottom+this.camera.frustumCrate.frustum.top),s.z=.5*(s.z*(i-r)-i-r),s.w=1,e.Matrix4.multiplyByVector(_,s,s);}this.vertices[12*t+3*i]=s.x,this.vertices[12*t+3*i+1]=s.y,this.vertices[12*t+3*i+2]=s.z;}}_computeIndices(){let e,t,i=0;for(;i<2;++i)e=8*i,t=4*i,this.indices[e]=t,this.indices[e+1]=t+1,this.indices[e+2]=t+1,this.indices[e+3]=t+2,this.indices[e+4]=t+2,this.indices[e+5]=t+3,this.indices[e+6]=t+3,this.indices[e+7]=t;for(i=0;i<2;++i)e=8*(2+i),t=4*i,this.indices[e]=t,this.indices[e+1]=t+4,this.indices[e+2]=t+1,this.indices[e+3]=t+5,this.indices[e+4]=t+2,this.indices[e+5]=t+6,this.indices[e+6]=t+3,this.indices[e+7]=t+7;}serialize(){return {type:this.type,camera:this.camera.serialize()}}destroy(){super.destroy(),this.frustumType=void 0,this.position=void 0,this.quaternion=void 0,this.camera=void 0,this.type=void 0,this.primitiveType=void 0,this.numberOfPlanes=void 0,this.vertices=void 0,this.indices=void 0,this._vertexArray=void 0,this._indexArray=void 0,this.needUpdate=void 0;}}const og=new Uint32Array(1);class ag extends e.Evented{constructor(t){if(super(),this.videoTextureFun=t.videoTextureFun,!t.location)throw new Error("location is null!");if(!Array.isArray(t.location))throw new Error("location is not array!");if(this._location=[parseFloat(t.location[0]),parseFloat(t.location[1])],this.altitude=e.defaultValue(parseFloat(t.altitude),60),this._oldAltitude=this._altitude,this._aspect=e.defaultValue(t.aspect,e.window.document.body.clientWidth/e.window.document.body.clientHeight),this._oldAspect=this._aspect,this._fov=e.defaultValue(t.fov,45),this._oldFov=this._fov,this._near=e.defaultValue(t.near,.1),this._oldNear=this._near,this._far=e.defaultValue(t.far,this._altitude+100),this._oldFar=this._far,this._alpha=e.defaultValue(t.alpha,1),this._enabled=e.defaultValue(t.enabled,!0),this._visible=!1,this.uniqueId=(og[0]++,og[0]),this._heading=e.defaultValue(t.heading,0),this._oldHeading=this._heading,this._pitch=e.defaultValue(t.pitch,0),this._oldPitch=this._pitch,this._roll=e.defaultValue(t.roll,0),this._oldRoll=this._roll,this.videoTexture=void 0,this.customOptions=t.customOptions,this._videoManager=void 0,this._clip=e.defaultValue(t.clip,!0),this._clipColor=this._getColor(),this._clipRegions=e.defaultValue([t.clipRegions],[]),this._shouldAddClipRegion=this._clipRegions.length>0,this._camTransformMatrix=void 0,this._debugVideo=!1,this.debugVideo=e.defaultValue(t.debugVideo,!1),this._debugFrustum=void 0,this._debugFrustumOutline=void 0,t.minzoom>t.maxzoom)throw new Error("minzoom must be less than maxzoom");this._minzoom=e.defaultValue(t.minzoom,0),this._maxzoom=e.defaultValue(t.maxzoom,22),this._used3DModel=e.defaultValue(t.used3DModel,!0),this._used3DTiles=e.defaultValue(t.used3DTiles,!0),this._usedPolygon=e.defaultValue(t.usedPolygon,!0),this._usedRaster=e.defaultValue(t.usedRaster,!0);const i=e.defaultValue(t.callback,(()=>{}));this.on("visible",i),this._perspectiveCamera=new l(this._fov,this._aspect,this._near,this._far),this.videoMatrix=void 0,this._computerMatrix();}get alpha(){return this._alpha}set alpha(t){e.isNumber(t)&&(this._alpha=t);}get altitude(){return this._altitude}set altitude(t){e.isNumber(t)&&(this._altitude=t);}get aspect(){return this._aspect}set aspect(t){e.isNumber(t)&&(this._aspect=t);}get enabled(){return this._enabled}set enabled(t){e.isBoolean(t)&&(this._enabled=t),e.defined(this._debugFrustum)&&(this._debugFrustum.show=t,this._debugFrustumOutline.show=t);}get far(){return this._far}set far(t){e.isNumber(t)&&(this._far=t);}get fov(){return this._fov}set fov(t){e.isNumber(t)&&(this._fov=t);}get heading(){return this._heading}set heading(t){e.isNumber(t)&&(this._heading=t);}get location(){return this._location}set location(e){Array.isArray(e)&&(this._location=e);}get near(){return this._near}set near(t){e.isNumber(t)&&(this._near=t);}get pitch(){return this._pitch}set pitch(t){e.isNumber(t)&&(this._pitch=t);}get roll(){return this._roll}set roll(t){e.isNumber(t)&&(this._roll=t);}get used3DModel(){return this._used3DModel}set used3DModel(t){e.isBoolean(t)&&(this._used3DModel=t);}get used3DTiles(){return this._used3DTiles}set used3DTiles(t){e.isBoolean(t)&&(this._used3DTiles=t);}get usedPolygon(){return this._usedPolygon}set usedPolygon(t){e.isBoolean(t)&&(this._usedPolygon=t);}get usedRaster(){return this._usedRaster}set usedRaster(t){e.isBoolean(t)&&(this._usedRaster=t);}get visible(){return this._visible}get minzoom(){return this._minzoom}set minzoom(t){e.isNumber(t)&&(this._minzoom=t);}get maxzoom(){return this._maxzoom}set maxzoom(t){e.isNumber(t)&&(this._maxzoom=t);}_limitZoom(e){const t=e.style.getNearestTileZoom();return t<=this._maxzoom&&t>=this._minzoom}update(t,i){this._limitZoom(t)&&this._enabled&&(e.defined(this._videoManager)||(this._videoManager=i),this._shouldAddClipRegion&&(this.removeClipRegion(),this._videoManager._clipManager.add({positions:this._clipRegions,uniqueId:this.uniqueId,clipColor:this._clipColor}),this._shouldAddClipRegion=!1,this._clipRegions=[]),this._updateTransform(t),this._updateVisibility(t),this._updateVideoTexture(t),this.debugVideo!==this._debugVideo&&(this.debugVideo?this._addDebugVideo(t):this._removeDebugVideo(t),this._debugVideo=this.debugVideo),e.defined(this._debugFrustum)&&e.defined(t.frameState.camera)&&(this._debugFrustum.update(t,t.frameState),this._debugFrustumOutline.update(t,t.frameState)));}_addDebugVideo(t){this._debugFrustum=new e.Primitive({geometry:new rg(this._perspectiveCamera),material:e.StandardMaterial.fromType("Color",{color:new e.Color(0,1,1,.1)}),name:`debugVideo_${this.uniqueId}`,modelMatrix:this._camTransformMatrix}),t.style.addPrimitive(this._debugFrustum),this._debugFrustumOutline=new e.Primitive({geometry:new ng(this._perspectiveCamera),material:e.StandardMaterial.fromType("Color",{color:new e.Color(1,0,0,1),lightingModel:e.LightingModelType.NONE}),name:`debugVideo_${this.uniqueId}`,modelMatrix:this._camTransformMatrix}),t.style.addPrimitive(this._debugFrustumOutline);}_removeDebugVideo(e){e.style.removePrimitive(this._debugFrustum),this._debugFrustum=void 0,e.style.removePrimitive(this._debugFrustumOutline),this._debugFrustumOutline=void 0;}addClipRegion(e){if(!(e instanceof Array))throw new Error("请正确添加视频裁剪区域位置数组！");this._clipRegions.push(e),this._shouldAddClipRegion=!0;}getClipRegion(){return e.defined(this._videoManager)?this._videoManager._clipManager.getByName(this.uniqueId):[]}removeClipRegion(){e.defined(this._videoManager)?this._videoManager._clipManager.removeByName(this.uniqueId):(this._clipRegions=[],this._shouldAddClipRegion=!1);}positioning(e,t){if(!Array.isArray(e))throw new Error("请输入正确视频点坐标!");if(!Array.isArray(t))throw new Error("请输入正确球面点坐标!");const i=parseFloat(t[0]-e[0]),s=parseFloat(t[1]-e[1]);this.location=[this.location[0]+i,this.location[1]+s];}_updateTransform(e){this._location===this._oldLocation&&this._heading===this._oldHeading&&this._pitch===this._oldPitch&&this._roll===this._oldRoll&&this._fov===this._oldFov&&this._altitude===this._oldAltitude&&this._near===this._oldNear&&this._far===this._oldFar&&this._aspect===this._oldAspect||(this._computerMatrix(),this._debugFrustum&&(this._fov!==this._oldFov||this._aspect!==this._oldAspect||this._near!==this._oldNear||this._far!==this._oldFar?(this._removeDebugVideo(e),this._addDebugVideo(e)):(this._debugFrustum.setMatrix(this._camTransformMatrix),this._debugFrustum.updateMatrixWorld(!0),this._debugFrustumOutline.setMatrix(this._camTransformMatrix),this._debugFrustumOutline.updateMatrixWorld(!0))),this._oldLocation=this._location,this._oldHeading=this._heading,this._oldPitch=this._pitch,this._oldRoll=this._roll,this._oldLocation=this._location,this._oldAltitude=this._altitude,this._oldFov=this._fov,this._oldAspect=this._aspect,this._oldNear=this._near,this._oldFar=this._far);}_computerMatrix(){const t=e.Vector3.fromDegrees(this.location[0],this.location[1],this.altitude);this._camTransformMatrix=e.Transforms.headingPitchRollToFixedFrame(t,new e.HeadingPitchRoll(e.CONSTS.CesiumMath.toRadians(this.heading),e.CONSTS.CesiumMath.toRadians(this.pitch),e.CONSTS.CesiumMath.toRadians(this.roll))),this.cartographic=new e.Vector3(this._camTransformMatrix[12],this._camTransformMatrix[13],this._camTransformMatrix[14]);const i=this._camTransformMatrix.clone();i[12]=0,i[13]=0,i[14]=0,i.invert(),this.videoMatrix=(new e.Matrix4).perspective({fov:this.fov*e.CONSTS.TRANSFORM.DEG_TO_RAD,aspect:this.aspect,near:this.near,far:this.far}).multiplyRight(i),this._perspectiveCamera.updatePerspectiveOptions({fov:this._fov,aspect:this._aspect,near:this._near,far:this.far}),this._perspectiveCamera.setMatrix(this._camTransformMatrix.clone());const s=[],r=(new e.Quaternion).fromHeadingPitchRoll(new e.HeadingPitchRoll(e.CONSTS.CesiumMath.toRadians(this.heading),e.CONSTS.CesiumMath.toRadians(this.pitch),e.CONSTS.CesiumMath.toRadians(this.roll))),n=new rg(this._perspectiveCamera);n.computeNearFarPlanes(this._perspectiveCamera.position,r,"PerspectiveCamera",this._perspectiveCamera,s),n.computerOthersPlans(s);const o=[];for(let t=0;t<s.length;t+=3)o.push(e.Vector3.unpack(s,t));this._boundingSphere=e.OrientedBoundingBox.fromPoints(o);}_updateVisibility(t){const i=-1!==t.transform.activeCamera.frustumCrate.cullingVolume.computeVisibility(this._boundingSphere);this._visible!==i&&(this._visible=i,this.fire(new e.Event("visible")));}_updateVideoTexture(t){if(e.defined(this.videoTexture)||(this.videoTexture=new e.Texture({context:t.context,image:void 0,pixelFormat:e.WebGLConstants.RGBA})),e.defined(this.videoTextureFun)&&this._enabled){const t=this.videoTextureFun();e.defined(t)&&0!==t.videoHeight&&0!==t.videoWidth&&(this.videoTexture.upload(t),this.videoTexture._hasSetSampler=!1,this.videoTexture.bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE));}}_getColor(){const t=e.Color.fromRgba(this.uniqueId);return t.a=1,t}destroy(){this._location=void 0,this._altitude=void 0,this._oldAltitude=void 0,this._aspect=void 0,this._oldAspect=void 0,this._fov=void 0,this._oldFov=void 0,this._near=void 0,this._oldNear=void 0,this._far=void 0,this._oldFar=void 0,this._alpha=void 0,this._enabled=void 0,this.uniqueId=void 0,this._heading=void 0,this._oldHeading=void 0,this._pitch=void 0,this._oldPitch=void 0,this._roll=void 0,this._oldRoll=void 0,this._used3DModel=void 0,this._used3DTiles=void 0,this._usedPolygon=void 0,this._usedRaster=void 0;}}class lg{constructor(e){this._clipRegions=[],this._clipPrimitives=[],this._painter=void 0,this._videoManager=e.videoManager;}get length(){return this._clipPrimitives.length}add(e){this._clipRegions.push(e);}remove(e){const t=this.indexOf(e);return -1!==t&&(this.removeByIndex(t),!0)}removeByName(e){const t=this.getByName(e);if(t.length>0)for(let e=0;e<t.length;e++)this.remove(t[e]);}removeByIndex(t){const i=this.getByIndex(t);e.defined(i)&&(this._clipPrimitives.splice(t,1),this.removePrimitiveFromScene(i));}removeAll(){for(let e=this._clipPrimitives.length;e>=0;e--)this.remove(this._clipPrimitives[e-1]);}removePrimitiveFromScene(e){this._painter&&(this._painter.style.removePrimitiveForPreRender(e),e.destroy());}indexOf(e){return this._clipPrimitives.indexOf(e)}getByName(e){const t=[];return this._clipPrimitives.forEach((i=>{i.name===e&&t.push(i);})),t}getByIndex(e){return this._clipPrimitives[e]}getAll(){return this._clipPrimitives}createPrimitives(){for(let e=0;e<this._clipRegions.length;e++)this.createPrimitive(this._clipRegions.splice(0,1)[0]);}_updateExtraCamera(){if(0===this._clipPrimitives.length)return;const t=this._painter,i=this._clipPrimitives,s=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];let n=0;for(let o=0;o<i.length;o++){const a=i[o];if(t.frameState.camera.frustumCrate.cullingVolume.computeVisibility(a.boundingBox)==e.INTERSECTION.OUTSIDE)continue;n++;const l=a.boundingBox.getBoundingMaximum(),h=l.boundingMinValue,_=l.boundingMaxValue;h[0]<s[0]&&(s[0]=h[0]),h[1]<s[1]&&(s[1]=h[1]),h[2]<s[2]&&(s[2]=h[2]),_[0]>r[0]&&(r[0]=_[0]),_[1]>r[1]&&(r[1]=_[1]),_[2]>r[2]&&(r[2]=_[2]);}if(0===n)return;const o=[(s[0]+r[0])/2,(s[1]+r[1])/2,(s[2]+r[2])/2];1===n&&(s[0]-=2*(o[0]-s[0]),s[1]-=2*(o[1]-s[1]),s[2]-=2*(o[2]-s[2]),r[0]+=2*(r[0]-o[0]),r[1]+=2*(r[1]-o[1]),r[2]+=2*(r[2]-o[2]));const a=Math.max(r[0]-s[0],r[1]-s[1],r[2]-s[2]),l=new h(a,t.style.symbolMatrixHelper.width/t.style.symbolMatrixHelper.height,1,1e4),_=e.Transforms.cartesian3ToCartographic(o),c=e.Transforms.cartographicToCartesian3([_[0],_[1],_[2]+50]),d=e.Transforms.localFrameToFixedFrame(c);l.setMatrix(d);for(let e=0;e<i.length;e++)i[e]._material._extraCamera=l;this._extraCameraOfOrthographic=l;}createPrimitive(t){if(e.defined(t.positions)&&Array.isArray(t.positions[0])){const i=new e.Primitive({geometry:new e.PolygonGeometry({polygonHierarchy:{positions:e.Vector3.fromDegreesArrayHeights(t.positions[0])}}),material:e.StandardMaterial.fromType("Color",{color:t.clipColor,lightingModel:e.LightingModelType.NONE}),framebuffer:this._videoManager._clipFill.framebuffer.framebuffer,name:t.uniqueId});i.visible=!1,this._painter.style.addPrimitiveForPreRender(i),this._clipPrimitives.push(i);}}update(t){let i;e.defined(this._painter)||(this._painter=t),this._clipRegions.length>0&&this.createPrimitives(),this._updateExtraCamera();for(let t=0;t<this._clipPrimitives.length;t++)i=0===t?{color:new e.Color(0,0,0,1),depth:1,stencil:0}:void 0,this._clipPrimitives[t].clearStates=i;}destroy(){this._painter=void 0;}}class hg{constructor(){this._videos=[],this._videoModelMaterial=new sg(this,"3DModel"),this._videoRasterMaterial=new sg(this,"Raster"),this._videoTilesMaterial=new sg(this,"3DTiles"),this._videoPolygonMaterial=new sg(this,"Polygon"),this._enabled=!0,this._maxUsedVideoUnit=0,this._enabledClip=!0,this._clipManager=new lg({videoManager:this}),this._clipFill=new sf,this._projectionMatrix=void 0;}get enabled(){return this._enabled}set enabled(t){if(e.isBoolean(t)){this._enabled=t;for(let e=0;e<this.length;e++)this._videos[e].enabled=t;}}get enableClip(){return this._enabledClip}set enableClip(t){e.isBoolean(t)&&(this._enabledClip=t);}get length(){return this._videos.length}get enabledLength(){let e=0;for(let t=0;t<this._videos.length;t++)this._videos[t].enabled&&e++;return e}add(t,i){if(!(t instanceof ag))return console.error("当前添加的不是视频文件，请检查！"),!1;const s=e.defined(i);if(s){if(i<0)throw new Error("index must be greater than or equal to zero.");if(i>this._videos.length)throw new Error("index must be less than or equal to the number of videos.")}return s?this._videos.splice(i,0,t):this._videos.push(t),!0}lower(e){const t=this.indexOf(e);this._swapLayers(t,t-1);}raise(e){const t=this.indexOf(e);this._swapLayers(t,t+1);}_swapLayers(t,i){const s=this._videos;if((t=e.clamp(t,0,s.length-1))===(i=e.clamp(i,0,s.length-1)))return;const r=s[t];s[t]=s[i],s[i]=r;}remove(e){const t=this.indexOf(e);return -1!==t&&(e.removeClipRegion(),this._videos.splice(t,1),!0)}removeById(e){const t=this.getById(e);this.remove(t);}removeAll(){for(let e=0;e<this.length;e++)this.getByIndex(e).removeClipRegion();this._videos=[],this._videoModelMaterial.empty();}removeAllClipRegions(){this._clipManager.removeAll();}getById(e){let t;return this._videos.forEach((i=>{i.uniqueId===e&&(t=i);})),t}getByIndex(e){return this._videos[e]}getAll(){return this._videos}contains(e){return -1!==this.indexOf(e)}containsById(e){return -1!==this.getById(e)}indexOf(e){return this._videos.indexOf(e)}indexOfById(e){return this.containsById(e)?this.indexOf(this.getById(e)):-1}update(e){if(this._videoModelMaterial.removeUniforms(),this._videoRasterMaterial.removeUniforms(),this._videoTilesMaterial.removeUniforms(),this._videoPolygonMaterial.removeUniforms(),!this._enabled||this.length<1)return;this._clipManager.update(e),this._updateClipRegionsVisibility(e),this._clipFill.update(e),this._calculateMaxTextureUnits(e);const t=this.length;for(let i=0;i<t;i++)this.getByIndex(i).update(e,this);this._videoModelMaterial.update(e),this._videoRasterMaterial.update(e),this._videoTilesMaterial.update(e),this._videoPolygonMaterial.update(e);}clear3DModel(){this._videoModelMaterial.removeUniforms(),!this._enabled||this.length<1||(this._videoModelMaterial._usedVideos=[]);}update3DModel(e){!this._enabled||this.length<1||this._videoModelMaterial.select3DModel(e);}clear3DTiles(){this._videoTilesMaterial.removeUniforms(),!this._enabled||this.length<1||(this._videoTilesMaterial._usedVideos=[]);}update3DTiles(e){!this._enabled||this.length<1||this._videoTilesMaterial.select3DTiles(e);}_calculateMaxTextureUnits(t){let i,s,r,n=[],o=0,a=0,l=0,h=0;for(let _=0;_<t.style._order.length;_++){if(i=t.style._layers[t.style._order[_]],s=t.style.sourceCaches[i.source],"raster"===i.type){if(s&&s.getVisibleCoordinates){n=s.getVisibleCoordinates(!1),r=i.id;for(let i=0;i<n.length;i++){const s=t.rasterPlotter._drawCommands.get(r),a=s?s.get(n[i].key):void 0;if(void 0!==a){const t=a._material._uniforms.entries();for(;;){const i=t.next();if(i.done)break;const s=i.value[0],r=i.value[1]();r instanceof e.Texture?h++:r instanceof Array&&r[0]instanceof e.Texture&&"u_VideoSampler"!==s&&(h+=r.length);}o=Math.max(o,h);break}}}}else if("3d-tiles"===i.type){const t=s.tileset3d;if(e.defined(t)){const i=t.selectedTiles;let s=[];for(let e=0;e<i.length;e++){let t=[];"cmpt"===i[e].content.type?i[e].content.tiles.forEach((e=>{t=t.concat(e.gltf.meshes);})):t=t.concat(i[e].content.gltf.meshes);for(let e=0;e<t.length;e++)s=s.concat(t[e].primitives);}if(e.defined(s))for(let t=0;t<s.length;t++)if(void 0!==s[t]&&e.defined(s[t]._material.pickColor)){const i=s[t]._material._uniforms.entries();for(;;){const t=i.next();if(t.done)break;const s=t.value[0],r=t.value[1];if(r instanceof Function){const t=r();t instanceof e.Texture?h++:t instanceof Array&&t[0]instanceof e.Texture&&"u_VideoSampler"!==s&&(h+=t.length);}}a=Math.max(a,h);break}}}else if("3d-model"===i.type){let t=[];for(let e=0;e<s._glTFTiles.length;e++)t=t.concat(s._glTFTiles[0].primitives);for(let i=0;i<t.length;i++)if(void 0!==t[i]&&e.defined(t[i]._material.pickColor)){const s=t[i]._material._uniforms.entries();for(;;){const t=s.next();if(t.done)break;const i=t.value[0],r=t.value[1];if(r instanceof Function){const t=r();t instanceof e.Texture?h++:t instanceof Array&&t[0]instanceof e.Texture&&"u_VideoSampler"!==i&&(h+=t.length);}}l=Math.max(l,h);break}}h=0;}const _=Math.max(o,a,l),c=t.context.gl.getParameter(e.WebGLConstants.MAX_TEXTURE_IMAGE_UNITS)-_;this._maxUsedVideoUnit=c;}_updateClipRegionsVisibility(t){e.defined(t.frameState.camera)&&this._clipManager._extraCameraOfOrthographic&&(this._projectionMatrix=this._clipManager._extraCameraOfOrthographic.getVPMatrix().clone());}serialize(){const e=[];for(let t=0;t<this.length;t++){const i=this.getByIndex(t);e[t]={location:i.location,altitude:i.altitude,aspect:i.aspect,fov:i.fov,alpha:i.alpha,heading:i.heading,pitch:i.pitch,roll:i.roll,near:i.near,enabled:i.enabled,far:i.far,customOptions:i.customOptions,minzoom:i.minzoom,maxzoom:i.maxzoom,used3DModel:i.used3DModel,used3DTiles:i.used3DTiles,usedRaster:i.usedRaster,usedPolygon:i.usedPolygon,debugVideo:i.debugVideo};}return e.length>0?e:void 0}}class _g{constructor(){this.globalInnerColor=new e.Vector4(41/255,52/255,71/255,8),this.globalOuterColor=new e.Vector4(166/255,184/255,213/255,0),this.globalOuterPara=new e.Vector4(543146,2.3,6,0),this.globalLightPercent=new e.Vector4(1,.01,3.5,1.2),this.nightGlobalPer=new e.Vector2(.01,.1),this.nightVisible=!0;}}class cg{constructor(t){if(t=e.defined(t)?t:{},e.defined(t.geometry)&&!(t.geometry instanceof e.Geometry))throw new Error("Geometry is not valid!");if(this._geometry=e.defaultValue(t.geometry,new e.Geometry({})),e.defined(t.color)&&!(t.color instanceof e.Color)&&"string"!=typeof t.color)throw new Error("Color type must be Color or String!");if(this._color=e.Color.parse(e.defaultValue(t.color,new e.Color(1,0,0,.3))),e.defined(t.opacity)&&!e.isNumber(t.opacity))throw new Error("'opacity' option must be a number!");if(this._opacity=e.defaultValue(t.opacity,1),e.defined(t.modelMatrix)&&!(t.modelMatrix instanceof e.Matrix4))throw new Error("'modelMatrix' is not valid");if(this._modelMatrix=e.defaultValue(t.modelMatrix,e.Matrix4.IDENTITY),e.defined(t.enabled)&&!e.isBoolean(t.enabled))throw new Error("'enabled' option must be true or false!");this._enabled=e.defaultValue(t.enabled,!0),this._initialized=!1,this._geometryUpdated=!1,this._colorUpdated=!1,this._opacityUpdated=!1,this._modelMatrixUpdated=!1,this.id=e.uuid();}get geometry(){return this._geometry}set geometry(t){if(!(t instanceof e.Geometry))throw new Error("Geometry is not valid!");this._geometry=t,this._geometryUpdated=!1;}get color(){return this._color}set color(t){if(!(t instanceof e.Color||"string"==typeof t))throw new Error("Color type must be Color or String!");this._color=e.Color.parse(t),this._colorUpdated=!1;}get opacity(){return this._opacity}set opacity(t){if(!e.isNumber(t))throw new Error("'opacity' option must be a number!");this._opacity=t,this._opacityUpdated=!1;}get modelMatrix(){return this._modelMatrix}set modelMatrix(t){if(!(t instanceof e.Matrix4))throw new Error("Model matrix is not valid!");this._modelMatrix=t,this._modelMatrixUpdated=!1;}get enabled(){return this._enabled}set enabled(t){if(!e.isBoolean(t))throw new Error("'enabled' option must be true or false!");this._enabled=t;}_initialize(){this._passFrontRenderState={},this._passFrontRenderState.blending=e.renderStateEnum.disableBlending,this._passFrontRenderState.cull=e.renderStateEnum.disableCull,this._passFrontRenderState.depthTest=e.renderStateEnum.enableDepthTest,this._passFrontRenderState.depthRange=e.renderStateEnum.depthRange,this._passFrontRenderState.depthMask=e.renderStateEnum.disableDepthMask,this._passFrontRenderState.stencilTest=e.renderStateEnum.enableClassificationStencilTest,this._passFrontRenderState.stencilMask=e.renderStateEnum.enableStencilMask,this._passFrontRenderState.colorMask=e.renderStateEnum.disabledColorMask,this._passBackRenderState={},this._passBackRenderState.blending=e.renderStateEnum.enableBlending,this._passBackRenderState.cull=e.renderStateEnum.disableCull,this._passBackRenderState.depthTest=e.renderStateEnum.disableDepthTest,this._passBackRenderState.depthRange=e.renderStateEnum.depthRange,this._passBackRenderState.depthMask=e.renderStateEnum.disableDepthMask,this._passBackRenderState.stencilTest=e.renderStateEnum.openClassificationStencilTest,this._passBackRenderState.colorMask=e.renderStateEnum.enableColorMask,this._passBackRenderState.stencilMask=e.renderStateEnum.enableStencilMask,this._material=e.StandardMaterial.fromType("Color",{color:this._color,opacity:this._opacity,lightingModel:e.LightingModelType.NONE,doubleSided:!0}),this._primitive=new e.Primitive({geometry:this._geometry,material:this._material,modelMatrix:this._modelMatrix}),this._initialized=!0,this._geometryUpdated=!0,this._colorUpdated=!0,this._opacityUpdated=!0,this._modelMatrixUpdated=!0;}_updateGeometry(){this._primitive._geometry=this._geometry,this._geometryUpdated=!0;}_updateColor(){this._material.updateProperty({color:this._color}),this._colorUpdated=!0;}_updateOpacity(){this._material.updateProperty({opacity:this._opacity}),this._opacityUpdated=!0;}_updateModelMatrix(){this._primitive.setMatrix(this._modelMatrix),this._primitive.updateMatrixWorld(!0),this._primitive.modelMatrix=this._modelMatrix,this._modelMatrixUpdated=!0;}update(){this._initialized?(this._geometryUpdated||this._updateGeometry(),this._colorUpdated||this._updateColor(),this._opacityUpdated||this._updateOpacity(),this._modelMatrixUpdated||this._updateModelMatrix()):this._initialize();}render(e){this._enabled&&(this._primitive.framebuffer=e.mainPass.framebuffer.framebuffer,this._material.renderState=this._passFrontRenderState,this._primitive.update(e,e.frameState),this._primitive.render(e,{id:"highlightFront"},e.frameState),this._material.renderState=this._passBackRenderState,this._primitive.update(e,e.frameState),this._primitive.render(e,{id:"highlightBack"},e.frameState),this._primitive.framebuffer=null);}destroy(){this._initialized?this._primitive instanceof e.Primitive&&this._primitive.destroy():(this._geometry instanceof e.Geometry&&this._geometry.destroy(),this._material instanceof e.Material&&this._material.destroy()),this._primitive=void 0,this._material=void 0,this._geometry=void 0,this._passFrontRenderState=void 0,this._passBackRenderState=void 0,this._enabled=void 0,this._color=void 0,this._modelMatrix=void 0,this._initialized=void 0,this._geometryUpdated=void 0,this._colorUpdated=void 0,this._opacityUpdated=void 0,this._modelMatrixUpdated=void 0,this.id=void 0;}}const dg=e.CONSTS.CesiumMath;class ug extends e.Geometry{constructor(t){super(t),this.type="PolygonOutlineGeometry",this.primitiveType=e.WebGLConstants.LINES,this.setData(t);}setData(t){if(super.setData(),!e.defined(t.polygonHierarchy)||!e.defined(t.polygonHierarchy.positions))throw new Error("positions must be defined!");if(t.perPositionHeight&&e.defined(t.height))throw new Error("Cannot use both options.perPositionHeight and options.height");if(e.defined(t.arcType)&&t.arcType!==e.ARCTYPE.GEODESIC&&t.arcType!==e.ARCTYPE.RHUMB)throw new Error("Invalid arcType. Valid options are minemap.ARCTYPE.GEODESIC and minemap.ARCTYPE.RHUMB.");if(e.defined(t.perPositionHeight)&&t.perPositionHeight&&e.defined(t.height))throw new Error("Cannot use both options.perPositionHeight and options.height");this._polygonHierarchy=t.polygonHierarchy,this._ellipsoid=e.defaultValue(t.ellipsoid,e.Ellipsoid.WGS84),this._granularity=e.defaultValue(t.granularity,dg.RADIANS_PER_DEGREE),this._perPositionHeight=e.defaultValue(t.perPositionHeight,!1),this._perPositionHeightExtrude=this._perPositionHeight&&e.defined(t.extrudedHeight),this._arcType=e.defaultValue(t.arcType,e.ARCTYPE.GEODESIC),this._referenceCenter=e.defaultValue(t.referenceCenter,new e.Vector3);let i=e.defaultValue(t.height,0),s=e.defaultValue(t.extrudedHeight,i);if(!this._perPositionHeightExtrude){const e=Math.max(i,s);s=Math.min(i,s),i=e;}this._height=i,this._extrudedHeight=s,this.vertices=void 0,this.indices=void 0,this._usedDoublePrecision=!e.defined(t.referenceCenter),this._vertexArray?(this._vertexArray.clear(),this._indexArray.clear()):(this._vertexArray=this._usedDoublePrecision?new e.StructArrayLayout3f3f24:new e.StructArrayLayout3f12,this._indexArray=new e.StructArrayLayout2ui4),this._polygonHierarchy.positions.length<3||(this.needUpdate=!0,this._parse(),this.computeBoundingSphere(),this.computeBoundingBox());}_parse(){const t=this._ellipsoid,i=this._granularity,s=this._perPositionHeight,r=this._arcType,n=e.PolygonGeometryLibrary.polygonOutlinesFromHierarchy(this._polygonHierarchy,!s,t);if(0===n.length)return;let o;const a=[],l=dg.chordLength(i,t.maximumRadius),h=this._height,_=this._extrudedHeight;if(this._perPositionHeightExtrude||!dg.equalsEpsilon(h,_,0,dg.EPSILON2))for(let i=0;i<n.length;i++)o=e.PolygonGeometryLibrary.createOutlineGeometryFromPositionsExtruded(t,n[i],l,s,r),o=e.PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(o,h,_,t,s),a.push(o);else for(let i=0;i<n.length;i++)o=e.PolygonGeometryLibrary.createOutlineGeometryFromPositions(t,n[i],l,s,r),o.positions=e.PolygonPipeline.scaleToGeodeticHeight(o.positions,h,t,!s),a.push(o);const c=e.PolygonGeometryLibrary.combineGeometries(a);this.indices=c.indices,this.vertices=e.PolygonPipeline.scaleToGeodeticHeight(c.positions,h,this._ellipsoid,!this._perPositionHeight);for(let e=0;e<this.vertices.length/3;e++)this.vertices[3*e]=this.vertices[3*e]-this._referenceCenter[0],this.vertices[3*e+1]=this.vertices[3*e+1]-this._referenceCenter[1],this.vertices[3*e+2]=this.vertices[3*e+2]-this._referenceCenter[2];this.emplaceVertexBufferOfLines();for(let e=0;e<this.indices.length/2;e++)this._indexArray.emplaceBack(this.indices[2*e],this.indices[2*e+1]);}update(t){if(this.needUpdate&&t.painter){this.needUpdate=!1;const i=t.painter.context;this._vertexBuffer&&this._indexBuffer?(this._vertexBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indexArray)):(this._vertexBuffer=i.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?ju.members:Xu.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indexArray,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/2);}}serialize(){const t={type:this.type,polygonHierarchy:e.PolygonPipeline.hierarchyPack(this._polygonHierarchy,{}),perPositionHeight:this._perPositionHeight,arcType:this._arcType};return (this._perPositionHeightExtrude||!e.CONSTS.CesiumMath.equalsEpsilon(this._height,this._extrudedHeight,0,e.CONSTS.CesiumMath.EPSILON2))&&(t.extrudedHeight=this._extrudedHeight),this._perPositionHeight||(t.height=this._height),t}destroy(){super.destroy(),this._polygonHierarchy=void 0,this._ellipsoid=void 0,this._granularity=void 0,this._perPositionHeight=void 0,this._perPositionHeightExtrude=void 0,this._arcType=void 0,this._height=void 0,this._extrudedHeight=void 0,this.vertices=void 0,this.indices=void 0,this._vertexArray=void 0,this._indexArray=void 0,this.type=void 0,this.primitiveType=void 0,this.needUpdate=void 0,this._vertexBuffer=void 0,this._indexBuffer=void 0,this._segmentVector=void 0,this.boundingBox=void 0,this.boundingSphere=void 0;}}class mg{constructor(t){if(e.defined(t.baseHeight)&&!e.isNumber(t.baseHeight))throw new Error("'baseHeight' must be a number");if(this._baseHeight=e.defaultValue(t.baseHeight,void 0),e.defined(t.minHeight)){if(!e.isNumber(t.minHeight))throw new Error("'minHeight' must be a number");if(t.minHeight>this._baseHeight)throw new Error("'minHeight' must not be bigger than 'baseHeight'")}if(this._minHeight=e.defaultValue(t.minHeight,void 0),e.defined(t.maxHeight)){if(!e.isNumber(t.maxHeight))throw new Error("'maxHeight' must be a number");if(t.maxHeight<this._baseHeight)throw new Error("'maxHeight' must not be smaller than 'baseHeight'")}this._maxHeight=e.defaultValue(t.maxHeight,void 0),this.fillColor=e.defaultValue(t.fillColor,new e.Color(0,1,0,1)),this.fillOpacity=e.defaultValue(t.fillOpacity,.5),this.cutColor=e.defaultValue(t.cutColor,new e.Color(.7,.4,.2,1)),this.cutOpacity=e.defaultValue(t.cutOpacity,.5),this.baseColor=e.defaultValue(t.baseColor,new e.Color(.2,0,1,1)),this.baseOpacity=e.defaultValue(t.baseOpacity,.5),this._baseMaterial=e.StandardMaterial.fromType("Color",{color:this._baseColor,opacity:this._baseOpacity,lightingModel:e.LightingModelType.NONE,doubleSided:!0}),this._baseMaterialUpdated=!1,this.baseOutlineColor=e.defaultValue(t.baseOutlineColor,new e.Color(1,1,1,1)),this.baseOutlineOpacity=e.defaultValue(t.baseOutlineOpacity,1),this._baseOutlineMaterial=e.StandardMaterial.fromType("Color",{color:this._baseOutlineColor,opacity:this._baseOutlineOpacity,lightingModel:e.LightingModelType.NONE,doubleSided:!0}),this.wallColor=e.defaultValue(t.wallColor,new e.Color(0,.7,0,1)),this.wallOpacity=e.defaultValue(t.wallOpacity,.5),this._wallMaterial=e.StandardMaterial.fromType("Color",{color:this._wallColor,opacity:this._wallOpacity,lightingModel:e.LightingModelType.NONE,doubleSided:!0}),this._wallMaterial.renderState.depthMask=!1,this._wallMaterialUpdated=!1,this.wallOutlineColor=e.defaultValue(t.wallOutlineColor,new e.Color(0,0,0,1)),this.wallOutlineOpacity=e.defaultValue(t.wallOutlineOpacity,1),this._wallOutlineMaterial=e.StandardMaterial.fromType("Color",{color:this._wallOutlineColor,opacity:this._wallOutlineOpacity,lightingModel:e.LightingModelType.NONE,doubleSided:!0}),this._wallOutlineMaterialUpdated=!1,this.positions=e.defaultValue(t.positions,[]),this.enabled=e.defaultValue(t.enabled,!0),this.id=e.uuid();}get positions(){return this._positions}set positions(t){if(!(t instanceof Array))throw new Error("positions is not type of Array!");if(0!==t.length&&t.length<3)throw new Error("positions' length must greater than 2!");if(0!==t.length&&!this._baseHeight){let i=0;for(let s=0;s<t.length;s++)i+=e.Cartographic.fromVector3(t[s]).height;i/=t.length,this._baseHeight=i;}this._minHeight||(this._minHeight=this._baseHeight-500),this._maxHeight||(this._maxHeight=this._baseHeight+500),this._positions=t,this._sameHeightPositions=mg.updateHeight(this._positions,this._baseHeight),this._createCutArea(),this._createFillArea(),this._createWall(),this._createBase();}get baseHeight(){return this._baseHeight}set baseHeight(t){if(e.isNumber(t))this._baseHeight=t;else {if(t)throw new Error("baseHeight must be a number or empty");{let i=0;for(let s=0;s<this._positions.length;s++)i+=e.Cartographic.fromVector3(t[s]).height;i/=this._positions.length,this._baseHeight=i;}}this._sameHeightPositions=mg.updateHeight(this._positions,this._baseHeight),this._createCutArea(),this._createFillArea(),this._createWall(),this._createBase();}get minHeight(){return this._minHeight}set minHeight(t){if(!e.isNumber(t))throw new Error("'minHeight' must be a number");if(t>this._baseHeight)throw new Error("'minHeight' must not be bigger than 'baseHeight'");this._minHeight=t,this._createFillArea(),this._createWall();}get maxHeight(){return this._maxHeight}set maxHeight(t){if(!e.isNumber(t))throw new Error("'maxHeight' must be a number");if(t<this._baseHeight)throw new Error("'maxHeight' must not be smaller than 'baseHeight'");this._maxHeight=t,this._createCutArea(),this._createWall();}get fillColor(){return this._fillColor}set fillColor(t){if(!(t instanceof e.Color||"string"==typeof t))throw new Error("'fillColor' type must be Color or String!");this._fillColor=e.Color.parse(t),this._fillHighlight&&(this._fillHighlight.color=this._fillColor);}get fillOpacity(){return this._fillOpacity}set fillOpacity(t){if(!e.isNumber(t))throw new Error("'fillOpacity' option must be a number!");this._fillOpacity=t,this._fillHighlight&&(this._fillHighlight.opacity=this._fillOpacity);}get cutColor(){return this._cutColor}set cutColor(t){if(!(t instanceof e.Color||"string"==typeof t))throw new Error("'cutColor' type must be Color or String!");this._cutColor=e.Color.parse(t),this._cutHighlight&&(this._cutHighlight.color=this._cutColor);}get cutOpacity(){return this._cutOpacity}set cutOpacity(t){if(!e.isNumber(t))throw new Error("'cutOpacity' option must be a number!");this._cutOpacity=t,this._cutHighlight&&(this._cutHighlight.opacity=this._cutOpacity);}get baseColor(){return this._baseColor}set baseColor(t){if(!(t instanceof e.Color||"string"==typeof t))throw new Error("'baseColor' type must be Color or String!");this._baseColor=e.Color.parse(t),this._baseMaterialUpdated=!1;}get baseOpacity(){return this._baseOpacity}set baseOpacity(t){if(!e.isNumber(t))throw new Error("'baseOpacity' option must be a number!");this._baseOpacity=t,this._baseMaterialUpdated=!1;}get baseOutlineColor(){return this._baseOutlineColor}set baseOutlineColor(t){if(!(t instanceof e.Color||"string"==typeof t))throw new Error("'baseOutlineColor' type must be Color or String!");this._baseOutlineColor=e.Color.parse(t),this._baseOutlineMaterialUpdated=!1;}get baseOutlineOpacity(){return this._baseOutlineOpacity}set baseOutlineOpacity(t){if(!e.isNumber(t))throw new Error("'baseOutlineOpacity' option must be a number!");this._baseOutlineOpacity=t,this._baseOutlineMaterialUpdated=!1;}get wallColor(){return this._wallColor}set wallColor(t){if(!(t instanceof e.Color||"string"==typeof t))throw new Error("'wallColor' type must be Color or String!");this._wallColor=e.Color.parse(t),this._wallMaterialUpdated=!1;}get wallOpacity(){return this._wallOpacity}set wallOpacity(t){if(!e.isNumber(t))throw new Error("'wallOpacity' option must be a number!");this._wallOpacity=t,this._wallMaterialUpdated=!1;}get wallOutlineColor(){return this._wallOutlineColor}set wallOutlineColor(t){if(!(t instanceof e.Color||"string"==typeof t))throw new Error("'wallOutlineColor' type must be Color or String!");this._wallOutlineColor=e.Color.parse(t),this._wallOutlineMaterialUpdated=!1;}get wallOutlineOpacity(){return this._wallOutlineOpacity}set wallOutlineOpacity(t){if(!e.isNumber(t))throw new Error("'wallOutlineOpacity' option must be a number!");this._wallOutlineOpacity=t,this._wallOutlineMaterialUpdated=!1;}get enabled(){return this._enabled}set enabled(t){if(!e.isBoolean(t))throw new Error("'enabled' option must be true or false!");this._enabled=t;}static updateHeight(t,i){if(0===t.length)return [];let s=[];for(let r=0;r<t.length;r++){const n=e.Transforms.cartesian3ToCartographic(t[r]);s=s.concat([n[0],n[1],i]);}return e.Vector3.fromDegreesArrayHeights(s)}_createCutArea(){this._cutGeometry=mg.createPolygon(this._sameHeightPositions,this._maxHeight),this._cutHighlight?this._cutHighlight.geometry=this._cutGeometry:this._cutHighlight=new cg({geometry:this._cutGeometry,color:this._cutColor,opacity:this._cutOpacity});}_createFillArea(){this._fillGeometry=mg.createPolygon(this._sameHeightPositions,this._minHeight),this._fillHighlight?this._fillHighlight.geometry=this._fillGeometry:this._fillHighlight=new cg({geometry:this._fillGeometry,color:this._fillColor,opacity:this._fillOpacity});}_createWall(){const e=mg.updateHeight(this._positions,this._minHeight);this._wallGeometry=mg.createPolygon(e,this._maxHeight,!0,!1),this._wallGeometryUpdated=!1,this._wallOutlineGeometry=mg.createPolygonOutline(e,this._maxHeight,!0,!1),this._wallOutlineGeometryUpdated=!1;}_createBase(){this._baseGeometry=mg.createPolygon(this._sameHeightPositions,this._baseHeight,!1),this._baseGeometryUpdated=!1,this._baseOutlineGeometry=mg.createPolygonOutline(this._sameHeightPositions,this._baseHeight,!1),this._baseOutlineGeometryUpdated=!1;}static createPolygon(t,i,s=!0,r=!0){return new e.PolygonGeometry(0===t.length?{polygonHierarchy:{positions:[]},arcType:e.ARCTYPE.GEODESIC}:{polygonHierarchy:{positions:t},perPositionHeight:!0,extrudedHeight:s?i:void 0,closeTop:!!r,closeBottom:!!r,arcType:e.ARCTYPE.GEODESIC})}static createPolygonOutline(t,i,s=!0,r=!0){return new ug(0===t.length?{polygonHierarchy:{positions:[]},arcType:e.ARCTYPE.GEODESIC}:{polygonHierarchy:{positions:t},perPositionHeight:!0,extrudedHeight:s?i:void 0,closeTop:!!r,closeBottom:!!r,arcType:e.ARCTYPE.GEODESIC})}get json(){const t=[];for(let i=0;i<this._positions.length;i++){const s=e.Transforms.cartesian3ToCartographic(this._positions[i]);t.push([s[0],s[1]]);}return 0===t.length?void 0:e.turfPolygon([[...t,t[0]]])}update(){this._cutHighlight.update(),this._fillHighlight.update(),this._base?(this._baseGeometryUpdated||(this._base._geometry=this._baseGeometry,this._baseGeometryUpdated=!0),this._baseMaterialUpdated||(this._baseMaterial.updateProperty({color:this._baseColor,opacity:this._baseOpacity}),this._baseMaterialUpdated=!0)):(this._base=new e.Primitive({geometry:this._baseGeometry,material:this._baseMaterial}),this._baseGeometryUpdated=!0,this._baseMaterialUpdated=!0),this._wall?(this._wallGeometryUpdated||(this._wall._geometry=this._wallGeometry,this._wallGeometryUpdated=!0),this._wallMaterialUpdated||(this._wallMaterial.updateProperty({color:this._wallColor,opacity:this._wallOpacity}),this._wallMaterialUpdated=!0)):(this._wall=new e.Primitive({geometry:this._wallGeometry,material:this._wallMaterial}),this._wallGeometryUpdated=!0,this._wallMaterialUpdated=!0),this._baseOutline?(this._baseOutlineGeometryUpdated||(this._baseOutline._geometry=this._baseOutlineGeometry,this._baseOutlineGeometryUpdated=!0),this._baseOutlineMaterialUpdated||(this._baseOutlineMaterial.updateProperty({color:this._baseOutlineColor,opacity:this._baseOutlineOpacity}),this._baseOutlineMaterialUpdated=!0)):(this._baseOutline=new e.Primitive({geometry:this._baseOutlineGeometry,material:this._baseOutlineMaterial}),this._baseOutlineGeometryUpdated=!0,this._baseOutlineMaterialUpdated=!0),this._wallOutline?(this._wallOutlineGeometryUpdated||(this._wallOutline._geometry=this._wallOutlineGeometry,this._wallOutlineGeometryUpdated=!0),this._wallOutlineMaterialUpdated||(this._wallOutlineMaterial.updateProperty({color:this._wallOutlineColor,opacity:this._wallOutlineOpacity}),this._wallOutlineMaterialUpdated=!0)):(this._wallOutline=new e.Primitive({geometry:this._wallOutlineGeometry,material:this._wallOutlineMaterial}),this._wallOutlineGeometryUpdated=!0,this._wallOutlineMaterialUpdated=!0);}render(e){this._enabled&&(this._cutHighlight.render(e),this._fillHighlight.render(e),this._base.framebuffer=e.mainPass.framebuffer.framebuffer,this._base.update(e,e.frameState),this._base.render(e,{id:"base"},e.frameState),this._base.framebuffer=null,this._wall.framebuffer=e.mainPass.framebuffer.framebuffer,this._wall.update(e,e.frameState),this._wall.render(e,{id:"wall"},e.frameState),this._wall.framebuffer=null,this._baseOutline.framebuffer=e.mainPass.framebuffer.framebuffer,this._baseOutline.update(e,e.frameState),this._baseOutline.render(e,{id:"baseOutline"},e.frameState),this._baseOutline.framebuffer=null,this._wallOutline.framebuffer=e.mainPass.framebuffer.framebuffer,this._wallOutline.update(e,e.frameState),this._wallOutline.render(e,{id:"wallOutline"},e.frameState),this._wallOutline.framebuffer=null);}destroy(){this._positions=void 0,this._baseHeight=void 0,this._minHeight=void 0,this._maxHeight=void 0,this._fillHighlight&&this._fillHighlight.destroy(),this._cutHighlight&&this._cutHighlight.destroy(),this._base&&this._base instanceof e.Primitive?this._base.destroy():(this._baseGeometry&&this._baseGeometry instanceof e.Geometry&&this._baseGeometry.destroy(),this._baseMaterial&&this._baseMaterial instanceof e.Material&&this._baseMaterial.destroy()),this._baseOutline&&this._baseOutline instanceof e.Primitive?this._baseOutline.destroy():(this._baseOutlineGeometry&&this._baseOutlineGeometry instanceof e.Geometry&&this._baseOutlineGeometry.destroy(),this._baseOutlineMaterial&&this._baseOutlineMaterial instanceof e.Material&&this._baseOutlineMaterial.destroy()),this._wall&&this._wall instanceof e.Primitive?this._wall.destroy():(this._wallGeometry&&this._wallGeometry instanceof e.Geometry&&this._wallGeometry.destroy(),this._wallMaterial&&this._wallMaterial instanceof e.Material&&this._wallMaterial.destroy()),this._wallOutline&&this._wallOutline instanceof e.Primitive?this._wallOutline.destroy():(this._wallOutlineGeometry&&this._wallOutlineGeometry instanceof e.Geometry&&this._wallOutlineGeometry.destroy(),this._wallOutlineMaterial&&this._wallOutlineMaterial instanceof e.Material&&this._wallOutlineMaterial.destroy()),this._fillColor=void 0,this._fillOpacity=void 0,this._fillHighlight=void 0,this._cutColor=void 0,this._cutOpacity=void 0,this._cutHighlight=void 0,this._baseColor=void 0,this._baseOpacity=void 0,this._base=void 0,this._baseGeometry=void 0,this._baseMaterial=void 0,this._baseGeometryUpdated=void 0,this._baseMaterialUpdated=void 0,this._baseOutlineColor=void 0,this._baseOutlineOpacity=void 0,this._baseOutlineGeometry=void 0,this._baseOutlineMaterial=void 0,this._baseOutlineGeometryUpdated=void 0,this._baseOutlineMaterialUpdated=void 0,this._wallColor=void 0,this._wallOpacity=void 0,this._wall=void 0,this._wallGeometry=void 0,this._wallMaterial=void 0,this._wallGeometryUpdated=void 0,this._wallMaterialUpdated=void 0,this._wallOutlineColor=void 0,this._wallOutlineOpacity=void 0,this._wallOutlineGeometry=void 0,this._wallOutlineMaterial=void 0,this._wallOutlineGeometryUpdated=void 0,this._wallOutlineMaterialUpdated=void 0,this._enabled=void 0,this.id=void 0;}}class pg{constructor(e){this._painter=e,this._cutFills=[];}get length(){return this._cutFills.length}add(t,i){if(!(t instanceof mg))return console.error("The current addition is not of type CutFill!"),!1;const s=e.defined(i);if(s){if(i<0)throw new Error("index must be greater than or equal to zero.");if(i>this._cutFills.length)throw new Error("index must be less than or equal to the number of CutFill.")}return s?this._cutFills.splice(i,0,t):this._cutFills.push(t),!0}getById(e){let t;return this._cutFills.forEach((i=>{i.id===e&&(t=i);})),t}getByIndex(t){if(e.isNumber(t)&&!(t>this.length))return this._cutFills[t]}indexOf(e){return this._cutFills.indexOf(e)}remove(e){const t=this.indexOf(e);return -1!==t&&(this._cutFills.splice(t,1),e.destroy(),!0)}removeById(e){const t=this.getById(e);this.remove(t);}removeByIndex(t){if(e.isNumber(t)){if(t<0)throw new Error("index must be greater than or equal to zero.");if(t>this._cutFills.length)throw new Error("index must be less than or equal to the number of CutFill.");const e=this.getByIndex(t);this.remove(e);}return !1}removeAll(){for(;this.length>0;)this.removeByIndex(0);this._cutFills=[];}update(e){for(let t=0;t<this.length;t++)this.getByIndex(t).update(e);}render(t){for(let i=0;i<this._cutFills.length;i++){const s=this.getByIndex(i);e.defined(s)&&s.render(t);}}serialize(){const t=[];for(let i=0;i<this.length;i++){const s=this.getByIndex(i),r=[];for(let t=0;t<s.positions.length;t++)r.push(e.Vector3.pack(s.positions[t],new Array(3)));const n={positions:r,baseHeight:s.baseHeight,minHeight:s.minHeight,maxHeight:s.maxHeight,fillColor:e.Color.pack(s.fillColor,new Array(4)),fillOpacity:s.fillOpacity,cutColor:e.Color.pack(s.cutColor,new Array(4)),cutOpacity:s.cutOpacity,baseColor:e.Color.pack(s.baseColor,new Array(4)),baseOpacity:s.baseOpacity,baseOutlineColor:e.Color.pack(s.baseOutlineColor,new Array(4)),baseOutlineOpacity:s.baseOutlineOpacity,wallColor:e.Color.pack(s.wallColor,new Array(4)),wallOpacity:s.wallOpacity,wallOutlineColor:e.Color.pack(s.wallOutlineColor,new Array(4)),wallOutlineOpacity:s.wallOutlineOpacity,enabled:s.enabled};t.push(n);}return t.length>0?t:void 0}}const fg={};function gg(t,i){return e.CONSTS.CesiumMath.equalsEpsilon(t.latitude,i.latitude,e.CONSTS.CesiumMath.EPSILON10)&&e.CONSTS.CesiumMath.equalsEpsilon(t.longitude,i.longitude,e.CONSTS.CesiumMath.EPSILON10)}fg.computePositions=function(t,i,s,r,n,o){const a=function(t,i,s,r){const n=new e.Cartographic,o=new e.Cartographic,a=(i=e.arrayRemoveDuplicates(i,e.Vector3.equalsEpsilon)).length;if(a<2)return;const l=e.defined(r),h=e.defined(s),_=new Array(a),c=new Array(a),d=new Array(a),u=i[0];_[0]=u;const m=t.cartesianToCartographic(u,n);e.fromCartographicToRadians(m,m),h&&(m.height=s[0]),c[0]=m.height,d[0]=l?r[0]:0;let p=c[0]===d[0],f=1;for(let n=1;n<a;++n){const a=i[n],u=t.cartesianToCartographic(a,o);e.fromCartographicToRadians(u,u),h&&(u.height=s[n]),p=p&&0===u.height,gg(m,u)?m.height<u.height&&(c[f-1]=u.height):(_[f]=a,c[f]=u.height,d[f]=l?r[n]:0,p=p&&c[f]===d[f],e.Cartographic.clone(u,m),++f);}return p||f<2?void 0:(_.length=f,c.length=f,d.length=f,{positions:_,topHeights:c,bottomHeights:d})}(t,i,s,r);if(!e.defined(a))return;s=a.topHeights,r=a.bottomHeights;const l=(i=a.positions).length,h=l-2;let _,c;const d=e.CONSTS.CesiumMath.chordLength(n,t.maximumRadius),u={positions:void 0,height:void 0,granularity:void 0,ellipsoid:void 0};if(u.minDistance=d,u.ellipsoid=t,o){let t,n=0;for(t=0;t<l-1;t++)n+=e.PolylinePipeline.numberOfPoints(i[t],i[t+1],d)+1;_=new Float64Array(3*n),c=new Float64Array(3*n);const o=new Array(2),a=new Array(2);u.positions=o,u.height=a;let h=0;for(t=0;t<l-1;t++){o[0]=i[t],o[1]=i[t+1],a[0]=s[t],a[1]=s[t+1];const n=e.PolylinePipeline.generateArc(u);_.set(n,h),a[0]=r[t],a[1]=r[t+1],c.set(e.PolylinePipeline.generateArc(u),h),h+=n.length;}}else u.positions=i,u.height=s,_=new Float64Array(e.PolylinePipeline.generateArc(u)),u.height=r,c=new Float64Array(e.PolylinePipeline.generateArc(u));return {bottomPositions:c,topPositions:_,numCorners:h}};class yg extends e.Geometry{constructor(t){if(super(t),!e.defined(t.positions))throw new Error("options.positions is required.");if(e.defined(t.maximumHeights)&&t.maximumHeights.length!==t.positions.length)throw new Error("options.positions and options.maximumHeights must have the same length.");if(e.defined(t.minimumHeights)&&t.minimumHeights.length!==t.positions.length)throw new Error("options.positions and options.minimumHeights must have the same length.");this._indexArray=new e.StructArrayLayout3ui6,this.primitiveType=e.WebGLConstants.TRIANGLES,this.type="WallGeometry",this._usedDoublePrecision=!0,this._vertexArray=new e.StructArrayLayout11f44,this.updateProperty(t);}updateProperty(e){this.setData(e);}setData(t){super.setData(),this.vertices=void 0,this.indices=void 0,this.normals=void 0,this.uvs=void 0,this._vertexArray?(this._vertexArray.clear(),this._indexArray.clear()):(this._indexArray=new e.StructArrayLayout3ui6,this._vertexArray=new e.StructArrayLayout11f44),this._positions=t.positions,this._maximumHeights=t.maximumHeights,this._minimumHeights=t.minimumHeights,this._granularity=e.defaultValue(t.granularity,e.CONSTS.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=e.defaultValue(t.ellipsoid,e.Ellipsoid.WGS84),this._needUpdate=!0,this._parse(),this.computeBoundingSphere(),this.computeBoundingBox();}static fromConstantHeights(t){const i=t.positions;if(!e.defined(i))throw new Error("options.positions is required.");let s,r;const n=t.minimumHeight,o=t.maximumHeight,a=e.defined(n),l=e.defined(o);if(a||l){const e=i.length;s=a?new Array(e):void 0,r=l?new Array(e):void 0;for(let t=0;t<e;++t)a&&(s[t]=n),l&&(r[t]=o);}return new yg({positions:i,maximumHeights:r,minimumHeights:s})}_parse(){const t=new e.Vector3,i=new e.Vector3,s=new e.Vector3,r=new e.Vector3,n=this._ellipsoid,o=fg.computePositions(n,this._positions,this._maximumHeights,this._minimumHeights,this._granularity,!0);if(!e.defined(o))return;const a=o.bottomPositions,l=o.topPositions,h=o.numCorners;let _=l.length,c=2*_,d=0;for(let t=0;t<_/3;t++)d=Math.max(d,e.Vector3.distance(e.Vector3.fromArray(l,3*t),e.Vector3.fromArray(a,3*t)));const u=new Float64Array(c),m=new Float32Array(c),p=new Float32Array(c/3*2);let f,g=0,y=0,T=0,C=new e.Vector3,x=!0;_/=3;let b=0;const v=1/(_-h-1);for(f=0;f<_;++f){const o=3*f,h=e.Vector3.fromArray(l,o,t),c=e.Vector3.fromArray(a,o,i);u[g++]=c.x,u[g++]=c.y,u[g++]=c.z,u[g++]=h.x,u[g++]=h.y,u[g++]=h.z,p[T++]=b,p[T++]=0,p[T++]=b,p[T++]=1;let d=e.Vector3.clone(e.Vector3.ZERO,r);const w=e.Vector3.subtract(h,n.geodeticSurfaceNormal(h,i),i);if(f+1<_&&(d=e.Vector3.fromArray(l,o+3,r)),x){const i=e.Vector3.subtract(d,h,s),r=e.Vector3.subtract(w,h,t);C=e.Vector3.normalize(e.Vector3.cross(r,i,C),C),x=!1;}e.Vector3.equalsEpsilon(h,d,e.CONSTS.CesiumMath.EPSILON10)?x=!0:b+=v,m[y++]=C.x,m[y++]=C.y,m[y++]=C.z,m[y++]=C.x,m[y++]=C.y,m[y++]=C.z;}const w=c/3;c-=6*(h+1);const S=new Uint16Array(c);let A=0;for(f=0;f<w-2;f+=2){const s=f,r=f+2,n=e.Vector3.fromArray(u,3*s,t),o=e.Vector3.fromArray(u,3*r,i);if(e.Vector3.equalsEpsilon(n,o,e.CONSTS.CesiumMath.EPSILON10))continue;const a=f+1,l=f+3;S[A++]=s,S[A++]=a,S[A++]=l,S[A++]=s,S[A++]=l,S[A++]=r;}this.vertices=u,this.indices=S,this.normals=m,this.uvs=p;for(let e=0;e<S.length;e+=3)this._indexArray.emplaceBack(S[e],S[e+1],S[e+2]);const E=new e.Vector3;for(let t=0;t<this.vertices.length;t+=3)e.Vector3.fromArray(this.vertices,t,E),this.vertices[t]=E.x,this.vertices[t+1]=E.y,this.vertices[t+2]=E.z;this.emplaceVertexBufferTriangle();}update(t){if(this._needUpdate&&t.painter){const i=t.painter.context;this._vertexBuffer?(this._vertexBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indexArray)):(this._vertexBuffer=i.createVertexBuffer(this._vertexArray,e.layout.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indexArray,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/3),this._needUpdate=!1;}}serialize(){return {type:this.type,positions:this._positions,maximumHeights:this._maximumHeights,minimumHeights:this._minimumHeights}}destroy(){super.destroy(),this._vertexBuffer=void 0,this._indexBuffer=void 0,this._segmentVector=void 0,this._needUpdate=void 0,this._positions=void 0,this._maximumHeights=void 0,this._minimumHeights=void 0,this._granularity=void 0,this._ellipsoid=void 0,this.vertices=void 0,this.indices=void 0,this.normals=void 0,this.uvs=void 0,this._vertexArray=void 0,this._indexArray=void 0,this.primitiveType=void 0,this.type=void 0,this._segmentVector=void 0;}}const Tg=new e.Matrix4,Cg=new e.Vector4;class xg extends e.Material{constructor(t){super(t),this._texType=e.defaultValue(t.texType,void 0),this._count=0,this._pickColorDepthTest=e.defaultValue(t.pickColorDepthTest,void 0),this._clippingPlanes=e.defaultValue(t.clippingPlanes,void 0),this._vertexColor=t.vertexColor,this._vertexColor&&(this.defines={VERTEX_COLOR:!0});}get pickColorDepthTest(){return this._pickColorDepthTest}set pickColorDepthTest(e){this._pickColorDepthTest=e;}update(t,i,s={}){if(super.update(t,i,s),this._batchTable&&(this.uniforms=this._batchTable.getUniformMapCallback(),t.commonDepthPass.render({painter:t}),this._uniforms.set("u_DepthTexture",(()=>t.commonDepthPass.framebuffer.getColorTexture(0).bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE))),this._uniforms.set("u_InvertViewMatrix",(()=>i.camera.getViewMatrix().invert())),this.defines=s.primitive._adaptTerrain?i.preMainDepthStencilTexture?{HAS_SHADOWVOLUME:!0,SHADOWVOLUME_DISCARD:!0}:{HAS_SHADOWVOLUME:!0,SHADOWVOLUME_DISCARD:!1}:{HAS_SHADOWVOLUME:!1,SHADOWVOLUME_DISCARD:!1}),this._clippingPlanes&&this._clippingPlanes.enabled&&0!==this._clippingPlanes.length){this._clippingPlanes.update(t,i),this._uniforms.set("u_model_clippingPlanesEdgeStyle",(()=>(Cg.set(this._clippingPlanes.edgeColor.r,this._clippingPlanes.edgeColor.g,this._clippingPlanes.edgeColor.b,this._clippingPlanes.edgeWidth),Cg))),this._uniforms.set("u_model_clippingPlanes",(()=>this._clippingPlanes.texture)),this._uniforms.set("u_model_clippingPlanesMatrix",(()=>{const t=e.Matrix4.multiply(Tg,i.camera.matrixWorldInverse,this._clippingPlanes.modelMatrix);return e.Matrix4.inverseTranspose(t,t),t})),this.defines.HAS_CLIPPING_PLANES=!0,this.defines.USE_CLIPPING_PLANES_FLOAT_TEXTURE=!!this._clippingPlanes._useFloatTexture;const s=e.ClippingPlaneCollection.getTextureResolution(this._clippingPlanes);this.defines.CLIPPING_PLANES_LENGTH=this._clippingPlanes.length,this.defines.CLIPPING_PLANES_TEXTURE_WIDTH=s.x,this.defines.CLIPPING_PLANES_TEXTURE_HEIGHT=s.y,this.defines.UNION_CLIPPING_REGIONS=!!this._clippingPlanes._unionClippingRegions;}else this.defines.HAS_CLIPPING_PLANES=!1,this.defines.USE_CLIPPING_PLANES_FLOAT_TEXTURE=!1,this.defines.CLIPPING_PLANES_LENGTH=0,this.defines.CLIPPING_PLANES_TEXTURE_WIDTH=1,this.defines.CLIPPING_PLANES_TEXTURE_HEIGHT=1;}updateTexture(t,i){let s;return t==e.StandardMaterialType.COLOR?s=xg.fromType(e.StandardMaterialType.COLOR,{color:i.baseColor,opacity:i.opacity,lightingModel:i.lightingModel,doubleSided:i.doubleSided}):t==e.StandardMaterialType.TEXTURE?s=xg.fromType(e.StandardMaterialType.TEXTURE,{baseColorTexture:i.baseColorTexture,opacity:i.opacity,lightingModel:i.lightingModel,doubleSided:i.doubleSided}):t==e.StandardMaterialType.RADAR_SCAN?s=xg.fromType(e.StandardMaterialType.RADAR_SCAN,{color:i.baseColor,opacity:i.opacity,lightingModel:i.lightingModel,doubleSided:i.doubleSided}):t==e.StandardMaterialType.DIFFUSING_RING&&(s=xg.fromType(e.StandardMaterialType.DIFFUSING_RING,{color:i.baseColor,opacity:i.opacity,lightingModel:i.lightingModel,doubleSided:i.doubleSided})),s}updateProperty(t){if(t.color){const i=e.Color.parse(t.color);this._uniforms.set("u_Color",(()=>e.Vector4.fromColor(i,!1)));}t.baseColorTexture&&(this._uniforms.set("u_BaseColorSampler",(()=>e.Material.bindTextureSampler(t.baseColorTexture))),xg.buildDefines(this,t)),e.defined(t.opacity)&&this._uniforms.set("u_Opacity",(()=>t.opacity)),this._updateTexOffsetScale(t);}static buildDefines(t,i={}){const s={};if(s.PHONG_LIGHT=i.phongLight,s.HAS_BASECOLORMAP=i.hasBaseColorMap,s.HAS_RADARSCAN=i.radarScan,s.HAS_DIFFUSINGRING=i.diffusingRing,s.HAS_CLIPPING_PLANES=i.clippingPlanes,s.HAS_CLIPPING_PLANES){s.HAS_CLIPPING_PLANES=!0,s.USE_CLIPPING_PLANES_FLOAT_TEXTURE=!!t._clippingPlanes._useFloatTexture;const i=e.ClippingPlaneCollection.getTextureResolution(t._clippingPlanes);s.CLIPPING_PLANES_LENGTH=t._clippingPlanes.length,s.CLIPPING_PLANES_TEXTURE_WIDTH=i.x,s.CLIPPING_PLANES_TEXTURE_HEIGHT=i.y,s.UNION_CLIPPING_REGIONS=!!t._clippingPlanes._unionClippingRegions;}else s.HAS_CLIPPING_PLANES=!1,s.USE_CLIPPING_PLANES_FLOAT_TEXTURE=!1,s.CLIPPING_PLANES_LENGTH=0,s.CLIPPING_PLANES_TEXTURE_WIDTH=1,s.CLIPPING_PLANES_TEXTURE_HEIGHT=1;t.defines=s;}get texType(){return this._texType}set texType(e){this._texType=e;}get clippingPlanes(){return this._clippingPlanes}set clippingPlanes(t){this._clippingPlanes=t instanceof e.ClippingPlaneCollection?t:void 0;}static fromType(t,i){const s=xg.getPresetMaterial(t,i),r=new xg({renderState:i.renderState?i.renderState:s.renderState,defines:i.defines,type:"StandardMaterial",texType:t,baseColorTexture:s.baseColorTexture,color:s.color,doubleSided:s.doubleSided,opacity:s.opacity,lightingModel:s.lightingModel,depthTest:i.depthTest,clippingPlanes:i.clippingPlanes,vertexColor:i.vertexColor});xg.buildDefines(r,s.microDefineOptions),e.PhongLightSetter.setPhongLightUniform({material:r});for(const e in s.uniforms)r._uniforms.set(`u_${e}`,s.uniforms[e]);return r._updateTexOffsetScale({texCoordRepeat:e.defaultValue(i.texRepeat,[0,0])}),r}static getPresetMaterial(t,i){const s=e.defaultValue(i?.lightingModel,e.LightingModelType.PHONG),r={renderState:e.Material.getDefaultRenderState(),videoOptions:{},uniforms:{},baseColorTexture:void 0,doubleSided:void 0,lightingModel:void 0,defines:void 0,microDefineOptions:{phongLight:s===e.LightingModelType.PHONG,hasBaseColorMap:e.defaultValue(!!i.baseColorTexture,!1),radarScan:e.defaultValue(t===e.StandardMaterialType.RADAR_SCAN,!1),diffusingRing:e.defaultValue(t===e.StandardMaterialType.DIFFUSING_RING,!1),clippingPlanes:e.defaultValue(!!i.clippingPlanes,!1)},color:void 0,opacity:void 0};r.renderState.polygonOffset={enabled:!0,factor:1,units:1},r.renderState.cull.enabled=e.defaultValue(!i.doubleSided,!0);const n=e.defaultValue(i?.opacity,1),o=e.Color.parse(e.defaultValue(i?.color,new e.Color(1,0,0,1)));r.color=o,r.doubleSided=e.defaultValue(i.doubleSided,!1),r.opacity=n,r.lightingModel=s,r.baseColorTexture=i.baseColorTexture;const a=e.defaultValue(i?.speed,1);if(t==e.StandardMaterialType.COLOR)r.uniforms={Color:()=>e.Vector4.fromColor(o,!1),Opacity:()=>n};else if(t==e.StandardMaterialType.TEXTURE)r.uniforms={BaseColorSampler:()=>e.Material.bindTextureSampler(i.baseColorTexture),Color:()=>new e.Vector4(o.r,o.g,o.b,o.a),Opacity:()=>n};else if(t==e.StandardMaterialType.RADAR_SCAN)r.uniforms={Color:()=>e.Vector4.fromColor(o,!1),Opacity:()=>n,Speed:()=>a};else {if(t!=e.StandardMaterialType.DIFFUSING_RING)throw new Error(`material with type '${t}' does not exist.`);r.uniforms={Color:()=>e.Vector4.fromColor(o,!1),Opacity:()=>n,Speed:()=>a};}return r}serialize(){const t={type:"StandardMaterial",texTYpe:this._texType,opacity:this._opacity,doubleSided:this._doubleSided,lightingModel:this._lightingModel};return this._texType===e.StandardMaterialType.COLOR?t.color=e.Color.pack(this._color,new Array(4)):this._texType===e.StandardMaterialType.TEXTURE&&(t.texUrl=this._baseColorTexture.texUrl),e.defined(this._flowOptions)&&(t.flowOptions=this._flowOptions),e.defined(this.clippingPlanes)&&(t.clippingPlanes=this.clippingPlanes.serialize()),t}destroy(){return super.destroy(),e.destroyObject(this)}}class bg{constructor(t){if(e.defined(t.positions)){if(!(t.positions instanceof Array))throw new Error("options.positions is not type of Array!");if(t.positions.length<3)throw new Error("options.positions's length must greater than 2!");t.positions.forEach((t=>{if(!(t instanceof e.Vector3))throw new Error("options.positions contains the type of not Vector3!")}));}if(this.bottomTextureUrl=t.bottomTextureUrl,this.sideTextureUrl=t.sideTextureUrl,this._minHeight=0,this._maxHeights=[],this._wallPositions=[],this._positions=e.defaultValue(t.positions,void 0),this.positions=this._positions,this._shadowVolumePositions=[],this._positionsUpdated=!1,e.defined(t.depth)&&!e.isNumber(t.depth))throw new Error("options.depth contains the type of not Number!");if(this._depth=e.defaultValue(t.depth,100),this.depth=this._depth,this._depthUpdated=!1,e.defined(t.sampleDistance)&&!e.isNumber(t.sampleDistance))throw new Error("options.sampleDistance is not a Number!");if(this._sampleDistance=e.defaultValue(t.sampleDistance,5),this.sampleDistance=this._sampleDistance,this._sampleDistanceUpdated=!1,e.defined(t.enabled)&&!e.isBoolean(t.enabled))throw new Error("options.sampleDistance is not a bool!");this._enabled=e.defaultValue(t.enabled,!0),this._bodyMaterial=void 0,this._bodyPrimitive=void 0,this._bottomMaterial=void 0,this._bottomPrimitive=void 0,this._backPrimitive=void 0,this._frontPrimitive=void 0,this._initialized=!1,this.id=e.uuid();}get depth(){return this._depth}set depth(t){e.isNumber(t)&&t>=0&&(this._depth=t,this._depthUpdated=!1);}get enabled(){return this._enabled}set enabled(t){e.isBoolean&&(this._enabled=t);}get positions(){return this._positions}set positions(t){(t instanceof Array||t.length>2)&&(t.forEach((t=>{if(!(t instanceof e.Vector3))throw new Error("positions contains the type of not Vector3!")})),this._positions=t,this._positions.push(t[0]),this._positionsUpdated=!1);}get sampleDistance(){return this._sampleDistance}set sampleDistance(t){e.isNumber(t)&&(this._sampleDistance=Math.max(t,1),this._sampleDistanceUpdated=!1);}_prepareVertex(t){const i=this;this._shadowVolumePositions=[];const s=new e.Cartographic,r=[];let n;for(let t=0;t<this.positions.length-1;t++){const o=this.positions[t];e.Cartographic.fromVector3(o,void 0,s),i._maxHeights.push(s.height),r.push(s.height),n=e.Cartographic.fromVector3(o),i._shadowVolumePositions.push(e.Vector3.fromRadians(n.longitude,n.latitude,9e3));}this._minHeight=r.sort(((e,t)=>e-t))[0]-this._depth;const o=e.Vector3.unpackArray(e.PolylinePipeline.generateRhumbArc({positions:this.positions,minDistance:this.sampleDistance}));this._wallPositions=[];for(let i=0;i<o.length;i++){const s=e.Cartographic.fromVector3(o[i]),r=180*s.longitude/Math.PI,n=180*s.latitude/Math.PI;if(t.style.rasterSourceCache.terrainSource.isTerrain()){const i=Il([r,n,0],e.Vector3.fromDegrees(r,n,1e4),t.style.rasterSourceCache.terrainSource,t.transform.projection);e.defined(i.intersectionPoint)&&this._wallPositions.push(i.intersectionPoint);}else this._wallPositions.push(e.Vector3.fromDegrees(r,n,0));}}_prepareMaterial(t){e.defined(this._bottomMaterial)||(this._bottomMaterial=xg.fromType("Texture",{baseColorTexture:(new oa).load({map:t._map,texUrl:this.bottomTextureUrl||wt("minemap://assets/DigBottom.jpg")}),lightingModel:e.LightingModelType.NONE,doubleSided:!0})),e.defined(this._bodyMaterial)||(this._bodyMaterial=xg.fromType("Texture",{baseColorTexture:(new oa).load({map:t._map,texUrl:this.sideTextureUrl||wt("minemap://assets/DigBody.jpg"),flipY:!0}),lightingModel:e.LightingModelType.NONE,doubleSided:!0}));}_createBody(t){e.defined(this._bodyPrimitive)&&t._map.removePrimitive(this._bodyPrimitive),this._bodyPrimitive=new e.Primitive({geometry:yg.fromConstantHeights({positions:this._wallPositions,minimumHeight:this._minHeight}),material:this._bodyMaterial,name:"excavationBody",classificationType:e.ClassificationType.IGNORECLASSIFICATION}),t._map.addPrimitive(this._bodyPrimitive);}_createBottom(t){e.defined(this._bottomPrimitive)&&t._map.removePrimitive(this._bottomPrimitive);const i=[];for(let t=0;t<this._positions.length-1;t++)i.push(e.Vector3.clone(this._positions[t]));this._bottomPrimitive=new e.Primitive({geometry:new e.PolygonGeometry({polygonHierarchy:{positions:i},height:this._minHeight}),material:this._bottomMaterial,name:"excavationBottom",classificationType:e.ClassificationType.IGNORECLASSIFICATION}),t._map.addPrimitive(this._bottomPrimitive);}_createShadowVolume(){const t=new e.PolygonGeometry({polygonHierarchy:{positions:this._shadowVolumePositions},extrudedHeight:-this._depth,perPositionHeight:!0});this._frontPrimitive=new e.Primitive({geometry:t,material:xg.fromType("Color",{renderState:{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},cull:{enabled:!0,face:e.WebGLConstants.FRONT},depthMask:!1,depthTest:{enabled:!0,func:e.WebGLConstants.LESS},stencilMask:255,stencilTest:{enabled:!0,frontFunction:e.WebGLConstants.ALWAYS,frontOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.KEEP},backOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.DECR_WRAP,zPass:e.WebGLConstants.KEEP},reference:0,mask:255}}})}),this._backPrimitive=new e.Primitive({geometry:t,material:xg.fromType("Color",{renderState:{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},cull:{enabled:!0,face:e.WebGLConstants.BACK},depthMask:!1,depthTest:{enabled:!0,func:e.WebGLConstants.LESS},depthRange:{near:0,far:1},stencilMask:255,stencilTest:{enabled:!0,frontFunction:e.WebGLConstants.ALWAYS,frontOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.INCR_WRAP,zPass:e.WebGLConstants.KEEP},backOperation:{fail:e.WebGLConstants.KEEP,zFail:e.WebGLConstants.KEEP,zPass:e.WebGLConstants.KEEP},reference:0,mask:255}}})});}_createPrimitive(e){this._prepareVertex(e),this._prepareMaterial(e),this._createBody(e),this._createBottom(e),this._createShadowVolume();}_initialize(e){this._createPrimitive(e),this._initialized=!0,this._positionsUpdated=!0,this._sampleDistanceUpdated=!0,this._depthUpdated=!0;}update(t){this._enabled&&e.defined(this._positions)&&(this._initialized&&this._positionsUpdated&&this._sampleDistanceUpdated&&this._depthUpdated||this._initialize(t),e.defined(this._backPrimitive)&&e.defined(this._frontPrimitive)&&(this._backPrimitive.update(t,t.frameState),this._backPrimitive.render(t,{id:"shadowVolumeBack"},t.frameState),this._frontPrimitive.update(t,t.frameState),this._frontPrimitive.render(t,{id:"shadowVolumeFront"},t.frameState)));}destroy(){return this._minHeight=void 0,this._maxHeights=void 0,this._wallPositions=void 0,this._positions=void 0,this._shadowVolumePositions=void 0,this._positionsUpdated=void 0,this._depth=void 0,this._depthUpdated=void 0,this._sampleDistance=void 0,this._sampleDistanceUpdated=void 0,this._enabled=void 0,this._bodyPrimitive.destroy(),this._bodyPrimitive=void 0,this._bodyMaterial=void 0,this._bottomPrimitive.destroy(),this._bottomPrimitive=void 0,this._bottomMaterial=void 0,this._backPrimitive.destroy(),this._frontPrimitive.destroy(),this._initialized=void 0,e.destroyObject(this)}}class vg{constructor(e){this._painter=e,this._excavations=[];}get length(){return this._excavations.length}add(t,i){if(!(t instanceof bg))return console.error("The current addition is not of type Excavation!"),!1;const s=e.defined(i);if(s){if(i<0)throw new Error("index must be greater than or equal to zero.");if(i>this._excavations.length)throw new Error("index must be less than or equal to the number of Excavation.")}return s?this._excavations.splice(i,0,t):this._excavations.push(t),!0}getById(e){let t;return this._excavations.forEach((i=>{i.id===e&&(t=i);})),t}getByIndex(t){if(e.isNumber(t)&&!(t>this.length))return this._excavations[t]}indexOf(e){return this._excavations.indexOf(e)}remove(e){const t=this.indexOf(e);return -1!==t&&(this._removePrimitive(e),this._excavations.splice(t,1),!0)}removeById(e){const t=this.getById(e);this.remove(t);}removeByIndex(t){if(e.isNumber(t)){if(t<0)throw new Error("index must be greater than or equal to zero.");if(t>this._excavations.length)throw new Error("index must be less than or equal to the number of Excavation.");const e=this.getByIndex(t);this.remove(e);}return !1}removeAll(){for(let e=0;e<this.length;e++)this._removePrimitive(this.getByIndex(e));this._excavations=[];}_removePrimitive(e){this._painter._map.removePrimitive(e._bottomPrimitive),this._painter._map.removePrimitive(e._bodyPrimitive);}update(t,i,s){if(this.length<1)return;const r={colorMask:{red:!1,green:!1,blue:!1,alpha:!1},depthTest:{enabled:!0}};let n,o;for(let e=0;e<i.length;e++)n=i[e],o=n._material.renderState,n._material._renderState=r,n.update(t,t.frameState),n.render(t,s,t.frameState),n._material._renderState=o;t.clearStencil();for(let e=0;e<this.length;e++)(this.getByIndex(e)._initialized||t.style.rasterSourceCache.loaded())&&this.getByIndex(e).update(t);e.RenderState.applyRenderState(t.context,e.RenderState.fromCache({colorMask:{red:!0,green:!0,blue:!0,alpha:!0},depthMask:!0})),t.context.clear({depth:1});}serialize(){const t=[];for(let i=0;i<this.length;i++){const s=this.getByIndex(i),r=[];for(let t=0;t<s.positions.length;t++){let i=s.positions[t];i=e.Cartographic.fromVector3(i),i.x=e.CONSTS.CesiumMath.toDegrees(i.x),i.y=e.CONSTS.CesiumMath.toDegrees(i.y),e.Vector3.pack(i,r,r.length);}t[i]={positions:r,depth:s.depth,sampleDistance:s.sampleDistance,enabled:s.enabled};}return t.length>0?t:void 0}}const wg={VISIBLE_DOME:0,HIDDEN_DOME:1,ALL_DOME:2};class Sg extends Nd{constructor(t){super(t),this.camera=t.camera,this.framebuffer=void 0,this.width=t.width,this.height=t.height,this.frameState=void 0,this.replaceMaterial=new e.DepthMaterial({});}_createFramebuffer({context:t,width:i,height:s}){const r=new e.Sampler({minificationFilter:e.TextureMinificationFilter.NEAREST,magnificationFilter:e.TextureMagnificationFilter.NEAREST});this.framebuffer=new Od({context:t,width:i,height:s,colorTextures:[new e.Texture({image:null,context:t,width:i,height:s,pixelFormat:e.WebGLConstants.RGBA})],depthStencilTexture:new e.Texture({context:t,width:i,height:s,minFilter:e.WebGLConstants.LINEAR,magFilter:e.WebGLConstants.LINEAR,pixelFormat:e.PixelFormat.DEPTH_STENCIL,pixelDatatype:e.PixelDatatype.UNSIGNED_INT_24_8,sampler:r,anisotropy:1})});}update(t,i,s){const r=t.context;e.defined(this.frameState)||(this.frameState=new Vd(this.passType)),this.frameState.overrideMaterial=this.replaceMaterial,e.defined(this.framebuffer)||this._createFramebuffer({context:r,width:i,height:s}),this.frameState.update({framebuffer:this.framebuffer,camera:this.camera}),this.frameState.bindFramebuffer(r);}render(t){const i=t.context,s=i.bindFramebuffer.get();this.update(t,this.width,this.height),e.RenderState.applyRenderState(i,e.RenderState.fromCache({blending:e.renderStateEnum.enableBlending,depthMask:!0,depthTest:{enabled:!0,depthTest:e.WebGLConstants.LESS},viewport:{x:0,y:0,width:this.width,height:this.height}})),i.clear({depth:1}),t.renderGroup.update({layers:t.style._layers,orders:t.style._order,frameState:this.frameState}),t.renderGroup.render({layers:t.style._layers,frameState:this.frameState}),this.frameState.overrideMaterial=void 0,i.bindFramebuffer.set(s),e.RenderState.applyRenderState(i,e.RenderState.fromCache({viewport:{x:0,y:0,width:t.width,height:t.height}}));}}class Ag{constructor(t){if(e.defined(t.viewPosition)&&!(t.viewPosition instanceof e.Vector3))throw new Error("viewerPosition is not type of Vector3!");if(this._viewPosition=e.defaultValue(t.viewPosition,new e.Vector3),this._radius=e.defaultValue(t.radius,100),this._domeType=e.defaultValue(t.domeType,wg.ALL_DOME),this._visible=e.defaultValue(t.visible,!0),this._visibleAreaColor=e.defaultValue(e.Color.parse(t.visibleAreaColor),new e.Color(0,1,0,1)),this._hiddenAreaColor=e.defaultValue(e.Color.parse(t.hiddenAreaColor),new e.Color(1,0,0,1)),this._startAngle=e.defaultValue(t.startAngle,0),this._endAngle=e.defaultValue(t.endAngle,360),this._isClosed=e.defaultValue(t.isClosed,!1),this._sholdCalculateVisibleRatio=e.defaultValue(t.sholdCalculateVisibleRatio,!0),this._hasCalculated=!1,this._visibleRatio=0,e.defined(t.ratioCalculated)&&!(t.ratioCalculated instanceof Function))throw new Error("options.ratioCalculated is not a function!");this.ratioCalculatedCallback=e.defaultValue(t.ratioCalculated,void 0),this._pointIndicator=void 0,this._indicatorVisible=e.defaultValue(t.indicatorVisible,10),this._indicatorSize=e.defaultValue(t.indicatorSize,10),this._indicatorColor=e.Color.parse(t.indicatorColor)||new e.Color(1,0,0,1),this._indicatorOutlineColor=e.Color.parse(t.indicatorOutlineColor)||new e.Color(0,0,0,0),this._indicatorOutlineWidth=e.defaultValue(t.indicatorOutlineWidth,0),this._initialized=!1,this._worldMatrix=new e.Matrix4,this._geometry=void 0,this._viewDomeCommand=void 0,this._calculateFramebuffers=[],this._calculateCommands=[],this._renderTextureMatrix=[],this._viewshedPass=[],this._windowSize={height:0,width:0},this.id=e.uuid();}get viewPosition(){return this._viewPosition}set viewPosition(t){if(t instanceof e.Vector3){this._viewPosition=t;const i=e.Vector3.fromDegrees(t.x,t.y,t.z);this._worldMatrix=e.Transforms.headingPitchRollToFixedFrame(i,new e.HeadingPitchRoll(0,0,0)),this._initialized=!1,this._hasCalculated=!1;}}get radius(){return this._radius}set radius(t){e.isNumber(t)&&(this._radius=t,this._initialized=!1,this._hasCalculated=!1);}get domeType(){return this._domeType}set domeType(e){this._domeType=e;}get visible(){return this._visible}set visible(t){e.isBoolean(t)&&(this._visible=t);}get sholdCalculateVisibleRatio(){return this._sholdCalculateVisibleRatio}set sholdCalculateVisibleRatio(t){e.isBoolean(t)&&(this._sholdCalculateVisibleRatio=t);}get visibleRatio(){return this._visibleRatio}get visibleAreaColor(){return this._visibleAreaColor}set visibleAreaColor(t){const i=e.Color.parse(t);e.defined(i)&&(this._visibleAreaColor=i);}get hiddenAreaColor(){return this._hiddenAreaColor}set hiddenAreaColor(t){const i=e.Color.parse(t);e.defined(i)?this._hiddenAreaColor=i:console.warn("hiddenAreaColor is not a valid color.");}get startAngle(){return this._startAngle}set startAngle(t){if(e.isNumber(t)){let e=Math.max(0,Math.min(360,t));e=Math.min(this._endAngle,e),this._startAngle=e,this._initialized=!1,this._hasCalculated=!1;}}get endAngle(){return this._endAngle}set endAngle(t){if(e.isNumber(t)){let e=Math.max(0,Math.min(360,t));e=Math.max(this._startAngle,e),this._endAngle=e,this._initialized=!1,this._hasCalculated=!1;}}get isClosed(){return this._isClosed}set isClosed(t){e.isBoolean(t)&&(this._isClosed=t,this._initialized=!1,this._hasCalculated=!1);}get indicatorVisible(){return this._indicatorVisible}set indicatorVisible(t){e.isBoolean(t)&&(this._indicatorVisible=t,this._addIndicator());}get indicatorSize(){return this._indicatorSize}set indicatorSize(t){e.isNumber(t)&&(this._indicatorSize=t,this._addIndicator());}get indicatorColor(){return this._indicatorColor}set indicatorColor(t){const i=e.Color.parse(t);e.defined(i)&&(this._indicatorColor=e.Color.parse(i),this._addIndicator());}get indicatorOutlineColor(){return this._indicatorOutlineColor}set indicatorOutlineColor(t){this._indicatorOutlineColor=e.Color.parse(t),this._addIndicator();}get indicatorOutlineWidth(){return this._indicatorOutlineWidth}set indicatorOutlineWidth(e){this._indicatorOutlineWidth=e,this._addIndicator();}_addIndicator(){if(!this._indicatorVisible)return;const t=e.Vector3.fromDegrees(this._viewPosition.x,this._viewPosition.y,this._viewPosition.z);e.defined(this._pointIndicator)?(this._pointIndicator.remove(this._pointPrimitive,!0),this._pointPrimitive=new Lh({show:!0,position:t,pixelSize:this._indicatorSize,color:this._indicatorColor,outlineColor:this._indicatorOutlineColor,outlineWidth:this._indicatorOutlineWidth}),this._pointIndicator.add(this._pointPrimitive)):(this._pointIndicator=new kh,this._pointPrimitive=new Lh({show:!0,position:t,pixelSize:this._indicatorSize,color:this._indicatorColor,outlineColor:this._indicatorOutlineColor,outlineWidth:this._indicatorOutlineWidth}),this._pointIndicator.add(this._pointPrimitive));}_drawPointIndicator(e){if(!this._indicatorVisible)return;this._pointIndicator.update(e);const t=this._pointIndicator.getTranslucentPrimitives();for(let i=0;i<t.length;i++)t[i].update(e,e.frameState,{}),t[i].framebuffer=e.mainPass.framebuffer.framebuffer;for(let i=0;i<t.length;i++)t[i].render(e,{id:"viewdom-indicator"},e.frameState),t[i].framebuffer=null;}_createDepthCamera(t){this._viewshedPass=[],this._renderTextureMatrix=[new e.Matrix4,new e.Matrix4,new e.Matrix4,new e.Matrix4,new e.Matrix4];const i=new e.Matrix4;for(let s=0;s<5;s++){const r=new l(90,1,Math.max(.001*this._radius,.1),Math.max(this._radius+100,10)),n=e.Transforms.headingPitchRollToFixedFrame(e.Vector3.fromDegrees(this.viewPosition.x,this.viewPosition.y,this.viewPosition.z),new e.HeadingPitchRoll(e.CONSTS.CesiumMath.toRadians(90*s),e.CONSTS.CesiumMath.toRadians(4===s?180:90),e.CONSTS.CesiumMath.toRadians(0)));r.setMatrix(n),e.Matrix4.multiply(i,r.getViewMatrix(),this._worldMatrix),e.Matrix4.multiply(this._renderTextureMatrix[s],r.getProjectionMatrix(),i),this._viewshedPass[s]=new Sg({camera:r,context:t.context,width:2048,height:2048,passType:e.RenderPassConsts.VIEWSHED_PASS});}}_createDomeGeometry(t,i,s,r,n,o){const a=(n-r)*e.CONSTS.CesiumMath.RADIANS_PER_DEGREE/i,l=Math.PI/(2*t);let h=0,_=0,c=!1;!o||0===r&&360===n||(c=!0);const d=new Array(3*(c?(t+1)*i+1:(t+1)*i));let u=0;for(let n=0;n<i;n++){_=n*a+r*e.CONSTS.CesiumMath.RADIANS_PER_DEGREE;for(let e=0;e<=t;e++)h=e*l,d[u++]=s*Math.sin(h)*Math.cos(_),d[u++]=s*Math.sin(h)*Math.sin(_),d[u++]=s*Math.cos(h);}return c&&(d[u++]=0,d[u++]=0,d[u++]=0),d}_createViewDomeIndices(e,t,i,s,r){const n=0==i&&360==s?t:t-1;let o;const a=[];for(o=0;o<e;o++)for(let i=0;i<n;i++){const s=o+i*(e+1),r=s+1,n=i==t-1?o+1:s+e+2;a.push(s),a.push(r),a.push(n),a.push(s),a.push(n),a.push(n-1);}if(r&&(0!=i||360!=s)){const i=(e+1)*t,s=n*(e+1);for(o=0;o<e;o++)a.push(o),a.push(o+1),a.push(i),a.push(o+s+1),a.push(o+s),a.push(i);}return a}_createViewDomeCommand(t){e.defined(this._geometry)&&this._geometry.destroy(),e.defined(this._viewDomeCommand)&&(this._viewDomeCommand.material=void 0,this._viewDomeCommand=void 0);const i=e.Vector3.fromDegrees(this.viewPosition.x,this.viewPosition.y,this.viewPosition.z);this._worldMatrix=e.Transforms.headingPitchRollToFixedFrame(i,new e.HeadingPitchRoll(0,0,0));const s=this._createDomeGeometry(129,129,1,this._startAngle,this._endAngle,this._isClosed),r=new e.StructArrayLayout3f2f3f32;for(let e=0;e<s.length;e+=3)r.emplaceBack(s[e],s[e+1],s[e+2],0,0,0,0,0);const n=this._createViewDomeIndices(129,129,this._startAngle,this._endAngle,this._isClosed),o=new e.StructArrayLayout3ui6;for(let e=0;e<n.length;e+=3)o.emplaceBack(n[e],n[e+1],n[e+2]);this._geometry=new e.Geometry({primitiveType:e.WebGLConstants.TRIANGLES,vertexBuffer:t.context.createVertexBuffer(r,e.layout$1.members),indexBuffer:t.context.createIndexBuffer(o),segmentVector:e.SegmentVector.simpleSegment(0,0,s.length/3,n.length/3)});const a=new Map([["u_ModelViewProjectionMatrix",()=>t.frameState.camera.getVPMatrix().multiplyRight(this._worldMatrix)],["u_Radius",()=>this._radius],["u_VisibleAreaColor",()=>e.Vector4.fromColor(this._visibleAreaColor,!1)],["u_HiddenAreaColor",()=>e.Vector4.fromColor(this._hiddenAreaColor,!1)],["u_DomeType",()=>this._domeType]]);for(let e=0;e<5;e++)a.set(`u_TexWorldViewProjMatrix${e}`,(()=>this._renderTextureMatrix[e])),a.set(`u_DepthMap${e}`,(()=>this._viewshedPass[e].framebuffer.depthStencilTexture));this._viewDomeCommand={painter:t,framebuffer:t.mainPass.framebuffer.framebuffer,layer:{id:"viewDomeAnalysis"},geometry:this._geometry,material:{renderState:{blending:e.renderStateEnum.enableBlending,depthTest:e.renderStateEnum.enableDepthTest},_uniforms:a,_shaderSource:new e.ShaderSource({type:"viewDomeAnalysis"})}};}_createCalculateCommand(t){const i=new e.Sampler({minificationFilter:e.TextureMinificationFilter.NEAREST,magnificationFilter:e.TextureMagnificationFilter.NEAREST});this._calculateCommands=[],this._calculateFramebuffers=[];for(let s=0;s<5;s++){const r=new e.Texture({context:t.context,width:2048,height:2048,minFilter:e.WebGLConstants.NEAREST,magFilter:e.WebGLConstants.NEAREST,pixelFormat:e.PixelFormat.RGBA,pixelDatatype:e.PixelDatatype.UNSIGNED_BYTE,sampler:i,anisotropy:1}),n=new Od({context:t.context,colorTextures:[r]});this._calculateFramebuffers.push(n);const o=new l(90,1,.1,Math.max(this._radius,1)),a=4===s?180:Math.PI/2,h=Math.PI/2*s,_=(new e.Matrix4).rotateX(a).rotateY(h);o.setMatrix(_);const c=new Map([["u_ModelViewProjectionMatrix",()=>o.getVPMatrix()],["u_DepthMap",()=>this._viewshedPass[s].framebuffer.depthStencilTexture]]);this._calculateCommands.push({painter:t,framebuffer:this._calculateFramebuffers[s].framebuffer,layer:{id:"viewDomeCalculateAnalysis"},geometry:this._geometry,material:{renderState:{blending:e.renderStateEnum.disableBlending,depthTest:e.renderStateEnum.enableDepthTest},_uniforms:c,_shaderSource:new e.ShaderSource({type:"viewDomeCalculateAnalysis"})}});}}_calculateVisibleRatio(t){this._visibleRatio=0;const i=[];for(let s=0;s<this._calculateCommands.length;s++)t.frameState.update({framebuffer:this._calculateFramebuffers[s]}),t.frameState.bindFramebuffer(t.context),t.context.clear({color:e.Color.transparent,depth:1,stencil:0}),t.context.draw(this._calculateCommands[s]),i.push(Fd({x:0,y:2048/e.window.devicePixelRatio,height:2048,width:2048},t.context,this._calculateFramebuffers[s],2048,e.WebGLConstants.UNSIGNED_BYTE,16777216)),t.context.bindFramebuffer.set(null);this._hasCalculated=!0,this.workerID=t.style.dispatcher.send("caculateViewdomeRatio",{data:i},((t,i)=>{this._visibleRatio=i,e.defined(this.ratioCalculatedCallback)&&this.ratioCalculatedCallback(this._visibleRatio);}),void 0);}update(e){if(this._visible&&(this._windowSize.height===e.height&&this._windowSize.width===e.width||(this._windowSize.height=e.height,this._windowSize.width=e.width,this._initialized=!1),!this._initialized)){this._addIndicator(),this._createViewDomeCommand(e),this._createDepthCamera(e),this._createCalculateCommand(e);for(let t=0;t<this._viewshedPass.length;t++)this._viewshedPass[t].render(e);this._initialized=!0;}}render(t){this._visible&&(e.RenderState.applyRenderState(t.context,e.RenderState.fromCache({viewport:{x:0,y:0,width:t.width*t._map.SSAASamples,height:t.height*t._map.SSAASamples}})),this._drawPointIndicator(t),this._sholdCalculateVisibleRatio&&!this._hasCalculated&&this._calculateVisibleRatio(t),t.context.draw(this._viewDomeCommand),e.RenderState.applyRenderState(t.context,e.RenderState.fromCache({viewport:{x:0,y:0,width:t.width,height:t.height}})));}destroy(){this._viewPosition=void 0,this._radius=void 0,this._domeType=void 0,this._visible=void 0,this._visibleAreaColor=void 0,this._hiddenAreaColor=void 0,this._startAngle=void 0,this._endAngle=void 0,this._isClosed=void 0,this._sholdCalculateVisibleRatio=void 0,this._hasCalculated=void 0,this._visibleRatio=void 0,this.ratioCalculatedCallback=void 0,e.defined(this._pointIndicator)&&(this._pointIndicator.removeAll(!0),this._pointIndicator=void 0),this._indicatorSize=void 0,this._indicatorColor=void 0,this._indicatorOutlineColor=void 0,this._indicatorOutlineWidth=void 0,this._initialized=void 0,this._worldMatrix=void 0,e.defined(this._geometry)&&(this._geometry.destroy(),this._geometry=void 0),this._viewDomeCommand.material=void 0,this._viewDomeCommand=void 0;for(let e=0;e<this._calculateFramebuffers;e++)this._calculateFramebuffers[e].destroy(!1);this._calculateFramebuffers=[];for(let e=0;e<this._calculateCommands;e++)this._calculateCommands[e].material=void 0,this._calculateCommands[e]=void 0;this._calculateCommands=[],this._renderTextureMatrix=[];for(let e=0;e<this._viewshedPass;e++)this._viewshedPass[e].destroy(),this._viewshedPass[e]=void 0;return this._viewshedPass=[],e.destroyObject(this)}}class Eg{constructor(){this._viewDomes=[];}get length(){return this._viewDomes.length}add(t,i){if(!(t instanceof Ag))return console.error("The current addition is not of type ViewDome!"),!1;const s=e.defined(i);if(s){if(i<0)throw new Error("index must be greater than or equal to zero.");if(i>this._viewDomes.length)throw new Error("index must be less than or equal to the number of ViewDome.")}return s?this._viewDomes.splice(i,0,t):this._viewDomes.push(t),!0}getById(e){let t;return this._viewDomes.forEach((i=>{i.id===e&&(t=i);})),t}getByIndex(t){if(e.isNumber(t)&&!(t>this.length))return this._viewDomes[t]}indexOf(e){return this._viewDomes.indexOf(e)}remove(e){const t=this.indexOf(e);return -1!==t&&(this._viewDomes.splice(t,1),!0)}removeById(e){const t=this.getById(e);this.remove(t);}removeByIndex(t){if(e.isNumber(t)){if(t<0)throw new Error("index must be greater than or equal to zero.");if(t>this._viewDomes.length)throw new Error("index must be less than or equal to the number of ViewDome.");const e=this.getByIndex(t);this.remove(e);}return !1}removeAll(){for(let e=0;e<this.length;e++)this._viewDomes[e].destroy();this._viewDomes=[];}update(e){for(let t=0;t<this.length;t++)this.getByIndex(t).update(e);}render(t){for(let i=0;i<this._viewDomes.length;i++){const s=this.getByIndex(i);e.defined(s)&&s.render(t);}}serialize(){const t=[];for(let i=0;i<this.length;i++){const s=this.getByIndex(i),r={viewPosition:e.Vector3.pack(s.viewPosition,new Array(3)),radius:s.radius,domeType:s.domeType,visible:s.visible,visibleAreaColor:e.Color.pack(s.visibleAreaColor,new Array(4)),hiddenAreaColor:e.Color.pack(s.hiddenAreaColor,new Array(4)),startAngle:s.startAngle,endAngle:s.endAngle,isClosed:s.isClosed,sholdCalculateVisibleRatio:s.sholdCalculateVisibleRatio,indicatorVisible:s.indicatorVisible,indicatorSize:s.indicatorSize,indicatorColor:e.Color.pack(s.indicatorColor,new Array(4)),indicatorOutlineColor:e.Color.pack(s.indicatorOutlineColor,new Array(4)),indicatorOutlineWidth:s.indicatorOutlineWidth};t.push(r);}return t.length>0?t:void 0}}class Mg extends e.Geometry{constructor(){super(),this.vertices=new Float64Array(633),this.indices=new Uint16Array(408);const t=this.indices;let i=0;t[i++]=0,t[i++]=1,t[i++]=0,t[i++]=21,t[i++]=0,t[i++]=85,t[i++]=0,t[i++]=105;let s=0;for(let e=0;e<5;++e){s++;for(let e=0;e<20;++e)t[i++]=s++,t[i++]=s;}s++;for(let e=0;e<20;++e)for(let e=0;e<5;++e)t[i++]=s,t[i++]=5+s++;this._boundingSphere=void 0,this.type="Viewshed3DHintLineGeometry",this._usedDoublePrecision=!1,this._vertexArray=this._usedDoublePrecision?new e.StructArrayLayout3f3f24:new e.StructArrayLayout3f12,this._indexArray=new e.StructArrayLayout2ui4;for(let e=0;e<this.indices.length/2;e++)this._indexArray.emplaceBack(this.indices[2*e],this.indices[2*e+1]);this.primitiveType=e.WebGLConstants.LINES,this._vertexBuffer=void 0,this._indexBuffer=void 0,this._segmentVector=void 0,this.needUpdate=!0,this._ready=!1;}updatePositions(t){const i=t.verticalFov,s=t.distance,r=t.modelMatrix,n=this.vertices,o=e.CONSTS.CesiumMath.toRadians(t.horizontalFov),a=e.CONSTS.CesiumMath.toRadians(i),l=s*Math.tan(.5*o),h=s*Math.tan(.5*a),_=new e.Vector3(-l,-h,-s),c=new e.Vector3(l,h,0);e.Matrix4.multiplyByPoint(r,_,_),e.Matrix4.multiplyByPoint(r,c,c),this._boundingSphere=e.BoundingSphere.fromCornerPoints(_,c);let d=0;n[d++]=0,n[d++]=0,n[d++]=0;const u=Math.PI-.5*o;let m,p,f=o/4;for(let e=0;e<5;++e){m=u+e*f;const t=h/(s/Math.cos(m)),i=Math.atan(t),r=-i,o=i/10;for(let e=0;e<21;++e)p=r+e*o,n[d++]=s*Math.cos(p)*Math.sin(m),n[d++]=s*Math.sin(p),n[d++]=s*Math.cos(p)*Math.cos(m);}f=o/20;for(let e=0;e<21;++e){m=u+e*f;const t=h/(s/Math.cos(m)),i=Math.atan(t),r=-i,o=i/2;for(let e=0;e<5;++e)p=r+e*o,n[d++]=s*Math.cos(p)*Math.sin(m),n[d++]=s*Math.sin(p),n[d++]=s*Math.cos(p)*Math.cos(m);}this.emplaceVertexBufferOfLines();}update(t){if(this.needUpdate&&t.painter){this.needUpdate=!1;const i=t.painter.context;e.defined(this._vertexBuffer)&&this._vertexBuffer.destroy(),this._vertexBuffer=i.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?ju.members:Xu.members,!0),this._indexBuffer=i.createIndexBuffer(this._indexArray,!1),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/2),this._ready=!0;}}destroy(){super.destroy(),this.vertices=void 0,this.indices=void 0,this._boundingSphere=void 0,this.type=void 0,this._vertexArray=void 0,this._indexBuffer=void 0,this._segmentVector=void 0,this._indexArray=void 0,this.primitiveType=void 0,this._vertexBuffer=void 0,this.needUpdate=void 0,this._ready=void 0;}}class Pg{constructor(t){if(t=e.defined(t)?t:{},e.defined(t.viewerPosition)&&!(t.viewerPosition instanceof e.Vector3))throw new Error("viewerPosition is not type of Vector3!");if(this._viewerPosition=e.defaultValue(t.viewerPosition,new e.Vector3(0,0,0)),e.defined(t.direction)&&(t.direction>360||t.direction<0))throw new Error("direction should be between 0 and 360!");if(this._direction=e.defaultValue(t.direction,0),e.defined(t.pitch)&&(t.pitch>180||t.pitch<0))throw new Error("pitch should be between 0 and 180!");if(this._pitch=e.defaultValue(t.pitch,90),e.defined(t.horizontalFov)&&(t.horizontalFov>180||t.horizontalFov<0))throw new Error("horizontalFov should be between 0 and 180!");if(this._horizontalFov=e.defaultValue(t.horizontalFov,60),e.defined(t.verticalFov)&&(t.verticalFov>180||t.verticalFov<0))throw new Error("horizontalFov should be between 0 and 180!");if(this._verticalFov=e.defaultValue(t.verticalFov,60),e.defined(t.distance)&&t.distance<=0)throw new Error("distance should be greater than 0!");if(this._distance=e.defaultValue(t.distance,100),e.defined(t.visibleAreaColor)&&!(t.visibleAreaColor instanceof e.Color)&&"string"!=typeof t.visibleAreaColor)throw new Error("visibleAreaColor type must be Color or String!");if(this._visibleAreaColor=e.Color.parse(e.defaultValue(t.visibleAreaColor,new e.Color(0,1,0,.3))),e.defined(t.hiddenAreaColor)&&!(t.hiddenAreaColor instanceof e.Color)&&"string"!=typeof t.hiddenAreaColor)throw new Error("hiddenAreaColor type must be Color or String!");if(this._hiddenAreaColor=e.Color.parse(e.defaultValue(t.hiddenAreaColor,new e.Color(1,0,0,.3))),e.defined(t.lineColor)&&!(t.lineColor instanceof e.Color)&&"string"!=typeof t.lineColor)throw new Error("lineColor type must be Color  or String!");this._lineColor=e.Color.parse(e.defaultValue(t.lineColor,new e.Color(1,1,1,1))),this._aspectRatio=this._calculateAspectRatio(),this._targetPoint=new e.Vector3(0,0,0),this._modelMatrix=new e.Matrix4,this._hintLine=void 0,this._lineVisible=e.defaultValue(t.lineVisible,!0),this._hintLineUpdated=!1,this._cameraUpdated=!1,this._depthCamera=void 0,this.viewshedPass=void 0,this._initialized=!1,this._visible=!1,this._currentFrustum=new e.Vector2,this._textureViewMatrix=new e.Matrix4,this._textureProjMatrix=new e.Matrix4,this._sceneDepthTexture=void 0,this._analysisCommand=void 0,this._mixDrawCommand=void 0,this._resultFrameBuffer=[],this._resultTextures=[],this._lastResultTexture=void 0,this.id=e.uuid(),this._mainCamera=void 0;}get direction(){return this._direction}set direction(t){e.isNumber(t)&&(this._direction=t,this._direction=(this._direction>=0?this._direction:this._direction+=360)<360?this._direction:this._direction-=360,this._cameraUpdated=!1,this._hintLineUpdated=!1);}get distance(){return this._distance}set distance(t){e.isNumber(t)&&(this._distance=t,this._cameraUpdated=!1,this._hintLineUpdated=!1);}get hiddenAreaColor(){return this._hiddenAreaColor}set hiddenAreaColor(t){(t instanceof e.Color||"string"==typeof t)&&(this._hiddenAreaColor=e.Color.parse(t));}get horizontalFov(){return this._horizontalFov}set horizontalFov(t){e.isNumber(t)&&t>0&&t<180&&(this._horizontalFov=t,this._calculateAspectRatio(),this._cameraUpdated=!1,this._hintLineUpdated=!1);}get lineColor(){return this._lineColor}set lineColor(t){(t instanceof e.Color||"string"==typeof t)&&(this._lineColor=e.Color.parse(t),e.defined(this._hintLine)&&(this._hintLine._material.destroy(),this._hintLine._material=void 0,this._hintLine._material=e.StandardMaterial.fromType("Color",{color:this._lineColor,lightingModel:e.LightingModelType.NONE})));}get lineVisible(){return this._lineVisible}set lineVisible(t){e.isBoolean(t)?this._lineVisible=t:console.error("lineVisible must be a boolean value");}get pitch(){return this._pitch}set pitch(t){e.isNumber(t)&&e.isNumber(t)&&t>=0&&t<=180&&(this._pitch=t,this._cameraUpdated=!1,this._hintLineUpdated=!1);}get verticalFov(){return this._verticalFov}set verticalFov(t){e.isNumber(t)&&t>0&&t<180&&(this._verticalFov=t,this._calculateAspectRatio(),this._cameraUpdated=!1,this._hintLineUpdated=!1);}get viewerPosition(){return this._viewerPosition}set viewerPosition(t){t instanceof e.Vector3&&(this._viewerPosition=t,this._cameraUpdated=!1,this._hintLineUpdated=!1);}get visibleAreaColor(){return this._visibleAreaColor}set visibleAreaColor(t){(t instanceof e.Color||"string"==typeof t)&&(this._visibleAreaColor=e.Color.parse(t));}_calculateAspectRatio(){this._aspectRatio=Math.tan(.5*this._horizontalFov*e.CONSTS.CesiumMath.RADIANS_PER_DEGREE)/Math.tan(.5*this._verticalFov*e.CONSTS.CesiumMath.RADIANS_PER_DEGREE);}_initialize(t){e.defined(this._depthCamera)||(this._depthCamera=new l(this._verticalFov,this._aspectRatio,.001*this._distance,this._distance)),e.defined(this.viewshedPass)||(this.viewshedPass=new Sg({camera:this._depthCamera,context:t.context,width:2048,height:2048,passType:e.RenderPassConsts.VIEWSHED_PASS})),this._initialized=!0;}setTargetPoint(t){this._distance=e.Vector3.distance(e.Vector3.fromDegrees(this._viewerPosition.x,this._viewerPosition.y,this._viewerPosition.z),e.Vector3.fromDegrees(t.x,t.y,t.z)),this._distance=this._distance<1?1:this._distance;const i=new e.Vector3,s=e.Transforms.eastNorthUpToFixedFrame(e.Vector3.fromDegrees(this._viewerPosition.x,this._viewerPosition.y,this._viewerPosition.z));e.Matrix4.inverse(s,s),e.Matrix4.multiplyByPoint(s,e.Vector3.fromDegrees(t.x,t.y,t.z),i),e.Vector3.normalize(i,i),this._direction=e.CONSTS.CesiumMath.toDegrees(Math.atan2(i.x,i.y)),this._direction=(this._direction>=0?this._direction:this._direction+=360)<360?this._direction:this._direction-=360,this.pitch=e.CONSTS.CesiumMath.toDegrees(Math.asin(i.z))+90;}locateToViewer(){e.defined(this._mainCamera)&&e.defined(this._depthCamera)&&this._mainCamera.setView({destination:this._depthCamera.position,orientation:{direction:this._depthCamera.direction,up:this._depthCamera.up}});}update(t){this._initialized||this._initialize(t),this._cameraUpdated||this._updateCamera(),this._hintLineUpdated||(e.defined(this._hintLine)||(this._hintLine=new e.Primitive({geometry:new Mg,material:e.StandardMaterial.fromType("Color",{color:this._lineColor,lightingModel:e.LightingModelType.NONE}),name:"Viewshed3DHintLine",modelMatrix:this._modelMatrix})),this._updateHintLine(t)),this._mainCamera=t.transform.activeCamera,this._visible&&(e.Matrix4.multiply(this._textureViewMatrix,t.transform.activeCamera.projectionMatrix,t.transform.activeCamera.getViewMatrix()),e.Matrix4.inverse(this._textureViewMatrix,this._textureViewMatrix),e.Matrix4.multiply(this._textureViewMatrix,this._depthCamera.getViewMatrix(),this._textureViewMatrix),e.Matrix4.clone(this._depthCamera.projectionMatrix,this._textureProjMatrix),this.viewshedPass.render(t));}_updateHintLine(t){this._hintLine._geometry.needUpdate=!0,this._hintLine._geometry.updatePositions({horizontalFov:this._horizontalFov,verticalFov:this._verticalFov,distance:this._distance,modelMatrix:this._modelMatrix}),this._hintLine.setMatrix(this._modelMatrix),this._hintLine.updateMatrixWorld(!0),this._hintLine._modelMatrix=this._modelMatrix,t.transform.activeCamera.frustumCrate.cullingVolume.computeVisibility(this._hintLine._geometry._boundingSphere)!==e.INTERSECTION.OUTSIDE?(this._visible=!0,this._hintLineUpdated=!0):this._visible=!1;}_updateCamera(){const t=e.Transforms.headingPitchRollToFixedFrame(e.Vector3.fromDegrees(this._viewerPosition.x,this._viewerPosition.y,this._viewerPosition.z),new e.HeadingPitchRoll(e.CONSTS.CesiumMath.toRadians(this.direction),e.CONSTS.CesiumMath.toRadians(this.pitch),0)),i=Math.tan(.5*this._horizontalFov*e.CONSTS.CesiumMath.RADIANS_PER_DEGREE)/Math.tan(.5*this._verticalFov*e.CONSTS.CesiumMath.RADIANS_PER_DEGREE);this._depthCamera.updatePerspectiveOptions({fov:this._verticalFov,aspect:i,near:.1,far:this.distance}),this._depthCamera.setMatrix(t),this._modelMatrix=t,this._cameraUpdated=!0,e.defined(this.viewshedPass)&&(this.viewshedPass.camera=this._depthCamera);}render(t){const i=t.width,s=t.height;if(0===this._resultTextures.length||this._resultTextures[0].width!=i||this._resultTextures[0].height!=s){this._resultTextures=[],this._resultFrameBuffer=[];const r=new e.Sampler({minificationFilter:e.TextureMinificationFilter.NEAREST,magnificationFilter:e.TextureMagnificationFilter.NEAREST});for(let n=0;n<2;++n){const n=new e.Texture({context:t.context,width:i,height:s,minFilter:e.WebGLConstants.NEAREST,magFilter:e.WebGLConstants.NEAREST,pixelFormat:e.PixelFormat.RGBA,pixelDatatype:e.PixelDatatype.UNSIGNED_BYTE,sampler:r,anisotropy:1});this._resultTextures.push(n);const o=new Od({context:t.context,colorTextures:[n]});this._resultFrameBuffer.push(o);}}const r=t.context.bindFramebuffer.get();t.frameState.update({framebuffer:this._resultFrameBuffer[0]}),t.frameState.bindFramebuffer(t.context),t.context.clear({color:e.Color.black}),this._lastResultTexture=this._resultTextures[0],this._doAnalysis(this,t),e.RenderState.applyRenderState(t.context,e.RenderState.fromCache({viewport:{x:0,y:0,width:i*t._map.SSAASamples,height:s*t._map.SSAASamples}})),t.frameState.update({framebuffer:null}),t.frameState.bindFramebuffer(t.context),t.context.bindFramebuffer.set(r),e.defined(this._mixDrawCommand)||(this._mixDrawCommand=this._createMixCommand(this,t)),t.context.draw(this._mixDrawCommand),this._lineVisible&&(this._hintLine.update(t,t.frameState,{}),t.context.draw({painter:t,framebuffer:t.mainPass.framebuffer.framebuffer,layer:{id:"Viewshed3DHintLine"},geometry:this._hintLine._geometry,material:this._hintLine._material})),e.RenderState.applyRenderState(t.context,e.RenderState.fromCache({viewport:{x:0,y:0,width:i,height:s}}));}_doAnalysis(t,i){if(!this._visible)return;const s=this._resultFrameBuffer[1];i.frameState.update({framebuffer:s}),i.frameState.bindFramebuffer(i.context),i.context.clear({color:e.Color.black}),e.defined(this._analysisCommand)||(this._analysisCommand=this._createAnalysisCommand(t,this,i)),t._analysisCommand.framebuffer=s.framebuffer,i.context.draw(t._analysisCommand),this._lastResultTexture=s._colorTextures[0];}_createAnalysisCommand(t,i,s){const r=new Map([["u_DepthTexture",()=>s.depthPass.framebuffer.getColorTexture(0).bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE)],["u_ViewshedDepthTexture",()=>t.viewshedPass.framebuffer.depthStencilTexture],["u_textureViewMatrix",()=>t._textureViewMatrix],["u_textureProjMatrix",()=>t._textureProjMatrix],["u_farDist",()=>t._distance],["u_ModelViewProjectionMatrix",()=>(new e.Matrix4).ortho({left:0,right:s.context.drawingBufferWidth,bottom:s.context.drawingBufferHeight,top:0,near:0,far:1})],["u_World",()=>new e.Vector2(s.context.drawingBufferWidth,s.context.drawingBufferHeight)],["u_CurrentFrustum",()=>(t._currentFrustum.x=s.transform.near,t._currentFrustum.y=s.transform.far,t._currentFrustum)]]);return {painter:s,framebuffer:void 0,layer:{id:"viewshedAnalysis"},geometry:new vu(s),material:{renderState:e.RenderState.fromCache({depthTest:{enabled:!1},depthMask:!1}),_uniforms:r,_shaderSource:new e.ShaderSource({type:"viewshedAnalysis"})}}}_createMixCommand(t,i){const s=new Map([["u_resultTexture",()=>t._lastResultTexture],["u_visibleAreaColor",()=>e.Vector4.fromColor(t._visibleAreaColor,!1)],["u_hiddenAreaColor",()=>e.Vector4.fromColor(t._hiddenAreaColor,!1)],["u_ModelViewProjectionMatrix",()=>(new e.Matrix4).ortho({left:0,right:i.context.drawingBufferWidth,bottom:i.context.drawingBufferHeight,top:0,near:0,far:1})],["u_World",()=>new e.Vector2(i.context.drawingBufferWidth,i.context.drawingBufferHeight)]]);return {painter:i,framebuffer:i.mainPass.framebuffer.framebuffer,layer:{id:"viewshed"},geometry:new vu(i),material:{renderState:{blending:e.renderStateEnum.enableBlending},_uniforms:s,_shaderSource:new e.ShaderSource({type:"viewshedMix"})}}}destroy(){return this._viewerPosition=void 0,this._direction=void 0,this._pitch=void 0,this._horizontalFov=void 0,this._verticalFov=void 0,this._distance=void 0,this._visibleAreaColor=void 0,this._hiddenAreaColor=void 0,this._aspectRatio=void 0,this._targetPoint=void 0,this._modelMatrix=void 0,this._hintLine?.destroy(),this._hintLine=void 0,this._hintLineUpdated=void 0,this._lineColor=void 0,this._cameraUpdated=void 0,this._depthCamera=void 0,this.viewshedPass.destroy(),this.viewshedPass=void 0,this._initialized=void 0,this._visible=void 0,this._textureViewMatrix=void 0,this._textureProjMatrix=void 0,this._sceneDepthTexture=void 0,this._analysisCommand=void 0,this._mixDrawCommand=void 0,this._resultFrameBuffer=void 0,this._resultTextures=void 0,this._lastResultTexture=void 0,e.destroyObject(this)}}class Rg{constructor(e){this._painter=e,this._viewshed3ds=[];}get length(){return this._viewshed3ds.length}add(t,i){if(!(t instanceof Pg))return console.error("The current addition is not of type Viewshed3D!"),!1;const s=e.defined(i);if(s){if(i<0)throw new Error("index must be greater than or equal to zero.");if(i>this._viewshed3ds.length)throw new Error("index must be less than or equal to the number of Viewshed3D.")}return s?this._viewshed3ds.splice(i,0,t):this._viewshed3ds.push(t),!0}getById(e){let t;return this._viewshed3ds.forEach((i=>{i.id===e&&(t=i);})),t}getByIndex(t){if(e.isNumber(t)&&!(t>this.length))return this._viewshed3ds[t]}indexOf(e){return this._viewshed3ds.indexOf(e)}remove(e){const t=this.indexOf(e);return -1!==t&&(this._painter.style.removePrimitive(e._hintLine),this._viewshed3ds.splice(t,1),!0)}removeById(e){const t=this.getById(e);this.remove(t);}removeByIndex(t){if(e.isNumber(t)){if(t<0)throw new Error("index must be greater than or equal to zero.");if(t>this._viewshed3ds.length)throw new Error("index must be less than or equal to the number of Viewshed3D.");const e=this.getByIndex(t);this.remove(e);}return !1}removeAll(){for(let e=0;e<this.length;e++)this._viewshed3ds[e].destroy();this._viewshed3ds=[];}update(e){for(let t=0;t<this.length;t++)this.getByIndex(t).update(e);}render(t){for(let i=0;i<this._viewshed3ds.length;i++){const s=this.getByIndex(i);e.defined(s)&&s.render(t);}}serialize(){const t=[];for(let i=0;i<this.length;i++){const s=this.getByIndex(i),r={viewerPosition:e.Vector3.pack(s.viewerPosition,new Array(3)),direction:s.direction,distance:s.distance,pitch:s.pitch,horizontalFov:s.horizontalFov,verticalFov:s.verticalFov,visibleAreaColor:e.Color.pack(s.visibleAreaColor,new Array(4)),hiddenAreaColor:e.Color.pack(s.hiddenAreaColor,new Array(4)),lineColor:e.Color.pack(s.lineColor,new Array(4))};t.push(r);}return t.length>0?t:void 0}}function Bg(t){return !function(t){return "undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return !1;var e,t,i=new Blob([""],{type:"text/javascript"}),s=URL.createObjectURL(i);try{t=new Worker(s),e=!0;}catch(t){e=!1;}return t&&t.terminate(),URL.revokeObjectURL(s),e}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return !1;var i=t.getImageData(0,0,1,1);return i&&i.width===e.width}()?(void 0===Ig[i=t&&t.failIfMajorPerformanceCaveat]&&(Ig[i]=function(t){var i,s=function(e){var t=document.createElement("canvas"),i=Object.create(Bg.webGLContextAttributes);return i.failIfMajorPerformanceCaveat=e,t.getContext("webgl",i)||t.getContext("experimental-webgl",i)}(t);if(!s)return !1;try{i=s.createShader(e.WebGLConstants.VERTEX_SHADER);}catch(e){return !1}return !(!i||s.isContextLost())&&(s.shaderSource(i,"void main() {}"),s.compileShader(i),!0===s.getShaderParameter(i,e.WebGLConstants.COMPILE_STATUS))}(i)),Ig[i]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var i;}(t)}var Ig={};Bg.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class Dg{constructor(e){this.collection=[],this._map=e;}add(e){this.collection.push(e);}remove(e,t){if(!t)throw new Error("请输入minemap的Map实例化对象！");let i=-1;for(let t=0;t<this.collection.length;t++)this.collection[t].id===e&&(i=t);return -1!=i&&(this.collection[i].destroy(t),this.collection.splice(i,1),!0)}removeAll(){for(let e=0;e<this.collection.length;e++)this.collection[e].destroy(this._map);this.collection=[];}}class Og{constructor(t){this._visibleColor=e.Color.parse(e.defaultValue(t.visibleColor,new e.Color(0,1,0,1))),this._hiddenColor=e.Color.parse(e.defaultValue(t.hiddenColor,new e.Color(1,0,0,1))),this._lineWidth=e.defaultValue(t.lineWidth,1),this._viewerPosition=new e.Vector3(e.defaultValue(t.viewerPosition,[0,0,0])),this._targetPointsMap=new Map,this._targets=[],this.targets=e.defaultValue(t.targets,this._targets),this._barrierPointMap=new Map,this._initialized=!1,this._resultTextures=[],this._mainCameraInvisibleDetection=!!t.mainCameraInvisibleDetection,this._indicatorSize=e.defaultValue(t.indicatorSize,10),this._indicatorColor=e.Color.parse(t.indicatorColor)||new e.Color(.5,0,0,1),this._indicatorOutlineColor=e.Color.parse(t.indicatorOutlineColor)||new e.Color(0,.6,1,.5),this._indicatorOutlineWidth=e.defaultValue(t.indicatorOutlineWidth,2),this.id=e.uuid();}get targets(){const t=[];return this._targetPointsMap.forEach(((i,s)=>{t.push({name:s,position:e.Vector3.pack(i.position,new Array(3))});})),t}set targets(e){if(e instanceof Array)for(let t=0;t<e.length;t++)this.addTargetPoint(e[t]);}set mainCameraInvisibleDetection(e){this._mainCameraInvisibleDetection=e;}get mainCameraInvisibleDetection(){return this._mainCameraInvisibleDetection}set indicatorSize(e){this._indicatorSize=e,this._addIndicator();}get indicatorSize(){return this._indicatorSize}set indicatorColor(t){this._indicatorColor=e.Color.parse(t),this._addIndicator();}get indicatorColor(){return this._indicatorColor}set indicatorOutlineColor(t){this._indicatorOutlineColor=e.Color.parse(t),this._addIndicator();}get indicatorOutlineColor(){return this._indicatorOutlineColor}set indicatorOutlineWidth(e){this._indicatorOutlineWidth=e,this._addIndicator();}get indicatorOutlineWidth(){return this._indicatorOutlineWidth}_addIndicator(){const t=e.Vector3.fromDegrees(this._viewerPosition.x,this._viewerPosition.y,this._viewerPosition.z);this.rtcModelMatrix=(new e.Matrix4).translate(t),this.rtcPosition=t,e.defined(this._pointIndicator)?(this._pointIndicator.remove(this._pointPrimitive,!0),this._pointPrimitive=new Lh({show:!0,position:t,pixelSize:this._indicatorSize,color:this._indicatorColor,outlineColor:this._indicatorOutlineColor,outlineWidth:this._indicatorOutlineWidth}),this._pointIndicator.add(this._pointPrimitive)):(this._pointIndicator=new kh,this._pointPrimitive=new Lh({show:!0,position:t,pixelSize:this._indicatorSize,color:this._indicatorColor,outlineColor:this._indicatorOutlineColor,outlineWidth:this._indicatorOutlineWidth}),this._pointIndicator.add(this._pointPrimitive));}_initialize(t){this._addIndicator();const i=this._targetPointsMap.values();for(;;){const s=i.next();if(s.done)break;const r=s.value;if(!e.defined(r.camera)){const t=e.Vector3.distance(e.Vector3.fromDegrees(this._viewerPosition.x,this._viewerPosition.y,this._viewerPosition.z),e.Vector3.fromDegrees(r.position.x,r.position.y,r.position.z));r.distance=t,r.camera=new l(60,1,.001*t,t);}e.defined(r.viewshedPass)||(r.viewshedPass=new Sg({camera:r.camera,context:t.context,width:2048,height:2048,passType:e.RenderPassConsts.VIEWSHED_PASS}));}this._initialized=!0;}get viewerPosition(){return this._viewerPosition}set viewerPosition(t){this._viewerPosition=new e.Vector3(t[0],t[1],t[2]);const i=this._targetPointsMap.values();for(;;){const e=i.next();if(e.done)break;e.value.needsUpdate=!0;}this._addIndicator();}set visibleColor(t){this._visibleColor=e.Color.parse(t);}get visibleColor(){return this._visibleColor}set hiddenColor(t){this._hiddenColor=e.Color.parse(t);}get hiddenColor(){return this._hiddenColor}addTargetPoint(t){if(!t.position)throw new Error("当前添加的点位数据为空",t,"method: addTargetPoint");this._targetPointsMap.set(t.name,{name:t.name,position:new e.Vector3(t.position),needsUpdate:!0}),this._initialized=!1;}updateTargetPoint(e){if(this._targetPointsMap.has(e.name)){const t=this._targetPointsMap.get(e.name);t.position=e.position,t.needsUpdate=!0;}}getBarrierPoint(e){return this._barrierPointMap.get(e)}removeTargetPoint(e){const t=this._barrierPointMap.get(e.name);return t?.viewshedPass?.destroy(),this._barrierPointMap.delete(e.name),this._targetPointsMap.delete(e.name)}removeAllTargetPoint(){const e=this._targetPointsMap.values();for(;;){const t=e.next();if(t.done)break;t.value.viewshedPass.destroy();}this._barrierPointMap.clear(),this._targetPointsMap.clear();}update(e){this._initialized||this._initialize(e),this._targetPointsMap.forEach(((t,i)=>{this._updateTargetPointCamera(i),t.viewshedPass.render(e);}));}render(t){const i=t.width,s=t.height;let r=!1;if(0===this._resultTextures.length||this._resultTextures[0].width!=i||this._resultTextures[0].height!=s){this._resultTextures=[],this._resultFrameBuffer=[],r=!0;const n=new e.Sampler({minificationFilter:e.TextureMinificationFilter.NEAREST,magnificationFilter:e.TextureMagnificationFilter.NEAREST});for(let r=0;r<2;++r){const r=new e.Texture({context:t.context,width:i,height:s,minFilter:e.WebGLConstants.NEAREST,magFilter:e.WebGLConstants.NEAREST,pixelFormat:e.PixelFormat.RGBA,pixelDatatype:e.PixelDatatype.UNSIGNED_BYTE,sampler:n,anisotropy:1});this._resultTextures.push(r);const o=new Od({context:t.context,colorTextures:[r]});this._resultFrameBuffer.push(o);}}const n=t.context.bindFramebuffer.get();t.frameState.update({framebuffer:this._resultFrameBuffer[0]}),t.frameState.bindFramebuffer(t.context),t.context.clear({color:e.Color.black}),this._lastResultTexture=this._resultTextures[0];const o=this._targetPointsMap.values();t.frameState.update({framebuffer:this._resultFrameBuffer[1]}),t.frameState.bindFramebuffer(t.context),t.context.clear({color:e.Color.transparent});let a=!1;for(;;){const e=o.next();if(e.done)break;a=this._doAnalysis(e.value,t)||a;}e.RenderState.applyRenderState(t.context,e.RenderState.fromCache({viewport:{x:0,y:0,width:i*t._map.SSAASamples,height:s*t._map.SSAASamples}})),a&&(t.frameState.update({framebuffer:null}),t.frameState.bindFramebuffer(t.context),t.context.bindFramebuffer.set(n),e.defined(this._mixDrawCommand)&&!r||(this._mixDrawCommand=this._createMixCommand(this,t)),t.context.draw(this._mixDrawCommand)),this._pointIndicator.update(t);const l=this._pointIndicator.getTranslucentPrimitives();for(let e=0;e<l.length;e++)l[e].update(t,t.frameState,{}),l[e].framebuffer=t.mainPass.framebuffer.framebuffer;for(let e=0;e<l.length;e++)l[e].render(t,{id:"sightline-indicator"},t.frameState),l[e].framebuffer=null;e.RenderState.applyRenderState(t.context,e.RenderState.fromCache({viewport:{x:0,y:0,width:i,height:s}}));}_doAnalysis(t,i){if(e.defined(t._analysisCommand)||(t._analysisCommand=this._createAnalysisCommand(t,i)),i.transform.activeCamera.frustumCrate.cullingVolume.computeVisibility(t._analysisCommand.geometry.boundingSphere.clone().transform(this.rtcModelMatrix))===e.INTERSECTION.OUTSIDE)return this._visible=!1,!1;const s=this._resultFrameBuffer[1];return t._analysisCommand.framebuffer=s.framebuffer,i.context.draw(t._analysisCommand),this._lastResultTexture=s._colorTextures[0],!0}_createAnalysisCommand(t,i){const s=this,r=new Map([["u_DepthTexture",()=>i.depthPass.framebuffer.getColorTexture(0).bind(e.WebGLConstants.LINEAR,e.WebGLConstants.CLAMP_TO_EDGE)],["u_ViewshedDepthTexture",()=>t.viewshedPass.framebuffer.depthStencilTexture],["u_HiddenColor",()=>e.Vector4.fromColor(s._hiddenColor,!1)],["u_VisibleColor",()=>e.Vector4.fromColor(s._visibleColor,!1)],["u_ModelViewProjectionMatrix",()=>i.transform.activeCamera.getVPMatrix().multiplyRight(s.rtcModelMatrix)],["u_ModelViewProjectionMatrixOnViewshed",()=>t.camera.getVPMatrix().multiplyRight(s.rtcModelMatrix)],["u_MainCameraDetection",()=>s._mainCameraInvisibleDetection]]),n=e.Vector3.fromDegreesArrayHeights([...this._viewerPosition,...t.position]),o=new qu({positions:n,width:10,arcType:e.ARCTYPE.NONE,referenceCenter:new e.Vector3(s.rtcPosition)});return o.update({painter:i}),{painter:i,framebuffer:void 0,layer:{id:"sightlineAnalysis"},geometry:o,material:{renderState:{depthTest:{enabled:!1},depthMask:!1,blending:e.renderStateEnum.disableBlending},_uniforms:r,_shaderSource:new e.ShaderSource({type:"sightlineAnalysis"})}}}_createMixCommand(t,i){const s=this,r=new Map([["u_resultTexture",()=>s._lastResultTexture],["u_ModelViewProjectionMatrix",()=>(new e.Matrix4).ortho({left:0,right:i.context.drawingBufferWidth,bottom:i.context.drawingBufferHeight,top:0,near:0,far:1})],["u_World",()=>new e.Vector2(i.context.drawingBufferWidth,i.context.drawingBufferHeight)],["u_HiddenColor",()=>e.Vector4.fromColor(s._hiddenColor,!1)],["u_VisibleColor",()=>e.Vector4.fromColor(s._visibleColor,!1)]]);return {painter:i,framebuffer:i.mainPass.framebuffer.framebuffer,layer:{id:"sightlineMix"},geometry:new vu(i),material:{renderState:{blending:e.renderStateEnum.enableBlending},_uniforms:r,_shaderSource:new e.ShaderSource({type:"sightlineMix",defines:{LINE_WIDTH:this._lineWidth}})}}}_updateTargetPointCamera(t){const i=this._targetPointsMap.get(t),s=this._getHeadingPitch(i.position),r=e.Vector3.fromDegrees(this._viewerPosition.x,this._viewerPosition.y,this._viewerPosition.z),n=e.Transforms.headingPitchRollToFixedFrame(r,new e.HeadingPitchRoll(e.CONSTS.CesiumMath.toRadians(s.x),e.CONSTS.CesiumMath.toRadians(s.y),0)),o=e.Vector3.distance(r,e.Vector3.fromDegrees(i.position.x,i.position.y,i.position.z));i.distance=o,i.camera.updatePerspectiveOptions({near:.5,far:o<=1?1:o}),i.camera.setMatrix(n);}_getHeadingPitch(t){const i=new e.Vector3,s=e.Transforms.eastNorthUpToFixedFrame(e.Vector3.fromDegrees(this._viewerPosition.x,this._viewerPosition.y,this._viewerPosition.z));e.Matrix4.inverse(s,s),e.Matrix4.multiplyByPoint(s,e.Vector3.fromDegrees(t.x,t.y,t.z),i),e.Vector3.normalize(i,i);let r=e.CONSTS.CesiumMath.toDegrees(Math.atan2(i.x,i.y));r=(r>=0?r:r+=360)<360?r:r-=360;const n=e.CONSTS.CesiumMath.toDegrees(Math.asin(i.z))+90;return new e.Vector2(r,n)}destroy(){this.removeAllTargetPoint(),this._mixDrawCommand&&(this._mixDrawCommand.geometry.destroy(),this._mixDrawCommand.material=void 0),this._pointIndicator.removeAll(!0);for(let e=0;e<this._resultFrameBuffer.length;e++)this._resultFrameBuffer[e].destroy();this._resultFrameBuffer=[];for(let e=0;e<this._resultTextures.length;e++)this._resultTextures[e].destroy();this._resultTextures=[],this._visibleColor=null,this._hiddenColor=null,this._viewerPosition=null;}}class Lg{constructor(e){this._painter=e,this._sightlines=[];}get length(){return this._sightlines.length}add(t,i){if(!(t instanceof Og))return console.error("The current addition is not of type Sightline!"),!1;const s=e.defined(i);if(s){if(i<0)throw new Error("index must be greater than or equal to zero.");if(i>this._sightlines.length)throw new Error("index must be less than or equal to the number of Sightline.")}return s?this._sightlines.splice(i,0,t):this._sightlines.push(t),!0}getById(e){let t;return this._sightlines.forEach((i=>{i.id===e&&(t=i);})),t}getByIndex(t){if(e.isNumber(t)&&!(t>this.length))return this._sightlines[t]}indexOf(e){return this._sightlines.indexOf(e)}remove(e){const t=this.indexOf(e);return -1!==t&&(this._sightlines.splice(t,1),e.destroy(),!0)}removeById(e){const t=this.getById(e);this.remove(t);}removeByIndex(t){if(e.isNumber(t)){if(t<0)throw new Error("index must be greater than or equal to zero.");if(t>this._sightlines.length)throw new Error("index must be less than or equal to the number of Sightline.");const e=this.getByIndex(t);this.remove(e);}return !1}removeAll(){for(;this.length>0;)this.removeByIndex(0);this._sightlines=[];}update(e){for(let t=0;t<this.length;t++)this.getByIndex(t).update(e);}render(e){for(let t=0;t<this._sightlines.length;t++)this.getByIndex(t).render(e);}serialize(){const t=[];for(let i=0;i<this.length;i++){const s=this.getByIndex(i),r={viewerPosition:e.Vector3.pack(s.viewerPosition,new Array(3)),targets:s.targets,visibleColor:e.Color.pack(s.visibleColor,new Array(4)),hiddenColor:e.Color.pack(s.hiddenColor,new Array(4)),indicatorSize:s.indicatorSize,indicatorColor:e.Color.pack(s.indicatorColor,new Array(4)),indicatorOutlineColor:e.Color.pack(s.indicatorOutlineColor,new Array(4)),indicatorOutlineWidth:s.indicatorOutlineWidth,mainCameraInvisibleDetection:s.mainCameraInvisibleDetection};t.push(r);}return t.length>0?t:void 0}}class Vg extends cg{constructor(t){if(t=e.defined(t)?t:{},e.defined(t.validColor)&&!(t.validColor instanceof e.Color)&&"string"!=typeof t.validColor)throw new Error("'validColor' type must be Color or String!");const i=e.Color.parse(e.defaultValue(t.validColor,new e.Color(0,1,0,1)));if(e.defined(t.validOpacity)&&!e.isNumber(t.validOpacity))throw new Error("'validOpacity' option must be a number!");const s=e.defaultValue(t.validOpacity,.5);if(e.defined(t.validOutlineColor)&&!(t.validOutlineColor instanceof e.Color)&&"string"!=typeof t.validOutlineColor)throw new Error("'validOutlineColor' type must be Color or String!");const r=e.Color.parse(e.defaultValue(t.validOutlineColor,new e.Color(0,0,0,1)));if(e.defined(t.validOutlineOpacity)&&!e.isNumber(t.validOutlineOpacity))throw new Error("'validOutlineOpacity' option must be a number!");const n=e.defaultValue(t.validOutlineOpacity,1);if(e.defined(t.invalidColor)&&!(t.invalidColor instanceof e.Color)&&"string"!=typeof t.invalidColor)throw new Error("'invalidColor' type must be Color or String!");if(t.color=e.Color.parse(e.defaultValue(t.invalidColor,new e.Color(1,0,0,1))),e.defined(t.invalidOpacity)&&!e.isNumber(t.invalidOpacity))throw new Error("'invalidOpacity' option must be a number!");if(t.opacity=e.defaultValue(t.invalidOpacity,.5),e.defined(t.baseHeight)&&!e.isNumber(t.baseHeight))throw new Error("'baseHeight' must be a number");const o=e.defaultValue(t.baseHeight,void 0);if(e.defined(t.limitHeight)&&!e.isNumber(t.limitHeight))throw new Error("'limitHeight' must be a number");const a=e.defaultValue(t.limitHeight,0);if(e.defined(t.positions)){if(!(t.positions instanceof Array))throw new Error("'positions' is not type of Array!");if(0!==t.positions.length&&t.positions.length<3)throw new Error("'positions' length must greater than 2!")}const l=e.defaultValue(t.positions,[]);if(e.defined(t.extrudeValidArea)&&!e.isBoolean(t.extrudeValidArea))throw new Error("'extrudeValidArea' option must be true or false!");const h=e.defaultValue(t.extrudeValidArea,!0);super(t),this._extrudeValidArea=h,this._validColor=i,this._validOpacity=s,this._validMaterial=e.StandardMaterial.fromType("Color",{color:this._validColor,opacity:this._validOpacity,lightingModel:e.LightingModelType.NONE,doubleSided:!0}),this._validGeometryUpdated=!1,this._validMaterialUpdated=!1,this._validOutlineColor=r,this._validOutlineOpacity=n,this._validOutlineMaterial=e.StandardMaterial.fromType("Color",{color:this._validOutlineColor,opacity:this._validOutlineOpacity,lightingModel:e.LightingModelType.NONE,doubleSided:!0}),this._validOutlineGeometryUpdated=!1,this._validOutlineMaterialUpdated=!1,this._baseHeight=o,this._limitHeight=a,this.positions=l;}get invalidColor(){return this._color}set invalidColor(e){this.color=e;}get invalidOpacity(){return this._opacity}set invalidOpacity(e){this.opacity=e;}get validColor(){return this._validColor}set validColor(t){if(!(t instanceof e.Color||"string"==typeof t))throw new Error("'validColor' type must be Color or String!");this._validColor=e.Color.parse(t),this._validMaterialUpdated=!1;}get validOpacity(){return this._validOpacity}set validOpacity(t){if(!e.isNumber(t))throw new Error("'validOpacity' option must be a number!");this._validOpacity=t,this._validMaterialUpdated=!1;}get validOutlineColor(){return this._validOutlineColor}set validOutlineColor(t){if(!(t instanceof e.Color||"string"==typeof t))throw new Error("'validOutlineColor' type must be Color or String!");this._validOutlineColor=e.Color.parse(t),this._validOutlineMaterialUpdated=!1;}get validOutlineOpacity(){return this._validOutlineOpacity}set validOutlineOpacity(t){if(!e.isNumber(t))throw new Error("'validOutlineOpacity' option must be a number!");this._validOutlineOpacity=t,this._validOutlineMaterialUpdated=!1;}get baseHeight(){return this._baseHeight}set baseHeight(t){if(e.isNumber(t))this._baseHeight=t,this.geometry=Vg.createInvalidArea(this._positions,this._baseHeight,this._limitHeight),this._createValidArea();else {if(t)throw new Error("baseHeight must be a number or empty");if(0===this._positions.length)this._baseHeight=void 0;else {let t=+Number.MAX_VALUE;for(let i=0;i<this._positions.length;i++){const s=e.Cartographic.fromVector3(this._positions[i]).height;t=Math.min(t,s);}this._baseHeight=t;}this.geometry=Vg.createInvalidArea(this._positions,this._baseHeight,this._limitHeight),this._createValidArea();}}get positions(){return this._positions}set positions(t){if(!(t instanceof Array))throw new Error("positions is not type of Array!");if(0!==t.length&&t.length<3)throw new Error("positions' length must greater than 2!");if(0!==t.length&&!this._baseHeight){let i=+Number.MAX_VALUE;for(let s=0;s<t.length;s++){const r=e.Cartographic.fromVector3(t[s]).height;i=Math.min(i,r);}this._baseHeight=i;}this._positions=t,this.geometry=Vg.createInvalidArea(this._positions,this._baseHeight,this._limitHeight),this._createValidArea();}get limitHeight(){return this._limitHeight}set limitHeight(t){if(!e.isNumber(t))throw new Error("limitHeight must be a number");this._limitHeight=t,this.geometry=Vg.createInvalidArea(this._positions,this._baseHeight,this._limitHeight),this._createValidArea();}get extrudeValidArea(){return this._extrudeValidArea}set extrudeValidArea(t){if(!e.isBoolean(t))throw new Error("'extrudeValidArea' option must be true or false!");this._extrudeValidArea=t,this._createValidArea();}_createValidArea(){const{polygon:e,outline:t}=Vg.createValidArea(this._positions,this._baseHeight,this._limitHeight,this._extrudeValidArea);this._validGeometry=e,this._validGeometryUpdated=!1,this._validOutlineGeometry=t,this._validOutlineGeometryUpdated=!1;}update(){super.update(),this._validArea?(this._validGeometryUpdated||(this._validArea._geometry=this._validGeometry,this._validGeometryUpdated=!0),this._validMaterialUpdated||(this._validMaterial.updateProperty({color:this._validColor,opacity:this._validOpacity}),this._validMaterialUpdated=!0)):(this._validArea=new e.Primitive({geometry:this._validGeometry,material:this._validMaterial}),this._validGeometryUpdated=!0,this._validMaterialUpdated=!0),this._validOutline?(this._validOutlineGeometryUpdated||(this._validOutline._geometry=this._validOutlineGeometry,this._validOutlineGeometryUpdated=!0),this._validOutlineMaterialUpdated||(this._validOutlineMaterial.updateProperty({color:this._validOutlineColor,opacity:this._validOutlineOpacity}),this._validOutlineMaterialUpdated=!0)):(this._validOutline=new e.Primitive({geometry:this._validOutlineGeometry,material:this._validOutlineMaterial}),this._validOutlineGeometryUpdated=!0,this._validOutlineMaterialUpdated=!0);}render(e){super.render(e),this._enabled&&(this._validArea.framebuffer=e.mainPass.framebuffer.framebuffer,this._validArea.update(e,e.frameState),this._validArea.render(e,{id:"validArea"},e.frameState),this._validArea.framebuffer=null,this._validOutline.framebuffer=e.mainPass.framebuffer.framebuffer,this._validOutline.update(e,e.frameState),this._validOutline.render(e,{id:"validOutline"},e.frameState),this._validOutline.framebuffer=null);}destroy(){super.destroy(),this._positions=void 0,this._baseHeight=void 0,this._limitHeight=void 0,this._validArea&&this._validArea instanceof e.Primitive?this._validArea.destroy():(this._validGeometry&&this._validGeometry instanceof e.Geometry&&this._validGeometry.destroy(),this._validMaterial&&this._validMaterial instanceof e.Material&&this._validMaterial.destroy()),this._validOutline&&this._validOutline instanceof e.Primitive?this._validOutline.destroy():(this._validOutlineGeometry&&this._validOutlineGeometry instanceof e.Geometry&&this._validOutlineGeometry.destroy(),this._validOutlineMaterial&&this._validOutlineMaterial instanceof e.Material&&this._validOutlineMaterial.destroy()),this._extrudeValidArea=void 0,this._validColor=void 0,this._validOpacity=void 0,this._validArea=void 0,this._validGeometry=void 0,this._validMaterial=void 0,this._validGeometryUpdated=void 0,this._validMaterialUpdated=void 0,this._validOutlineColor=void 0,this._validOutlineOpacity=void 0,this._validOutlineGeometry=void 0,this._validOutlineMaterial=void 0,this._validOutlineGeometryUpdated=void 0,this._validOutlineMaterialUpdated=void 0;}static createValidArea(t,i,s,r=!0){if(0===t.length)return {polygon:new e.PolygonGeometry({polygonHierarchy:{positions:[]},arcType:e.ARCTYPE.GEODESIC}),outline:new ug({polygonHierarchy:{positions:[]},arcType:e.ARCTYPE.GEODESIC})};if(r){let r=[];for(let s=0;s<t.length;s++){const n=e.Transforms.cartesian3ToCartographic(t[s]);r=r.concat([n[0],n[1],i]);}return r=e.Vector3.fromDegreesArrayHeights(r),{polygon:new e.PolygonGeometry({polygonHierarchy:{positions:r},perPositionHeight:!0,extrudedHeight:i+s,arcType:e.ARCTYPE.GEODESIC}),outline:new ug({polygonHierarchy:{positions:r},perPositionHeight:!0,extrudedHeight:i+s,arcType:e.ARCTYPE.GEODESIC})}}return {polygon:new e.PolygonGeometry({polygonHierarchy:{positions:t},height:i+s,arcType:e.ARCTYPE.GEODESIC}),outline:new ug({polygonHierarchy:{positions:t},height:i+s,arcType:e.ARCTYPE.GEODESIC})}}static createInvalidArea(t,i,s){if(0===t.length)return new e.PolygonGeometry({polygonHierarchy:{positions:[]},arcType:e.ARCTYPE.GEODESIC});let r=[];for(let n=0;n<t.length;n++){const o=e.Transforms.cartesian3ToCartographic(t[n]);r=r.concat([o[0],o[1],i+s]);}return r=e.Vector3.fromDegreesArrayHeights(r),new e.PolygonGeometry({polygonHierarchy:{positions:r},perPositionHeight:!0,extrudedHeight:1e4,arcType:e.ARCTYPE.GEODESIC})}}class Ng{constructor(e){this._painter=e,this._highlights=[];}get length(){return this._highlights.length}add(t,i){if(!(t instanceof cg))return console.error("The current addition is not of type Highlight!"),!1;const s=e.defined(i);if(s){if(i<0)throw new Error("index must be greater than or equal to zero.");if(i>this._highlights.length)throw new Error("index must be less than or equal to the number of Highlight.")}return s?this._highlights.splice(i,0,t):this._highlights.push(t),!0}getById(e){let t;return this._highlights.forEach((i=>{i.id===e&&(t=i);})),t}getByIndex(t){if(e.isNumber(t)&&!(t>this.length))return this._highlights[t]}indexOf(e){return this._highlights.indexOf(e)}remove(e){const t=this.indexOf(e);return -1!==t&&(this._highlights.splice(t,1),e.destroy(),!0)}removeById(e){const t=this.getById(e);this.remove(t);}removeByIndex(t){if(e.isNumber(t)){if(t<0)throw new Error("index must be greater than or equal to zero.");if(t>this._highlights.length)throw new Error("index must be less than or equal to the number of Highlight.");const e=this.getByIndex(t);this.remove(e);}return !1}removeAll(){for(;this.length>0;)this.removeByIndex(0);this._highlights=[];}update(e){for(let t=0;t<this.length;t++)this.getByIndex(t).update(e);}render(t){for(let i=0;i<this.length;i++){const s=this.getByIndex(i);e.defined(s)&&s.render(t);}}serialize(){const t=[];for(let i=0;i<this.length;i++){const s=this.getByIndex(i),r=[];for(let t=0;t<s.positions.length;t++)r.push(e.Vector3.pack(s.positions[t],new Array(3)));const n={positions:r,baseHeight:s.baseHeight,limitHeight:s.limitHeight,invalidColor:e.Color.pack(s.invalidColor,new Array(4)),invalidOpacity:s.invalidOpacity,validColor:e.Color.pack(s.validColor,new Array(4)),validOpacity:s.validOpacity,validOutlineColor:e.Color.pack(s.validOutlineColor,new Array(4)),validOutlineOpacity:s.validOutlineOpacity,extrudeValidArea:s.extrudeValidArea,enabled:s.enabled};t[i]=n;}return t.length>0?t:void 0}}let Fg,Gg,kg;function Ug(t,i,s,r){t.radii=new e.Vector3(i,s,r),t.radiiSquared=new e.Vector3(i*i,s*s,r*r),t.radiiToTheFourth=new e.Vector3(i*i*i*i,s*s*s*s,r*r*r*r),t.oneOverRadii=new e.Vector3(0===i?0:1/i,0===s?0:1/s,0===r?0:1/r),t.oneOverRadiiSquared=new e.Vector3(0===i?0:1/(i*i),0===s?0:1/(s*s),0===r?0:1/(r*r)),t.minimumRadius=Math.min(i,s,r),t.maximumRadius=Math.max(i,s,r),t.centerToleranceSquared=e.CONSTS.TRANSFORM.EPSILON1,0!==t.radiiSquared.z&&(t.squaredXOverSquaredZ=t.radiiSquared.x/t.radiiSquared.z),Object.freeze(this);}class Hg{constructor(t=0,i=0,s=0){this._scratchNormal=new e.Vector3,this._scratchK=new e.Vector3,this._scratchPosition=new e.Vector3,this._scratchHeight=new e.Vector3,this._scratchCartesian=new e.Vector3,this._scratchVector=new e.Vector3,Ug(this,t,i,s);}equals(e){return this===e||Boolean(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,t=[0,0,0],i){const s=this._scratchNormal,r=this._scratchK,n=e[2];this.geodeticSurfaceNormalCartographic(e,s,i),r.copy(this.radiiSquared).scale(s);const o=Math.sqrt(s.dot(r));return r.multiplyScalar(1/o),s.multiplyScalar(n),r.add(s),r.to(t)}cartographicToCartesianInRadians(e,t=[0,0,0]){const i=this._scratchNormal,s=this._scratchK,[,,r]=e;this.geodeticSurfaceNormalCartographic(e,i,!0),s.copy(this.radiiSquared).scale(i);const n=Math.sqrt(i.dot(s));return s.scale(1/n),i.scale(r),s.add(i),s.to(t)}cartesianToCartographic(t,i=[0,0,0]){this._scratchCartesian.from(t);const s=this.scaleToGeodeticSurface(this._scratchCartesian,this._scratchPosition);if(!s)return;const r=this.geodeticSurfaceNormal(s,this._scratchNormal),n=this._scratchHeight;n.copy(this._scratchCartesian).subtract(s);const o=Math.atan2(r.y,r.x),a=Math.asin(r.z),l=Math.sign(e.dot(n,this._scratchCartesian))*e.length(n);return e.toCartographicFromRadians([o,a,l],i)}eastNorthUpToFixedFrame(t,i=new e.Matrix4){return e.localFrameToFixedFrame(this,"east","north","up",t,i)}localFrameToFixedFrame(t,i,s,r,n=new e.Matrix4){return e.localFrameToFixedFrame(this,t,i,s,r,n)}geocentricSurfaceNormal(e,t=[0,0,0]){return this._scratchVector.from(e).normalize().to(t)}geodeticSurfaceNormalCartographic(t,i=[0,0,0],s){const r=s?t:e.fromCartographicToRadians(t),n=r[0],o=r[1],a=Math.cos(o);return this._scratchVector.set(a*Math.cos(n),a*Math.sin(n),Math.sin(o)).normalize(),this._scratchVector.to(i)}geodeticSurfaceNormal(e,t=[0,0,0]){return this._scratchVector.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}scaleToGeodeticSurface(t,i){return e.scaleToGeodeticSurface(t,this,i)}scaleToGeocentricSurface(e,t=[0,0,0]){this._scratchPosition.from(e);const i=this._scratchPosition.x,s=this._scratchPosition.y,r=this._scratchPosition.z,n=this.oneOverRadiiSquared,o=1/Math.sqrt(i*i*n.x+s*s*n.y+r*r*n.z);return this._scratchPosition.multiplyScalar(o).to(t)}transformPositionToScaledSpace(e,t=[0,0,0]){return this._scratchPosition.from(e).scale(this.oneOverRadii).to(t)}transformPositionFromScaledSpace(e,t=[0,0,0]){return this._scratchPosition.from(e).scale(this.radii).to(t)}getSurfaceNormalIntersectionWithZAxis(e,t=0,i=[0,0,0]){this._scratchPosition.from(e);const s=this._scratchPosition.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(s)>=this.radii.z-t))return this._scratchPosition.set(0,0,s).to(i)}static fromCartesian3(e,t){return Ug(t,e.x,e.y,e.z),t}static clone(e){return new Hg(e.radii.x,e.radii.y,e.radii.z)}static get WGS84(){return Fg=Fg||new Hg(e.WGS84_RADIUS_X,e.WGS84_RADIUS_Y,e.WGS84_RADIUS_Z),Fg}static get RegularEllipsoid(){return Gg=Gg||new Hg(e.WGS84_RADIUS_X,e.WGS84_RADIUS_Y,e.REGULAR_RADIUS_Z),Gg}static get UNIT_SPHERE(){return kg=kg||new Hg(1,1,1),kg}}class zg{constructor(){}static computePosition(t,i,s,r,n,o,a){const l=i.radiiSquared,h=t.nwCorner,_=t.boundingRectangle;let c=h.latitude-t.granYCos*r+n*t.granXSin;const d=Math.cos(c),u=Math.sin(c),m=l.z*u;let p=h.longitude+r*t.granYSin+n*t.granXCos;const f=d*Math.cos(p),g=d*Math.sin(p),y=l.x*f,T=l.y*g,C=Math.sqrt(y*f+T*g+m*u);if(o.x=y/C,o.y=T/C,o.z=m/C,s){const i=t.stNwCorner;e.defined(i)?(c=i.latitude-t.stGranYCos*r+n*t.stGranXSin,p=i.longitude+r*t.stGranYSin+n*t.stGranXCos,a.x=(p-t.stWest)*t.lonScalar,a.y=(c-t.stSouth)*t.latScalar):(a.x=(p-_.west)*t.lonScalar,a.y=(c-_.south)*t.latScalar);}}static getRotationOptions(t,i,s,r,n,o,a,l){const h=new e.Matrix2,_=new e.GeographicProjection;let c=new e.Vector3;const d=Math.cos(i),u=r*d,m=s*d,p=Math.sin(i),f=r*p,g=s*p;c=_.project(t,c),c=e.Vector3.subtract(c,l,c);const y=e.Matrix2.fromRotation(i,h);c=e.Matrix2.multiplyByVector(y,c,c),c=e.Vector3.add(c,l,c);const T=(t=_.unproject(c,t)).latitude,C=T+(o-=1)*g,x=T-u*(a-=1),b=T-u*a+o*g,v=Math.max(T,C,x,b),w=Math.min(T,C,x,b),S=t.longitude,A=S+o*m,E=S+a*f,M=S+a*f+o*m;return {north:v,south:w,east:Math.max(S,A,E,M),west:Math.min(S,A,E,M),granYCos:u,granYSin:f,granXCos:m,granXSin:g,nwCorner:t}}static computeOptions(t,i,s,r,n,o,a){const l=new e.Cartographic;let h=new e.Vector3;const _=new e.GeographicProjection;let c,d=t.east,u=t.west,m=t.north,p=t.south,f=!1,g=!1;m===e.CONSTS.CesiumMath.PI_OVER_TWO&&(f=!0),p===-e.CONSTS.CesiumMath.PI_OVER_TWO&&(g=!0);const y=m-p;c=u>d?e.CONSTS.CesiumMath.TWO_PI-u+d:d-u;const T=Math.ceil(c/i)+1,C=Math.ceil(y/i)+1,x=c/(T-1),b=y/(C-1),v=e.Rectangle.northwest(t,o),w=e.Rectangle.center(t,l);0===s&&0===r||(w.longitude<v.longitude&&(w.longitude+=e.CONSTS.CesiumMath.TWO_PI),h=_.project(w,h));const S=b,A=x,E=e.Rectangle.clone(t,n),M={granYCos:S,granYSin:0,granXCos:A,granXSin:0,nwCorner:v,boundingRectangle:E,width:T,height:C,northCap:f,southCap:g};if(0!==s){const t=zg.getRotationOptions(v,s,x,b,w,T,C,h);if(m=t.north,p=t.south,d=t.east,u=t.west,m<-e.CONSTS.CesiumMath.PI_OVER_TWO||m>e.CONSTS.CesiumMath.PI_OVER_TWO||p<-e.CONSTS.CesiumMath.PI_OVER_TWO||p>e.CONSTS.CesiumMath.PI_OVER_TWO)throw new Error("Rotated rectangle is invalid.  It crosses over either the north or south pole.");M.granYCos=t.granYCos,M.granYSin=t.granYSin,M.granXCos=t.granXCos,M.granXSin=t.granXSin,E.north=m,E.south=p,E.east=d,E.west=u;}if(0!==r){s-=r;const t=e.Rectangle.northwest(E,a),i=zg.getRotationOptions(t,s,x,b,w,T,C,h);M.stGranYCos=i.granYCos,M.stGranXCos=i.granXCos,M.stGranYSin=i.granYSin,M.stGranXSin=i.granXSin,M.stNwCorner=t,M.stWest=i.west,M.stSouth=i.south;}return M}}class Wg extends e.Geometry{constructor(t){super(t);const i=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).rectangle;if(e.Rectangle.validate(i),i.north<i.south)throw new Error("options.rectangle.north must be greater than or equal to options.rectangle.south");const s=e.defaultValue(t.height,0),r=e.defaultValue(t.extrudedHeight,s);this.minimumHeight=e.defaultValue(t.minimumHeight,e.defaultValue(this.minimumHeight,e.MINIMUM_HEIGHT)),this.maximumHeight=e.defaultValue(t.maximumHeight,e.defaultValue(this.maximumHeight,e.MAXIMUM_HEIGHT)),this._rectangle=e.Rectangle.clone(i),this._granularity=e.defaultValue(t.granularity,e.CONSTS.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=Hg.clone(e.defaultValue(t.ellipsoid,Hg.WGS84)),this._surfaceHeight=Math.max(s,r),this._extrudedHeight=Math.min(s,r),this._shadowVolume=e.defaultValue(t.shadowVolume,!0),this._textureCoordinateRotationPoints=void 0,this.primitiveType=e.WebGLConstants.TRIANGLES,this.type="RectangleGeometry",this._usedDoublePrecision=!0,this.vertices=void 0,this.indices=void 0,this.normal=void 0,this.uvs=void 0,this._vertexArray=this._usedDoublePrecision?new e.StructArrayLayout11f44:new e.StructArrayLayout3f2f3f32,this._indexArray=new e.StructArrayLayout3ui6,this._initialized=!1,this._needUpdate=!0,this.createGeometry();}createGeometry(){if(e.CONSTS.CesiumMath.equalsEpsilon(this._rectangle.north,this._rectangle.south,e.CONSTS.CesiumMath.EPSILON10)||e.CONSTS.CesiumMath.equalsEpsilon(this._rectangle.east,this._rectangle.west,e.CONSTS.CesiumMath.EPSILON10))return;const t=this._rectangle,i=new e.Rectangle,s=new e.Cartographic,r=new e.Cartographic,n=zg.computeOptions(t,this._granularity,0,0,i,s,r),o=new e.Matrix3;e.Matrix3.clone(e.Matrix3.IDENTITY,o),n.lonScalar=1/this._rectangle.width,n.latScalar=1/this._rectangle.height,n.tangentRotationMatrix=o,Wg.constructExtrudedRectangle(this,n),this._indexArray.clear();for(let e=0;e<this.indices.length;e+=3)this._indexArray.emplaceBack(this.indices[e],this.indices[e+1],this.indices[e+2]);this.uvs=new Float32Array(this.vertices.length/3*2);for(let e=0;e<100;e++)this.uvs[e]=0;this.emplaceVertexBufferTriangle(),this._initialized=!0,this.computeBoundingSphere(),this.computeBoundingBox();}static constructExtrudedRectangle(t,i){const s=t._shadowVolume,r=t.minimumHeight,n=t.maximumHeight,o=t._ellipsoid,a=i.height,l=i.width;let h;const _=Wg._constructRectangle(t,i);let c=e.PolygonPipeline.scaleToGeodeticHeight(_.positions,n,o,!1);c=new Float64Array(c);let d=c.length;const u=2*d,m=new Float64Array(u);m.set(c);const p=e.PolygonPipeline.scaleToGeodeticHeight(_.positions,r,o);let f;if(m.set(p,d),_.positions=m,s){f=_.normals;const e=new Float32Array(u);for(h=0;h<d;h++)f[h]=-f[h];e.set(f,d),_.extrudeDirection=e;}const g=_.indices,y=g.length,T=d/3,C=new Uint16Array(2*y);for(C.set(g),h=0;h<y;h+=3)C[h+y]=g[h+2]+T,C[h+1+y]=g[h+1]+T,C[h+2+y]=g[h]+T;_.indices=C;const x=a;let b=0;b+=2*l+2*x-4;const v=2*(b+4);let w=new Float64Array(3*v);const S=s?new Float32Array(3*v):void 0;let A=0,E=0;const M=l*x;let P;for(h=0;h<M;h+=l)P=3*h,w=Wg._addWallPositions(w,A,P,c,p),A+=6,s&&(E+=3,S[E++]=f[P],S[E++]=f[P+1],S[E++]=f[P+2]);for(h=M-l;h<M;h++)P=3*h,w=Wg._addWallPositions(w,A,P,c,p),A+=6,s&&(E+=3,S[E++]=f[P],S[E++]=f[P+1],S[E++]=f[P+2]);for(h=M-1;h>0;h-=l)P=3*h,w=Wg._addWallPositions(w,A,P,c,p),A+=6,s&&(E+=3,S[E++]=f[P],S[E++]=f[P+1],S[E++]=f[P+2]);for(h=l-1;h>=0;h--)P=3*h,w=Wg._addWallPositions(w,A,P,c,p),A+=6,s&&(E+=3,S[E++]=f[P],S[E++]=f[P+1],S[E++]=f[P+2]);const R={positions:w};s&&(R.extrudeDirection=S);const B=new Uint16Array(6*b);let I,D,O,L;d=w.length/3;let V=0;for(h=0;h<d-1;h+=2){I=h,L=(I+2)%d;const t=e.Vector3.fromArray(w,3*I,new e.Vector3),i=e.Vector3.fromArray(w,3*L,new e.Vector3);e.Vector3.equalsEpsilon(t,i,e.CONSTS.CesiumMath.EPSILON10)||(D=(I+1)%d,O=(D+2)%d,B[V++]=I,B[V++]=D,B[V++]=L,B[V++]=L,B[V++]=D,B[V++]=O);}R.indices=B;const N=[_.positions,R.positions],F=new Float32Array(3*(_.positions.length/3+v));let G=0;for(let e=0;e<N.length;++e)for(let t=0;t<N[e].length;++t)F[G++]=N[e][t];const k=new Uint16Array(36),U=[_.indices,R.indices];let H=0,z=0;for(let e=0;e<U.length;++e){for(let t=0;t<U[e].length;++t)k[H++]=z+U[e][t];z+=8;}t.vertices=F,t.indices=k;}static _constructRectangle(t,i){const s=t._ellipsoid,r=i.height,n=i.width,o=i.northCap,a=i.southCap;let l=0,h=r,_=r,c=0;o&&(l=1,_-=1,c+=1),a&&(h-=1,_-=1,c+=1),c+=n*_;const d=new Float64Array(3*c),u=new Float32Array(2*c);let m=0,p=0;const f=new e.Vector3,g=new e.Vector2;let y=Number.MAX_VALUE,T=Number.MAX_VALUE,C=-Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let e=l;e<h;++e)for(let t=0;t<n;++t)zg.computePosition(i,s,!0,e,t,f,g),d[m++]=f.x,d[m++]=f.y,d[m++]=f.z,u[p++]=g.x,u[p++]=g.y,y=Math.min(y,g.x),T=Math.min(T,g.y),C=Math.max(C,g.x),x=Math.max(x,g.y);if(o&&(zg.computePosition(i,s,!0,0,0,f,g),d[m++]=f.x,d[m++]=f.y,d[m++]=f.z,u[p++]=g.x,u[p++]=g.y,y=g.x,T=g.y,C=g.x,x=g.y),a&&(zg.computePosition(i,s,!0,r-1,0,f,g),d[m++]=f.x,d[m++]=f.y,d[m]=f.z,u[p++]=g.x,u[p]=g.y,y=Math.min(y,g.x),T=Math.min(T,g.y),C=Math.max(C,g.x),x=Math.max(x,g.y)),y<0||T<0||C>1||x>1)for(let e=0;e<u.length;e+=2)u[e]=(u[e]-y)/(C-y),u[e+1]=(u[e+1]-T)/(x-T);const b=d.length,v=new Float32Array(b);let w=0,S=new e.Vector3;for(let t=0;t<b;t+=3){const i=e.Vector3.fromArray(d,t,new e.Vector3),r=w+1,n=w+2;S=s.geodeticSurfaceNormal(i,S),v[w]=S.x,v[r]=S.y,v[n]=S.z,w+=3;}t.vertices=d,t.normals=v;const A=new Uint16Array(6*(n-1)*(_-1));let E,M=0,P=0;for(E=0;E<_-1;++E){for(let e=0;e<n-1;++e){const e=M+n,t=e+1,i=M+1;A[P++]=M,A[P++]=e,A[P++]=i,A[P++]=i,A[P++]=e,A[P++]=t,++M;}++M;}if(o||a){let e=c-1;const t=c-1;let i,s;if(o&&a&&(e=c-2),M=0,o)for(E=0;E<n-1;E++)i=M,s=i+1,A[P++]=e,A[P++]=i,A[P++]=s,++M;if(a)for(M=(_-1)*n,E=0;E<n-1;E++)i=M,s=i+1,A[P++]=i,A[P++]=t,A[P++]=s,++M;}return t.indices=A,{positions:d,normals:v,indices:A}}static _addWallPositions(e,t,i,s,r){return e[t++]=s[i],e[t++]=s[i+1],e[t++]=s[i+2],e[t++]=r[i],e[t++]=r[i+1],e[t]=r[i+2],e}_computeRectangleBounds(t,i,s,r,n,o){const a=e.Rectangle.center(t,new e.Cartographic);a.height=s;const l=e.Cartographic.toVector3(a,i,new e.Vector3),h=e.Transforms.eastNorthUpToFixedFrame(l,i),_=e.Matrix4.inverse(h,new e.Matrix4),c=t.west,d=t.east,u=t.north,m=t.south,p=[new e.Cartographic,new e.Cartographic,new e.Cartographic,new e.Cartographic,new e.Cartographic,new e.Cartographic,new e.Cartographic,new e.Cartographic];p[0].latitude=m,p[0].longitude=c,p[1].latitude=u,p[1].longitude=c,p[2].latitude=u,p[2].longitude=d,p[3].latitude=m,p[3].longitude=d;const f=.5*(c+d),g=.5*(u+m);p[4].latitude=m,p[4].longitude=f,p[5].latitude=u,p[5].longitude=f,p[6].latitude=g,p[6].longitude=c,p[7].latitude=g,p[7].longitude=d;let y=Number.POSITIVE_INFINITY,T=Number.NEGATIVE_INFINITY,C=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY;for(let t=0;t<8;t++){p[t].height=s;const r=e.Cartographic.toVector3(p[t],i,new e.Vector3);e.Matrix4.multiplyByPoint(_,r,r),r.z=0,y=Math.min(y,r.x),T=Math.max(T,r.x),C=Math.min(C,r.y),x=Math.max(x,r.y);}const b=r;b.x=y,b.y=C,b.z=0,e.Matrix4.multiplyByPoint(h,b,b);const v=n;v.x=T,v.y=C,v.z=0,e.Matrix4.multiplyByPoint(h,v,v),e.Vector3.subtract(v,b,n);const w=o;w.x=y,w.y=x,w.z=0,e.Matrix4.multiplyByPoint(h,w,w),e.Vector3.subtract(w,b,o);}_pointLineDistance(t,i,s){return Math.abs((i.y-t.y)*s.x-(i.x-t.x)*s.y+i.x*t.y-i.y*t.x)/e.Vector2.distance(i,t)}_addTextureCoordinateRotationAttributes(t,i){const s=[new e.Vector2,new e.Vector2,new e.Vector2,new e.Vector2],r=e.Vector2.unpack(i,0,s[0]),n=e.Vector2.unpack(i,2,s[1]),o=e.Vector2.unpack(i,4,s[2]);this.attributes.push({name:"uMaxVmax",type:e.WebGLConstants.FLOAT,components:4,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1,batchTableAttributeIndex:this.attributes.length}),this.uMaxVmax=new e.Vector4(0,1,1,0);const a=1/this._pointLineDistance(r,n,o),l=1/this._pointLineDistance(r,o,n);this.attributes.push({name:"uvMinAndExtents",type:e.WebGLConstants.FLOAT,components:4,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1,batchTableAttributeIndex:this.attributes.length}),this.uvMinAndExtents=new e.Vector4(r.x,r.y,a,l);}_add2DTextureCoordinateAttributes(t,i){const s=new e.Cartographic;s.height=0;const r={high:0,low:0};s.longitude=t.west,s.latitude=t.south;const n=i.project(s,new e.Vector3);s.latitude=t.north;const o=i.project(s,new e.Vector3);s.longitude=t.east,s.latitude=t.south;const a=i.project(s,new e.Vector3),l=[0,0,0,0],h=[0,0,0,0];let _=e.EncodedVector3.encode(n.x,r);l[0]=_.high,h[0]=_.low,_=e.EncodedVector3.encode(n.y,r),l[1]=_.high,h[1]=_.low,_=e.EncodedVector3.encode(o.y,r),l[2]=_.high,h[2]=_.low,_=e.EncodedVector3.encode(a.x,r),l[3]=_.high,h[3]=_.low,this.attributes.push({name:"planes2DHIGH",type:e.WebGLConstants.FLOAT,components:4,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1,batchTableAttributeIndex:this.attributes.length}),this.planes2DHIGH=new e.Vector4(l[0],l[1],l[2],l[3]),this.attributes.push({name:"planes2DLOW",type:e.WebGLConstants.FLOAT,components:4,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1,batchTableAttributeIndex:this.attributes.length}),this.planes2DLOW=new e.Vector4(h[0],h[1],h[2],h[3]);}getDataComputeUV(){const t=new e.Vector3,i=new e.Vector3,s=new e.Vector3;this.attributes=[],this._computeRectangleBounds(this._rectangle,this._ellipsoid,e.defaultValue(this.maximumHeight,0),t,i,s),this._addTextureCoordinateRotationAttributes({},[0,0,0,1,1,0]);const r=e.EncodedVector3.fromVector3(t,new e.EncodedVector3);this.attributes.push({name:"southWestHIGH",type:e.WebGLConstants.FLOAT,components:3,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1,batchTableAttributeIndex:this.attributes.length}),this.southWestHIGH=r.high,this.attributes.push({name:"southWestLOW",type:e.WebGLConstants.FLOAT,components:3,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1,batchTableAttributeIndex:this.attributes.length}),this.southWestLOW=r.low,this.attributes.push({name:"eastward",type:e.WebGLConstants.FLOAT,components:3,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1,batchTableAttributeIndex:this.attributes.length}),this.eastward=i,this.attributes.push({name:"northward",type:e.WebGLConstants.FLOAT,components:3,byteStride:0,offset:0,instance:!0,attribIndex:0,divisor:1,batchTableAttributeIndex:this.attributes.length}),this.northward=s;const n=new e.GeographicProjection(this._ellipsoid);this._add2DTextureCoordinateAttributes(this._rectangle,n);}update(t){if(this._initialized&&this._needUpdate&&t.painter){const i=t.painter.context;this._segmentVector&&this._segmentVector.destroy(),e.defined(this._vertexBuffer)||(this._vertexBuffer=i.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?e.layout.members:e.layout$1.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indexArray,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/3),this._needUpdate=!1;}}serialize(){}}class jg{constructor(s){switch((s=e.defaultValue(s,e.defaultValue.EMPTY_OBJECT)).interferenceType){case i.AUTONOMOUS_COMPUTING:break;case i.ACCEPT_COMPUTING:if(!e.defined(s.lngLatBounds))throw new Error("lngLatBounds must be defined!");if(!(s.lngLatBounds instanceof e.LngLatBounds))throw new Error("lngLatBounds is not type of LngLatBounds!");if(!s.projectionTexture)throw new Error("projectionTexture must be defined!");if(!(s.projectionTexture instanceof e.Texture))throw new Error("projectionTexture is not type of Texture!");break;default:throw new Error("interferenceType is not defined!")}if(this._interferenceType=s.interferenceType,this._lngLatBounds=s.lngLatBounds,!e.defined(s.viewPosition))throw new Error("viewerPosition must be defined!");if(!(s.viewPosition instanceof e.Vector3))throw new Error("viewerPosition is not type of Vector3!");this._viewPosition=s.viewPosition,this._radius=e.defaultValue(s.radius,100),this._projectionTexture=e.defaultValue(s.projectionTexture,void 0),this._sphereType=e.defaultValue(s.sphereType,t.ALL),this._projectionPlaneType=e.defaultValue(s.projectionPlaneType,t.ALL),this._show=e.defaultValue(s.show,!0),this._sphereVisibleAreaColor=e.defaultValue(e.Color.parse(s.sphereVisibleAreaColor),new e.Color(0,1,0,.3)),this._sphereHiddenAreaColor=e.defaultValue(e.Color.parse(s.sphereHiddenAreaColor),new e.Color(1,0,0,.3)),this._projectionPlaneVisibleAreaColor=e.defaultValue(e.Color.parse(s.projectionPlaneVisibleAreaColor),new e.Color(0,1,0,.3)),this._projectionPlaneHiddenAreaColor=e.defaultValue(e.Color.parse(s.projectionPlaneHiddenAreaColor),new e.Color(1,0,0,.3)),this._pointIndicator=void 0,this._indicatorVisible=e.defaultValue(s.indicatorVisible,10),this._indicatorSize=e.defaultValue(s.indicatorSize,10),this._indicatorColor=e.Color.parse(s.indicatorColor)||new e.Color(1,0,0,1),this._indicatorOutlineColor=e.Color.parse(s.indicatorOutlineColor)||new e.Color(0,0,0,0),this._indicatorOutlineWidth=e.defaultValue(s.indicatorOutlineWidth,0),this._initialized=!1,this._worldMatrix=new e.Matrix4,this._sphereGeometry=void 0,this._sphereAnalysisCommand=void 0,this._rectangle=void 0,this._viewsheds=[],this._renderTextureMatrix=[],this._viewshedPass=[],this._windowSize={height:0,width:0},this.id=e.defaultValue(s.id,e.uuid()),this._boundingSphere=new e.BoundingSphere(e.Vector3.fromDegrees(this._viewPosition.x,this._viewPosition.y,this._viewPosition.z),this._radius),this._conjointed=!1;}get indicatorColor(){return this._indicatorColor}set indicatorColor(t){const i=e.Color.parse(t);e.defined(i)?(this._indicatorColor=e.Color.parse(i),this._addIndicator()):console.error("minemap.Interference: indicatorColor is not a valid value.");}get indicatorOutlineColor(){return this._indicatorOutlineColor}set indicatorOutlineColor(t){const i=e.Color.parse(t);e.defined(i)?(this._indicatorOutlineColor=e.Color.parse(i),this._addIndicator()):console.error("minemap.Interference: indicatorOutlineColor is not a valid value.");}get indicatorOutlineWidth(){return this._indicatorOutlineWidth}set indicatorOutlineWidth(t){e.isNumber(t)?this._indicatorOutlineWidth=t:console.error("minemap.Interference: indicatorOutlineWidth is not a valid value.");}get indicatorSize(){return this._indicatorSize}set indicatorSize(t){e.isNumber(t)?(this._indicatorSize=t,this._addIndicator()):console.error("minemap.Interference: indicatorSize is not a valid value.");}get indicatorVisible(){return this._indicatorVisible}set indicatorVisible(t){e.isBoolean(t)?(this._indicatorVisible=t,this._addIndicator()):console.error("minemap.Interference: indicatorVisible is not a valid value.");}get viewPosition(){return this._viewPosition}set viewPosition(t){if(t instanceof e.Vector3){if(this._interferenceType===i.AUTONOMOUS_COMPUTING){this._viewPosition=t;const i=e.Vector3.fromDegrees(t.x,t.y,t.z);this._worldMatrix=e.Transforms.headingPitchRollToFixedFrame(i,new e.HeadingPitchRoll(0,0,0)),this._initialized=!1;}}else console.error("minemap.Interference: viewPosition is not type of Vector3!");}get radius(){return this._radius}set radius(t){e.isNumber(t)?this._interferenceType===i.AUTONOMOUS_COMPUTING&&(this._radius=t,this._initialized=!1):console.error("minemap.Interference: radius is not a valid value.");}get sphereType(){return this._sphereType}set sphereType(i){if(e.isNumber(i))switch(i){case t.VISIBLE:case t.HIDDEN:case t.ALL:case t.NONE:this._sphereType=i;break;default:console.error("minemap.Interference: sphereType is not a valid value.");}else console.error("minemap.Interference: sphereType should be a number.");}get projectionPlaneType(){return this._projectionPlaneType}set projectionPlaneType(s){if(e.isNumber(s)){if(this._interferenceType===i.AUTONOMOUS_COMPUTING){const i=e.Color.clone(this._projectionPlaneVisibleAreaColor),r=e.Color.clone(this._projectionPlaneHiddenAreaColor);switch(s){case t.VISIBLE:r.a=0;break;case t.HIDDEN:i.a=0;break;case t.ALL:break;case t.NONE:i.a=0,r.a=0;break;default:return void console.error("minemap.Interference: projectionPlaneType is not a valid value.")}for(let e=0;e<this._viewsheds.length;e++)this._viewsheds[e].visibleAreaColor=i,this._viewsheds[e].hiddenAreaColor=r;}this._projectionPlaneType=s;}else console.error("Invalid projectionPlaneType value. Number expected.");}get show(){return this._show}set show(t){e.isBoolean(t)?this._show=t:console.error("minemap.Interference: show should be a boolean.");}get sphereVisibleAreaColor(){return this._sphereVisibleAreaColor}set sphereVisibleAreaColor(t){const i=e.Color.parse(t);e.defined(i)?this._sphereVisibleAreaColor=i:console.error("minemap.Interference: sphereVisibleAreaColor is not a valid value.");}get sphereHiddenAreaColor(){return this._sphereHiddenAreaColor}set sphereHiddenAreaColor(t){const i=e.Color.parse(t);e.defined(i)?this._sphereHiddenAreaColor=i:console.error("minemap.Interference: sphereHiddenAreaColor is not a valid value.");}get projectionPlaneVisibleAreaColor(){let e;return e=this._interferenceType===i.AUTONOMOUS_COMPUTING?this._projectionPlaneVisibleAreaColor:void 0,e}set projectionPlaneVisibleAreaColor(t){const s=e.Color.parse(t);if(e.defined(s)){if(this._interferenceType===i.AUTONOMOUS_COMPUTING){for(let e=0;e<this._viewsheds.length;e++)this._viewsheds[e].visibleAreaColor=s;this._projectionPlaneVisibleAreaColor=s;}}else console.error("minemap.Interference: projectionPlaneVisibleAreaColor is not a valid value.");}get projectionPlaneHiddenAreaColor(){let e;return e=this._interferenceType===i.AUTONOMOUS_COMPUTING?this._projectionPlaneHiddenAreaColor:void 0,e}set projectionPlaneHiddenAreaColor(t){const s=e.Color.parse(t);if(e.defined(s)){if(this._interferenceType===i.AUTONOMOUS_COMPUTING){for(let e=0;e<this._viewsheds.length;e++)this._viewsheds[e].hiddenAreaColor=s;this._projectionPlaneHiddenAreaColor=s;}}else console.error("minemap.Interference: projectionPlaneHiddenAreaColor is not a valid value.");}_addIndicator(){if(!this._indicatorVisible)return;const t=e.Vector3.fromDegrees(this._viewPosition.x,this._viewPosition.y,this._viewPosition.z);e.defined(this._pointIndicator)?(this._pointIndicator.remove(this._pointPrimitive,!0),this._pointPrimitive=new Lh({show:!0,position:t,pixelSize:this._indicatorSize,color:this._indicatorColor,outlineColor:this._indicatorOutlineColor,outlineWidth:this._indicatorOutlineWidth}),this._pointIndicator.add(this._pointPrimitive)):(this._pointIndicator=new kh,this._pointPrimitive=new Lh({show:!0,position:t,pixelSize:this._indicatorSize,color:this._indicatorColor,outlineColor:this._indicatorOutlineColor,outlineWidth:this._indicatorOutlineWidth}),this._pointIndicator._materialOpaque.renderState.depthMask=!1,this._pointIndicator._materialTranslucent.renderState.depthMask=!1,this._pointIndicator.add(this._pointPrimitive));}_createDepthCamera(t){this._viewshedPass=[],this._renderTextureMatrix=[new e.Matrix4,new e.Matrix4,new e.Matrix4,new e.Matrix4,new e.Matrix4,new e.Matrix4];const i=new e.Matrix4;for(let s=0;s<6;s++){const r=new l(90,1,Math.max(.001*this._radius,.1),Math.max(this._radius+100,10)),n=e.Transforms.headingPitchRollToFixedFrame(e.Vector3.fromDegrees(this._viewPosition.x,this._viewPosition.y,this._viewPosition.z),new e.HeadingPitchRoll(e.CONSTS.CesiumMath.toRadians(s>3?0:90*s),e.CONSTS.CesiumMath.toRadians(s>3?4===s?180:0:90),e.CONSTS.CesiumMath.toRadians(0)));r.setMatrix(n),e.Matrix4.multiply(i,r.getViewMatrix(),this._worldMatrix),e.Matrix4.multiply(this._renderTextureMatrix[s],r.getProjectionMatrix(),i),this._viewshedPass[s]=new Sg({camera:r,context:t.context,width:2048,height:2048,passType:e.RenderPassConsts.VIEWSHED_PASS});}}_createSphereVertices(t,i,s){const r=360*e.CONSTS.CesiumMath.RADIANS_PER_DEGREE/i,n=Math.PI/t;let o=0,a=0;const l=new Array((t+1)*i*3);let h=0;for(let e=0;e<i;e++){a=e*r;for(let e=0;e<=t;e++)o=e*n,l[h++]=s*Math.sin(o)*Math.cos(a),l[h++]=s*Math.sin(o)*Math.sin(a),l[h++]=s*Math.cos(o);}return l}_createSphereIndices(e,t){let i;const s=[];for(i=0;i<e;i++)for(let r=0;r<t;r++){const n=i+r*(e+1),o=n+1,a=r==t-1?i+1:n+e+2;s.push(n),s.push(o),s.push(a),s.push(n),s.push(a),s.push(a-1);}return s}_createCommand(t){e.defined(this._sphereGeometry)&&(this._sphereGeometry.destroy(),this._vertices=[]),e.defined(this._sphereAnalysisCommand)&&(this._sphereAnalysisCommand.material=void 0,this._sphereAnalysisCommand=void 0);const i=e.Vector3.fromDegrees(this._viewPosition.x,this._viewPosition.y,this._viewPosition.z);this._worldMatrix=e.Transforms.headingPitchRollToFixedFrame(i,new e.HeadingPitchRoll(0,0,0)),this._vertices=this._createSphereVertices(129,129,1);const s=new e.StructArrayLayout3f2f3f32;for(let e=0;e<this._vertices.length;e+=3)s.emplaceBack(this._vertices[e],this._vertices[e+1],this._vertices[e+2],0,0,0,0,0);const r=this._createSphereIndices(129,129),n=new e.StructArrayLayout3ui6;for(let e=0;e<r.length;e+=3)n.emplaceBack(r[e],r[e+1],r[e+2]);this._sphereGeometry=new e.Geometry({primitiveType:e.WebGLConstants.TRIANGLES,vertexBuffer:t.context.createVertexBuffer(s,e.layout$1.members),indexBuffer:t.context.createIndexBuffer(n),segmentVector:e.SegmentVector.simpleSegment(0,0,this._vertices.length/3,r.length/3)});const o=new Map([["u_ModelViewProjectionMatrix",()=>t.frameState.camera.getVPMatrix().multiplyRight(this._worldMatrix)],["u_Radius",()=>this._radius],["u_SphereVisibleAreaColor",()=>e.Vector4.fromColor(this._sphereVisibleAreaColor,!1)],["u_SphereHiddenAreaColor",()=>e.Vector4.fromColor(this._sphereHiddenAreaColor,!1)],["u_SphereType",()=>this._sphereType]]);for(let e=0;e<6;e++)o.set(`u_TexWorldViewProjMatrix${e}`,(()=>this._renderTextureMatrix[e])),o.set(`u_DepthMap${e}`,(()=>this._viewshedPass[e].framebuffer.depthStencilTexture));this._sphereAnalysisCommand={painter:t,framebuffer:t.mainPass.framebuffer.framebuffer,layer:{id:"interferenceAnalysis"},geometry:this._sphereGeometry,material:{renderState:{blending:e.renderStateEnum.enableBlending,depthTest:e.renderStateEnum.enableDepthTest,depthMask:!1},_uniforms:o,_shaderSource:new e.ShaderSource({type:"interferenceAnalysis"})}};}_createViewshed(){for(;this._viewsheds.length>0;)this._viewsheds.pop().destroy();for(let e=0;e<6;e++)this._viewsheds.push(new Pg({viewerPosition:this._viewPosition,distance:this._radius,direction:e>3?0:90*e,pitch:e>3?4===e?180:0:90,horizontalFov:90,verticalFov:90,visibleAreaColor:this._projectionPlaneVisibleAreaColor,hiddenAreaColor:this._projectionPlaneHiddenAreaColor,lineVisible:!1}));}_drawPointIndicator(e){if(!this._indicatorVisible)return;this._pointIndicator.update(e);const t=this._pointIndicator.getTranslucentPrimitives();for(let i=0;i<t.length;i++)t[i].update(e,e.frameState,{}),t[i].framebuffer=e.mainPass.framebuffer.framebuffer;for(let i=0;i<t.length;i++)t[i].render(e,{id:"viewdom-indicator"},e.frameState),t[i].framebuffer=null;}_createRectanglePrimitive(t){const i=this._vertices,s=this._worldMatrix,r=[];for(let t=0;t<i.length;t+=3){const n=new e.Vector3(i[t]*this._radius,i[t+1]*this._radius,i[t+2]*this._radius);r.push(e.Matrix4.multiplyByPoint(s,n,new e.Vector3));}const n=this._lngLatBounds.getWest(),o=this._lngLatBounds.getNorth(),a=this._lngLatBounds.getEast(),l=this._lngLatBounds.getSouth(),h=e.StandardMaterial.fromType("Texture",{baseColorTexture:this._projectionTexture});h._uniforms.set("u_viewNormal",(()=>e.getNormalMatrix(t._map.camera.viewMatrix.clone()))),this._rectanglePrimitive=new e.Primitive({geometry:new Wg({rectangle:e.Rectangle.fromDegrees(n,l,a,o)}),material:h,adaptTerrain:!0});}_renderPrimitive(e){const t=e.frameState,i=this._rectanglePrimitive,s=this._rectanglePrimitive.material;i.framebuffer=e.mainPass.framebuffer.framebuffer;const r={lightingModel:e._map.lightingModel,type:"3d-model",isHidden:()=>!1,classificationType:5};e.clearStencil();const n=Lp._createRenderState(e,r);s.overrideRenderState=n.pass1,i.update(e,t,{}),i.render(e,r,t),s.overrideRenderState=n.pass2,i.update(e,t,{}),i.render(e,r,t),s.overrideRenderState=void 0;}update(s){if(this._show){if(this._windowSize.height===s.height&&this._windowSize.width===s.width||(this._windowSize.height=s.height,this._windowSize.width=s.width,this._initialized=!1),!this._initialized){this._addIndicator(),this._createCommand(s),this._interferenceType===i.AUTONOMOUS_COMPUTING?this._createViewshed():this._createRectanglePrimitive(s),this._createDepthCamera(s);for(let e=0;e<this._viewshedPass.length;e++)this._viewshedPass[e].render(s);this._boundingSphere.fromCenterRadius(e.Vector3.fromDegrees(this._viewPosition.x,this._viewPosition.y,this._viewPosition.z),this._radius),this._initialized=!0;}if(this._projectionPlaneType!==t.NONE)for(let e=0;e<this._viewsheds.length;e++)this._viewsheds[e].update(s);}}render(s){if(this._show){if(!this._conjointed&&this._projectionPlaneType!==t.NONE)if(this._interferenceType===i.AUTONOMOUS_COMPUTING)for(let e=0;e<this._viewsheds.length;e++)this._viewsheds[e].render(s);else this._renderPrimitive(s);this._indicatorVisible&&this._drawPointIndicator(s),this._sphereType!==t.NONE&&(e.RenderState.applyRenderState(s.context,e.RenderState.fromCache({viewport:{x:0,y:0,width:s.width*s._map.SSAASamples,height:s.height*s._map.SSAASamples}})),s.context.draw(this._sphereAnalysisCommand),e.RenderState.applyRenderState(s.context,e.RenderState.fromCache({viewport:{x:0,y:0,width:s.width,height:s.height}})));}}destroy(){for(this._viewPosition=void 0,this._radius=void 0,this._sphereType=void 0,this._show=void 0,this._sphereVisibleAreaColor=void 0,this._sphereHiddenAreaColor=void 0,this._projectionPlaneVisibleAreaColor=void 0,this._projectionPlaneHiddenAreaColor=void 0,this._rectangle=void 0,this._initialized=void 0,this._vertices=[],this._worldMatrix=void 0,e.defined(this._sphereGeometry)&&(this._sphereGeometry.destroy(),this._sphereGeometry=void 0),this._sphereAnalysisCommand.material=void 0,this._sphereAnalysisCommand=void 0,this._renderTextureMatrix=[];this._viewshedPass.length>0;)this._viewshedPass.pop().destroy();for(;this._viewsheds.length>0;)this._viewsheds.pop().destroy();return e.destroyObject(this)}}class Xg{constructor(t){const i=t.interferences,s=t.lngLatBounds,r=t.projectionTexture;this._show=e.defaultValue(t.show,!0),this.id=e.defaultValue(t.id,e.uuid()),this._interferences=[],this._lngLatBounds=void 0,this._projectionTexture=void 0,this._rectanglePrimitive=void 0,this._initialized=!1,e.defined(i)&&e.defined(s)&&e.defined(r)&&this.add(i,s,r);}get interferences(){return this._interferences}get lngLatBounds(){return this._lngLatBounds}get projectionTexture(){return this._projectionTexture}get length(){return this._interferences.length}get show(){return this._show}set show(t){e.isBoolean(t)&&(this._show=t);}add(t,i,s){if(!(t instanceof Array))throw new Error("interferences is not type of Array!");if(!e.defined(i))throw new Error("lngLatBounds must be defined!");if(!(i instanceof e.LngLatBounds))throw new Error("lngLatBounds is not type of LngLatBounds!");if(this._lngLatBounds=i,!s)throw new Error("projectionTexture must be defined!");if(!(s instanceof e.Texture))throw new Error("projectionTexture is not type of Texture!");this._projectionTexture=s;for(let e=0;e<t.length;e++){const i=t[e];i._conjointed=!0,this._interferences.push(i);}return this._initialized=!1,this}remove(t,i){if(e.defined(i)){if(e.defined(i)&&!(i instanceof e.LngLatBounds))throw new Error("lngLatBounds is not type of LngLatBounds!");this._lngLatBounds=i,this._initialized=!1;}if(!(t instanceof Array))throw new Error("The interferences is not the type of Array.");for(let e=0;e<t.length;e++){const i=t[e],s=this._interferences.indexOf(i);s>=0&&(this._interferences.splice(s,1),i._conjointed=!1);}}_createRectanglePrimitive(t){if(!e.defined(this._lngLatBounds))return;const i=this._lngLatBounds.getWest(),s=this._lngLatBounds.getNorth(),r=this._lngLatBounds.getEast(),n=this._lngLatBounds.getSouth(),o=e.StandardMaterial.fromType("Texture",{baseColorTexture:this._projectionTexture});o._uniforms.set("u_viewNormal",(()=>e.getNormalMatrix(t._map.camera.viewMatrix.clone()))),this._rectanglePrimitive=new e.Primitive({geometry:new Wg({rectangle:e.Rectangle.fromDegrees(i,n,r,s)}),material:o,adaptTerrain:!0}),this._initialized=!0;}_renderPrimitive(t){const i=t.frameState,s=this._rectanglePrimitive;if(!e.defined(s))return;this._rectanglePrimitive.material._uniforms.set("u_viewNormal",(()=>e.getNormalMatrix(t._map.camera.viewMatrix.clone())));const r=s.material;s.framebuffer=t.mainPass.framebuffer.framebuffer;const n={lightingModel:t._map.lightingModel,type:"3d-model",isHidden:()=>!1,classificationType:5};t.clearStencil();const o=Lp._createRenderState(t,n);r.overrideRenderState=o.pass1,s.update(t,i,{}),s.render(t,n,i),r.overrideRenderState=o.pass2,s.update(t,i,{}),s.render(t,n,i),r.overrideRenderState=void 0;}update(e){this._initialized||this._createRectanglePrimitive(e);}render(e){this._show&&this._renderPrimitive(e);}}class qg{constructor(){this._interferences=[],this._conjointedInterferences=[];}get length(){return this._interferences.length}get conjoinedLength(){return this._conjointedInterferences.length}add(t,i){if(!(t instanceof jg))return console.error("The current addition is not of type ViewDome!"),!1;const s=e.defined(i);if(s){if(i<0)throw new Error("index must be greater than or equal to zero.");if(i>this._interferences.length)throw new Error("index must be less than or equal to the number of ViewDome.")}return s?this._interferences.splice(i,0,t):this._interferences.push(t),!0}contains(e){return -1!==this.indexOf(e)}getById(e){let t;return this._interferences.forEach((i=>{i.id===e&&(t=i);})),t}getConjoinedById(e){let t;return this._conjointedInterferences.forEach((i=>{i.id===e&&(t=i);})),t}getByIndex(t){if(e.isNumber(t)&&!(t>this.length))return this._interferences[t]}getConjoinedByIndex(t){if(e.isNumber(t)&&!(t>this.length))return this._conjointedInterferences[t]}indexOf(e){return this._interferences.indexOf(e)}remove(e){const t=this.indexOf(e);return -1!==t&&(this._interferences.splice(t,1),!0)}removeById(e){const t=this.getById(e);if(t)return this.remove(t);console.error("The interference does not exist.");}removeByIndex(t){if(e.isNumber(t)){if(t<0)throw new Error("index must be greater than or equal to zero.");if(t>this._interferences.length)throw new Error("index must be less than or equal to the number of Interference.");const e=this.getByIndex(t);return this.remove(e)}throw new Error("index must be a number.")}removeAll(){for(let e=0;e<this.length;e++)this._interferences[e].destroy();this._interferences=[];}addConjoined(e){if(!(e instanceof Xg))throw new Error("interferenceConjoined must be type of InterferenceConjoined!");this._conjointedInterferences.push(e);for(let t=0;t<e.length;t++)this.contains(e._interferences[t])&&(e._interferences[t]._conjointed=!0);return e}removeConjoined(e){if(!(e instanceof Xg))throw new Error("interferenceConjoined must be type of InterferenceConjoined!");let t=!1;const i=this._conjointedInterferences.indexOf(e);if(i>=0){this._conjointedInterferences.splice(i,1);for(let t=0;t<e.length;t++)this.contains(e._interferences[t])&&(e._interferences[t]._conjointed=!1);t=!0;}return t}removeConjoinedByIndex(t){if(!e.isNumber(t))throw new Error("index must be a number.");{if(t<0)throw new Error("index must be greater than or equal to zero.");if(t>this._interferences.length)throw new Error("index must be less than or equal to the number of ConjoinedInterference.");const i=this._conjointedInterferences[t];if(e.defined(i))return this.removeConjoined(i)}}removeConjoinedById(e){let t;if(this._conjointedInterferences.forEach((i=>{i.id===e&&(t=i);})),t)return this.removeConjoined(t);console.error("The interference does not exist.");}removeAllConjoined(){for(let e=0;e<this._conjointedInterferences.length;e++){const t=this._conjointedInterferences[e];for(let e=0;e<t.length;e++)this.contains(t._interferences[e])&&(t._interferences[e]._conjointed=!1);}this._conjointedInterferences=[];}update(t){for(let i=0;i<this.length;i++){const s=this.getByIndex(i);t.transform.activeCamera.frustumCrate.cullingVolume.computeVisibility(s._boundingSphere)!==e.INTERSECTION.OUTSIDE&&s.update(t);}if(this._conjointedInterferences.length>0)for(let e=0;e<this._conjointedInterferences.length;e++)this._conjointedInterferences[e].update(t);}render(t){if(this._conjointedInterferences.length>0)for(let e=0;e<this._conjointedInterferences.length;e++)this._conjointedInterferences[e].render(t);for(let i=0;i<this.length;i++){const s=this.getByIndex(i);t.transform.activeCamera.frustumCrate.cullingVolume.computeVisibility(s._boundingSphere)!==e.INTERSECTION.OUTSIDE&&s._initialized&&s.render(t);}}serialize(){}}const Kg="geometry的数据更新已经全面采用了setData,参数不变，方法名变更了，建议修改";class Jg extends e.Geometry{constructor(e){super(e),this.type="BoxGeometry",this.setData(e);}parse(){super.parse(),this.indices=[],this.vertices=[],this.normals=[],this.uvs=[],this.needUpdate=!0,this._ready=!0,this.numberOfVertices=0,this.groupStart=0,this.buildPlane("z","y","x",-1,-1,this.depth,this.height,this.width,this.depthSegments,this.heightSegments,0),this.buildPlane("z","y","x",1,-1,this.depth,this.height,-this.width,this.depthSegments,this.heightSegments,1),this.buildPlane("x","z","y",1,1,this.width,this.depth,this.height,this.widthSegments,this.depthSegments,2),this.buildPlane("x","z","y",1,-1,this.width,this.depth,-this.height,this.widthSegments,this.depthSegments,3),this.buildPlane("x","y","z",1,-1,this.width,this.height,this.depth,this.widthSegments,this.heightSegments,4),this.buildPlane("x","y","z",-1,-1,this.width,this.height,-this.depth,this.widthSegments,this.heightSegments,5);for(let e=0;e<this.indices.length;e+=3)this._indexArray.emplaceBack(this.indices[e],this.indices[e+1],this.indices[e+2]);this.emplaceVertexBufferTriangle();}buildPlane(t,i,s,r,n,o,a,l,h,_,c){const d=o/h,u=a/_,m=o/2,p=a/2,f=l/2,g=h+1,y=_+1;let T,C,x=0,b=0;const v=new e.Vector3;for(C=0;C<y;C++){const e=C*u-p;for(T=0;T<g;T++)v[t]=(T*d-m)*r,v[i]=e*n,v[s]=f,this.vertices.push(v.x,v.y,v.z),v[t]=0,v[i]=0,v[s]=l>0?1:-1,this.normals.push(v.x,v.y,v.z),this.uvs.push(T/h),this.uvs.push(1-C/_),x+=1;}for(C=0;C<_;C++)for(T=0;T<h;T++){const e=this.numberOfVertices+T+g*(C+1),t=this.numberOfVertices+(T+1)+g*(C+1),i=this.numberOfVertices+(T+1)+g*C;this.indices.push(this.numberOfVertices+T+g*C,e,i),this.indices.push(e,t,i),b+=6;}this.groupStart+=b,this.numberOfVertices+=x;}setData(t){super.setData(),this.width=t.width?t.width:1,this.height=t.height?t.height:1,this.depth=t.depth?t.depth:1,this.widthSegments=t.widthSegments?Math.floor(t.widthSegments):1,this.heightSegments=t.heightSegments?Math.floor(t.heightSegments):1,this.depthSegments=t.depthSegments?Math.floor(t.depthSegments):1,this._usedDoublePrecision=!1,this._vertexArray?(this._vertexArray.clear(),this._indexArray.clear()):(this._vertexArray=this._usedDoublePrecision?new e.StructArrayLayout11f44:new e.StructArrayLayout3f2f3f32,this._indexArray=new e.StructArrayLayout3ui6),this._ready=!1,this.primitiveType=e.WebGLConstants.TRIANGLES,this.parse(),this.computeBoundingSphere(),this.computeBoundingBox();}updateBoxGeometry(e){console.warn(Kg),this.setData(e);}update(t){if(this._ready&&this.needUpdate&&t.painter){this._ready=!1,this.needUpdate=!1;const i=t.painter.context;this._vertexBuffer&&this._indexBuffer?(this._vertexBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indexArray)):(this._vertexBuffer=i.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?e.layout.members:e.layout$1.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indexArray,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/3);}}serialize(){return {type:this.type,width:this.width,height:this.height,depth:this.depth}}destroy(){super.destroy(),this.width=void 0,this.height=void 0,this.depth=void 0,this.widthSegments=void 0,this.heightSegments=void 0,this.depthSegments=void 0,this.type=void 0,this._vertexArray=void 0,this._indexArray=void 0,this._ready=void 0,this.needUpdate=void 0,this.primitiveType=void 0;}}class Zg extends e.Geometry{constructor(t){super(t),this.type="ConeGeometry",this.primitiveType=e.WebGLConstants.TRIANGLES,this.setData(t);}setData(t){super.setData(),this.radiusTop=0,this.radiusBottom=t.radiusBottom?t.radiusBottom:0,this.height=t.height?t.height:1,this.radialSegments=Math.floor(t.radialSegments?t.radialSegments:8),this.heightSegments=Math.floor(t.heightSegments?t.heightSegments:1),this.openEnded=!!t.openEnded&&t.openEnded,this.thetaStart=t.thetaStart?t.thetaStart:0,this.thetaLength=t.thetaLength?t.thetaLength:2*Math.PI,this._vertexArray?(this._vertexArray.clear(),this._indexArray.clear()):(this._vertexArray=new e.StructArrayLayout3f2f3f32,this._indexArray=new e.StructArrayLayout3ui6),this._ready=!1,this.parse(),this.computeBoundingSphere(),this.computeBoundingBox();}parse(){this._createGeometry(),this._ready=!0,this.needUpdate=!0;for(let e=0;e<this.indices.length;e+=3)this._indexArray.emplaceBack(this.indices[e],this.indices[e+1],this.indices[e+2]);for(let e=0;e<this.normals.length/3;e++)this._vertexArray.emplaceBack(this.vertices[3*e],this.vertices[3*e+1],this.vertices[3*e+2],this.uvs[2*e],this.uvs[2*e+1],this.normals[3*e],this.normals[3*e+1],this.normals[3*e+2]);}_createGeometry(){this.indices=[],this.vertices=[],this.normals=[],this.uvs=[],this.index=0,this.indexArray=[],this.halfHeight=this.height/2,this.generateTorso(),!1===this.openEnded&&(this.radiusTop>0&&this.generateCap(!0),this.radiusBottom>0&&this.generateCap(!1));}generateTorso(){const t=new e.Vector3,i=new e.Vector3,s=(this.radiusBottom-this.radiusTop)/this.height;for(let e=0;e<=this.heightSegments;e++){const r=[],n=e/this.heightSegments,o=n*(this.radiusBottom-this.radiusTop)+this.radiusTop;for(let e=0;e<=this.radialSegments;e++){const a=e/this.radialSegments,l=a*this.thetaLength+this.thetaStart,h=Math.sin(l),_=Math.cos(l);i.x=o*h,i.y=-n*this.height+this.halfHeight,i.z=o*_,this.vertices.push(i.x,i.y,i.z),t.set(h,s,_).normalize(),this.normals.push(t.x,t.y,t.z),this.uvs.push(a,1-n),r.push(this.index++);}this.indexArray.push(r);}for(let e=0;e<this.radialSegments;e++)for(let t=0;t<this.heightSegments;t++){const i=this.indexArray[t+1][e],s=this.indexArray[t+1][e+1],r=this.indexArray[t][e+1];this.indices.push(this.indexArray[t][e],i,r),this.indices.push(i,s,r);}}generateCap(t){const i=this.index,s=new e.Vector2,r=new e.Vector3,n=!0===t?this.radiusTop:this.radiusBottom,o=!0===t?1:-1;for(let e=1;e<=this.radialSegments;e++)this.vertices.push(0,this.halfHeight*o,0),this.normals.push(0,o,0),this.uvs.push(.5,.5),this.index++;const a=this.index;for(let e=0;e<=this.radialSegments;e++){const t=e/this.radialSegments*this.thetaLength+this.thetaStart,i=Math.cos(t),a=Math.sin(t);r.x=n*a,r.y=this.halfHeight*o,r.z=n*i,this.vertices.push(r.x,r.y,r.z),this.normals.push(0,o,0),s.x=.5*i+.5,s.y=.5*a*o+.5,this.uvs.push(s.x,s.y),this.index++;}for(let e=0;e<this.radialSegments;e++){const s=i+e,r=a+e;!0===t?this.indices.push(r,r+1,s):this.indices.push(r+1,r,s);}}updateConeGeometry(e){console.warn(Kg),this.setData(e);}update(t){if(this._ready&&this.needUpdate&&t.painter){this.needUpdate=!1;const i=t.painter.context;this._vertexBuffer&&this._indexBuffer?(this._vertexBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indexArray)):(this._vertexBuffer=i.createVertexBuffer(this._vertexArray,e.layout$1.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indexArray,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/3);}}serialize(){return {type:this.type,radiusTop:this.radiusTop,radiusBottom:this.radiusBottom,height:this.height,radialSegments:this.radialSegments,heightSegments:this.heightSegments,openEnded:this.openEnded,thetaStart:this.thetaStart,thetaLength:this.thetaLength}}destroy(){super.destroy(),this._ready=void 0,this.needUpdate=void 0,this._vertexArray=void 0,this.indices=void 0,this.vertices=void 0,this.uvs=void 0;}}class Yg extends e.Geometry{constructor(t){super(t),this.type="CylinderGeometry",this.primitiveType=e.WebGLConstants.TRIANGLES,this.setData(t);}setData(t){super.setData(),this.radiusTop=t.radiusTop?t.radiusTop:0,this.radiusBottom=t.radiusBottom?t.radiusBottom:0,this.height=t.height?t.height:1,this.radialSegments=Math.floor(t.radialSegments?t.radialSegments:8),this.heightSegments=Math.floor(t.heightSegments?t.heightSegments:1),this.openEnded=!!t.openEnded&&t.openEnded,this.thetaStart=t.thetaStart?t.thetaStart:0,this.thetaLength=t.thetaLength?t.thetaLength:2*Math.PI,this._usedDoublePrecision=!1,this._vertexArray?(this._vertexArray.clear(),this._indexArray.clear()):(this._vertexArray=this._usedDoublePrecision?new e.StructArrayLayout11f44:new e.StructArrayLayout3f2f3f32,this._indexArray=new e.StructArrayLayout3ui6),this._ready=!1,this.parse(),this.computeBoundingSphere(),this.computeBoundingBox();}parse(){this._createGeometry(),this._ready=!0,this.needUpdate=!0;for(let e=0;e<this.indices.length;e+=3)this._indexArray.emplaceBack(this.indices[e],this.indices[e+1],this.indices[e+2]);this.emplaceVertexBufferTriangle();}_createGeometry(){this.indices=[],this.vertices=[],this.normals=[],this.uvs=[],this.index=0,this.indexArray=[],this.halfHeight=this.height/2,this.generateTorso(),!1===this.openEnded&&(this.radiusTop>0&&this.generateCap(!0),this.radiusBottom>0&&this.generateCap(!1));}generateTorso(){const t=new e.Vector3,i=new e.Vector3,s=(this.radiusBottom-this.radiusTop)/this.height;for(let e=0;e<=this.heightSegments;e++){const r=[],n=e/this.heightSegments,o=n*(this.radiusBottom-this.radiusTop)+this.radiusTop;for(let e=0;e<=this.radialSegments;e++){const a=e/this.radialSegments,l=a*this.thetaLength+this.thetaStart,h=Math.sin(l),_=Math.cos(l);i.x=o*h,i.y=-n*this.height+this.halfHeight,i.z=o*_,this.vertices.push(i.x,i.y,i.z),t.set(h,s,_).normalize(),this.normals.push(t.x,t.y,t.z),this.uvs.push(a,1-n),r.push(this.index++);}this.indexArray.push(r);}for(let e=0;e<this.radialSegments;e++)for(let t=0;t<this.heightSegments;t++){const i=this.indexArray[t+1][e],s=this.indexArray[t+1][e+1],r=this.indexArray[t][e+1];this.indices.push(this.indexArray[t][e],i,r),this.indices.push(i,s,r);}}generateCap(t){const i=this.index,s=new e.Vector2,r=new e.Vector3,n=!0===t?this.radiusTop:this.radiusBottom,o=!0===t?1:-1;for(let e=1;e<=this.radialSegments;e++)this.vertices.push(0,this.halfHeight*o,0),this.normals.push(0,o,0),this.uvs.push(.5,.5),this.index++;const a=this.index;for(let e=0;e<=this.radialSegments;e++){const t=e/this.radialSegments*this.thetaLength+this.thetaStart,i=Math.cos(t),a=Math.sin(t);r.x=n*a,r.y=this.halfHeight*o,r.z=n*i,this.vertices.push(r.x,r.y,r.z),this.normals.push(0,o,0),s.x=.5*i+.5,s.y=.5*a*o+.5,this.uvs.push(s.x,s.y),this.index++;}for(let e=0;e<this.radialSegments;e++){const s=i+e,r=a+e;!0===t?this.indices.push(r,r+1,s):this.indices.push(r+1,r,s);}}update(t){if(this._ready&&this.needUpdate&&t.painter){this.needUpdate=!1;const i=t.painter.context;this._vertexBuffer&&this._indexBuffer?(this._vertexBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indexArray)):(this._vertexBuffer=i.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?e.layout.members:e.layout$1.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indexArray,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/3);}}serialize(){return {type:this.type,radiusTop:this.radiusTop,radiusBottom:this.radiusBottom,height:this.height,radialSegments:this.radialSegments,heightSegments:this.heightSegments,openEnded:this.openEnded,thetaStart:this.thetaStart,thetaLength:this.thetaLength}}destroy(){super.destroy(),this._ready=!1,this.needUpdate=!1,this.indices=null,this.vertices=null,this.uvs=null,this.vertices=null;}}class Qg extends e.Geometry{constructor(t){super(),this.primitiveType=e.WebGLConstants.TRIANGLES,this.type="FenceGeometry",this.setData(t);}setData(t){if(super.setData(),!e.defined(t.positions))throw new Error("options.positions is required.");if(e.defined(t.maximumHeights)&&t.maximumHeights.length!==t.positions.length)throw new Error("options.positions and options.maximumHeights must have the same length.");if(e.defined(t.minimumHeights)&&t.minimumHeights.length!==t.positions.length)throw new Error("options.positions and options.minimumHeights must have the same length.");if(this._positions=t.positions,this._maximumHeights=t.maximumHeights,this._minimumHeights=t.minimumHeights,this._granularity=e.defaultValue(t.granularity,e.CONSTS.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=e.defaultValue(t.ellipsoid,e.Ellipsoid.WGS84),this.vertices=void 0,this.indices=void 0,this.normals=void 0,this.uvs=void 0,this._evennessUV=[],this._needUpdate=!0,this._usedDoublePrecision=!0,this._vertexArray?(this._vertexArray.clear(),this._indexArray.clear()):(this._vertexArray=this._usedDoublePrecision?new e.StructArrayLayout11f44:new e.StructArrayLayout3f2f3f32,this._indexArray=new e.StructArrayLayout3ui6),t.useEvennessUV){this._evennessUV.push(0,0,0,1);const t=[0];for(let i=1;i<this._positions.length;i++){const s=t[i-1]+e.Vector3.distance(this._positions[i-1],this._positions[i]);t.push(s);}for(let e=1;e<t.length-1;e++){const i=t[e]/t[t.length-1];this._evennessUV.push(i,0,i,1,i,0,i,1);}this._evennessUV.push(1,0,1,1);}this._parse(),this.computeBoundingSphere(),this.computeBoundingBox();}static fromConstantHeights(t){const i=t.positions;if(!e.defined(i))throw new Error("options.positions is required.");let s,r;const n=t.minimumHeight,o=t.maximumHeight,a=e.defaultValue(t.useEvennessUV,!1),l=e.defined(n),h=e.defined(o);if(l||h){const e=i.length;s=l?new Array(e):void 0,r=h?new Array(e):void 0;for(let t=0;t<e;++t)l&&(s[t]=n),h&&(r[t]=o);}return new Qg({positions:i,maximumHeights:r,minimumHeights:s,useEvennessUV:a})}_parse(){const t=new e.Vector3,i=new e.Vector3,s=new e.Vector3,r=new e.Vector3,n=this._ellipsoid,o=fg.computePositions(n,this._positions,this._maximumHeights,this._minimumHeights,this._granularity,!0);if(!e.defined(o))return;const a=o.bottomPositions,l=o.topPositions,h=o.numCorners;let _=l.length,c=2*_,d=0;for(let t=0;t<_/3;t++)d=Math.max(d,e.Vector3.distance(e.Vector3.fromArray(l,3*t),e.Vector3.fromArray(a,3*t)));const u=new Float64Array(c),m=new Float32Array(c),p=new Float32Array(c/3*2);let f,g=0,y=0,T=0,C=new e.Vector3,x=!0;_/=3;let b=0;const v=1/(_-h-1);for(f=0;f<_;++f){const o=3*f,h=e.Vector3.fromArray(l,o,t),c=e.Vector3.fromArray(a,o,i);u[g++]=c.x,u[g++]=c.y,u[g++]=c.z,u[g++]=h.x,u[g++]=h.y,u[g++]=h.z,p[T++]=b,p[T++]=0,p[T++]=b,p[T++]=e.Vector3.distance(h,c)/d;let w=e.Vector3.clone(e.Vector3.ZERO,r);const S=e.Vector3.subtract(h,n.geodeticSurfaceNormal(h,i),i);if(f+1<_&&(w=e.Vector3.fromArray(l,o+3,r)),x){const i=e.Vector3.subtract(w,h,s),r=e.Vector3.subtract(S,h,t);C=e.Vector3.normalize(e.Vector3.cross(r,i,C),C),x=!1;}e.Vector3.equalsEpsilon(h,w,e.CONSTS.CesiumMath.EPSILON10)?x=!0:b+=v,m[y++]=C.x,m[y++]=C.y,m[y++]=C.z,m[y++]=C.x,m[y++]=C.y,m[y++]=C.z;}const w=c/3;c-=6*(h+1);const S=new Uint16Array(c);let A=0;for(f=0;f<w-2;f+=2){const s=f,r=f+2,n=e.Vector3.fromArray(u,3*s,t),o=e.Vector3.fromArray(u,3*r,i);if(e.Vector3.equalsEpsilon(n,o,e.CONSTS.CesiumMath.EPSILON10))continue;const a=f+1,l=f+3;S[A++]=s,S[A++]=a,S[A++]=l,S[A++]=s,S[A++]=l,S[A++]=r;}this.vertices=u,this.indices=S,this.normals=m;for(let e=0;e<this._evennessUV.length;e++)p[e]=this._evennessUV[e];this.uvs=p;for(let e=0;e<S.length;e+=3)this._indexArray.emplaceBack(S[e],S[e+1],S[e+2]);const E=new e.Vector3;for(let t=0;t<this.vertices.length;t+=3)e.Vector3.fromArray(this.vertices,t,E),this.vertices[t]=E.x,this.vertices[t+1]=E.y,this.vertices[t+2]=E.z;this.emplaceVertexBufferTriangle();}update(t){if(this._needUpdate&&t.painter){const i=t.painter.context;this._vertexBuffer&&this._indexBuffer?(this._vertexBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indexArray)):(this._vertexBuffer=i.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?e.layout.members:e.layout$1.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indexArray,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/3),this._needUpdate=!1;}}serialize(){const t=[];for(let i=0;i<this._positions.length;i++)t.push(e.Vector3.pack(this._positions[i],new Array(3)));return {type:this.type,positions:t,maximumHeights:this._maximumHeights,minimumHeights:this._minimumHeights}}destroy(){super.destroy(),this._vertexBuffer=void 0,this._indexBuffer=void 0,this._segmentVector=void 0,this._needUpdate=void 0,this._positions=void 0,this._maximumHeights=void 0,this._minimumHeights=void 0,this._granularity=void 0,this._ellipsoid=void 0,this.vertices=void 0,this.indices=void 0,this.normals=void 0,this.uvs=void 0,this._vertexArray=void 0,this._indexArray=void 0,this.primitiveType=void 0,this.type=void 0,this._segmentVector?.destroy(),this._segmentVector=void 0;}}class $g extends e.Geometry{constructor(e){super(e),this.setData(e);}setData(t){if(super.setData(),!t.positions)throw new Error("gradient color 数据为空");this.vertices=t.positions.flat(),this.uvs=t.values,this.index=t.index,this.type="GradientColorBoxGeometry",this._usedDoublePrecision=!1,this._vertexArray?(this._vertexArray.clear(),this._indexArray.clear()):(this._vertexArray=this._usedDoublePrecision?new e.StructArrayLayout11f44:new e.StructArrayLayout3f2f3f32,this._indexArray=new e.StructArrayLayout3ui6),this._needUpdate=!0,this.primitiveType=e.WebGLConstants.TRIANGLES,this.parse();}updateProperty(e){this.setData(e);}updateGradientColorBoxGeometry(e){console.warn("geometry的数据更新已经全面采用了setData,参数不变，方法名变更了！"),this.setData(e);}parse(){for(let e=0;e<this.index.length;e+=3)this._indexArray.emplaceBack(this.index[e],this.index[e+1],this.index[e+2]);if(this._usedDoublePrecision){let t,i,s;for(let r=0;r<this.vertices.length;r+=3)t=e.EncodedVector3.encode(this.vertices[r]),i=e.EncodedVector3.encode(this.vertices[r+1]),s=e.EncodedVector3.encode(this.vertices[r+2]),this._vertexArray.emplaceBack(t.high,i.high,s.high,t.low,i.low,s.low,this.uvs[r/3],0,0,0,0);}else for(let e=0;e<this.vertices.length;e+=3)this._vertexArray.emplaceBack(this.vertices[e],this.vertices[e+1],this.vertices[e+2],this.uvs[e/3],0,0,0,0);}update(t){if(this._needUpdate&&t.painter){const i=t.painter.context;this._vertexBuffer&&this._indexBuffer?(this._vertexBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indexArray)):(this._vertexBuffer=i.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?e.layout.members:e.layout$1.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indexArray,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.index.length/3),this._needUpdate=!1;}}serialize(){return {type:this.type,positions:this.vertices,index:this.index,values:this.uvs}}destroy(){super.destroy(),this.vertices=void 0,this.uvs=void 0,this.index=void 0,this._vertexArray=void 0,this._indexArray=void 0,this._needUpdate=!1;}}class ey extends e.Geometry{constructor(t){super(t),this.type="PlaneGeometry",this.primitiveType=e.WebGLConstants.TRIANGLES,this.setData(t);}setData(t){if(super.setData(),!e.defined(t.position))throw new Error("options.position is required.");if(!e.defined(t.normal))throw new Error("options.normal is required.");if(!e.defined(t.dimensions))throw new Error("options.dimensions is required.");this._origin=t.position,this._normal=t.normal,this._distance=e.defaultValue(t.distance,0),this._dimensions=t.dimensions,this._modelMatrix=void 0,this.vertices=new Float64Array(12),this.normals=new Float32Array(12),this.indices=new Uint16Array(6),this.uvs=new Float32Array(8),this._vertexArray?(this._vertexArray.clear(),this._indexArray.clear()):(this._vertexArray=new e.StructArrayLayout11f44,this._indexArray=new e.StructArrayLayout3ui6),this.needUpdate=!0,this._usedDoublePrecision=!0,this._parse(),this.computeBoundingSphere(),this.computeBoundingBox();}updateProperty(e){console.warn("geometry的数据更新已经全面采用了setData,参数不变，方法名变更了！"),this.setData(e);}_parse(){this._computeMatrix(),this._computeVertices(),this._computeNormals(),this._computeUvs(),this._computeIndices(),this._recalculateGeometry(),this._createGeometry();}_computeMatrix(){const t=new e.Vector3,i=new e.Vector3,s=new e.Vector3,r=new e.Vector3,n=new e.Matrix3,o=new e.Matrix4,a=this._normal,l=e.Vector3.multiplyByScalar(a,-this._distance,s);let h=e.Vector3.clone(e.Vector3.UNIT_Z,i);e.CONSTS.CesiumMath.equalsEpsilon(Math.abs(e.Vector3.dot(h,a)),1,e.CONSTS.CesiumMath.EPSILON8)&&(h=e.Vector3.clone(e.Vector3.UNIT_Y,h));const _=e.Vector3.cross(h,a,t);h=e.Vector3.cross(a,_,h),e.Vector3.normalize(_,_),e.Vector3.normalize(h,h);const c=new e.Matrix3;e.Matrix3.setColumn(c,0,_,c),e.Matrix3.setColumn(c,1,h,c),e.Matrix3.setColumn(c,2,a,c);const d=e.Vector3.fromElements(this._dimensions.x,this._dimensions.y,1,r),u=e.Matrix3.multiplyByScale(c,d,n),m=e.Matrix4.fromRotationTranslation(u,l,o);this._modelMatrix=e.Transforms.eastNorthUpToFixedFrame(this._origin,void 0),e.Matrix4.multiplyTransformation(this._modelMatrix,m,this._modelMatrix);}_computeVertices(){const t=new e.Vector3(-.5,-.5,0),i=new e.Vector3(.5,.5,0);this.vertices[0]=t.x,this.vertices[1]=t.y,this.vertices[2]=0,this.vertices[3]=i.x,this.vertices[4]=t.y,this.vertices[5]=0,this.vertices[6]=i.x,this.vertices[7]=i.y,this.vertices[8]=0,this.vertices[9]=t.x,this.vertices[10]=i.y,this.vertices[11]=0;}_computeNormals(){this.normals[0]=0,this.normals[1]=0,this.normals[2]=1,this.normals[3]=0,this.normals[4]=0,this.normals[5]=1,this.normals[6]=0,this.normals[7]=0,this.normals[8]=1,this.normals[9]=0,this.normals[10]=0,this.normals[11]=1;}_computeUvs(){this.uvs[0]=0,this.uvs[1]=0,this.uvs[2]=1,this.uvs[3]=0,this.uvs[4]=1,this.uvs[5]=1,this.uvs[6]=0,this.uvs[7]=1;}_computeIndices(){this.indices[0]=0,this.indices[1]=1,this.indices[2]=2,this.indices[3]=0,this.indices[4]=2,this.indices[5]=3;}_recalculateGeometry(){let t=new e.Vector3,i=this.vertices.length;for(let s=0;s<i;s+=3)e.Vector3.unpack(this.vertices,s,t),e.Matrix4.multiplyByPoint(this._modelMatrix,t,t),e.Vector3.pack(t,this.vertices,s);const s=new e.Matrix4,r=new e.Matrix3;e.Matrix4.inverse(this._modelMatrix,s),e.Matrix4.transpose(s,s),e.Matrix4.getMatrix3(s,r),i=this.normals.length;for(let s=0;s<i;s+=3)e.Vector3.unpack(this.normals,s,t),e.Matrix3.multiplyByVector(r,t,t),t=e.Vector3.normalize(t,t),e.Vector3.pack(t,this.normals,s);}_createGeometry(){for(let e=0;e<this.indices.length;e+=3)this._indexArray.emplaceBack(this.indices[e],this.indices[e+2],this.indices[e+1]);this.emplaceVertexBufferTriangle();}update(t){if(this.needUpdate&&t.painter){this.needUpdate=!1;const i=t.painter.context;this._vertexBuffer&&this._indexBuffer?(this._vertexBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indexArray)):(this._vertexBuffer=i.createVertexBuffer(this._vertexArray,e.layout.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indexArray,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/3);}}serialize(){return {type:this.type,position:e.Vector3.pack(this._origin,new Array(3)),normal:e.Vector3.pack(this._normal,new Array(3)),distance:this._distance,dimensions:e.Vector2.pack(this._dimensions,new Array(2))}}destroy(){super.destroy(),this._origin=void 0,this._dimensions=void 0,this._distance=void 0,this._normal=void 0,this._modelMatrix=void 0,this.vertices=void 0,this.normals=void 0,this.indices=void 0,this.uvs=void 0,this.type=void 0,this.primitiveType=void 0,this._vertexArray=void 0,this._indexArray=void 0,this.needUpdate=void 0,this._segmentVector=void 0;}}class ty extends e.Geometry{constructor(t){super(t),this.type="PlaneOutlineGeometry",this.primitiveType=e.WebGLConstants.LINE_LOOP,this.setData(t);}setData(t){if(super.setData(),!e.defined(t.position))throw new Error("options.position is required.");if(!e.defined(t.normal))throw new Error("options.normal is required.");if(!e.defined(t.dimensions))throw new Error("options.dimensions is required.");this._origin=t.position,this._dimensions=t.dimensions,this._normal=t.normal,this._distance=e.defaultValue(t.distance,0),this._modelMatrix=void 0,this.vertices=new Float64Array(12),this.indices=new Uint16Array(6),this._vertexArray?(this._vertexArray.clear(),this._indexArray.clear()):(this._vertexArray=new e.StructArrayLayout3f3f24,this._indexArray=new e.StructArrayLayout2ui4),this.needUpdate=!0,this._usedDoublePrecision=!0,this.parse(),this.computeBoundingSphere(),this.computeBoundingBox();}parse(){this._computeMatrix(),this._computeVertices(),this._computeIndices(),this._recalculateGeometry(),this._createGeometry();}_computeMatrix(){const t=new e.Vector3,i=new e.Vector3,s=new e.Vector3,r=new e.Vector3,n=new e.Matrix3,o=new e.Matrix4,a=this._normal,l=e.Vector3.multiplyByScalar(a,-this._distance,s);let h=e.Vector3.clone(e.Vector3.UNIT_Z,i);e.CONSTS.CesiumMath.equalsEpsilon(Math.abs(e.Vector3.dot(h,a)),1,e.CONSTS.CesiumMath.EPSILON8)&&(h=e.Vector3.clone(e.Vector3.UNIT_Y,h));const _=e.Vector3.cross(h,a,t);h=e.Vector3.cross(a,_,h),e.Vector3.normalize(_,_),e.Vector3.normalize(h,h);const c=new e.Matrix3;e.Matrix3.setColumn(c,0,_,c),e.Matrix3.setColumn(c,1,h,c),e.Matrix3.setColumn(c,2,a,c);const d=e.Vector3.fromElements(this._dimensions.x,this._dimensions.y,1,r),u=e.Matrix3.multiplyByScale(c,d,n),m=e.Matrix4.fromRotationTranslation(u,l,o);this._modelMatrix=e.Transforms.eastNorthUpToFixedFrame(this._origin,void 0),e.Matrix4.multiplyTransformation(this._modelMatrix,m,this._modelMatrix);}_computeVertices(){const t=new e.Vector3(-.5,-.5,0),i=new e.Vector3(.5,.5,0);this.vertices[0]=t.x,this.vertices[1]=t.y,this.vertices[2]=t.z,this.vertices[3]=i.x,this.vertices[4]=t.y,this.vertices[5]=t.z,this.vertices[6]=i.x,this.vertices[7]=i.y,this.vertices[8]=t.z,this.vertices[9]=t.x,this.vertices[10]=i.y,this.vertices[11]=t.z;}_computeIndices(){this.indices[0]=0,this.indices[1]=1,this.indices[2]=1,this.indices[3]=2,this.indices[4]=2,this.indices[5]=3,this.indices[6]=3,this.indices[7]=0;}_recalculateGeometry(){const t=new e.Vector3,i=this.vertices.length;for(let s=0;s<i;s+=3)e.Vector3.unpack(this.vertices,s,t),e.Matrix4.multiplyByPoint(this._modelMatrix,t,t),e.Vector3.pack(t,this.vertices,s);}_createGeometry(){this.emplaceVertexBufferOfLines();for(let e=0;e<this.indices.length/2;e++)this._indexArray.emplaceBack(this.indices[2*e],this.indices[2*e+1]);}update(t){if(this.needUpdate&&t.painter){this.needUpdate=!1;const i=t.painter.context;this._vertexBuffer&&this._indexBuffer?(this._vertexBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indexArray)):(this._vertexBuffer=i.createVertexBuffer(this._vertexArray,ju.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indexArray,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/2);}}serialize(){return {type:this.type,position:e.Vector3.pack(this._origin,new Array(3)),normal:e.Vector3.pack(this._normal,new Array(3)),distance:this._distance,dimensions:e.Vector2.pack(this._dimensions,new Array(2))}}destroy(){super.destroy(),this._origin=void 0,this._dimensions=void 0,this._normal=void 0,this._distance=void 0,this._modelMatrix=void 0,this.vertices=void 0,this.indices=void 0,this.type=void 0,this._vertexArray=void 0,this._indexArray=void 0,this.primitiveType=void 0,this.needUpdate=void 0,this._segmentVector=void 0;}}class iy extends e.Geometry{constructor(t){if(super(t),!e.defined(t.positions))throw new Error("options.positions is required.");if(e.defined(t.maximumHeights)&&t.maximumHeights.length!==t.positions.length)throw new Error("options.positions and options.maximumHeights must have the same length.");if(e.defined(t.minimumHeights)&&t.minimumHeights.length!==t.positions.length)throw new Error("options.positions and options.minimumHeights must have the same length.");this._positions=t.positions,this._maximumHeights=t.maximumHeights,this._minimumHeights=t.minimumHeights,this._granularity=e.defaultValue(t.granularity,e.CONSTS.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=e.defaultValue(t.ellipsoid,e.Ellipsoid.WGS84),this.vertices=void 0,this.indices=void 0,this._usedDoublePrecision=!0,this._vertexArray=new e.StructArrayLayout3f3f24,this._indexArray=new e.StructArrayLayout2ui4,this.primitiveType=e.WebGLConstants.LINES,this.type="WallOutlineGeometry",this.updateProperty(t);}updateProperty(e){this.setData(e);}setData(t){super.setData(),this.vertices=void 0,this.indices=void 0,this.normals=void 0,this.uvs=void 0,this._vertexArray?(this._vertexArray.clear(),this._indexArray.clear()):(this._indexArray=new e.StructArrayLayout2ui4,this._vertexArray=new e.StructArrayLayout3f3f24),this._positions=t.positions,this._maximumHeights=t.maximumHeights,this._minimumHeights=t.minimumHeights,this._granularity=e.defaultValue(t.granularity,e.CONSTS.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=e.defaultValue(t.ellipsoid,e.Ellipsoid.WGS84),this._needUpdate=!0,this.parse(),this.computeBoundingSphere(),this.computeBoundingBox();}static fromConstantHeights(t){const i=t.positions;if(!e.defined(i))throw new Error("options.positions is required.");let s,r;const n=t.minimumHeight,o=t.maximumHeight,a=e.defined(n),l=e.defined(o);if(a||l){const e=i.length;s=a?new Array(e):void 0,r=l?new Array(e):void 0;for(let t=0;t<e;++t)a&&(s[t]=n),l&&(r[t]=o);}return new iy({positions:i,maximumHeights:r,minimumHeights:s,ellipsoid:t.ellipsoid})}parse(){const t=new e.Vector3,i=new e.Vector3,s=fg.computePositions(this._ellipsoid,this._positions,this._maximumHeights,this._minimumHeights,this._granularity,!1);if(!e.defined(s))return;const r=s.bottomPositions,n=s.topPositions;let o=n.length,a=2*o;const l=new Float64Array(a);let h,_=0;for(o/=3,h=0;h<o;++h){const s=3*h,o=e.Vector3.fromArray(n,s,t),a=e.Vector3.fromArray(r,s,i);l[_++]=a.x,l[_++]=a.y,l[_++]=a.z,l[_++]=o.x,l[_++]=o.y,l[_++]=o.z;}this.vertices=l;const c=a/3;a=2*c-4+c;const d=new Uint16Array(a);let u=0;for(h=0;h<c-2;h+=2){const s=h,r=h+2,n=e.Vector3.fromArray(l,3*s,t),o=e.Vector3.fromArray(l,3*r,i);if(e.Vector3.equalsEpsilon(n,o,e.CONSTS.CesiumMath.EPSILON10))continue;const a=h+1,_=h+3;d[u++]=a,d[u++]=s,d[u++]=a,d[u++]=_,d[u++]=s,d[u++]=r;}for(d[u++]=c-2,d[u++]=c-1,this.indices=d,this.emplaceVertexBufferOfLines(),h=0;h<this.indices.length/2;h++)this._indexArray.emplaceBack(this.indices[2*h],this.indices[2*h+1]);}update(t){if(this._needUpdate&&t.painter){const i=t.painter.context;this._vertexBuffer?(this._vertexBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indexArray)):(this._vertexBuffer=i.createVertexBuffer(this._vertexArray,ju.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indexArray,this.dynamicDraw)),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length/3,this.indices.length/2),this._needUpdate=!1;}}serialize(){return {type:this.type,positions:this._positions,maximumHeights:this._maximumHeights,minimumHeights:this._minimumHeights}}destroy(){super.destroy(),this._positions=void 0,this._maximumHeights=void 0,this._minimumHeights=void 0,this._granularity=void 0,this._ellipsoid=void 0,this.vertices=void 0,this.indices=void 0,this._vertexArray=void 0,this._indexArray=void 0,this.primitiveType=void 0,this._needUpdate=void 0,this.type=void 0,this._segmentVector=void 0;}}class sy extends e.Material{constructor(t){t.defines=null,t.type="GradientColorBoxMaterial";let i="attribute vec3 a_POSITION; \nattribute vec2 a_TEXCOORD_0; \nvarying vec4 v_color; \nuniform mat4 u_ModelViewProjectionMatrix; \nuniform vec3 a_NORMAL; \n";i+="void main() { \n",i+="gl_Position = u_ModelViewProjectionMatrix * vec4(a_POSITION.xyz, 1.0); \n";const s=t.gradientColor.slice();for(let t=0;t<s.length-1;t++){const r=e.Color.parse(s[t][1]),n=`vec4(float(${r.r}) , float(${r.g}), float(${r.b}), float(${r.a}))`,o=e.Color.parse(s[t+1][1]);i+=`if(float(${s[t][0]}) <= a_TEXCOORD_0.s && a_TEXCOORD_0.s <= float(${s[t+1][0]})) \n`,i+="{ \n",i+=`float mixParam = (a_TEXCOORD_0.s - float(${s[t][0]})) / (float(${s[t+1][0]}) - float(${s[t][0]})); \n`,i+=`v_color = mix(${n}, vec4(float(${o.r}), float(${o.g}), float(${o.b}), float(${o.a})), mixParam);`,i+="} \n";}i+="}",t.fragmentSource="precision highp float;\nvarying vec4 v_color;\n\nvoid main() {\n    gl_FragColor = v_color;\n}",t.vertexSource=i;const r=e.Material.getDefaultRenderState();r.cull.enabled=e.defaultValue(!t.doubleSided,!0),t.renderState=r,super(t),this.gradientColor=e.defaultValue(t.gradientColor,void 0);}updateMaterialProperty(e){this._shaderSource=void 0;const t=new sy(e);this._shaderSource&&this._shaderSource.destroy(),this._shaderSource=t._shaderSource;}serialize(){return {type:this.type,gradientColor:this.gradientColor,doubleSided:this._doubleSided}}destroy(){}}class ry extends e.Material{constructor(t){t.type="WaterMaterial",super(t),this._speed=void 0!==t.speed?1*t.speed/60:1/60,this._alpha=t.opacity;try{this._waterColor=e.defined(t.color)?e.Color.parse(t.color).toVector3():new e.Vector3(0,0,1);}catch(i){if("object"==typeof t.color&&e.defined(t.color.r)&&e.defined(t.color.g)&&e.defined(t.color.b))throw new Error("当前类型的Color为非法！请修改为标准的Color Input类型！")}this._texture=void 0!==t.texture?t.texture:null,this._sunLightDirection=void 0!==t.sunLightDirection?new e.Vector3(t.sunLightDirection):null,this._sunLightColor=void 0!==t.sunLightColor?new e.Vector3(t.sunLightColor.r,t.sunLightColor.g,t.sunLightColor.b):new e.Vector3(1,1,1),this._waveSize=e.defaultValue(1/t.waveSize,1),this._time=0,this._skyColor=e.defined(t.skyColor)?new e.Vector3(t.skyColor.r,t.skyColor.g,t.skyColor.b):new e.Vector3(1,1,1),this._enableSSR=!!e.defined(t.enableSSR)&&t.enableSSR,this._enableSSR&&(this._colorTexture=null,this._depthTexture=null,this._normalTexture=null,this.SSRState=!1);}enableSSR(){this._enableSSR=!0;}disableSSR(){this._enableSSR=!1;}update(t,i,s={}){super.update(t,i,s),t.enableSSR=this._enableSSR,this._uniforms.set("u_SkyColor",(()=>this._skyColor)),this._uniforms.set("u_Opacity",(()=>this._alpha)),this._uniforms.set("u_Time",(()=>(this._time=this._time+this._speed,this._time))),this._uniforms.set("u_BaseColorSampler",(()=>(this._texture.sampler={minificationFilter:e.WebGLConstants.LINEAR_MIPMAP_LINEAR,magnificationFilter:e.WebGLConstants.LINEAR,wrapS:e.WebGLConstants.REPEAT,wrapT:e.WebGLConstants.REPEAT},this._texture))),this._uniforms.set("u_NormalSampler",(()=>{if(this.SSRState)return this._normalTexture})),this._uniforms.set("u_ColorSampler",(()=>{if(this.SSRState)return this._colorTexture})),this._uniforms.set("u_DepthSampler",(()=>{if(this.SSRState)return this._depthTexture})),this._uniforms.set("u_Width",(()=>t.width)),this._uniforms.set("u_Height",(()=>t.height)),this._uniforms.set("u_Color",(()=>this._waterColor)),this._uniforms.set("u_DistortionScale",(()=>3.7)),this._uniforms.set("u_SunColor",(()=>this._sunLightColor)),this._uniforms.set("u_SunDirection",(()=>this._sunLightDirection)),this._uniforms.set("u_WaveSize",(()=>this._waveSize));}serialize(){return {type:this.type,texture:this._texture.serialize(),opacity:this._alpha,color:e.Vector3.pack(this._waterColor,new Array(3)),sunLightColor:e.Vector3.pack(this._sunLightColor,new Array(3)),sunLightDirection:e.Vector3.pack(this._sunLightDirection,new Array(3)),waveSize:1/this._waveSize,skyColor:e.Vector3.pack(this._skyColor,new Array(3)),speed:60*this._speed,enableSSR:this._enableSSR}}destroy(){}}const ny={BoxGeometry:Jg,BoxOutlineGeometry:Dp,ConeGeometry:Zg,CylinderGeometry:Yg,FenceGeometry:Qg,FrustumGeometry:rg,FrustumOutlineGeometry:ng,GradientColorBoxGeometry:$g,PlaneGeometry:ey,PlaneOutlineGeometry:ty,PolygonGeometry:e.PolygonGeometry,PolygonOutlineGeometry:ug,PolylineGeometry:e.PolylineGeometry,SimplePolylineGeometry:qu,SphereGeometry:zh,WallGeometry:yg,WallOutlineGeometry:iy},oy={GradientColorBoxMaterial:sy,PolylineMaterial:e.PolylineMaterial,StandardMaterial:e.StandardMaterial,PhongMaterial:ha,gltfPBR:aa,WaterMaterial:ry};function ay(t,i){const s=i.geometry;if(!e.defined(s))throw new Error("geometry's options is not defined!");const r=i.material;if(!e.defined(s))throw new Error("material's options is not defined!");if(!e.defined(s)&&!e.defined(r))return;const n=function(t){const i=t.type;let s;switch(i){case"BoxGeometry":case"ConeGeometry":case"CylinderGeometry":case"GradientColorBoxGeometry":case"SphereGeometry":break;case"BoxOutlineGeometry":t.minPoint=e.Vector3.unpack(t.minPoint),t.maxPoint=e.Vector3.unpack(t.maxPoint);break;case"FenceGeometry":case"PolylineGeometry":case"SimplePolylineGeometry":case"WallGeometry":case"WallOutlineGeometry":if(e.defined(t.positions))for(let i=0;i<t.positions.length;i++)t.positions[i]=e.Vector3.unpack(t.positions[i]);break;case"FrustumGeometry":case"FrustumOutlineGeometry":"PerspectiveCamera"===t.camera.type?s=new l(t.camera.fov,t.camera.aspect,t.camera.near,t.camera.far):"OrthographicCamera"===t.camera.type&&(s=new h(t.camera.width,t.camera.aspect,t.camera.near,t.camera.far),s.setMatrix(new e.Matrix4(t.camera.matrix))),t=s;break;case"PlaneGeometry":case"PlaneOutlineGeometry":t.position=e.Vector3.unpack(t.position),t.normal=e.Vector3.unpack(t.normal),t.dimensions=e.Vector2.unpack(t.dimensions);break;case"PolygonGeometry":case"PolygonOutlineGeometry":t.polygonHierarchy=e.PolygonPipeline.hierarchyUnpack(t.polygonHierarchy,{});break;default:throw new Error("Unknown geometry type!")}return new ny[i](t)}(s),o=function(t,i){const s=t.type;let r;switch(s){case"StandardMaterial":e.defined(t.color)&&(t.color=e.Color.unpack(t.color)),e.defined(t.texUrl)&&(t.baseColorTexture=(new oa).load({map:i,texUrl:t.texUrl})),r=oy[s].fromType(t.texTYpe,t),e.defined(t.flowOptions)&&r.flowTexture(t.flowOptions);break;case"GradientColorBoxMaterial":case"PolylineMaterial":case"PhongMaterial":case"gltfPBR":case"WaterMaterial":e.defined(t.color)&&(t.color=e.Color.unpack(t.color).toVector3()),e.defined(t.sunLightColor)&&(t.sunLightColor=e.Color.unpack(t.sunLightColor)),e.defined(t.skyColor)&&(t.skyColor=e.Color.unpack(t.skyColor)),e.defined(t.texture)&&e.defined(t.texture.texUrl)&&(t.texture=(new oa).load({map:i,texUrl:t.texture.texUrl})),e.defined(t.baseColorTextureUrl)&&(t.baseColorTexture=(new oa).load({map:i,texUrl:t.baseColorTextureUrl})),e.defined(t.normalTextureUrl)&&(t.normalTexture=(new oa).load({map:i,texUrl:t.normalTextureUrl})),e.defined(t.metallicRoughnessTextureUrl)&&(t.metallicRoughnessTexture=(new oa).load({map:i,texUrl:t.metallicRoughnessTextureUrl})),r=new oy[s](t);break;default:throw new Error("Unknown material type!")}return r}(r,t),a={geometry:n,material:o},_=i.modelMatrix;return e.defined(_)&&(a.modelMatrix=new e.Matrix4(_)),e.defined(i.id)&&(a.id=i.id),new e.Primitive(a)}class ly{constructor(){}static deserialize(t,i,s){if(e.defined(i.projection)&&(t.projection=i.projection),s.useCustomCamera){const s=i.camera;e.defined(s)&&t.jumpTo({target:s.position,bearing:e.defined(s.bearing)?s.bearing:0,pitch:e.defined(s.pitch)?s.pitch:0,roll:e.defined(s.roll)?s.roll:0});}!function(t,i){e.defined(i.metadata)&&(i.metadata.enableNormal?t.enableNormalPass():t.disableNormalPass(),i.metadata.resolvePass&&t.setResolvePass(i.metadata.resolvePass));}(t,i),e.defined(i.terrain)&&t.setTerrain(i.terrain),function(t,i){if(e.defined(i.lights)){let s,r;i.lights.forEach((i=>{switch(i.type){case"AmbientLight":t.addLight(new Ld(e.Color.unpack(i.color),i.intensity));break;case"DirectionalLight":i.color=e.Color.unpack(i.color),s=new Ko(i.color,i.intensity),s.setPosition(i.lightPosition,i.targetPosition),t.addLight(s);break;case"PointLight":i.color=e.Color.unpack(i.color),r=new lf(i.color,i.intensity,i.distane,i.decay),r.setPosition(i.position),t.addLight(r);break;case"SunLight":i.color=e.Color.unpack(i.color),t.addLight(new ra(i.color,i.intensity,i.timeStamp));break;default:t.enableLight(i.enableLight);}}));}}(t,i),function(t,i){if(e.defined(i.sceneComponent)){if(e.defined(i.sceneComponent.sceneModels))for(let s=0;s<i.sceneComponent.sceneModels.length;s++){const r=i.sceneComponent.sceneModels[s];if(e.defined(r.positions))for(let t=0;t<r.positions.length;t++)r.positions[t]=e.Vector3.unpack(r.positions[t]);if(e.defined(r.rotations))for(let t=0;t<r.rotations.length;t++)r.rotations[t]=new e.HeadingPitchRoll(r.rotations[t].heading,r.rotations[t].pitch,r.rotations[t].roll);if(e.defined(r.scales))for(let t=0;t<r.scales.length;t++)r.scales[t]=e.Vector3.unpack(r.scales[t]);if(e.defined(r.colors))for(let t=0;t<r.colors.length;t++)r.colors[t]=e.Color.unpack(r.colors[t]);if(r.type="3d-model",e.defined(r.clippingPlanes)&&e.defined(r.clippingPlanes.planes)){const t=[];for(let i=0;i<r.clippingPlanes.planes.length;i++){const s=r.clippingPlanes.planes[i];s.position=e.Vector3.unpack(s.position),s.normal=e.Vector3.unpack(s.normal),t.push(new e.ClippingPlane(s));}r.clippingPlanes=new e.ClippingPlaneCollection({modelMatrix:new e.Matrix4(r.clippingPlanes.modelMatrix),edgeColor:e.Color.unpack(r.clippingPlanes.edgeColor),edgeWidth:r.clippingPlanes.edgeWidth,enabled:r.clippingPlanes.enabled,unionClippingRegions:r.clippingPlanes.unionClippingRegions,planes:t});}t.addSceneComponent(r);}if(e.defined(i.sceneComponent.sceneTilesets))for(let s=0;s<i.sceneComponent.sceneTilesets.length;s++){const r=i.sceneComponent.sceneTilesets[s];if(e.defined(r.translation)&&(r.translation=e.Vector3.unpack(r.translation)),e.defined(r.clippingPlanes)){const t=[];for(let i=0;i<r.clippingPlanes.planes.length;i++){const s=r.clippingPlanes.planes[i];s.position=e.Vector3.unpack(s.position),s.normal=e.Vector3.unpack(s.normal),t.push(new e.ClippingPlane(s));}r.clippingPlanes=new e.ClippingPlaneCollection({modelMatrix:new e.Matrix4(r.clippingPlanes.modelMatrix),edgeColor:e.Color.unpack(r.clippingPlanes.edgeColor),edgeWidth:r.clippingPlanes.edgeWidth,enabled:r.clippingPlanes.enabled,planes:t});}t.addSceneComponent(r);}if(e.defined(i.sceneComponent.primitives))for(let e=0;e<i.sceneComponent.primitives.length;e++)t.addPrimitive(ay(t,i.sceneComponent.primitives[e]));if(e.defined(i.sceneComponent.sceneObjects))for(let e=0;e<i.sceneComponent.sceneObjects.length;e++){const s=i.sceneComponent.sceneObjects[e];"airLine"==s.type&&t.addSceneComponent(new Ju(s));}const s=i.sceneComponent.skybox;e.defined(s)&&t.addSceneComponent(new Uu({starrySkyTextureUrls:s.starrySkyTextureUrls,dayTextureUrls:s.dayTextureUrls}));}}(t,i),function(t,i){if(e.defined(i.animations))for(let e=0;e<i.animations.length;e++)t.animationManager.add(i.animations[e]).then((e=>{e.forEach((e=>{e.play();}));}));}(t,i),function(t,i){if(e.defined(i.videoProjection))for(let e=0;e<i.videoProjection.length;e++)t.videoManager.add(new ag(i.videoProjection[e]));}(t,i),function(t,i){if(e.defined(i.analysis)){if(e.defined(i.analysis.viewDome))for(let s=0;s<i.analysis.viewDome.length;s++){const r=i.analysis.viewDome[s];r.viewPosition=e.Vector3.unpack(r.viewPosition),r.visibleAreaColor=e.Color.unpack(r.visibleAreaColor),r.hiddenAreaColor=e.Color.unpack(r.hiddenAreaColor),r.indicatorColor=e.Color.unpack(r.indicatorColor),r.indicatorOutlineColor=e.Color.unpack(r.indicatorOutlineColor),t.analysis.viewDomeCollection.add(new Ag(r));}if(e.defined(i.analysis.viewshed))for(let s=0;s<i.analysis.viewshed.length;s++){const r=i.analysis.viewshed[s];r.viewerPosition=e.Vector3.unpack(r.viewerPosition),r.visibleAreaColor=e.Color.unpack(r.visibleAreaColor),r.hiddenAreaColor=e.Color.unpack(r.hiddenAreaColor),r.lineColor=e.Color.unpack(r.lineColor),t.analysis.viewshed3DCollection.add(new Pg(r));}if(e.defined(i.analysis.sightLine))for(let s=0;s<i.analysis.sightLine.length;s++){const r=i.analysis.sightLine[s];r.viewerPosition=e.Vector3.unpack(r.viewerPosition),r.visibleColor=e.Color.unpack(r.visibleColor),r.hiddenColor=e.Color.unpack(r.hiddenColor),r.indicatorColor=e.Color.unpack(r.indicatorColor),r.indicatorOutlineColor=e.Color.unpack(r.indicatorOutlineColor),t.analysis.sightlineCollection.add(new Og(r));}if(e.defined(i.analysis.excavation))for(let s=0;s<i.analysis.excavation.length;s++){const r=i.analysis.excavation[s];r.positions=e.Vector3.fromDegreesArrayHeights(r.positions),t.analysis.excavationCollection.add(new bg(r));}if(e.defined(i.analysis.highlight))for(let s=0;s<i.analysis.highlight.length;s++){const r=i.analysis.highlight[s];for(let t=0;t<r.positions.length;t++)r.positions[t]=e.Vector3.unpack(r.positions[t]);r.invalidColor=e.Color.unpack(r.invalidColor),r.validColor=e.Color.unpack(r.validColor),r.validOutlineColor=e.Color.unpack(r.validOutlineColor),t.analysis.highlightCollection.add(new Vg(r));}if(e.defined(i.analysis.cutFill))for(let s=0;s<i.analysis.cutFill.length;s++){const r=i.analysis.cutFill[s];for(let t=0;t<r.positions.length;t++)r.positions[t]=e.Vector3.unpack(r.positions[t]);r.fillColor=e.Color.unpack(r.fillColor),r.cutColor=e.Color.unpack(r.cutColor),r.baseColor=e.Color.unpack(r.baseColor),r.baseOutlineColor=e.Color.unpack(r.baseOutlineColor),r.wallColor=e.Color.unpack(r.wallColor),r.wallOutlineColor=e.Color.unpack(r.wallOutlineColor),t.analysis.cutFillCollection.add(new mg(r));}}}(t,i),function(t,i){if(e.defined(i.postProcess)&&i.postProcess.blackWhite&&t.postProcessStages.add(op.createBlackAndWhiteStage()),e.defined(i.postProcess)&&i.postProcess.bloom&&(t.bloom=i.postProcess.bloom),e.defined(i.postProcess)&&i.postProcess.fxaa&&(t.fxaa=i.postProcess.fxaa),e.defined(i.postProcess)&&i.postProcess.nightVision&&t.postProcessStages.add(op.createNightVisionStage()),e.defined(i.postProcess)&&i.postProcess.hdr&&(t.hdr=i.postProcess.hdr),e.defined(i.postProcess)&&e.defined(i.postProcess.fog)){const s=op.createFogEffect({fogColor:e.Color.unpack(i.postProcess.fog.fogColor),fogDensity:i.postProcess.fog.fogDensity});t.postProcessStages.add(s);}e.defined(i.postProcess)&&e.defined(i.postProcess.skyline)&&t.postProcessStages.add(op.createSkyline({width:i.postProcess.skyline.width,color:new e.Color(e.Color.floatToByte(i.postProcess.skyline.color[0]),e.Color.floatToByte(i.postProcess.skyline.color[1]),e.Color.floatToByte(i.postProcess.skyline.color[2]),e.Color.floatToByte(i.postProcess.skyline.color[3]))}));}(t,i);}}class hy{constructor(t,i){this._map=t,this._enabled=e.defaultValue(i.scrollZoom,!0),this._enabled||this.disable();}setZoomRate(){console.warn("setZoomRate is deprecated!");}setWheelZoomRate(){console.warn("setWheelZoomRate is deprecated!");}isEnabled(){return !!this._enabled}isActive(){console.warn("setZoomRate is deprecated!");}isZooming(){return !!this._zooming}enable(){this._enabled=!0,this._map.cameraController.enableZoom=!0;}disable(){this._enabled=!1,this._map.cameraController.enableZoom=!1;}blur(){this.reset();}reset(){this._active=!1;}_isFullscreen(){return !!e.window.document.fullscreenElement}}class _y{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=i.clickTolerance||1,this._enabled=e.defaultValue(i.boxZoom,!0),this._enabled||this.disable();}isEnabled(){return !!this._enabled}isActive(){return !!this._active}enable(){this.isEnabled()||(this._enabled=!0);}disable(){this.isEnabled()&&(this._enabled=!1);}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(W.disableDrag(),this._startPos=this._lastPos=t,this._active=!0);}mousemoveWindow(e,t){if(!this._active)return;const i=t;if(this._lastPos.equals(i)||!this._box&&i.dist(this._startPos)<this._clickTolerance)return;const s=this._startPos;this._lastPos=i,this._box||(this._box=W.create("div","minemap-boxzoom",this._container),this._container.classList.add("minemap-crosshair"),this._fireEvent("boxzoomstart",e));const r=Math.min(s.x,i.x),n=Math.max(s.x,i.x),o=Math.min(s.y,i.y),a=Math.max(s.y,i.y);this._map._requestDomTask((()=>{this._box&&(W.setTransform(this._box,`translate(${r}px,${o}px)`),this._box.style.width=n-r+"px",this._box.style.height=a-o+"px");}));}mouseupWindow(t){if(!this._active)return;if(0!==t.button)return;const i=this._startPos,s=W.mousePos(this._el,t);this.reset(),W.suppressClick(),i.x===s.x&&i.y===s.y?this._fireEvent("boxzoomcancel",t):(this._map.fitScreenCoordinates(i,s,this._map.getBearing(),{linear:!0}),this._map.fire(new e.Event("boxzoomend",{originalEvent:t})));}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e));}blur(){this.reset();}reset(){this._active=!1,this._container.classList.remove("minemap-crosshair"),this._box&&(W.remove(this._box),this._box=null),W.enableDrag(),delete this._startPos,delete this._lastPos;}_fireEvent(t,i){return this._map.fire(new e.Event(t,{originalEvent:i}))}}class cy{constructor(t,i){this._map=t,this._enable=e.defaultValue(i.dragRotate,!0),this._enable||this.disable();}enable(){this._enable=!0,this._map.cameraController.enableTilt=!0;}disable(){this._enable=!1,this._map.cameraController.enableTilt=!1;}isEnabled(){return this._enable}isActive(){}}class dy{constructor(t,i){this._map=t,this._enable=e.defaultValue(i.dragRotate,!0),this._enable||this.disable();}enable(){this._enable=!0,this._map.cameraController.enableRotate=!0;}disable(){this._enable=!1,this._map.cameraController.enableRotate=!1;}isEnabled(){return this._enable}isActive(){}}const uy={panStep:100,bearingStep:15,pitchStep:10};class my{constructor(t,i){this._map=t;const s=uy;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1,this._enabled=e.defaultValue(i.keyboard,!0),this._enabled||this.disable();}blur(){this.reset();}reset(){this._active=!1;}keydown(t){if(!this._enabled||!this._map._interactive||t.altKey||t.ctrlKey||t.metaKey)return;let i=0,s=0,r=0,n=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:i=t.shiftKey?2:1;break;case 189:case 109:case 173:i=t.shiftKey?-2:-1;break;case 37:t.shiftKey?s=-1:(t.preventDefault(),n=-1);break;case 39:t.shiftKey?s=1:(t.preventDefault(),n=1);break;case 38:t.shiftKey?r=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?r=-1:(t.preventDefault(),o=1);break;default:return}this._rotationDisabled&&(s=0,r=0);const a=this._map,l=a.transform.activeCamera,h=a.transform.minZoom,_=a.transform.maxZoom;let c,d,u,m=!1;const p=a.getBearing()+s*this._bearingStep,f=e.clamp(a.getCameraPitch()+r*this._pitchStep,0,180),g=e.clamp(a.getZoom()+i,h,_);0===r?(c=e=>e*(2-e),0===i&&(u=l.cartographicPosition[2])):(c=e=>e,m=!0,d=[l.cartographicPosition[0],l.cartographicPosition[1],l.cartographicPosition[2]]),a.easeTo({easeId:"keyboardHandler",duration:300,easing:c,target:d,bearing:p,pitch:f,linearPitch:m,zoom:g,offset:[-n*this._panStep,-o*this._panStep],cameraHeight:u});}enable(){this._enabled=!0;}disable(){this._enabled=!1,this.reset();}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0;}enableRotation(){this._rotationDisabled=!1;}}class py{constructor(t,i){this._map=t,this._enable=e.defaultValue(i.doubleClickZoom,!0),this._enable||this.disable();}enable(){this._enable=!0,this._map.cameraController.enableDoubleZoomClickFly=!0;}disable(){this._enable=!1,this._map.cameraController.enableDoubleZoomClickFly=!1;}isEnabled(){return this._enable}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class fy{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),this._enabled=e.defaultValue(i.touchPan,!0),this._enabled||this.disable();}reset(){this._active=!1,this._touches={},this._sum=new e.pointGeometry3d(0,0);}touchstart(){}touchmove(){}touchend(){}touchcancel(){}_calculateTransform(){}enable(){this._enabled=!0,this._map.cameraController.enableRotate=!0;}disable(){this._enabled=!1,this._map.cameraController.enableRotate=!1,this.reset();}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){}_showTouchPanBlockerAlert(){}}class gy{constructor(t,i){this._map=t,this._active=!1,this._enabled=e.defaultValue(i.touchZoomRotate,!0),this._enabled||this.disable();}reset(){this._active=!1,delete this._firstTwoTouches;}_start(){}_move(){}touchstart(){}touchmove(){}touchend(){}touchcancel(){}enable(e){this._enabled=!0,this._map.cameraController.enableTouchZoomRotate=!0,this._aroundCenter=!!e&&"center"===e.around;}disable(){this._enabled=!1,this._map.cameraController.enableTouchZoomRotate=!1,this.reset();}isEnabled(){return this._enabled}isActive(){return this._active}}class yy{constructor(t,i){this._map=t,this._enabled=e.defaultValue(i.touchPitch,!0),this._enabled||this.disable();}reset(){this._valid=void 0,delete this._firstMove,delete this._lastPoints;}_start(){}_move(){}gestureBeginsVertically(){}touchstart(){}touchmove(){}touchend(){}touchcancel(){}enable(e){this._enabled=!0,this._map.cameraController.enableTouchPitch=!0,this._aroundCenter=!!e&&"center"===e.around;}disable(){this._enabled=!1,this._map.cameraController.enableTouchPitch=!1,this.reset();}isEnabled(){return this._enabled}isActive(){return this._active}}const Ty=0,Cy=2,xy={[Ty]:1,[Cy]:2};class by{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1;}blur(){this.reset();}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton;}_correctButton(e,t){return !1}_move(e,t){return {}}mousedown(t,i){if(this._lastPoint)return;const s=W.mouseButton(t);this._correctButton(t,s)&&(this._mousedownClickPoint=new e.pointGeometry3d(i.x,i.y),this._lastPoint=i,this._eventButton=s);}mousemoveWindow(e,t){const i=this._lastPoint;if(i)if(e.preventDefault(),function(e,t){const i=xy[t];return void 0===e.buttons||(e.buttons&i)!==i}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(i,t)}mouseupWindow(e){this._mousedownClickPoint=null,this._lastPoint&&W.mouseButton(e)===this._eventButton&&(this._moved&&W.suppressClick(),this.reset());}enable(){this._enabled=!0;}disable(){this._enabled=!1,this.reset();}isEnabled(){return this._enabled}isActive(){return this._active}}class vy extends by{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const i=.8*(t.x-e.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(e){e.preventDefault();}}class wy extends by{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const i=-.5*(t.y-e.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(e){e.preventDefault();}}const Sy={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ay{constructor(t){this.options=e.extend({},Sy,t),this._container=W.create("div","minemap-ctrl minemap-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(e.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("minemap-ctrl-icon minemap-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),W.create("span","minemap-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("minemap-ctrl-icon minemap-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),W.create("span","minemap-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(e.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("minemap-ctrl-icon minemap-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e});})),this._compassIcon=W.create("span","minemap-ctrl-compass-arrow",this._compass),this._compassIcon.setAttribute("aria-hidden",!0));}_updateZoomButtons(){const e=this._map.getZoom(),t=e>=this._map.getMaxZoom(),i=e<=this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString());}_rotateCompassArrow(){const e=`rotate(${-this._map.transform.bearing}deg)`;this._map._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=e);}));}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ey(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){this._container.remove(),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._map.off("panorama-change-bearing",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map;}_createButton(e,t){const i=W.create("button",e,this._container);return i.type="button",i.addEventListener("click",t),i}_setButtonTitle(e,t){const i=this._map._getUIString(`NavigationControl.${t}`);e.setAttribute("aria-label",i),e.firstElementChild&&e.firstElementChild.setAttribute("title",i);}}class Ey{constructor(t,i,s=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new vy({clickTolerance:3}),this.map=t,s&&(this.mousePitch=new wy({clickTolerance:3})),e.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),W.addEventListener(i,"mousedown",this.mousedown),W.addEventListener(i,"touchstart",this.touchstart,{passive:!1}),W.addEventListener(i,"touchmove",this.touchmove),W.addEventListener(i,"touchend",this.touchend),W.addEventListener(i,"touchcancel",this.reset);}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),W.disableDrag();}move(e,t){const i=this.map,s=this.mouseRotate.mousemoveWindow(e,t);if(s&&s.bearingDelta&&i.setBearing(i.getBearing()+s.bearingDelta),this.mousePitch){const s=this.mousePitch.mousemoveWindow(e,t);s&&s.pitchDelta&&i.setPitch(i.getPitch()+s.pitchDelta);}}off(){const e=this.element;W.removeEventListener(e,"mousedown",this.mousedown),W.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),W.removeEventListener(e,"touchmove",this.touchmove),W.removeEventListener(e,"touchend",this.touchend),W.removeEventListener(e,"touchcancel",this.reset),this.offTemp();}offTemp(){W.enableDrag(),W.removeEventListener(e.window,"mousemove",this.mousemove),W.removeEventListener(e.window,"mouseup",this.mouseup);}mousedown(t){this.down(e.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),W.mousePos(this.element,t)),W.addEventListener(e.window,"mousemove",this.mousemove),W.addEventListener(e.window,"mouseup",this.mouseup);}mousemove(e){this.move(e,W.mousePos(this.element,e));}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp();}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=W.touchPos(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos));}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=W.touchPos(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos));}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset();}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp();}}var My=Object.freeze({LEFT_DRAG:0,RIGHT_DRAG:1,MIDDLE_DRAG:2,WHEEL:3,PINCH:4,LEFT_DOUBLE_FLY:5});const Py=(t,i)=>{let s=t;return e.defined(i)&&(s+=`+${i}`),s},Ry=(t,i,s)=>{const r=Py(My.PINCH,i),n=t._update,o=t._isDown,a=t._eventStartPosition,l=t._pressTime,h=t._releaseTime;n[r]=!0,o[r]=!1,a[r]=new e.Vector2;let _=t._movement[r];e.defined(_)||(_=t._movement[r]={}),_.distance={startPosition:new e.Vector2,endPosition:new e.Vector2},_.angleAndHeight={startPosition:new e.Vector2,endPosition:new e.Vector2},_.preAngle=0,t._eventHandler.setInputAction((i=>{t._buttonsDown++,o[r]=!0,l[r]=new Date,e.Vector2.lerp(i.position1,i.position2,.5,a[r]);}),te.PINCH_START,i),t._eventHandler.setInputAction((()=>{t._buttonsDown=Math.max(t._buttonsDown-1,0),o[r]=!1,h[r]=new Date;}),te.PINCH_END,i),t._eventHandler.setInputAction((t=>{if(o[r]){n[r]?(e.Vector2.clone((i=t).distance.startPosition,(a=_).distance.startPosition),e.Vector2.clone(i.distance.endPosition,a.distance.endPosition),e.Vector2.clone(i.angleAndHeight.startPosition,a.angleAndHeight.startPosition),e.Vector2.clone(i.angleAndHeight.endPosition,a.angleAndHeight.endPosition),n[r]=!1,_.prevAngle=_.angleAndHeight.startPosition.x):(e.Vector2.clone(t.distance.endPosition,_.distance.endPosition),e.Vector2.clone(t.angleAndHeight.endPosition,_.angleAndHeight.endPosition));let o=_.angleAndHeight.endPosition.x;const l=_.prevAngle,h=2*Math.PI;for(;o>=l+Math.PI;)o-=h;for(;o<l-Math.PI;)o+=h;_.angleAndHeight.endPosition.x=-o*s.clientWidth/12,_.angleAndHeight.startPosition.x=-l*s.clientWidth/12;}var i,a;}),te.PINCH_MOVE,i);};function By(t,i){e.Vector2.clone(t.startPosition,i.startPosition),e.Vector2.clone(t.endPosition,i.endPosition);}function Iy(t,i){const s=t._update,r=t._movement,n=t._lastMovement,o=t._isDown;for(const r in My)if(My.hasOwnProperty(r)){const n=My[r];if(e.defined(n)){const r=Py(n,i);s[r]=!0,e.defined(t._lastMovement[r])||(t._lastMovement[r]={startPosition:new e.Vector2,endPosition:new e.Vector2,valid:!1}),e.defined(t._movement[r])||(t._movement[r]={startPosition:new e.Vector2,endPosition:new e.Vector2});}}t._eventHandler.setInputAction((a=>{for(const t in My)if(My.hasOwnProperty(t)){const l=My[t];if(e.defined(l)){const t=Py(l,i);o[t]&&(s[t]?a.startPosition.equals(a.endPosition)||(By(r[t],n[t]),n[t].valid=!0,By(a,r[t]),s[t]=!1):e.Vector2.clone(a.endPosition,r[t].endPosition));}}e.Vector2.clone(a.endPosition,t._currentMousePosition);}),te.MOUSE_MOVE,i);}const Dy=(t,i,s)=>{const r=Py(s,i),n=t._isDown,o=t._eventStartPosition,a=t._pressTime,l=t._releaseTime;n[r]=!1,o[r]=new e.Vector2;let h,_,c=t._lastMovement[r];e.defined(c)||(c=t._lastMovement[r]={startPosition:new e.Vector2,endPosition:new e.Vector2,valid:!1}),s===My.LEFT_DRAG?(h=te.LEFT_DOWN,_=te.LEFT_UP):s===My.RIGHT_DRAG?(h=te.RIGHT_DOWN,_=te.RIGHT_UP):s===My.MIDDLE_DRAG&&(h=te.MIDDLE_DOWN,_=te.MIDDLE_UP),t._eventHandler.setInputAction((i=>{t._buttonsDown++,c.valid=!1,n[r]=!0,a[r]=new Date,e.Vector2.clone(i.position,o[r]);}),h,i),t._eventHandler.setInputAction((()=>{t._buttonsDown=Math.max(t._buttonsDown-1,0),n[r]=!1,l[r]=new Date;}),_,i);};class Oy{constructor(t,i){if(!e.defined(t))throw new Error("canvas is required.");this._eventHandler=new Ge(t,i),t.addEventListener("touchstart",(e=>{e.preventDefault();})),t.addEventListener("touchmove",(e=>{e.preventDefault();})),t.addEventListener("touch",(e=>{e.preventDefault();})),this._update={},this._movement={},this._lastMovement={},this._isDown={},this._eventStartPosition={},this._pressTime={},this._releaseTime={},this._buttonsDown=0,this._currentMousePosition=new e.Vector2,((t,i)=>{const s=Py(My.WHEEL,i),r=t._pressTime,n=t._releaseTime,o=t._update;o[s]=!0;let a=t._movement[s];e.defined(a)||(a=t._movement[s]={});let l=t._lastMovement[s];e.defined(l)||(l=t._lastMovement[s]={startPosition:new e.Vector2,endPosition:new e.Vector2,valid:!1}),a.startPosition=new e.Vector2,e.Vector2.clone(e.Vector2.ZERO,a.startPosition),a.endPosition=new e.Vector2,t._eventHandler.setInputAction((i=>{const h=7.5*e.toRadians(i);r[s]=n[s]=new Date,a.endPosition.x=0,a.endPosition.y=h,e.Vector2.clone(a.endPosition,l.endPosition),l.valid=!0,o[s]=!1,e.Vector2.clone(t._eventHandler._primaryPosition,t._currentMousePosition);}),te.WHEEL,i);})(this,void 0),Ry(this,void 0,t),Dy(this,void 0,My.LEFT_DRAG),Dy(this,void 0,My.RIGHT_DRAG),Dy(this,void 0,My.MIDDLE_DRAG),Iy(this,void 0),((t,i)=>{const s=My.LEFT_DOUBLE_FLY,r=Py(s,i),n=t._update;n[r]=!0;const o=t._isDown,a=t._eventStartPosition,l=t._pressTime;o[r]=!1,a[r]=new e.Vector2;let h=t._movement[r];e.defined(h)||(h=t._movement[r]={}),h.startPosition=new e.Vector2,h.endPosition=new e.Vector2;let _,c=t._lastMovement[r];e.defined(c)||(c=t._lastMovement[r]={startPosition:new e.Vector2,endPosition:new e.Vector2,valid:!1}),s===My.LEFT_DOUBLE_FLY&&(_=te.LEFT_DOUBLE_CLICK),t._eventHandler.setInputAction((t=>{c.valid=!1,o[r]=!0,n[r]=!0,l[r]=new Date,e.Vector2.clone(t.position,a[r]);const i=15*e.CONSTS.CesiumMath.toRadians(1);e.Vector2.clone(e.Vector2.ZERO,h.startPosition),h.endPosition.x=0,h.endPosition.y=i;}),_,i);})(this,void 0);for(const i in ee)if(ee.hasOwnProperty(i)){const s=ee[i];e.defined(s)&&(Ry(this,s,t),Dy(this,s,My.LEFT_DRAG),Dy(this,s,My.RIGHT_DRAG),Dy(this,s,My.MIDDLE_DRAG),Iy(this,s));}}get currentMousePosition(){return this._currentMousePosition}get anyButtonDown(){const e=!(this._update[Py(My.WHEEL)]&&this._update[Py(My.WHEEL,ee.SHIFT)]&&this._update[Py(My.WHEEL,ee.CTRL)]&&this._update[Py(My.WHEEL,ee.ALT)]);return this._buttonsDown>0||e}isMoving(t,i){if(!e.defined(t))throw new Error("type is required.");const s=Py(t,i);return !this._update[s]}getMovement(t,i){if(!e.defined(t))throw new Error("type is required.");const s=Py(t,i);return this._movement[s]}getLastMovement(t,i){if(!e.defined(t))throw new Error("type is required.");const s=Py(t,i),r=this._lastMovement[s];if(r.valid)return r}isButtonDown(t,i){if(!e.defined(t))throw new Error("type is required.");const s=Py(t,i);return this._isDown[s]}getStartMousePosition(t,i){if(!e.defined(t))throw new Error("type is required.");if(t===My.WHEEL)return this._currentMousePosition;const s=Py(t,i);return this._eventStartPosition[s]}getButtonPressTime(t,i){if(!e.defined(t))throw new Error("type is required.");const s=Py(t,i);return this._pressTime[s]}getButtonReleaseTime(t,i){if(!e.defined(t))throw new Error("type is required.");const s=Py(t,i);return this._releaseTime[s]}reset(){for(const e in this._update)this._update.hasOwnProperty(e)&&(this._update[e]=!0);}isDestroyed(){return !1}destroy(){return this._eventHandler=this._eventHandler&&this._eventHandler.destroy(),e.destroyObject(this)}}class Ly{static wgs84ToWindowCoordinates(t,i,s){return Ly.wgs84WithEyeOffsetToWindowCoordinates(t,i,e.Vector3.ZERO,s)}static wgs84WithEyeOffsetToWindowCoordinates(t,i,s,r){if(!e.defined(t))throw new Error("map is required.");if(!e.defined(i))throw new Error("position is required.");const n=Ly.computeActualWgs84Position(i,new e.Vector4(0,0,0,1));if(!e.defined(n))return;const o=t.getCanvas(),a=new e.BoundingRectangle;a.x=0,a.y=0,a.width=o.clientWidth,a.height=o.clientHeight;const l=t.camera;let h=new e.Vector4;return h=function(t,i,s,r){const n=s.getViewMatrix(),o=e.Matrix4.multiplyByVector(n,e.Vector4.fromElements(t.x,t.y,t.z,1,new e.Vector4),new e.Vector4),a=e.Vector3.multiplyComponents(i,e.Vector3.normalize(o,new e.Vector3),new e.Vector3);return o.x+=i.x+a.x,o.y+=i.y+a.y,o.z+=a.z,e.Matrix4.multiplyByVector(s.frustumCrate.frustum.projectionMatrix,o,r)}(n,s,l,h),h.z<0?void 0:((r=Ly.clipToGLWindowCoordinates(a,h,r)).y=o.clientHeight-r.y,r)}static computeActualWgs84Position(t,i){return e.Vector3.clone(t,i)}static clipToGLWindowCoordinates(t,i,s){const r=new e.Vector3;e.Vector3.divideByScalar(i,i.w,r);const n=new e.Matrix4;e.Matrix4.computeViewportTransformation(t,0,1,n);const o=new e.Vector3;return e.Matrix4.multiplyByPoint(n,r,o),e.Vector2.clone(o,s)}static transformWindowToDrawingBuffer(t,i,s){const r=t.canvas;return e.Vector2.fromElements(i.x*(t.drawingBufferWidth/r.clientWidth),i.y*(t.drawingBufferHeight/r.clientHeight),s)}}const Vy=(t,i,s,r,n,o,a)=>{let l=o[a];e.defined(l)||(l=o[a]={startPosition:new e.Vector2,endPosition:new e.Vector2,motion:new e.Vector2,inertiaEnabled:!0});const h=t.getButtonPressTime(i,s),_=t.getButtonReleaseTime(i,s),c=h&&_&&(_.getTime()-h.getTime())/1e3,d=new Date,u=_&&(d.getTime()-_.getTime())/1e3;if(h&&_&&c<.4){const a=(p=u)<0?0:Math.exp(-25*(1-r)*p),h=t.getLastMovement(i,s);if(!e.defined(h)||e.Vector2.equalsEpsilon((m=h).startPosition,m.endPosition,e.CONSTS.CesiumMath.EPSILON14)||!l.inertiaEnabled)return Gy(o,i),void jy(o,i);if(l.motion.x=.5*(h.endPosition.x-h.startPosition.x),l.motion.y=.5*(h.endPosition.y-h.startPosition.y),l.startPosition=e.Vector2.clone(h.startPosition,l.startPosition),l.endPosition=e.Vector2.multiplyByScalar(l.motion,a,l.endPosition),l.endPosition=e.Vector2.add(l.startPosition,l.endPosition,l.endPosition),isNaN(l.endPosition.x)||isNaN(l.endPosition.y)||e.Vector2.distance(l.startPosition,l.endPosition)<.5)return Gy(o,i),Hy(o,i),void jy(o,i);if(!t.isButtonDown(i,s)){const e=t.getStartMousePosition(i,s);o._eventType=i,n(o,e,l),o._map.style._performanceManagerEvent();}}else h&&_&&c>.4&&(Gy(o,i),Hy(o,i),jy(o,i));var m,p;},Ny=(t,i)=>{if(e.defined(i)){let s=t[i];e.defined(s)&&(s.inertiaEnabled=!0);const r=t._inertiaDisablers[i];if(e.defined(r)){const i=r.length;for(let n=0;n<i;++n)s=t[r[n]],e.defined(s)&&(s.inertiaEnabled=!1);}}},Fy=(e,t)=>{!e._wheelEventStart&&e._aggregator._eventHandler._isRollerWheel&&t===My.WHEEL&&(e._wheelEventStart=!0,e._map._zooming=!0,Xy(e),Ge.executeEvent(e._map,"zoomstart"));},Gy=(e,t)=>{e._wheelEventStart&&e._aggregator._eventHandler._isRollerWheel&&t===My.WHEEL&&(e._wheelEventStart=!1,e._aggregator._eventHandler._isRollerWheel=!1,e._map._zooming=!1,Ky(e),Ge.executeEvent(e._map,"zoomend"));},ky=(e,t)=>{e._rotateEvent||t!==My.LEFT_DRAG&&t!==My.RIGHT_DRAG&&t!==My.PINCH||(e._rotateEvent=!0,e._map._rotating=!0,Xy(e),Ge.executeEvent(e._map,"rotatestart"));},Uy=e=>{e._rotateEvent&&(qy(e),Ge.executeEvent(e._map,"rotate"));},Hy=(t,i)=>{if(t._rotateEvent&&(i===My.LEFT_DRAG||i===My.RIGHT_DRAG||i===My.PINCH&&"touchend"===t._map._screenSpaceEventHandler._elementEvent.type)){const s=i===My.LEFT_DRAG?t._aggregator._eventHandler._buttonDown[0]:t._aggregator._eventHandler._buttonDown[2];!e.defined(s)||s||t._aggregator.anyButtonDown||(delete t._aggregator._eventHandler._buttonDown[i],t._map._rotating=!1,t._rotateEvent=!1,Ky(t),Ge.executeEvent(t._map,"rotateend"));}},zy=(e,t)=>{e._pitchEvent||t!==My.RIGHT_DRAG&&t!==My.PINCH||(e._pitchEvent=!0,e._map._pitching=!0,Xy(e),Ge.executeEvent(e._map,"pitchstart"));},Wy=e=>{e._pitchEvent&&(qy(e),Ge.executeEvent(e._map,"pitch"));},jy=(t,i)=>{if(t._pitchEvent&&(i===My.RIGHT_DRAG||i===My.PINCH&&"touchend"===t._map._screenSpaceEventHandler._elementEvent.type)){const i=t._aggregator._eventHandler._buttonDown[2];e.defined(i)&&!i&&(t._pitchEvent=!1,t._map._pitching=!1,delete t._aggregator._eventHandler._buttonDown[2],Ky(t),Ge.executeEvent(t._map,"pitchend"),t._lastDeltaTheta=void 0);}},Xy=(e,t)=>{!e._moveEvent&&(e._wheelEventStart||e._rotateEvent||e._pitchEvent||t)&&(e._moveEvent=!0,Ge.executeEvent(e._map,"movestart"));},qy=e=>{e._moveEvent&&Ge.executeEvent(e._map,"move");},Ky=e=>{!e._moveEvent||e._wheelEventStart||e._rotateEvent||e._pitchEvent||(e._moveEvent=!1,Ge.executeEvent(e._map,"moveend"));},Jy=(t,i,s,r,n,o)=>{if(!e.defined(s))return;const a=[],l=t._aggregator;Array.isArray(s)||(a[0]=s,s=a);const h=s.length;for(let a=0;a<h;++a){const h=s[a],_=e.defined(h.eventType)?h.eventType:h,c=h.modifier,d=l.isMoving(_,c)&&l.getMovement(_,c),u=l.getStartMousePosition(_,c);t._map._interactive&&t._enableInputs&&i&&(d?(Fy(t,_),ky(t,_),zy(t,_),t._map._stop(!0),t._eventType=_,r(t,u,d),Ny(t,o),t._map.style._performanceManagerEvent()):n<1&&Vy(l,_,c,n,r,t,o));}},Zy=(t,i,s)=>{const r=t._map.getPositionByGPUPick(i);if(e.defined(r))return e.Vector3.fromDegrees(r.x,r.y,r.z,t._ellipsoid,s),s},Yy=t=>{let i=0;const s=t._ellipsoid.cartesianToCartographic(t._map.camera.positionNew,new e.Cartographic);e.defined(s)&&(i=s.height);const r=e.defaultValue(t._map._globeHeight,0);return Math.abs(r-i)},Qy=(t,i,s)=>{const r=t._map,n=r.transform.activeCamera,o=r.getCanvas(),a=n.getPickRay(i.endPosition,o,new e.Ray);let l=e.Vector3.clone(n.directionNew,new e.Vector3);const h=e.Plane.fromPointNormal(s,l,new e.Plane(e.Vector3.UNIT_X,0)),_=e.IntersectionTests.rayPlane(a,h,new e.Vector3);e.defined(_)&&(l=e.Vector3.subtract(s,_,l),n.position=e.Vector3.add(n.positionNew,l,n.positionNew));},$y=(t,i,s)=>{const r=new e.Vector3,n=t._map,o=n.transform.activeCamera,a=n.getCanvas(),l=t._cameraUnderground;let h=t._ellipsoid;const _={orientation:new e.HeadingPitchRoll};let c,d;const u=h.geodeticSurfaceNormal(o.positionNew,new e.Vector3);if(e.Vector2.equals(i,t._rotateMousePosition)){if(t._looking)aT(t,i,s,u);else if(t._rotating){eT(t,i,s,void 0,void 0,void 0,n.transform.bearing>90||n.transform.bearing<-90?-1:1);const e=_.orientation;o._initializedHeadingPitchRoll(),e.heading=o.heading,e.pitch=o.pitch,e.roll=o.roll,o.setView(_);}else if(t._strafing)((t,i)=>{const s=i.endPosition,r=e.Vector2.subtract(i.endPosition,i.startPosition,new e.Vector2),n=t._strafeEndMousePosition;e.Vector2.add(n,r,n),i.endPosition=n,Qy(t,i,t._strafeStartPosition),i.endPosition=s;})(t,s);else {if(e.Vector3.magnitude(o.position)<e.Vector3.magnitude(t._rotateStartPosition))return;c=e.Vector3.magnitude(t._rotateStartPosition),d=new e.Vector3,d.x=d.y=d.z=c,h=e.Ellipsoid.fromCartesian3(d,new e.Ellipsoid),tT(t,i,s,h);}return void Uy(t)}t._looking=!1,t._rotating=!1,t._strafing=!1;const m=h.cartesianToCartographic(o.positionWC,new e.Cartographic).height;if(m<t._minimumPickingTerrainHeight){const r=Zy(t,s.startPosition,new e.Vector3);if(e.defined(r)){let n;const _=o.getPickRay(s.startPosition,a,new e.Ray);if(l)n=!0,((t,i,s,r)=>{let n;e.defined(s)?(n=e.Vector3.distance(i.origin,s),n>t._maximumUndergroundPickDistance&&(n=Yy(t))):n=Yy(t),e.Ray.getPoint(i,n,r);})(t,_,r,r);else {const t=h.geodeticSurfaceNormal(r,new e.Vector3);n=!!(Math.abs(e.Vector3.dot(_.direction,t))<.05)||e.Vector3.magnitude(o.positionNew)<e.Vector3.magnitude(r);}n?(e.Vector2.clone(i,t._strafeEndMousePosition),e.Vector3.clone(r,t._strafeStartPosition),t._strafing=!0,Qy(t,s,t._strafeStartPosition)):(c=e.Vector3.magnitude(r),d=new e.Vector3,d.x=d.y=d.z=c,h=e.Ellipsoid.fromCartesian3(d,new e.Ellipsoid),tT(t,i,s,h),e.Vector3.clone(r,t._rotateStartPosition));}else t._looking=!0,aT(t,i,s,u);}else if(e.defined(o.pickEllipsoid(s.startPosition,a,t._ellipsoid,r)))tT(t,i,s,t._ellipsoid),e.Vector3.clone(r,t._rotateStartPosition);else if(m>t._minimumTrackBallHeight){t._rotating=!0,eT(t,i,s);const e=_.orientation;o._initializedHeadingPitchRoll(),e.heading=o.heading,e.pitch=o.pitch,e.roll=o.roll,o.setView(_);}else t._looking=!0,aT(t,i,s,u);e.Vector2.clone(i,t._rotateMousePosition),Uy(t);},eT=(t,i,s,r,n,o,a=1)=>{n=e.defaultValue(n,!1),o=e.defaultValue(o,!1);const l=t._map,h=l.transform.activeCamera,_=l.getCanvas(),c=h.constrainedAxis;e.defined(r)&&(h.constrainedAxis=r);const d=e.Vector3.magnitude(h.positionNew);let u=t._rotateFactor*(d-t._rotateRateRangeAdjustment);u>t._maximumRotateRate&&(u=t._maximumRotateRate),u<t._minimumRotateRate&&(u=t._minimumRotateRate);let m=(s.startPosition.x-s.endPosition.x)/_.clientWidth,p=(s.startPosition.y-s.endPosition.y)/_.clientHeight;m=Math.min(m,t.maximumMovementRatio),p=Math.min(p,t.maximumMovementRatio);const f=u*m*Math.PI*2*a,g=u*p*Math.PI*a;t._eventType===My.PINCH&&!t.enableTouchZoomRotate||n||h.rotateRight(f),t._eventType===My.PINCH&&!t.enableTouchPitch||o||(h.rotateUp(g),ky(t),Uy(t)),h.constrainedAxis=c;},tT=(t,i,s,r)=>{const n=t._map,o=n.transform.activeCamera,a=n.getCanvas(),l=e.Vector4.clone(e.Vector4.UNIT_W),h=e.Vector4.clone(e.Vector4.UNIT_W),_=new e.Vector3,c=new e.Vector3,d=new e.Vector3,u=new e.Vector3,m=new e.Vector2,p=new e.Vector2,f=e.Vector2.clone(s.startPosition,m),g=e.Vector2.clone(s.endPosition,p),y={orientation:new e.HeadingPitchRoll};let T=o.pickEllipsoid(f,a,r,l),C=o.pickEllipsoid(g,a,r,h);if(!e.defined(T)||!e.defined(C)){t._rotating=!0,eT(t,i,s);const e=y.orientation;return o._initializedHeadingPitchRoll(),e.heading=o.heading,e.pitch=o.pitch,e.roll=o.roll,void o.setView(y)}if(T=o.worldToCameraCoordinates(T,T),C=o.worldToCameraCoordinates(C,C),e.defined(o.constrainedAxis)){const t=o.constrainedAxis,i=e.Vector3.mostOrthogonalAxis(t,_);e.Vector3.cross(i,t,i),e.Vector3.normalize(i,i);const s=e.Vector3.cross(t,i,c),r=e.Vector3.magnitude(T),n=e.Vector3.dot(t,T),a=Math.acos(n/r),l=e.Vector3.multiplyByScalar(t,n,d);e.Vector3.subtract(T,l,l),e.Vector3.normalize(l,l);const h=e.Vector3.magnitude(C),m=e.Vector3.dot(t,C),p=Math.acos(m/h),f=e.Vector3.multiplyByScalar(t,m,u);e.Vector3.subtract(C,f,f),e.Vector3.normalize(f,f);let g=Math.acos(e.Vector3.dot(l,i));e.Vector3.dot(l,s)<0&&(g=e.CONSTS.CesiumMath.TWO_PI-g);let x=Math.acos(e.Vector3.dot(f,i));e.Vector3.dot(f,s)<0&&(x=e.CONSTS.CesiumMath.TWO_PI-x);const b=g-x;let v;v=e.Vector3.equalsEpsilon(t,o.positionNew,e.CONSTS.CesiumMath.EPSILON2)?o.rightNew:e.Vector3.cross(t,o.positionNew,_);const w=e.Vector3.cross(t,v,_),S=e.Vector3.dot(w,e.Vector3.subtract(T,t,c)),A=e.Vector3.dot(w,e.Vector3.subtract(C,t,c));let E;E=S>0&&A>0?p-a:S>0&&A<=0?e.Vector3.dot(o.positionNew,t)>0?-a-p:a+p:a-p,o.rotateRight(b),o.rotateUp(E);const M=y.orientation;o._initializedHeadingPitchRoll(),M.heading=o.heading,M.pitch=o.pitch,M.roll=o.roll,o.setView(y);}else {e.Vector3.normalize(T,T),e.Vector3.normalize(C,C);const t=e.Vector3.dot(T,C),i=e.Vector3.cross(T,C,_);if(t<1&&!e.Vector3.equalsEpsilon(i,e.Vector3.ZERO,e.CONSTS.CesiumMath.EPSILON14)){const e=Math.acos(t);o.rotate(i,e);}}},iT=(t,i,s)=>{if(!e.defined(s.motion))return;let r=t._map.transform.fov;r+=s.motion[1]>0?-2:2,r>0&&r<180&&(t._map.transform.fov=r);},sT=(t,i,s)=>{if(e.defined(s.distance)&&(s=s.distance),t._eventType===My.PINCH&&!t.enableTouchZoomRotate)return;const r=s.inertiaEnabled,n=t._ellipsoid,o=t._map,a=o.transform.activeCamera,l=o.getCanvas(),h=o.transform.minZoom,_=o.transform.maxZoom,c=t._cameraUnderground,d=e.Vector3.clone(a.positionNew,new e.Vector3),u=e.Vector3.clone(a.directionNew,new e.Vector3),m=e.Vector3.clone(a.upNew,new e.Vector3),p=e.Vector3.clone(a.rightNew,new e.Vector3);let f;c?f=i:(f=new e.Vector2,f.x=l.clientWidth/2,f.y=l.clientHeight/2);const g=a.getPickRay(f,l,new e.Ray);let y;const T=n.cartesianToCartographic(a.positionNew,new e.Cartographic).height;let C;if((r?t.minimumPickingTerrainDistanceWithInertia>0:T<t._minimumPickingTerrainHeight)&&(y=Zy(t,f,new e.Vector3)),e.defined(y)&&(C=e.Vector3.distance(g.origin,y)),c){const i=((t,i)=>{const s=i.origin,r=i.direction,n=Yy(t),o=e.Vector3.normalize(s,new e.Vector3);let a=Math.abs(e.Vector3.dot(o,r));return a=2*Math.max(a,.5),n*a})(t,g);C=e.defined(C)?Math.min(C,i):i;}e.defined(C)||(C=T);const x=e.Vector3.normalize(a.positionNew,new e.Vector3);o.transform.zoomPickedDistance=C,((t,i,s,r,n,o)=>{let a=1;e.defined(o)&&(a=e.CONSTS.CesiumMath.clamp(Math.abs(o),.25,1));const l=s.endPosition.y-s.startPosition.y,h=l>0?t.minimumZoomDistance*a:0,_=t.maximumZoomDistance;let c=r*(n-h);c=e.CONSTS.CesiumMath.clamp(c,t._minimumZoomRate,t._maximumZoomRate);let d=l/t._map.getCanvas().clientHeight;d=Math.min(d,t.maximumMovementRatio);let u=c*d;if(t.enableCollisionDetection||0===t.minimumZoomDistance){if(u>0&&Math.abs(n-h)<1)return;if(u<0&&Math.abs(n-_)<1)return;n-u<h?u=n-h-1:n-u>_&&(u=n-_);}t._awayFrom=u<0;const m=t._map,p=m.transform.activeCamera,f=m.getCanvas(),g={orientation:new e.HeadingPitchRoll},y=g.orientation;p._initializedHeadingPitchRoll(),y.heading=p.heading,y.pitch=p.pitch,y.roll=p.roll;const T=e.defaultValue(s.inertiaEnabled,e.Vector2.equals(i,t._zoomMouseStart));let C,x=t._zoomingOnVector,b=t._rotatingZoom;if(T||(t._zoomMouseStart=e.Vector2.clone(i,t._zoomMouseStart),C=Zy(t,i,new e.Vector3),e.defined(C)?(t._useZoomWorldPosition=!0,t._zoomWorldPosition=e.Vector3.clone(C,t._zoomWorldPosition)):t._useZoomWorldPosition=!1,x=t._zoomingOnVector=!1,b=t._rotatingZoom=!1,t._zoomingUnderground=t._cameraUnderground),!t._useZoomWorldPosition)return void p.zoomIn(u);let v=!1;if(p.cartographicPosition[2]<2e6&&(b=!0),!T||b){const i=e.Vector3.normalize(p.positionNew,new e.Vector3);if(t._cameraUnderground||t._zoomingUnderground||p.cartographicPosition[2]<3e3&&Math.abs(e.Vector3.dot(p.directionNew,i))<.6)v=!0;else {const s=new e.Vector2;s.x=f.clientWidth/2,s.y=f.clientHeight/2;const r=Zy(t,s,new e.Vector3);if(e.defined(r))if(p.cartographicPosition[2]<1e6){if(!(e.Vector3.dot(p.directionNew,i)>=-.5)){const s=new e.Vector3;e.Vector3.clone(p.positionNew,s);const r=t._zoomWorldPosition;let n=new e.Vector3;if(n=e.Vector3.normalize(r,n),e.Vector3.dot(n,i)<0)return;const o=new e.Vector3,a=new e.Vector3;e.Vector3.clone(p.directionNew,a),e.Vector3.add(s,e.Vector3.multiplyByScalar(a,1e3,new e.Vector3),o);const l=new e.Vector3,h=new e.Vector3;e.Vector3.subtract(r,s,l),e.Vector3.normalize(l,h);const _=Math.min(Math.max(e.Vector3.dot(i,h),-1),1);if(_>=0)return void(t._zoomMouseStart.x=-1);const c=Math.acos(-_),d=e.Vector3.magnitude(s),m=e.Vector3.magnitude(r),f=d-u,y=e.Vector3.magnitude(l),T=Math.asin(e.CONSTS.CesiumMath.clamp(y/m*Math.sin(c),-1,1))-Math.asin(e.CONSTS.CesiumMath.clamp(f/m*Math.sin(c),-1,1))+c,C=new e.Vector3;e.Vector3.normalize(s,C);let x=new e.Vector3;x=e.Vector3.cross(h,C,x),x=e.Vector3.normalize(x,x),e.Vector3.normalize(e.Vector3.cross(C,x,new e.Vector3),a),e.Vector3.multiplyByScalar(e.Vector3.normalize(o,new e.Vector3),e.Vector3.magnitude(o)-u,o),e.Vector3.normalize(s,s),e.Vector3.multiplyByScalar(s,f,s);const b=new e.Vector3;e.Vector3.multiplyByScalar(e.Vector3.add(e.Vector3.multiplyByScalar(C,Math.cos(T)-1,new e.Vector3),e.Vector3.multiplyByScalar(a,Math.sin(T),new e.Vector3),new e.Vector3),f,b),e.Vector3.add(s,b,s),e.Vector3.normalize(o,C),e.Vector3.normalize(e.Vector3.cross(C,x,new e.Vector3),a);const v=new e.Vector3;return e.Vector3.multiplyByScalar(e.Vector3.add(e.Vector3.multiplyByScalar(C,Math.cos(T)-1,new e.Vector3),e.Vector3.multiplyByScalar(a,Math.sin(T),new e.Vector3),new e.Vector3),e.Vector3.magnitude(o),v),e.Vector3.add(o,v,o),p.position=e.Vector3.clone(s),e.Vector3.clone(s,p.positionNew),e.Vector3.normalize(e.Vector3.subtract(o,s,new e.Vector3),p.directionNew),e.Vector3.clone(p.directionNew,p.directionNew),e.Vector3.cross(p.directionNew,p.upNew,p.rightNew),e.Vector3.cross(x,p.directionNew,p.upNew),void p.setView(g)}v=!0;}else {const i=e.Vector3.normalize(r,new e.Vector3),s=e.Vector3.normalize(t._zoomWorldPosition,new e.Vector3),n=e.Vector3.dot(s,i);if(n>0&&n<1){const t=e.CONSTS.CesiumMath.acosClamped(n),r=e.Vector3.cross(s,i,new e.Vector3),o=Math.abs(t)>e.CONSTS.CesiumMath.toRadians(20)?.75*p.cartographicPosition[2]:p.cartographicPosition[2]-u;p.rotate(r,t*(u/o)),p._initializedHeadingPitchRoll(),y.heading=p.heading,y.pitch=p.pitch,y.roll=p.roll,p.setView(g);}}else v=!0;}t._rotatingZoom=!v;}if(!T&&v||x){let s;const r=Ly.wgs84ToWindowCoordinates(m,t._zoomWorldPosition,new e.Vector2),o=new e.Ray;s=e.Vector2.equals(i,t._zoomMouseStart)&&e.defined(r)?p.getPickRay(r,f,o):p.getPickRay(i,f,o),p.move(s.direction,u>n-.1?n-.1:u),t._zoomingOnVector=!0;}else p.zoomIn(u>n-.1?n-.1:u);t._cameraUnderground||p.setView(g);})(t,i,s,t._zoomFactor,C,e.Vector3.dot(x,a.directionNew)),t.enableCollisionDetection&&o.transform.zoom-_>e.CONSTS.CesiumMath.EPSILON4&&!1===t._awayFrom||h-o.transform.zoom>e.CONSTS.CesiumMath.EPSILON4&&!0===t._awayFrom?hT(a,d,u,m,p):(e=>{e._wheelEventStart&&(qy(e),Ge.executeEvent(e._map,"zoom"));})(t);},rT=(t,i,s)=>{const r=t._ellipsoid.geodeticSurfaceNormal(t._map.transform.activeCamera.positionNew,new e.Vector3);aT(t,i,s,r);},nT=(t,i,s)=>{const r=t._map,n=r.transform.activeCamera,o=e.Vector3.clone(n.positionNew,new e.Vector3),a=e.Vector3.clone(n.directionNew,new e.Vector3),l=e.Vector3.clone(n.upNew,new e.Vector3),h=e.Vector3.clone(n.rightNew,new e.Vector3);if(e.Matrix4.equals(n.transform,e.Matrix4.IDENTITY)){if(e.defined(s.angleAndHeight)&&(s=s.angleAndHeight),e.Vector2.equals(i,t._tiltCenterMousePosition)||(t._tiltOnEllipsoid=!1,t._looking=!1),t._looking){const r=t._ellipsoid.geodeticSurfaceNormal(n.positionNew,new e.Vector3);return aT(t,i,s,r),void Wy(t)}t._tilting=!0,oT(t,i,s);for(let e=0;e<t._map._controls.length;e++)t._map._controls[e]instanceof Ay&&t._map._controls[e]._rotateCompassArrow();(r.getPitch()<r.transform.minPitch||r.getPitch()>r.transform.maxPitch)&&hT(n,o,a,l,h),(t._eventType!==My.PINCH||t.enableTouchPitch)&&(ky(t),Uy(t)),Wy(t);}},oT=(t,i,s)=>{const r=t._ellipsoid,n=t._map,o=n.transform.activeCamera,a=n.getCanvas(),l=t._cameraUnderground,h={orientation:new e.HeadingPitchRoll};let _,c,d;if(e.Vector2.equals(i,t._tiltCenterMousePosition))_=e.Vector3.clone(t._tiltCenter,new e.Vector3);else {if(_=Zy(t,i,new e.Vector3),!e.defined(_)){if(c=o.getPickRay(i,a,new e.Ray),d=e.IntersectionTests.rayEllipsoid(c,r),!e.defined(d)){if(r.cartesianToCartographic(o.positionNew,new e.Cartographic).height<=t._minimumTrackBallHeight){t._looking=!0;const r=t._ellipsoid.geodeticSurfaceNormal(o.positionNew,new e.Vector3);aT(t,i,s,r),e.Vector2.clone(i,t._tiltCenterMousePosition);}return}_=e.Ray.getPoint(c,d.start,new e.Vector3);}l&&(e.defined(c)||(c=o.getPickRay(i,a,new e.Ray)),((t,i,s,r)=>{let n=e.Vector3.distance(i.origin,s);const o=Yy(t);n>e.CONSTS.CesiumMath.clamp(5*o,t._minimumUndergroundPickDistance,t._maximumUndergroundPickDistance)&&(n=Math.min(n,o/5),n=Math.max(n,100)),e.Ray.getPoint(i,n,r);})(t,c,_,_)),e.Vector2.clone(i,t._tiltCenterMousePosition),e.Vector3.clone(_,t._tiltCenter);}const u=new e.Vector2(a.clientWidth/2,t._tiltCenterMousePosition.y);c=o.getPickRay(u,a,new e.Ray);const m=e.Vector3.magnitude(_),p=e.Vector3.fromElements(m,m,m,new e.Vector3),f=e.Ellipsoid.fromCartesian3(p,new e.Ellipsoid);if(d=e.IntersectionTests.rayEllipsoid(c,f),!e.defined(d))return;t._rotateFactor=1,t._rotateRateRangeAdjustment=1,(t._aggregator._isDown["0+1"]||t._aggregator._isDown[1])&&(t._lastDeltaTheta=void 0);const g=((t,i,s)=>{const r=t._map,n=r.transform.activeCamera,o=r.getCanvas(),a=e.Vector3.magnitude(n.positionNew);let l=t._rotateFactor*(a-t._rotateRateRangeAdjustment);l>t._maximumRotateRate&&(l=t._maximumRotateRate),l<t._minimumRotateRate&&(l=t._minimumRotateRate);let h=(s.startPosition.x-s.endPosition.x)/o.clientWidth,_=(s.startPosition.y-s.endPosition.y)/o.clientHeight;return h=Math.min(h,t.maximumMovementRatio),_=Math.min(_,t.maximumMovementRatio),{deltaPhi:l*h*Math.PI*2,deltaTheta:l*_*Math.PI}})(t,0,s),y=_,T=o.matrix.clone(),C=e.Transforms.fixedFrameToHeadingPitchRoll(T),x=Math.min(Math.max(C.roll,0),Math.PI);(x+g.deltaTheta<=0||x+g.deltaTheta>=Math.PI)&&(t._lastDeltaTheta=0),0===t._lastDeltaTheta&&(g.deltaTheta=0),T[12]-=y[0],T[13]-=y[1],T[14]-=y[2];const b=new e.Vector3(T[0],T[1],T[2]),v=new e.Vector3(y).normalize(),w=(new e.Matrix4).rotateAxis(g.deltaTheta,b),S=(new e.Matrix4).rotateAxis(g.deltaPhi,v);T.multiplyLeft(w).multiplyLeft(S),T[12]+=y[0],T[13]+=y[1],T[14]+=y[2],o.positionNew=new e.Vector3(T[12],T[13],T[14]),o.directionNew=new e.Vector3(-T[8],-T[9],-T[10]),o.rightNew=new e.Vector3(T[0],T[1],T[2]),o.upNew=new e.Vector3(T[4],T[5],T[6]),o._updateCameraChanged(),o.setMatrix(T),o._updateCameraChanged();const A=h.orientation;o._initializedHeadingPitchRoll(),A.heading=o.heading,A.pitch=o.pitch,A.roll=0,o.setView(h),t.enableCollisionDetection&&lT(t);},aT=(t,i,s,r)=>{const n=t._map,o=n.transform.activeCamera,a=e.Vector3.clone(o.positionNew,new e.Vector3),l=e.Vector3.clone(o.directionNew,new e.Vector3),h=e.Vector3.clone(o.upNew,new e.Vector3),_=e.Vector3.clone(o.rightNew,new e.Vector3),c=n.getCanvas(),d={orientation:new e.HeadingPitchRoll},u=new e.Vector2(s.startPosition.x,0),m=new e.Vector2(s.endPosition.x,0);let p,f,g=o.getPickRay(u,c,new e.Ray),y=o.getPickRay(m,c,new e.Ray),T=0;p=g.direction,f=y.direction;let C=e.Vector3.dot(p,f);C<1&&(T=Math.acos(C)),T=s.startPosition.x>s.endPosition.x?-T:T;const x=t._horizontalRotationAxis;if(e.defined(r)?o.look(r,-T):e.defined(x)&&o.look(x,-T),u.x=0,u.y=s.startPosition.y,m.x=0,m.y=s.endPosition.y,g=o.getPickRay(u,c,new e.Ray),y=o.getPickRay(m,c,new e.Ray),T=0,p=g.direction,f=y.direction,C=e.Vector3.dot(p,f),C<1&&(T=Math.acos(C)),T=s.startPosition.y>s.endPosition.y?-T:T,r=e.defaultValue(r,x),e.defined(r)){const t=o.directionNew,i=e.Vector3.negate(r,new e.Vector3),s=e.Vector3.equalsEpsilon(t,r,e.CONSTS.CesiumMath.EPSILON2),n=e.Vector3.equalsEpsilon(t,i,e.CONSTS.CesiumMath.EPSILON2);if(s||n)(s&&T<0||n&&T>0)&&o.look(o.rightNew,-T);else {C=e.Vector3.dot(t,r);let s=e.CONSTS.CesiumMath.acosClamped(C);T>0&&T>s&&(T=s-e.CONSTS.CesiumMath.EPSILON4),C=e.Vector3.dot(t,i),s=e.CONSTS.CesiumMath.acosClamped(C),T<0&&-T>s&&(T=-s+e.CONSTS.CesiumMath.EPSILON4);const n=e.Vector3.cross(r,t,new e.Vector3);o.look(n,T);}}else o.lookUp(T);const b=d.orientation;o._initializedHeadingPitchRoll(),b.heading=o.heading,b.pitch=o.pitch,b.roll=o.roll,o.setView(d),(n.getPitch()<n.transform.minPitch||n.getPitch()>n.transform.maxPitch)&&hT(o,a,l,h,_);},lT=t=>{t._adjustedHeightForTerrain=!0;const i=t._ellipsoid,s=t._map.transform.activeCamera;let r,n;e.Matrix4.equals(s.transform,e.Matrix4.IDENTITY)||(r=e.Matrix4.clone(s.transform,new e.Matrix4),n=e.Vector3.magnitude(s.positionNew),s._setTransform(e.Matrix4.IDENTITY));const o=new e.Cartographic;i.cartesianToCartographic(s.positionNew,o);let a=!1;if(o.height<t._minimumCollisionTerrainHeight){const r=t._map._globeHeight;if(e.defined(r)){const e=r+t.minimumZoomDistance;o.height<e&&(o.height=e,i.cartographicToCartesian(o,s.positionNew),a=!0);}}if(e.defined(r)&&(s._setTransform(r),a&&(e.Vector3.normalize(s.positionNew,s.positionNew),e.Vector3.negate(s.positionNew,s.directionNew),e.Vector3.multiplyByScalar(s.positionNew,Math.max(n,t.minimumZoomDistance),s.positionNew),e.Vector3.normalize(s.directionNew,s.directionNew),e.Vector3.cross(s.directionNew,s.upNew,s.rightNew),e.Vector3.cross(s.rightNew,s.directionNew,s.upNew))),a){const t={orientation:new e.HeadingPitchRoll},i=t.orientation;s._initializedHeadingPitchRoll(),i.heading=s.heading,i.pitch=s.pitch,i.roll=0,s.setView(t);}},hT=(t,i,s,r,n)=>{t.positionNew=i,t.directionNew=s,t.upNew=r,t.rightNew=n;const o={orientation:new e.HeadingPitchRoll},a=o.orientation;t._initializedHeadingPitchRoll(),a.heading=t.heading,a.pitch=t.pitch,a.roll=t.roll,t.setView(o);};class _T{constructor(t){this._enableInputs=!0,this.enableZoom=!0,this.enableRotate=!0,this.enableTilt=!0,this.enableDoubleZoomClickFly=!0,this.enableTouchZoomRotate=!0,this.enableTouchPitch=!0,this._enableCameraFixed=!1,this.inertiaSpin=.9,this.inertiaTranslate=.9,this.inertiaZoom=.8,this.maximumMovementRatio=.1,this.minimumZoomDistance=1,this.maximumZoomDistance=Number.POSITIVE_INFINITY,this.zoomEventTypes=[My.WHEEL,My.PINCH],this.rotateEventTypes=My.LEFT_DRAG,this.tiltEventTypes=[My.RIGHT_DRAG,{eventType:My.LEFT_DRAG,modifier:ee.CTRL},My.PINCH],this.minimumPickingTerrainHeight=15e4,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight,this.minimumTrackBallHeight=75e5,this._minimumTrackBallHeight=this.minimumTrackBallHeight,this.minimumPickingTerrainDistanceWithInertia=4e3,this.minimumCollisionTerrainHeight=3e4,this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight,this.enableCollisionDetection=e.defaultValue(!t.enableUnderGround,!0),this._ellipsoid=void 0,this._map=t;const i=t.getCanvas();i.oncontextmenu=function(){return !1},i.onselectstart=function(){return !1},this._aggregator=new Oy(this._map.getCanvasContainer(),this._map),this._lastInertiaSpinMovement=void 0,this._lastInertiaZoomMovement=void 0,this._lastInertiaTiltMovement=void 0,this._inertiaDisablers={_lastInertiaZoomMovement:["_lastInertiaSpinMovement","_lastInertiaTiltMovement"],_lastInertiaTiltMovement:["_lastInertiaSpinMovement"]},this._horizontalRotationAxis=void 0,this._tiltCenterMousePosition=new e.Vector2(-1,-1),this._tiltCenter=new e.Vector3,this._rotateMousePosition=new e.Vector2(-1,-1),this._rotateStartPosition=new e.Vector3,this._strafeStartPosition=new e.Vector3,this._strafeEndMousePosition=new e.Vector2,this._zoomMouseStart=new e.Vector2(-1,-1),this._zoomWorldPosition=new e.Vector3,this._useZoomWorldPosition=!1,this._panLastMousePosition=new e.Vector2,this._panLastWorldPosition=new e.Vector3,this._lastDeltaTheta=void 0,this._looking=!1,this._rotating=!1,this._tilting=!1,this._strafing=!1,this._zoomingOnVector=!1,this._zoomingUnderground=!1,this._rotatingZoom=!1,this._adjustedHeightForTerrain=!1,this._cameraUnderground=!1,this._zoomFactor=5,this._rotateFactor=void 0,this._rotateRateRangeAdjustment=void 0,this._maximumRotateRate=1.77,this._minimumRotateRate=2e-4,this._minimumZoomRate=20,this._maximumZoomRate=5906376272e3,this._minimumUndergroundPickDistance=2e3,this._maximumUndergroundPickDistance=1e4,this._wheelEventStart=!1,this._rotateEvent=!1,this._pitchEvent=!1,this._moveEvent=!1,this._awayFrom=!1,this._eventType=void 0;}get enableInputs(){return this._enableInputs}set enableInputs(t){if(e.isBoolean(t)){this._enableInputs=t;for(const t in this._aggregator._movement){const i=this._aggregator._movement[t];e.defined(i.startPosition)&&(i.startPosition=new e.Vector2),e.defined(i.endPosition)&&(i.endPosition=new e.Vector2);}for(const e in this._aggregator._pressTime)this._aggregator._pressTime[e]=new Date(Date.parse(new Date)-1e4);for(const e in this._aggregator._releaseTime)this._aggregator._releaseTime[e]=new Date;}}get enableCameraFixed(){return this._enableCameraFixed}set enableCameraFixed(t){!1===t&&!0===this._enableCameraFixed&&(this._map.transform.fov=e.CONSTS.TRANSFORM.FOV_IN_DEGREES),this._enableCameraFixed=t;}_stopInertia(){e.defined(this._lastInertiaSpinMovement)&&(this._lastInertiaSpinMovement.inertiaEnabled=!1),e.defined(this._lastInertiaZoomMovement)&&(this._lastInertiaZoomMovement.inertiaEnabled=!1),e.defined(this._lastInertiaTiltMovement)&&(this._lastInertiaTiltMovement.inertiaEnabled=!1);}update(){const t=this._map,i=t.transform.activeCamera;this._ellipsoid=e.Matrix4.equals(i.transform,e.Matrix4.IDENTITY)?t._tilingScheme._ellipsoid:e.Ellipsoid.UNIT_SPHERE,this._cameraUnderground=t._cameraUnderground;const s=this._ellipsoid.maximumRadius;this._rotateFactor=1/s,this._rotateRateRangeAdjustment=s,this._tilting=!1,this._adjustedHeightForTerrain=!1;const r=e.Vector3.clone(i.positionNew,new e.Vector3),n=e.Vector3.clone(i.directionNew,new e.Vector3),o=e.Vector3.clone(i.upNew,new e.Vector3),a=e.Vector3.clone(i.rightNew,new e.Vector3);this._horizontalRotationAxis=void 0,this._awayFrom=void 0,(t=>{const i=t._aggregator;if(i.isButtonDown(My.LEFT_DOUBLE_FLY,void 0)){const s=i.getMovement(My.LEFT_DOUBLE_FLY,void 0),r=i.getStartMousePosition(My.LEFT_DOUBLE_FLY,void 0);t.enableDoubleZoomClickFly&&!t._cameraUnderground&&((t,i,s)=>{e.defined(s.distance)&&(s=s.distance);const r=t._map.transform.activeCamera,n=t._ellipsoid,o=Zy(t,i,new e.Vector3);let a;a=e.defined(o)?e.Vector3.distance(r.positionNew,o):n.cartesianToCartographic(r.positionNew,new e.Cartographic).height,((t,i,s,r,n,o)=>{const a=t._map,l=.9*n,h={orientation:new e.HeadingPitchRoll},_=a.transform.activeCamera;if(!e.defined(o))return;const c=h.orientation;_._initializedHeadingPitchRoll(),c.heading=_.heading,c.pitch=_.pitch,c.roll=_.roll;const d=e.Vector3.clone(_.positionNew),u=e.Vector3.clone(_.rightNew),m=e.Vector3.clone(_.directionNew),p=e.Vector3.clone(_.upNew),f=o,g=new e.Vector3;e.Vector3.subtract(f,_.positionNew,g),e.Vector3.normalize(g,g),_.move(g,l),_.setView(h);const y=_.positionNew.clone();if(_.position=_.positionNew=d,_.rightNew=u,_.directionNew=m,_.upNew=p,_.setView(h),e.Vector3.distance(y,f)<1)return;const T=e.Cartographic.fromVector3(y);a.flyTo({target:[e.CONSTS.CesiumMath.toDegrees(T.longitude),e.CONSTS.CesiumMath.toDegrees(T.latitude),T.height],bearing:a.transform.bearing,pitch:a.transform.pitch,roll:a.transform.roll,duration:500,easing:ff.LINEAR_NONE,isEaseToType:!0,callback:Ky},t),Xy(t,!0);})(t,0,0,0,a,o);})(t,r,s),i._isDown[My.LEFT_DOUBLE_FLY]=!1;}else t.enableCameraFixed?(Jy(t,t.enableTilt,t.tiltEventTypes,rT),Jy(t,t.enableZoom,t.zoomEventTypes,iT,t.inertiaZoom,"_lastInertiaZoomMovement")):(Jy(t,t.enableRotate,t.rotateEventTypes,$y,t.inertiaSpin,"_lastInertiaSpinMovement"),Jy(t,t.enableTilt,t.tiltEventTypes,nT,t.inertiaSpin,"_lastInertiaTiltMovement"),Jy(t,t.enableZoom,t.zoomEventTypes,sT,t.inertiaZoom,"_lastInertiaZoomMovement"));})(this),this._ellipsoid.cartesianToCartographic(i.positionNew,new e.Cartographic).height>38268822&&hT(i,r,n,o,a),this.enableCollisionDetection&&!this._adjustedHeightForTerrain&&(!e.Vector3.equals(r,i.position)||!e.Vector3.equals(n,i.direction))&&lT(this),this._aggregator.reset();}isDestroyed(){return !1}destroy(){return this._aggregator=this._aggregator&&this._aggregator.destroy(),e.destroyObject(this)}}const cT=180,dT={bearing:0,pitch:0,roll:0,minZoom:0,maxZoom:22,minPitch:0,maxPitch:cT,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,dragZoom:!1,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!1,fps:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,transformRequest:null,fadeDuration:300,crossSourceCollisions:!0,sphereRender:!0,projection:e.ProjectionType.MERCATOR,localIdeographFontFamily:"PingFang SC,Microsoft YaHei,微软雅黑,Arial,sans-serif,黑体",defaultCursor:null,logoControl:!0,logoUrl:"",skyBox:!0,earthSkin:!0,earthSkinDepth:!1,terrainSkirtHeight:-1,minHeightToDemSurface:1,lightingModel:e.LightingModelType.NONE},{HTMLImageElement:uT,HTMLElement:mT,ImageBitmap:pT}=e.window;class fT extends Vf{needRepaint=!1;constructor(t){if("undefined"==typeof global&&!Bg(void 0))throw new Error("minemap.js is not supported in the current environment");if(t=e.extend({},dT,t),e.defined(t.center)||e.defined(t.zoom)||e.defined(t.position)||(t.center=[0,0],t.zoom=0),e.defined(t.center)&&e.defined(t.zoom)&&e.defined(t.position))throw new Error("You must specify either center and zoom, or position");if(null!=t.minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>cT)throw new Error("maxPitch must be less than or equal to 180");const i=new Zf(t.minZoom,t.maxZoom,t.projection,t.minPitch,t.maxPitch);i.minHeightToDemSurface=t.minHeightToDemSurface,super(i,t),this.spaceErrorScale=t.spaceErrorScale,this.lightingModel=t.lightingModel,this.rasterScreenSpaceError=e.defaultValue(t.rasterScreenSpaceError,.5),this._logDepth=t.logDepth||!1,this._canvasTransparent=void 0===t.canvasTransparent||t.canvasTransparent,this.testMode=t.testMode||!1,this._shadowFlag=!1,this._viewShedFlag=!1,this.mapProjection=new jf(t,this),this._interactive=t.interactive,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._crossSourceCollisions=t.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=t.collectResourceTiming,this._renderTaskQueue=new Wf,this._domRenderTaskQueue=new Wf,this._fxaaRender=t.fxaa||!1,this._bloomRender=t.bloom||!1,this._bloomOptions={step:9,extent:6},this._controls=[],this._markers=[],this.__popupList=[],this.particleSystemCollection=new Dg(this),this.isLatLon="LATLON"===t.projection,this._tilingScheme="LATLON"===t.projection?new Ot:new Dt,this._cooperativeGestures=t.cooperativeGestures,this._locale=e.extend({},tg,t.locale),this._clickTolerance=t.clickTolerance,this._containerWidth=0,this._containerHeight=0,this._showDebugBoundingBox=e.defaultValue(t.showDebugBoundingBox,!1),this._shadows=t.shadows||!1,this._shadowsType=this._shadows?t.shadowsType||e.ShadowsType.ShadowMapping:e.ShadowsType.NONE,this._enableUnderGround=e.defaultValue(t.enableUnderGround,!1),this._enableNormal=!!t.enableNormal&&t.enableNormal,this._resolvePass=t.resolvePass?t.resolvePass:"main";const s=t.transformRequest;if(this._transformRequest=s?(e,t)=>s(e,t)||{url:e,type:t}:e=>({url:e}),this.timer=new $f,this._SSAASamples=t.SSAASamples?t.SSAASamples:1,this._trackingOptions=null,this._roamingOptions=null,"string"==typeof t.container){if(this._container=e.window.document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container}' not found.`)}else {if(!(t.container instanceof mT))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container;}if(this._container.childNodes.length>0&&e.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the MineMap Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),e.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored","_update","_render","_onData","_onDataLoading"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");void 0!==e.window&&(e.window.addEventListener("online",this._onWindowOnline,!1),e.window.addEventListener("resize",this._onWindowResize,!1),e.window.addEventListener("orientationchange",this._onWindowResize,!1),e.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this._globeHeight=void 0,this._cameraUnderground=!1,this._cameraController=new _T(this),this._screenSpaceEventHandler=new Ge(this.getCanvasContainer(),this,!0),this._addHandOperationEventListener(),this.keyboard=new my(this,t),this.dragPan=new dy(this,t),this.dragRotate=new cy(this,t),this.scrollZoom=new hy(this,t),this.boxZoom=new _y(this,t),this.doubleClickZoom=new py(this,t),this.touchPan=new fy(this,t),this.touchZoomRotate=new gy(this,t),this.touchPitch=new yy(this,t),this._hash=t.hash&&(new mf).addTo(this),this._hash&&this._hash._onHashChange()||(e.defined(t.center)&&e.defined(t.zoom)&&!e.defined(t.position)?this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch,roll:t.roll}):this.jumpTo({target:t.position,bearing:t.bearing,pitch:t.pitch,roll:t.roll}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,e.extend({},t.fitBoundsOptions,{duration:0})))),this.resize(),this.directionLightParameter=new _g,this.animationManager=new Xa(this),this.videoManager=new hg,this.analysis={cutFillCollection:new pg(this.painter),excavationCollection:new vg(this.painter),highlightCollection:new Ng(this.painter),sightlineCollection:new Lg(this.painter),viewDomeCollection:new Eg(this.painter),viewshed3DCollection:new Rg(this.painter),interferenceCollection:new qg(this.painter)},t.style&&this.setStyle(t.style,{localIdeographFontFamily:t.localIdeographFontFamily,projection:t.projection}),t.attributionControl&&this.addControl(new Nf),t.fps&&this.addFPSControl(),t.logoControl&&this.addControl(new Ff,t.logoPosition,t.logoUrl),this.on("style.load",(()=>{if(Object.getOwnPropertyDescriptor(this,"testMode").hasOwnProperty("get"))throw new Error("The introduction framework modifies the properties of minemap itself. Please check whether the instantiated object uses the Object.defineproperty method (P.S. may be due to Vue or React)");this.transform.unmodified&&this.jumpTo(this.style.stylesheet);})),this.on("data",this._onData),this.on("dataloading",this._onDataLoading),this.on("processStyleJson",this._processStyleJson),this._overviewMapOptions=t,t.overviewMap?(this._overviewMap=!0,this.addOverviewMap()):this._overviewMap=!1,this._terrainSkirtHeight=t.terrainSkirtHeight,this.setCursor(t.defaultCursor);const{skyBox:r,earthSkin:n,earthSkinDepth:o}=t;this._earthSkin=n,this._earthSkinDepth=o,this._addBaseEarthImage(r,n,o),this._printInfo(),this._rerender();}enableRequestManage(){}disableRequestManage(){}setRequestManageDuration(){}_addBaseEarthImage(e,t,i){const s=`${yt.SRC_URL}/assets`;if(e){const e=new Uu({starrySkyTextureUrls:{nx:`${s}/tycho2t3_80_pz/tycho2t3_80_mx.jpg`,px:`${s}/tycho2t3_80_pz/tycho2t3_80_px.jpg`,ny:`${s}/tycho2t3_80_pz/tycho2t3_80_my.jpg`,py:`${s}/tycho2t3_80_pz/tycho2t3_80_py.jpg`,nz:`${s}/tycho2t3_80_pz/tycho2t3_80_mz.jpg`,pz:`${s}/tycho2t3_80_pz/tycho2t3_80_pz.jpg`},dayTextureUrls:{nx:`${s}/penguins-skybox-pack/penguins (44)/yonder_lf.jpg`,px:`${s}/penguins-skybox-pack/penguins (44)/yonder_rt.jpg`,ny:`${s}/penguins-skybox-pack/penguins (44)/yonder_dn.jpg`,py:`${s}/penguins-skybox-pack/penguins (44)/yonder_up.jpg`,nz:`${s}/penguins-skybox-pack/penguins (44)/yonder_ft.jpg`,pz:`${s}/penguins-skybox-pack/penguins (44)/yonder_bk.jpg`}});this.addSceneComponent(e);}if(t){const e=new Wu({url:`${s}/Earth_Diffuse22.png`,cloudImageUrl:`${s}/Earth_Clouds4.png`,nightImageUrl:`${s}/imageNightLightEarth.png`,widthSegments:128,heightSegments:64,depth:i});this.addSceneComponent(e);}}getCurrentLocation(){return {center:this.getCenter().toArray(),zoom:this.getZoom(),pitch:this.getPitch(),bearing:this.getBearing(),roll:this.getRoll()}}_onMove(t){if(!t.overviewMapInstance)return;t.overviewMapInstance.jumpTo({center:t.getCenter(),zoom:t.getZoom()<6?3:t.getZoom()-3,bearing:t.getBearing(),pitch:0,roll:0});const i=t.overviewMapInstance.getPixelBounds(),s={positions:e.Vector3.fromDegreesArrayHeights([...i[0].toArray(),0,...i[1].toArray(),0,...i[2].toArray(),0,...i[3].toArray(),0,...i[0].toArray(),0]),width:1,arcType:e.ARCTYPE.GEODESIC};t.getZoom()>2?(t.overviewMapInstance.style.primitiveCollection._data.forEach((e=>{e.visible=!0;})),t.overviewMapInstance.overViewPolyline?.setData(s)):t.overviewMapInstance.style.primitiveCollection._data.forEach((e=>{e.visible=!1;}));}disableDrag(){this.dragPan.disable();}enableDrag(){this.dragPan.enable();}setCursor(e){this._canvas.style.cursor=e||"";}getZoomFromDistance(t){return e.getZoomFromDistance(this.transform._fov,e.CONSTS.TRANSFORM.R+t,e.CONSTS.TRANSFORM.R)}getZoomFromDistanceForUser(){console.error("很抱歉，当前方法已经迁移，调用新的方法getZoomFromDistance");}getDistanceFromZoom(t){return e.getDistanceFromZoom(this.transform._fov,t,e.CONSTS.TRANSFORM.R)-e.CONSTS.TRANSFORM.R}getDistanceFromZoomForUser(e){console.error("很抱歉，当前方法已经迁移，调用新的方法getDistanceFromZoom");}getCursor(){return this.getCanvas().style.cursor}setZoomAndCenter(e,t){this.jumpTo({center:t,zoom:e});}getAllMarkers(){return this._markers}addMarker(e){if(e instanceof Qf){if(this._markers.filter((t=>t._uuid===e._uuid)).length)return;e.addTo(this);}}addMarkers(e){for(let t=0;t<e.length;t++)this.addMarker(e[t]);}removeMarker(e){e instanceof Qf&&e.remove();}removeMarkers(e){if(e&&e.length)for(let t=0;t<e.length;t++)this.removeMarker(e[t]);else console.error("removeMarkers need a array of marker");}removeAllMarkers(){const e=[...this._markers];this.removeMarkers(e);}removeOverviewMap(){this.overviewMapInstance&&(this._overviewDrag&&this._overviewDrag.remove(),this.off("move",this._onMove),this.overviewMapInstance.remove(),this.overviewMapInstance=null,this.getContainer().parentNode.parentNode.removeChild(this._overviewMapElement),this._overviewMapElement=null);}updateOverviewMap(e){this.overviewMapInstance.getLayer(e.id)||(void 0===this.overviewMapInstance.getSource(e.source)&&this.overviewMapInstance.style.addSource(e.source,this.getSource(e.source)._options),this.overviewMapInstance.style.addLayer(e),this.overviewMapInstance._update(!0));}addOverviewMap(){this.overviewMapInstance||(this._overviewMapElement=e.window.document.createElement("div"),this._overviewMapElement.id=`overviewMap_${Math.random()}`,this._overviewMapElement.style.position="absolute",this._overviewMapElement.style.width="160px",this._overviewMapElement.style.height="160px",this._overviewMapElement.style.bottom="0px",this._overviewMapElement.style.right="0px",this._overviewMapElement.style.zIndex=200,this._overviewMapElement.style.boxSizing="border-box",this._overviewMapElement.style.border="2px solid rgba(187,187,187,0.5)",this._overviewMapElement.style.borderRadius="2px",this.getContainer().parentNode.parentNode.appendChild(this._overviewMapElement),this.overviewMapInstance=new fT({container:this._overviewMapElement,style:this._overviewMapOptions.style,center:this.getCenter(),zoom:this.getZoom()<7?3:this.getZoom()-4,pitch:0,dragPan:!1,doubleClickZoom:!1,scrollZoom:!1,dragRotate:!1,dragZoom:!1,maxZoom:22,minZoom:3,logoControl:!1,preserveDrawingBuffer:!0,projection:this.isLatLon?"LATLON":"MERCATOR"}),this.on("move",this._onMove.bind(null,this)),setTimeout((()=>{const t=this.overviewMapInstance.getCurrentViewBounds(this),i=new e.PolylineGeometry({positions:e.Vector3.fromDegreesArrayHeights([...t[0].toArray(),0,...t[1].toArray(),0,...t[2].toArray(),0,...t[3].toArray(),0,...t[0].toArray(),0]),width:1,arcType:e.ARCTYPE.GEODESIC}),s=e.PolylineMaterial.fromType("Color",{color:"red"}),r=new e.Primitive({geometry:i,material:s,name:"overViewPolyline"});this.overviewMapInstance.overViewPolyline=i;const n=Object.keys(this.getAllLayers()).reduce(((e,t)=>("raster"!==this.getAllLayers()[t].type&&"vector"!==this.getAllLayers()[t].type||(e[t]=this.getAllLayers()[t]),e)),{});if(Object.keys(n).length>0)for(const e in n){const t=n[e].source;this.overviewMapInstance.style.addSource(t,this.getSource(t)._options),this.overviewMapInstance.addLayer({id:e,type:n[e].type,source:t,minzoom:n[e].minzoom,maxzoom:n[e].maxzoom});}this.overviewMapInstance.addPrimitive(r);}),100));}openOverviewMap(e){this._overviewMap=e,this.overviewMapInstance?this._overviewMapElement.style.display="block":this.addOverviewMap();}closeOverviewMap(){this.overviewMapInstance&&(this._overviewMapElement.style.display="none");}getOverviewMap(){return this._overviewMap}addControl(t,i,s){if(void 0===i&&(i=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=t.onAdd(this,s);this._controls.push(t);const n=this._controlPositions[i];return -1!==i.indexOf("bottom")?n.insertBefore(r,n.firstChild):n.appendChild(r),this}convertV34Pos2V4(t){return e.V34Pos2V4PosUtil(t,e.CONSTS.TRANSFORM.FOV_IN_RADIANS)}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(t);return i>-1&&this._controls.splice(i,1),t.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&(this.fire(new e.Event("movestart",t)).fire(new e.Event("move",t)),Ge.executeEvent(this,"movestart"),Ge.executeEvent(this,"move")),this.fire(new e.Event("resize",t)),i&&(this.fire(new e.Event("moveend",t)),Ge.executeEvent(this,"moveend")),this}getBounds(){return (new e.LngLatBounds).extend(this.transform.pointLocation(new e.pointGeometry3d(0,0))).extend(this.transform.pointLocation(new e.pointGeometry3d(this.transform.width,0))).extend(this.transform.pointLocation(new e.pointGeometry3d(this.transform.width,this.transform.height))).extend(this.transform.pointLocation(new e.pointGeometry3d(0,this.transform.height)))}getCurrentViewBounds(){const t=[],i=[new e.pointGeometry3d(0,0),new e.pointGeometry3d(this.transform.width,0),new e.pointGeometry3d(this.transform.width,this.transform.height),new e.pointGeometry3d(0,this.transform.height)];return i.forEach((s=>{let r=this.transform.pointLocation(s),n=0;for(;!r&&n<this.transform.width/2;)s.x+=s===i[0]||s===i[3]?1:-1,s.y+=s===i[0]||s===i[1]?1:-1,r=this.transform.pointLocation(s),n++;t.push(r||new e.LngLat(0,0));})),t}getMaxBounds(){return this.transform.latRange&&2===this.transform.latRange.length&&this.transform.lngRange&&2===this.transform.lngRange.length?new e.LngLatBounds([this.transform.lngRange[0],this.transform.latRange[0]],[this.transform.lngRange[1],this.transform.latRange[1]]):null}setMaxBounds(t){if(t){const i=e.LngLatBounds.convert(t);this.transform.lngRange=[i.getWest(),i.getEast()],this.transform.latRange=[i.getSouth(),i.getNorth()],this._update();}else null==t&&(this.transform.lngRange=null,this._update());return this}setMinZoom(e){if((e=null==e?0:e)>=0&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between 0 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}project(t,i){return this.transform.locationPoint(e.LngLat.convert(t),i)}unproject(t,i){return this.transform.pointLocation(e.pointGeometry3d.convert(t),i)}isMoving(){return this._moving}isZooming(){return this._zooming}isRotating(){return this._rotating}_createDelegatedListener(e,t,i){if("mouseenter"===e||"mouseover"===e){let s=!1;const r=r=>{const n=t.filter((e=>this.getLayer(e))),o=n.length?this.queryRenderedFeatures(r.point,{layers:n}):[];o.length?s||(s=!0,i.call(this,new Q(e,this,r.originalEvent,{features:o}))):s=!1;},n=()=>{s=!1;};return {layers:new Set(t),listener:i,delegates:{mousemove:r,mouseout:n}}}if("mouseleave"===e||"mouseout"===e){let s=!1;const r=r=>{const n=t.filter((e=>this.getLayer(e)));(n.length?this.queryRenderedFeatures(r.point,{layers:n}):[]).length?s=!0:s&&(s=!1,i.call(this,new Q(e,this,r.originalEvent)));},n=t=>{s&&(s=!1,i.call(this,new Q(e,this,t.originalEvent)));};return {layers:new Set(t),listener:i,delegates:{mousemove:r,mouseout:n}}}{const s=e=>{const s=t.filter((e=>this.getLayer(e))),r=s.length?this.queryRenderedFeatures(e.point,{layers:s}):[];r.length&&(e.features=r,i.call(this,e),delete e.features);};return {layers:new Set(t),listener:i,delegates:{[e]:s}}}}on(e,t,i){const s=Ge.addEventListeners(e,t,this,!1);if(s.length>0)return s;if(void 0===i){if(null==t)return;return super.on(e,t)}Array.isArray(t)||(t=[t]);const r=this._createDelegatedListener(e,t,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(r);for(const e in r.delegates)this.on(e,r.delegates[e]);return this}once(e,t,i){const s=Ge.addEventListeners(e,t,this,!0);if(s.length>0)return s;if(void 0===i)return super.once(e,t);Array.isArray(t)||(t=[t]);const r=this._createDelegatedListener(e,t,i);for(const e in r.delegates)this.once(e,r.delegates[e]);return this}off(e,t,i){if(Ge.removeEventListeners(e,t,this))return;if(void 0===i)return super.off(e,t);t=new Set(Array.isArray(t)?t:[t]);const s=(e,t)=>{if(e.size!==t.size)return !1;for(const i of e)if(!t.has(i))return !1;return !0},r=this._delegatedListeners?this._delegatedListeners[e]:void 0;return r&&(e=>{for(let r=0;r<e.length;r++){const n=e[r];if(n.listener===i&&s(n.layers,t)){for(const e in n.delegates)this.off(e,n.delegates[e]);return e.splice(r,1),this}}})(r),this}queryRenderedFeatures(t,i,s){if(!this.style)return [];let r;if(void 0!==i||void 0===t||t instanceof e.pointGeometry3d||Array.isArray(t)||(i=t,t=void 0),i=i||{},(t=t||[[0,0],[this.transform.width,this.transform.height]])instanceof e.pointGeometry3d||"number"==typeof t[0]){r=[e.pointGeometry3d.convert(t)];const n=this.style.queryRenderedFeatures(r,i,this.transform,s);return e.sortFeaturesDependsAnchor(n,this.unproject(t))}{const n=e.pointGeometry3d.convert(t[0]),o=e.pointGeometry3d.convert(t[1]);r=[n,new e.pointGeometry3d(o.x,n.y),o,new e.pointGeometry3d(n.x,o.y),n];const a=this.style.queryRenderedFeatures(r,i,this.transform,s),l=e.pointGeometry3d.convert([(n.x+o.x)/2,(n.y+o.y)/2]);return e.sortFeaturesDependsAnchor(a,this.unproject(l))}}queryPixelColor(t,i){if(!this.painter)return [];let s;if(void 0!==i||void 0===t||t instanceof e.pointGeometry3d||Array.isArray(t)||(i=t,t=void 0),i=i||{},(t=t||[[0,0],[this.transform.width,this.transform.height]])instanceof e.pointGeometry3d||"number"==typeof t[0])t=e.pointGeometry3d.convert(t),s=[new e.pointGeometry3d(t.x,t.y,0)];else {const i=e.pointGeometry3d.convert(t[0]),r=e.pointGeometry3d.convert(t[1]);s=[i,new e.pointGeometry3d(r.x,i.y),r,new e.pointGeometry3d(i.x,r.y),i];}return this.painter.queryPixelColor(s,i)}querySpherePosition(e,t){return this.queryDEMSourceHeightByPoint(e,t)}queryDEMSourceHeightByPoint(e,t){return []}queryDEMHeightByPoint(e){const t=this.getPositionByGPUPick(e);let i;return this.style.rasterSourceCache.terrainSource.isTerrain()&&(i=Ol([t.x,t.y],this.style.rasterSourceCache.terrainSource,this.projection)),t.z=i||0,t}async queryAccurateDEMHeightByPoint(t){const i=this.getPositionByGPUPick(t);let s;return this.style.rasterSourceCache.terrainSource.isTerrain()&&(s=await function(t,i,s){t=e.LngLat.convert(t);const r={longitude:e.toRadians(t.lng),latitude:e.toRadians(t.lat),height:0};if(!i.availability)return void console.error("没有提供地形索引文件，无法查询当前位置最高精度的dem");const n=i.availability.computeMaximumLevelAtPosition(r);if(n<0)return;const o=i.map._tilingScheme.positionToTileXY(r,n),a=new e.OverscaledTileID(n,0,n,o.x,o.y,s);let l=i._tempTerrainTiles.get(a.key);return l||(l=i._terrainTiles.get(a.key)),l&&l.data?Ll(l,t,s):new Promise(((e,t)=>i.requestTempData(a,((i,s)=>{i&&t(i),e(s);})))).then((e=>{if("replaced"!==e.state)return Ll(e,t,s)}))}([i.x,i.y],this.style.rasterSourceCache.terrainSource,this.projection)),i.z=s||0,i}queryDEMHeightByLngLat(t){let i;return t=e.LngLat.convert(t),this.style.rasterSourceCache.terrainSource.isTerrain()&&(i=Ol([t.lng,t.lat],this.style.rasterSourceCache.terrainSource,this.projection)),new e.Vector3(t.lng,t.lat,i||0)}querySourceFeatures(e,t){return this.style.querySourceFeatures(e,t)}getStyle(){if(this.style)return this.style.serialize()}setStyle(t,i){return (i=e.extend({},{localIdeographFontFamily:dT.localIdeographFontFamily},i)).diff=e.defaultValue(i.diff,!1),i.keepUserInfo=e.defaultValue(i.keepUserInfo,!1),i.useCustomCamera=e.defaultValue(i.useCustomCamera,!0),this.projection===e.ProjectionType.LATLON&&(i.projection=e.ProjectionType.LATLON),e.defined(this.style)&&(this.style.fristClassificationTypeId=void 0),(i.keepUserInfo||i.diff)&&e.defined(this.style)&&e.defined(t)?(this._diffStyle(t,i),this):(this._clearScene(),this._updateStyle(t,i))}set minHeightToDemSurface(e){this.transform.minHeightToDemSurface=null!=e&&null!=e?e:1;}get minHeightToDemSurface(){return this.transform.minHeightToDemSurface}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove()),e?(this.style=new am(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e,t):this.style.loadJSON(e,t),this):(delete this.style,this)}_clearScene(){this.animationManager.removeAll(),this.videoManager.removeAll(),this.postProcessStages.removeAll(),this.analysis.cutFillCollection.removeAll(),this.analysis.excavationCollection.removeAll(),this.analysis.viewDomeCollection.removeAll(),this.analysis.viewshed3DCollection.removeAll(),this.analysis.sightlineCollection.removeAll(),this.analysis.highlightCollection.removeAll(),this.analysis.interferenceCollection.removeAll(),this.particleSystemCollection.removeAll();}_lazyInitEmptyStyle(){this.style||(this.style=new am(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty());}_diffStyle(t,i){if("string"==typeof t){const s=bt(t),r=this._transformRequest(s,e.ResourceType.Style);e.getJSON(r,((t,s)=>{t?this.fire(new e.ErrorEvent(t)):s&&this._updateDiff(s,i);}));}else "object"==typeof t&&this._updateDiff(t,i);}_updateDiff(t,i){try{this.style.setState(t,i.keepUserInfo)&&(this._update(!0),this.fire(new e.Event("style.load")),this.fire(new e.Event("processStyleJson",{dataType:"style",diff:i.diff,keepUserInfo:i.keepUserInfo,styleJsonData:t})));}catch(s){e.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(t,i);}}isStyleLoaded(){return this.style?this.style.loaded():e.warnOnce("There is no style added to the map.")}addSceneComponent(e){let t;if(Array.isArray(e)){t=[];for(let i=0;i<e.length;i++)t.push(this.style.addSceneComponent(e[i]));}else t=this.style.addSceneComponent(e);return t}getSceneComponent(e){if(this.style)return this.style.getSceneComponent(e)}removeSceneComponent(e){if(this.style)return this.style.removeSceneComponent(e)}addPrimitive(e){if(Array.isArray())for(let t=0;t<e.length;t++)this.style.addPrimitive(e[t]);else this.style.addPrimitive(e);return e}removePrimitive(e){this.style.removePrimitive(e);}removePrimitiveById(e){this.style.removePrimitiveById(e);}getPrimitiveById(e){return this.style.getPrimitiveById(e)}addParticleSystem(e){this.particleSystemCollection.add(e);}removeParticleSystemById(e){return this.particleSystemCollection.remove(e,this)}addSource(e,t){return "3d-tiles"===t.type&&console.warn("该添加3d-tiles到source方法已被废弃，请使用addSceneComponent替换！"),this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0),this}isSourceLoaded(t){const i=this.style&&this.style.sourceCaches[t];if(void 0!==i)return i.loaded();this.fire(new e.ErrorEvent(new Error(`There is no source with ID '${t}'`)));}areTilesLoaded(){const e=this.style&&this.style.sourceCaches;for(const t in e)if(!e[t].loaded())return !1;return !!(this.style.modelCollection.loaded()&&this.style.tilesetCollection.loaded()&&this.style.sceneObjectCollection.loaded()&&this.style.scenePointPrimitiveCollection.loaded())}addSourceType(e,t,i){return this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,i)}removeSource(e){return this.style.removeSource(e),this._update(!0),this}getSource(e){if(this.style)return this.style.getSource(e)}addImage(t,i,{pixelRatio:s=1,sdf:r=!1,stretchX:n,stretchY:o,content:a,url:l}={}){if(this._lazyInitEmptyStyle(),i instanceof uT||pT&&i instanceof pT){const{width:h,height:_,data:c}=e.exported.getImageData(i);this.style.addImage(t,{data:new e.RGBAImage({width:h,height:_},c),pixelRatio:s,stretchX:n,stretchY:o,content:a,sdf:r,version:0,url:l});}else {if(void 0===i.width||void 0===i.height)return this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:h,height:_,data:c}=i,d=i;this.style.addImage(t,{data:new e.RGBAImage({width:h,height:_},new Uint8Array(c)),pixelRatio:s,stretchX:n,stretchY:o,content:a,sdf:r,version:0,userImage:d,url:l}),d.onAdd&&d.onAdd(this,t);}}}updateImage(t,i){const s=this.style.getImage(t);if(!s)return this.fire(new e.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const r=i instanceof uT||pT&&i instanceof pT?e.exported.getImageData(i):i,{width:n,height:o,data:a}=r;return void 0===n||void 0===o?this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):n!==s.data.width||o!==s.data.height?this.fire(new e.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(s.data.replace(a,!(i instanceof uT||pT&&i instanceof pT)),void this.style.updateImage(t,s))}hasImage(t){return t?!!this.style.getImage(t):(this.fire(new e.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e);}loadImage(t,i){e.getImage(this._transformRequest(t,e.ResourceType.Image),i);}loadImages(e,t){const i={};e.forEach((s=>{this.loadImage(s,((r,n)=>{r?t(r):(i[s]=n,Object.keys(i).length===e.length&&t(null,i));}));}));}listImages(){return this.style.listImages()}addLayer(e,t){return this._lazyInitEmptyStyle(),"3d-tiles"===e.type&&console.warn("该添加3d-tiles到layer方法已被废弃，请使用addSceneComponent替换！"),this.style.addLayer(e,t),this._update(!0),this.overviewMapInstance&&this.updateOverviewMap(e),this}addLight(e){e&&"SunLight"==e.type?this.painter.frameState.sunLight=e:this.painter.frameState.addLight(e);}removeLight(e){e instanceof ra?e.id==this.painter.frameState._sunLight.id?this.painter.frameState._sunLight=void 0:console.warn("不存在此光源"):this.painter.frameState._lights=this.painter.frameState._lights.filter((t=>t.id!=e.id));}updatePointLightShadow(){this.painter.frameState._lights.length>0&&this.painter.frameState._lights.forEach((e=>{e instanceof lf&&(e.shadowRepaint=!0);}));}getLights(){const e=[];return this.painter.frameState._lights.length>0&&this.painter.frameState._lights.forEach((t=>{e.push(t);})),null!=this.painter.frameState._sunLight&&e.push(this.painter.frameState._sunLight),e}enableLight(){this.painter.frameState._enableLight=!0;}disableLight(){this.painter.frameState._enableLight=!1;}getId(e){return this.style.getId(e)}moveLayer(e,t){return this.style.moveLayer(e,t),this._update(!0),this}upwardMoveLayer(e,t){return this.style.upwardMoveLayer(e,t),this._update(!0),this}removeLayer(e){return this.style.removeLayer(e),this._update(!0),this.overviewMapInstance&&void 0!==this.overviewMapInstance.style.getLayer(e)&&(this.overviewMapInstance.style.removeLayer(e),this.overviewMapInstance._update(!0)),this}getLayer(e){return this.style.getLayer(e)}setFilter(e,t){return this.style.setFilter(e,t),this._update(!0),this}setSourceFilter(e,t){return this.style.setSourceFilter(e,t),this._update(!0),this}setLayerZoomRange(e,t,i){return this.style.setLayerZoomRange(e,t,i),this._update(!0),this}getFilter(e){return this.style.getFilter(e)}setPaintProperty(e,t,i){return this.style.setPaintProperty(e,t,i),this._update(!0),this}getPaintProperty(e,t){return this.style.getPaintProperty(e,t)}setLayoutProperty(e,t,i){return this.style.setLayoutProperty(e,t,i),this._update(!0)}getLayoutProperty(e,t){return this.style.getLayoutProperty(e,t)}setTime(){let e;void 0===this._time?(e=(new Date).getTime(),this.painter?.frameState?.sunLight&&(this.painter.frameState.sunLight.timestamp=e),this._update(!0)):this.setSunLight(this._time);}setSunLight(e){const t=new Date,i=new Date(e.year||t.getFullYear(),e.month-1,e.day,e.hour,e.minute,0).getTime();this.painter?.frameState?.sunLight&&(this.painter.frameState.sunLight.timestamp=i),this._update(!0);}getSunDuration(e,t){const i=function(e,t){const i=ia(t.month),s=23.45*Math.sin(360*(i+t.day-80)/370*Math.PI/180),r=Math.PI/180,n=180/Math.PI,o=Math.tan(e*r)*Math.tan(s*r);let a;a=o>=1?Math.PI:o<-1?0:Math.acos(-o);const l=2/15*a*n;return [12-l/2,12+l/2]}(e,t);return i}setCameraFlyingHeight(e){console.error("调用的setCameraFlyingHeight的方法无效，请参见文档的迁移建议");}setViewshedVisibleColor(){}setViewshedInVisibleColor(){}enableShadow(t){t==e.ShadowsType.ShadowMapping||t==e.ShadowsType.PCF?(this._shadows=!0,this.painter.setShadows(this._shadows),this.painter.frameState.setShadows(this._shadows),this.painter.frameState._shadowModel=t,this._update(!0),console.warn("点光源阴影效果当前仅支持最多6个点光源,多余的点光源将不产生阴影!!")):console.warn(`不支持输入阴影类型: ${t}`);}disableShadow(){this._shadows=!1,this.painter.setShadows(this._shadows),this.painter.frameState.setShadows(this._shadows),this.painter.frameState._shadowModel=e.ShadowsType.NONE,this._update(!0);}enableNearDetection(){}disableNearDetection(){}enableNormalPass(){this._enableNormal=!0,this.painter.setNormalPass(this._enableNormal);}disableNormalPass(){this._enableNormal=!1,this.painter.setNormalPass(this._enableNormal);}setResolvePass(e){this._resolvePass=e,this.painter.setResolvePass(e);}setFeatureState(e,t){return this.style.setFeatureState(e,t),this._update()}removeFeatureState(e,t){return this.style.removeFeatureState(e,t),this._update()}getFeatureState(e){return this.style.getFeatureState(e)}get trackingOptions(){return this._trackingOptions}set trackingOptions(e){this._trackingOptions=e;}get roamingOptions(){return this._roamingOptions}set roamingOptions(e){this._roamingOptions=e;}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}get enableUnderGround(){return this._enableUnderGround}set enableUnderGround(t){e.isBoolean(t)&&(this._enableUnderGround=t,this._cameraController.enableCollisionDetection=!t);}get cameraController(){return this._cameraController}_updateContainerDimensions(){if(!this._container)return;const t=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let s,r=this._container;for(;r&&!s;){const t=e.window.getComputedStyle(r).transform;t&&"none"!==t&&(s=t.match(/matrix.*\((.+)\)/)[1].split(", ")),r=r.parentElement;}s?(this._containerWidth=s[0]&&"0"!==s[0]?Math.abs(t/s[0]):t,this._containerHeight=s[3]&&"0"!==s[3]?Math.abs(i/s[3]):i):(this._containerWidth=t,this._containerHeight=i);}_detectMissingCSS(){"rgb(250, 128, 114)"!==e.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.warnOnce("当前页面没有找到minemap.css声明，可能会产生一些页面布局或者渲染错误。");}_setupContainer(){const e=this._container;e.classList.add("minemap-map"),(this._missingCSSCanary=W.create("div","minemap-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=W.create("div","minemap-canvas-container",e);this._interactive&&t.classList.add("minemap-interactive"),this._canvas=W.create("canvas","minemap-canvas",t),this._canvas.style.position="absolute",this._canvas.style.left="0",this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=W.create("div","minemap-control-container",e),s=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((e=>{s[e]=W.create("div",`minemap-ctrl-${e}`,i);})),this._container.addEventListener("scroll",this._onMapScroll,!1);}_resizeCanvas(t,i){const s=e.window.devicePixelRatio||1;this._canvas.width=s*Math.ceil(t),this._canvas.height=s*Math.ceil(i),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${i}px`;}_setupPainter(){const t=e.extend({failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer},zf.webGLContextAttributes),i=this._canvas.getContext("webgl",t)||this._canvas.getContext("experimental-webgl",t);i?(this.painter=new uf(i,this),this.painter.postProcessStages.fxaa.enabled=this._fxaaRender,this.painter.setShadows(this._shadows),1==this._shadows&&console.warn("点光源阴影效果当前仅支持最多6个点光源,多余的点光源将不产生阴影!!"),this.painter.frameState.setShadows(this._shadows),this.painter.setNormalPass(this._enableNormal),this.painter.setResolvePass(this._resolvePass),this.painter.frameState._shadowModel=this._shadowsType,this.painter.mainPass.SSAASamples=this._SSAASamples):this.fire(new e.ErrorEvent(new Error("Failed to initialize WebGL")));}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.Event("webglcontextlost",{originalEvent:t}));}_contextRestored(t){this._setupPainter(),this.resize(),this._update(),this.fire(new e.Event("webglcontextrestored",{originalEvent:t}));}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return !this._styleDirty&&!(!this.style||!this.style.loaded())}_update(e){this.style&&(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.needRepaint=!0);}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e);}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e);}_render(t){if(this.painter.setBaseState(),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;let i=!1;if(this.style.updateSymbolHelperMatrix(),this.style&&this._styleDirty){this._styleDirty=!1;const t=this.style.symbolMatrixHelper.zoom,s=e.exported.now();this.style.zoomHistory.update(t,s);const r=new e.EvaluationParameters(t,{now:s,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),n=r.crossFadingFactor();1===n&&n===this._crossFadingFactor||(i=!0,this._crossFadingFactor=n),this.style.update(r);}return this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.style._updateSources()):this.style&&!this.style.performanceManager.eventDone&&this.style._updateSources(),this.style.performanceManager.eventDone=!1,this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions,!1,this._symbolNumStrategy),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,showDebugBoundingBox:this._showDebugBoundingBox,rotating:this.isRotating(),zooming:this.isZooming(),fadeDuration:this._fadeDuration}),this.fire(new e.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new e.Event("load"))),this.style&&(this.style.hasTransitions()||i)&&(this._styleDirty=!0),!this.isMoving()&&this.loaded()&&this.fire(new e.Event("idle")),this}setTerrain(e){this.style.rasterSourceCache.setTerrain(e);for(const e in this.style.sourceCaches)this.style.sourceCaches[e].quadtree?.destroy(),delete this.style.sourceCaches[e].quadtree;this.style.proxySourceCache.updateLayer();}remove(){this._hash&&this._hash.remove(),this._cameraController.destroy(),this._screenSpaceEventHandler.destroy();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style?.clearWorkerCaches(),this.painter.destroy(),this.setStyle(null),void 0!==e.window&&(e.window.removeEventListener("resize",this._onWindowResize,!1),e.window.removeEventListener("orientationchange",this._onWindowResize,!1),e.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),e.window.removeEventListener("online",this._onWindowOnline,!1));const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),gT(this._canvasContainer),gT(this._controlContainer),gT(this._missingCSSCanary),this._container.classList.remove("minemap-map"),this._removed=!0,this.fire(new e.Event("remove")),this.removeOverviewMap();}triggerRepaint(e){this.style&&(this.timer.update(e),this._updateSyncAnimation(this.timer.getDelta()),this._render(e),this.roam());}getAllLayers(){return this.style._layers||{}}getAllSources(){const e=this.style.sourceCaches,t=this.style.rasterSourceCache.getAllSources();if(Object.keys(e).length>0)for(const i in e)e.hasOwnProperty(i)&&(t[i]=this.getSource(i));return t}getAllPopups(){return this.__popupList}_getGlobeHeight(){let t=0;if(e.defined(this.transform.activeCamera)&&e.defined(this.transform.activeCamera.cartographicPosition)&&this.style.rasterSourceCache.terrainSource.isTerrain()&&this.style.rasterSourceCache.terrainSource.isLoaded()){const i=this.transform.activeCamera.cartographicPosition[0],s=this.transform.activeCamera.cartographicPosition[1],r=Il([i,s,0],e.Vector3.fromDegrees(i,s,1e4),this.style.rasterSourceCache.terrainSource,this.projection);t=e.defined(r.intersectionPoint)?e.Cartographic.fromVector3(r.intersectionPoint).height:void 0;}return t}_isCameraUnderground(){const t=this.transform.activeCamera.cartographicPosition;if(!e.defined(t))return !1;if(t[2]<0)return !0;const i=this._globeHeight;return e.defined(i)&&t[2]<i}_rerender(){this._frame||(this._frame=e.exported.frame((e=>{this._globeHeight=this._getGlobeHeight(),this._cameraUnderground=this._isCameraUnderground(this),this._cameraController.update(),this.transform.activeCamera._updateCameraChanged(),this.transform.cameraCheck.checkForCameraUpdates()?(this._styleDirty=!0,this.triggerRepaint(e)):(this._sourcesDirty||this._repaint||this._styleDirty||this._placementDirty||this.needRepaint)&&this.triggerRepaint(e),this.needRepaint=!1,this._frame=null,this._rerender();})));}_onWindowOnline(){this._update();}_onWindowResize(){this._trackResize&&this.resize()._update();}get showTileBoundaries(){return this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update());}get showCollisionBoxes(){return !!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update());}get showOverdrawInspector(){return !!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update());}get showDebugBoundingBox(){return !!this._showDebugBoundingBox}set showDebugBoundingBox(e){this._showDebugBoundingBox!==e&&(this._showDebugBoundingBox=e,this._update());}get repaint(){return !!this._repaint}set repaint(e){this._repaint=e,this.timer.state=!!e,this._update();}set atmosphere(e){this.painter.postProcessStages.atmosphere.enabled=e,this.needRepaint=!0;}get atmosphere(){return this.painter.postProcessStages.atmosphere.enabled}set atmosphereColor(t){const i=e.Vector4.fromColor(e.Color.parse(t));this.painter.postProcessStages.atmosphere.extraData.color=i,this.needRepaint=!0;}set fxaa(e){this._fxaaRender=e,this.painter.postProcessStages.fxaa.enabled=e;}get fxaa(){return this._fxaaRender}set SSAASamples(e){const t=Math.floor(Math.min(this.painter.context.gl.getParameter(this.painter.context.gl.MAX_TEXTURE_SIZE)/this.painter.width,this.painter.context.gl.getParameter(this.painter.context.gl.MAX_TEXTURE_SIZE)/this.painter.height));this._SSAASamples=Math.max(1,Math.min(e,t)),this.painter.mainPass.SSAASamples=this._SSAASamples;}get SSAASamples(){return this._SSAASamples}set hdr(e){this.painter.postProcessStages.useHdr=e;}get hdr(){return this.painter.postProcessStages.useHdr}set bloom(e){this._bloomRender=e,this.painter.postProcessStages.bloom.enabled=e;}get bloom(){return this._bloomRender}get postProcessStages(){return this.painter.postProcessStages}get projection(){return this.mapProjection._projection}set projection(t){t!==e.ProjectionType.MERCATOR&&t!==e.ProjectionType.LATLON||(this.mapProjection._projection=t);}get earthSkinDepth(){return this._earthSkinDepth}set earthSkinDepth(e){this._earthSkinDepth=e;const t=this.style.getSceneComponent("earthCrate-MinemapInternal");t&&(t.depth=e,this.needRepaint=!0);}get terrainSkirtHeight(){return this._terrainSkirtHeight}set terrainSkirtHeight(e){this._terrainSkirtHeight=e,this.style.rasterSourceCache.setTerrain(this.style.rasterSourceCache.terrainSource._options);}isTerrain(){return this.style.rasterSourceCache.terrainSource.isTerrain()}setBloomOptions(e){e&&(this._bloomOptions=e);}_onData(t){if("cesium-tile"===t.dataType)this._sourcesDirty=!1,this.needRepaint=!0;else if("gltf-data-loaded"===t.dataType)this._update(!1,!0);else {this._update("style"===t.dataType,!1);const i=t.styleJsonData;e.defined(i)&&e.defined(i.cameraPosition)&&this.setCameraPosition(i.cameraPosition),this.fire(new e.Event(`${t.dataType}data`,t));}}_processStyleJson(t){const i=t.styleJsonData;"style"===t.dataType&&e.defined(i)&&ly.deserialize(this,i,t);}_onDataLoading(t){this.fire(new e.Event(`${t.dataType}dataloading`,t));}getTDSpaceCoord(t){if(t.disableLayer){const i=this.unproject(t.point,0);return {lngLat:i,geographic:i?e.Transforms.cartographicToCartesian3([i.lng,i.lat,0]):null,altitude:0}}{const i=this.queryRenderedFeatures(t.point,{disableLayer:!1,modelHighlight:t.modelHighlight,highlightRange:t.highlightRange||e.CONSTS.HIGHLIGHT_TYPE.PRIMITIVE});if(0===i.length){const i=this.unproject(t.point,0);return {lngLat:i,geographic:i?e.Transforms.cartographicToCartesian3([i.lng,i.lat,0]):null,altitude:0}}{let s=null;for(let e=0;e<i.length;e++)i[e].hasOwnProperty("intersectionPoint")&&(s=i[e].intersectionPoint);if(s){const t=e.Transforms.cartesian3ToCartographic(new e.Vector3(s));return {geographic:s,lngLat:new e.LngLat(t[0],t[1]),altitude:t[2]*e.CONSTS.TRANSFORM.R_ZOOM}}{const i=this.unproject(t.point,0);return {lngLat:i,geographic:i?e.Transforms.cartographicToCartesian3([i.lng,i.lat,0]):null,altitude:0}}}}}setTimerCount(e){this.timer.totalTime=e,this._stopTimerCount=!1,this.timer.resumeTimer();}pauseTimerCount(){this._stopTimerCount||this.timer.pauseTimer();}resumeTimerCount(){this._stopTimerCount||this.timer.resumeTimer();}stopTimerCount(){this._stopTimerCount=!0,this.timer.pauseTimer();}getCameraHeight(){return +this.transform.activeCamera.cartographicPosition[2].toFixed(2)}get camera(){return this.transform.activeCamera}setMinPitch(t){if((t=e.defaultValue(t,0))<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=e.defaultValue(t,cT))>cT)throw new Error("maxPitch must be less than or equal to 180");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}addFPSControl(){return this.fpsControl||(this.fpsControl=new Hf,this.addControl(this.fpsControl,"top-right")),this.fpsControl}removeFPSControl(){this.fpsControl&&(this.removeControl(this.fpsControl),this.fpsControl=null);}getFeatureByGPUPick(e){return this.painter.getFeatureByGPUPick(e)}getFeatureByPickColor(e){return this.painter.getFeatureByPickColor(e)}getPositionByGPUPick(e,t){return this.painter.getPositionByGPUPick(e,t)}_updateSyncAnimation(e){this.animationManager.update(e),this.particleSystemCollection.collection.length>0&&this.particleSystemCollection.collection.forEach((t=>{t.update(e,this);}));}getEarthSkinObject(){return this.style.sceneObjectCollection.getEarthObject()}getPixelBounds(){const t=this.getCenter(),i=this.project(t),s=Math.ceil(this.transform.width/4),r=Math.ceil(this.transform.height/8),n=new e.pointGeometry3d(i.x-s,i.y+r),o=new e.pointGeometry3d(i.x+s,i.y+r),a=new e.pointGeometry3d(i.x+s,i.y-r),l=new e.pointGeometry3d(i.x-s,i.y-r);return [this.transform.pointLocation(n),this.transform.pointLocation(o),this.transform.pointLocation(a),this.transform.pointLocation(l)]}_printInfo(){console.log("%c╔╦╗╦╔╗╔╔═╗╔╦╗╔═╗╔═╗  ╔╦╗╔═╗╔═╗╔╦╗\r\n║║║║║║║║╣  ║║║╠═╣╠═╝    ║  ║╣  ╠═╣║║║\r\n╩  ╩╩╝╚╝╚═╝╩  ╩╩  ╩╩        ╩  ╚═╝╩  ╩╩  ╩\r\n","color: #40c0f5; font-size: 12px;"),console.log(`%cMineMap4.0\r\n版本：${pt}\r\n时间：${"/**\n * minemap-3d-engine\n * version: v4.8.2\n * submission time: 2024-06-19 19:36:13 +0800\n * build time: 2024-06-19 19:39:09\n * branch: master\n * SHA: f36999e8667124c569f3749f876e39797ee72ca5\n */"?.split("*")[6].substring(13,32)||(new Date).toLocaleDateString()}\r\n分支：master\r\n电话：400-650-0295\r\n邮箱：tujieyong11188@navinfo.com\r\n`,"color: red; font-size: 16px;");}}function gT(e){e.parentNode&&e.parentNode.removeChild(e);}const yT={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0},TT="minemap-ctrl";let CT;const xT={maxWidth:100,unit:"metric"};function bT(t,i,s,r){const n=r&&r.maxWidth||100,o=t._container.getBoundingClientRect().height/2,a=t._container.getBoundingClientRect().width/2,l=t.unproject([a,o]),h=t.unproject([a+1,o]);if(!l||!h)return;const _=function(t,i){const s=e.CONSTS.TRANSFORM.R,r=Math.PI/180,n=t.lat*r,o=i.lat*r,a=Math.sin(n)*Math.sin(o)+Math.cos(n)*Math.cos(o)*Math.cos((i.lng-t.lng)*r);return s*Math.acos(Math.min(a,1))}(t.unproject([a,o]),t.unproject([a+1,o]))*n;if(r&&"imperial"===r.unit){const e=3.2808*_;e>5280?vT(i,s,n,e/5280,t._getUIString("ScaleControl.Miles"),t):vT(i,s,n,e,t._getUIString("ScaleControl.Feet"),t);}else r&&"nautical"===r.unit?vT(i,s,n,_/1852,t._getUIString("ScaleControl.NauticalMiles"),t):_>=1e3?vT(i,s,n,_/1e3,t._getUIString("ScaleControl.Kilometers"),t):vT(i,s,n,_,t._getUIString("ScaleControl.Meters"),t);}function vT(e,t,i,s,r,n){const o=function(e){const t=Math.pow(10,`${Math.floor(e)}`.length-1);let i=e/t;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1,t*i}(s),a=o/s;n._requestDomTask((()=>{e.style.width=i*a+"px",e.innerHTML=`${o}&nbsp;${r}`;})),t.innerHTML=o+r;}const wT={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ST=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");var AT=Object.freeze({DISABLED:0,ENABLED:1,CAST_ONLY:2,RECEIVE_ONLY:3});const ET=e.createLayout([{name:"a_PositionHigh",type:"Float32",components:3},{name:"a_PositionLow",type:"Float32",components:3},{name:"a_COLOR_0",type:"Float32",components:4}]),MT=e.createLayout([{name:"a_POSITION",type:"Float32",components:3},{name:"a_COLOR_0",type:"Float32",components:4}],4);class PT extends e.Geometry{constructor(e){super(),this.dynamicDraw=!0,this._usedDoublePrecision=!1,this.setData(e);}setData(t){super.setData(),this._ready=!0,this.needUpdate=!0,this._indexArray?this._indexArray.resize(0):this._indexArray=new e.StructArrayLayout3ui6,this._vertexArray?this._vertexArray.resize(0):this._vertexArray=this._usedDoublePrecision?new e.StructArrayLayout10f40:new e.StructArrayLayout3f4f28,this.process(t),this.computeBoundingSphere(),this.computeBoundingBox();}process(t){this.vertices=t.data,this.primitiveCount=0;const i=t.data,s=t.properties.color,r=[];for(let t=0;t<s.length;t++)r.push(e.Color.parse(s[t]));const n=i.length;for(let t=0;t<n;t++){const s=Math.floor(t/8);if(this._usedDoublePrecision){const n=e.EncodedVector3.encode(i[t][0]),o=e.EncodedVector3.encode(i[t][1]),a=e.EncodedVector3.encode(i[t][2]);this._vertexArray.emplaceBack(n.high,o.high,a.high,n.low,o.low,a.low,r[s].r,r[s].g,r[s].b,r[s].a);}else this._vertexArray.emplaceBack(i[t][0],i[t][1],i[t][2],r[s].r,r[s].g,r[s].b,r[s].a);if(t%8==0){const e=t-1;this._indexArray.emplaceBack(e+1,e+4,e+2),this._indexArray.emplaceBack(e+2,e+4,e+3),this._indexArray.emplaceBack(e+5,e+6,e+8),this._indexArray.emplaceBack(e+6,e+7,e+8),this._indexArray.emplaceBack(e+3,e+4,e+8),this._indexArray.emplaceBack(e+3,e+8,e+7),this._indexArray.emplaceBack(e+1,e+2,e+5),this._indexArray.emplaceBack(e+2,e+6,e+5),this._indexArray.emplaceBack(e+1,e+8,e+4),this._indexArray.emplaceBack(e+1,e+5,e+8),this._indexArray.emplaceBack(e+2,e+3,e+7),this._indexArray.emplaceBack(e+2,e+7,e+6),this.primitiveCount+=12;}}}update(t){if(super.update(),this._ready&&this.needUpdate&&t.painter){this._ready=!1,this.needUpdate=!1;const i=t.painter.context;this._vertexBuffer&&this._indexBuffer?(this._vertexBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indexArray)):(this._vertexBuffer=i.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?ET.members:MT.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indexArray,this.dynamicDraw)),this._segmentVector&&this._segmentVector.destroy(),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length,this.primitiveCount);}}updateByIndex(){}destroy(){super.destroy();}}class RT extends e.Geometry{constructor(t){super(),this.dynamicDraw=!0,this._usedDoublePrecision=!1,this.primitiveType=e.WebGLConstants.LINES,this.setData(t);}setData(t){super.setData(),this._ready=!0,this.needUpdate=!0,this._indexArray?this._indexArray.resize(0):this._indexArray=new e.StructArrayLayout2ui4,this._vertexArray?this._vertexArray.resize(0):this._vertexArray=this._usedDoublePrecision?new e.StructArrayLayout10f40:new e.StructArrayLayout3f4f28,this.process(t),this.computeBoundingSphere(),this.computeBoundingBox();}process(t){this.vertices=t.data,this.primitiveCount=0;const i=t.data,s=t.properties.color,r=[];for(let t=0;t<s.length;t++)r.push(e.Color.parse(s[t]));const n=i.length;for(let t=0;t<n;t++){const s=Math.floor(t/8);if(this._usedDoublePrecision){const n=e.EncodedVector3.encode(i[t][0]),o=e.EncodedVector3.encode(i[t][1]),a=e.EncodedVector3.encode(i[t][2]);this._vertexArray.emplaceBack(n.high,o.high,a.high,n.low,o.low,a.low,r[s].r,r[s].g,r[s].b,r[s].a);}else this._vertexArray.emplaceBack(i[t][0],i[t][1],i[t][2],r[s].r,r[s].g,r[s].b,r[s].a);if(t%8==0){const e=t-1;this._indexArray.emplaceBack(e+1,e+2),this._indexArray.emplaceBack(e+2,e+3),this._indexArray.emplaceBack(e+3,e+4),this._indexArray.emplaceBack(e+4,e+1),this._indexArray.emplaceBack(e+1,e+5),this._indexArray.emplaceBack(e+2,e+6),this._indexArray.emplaceBack(e+3,e+7),this._indexArray.emplaceBack(e+4,e+8),this._indexArray.emplaceBack(e+5,e+6),this._indexArray.emplaceBack(e+6,e+7),this._indexArray.emplaceBack(e+7,e+8),this._indexArray.emplaceBack(e+8,e+5),this.primitiveCount+=12;}}}update(t){if(super.update(),this._ready&&this.needUpdate&&t.painter){this._ready=!1,this.needUpdate=!1;const i=t.painter.context;this._vertexBuffer&&this._indexBuffer?(this._vertexBuffer.updateData(this._vertexArray),this._indexBuffer.updateData(this._indexArray)):(this._vertexBuffer=i.createVertexBuffer(this._vertexArray,this._usedDoublePrecision?ET.members:MT.members,this.dynamicDraw),this._indexBuffer=i.createIndexBuffer(this._indexArray,this.dynamicDraw)),this._segmentVector&&this._segmentVector.destroy(),this._segmentVector=e.SegmentVector.simpleSegment(0,0,this.vertices.length,this.primitiveCount);}}updateByIndex(){}destroy(){super.destroy();}}class BT{constructor(t,i){t=e.defaultValue(t,0),this._near=t,i=e.defaultValue(i,Number.MAX_VALUE),this._far=i;}get near(){return this._near}set near(e){this._near=e;}get far(){return this._far}set far(e){this._far=e;}pack(t,i,s){if(!e.defined(t))throw new Error("value is required");if(!e.defined(i))throw new Error("array is required");return s=e.defaultValue(s,0),i[s++]=t.near,i[s]=t.far,i}unpack(t,i,s){if(!e.defined(t))throw new Error("array is required");return i=e.defaultValue(i,0),e.defined(s)||(s=new BT),s.near=t[i++],s.far=t[i],s}static equals(t,i){return t===i||e.defined(t)&&e.defined(i)&&t.near===i.near&&t.far===i.far}equals(e){return BT.equals(this,e)}static clone(t,i){if(e.defined(t))return e.defined(i)||(i=new BT),i.near=t.near,i.far=t.far,i}clone(e){return BT.clone(this,e)}}const IT=new e.Vector3(.005,.005,1),DT=new e.Vector3;class OT{constructor(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this.mass=e.defaultValue(t.mass,1),this.position=e.Vector3.clone(e.defaultValue(t.position,e.Vector3.ZERO)),this.positionClone=e.Vector3.clone(e.defaultValue(t.positionClone,e.Vector3.ZERO)),this.velocity=e.Vector3.clone(e.defaultValue(t.velocity,e.Vector3.ZERO)),this.life=e.defaultValue(t.life,Number.MAX_VALUE),this.image=t.image,this.texture=t.texture,this.imageUrl=t.imageUrl,this.startColor=e.Color.clone(e.Color.parse(e.defaultValue(t.startColor,e.Color.white))),this.endColor=e.Color.clone(e.Color.parse(e.defaultValue(t.endColor,e.Color.white))),this.startScale=e.defaultValue(t.startScale,1),this.endScale=e.defaultValue(t.endScale,1),this.imageSize=e.Vector3.clone(e.defaultValue(t.imageSize,IT)),this._age=0,this._normalizedAge=0,this._billboard=void 0,this.show=!0;}get age(){return this._age}get normalizedAge(){return this._normalizedAge}update(t,i){return e.Vector3.multiplyByScalar(this.velocity,t,DT),e.Vector3.add(this.position,DT,this.position),e.defined(i)&&i(this,t),this._age+=t,this._normalizedAge=this.life===Number.MAX_VALUE?0:this._age/this.life,this._age<=this.life}}class LT{constructor(t){t=e.defaultValue(t,1),this._radius=e.defaultValue(t,1);}emit(t){const i=e.randomBetween(0,e.CONSTS.TRANSFORM.TWO_PI),s=e.randomBetween(0,this._radius),r=s*Math.cos(i),n=s*Math.sin(i);t.position=e.Vector3.fromElements(r,n,0,t.position),t.velocity=e.Vector3.clone(e.Vector3.UNIT_Z,t.velocity);}}const VT=new e.Vector3;function NT(t){let i=t._particlePool.pop();return e.defined(i)||(i=new OT),i}function FT(e,t){e._particlePool.push(t);}function GT(t){e.defined(t)&&(t.show=!1);}function kT(t,i){i.show=!0;const s=e.lerp(i.startScale,i.endScale,i.normalizedAge);i.scale=s;const r=e.lerp(i.startColor.r,i.endColor.r,i.normalizedAge),n=e.lerp(i.startColor.g,i.endColor.g,i.normalizedAge),o=e.lerp(i.startColor.b,i.endColor.b,i.normalizedAge),a=e.lerp(i.startColor.a,i.endColor.a,i.normalizedAge);i.color=new e.Color(r,n,o,a);}function UT(t,i){i.startColor=e.Color.clone(t._startColor,i.startColor),i.endColor=e.Color.clone(t._endColor,i.endColor),i.startScale=t._startScale,i.endScale=t._endScale,i.image=t.image,i.imageUrl=t.imageUrl,i.texture=t.texture,i.life=t.particleLife,i.mass=e.randomBetween(t._minimumMass,t._maximumMass),i._normalizedAge=0,i._age=0,i.show=!0,i.imageSize=t.imageSize,e.Vector3.multiplyByScalar(i.velocity,t._speed,i.velocity),t._particles.push(i);}function HT(t,i){const s=e.defaultValue(Math.sign,(e=>0==(e=+e)||e!=e?e:e>0?1:-1)),r=e.defaultValue(Math.sign,(e=>0==(e=+e)||e!=e?e:e>0?1:-1));return s===r&&Math.abs(t)<Math.abs(i)?t:(t%i+i)%i}const zT=e.CONSTS.CesiumMath.toDegrees(30),WT=new e.Vector3(1,1,1),jT=new e.Vector3,XT=new e.Vector3(1,1,1),qT=new e.Vector3;class KT{read(t){if(!t)return null;if("string"==typeof t){const s=(i=t,(new e.window.DOMParser).parseFromString(i,"application/xml"));return this.readFromDocument(s)}return "documentElement"in t?this.readFromDocument(t):this.readFromNode(t);var i;}readFromDocument(t){for(let i=t.firstChild;i;i=i.nextSibling)if(i.nodeType==e.window.Node.ELEMENT_NODE)return this.readFromNode(i);return null}readFromNode(e){}}function JT(e,t){return ZT(e,t,[]).join("")}function ZT(t,i,s){if(t.nodeType==e.window.Node.CDATA_SECTION_NODE||t.nodeType==e.window.Node.TEXT_NODE)s.push(i?String(t.nodeValue).replace(/(\r\n|\r|\n)/g,""):t.nodeValue);else {let e;for(e=t.firstChild;e;e=e.nextSibling)ZT(e,i,s);}return s}function YT(e,t){return function(i,s){const r=e.call(void 0!==t?t:this,i,s);void 0!==r&&s[s.length-1].push(r);}}function QT(e,t,i){return function(s,r){const n=e.call(void 0!==i?i:this,s,r);if(void 0!==n){const e=r[r.length-1],i=void 0!==t?t:s.localName;let o;i in e?o=e[i]:(o=[],e[i]=o),o.push(n);}}}function $T(e,t,i){return function(s,r){const n=e.call(void 0!==i?i:this,s,r);void 0!==n&&(r[r.length-1][void 0!==t?t:s.localName]=n);}}function eC(e,t,i){let s,r;for(i=void 0!==i?i:{},s=0,r=e.length;s<r;++s)i[e[s]]=t;return i}function tC(e,t,i,s,r){return s.push(e),function(e,t,i,s){let r;for(r=t.firstElementChild;r;r=r.nextElementSibling){const t=e[r.namespaceURI];if(void 0!==t){const e=t[r.localName];void 0!==e&&e.call(s,r,i);}}}(t,i,s,r),s.pop()}function iC(e){return e.getAttributeNS("http://www.w3.org/1999/xlink","href")}function sC(e){return function(e){const t=/^\s*(\d+)\s*$/.exec(e);if(t)return parseInt(t[1],10)}(JT(e,!1))}function rC(e){return JT(e,!1).trim()}const nC=[null,"http://www.opengis.net/ows/1.1"],oC=eC(nC,{ServiceIdentification:$T((function(e,t){return tC({},TC,e,t)})),ServiceProvider:$T((function(e,t){return tC({},CC,e,t)})),OperationsMetadata:$T((function(e,t){return tC({},pC,e,t)}))});class aC extends KT{constructor(){super();}readFromNode(e){return tC({},oC,e,[])||null}}const lC=eC(nC,{DeliveryPoint:$T(rC),City:$T(rC),AdministrativeArea:$T(rC),PostalCode:$T(rC),Country:$T(rC),ElectronicMailAddress:$T(rC)}),hC=eC(nC,{Value:QT((function(e){return rC(e)}))}),_C=eC(nC,{AllowedValues:$T((function(e,t){return tC({},hC,e,t)}))}),cC=eC(nC,{Phone:$T((function(e,t){return tC({},fC,e,t)})),Address:$T((function(e,t){return tC({},lC,e,t)}))}),dC=eC(nC,{HTTP:$T((function(e,t){return tC({},uC,e,t)}))}),uC=eC(nC,{Get:QT((function(e,t){const i=iC(e);if(i)return tC({href:i},gC,e,t)})),Post:void 0}),mC=eC(nC,{DCP:$T((function(e,t){return tC({},dC,e,t)}))}),pC=eC(nC,{Operation:function(e,t){const i=e.getAttribute("name"),s=tC({},mC,e,t);s&&(t[t.length-1][i]=s);}}),fC=eC(nC,{Voice:$T(rC),Facsimile:$T(rC)}),gC=eC(nC,{Constraint:QT((function(e,t){const i=e.getAttribute("name");if(i)return tC({name:i},_C,e,t)}))}),yC=eC(nC,{IndividualName:$T(rC),PositionName:$T(rC),ContactInfo:$T((function(e,t){return tC({},cC,e,t)}))}),TC=eC(nC,{Abstract:$T(rC),AccessConstraints:$T(rC),Fees:$T(rC),Title:$T(rC),ServiceTypeVersion:$T(rC),ServiceType:$T(rC)}),CC=eC(nC,{ProviderName:$T(rC),ProviderSite:$T(iC),ServiceContact:$T((function(e,t){return tC({},yC,e,t)}))}),xC=[null,"http://www.opengis.net/wmts/1.0"],bC=[null,"http://www.opengis.net/ows/1.1"],vC=eC(xC,{Contents:$T((function(e,t){return tC({},wC,e,t)}))}),wC=eC(xC,{Layer:QT((function(e,t){return tC({},SC,e,t)})),TileMatrixSet:QT((function(e,t){return tC({},IC,e,t)}))}),SC=eC(xC,{Style:QT((function(e,t){const i=tC({},AC,e,t);if(!i)return;const s="true"===e.getAttribute("isDefault");return i.isDefault=s,i})),Format:QT(rC),TileMatrixSetLink:QT((function(e,t){return tC({},EC,e,t)})),Dimension:QT((function(e,t){return tC({},RC,e,t)})),ResourceURL:QT((function(e){const t=e.getAttribute("format"),i=e.getAttribute("template"),s=e.getAttribute("resourceType"),r={};return t&&(r.format=t),i&&(r.template=i),s&&(r.resourceType=s),r}))},eC(bC,{Title:$T(rC),Abstract:$T(rC),WGS84BoundingBox:$T(OC),Identifier:$T(rC)})),AC=eC(xC,{LegendURL:QT((function(e){const t={};return t.format=e.getAttribute("format"),t.href=iC(e),t}))},eC(bC,{Title:$T(rC),Identifier:$T(rC)})),EC=eC(xC,{TileMatrixSet:$T(rC),TileMatrixSetLimits:$T((function(e,t){return tC([],MC,e,t)}))}),MC=eC(xC,{TileMatrixLimits:YT((function(e,t){return tC({},PC,e,t)}))}),PC=eC(xC,{TileMatrix:$T(rC),MinTileRow:$T(sC),MaxTileRow:$T(sC),MinTileCol:$T(sC),MaxTileCol:$T(sC)}),RC=eC(xC,{Default:$T(rC),Value:QT(rC)},eC(bC,{Identifier:$T(rC)})),BC=eC(bC,{LowerCorner:YT(LC),UpperCorner:YT(LC)}),IC=eC(xC,{WellKnownScaleSet:$T(rC),TileMatrix:QT((function(e,t){return tC({},DC,e,t)}))},eC(bC,{SupportedCRS:$T(rC),Identifier:$T(rC),BoundingBox:$T(OC)})),DC=eC(xC,{TopLeftCorner:$T(LC),ScaleDenominator:$T((function(e){return function(e){const t=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(e);if(t)return parseFloat(t[1])}(JT(e,!1))})),TileWidth:$T(sC),TileHeight:$T(sC),MatrixWidth:$T(sC),MatrixHeight:$T(sC)},eC(bC,{Identifier:$T(rC)}));function OC(e,t){const i=tC([],BC,e,t);if(2==i.length)return function(e){const t=[1/0,1/0,-1/0,-1/0];for(let i=0,s=e.length;i<s;++i)VC(t,e[i]);return t}(i)}function LC(e){const t=rC(e).split(/\s+/);if(!t||2!=t.length)return;const i=+t[0],s=+t[1];return isNaN(i)||isNaN(s)?void 0:[i,s]}function VC(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1]);}const NC=[0,0,0];class FC{constructor(e){let t;if(this.minZoom=void 0!==e.minZoom?e.minZoom:0,this.resolutions=e.resolutions,!e.origins)for(let e=0,i=this.resolutions.length-1;e<i;++e)if(t){if(this.resolutions[e]/this.resolutions[e+1]!==t){t=void 0;break}}else t=this.resolutions[e]/this.resolutions[e+1];this.zoomFactor=t,this.maxZoom=this.resolutions.length-1,this.origin=void 0!==e.origin?e.origin:null,this.origins=null,void 0!==e.origins&&(this.origins=e.origins);const i=e.extent;void 0===i||this.origin||this.origins||(this.origin=[i[0],i[3]]),this.tileSizes=null,void 0!==e.tileSizes&&(this.tileSizes=e.tileSizes),this.tileSize=void 0!==e.tileSize?e.tileSize:this.tileSizes?null:256,this.extent=void 0!==i?i:null,this.fullTileRanges=null,this.tmpSize=[0,0],this.tmpExtent=[0,0,0,0],void 0!==e.sizes?this.fullTileRanges=e.sizes.map((function(e,t){const s={minX:Math.min(0,e[0]),maxX:Math.max(e[0]-1,-1),minY:Math.min(0,e[1]),maxY:Math.max(e[1]-1,-1)};if(i){const e=this.getTileRangeForExtentAndZ(i,t);s.minX=Math.max(e.minX,s.minX),s.maxX=Math.min(e.maxX,s.maxX),s.minY=Math.max(e.minY,s.minY),s.maxY=Math.min(e.maxY,s.maxY);}return s}),this):i&&this.calculateTileRanges(i);}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin?this.origin:this.origins[e]}getResolution(e){return this.resolutions[e]}getTileRangeForExtentAndZ(e,t){this.getTileCoordForXYAndZ(e[0],e[3],t,!1,NC);const i=NC[1],s=NC[2];return this.getTileCoordForXYAndZ(e[2],e[1],t,!0,NC),{minX:i,maxX:NC[1],minY:s,maxY:NC[2]}}getTileCoordForXYAndZ(e,t,i,s,r){const n=this.getOrigin(i),o=this.getResolution(i),a=(l=this.getTileSize(i),h=this.tmpSize,Array.isArray(l)?l:(void 0===h?h=[l,l]:(h[0]=l,h[1]=l),h));var l,h;let _=(e-n[0])/o/a[0],c=(n[1]-t)/o/a[1];return s?(_=Math.ceil(GC(_,5))-1,c=Math.ceil(GC(c,5))-1):(_=Math.floor(GC(_,5)),c=Math.floor(GC(c,5))),r[0]=i,r[1]=_,r[2]=c,r}getTileSize(e){return this.tileSize?this.tileSize:this.tileSizes[e]}getFullTileRange(e){return this.fullTileRanges?this.fullTileRanges[e]:this.extent?this.getTileRangeForExtentAndZ(this.extent,e):null}calculateTileRanges(e){const t=this.resolutions.length,i=new Array(t);for(let s=this.minZoom;s<t;++s)i[s]=this.getTileRangeForExtentAndZ(e,s);this.fullTileRanges=i;}}function GC(e,t){const i=Math.pow(10,t);return Math.round(e*i)/i}function kC(e){if("EPSG:4326"!==(e=e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3"))&&"EPSG:3857"!==e)throw Error(`WTMS服务中含有不支持的坐标系统${e}`);return e}class UC extends FC{constructor(e){super({extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes}),this.matrixIds=e.matrixIds;}getMatrixId(e){return this.matrixIds[e]}getMatrixIds(){return this.matrixIds}}const HC={width:100,height:100};class zC{constructor(t,i,s,r){this._gl=t,this._n=void 0,this._uMvpMatrix=void 0,this._options=i,this._canvas=s,this.map=r,this.lastX=-1,this.lastY=-1,this.lastMouseLnglat=[-1,-1],this.dragging=!1,this.curLnglat=[i.center[0],i.center[1]],this.bufferArray=[],this.ellipsoid=new e.Ellipsoid(2.3,2.3,2.3),this.bearing=0,this.pitch=0,this.roll=0,this.mvpMatrix=new e.Matrix4,this.projMatrix=new e.Matrix4,this.projMatrix.perspective({fov:1,aspect:this._canvas.width/this._canvas.height,near:.01,far:10}),this.viewMatrix=new e.Matrix4,this.modelMatrix=new e.Matrix4,this.init(t),this.rotateGlobal();}initVertexBuffers(e){const t=new zh({radius:2.3,widthSegments:100,heightSegments:100});if(!this.initArrayBuffer(e,"a_Position",new Float32Array(t.vertices),e.FLOAT,3))return -1;if(!this.initArrayBuffer(e,"a_TexCoord",new Float32Array(t.uvs),e.FLOAT,2))return -1;const i=e.createBuffer();return this.bufferArray.push(i),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(t.indices),e.STATIC_DRAW),t.indices.length}initArrayBuffer(e,t,i,s,r){const n=e.createBuffer();this.bufferArray.push(n),e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW);const o=e.getAttribLocation(e.program,t);return e.vertexAttribPointer(o,r,s,!1,0,0),e.enableVertexAttribArray(o),!0}loadTexture(t,i){this.texture=t.createTexture();const s=t.getUniformLocation(t.program,"u_Sampler");return e.getImage({url:i},((i,r)=>{if(i)throw new e.ErrorEvent(i);r&&(this.bindTexture(t,r,this.texture,s),this.initEventHandlers(),this._uMvpMatrix=t.getUniformLocation(t.program,"u_MvpMatrix"),this.draw(t));})),!0}bindTexture(e,t,i,s){e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGB,e.RGB,e.UNSIGNED_BYTE,t),e.uniform1i(s,0);}draw(e){this.mvpMatrix=this.projMatrix.clone(),this.mvpMatrix.multiplyRight(this.viewMatrix),this.mvpMatrix.multiplyRight(this.modelMatrix),e.uniformMatrix4fv(this._uMvpMatrix,!1,this.mvpMatrix.toFloat32Array()),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.drawElements(e.TRIANGLES,this._n,e.UNSIGNED_SHORT,0);}init(e){jC(e,"\n\t\tprecision highp float;\n\t\tattribute vec4 a_Position;\n\t\tattribute vec2 a_TexCoord;\n\t\tvarying vec2 v_TexCoord;\n\t\tuniform mat4 u_MvpMatrix;\n\t\tvoid main() {\n\t\t  gl_Position = u_MvpMatrix * a_Position;\n\t\t  v_TexCoord = a_TexCoord;\n\t\t}\n\t\t","\n\t\tprecision highp float;\n\t\tuniform sampler2D u_Sampler;\n\t\tvarying vec2 v_TexCoord;\n\t\tvoid main() {\n\t\t  gl_FragColor = texture2D(u_Sampler, v_TexCoord);\n\t\t}\n\t\t"),this._n=this.initVertexBuffers(e),e.clear(e.DEPTH_BUFFER_BIT),e.enable(e.DEPTH_TEST),this.loadTexture(e,this._options.url);}initEventHandlers(){W.addEventListener(this._canvas,"mousedown",this._onDraggingStart.bind(this)),W.addEventListener(this._canvas,"touchstart",this._onDraggingStart.bind(this)),W.addEventListener(this._canvas,"mousemove",this._onDraggingMove.bind(this)),W.addEventListener(this._canvas,"touchmove",this._onDraggingMove.bind(this)),W.addEventListener(this._canvas,"mouseup",this._onDraggingEnd.bind(this)),W.addEventListener(this._canvas,"mouseout",this._onDraggingEnd.bind(this)),W.addEventListener(this._canvas,"touchend",this._onDraggingEnd.bind(this)),this._options.clickCallback&&W.addEventListener(this._canvas,"click",this._onClick.bind(this));}destroyEventHandlers(){W.removeEventListener(this._canvas,"mousedown",this._onDraggingStart),W.removeEventListener(this._canvas,"touchstart",this._onDraggingStart),W.removeEventListener(this._canvas,"mousemove",this._onDraggingMove),W.removeEventListener(this._canvas,"touchmove",this._onDraggingMove),W.removeEventListener(this._canvas,"mouseup",this._onDraggingEnd),W.removeEventListener(this._canvas,"mouseout",this._onDraggingEnd),W.removeEventListener(this._canvas,"touchend",this._onDraggingEnd),this._options.clickCallback&&W.removeEventListener(this._canvas,"click",this._onClick);}_onClick(e){if(this.isMoveEvt)return;let t,i;const s=e.target.getBoundingClientRect();e.changedTouches&&e.changedTouches.length?(t=e.changedTouches[0].clientX-s.left-e.target.clientLeft,i=e.changedTouches[0].clientY-s.top-e.target.clientTop):(t=e.layerX,i=e.layerY),e.lnglat=this.calculateWebGLLngLat(t,i),e.lnglat&&this._options.clickCallback(e);}_onDraggingEnd(e){let t,i;e.changedTouches&&e.changedTouches.length?(t=e.changedTouches[0].clientX,i=e.changedTouches[0].clientY):(t=e.clientX,i=e.clientY),this.isMoveEvt=!0,this.moveDownXY&&t===this.moveDownXY.x&&i===this.moveDownXY.y&&(this.isMoveEvt=!1,this._onClick(e)),this.dragging=!1,this._canvas.style.cursor="pointer",this.draw(this._gl);}_onDraggingStart(e){let t,i;e.preventDefault(),e.touches&&e.touches.length?(t=e.touches[0].clientX,i=e.touches[0].clientY):(t=e.clientX,i=e.clientY),this.moveDownXY={x:t,y:i},this.isMoveEvt=!1,this._canvas.style.cursor="grabbing";const s=e.target.getBoundingClientRect();s.left<=t&&t<s.right&&s.top<=i&&i<s.bottom&&(e.touches&&e.touches.length?(this.lastX=e.touches[0].clientX-s.left-e.target.clientLeft,this.lastY=e.touches[0].clientY-s.top-e.target.clientTop):(this.lastX=e.layerX,this.lastY=e.layerY),this.dragging=!0),this.draw(this._gl);}_onDraggingMove(t){if(!this.dragging)return;let i,s;this.isMoveEvt=!0;const r=t.target.getBoundingClientRect();t.touches&&t.touches.length?(i=t.touches[0].clientX-r.left-t.target.clientLeft,s=t.touches[0].clientY-r.top-t.target.clientTop):(i=t.layerX,s=t.layerY);const n=this.calculateWebGLLngLat(i,s);if(!n)return;this.lastMouseLnglat=this.calculateWebGLLngLat(this.lastX,this.lastY);const o=n[0]-this.lastMouseLnglat[0],a=n[1]-this.lastMouseLnglat[1];this.lastX=i,this.lastY=s,this.curLnglat=[this.curLnglat[0]-o,this.curLnglat[1]-a],this.curLnglat=e.limitLnglatScope(this.curLnglat),this.rotateGlobal(),this.map.jumpTo({target:[this.curLnglat[0],this.curLnglat[1],this.map.getCameraHeight()],bearing:this.bearing,pitch:this.map.getCameraPitch(),roll:this.map.getCameraRoll()}),this.draw(this._gl);}rotateGlobal(){const t=e.HeadingPitchRoll.fromDegrees(this.bearing,this.pitch,this.roll),i=e.Vector3.fromDegrees(...this.curLnglat,2.7,this.ellipsoid);this.viewMatrix=e.Transforms.headingPitchRollToFixedFrame(i,t,this.ellipsoid),this.viewMatrix.invert();}setCamera(e,t){this.curLnglat=[e[0],e[1]],this.bearing=t,this.rotateGlobal(),this.draw(this._gl);}calculateWebGLLngLat(t,i){const{width:s,height:r}=this._canvas,n=e.getPickPositionOfSurface({canvasX:t,canvasY:i,transform:{width:s,height:r,getCameraPos:()=>e.Vector3.fromDegrees(...this.curLnglat,2.7,this.ellipsoid).toArray(),activeCamera:{projectionMatrixInverse:this.projMatrix.clone().invert(),matrixWorld:this.viewMatrix.clone().invert()}},ellipsoid:this.ellipsoid});return n.lngLat?this.toArray(n.lngLat):null}toArray(e){return [e.lng,e.lat]}destroyGL(){if(this.texture&&this._gl.deleteTexture(this.texture),this.bufferArray.length)for(let e=0;e<this.bufferArray.length;e++){const t=this.bufferArray[e];this.bufferArray.splice(e,1),this._gl.deleteBuffer(t),e--;}}destroy(){return this.destroyEventHandlers(),this.destroyGL(),e.destroyObject(this)}}const WC=(t,i,s)=>{const r=t.createShader(i);if(null==r)throw new Error("unable to create shader");if(t.shaderSource(r,s),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){const i=t.getShaderInfoLog(r);return e.warnOnce(`Failed to compile shader: ${i}`),t.deleteShader(r),null}return r},jC=(e,t,i)=>{const s=((e,t,i)=>{const s=WC(e,e.VERTEX_SHADER,t),r=WC(e,e.FRAGMENT_SHADER,i);if(!s||!r)return null;const n=e.createProgram();if(!n)return null;if(e.attachShader(n,s),e.attachShader(n,r),e.linkProgram(n),!e.getProgramParameter(n,e.LINK_STATUS)){const t=e.getProgramInfoLog(n);return console.warn(`Failed to link program: ${t}`),e.deleteProgram(n),e.deleteShader(r),e.deleteShader(s),null}return n})(e,t,i);return s?(e.useProgram(s),e.program=s,!0):(console.warn("Failed to create program"),!1)},XC={getJSON:e.getJSON,getString:e.getString},qC={RenderState:e.RenderState,ArcType:e.ArcType,ARCTYPE:e.ARCTYPE,AnalysisVisibleType:t,InterferenceType:i,AnimationConstants:_,AnimationTrackingMode:rt,AnimationTrackingEffects:c,ClassificationType:e.ClassificationType,LightingModelType:e.LightingModelType,ShadowsModelType:AT,ShadowsType:e.ShadowsType,ViewDomeType:wg,ProjectionType:e.ProjectionType,WebGLConstants:e.WebGLConstants,AnimationClip:He,AnimationBlender:ht,MultiTrackingKeyframeTrack:ut,MultiPositionKeyframeTrack:mt,TrackingKeyframeTrack:dt,PositionKeyframeTrack:ct,Attribution:Nf,FPSControl:Hf,Fullscreen:class{constructor(){this._fullscreen=!1,e.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in e.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in e.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in e.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in e.window.document&&(this._fullscreenchange="MSFullscreenChange"),this._className="minemap-ctrl";}onAdd(t){return this._map=t,this._mapContainer=this._map.getContainer(),this._container=W.create("div",`${this._className} minemap-ctrl-group`),this._checkFullscreenSupport()?this._setupUI():(this._container.style.display="none",e.warnOnce("This device does not support fullscreen mode.")),this._container}onRemove(){W.remove(this._container),this._map=null,e.window.document.removeEventListener(this._fullscreenchange,this._changeIcon);}_checkFullscreenSupport(){return !!(e.window.document.fullscreenEnabled||e.window.document.mozFullScreenEnabled||e.window.document.msFullscreenEnabled||e.window.document.webkitFullscreenEnabled)}_setupUI(){const t=this._fullscreenButton=W.create("button",`${this._className}-icon ${this._className}-fullscreen`,this._container);t.setAttribute("aria-label","Toggle fullscreen"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),e.window.document.addEventListener(this._fullscreenchange,this._changeIcon);}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.title=e;}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(e.window.document.fullscreenElement||e.window.document.mozFullScreenElement||e.window.document.webkitFullscreenElement||e.window.document.msFullscreenElement)===this._mapContainer!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle(`${this._className}-shrink`),this._fullscreenButton.classList.toggle(`${this._className}-fullscreen`));}_onClickFullscreen(){this._isFullscreen()?e.window.document.exitFullscreen?e.window.document.exitFullscreen():e.window.document.mozCancelFullScreen?e.window.document.mozCancelFullScreen():e.window.document.msExitFullscreen?e.window.document.msExitFullscreen():e.window.document.webkitCancelFullScreen&&e.window.document.webkitCancelFullScreen():this._mapContainer.requestFullscreen?this._mapContainer.requestFullscreen():this._mapContainer.mozRequestFullScreen?this._mapContainer.mozRequestFullScreen():this._mapContainer.msRequestFullscreen?this._mapContainer.msRequestFullscreen():this._mapContainer.webkitRequestFullscreen&&this._mapContainer.webkitRequestFullscreen();}},Geolocate:class extends e.Evented{constructor(t){super(),this.options=e.extend({},yT,t),e.bindAll(["_onSuccess","_onError","_finish","_setupUI","_updateCamera","_updateMarker"],this);}onAdd(t){var i;return this._map=t,this._container=W.create("div",`${TT} ${TT}-group`),i=this._setupUI,void 0!==CT?i(CT):void 0!==e.window.navigator.permissions?e.window.navigator.permissions.query({name:"geolocation"}).then((e=>{CT="denied"!==e.state,i(CT);})):(CT=!!e.window.navigator.geolocation,i(CT)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(e.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker.remove(),W.remove(this._container),this._map=void 0;}_onSuccess(t){if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-background");}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("minemap-user-location-dot-stale"),this.fire(new e.Event("geolocate",t)),this._finish();}_updateCamera(t){const i=new e.LngLat(t.coords.longitude,t.coords.latitude);this._map.fitBounds(i.toBounds(t.coords.accuracy),this.options.fitBoundsOptions,{geolocateSource:!0});}_updateMarker(e){e?this._userLocationDotMarker.setLngLat([e.coords.longitude,e.coords.latitude]).addTo(this._map):this._userLocationDotMarker.remove();}_onError(t){if(this.options.trackUserLocation)if(1===t.code)this._watchState="OFF",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background-error"),void 0!==this._geolocationWatchID&&this._clearWatch();else switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting");}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("minemap-user-location-dot-stale"),this.fire(new e.Event("error",t)),this._finish();}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0;}_setupUI(t){!1!==t?(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=W.create("button",`${TT}-icon ${TT}-geolocate`,this._container),this._geolocateButton.type="button",this._geolocateButton.setAttribute("aria-label",this._map._getUIString("GeolocateControl.Geolocate")),this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=W.create("div","minemap-user-location-dot"),this._userLocationDotMarker=new Qf(this._dotElement),this.options.trackUserLocation&&(this._watchState="OFF")),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("minemap-ctrl-geolocate-background"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this.fire(new e.Event("trackuserlocationend")));}))):e.warnOnce("Geolocation support is not available, the GeolocateControl will not be visible.");}trigger(){if(!this._setup)return e.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._watchState="OFF",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background-error"),this.fire(new e.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.Event("trackuserlocationstart"));}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("minemap-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("minemap-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-background-error");}"OFF"===this._watchState&&void 0!==this._geolocationWatchID?this._clearWatch():void 0===this._geolocationWatchID&&(this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._geolocationWatchID=e.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,this.options.positionOptions));}else e.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return !0}_clearWatch(){e.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null);}},Navigation:Ay,Scale:class{constructor(t){this.options=e.extend({},xT,t),e.bindAll(["_onMove","setUnit"],this);}getDefaultPosition(){return "bottom-left"}onAdd(t){this._map=t,this._container=W.create("div","minemap-ctrl minemap-ctrl-scale",t.getContainer()),this._content=W.create("div","minemap-ctrl-scale-text",this._container),this._container.appendChild(this._content);const i=W.create("div","minemap-ctrl-scale-left-bar",this._container),s=W.create("div","minemap-ctrl-scale-right-bar",this._container),r=W.create("div","minemap-ctrl-scale-bottom-bar",this._container);return this._container.appendChild(i),this._container.appendChild(s),this._container.appendChild(r),this._onMove=(n=()=>{bT(this._map,this._container,this._content,this.options);},a=!0,l=!0,e.isObject(o)&&(a="leading"in o?!!o.leading:a,l="trailing"in o?!!o.trailing:l),function(t,i,s){var r,n,o,a,l,h,_=0,c=!1,d=!1,u=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function m(e){var i=r,s=n;return r=n=void 0,_=e,a=t.apply(s,i)}function p(e){var t=e-h;return void 0===h||t>=i||t<0||d&&e-_>=o}function f(){var e=Ho();if(p(e))return g(e);l=setTimeout(f,function(e){var t=i-(e-h);return d?Wo(t,o-(e-_)):t}(e));}function g(e){return l=void 0,u&&r?m(e):(r=n=void 0,a)}function y(){var e=Ho(),t=p(e);if(r=arguments,n=this,h=e,t){if(void 0===l)return function(e){return _=e,l=setTimeout(f,i),c?m(e):a}(h);if(d)return clearTimeout(l),l=setTimeout(f,i),m(h)}return void 0===l&&(l=setTimeout(f,i)),a}return i=Uo(i)||0,e.isObject(s)&&(c=!!s.leading,o=(d="maxWait"in s)?zo(Uo(s.maxWait)||0,i):o,u="trailing"in s?!!s.trailing:u),y.cancel=function(){void 0!==l&&clearTimeout(l),_=0,r=h=n=l=void 0;},y.flush=function(){return void 0===l?a:g(Ho())},y}(n,200,{leading:a,maxWait:200,trailing:l})),this._map.on("move",this._onMove),this._onMove(),this._container;var n,o,a,l;}onRemove(){W.remove(this._container),this._map.off("move",this._onMove),this._map=void 0;}setUnit(e){this.options.unit=e,bT(this._map,this._container,this._content,this.options);}},Marker:Qf,Popup:class extends e.Evented{constructor(t){super(),this.options=e.extend(Object.create(wT),t),this.heightToSurface=0,e.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[]);}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("minemap-track-pointer")):this._map.on("move",this._update),t.__popupList.push(this),this.fire(new e.Event("open")),this}isOpen(){return !!this._map}remove(){if(this._content&&this._content.remove(),this._container&&(this._container.remove(),delete this._container),this._map){for(let e=0;e<this._map.__popupList.length;e++)this._map.__popupList[e]===this&&this._map.__popupList.splice(e,1);this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map;}return this.fire(new e.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(t){return t=e.LngLat.convert(t),e.LngLat.equals(t,this._lngLat||new e.LngLat(0,0))&&this.boundingVolume||(this.boundingVolume=new e.BoundingSphere(e.Vector3.fromDegrees(t.lng,t.lat,this.heightToSurface),100)),this._lngLat=e.LngLat.convert(t),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("minemap-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("minemap-track-pointer")),this}getAltitude(){return this.heightToSurface}setAltitude(t){return this.heightToSurface=t,this.boundingVolume=new e.BoundingSphere(e.Vector3.fromDegrees(this._lngLat.lng,this._lngLat.lat,this.heightToSurface),100),this._pos=null,this._update(),this._trackPointer=!1,this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("minemap-popup-track-pointer"),this._map._canvasContainer.classList.remove("minemap-track-pointer")),this}setText(t){return this.setDOMContent(e.window.document.createTextNode(t))}setHTML(t){const i=e.window.document.createDocumentFragment(),s=e.window.document.createElement("body");let r;for(s.innerHTML=t;r=s.firstChild,r;)i.appendChild(r);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=W.create("div","minemap-popup-content",this._container);return this._content.appendChild(e),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._container&&this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._container&&this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._container&&this._updateClassList(),t}_createCloseButton(){this.options.closeButton&&(this._closeButton=W.create("button","minemap-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose));}_createContent(){this._content&&W.remove(this._content),this._content=W.create("div","minemap-popup-content",this._container),this.options.closeButton&&(this._closeButton=W.create("button","minemap-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClickClose));}_updateClassList(){const e=[...this._classList];e.push("minemap-popup"),this._anchor&&e.push(`minemap-popup-anchor-${this._anchor}`),this._trackPointer&&e.push("minemap-popup-track-pointer"),this._container.className=e.join(" ");}calculateScreenCoordinates(){const t=e.Transforms.cartographicToCartesian3(new e.Vector3(this._lngLat.lng,this._lngLat.lat,this.heightToSurface||0)),i=this._map.transform,s=e.Transforms.pointToWindowCoordinatesFrontCheck(i.activeCamera.getVPMatrix(),i.pixelMatrix,new e.Vector3(t));return new e.pointGeometry3d(s.x*s.z,s.y*s.z)}_update(t){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=W.create("div","minemap-popup",this._map.getContainer()),this._tip=W.create("div","minemap-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),!this._trackPointer||t){const i=this._pos=this._trackPointer&&t?t:this.calculateScreenCoordinates(),s=function(t){if(t||(t=new e.pointGeometry3d(0,0)),"number"==typeof t){const i=Math.round(Math.sqrt(.5*Math.pow(t,2)));return {center:new e.pointGeometry3d(0,0),top:new e.pointGeometry3d(0,t),"top-left":new e.pointGeometry3d(i,i),"top-right":new e.pointGeometry3d(-i,i),bottom:new e.pointGeometry3d(0,-t),"bottom-left":new e.pointGeometry3d(i,-i),"bottom-right":new e.pointGeometry3d(-i,-i),left:new e.pointGeometry3d(t,0),right:new e.pointGeometry3d(-t,0)}}if(t instanceof e.pointGeometry3d||Array.isArray(t)){const i=e.pointGeometry3d.convert(t);return {center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return {center:e.pointGeometry3d.convert(t.center||[0,0]),top:e.pointGeometry3d.convert(t.top||[0,0]),"top-left":e.pointGeometry3d.convert(t["top-left"]||[0,0]),"top-right":e.pointGeometry3d.convert(t["top-right"]||[0,0]),bottom:e.pointGeometry3d.convert(t.bottom||[0,0]),"bottom-left":e.pointGeometry3d.convert(t["bottom-left"]||[0,0]),"bottom-right":e.pointGeometry3d.convert(t["bottom-right"]||[0,0]),left:e.pointGeometry3d.convert(t.left||[0,0]),right:e.pointGeometry3d.convert(t.right||[0,0])}}(this.options.offset),r=this._anchor=this._getAnchor(s),n=i.add(s[r]).round();this._map._requestDomTask((()=>{this._container&&r&&(this._container.style.transform=`${Yf[r]} translate(${n.x}px,${n.y}px)`);})),this._updatePanoramaMode();}this._updateClassList();}}_updatePanoramaMode(){if(!this._trackPointer){const t=this._map.transform.activeCamera.frustumCrate.cullingVolume.computeVisibility(this.boundingVolume);if(this._container.style.visibility=t===e.INTERSECTION.OUTSIDE?"hidden":"visible","visible"==this._container.style.visibility){const t=e.Transforms.cartographicToCartesian3([this._lngLat.lng,this._lngLat.lat,this.heightToSurface]),i=new e.Vector3(this._map.transform.getCameraPos()),s=new e.Vector3(t[0]-i[0],t[1]-i[1],t[2]-i[2]).normalize(),r=e.getPickPositionOfSurfaceByOriginAndDir(i,s);r&&i.distance(r)<i.distance(t)-1e4&&(this._container.style.visibility="hidden");}}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(ST);e&&e.focus();}_onClose(){this.remove();}_setOpacity(e){this._content&&(this._content.style.opacity=e),this._tip&&(this._tip.style.opacity=e);}getElement(){return this._container}getMap(){return this._map}_onMouseUp(e){this._update(e.point);}_onMouseMove(e){this._update(e.point);}_onDrag(e){this._update(e.point);}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._pos,i=this._container.offsetWidth,s=this._container.offsetHeight;let r;return r=t.y+e.bottom.y<s?["top"]:t.y>this._map.transform.height-s?["bottom"]:[],t.x<i/2?r.push("left"):t.x>this._map.transform.width-i/2&&r.push("right"),0===r.length?"bottom":r.join("-")}},OrthographicCamera:h,PerspectiveCamera:l,OrthographicFrustum:e.OrthographicFrustum,OrthographicOffCenterFrustum:e.OrthographicOffCenterFrustum,PerspectiveFrustum:n,PerspectiveOffCenterFrustum:e.PerspectiveOffCenterFrustum,Plane:e.Plane,INTERSECTION:e.INTERSECTION,BillboardMaterial:za,GradientColorBoxMaterial:sy,PhysicalMaterial:aa,StandardMaterial:e.StandardMaterial,StandardMaterialType:e.StandardMaterialType,WaterMaterial:ry,MirrorMaterial:hf,PhongMaterial:ha,LambertMaterial:class extends e.Material{constructor(t){t.type="LambertMaterial",super(t),this.color=new e.Color(1,1,1).toVector3(),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new e.Color(0,0,0).toVector3(),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new e.Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.opacity=1,this.setValues(t);}setValues(e){super.setValues(e);}update(e,t,i={}){super.update(e,t,i),this._uniforms.set("u_Color",(()=>this.color)),this._uniforms.set("u_Reflectivity",(()=>this.reflectivity)),this._uniforms.set("u_Opacity",(()=>this.opacity));}serialize(){return {type:this.type,color:e.Vector3.pack(this.color,new Array(3)),reflectivity:this.reflectivity,opacity:this.opacity}}destroy(){}},PolylineMaterial:e.PolylineMaterial,BoxGeometry:Jg,BoxOutlineGeometry:Dp,ConeGeometry:Zg,CylinderGeometry:Yg,FrustumGeometry:rg,FrustumOutlineGeometry:ng,PlaneGeometry:ey,PlaneOutlineGeometry:ty,PolygonGeometry:e.PolygonGeometry,PolygonOutlineGeometry:ug,SimplePolylineGeometry:qu,SphereGeometry:zh,GradientColorBoxGeometry:$g,WallGeometry:yg,WallOutlineGeometry:iy,PolylineGeometry:e.PolylineGeometry,BillboardGeometry:ja,FenceGeometry:Qg,RegionGeometry:PT,RegionOutlineGeometry:RT,Geometries:{BoxGeometry:Jg,BoxOutlineGeometry:Dp,ConeGeometry:Zg,CylinderGeometry:Yg,FrustumGeometry:rg,FrustumOutlineGeometry:ng,PlaneGeometry:ey,PlaneOutlineGeometry:ty,PolygonGeometry:e.PolygonGeometry,PolygonOutlineGeometry:ug,SimplePolylineGeometry:qu,SphereGeometry:zh,GradientColorBoxGeometry:$g,WallGeometry:yg,WallOutlineGeometry:iy,PolylineGeometry:e.PolylineGeometry,BillboardGeometry:ja,FenceGeometry:Qg,RegionGeometry:PT,RegionOutlineGeometry:RT},PointPrimitive:Lh,PointPrimitiveCollection:kh,Primitive:e.Primitive,AmbientLight:Ld,SunLight:ra,DirectionalLight:Ko,PointLight:lf,AxisAlignedBoundingBox:e.AxisAlignedBoundingBox,BoundingRectangle:e.BoundingRectangle,BoundingSphere:e.BoundingSphere,OrientedBoundingBox:e.OrientedBoundingBox,Bounds:{AxisAlignedBoundingBox:e.AxisAlignedBoundingBox,BoundingRectangle:e.BoundingRectangle,BoundingSphere:e.BoundingSphere,OrientedBoundingBox:e.OrientedBoundingBox},SphereEmitter:class{constructor(t){t=e.defaultValue(t,1),this._radius=e.defaultValue(t,1);}emit(t){const i=e.randomBetween(0,e.CONSTS.TRANSFORM.TWO_PI),s=e.randomBetween(0,e.CONSTS.TRANSFORM.PI),r=e.randomBetween(0,this._radius),n=r*Math.cos(i)*Math.sin(s),o=r*Math.sin(i)*Math.sin(s),a=r*Math.cos(s);t.position=e.Vector3.fromElements(n,o,a,t.position),t.velocity=e.Vector3.normalize(t.position,t.velocity);}},CircleEmitter:LT,ConeEmitter:class{constructor(t){this._angle=e.defaultValue(t,zT);}emit(t){const i=Math.tan(this._angle),s=e.randomBetween(0,e.CONSTS.TRANSFORM.TWO_PI),r=e.randomBetween(0,i),n=r*Math.cos(s),o=r*Math.sin(s);t.velocity=e.Vector3.fromElements(n,o,1,t.velocity),e.Vector3.normalize(t.velocity,t.velocity),t.position=e.Vector3.clone(e.Vector3.ZERO,t.position);}},BoxEmitter:class{constructor(t){t=e.defaultValue(t,WT),this._dimensions=e.Vector3.clone(t);}emit(t){const i=e.Vector3.multiplyByScalar(this._dimensions,.5,jT),s=e.randomBetween(-i.x,i.x),r=e.randomBetween(-i.y,i.y),n=e.randomBetween(-i.z,i.z);t.position=e.Vector3.fromElements(s,r,n,t.position),t.velocity=e.Vector3.normalize(t.position,t.velocity);}},RandomBoxEmitter:class{constructor(t){t=e.defaultValue(t,XT),this._dimensions=e.Vector3.clone(t),this._isComplete=!1,this.isRandomBoxEmitter=!0;}emit(t){const i=e.Vector3.multiplyByScalar(this._dimensions,.5,qT),s=e.randomBetween(-i.x,i.x),r=e.randomBetween(-i.y,i.y),n=e.randomBetween(-i.z,i.z);t.position=e.Vector3.fromElements(s,r,n,t.position);}},ParticleBurst:class{constructor(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this.time=e.defaultValue(t.time,0),this.minimum=e.defaultValue(t.minimum,0),this.maximum=e.defaultValue(t.maximum,50),this._complete=!1;}get complete(){return this._complete}},ParticleSystem:class{constructor(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this.show=e.defaultValue(t.show,!0),this.updateCallback=t.updateCallback,this.loop=e.defaultValue(t.loop,!0),this.image=e.defaultValue(t.image,void 0);let i=t.emitter;e.defined(i)||(i=new LT(.5)),this._emitter=i,this._bursts=t.bursts,this._modelMatrix=e.Matrix4.clone(e.defaultValue(t.modelMatrix,e.Matrix4.IDENTITY),new e.Matrix4),this._emitterModelMatrix=e.Matrix4.clone(e.defaultValue(t.emitterModelMatrix,e.Matrix4.IDENTITY),new e.Matrix4),this._matrixDirty=!0,this._combinedMatrix=new e.Matrix4,this._startColor=e.Color.clone(e.Color.parse(e.defaultValue(t.startColor,e.Color.white))),this._endColor=e.Color.clone(e.Color.parse(e.defaultValue(t.endColor,e.Color.white))),this._particleNumber=e.defaultValue(t.particleNumber,1e4),this._startScale=e.defaultValue(t.startScale,1),this._endScale=e.defaultValue(t.endScale,1),this._emissionRate=e.defaultValue(t.emissionRate,5),this.sizeattenuation=e.defaultValue(t.sizeattenuation,!0),this._speed=e.defaultValue(t.speed,1),this._particleLife=e.defaultValue(t.particleLife,5),this._minimumMass=e.defaultValue(t.minimumMass,1),this._maximumMass=e.defaultValue(t.maximumMass,1),this._lifetime=e.defaultValue(t.lifetime,Number.MAX_VALUE),this._plummeting=e.defaultValue(t.plummeting,!1),this._billboardCollection=void 0,this._particles=[],this._particlePool=[],this._previousTime=void 0,this._currentTime=0,this._carryOver=0,this._isComplete=!1,this._updateParticlePool=!0,this._particleEstimate=0,this._primitive=null,this.imageSize=t.imageSize,this.imageUrl=t.imageUrl,this.texture=t.texture,this.id=e.defaultValue(t.id,e.uuid());}get emitter(){return this._emitter}set emitter(e){this._emitter=e;}get bursts(){return this._bursts}set bursts(e){this._bursts=e,this._updateParticlePool=!0;}get modelMatrix(){return this._modelMatrix}set modelMatrix(t){e.defined(t)&&(this._matrixDirty=this._matrixDirty||!e.Matrix4.equals(this._modelMatrix,t),e.Matrix4.clone(t,this._modelMatrix));}get emitterModelMatrix(){return this._emitterModelMatrix}set emitterModelMatrix(t){this._matrixDirty=this._matrixDirty||!e.Matrix4.equals(this._emitterModelMatrix,t),e.Matrix4.clone(t,this._emitterModelMatrix);}get startColor(){return this._startColor}set startColor(t){e.Color.clone(t,this._startColor);}get endColor(){return this._endColor}set endColor(t){e.Color.clone(t,this._endColor);}get startScale(){return this._startScale}set startScale(t){e.Color.clone(t,this._startScale);}get endScale(){return this._endScale}set endScale(t){e.Color.clone(t,this._endScale);}get emissionRate(){return this._emissionRate}set emissionRate(e){this._emissionRate=e,this._updateParticlePool=!0;}get speed(){return this._speed}set speed(e){this._speed=e;}get particleLife(){return this._particleLife}set particleLife(e){this._particleLife=e;}get lifetime(){return this._lifetime}set lifetime(e){this._lifetime=e;}get isComplete(){return this._isComplete}get particleNumber(){return this._particleNumber}set particleNumber(e){this._particleNumber=e,this._emitter.isComplete=!1,this._particles=[];}update(t,i){if(!this.show)return;e.defined(this._billboardCollection)||(this._billboardCollection=[]),this._updateParticlePool&&(function(t,i){const s=t._emissionRate,r=t._maximumParticleLife;let n=0;const o=t._bursts;if(e.defined(o)){const e=o.length;for(let t=0;t<e;++t)n+=o[t].maximum;}const a=t.image,l=t.imageUrl,h=t.texture,_=Math.ceil(s*r+n),c=t._particlePool;let d;d=t._emitter.isRandomBoxEmitter?t._particleNumber:Math.max(_-t._particles.length-c.length,0);for(let e=0;e<d;++e){const e=new OT({imageSize:t.imageSize});e.image=a,c.push(e);}if(t._particleEstimate=_,!t._primitive){const s=new ja;let r;a?r=new za({image:a,sizeattenuation:t.sizeattenuation,scale:t.imageSize}):l?r=new za({imageUrl:l,sizeattenuation:t.sizeattenuation,scale:t.imageSize}):h?r=new za({texture:h,sizeattenuation:t.sizeattenuation,scale:t.imageSize}):console.error("请传入纹理texture或图片路径imageUrl或是canvas图片image");const n=new e.Primitive({id:t.id,geometry:s,material:r,particleSystem:!0});i.addPrimitive(n),t._primitive=n;}}(this,i),this._updateParticlePool=!1);let s=0;s+=t,s<0&&(s=0);const r=this._particles,n=this._emitter,o=this.updateCallback;let a,l;if(this._emitter.isRandomBoxEmitter){if(this._emitter.isComplete){this._matrixDirty&&(this._combinedMatrix=e.Matrix4.multiply(this._combinedMatrix,this.modelMatrix,this.emitterModelMatrix),this._matrixDirty=!1);const t=this._combinedMatrix,i=-this._emitter._dimensions.z/2,r=-this._emitter._dimensions.y/2,n=-this._emitter._dimensions.x/2;for(a=0;a<this._particles.length;a++){if(this._plummeting){const e=10*Math.cos(.15*s*this._particles[a].velocity.z);this._particles[a].positionClone.z-=e*this._speed;}else {const e=1e3*Math.sin(.5*s*this._particles[a].velocity.x),t=10*Math.cos(.15*s*this._particles[a].velocity.z);this._particles[a].positionClone.x+=e,this._particles[a].positionClone.y+=5*this._particles[a].velocity.y,this._particles[a].positionClone.z-=t*this._speed;}i>this._particles[a].positionClone.z&&(this._particles[a].positionClone.z+=this._emitter._dimensions.z),r>this._particles[a].positionClone.y&&(this._particles[a].positionClone.y+=this._emitter._dimensions.y),-r<this._particles[a].positionClone.y&&(this._particles[a].positionClone.y+=-this._emitter._dimensions.y),n>this._particles[a].positionClone.x&&(this._particles[a].positionClone.x+=this._emitter._dimensions.x),-n<this._particles[a].positionClone.x&&(this._particles[a].positionClone.x+=-this._emitter._dimensions.x),e.Matrix4.multiplyByPoint(t,this._particles[a].positionClone,this._particles[a].position),kT(0,this._particles[a]);}}if(!this._emitter.isComplete){this._matrixDirty&&(this._combinedMatrix=e.Matrix4.multiply(this._combinedMatrix,this.modelMatrix,this.emitterModelMatrix),this._matrixDirty=!1);const t=this._combinedMatrix;for(a=0;a<this._particleNumber;a++){l=NT(this),this._emitter.emit(l);const i=.1*Math.floor(6*Math.random()-3),s=-.05*Math.floor(10*Math.random()+3),r=.1*Math.floor(6*Math.random()-3);l.velocity=new e.Vector3(i,s,r),e.Vector3.add(l.position,l.velocity,VT),e.Matrix4.multiplyByPoint(t,VT,VT),l.positionClone=e.Vector3.clone(e.defaultValue(l.position,VT)),e.Matrix4.multiplyByPoint(t,l.position,l.position),UT(this,l),kT(0,l);}this._emitter.isComplete=!0;}}else {let t=r.length;for(a=0;a<t;++a)l=r[a],l.update(s,o)?kT(0,l):(GT(l),FT(this,l),r[a]=r[t-1],--a,--t);r.length=t;const i=function(t,i){if(t._isComplete)return 0;const s=(i=HT(i,t._lifetime))*t._emissionRate;let r=Math.floor(s);if(t._carryOver+=s-r,t._carryOver>1&&(r++,t._carryOver-=1),e.defined(t.bursts)){const i=t.bursts.length;for(let s=0;s<i;s++){const i=t.bursts[s],n=t._currentTime;e.defined(i)&&!i._complete&&n>i.time&&(r+=e.randomBetween(i.minimum,i.maximum),i._complete=!0);}}return r}(this,s);if(i>0&&e.defined(n)){this._matrixDirty&&(this._combinedMatrix=e.Matrix4.multiply(this._combinedMatrix,this.modelMatrix,this.emitterModelMatrix),this._matrixDirty=!1);const t=this._combinedMatrix;for(a=0;a<i;a++)l=NT(this),this._emitter.emit(l),e.Vector3.add(l.position,l.velocity,VT),e.Matrix4.multiplyByPoint(t,VT,VT),e.Matrix4.multiplyByPoint(t,l.position,l.position),e.Vector3.subtract(VT,l.position,l.velocity),e.Vector3.normalize(l.velocity,l.velocity),UT(this,l),kT(0,l);}}const h=[],_=[],c=[];for(let e=0;e<this._particles.length;e++){const t=this._particles[e];t.show&&(h.push(t.position),_.push(t.color.r,t.color.g,t.color.b,t.color.a),c.push(t.scale));}if(this._primitive.particleSystemInstanceCollection.updateData({positions:h,colorArr:_,scaleArr:c,frameState:i.painter.frameState}),this._currentTime+=s,this._lifetime!==Number.MAX_VALUE&&this._currentTime>this._lifetime)if(this.loop){if(this._currentTime=HT(this._currentTime,this._lifetime),this.bursts){const e=this.bursts.length;for(a=0;a<e;a++)this.bursts[a]._complete=!1;}}else this._isComplete=!0;}destroy(e){this._billboardCollection=[],this._particlePool=[],this._primitive.particleSystemInstanceCollection.destroy(),this.texture&&e.painter.textureResourceManager.removeTexture(this.texture.texUrl),this.texture=null,this.image=null,this.imageUrl=null,this.modelMatrix=null,this.startColor=null,this.endColor=null,this._emitter=null,this._bursts=null,this._combinedMatrix=null,this.speed=null,this._emissionRate=null,this._lifetime=null,this._endScale=null,this._isComplete=null,this._particleNumber=null,this._particles=[],this._startColor=null,e.removePrimitive(this._primitive);}},Excavation:bg,Highlight:cg,Interference:jg,InterferenceConjoined:Xg,LimitHeight:Vg,Measurement3D:Ku,Sightline:Og,ViewDome:Ag,Viewshed3D:Pg,Sun:im,Earth:Wu,AirLine:Ju,Skybox:Uu,SceneModel:Ua,SceneTileset:_d,ModelInstance:tt,ModelInstanceCollection:it,ClippingPlane:e.ClippingPlane,ClippingPlaneCollection:e.ClippingPlaneCollection,PostProcessStageLibrary:op,PostProcessStage:Um,PostProcessStageComposite:qm,Math:Ft,Transforms:e.Transforms,Event:e.Event,Evented:e.Evented,Map:fT,Color:e.Color,Ellipsoid:e.Ellipsoid,DistanceDisplayCondition:BT,LngLat:e.LngLat,LngLatBounds:e.LngLatBounds,NearFarScalar:Oh,TextureLoader:oa,Texture:e.Texture,VideoProjection:ag,CutFill:mg,Thumbnail:class{constructor(t){this.options=e.extend({},HC,t),e.bindAll(["_onMove"],this);}getDefaultPosition(){return "bottom-right"}_onMove(){const t=this._map.transform,i=((t,i,s)=>{const r=e.getDistanceFromZoom(i,t[2],e.CONSTS.TRANSFORM.R)-e.CONSTS.TRANSFORM.R,n=e.Vector3.fromDegrees(t[0],t[1],r),o=e.Transforms.headingPitchRollToFixedFrame(n,new e.HeadingPitchRoll(t[3]*e.CONSTS.TRANSFORM.DEG_TO_RAD,t[4]*e.CONSTS.TRANSFORM.DEG_TO_RAD,t[5]*e.CONSTS.TRANSFORM.DEG_TO_RAD)),a=e.binaryFindRayIntersectionTop(s);if(!a||!a.cartographic||!a.cartesian)return null;const l=e.binaryFindRayIntersectionBottom(s),h=a.ray,_=new e.Ray(h.origin,e.Vector3.add(h.direction,l.ray.direction).normalize()),c=e.IntersectionTests.rayEllipsoid(_,e.Transforms.DefaultEllipsoid),d=_.origin.clone().add(_.direction.clone().multiplyScalar(c.start)),u=e.Transforms.cartesian3ToCartographic(d,e.Transforms.DefaultEllipsoid);if(u[2]=0,!d||!u)return null;const m=e.Transforms.localFrameToFixedFrame(d).invert().multiplyRight(o),p=new e.Matrix3;p[0]=m[0],p[1]=m[1],p[2]=m[2],p[3]=m[4],p[4]=m[5],p[5]=m[6],p[6]=m[8],p[7]=m[9],p[8]=m[10];const f=new e.Quaternion;f.fromMatrix3(p);const g=e.HeadingPitchRoll.fromQuaternion(f);let y=g.heading*e.CONSTS.TRANSFORM.RAD_TO_DEG;Math.abs(t[3]-y)<.01&&(y=t[3]);const T=g.roll*e.CONSTS.TRANSFORM.RAD_TO_DEG,C=g.pitch*e.CONSTS.TRANSFORM.RAD_TO_DEG,x=new e.Vector3(o[12]-d[0],o[13]-d[1],o[14]-d[2]).len(),b=e.getZoomFromDistance(i,x+e.CONSTS.TRANSFORM.R,e.CONSTS.TRANSFORM.R);return [u[0],u[1],b,y,T,C]})([t.activeCamera.cartographicPosition[0],t.activeCamera.cartographicPosition[1],t._cameraHeightConvertedZoom,t.bearing,t.pitch,t.roll],e.CONSTS.TRANSFORM.FOV_IN_RADIANS,t);i&&(this._drawThumbnailControl.dragging||this._drawThumbnailControl.setCamera([i[0],i[1]],i[3]));}_setupPainter(){const t=e.extend({failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1},zf.webGLContextAttributes),i=this._canvas.getContext("webgl",t)||this._canvas.getContext("experimental-webgl",t);i?this._drawThumbnailControl=new zC(i,this.options,this._canvas,this._map):this.fire(new e.ErrorEvent(new Error("Failed to initialize WebGL")));}onAdd(e){this._map=e,this.options.center=e.getCenter().toArray(),this._container=W.create("div","minemap-ctrl minemap-ctrl-thumbnail",e.getContainer()),this._canvas=W.create("canvas","minemap-ctrl-thumbnail-canvas",this._container),this._container.appendChild(this._canvas);const{width:t,height:i}=this.options;return this._container.style=`width: ${t}px; height: ${i}px`,this._canvas.style.borderRadius="50%",this._canvas.width=t,this._canvas.height=i,this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","map-control"),this._canvas.style.outline="0px",this._canvas.style.cursor="pointer",this._setupPainter(),this._map.on("move",this._onMove),this._container}onRemove(){this._drawThumbnailControl.destroy(),W.remove(this._container),this._map.off("move",this._onMove),delete this._map;}getContainer(){return this}},WMTSCapabilities:class extends KT{constructor(){super(),this.owsParser_=new aC;}readFromNode(e){let t=e.getAttribute("version");t&&(t=t.trim());let i=this.owsParser_.readFromNode(e);return i?(i.version=t,i=tC(i,vC,e,[]),i||null):null}},util:XC},KC={optionsFromCapabilities:function(e,t){const i=e.Contents.Layer.find((e=>e.Identifier===t.layer));if(!i)throw Error(`WTMS服务中未找到${t.layer}图层`);const s=e.Contents.TileMatrixSet;let r;r=i.TileMatrixSetLink.length>1?i.TileMatrixSetLink.findIndex("projection"in t?e=>{const i=s.find((t=>t.Identifier===e.TileMatrixSet)).SupportedCRS,r=kC(i),n=kC(t.projection);return r&&n?r===n:i===t.projection}:e=>e.TileMatrixSet===t.matrixSet):0,r<0&&(r=0);const n=i.TileMatrixSetLink[r].TileMatrixSet,o=i.TileMatrixSetLink[r].TileMatrixSetLimits;let a=i.Format[0];"format"in t&&(a=t.format),r=i.Style.findIndex((e=>"style"in t?e.Title===t.style:e.isDefault)),r<0&&(r=0);const l=i.Style[r].Identifier,h=new Map;"Dimension"in i&&i.Dimension.forEach((e=>{let t=e.Default;void 0===t&&(t=e.Value[0]),h.set(e.Identifier,t);}));const _=e.Contents.TileMatrixSet.find((e=>e.Identifier===n));let c;const d=_.SupportedCRS;if(d&&(c=kC(d)),"projection"in t){const e=kC(t.projection);e&&(c&&e!==c||(c=e));}let u,m;if("EPSG:4326"===c)u=6378137*Math.PI/180,m=!0;else {if("EPSG:3857"!==c)throw Error(`WTMS服务中含有不支持的坐标系统${c}`);u=1,m=!1;}let p=_.TileMatrix[0],f={MinTileCol:0,MinTileRow:0,MaxTileCol:p.MatrixWidth-1,MaxTileRow:p.MatrixHeight-1};if(o){f=o[o.length-1];const e=_.TileMatrix.find((e=>e.Identifier===f.TileMatrix||`${_.Identifier}:${e.Identifier}`===f.TileMatrix));e&&(p=e);}const g=28e-5*p.ScaleDenominator/u,y=m?[p.TopLeftCorner[1],p.TopLeftCorner[0]]:p.TopLeftCorner,T=p.TileWidth*g,C=p.TileHeight*g;let x=_.BoundingBox;x&&m&&(x=[x[1],x[0],x[3],x[2]]);let b=[y[0]+T*f.MinTileCol,y[1]-C*(1+f.MaxTileRow),y[0]+T*(1+f.MaxTileCol),y[1]-C*f.MinTileRow];var v,w;void 0===x||(v=x)[0]<=(w=b)[0]&&w[2]<=v[2]&&v[1]<=w[1]&&w[3]<=v[3]||(b=x);const S=function(e,t,i){const s=[],r=[],n=[],o=[],a=[];i=void 0!==i?i:[];const l="TileMatrix",h="Identifier",_="ScaleDenominator",c="TopLeftCorner",d=kC(e.SupportedCRS);let u,m;if("EPSG:4326"===d)u=6378137*Math.PI/180,m=!0;else {if("EPSG:3857"!==d)throw Error(`WTMS服务中含有不支持的坐标系统${d}`);u=1,m=!1;}return e[l].sort(((e,t)=>t[_]-e[_])),e[l].forEach((t=>{let d;if(d=!(i.length>0)||i.find((i=>t[h]===i[l]||!t[h].includes(":")&&`${e[h]}:${t[h]}`===i[l])),d){r.push(t[h]);const e=28e-5*t[_]/u,i=t.TileWidth,l=t.TileHeight;n.push(m?[t[c][1],t[c][0]]:t[c]),s.push(e),o.push(i===l?i:[i,l]),a.push([t.MatrixWidth,t.MatrixHeight]);}})),new UC({extent:t,origins:n,resolutions:s,matrixIds:r,tileSizes:o,sizes:a})}(_,b,o),A=[];let E=t.requestEncoding;if(E=void 0!==E?E:"","OperationsMetadata"in e&&"GetTile"in e.OperationsMetadata){const t=e.OperationsMetadata.GetTile.DCP.HTTP.Get;for(let e=0,i=t.length;e<i;++e)if(t[e].Constraint){const i=t[e].Constraint.find((e=>"GetEncoding"===e.name)).AllowedValues.Value;if(""===E&&(E=i[0]),"KVP"!==E)break;i.includes("KVP")&&A.push(t[e].href);}else t[e].href&&(E="KVP",A.push(t[e].href));}if(0===A.length&&(E="REST",i.ResourceURL.forEach((e=>{"tile"===e.resourceType&&a&&e.format===a&&A.push(e.template);})),0===A.length))throw Error("未找到对应图层的url, 请检查参数是否正确");return {urls:A,layer:t.layer,matrixSet:n,format:a,projection:c,requestEncoding:E,tileGrid:S,style:l,dimensions:h,wrapX:!1,crossOrigin:t.crossOrigin}},setRTLTextPlugin:e.setRTLTextPlugin,getRTLTextPluginStatus:e.getRTLTextPluginStatus},JC={get accessToken(){return yt.ACCESS_TOKEN},set accessToken(e){yt.ACCESS_TOKEN=e;},get appKey(){return yt.APP_KEY},set appKey(e){yt.APP_KEY=e;},get key(){return yt.KEY},set key(e){yt.KEY=e;},get solution(){return yt.SOLU},set solution(e){yt.SOLU=e;},get dataVersion(){return yt.DATA_VERSION},set dataVersion(e){yt.DATA_VERSION=e;},get spriteUrl(){return yt.spriteUrl},set spriteUrl(e){yt.spriteUrl=e;},get fontsUrl(){return yt.fontsUrl},set fontsUrl(e){yt.fontsUrl=e;},get serviceUrl(){return yt.SERVICE_URL},set serviceUrl(e){yt.SERVICE_URL=e;},get domainUrl(){return yt.DOMAIN},set domainUrl(e){yt.DOMAIN=e,yt.SRC_URL=yt.DOMAIN+yt.SRC_BASE,yt.SERVICE_URL=yt.DOMAIN+yt.SERVICE_BASE;},get dataDomainUrl(){return yt.DATA_DOMAIN},set dataDomainUrl(e){yt.DATA_DOMAIN=e,Array.isArray(e)?(yt.API_URL=yt.DATA_DOMAIN.map((e=>e+yt.API_BASE)),yt.DYN_URL=yt.DATA_DOMAIN.map((e=>e+yt.DYN_BASE)),yt.MERGE_URL=yt.DATA_DOMAIN.map((e=>e+yt.MERGE_BASE)),yt.OTHER_URL=yt.DATA_DOMAIN.map((e=>e+yt.OTHER_BASE))):(yt.API_URL=yt.DATA_DOMAIN+yt.API_BASE,yt.DYN_URL=yt.DATA_DOMAIN+yt.DYN_BASE,yt.MERGE_URL=yt.DATA_DOMAIN+yt.MERGE_BASE,yt.OTHER_URL=yt.DATA_DOMAIN+yt.OTHER_BASE);},get serverDomainUrl(){return yt.SERVER_DOMAIN},set serverDomainUrl(e){yt.SERVER_DOMAIN=e,yt.SERVER_URL=Array.isArray(e)?yt.SERVER_DOMAIN.map((e=>`${e}/service/`)):`${yt.SERVER_DOMAIN}/service/`;},workerUrl:""};return e.extend(JC,qC,KC,{version:pt}),JC}));

//

var minemap$1 = minemap;

return minemap$1;

}));
